import{j as e,D as ne,ak as ie,l as le,i as q,g as P,Z as ce,ar as oe,R as L,m as N,v as O,as as Y,t as de,A as J,f as X,a as xe,a4 as Q,at as me,_ as ee,al as ue,T as he,a7 as pe}from"./ui-vendor-BE38435C.js";import{a}from"./react-vendor-uDOJF2jQ.js";import{u as fe}from"./useMobile-YxjH166V.js";import{k as be,v as je,l as we,m as Ne,M as ve,n as ge}from"./index.js";import{e as Se,w as B}from"./FeatureInfoButton-CSryWUQ2.js";import{M as ye,a as ke}from"./MicrophoneTestDialog-C05j5OVg.js";import{B as M,C as R}from"./Button-e95WK7fN.js";import{B as _e}from"./select-native-BLl1yQpp.js";import{V as Re,S as Me,a as Te}from"./ScenarioCard-7zFehSp1.js";import"./dialog-D3nE5LV1.js";import{u as Ce}from"./Confetti-B6L8Lnvq.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./useBranding-rTM6G-Dl.js";const te={rocket:L,shuffle:oe,zap:ce},G=({icon:t,label:r,value:p,isMobile:x})=>e.jsxs(R,{className:"p-4 md:p-6 shadow-card hover:shadow-card-hover transition-all duration-300 hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex-center mb-3 shadow-sm",children:e.jsx(t,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("div",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:p}),e.jsx("div",{className:"text-xs md:text-sm text-slate-500 font-medium",children:r})]}),Ee=({mode:t,onBack:r,onStart:p})=>{const[x,s]=a.useState(""),[l,d]=a.useState(!1),[i,m]=a.useState(null),[j,c]=a.useState(!1),S=te[t.icon]||L;a.useEffect(()=>{t.id==="klassiker"?s(t.topic):t.getTopic&&s(t.getTopic())},[t]);const v=()=>{if(!t.getTopic)return;d(!0);const E=1500,T=100;let I=0;const f=setInterval(()=>{s(t.getTopic()),I+=T,I>=E&&(clearInterval(f),d(!1))},T)},y=()=>{p({mode:t,topic:x,duration:t.duration,selectedMicrophoneId:i})};return e.jsxs("div",{className:"min-h-full flex flex-col p-6",children:[e.jsx(N.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:e.jsx(M,{variant:"secondary",size:"sm",icon:e.jsx(O,{}),onClick:r,className:"mb-8 w-fit",children:"ZurÃ¼ck zur Auswahl"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center max-w-[600px] mx-auto w-full",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex-center mx-auto mb-5 shadow-lg",children:e.jsx(S,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:t.title}),e.jsxs("p",{className:"text-base text-slate-500",children:[t.duration," Sekunden â€¢ ",t.subtitle]})]}),e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"w-full bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl p-8 mb-6 shadow-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-white/90",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold text-base",children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&e.jsxs(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:v,disabled:l,className:"btn-glass flex items-center gap-2 px-4 py-2.5 border border-white/30 rounded-lg text-sm font-semibold disabled:cursor-not-allowed",children:[e.jsx(de,{className:`w-4 h-4 ${l?"animate-spin":""}`}),l?"Dreht...":"Neu wÃ¼rfeln"]})]}),e.jsx(J,{mode:"wait",children:e.jsxs(N.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-2xl font-semibold text-white leading-relaxed min-h-[66px]",children:['"',x,'"']},x)})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(R,{className:"w-full mb-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4 text-slate-700",children:[e.jsx(X,{className:"w-5 h-5 text-violet-600"}),e.jsx("span",{className:"font-semibold text-base",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(ye,{selectedDeviceId:i,onDeviceChange:m,onTestClick:()=>c(!0)})]})}),e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"w-full bg-violet-50 border border-violet-100 rounded-2xl p-5 mb-8 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-violet-900",children:[e.jsx(xe,{className:"w-4.5 h-4.5 text-violet-600"}),e.jsx("span",{className:"font-semibold text-sm",children:"Tipps fÃ¼r deine Antwort"})]}),e.jsxs("ul",{className:"m-0 pl-5 text-slate-600 text-sm leading-relaxed list-disc",children:[e.jsx("li",{children:"Atme tief durch bevor du beginnst"}),e.jsx("li",{children:"Sprich in einem ruhigen, gleichmÃ¤ÃŸigen Tempo"}),e.jsx("li",{children:'Mache bewusst Pausen statt "Ã„hm" zu sagen'}),e.jsx("li",{children:"Strukturiere deine Antwort: Einleitung â†’ Hauptteil â†’ Schluss"})]})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"w-full max-w-[400px]",children:e.jsx(M,{size:"lg",icon:e.jsx(Q,{}),onClick:y,fullWidth:!0,children:"Aufnahme starten"})})]}),e.jsx(ke,{isOpen:j,onClose:()=>c(!1),deviceId:i})]})},A={MODES:"modes",TOPIC:"topic"},Qe=({onStartGame:t,isAuthenticated:r,requireAuth:p,setPendingAction:x})=>{const[s,l]=a.useState(A.MODES),[d,i]=a.useState(null),[m,j]=a.useState("grid"),[c,S]=a.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),v=fe(),[y,E]=a.useState(null);a.useEffect(()=>{const u=async()=>{try{const o=await B.getGameStats();o.success&&o.data&&S({totalGames:o.data.total_games||0,bestScore:o.data.best_score||0,avgScore:o.data.avg_score||0,totalPracticeTime:o.data.total_practice_time||0})}catch(o){console.error("Failed to load stats:",o)}};s===A.MODES&&u()},[s]),a.useEffect(()=>{y&&r&&(i(y),l(A.TOPIC),E(null))},[y,r]),a.useEffect(()=>{window.scrollTo(0,0)},[s]);const T=u=>{if(!r){E(u),p&&p(()=>{},null);return}i(u),l(A.TOPIC)},I=()=>{i(null),l(A.MODES)},f=u=>{t(u)},C=Object.values(be);return s===A.TOPIC&&d?e.jsx(Ee,{mode:d,onBack:I,onStart:f}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{featureId:"rhetorikgym",showOnMount:!0}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-5 md:mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2.5 md:gap-3 mb-2 md:mb-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex-center shadow-lg",children:e.jsx(ne,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Der FÃ¼llwort-Killer"})]}),e.jsx("p",{className:"text-sm md:text-base text-slate-600 max-w-[600px] mx-auto",children:"Trainiere deine Rhetorik - sprich flÃ¼ssig und Ã¼berzeugend ohne Ã„hm und Ã–h!"})]}),e.jsxs("div",{className:"px-2 md:px-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2.5 md:gap-4 mb-6 md:mb-8",children:[e.jsx(G,{icon:ie,label:"Highscore",value:c.bestScore||"-",isMobile:v}),e.jsx(G,{icon:le,label:"Spiele",value:c.totalGames||0,isMobile:v}),e.jsx(G,{icon:q,label:"Durchschnitt",value:c.avgScore?Math.round(c.avgScore):"-",isMobile:v}),e.jsx(G,{icon:P,label:"Trainingszeit",value:c.totalPracticeTime?`${Math.round(c.totalPracticeTime/60)}m`:"0m",isMobile:v})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"WÃ¤hle deinen Modus"}),e.jsx(Re,{viewMode:m,onViewChange:j})]}),e.jsx(Me,{minCardWidth:"280px",viewMode:m,children:C.map(u=>{const o=te[u.icon]||L;return e.jsx(Te,{title:u.title,subtitle:u.subtitle,description:u.description,icon:o,meta:[{icon:P,text:`${u.duration} Sekunden`}],action:{label:"Starten",icon:q},onClick:()=>T(u),viewMode:m},u.id)})})]})]})]})},h={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},Ie=({count:t})=>e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-slate-900/90 flex-center z-50",children:e.jsxs(N.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},className:"text-white text-center",children:[e.jsx("div",{className:"text-[120px] font-bold mb-4",children:t}),e.jsx("div",{className:"text-2xl text-slate-400",children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),De=({seconds:t,total:r,isWarning:p})=>{const x=t/r*100,s=Math.floor(t/60),l=t%60;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-8 mb-6",children:[e.jsxs("div",{className:`text-7xl md:text-8xl font-bold font-mono text-center mb-4 ${p?"text-red-500":"bg-gradient-to-br from-violet-600 to-purple-600 bg-clip-text text-transparent"}`,children:[s,":",l.toString().padStart(2,"0")]}),e.jsx("div",{className:"h-3 bg-slate-100 rounded-full overflow-hidden shadow-inner",children:e.jsx(N.div,{className:`h-full rounded-full ${p?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-violet-500 to-purple-600"}`,initial:{width:"100%"},animate:{width:`${x}%`},transition:{duration:.5}})})]})},Ae=({word:t,count:r})=>e.jsxs(_e,{variant:"error",className:"gap-1",children:['"',t,'"',e.jsxs("span",{className:"bg-red-500/20 px-1.5 py-0.5 rounded text-xs",children:[r,"x"]})]}),Oe=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(r=>r.length>0).length,ze=t=>!t||!Array.isArray(t)?0:t.reduce((r,p)=>r+(p.count||0),0),Ge=(t,r,p,x)=>{const s=Oe(t),l=ze(r),d=s>0?l/s*100:0,i=x>0?Math.round(s/x*60):0;let m=0;s>=60?m=25:s>=40?m=15:s>=20?m=10:s>=10&&(m=5);let j=25;d>25?j=0:d>15?j=10:d>10?j=15:d>5&&(j=20);let c=0,S="keine_sprache";s>0&&(i>=100&&i<=140?(c=10,S="optimal"):i>=80&&i<100||i>140&&i<=160?(c=5,S=i<100?"zu_langsam":"zu_schnell"):(c=0,S=i<80?"zu_langsam":"zu_schnell"));const v=Math.min(40,Math.max(0,p||0)),y=m+j+c+v;return{total_words:s,filler_count:l,filler_percentage:d,words_per_minute:i,pace_feedback:S,score:y,score_breakdown:{words_score:m,filler_score:j,tempo_score:c,content_score:v}}},Pe=({result:t,onPlayAgain:r,onBack:p})=>{const x=ge(t.score),s=t.score>=70,l=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]",{triggerConfetti:d,ConfettiComponent:i}=Ce();a.useEffect(()=>{s&&!l&&d()},[s,l,d]);const m=l?"bg-gradient-to-br from-slate-500 to-slate-600":s?"bg-gradient-to-br from-green-500 to-primary":"bg-gradient-to-br from-amber-500 to-orange-500";return e.jsxs(e.Fragment,{children:[e.jsx(i,{}),e.jsxs("div",{className:"max-w-[600px] mx-auto",children:[e.jsxs("div",{className:`${m} rounded-2xl p-10 mb-8 text-white text-center shadow-card`,children:[e.jsx("div",{className:"text-6xl mb-4",children:l?"ðŸŽ¤":x.emoji}),e.jsx("div",{className:"text-8xl font-bold mb-3",children:t.score}),e.jsx("div",{className:"text-2xl opacity-90 mb-5 font-semibold",children:"Punkte"}),e.jsx("p",{className:"text-lg leading-relaxed",children:l?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":x.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs(R,{className:"p-5 shadow-card",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center mb-3",children:e.jsx(Y,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mb-1",children:t.total_words}),e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"WÃ¶rter gesprochen"})]}),e.jsxs(R,{className:"p-5 shadow-card",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center mb-3",children:e.jsx(he,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mb-1",children:t.filler_count}),e.jsxs("div",{className:"text-sm text-slate-600 font-medium",children:["FÃ¼llwÃ¶rter (",t.filler_percentage?.toFixed(1)||"0","%)"]})]}),e.jsxs(R,{className:"p-5 shadow-card",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mb-3",children:e.jsx(pe,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mb-1",children:t.words_per_minute}),e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"WPM Tempo"})]}),e.jsxs(R,{className:"p-5 shadow-card",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-slate-500 to-slate-600 flex items-center justify-center mb-3",children:e.jsx(P,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 mb-1",children:t.duration_seconds||0}),e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"Sekunden Sprechzeit"})]})]}),t.filler_words&&t.filler_words.length>0&&e.jsxs(R,{className:"mb-6 shadow-card",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-4 text-base",children:"Erkannte FÃ¼llwÃ¶rter"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.filler_words.map((j,c)=>e.jsx(Ae,{word:j.word,count:j.count},c))})]}),!l&&e.jsxs("div",{className:"bg-violet-50 border border-violet-200 rounded-2xl p-5 mb-6 shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-violet-900 mb-4 text-base",children:"Bewertung im Detail"}),t.score_breakdown&&e.jsxs("div",{className:`grid grid-cols-2 gap-2 ${t.content_feedback?"mb-3":""}`,children:[e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸ“ Wortanzahl: ",e.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸš« FÃ¼llwÃ¶rter: ",e.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["â±ï¸ Tempo: ",e.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸ’¡ Inhalt: ",e.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&e.jsx("div",{className:"pt-4 border-t border-violet-200",children:e.jsxs("p",{className:"text-sm text-slate-700 leading-relaxed",children:[e.jsx("strong",{className:"text-violet-900",children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-5 mb-6 shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-amber-700 mb-3 text-base",children:"Tempo-Hinweis"}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine PrÃ¤sentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&e.jsxs(R,{className:"mb-8 bg-slate-50 shadow-card",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-4 text-base",children:"Transkript"}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:t.transcript})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(M,{icon:e.jsx(ee,{}),onClick:r,fullWidth:!0,children:"Nochmal spielen"}),e.jsx(M,{variant:"secondary",icon:e.jsx(O,{}),onClick:p,fullWidth:!0,children:"ZurÃ¼ck"})]})]})]})},et=({gameConfig:t,onBack:r,onComplete:p})=>{const[x,s]=a.useState(h.COUNTDOWN),[l,d]=a.useState(3),[i,m]=a.useState(t.duration),[j,c]=a.useState(null),[S,v]=a.useState(null),[y,E]=a.useState(0),[T,I]=a.useState(!1),f=a.useRef(null),C=a.useRef([]),u=a.useRef(null),o=a.useRef(null),k=a.useRef(null),F=a.useRef(null),U=a.useRef(null),V=B.getGeminiApiKey(),z=a.useCallback(()=>{u.current&&clearInterval(u.current),F.current&&cancelAnimationFrame(F.current),k.current&&(k.current.close(),k.current=null),f.current&&f.current.state!=="inactive"&&f.current.stop()},[]);a.useEffect(()=>z,[z]),a.useEffect(()=>{T||(I(!0),se())},[T]);const se=async()=>{s(h.COUNTDOWN),d(3);try{const w=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,b=await navigator.mediaDevices.getUserMedia({audio:w});k.current=new(window.AudioContext||window.webkitAudioContext);const _=k.current.createMediaStreamSource(b);o.current=k.current.createAnalyser(),o.current.fftSize=256,_.connect(o.current),f.current=new MediaRecorder(b,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),C.current=[],f.current.ondataavailable=g=>{g.data.size>0&&C.current.push(g.data)};let n=3;const D=setInterval(()=>{n--,d(n),n===0&&(clearInterval(D),K())},1e3)}catch(w){console.error("Microphone access denied:",w),v("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),s(h.ERROR)}},Z=a.useCallback(async()=>{s(h.COUNTDOWN),d(3);try{const w=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,b=await navigator.mediaDevices.getUserMedia({audio:w});k.current=new(window.AudioContext||window.webkitAudioContext);const _=k.current.createMediaStreamSource(b);o.current=k.current.createAnalyser(),o.current.fftSize=256,_.connect(o.current),f.current=new MediaRecorder(b,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),C.current=[],f.current.ondataavailable=g=>{g.data.size>0&&C.current.push(g.data)};let n=3;const D=setInterval(()=>{n--,d(n),n===0&&(clearInterval(D),K())},1e3)}catch(w){console.error("Microphone access denied:",w),v("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),s(h.ERROR)}},[t.selectedMicrophoneId]),K=a.useCallback(()=>{s(h.RECORDING),m(t.duration),U.current=Date.now(),f.current.start();const w=()=>{if(o.current){const b=new Uint8Array(o.current.frequencyBinCount);o.current.getByteFrequencyData(b);const _=b.reduce((n,D)=>n+D)/b.length;E(_/255)}F.current=requestAnimationFrame(w)};w(),u.current=setInterval(()=>{m(b=>b<=1?($(),0):b-1)},1e3)},[t.duration]),$=a.useCallback(()=>{const w=U.current?Math.round((Date.now()-U.current)/1e3):t.duration;z(),s(h.PROCESSING),f.current.onstop=async()=>{const b=new Blob(C.current,{type:f.current.mimeType});f.current.stream.getTracks().forEach(n=>n.stop());const _=je(b,{minSize:ve});if(!_.valid){console.warn("[GameSession] Audio validation failed:",_.error,"Size:",b.size);const n={...we("game"),score:0,word_count:0,filler_count:0,words_per_minute:0,duration_seconds:w};c(n),s(h.RESULTS);return}try{const n=await Ne(b,V,t.topic,t.duration),g={...Ge(n.transcript,n.filler_words,n.content_score,w),transcript:n.transcript||"[Keine Sprache erkannt]",filler_words:n.filler_words||[],content_feedback:n.content_feedback||"",duration_seconds:w};c(g),s(h.RESULTS);try{const W={game_type:t.mode.id,topic:t.topic,duration_seconds:w,score:g.score,filler_count:g.filler_count,words_per_minute:g.words_per_minute,transcript:g.transcript,analysis_json:JSON.stringify(g)};await B.createGameSession(W)}catch(W){console.error("[GameSession] Failed to save game session:",W)}}catch(n){console.error("Analysis failed:",n),v(`Analyse fehlgeschlagen: ${n.message}`),s(h.ERROR)}},f.current.stop()},[V,t,z]),ae=()=>{$()},H=()=>{c(null),v(null),m(t.duration),Z()},re=()=>{switch(x){case h.READY:return e.jsx("div",{className:"text-center py-10 px-5",children:e.jsxs("div",{className:"max-w-[500px] mx-auto",children:[e.jsx("div",{className:"text-6xl mb-6",children:"ðŸŽ¤"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Bereit?"}),e.jsx("p",{className:"text-base text-slate-600 mb-6 leading-relaxed",children:t.topic}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full text-slate-600 text-sm mb-8",children:[e.jsx(P,{className:"w-4 h-4"}),t.duration," Sekunden"]}),e.jsx("div",{children:e.jsx(M,{size:"lg",icon:e.jsx(Q,{}),onClick:Z,children:"Aufnahme starten"})}),e.jsxs("button",{onClick:r,className:"mt-6 px-5 py-2.5 border-none bg-transparent text-slate-400 text-sm cursor-pointer inline-flex items-center gap-1.5",children:[e.jsx(O,{className:"w-4 h-4"}),"ZurÃ¼ck zur Auswahl"]})]})});case h.RECORDING:return e.jsx("div",{className:"text-center py-10 px-5",children:e.jsxs("div",{className:"max-w-[500px] mx-auto",children:[e.jsx(De,{seconds:i,total:t.duration,isWarning:i<=10}),e.jsxs("div",{className:"mb-8 p-5 bg-violet-50 border border-violet-100 rounded-2xl shadow-sm",children:[e.jsx("p",{className:"text-sm text-violet-600 mb-2 font-medium",children:"Dein Thema:"}),e.jsx("p",{className:"text-base font-semibold text-slate-900",children:t.topic})]}),e.jsx("div",{className:"mb-8",children:e.jsx(N.div,{className:"h-24 bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl flex-center shadow-card",animate:{opacity:.7+y*.3},children:e.jsx(N.div,{className:"w-16 h-16 rounded-full bg-white/30 flex-center backdrop-blur-sm",animate:{scale:1+y*.4},children:e.jsx(X,{className:"w-8 h-8 text-white"})})})}),e.jsxs("div",{className:"flex-center gap-2 mb-8",children:[e.jsx(N.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"font-medium text-red-500 text-sm",children:"Aufnahme lÃ¤uft..."})]}),e.jsx(M,{variant:"danger",icon:e.jsx(ue,{}),onClick:ae,children:"Aufnahme beenden"})]})});case h.PROCESSING:return e.jsxs("div",{className:"text-center py-20 px-5",children:[e.jsx(N.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-16 h-16 border-4 border-violet-600 border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Analysiere deine Aufnahme..."}),e.jsx("p",{className:"text-base text-slate-600",children:"Der FÃ¼llwort-Killer zÃ¤hlt nach"})]});case h.RESULTS:return e.jsx(Pe,{result:j,onPlayAgain:H,onBack:r});case h.ERROR:return e.jsx("div",{className:"text-center py-16 px-5",children:e.jsxs("div",{className:"max-w-[400px] mx-auto",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-red-100 flex-center mx-auto mb-6 shadow-sm",children:e.jsx(me,{className:"w-10 h-10 text-red-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Fehler"}),e.jsx("p",{className:"text-base text-slate-600 mb-8 leading-relaxed",children:S}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(M,{icon:e.jsx(ee,{}),onClick:H,children:"Erneut versuchen"}),e.jsx(M,{variant:"secondary",icon:e.jsx(O,{}),onClick:r,children:"ZurÃ¼ck"})]})]})});default:return null}};return e.jsxs("div",{className:"min-h-full pb-8",children:[e.jsx(J,{children:x===h.COUNTDOWN&&e.jsx(Ie,{count:l})}),x!==h.COUNTDOWN&&x!==h.RECORDING&&e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-[600px] mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 border-none bg-transparent text-slate-600 text-sm cursor-pointer",children:[e.jsx(O,{className:"w-4.5 h-4.5"}),"ZurÃ¼ck"]}),e.jsx("h1",{className:"font-semibold text-slate-900 text-base",children:t.mode.title}),e.jsx("div",{className:"w-[60px]"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-[600px] mx-auto",children:re()})})]})};export{et as GameSession,Qe as RhetorikGym};
