import{a as s,w as p,j as S}from"./colors-BQukwKjN.js";import{a as A,D as b}from"./DecisionBoardResult-Czvv77ll.js";import"./card-DJOKIzV1.js";import"./utils-BEHD0UYf.js";import"./button-BqGd9OJS.js";import"./designTokens-DbcSlXo4.js";import"./input-D6anJtWm.js";import"./textarea-CKHRnpcK.js";import"./useBranding-D1dNadPD.js";import"./gemini-BXO6QR_g.js";import"./audio-BZs8f3gH.js";import"./AudioRecorder-BEmTtitb.js";import"./index.js";import"./check-DiBTcvJw.js";import"./message-circle-Dy8g8Sor.js";import"./skip-forward-fqNrvCYq.js";import"./thumbs-up-Z0tZ72js.js";import"./lightbulb-DOBxo0V4.js";import"./plus-b6jIgRO0.js";import"./circle-alert-CNsSzecp.js";import"./chevron-up-DQD89_pB.js";import"./trash-2-u9VwVFZs.js";import"./arrow-left-BSe0bpeL.js";import"./refresh-cw-hxJHsysT.js";import"./pen-line-CkFrlKhF.js";import"./heart-DAOFFmWr.js";const r={INPUT:"input",RESULT:"result"},re=({isAuthenticated:h,requireAuth:C,setPendingAction:k,onNavigateToHistory:l})=>{const[f,u]=s.useState(r.INPUT),[w,d]=s.useState(null),[I,a]=s.useState(null),[n,i]=s.useState(null),[P,g]=s.useState(!1),c=s.useRef(!1);s.useEffect(()=>{window.scrollTo(0,0)},[f]);const x=s.useCallback(async e=>{if(c.current||!e.topic?.trim())return null;try{const o={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},t=await p.createDecision(o);if(t?.id)return c.current=!0,i(t.id),console.log("[DecisionBoard] Draft session saved with ID:",t.id),t.id}catch(o){console.error("[DecisionBoard] Failed to save draft session:",o)}return null},[]),m=s.useCallback(async(e,o)=>{if(e)try{const t={topic:o.topic,context:o.context||null,pros:o.pros||[],cons:o.cons||[],pro_score:o.proScore||0,contra_score:o.contraScore||0,analysis:o.analysis||null,status:o.status||"completed"};await p.updateDecision(e,t),console.log("[DecisionBoard] Session updated:",e)}catch(t){console.error("[DecisionBoard] Failed to update session:",t)}},[]),y=s.useCallback(async e=>{if(e)try{await p.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(o){console.error("[DecisionBoard] Failed to delete session:",o)}},[]),B=s.useCallback(async(e,o)=>{d(e),a(o),u(r.RESULT);try{if(n)await m(n,{...e,analysis:o,status:"completed"});else{const t={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:o,status:"completed"},D=await p.createDecision(t);D?.id&&(i(D.id),c.current=!0,console.log("[DecisionBoard] Decision saved with ID:",D.id))}}catch(t){console.error("[DecisionBoard] Failed to save decision:",t)}},[n,m]),v=s.useCallback(()=>{d(null),a(null),i(null),c.current=!1,u(r.INPUT)},[]),E=s.useCallback(()=>{a(null),u(r.INPUT)},[]),R=s.useCallback(async()=>{n&&await y(n),d(null),a(null),i(null),c.current=!1,l&&l()},[n,y,l]),U=()=>{switch(f){case r.RESULT:return S.jsx(b,{decisionData:w,analysisResult:I,onStartNew:v,onEditDecision:E});case r.INPUT:default:return S.jsx(A,{initialData:w,onAnalysisComplete:B,onCancel:l?R:null,isAuthenticated:h,requireAuth:C,savedDecisionId:n,onSaveDraft:x,onUpdateSession:m,onDecisionIdChange:i})}};return S.jsx("div",{style:{minHeight:"100%"},children:U()})};export{re as DecisionBoardApp,A as DecisionBoardInput,b as DecisionBoardResult};
