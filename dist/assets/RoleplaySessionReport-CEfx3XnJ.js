import{j as e,m as y,a7 as Z,a6 as de,l as O,z as je,a2 as ye,a3 as ve,a4 as G,a5 as Ne,M as Y,N as we,w as Se,a8 as ke,e as E,A as R,u as te,q as ze,y as Ce,T as Ae,a0 as _e,af as Q,ag as Te,ah as Me,k as Re,v as Ie,Q as Le,b as $e,Y as xe,O as K}from"./ui-vendor-B9DEMv6g.js";import{a as m}from"./react-vendor-uDOJF2jQ.js";import{u as De}from"./useMobile-YxjH166V.js";import{u as ne}from"./useBranding-DY0PKpWK.js";import{j as re,i as J,c as fe}from"./FeatureInfoButton-Df0Ex1oW.js";import{b as We,e as Be,d as Ee,p as Oe,i as Ge}from"./index.js";const Pe=({score:t,size:n=100,primaryAccent:c,isHeader:l=!1})=>{const g=Math.min(100,Math.max(0,t||0)),s=(n-10)/2,o=s*2*Math.PI,i=o-g/100*o,f=re(t,c);return e.jsxs("div",{className:"relative",style:{width:n,height:n},children:[e.jsxs("svg",{width:n,height:n,className:"-rotate-90",children:[e.jsx("circle",{cx:n/2,cy:n/2,r:s,fill:"none",stroke:l?"rgba(255,255,255,0.25)":"#e2e8f0",strokeWidth:8}),e.jsx(y.circle,{cx:n/2,cy:n/2,r:s,fill:"none",stroke:l?"#fff":f,strokeWidth:8,strokeLinecap:"round",strokeDasharray:o,initial:{strokeDashoffset:o},animate:{strokeDashoffset:i},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx(y.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},className:"font-bold leading-none",style:{fontSize:n/3,color:l?"#fff":f},children:Math.round(t)})})]})},Fe=({audioUrl:t,duration:n,primaryAccent:c,branding:l,onSeek:g})=>{const s=m.useRef(null),o=m.useRef(null),i=m.useRef(null),[f,u]=m.useState(!1),[r,h]=m.useState(!1),[S,C]=m.useState(0),[N,d]=m.useState(n||0),[p,x]=m.useState(!0),[j,v]=m.useState(null);m.useEffect(()=>{if(!t)return;let b=!0;const I=t.includes("/wp-json/")||t.includes("/api/");return(async()=>{try{x(!0),v(null);let T=t;if(I){const A=await fetch(t,{method:"GET",headers:{"X-WP-Nonce":fe()},credentials:"same-origin"});if(!A.ok)throw new Error(`HTTP ${A.status}`);const D=await A.blob();if(!b)return;if(D.size===0)throw new Error("Audio nicht verfügbar");const H=URL.createObjectURL(D);i.current=H,T=H}const a=new Audio(T);s.current=a,a.addEventListener("loadedmetadata",()=>{b&&(d(a.duration),x(!1))}),a.addEventListener("timeupdate",()=>{b&&C(a.currentTime)}),a.addEventListener("ended",()=>{b&&(u(!1),C(0))}),a.addEventListener("error",()=>{b&&(v("Audio konnte nicht geladen werden"),x(!1))})}catch(T){console.error("[AudioPlayer] Failed to load audio:",T),b&&(v("Audio konnte nicht geladen werden"),x(!1))}})(),()=>{b=!1,s.current&&(s.current.pause(),s.current.src=""),i.current&&URL.revokeObjectURL(i.current)}},[t]);const k=()=>{s.current&&(f?s.current.pause():s.current.play(),u(!f))},z=()=>{s.current&&(s.current.muted=!r,h(!r))},$=b=>{s.current&&(s.current.currentTime=Math.max(0,Math.min(N,s.current.currentTime+b)))},w=b=>{s.current&&(s.current.currentTime=b,C(b),f||(s.current.play(),u(!0)))};m.useEffect(()=>{g&&(g.current=w)},[g]);const P=b=>{if(!o.current||!N)return;const I=o.current.getBoundingClientRect(),F=(b.clientX-I.left)/I.width;w(F*N)};return t?e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsaufnahme"})]}),e.jsx("div",{ref:o,onClick:P,className:"relative h-12 bg-slate-50 rounded-xl cursor-pointer overflow-hidden mb-4",children:p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(O,{size:24,className:"text-primary animate-spin"})}):j?e.jsxs("div",{className:"flex items-center justify-center h-full gap-2",children:[e.jsx(je,{size:18,className:"text-red-500"}),e.jsx("span",{className:"text-sm text-slate-500",children:j})]}):e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{width:0},animate:{width:`${N>0?S/N*100:0}%`},className:"absolute inset-0 bg-primary/25 rounded-xl"}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-primary -translate-x-1/2",style:{left:`${N>0?S/N*100:0}%`}})]})}),!j&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(-10),disabled:p,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center disabled:opacity-50",children:e.jsx(ye,{size:20,className:"text-slate-600"})}),e.jsx("button",{onClick:k,disabled:p,className:"w-12 h-12 rounded-full border-none bg-primary cursor-pointer flex items-center justify-center disabled:opacity-50",children:f?e.jsx(ve,{size:20,className:"text-white"}):e.jsx(G,{size:20,className:"text-white ml-0.5"})}),e.jsx("button",{onClick:()=>$(10),disabled:p,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center disabled:opacity-50",children:e.jsx(Ne,{size:20,className:"text-slate-600"})})]}),e.jsxs("div",{className:"flex-1 text-center text-sm text-slate-600 font-mono",children:[J(S)," / ",J(N)]}),e.jsx("button",{onClick:z,disabled:p,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center",children:r?e.jsx(de,{size:20,className:"text-slate-600"}):e.jsx(Z,{size:20,className:"text-slate-600"})})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsaufnahme"})]}),e.jsxs("div",{className:"flex items-center justify-center h-20 bg-slate-50 rounded-xl text-slate-500 text-sm",children:[e.jsx(de,{size:20,className:"mr-2"}),"Keine Audioaufnahme verfügbar"]})]})},He=({transcript:t,scenario:n,primaryAccent:c,branding:l,onSeekToTime:g})=>!t||t.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-10 border border-slate-200 text-center",children:[e.jsx(Y,{size:32,className:"text-slate-400 mb-3 mx-auto"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kein Transkript verfügbar"})]}):e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Y,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsverlauf"})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto pr-2",children:t.map((s,o)=>{const i=s.role==="agent",f=s.timeLabel||(s.elapsedTime!==void 0?J(s.elapsedTime):null);return e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.03},className:`flex gap-2.5 mb-3 ${i?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[i?n?.interviewer_profile?.image_url?e.jsx("img",{src:n.interviewer_profile.image_url,alt:n.interviewer_profile.name||"Interviewer",className:"w-8 h-8 rounded-full object-cover border-2 border-primary/20"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-gradient flex items-center justify-center",children:e.jsx(we,{size:16,className:"text-white"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center",children:e.jsx(Se,{size:16,className:"text-white"})}),!i&&f&&e.jsx("button",{onClick:()=>g?.(s.elapsedTime),className:"text-[10px] font-mono text-primary bg-transparent border-none cursor-pointer p-0",children:f})]}),e.jsx("div",{className:`max-w-[85%] px-3.5 py-2.5 text-[13px] leading-relaxed border ${i?"rounded-[4px_16px_16px_16px] bg-slate-50 text-slate-900 border-slate-200":"rounded-[16px_4px_16px_16px] bg-gradient-to-br from-teal-500 to-teal-600 text-white border-transparent"}`,children:s.text})]},o)})})]}),V=({label:t,value:n,maxValue:c=10,primaryAccent:l,branding:g})=>{const s=ne(),o=g||s,i=n/c*100,f=c===10?n*10:n,u=re(f,l);return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between mb-1.5",children:[e.jsx("span",{className:"text-[13px] text-slate-600",children:t}),e.jsx("span",{className:"text-[13px] font-semibold",style:{color:u},children:f})]}),e.jsx("div",{className:"h-1.5 rounded overflow-hidden",style:{background:o.cardBgHover},children:e.jsx(y.div,{initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"},className:"h-full rounded",style:{background:u}})})]})},ee=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const n=[];return t.point&&n.push(t.point),t.detail&&n.push(t.detail),t.action&&n.push(t.action),n.join(": ")||JSON.stringify(t)}return String(t)},Ue=t=>{const n={selbstkundgabe:"Selbstkundgabe",beziehung:"Beziehungsebene",sachinhalt:"Sachinhalt",appell:"Appell",bewertung:"Bewertung",begruendung:"Begründung",nachricht:"Nachricht",analyse_nachricht:"Nachricht-Analyse",overall_assessment:"Gesamtbewertung",deescalation_score:"Deeskalations-Score",score_explanation:"Score-Erklärung"},c=t.toLowerCase();return n[c]?n[c]:t.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,l=>l.toUpperCase()).trim()},se=(t,n=0)=>t==null?null:typeof t=="string"?e.jsx("p",{className:"text-[13px] leading-relaxed text-slate-700 m-0 whitespace-pre-wrap",children:t}):typeof t=="number"?e.jsx("span",{className:"text-[13px] font-semibold text-primary",children:t}):typeof t=="boolean"?e.jsx("span",{className:`text-[13px] font-semibold ${t?"text-green-600":"text-red-600"}`,children:t?"Ja":"Nein"}):Array.isArray(t)?e.jsx("div",{className:"space-y-2",children:t.map((c,l)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 text-[13px]",children:"•"}),e.jsx("div",{className:"flex-1",children:se(c,n+1)})]},l))}):typeof t=="object"?e.jsx("div",{className:`space-y-3 ${n>0?"pl-3 border-l-2 border-slate-200":""}`,children:Object.entries(t).map(([c,l])=>e.jsxs("div",{children:[e.jsx("span",{className:"text-[12px] font-semibold text-slate-500 uppercase tracking-wide",children:Ue(c)}),e.jsx("div",{className:"mt-1",children:se(l,n+1)})]},c))}):e.jsx("span",{className:"text-[13px] text-slate-700",children:String(t)}),pe=t=>t?!!(t.summary||t.overall_assessment||t.strengths?.length>0||t.improvements?.length>0||t.areas_for_improvement?.length>0||t.tips?.length>0||t.suggestions?.length>0||t.rating):!1,Ke=({feedback:t,audioAnalysis:n,primaryAccent:c,branding:l})=>{const g=pe(t)?"summary":"custom-feedback",[s,o]=m.useState(g),i=t?{summary:t.summary||t.overall_assessment||null,strengths:t.strengths||[],improvements:t.improvements||t.areas_for_improvement||[],tips:t.tips||t.suggestions||[],rating:t.rating||null}:null,f=u=>{o(s===u?null:u)};return e.jsxs("div",{className:"flex flex-col gap-3",children:[i?.summary&&e.jsxs("div",{className:"bg-primary/5 rounded-xl border border-primary/20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("summary"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(ke,{size:18,className:"text-primary"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-slate-900",children:"Gesamtbewertung"}),e.jsx(E,{size:18,className:`text-slate-500 transition-transform ${s==="summary"?"rotate-180":""}`})]}),e.jsx(R,{children:s==="summary"&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("p",{className:"text-[13px] leading-relaxed text-slate-700",children:i.summary})})})})]}),i?.strengths?.length>0&&e.jsxs("div",{className:"bg-green-50 rounded-xl border border-green-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("strengths"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(te,{size:18,className:"text-green-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-green-800",children:"Deine Superkräfte"}),e.jsxs("span",{className:"text-xs text-green-500 font-medium",children:[i.strengths.length," Stärken"]}),e.jsx(E,{size:18,className:`text-green-500 transition-transform ${s==="strengths"?"rotate-180":""}`})]}),e.jsx(R,{children:s==="strengths"&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.strengths.map((u,r)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[11px] font-semibold text-green-500",children:"✓"})}),e.jsx("p",{className:"text-[13px] leading-relaxed text-green-800 m-0",children:ee(u)})]},r))})})})]}),i?.improvements?.length>0&&e.jsxs("div",{className:"bg-amber-50 rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("improvements"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(ze,{size:18,className:"text-amber-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-amber-900",children:"Dein Trainingsfeld"}),e.jsxs("span",{className:"text-xs text-amber-500 font-medium",children:[i.improvements.length," Punkte"]}),e.jsx(E,{size:18,className:`text-amber-500 transition-transform ${s==="improvements"?"rotate-180":""}`})]}),e.jsx(R,{children:s==="improvements"&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.improvements.map((u,r)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[11px] font-semibold text-amber-500",children:r+1})}),e.jsx("p",{className:"text-[13px] leading-relaxed text-amber-900 m-0",children:ee(u)})]},r))})})})]}),i?.tips?.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-xl border border-blue-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("tips"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(Ce,{size:18,className:"text-blue-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-blue-900",children:"Praktische Tipps"}),e.jsxs("span",{className:"text-xs text-blue-500 font-medium",children:[i.tips.length," Tipps"]}),e.jsx(E,{size:18,className:`text-blue-500 transition-transform ${s==="tips"?"rotate-180":""}`})]}),e.jsx(R,{children:s==="tips"&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.tips.map((u,r)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx(Ae,{size:16,className:"text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-[13px] leading-relaxed text-blue-900 m-0",children:ee(u)})]},r))})})})]}),i?.rating&&e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Bewertungskriterien"})]}),i.rating.communication!==void 0&&e.jsx(V,{label:"Kommunikation",value:i.rating.communication,primaryAccent:c,branding:l}),i.rating.motivation!==void 0&&e.jsx(V,{label:"Motivation",value:i.rating.motivation,primaryAccent:c,branding:l}),i.rating.professionalism!==void 0&&e.jsx(V,{label:"Professionalität",value:i.rating.professionalism,primaryAccent:c,branding:l}),i.rating.preparation!==void 0&&e.jsx(V,{label:"Vorbereitung",value:i.rating.preparation,primaryAccent:c,branding:l})]}),!pe(t)&&t&&e.jsxs("div",{className:"bg-primary/5 rounded-xl border border-primary/20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>f("custom-feedback"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(Y,{size:18,className:"text-primary"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-slate-900",children:"Feedback-Analyse"}),e.jsx(E,{size:18,className:`text-slate-500 transition-transform ${s==="custom-feedback"?"rotate-180":""}`})]}),e.jsx(R,{children:s==="custom-feedback"&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:se(t)})})})]})]})},Ve=t=>t>=80?{color:"#22c55e",bg:"#f0fdf4",label:"Sehr selbstsicher"}:t>=60?{color:"#3b82f6",bg:"#eff6ff",label:"Selbstsicher"}:t>=40?{color:"#f59e0b",bg:"#fffbeb",label:"Ausbaufähig"}:{color:"#ef4444",bg:"#fef2f2",label:"Unsicher"},Ye=t=>{switch(t){case"zu_langsam":return 15;case"optimal":return 50;case"zu_schnell":return 85;default:return 50}},me=t=>{if(typeof t=="number")return t;if(!t||typeof t!="string")return 0;const n=t.split(":");if(n.length===2){const c=parseInt(n[0],10)||0,l=parseInt(n[1],10)||0;return c*60+l}if(n.length===3){const c=parseInt(n[0],10)||0,l=parseInt(n[1],10)||0,g=parseInt(n[2],10)||0;return c*3600+l*60+g}return parseFloat(t)||0},Je=t=>t==="lebendig"?"Lebendig":t==="natürlich"?"Natürlich":"Monoton",Xe=t=>t==="lebendig"?{base:20,variance:30}:t==="natürlich"?{base:25,variance:20}:{base:35,variance:8},qe=({audioAnalysis:t,primaryAccent:n,branding:c,onJumpToTimestamp:l})=>{const g=ne(),s=c||g,o=t?.audio_metrics||t,i=o&&(o.confidence_score!==void 0||o.speech_cleanliness||o.pacing||o.tonality);if(!t||!i)return e.jsxs("div",{className:"bg-white rounded-xl p-10 py-10 text-center",style:{border:`1px solid ${s.borderColor}`},children:[e.jsx(Q,{size:32,color:s.textMuted,className:"mb-3 inline-block"}),e.jsx("p",{className:"text-sm m-0",style:{color:s.textMuted},children:"Keine Audio-Analyse verfügbar"})]});const f=o.confidence_score,u=o.speech_cleanliness,r=o.pacing,h=o.tonality,S=u?.total_filler_count||0,C=u?.filler_word_analysis||[],N=u?.feedback;return e.jsxs("div",{className:"flex flex-col gap-4",children:[f!==void 0&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{size:18,color:n}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Selbstsicherheit"})]}),e.jsx("div",{className:"flex justify-center mb-4",children:(()=>{const d=f,p=Ve(d),x=140,j=x/2-12,v=Math.PI*j,k=v-d/100*v;return e.jsxs("div",{className:"rounded-2xl p-5 px-7.5 flex flex-col items-center",style:{background:p.bg},children:[e.jsxs("div",{style:{position:"relative",width:x,height:x/2+20},children:[e.jsxs("svg",{width:x,height:x/2+20,style:{overflow:"visible"},children:[e.jsx("path",{d:`M 12 ${x/2} A ${j} ${j} 0 0 1 ${x-12} ${x/2}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"10",strokeLinecap:"round"}),e.jsx(y.path,{d:`M 12 ${x/2} A ${j} ${j} 0 0 1 ${x-12} ${x/2}`,fill:"none",stroke:p.color,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:v,initial:{strokeDashoffset:v},animate:{strokeDashoffset:k},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",paddingBottom:"4px"},children:[e.jsx(y.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5},style:{fontSize:"32px",fontWeight:700,color:p.color},children:Math.round(d)}),e.jsx("span",{style:{fontSize:"11px",color:s.textMuted},children:"/ 100"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"8px"},children:[e.jsx(Q,{size:14,color:p.color}),e.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:p.color},children:p.label})]})]})})()}),o.summary_text&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,textAlign:"center"},children:o.summary_text})]}),u&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:18,color:"#f97316"}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Füllwörter"})]}),e.jsxs("span",{className:"text-[13px] font-semibold px-2.5 py-1 rounded-full",style:{background:S<=2?"#dcfce7":S<=5?"#fef3c7":"#fee2e2",color:S<=2?"#166534":S<=5?"#92400e":"#991b1b"},children:[S,"x gesamt"]})]}),C.length>0?e.jsx("div",{className:"flex flex-col gap-2 mb-3",children:C.map((d,p)=>e.jsxs("div",{className:"rounded-lg bg-amber-100 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("span",{className:"text-[13px] text-amber-900 font-medium",children:['"',d.word,'"']}),e.jsxs("span",{className:"text-xs text-amber-900 font-semibold",children:[d.count,"x"]})]}),d.examples?.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 px-3 py-2 bg-amber-50 border-t border-amber-200",children:d.examples.map((x,j)=>e.jsxs("button",{onClick:()=>l?.(me(x.timestamp)),style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"6px",border:"none",background:"#fef3c7",cursor:"pointer",fontSize:"11px",color:"#92400e",transition:"all 0.15s"},onMouseOver:v=>v.currentTarget.style.background="#fde68a",onMouseOut:v=>v.currentTarget.style.background="#fef3c7",children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:600},children:x.timestamp}),e.jsx(G,{size:10})]},j))})]},p))}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#22c55e"},children:[e.jsx(te,{size:16}),e.jsx("span",{style:{fontSize:"13px"},children:"Keine Füllwörter erkannt!"})]}),N&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,marginTop:"12px"},children:N})]}),r&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{size:18,color:"#3b82f6"}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Sprechtempo"})]}),r.estimated_wpm&&e.jsxs("span",{className:"text-xs font-mono px-2.5 py-1 rounded-md",style:{background:s.cardBgHover,color:s.textSecondary},children:["~",r.estimated_wpm," WPM"]})]}),e.jsxs("div",{style:{position:"relative",height:"40px",marginBottom:"8px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"8px",borderRadius:"4px",background:"linear-gradient(90deg, #93c5fd, #86efac, #fca5a5)",transform:"translateY(-50%)"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"60px",height:"16px",background:"rgba(34, 197, 94, 0.2)",border:"1px solid #22c55e",borderRadius:"8px",transform:"translate(-50%, -50%)"}}),e.jsx(y.div,{initial:{left:"50%"},animate:{left:`${Ye(r.rating)}%`},transition:{duration:.8,ease:"easeOut"},style:{position:"absolute",top:"50%",width:"16px",height:"16px",borderRadius:"50%",background:r.rating==="optimal"?"#22c55e":"#f59e0b",border:"2px solid #fff",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",transform:"translate(-50%, -50%)"}}),e.jsxs("div",{style:{position:"absolute",bottom:"-4px",left:0,right:0,display:"flex",justifyContent:"space-between",fontSize:"10px",color:s.textMuted},children:[e.jsx("span",{children:"Langsam"}),e.jsx("span",{style:{color:"#22c55e",fontWeight:500},children:"Optimal"}),e.jsx("span",{children:"Schnell"})]})]}),r.feedback&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,marginTop:"16px"},children:r.feedback})]}),h&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{size:18,color:"#14b8a6"}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Betonung & Melodie"})]}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-md bg-teal-50 text-teal-700",children:Je(h.rating)})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",height:"48px",marginBottom:"12px"},children:Array.from({length:30}).map((d,p)=>{const{base:x,variance:j}=Xe(h.rating),v=x+Math.sin(p*.5)*j+Math.sin(p*12.9898)%1*(j/2);return e.jsx(y.div,{initial:{height:0},animate:{height:`${Math.max(10,Math.min(100,v))}%`},transition:{duration:.5,delay:p*.02},style:{width:"4px",borderRadius:"2px",background:"#14b8a6"}},p)})}),h.highlights?.length>0&&e.jsx("div",{style:{marginBottom:"12px"},children:h.highlights.map((d,p)=>e.jsxs("button",{onClick:()=>l?.(me(d.timestamp)),style:{width:"100%",display:"flex",alignItems:"flex-start",gap:"8px",padding:"10px 12px",marginBottom:"6px",borderRadius:"8px",border:"none",background:d.type==="positive"?"#f0fdf4":"#fef2f2",cursor:"pointer",textAlign:"left"},children:[e.jsx("span",{style:{fontSize:"11px",fontFamily:"monospace",padding:"2px 6px",borderRadius:"4px",background:d.type==="positive"?"#dcfce7":"#fee2e2",color:d.type==="positive"?"#166534":"#991b1b",flexShrink:0},children:d.timestamp}),e.jsx("span",{style:{flexShrink:0,marginTop:"1px"},children:d.type==="positive"?e.jsx(te,{size:14,color:"#22c55e"}):e.jsx(Re,{size:14,color:"#ef4444"})}),e.jsx("span",{style:{fontSize:"12px",color:s.textSecondary,flex:1,lineHeight:1.5,wordBreak:"break-word",whiteSpace:"normal"},children:d.note}),e.jsx(G,{size:12,color:s.textMuted,style:{flexShrink:0,marginTop:"2px"}})]},p))}),h.feedback&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary},children:h.feedback})]})]})},_={COACHING:"coaching",ANALYSEN:"analysen"},Ze=t=>t>=90?"Ausgezeichnet!":t>=80?"Sehr gut!":t>=70?"Gut!":t>=60?"Solide Leistung":t>=50?"Ausbaufähig":"Weiter üben!",Qe=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",lt=({session:t,scenario:n,feedback:c,audioAnalysis:l,onBack:g,onRepeat:s,onDelete:o,isLoading:i=!1,primaryAccent:f,headerGradient:u})=>{const r=ne(),h=f||r.primaryAccent,S=u||r.headerGradient,C=r.pageBg;r.textMain;const N=r.textSecondary;r.textMuted,r.cardBg,r.borderColor,r.cardBgHover;const d=De(768),p=m.useRef(null),[x,j]=m.useState(_.COACHING),[v,k]=m.useState(!1),[z,$]=m.useState(!1),[w,P]=m.useState(!1),[b,I]=m.useState(null),[F,T]=m.useState(!1),a=b||t;m.useEffect(()=>{t?.id&&!t?.audio_analysis_json&&!l&&!b&&(T(!0),We(t.id).then(W=>{I(W)}).catch(W=>{console.error("Failed to fetch full session:",W)}).finally(()=>{T(!1)}))},[t?.id,t?.audio_analysis_json,l,b]);const A=m.useMemo(()=>c&&typeof c=="object"?c:a?.feedback_json?Be(a.feedback_json):null,[c,a?.feedback_json]),D=m.useMemo(()=>l&&typeof l=="object"?l:a?.audio_analysis_json?Ee(a.audio_analysis_json):null,[l,a?.audio_analysis_json]),H=m.useMemo(()=>a?.transcript?Oe(a.transcript):[],[a?.transcript]),ue=m.useMemo(()=>a?.audio_url?a.audio_url:a?.id?Ge(a.id):null,[a?.id,a?.audio_url]),X=m.useMemo(()=>A?.rating?.overall!==void 0?A.rating.overall*10:0,[A]),ie=M=>{p.current&&p.current(M)},ae=async()=>{if(!(!a?.id||w)){P(!0);try{const W=(window.wpApiSettings||{}).root||"/wp-json/",he=fe(),le=await fetch(`${W}bewerbungstrainer/v1/sessions/${a.id}/export-pdf`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":he}}),L=await le.json();if(!le.ok)throw console.error("[PDF] Server error:",L),new Error(L.error||"PDF-Export fehlgeschlagen");if(L.pdf_base64&&L.filename){const q=atob(L.pdf_base64),oe=new Array(q.length);for(let U=0;U<q.length;U++)oe[U]=q.charCodeAt(U);const ge=new Uint8Array(oe),be=new Blob([ge],{type:"application/pdf"}),ce=window.URL.createObjectURL(be),B=document.createElement("a");B.href=ce,B.download=L.filename,document.body.appendChild(B),B.click(),document.body.removeChild(B),window.URL.revokeObjectURL(ce)}}catch(M){console.error("[PDF] Download failed:",M)}finally{P(!1)}}};return i||F?e.jsxs("div",{className:"min-h-screen flex items-center justify-center flex-col gap-4",children:[e.jsx(O,{size:40,color:h,className:"animate-spin"}),e.jsx("p",{className:"text-sm",style:{color:N},children:"Lade Report..."})]}):e.jsxs("div",{className:"min-h-screen",style:{background:C},children:[e.jsx("div",{className:`sticky top-0 z-40 ${d?"p-5 px-4":"p-6 px-8"}`,style:{background:S},children:e.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[g&&e.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[e.jsx(Ie,{size:16}),"Zurück zur Übersicht"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!d&&e.jsx(Pe,{score:X,size:100,primaryAccent:h,isHeader:!0}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Live-Simulation"}),e.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:re(X,h)},children:Ze(X)})]}),e.jsx("h1",{style:{fontSize:d?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:n?.title||a?.scenario_title||"Übungssession"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[e.jsx(Le,{size:14}),Qe(a?.created_at)]}),a?.duration&&e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[e.jsx($e,{size:14}),J(a.duration)]})]})]}),!d&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a?.id&&e.jsxs("button",{onClick:ae,disabled:w,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:w?"wait":"pointer",color:"#fff",fontSize:"14px",fontWeight:500,opacity:w?.7:1},children:[w?e.jsx(O,{size:16,style:{animation:"spin 1s linear infinite"}}):e.jsx(xe,{size:16}),"PDF Export"]}),s&&e.jsxs("button",{onClick:s,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[e.jsx(G,{size:16}),"Erneut üben"]}),o&&e.jsx("button",{onClick:()=>k(!0),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:"10px 16px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:e.jsx(K,{size:16})})]})]})]})}),e.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:d?"16px":"24px 32px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"30fr 70fr",gap:"24px",alignItems:"start"},children:[e.jsxs("div",{style:{order:d?2:1},children:[e.jsx(He,{transcript:H,scenario:n,primaryAccent:h,branding:r,onSeekToTime:ie}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(Fe,{audioUrl:ue,duration:a?.duration,primaryAccent:h,branding:r,onSeek:p})})]}),e.jsxs("div",{style:{order:d?1:2},children:[e.jsxs("div",{style:{display:"flex",background:"#fff",borderRadius:"12px",padding:"4px",marginBottom:"16px",border:`1px solid ${r.borderColor}`},children:[e.jsx("button",{onClick:()=>j(_.COACHING),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:x===_.COACHING?h:"transparent",color:x===_.COACHING?"#fff":r.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Coaching"}),e.jsx("button",{onClick:()=>j(_.ANALYSEN),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:x===_.ANALYSEN?h:"transparent",color:x===_.ANALYSEN?"#fff":r.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Analysen"})]}),e.jsx(R,{mode:"wait",children:e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:x===_.COACHING?e.jsx(Ke,{feedback:A,audioAnalysis:D,primaryAccent:h,branding:r}):e.jsx(qe,{audioAnalysis:D,primaryAccent:h,branding:r,onJumpToTimestamp:ie})},x)})]})]}),d&&e.jsxs("div",{style:{marginTop:"24px",display:"flex",flexDirection:"column",gap:"12px"},children:[a?.id&&e.jsxs("button",{onClick:ae,disabled:w,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:h,border:"none",borderRadius:"12px",padding:"14px 24px",cursor:w?"wait":"pointer",color:"#fff",fontSize:"15px",fontWeight:600,opacity:w?.7:1},children:[w?e.jsx(O,{size:18,style:{animation:"spin 1s linear infinite"}}):e.jsx(xe,{size:18}),"PDF Export"]}),s&&e.jsxs("button",{onClick:s,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:r.cardBg,border:`1px solid ${r.borderColor}`,borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:r.textMain,fontSize:"15px",fontWeight:600},children:[e.jsx(G,{size:18}),"Erneut üben"]}),o&&e.jsxs("button",{onClick:()=>k(!0),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:"transparent",border:"1px solid #ef4444",borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:"#ef4444",fontSize:"15px",fontWeight:600},children:[e.jsx(K,{size:18}),"Session löschen"]})]})]}),e.jsx(R,{children:v&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>k(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3}}),e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",zIndex:1001,boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:"rgba(239,68,68,0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx(K,{size:24,color:"#ef4444"})}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:r.textMain,marginBottom:"8px"},children:"Session löschen?"}),e.jsx("p",{style:{fontSize:"14px",color:r.textSecondary,marginBottom:"24px"},children:"Diese Aktion kann nicht rückgängig gemacht werden. Dein Transkript und Feedback werden dauerhaft gelöscht."}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{onClick:()=>k(!1),disabled:z,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:`1px solid ${r.borderColor}`,background:"#fff",color:r.textMain,fontSize:"14px",fontWeight:500,cursor:z?"not-allowed":"pointer",opacity:z?.5:1},children:"Abbrechen"}),e.jsx("button",{onClick:async()=>{if(!(!o||!a?.id)){$(!0);try{await o(a)}catch(M){console.error("Failed to delete session:",M)}finally{$(!1),k(!1)}}},disabled:z,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"none",background:"#ef4444",color:"#fff",fontSize:"14px",fontWeight:500,cursor:z?"not-allowed":"pointer",opacity:z?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:z?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16,style:{animation:"spin 1s linear infinite"}}),"Löschen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16}),"Löschen"]})})]})]})})]})}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})};export{lt as R};
