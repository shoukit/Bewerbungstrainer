import{j as e,m as w,a7 as Q,a6 as ce,L as F,z as ge,a2 as be,a3 as je,a4 as W,a5 as ye,M as J,N as Ne,w as ve,a8 as we,C as P,A as $,u as se,i as ke,y as Se,l as Ce,a0 as ze,ag as ee,ah as Ae,ai as _e,T as Te,v as Le,Q as Me,g as $e,Y as de,O as K}from"./ui-vendor-Dm6q_mjH.js";import{a as p}from"./react-vendor-uDOJF2jQ.js";import{o as Re,C as n,m as ne,l as X,a as pe,b as ie,h as De}from"./FeatureInfoButton-DP9rw1S0.js";import{b as Ee,e as Ie,d as Oe,p as Ge,h as Be}from"./index.js";const Pe=({score:t,size:r=100,primaryAccent:c,isHeader:a=!1})=>{const j=Math.min(100,Math.max(0,t||0)),s=(r-10)/2,l=s*2*Math.PI,i=l-j/100*l,u=ne(t,c);return e.jsxs("div",{className:"relative",style:{width:r,height:r},children:[e.jsxs("svg",{width:r,height:r,className:"-rotate-90",children:[e.jsx("circle",{cx:r/2,cy:r/2,r:s,fill:"none",stroke:a?Re.trackLightRgba:n.slate[200],strokeWidth:8}),e.jsx(w.circle,{cx:r/2,cy:r/2,r:s,fill:"none",stroke:a?n.white:u,strokeWidth:8,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:i},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx(w.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},className:"font-bold leading-none",style:{fontSize:r/3,color:a?n.white:u},children:Math.round(t)})})]})},Fe=({audioUrl:t,duration:r,primaryAccent:c,branding:a,onSeek:j})=>{const s=p.useRef(null),l=p.useRef(null),i=p.useRef(null),[u,f]=p.useState(!1),[x,b]=p.useState(!1),[C,z]=p.useState(0),[y,g]=p.useState(r||0),[m,d]=p.useState(!0),[N,v]=p.useState(null);p.useEffect(()=>{if(!t)return;let h=!0;const o=t.includes("/wp-json/")||t.includes("/api/");return(async()=>{try{d(!0),v(null);let L=t;if(o){const S=await fetch(t,{method:"GET",headers:{"X-WP-Nonce":pe()},credentials:"same-origin"});if(!S.ok)throw new Error(`HTTP ${S.status}`);const I=await S.blob();if(!h)return;if(I.size===0)throw new Error("Audio nicht verfügbar");const O=URL.createObjectURL(I);i.current=O,L=O}const k=new Audio(L);s.current=k,k.preload="auto";const E=()=>{const S=k.duration;S&&isFinite(S)&&S>0&&h&&g(S)};k.addEventListener("loadedmetadata",()=>{if(h&&(E(),d(!1),!isFinite(k.duration)||k.duration===0)){const S=k.currentTime;k.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{E(),k.currentTime=S},100)}}),k.addEventListener("durationchange",E),k.addEventListener("timeupdate",()=>{h&&z(k.currentTime)}),k.addEventListener("ended",()=>{h&&(f(!1),z(0))}),k.addEventListener("error",()=>{h&&(v("Audio konnte nicht geladen werden"),d(!1))})}catch(L){console.error("[AudioPlayer] Failed to load audio:",L),h&&(v("Audio konnte nicht geladen werden"),d(!1))}})(),()=>{h=!1,s.current&&(s.current.pause(),s.current.src=""),i.current&&URL.revokeObjectURL(i.current)}},[t]);const A=()=>{s.current&&(u?s.current.pause():s.current.play(),f(!u))},H=()=>{s.current&&(s.current.muted=!x,b(!x))},R=h=>{s.current&&(s.current.currentTime=Math.max(0,Math.min(y,s.current.currentTime+h)))},U=h=>{if(!s.current){console.warn("[AudioPlayer] Cannot seek - audio not loaded");return}console.log("[AudioPlayer] Seeking to",h),s.current.currentTime=h,z(h),u||(s.current.play(),f(!0))};p.useEffect(()=>{j&&!m&&s.current&&(j.current=U)},[j,m]);const Z=h=>{if(!l.current||!y)return;const o=l.current.getBoundingClientRect(),T=(h.clientX-o.left)/o.width;U(T*y)};return t?e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{size:18,className:"text-indigo-600"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsaufnahme"})]}),e.jsx("div",{ref:l,onClick:Z,className:"relative h-12 bg-slate-50 rounded-xl cursor-pointer overflow-hidden mb-4",children:m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(F,{size:24,className:"text-indigo-600 animate-spin"})}):N?e.jsxs("div",{className:"flex items-center justify-center h-full gap-2",children:[e.jsx(ge,{size:18,className:"text-red-500"}),e.jsx("span",{className:"text-sm text-slate-500",children:N})]}):e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{width:0},animate:{width:`${y>0?C/y*100:0}%`},className:"absolute inset-0 bg-indigo-500/25 rounded-xl"}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-indigo-500 -translate-x-1/2",style:{left:`${y>0?C/y*100:0}%`}})]})}),!N&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(-10),disabled:m,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center disabled:opacity-50",children:e.jsx(be,{size:20,className:"text-slate-600"})}),e.jsx("button",{onClick:A,disabled:m,className:"rounded-full border-none cursor-pointer flex items-center justify-center disabled:opacity-50 transition-colors shadow-md",style:{width:"48px",height:"48px",minWidth:"48px",minHeight:"48px",backgroundColor:"#6366f1"},onMouseEnter:h=>h.currentTarget.style.backgroundColor="#4f46e5",onMouseLeave:h=>h.currentTarget.style.backgroundColor="#6366f1",children:u?e.jsx(je,{size:20,style:{color:"white"}}):e.jsx(W,{size:20,style:{color:"white",marginLeft:"2px"},fill:"white"})}),e.jsx("button",{onClick:()=>R(10),disabled:m,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center disabled:opacity-50",children:e.jsx(ye,{size:20,className:"text-slate-600"})})]}),e.jsxs("div",{className:"flex-1 text-center text-sm text-slate-600 font-mono",children:[X(C)," / ",X(y)]}),e.jsx("button",{onClick:H,disabled:m,className:"w-9 h-9 rounded-lg border-none bg-slate-50 cursor-pointer flex items-center justify-center",children:x?e.jsx(ce,{size:20,className:"text-slate-600"}):e.jsx(Q,{size:20,className:"text-slate-600"})})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsaufnahme"})]}),e.jsxs("div",{className:"flex items-center justify-center h-20 bg-slate-50 rounded-xl text-slate-500 text-sm",children:[e.jsx(ce,{size:20,className:"mr-2"}),"Keine Audioaufnahme verfügbar"]})]})},We=({transcript:t,scenario:r,primaryAccent:c,branding:a,onSeekToTime:j})=>!t||t.length===0?e.jsxs("div",{className:"bg-white rounded-2xl p-10 border border-slate-200 text-center",children:[e.jsx(J,{size:32,className:"text-slate-400 mb-3 mx-auto"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kein Transkript verfügbar"})]}):e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Gesprächsverlauf"})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto pr-2",children:t.map((s,l)=>{const i=s.role==="agent",u=s.timeLabel||(s.elapsedTime!==void 0?X(s.elapsedTime):null);return e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l*.03},className:`flex gap-2.5 mb-3 ${i?"flex-row":"flex-row-reverse"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[i?r?.interviewer_profile?.image_url?e.jsx("img",{src:r.interviewer_profile.image_url,alt:r.interviewer_profile.name||"Interviewer",className:"w-8 h-8 rounded-full object-cover border-2 border-primary/20"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-gradient flex items-center justify-center",children:e.jsx(Ne,{size:16,className:"text-white"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center",children:e.jsx(ve,{size:16,className:"text-white"})}),!i&&u&&e.jsx("button",{onClick:()=>j?.(s.elapsedTime),className:"text-[10px] font-mono text-primary bg-transparent border-none cursor-pointer p-0",children:u})]}),e.jsx("div",{className:`max-w-[85%] px-3.5 py-2.5 text-[13px] leading-relaxed border ${i?"rounded-[4px_16px_16px_16px] bg-slate-50 text-slate-900 border-slate-200":"rounded-[16px_4px_16px_16px] bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-transparent"}`,children:s.text})]},l)})})]}),Y=({label:t,value:r,maxValue:c=10,primaryAccent:a,branding:j})=>{const s=ie(),l=j||s,i=r/c*100,u=c===10?r*10:r,f=ne(u,a);return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between mb-1.5",children:[e.jsx("span",{className:"text-[13px] text-slate-600",children:t}),e.jsx("span",{className:"text-[13px] font-semibold",style:{color:f},children:u})]}),e.jsx("div",{className:"h-1.5 rounded overflow-hidden",style:{background:l.cardBgHover},children:e.jsx(w.div,{initial:{width:0},animate:{width:`${i}%`},transition:{duration:.8,ease:"easeOut"},className:"h-full rounded",style:{background:f}})})]})},te=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null){const r=[];return t.point&&r.push(t.point),t.detail&&r.push(t.detail),t.action&&r.push(t.action),r.join(": ")||JSON.stringify(t)}return String(t)},He=t=>{const r={selbstkundgabe:"Selbstkundgabe",beziehung:"Beziehungsebene",sachinhalt:"Sachinhalt",appell:"Appell",bewertung:"Bewertung",begruendung:"Begründung",nachricht:"Nachricht",analyse_nachricht:"Nachricht-Analyse",overall_assessment:"Gesamtbewertung",deescalation_score:"Deeskalations-Score",score_explanation:"Score-Erklärung"},c=t.toLowerCase();return r[c]?r[c]:t.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase()).trim()},re=(t,r=0)=>t==null?null:typeof t=="string"?e.jsx("p",{className:"text-[13px] leading-relaxed text-slate-700 m-0 whitespace-pre-wrap",children:t}):typeof t=="number"?e.jsx("span",{className:"text-[13px] font-semibold text-primary",children:t}):typeof t=="boolean"?e.jsx("span",{className:`text-[13px] font-semibold ${t?"text-green-600":"text-red-600"}`,children:t?"Ja":"Nein"}):Array.isArray(t)?e.jsx("div",{className:"space-y-2",children:t.map((c,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 text-[13px]",children:"•"}),e.jsx("div",{className:"flex-1",children:re(c,r+1)})]},a))}):typeof t=="object"?e.jsx("div",{className:`space-y-3 ${r>0?"pl-3 border-l-2 border-slate-200":""}`,children:Object.entries(t).map(([c,a])=>e.jsxs("div",{children:[e.jsx("span",{className:"text-[12px] font-semibold text-slate-500 uppercase tracking-wide",children:He(c)}),e.jsx("div",{className:"mt-1",children:re(a,r+1)})]},c))}):e.jsx("span",{className:"text-[13px] text-slate-700",children:String(t)}),xe=t=>t?!!(t.summary||t.overall_assessment||t.strengths?.length>0||t.improvements?.length>0||t.areas_for_improvement?.length>0||t.tips?.length>0||t.suggestions?.length>0||t.rating):!1,Ue=({feedback:t,audioAnalysis:r,primaryAccent:c,branding:a})=>{const j=xe(t)?"summary":"custom-feedback",[s,l]=p.useState(j),i=t?{summary:t.summary||t.overall_assessment||null,strengths:t.strengths||[],improvements:t.improvements||t.areas_for_improvement||[],tips:t.tips||t.suggestions||[],rating:t.rating||null}:null,u=f=>{l(s===f?null:f)};return e.jsxs("div",{className:"flex flex-col gap-3",children:[i?.summary&&e.jsxs("div",{className:"bg-primary/5 rounded-xl border border-primary/20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("summary"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(we,{size:18,className:"text-primary"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-slate-900",children:"Gesamtbewertung"}),e.jsx(P,{size:18,className:`text-slate-500 transition-transform ${s==="summary"?"rotate-180":""}`})]}),e.jsx($,{children:s==="summary"&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("p",{className:"text-[13px] leading-relaxed text-slate-700",children:i.summary})})})})]}),i?.strengths?.length>0&&e.jsxs("div",{className:"bg-green-50 rounded-xl border border-green-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("strengths"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(se,{size:18,className:"text-green-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-green-800",children:"Deine Superkräfte"}),e.jsxs("span",{className:"text-xs text-green-500 font-medium",children:[i.strengths.length," Stärken"]}),e.jsx(P,{size:18,className:`text-green-500 transition-transform ${s==="strengths"?"rotate-180":""}`})]}),e.jsx($,{children:s==="strengths"&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.strengths.map((f,x)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[11px] font-semibold text-green-500",children:"✓"})}),e.jsx("p",{className:"text-[13px] leading-relaxed text-green-800 m-0",children:te(f)})]},x))})})})]}),i?.improvements?.length>0&&e.jsxs("div",{className:"bg-amber-50 rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("improvements"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(ke,{size:18,className:"text-amber-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-amber-900",children:"Dein Trainingsfeld"}),e.jsxs("span",{className:"text-xs text-amber-500 font-medium",children:[i.improvements.length," Punkte"]}),e.jsx(P,{size:18,className:`text-amber-500 transition-transform ${s==="improvements"?"rotate-180":""}`})]}),e.jsx($,{children:s==="improvements"&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.improvements.map((f,x)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-[11px] font-semibold text-amber-500",children:x+1})}),e.jsx("p",{className:"text-[13px] leading-relaxed text-amber-900 m-0",children:te(f)})]},x))})})})]}),i?.tips?.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-xl border border-blue-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("tips"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(Se,{size:18,className:"text-blue-500"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-blue-900",children:"Praktische Tipps"}),e.jsxs("span",{className:"text-xs text-blue-500 font-medium",children:[i.tips.length," Tipps"]}),e.jsx(P,{size:18,className:`text-blue-500 transition-transform ${s==="tips"?"rotate-180":""}`})]}),e.jsx($,{children:s==="tips"&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:i.tips.map((f,x)=>e.jsxs("div",{className:"flex gap-2.5 mb-2.5",children:[e.jsx(Ce,{size:16,className:"text-blue-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-[13px] leading-relaxed text-blue-900 m-0",children:te(f)})]},x))})})})]}),i?.rating&&e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ze,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"Bewertungskriterien"})]}),i.rating.communication!==void 0&&e.jsx(Y,{label:"Kommunikation",value:i.rating.communication,primaryAccent:c,branding:a}),i.rating.motivation!==void 0&&e.jsx(Y,{label:"Motivation",value:i.rating.motivation,primaryAccent:c,branding:a}),i.rating.professionalism!==void 0&&e.jsx(Y,{label:"Professionalität",value:i.rating.professionalism,primaryAccent:c,branding:a}),i.rating.preparation!==void 0&&e.jsx(Y,{label:"Vorbereitung",value:i.rating.preparation,primaryAccent:c,branding:a})]}),!xe(t)&&t&&e.jsxs("div",{className:"bg-primary/5 rounded-xl border border-primary/20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u("custom-feedback"),className:"w-full px-4 py-3.5 flex items-center gap-2.5 bg-transparent border-none cursor-pointer text-left",children:[e.jsx(J,{size:18,className:"text-primary"}),e.jsx("span",{className:"flex-1 text-sm font-semibold text-slate-900",children:"Feedback-Analyse"}),e.jsx(P,{size:18,className:`text-slate-500 transition-transform ${s==="custom-feedback"?"rotate-180":""}`})]}),e.jsx($,{children:s==="custom-feedback"&&e.jsx(w.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:re(t)})})})]})]})},Ve=t=>t>=80?{color:n.green[500],bg:n.green[50],label:"Sehr selbstsicher"}:t>=60?{color:n.blue[500],bg:n.blue[50],label:"Selbstsicher"}:t>=40?{color:n.amber[500],bg:n.amber[50],label:"Ausbaufähig"}:{color:n.red[500],bg:n.red[50],label:"Unsicher"},Ke=t=>{switch(t){case"zu_langsam":return 15;case"optimal":return 50;case"zu_schnell":return 85;default:return 50}},me=t=>{if(typeof t=="number")return t;if(!t||typeof t!="string")return 0;const r=t.split(":");if(r.length===2){const c=parseInt(r[0],10)||0,a=parseInt(r[1],10)||0;return c*60+a}if(r.length===3){const c=parseInt(r[0],10)||0,a=parseInt(r[1],10)||0,j=parseInt(r[2],10)||0;return c*3600+a*60+j}return parseFloat(t)||0},Ye=t=>t==="lebendig"?"Lebendig":t==="natürlich"?"Natürlich":"Monoton",Je=t=>t==="lebendig"?{base:20,variance:30}:t==="natürlich"?{base:25,variance:20}:{base:35,variance:8},Xe=({audioAnalysis:t,primaryAccent:r,branding:c,onJumpToTimestamp:a})=>{const j=ie(),s=c||j,l=t?.audio_metrics||t,i=l&&(l.confidence_score!==void 0||l.speech_cleanliness||l.pacing||l.tonality);if(!t||!i)return e.jsxs("div",{className:"bg-white rounded-xl p-10 py-10 text-center",style:{border:`1px solid ${s.borderColor}`},children:[e.jsx(ee,{size:32,color:s.textMuted,className:"mb-3 inline-block"}),e.jsx("p",{className:"text-sm m-0",style:{color:s.textMuted},children:"Keine Audio-Analyse verfügbar"})]});const u=l.confidence_score,f=l.speech_cleanliness,x=l.pacing,b=l.tonality,C=f?.total_filler_count||0,z=f?.filler_word_analysis||[],y=f?.feedback;return e.jsxs("div",{className:"flex flex-col gap-4",children:[u!==void 0&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ee,{size:18,color:r}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Selbstsicherheit"})]}),e.jsx("div",{className:"flex justify-center mb-4",children:(()=>{const g=u,m=Ve(g),d=140,N=d/2-12,v=Math.PI*N,A=v-g/100*v;return e.jsxs("div",{className:"rounded-2xl p-5 px-7.5 flex flex-col items-center",style:{background:m.bg},children:[e.jsxs("div",{style:{position:"relative",width:d,height:d/2+20},children:[e.jsxs("svg",{width:d,height:d/2+20,style:{overflow:"visible"},children:[e.jsx("path",{d:`M 12 ${d/2} A ${N} ${N} 0 0 1 ${d-12} ${d/2}`,fill:"none",stroke:n.slate[200],strokeWidth:"10",strokeLinecap:"round"}),e.jsx(w.path,{d:`M 12 ${d/2} A ${N} ${N} 0 0 1 ${d-12} ${d/2}`,fill:"none",stroke:m.color,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:v,initial:{strokeDashoffset:v},animate:{strokeDashoffset:A},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",paddingBottom:"4px"},children:[e.jsx(w.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5},style:{fontSize:"32px",fontWeight:700,color:m.color},children:Math.round(g)}),e.jsx("span",{style:{fontSize:"11px",color:s.textMuted},children:"/ 100"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"8px"},children:[e.jsx(ee,{size:14,color:m.color}),e.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:m.color},children:m.label})]})]})})()}),l.summary_text&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,textAlign:"center"},children:l.summary_text})]}),f&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{size:18,color:n.orange[500]}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Füllwörter"})]}),e.jsxs("span",{className:"text-[13px] font-semibold px-2.5 py-1 rounded-full",style:{background:C<=2?n.green[100]:C<=5?n.amber[100]:n.red[100],color:C<=2?n.green[800]:C<=5?n.amber[800]:n.red[800]},children:[C,"x gesamt"]})]}),z.length>0?e.jsx("div",{className:"flex flex-col gap-2 mb-3",children:z.map((g,m)=>e.jsxs("div",{className:"rounded-lg bg-amber-100 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("span",{className:"text-[13px] text-amber-900 font-medium",children:['"',g.word,'"']}),e.jsxs("span",{className:"text-xs text-amber-900 font-semibold",children:[g.count,"x"]})]}),g.examples?.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 px-3 py-2 bg-amber-50 border-t border-amber-200",children:g.examples.map((d,N)=>e.jsxs("button",{onClick:()=>a?.(me(d.timestamp)),style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"6px",border:"none",background:n.amber[100],cursor:"pointer",fontSize:"11px",color:n.amber[800],transition:"all 0.15s"},onMouseOver:v=>v.currentTarget.style.background=n.amber[200],onMouseOut:v=>v.currentTarget.style.background=n.amber[100],children:[e.jsx("span",{style:{fontFamily:"monospace",fontWeight:600},children:d.timestamp}),e.jsx(W,{size:10})]},N))})]},m))}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:n.green[500]},children:[e.jsx(se,{size:16}),e.jsx("span",{style:{fontSize:"13px"},children:"Keine Füllwörter erkannt!"})]}),y&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,marginTop:"12px"},children:y})]}),x&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{size:18,color:n.blue[500]}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Sprechtempo"})]}),x.estimated_wpm&&e.jsxs("span",{className:"text-xs font-mono px-2.5 py-1 rounded-md",style:{background:s.cardBgHover,color:s.textSecondary},children:["~",x.estimated_wpm," WPM"]})]}),e.jsxs("div",{style:{position:"relative",height:"40px",marginBottom:"8px"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"8px",borderRadius:"4px",background:`linear-gradient(90deg, ${n.blue[300]}, ${n.green[300]}, ${n.red[300]})`,transform:"translateY(-50%)"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"60px",height:"16px",background:De(n.green[500],.2),border:`1px solid ${n.green[500]}`,borderRadius:"8px",transform:"translate(-50%, -50%)"}}),e.jsx(w.div,{initial:{left:"50%"},animate:{left:`${Ke(x.rating)}%`},transition:{duration:.8,ease:"easeOut"},style:{position:"absolute",top:"50%",width:"16px",height:"16px",borderRadius:"50%",background:x.rating==="optimal"?n.green[500]:n.amber[500],border:`2px solid ${n.white}`,boxShadow:"0 2px 6px rgba(0,0,0,0.2)",transform:"translate(-50%, -50%)"}}),e.jsxs("div",{style:{position:"absolute",bottom:"-4px",left:0,right:0,display:"flex",justifyContent:"space-between",fontSize:"10px",color:s.textMuted},children:[e.jsx("span",{children:"Langsam"}),e.jsx("span",{style:{color:n.green[500],fontWeight:500},children:"Optimal"}),e.jsx("span",{children:"Schnell"})]})]}),x.feedback&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary,marginTop:"16px"},children:x.feedback})]}),b&&e.jsxs("div",{className:"bg-white rounded-2xl p-5",style:{border:`1px solid ${s.borderColor}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{size:18,color:n.indigo[500]}),e.jsx("span",{className:"text-sm font-semibold",style:{color:s.textMain},children:"Betonung & Melodie"})]}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-md bg-indigo-50 text-indigo-700",children:Ye(b.rating)})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",height:"48px",marginBottom:"12px"},children:Array.from({length:30}).map((g,m)=>{const{base:d,variance:N}=Je(b.rating),v=d+Math.sin(m*.5)*N+Math.sin(m*12.9898)%1*(N/2);return e.jsx(w.div,{initial:{height:0},animate:{height:`${Math.max(10,Math.min(100,v))}%`},transition:{duration:.5,delay:m*.02},style:{width:"4px",borderRadius:"2px",background:n.indigo[500]}},m)})}),b.highlights?.length>0&&e.jsx("div",{style:{marginBottom:"12px"},children:b.highlights.map((g,m)=>e.jsxs("button",{onClick:()=>a?.(me(g.timestamp)),style:{width:"100%",display:"flex",alignItems:"flex-start",gap:"8px",padding:"10px 12px",marginBottom:"6px",borderRadius:"8px",border:"none",background:g.type==="positive"?n.green[50]:n.red[50],cursor:"pointer",textAlign:"left"},children:[e.jsx("span",{style:{fontSize:"11px",fontFamily:"monospace",padding:"2px 6px",borderRadius:"4px",background:g.type==="positive"?n.green[100]:n.red[100],color:g.type==="positive"?n.green[800]:n.red[800],flexShrink:0},children:g.timestamp}),e.jsx("span",{style:{flexShrink:0,marginTop:"1px"},children:g.type==="positive"?e.jsx(se,{size:14,color:n.green[500]}):e.jsx(Te,{size:14,color:n.red[500]})}),e.jsx("span",{style:{fontSize:"12px",color:s.textSecondary,flex:1,lineHeight:1.5,wordBreak:"break-word",whiteSpace:"normal"},children:g.note}),e.jsx(W,{size:12,color:s.textMuted,style:{flexShrink:0,marginTop:"2px"}})]},m))}),b.feedback&&e.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:s.textSecondary},children:b.feedback})]})]})},_={COACHING:"coaching",ANALYSEN:"analysen"},Ze=t=>t>=90?"Ausgezeichnet!":t>=80?"Sehr gut!":t>=70?"Gut!":t>=60?"Solide Leistung":t>=50?"Ausbaufähig":"Weiter üben!",qe=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",nt=({session:t,scenario:r,feedback:c,audioAnalysis:a,onBack:j,onRepeat:s,onDelete:l,isLoading:i=!1,primaryAccent:u,headerGradient:f})=>{const x=ie(),b=u||x.primaryAccent,C=f||x.headerGradient,z=p.useRef(null),[y,g]=p.useState(_.COACHING),[m,d]=p.useState(!1),[N,v]=p.useState(!1),[A,H]=p.useState(!1),[R,U]=p.useState(null),[Z,h]=p.useState(!1),o=R||t;p.useEffect(()=>{t?.id&&!t?.audio_analysis_json&&!a&&!R&&(h(!0),Ee(t.id).then(G=>{U(G)}).catch(G=>{console.error("Failed to fetch full session:",G)}).finally(()=>{h(!1)}))},[t?.id,t?.audio_analysis_json,a,R]);const T=p.useMemo(()=>c&&typeof c=="object"?c:o?.feedback_json?Ie(o.feedback_json):null,[c,o?.feedback_json]),L=p.useMemo(()=>a&&typeof a=="object"?a:o?.audio_analysis_json?Oe(o.audio_analysis_json):null,[a,o?.audio_analysis_json]),k=p.useMemo(()=>o?.transcript?Ge(o.transcript):[],[o?.transcript]),E=p.useMemo(()=>o?.audio_url?o.audio_url:o?.id?Be(o.id):null,[o?.id,o?.audio_url]),S=p.useMemo(()=>T?.rating?.overall!==void 0?T.rating.overall*10:0,[T]),I=M=>{z.current&&z.current(M)},O=async()=>{if(!(!o?.id||A)){H(!0);try{const G=(window.wpApiSettings||{}).root||"/wp-json/",ue=pe(),ae=await fetch(`${G}bewerbungstrainer/v1/sessions/${o.id}/export-pdf`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":ue}}),D=await ae.json();if(!ae.ok)throw console.error("[PDF] Server error:",D),new Error(D.error||"PDF-Export fehlgeschlagen");if(D.pdf_base64&&D.filename){const q=atob(D.pdf_base64),le=new Array(q.length);for(let V=0;V<q.length;V++)le[V]=q.charCodeAt(V);const he=new Uint8Array(le),fe=new Blob([he],{type:"application/pdf"}),oe=window.URL.createObjectURL(fe),B=document.createElement("a");B.href=oe,B.download=D.filename,document.body.appendChild(B),B.click(),document.body.removeChild(B),window.URL.revokeObjectURL(oe)}}catch(M){console.error("[PDF] Download failed:",M)}finally{H(!1)}}};return i||Z?e.jsxs("div",{className:"min-h-screen flex items-center justify-center flex-col gap-4",children:[e.jsx(F,{size:40,className:"animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Lade Report..."})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"sticky top-0 z-40 p-5 px-4 md:p-6 md:px-8",style:{background:C},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[j&&e.jsxs("button",{onClick:j,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Le,{size:16}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(Pe,{score:S,size:100,primaryAccent:b,isHeader:!0})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Live-Simulation"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:ne(S,b)},children:Ze(S)})]}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white m-0 mb-2",children:r?.title||o?.scenario_title||"Übungssession"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(Me,{size:14}),qe(o?.created_at)]}),o?.duration&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx($e,{size:14}),X(o.duration)]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[o?.id&&e.jsxs("button",{onClick:O,disabled:A,className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-[10px] px-5 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-white/30 transition-colors disabled:opacity-70 disabled:cursor-wait",children:[A?e.jsx(F,{size:16,className:"animate-spin"}):e.jsx(de,{size:16}),"PDF Export"]}),s&&e.jsxs("button",{onClick:s,className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-[10px] px-5 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-white/30 transition-colors",children:[e.jsx(W,{size:16}),"Erneut üben"]}),l&&e.jsx("button",{onClick:()=>d(!0),className:"flex items-center gap-2 bg-red-500/20 border border-red-500/40 rounded-[10px] px-4 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-red-500/30 transition-colors",children:e.jsx(K,{size:16})})]})]})]})}),e.jsxs("div",{className:"max-w-[1400px] mx-auto p-4 md:px-8 md:py-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[30fr_70fr] gap-6 items-start",children:[e.jsxs("div",{className:"order-2 md:order-1",children:[e.jsx(We,{transcript:k,scenario:r,primaryAccent:b,branding:x,onSeekToTime:I}),e.jsx("div",{className:"mt-4",children:e.jsx(Fe,{audioUrl:E,duration:o?.duration,primaryAccent:b,branding:x,onSeek:z})})]}),e.jsxs("div",{className:"order-1 md:order-2",children:[e.jsxs("div",{className:"flex bg-white rounded-xl p-1 mb-4 border border-slate-200",children:[e.jsx("button",{onClick:()=>g(_.COACHING),className:`flex-1 py-2.5 px-4 rounded-lg border-none text-[13px] font-semibold cursor-pointer transition-all ${y===_.COACHING?"text-white":"bg-transparent text-slate-500 hover:text-slate-700"}`,style:y===_.COACHING?{background:b}:{},children:"Coaching"}),e.jsx("button",{onClick:()=>g(_.ANALYSEN),className:`flex-1 py-2.5 px-4 rounded-lg border-none text-[13px] font-semibold cursor-pointer transition-all ${y===_.ANALYSEN?"text-white":"bg-transparent text-slate-500 hover:text-slate-700"}`,style:y===_.ANALYSEN?{background:b}:{},children:"Analysen"})]}),e.jsx($,{mode:"wait",children:e.jsx(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:y===_.COACHING?e.jsx(Ue,{feedback:T,audioAnalysis:L,primaryAccent:b,branding:x}):e.jsx(Xe,{audioAnalysis:L,primaryAccent:b,branding:x,onJumpToTimestamp:I})},y)})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col gap-3 md:hidden",children:[o?.id&&e.jsxs("button",{onClick:O,disabled:A,className:"w-full flex items-center justify-center gap-2 rounded-xl px-6 py-3.5 cursor-pointer text-white text-[15px] font-semibold border-none disabled:opacity-70 disabled:cursor-wait",style:{background:b},children:[A?e.jsx(F,{size:18,className:"animate-spin"}):e.jsx(de,{size:18}),"PDF Export"]}),s&&e.jsxs("button",{onClick:s,className:"w-full flex items-center justify-center gap-2 bg-white border border-slate-200 rounded-xl px-6 py-3.5 cursor-pointer text-slate-900 text-[15px] font-semibold hover:bg-slate-50 transition-colors",children:[e.jsx(W,{size:18}),"Erneut üben"]}),l&&e.jsxs("button",{onClick:()=>d(!0),className:"w-full flex items-center justify-center gap-2 bg-transparent border border-red-500 rounded-xl px-6 py-3.5 cursor-pointer text-red-500 text-[15px] font-semibold hover:bg-red-50 transition-colors",children:[e.jsx(K,{size:18}),"Session löschen"]})]})]}),e.jsx($,{children:m&&e.jsxs(e.Fragment,{children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>d(!1),className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Session löschen?"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Diese Aktion kann nicht rückgängig gemacht werden. Dein Transkript und Feedback werden dauerhaft gelöscht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(!1),disabled:N,className:"flex-1 py-3 px-4 rounded-[10px] border border-slate-200 bg-white text-slate-900 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Abbrechen"}),e.jsx("button",{onClick:async()=>{if(!(!l||!o?.id)){v(!0);try{await l(o)}catch(M){console.error("Failed to delete session:",M)}finally{v(!1),d(!1)}}},disabled:N,className:"flex-1 py-3 px-4 rounded-[10px] border-none bg-red-500 text-white text-sm font-medium cursor-pointer flex items-center justify-center gap-2 hover:bg-red-600 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:N?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:16,className:"animate-spin"}),"Löschen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16}),"Löschen"]})})]})]})})]})})]})};export{nt as R};
