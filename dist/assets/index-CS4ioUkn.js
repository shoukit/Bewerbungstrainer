import{j as r,S as k}from"./ui-vendor-B9DEMv6g.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{a as v,D as A}from"./DecisionBoardResult-Coacccm7.js";import{w as p,h as F,l as P,C as x}from"./FeatureInfoButton-DsfjgKw4.js";import{u as T,a as _,F as L}from"./useScrollToTop-BwJMcv0w.js";import"./Button-BHvYxNT_.js";import"./utils-BEHD0UYf.js";import"./input-B9TvIUbd.js";import"./textarea-Bk12bbFh.js";import"./index.js";import"./AudioRecorder-B5vZ1Zkz.js";import"./useBranding-CjHnMPMs.js";import"./button-CGU79vEo.js";import"./card-Ct7yzV_G.js";import"./index-CklPxmEV.js";const i={INPUT:"input",RESULT:"result"},oe=({isAuthenticated:m,requireAuth:h,setPendingAction:M,onNavigateToHistory:c})=>{const[y,d]=o.useState(i.INPUT),[I,D]=o.useState(null),[C,u]=o.useState(null),[t,a]=o.useState(null),[N,O]=o.useState(!1),l=o.useRef(!1),B=P(x.teal[500],x.teal[400]);T(m,h),_({dependencies:[y]});const b=o.useCallback(async e=>{if(l.current||!e.topic?.trim())return null;try{const s={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},n=await p.createDecision(s);if(n?.id)return l.current=!0,a(n.id),console.log("[DecisionBoard] Draft session saved with ID:",n.id),n.id}catch(s){console.error("[DecisionBoard] Failed to save draft session:",s)}return null},[]),S=o.useCallback(async(e,s)=>{if(e)try{const n={topic:s.topic,context:s.context||null,pros:s.pros||[],cons:s.cons||[],pro_score:s.proScore||0,contra_score:s.contraScore||0,analysis:s.analysis||null,status:s.status||"completed"};await p.updateDecision(e,n),console.log("[DecisionBoard] Session updated:",e)}catch(n){console.error("[DecisionBoard] Failed to update session:",n)}},[]),w=o.useCallback(async e=>{if(e)try{await p.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(s){console.error("[DecisionBoard] Failed to delete session:",s)}},[]),g=o.useCallback(async(e,s)=>{D(e),u(s),d(i.RESULT);try{if(t)await S(t,{...e,analysis:s,status:"completed"});else{const n={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:s,status:"completed"},f=await p.createDecision(n);f?.id&&(a(f.id),l.current=!0,console.log("[DecisionBoard] Decision saved with ID:",f.id))}}catch(n){console.error("[DecisionBoard] Failed to save decision:",n)}},[t,S]),E=o.useCallback(()=>{D(null),u(null),a(null),l.current=!1,d(i.INPUT)},[]),R=o.useCallback(()=>{u(null),d(i.INPUT)},[]),U=o.useCallback(async()=>{t&&await w(t),D(null),u(null),a(null),l.current=!1,c&&c()},[t,w,c]),j=()=>{switch(y){case i.RESULT:return r.jsx(A,{decisionData:I,analysisResult:C,onStartNew:E,onEditDecision:R});case i.INPUT:default:return r.jsx(v,{initialData:I,onAnalysisComplete:g,onCancel:c?U:null,isAuthenticated:m,requireAuth:h,savedDecisionId:t,onSaveDraft:b,onUpdateSession:S,onDecisionIdChange:a})}};return r.jsxs(r.Fragment,{children:[r.jsx(F,{featureId:"decisionboard",showOnMount:!0}),r.jsxs("div",{style:{minHeight:"100%"},children:[r.jsx(L,{featureId:"decisionboard",icon:k,title:"Entscheidungs-Board",subtitle:"Strukturierte Entscheidungsfindung",gradient:B,historyLabel:"Meine Entscheidungen",onNavigateToHistory:c}),j()]})]})};export{oe as DecisionBoardApp,v as DecisionBoardInput,A as DecisionBoardResult};
