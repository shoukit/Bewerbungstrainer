import{j as e,p as Q,q as Ct,b as X,a as Ae,T as te,ai as _t,w as At,aj as zt,B as lt,v as ze,x as Pe,e as Ee,ae as Ce,O as it,o as ot,z as pe,I as ge,M as he,a7 as Et,aa as ct,k as dt,y as Z,_ as Ze,ak as ut,h as De,a2 as Mt,l as We,a3 as Ft,a4 as Ke,a5 as $t,A as Tt,m as Rt,J as It,E as Oe,al as Bt,a1 as be,am as Ve,n as xt,X as Lt,i as qt,a0 as Dt}from"./ui-vendor-B9DEMv6g.js";import{a as n,d as mt}from"./react-vendor-uDOJF2jQ.js";import{h as Ot,F as Vt,g as Pt,c as Zt,C as Ye,i as _e,u as ht,w as U,j as Wt}from"./FeatureInfoButton-ZHD_p0zG.js";import{S as Kt}from"./ScenarioDashboard-B4VCawg1.js";import{u as ce}from"./useBranding-B-qAk1eY.js";import{u as Gt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-DuNWsfsv.js";import{A as Ut,M as pt,a as gt}from"./MicrophoneTestDialog-CjRagsq0.js";import{D as Ht}from"./DeviceSettingsDialog-C-NwpFg0.js";import{F as bt}from"./fullscreen-loader-BGHAvS2i.js";import{B as oe,C as ke}from"./Button-DIyOYEUG.js";import"./select-native-hA6ciQRA.js";import"./dialog-BRm7JlyZ.js";import{D as Jt}from"./DynamicFormField-BZFsF8na.js";import"./ScenarioCard-DvRLBHYT.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-S-Mr7VxU.js";import"./index-CklPxmEV.js";const et="[SIMULATOR_DASHBOARD]",Xt={briefcase:lt,banknote:zt,user:At,presentation:_t,target:te,mic:Q},Yt=async()=>{const t=await fetch(`${Pt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Zt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const a=await t.json();if(a.success&&a.data?.scenarios)return a.data.scenarios;throw new Error("Keine Szenarien gefunden")},es=t=>Xt[t.icon]||lt,ts=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],tt=({onSelectScenario:t,isAuthenticated:a,requireAuth:o,setPendingScenario:c,onNavigateToHistory:r})=>(n.useEffect(()=>(console.log(`${et} ðŸ”µ MOUNT`),()=>{console.log(`${et} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Ot,{featureId:"simulator",showOnMount:!0}),e.jsx(Kt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ae,headerActions:e.jsx(Vt,{featureId:"simulator",size:"sm"}),fetchScenarios:Yt,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:ts,getIconForScenario:es,cardActionLabel:"Starten",cardActionIcon:Ct,categoryField:"category",emptyStateIcon:Q,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:a,requireAuth:o,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]})),ss=({field:t,value:a,onChange:o,error:c,focusColor:r,branding:s})=>{const x=r||"#4a9ec9",_="w-full rounded-lg text-base outline-none transition-all",w="px-4 py-3",b=c?"border-2 border-red-500":"border-2 border-slate-200",p={borderColor:x,boxShadow:`0 0 0 3px ${x}1a`},m=l=>{Object.assign(l.target.style,p),setTimeout(()=>{const N=l.target;if(N){const S=N.closest("div");S&&S.scrollIntoView({behavior:"smooth",block:"center"})}},300)},M=l=>{l.target.style.borderColor=c?Ye.red[500]:Ye.slate[200],l.target.style.boxShadow="none"},j=()=>{const l=`${_} ${w} ${b} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:a||"",onChange:N=>o(t.key,N.target.value),placeholder:t.placeholder||"",className:l,onFocus:m,onBlur:M});case"textarea":return e.jsx("textarea",{value:a||"",onChange:N=>o(t.key,N.target.value),placeholder:t.placeholder||"",rows:4,className:`${l} resize-vertical min-h-[100px]`,onFocus:m,onBlur:M});case"select":return e.jsxs("select",{value:a||t.default||"",onChange:N=>o(t.key,N.target.value),className:`${l} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:m,onBlur:M,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))]});case"number":return e.jsx("input",{type:"number",value:a||"",onChange:N=>o(t.key,N.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:l,onFocus:m,onBlur:M});default:return e.jsx("input",{type:"text",value:a||"",onChange:N=>o(t.key,N.target.value),placeholder:t.placeholder||"",className:l,onFocus:m,onBlur:M})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),j(),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),t.hint]})]})},ns=({scenario:t,onBack:a,onNext:o})=>{const[c,r]=n.useState({}),[s,x]=n.useState({}),[_,w]=n.useState([]),[b,p]=n.useState(!1),m=ce(),M=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const d=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(d)?d.filter(g=>g.user_input!==!1):[]}catch(d){return console.error("Error parsing input_configuration:",d),[]}},[t?.input_configuration]);n.useEffect(()=>{const d={};M.forEach(g=>{g.default&&(d[g.key]=g.default)}),r(d)},[M]);const j=(d,g)=>{r(i=>({...i,[d]:g})),s[d]&&x(i=>{const y={...i};return delete y[d],y})},l=()=>{w(d=>[...d,{key:"",value:""}])},N=(d,g,i)=>{w(y=>{const f=[...y];return f[d]={...f[d],[g]:i},f})},S=d=>{w(g=>g.filter((i,y)=>y!==d))},$=()=>{const d={};return M.forEach(g=>{const i=c[g.key];if(g.required&&(!i||i.trim()==="")){d[g.key]="Dieses Feld ist erforderlich";return}if(!(!i||i.trim()==="")&&g.validation){const{minLength:y,maxLength:f,min:k,max:z,pattern:I}=g.validation;y&&i.length<y&&(d[g.key]=`Mindestens ${y} Zeichen erforderlich`),f&&i.length>f&&(d[g.key]=`Maximal ${f} Zeichen erlaubt`),k!==void 0&&Number(i)<k&&(d[g.key]=`Mindestens ${k}`),z!==void 0&&Number(i)>z&&(d[g.key]=`Maximal ${z}`),I&&!new RegExp(I).test(i)&&(d[g.key]="UngÃ¼ltiges Format")}}),x(d),Object.keys(d).length===0},L=d=>{if(d.preventDefault(),!$())return;const g={...c};_.forEach(i=>{i.key&&i.value&&(g[i.key]=i.value)}),o(g)};return n.useEffect(()=>{M.length===0&&o({})},[M,o]),M.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:m.headerGradient},children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:L,children:[M.map(d=>e.jsx(ss,{field:d,value:c[d.key],onChange:j,error:s[d.key],focusColor:m.primaryAccent,branding:m},d.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>p(!b),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:b?m.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[b?e.jsx(Pe,{size:18}):e.jsx(Ee,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),b&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),_.length>0&&e.jsx("div",{className:"mb-3",children:_.map((d,g)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:d.key||"",onChange:i=>N(g,"key",i.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>S(g),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(it,{size:16})})]}),e.jsx("textarea",{value:d.value||"",onChange:i=>N(g,"value",i.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},g))}),e.jsxs("button",{type:"button",onClick:l,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:m.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all hover:-translate-y-0.5",style:{background:m.buttonGradient,boxShadow:`0 4px 12px ${m.primaryAccent}4d`},children:["Weiter",e.jsx(ot,{className:"w-5 h-5"})]})]})]})},ve=({score:t,label:a,size:o="normal",variant:c="default"})=>{const r=t!=null?t*10:null,x=(w=>c==="white"?"bg-white/20 border-white text-white":w>=80?"bg-green-50 border-green-500 text-green-600":w>=60?"bg-blue-50 border-blue-500 text-blue-600":w>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(r),_=o==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${_?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${x}
      `,children:e.jsx("span",{className:`
          ${_?"text-3xl":"text-2xl"}
          font-bold
        `,children:r!=null?Math.round(r):"-"})}),e.jsx("span",{className:`
        ${_?"text-sm":"text-xs"}
        ${c==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:a})]})},ie=({title:t,icon:a,children:o,defaultOpen:c=!0})=>{const[r,s]=n.useState(c);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>s(!r),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),r?e.jsx(Pe,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ee,{className:"w-5 h-5 text-slate-400"})]}),r&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:o})]})},Be=({text:t,type:a})=>{const o={strength:{icon:ct,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:dt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:Z,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:c,iconClass:r,bgClass:s}=o[a]||o.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${s} mb-2`,children:[e.jsx(c,{className:`w-5 h-5 ${r} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},rs=({metrics:t})=>{if(!t)return null;const o=(r=>{switch(r){case"optimal":return{label:"Optimal",colorClass:"text-green-600"};case"zu_schnell":return{label:"Zu schnell",colorClass:"text-amber-600"};case"zu_langsam":return{label:"Zu langsam",colorClass:"text-amber-600"};default:return{label:r||"N/A",colorClass:"text-slate-400"}}})(t.speech_rate),c=r=>{switch(r){case"niedrig":return"text-green-600";case"mittel":return"text-amber-600";case"hoch":return"text-red-600";default:return"text-slate-400"}};return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Sprechtempo"}),e.jsx("span",{className:`text-lg font-semibold ${o.colorClass}`,children:o.label})]}),t.filler_words&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{className:`text-lg font-semibold ${c(t.filler_words.severity)}`,children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{className:"text-xs font-normal ml-2",children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Selbstbewusstsein"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.confidence_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.confidence_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Klarheit"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.clarity_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.clarity_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2 p-4 rounded-xl bg-blue-50 text-sm text-slate-700 leading-relaxed",children:["ðŸ’¡ ",t.notes]})]})},as=({audioUrl:t})=>{const a=n.useRef(null),[o,c]=n.useState(!1),[r,s]=n.useState(0),[x,_]=n.useState(0),[w,b]=n.useState(!0),[p,m]=n.useState(null);n.useEffect(()=>{if(!t)return;b(!0),m(null);const S=new Audio;a.current=S;const $=()=>{const d=S.duration;d&&isFinite(d)&&d>0&&_(d),b(!1)},L=()=>{b(!1);const d=S.duration;d&&isFinite(d)&&d>0&&_(d)};return S.addEventListener("loadedmetadata",$),S.addEventListener("canplaythrough",L),S.addEventListener("timeupdate",()=>s(S.currentTime)),S.addEventListener("play",()=>c(!0)),S.addEventListener("pause",()=>c(!1)),S.addEventListener("ended",()=>c(!1)),S.addEventListener("error",()=>{m("Audio nicht verfÃ¼gbar"),b(!1)}),S.src=t,S.load(),()=>{S.pause(),S.src=""}},[t]);const M=()=>{a.current&&(o?a.current.pause():a.current.play())},j=S=>{const $=S.currentTarget.getBoundingClientRect(),L=(S.clientX-$.left)/$.width;a.current&&x>0&&(a.current.currentTime=L*x)},l=S=>{a.current&&(a.current.currentTime=Math.max(0,Math.min(a.current.currentTime+S,x)))};if(!t)return null;if(p)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(pe,{size:16})," ",p]});const N=x>0?r/x*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:j,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full transition-all",style:{width:`${N}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>l(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Mt,{size:20})}),e.jsx("button",{onClick:M,disabled:w,className:`w-11 h-11 rounded-full bg-blue-600 hover:bg-blue-700 border-none flex items-center justify-center text-white shadow-md transition-all ${w?"cursor-wait opacity-70":"cursor-pointer"}`,children:w?e.jsx(We,{size:20,className:"animate-spin"}):o?e.jsx(Ft,{size:20,fill:"white"}):e.jsx(Ke,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>l(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx($t,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[_e(r)," / ",_e(x)]})]})},ls=({transcript:t,feedback:a,audioMetrics:o,audioUrl:c,onRetry:r,onNext:s,onComplete:x,isLastQuestion:_,hideButtons:w=!1})=>{const b=typeof a=="string"?JSON.parse(a):a;return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl shadow-lg",children:[e.jsx(ve,{score:b?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:b?.summary||"Deine Antwort wurde analysiert."})]})]}),b?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(ve,{score:b.scores.content,label:"Inhalt"}),e.jsx(ve,{score:b.scores.structure,label:"Struktur"}),e.jsx(ve,{score:b.scores.relevance,label:"Relevanz"})]}),e.jsx(ie,{title:"Transkript",icon:he,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),c&&e.jsx(ie,{title:"Deine Aufnahme",icon:Et,defaultOpen:!0,children:e.jsx(as,{audioUrl:c})}),b?.strengths?.length>0&&e.jsx(ie,{title:"StÃ¤rken",icon:ct,defaultOpen:!0,children:b.strengths.map((p,m)=>e.jsx(Be,{text:p,type:"strength"},m))}),b?.improvements?.length>0&&e.jsx(ie,{title:"Verbesserungen",icon:dt,defaultOpen:!0,children:b.improvements.map((p,m)=>e.jsx(Be,{text:p,type:"improvement"},m))}),b?.tips?.length>0&&e.jsx(ie,{title:"Tipps",icon:Z,defaultOpen:!1,children:b.tips.map((p,m)=>e.jsx(Be,{text:p,type:"tip"},m))}),o&&e.jsx(ie,{title:"Sprechanalyse",icon:Q,defaultOpen:!1,children:e.jsx(rs,{metrics:o})}),!w&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[r&&e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:_?x:s,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(De,{className:"w-4 h-4"})]})})]})]})},is=({tips:t,primaryAccent:a,tipsLabel:o,branding:c})=>{const r=ce(),s=c||r,[x,_]=n.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:s.cardBg,borderRadius:s.radius.xl,border:`1px solid ${s.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>_(!x),style:{width:"100%",padding:`${s.space[4]} ${s.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:s.space[2],fontSize:s.fontSize.base,fontWeight:s.fontWeight.semibold,color:s.textMain},children:[e.jsx(Z,{size:s.iconSize.md,color:a}),o||"Tipps fÃ¼r diese Frage"]}),e.jsx(Ee,{size:s.iconSize.md,color:s.textMuted,style:{transform:x?"rotate(180deg)":"none",transition:s.transition.normal}})]}),e.jsx(Tt,{children:x&&e.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${s.space[6]} ${s.space[6]}`},children:t.map((w,b)=>e.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.md,backgroundColor:s.warningLight,marginBottom:b<t.length-1?s.space[2]:0},children:[e.jsx(Z,{style:{width:s.iconSize.sm,height:s.iconSize.sm,color:s.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:s.textSecondary,margin:0,lineHeight:1.5},children:w.replace(/^Tipp \d+:\s*/i,"")})]},b))})})})]})},os=({seconds:t,maxSeconds:a,isRecording:o,branding:c})=>{const r=ce(),s=c||r,x=a>0?t/a*100:0,_=x>75,w=x>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.lg,backgroundColor:w?s.errorLight:_?s.warningLight:s.cardBgHover},children:[e.jsx(X,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:w?s.error:_?s.warning:s.textSecondary}}),e.jsx("span",{style:{fontSize:s.fontSize.xl,fontWeight:s.fontWeight.semibold,fontFamily:"monospace",color:w?s.error:_?s.warning:s.textSecondary},children:_e(t)}),e.jsxs("span",{style:{fontSize:s.fontSize.base,color:s.textMuted},children:["/ ",_e(a)]})]})},st=({onRecordingComplete:t,timeLimit:a,disabled:o,deviceId:c,themedGradient:r,primaryAccent:s,isSubmitting:x,labels:_,onOpenSettings:w,branding:b,isMobile:p,onStreamChange:m})=>{const M=ce(),j=b||M,[l,N]=n.useState("idle"),[S,$]=n.useState(0),[L,d]=n.useState(0),[g,i]=n.useState(!1),y=n.useRef(null),f=n.useRef([]),k=n.useRef(null),z=n.useRef(null),I=n.useRef(null),E=n.useRef(null),D=n.useRef(null),h=n.useRef(0),u=n.useRef(!1);n.useEffect(()=>()=>{v()},[]),n.useEffect(()=>{l==="recording"&&S>=a&&O()},[S,a,l]);const v=()=>{k.current&&clearInterval(k.current),E.current&&cancelAnimationFrame(E.current),z.current&&(z.current.close(),z.current=null),D.current&&(D.current.getTracks().forEach(R=>R.stop()),D.current=null,m&&m(null))},F=async()=>{try{i(!1),f.current=[],$(0);let R;const ne={audio:c?{deviceId:{exact:c}}:!0};try{R=await navigator.mediaDevices.getUserMedia(ne)}catch(q){throw console.error("[SIMULATOR] Selected device unavailable:",q),q.name==="OverconstrainedError"||q.name==="NotFoundError"?(i(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):q}D.current=R,m&&m(R),z.current=new(window.AudioContext||window.webkitAudioContext),I.current=z.current.createAnalyser(),z.current.createMediaStreamSource(R).connect(I.current),I.current.fftSize=256;const de=()=>{if(I.current&&u.current){const q=new Uint8Array(I.current.frequencyBinCount);I.current.getByteFrequencyData(q);const Me=q.reduce((re,Fe)=>re+Fe)/q.length;d(Me/255)}E.current=requestAnimationFrame(de)};u.current=!0,de();const K=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";y.current=new MediaRecorder(R,{mimeType:K}),y.current.ondataavailable=q=>{q.data.size>0&&f.current.push(q.data)},y.current.onstop=()=>{const q=new Blob(f.current,{type:K});t(q,h.current)},y.current.start(1e3),N("recording"),k.current=setInterval(()=>{$(q=>q+1)},1e3)}catch(R){console.error("Error starting recording:",R),(R.name==="NotAllowedError"||R.name==="PermissionDeniedError")&&i(!0)}},T=()=>{y.current&&y.current.state==="recording"&&(y.current.pause(),N("paused"),u.current=!1,k.current&&(clearInterval(k.current),k.current=null),d(0))},C=()=>{y.current&&y.current.state==="paused"&&(y.current.resume(),N("recording"),u.current=!0,k.current=setInterval(()=>{$(R=>R+1)},1e3))},O=()=>{h.current=S,u.current=!1,k.current&&(clearInterval(k.current),k.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),z.current&&(z.current.close(),z.current=null),y.current&&y.current.state!=="inactive"&&y.current.stop(),D.current&&(D.current.getTracks().forEach(R=>R.stop()),D.current=null),N("idle"),d(0),$(0)},B=()=>{l==="idle"?F():l==="recording"?T():l==="paused"&&C()};if(g)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:j.errorLight},children:[e.jsx(It,{className:"w-12 h-12 mb-3 mx-auto",style:{color:j.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:j.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:j.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const se=()=>{const R={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:p?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:p?"15px":"16px",fontWeight:600,cursor:o||x?"not-allowed":"pointer",flex:p?1:"none"};return o||x?{...R,background:j.borderColor,boxShadow:"none"}:l==="idle"?{...R,background:j.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:l==="recording"?{...R,background:j.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...R,background:j.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:j.cardBg,border:`1px solid ${j.borderColor}`},children:[p&&e.jsx("button",{onClick:w,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:j.cardBgHover,border:`1px solid ${j.borderColor}`},children:e.jsx(Oe,{size:18,style:{color:j.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(os,{seconds:S,maxSeconds:a,isRecording:l==="recording",branding:j})}),l==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{audioLevel:L,isActive:!0,variant:"bars",size:"sm",accentColor:s})}),l==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:j.warning},children:[e.jsx(Q,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!p&&e.jsx("button",{onClick:w,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:j.cardBgHover,border:`1px solid ${j.borderColor}`},children:e.jsx(Oe,{size:20,style:{color:j.textMuted}})}),e.jsxs("button",{onClick:B,disabled:o||x,style:se(),children:[l==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Aufnahme starten"]}),l==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),l==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(l==="recording"||l==="paused")&&e.jsxs("button",{onClick:O,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:p?"14px 16px":"14px 24px",flex:p?1:"none",backgroundColor:j.cardBgHover,color:j.textMain,fontSize:p?"15px":"16px"},children:[e.jsx(be,{className:"w-[18px] h-[18px]",style:{color:j.success}}),_?.submitButton||"Antwort abgeben"]})]}),l==="idle"&&!x&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:j.textMuted},children:_?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),x&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(We,{className:"w-8 h-8 animate-spin",style:{color:s}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:j.textSecondary},children:_?.analyzing||"Antwort wird analysiert..."})]})]})},nt={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Ve,info:ge,settings:Oe,check:be,Target:te,Clock:X,Mic:Q,MessageSquare:he,Lightbulb:Z,Brain:Ve},cs=({scenario:t,variables:a,questions:o,onStart:c,onBack:r,selectedMicrophoneId:s,onMicrophoneChange:x,onMicrophoneTest:_,themedGradient:w,primaryAccent:b,primaryAccentLight:p,isLoading:m,branding:M})=>{const j=ce(),l=M||j,N=t?.mode==="SIMULATION",S=N?"Situationen":"Fragen",$=N?"Zeit pro Situation":"Zeit pro Frage",L=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${N?"Situation":"Frage"}. ${N?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:Q,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:he,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],d=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((f,k)=>typeof f=="string"?{icon:Z,title:`Tipp ${k+1}`,description:f}:{icon:nt[f.icon]||nt[f.icon?.toLowerCase()]||Z,title:f.title||`Tipp ${k+1}`,description:f.text||f.description||""}):L,g=n.useMemo(()=>{if(!t?.input_configuration)return{};try{const f=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(f)?f.reduce((k,z)=>(z.key&&z.label&&(k[z.key]=z.label),k),{}):{}}catch{return{}}},[t?.input_configuration]),i=a?Object.entries(a).filter(([f,k])=>k&&k.trim&&k.trim()!=="").map(([f,k])=>({label:g[f]||f.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase()),value:k})):[],y=f=>{if(!f||!a)return f;let k=f;return Object.entries(a).forEach(([z,I])=>{I&&(k=k.replace(new RegExp(`\\$\\{${z}\\}`,"g"),I),k=k.replace(new RegExp(`\\{${z}\\}`,"g"),I))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:l.textSecondary},children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:w},children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:l.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:l.textSecondary},children:[t.title,o.length>0?` â€¢ ${o.length} ${S}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:w},children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:l.textMain},children:"Deine Aufgabe"}),e.jsx("p",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:l.textSecondary},children:y(t.long_description?.replace(/\/n/g,`
`))})]})]})}),i.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:p},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:b},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:i.map((f,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:f.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:l.textMain},children:f.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px]",style:{color:b}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:l.textMain},children:"Mikrofon testen"})]}),e.jsx(pt,{selectedDeviceId:s,onDeviceChange:x,onTestClick:_})]}),e.jsxs("button",{onClick:c,disabled:m,className:"w-full py-[18px] px-7 rounded-[14px] border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 transition-all",style:{background:m?l.borderColor:w,boxShadow:m?"none":`0 4px 12px ${b}4d`,cursor:m?"not-allowed":"pointer"},children:[e.jsx(Ke,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(Z,{className:"w-[22px] h-[22px]",style:{color:l.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:l.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:d.map((f,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:l.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:p},children:e.jsx(f.icon,{className:"w-[22px] h-[22px]",style:{color:b}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:l.textMain},children:f.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:l.textSecondary},children:f.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:l.cardBgHover},children:[o.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:S}),e.jsx("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:o.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:$}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},ds=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,totalCount:r,labels:s})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(xt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),c>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:s.answeredCount(c,r)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",s.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",s.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,us=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,labels:r})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(pe,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",c>0?` (${c} ${r.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,xs=({number:t,size:a="md"})=>{const o={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${o[a]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},Le=({question:t,index:a,labels:o,isMobile:c})=>e.jsxs(ke,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(xs,{number:a+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||o.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||o.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:c?14:16}),o.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),rt=({error:t,onRetry:a,isMobile:o})=>e.jsxs("div",{className:`flex flex-col items-center ${o?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(pe,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(oe,{variant:"danger",size:"sm",onClick:a,className:"mt-3",children:"Erneut versuchen"})]}),ms=({session:t,questions:a,scenario:o,variables:c,preloadedQuestions:r,onSessionCreated:s,onComplete:x,onExit:_,startFromQuestion:w=0,initialMicrophoneId:b})=>{const p=Gt(),[m,M]=n.useState(t),[j,l]=n.useState(a||[]),[N,S]=n.useState(!1),[$,L]=n.useState(null),{demoCode:d,branding:g}=ht(),i=o?.mode==="SIMULATION",y={questionLabel:i?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:i?"Situation":"Frage",questionLoading:i?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:i?"Deine Reaktion...":"Deine Antwort...",submitButton:i?"Reaktion abgeben":"Antwort abgeben",submitHint:i?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:i?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,V)=>i?`Situation ${A} von ${V}`:`Frage ${A} von ${V}`,questionsCount:A=>i?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,V)=>i?`${A} von ${V} Situationen`:`${A} von ${V} Fragen`,tipsLabel:i?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:i?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:i?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:i?"Situationen":"Fragen",recommendedTime:i?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},f=w>0,k=f?Array.from({length:w},(A,V)=>V):[],[z,I]=n.useState(f?"interview":"preparation"),[E,D]=n.useState(w||m?.current_question_index||0),[h,u]=n.useState(null),[v,F]=n.useState(!1),[T,C]=n.useState(!1),[O,B]=n.useState(null),[se,R]=n.useState([]),[ne,Ge]=n.useState(k),de="karriereheld_selected_microphone",[K,q]=n.useState(()=>{if(b)return b;try{return localStorage.getItem(de)||null}catch{return null}}),[Me,re]=n.useState(!1),[Fe,ue]=n.useState(!1),fe=n.useRef(null),je=n.useCallback(()=>{fe.current&&(fe.current.getTracks().forEach(A=>A.stop()),fe.current=null)},[]),Qe=n.useCallback(A=>{fe.current=A},[]);n.useEffect(()=>()=>{je()},[je]),n.useEffect(()=>{if(K)try{localStorage.setItem(de,K)}catch{}},[K]);const[ft,$e]=n.useState(!1),[jt,Te]=n.useState(!1),[ye,Ue]=n.useState(!1),[xe,we]=n.useState(null),[H,He]=n.useState(!1),J=j[E],ae=E===j.length-1,Je=E===0,Xe=async(A,V)=>{if(V<2){B("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),B("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}C(!0),B(null);try{const P=await U.submitSimulatorAnswer(m.id,A,E,J.question,J.category,V);if(!P.success)throw new Error(P.message||"Fehler beim Analysieren der Antwort");if(u(P.data),F(!0),R(G=>[...G.filter(Y=>Y.questionIndex!==E),{questionIndex:E,feedback:P.data}]),Ge(G=>G.includes(E)?G:[...G,E]),i&&!H){Ue(!0),we(null);const G=ne.includes(E);try{const Y=await U.generateNextTurn(m.id);if(Y.success){const le=Y.data.next_question;Y.data.is_finished?(we(le),l(G?ee=>{const me=[...ee];return me[E+1]=le,me.slice(0,E+2)}:ee=>[...ee,le]),He(!0)):(we(le),G?(l(ee=>{const me=[...ee];return me[E+1]=le,me.slice(0,E+2)}),He(!1)):l(ee=>[...ee,le]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{Ue(!1)}}}catch(P){console.error("Error submitting answer:",P),B(P.message||"Ein Fehler ist aufgetreten")}finally{C(!1)}},Re=()=>{u(null),F(!1),B(null)},Ie=()=>{if(u(null),F(!1),B(null),i){if(xe){D(A=>A+1),we(null);return}if(H){Ne();return}}else ae||D(A=>A+1)},yt=()=>{u(null),F(!1),B(null),Je||D(A=>A-1)},wt=()=>{$e(!0)},Ne=async()=>{$e(!1),ue(!1),re(!1),je();try{const A=await U.completeSimulatorSession(m.id);A.success?x(A.data):x({session:{...m,status:"completed"}})}catch(A){console.error("Error completing session:",A),x({session:{...m,status:"completed"}})}},Nt=()=>{Te(!0)},vt=()=>{Te(!1),ue(!1),re(!1),je(),_()},St=async()=>{if(m&&j.length>0){I("interview");return}S(!0),L(null);try{const A=await U.createSimulatorSession({scenario_id:o.id,variables:c,demo_code:d||null,questions:r||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const V=A.data.session;let P;if(r&&r.length>0)P=r,await U.updateSimulatorSessionQuestions(V.id,P);else{const G=await U.generateSimulatorQuestions(V.id);if(!G.success)throw new Error(G.message||"Fehler beim Generieren der Fragen");P=G.data.questions}M({...V,questions_json:P}),l(P),s&&s({session:{...V,questions_json:P},questions:P,selectedMicrophoneId:K}),I("interview")}catch(A){console.error("Error creating session:",A),L(A.message||"Ein Fehler ist aufgetreten")}finally{S(!1)}};if(z==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(cs,{scenario:o,variables:c,questions:j,onStart:St,onBack:_,selectedMicrophoneId:K,onMicrophoneChange:q,onMicrophoneTest:()=>re(!0),themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],primaryAccentLight:g?.["--primary-accent-light"],isLoading:N}),e.jsx(gt,{isOpen:Me,onClose:()=>re(!1),deviceId:K}),$&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:$}),e.jsx(bt,{isLoading:N,message:i?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const kt=v&&(i&&H&&!xe||!i&&ae);return e.jsxs("div",{className:`${p?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${p?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${p?"text-lg":"text-xl"} font-semibold text-slate-900`,children:o?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${p?"justify-between":"justify-end"}`,children:[!kt&&e.jsxs("button",{onClick:wt,className:`${p?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(xt,{size:16}),p?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:Nt,className:`${p?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Lt,{size:16}),"Abbrechen"]})]})]}),e.jsx(ds,{isOpen:ft,onClose:()=>$e(!1),onConfirm:Ne,answeredCount:ne.length,totalCount:j.length,labels:y}),e.jsx(us,{isOpen:jt,onClose:()=>Te(!1),onConfirm:vt,answeredCount:ne.length,labels:y}),!v&&!i&&e.jsxs("div",{className:`flex ${p?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(oe,{variant:"secondary",size:p?"sm":"md",icon:e.jsx(qt,{size:16}),onClick:yt,disabled:Je,className:p?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(oe,{variant:"secondary",size:p?"sm":"md",iconPosition:"right",icon:e.jsx(De,{size:16}),onClick:Ie,disabled:ae,className:p?"flex-1":"",children:p?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Qt,{current:E,total:j.length,answeredQuestions:ne,primaryAccent:g?.["--primary-accent"],labels:y}),v?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[o.allow_retry&&e.jsx(oe,{variant:"secondary",icon:e.jsx(Ze,{size:16}),onClick:Re,children:"Nochmal versuchen"}),e.jsxs(oe,{onClick:i?H&&!xe?Ne:Ie:ae?Ne:Ie,disabled:i&&ye&&!H,icon:ye?e.jsx(We,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[i&&ye&&!H?"GesprÃ¤chspartner tippt...":i?H&&!xe?"Training abschlieÃŸen":y.nextButton:ae?"Training abschlieÃŸen":y.nextButton,!ye&&!(i?H&&!xe:ae)&&e.jsx(De,{size:16,className:"ml-1"})]})]}),e.jsx(Le,{question:J,index:E,labels:y,isMobile:p}),e.jsx("div",{className:"mt-4",children:e.jsx(ls,{transcript:h.transcript,feedback:h.feedback,audioMetrics:h.audio_analysis,audioUrl:h.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${p?"gap-4":"gap-6"}`,children:[p?e.jsxs(e.Fragment,{children:[e.jsx(Le,{question:J,index:E,labels:y,isMobile:!0}),e.jsx(st,{onRecordingComplete:Xe,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],isSubmitting:T,labels:y,onOpenSettings:()=>ue(!0),isMobile:!0,onStreamChange:Qe}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(st,{onRecordingComplete:Xe,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],isSubmitting:T,labels:y,onOpenSettings:()=>ue(!0),isMobile:!1,onStreamChange:Qe}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!1})]}),e.jsx(Le,{question:J,index:E,labels:y,isMobile:!1})]}),J?.tips&&J.tips.length>0&&e.jsx(is,{tips:J.tips,primaryAccent:g?.["--primary-accent"],tipsLabel:y.tipsLabel})]}),e.jsx(Ht,{isOpen:Fe,onClose:()=>ue(!1),mode:"audio",selectedMicrophoneId:K,onMicrophoneChange:q})]})},Se=({score:t,label:a,primaryAccent:o,b:c})=>{const r=t!=null?t*10:null,s=Wt(r,o);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:s},children:r!=null?Math.round(r):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:a})]})},qe=({icon:t,value:a,label:o,primaryAccent:c,b:r})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:c}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:a}),e.jsx("div",{className:"text-xs text-slate-500",children:o})]})]}),hs=({session:t,scenario:a,onBackToDashboard:o,onStartNew:c})=>{const r=ce(),s=t.summary_feedback||t.summary_feedback_json,x=s?typeof s=="string"?JSON.parse(s):s:null,_=t.overall_score||x?.overall_score||0,w=_<=10?_*10:_,p=(m=>m>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:m>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:m>=70?{text:"Gut!",emoji:"ðŸ‘"}:m>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:m>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(w);return e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:r.headerGradient,boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:e.jsx(ut,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",p.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[a?.title||"Skill Training"," - ",p.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${r.primaryAccent}`,backgroundColor:r.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:r.primaryAccent},children:w?Math.round(w):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:w?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(qe,{icon:be,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),e.jsx(qe,{icon:te,value:x?.average_content_score?Math.round(x.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(qe,{icon:Dt,value:x?.average_delivery_score?Math.round(x.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),x?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Se,{score:x.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:x.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:x.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:x.scores.delivery,label:"PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),x?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:x.summary})]}),x?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:x.key_takeaways.map((m,M)=>e.jsx("li",{className:"mb-2",children:m},M))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-none text-white text-base font-semibold cursor-pointer transition-all hover:-translate-y-0.5",style:{background:r.buttonGradient,boxShadow:`0 4px 12px ${r.primaryAccent}4d`},children:[e.jsx(Ze,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})},W={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Ts=({isAuthenticated:t,requireAuth:a,setPendingAction:o,pendingContinueSession:c,clearPendingContinueSession:r,pendingRepeatSession:s,clearPendingRepeatSession:x,onNavigateToHistory:_})=>{const[w,b]=n.useState(W.DASHBOARD),[p,m]=n.useState(null),[M,j]=n.useState(null),[l,N]=n.useState([]),[S,$]=n.useState({}),[L,d]=n.useState(null),[g,i]=n.useState(null),[y,f]=n.useState(null),[k,z]=n.useState(0);n.useEffect(()=>{y&&t&&(m(y),b(W.VARIABLES),f(null))},[y,t]),n.useEffect(()=>{if(c&&t){const{session:C,scenario:O}=c,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[],R=C.completed_questions||C.answered_count||0;m(O||{id:C.scenario_id,title:C.scenario_title}),j(C),N(se),$({}),z(R),b(W.SESSION),r&&r()}},[c,t,r]),n.useEffect(()=>{if(s&&t){const{session:C,scenario:O}=s,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[];m(O||{id:C.scenario_id,title:C.scenario_title}),N(se),$({}),z(0),b(W.SESSION),x&&x()}},[s,t,x]),n.useEffect(()=>{window.scrollTo(0,0)},[w]);const I=n.useCallback(C=>{m(C),b(W.VARIABLES)},[]),E=n.useCallback(()=>{m(null),j(null),N([]),$({}),d(null),z(0),i(null),b(W.DASHBOARD)},[]),D=n.useCallback(C=>{$(C),b(W.SESSION)},[]),h=n.useCallback(C=>{j(C.session),N(C.questions),C.selectedMicrophoneId&&i(C.selectedMicrophoneId)},[]),u=n.useCallback(C=>{d(C.session),b(W.COMPLETE)},[]),v=n.useCallback(()=>{E()},[E]),F=n.useCallback(()=>{j(null),N([]),d(null),z(0),i(null),b(W.VARIABLES)},[]),T=()=>{switch(w){case W.DASHBOARD:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:f,onNavigateToHistory:_});case W.VARIABLES:return e.jsx(ns,{scenario:p,onBack:E,onNext:D});case W.SESSION:return e.jsx(ms,{session:M,questions:l,scenario:p,variables:S,preloadedQuestions:l.length>0?l:null,onSessionCreated:h,onComplete:u,onExit:v,startFromQuestion:k,initialMicrophoneId:g});case W.COMPLETE:return e.jsx(hs,{session:L,scenario:p,onBackToDashboard:E,onStartNew:F});default:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:f,onNavigateToHistory:_})}};return e.jsx("div",{className:"min-h-full",children:T()})},at={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Ve,info:ge,check:be,sparkles:Ae},ps=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:Q,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Rs=({scenario:t,onBack:a,onStart:o,preloadedQuestions:c})=>{const[r,s]=n.useState({}),[x,_]=n.useState({}),[w,b]=n.useState(!1),[p,m]=n.useState(null),[M,j]=n.useState(null),[l,N]=n.useState(!1),[S,$]=n.useState([]),[L,d]=n.useState(!1),{demoCode:g}=ht(),i=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const h=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(h)?h.filter(u=>u.user_input!==!1):[]}catch(h){return console.error("Error parsing input_configuration:",h),[]}},[t?.input_configuration]);n.useEffect(()=>{const h={};i.forEach(u=>{u.default&&(h[u.key]=u.default)}),s(h)},[i]);const y=(h,u)=>{if(!h)return h;let v=h;return Object.entries(u||{}).forEach(([F,T])=>{T&&(v=v.replace(new RegExp(`\\$\\{${F}\\}`,"g"),T),v=v.replace(new RegExp(`\\{${F}\\}`,"g"),T))}),v},f=(h,u)=>{s(v=>({...v,[h]:u})),x[h]&&_(v=>{const F={...v};return delete F[h],F})},k=()=>{$(h=>[...h,{key:"",value:""}])},z=(h,u,v)=>{$(F=>{const T=[...F];return T[h]={...T[h],[u]:v},T})},I=h=>{$(u=>u.filter((v,F)=>F!==h))},E=()=>{const h={};return i.forEach(u=>{const v=r[u.key];if(u.required&&(!v||v.trim()==="")){h[u.key]="Dieses Feld ist erforderlich";return}if(!(!v||v.trim()==="")&&u.validation){const{minLength:F,maxLength:T,min:C,max:O,pattern:B}=u.validation;F&&v.length<F&&(h[u.key]=`Mindestens ${F} Zeichen erforderlich`),T&&v.length>T&&(h[u.key]=`Maximal ${T} Zeichen erlaubt`),C!==void 0&&Number(v)<C&&(h[u.key]=`Mindestens ${C}`),O!==void 0&&Number(v)>O&&(h[u.key]=`Maximal ${O}`),B&&!new RegExp(B).test(v)&&(h[u.key]="UngÃ¼ltiges Format")}}),_(h),Object.keys(h).length===0},D=async h=>{if(h.preventDefault(),m(null),!!E()){b(!0);try{const u={...r};S.forEach(C=>{C.key&&C.value&&(u[C.key]=C.value)});const v=await U.createSimulatorSession({scenario_id:t.id,variables:u,demo_code:g||null,questions:c||null});if(!v.success)throw new Error(v.message||"Fehler beim Erstellen der Session");const F=v.data.session;let T;if(c&&c.length>0)T=c,await U.updateSimulatorSessionQuestions(F.id,T);else{const C=await U.generateSimulatorQuestions(F.id);if(!C.success)throw new Error(C.message||"Fehler beim Generieren der Fragen");T=C.data.questions}o({session:{...F,questions_json:T},questions:T,scenario:t,variables:u,selectedMicrophoneId:M})}catch(u){console.error("Error starting session:",u),m(u.message||"Ein Fehler ist aufgetreten")}finally{b(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ke,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:y(t.long_description?.replace(/\/n/g,`
`),r)})]})]})}),(()=>{const h=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((u,v)=>typeof u=="string"?{icon:Z,title:`Tipp ${v+1}`,description:u}:{icon:at[u.icon]||at[u.icon?.toLowerCase()]||Z,title:u.title||`Tipp ${v+1}`,description:u.text||u.description||""}):ps;return e.jsxs(ke,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:h.map((u,v)=>{const F=u.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(F,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:u.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:u.description})]})]},v)})})]})})(),e.jsxs("form",{onSubmit:D,children:[i.length>0?i.map(h=>e.jsx(Jt,{field:h,value:r[h.key],onChange:f,error:x[h.key]},h.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(be,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>d(!L),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${L?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[L?e.jsx(Pe,{size:18}):e.jsx(Ee,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),L&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),S.length>0&&e.jsx("div",{className:"mb-3",children:S.map((h,u)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:h.key||"",onChange:v=>z(u,"key",v.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>I(u),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(it,{size:18})})]}),e.jsx("textarea",{value:h.value||"",onChange:v=>z(u,"value",v.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},u))}),e.jsxs("button",{type:"button",onClick:k,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ke,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(pt,{selectedDeviceId:M,onDeviceChange:j,onTestClick:()=>N(!0)})]}),p&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(pe,{className:"w-[18px] h-[18px]"}),p]}),e.jsx(oe,{type:"submit",disabled:w,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(ot,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(gt,{isOpen:l,onClose:()=>N(!1),deviceId:M}),e.jsx(bt,{isLoading:w,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{us as CancelConfirmDialog,ds as CompleteConfirmDialog,ls as ImmediateFeedback,cs as PreSessionView,is as QuestionTips,hs as SessionComplete,os as SessionTimer,Ts as SimulatorApp,st as SimulatorAudioRecorder,tt as SimulatorDashboard,ms as SimulatorSession,Rs as SimulatorWizard};
