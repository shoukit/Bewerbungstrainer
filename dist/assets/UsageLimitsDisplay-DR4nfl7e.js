import{j as e,L as G,z as x,t as L,P as p,m as h,A as z,u as E,i as U,g as S,Q as T}from"./ui-vendor-CgXEyNXi.js";import{a as n}from"./react-vendor-uDOJF2jQ.js";import{B as N}from"./button-DNbs8NG8.js";import{u as K,D as u,C as i,w as P}from"./FeatureInfoButton-BWFu44hS.js";const I=({onNavigateToRoleplay:f,compact:C=!1})=>{const{branding:l,demoCode:b}=K(),[D,y]=n.useState(!0),[v,w]=n.useState(null),[s,M]=n.useState(null),a=n.useMemo(()=>{const t=l?.["--header-gradient"]||u["--header-gradient"],r=l?.["--header-text"]||u["--header-text"],c=l?.["--primary-accent"]||u["--primary-accent"],A=l?.["--primary-accent-light"]||u["--primary-accent-light"];return{headerGradient:t,headerText:r,primaryAccent:c,primaryAccentLight:A}},[l]),j=async()=>{try{y(!0),w(null);const t=await P.getUsageLimits(b);M(t)}catch(t){console.error("[UsageLimits] Error fetching usage data:",t),w(t.message||"Fehler beim Laden der Nutzungsdaten")}finally{y(!1)}};n.useEffect(()=>{j()},[b]);const g=n.useMemo(()=>!s||s.monthly_limit===0?0:Math.min(100,s.used_minutes/s.monthly_limit*100),[s]),_=(t,r)=>{const c=t/r*100;return c<=0?i.red[500]:c<=20?i.amber[500]:c<=50?i.yellow[500]:i.green[500]},d=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",m=t=>t==null?"0 Min.":`${Math.round(t*10)/10} Min.`;if(D)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(G,{className:"w-8 h-8 animate-spin text-slate-400"})});if(v)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:v})}),e.jsxs(N,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(C){const t=_(s?.remaining_minutes||0,s?.monthly_limit||10),r=s?.has_minutes!==!1;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:f,title:r?"Live-Gespräch starten":"Keine Minuten mehr verfügbar",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:a.headerGradient},children:e.jsx(p,{className:"w-5 h-5",style:{color:a.headerText}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gespräche"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg",style:{color:t},children:m(s?.remaining_minutes||0)}),e.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",s?.monthly_limit||10," Min."]})]})]}),!r&&e.jsx(x,{className:"w-5 h-5 text-red-500"})]}),e.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${g}%`,background:t}})})]})}const k=_(s?.remaining_minutes||0,s?.monthly_limit||10),o=s?.has_minutes!==!1;return e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4",style:{background:a.headerGradient},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6",style:{color:a.headerText}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:a.headerText},children:"Live-Gespräche"}),e.jsx("p",{className:"text-sm opacity-80",style:{color:a.headerText},children:"Monatliches Kontingent"})]})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:j,className:"text-white hover:bg-white/10",children:e.jsx(L,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:i.slate[200],strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:k,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-g)*2.827} 282.7`,className:"transition-all duration-500"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-3xl font-bold",style:{color:k},children:m(s?.remaining_minutes||0)}),e.jsx("span",{className:"text-sm text-slate-500",children:"verfügbar"})]})]})}),e.jsx(z,{mode:"wait",children:o?g>80?e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),e.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",m(s?.remaining_minutes)," weise."]})]})]})},"low-minutes"):e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfügbar"}),e.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gespräch zum Üben."})]})]})},"ok"):e.jsx(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),e.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",d(s?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),e.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[s?.monthly_limit||10," Min."]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),e.jsx("span",{className:"text-lg font-bold text-slate-700",children:m(s?.used_minutes||0)})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:d(s?.next_reset)})]})]}),e.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",d(s?.period_start)," - ",d(s?.period_end)]}),f&&e.jsxs(N,{onClick:f,disabled:!o,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:o?a.headerGradient:i.slate[400],color:a.headerText},children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),o?"Live-Gespräch starten":"Keine Minuten verfügbar"]}),s?.is_demo_user&&s?.demo_code&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",e.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:s.demo_code})]})})]})]})};export{I as default};
