import{F as G,Q as ie,aE as ee,s as je,aF as ye,aG as we,aH as Ne,aI as ve,aJ as ke,t as Ce,L as B,u as Se,T as _e,I as ze,X as le,b as oe,aK as Ee,ah as q,Y as D,aL as Pe,aM as Ae,aN as Be,aO as Ie,g as Le,aP as Me,P as $e,aQ as De,M as Fe,ad as Te,ag as Oe,Z as Ue,aR as Re,aS as Ge,aT as He,i as qe,aU as Je,J as Ke,aA as ce,E as Ve,a3 as We,a8 as Qe,e as Ze,V as Ye,a as te,_ as de,R as me,c as Xe,S as et,z as xe,a2 as tt,ax as st,ay as nt,a1 as at,l as rt,at as he,x as it,U as ue,am as pe,r as ge,j as e,w as ae,$ as lt,y as se,C as ne,A as be,m as X,aV as ot,aW as ct,aC as dt,a0 as mt,h as xt}from"./ui-vendor-4RzMPcHM.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{u as ht,w as $,n as ut}from"./FeatureInfoButton-DkKoIptM.js";import{u as pt}from"./useMobile-YxjH166V.js";import{C as K,B as R}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const gt={"file-text":G,briefcase:ge,banknote:pe,users:ue,user:it,"message-circle":he,target:rt,award:at,book:nt,clipboard:st,star:tt,lightbulb:xe,shield:et,compass:Xe,rocket:me,calendar:de,sparkles:te,video:Ye,mic:Ze,play:Qe,"check-circle":We,"alert-circle":Ve,"help-circle":ce,settings:Ke,home:Je,"trending-up":qe,"bar-chart":He,"pie-chart":Ge,activity:Re,zap:Ue,heart:Oe,"thumbs-up":Te,"message-square":Fe,mail:De,phone:$e,"map-pin":Me,clock:Le,bell:Ie,search:Be,filter:Ae,edit:Pe,trash:D,plus:q,minus:Ee,check:oe,x:le,info:ze,warning:_e,refresh:Se,loader:B,globe:Ce,link:ke,bookmark:ve,tag:Ne,code:we,database:ye,server:je,pen:ee,bot:ie},bt={"file-text":G,briefcase:ge,banknote:pe,users:ue},ft=(t,s=G)=>gt[t]||s,Lt=t=>bt[t]||G,jt=t=>{if(!t)return[];const s=t.split(`
`),i=[];for(const m of s){const x=m.trim(),n=x.match(/^[\*\-â€¢]\s+(.+)$/),p=x.match(/^\d+[\.\)]\s+(.+)$/);let c=null;if(n?c=n[1].trim():p&&(c=p[1].trim()),c){const h=c.match(/^\*\*([^*]+)\*\*:?\s*(.*)$/);if(h)i.push({label:h[1].trim(),content:h[2].trim()||""});else{const g=c.split(/[.!?]/)[0];i.push({label:g.length>50?g.substring(0,50)+"...":g,content:c})}}}return i},yt={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},wt=t=>yt[t]||t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),J=t=>{if(!t)return null;const s=[];let i=t,m=0;for(;i.length>0;){const x=i.match(/\*\*(.+?)\*\*/),n=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),p=i.match(/`([^`]+)`/),c=[{match:x,type:"bold"},{match:n,type:"italic"},{match:p,type:"code"}].filter(g=>g.match);if(c.length===0){s.push(i);break}const h=c.reduce((g,l)=>(g.match?.index??1/0)<(l.match?.index??1/0)?g:l);switch(h.match.index>0&&s.push(i.substring(0,h.match.index)),h.type){case"bold":s.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:h.match[1]},m++));break;case"italic":s.push(e.jsx("em",{className:"italic",children:h.match[1]||h.match[2]},m++));break;case"code":s.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:h.match[1]},m++));break}i=i.substring(h.match.index+h.match[0].length)}return s},fe=({content:t})=>{if(!t)return null;const s=i=>{const m=i.split(`
`),x=[];let n=[],p=null;const c=()=>{n.length>0&&(x.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:n.map((h,g)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:p==="number"?`${g+1}.`:"â€¢"}),J(h)]},g))},`list-${x.length}`)),n=[],p=null)};return m.forEach((h,g)=>{const l=h.trim();if(!l){c();return}if(l.startsWith("- ")||l.startsWith("* ")){p!=="bullet"&&(c(),p="bullet"),n.push(l.substring(2));return}const k=l.match(/^(\d+)\.\s/);if(k){p!=="number"&&(c(),p="number"),n.push(l.substring(k[0].length));return}c(),x.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:J(l)},`p-${g}`))}),c(),x};return e.jsx("div",{children:s(t)})},Nt=({item:t,onRestore:s})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:t.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(mt,{size:12}),"Wiederherstellen"]})]}),vt=({explanation:t,onDelete:s,onAddAsItem:i,onAddActionPoint:m,itemLabel:x})=>{const[n,p]=o.useState(!0),c=jt(t.answer),h=()=>{if(t.quick_action)switch(t.quick_action){case"explain":return"ðŸ’¡ ErklÃ¤rung";case"examples":return"ðŸ“ Beispiele";case"howto":return"ðŸš€ Umsetzung";default:return"Frage"}return`â“ ${t.question}`},g=t.answer?.length>100?t.answer.substring(0,100)+"...":t.answer;return e.jsxs("div",{className:"bg-white rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>p(!n),className:"w-full px-3 py-2.5 bg-transparent border-none cursor-pointer flex items-center gap-2 text-left hover:bg-amber-50/50 transition-colors",children:[e.jsx(xt,{size:14,className:`text-amber-600 transition-transform flex-shrink-0 ${n?"rotate-90":""}`}),e.jsx("span",{className:"text-[12px] font-medium text-amber-700 flex-1 truncate",children:h()}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:l=>l.stopPropagation(),children:[i&&e.jsx("button",{onClick:l=>{l.stopPropagation(),i(t.answer,x)},title:"Gesamten Block als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(q,{size:14})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),s(t.id)},title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(le,{size:14})})]})]}),!n&&e.jsx("div",{className:"px-3 pb-2.5 pt-0",children:e.jsx("p",{className:"text-[12px] text-slate-500 m-0 line-clamp-2",children:g})}),e.jsx(be,{children:n&&e.jsx(X.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 border-t border-amber-100",children:[e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap mt-2.5 leading-relaxed",children:J(t.answer)}),c.length>0&&m&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-100",children:[e.jsxs("p",{className:"text-[11px] font-medium text-amber-700 mb-2 flex items-center gap-1",children:[e.jsx(q,{size:12}),"Einzelne Punkte hinzufÃ¼gen:"]}),e.jsx("div",{className:"space-y-2",children:c.map((l,k)=>e.jsx("div",{className:"p-2.5 bg-white rounded-xl border border-amber-100 hover:border-amber-200 hover:shadow-sm transition-all group",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 flex-shrink-0 mt-1.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"text-[13px] font-semibold text-slate-800 m-0 mb-0.5 leading-snug",children:l.label}),l.content&&l.content!==l.label&&e.jsx("p",{className:"text-[12px] text-slate-600 m-0 leading-snug",children:l.content.length>120?l.content.substring(0,120)+"...":l.content})]}),e.jsx("button",{onClick:()=>m(l),title:"Diesen Punkt zur Liste hinzufÃ¼gen",className:"p-1.5 rounded-lg bg-transparent border-none text-amber-600 cursor-pointer hover:text-white hover:bg-indigo-500 transition-all opacity-60 group-hover:opacity-100 flex-shrink-0",children:e.jsx(q,{size:14})})]})},k))})]})]})})})]})},re=({item:t,sectionId:s,onUpdateItem:i,onAskItem:m,onDeleteExplanation:x,onAddAsItem:n,onAddActionPoint:p})=>{const[c,h]=o.useState(t.user_note||""),[g,l]=o.useState(!1),[k,z]=o.useState(!1),[E,P]=o.useState(!1),[_,S]=o.useState(!!t.user_note),[C,I]=o.useState(!1),[u,F]=o.useState(""),[v,M]=o.useState(!1),[T,O]=o.useState(!0),L=t.ai_explanations||[];o.useEffect(()=>{P(c!==(t.user_note||""))},[c,t.user_note]);const V=async()=>{l(!0);try{await i(s,t.id,{user_note:c}),z(!0),P(!1),setTimeout(()=>z(!1),2e3)}catch(f){console.error("Error saving note:",f)}finally{l(!1)}},W=async()=>{try{await i(s,t.id,{deleted:!0})}catch(f){console.error("Error deleting item:",f)}},Q=async()=>{try{await i(s,t.id,{deleted:!1})}catch(f){console.error("Error restoring item:",f)}},U=async f=>{if(m){M(!0);try{await m(s,t.id,{quick_action:f}),O(!0)}catch(a){console.error("Error asking AI:",a)}finally{M(!1)}}},H=async()=>{if(!(!m||!u.trim())){M(!0);try{await m(s,t.id,{question:u.trim()}),F(""),O(!0)}catch(f){console.error("Error asking AI:",f)}finally{M(!1)}}},Z=async f=>{if(x)try{await x(s,t.id,f)}catch(a){console.error("Error deleting explanation:",a)}};return t.deleted?e.jsx(Nt,{item:t,onRestore:Q}):e.jsxs(K,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:t.label})]}),t.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:J(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[L.length>0&&!C&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[L.length," KI"]}),t.user_note&&!_&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{I(!C),C||S(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${C?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:()=>{S(!_),_||I(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${_?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:W,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(D,{size:16})})]})]}),C&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>U("explain"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ce,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>U("examples"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ot,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>U("howto"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(me,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:f=>F(f.target.value),onKeyDown:f=>f.key==="Enter"&&!v&&H(),placeholder:"Oder stelle eine eigene Frage...",disabled:v,className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx(R,{variant:"primary",size:"sm",onClick:H,disabled:v||!u.trim(),icon:v?e.jsx(B,{size:14,className:"animate-spin"}):e.jsx(ct,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),v&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(B,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),L.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>O(!T),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[T?e.jsx(se,{size:14}):e.jsx(ne,{size:14}),"KI-ErklÃ¤rungen (",L.length,")"]}),T&&e.jsx("div",{className:"space-y-2",children:L.map(f=>e.jsx(vt,{explanation:f,itemLabel:t.label,onDelete:Z,onAddAsItem:n?(a,r)=>n(s,a,r):null,onAddActionPoint:p?a=>p(s,a,t.label):null},f.id))})]})]}),_&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:c,onChange:f=>h(f.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(R,{variant:"secondary",size:"sm",onClick:()=>{S(!1),h(t.user_note||"")},children:"Abbrechen"}),e.jsx(R,{variant:k?"secondary":"primary",size:"sm",onClick:V,disabled:g||!E,icon:g?e.jsx(B,{size:12,className:"animate-spin"}):k?e.jsx(oe,{size:12}):e.jsx(dt,{size:12}),className:k?"bg-green-100 text-green-700 border-green-200":"",children:k?"Gespeichert!":"Speichern"})]})]})]})},kt=({onClick:t,isGenerating:s})=>e.jsx("button",{onClick:t,disabled:s,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{size:16}),"5 weitere Punkte generieren"]})}),Ct=({section:t,onUpdateItem:s,onGenerateMore:i,onAskItem:m,onDeleteExplanation:x,onAddAsItem:n,onAddActionPoint:p,isExpanded:c,onToggle:h})=>{const[g,l]=o.useState(!1),k=async()=>{l(!0);try{await i(t.id)}catch(u){console.error("Error generating more items:",u)}finally{l(!1)}},z=o.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const u=JSON.parse(t.ai_content);if(u&&Array.isArray(u.items))return{type:"items",items:u.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:E,items:P,content:_}=z(),S=P.filter(u=>!u.deleted),C=P.filter(u=>u.deleted),I=P.some(u=>u.user_note&&!u.deleted);return e.jsxs(K,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:h,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${c?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:t.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[E==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[S.length," Punkte"]}),I&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(ee,{size:12}),"Notizen"]}),c?e.jsx(se,{size:20,className:"text-slate-400"}):e.jsx(ne,{size:20,className:"text-slate-400"})]})]}),c&&e.jsx("div",{className:"px-5 py-4",children:E==="items"?e.jsxs(e.Fragment,{children:[S.map(u=>e.jsx(re,{item:u,sectionId:t.id,onUpdateItem:s,onAskItem:m,onDeleteExplanation:x,onAddAsItem:n,onAddActionPoint:p},u.id)),i&&e.jsx(kt,{onClick:k,isGenerating:g}),C.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(D,{size:12}),C.length," gelÃ¶schte ",C.length===1?"Punkt":"Punkte"]}),C.map(u=>e.jsx(re,{item:u,sectionId:t.id,onUpdateItem:s,onAskItem:m,onDeleteExplanation:x,onAddAsItem:n,onAddActionPoint:p},u.id))]})]}):E==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ie,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(fe,{content:_})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},Y=({onClick:t,disabled:s,loading:i,icon:m,danger:x,title:n})=>e.jsx("button",{onClick:t,disabled:s,title:n,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${x?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:i?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(m,{size:16})}),St=({variables:t,isExpanded:s,onToggle:i})=>!t||Object.keys(t).length===0?null:e.jsxs(K,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:i,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(t).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:s?"Einklappen":"Ausklappen"}),s?e.jsx(se,{size:16}):e.jsx(ne,{size:16})]})]}),s&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(t).map(([m,x])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[wt(m),":"]})," ",x]},m))})]}),_t=({isOpen:t,onClose:s,onConfirm:i,isDeleting:m})=>e.jsx(be,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(X.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(R,{variant:"secondary",onClick:s,disabled:m,fullWidth:!0,children:"Abbrechen"}),e.jsx(R,{variant:"danger",onClick:i,disabled:m,icon:m?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(D,{size:16}),fullWidth:!0,children:m?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),Mt=({briefing:t,onBack:s,onDelete:i})=>{const{config:m}=ht(),x=pt(),[n,p]=o.useState(t),[c,h]=o.useState(!t?.sections),[g,l]=o.useState(null),[k,z]=o.useState({}),[E,P]=o.useState(!1),[_,S]=o.useState(!1),[C,I]=o.useState(!1),[u,F]=o.useState(!1),[v,M]=o.useState(!1);o.useRef(null);const T=ft(n?.template_icon)||G;o.useEffect(()=>{const a=()=>{const r=window.scrollY||document.documentElement.scrollTop;M(r>80)};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),o.useEffect(()=>{const a=async()=>{if(n?.sections){const r={};n.sections.forEach(y=>{r[y.id]=!0}),z(r),h(!1);return}try{h(!0);const r=await $.request(`/smartbriefing/briefings/${n.id}`,{method:"GET"});if(r.success&&r.data?.briefing){p(r.data.briefing);const y={};r.data.briefing.sections?.forEach(N=>{y[N.id]=!0}),z(y)}else throw new Error("Fehler beim Laden des Briefings")}catch(r){console.error("[SmartBriefing] Error fetching briefing:",r),l(r.message)}finally{h(!1)}};n?.id&&a()},[n?.id]);const O=o.useCallback(a=>{z(r=>({...r,[a]:!r[a]}))},[]),L=o.useCallback(async(a,r,y)=>{const N=await $.request(`/smartbriefing/sections/${a}/items/${r}`,{method:"PATCH",body:JSON.stringify(y)});if(!N.success)throw new Error("Fehler beim Speichern");p(w=>({...w,sections:w.sections.map(b=>b.id===a?N.data.section:b)}))},[]),V=o.useCallback(async a=>{const r=await $.request(`/smartbriefing/sections/${a}/generate-more`,{method:"POST"});if(!r.success)throw new Error(r.message||"Fehler beim Generieren");return p(y=>({...y,sections:y.sections.map(N=>N.id===a?r.data.section:N)})),r.data.new_items_count},[]),W=o.useCallback(async(a,r,y)=>{const N=await $.askBriefingItem(a,r,y);return p(w=>({...w,sections:w.sections.map(b=>{if(b.id!==a)return b;let d;try{d=typeof b.ai_content=="string"?JSON.parse(b.ai_content):b.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),b}if(!d?.items)return b;const j=d.items.map(A=>A.id===r?N.item:A);return{...b,ai_content:JSON.stringify({...d,items:j})}})})),N},[]),Q=o.useCallback(async(a,r,y)=>{await $.deleteBriefingItemExplanation(a,r,y),p(N=>({...N,sections:N.sections.map(w=>{if(w.id!==a)return w;let b;try{b=typeof w.ai_content=="string"?JSON.parse(w.ai_content):w.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),w}if(!b?.items)return w;const d=b.items.map(j=>j.id!==r?j:{...j,ai_explanations:(j.ai_explanations||[]).filter(A=>A.id!==y)});return{...w,ai_content:JSON.stringify({...b,items:d})}})}))},[]),U=o.useCallback(async(a,r,y)=>{const N=`Vertiefung: ${y}`,w=r.length>200?r.substring(0,200)+"...":r;p(b=>({...b,sections:b.sections.map(d=>{if(d.id!==a)return d;let j;try{j=typeof d.ai_content=="string"?JSON.parse(d.ai_content):d.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),d}if(!j?.items)return d;const A={id:crypto.randomUUID(),label:N,content:w,user_note:`VollstÃ¤ndige KI-Antwort:

${r}`,deleted:!1,ai_explanations:[]};return{...d,ai_content:JSON.stringify({...j,items:[...j.items,A]})}})}))},[]),H=o.useCallback((a,r,y)=>{const N=r.label||"Neuer Punkt",w=r.content||r.label||"";p(b=>({...b,sections:b.sections.map(d=>{if(d.id!==a)return d;let j;try{j=typeof d.ai_content=="string"?JSON.parse(d.ai_content):d.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),d}if(!j?.items)return d;const A={id:crypto.randomUUID(),label:N,content:w,user_note:"",deleted:!1,ai_explanations:[]};return{...d,ai_content:JSON.stringify({...j,items:[...j.items,A]})}})}))},[]),Z=o.useCallback(async()=>{if(!(u||!n?.id)){F(!0);try{const a=await $.request(`/smartbriefing/briefings/${n.id}/pdf`,{method:"GET"});if(!a.success||!a.data?.pdf_base64)throw new Error(a.message||"PDF-Export fehlgeschlagen");const r=atob(a.data.pdf_base64),y=new Array(r.length);for(let j=0;j<r.length;j++)y[j]=r.charCodeAt(j);const N=new Uint8Array(y),w=new Blob([N],{type:"application/pdf"}),b=window.URL.createObjectURL(w),d=document.createElement("a");d.href=b,d.download=a.data.filename||"Smart-Briefing.pdf",document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(b)}catch(a){console.error("[SmartBriefing] PDF download error:",a)}finally{F(!1)}}},[n?.id,u]),f=async()=>{if(!(!i||!n?.id)){I(!0);try{await i(n)}catch(a){console.error("Failed to delete briefing:",a)}finally{I(!1),S(!1)}}};return n?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`sticky top-0 z-40 transition-all duration-300 ease-out ${v?x?"py-2":"py-2.5":x?"py-5":"py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:`max-w-[1400px] mx-auto ${x?"px-4":"px-8"}`,children:[s&&e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0 mb-0":"max-h-12 opacity-100 mb-4"}`,children:e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(ae,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]})}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[!x&&e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-out ${v?"w-10 h-10":"w-[90px] h-[90px]"}`,children:e.jsx(T,{size:v?20:40,className:"text-white transition-all duration-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0 mb-0":"max-h-10 opacity-100 mb-2"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:n.template_title})]})}),e.jsx("h1",{className:`font-bold text-white m-0 truncate transition-all duration-300 ease-out ${v?"text-base md:text-lg mb-0":x?"text-xl mb-2":"text-2xl mb-2"}`,children:n.title||"Briefing"}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0":"max-h-8 opacity-100"}`,children:e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(de,{size:14}),ut(n.created_at)]})})})]}),e.jsxs("div",{className:"flex gap-2 md:gap-2.5 flex-shrink-0",children:[s&&v&&e.jsx(Y,{onClick:s,icon:ae,title:"ZurÃ¼ck zur Ãœbersicht"}),e.jsx(Y,{onClick:Z,disabled:u,loading:u,icon:lt,title:"Als PDF herunterladen"}),i&&e.jsx(Y,{onClick:()=>S(!0),icon:D,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${x?"p-4":"px-8 py-6"}`,children:[e.jsx(St,{variables:n.variables,isExpanded:E,onToggle:()=>P(!E)}),c&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(B,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),g&&!c&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:g})}),!c&&!g&&n.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[n.sections.length," Abschnitte"]})]}),n.sections.map(a=>e.jsx(Ct,{section:a,onUpdateItem:L,onGenerateMore:V,onAskItem:W,onDeleteExplanation:Q,onAddAsItem:U,onAddActionPoint:H,isExpanded:k[a.id],onToggle:()=>O(a.id)},a.id))]}),!c&&!g&&(!n.sections||n.sections.length===0)&&n.content_markdown&&e.jsx(K,{className:"p-6",children:e.jsx(fe,{content:n.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(_t,{isOpen:_,onClose:()=>S(!1),onConfirm:f,isDeleting:C})]}):null};export{Mt as B,ft as a,Lt as g};
