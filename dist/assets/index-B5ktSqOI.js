import{j as e,p as Q,q as Ct,b as X,a as Ae,T as te,ai as _t,w as At,aj as zt,B as it,v as ze,x as Pe,e as Ee,ae as Ce,O as lt,o as ot,z as pe,I as ge,M as he,a7 as Et,aa as ct,k as dt,y as Z,_ as Ze,ak as ut,h as qe,a2 as Mt,l as We,a3 as Ft,a4 as Ke,a5 as Tt,A as $t,m as Rt,J as It,E as Oe,al as Bt,a1 as be,am as Ve,n as xt,X as Lt,i as Dt,a0 as qt}from"./ui-vendor-B9DEMv6g.js";import{a as n,d as mt}from"./react-vendor-uDOJF2jQ.js";import{h as Ot,F as Vt,g as Pt,c as Zt,C as Ye,i as _e,u as ht,w as U,j as Wt}from"./FeatureInfoButton-ZHD_p0zG.js";import{S as Kt}from"./ScenarioDashboard-Ds20Ef4W.js";import{u as ce}from"./useBranding-B-qAk1eY.js";import{u as Gt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-DuNWsfsv.js";import{A as Ut,M as pt,a as gt}from"./MicrophoneTestDialog-CjRagsq0.js";import{D as Ht}from"./DeviceSettingsDialog-C-NwpFg0.js";import{F as bt}from"./fullscreen-loader-BGHAvS2i.js";import{B as oe,C as ke}from"./Button-CE7zPp3G.js";import"./select-native-DGqpX1mm.js";import"./dialog-BRm7JlyZ.js";import{D as Jt}from"./DynamicFormField-BZFsF8na.js";import"./ScenarioCard-DvRLBHYT.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-S-Mr7VxU.js";import"./index-CklPxmEV.js";const et="[SIMULATOR_DASHBOARD]",Xt={briefcase:it,banknote:zt,user:At,presentation:_t,target:te,mic:Q},Yt=async()=>{const t=await fetch(`${Pt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Zt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const a=await t.json();if(a.success&&a.data?.scenarios)return a.data.scenarios;throw new Error("Keine Szenarien gefunden")},es=t=>Xt[t.icon]||it,ts=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],tt=({onSelectScenario:t,isAuthenticated:a,requireAuth:o,setPendingScenario:c,onNavigateToHistory:r})=>(n.useEffect(()=>(console.log(`${et} ðŸ”µ MOUNT`),()=>{console.log(`${et} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Ot,{featureId:"simulator",showOnMount:!0}),e.jsx(Kt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ae,headerActions:e.jsx(Vt,{featureId:"simulator",size:"sm"}),fetchScenarios:Yt,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:ts,getIconForScenario:es,cardActionLabel:"Starten",cardActionIcon:Ct,categoryField:"category",emptyStateIcon:Q,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:a,requireAuth:o,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]})),ss=({field:t,value:a,onChange:o,error:c,focusColor:r,branding:s})=>{const u=r||"#4a9ec9",_="w-full rounded-lg text-base outline-none transition-all",v="px-4 py-3",b=c?"border-2 border-red-500":"border-2 border-slate-200",g={borderColor:u,boxShadow:`0 0 0 3px ${u}1a`},p=i=>{Object.assign(i.target.style,g),setTimeout(()=>{const w=i.target;if(w){const S=w.closest("div");S&&S.scrollIntoView({behavior:"smooth",block:"center"})}},300)},M=i=>{i.target.style.borderColor=c?Ye.red[500]:Ye.slate[200],i.target.style.boxShadow="none"},y=()=>{const i=`${_} ${v} ${b} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:a||"",onChange:w=>o(t.key,w.target.value),placeholder:t.placeholder||"",className:i,onFocus:p,onBlur:M});case"textarea":return e.jsx("textarea",{value:a||"",onChange:w=>o(t.key,w.target.value),placeholder:t.placeholder||"",rows:4,className:`${i} resize-vertical min-h-[100px]`,onFocus:p,onBlur:M});case"select":return e.jsxs("select",{value:a||t.default||"",onChange:w=>o(t.key,w.target.value),className:`${i} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:p,onBlur:M,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))]});case"number":return e.jsx("input",{type:"number",value:a||"",onChange:w=>o(t.key,w.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:i,onFocus:p,onBlur:M});default:return e.jsx("input",{type:"text",value:a||"",onChange:w=>o(t.key,w.target.value),placeholder:t.placeholder||"",className:i,onFocus:p,onBlur:M})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),y(),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),t.hint]})]})},ns=({scenario:t,onBack:a,onNext:o})=>{const[c,r]=n.useState({}),[s,u]=n.useState({}),[_,v]=n.useState([]),[b,g]=n.useState(!1),p=ce(),M=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const x=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(x)?x.filter(m=>m.user_input!==!1):[]}catch(x){return console.error("Error parsing input_configuration:",x),[]}},[t?.input_configuration]);n.useEffect(()=>{const x={};M.forEach(m=>{m.default&&(x[m.key]=m.default)}),r(x)},[M]);const y=(x,m)=>{r(l=>({...l,[x]:m})),s[x]&&u(l=>{const f={...l};return delete f[x],f})},i=()=>{v(x=>[...x,{key:"",value:""}])},w=(x,m,l)=>{v(f=>{const j=[...f];return j[x]={...j[x],[m]:l},j})},S=x=>{v(m=>m.filter((l,f)=>f!==x))},F=()=>{const x={};return M.forEach(m=>{const l=c[m.key];if(m.required&&(!l||l.trim()==="")){x[m.key]="Dieses Feld ist erforderlich";return}if(!(!l||l.trim()==="")&&m.validation){const{minLength:f,maxLength:j,min:k,max:z,pattern:I}=m.validation;f&&l.length<f&&(x[m.key]=`Mindestens ${f} Zeichen erforderlich`),j&&l.length>j&&(x[m.key]=`Maximal ${j} Zeichen erlaubt`),k!==void 0&&Number(l)<k&&(x[m.key]=`Mindestens ${k}`),z!==void 0&&Number(l)>z&&(x[m.key]=`Maximal ${z}`),I&&!new RegExp(I).test(l)&&(x[m.key]="UngÃ¼ltiges Format")}}),u(x),Object.keys(x).length===0},L=x=>{if(x.preventDefault(),!F())return;const m={...c};_.forEach(l=>{l.key&&l.value&&(m[l.key]=l.value)}),o(m)};return n.useEffect(()=>{M.length===0&&o({})},[M,o]),M.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:p.headerGradient},children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:L,children:[M.map(x=>e.jsx(ss,{field:x,value:c[x.key],onChange:y,error:s[x.key],focusColor:p.primaryAccent,branding:p},x.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>g(!b),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:b?p.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[b?e.jsx(Pe,{size:18}):e.jsx(Ee,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),b&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),_.length>0&&e.jsx("div",{className:"mb-3",children:_.map((x,m)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:x.key||"",onChange:l=>w(m,"key",l.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>S(m),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:16})})]}),e.jsx("textarea",{value:x.value||"",onChange:l=>w(m,"value",l.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},m))}),e.jsxs("button",{type:"button",onClick:i,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:p.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(ot,{className:"w-5 h-5"})]})]})]})},ve=({score:t,label:a,size:o="normal",variant:c="default"})=>{const r=t!=null?t*10:null,u=(v=>c==="white"?"bg-white/20 border-white text-white":v>=80?"bg-green-50 border-green-500 text-green-600":v>=60?"bg-blue-50 border-blue-500 text-blue-600":v>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(r),_=o==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${_?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${u}
      `,children:e.jsx("span",{className:`
          ${_?"text-3xl":"text-2xl"}
          font-bold
        `,children:r!=null?Math.round(r):"-"})}),e.jsx("span",{className:`
        ${_?"text-sm":"text-xs"}
        ${c==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:a})]})},le=({title:t,icon:a,children:o,defaultOpen:c=!0})=>{const[r,s]=n.useState(c);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>s(!r),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),r?e.jsx(Pe,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ee,{className:"w-5 h-5 text-slate-400"})]}),r&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:o})]})},Be=({text:t,type:a})=>{const o={strength:{icon:ct,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:dt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:Z,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:c,iconClass:r,bgClass:s}=o[a]||o.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${s} mb-2`,children:[e.jsx(c,{className:`w-5 h-5 ${r} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},rs=({metrics:t})=>{if(!t)return null;const o=(r=>{switch(r){case"optimal":return{label:"Optimal",colorClass:"text-green-600"};case"zu_schnell":return{label:"Zu schnell",colorClass:"text-amber-600"};case"zu_langsam":return{label:"Zu langsam",colorClass:"text-amber-600"};default:return{label:r||"N/A",colorClass:"text-slate-400"}}})(t.speech_rate),c=r=>{switch(r){case"niedrig":return"text-green-600";case"mittel":return"text-amber-600";case"hoch":return"text-red-600";default:return"text-slate-400"}};return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Sprechtempo"}),e.jsx("span",{className:`text-lg font-semibold ${o.colorClass}`,children:o.label})]}),t.filler_words&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{className:`text-lg font-semibold ${c(t.filler_words.severity)}`,children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{className:"text-xs font-normal ml-2",children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Selbstbewusstsein"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.confidence_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.confidence_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Klarheit"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.clarity_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.clarity_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2 p-4 rounded-xl bg-blue-50 text-sm text-slate-700 leading-relaxed",children:["ðŸ’¡ ",t.notes]})]})},as=({audioUrl:t})=>{const a=n.useRef(null),[o,c]=n.useState(!1),[r,s]=n.useState(0),[u,_]=n.useState(0),[v,b]=n.useState(!0),[g,p]=n.useState(null);n.useEffect(()=>{if(!t)return;b(!0),p(null);const S=new Audio;a.current=S;const F=()=>{const f=S.duration;f&&isFinite(f)&&f>0&&_(f)},L=()=>{F(),b(!1)},x=()=>{b(!1),F()},m=()=>{F()},l=()=>{s(S.currentTime),F()};return S.addEventListener("loadedmetadata",L),S.addEventListener("canplaythrough",x),S.addEventListener("durationchange",m),S.addEventListener("timeupdate",l),S.addEventListener("play",()=>c(!0)),S.addEventListener("pause",()=>c(!1)),S.addEventListener("ended",()=>c(!1)),S.addEventListener("error",()=>{p("Audio nicht verfÃ¼gbar"),b(!1)}),S.src=t,S.load(),()=>{S.pause(),S.src=""}},[t]);const M=()=>{a.current&&(o?a.current.pause():a.current.play())},y=S=>{const F=S.currentTarget.getBoundingClientRect(),L=(S.clientX-F.left)/F.width;a.current&&u>0&&(a.current.currentTime=L*u)},i=S=>{a.current&&(a.current.currentTime=Math.max(0,Math.min(a.current.currentTime+S,u)))};if(!t)return null;if(g)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(pe,{size:16})," ",g]});const w=u>0?r/u*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:y,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${w}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>i(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Mt,{size:20})}),e.jsx("button",{onClick:M,disabled:v,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${v?"cursor-wait opacity-70":"cursor-pointer"}`,children:v?e.jsx(We,{size:20,className:"animate-spin"}):o?e.jsx(Ft,{size:20,fill:"white"}):e.jsx(Ke,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>i(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Tt,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[_e(r)," / ",_e(u)]})]})},is=({transcript:t,feedback:a,audioMetrics:o,audioUrl:c,onRetry:r,onNext:s,onComplete:u,isLastQuestion:_,hideButtons:v=!1})=>{const b=typeof a=="string"?JSON.parse(a):a;return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(ve,{score:b?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:b?.summary||"Deine Antwort wurde analysiert."})]})]}),b?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(ve,{score:b.scores.content,label:"Inhalt"}),e.jsx(ve,{score:b.scores.structure,label:"Struktur"}),e.jsx(ve,{score:b.scores.relevance,label:"Relevanz"})]}),e.jsx(le,{title:"Transkript",icon:he,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),c&&e.jsx(le,{title:"Deine Aufnahme",icon:Et,defaultOpen:!0,children:e.jsx(as,{audioUrl:c})}),b?.strengths?.length>0&&e.jsx(le,{title:"StÃ¤rken",icon:ct,defaultOpen:!0,children:b.strengths.map((g,p)=>e.jsx(Be,{text:g,type:"strength"},p))}),b?.improvements?.length>0&&e.jsx(le,{title:"Verbesserungen",icon:dt,defaultOpen:!0,children:b.improvements.map((g,p)=>e.jsx(Be,{text:g,type:"improvement"},p))}),b?.tips?.length>0&&e.jsx(le,{title:"Tipps",icon:Z,defaultOpen:!1,children:b.tips.map((g,p)=>e.jsx(Be,{text:g,type:"tip"},p))}),o&&e.jsx(le,{title:"Sprechanalyse",icon:Q,defaultOpen:!1,children:e.jsx(rs,{metrics:o})}),!v&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[r&&e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:_?u:s,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(qe,{className:"w-4 h-4"})]})})]})]})},ls=({tips:t,primaryAccent:a,tipsLabel:o,branding:c})=>{const r=ce(),s=c||r,[u,_]=n.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:s.cardBg,borderRadius:s.radius.xl,border:`1px solid ${s.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>_(!u),style:{width:"100%",padding:`${s.space[4]} ${s.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:s.space[2],fontSize:s.fontSize.base,fontWeight:s.fontWeight.semibold,color:s.textMain},children:[e.jsx(Z,{size:s.iconSize.md,color:a}),o||"Tipps fÃ¼r diese Frage"]}),e.jsx(Ee,{size:s.iconSize.md,color:s.textMuted,style:{transform:u?"rotate(180deg)":"none",transition:s.transition.normal}})]}),e.jsx($t,{children:u&&e.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${s.space[6]} ${s.space[6]}`},children:t.map((v,b)=>e.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.md,backgroundColor:s.warningLight,marginBottom:b<t.length-1?s.space[2]:0},children:[e.jsx(Z,{style:{width:s.iconSize.sm,height:s.iconSize.sm,color:s.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:s.textSecondary,margin:0,lineHeight:1.5},children:v.replace(/^Tipp \d+:\s*/i,"")})]},b))})})})]})},os=({seconds:t,maxSeconds:a,isRecording:o,branding:c})=>{const r=ce(),s=c||r,u=a>0?t/a*100:0,_=u>75,v=u>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.lg,backgroundColor:v?s.errorLight:_?s.warningLight:s.cardBgHover},children:[e.jsx(X,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:v?s.error:_?s.warning:s.textSecondary}}),e.jsx("span",{style:{fontSize:s.fontSize.xl,fontWeight:s.fontWeight.semibold,fontFamily:"monospace",color:v?s.error:_?s.warning:s.textSecondary},children:_e(t)}),e.jsxs("span",{style:{fontSize:s.fontSize.base,color:s.textMuted},children:["/ ",_e(a)]})]})},st=({onRecordingComplete:t,timeLimit:a,disabled:o,deviceId:c,themedGradient:r,primaryAccent:s,isSubmitting:u,labels:_,onOpenSettings:v,branding:b,isMobile:g,onStreamChange:p})=>{const M=ce(),y=b||M,[i,w]=n.useState("idle"),[S,F]=n.useState(0),[L,x]=n.useState(0),[m,l]=n.useState(!1),f=n.useRef(null),j=n.useRef([]),k=n.useRef(null),z=n.useRef(null),I=n.useRef(null),E=n.useRef(null),q=n.useRef(null),h=n.useRef(0),d=n.useRef(!1);n.useEffect(()=>()=>{N()},[]),n.useEffect(()=>{i==="recording"&&S>=a&&O()},[S,a,i]);const N=()=>{k.current&&clearInterval(k.current),E.current&&cancelAnimationFrame(E.current),z.current&&(z.current.close(),z.current=null),q.current&&(q.current.getTracks().forEach(R=>R.stop()),q.current=null,p&&p(null))},T=async()=>{try{l(!1),j.current=[],F(0);let R;const ne={audio:c?{deviceId:{exact:c}}:!0};try{R=await navigator.mediaDevices.getUserMedia(ne)}catch(D){throw console.error("[SIMULATOR] Selected device unavailable:",D),D.name==="OverconstrainedError"||D.name==="NotFoundError"?(l(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):D}q.current=R,p&&p(R),z.current=new(window.AudioContext||window.webkitAudioContext),I.current=z.current.createAnalyser(),z.current.createMediaStreamSource(R).connect(I.current),I.current.fftSize=256;const de=()=>{if(I.current&&d.current){const D=new Uint8Array(I.current.frequencyBinCount);I.current.getByteFrequencyData(D);const Me=D.reduce((re,Fe)=>re+Fe)/D.length;x(Me/255)}E.current=requestAnimationFrame(de)};d.current=!0,de();const K=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";f.current=new MediaRecorder(R,{mimeType:K}),f.current.ondataavailable=D=>{D.data.size>0&&j.current.push(D.data)},f.current.onstop=()=>{const D=new Blob(j.current,{type:K});t(D,h.current)},f.current.start(1e3),w("recording"),k.current=setInterval(()=>{F(D=>D+1)},1e3)}catch(R){console.error("Error starting recording:",R),(R.name==="NotAllowedError"||R.name==="PermissionDeniedError")&&l(!0)}},$=()=>{f.current&&f.current.state==="recording"&&(f.current.pause(),w("paused"),d.current=!1,k.current&&(clearInterval(k.current),k.current=null),x(0))},C=()=>{f.current&&f.current.state==="paused"&&(f.current.resume(),w("recording"),d.current=!0,k.current=setInterval(()=>{F(R=>R+1)},1e3))},O=()=>{h.current=S,d.current=!1,k.current&&(clearInterval(k.current),k.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),z.current&&(z.current.close(),z.current=null),f.current&&f.current.state!=="inactive"&&f.current.stop(),q.current&&(q.current.getTracks().forEach(R=>R.stop()),q.current=null),w("idle"),x(0),F(0)},B=()=>{i==="idle"?T():i==="recording"?$():i==="paused"&&C()};if(m)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:y.errorLight},children:[e.jsx(It,{className:"w-12 h-12 mb-3 mx-auto",style:{color:y.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:y.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:y.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const se=()=>{const R={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:g?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:g?"15px":"16px",fontWeight:600,cursor:o||u?"not-allowed":"pointer",flex:g?1:"none"};return o||u?{...R,background:y.borderColor,boxShadow:"none"}:i==="idle"?{...R,background:y.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:i==="recording"?{...R,background:y.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...R,background:y.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:y.cardBg,border:`1px solid ${y.borderColor}`},children:[g&&e.jsx("button",{onClick:v,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:y.cardBgHover,border:`1px solid ${y.borderColor}`},children:e.jsx(Oe,{size:18,style:{color:y.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(os,{seconds:S,maxSeconds:a,isRecording:i==="recording",branding:y})}),i==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{audioLevel:L,isActive:!0,variant:"bars",size:"sm",accentColor:s})}),i==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:y.warning},children:[e.jsx(Q,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!g&&e.jsx("button",{onClick:v,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:y.cardBgHover,border:`1px solid ${y.borderColor}`},children:e.jsx(Oe,{size:20,style:{color:y.textMuted}})}),e.jsxs("button",{onClick:B,disabled:o||u,style:se(),children:[i==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Aufnahme starten"]}),i==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),i==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(i==="recording"||i==="paused")&&e.jsxs("button",{onClick:O,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:g?"14px 16px":"14px 24px",flex:g?1:"none",backgroundColor:y.cardBgHover,color:y.textMain,fontSize:g?"15px":"16px"},children:[e.jsx(be,{className:"w-[18px] h-[18px]",style:{color:y.success}}),_?.submitButton||"Antwort abgeben"]})]}),i==="idle"&&!u&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:y.textMuted},children:_?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),u&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(We,{className:"w-8 h-8 animate-spin",style:{color:s}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:y.textSecondary},children:_?.analyzing||"Antwort wird analysiert..."})]})]})},nt={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Ve,info:ge,settings:Oe,check:be,Target:te,Clock:X,Mic:Q,MessageSquare:he,Lightbulb:Z,Brain:Ve},cs=({scenario:t,variables:a,questions:o,onStart:c,onBack:r,selectedMicrophoneId:s,onMicrophoneChange:u,onMicrophoneTest:_,themedGradient:v,primaryAccent:b,primaryAccentLight:g,isLoading:p,branding:M})=>{const y=ce(),i=M||y,w=t?.mode==="SIMULATION",S=w?"Situationen":"Fragen",F=w?"Zeit pro Situation":"Zeit pro Frage",L=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${w?"Situation":"Frage"}. ${w?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:Q,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:he,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],x=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((j,k)=>typeof j=="string"?{icon:Z,title:`Tipp ${k+1}`,description:j}:{icon:nt[j.icon]||nt[j.icon?.toLowerCase()]||Z,title:j.title||`Tipp ${k+1}`,description:j.text||j.description||""}):L,m=n.useMemo(()=>{if(!t?.input_configuration)return{};try{const j=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(j)?j.reduce((k,z)=>(z.key&&z.label&&(k[z.key]=z.label),k),{}):{}}catch{return{}}},[t?.input_configuration]),l=a?Object.entries(a).filter(([j,k])=>k&&k.trim&&k.trim()!=="").map(([j,k])=>({label:m[j]||j.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase()),value:k})):[],f=j=>{if(!j||!a)return j;let k=j;return Object.entries(a).forEach(([z,I])=>{I&&(k=k.replace(new RegExp(`\\$\\{${z}\\}`,"g"),I),k=k.replace(new RegExp(`\\{${z}\\}`,"g"),I))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:i.textSecondary},children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:v},children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:i.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:i.textSecondary},children:[t.title,o.length>0?` â€¢ ${o.length} ${S}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:v},children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:i.textMain},children:"Deine Aufgabe"}),e.jsx("p",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:i.textSecondary},children:f(t.long_description?.replace(/\/n/g,`
`))})]})]})}),l.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:g},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:b},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:l.map((j,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:j.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:i.textMain},children:j.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px]",style:{color:b}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Mikrofon testen"})]}),e.jsx(pt,{selectedDeviceId:s,onDeviceChange:u,onTestClick:_})]}),e.jsxs("button",{onClick:c,disabled:p,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Ke,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(Z,{className:"w-[22px] h-[22px]",style:{color:i.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:x.map((j,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:i.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:g},children:e.jsx(j.icon,{className:"w-[22px] h-[22px]",style:{color:b}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:i.textMain},children:j.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:i.textSecondary},children:j.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:i.cardBgHover},children:[o.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:S}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:o.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:F}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},ds=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,totalCount:r,labels:s})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(xt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),c>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:s.answeredCount(c,r)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",s.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",s.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,us=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,labels:r})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(pe,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",c>0?` (${c} ${r.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,xs=({number:t,size:a="md"})=>{const o={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${o[a]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},Le=({question:t,index:a,labels:o,isMobile:c})=>e.jsxs(ke,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(xs,{number:a+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||o.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||o.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:c?14:16}),o.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),rt=({error:t,onRetry:a,isMobile:o})=>e.jsxs("div",{className:`flex flex-col items-center ${o?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(pe,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(oe,{variant:"danger",size:"sm",onClick:a,className:"mt-3",children:"Erneut versuchen"})]}),ms=({session:t,questions:a,scenario:o,variables:c,preloadedQuestions:r,onSessionCreated:s,onComplete:u,onExit:_,startFromQuestion:v=0,initialMicrophoneId:b})=>{const g=Gt(),[p,M]=n.useState(t),[y,i]=n.useState(a||[]),[w,S]=n.useState(!1),[F,L]=n.useState(null),{demoCode:x,branding:m}=ht(),l=o?.mode==="SIMULATION",f={questionLabel:l?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:l?"Situation":"Frage",questionLoading:l?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:l?"Deine Reaktion...":"Deine Antwort...",submitButton:l?"Reaktion abgeben":"Antwort abgeben",submitHint:l?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:l?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,V)=>l?`Situation ${A} von ${V}`:`Frage ${A} von ${V}`,questionsCount:A=>l?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,V)=>l?`${A} von ${V} Situationen`:`${A} von ${V} Fragen`,tipsLabel:l?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:l?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:l?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:l?"Situationen":"Fragen",recommendedTime:l?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},j=v>0,k=j?Array.from({length:v},(A,V)=>V):[],[z,I]=n.useState(j?"interview":"preparation"),[E,q]=n.useState(v||p?.current_question_index||0),[h,d]=n.useState(null),[N,T]=n.useState(!1),[$,C]=n.useState(!1),[O,B]=n.useState(null),[se,R]=n.useState([]),[ne,Ge]=n.useState(k),de="karriereheld_selected_microphone",[K,D]=n.useState(()=>{if(b)return b;try{return localStorage.getItem(de)||null}catch{return null}}),[Me,re]=n.useState(!1),[Fe,ue]=n.useState(!1),fe=n.useRef(null),je=n.useCallback(()=>{fe.current&&(fe.current.getTracks().forEach(A=>A.stop()),fe.current=null)},[]),Qe=n.useCallback(A=>{fe.current=A},[]);n.useEffect(()=>()=>{je()},[je]),n.useEffect(()=>{if(K)try{localStorage.setItem(de,K)}catch{}},[K]);const[ft,Te]=n.useState(!1),[jt,$e]=n.useState(!1),[ye,Ue]=n.useState(!1),[xe,we]=n.useState(null),[H,He]=n.useState(!1),J=y[E],ae=E===y.length-1,Je=E===0,Xe=async(A,V)=>{if(V<2){B("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),B("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}C(!0),B(null);try{const P=await U.submitSimulatorAnswer(p.id,A,E,J.question,J.category,V);if(!P.success)throw new Error(P.message||"Fehler beim Analysieren der Antwort");if(d(P.data),T(!0),R(G=>[...G.filter(Y=>Y.questionIndex!==E),{questionIndex:E,feedback:P.data}]),Ge(G=>G.includes(E)?G:[...G,E]),l&&!H){Ue(!0),we(null);const G=ne.includes(E);try{const Y=await U.generateNextTurn(p.id);if(Y.success){const ie=Y.data.next_question;Y.data.is_finished?(we(ie),i(G?ee=>{const me=[...ee];return me[E+1]=ie,me.slice(0,E+2)}:ee=>[...ee,ie]),He(!0)):(we(ie),G?(i(ee=>{const me=[...ee];return me[E+1]=ie,me.slice(0,E+2)}),He(!1)):i(ee=>[...ee,ie]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{Ue(!1)}}}catch(P){console.error("Error submitting answer:",P),B(P.message||"Ein Fehler ist aufgetreten")}finally{C(!1)}},Re=()=>{d(null),T(!1),B(null)},Ie=()=>{if(d(null),T(!1),B(null),l){if(xe){q(A=>A+1),we(null);return}if(H){Ne();return}}else ae||q(A=>A+1)},yt=()=>{d(null),T(!1),B(null),Je||q(A=>A-1)},wt=()=>{Te(!0)},Ne=async()=>{Te(!1),ue(!1),re(!1),je();try{const A=await U.completeSimulatorSession(p.id);A.success?u(A.data):u({session:{...p,status:"completed"}})}catch(A){console.error("Error completing session:",A),u({session:{...p,status:"completed"}})}},Nt=()=>{$e(!0)},vt=()=>{$e(!1),ue(!1),re(!1),je(),_()},St=async()=>{if(p&&y.length>0){I("interview");return}S(!0),L(null);try{const A=await U.createSimulatorSession({scenario_id:o.id,variables:c,demo_code:x||null,questions:r||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const V=A.data.session;let P;if(r&&r.length>0)P=r,await U.updateSimulatorSessionQuestions(V.id,P);else{const G=await U.generateSimulatorQuestions(V.id);if(!G.success)throw new Error(G.message||"Fehler beim Generieren der Fragen");P=G.data.questions}M({...V,questions_json:P}),i(P),s&&s({session:{...V,questions_json:P},questions:P,selectedMicrophoneId:K}),I("interview")}catch(A){console.error("Error creating session:",A),L(A.message||"Ein Fehler ist aufgetreten")}finally{S(!1)}};if(z==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(cs,{scenario:o,variables:c,questions:y,onStart:St,onBack:_,selectedMicrophoneId:K,onMicrophoneChange:D,onMicrophoneTest:()=>re(!0),themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],primaryAccentLight:m?.["--primary-accent-light"],isLoading:w}),e.jsx(gt,{isOpen:Me,onClose:()=>re(!1),deviceId:K}),F&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:F}),e.jsx(bt,{isLoading:w,message:l?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const kt=N&&(l&&H&&!xe||!l&&ae);return e.jsxs("div",{className:`${g?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${g?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${g?"text-lg":"text-xl"} font-semibold text-slate-900`,children:o?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${g?"justify-between":"justify-end"}`,children:[!kt&&e.jsxs("button",{onClick:wt,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(xt,{size:16}),g?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:Nt,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Lt,{size:16}),"Abbrechen"]})]})]}),e.jsx(ds,{isOpen:ft,onClose:()=>Te(!1),onConfirm:Ne,answeredCount:ne.length,totalCount:y.length,labels:f}),e.jsx(us,{isOpen:jt,onClose:()=>$e(!1),onConfirm:vt,answeredCount:ne.length,labels:f}),!N&&!l&&e.jsxs("div",{className:`flex ${g?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(oe,{variant:"secondary",size:g?"sm":"md",icon:e.jsx(Dt,{size:16}),onClick:yt,disabled:Je,className:g?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(oe,{variant:"secondary",size:g?"sm":"md",iconPosition:"right",icon:e.jsx(qe,{size:16}),onClick:Ie,disabled:ae,className:g?"flex-1":"",children:g?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Qt,{current:E,total:y.length,answeredQuestions:ne,primaryAccent:m?.["--primary-accent"],labels:f}),N?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[o.allow_retry&&e.jsx(oe,{variant:"secondary",icon:e.jsx(Ze,{size:16}),onClick:Re,children:"Nochmal versuchen"}),e.jsxs(oe,{onClick:l?H&&!xe?Ne:Ie:ae?Ne:Ie,disabled:l&&ye&&!H,icon:ye?e.jsx(We,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[l&&ye&&!H?"GesprÃ¤chspartner tippt...":l?H&&!xe?"Training abschlieÃŸen":f.nextButton:ae?"Training abschlieÃŸen":f.nextButton,!ye&&!(l?H&&!xe:ae)&&e.jsx(qe,{size:16,className:"ml-1"})]})]}),e.jsx(Le,{question:J,index:E,labels:f,isMobile:g}),e.jsx("div",{className:"mt-4",children:e.jsx(is,{transcript:h.transcript,feedback:h.feedback,audioMetrics:h.audio_analysis,audioUrl:h.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${g?"gap-4":"gap-6"}`,children:[g?e.jsxs(e.Fragment,{children:[e.jsx(Le,{question:J,index:E,labels:f,isMobile:!0}),e.jsx(st,{onRecordingComplete:Xe,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],isSubmitting:$,labels:f,onOpenSettings:()=>ue(!0),isMobile:!0,onStreamChange:Qe}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(st,{onRecordingComplete:Xe,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],isSubmitting:$,labels:f,onOpenSettings:()=>ue(!0),isMobile:!1,onStreamChange:Qe}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!1})]}),e.jsx(Le,{question:J,index:E,labels:f,isMobile:!1})]}),J?.tips&&J.tips.length>0&&e.jsx(ls,{tips:J.tips,primaryAccent:m?.["--primary-accent"],tipsLabel:f.tipsLabel})]}),e.jsx(Ht,{isOpen:Fe,onClose:()=>ue(!1),mode:"audio",selectedMicrophoneId:K,onMicrophoneChange:D})]})},Se=({score:t,label:a,primaryAccent:o,b:c})=>{const r=t!=null?t*10:null,s=Wt(r,o);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:s},children:r!=null?Math.round(r):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:a})]})},De=({icon:t,value:a,label:o,primaryAccent:c,b:r})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:c}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:a}),e.jsx("div",{className:"text-xs text-slate-500",children:o})]})]}),hs=({session:t,scenario:a,onBackToDashboard:o,onStartNew:c})=>{const r=ce(),s=t.summary_feedback||t.summary_feedback_json,u=s?typeof s=="string"?JSON.parse(s):s:null,_=t.overall_score||u?.overall_score||0,v=_<=10?_*10:_,g=(p=>p>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:p>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:p>=70?{text:"Gut!",emoji:"ðŸ‘"}:p>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:p>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(v);return e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:r.headerGradient,boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:e.jsx(ut,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",g.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[a?.title||"Skill Training"," - ",g.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${r.primaryAccent}`,backgroundColor:r.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:r.primaryAccent},children:v?Math.round(v):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:v?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(De,{icon:be,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),e.jsx(De,{icon:te,value:u?.average_content_score?Math.round(u.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(De,{icon:qt,value:u?.average_delivery_score?Math.round(u.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),u?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Se,{score:u.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:u.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:u.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:u.scores.delivery,label:"PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),u?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:u.summary})]}),u?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:u.key_takeaways.map((p,M)=>e.jsx("li",{className:"mb-2",children:p},M))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Ze,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})},W={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},$s=({isAuthenticated:t,requireAuth:a,setPendingAction:o,pendingContinueSession:c,clearPendingContinueSession:r,pendingRepeatSession:s,clearPendingRepeatSession:u,onNavigateToHistory:_})=>{const[v,b]=n.useState(W.DASHBOARD),[g,p]=n.useState(null),[M,y]=n.useState(null),[i,w]=n.useState([]),[S,F]=n.useState({}),[L,x]=n.useState(null),[m,l]=n.useState(null),[f,j]=n.useState(null),[k,z]=n.useState(0);n.useEffect(()=>{f&&t&&(p(f),b(W.VARIABLES),j(null))},[f,t]),n.useEffect(()=>{if(c&&t){const{session:C,scenario:O}=c,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[],R=C.completed_questions||C.answered_count||0;p(O||{id:C.scenario_id,title:C.scenario_title}),y(C),w(se),F({}),z(R),b(W.SESSION),r&&r()}},[c,t,r]),n.useEffect(()=>{if(s&&t){const{session:C,scenario:O}=s,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[];p(O||{id:C.scenario_id,title:C.scenario_title}),w(se),F({}),z(0),b(W.SESSION),u&&u()}},[s,t,u]),n.useEffect(()=>{window.scrollTo(0,0)},[v]);const I=n.useCallback(C=>{p(C),b(W.VARIABLES)},[]),E=n.useCallback(()=>{p(null),y(null),w([]),F({}),x(null),z(0),l(null),b(W.DASHBOARD)},[]),q=n.useCallback(C=>{F(C),b(W.SESSION)},[]),h=n.useCallback(C=>{y(C.session),w(C.questions),C.selectedMicrophoneId&&l(C.selectedMicrophoneId)},[]),d=n.useCallback(C=>{x(C.session),b(W.COMPLETE)},[]),N=n.useCallback(()=>{E()},[E]),T=n.useCallback(()=>{y(null),w([]),x(null),z(0),l(null),b(W.VARIABLES)},[]),$=()=>{switch(v){case W.DASHBOARD:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:j,onNavigateToHistory:_});case W.VARIABLES:return e.jsx(ns,{scenario:g,onBack:E,onNext:q});case W.SESSION:return e.jsx(ms,{session:M,questions:i,scenario:g,variables:S,preloadedQuestions:i.length>0?i:null,onSessionCreated:h,onComplete:d,onExit:N,startFromQuestion:k,initialMicrophoneId:m});case W.COMPLETE:return e.jsx(hs,{session:L,scenario:g,onBackToDashboard:E,onStartNew:T});default:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:j,onNavigateToHistory:_})}};return e.jsx("div",{className:"min-h-full",children:$()})},at={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Ve,info:ge,check:be,sparkles:Ae},ps=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:Q,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Rs=({scenario:t,onBack:a,onStart:o,preloadedQuestions:c})=>{const[r,s]=n.useState({}),[u,_]=n.useState({}),[v,b]=n.useState(!1),[g,p]=n.useState(null),[M,y]=n.useState(null),[i,w]=n.useState(!1),[S,F]=n.useState([]),[L,x]=n.useState(!1),{demoCode:m}=ht(),l=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const h=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(h)?h.filter(d=>d.user_input!==!1):[]}catch(h){return console.error("Error parsing input_configuration:",h),[]}},[t?.input_configuration]);n.useEffect(()=>{const h={};l.forEach(d=>{d.default&&(h[d.key]=d.default)}),s(h)},[l]);const f=(h,d)=>{if(!h)return h;let N=h;return Object.entries(d||{}).forEach(([T,$])=>{$&&(N=N.replace(new RegExp(`\\$\\{${T}\\}`,"g"),$),N=N.replace(new RegExp(`\\{${T}\\}`,"g"),$))}),N},j=(h,d)=>{s(N=>({...N,[h]:d})),u[h]&&_(N=>{const T={...N};return delete T[h],T})},k=()=>{F(h=>[...h,{key:"",value:""}])},z=(h,d,N)=>{F(T=>{const $=[...T];return $[h]={...$[h],[d]:N},$})},I=h=>{F(d=>d.filter((N,T)=>T!==h))},E=()=>{const h={};return l.forEach(d=>{const N=r[d.key];if(d.required&&(!N||N.trim()==="")){h[d.key]="Dieses Feld ist erforderlich";return}if(!(!N||N.trim()==="")&&d.validation){const{minLength:T,maxLength:$,min:C,max:O,pattern:B}=d.validation;T&&N.length<T&&(h[d.key]=`Mindestens ${T} Zeichen erforderlich`),$&&N.length>$&&(h[d.key]=`Maximal ${$} Zeichen erlaubt`),C!==void 0&&Number(N)<C&&(h[d.key]=`Mindestens ${C}`),O!==void 0&&Number(N)>O&&(h[d.key]=`Maximal ${O}`),B&&!new RegExp(B).test(N)&&(h[d.key]="UngÃ¼ltiges Format")}}),_(h),Object.keys(h).length===0},q=async h=>{if(h.preventDefault(),p(null),!!E()){b(!0);try{const d={...r};S.forEach(C=>{C.key&&C.value&&(d[C.key]=C.value)});const N=await U.createSimulatorSession({scenario_id:t.id,variables:d,demo_code:m||null,questions:c||null});if(!N.success)throw new Error(N.message||"Fehler beim Erstellen der Session");const T=N.data.session;let $;if(c&&c.length>0)$=c,await U.updateSimulatorSessionQuestions(T.id,$);else{const C=await U.generateSimulatorQuestions(T.id);if(!C.success)throw new Error(C.message||"Fehler beim Generieren der Fragen");$=C.data.questions}o({session:{...T,questions_json:$},questions:$,scenario:t,variables:d,selectedMicrophoneId:M})}catch(d){console.error("Error starting session:",d),p(d.message||"Ein Fehler ist aufgetreten")}finally{b(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(ze,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ke,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:f(t.long_description?.replace(/\/n/g,`
`),r)})]})]})}),(()=>{const h=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((d,N)=>typeof d=="string"?{icon:Z,title:`Tipp ${N+1}`,description:d}:{icon:at[d.icon]||at[d.icon?.toLowerCase()]||Z,title:d.title||`Tipp ${N+1}`,description:d.text||d.description||""}):ps;return e.jsxs(ke,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:h.map((d,N)=>{const T=d.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:d.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:d.description})]})]},N)})})]})})(),e.jsxs("form",{onSubmit:q,children:[l.length>0?l.map(h=>e.jsx(Jt,{field:h,value:r[h.key],onChange:j,error:u[h.key]},h.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(be,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>x(!L),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${L?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[L?e.jsx(Pe,{size:18}):e.jsx(Ee,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),L&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),S.length>0&&e.jsx("div",{className:"mb-3",children:S.map((h,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:h.key||"",onChange:N=>z(d,"key",N.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>I(d),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:18})})]}),e.jsx("textarea",{value:h.value||"",onChange:N=>z(d,"value",N.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},d))}),e.jsxs("button",{type:"button",onClick:k,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ke,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(pt,{selectedDeviceId:M,onDeviceChange:y,onTestClick:()=>w(!0)})]}),g&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(pe,{className:"w-[18px] h-[18px]"}),g]}),e.jsx(oe,{type:"submit",disabled:v,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(ot,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(gt,{isOpen:i,onClose:()=>w(!1),deviceId:M}),e.jsx(bt,{isLoading:v,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{us as CancelConfirmDialog,ds as CompleteConfirmDialog,is as ImmediateFeedback,cs as PreSessionView,ls as QuestionTips,hs as SessionComplete,os as SessionTimer,$s as SimulatorApp,st as SimulatorAudioRecorder,tt as SimulatorDashboard,ms as SimulatorSession,Rs as SimulatorWizard};
