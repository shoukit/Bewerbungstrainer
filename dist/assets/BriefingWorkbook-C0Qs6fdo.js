import{F as z,N as U,aD as L,r as ne,aE as ie,aF as le,aG as ce,aH as oe,aI as de,s as me,l as k,t as xe,k as he,I as pe,X as ue,n as $,aJ as fe,ae as ge,O as w,aK as be,aL as je,aM as ye,aN as Ne,b as we,aO as ke,P as ve,aP as Ce,M as Se,aa as ze,ad as _e,Z as Pe,aQ as Ae,aR as Be,aS as Ee,q as Ie,aT as Me,E as Le,aA as De,z as Te,a1 as Fe,a4 as Ge,p as Re,V as Oe,a as D,Q as q,R as Ue,C as $e,c as qe,y as H,a0 as He,aw as Ve,ax as Ke,a8 as We,T as Ze,as as Je,w as Qe,U as V,aj as K,B as W,j as e,v as Ye,Y as Xe,x as Z,e as J,A as es,m as G,aB as ss,_ as ts}from"./ui-vendor-B9DEMv6g.js";import{a as d}from"./react-vendor-uDOJF2jQ.js";import{u as as,w as B,k as rs}from"./FeatureInfoButton-Df0Ex1oW.js";import{u as ns}from"./useMobile-YxjH166V.js";import{C as I,B as E}from"./Button-BHvYxNT_.js";import"./select-native-BpAm0hLd.js";import"./dialog-BRm7JlyZ.js";const is={"file-text":z,briefcase:W,banknote:K,users:V,user:Qe,"message-circle":Je,target:Ze,award:We,book:Ke,clipboard:Ve,star:He,lightbulb:H,shield:qe,compass:$e,rocket:Ue,calendar:q,sparkles:D,video:Oe,mic:Re,play:Ge,"check-circle":Fe,"alert-circle":Te,"help-circle":De,settings:Le,home:Me,"trending-up":Ie,"bar-chart":Ee,"pie-chart":Be,activity:Ae,zap:Pe,heart:_e,"thumbs-up":ze,"message-square":Se,mail:Ce,phone:ve,"map-pin":ke,clock:we,bell:Ne,search:ye,filter:je,edit:be,trash:w,plus:ge,minus:fe,check:$,x:ue,info:pe,warning:he,refresh:xe,loader:k,globe:me,link:de,bookmark:oe,tag:ce,code:le,database:ie,server:ne,pen:L,bot:U},ls={"file-text":z,briefcase:W,banknote:K,users:V},cs=(s,a=z)=>is[s]||a,ks=s=>ls[s]||z,os={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprächsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprächsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fähigkeiten",strengths:"Stärken",challenges:"Herausforderungen"},ds=s=>os[s]||s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),M=s=>{if(!s)return null;const a=[];let r=s,n=0;for(;r.length>0;){const h=r.match(/\*\*(.+?)\*\*/),t=r.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),u=r.match(/`([^`]+)`/),m=[{match:h,type:"bold"},{match:t,type:"italic"},{match:u,type:"code"}].filter(x=>x.match);if(m.length===0){a.push(r);break}const c=m.reduce((x,p)=>(x.match?.index??1/0)<(p.match?.index??1/0)?x:p);switch(c.match.index>0&&a.push(r.substring(0,c.match.index)),c.type){case"bold":a.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:c.match[1]},n++));break;case"italic":a.push(e.jsx("em",{className:"italic",children:c.match[1]||c.match[2]},n++));break;case"code":a.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-[13px] font-mono text-primary",children:c.match[1]},n++));break}r=r.substring(c.match.index+c.match[0].length)}return a},Q=({content:s})=>{if(!s)return null;const a=r=>{const n=r.split(`
`),h=[];let t=[],u=null;const m=()=>{t.length>0&&(h.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:t.map((c,x)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-primary font-bold",children:u==="number"?`${x+1}.`:"•"}),M(c)]},x))},`list-${h.length}`)),t=[],u=null)};return n.forEach((c,x)=>{const p=c.trim();if(!p){m();return}if(p.startsWith("- ")||p.startsWith("* ")){u!=="bullet"&&(m(),u="bullet"),t.push(p.substring(2));return}const g=p.match(/^(\d+)\.\s/);if(g){u!=="number"&&(m(),u="number"),t.push(p.substring(g[0].length));return}m(),h.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:M(p)},`p-${x}`))}),m(),h};return e.jsx("div",{children:a(s)})},ms=({item:s,onRestore:a})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-lg mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:s.label})," - gelöscht"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-md border-none bg-slate-200 text-slate-500 text-xs cursor-pointer hover:bg-slate-300 transition-colors",children:[e.jsx(ts,{size:12}),"Wiederherstellen"]})]}),R=({item:s,sectionId:a,onUpdateItem:r})=>{const[n,h]=d.useState(s.user_note||""),[t,u]=d.useState(!1),[m,c]=d.useState(!1),[x,p]=d.useState(!1),[g,j]=d.useState(!!s.user_note);d.useEffect(()=>{p(n!==(s.user_note||""))},[n,s.user_note]);const y=async()=>{u(!0);try{await r(a,s.id,{user_note:n}),c(!0),p(!1),setTimeout(()=>c(!1),2e3)}catch(b){console.error("Error saving note:",b)}finally{u(!1)}},v=async()=>{try{await r(a,s.id,{deleted:!0})}catch(b){console.error("Error deleting item:",b)}},o=async()=>{try{await r(a,s.id,{deleted:!1})}catch(b){console.error("Error restoring item:",b)}};return s.deleted?e.jsx(ms,{item:s,onRestore:o}):e.jsxs(I,{className:"mb-2.5 overflow-hidden p-0",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})]}),s.content&&e.jsx("p",{className:"text-[13px] text-slate-500 m-0 ml-3.5 leading-snug",children:M(s.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.user_note&&!g&&e.jsx("span",{className:"text-[11px] text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:"Notiz"}),e.jsx("button",{onClick:()=>j(!g),title:"Notiz hinzufügen",className:`p-1.5 rounded-md border-none cursor-pointer flex items-center justify-center transition-colors ${g?"bg-primary/10 text-primary":"bg-transparent text-slate-400 hover:text-primary hover:bg-primary/5"}`,children:e.jsx(L,{size:16})}),e.jsx("button",{onClick:v,title:"Löschen",className:"p-1.5 rounded-md border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-colors",children:e.jsx(w,{size:16})})]})]}),g&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:n,onChange:b=>h(b.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-lg border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-primary"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(E,{variant:"secondary",size:"sm",onClick:()=>{j(!1),h(s.user_note||"")},children:"Abbrechen"}),e.jsx(E,{variant:m?"secondary":"primary",size:"sm",onClick:y,disabled:t||!x,icon:t?e.jsx(k,{size:12,className:"animate-spin"}):m?e.jsx($,{size:12}):e.jsx(ss,{size:12}),className:m?"bg-green-100 text-green-700 border-green-200":"",children:m?"Gespeichert!":"Speichern"})]})]})]})},xs=({onClick:s,isGenerating:a})=>e.jsx("button",{onClick:s,disabled:a,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border border-dashed border-primary/40 bg-primary/5 text-primary text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-primary/10 hover:border-primary/60
      disabled:cursor-wait disabled:opacity-60`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{size:16}),"5 weitere Punkte generieren"]})}),hs=({section:s,onUpdateItem:a,onGenerateMore:r,isExpanded:n,onToggle:h})=>{const[t,u]=d.useState(!1),m=async()=>{u(!0);try{await r(s.id)}catch(o){console.error("Error generating more items:",o)}finally{u(!1)}},c=d.useCallback(()=>{if(!s.ai_content)return{type:"empty",items:[],content:""};try{const o=JSON.parse(s.ai_content);if(o&&Array.isArray(o.items))return{type:"items",items:o.items,content:""}}catch{}return{type:"markdown",items:[],content:s.ai_content}},[s.ai_content]),{type:x,items:p,content:g}=c(),j=p.filter(o=>!o.deleted),y=p.filter(o=>o.deleted),v=p.some(o=>o.user_note&&!o.deleted);return e.jsxs(I,{className:"mb-4 overflow-hidden p-0",children:[e.jsxs("button",{onClick:h,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${n?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:s.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[x==="items"&&e.jsxs("span",{className:"text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded-lg",children:[j.length," Punkte"]}),v&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-primary bg-primary/10 px-2 py-1 rounded-lg",children:[e.jsx(L,{size:12}),"Notizen"]}),n?e.jsx(Z,{size:20,className:"text-slate-400"}):e.jsx(J,{size:20,className:"text-slate-400"})]})]}),n&&e.jsx("div",{className:"px-5 py-4",children:x==="items"?e.jsxs(e.Fragment,{children:[j.map(o=>e.jsx(R,{item:o,sectionId:s.id,onUpdateItem:a},o.id)),r&&e.jsx(xs,{onClick:m,isGenerating:t}),y.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(w,{size:12}),y.length," gelöschte ",y.length===1?"Punkt":"Punkte"]}),y.map(o=>e.jsx(R,{item:o,sectionId:s.id,onUpdateItem:a},o.id))]})]}):x==="markdown"?e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(U,{size:16,className:"text-primary"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(Q,{content:g})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfügbar"})})]})},O=({onClick:s,disabled:a,loading:r,icon:n,danger:h,title:t})=>e.jsx("button",{onClick:s,disabled:a,title:t,className:`flex items-center justify-center rounded-lg px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${h?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30":"bg-white/20 border-white/30 text-white hover:bg-white/30"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:r?e.jsx(k,{size:16,className:"animate-spin"}):e.jsx(n,{size:16})}),ps=({variables:s,isExpanded:a,onToggle:r})=>!s||Object.keys(s).length===0?null:e.jsxs(I,{className:"mb-5 p-4",children:[e.jsxs("button",{onClick:r,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(s).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[e.jsx("span",{className:"text-xs",children:a?"Einklappen":"Ausklappen"}),a?e.jsx(Z,{size:16}):e.jsx(J,{size:16})]})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(s).map(([n,h])=>e.jsxs("span",{className:"bg-slate-100 px-3 py-1.5 rounded-full text-xs text-slate-600",children:[e.jsxs("strong",{className:"text-slate-900",children:[ds(n),":"]})," ",h]},n))})]}),us=({isOpen:s,onClose:a,onConfirm:r,isDeleting:n})=>e.jsx(es,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(w,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing löschen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rückgängig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelöscht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{variant:"secondary",onClick:a,disabled:n,fullWidth:!0,children:"Abbrechen"}),e.jsx(E,{variant:"danger",onClick:r,disabled:n,icon:n?e.jsx(k,{size:16,className:"animate-spin"}):e.jsx(w,{size:16}),fullWidth:!0,children:n?"Löschen...":"Löschen"})]})]})})]})}),vs=({briefing:s,onBack:a,onDelete:r})=>{const{config:n}=as(),h=ns(),[t,u]=d.useState(s),[m,c]=d.useState(!s?.sections),[x,p]=d.useState(null),[g,j]=d.useState({}),[y,v]=d.useState(!1),[o,b]=d.useState(!1),[Y,T]=d.useState(!1),[_,F]=d.useState(!1),X=cs(t?.template_icon)||z;d.useEffect(()=>{const i=async()=>{if(t?.sections){const l={};t.sections.forEach(f=>{l[f.id]=!0}),j(l),c(!1);return}try{c(!0);const l=await B.request(`/smartbriefing/briefings/${t.id}`,{method:"GET"});if(l.success&&l.data?.briefing){u(l.data.briefing);const f={};l.data.briefing.sections?.forEach(N=>{f[N.id]=!0}),j(f)}else throw new Error("Fehler beim Laden des Briefings")}catch(l){console.error("[SmartBriefing] Error fetching briefing:",l),p(l.message)}finally{c(!1)}};t?.id&&i()},[t?.id]);const ee=d.useCallback(i=>{j(l=>({...l,[i]:!l[i]}))},[]),se=d.useCallback(async(i,l,f)=>{const N=await B.request(`/smartbriefing/sections/${i}/items/${l}`,{method:"PATCH",body:JSON.stringify(f)});if(!N.success)throw new Error("Fehler beim Speichern");u(P=>({...P,sections:P.sections.map(C=>C.id===i?N.data.section:C)}))},[]),te=d.useCallback(async i=>{const l=await B.request(`/smartbriefing/sections/${i}/generate-more`,{method:"POST"});if(!l.success)throw new Error(l.message||"Fehler beim Generieren");return u(f=>({...f,sections:f.sections.map(N=>N.id===i?l.data.section:N)})),l.data.new_items_count},[]),ae=d.useCallback(async()=>{if(!(_||!t?.id)){F(!0);try{const i=await B.request(`/smartbriefing/briefings/${t.id}/pdf`,{method:"GET"});if(!i.success||!i.data?.pdf_base64)throw new Error(i.message||"PDF-Export fehlgeschlagen");const l=atob(i.data.pdf_base64),f=new Array(l.length);for(let A=0;A<l.length;A++)f[A]=l.charCodeAt(A);const N=new Uint8Array(f),P=new Blob([N],{type:"application/pdf"}),C=window.URL.createObjectURL(P),S=document.createElement("a");S.href=C,S.download=i.data.filename||"Smart-Briefing.pdf",document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(C)}catch(i){console.error("[SmartBriefing] PDF download error:",i)}finally{F(!1)}}},[t?.id,_]),re=async()=>{if(!(!r||!t?.id)){T(!0);try{await r(t)}catch(i){console.error("Failed to delete briefing:",i)}finally{T(!1),b(!1)}}};return t?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 py-5 md:px-8 md:py-6",style:{background:"var(--header-gradient, linear-gradient(135deg, #3A7FA7 0%, #4A9BC7 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[a&&e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ye,{size:16}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx("div",{className:"w-[90px] h-[90px] rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(X,{size:40,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-primary",children:t.template_title})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:t.title||"Briefing"}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(q,{size:14}),rs(t.created_at)]})})]}),e.jsxs("div",{className:"flex gap-2.5 flex-shrink-0",children:[e.jsx(O,{onClick:ae,disabled:_,loading:_,icon:Xe,title:"Als PDF herunterladen"}),r&&e.jsx(O,{onClick:()=>b(!0),icon:w,danger:!0,title:"Briefing löschen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${h?"p-4":"px-8 py-6"}`,children:[e.jsx(ps,{variables:t.variables,isExpanded:y,onToggle:()=>v(!y)}),m&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(k,{size:40,className:"text-primary animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-500",children:"Briefing wird geladen..."})]}),x&&!m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:x})}),!m&&!x&&t.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(D,{size:18,className:"text-primary"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] text-slate-400",children:["(",t.sections.length," Abschnitte)"]})]}),t.sections.map(i=>e.jsx(hs,{section:i,onUpdateItem:se,onGenerateMore:te,isExpanded:g[i.id],onToggle:()=>ee(i.id)},i.id))]}),!m&&!x&&(!t.sections||t.sections.length===0)&&t.content_markdown&&e.jsx(I,{className:"p-6",children:e.jsx(Q,{content:t.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{size:18,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-500 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufügen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(us,{isOpen:o,onClose:()=>b(!1),onConfirm:re,isDeleting:Y})]}):null};export{vs as B,cs as a,ks as g};
