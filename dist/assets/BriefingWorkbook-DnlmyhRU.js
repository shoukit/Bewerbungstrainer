import{F as U,Q as ee,aE as V,s as he,aF as ue,aG as pe,aH as ge,aI as be,aJ as fe,t as je,L as E,u as ye,T as we,I as Ne,X as se,b as te,aK as ke,ah as ae,Y as M,aL as ve,aM as Ce,aN as _e,aO as ze,g as Se,aP as Ee,P as Ae,aQ as Pe,M as Be,ad as Ie,ag as Le,Z as Me,aR as De,aS as Fe,aT as Te,i as $e,aU as Ue,J as Ge,aA as ne,E as Re,a3 as qe,a8 as Oe,e as Ke,V as He,a as W,_ as re,R as ie,c as Ve,S as We,z as le,a2 as Qe,ax as Je,ay as Ze,a1 as Ye,l as Xe,at as oe,x as es,U as ce,am as de,r as xe,j as e,w as ss,$ as ts,y as Q,C as J,A as as,m as Z,aV as ns,aW as rs,aC as is,a0 as ls}from"./ui-vendor-4RzMPcHM.js";import{a as i}from"./react-vendor-uDOJF2jQ.js";import{u as os,w as L,n as cs}from"./FeatureInfoButton-DkKoIptM.js";import{u as ds}from"./useMobile-YxjH166V.js";import{C as q,B as $}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const xs={"file-text":U,briefcase:xe,banknote:de,users:ce,user:es,"message-circle":oe,target:Xe,award:Ye,book:Ze,clipboard:Je,star:Qe,lightbulb:le,shield:We,compass:Ve,rocket:ie,calendar:re,sparkles:W,video:He,mic:Ke,play:Oe,"check-circle":qe,"alert-circle":Re,"help-circle":ne,settings:Ge,home:Ue,"trending-up":$e,"bar-chart":Te,"pie-chart":Fe,activity:De,zap:Me,heart:Le,"thumbs-up":Ie,"message-square":Be,mail:Pe,phone:Ae,"map-pin":Ee,clock:Se,bell:ze,search:_e,filter:Ce,edit:ve,trash:M,plus:ae,minus:ke,check:te,x:se,info:Ne,warning:we,refresh:ye,loader:E,globe:je,link:fe,bookmark:be,tag:ge,code:pe,database:ue,server:he,pen:V,bot:ee},ms={"file-text":U,briefcase:xe,banknote:de,users:ce},hs=(t,a=U)=>xs[t]||a,zs=t=>ms[t]||U,us={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},ps=t=>us[t]||t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),R=t=>{if(!t)return null;const a=[];let l=t,c=0;for(;l.length>0;){const h=l.match(/\*\*(.+?)\*\*/),n=l.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),d=l.match(/`([^`]+)`/),g=[{match:h,type:"bold"},{match:n,type:"italic"},{match:d,type:"code"}].filter(u=>u.match);if(g.length===0){a.push(l);break}const m=g.reduce((u,p)=>(u.match?.index??1/0)<(p.match?.index??1/0)?u:p);switch(m.match.index>0&&a.push(l.substring(0,m.match.index)),m.type){case"bold":a.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:m.match[1]},c++));break;case"italic":a.push(e.jsx("em",{className:"italic",children:m.match[1]||m.match[2]},c++));break;case"code":a.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:m.match[1]},c++));break}l=l.substring(m.match.index+m.match[0].length)}return a},me=({content:t})=>{if(!t)return null;const a=l=>{const c=l.split(`
`),h=[];let n=[],d=null;const g=()=>{n.length>0&&(h.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:n.map((m,u)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:d==="number"?`${u+1}.`:"â€¢"}),R(m)]},u))},`list-${h.length}`)),n=[],d=null)};return c.forEach((m,u)=>{const p=m.trim();if(!p){g();return}if(p.startsWith("- ")||p.startsWith("* ")){d!=="bullet"&&(g(),d="bullet"),n.push(p.substring(2));return}const v=p.match(/^(\d+)\.\s/);if(v){d!=="number"&&(g(),d="number"),n.push(p.substring(v[0].length));return}g(),h.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:R(p)},`p-${u}`))}),g(),h};return e.jsx("div",{children:a(t)})},gs=({item:t,onRestore:a})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:t.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(ls,{size:12}),"Wiederherstellen"]})]}),Y=({item:t,sectionId:a,onUpdateItem:l,onAskItem:c,onDeleteExplanation:h,onAddAsItem:n})=>{const[d,g]=i.useState(t.user_note||""),[m,u]=i.useState(!1),[p,v]=i.useState(!1),[C,_]=i.useState(!1),[z,S]=i.useState(!!t.user_note),[w,B]=i.useState(!1),[o,A]=i.useState(""),[N,I]=i.useState(!1),[D,F]=i.useState(!0),P=t.ai_explanations||[];i.useEffect(()=>{_(d!==(t.user_note||""))},[d,t.user_note]);const O=async()=>{u(!0);try{await l(a,t.id,{user_note:d}),v(!0),_(!1),setTimeout(()=>v(!1),2e3)}catch(s){console.error("Error saving note:",s)}finally{u(!1)}},K=async()=>{try{await l(a,t.id,{deleted:!0})}catch(s){console.error("Error deleting item:",s)}},H=async()=>{try{await l(a,t.id,{deleted:!1})}catch(s){console.error("Error restoring item:",s)}},T=async s=>{if(c){I(!0);try{await c(a,t.id,{quick_action:s}),F(!0)}catch(x){console.error("Error asking AI:",x)}finally{I(!1)}}},G=async()=>{if(!(!c||!o.trim())){I(!0);try{await c(a,t.id,{question:o.trim()}),A(""),F(!0)}catch(s){console.error("Error asking AI:",s)}finally{I(!1)}}},r=async s=>{if(h)try{await h(a,t.id,s)}catch(x){console.error("Error deleting explanation:",x)}};return t.deleted?e.jsx(gs,{item:t,onRestore:H}):e.jsxs(q,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:t.label})]}),t.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:R(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[P.length>0&&!w&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[P.length," KI"]}),t.user_note&&!z&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{B(!w),w||S(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${w?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(oe,{size:16})}),e.jsx("button",{onClick:()=>{S(!z),z||B(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${z?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(V,{size:16})}),e.jsx("button",{onClick:K,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(M,{size:16})})]})]}),w&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>T("explain"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ne,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>T("examples"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ns,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>T("howto"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ie,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:s=>A(s.target.value),onKeyDown:s=>s.key==="Enter"&&!N&&G(),placeholder:"Oder stelle eine eigene Frage...",disabled:N,className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx($,{variant:"primary",size:"sm",onClick:G,disabled:N||!o.trim(),icon:N?e.jsx(E,{size:14,className:"animate-spin"}):e.jsx(rs,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),N&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(E,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),P.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>F(!D),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[D?e.jsx(Q,{size:14}):e.jsx(J,{size:14}),"KI-ErklÃ¤rungen (",P.length,")"]}),D&&e.jsx("div",{className:"space-y-2",children:P.map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-amber-200",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("p",{className:"text-[12px] font-medium text-amber-700 m-0",children:s.quick_action?s.quick_action==="explain"?"ðŸ’¡ ErklÃ¤rung":s.quick_action==="examples"?"ðŸ“ Beispiele":s.quick_action==="howto"?"ðŸš€ Umsetzung":"Frage":`â“ ${s.question}`}),e.jsxs("div",{className:"flex items-center gap-1",children:[n&&e.jsx("button",{onClick:()=>n(a,s.answer,t.label),title:"Als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(ae,{size:14})}),e.jsx("button",{onClick:()=>r(s.id),title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(se,{size:14})})]})]}),e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap",children:R(s.answer)})]},s.id))})]})]}),z&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:d,onChange:s=>g(s.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx($,{variant:"secondary",size:"sm",onClick:()=>{S(!1),g(t.user_note||"")},children:"Abbrechen"}),e.jsx($,{variant:p?"secondary":"primary",size:"sm",onClick:O,disabled:m||!C,icon:m?e.jsx(E,{size:12,className:"animate-spin"}):p?e.jsx(te,{size:12}):e.jsx(is,{size:12}),className:p?"bg-green-100 text-green-700 border-green-200":"",children:p?"Gespeichert!":"Speichern"})]})]})]})},bs=({onClick:t,isGenerating:a})=>e.jsx("button",{onClick:t,disabled:a,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:16}),"5 weitere Punkte generieren"]})}),fs=({section:t,onUpdateItem:a,onGenerateMore:l,onAskItem:c,onDeleteExplanation:h,onAddAsItem:n,isExpanded:d,onToggle:g})=>{const[m,u]=i.useState(!1),p=async()=>{u(!0);try{await l(t.id)}catch(o){console.error("Error generating more items:",o)}finally{u(!1)}},v=i.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const o=JSON.parse(t.ai_content);if(o&&Array.isArray(o.items))return{type:"items",items:o.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:C,items:_,content:z}=v(),S=_.filter(o=>!o.deleted),w=_.filter(o=>o.deleted),B=_.some(o=>o.user_note&&!o.deleted);return e.jsxs(q,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:g,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${d?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:t.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[C==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[S.length," Punkte"]}),B&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(V,{size:12}),"Notizen"]}),d?e.jsx(Q,{size:20,className:"text-slate-400"}):e.jsx(J,{size:20,className:"text-slate-400"})]})]}),d&&e.jsx("div",{className:"px-5 py-4",children:C==="items"?e.jsxs(e.Fragment,{children:[S.map(o=>e.jsx(Y,{item:o,sectionId:t.id,onUpdateItem:a,onAskItem:c,onDeleteExplanation:h,onAddAsItem:n},o.id)),l&&e.jsx(bs,{onClick:p,isGenerating:m}),w.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(M,{size:12}),w.length," gelÃ¶schte ",w.length===1?"Punkt":"Punkte"]}),w.map(o=>e.jsx(Y,{item:o,sectionId:t.id,onUpdateItem:a,onAskItem:c,onDeleteExplanation:h,onAddAsItem:n},o.id))]})]}):C==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ee,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(me,{content:z})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},X=({onClick:t,disabled:a,loading:l,icon:c,danger:h,title:n})=>e.jsx("button",{onClick:t,disabled:a,title:n,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${h?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:l?e.jsx(E,{size:16,className:"animate-spin"}):e.jsx(c,{size:16})}),js=({variables:t,isExpanded:a,onToggle:l})=>!t||Object.keys(t).length===0?null:e.jsxs(q,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:l,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(t).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:a?"Einklappen":"Ausklappen"}),a?e.jsx(Q,{size:16}):e.jsx(J,{size:16})]})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(t).map(([c,h])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[ps(c),":"]})," ",h]},c))})]}),ys=({isOpen:t,onClose:a,onConfirm:l,isDeleting:c})=>e.jsx(as,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(Z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{variant:"secondary",onClick:a,disabled:c,fullWidth:!0,children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:l,disabled:c,icon:c?e.jsx(E,{size:16,className:"animate-spin"}):e.jsx(M,{size:16}),fullWidth:!0,children:c?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),Ss=({briefing:t,onBack:a,onDelete:l})=>{const{config:c}=os(),h=ds(),[n,d]=i.useState(t),[g,m]=i.useState(!t?.sections),[u,p]=i.useState(null),[v,C]=i.useState({}),[_,z]=i.useState(!1),[S,w]=i.useState(!1),[B,o]=i.useState(!1),[A,N]=i.useState(!1),I=hs(n?.template_icon)||U;i.useEffect(()=>{const r=async()=>{if(n?.sections){const s={};n.sections.forEach(x=>{s[x.id]=!0}),C(s),m(!1);return}try{m(!0);const s=await L.request(`/smartbriefing/briefings/${n.id}`,{method:"GET"});if(s.success&&s.data?.briefing){d(s.data.briefing);const x={};s.data.briefing.sections?.forEach(f=>{x[f.id]=!0}),C(x)}else throw new Error("Fehler beim Laden des Briefings")}catch(s){console.error("[SmartBriefing] Error fetching briefing:",s),p(s.message)}finally{m(!1)}};n?.id&&r()},[n?.id]);const D=i.useCallback(r=>{C(s=>({...s,[r]:!s[r]}))},[]),F=i.useCallback(async(r,s,x)=>{const f=await L.request(`/smartbriefing/sections/${r}/items/${s}`,{method:"PATCH",body:JSON.stringify(x)});if(!f.success)throw new Error("Fehler beim Speichern");d(y=>({...y,sections:y.sections.map(j=>j.id===r?f.data.section:j)}))},[]),P=i.useCallback(async r=>{const s=await L.request(`/smartbriefing/sections/${r}/generate-more`,{method:"POST"});if(!s.success)throw new Error(s.message||"Fehler beim Generieren");return d(x=>({...x,sections:x.sections.map(f=>f.id===r?s.data.section:f)})),s.data.new_items_count},[]),O=i.useCallback(async(r,s,x)=>{const f=await L.askBriefingItem(r,s,x);return d(y=>({...y,sections:y.sections.map(j=>{if(j.id!==r)return j;const b=j.ai_content?.items?.map(k=>k.id===s?f.item:k);return{...j,ai_content:{...j.ai_content,items:b}}})})),f},[]),K=i.useCallback(async(r,s,x)=>{await L.deleteBriefingItemExplanation(r,s,x),d(f=>({...f,sections:f.sections.map(y=>{if(y.id!==r)return y;const j=y.ai_content?.items?.map(b=>b.id!==s?b:{...b,ai_explanations:(b.ai_explanations||[]).filter(k=>k.id!==x)});return{...y,ai_content:{...y.ai_content,items:j}}})}))},[]),H=i.useCallback(async(r,s,x)=>{const f=`Vertiefung: ${x}`,y=s.length>200?s.substring(0,200)+"...":s;d(j=>({...j,sections:j.sections.map(b=>{if(b.id!==r)return b;const k={id:crypto.randomUUID(),label:f,content:y,user_note:`VollstÃ¤ndige KI-Antwort:

${s}`,deleted:!1,ai_explanations:[]};return{...b,ai_content:{...b.ai_content,items:[...b.ai_content?.items||[],k]}}})}))},[]),T=i.useCallback(async()=>{if(!(A||!n?.id)){N(!0);try{const r=await L.request(`/smartbriefing/briefings/${n.id}/pdf`,{method:"GET"});if(!r.success||!r.data?.pdf_base64)throw new Error(r.message||"PDF-Export fehlgeschlagen");const s=atob(r.data.pdf_base64),x=new Array(s.length);for(let k=0;k<s.length;k++)x[k]=s.charCodeAt(k);const f=new Uint8Array(x),y=new Blob([f],{type:"application/pdf"}),j=window.URL.createObjectURL(y),b=document.createElement("a");b.href=j,b.download=r.data.filename||"Smart-Briefing.pdf",document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(j)}catch(r){console.error("[SmartBriefing] PDF download error:",r)}finally{N(!1)}}},[n?.id,A]),G=async()=>{if(!(!l||!n?.id)){o(!0);try{await l(n)}catch(r){console.error("Failed to delete briefing:",r)}finally{o(!1),w(!1)}}};return n?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 py-5 md:px-8 md:py-6",style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[a&&e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(ss,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx("div",{className:"w-[90px] h-[90px] rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(I,{size:40,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:n.template_title})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:n.title||"Briefing"}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(re,{size:14}),cs(n.created_at)]})})]}),e.jsxs("div",{className:"flex gap-2.5 flex-shrink-0",children:[e.jsx(X,{onClick:T,disabled:A,loading:A,icon:ts,title:"Als PDF herunterladen"}),l&&e.jsx(X,{onClick:()=>w(!0),icon:M,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${h?"p-4":"px-8 py-6"}`,children:[e.jsx(js,{variables:n.variables,isExpanded:_,onToggle:()=>z(!_)}),g&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(E,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),u&&!g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:u})}),!g&&!u&&n.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[n.sections.length," Abschnitte"]})]}),n.sections.map(r=>e.jsx(fs,{section:r,onUpdateItem:F,onGenerateMore:P,onAskItem:O,onDeleteExplanation:K,onAddAsItem:H,isExpanded:v[r.id],onToggle:()=>D(r.id)},r.id))]}),!g&&!u&&(!n.sections||n.sections.length===0)&&n.content_markdown&&e.jsx(q,{className:"p-6",children:e.jsx(me,{content:n.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(le,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(ys,{isOpen:S,onClose:()=>w(!1),onConfirm:G,isDeleting:B})]}):null};export{Ss as B,hs as a,zs as g};
