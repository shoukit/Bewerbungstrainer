import{j as e,O as q,L as G,z as ge,v as Ns,Q as ke,g as ye,Y as ys,_ as Ke,m as E,V as Ee,M as be,$ as cs,F as vs,a0 as fe,a1 as Re,y as we,C as ws,A as ks,f as He,a2 as Ss,a3 as Is,a4 as Ae,a5 as Ds,a6 as Ks,a7 as qs,w as As,a8 as os,a9 as Hs,h as oe,l as $e,d as _e,aa as ds,ab as xs,c as Ce,ac as Ys,s as Xs,ad as Js,a as Ye,H as ms,p as hs,t as us,ae as Zs}from"./ui-vendor-CgXEyNXi.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{B as X,C as U}from"./Button-j0YrfSxa.js";import{S as Me,a as Qs}from"./select-native-BxSPgKHW.js";import{u as _s,D as et,g as ve,a as ce,m as J,l as je,C as R,n as de,I as F,w as Y}from"./FeatureInfoButton-Dhrvh00g.js";import{D as st,a as tt,b as at,c as nt,d as it,e as rt}from"./dialog-dwOizz02.js";import{b as lt,p as ct,d as ot,e as dt,h as xt,i as mt,j as ht,g as ut}from"./index.js";import{u as Se}from"./useMobile-YxjH166V.js";import{R as pt}from"./RoleplaySessionReport-Cyv5smOw.js";import{g as gt,B as ft}from"./BriefingWorkbook-C8vM0aTh.js";import{D as jt,a as bt}from"./DecisionBoardResult-CCelUTuh.js";import{I as Nt,a as yt}from"./IkigaiResults-Bvblprfi.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./input-lfaX5RPk.js";import"./textarea-CvyTjNsl.js";import"./AudioRecorder-C5EmPNuu.js";import"./button-ZJ-ZV28u.js";import"./card-h-69AINb.js";import"./DeviceSettingsDialog-DGZHcDR3.js";import"./DeviceSetupPage-BPt12dL8.js";import"./MicrophoneTestDialog-CxIdSzZQ.js";const xe=({isOpen:s,onClose:a,onConfirm:n,title:g="L√∂schen best√§tigen",description:d="Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:r=!1,confirmLabel:x="L√∂schen",cancelLabel:h="Abbrechen"})=>{const{branding:b}=_s(),p=b?.["--primary-accent"]||et["--primary-accent"];return e.jsx(st,{open:s,onOpenChange:a,children:e.jsxs(tt,{className:"max-w-[400px]",children:[e.jsxs(at,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-white"})}),e.jsx(nt,{children:g})]}),e.jsx(it,{children:d})]}),e.jsxs(rt,{className:"mt-4",children:[e.jsx("button",{onClick:a,disabled:r,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg bg-white text-sm font-medium transition-all hover:bg-slate-50",style:{border:`2px solid ${p}`,color:p,cursor:r?"not-allowed":"pointer",opacity:r?.5:1},children:h}),e.jsx("button",{onClick:n,disabled:r,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg border-none bg-gradient-to-br from-red-500 to-red-600 text-white text-sm font-medium transition-all inline-flex items-center justify-center gap-2 hover:opacity-90",style:{cursor:r?"not-allowed":"pointer",opacity:r?.5:1},children:r?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin"}),x,"..."]}):x})]})]})})},vt={auftreten:Hs,selbstbewusstsein:os,koerpersprache:As,kommunikation:be,professionalitaet:os,inhalt:we},wt=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"Weiter √ºben!",kt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",St=s=>s==="video"?"Wirkungs-Analyse":s==="roleplay"?"Live-Simulation":"Szenario-Training",It=({score:s,size:a=120,isHeader:n=!1})=>{const g=Math.min(100,Math.max(0,s||0)),d=(a-12)/2,r=d*2*Math.PI,x=r-g/100*r,h=J(s);return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:n?"rgba(255,255,255,0.3)":R.slate[200],strokeWidth:10}),e.jsx(E.circle,{cx:a/2,cy:a/2,r:d,fill:"none",stroke:h,strokeWidth:10,strokeLinecap:"round",strokeDasharray:r,initial:{strokeDashoffset:r},animate:{strokeDashoffset:x},transition:{duration:1,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{style:{fontSize:a/3.5,fontWeight:700,color:h},children:Math.round(s)}),e.jsx("span",{className:`${n?"text-white":"text-slate-500"}`,style:{fontSize:a/10},children:"von 100"})]})]})},Dt=({audioUrl:s,durationHint:a})=>{const n=o.useRef(null),[g,d]=o.useState(!1),[r,x]=o.useState(0),[h,b]=o.useState(a||0),[p,c]=o.useState(!0),[D,w]=o.useState(null);o.useEffect(()=>{if(!s)return;c(!0),w(null),b(a||0);const m=new Audio;n.current=m;const z=()=>{const _=m.duration;_&&isFinite(_)&&_>0&&b(_),c(!1)},T=()=>{const _=m.duration;_&&isFinite(_)&&_>0&&b(_)},I=()=>{c(!1);const _=m.duration;_&&isFinite(_)&&_>0&&b(_)};return m.addEventListener("loadedmetadata",z),m.addEventListener("durationchange",T),m.addEventListener("canplaythrough",I),m.addEventListener("timeupdate",()=>x(m.currentTime)),m.addEventListener("play",()=>d(!0)),m.addEventListener("pause",()=>d(!1)),m.addEventListener("ended",()=>d(!1)),m.addEventListener("error",()=>{w("Audio nicht verf√ºgbar"),c(!1)}),m.src=s,m.load(),()=>{m.pause(),m.removeEventListener("loadedmetadata",z),m.removeEventListener("durationchange",T),m.removeEventListener("canplaythrough",I),m.src=""}},[s,a]);const N=()=>{n.current&&(g?n.current.pause():n.current.play())},k=m=>{const z=m.currentTarget.getBoundingClientRect(),T=(m.clientX-z.left)/z.width;n.current&&(n.current.currentTime=T*h)},O=m=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+m,h)))};if(D)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-slate-500 text-[13px] flex items-center gap-2",children:[e.jsx(ge,{size:16})," ",D]});if(!s)return null;const A=h>0?r/h*100:0;return e.jsxs(U,{className:"p-5",children:[e.jsx("div",{onClick:k,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${A}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>O(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})}),e.jsx("button",{onClick:N,disabled:p,className:`w-12 h-12 rounded-full bg-primary border-none flex items-center justify-center text-white ${p?"cursor-wait opacity-70":"cursor-pointer"}`,children:p?e.jsx(G,{size:22,className:"animate-spin"}):g?e.jsx(Is,{size:22,fill:"white"}):e.jsx(Ae,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>O(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ds,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[je(r)," / ",je(h)]})]})},At=({sessionId:s,conversationId:a})=>{const n=o.useRef(null),[g,d]=o.useState(!1),[r,x]=o.useState(!1),[h,b]=o.useState(0),[p,c]=o.useState(0),[D,w]=o.useState(null),[N,k]=o.useState(!0);o.useEffect(()=>{if(!a){k(!1),w("Keine Audio-Aufnahme verf√ºgbar");return}const T=mt(s);return k(!0),w(null),fetch(T,{headers:{"X-WP-Nonce":ce()},credentials:"same-origin"}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}`);return I.blob()}).then(I=>{const _=URL.createObjectURL(I),y=new Audio(_);n.current=y,y._objectUrl=_,y.addEventListener("loadedmetadata",()=>{c(y.duration),k(!1)}),y.addEventListener("timeupdate",()=>b(y.currentTime)),y.addEventListener("play",()=>d(!0)),y.addEventListener("pause",()=>d(!1)),y.addEventListener("ended",()=>d(!1)),y.addEventListener("error",()=>{w("Audio konnte nicht abgespielt werden."),k(!1)})}).catch(()=>{w("Audio nicht verf√ºgbar."),k(!1)}),()=>{n.current&&(n.current.pause(),n.current._objectUrl&&URL.revokeObjectURL(n.current._objectUrl),n.current=null)}},[s,a]);const O=()=>{n.current&&(g?n.current.pause():n.current.play())},A=()=>{n.current&&(n.current.muted=!r,x(!r))},m=T=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+T,p)))},z=T=>{const I=T.currentTarget.getBoundingClientRect(),_=(T.clientX-I.left)/I.width;n.current&&(n.current.currentTime=_*p)};return N?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(G,{size:24,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:"Audio wird geladen..."})]}):D?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ge,{size:24,className:"text-slate-400 mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:D})]}):e.jsxs(U,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(He,{size:18,className:"text-primary"})," Gespr√§chsaufnahme"]}),e.jsx("div",{onClick:z,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${h/p*100||0}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>m(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})}),e.jsx("button",{onClick:O,className:"w-12 h-12 rounded-full bg-primary border-none cursor-pointer flex items-center justify-center text-white",children:g?e.jsx(Is,{size:22,fill:"white"}):e.jsx(Ae,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>m(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ds,{size:20})}),e.jsx("button",{onClick:A,className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600 ml-auto",children:r?e.jsx(Ks,{size:20}):e.jsx(qs,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[je(h)," / ",je(p)]})]})},_t=({entry:s})=>{const a=s.role==="user";return e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${a?"bg-primary":"bg-slate-200"}`,children:e.jsx(As,{size:16,className:a?"text-white":"text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-semibold mb-1 ${a?"text-primary":"text-slate-400"}`,children:a?"Du":"Interviewer"}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed m-0",children:s.text||s.message})]})]})},Ct=({answer:s,index:a})=>{const[n,g]=o.useState(!1),d=s.feedback?typeof s.feedback=="string"?JSON.parse(s.feedback):s.feedback:null,r=s.audio_analysis?typeof s.audio_analysis=="string"?JSON.parse(s.audio_analysis):s.audio_analysis:null,x=s.transcript==="[Keine Sprache erkannt]"||r?.speech_rate==="keine_sprache";return e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},children:e.jsxs(U,{className:"mb-4 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>g(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3 text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center text-primary font-bold text-sm flex-shrink-0",children:a+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 truncate",children:s.question_text||`Frage ${a+1}`})}),s.overall_score!=null&&e.jsx("span",{className:"text-base font-bold",style:{color:x?R.slate[400]:J(s.overall_score*10)},children:x?"‚Äì":`${Math.round(s.overall_score*10)}%`}),e.jsx(ws,{size:18,className:`text-slate-400 transition-transform ${n?"rotate-180":""}`})]}),e.jsx(ks,{children:n&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-5 pb-5 pt-4 border-t border-slate-100",children:[s.question_text&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(be,{size:14,className:"text-primary"})," Frage / Situation"]}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed bg-primary/5 p-3 rounded-lg m-0 border border-primary/10",children:s.question_text})]}),s.audio_url&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(He,{size:14,className:"text-primary"})," Deine Aufnahme"]}),e.jsx(Dt,{audioUrl:s.audio_url,durationHint:s.audio_duration_seconds})]}),s.transcript&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(vs,{size:14,className:"text-primary"})," Transkript"]}),e.jsxs("p",{className:`text-[13px] leading-relaxed bg-slate-50 p-3 rounded-lg m-0 italic break-words ${x?"text-slate-400":"text-slate-600"}`,children:['"',s.transcript,'"']})]}),d?.scores&&!x&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2.5 flex items-center gap-1.5",children:[e.jsx(fe,{size:14,className:"text-primary"})," Bewertung"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Pr√§sentation"}].map(({key:h,label:b})=>{const p=d.scores[h],c=p!=null?p*10:null;return e.jsxs("div",{className:"p-2.5 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-base font-bold",style:{color:c!=null?J(c):R.slate[400]},children:c!=null?Math.round(c):"-"}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:b})]},h)})}),(()=>{const h=d.scores.overall,b=h!=null?h*10:null;return e.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg text-center border border-primary/20 flex items-center justify-center gap-3",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:"Gesamt"}),e.jsx("div",{className:"text-xl font-bold",style:{color:b!=null?J(b):R.slate[400]},children:b!=null?Math.round(b):"-"})]})})()]}),d?.summary&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-3",children:d.summary}),d?.strengths?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1.5 flex items-center gap-1",children:[e.jsx(Re,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.strengths.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),d?.improvements?.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1.5 flex items-center gap-1",children:[e.jsx(ge,{size:12})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.improvements.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),d?.tips?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-primary mb-1.5 flex items-center gap-1",children:[e.jsx(we,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.tips.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),r&&!x&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-3 flex items-center gap-1.5",children:[e.jsx(He,{size:14,className:"text-primary"})," Sprechanalyse"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[r.speech_rate&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Sprechtempo"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 capitalize",children:r.speech_rate==="optimal"?"‚úì Optimal":r.speech_rate==="zu_schnell"?"‚ö° Zu schnell":r.speech_rate==="zu_langsam"?"üê¢ Zu langsam":r.speech_rate})]}),r.filler_words&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"F√ºllw√∂rter"}),e.jsxs("div",{className:`text-sm font-semibold ${r.filler_words.count<=2?"text-green-600":r.filler_words.count<=5?"text-amber-600":"text-red-600"}`,children:[r.filler_words.count||0," erkannt"]}),r.filler_words.words?.length>0&&e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:r.filler_words.words.slice(0,5).join(", ")})]}),r.confidence_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Selbstsicherheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:J(r.confidence_score)},children:[r.confidence_score,"%"]})]}),r.clarity_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Klarheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:J(r.clarity_score)},children:[r.clarity_score,"%"]})]})]}),r.notes&&e.jsx("p",{className:"text-xs text-slate-500 mt-2.5 italic",children:r.notes})]})]})})})]})})},Et=({isOpen:s,onClose:a,onConfirm:n,isDeleting:g})=>s?e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:a,children:e.jsxs(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl p-6 max-w-[400px] w-[90%] shadow-2xl",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(q,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Session l√∂schen?"})]}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:"M√∂chtest du diese Session wirklich l√∂schen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:a,disabled:g,children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:n,disabled:g,icon:g?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(q,{size:16}),children:g?"L√∂schen...":"L√∂schen"})]})]})}):null,zt=({category:s})=>{const[a,n]=o.useState(!1),g=vt[s.category]||fe,d=J(s.score);return e.jsxs(U,{className:"mb-2.5 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>n(!a),className:"w-full p-3.5 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{backgroundColor:`${d}15`},children:e.jsx(g,{size:18,style:{color:d}})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})}),e.jsxs("span",{className:"text-base font-bold",style:{color:d},children:[Math.round(s.score),"%"]}),e.jsx(ws,{size:18,className:`text-slate-400 transition-transform ${a?"rotate-180":""}`})]}),e.jsx(ks,{children:a&&e.jsx(E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-3 border-t border-slate-100",children:[s.feedback&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-2.5",children:s.feedback}),s.strengths?.length>0&&e.jsxs("div",{className:"mb-2.5",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1 flex items-center gap-1",children:[e.jsx(Re,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.strengths.map((r,x)=>e.jsx("li",{children:r},x))})]}),s.improvements?.length>0&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1 flex items-center gap-1",children:[e.jsx(we,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.improvements.map((r,x)=>e.jsx("li",{children:r},x))})]})]})})})]})},Lt=({session:s,type:a,scenario:n,onBack:g,onContinueSession:d,onRepeatSession:r,onDeleteSession:x})=>{const h=Se(),[b,p]=o.useState(!1);o.useEffect(()=>{const i=()=>{const f=window.innerWidth;p(f>=768&&f<1200)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const[c,D]=o.useState([]),[w,N]=o.useState(!0),[k,O]=o.useState(null),[A,m]=o.useState(!1),[z,T]=o.useState(!1),[I,_]=o.useState(!1),[y,me]=o.useState(null),[te,Ne]=o.useState(n),B=a==="video",P=a==="simulator",W=a==="roleplay",he=(()=>{const i=s?.questions||s?.questions_json;if(!i)return!1;try{const f=typeof i=="string"?JSON.parse(i):i;return Array.isArray(f)&&f.length>0}catch{return!1}})(),S=(()=>{if(!P||!he)return!1;const i=s?.total_questions||0,f=s?.completed_questions||0;return i>0&&f<i})(),V=async()=>{if(x){T(!0);try{await x(s,a)}catch(i){console.error("Failed to delete session:",i),T(!1),m(!1)}}},H=async()=>{if(!(I||!s?.id)){_(!0);try{let i;if(P)i=`${ve()}/simulator/sessions/${s.id}/export-pdf`;else if(B)i=`${ve()}/video-training/sessions/${s.id}/export-pdf`;else if(W)i=`${ve()}/sessions/${s.id}/export-pdf`;else throw new Error("Unsupported session type for PDF export");const f=await fetch(i,{method:"POST",headers:{"X-WP-Nonce":ce(),"Content-Type":"application/json"},credentials:"same-origin"}),C=await f.json();if(!f.ok)throw new Error(C.error||`HTTP ${f.status}`);if(!C.success||!C.pdf_base64)throw new Error(C.error||"PDF generation failed");const re=atob(C.pdf_base64),Ie=new Array(re.length);for(let le=0;le<re.length;le++)Ie[le]=re.charCodeAt(le);const ue=new Uint8Array(Ie),Fe=new Blob([ue],{type:C.content_type||"application/pdf"}),De=window.URL.createObjectURL(Fe),ee=document.createElement("a");ee.href=De,ee.download=C.filename||"Training.pdf",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),window.URL.revokeObjectURL(De)}catch(i){console.error("Failed to download PDF:",i)}finally{_(!1)}}};o.useEffect(()=>{P&&s?.id?Be():W&&s?.id?ze():N(!1)},[s?.id,a]);const Be=async()=>{try{N(!0);const f=await(await fetch(`${ve()}/simulator/sessions/${s.id}/answers`,{headers:{"X-WP-Nonce":ce()}})).json();f.success&&f.data?.answers?D(f.data.answers):Array.isArray(f.data)&&D(f.data)}catch(i){console.error("Failed to load answers:",i),O("Fehler beim Laden der Antworten")}finally{N(!1)}},ze=async()=>{try{N(!0);const i=await lt(s.id);if(me({...s,...i,feedback:dt(i.feedback_json||s.feedback_json),audioAnalysis:ot(i.audio_analysis_json||s.audio_analysis_json),transcript:ct(i.transcript||s.transcript)}),!n&&i.scenario_id)try{const f=await xt(i.scenario_id);Ne(f)}catch(f){console.warn("Could not load scenario:",f)}}catch(i){console.error("Failed to load roleplay data:",i),O("Fehler beim Laden der Gespr√§chsdaten")}finally{N(!1)}},Z=s?.summary_feedback_json?typeof s.summary_feedback_json=="string"?JSON.parse(s.summary_feedback_json):s.summary_feedback_json:null,$=s?.category_scores||[],Q=s?.analysis||{},ie=(()=>{let i=0;return W&&y?.feedback?.rating?.overall?i=y.feedback.rating.overall:i=s?.overall_score||Z?.overall_score||0,(P||W)&&i<=10?i*10:i})();return w?e.jsx("div",{className:"w-full min-h-[60vh] flex items-center justify-center p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{size:48,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-4",children:"Analyse wird geladen..."})]})}):k?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ge,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-600 mb-6",children:k}),e.jsx(X,{variant:"secondary",onClick:g,children:"Zur√ºck"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 overflow-hidden max-w-full",children:[e.jsx("div",{className:`sticky top-0 z-40 ${h?"px-4 py-5":"px-8 py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[g&&e.jsxs("button",{onClick:g,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ns,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx(It,{score:ie,size:100,isHeader:!0}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:St(a)}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:J(ie)},children:wt(ie)})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:(W?te?.title:n?.title)||s?.scenario_title||s?.position||"Training"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ke,{size:14}),kt(s?.created_at)]}),s?.duration&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ye,{size:14}),je(s.duration)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:H,disabled:I,title:"Als PDF herunterladen",className:`flex items-center justify-center bg-white/20 border border-white/30 rounded-lg px-3 py-2.5 text-white outline-none transition-colors hover:bg-white/30 ${I?"cursor-wait opacity-70":"cursor-pointer"}`,children:I?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(ys,{size:16})}),!h&&r&&e.jsxs("button",{onClick:()=>r(s,n),className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-lg px-5 py-2.5 cursor-pointer text-white text-sm font-medium outline-none hover:bg-white/30 transition-colors",children:[e.jsx(Ke,{size:16}),"Erneut √ºben"]}),x&&e.jsx("button",{onClick:()=>m(!0),className:`flex items-center gap-2 bg-red-500/20 border border-red-500/40 rounded-lg cursor-pointer text-white text-sm font-medium outline-none hover:bg-red-500/30 transition-colors ${h?"px-3 py-2.5":"px-4 py-2.5"}`,children:e.jsx(q,{size:16})})]})]})]})}),e.jsx("div",{className:`overflow-hidden ${h?"p-4":"px-8 py-6"}`,children:e.jsxs("div",{className:"grid gap-6 overflow-hidden",style:{gridTemplateColumns:h||b?"1fr":"1fr 400px"},children:[e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[B&&s?.video_url&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(Ee,{size:18,className:"text-primary"})," Deine Aufnahme"]}),e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]})}),P&&c.length>0&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(be,{size:18,className:"text-primary"})," Deine Antworten (",c.length,")"]}),c.map((i,f)=>e.jsx(Ct,{answer:i,index:f},i.id||f)),S&&(d||r)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap mt-6 p-5 bg-slate-50 rounded-xl border border-dashed border-slate-300",children:[e.jsx("p",{className:"w-full text-center text-slate-600 text-sm mb-3",children:"Diese Session ist noch nicht abgeschlossen."}),d&&e.jsx(X,{onClick:()=>d(s,n),icon:e.jsx(cs,{size:18}),children:"Fortsetzen"}),r&&e.jsx(X,{variant:"secondary",onClick:()=>r(s,n),icon:e.jsx(Ke,{size:18}),children:"Erneut starten"})]})]}),P&&c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6 bg-slate-50 rounded-2xl",children:[e.jsx(ge,{size:48,className:"text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Keine Antworten vorhanden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:he?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),S&&(d||r)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap",children:[d&&e.jsx(X,{onClick:()=>d(s,n),icon:e.jsx(cs,{size:18}),children:"Fortsetzen"}),r&&e.jsx(X,{variant:"secondary",onClick:()=>r(s,n),icon:e.jsx(Ke,{size:18}),children:"Erneut starten"})]})]}),W&&y&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-5",children:e.jsx(At,{sessionId:s.id,conversationId:y.conversation_id})}),W&&y?.transcript?.length>0&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(U,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(vs,{size:18,className:"text-primary"})," Gespr√§chsverlauf"]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:y.transcript.map((i,f)=>e.jsx(_t,{entry:i},f))})]})})]}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[B&&$.length>0&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-primary"})," Detaillierte Bewertung"]}),$.map((i,f)=>e.jsx(zt,{category:i},i.category||f))]}),B&&(Q.key_strengths?.length>0||Q.actionable_tips?.length>0)&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(U,{className:"mb-5 p-5",children:[Q.key_strengths?.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(Re,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:Q.key_strengths.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},f))})]}),Q.actionable_tips?.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-primary mb-2.5 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-5",children:Q.actionable_tips.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},f))})]})]})}),B&&s?.summary_feedback&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:s.summary_feedback})]})}),P&&Z&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[Z.summary&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:Z.summary})]}),Z.scores&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Bewertung"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:Object.entries(Z.scores).map(([i,f])=>{const C=f!=null?f*10:null;return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-xl font-bold",style:{color:J(C)},children:C!=null?Math.round(C):"-"}),e.jsx("div",{className:"text-[11px] text-slate-500 capitalize",children:i})]},i)})})]}),Z.key_takeaways?.length>0&&e.jsxs("div",{className:"bg-green-50 rounded-2xl p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Wichtigste Erkenntnisse"]}),e.jsx("ul",{className:"m-0 pl-5 text-[13px] text-slate-900 leading-snug",children:Z.key_takeaways.map((i,f)=>e.jsx("li",{className:"mb-1.5",children:i},f))})]})]}),W&&y?.feedback&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[y.feedback.rating&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-primary"})," Bewertungskriterien"]}),e.jsx("div",{className:"flex flex-col gap-2.5",children:Object.entries(y.feedback.rating).filter(([i])=>i!=="overall").map(([i,f])=>{const C=f*10;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"flex-1 text-[13px] font-medium text-slate-900 capitalize",children:i.replace(/_/g," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-1.5 bg-slate-200 rounded",children:e.jsx("div",{className:"h-full rounded",style:{width:`${C}%`,backgroundColor:J(C)}})}),e.jsx("span",{className:"text-sm font-semibold min-w-[45px]",style:{color:J(C)},children:Math.round(C)})]})]},i)})})]}),y.feedback.strengths?.length>0&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-3 flex items-center gap-1.5",children:[e.jsx(Re,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:y.feedback.strengths.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},f))})]}),y.feedback.improvements?.length>0&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-amber-600 mb-3 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:y.feedback.improvements.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},f))})]}),y.feedback.summary&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:y.feedback.summary})]})]}),W&&!y?.feedback&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ge,{size:32,className:"text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 m-0",children:"Keine Analyse verf√ºgbar f√ºr dieses Gespr√§ch."})]})]})]})}),e.jsx(Et,{isOpen:A,onClose:()=>m(!1),onConfirm:V,isDeleting:z})]})},Ot=({briefing:s,onClick:a,onDelete:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=Se(900),D=gt(s.template_icon),w=k=>{k.stopPropagation(),p(!0)},N=async()=>{h(!0);try{await n(s.id),p(!1)}catch(k){console.error("Error deleting briefing:",k)}finally{h(!1)}};return c?e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-[22px] h-[22px] text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.title||"Briefing"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2.5 py-1 rounded-[10px] text-xs font-medium max-w-[70%] overflow-hidden text-ellipsis whitespace-nowrap",children:s.template_title}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:N,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:s.title||"Briefing"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-[10px] text-xs font-medium",children:s.template_title}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:N,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},ne={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},Tt=({session:s,type:a,scenario:n,onClick:g,onContinueSession:d,onDeleteSession:r,headerGradient:x,headerText:h,primaryAccent:b})=>{const[p,c]=o.useState(!1),[D,w]=o.useState(!1),N=Se(900),k=()=>{let S=null;if(a===ne.SIMULATOR)S=s.overall_score||s.average_score;else if(a===ne.VIDEO)S=s.overall_score;else if(s.feedback_json)try{let V=s.feedback_json;if(typeof V=="string"){let H=V.trim();H.startsWith("```json")?H=H.replace(/```json\s*/g,"").replace(/```\s*$/g,""):H.startsWith("```")&&(H=H.replace(/```\s*/g,"").replace(/```\s*$/g,"")),V=JSON.parse(H)}S=V.rating?.overall||null}catch{S=null}return S==null||isNaN(S)||S===0?null:S},O=()=>a===ne.SIMULATOR||a===ne.VIDEO?s.status:s.feedback_json?"completed":"pending",A=k(),z=O()==="completed",T=s.total_questions>0&&(s.completed_questions||0)<s.total_questions,I=a===ne.SIMULATOR&&T,_=()=>{if(!I)return null;const S=s.completed_questions||0,V=s.total_questions||0;return`${S}/${V} Fragen`},y=S=>{S.stopPropagation(),d&&d(s,n)},me=S=>{S.stopPropagation(),w(!0)},te=async()=>{c(!0);try{await r(s,a),w(!1)}catch(S){console.error("Error deleting session:",S)}finally{c(!1)}},B=(()=>{if(A==null||isNaN(A))return null;if(a===ne.SIMULATOR||a===ne.ROLEPLAY){const S=A<=10?A*10:A;return isNaN(S)?null:S}return isNaN(A)?null:A})(),P=S=>{if(!S&&S!==0)return{background:R.slate[100],color:R.slate[500]};const V=parseFloat(S);return V>=80?{background:R.green[100],color:R.green[800]}:V>=60?{background:R.amber[100],color:R.amber[800]}:{background:R.red[100],color:R.red[800]}},he=(()=>{switch(a){case ne.SIMULATOR:return $e;case ne.VIDEO:return Ee;default:return be}})();return N?e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:g,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(he,{className:"w-[22px] h-[22px]",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3]",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),r&&e.jsx("button",{onClick:me,disabled:p,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600 hover:bg-slate-100 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:p?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(ye,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full text-[13px] font-semibold",style:P(B),children:[e.jsx(fe,{size:13}),B!==null?`${Math.round(B)}%`:"-- %"]}),(s.duration||s.video_duration_seconds)&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(ye,{size:12}),je(s.duration||s.video_duration_seconds)]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:_()})]}),I&&d?e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-4 py-2.5 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:shadow-lg transition-shadow shrink-0",children:[e.jsx(Ae,{size:14}),"Fortsetzen"]}):e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:D,onClose:()=>w(!1),onConfirm:te,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:p})]}):e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:g,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(he,{className:"w-6 h-6",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]}),s.duration||s.video_duration_seconds?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{size:14}),je(s.duration||s.video_duration_seconds)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[I&&d&&e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:scale-105 hover:shadow-lg transition-all",children:[e.jsx(Ae,{size:14}),"Fortsetzen"]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:_()}),!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(ye,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-semibold",style:P(B),children:[e.jsx(fe,{size:14}),B!==null?`${Math.round(B)}%`:"-- %"]}),r&&e.jsx("button",{onClick:me,disabled:p,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:p?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:D,onClose:()=>w(!1),onConfirm:te,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:p})]})},ps=({proScore:s,contraScore:a})=>{const n=s+a,g=n>0?Math.round(s/n*100):50;return e.jsxs("div",{className:"h-1.5 rounded-[3px] overflow-hidden flex bg-slate-100 w-full max-w-[120px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full",style:{width:`${g}%`}}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 h-full",style:{width:`${100-g}%`}})]})},Mt=({decision:s,onClick:a,onDelete:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=Se(900),D=(s.pros||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),w=(s.cons||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),N=(s.pros||[]).filter(m=>m.text?.trim()).length,k=(s.cons||[]).filter(m=>m.text?.trim()).length,O=m=>{m.stopPropagation(),p(!0)},A=async()=>{h(!0);try{await n(s.id),p(!1)}catch(m){console.error("Error deleting decision:",m)}finally{h(!1)}};return c?e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(_e,{className:"w-[22px] h-[22px] text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.topic||"Entscheidung"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14,className:"text-green-600"}),e.jsx("span",{className:"text-[13px] font-medium text-green-600",children:N})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{size:14,className:"text-red-600"}),e.jsx("span",{className:"text-[13px] font-medium text-red-600",children:k})]}),e.jsx(ps,{proScore:D,contraScore:w})]}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:A,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(_e,{className:"w-6 h-6 text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1.5 whitespace-nowrap overflow-hidden text-ellipsis",children:s.topic||"Entscheidung"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14,className:"text-green-600"}),e.jsxs("span",{className:"font-medium text-green-600",children:[N," Pro"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{size:14,className:"text-red-600"}),e.jsxs("span",{className:"font-medium text-red-600",children:[k," Contra"]})]})]}),e.jsx(ps,{proScore:D,contraScore:w}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:A,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},Rt={love:{icon:Js,color:F.love.color,label:"Liebe"},talent:{icon:fe,color:F.talent.color,label:"Talent"},need:{icon:Xs,color:F.need.color,label:"Welt"},market:{icon:Ys,color:F.market.color,label:"Markt"}},gs=({dimensions:s})=>e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Object.entries(Rt).map(([a,n])=>{const g=s?.[a]||[],d=g.length>0,r=n.icon;return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-xl text-xs font-medium",style:{backgroundColor:d?`${n.color}15`:R.slate[100],color:d?n.color:R.slate[400],border:d?`1px solid ${n.color}30`:`1px solid ${R.slate[200]}`},children:[e.jsx(r,{size:12}),e.jsx("span",{children:g.length})]},a)})}),$t=({ikigai:s,onDelete:a,onNavigate:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=Se(900),D={love:s.love_tags||[],talent:s.talent_tags||[],need:s.need_tags||[],market:s.market_tags||[]},w=Object.values(D).filter(m=>m.length>0).length,N=s.status==="completed",k=s.paths?.[0]?.role_title||(N?"Ikigai-Analyse abgeschlossen":"Ikigai-Analyse"),O=m=>{m.stopPropagation(),p(!0)},A=async()=>{h(!0);try{await a(s.id),p(!1)}catch(m){console.error("Error deleting ikigai:",m)}finally{h(!1)}};return c?e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:n,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:N?`linear-gradient(135deg, ${F.love.color}, ${F.talent.color}, ${F.need.color}, ${F.market.color})`:`linear-gradient(135deg, ${R.indigo[500]}15, ${R.indigo[500]}30)`},children:e.jsx(Ce,{className:`w-[22px] h-[22px] ${N?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:k}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsx(gs,{dimensions:D}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:A,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:n,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:N?`linear-gradient(135deg, ${F.love.color}, ${F.talent.color}, ${F.need.color}, ${F.market.color})`:`linear-gradient(135deg, ${R.indigo[500]}15, ${R.indigo[500]}30)`},children:e.jsx(Ce,{className:`w-6 h-6 ${N?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 whitespace-nowrap overflow-hidden text-ellipsis",children:k}),N&&e.jsx("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-gradient-to-r from-green-500 to-green-600 text-white",children:"Abgeschlossen"}),!N&&w>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-amber-500/10 text-amber-500",children:[w,"/4 Dimensionen"]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsx(gs,{dimensions:D}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:b,onClose:()=>p(!1),onConfirm:A,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},Bt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Ft=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"In Arbeit",fs={ikigai:{label:"Ikigai-Kompass",icon:Ce},decision:{label:"Entscheidungs-Board",icon:_e},briefing:{label:"Smart Briefing",icon:Ye},simulator:{label:"Szenario-Training",icon:$e},video:{label:"Wirkungs-Analyse",icon:Ee},roleplay:{label:"Live-Simulation",icon:be}},Pt=({score:s,size:a=80})=>{const n=Math.min(100,Math.max(0,s||0)),g=(a-10)/2,d=g*2*Math.PI,r=d-n/100*d;return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"-rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:g,fill:"none",stroke:"rgba(255,255,255,0.25)",strokeWidth:8}),e.jsx(E.circle,{cx:a/2,cy:a/2,r:g,fill:"none",stroke:"#fff",strokeWidth:8,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:r},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx(E.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},className:"font-bold text-white leading-none",style:{fontSize:a/3},children:Math.round(s)})})]})},js=({type:s,title:a,subtitle:n,score:g,status:d,createdAt:r,duration:x,onBack:h,onDelete:b,onDownload:p,isDeleting:c=!1,isDownloading:D=!1,extraActions:w})=>{const N=Se(768),k=fs[s]||fs.simulator,O=k.icon,A=g!=null&&g>0;return e.jsx("div",{className:"sticky top-0 z-40 bg-brand-gradient",style:{padding:N?"20px 16px":"24px 32px"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[h&&e.jsxs("button",{onClick:h,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ns,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!N&&A&&e.jsx(Pt,{score:g,size:80}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[11px] font-semibold uppercase tracking-wider px-2.5 py-1 rounded-full bg-white/20 text-white",children:[e.jsx(O,{size:14}),k.label]}),A&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:J(g)},children:Ft(g)}),d==="in_progress"&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-amber-600",children:"In Bearbeitung"})]}),e.jsx("h1",{className:"font-bold text-white m-0 truncate",style:{fontSize:N?"20px":"24px",marginBottom:n?"4px":"8px"},children:a}),n&&e.jsx("p",{className:"text-sm text-white/80 m-0 mb-2",children:n}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[r&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ke,{size:14}),Bt(r)]}),x&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ye,{size:14}),Math.floor(x/60),":",String(x%60).padStart(2,"0")," Min."]})]})]}),e.jsxs("div",{className:"flex gap-3 flex-shrink-0",children:[p&&e.jsxs("button",{onClick:p,disabled:D,title:"Als PDF herunterladen",className:"flex items-center justify-center gap-1.5 bg-white/15 border-none rounded-lg text-white text-[13px] font-medium hover:bg-white/25 transition-colors disabled:opacity-70",style:{padding:N?"10px":"10px 16px",cursor:D?"wait":"pointer"},children:[e.jsx(ys,{size:16}),!N&&"PDF"]}),w,b&&e.jsxs("button",{onClick:b,disabled:c,title:"L√∂schen",className:"flex items-center justify-center gap-1.5 bg-red-500/20 border border-red-500/40 rounded-lg text-white text-[13px] font-medium hover:bg-red-500/30 transition-colors disabled:opacity-70",style:{padding:N?"10px":"10px 16px",cursor:c?"wait":"pointer"},children:[e.jsx(q,{size:16}),!N&&"L√∂schen"]})]})]})]})})},bs={love:{key:"love",label:"Liebe",icon:"‚ù§Ô∏è",color:F.love.color,question:"Vergiss mal Geld und Karriere. Bei welchen T√§tigkeiten vergisst du die Zeit?",placeholder:"Erz√§hle mir, was du wirklich liebst zu tun...",description:"Was du liebst"},talent:{key:"talent",label:"Talent",icon:"‚≠ê",color:F.talent.color,question:"Worin bist du richtig gut? Was f√§llt dir leicht, w√§hrend andere damit k√§mpfen?",placeholder:"Beschreibe deine St√§rken und F√§higkeiten...",description:"Worin du gut bist"},need:{key:"need",label:"Welt",icon:"üåç",color:F.need.color,question:"Welche Probleme der Welt w√ºrdest du gerne l√∂sen? Wo siehst du Bedarf?",placeholder:"Welchen Beitrag m√∂chtest du leisten...",description:"Was die Welt braucht"},market:{key:"market",label:"Markt",icon:"üí∞",color:F.market.color,question:"Wof√ºr werden Menschen in deinem Bereich bezahlt? Was ist gefragt?",placeholder:"Welche Berufe oder M√§rkte interessieren dich...",description:"Wof√ºr du bezahlt wirst"}},l={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings",DECISIONS:"decisions",IKIGAI:"ikigai"},qe=[{id:l.BRIEFINGS,label:"Smart Briefings",icon:Ye},{id:l.DECISIONS,label:"Entscheidungs-Kompass",icon:_e},{id:l.IKIGAI,label:"Ikigai-Kompass",icon:Ce},{id:l.SIMULATOR,label:"Szenario-Training",icon:$e},{id:l.VIDEO,label:"Wirkungs-Analyse",icon:Ee},{id:l.ROLEPLAY,label:"Live-Simulationen",icon:be}],da=l,xa=({onBack:s,onSelectSession:a,isAuthenticated:n,onLoginClick:g,onContinueSession:d,onRepeatSession:r,initialTab:x,onNavigateToModule:h})=>{const{branding:b,demoCode:p}=_s(),[c,D]=o.useState(x||l.BRIEFINGS);o.useEffect(()=>{x&&D(x)},[x]);const[w,N]=o.useState(null),[k,O]=o.useState(null);o.useEffect(()=>{window.scrollTo(0,0)},[c,w]);const[A,m]=o.useState([]),[z,T]=o.useState([]),[I,_]=o.useState([]),[y,me]=o.useState([]),[te,Ne]=o.useState([]),[B,P]=o.useState([]),[W,he]=o.useState([]),[S,V]=o.useState([]),[H,Be]=o.useState([]),[ze,Z]=o.useState(null),[$,Q]=o.useState(null),[Le,ie]=o.useState(null),[i,f]=o.useState(null),[C,re]=o.useState({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),[Ie,ue]=o.useState(null),[Fe,De]=o.useState(!1),[ee,le]=o.useState(!0),[Xe,Je]=o.useState(null);o.useEffect(()=>{n?Oe():le(!1)},[n]);const Oe=async()=>{le(!0),Je(null);try{const t=ve(),u=p?`&demo_code=${encodeURIComponent(p)}`:"",[j,v,M,K,se,ae,pe,Ws,Vs]=await Promise.all([ht({limit:50,...p&&{demo_code:p}}).catch(()=>({data:[]})),fetch(`${t}/simulator/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),Y.request(`/smartbriefing/briefings?limit=50${p?`&demo_code=${encodeURIComponent(p)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),Y.getDecisions().catch(()=>({success:!1,data:{decisions:[]}})),Y.getIkigais().catch(()=>({success:!1,data:{ikigais:[]}})),ut().catch(()=>[]),fetch(`${t}/simulator/scenarios`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/scenarios`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]}))]),We=(L,Te="sessions")=>Array.isArray(L?.data)?L.data:Array.isArray(L?.data?.[Te])?L.data[Te]:Array.isArray(L?.[Te])?L[Te]:Array.isArray(L)?L:[],Ve=L=>Array.isArray(L?.data?.scenarios)?L.data.scenarios:Array.isArray(L?.data)?L.data:Array.isArray(L)?L:[];m(We(j)),T(We(v)),_(We(M)),me(K?.data?.briefings||[]),Ne(se?.data?.decisions||[]),P(ae?.data?.ikigais||[]),he(Ve(pe)),V(Ve(Ws)),Be(Ve(Vs))}catch(t){console.error("Failed to load sessions:",t),Je(t.message||"Fehler beim Laden der Daten")}finally{le(!1)}},Ze=o.useMemo(()=>{const t={};return W.forEach(u=>{t[u.id]=u}),t},[W]),Qe=o.useMemo(()=>{const t={};return S.forEach(u=>{t[u.id]=u}),t},[S]),es=o.useMemo(()=>{const t={};return H.forEach(u=>{t[u.id]=u}),t},[H]),Cs=()=>{switch(c){case l.SIMULATOR:return z;case l.VIDEO:return I;case l.BRIEFINGS:return y;case l.DECISIONS:return te;case l.IKIGAI:return B;default:return A}},Es=()=>{switch(c){case l.SIMULATOR:return Qe;case l.VIDEO:return es;default:return Ze}},ss=A.length+z.length+I.length+y.length+te.length,ts=async t=>{(await Y.request(`/smartbriefing/briefings/${t}`,{method:"DELETE"})).success&&me(j=>j.filter(v=>v.id!==t))},zs=t=>{Z(t)},Ls=()=>{Z(null)},as=async t=>{(await Y.deleteDecision(t)).success&&Ne(j=>j.filter(v=>v.id!==t))},ns=async t=>{await Y.deleteIkigai(t)&&P(j=>j.filter(v=>v.id!==t))},Os=t=>{Q(t)},is=()=>{Q(null),ie(null)},Ts=t=>{f(t),re({love:{input:t.love_input||"",tags:t.love_tags||[]},talent:{input:t.talent_input||"",tags:t.talent_tags||[]},need:{input:t.need_input||"",tags:t.need_tags||[]},market:{input:t.market_input||"",tags:t.market_tags||[]}}),t.status==="completed"&&t.paths?ue({summary:t.summary,paths:t.paths}):ue(null)},Pe=()=>{f(null),re({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),ue(null)},Ms=async(t,u,j)=>{if(re(v=>({...v,[t]:{input:u,tags:j}})),i?.id)try{await Y.updateIkigai(i.id,{[`${t}_input`]:u,[`${t}_tags`]:j})}catch(v){console.error("[Ikigai] Failed to save dimension:",v)}},Rs=async(t,u)=>{try{return(await Y.extractIkigaiKeywords(t,u))?.keywords||[]}catch(j){return console.error("[Ikigai] Failed to extract keywords:",j),[]}},$s=(t,u)=>{re(j=>{const v=j[t].tags.filter(M=>M!==u);return{...j,[t]:{...j[t],tags:v}}})},Bs=async()=>{if(Object.values(C).every(u=>u.tags&&u.tags.length>0)){De(!0);try{const u=await Y.synthesizeIkigaiPaths({love_tags:C.love.tags,talent_tags:C.talent.tags,need_tags:C.need.tags,market_tags:C.market.tags});u&&(ue(u),i?.id&&(await Y.updateIkigai(i.id,{summary:u.summary,paths:u.paths,status:"completed"}),P(j=>j.map(v=>v.id===i.id?{...v,summary:u.summary,paths:u.paths,status:"completed"}:v))))}catch(u){console.error("[Ikigai] Failed to synthesize paths:",u)}finally{De(!1)}}},Fs=Object.values(C).every(t=>t.tags&&t.tags.length>0),Ps=t=>{Ne(u=>u.map(j=>j.id===t.id?t:j)),Q(t)},Us=t=>{N(t),O(c)},Ue=()=>{N(null),O(null)},Ge=async(t,u)=>{const j=ve();try{let v,M;switch(u){case l.SIMULATOR:v=`${j}/simulator/sessions/${t.id}`,M=()=>T(ae=>ae.filter(pe=>pe.id!==t.id));break;case l.ROLEPLAY:v=`${j}/sessions/${t.id}`,M=()=>m(ae=>ae.filter(pe=>pe.id!==t.id));break;case l.VIDEO:v=`${j}/video-training/sessions/${t.id}`,M=()=>_(ae=>ae.filter(pe=>pe.id!==t.id));break;default:throw new Error("Unknown session type")}const se=await(await fetch(v,{method:"DELETE",headers:{"X-WP-Nonce":ce()}})).json();if(se.success)M(),w&&Ue();else throw new Error(se.message||"Delete failed")}catch(v){throw console.error("Failed to delete session:",v),v}},rs=(t,u)=>(u===l.SIMULATOR?Qe:u===l.VIDEO?es:Ze)[t?.scenario_id];if(ze)return e.jsx(ft,{briefing:ze,onBack:Ls,onDelete:ts});if($){const t={topic:$.topic||"",context:$.context||"",pros:$.pros||[],cons:$.cons||[],proScore:$.pro_score||0,contraScore:$.contra_score||0},u=async(M,K)=>{try{const se={topic:M.topic,context:M.context||null,pros:M.pros,cons:M.cons,pro_score:M.proScore,contra_score:M.contraScore,analysis:K,status:"completed"};await Y.updateDecision($.id,se);const ae={...$,...se};Ps(ae),ie({data:M,result:K})}catch(se){console.error("[SessionHistory] Failed to update decision:",se)}},j=async M=>$.id,v=async(M,K)=>{try{await Y.updateDecision(M,{topic:K.topic,context:K.context||null,pros:K.pros,cons:K.cons,pro_score:K.proScore,contra_score:K.contraScore,status:K.status||"draft"})}catch(se){console.error("[SessionHistory] Failed to update decision:",se)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(js,{type:"decision",title:$.topic||"Entscheidung",status:$.status,createdAt:$.created_at,onBack:is,onDelete:()=>{window.confirm("M√∂chtest du diese Entscheidungs-Analyse wirklich l√∂schen?")&&(as($.id),is())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:Le?e.jsx(jt,{decisionData:Le.data,analysisResult:Le.result,onStartNew:()=>{ie(null),Q(null)},onEditDecision:()=>{ie(null)}}):e.jsx(bt,{initialData:t,onAnalysisComplete:u,isAuthenticated:n,savedDecisionId:$.id,onSaveDraft:j,onUpdateSession:v,onDecisionIdChange:()=>{}})})]})}if(i)return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(js,{type:"ikigai",title:"Ikigai-Analyse",subtitle:i.status==="completed"?"Berufliche Orientierung":"In Bearbeitung",status:i.status,createdAt:i.created_at,onBack:Pe,onDelete:()=>{window.confirm("M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen?")&&(ns(i.id),Pe())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:Ie?e.jsx(Nt,{dimensions:C,synthesisResult:Ie,onStartNew:Pe,onEdit:()=>ue(null),DIMENSIONS:bs}):e.jsx(yt,{dimensions:C,DIMENSIONS:bs,onExtractKeywords:Rs,onUpdateDimension:Ms,onRemoveTag:$s,allDimensionsFilled:Fs,onSynthesize:Bs,isSynthesizing:Fe})})]});if(w){if(k===l.ROLEPLAY){const j=rs(w,k);return e.jsx(pt,{session:w,scenario:j,onBack:Ue,onRepeat:()=>r?.(w,j,"roleplay"),onDelete:v=>Ge(v,l.ROLEPLAY)})}const u={[l.SIMULATOR]:"simulator",[l.VIDEO]:"video"}[k]||"simulator";return e.jsx(Lt,{session:w,type:k,scenario:rs(w,k),onBack:Ue,onContinueSession:d,onRepeatSession:(j,v)=>r?.(j,v,u),onDeleteSession:Ge})}if(!n)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ms,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsx("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:"Hier findest du deine gespeicherten √úbungen und Fortschritte"})]}),e.jsxs(U,{className:"max-w-[500px] mx-auto mt-16 p-10 text-center rounded-2xl shadow-card",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto mb-5",children:e.jsx(hs,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-slate-500 mb-6 leading-relaxed",children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),e.jsx(X,{onClick:g,size:"lg",icon:e.jsx(hs,{className:"w-5 h-5"}),children:"Jetzt anmelden"})]})]});if(ee)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx(Me,{className:"w-12 h-12 rounded-2xl"}),e.jsx(Me,{className:"h-10 w-48"})]}),e.jsx(Me,{className:"h-5 w-32 mx-auto"})]}),e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:[1,2,3,4,5,6].map(t=>e.jsx(Me,{className:"h-12 w-28 rounded-xl"},t))}),e.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:[1,2,3,4,5].map(t=>e.jsx(Qs,{},t))})]});if(Xe)return e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ge,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:Xe}),e.jsx(X,{onClick:Oe,children:"Erneut versuchen"})]})});const ls=Cs(),Gs=Es();return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center relative",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ms,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsxs("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:[ss," ",ss===1?"√úbung":"√úbungen"," gespeichert"]}),e.jsx("button",{onClick:Oe,disabled:ee,className:"absolute top-0 right-0 p-2.5 rounded-xl border border-slate-200 bg-white text-slate-500 shadow-sm flex items-center justify-center md:hidden disabled:opacity-50 hover:shadow-md transition-shadow",children:e.jsx(us,{className:`w-5 h-5 ${ee?"animate-spin":""}`})})]}),e.jsx("div",{className:"hidden lg:flex flex-wrap gap-2 mx-6 mb-6 bg-slate-100 p-1.5 rounded-2xl",children:qe.map(t=>{const u=t.icon,j=c===t.id,v=t.id===l.SIMULATOR?z.length:t.id===l.VIDEO?I.length:t.id===l.BRIEFINGS?y.length:t.id===l.DECISIONS?te.length:t.id===l.IKIGAI?B.length:A.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 min-w-fit py-3 px-4 rounded-xl border-none text-sm cursor-pointer flex items-center justify-center gap-2 transition-all ${j?"bg-white text-slate-900 font-semibold shadow-md":"bg-transparent text-slate-500 font-medium hover:bg-white/50"}`,children:[e.jsx(u,{size:18}),e.jsx("span",{children:t.label}),e.jsx("span",{className:`py-0.5 px-2 rounded-xl text-xs font-semibold min-w-[24px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsxs("div",{className:"lg:hidden mx-4 mb-4",children:[e.jsx("div",{className:"flex gap-2 justify-center mb-3",children:qe.map(t=>{const u=t.icon,j=c===t.id,v=t.id===l.SIMULATOR?z.length:t.id===l.VIDEO?I.length:t.id===l.BRIEFINGS?y.length:t.id===l.DECISIONS?te.length:t.id===l.IKIGAI?B.length:A.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 max-w-[80px] py-3 px-2 rounded-xl border-2 cursor-pointer flex flex-col items-center justify-center gap-1 transition-all ${j?"bg-white shadow-md border-indigo-500":"bg-slate-100 border-transparent hover:bg-white/60"}`,children:[e.jsx(u,{size:20,className:j?"text-indigo-500":"text-slate-500"}),e.jsx("span",{className:`py-0.5 px-1.5 rounded-lg text-[11px] font-semibold min-w-[20px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsx("div",{className:"text-center text-[15px] font-semibold text-slate-900 py-2 px-4 bg-white rounded-xl shadow-sm",children:qe.find(t=>t.id===c)?.label})]}),e.jsxs("div",{className:"hidden sm:flex justify-center lg:justify-end flex-wrap gap-3 mx-6 mb-6",children:[e.jsx(X,{variant:"outline",onClick:Oe,disabled:ee,title:"Aktualisieren",children:e.jsx(us,{className:`w-4 h-4 ${ee?"animate-spin":""}`})}),h&&e.jsxs(X,{onClick:()=>{const t={[l.BRIEFINGS]:"smart_briefing",[l.DECISIONS]:"decision_board",[l.IKIGAI]:"ikigai",[l.SIMULATOR]:"simulator",[l.VIDEO]:"video_training",[l.ROLEPLAY]:"dashboard"};h(t[c]||"overview")},children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),c===l.BRIEFINGS?"Neues Briefing":c===l.DECISIONS?"Neue Entscheidungs-Analyse":c===l.IKIGAI?"Neue Ikigai-Analyse":c===l.SIMULATOR?"Neues Szenario-Training":c===l.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),e.jsx("div",{className:"mx-4 sm:mx-6",children:ls.length===0?e.jsxs(U,{className:"text-center py-16 px-6 rounded-2xl shadow-card",children:[c===l.SIMULATOR&&e.jsx($e,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.ROLEPLAY&&e.jsx(be,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.VIDEO&&e.jsx(Ee,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.BRIEFINGS&&e.jsx(Ye,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.DECISIONS&&e.jsx(_e,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.IKIGAI&&e.jsx(Ce,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-slate-600 mb-2",children:["Noch keine ",c===l.SIMULATOR?"Szenario-Trainings":c===l.VIDEO?"Wirkungs-Analysen":c===l.BRIEFINGS?"Smart Briefings":c===l.DECISIONS?"Entscheidungs-Analysen":c===l.IKIGAI?"Ikigai-Analysen":"Live-Simulationen"]}),e.jsx("p",{className:"text-slate-500 mb-6",children:c===l.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":c===l.DECISIONS?"Nutze den Entscheidungs-Kompass, um deine erste Entscheidung zu analysieren.":c===l.IKIGAI?"Entdecke deinen idealen Karrierepfad mit dem Ikigai-Kompass.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),e.jsxs(X,{onClick:s,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),c===l.BRIEFINGS?"Briefing erstellen":c===l.DECISIONS?"Entscheidung analysieren":c===l.IKIGAI?"Ikigai entdecken":"Training starten"]})]}):e.jsx(E.div,{className:"flex flex-col gap-3",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:c===l.BRIEFINGS?y.map(t=>e.jsx(Ot,{briefing:t,onClick:()=>zs(t),onDelete:ts},t.id)):c===l.DECISIONS?te.map(t=>e.jsx(Mt,{decision:t,onClick:()=>Os(t),onDelete:as},t.id)):c===l.IKIGAI?B.map(t=>e.jsx($t,{ikigai:t,onDelete:ns,onNavigate:()=>Ts(t)},t.id)):ls.map(t=>{const u=Gs[t.scenario_id];return e.jsx(Tt,{session:t,type:c,scenario:u,onClick:()=>Us(t),onContinueSession:d,onDeleteSession:Ge},t.id)})})})]})};export{da as SESSION_TABS,xa as default};
