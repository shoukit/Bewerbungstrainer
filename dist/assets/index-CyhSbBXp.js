import{j as e,p as K,q as zt,b as X,a as _e,T as te,ai as _t,w as At,aj as Mt,B as lt,v as Ae,x as We,e as Me,ae as Ce,O as ct,o as dt,z as he,I as ge,M as pe,a7 as Et,aa as ut,k as xt,y as W,_ as He,ak as mt,h as Oe,a2 as Rt,l as Ze,a3 as Ft,a4 as Ge,a5 as Tt,A as It,m as Bt,J as $t,E as Ve,al as Lt,a1 as fe,am as Pe,n as pt,X as Dt,i as qt,a0 as Ot}from"./ui-vendor-B9DEMv6g.js";import{a,d as ht}from"./react-vendor-uDOJF2jQ.js";import{h as Vt,F as Pt,g as Wt,c as Ht,C as tt,u as Ke,D as $e,i as ze,w as Q,j as Zt}from"./FeatureInfoButton-BttXoQBt.js";import{S as Gt}from"./ScenarioDashboard-IRiLlffW.js";import{u as se}from"./useBranding-CGYcFGFC.js";import{u as Kt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-CrkU1tZp.js";import{A as Ut,M as gt,a as ft}from"./MicrophoneTestDialog-CjRagsq0.js";import{D as Jt}from"./DeviceSettingsDialog-D1QpilkE.js";import{F as bt}from"./fullscreen-loader-BQ5mAkGp.js";import{B as ce,C as ke}from"./Button-BHvYxNT_.js";import"./select-native-BpAm0hLd.js";import"./dialog-BRm7JlyZ.js";import{D as Xt}from"./DynamicFormField-CMxv0G5d.js";import"./ScenarioCard-CRO_L3PC.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-BUkAII3K.js";import"./index-CklPxmEV.js";const st="[SIMULATOR_DASHBOARD]",Yt={briefcase:lt,banknote:Mt,user:At,presentation:_t,target:te,mic:K},es=async()=>{const t=await fetch(`${Wt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Ht()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const r=await t.json();if(r.success&&r.data?.scenarios)return r.data.scenarios;throw new Error("Keine Szenarien gefunden")},ts=t=>Yt[t.icon]||lt,ss=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],rt=({onSelectScenario:t,isAuthenticated:r,requireAuth:c,setPendingScenario:d,onNavigateToHistory:n})=>(a.useEffect(()=>(console.log(`${st} üîµ MOUNT`),()=>{console.log(`${st} üî¥ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Vt,{featureId:"simulator",showOnMount:!0}),e.jsx(Gt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:_e,headerActions:e.jsx(Pt,{featureId:"simulator",size:"sm"}),fetchScenarios:es,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:n,onSelectScenario:t,renderCardMeta:ss,getIconForScenario:ts,cardActionLabel:"Starten",cardActionIcon:zt,categoryField:"category",emptyStateIcon:K,emptyStateTitle:"Keine Trainingsszenarien verf√ºgbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:r,requireAuth:c,setPendingScenario:d,loadingMessage:"Szenarien werden geladen..."})]})),rs=({field:t,value:r,onChange:c,error:d,focusColor:n,branding:s})=>{const m=n||"#4a9ec9",N="w-full rounded-lg text-base outline-none transition-all",y="px-4 py-3",S=d?"border-2 border-red-500":"border-2 border-slate-200",o={borderColor:m,boxShadow:`0 0 0 3px ${m}1a`},h=i=>{Object.assign(i.target.style,o),setTimeout(()=>{const u=i.target;if(u){const R=u.closest("div");R&&R.scrollIntoView({behavior:"smooth",block:"center"})}},300)},b=i=>{i.target.style.borderColor=d?tt.red[500]:tt.slate[200],i.target.style.boxShadow="none"},j=()=>{const i=`${N} ${y} ${S} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:r||"",onChange:u=>c(t.key,u.target.value),placeholder:t.placeholder||"",className:i,onFocus:h,onBlur:b});case"textarea":return e.jsx("textarea",{value:r||"",onChange:u=>c(t.key,u.target.value),placeholder:t.placeholder||"",rows:4,className:`${i} resize-vertical min-h-[100px]`,onFocus:h,onBlur:b});case"select":return e.jsxs("select",{value:r||t.default||"",onChange:u=>c(t.key,u.target.value),className:`${i} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:h,onBlur:b,children:[e.jsx("option",{value:"",children:"Bitte w√§hlen..."}),t.options?.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]});case"number":return e.jsx("input",{type:"number",value:r||"",onChange:u=>c(t.key,u.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:i,onFocus:h,onBlur:b});default:return e.jsx("input",{type:"text",value:r||"",onChange:u=>c(t.key,u.target.value),placeholder:t.placeholder||"",className:i,onFocus:h,onBlur:b})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),j(),d&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),d]}),t.hint&&!d&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),t.hint]})]})},ns=({scenario:t,onBack:r,onNext:c})=>{const[d,n]=a.useState({}),[s,m]=a.useState({}),[N,y]=a.useState([]),[S,o]=a.useState(!1),h=se(),b=ht.useMemo(()=>{if(!t?.input_configuration)return[];try{const p=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(p)?p.filter(g=>g.user_input!==!1):[]}catch(p){return console.error("Error parsing input_configuration:",p),[]}},[t?.input_configuration]);a.useEffect(()=>{const p={};b.forEach(g=>{g.default&&(p[g.key]=g.default)}),n(p)},[b]);const j=(p,g)=>{n(l=>({...l,[p]:g})),s[p]&&m(l=>{const v={...l};return delete v[p],v})},i=()=>{y(p=>[...p,{key:"",value:""}])},u=(p,g,l)=>{y(v=>{const w=[...v];return w[p]={...w[p],[g]:l},w})},R=p=>{y(g=>g.filter((l,v)=>v!==p))},B=()=>{const p={};return b.forEach(g=>{const l=d[g.key];if(g.required&&(!l||l.trim()==="")){p[g.key]="Dieses Feld ist erforderlich";return}if(!(!l||l.trim()==="")&&g.validation){const{minLength:v,maxLength:w,min:C,max:M,pattern:$}=g.validation;v&&l.length<v&&(p[g.key]=`Mindestens ${v} Zeichen erforderlich`),w&&l.length>w&&(p[g.key]=`Maximal ${w} Zeichen erlaubt`),C!==void 0&&Number(l)<C&&(p[g.key]=`Mindestens ${C}`),M!==void 0&&Number(l)>M&&(p[g.key]=`Maximal ${M}`),$&&!new RegExp($).test(l)&&(p[g.key]="Ung√ºltiges Format")}}),m(p),Object.keys(p).length===0},_=p=>{if(p.preventDefault(),!B())return;const g={...d};N.forEach(l=>{l.key&&l.value&&(g[l.key]=l.value)}),c(g)};return a.useEffect(()=>{b.length===0&&c({})},[b,c]),b.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:h.headerGradient},children:e.jsx(_e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:_,children:[b.map(p=>e.jsx(rs,{field:p,value:d[p.key],onChange:j,error:s[p.key],focusColor:h.primaryAccent,branding:h},p.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>o(!S),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:S?h.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[S?e.jsx(We,{size:18}):e.jsx(Me,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"Zus√§tzliche Variablen hinzuf√ºgen (optional)"})]}),S&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"F√ºge eigene Variablen hinzu, die in das Training einflie√üen sollen."}),N.length>0&&e.jsx("div",{className:"mb-3",children:N.map((p,g)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:p.key||"",onChange:l=>u(g,"key",l.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>R(g),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(ct,{size:16})})]}),e.jsx("textarea",{value:p.value||"",onChange:l=>u(g,"value",l.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},g))}),e.jsxs("button",{type:"button",onClick:i,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(Ce,{size:16}),"Variable hinzuf√ºgen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:h.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all hover:-translate-y-0.5",style:{background:h.buttonGradient,boxShadow:`0 4px 12px ${h.primaryAccent}4d`},children:["Weiter",e.jsx(dt,{className:"w-5 h-5"})]})]})]})},ve=({score:t,label:r,size:c="normal",primaryAccent:d,branding:n})=>{const s=t!=null?t*10:null,N=(S=>S>=80?n.success:S>=60?d:S>=40?n.warning:n.error)(s),y=c==="large";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:n.space[1]},children:[e.jsx("div",{style:{width:y?"80px":"56px",height:y?"80px":"56px",borderRadius:n.radius.full,backgroundColor:`${N}15`,border:`3px solid ${N}`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:y?n.fontSize["5xl"]:n.fontSize["2xl"],fontWeight:n.fontWeight.bold,color:N},children:s!=null?Math.round(s):"-"})}),e.jsx("span",{style:{fontSize:y?n.fontSize.base:n.fontSize.xs,color:n.textSecondary,fontWeight:n.fontWeight.medium},children:r})]})},le=({title:t,icon:r,children:c,defaultOpen:d=!0,primaryAccent:n,branding:s})=>{const[m,N]=a.useState(d);return e.jsxs("div",{style:{borderRadius:s.radius.lg,border:`1px solid ${s.borderColor}`,backgroundColor:s.cardBg,overflow:"hidden",marginBottom:s.space[4]},children:[e.jsxs("button",{onClick:()=>N(!m),style:{width:"100%",padding:`${s.space[4]} ${s.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3]},children:[e.jsx(r,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:n}}),e.jsx("span",{style:{fontSize:s.fontSize.md,fontWeight:s.fontWeight.semibold,color:s.textMain},children:t})]}),m?e.jsx(We,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:s.textMuted}}):e.jsx(Me,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:s.textMuted}})]}),m&&e.jsx("div",{style:{padding:`0 ${s.space[5]} ${s.space[5]} ${s.space[5]}`,borderTop:`1px solid ${s.cardBgHover}`,paddingTop:s.space[4]},children:c})]})},Le=({text:t,type:r,primaryAccent:c,primaryAccentLight:d,branding:n})=>{const s={strength:{icon:ut,color:n.success,bg:n.successLight},improvement:{icon:xt,color:n.warning,bg:n.warningLight},tip:{icon:W,color:c,bg:d}},{icon:m,color:N,bg:y}=s[r]||s.tip;return e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:n.space[3],borderRadius:n.radius.md,backgroundColor:y,marginBottom:n.space[2]},children:[e.jsx(m,{style:{width:n.iconSize.md,height:n.iconSize.md,color:N,flexShrink:0,marginTop:"2px"}}),e.jsx("span",{style:{fontSize:n.fontSize.base,color:n.textSecondary,lineHeight:1.5},children:t})]})},as=({metrics:t,branding:r})=>{if(!t)return null;const d=(s=>{switch(s){case"optimal":return{label:"Optimal",color:r.success};case"zu_schnell":return{label:"Zu schnell",color:r.warning};case"zu_langsam":return{label:"Zu langsam",color:r.warning};default:return{label:s||"N/A",color:r.textMuted}}})(t.speech_rate),n=s=>{switch(s){case"niedrig":return r.success;case"mittel":return r.warning;case"hoch":return r.error;default:return r.textMuted}};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:r.space[4]},children:[e.jsxs("div",{style:{padding:r.space[4],borderRadius:r.radius.md,backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:r.textMuted,display:"block",marginBottom:r.space[1]},children:"Sprechtempo"}),e.jsx("span",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:d.color},children:d.label})]}),t.filler_words&&e.jsxs("div",{style:{padding:r.space[4],borderRadius:r.radius.md,backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:r.textMuted,display:"block",marginBottom:r.space[1]},children:"F√ºllw√∂rter"}),e.jsxs("span",{style:{fontSize:r.fontSize.lg,fontWeight:600,color:n(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:r.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?r.success:r.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:r.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?r.success:r.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:r.primaryAccentLight,fontSize:"14px",color:r.textSecondary,lineHeight:1.5},children:["üí° ",t.notes]})]})},is=({audioUrl:t,primaryAccent:r,branding:c})=>{const d=a.useRef(null),[n,s]=a.useState(!1),[m,N]=a.useState(0),[y,S]=a.useState(0),[o,h]=a.useState(!0),[b,j]=a.useState(null);a.useEffect(()=>{if(!t)return;h(!0),j(null);const _=new Audio;d.current=_;const p=()=>{const l=_.duration;l&&isFinite(l)&&l>0&&S(l),h(!1)},g=()=>{h(!1);const l=_.duration;l&&isFinite(l)&&l>0&&S(l)};return _.addEventListener("loadedmetadata",p),_.addEventListener("canplaythrough",g),_.addEventListener("timeupdate",()=>N(_.currentTime)),_.addEventListener("play",()=>s(!0)),_.addEventListener("pause",()=>s(!1)),_.addEventListener("ended",()=>s(!1)),_.addEventListener("error",()=>{j("Audio nicht verf√ºgbar"),h(!1)}),_.src=t,_.load(),()=>{_.pause(),_.src=""}},[t]);const i=()=>{d.current&&(n?d.current.pause():d.current.play())},u=_=>{const p=_.currentTarget.getBoundingClientRect(),g=(_.clientX-p.left)/p.width;d.current&&y>0&&(d.current.currentTime=g*y)},R=_=>{d.current&&(d.current.currentTime=Math.max(0,Math.min(d.current.currentTime+_,y)))};if(!t)return null;if(b)return e.jsxs("div",{style:{padding:"12px 16px",background:c.cardBgHover,borderRadius:"10px",color:c.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(he,{size:16})," ",b]});const B=y>0?m/y*100:0;return e.jsxs("div",{style:{background:c.cardBgHover,borderRadius:"12px",padding:"16px"},children:[e.jsx("div",{onClick:u,style:{height:"6px",background:c.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:e.jsx("div",{style:{width:`${B}%`,height:"100%",background:r,borderRadius:"3px",transition:"width 0.1s"}})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[e.jsx("button",{onClick:()=>R(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:c.textMuted,display:"flex",alignItems:"center"},children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:i,disabled:o,style:{width:"44px",height:"44px",borderRadius:"50%",background:r,border:"none",cursor:o?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:o?.7:1},children:o?e.jsx(Ze,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):n?e.jsx(Ft,{size:20,color:"#ffffff",fill:"#ffffff"}):e.jsx(Ge,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),e.jsx("button",{onClick:()=>R(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:c.textMuted,display:"flex",alignItems:"center"},children:e.jsx(Tt,{size:20})})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:c.textMuted},children:[ze(m)," / ",ze(y)]}),e.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},os=({transcript:t,feedback:r,audioMetrics:c,audioUrl:d,onRetry:n,onNext:s,onComplete:m,isLastQuestion:N,hideButtons:y=!1})=>{const{branding:S}=Ke(),o=se(),h=S?.["--button-gradient"]||S?.["--header-gradient"]||$e["--header-gradient"],b=S?.["--primary-accent"]||$e["--primary-accent"],j=S?.["--primary-accent-light"]||$e["--primary-accent-light"],i=typeof r=="string"?JSON.parse(r):r;return e.jsxs("div",{style:{backgroundColor:o.cardBgHover,borderRadius:o.radius.xl,padding:o.space[6]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:o.space[5],backgroundColor:o.cardBg,borderRadius:o.radius.lg},children:[e.jsx(ve,{score:i?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:b,branding:o}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:o.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),e.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,margin:0,lineHeight:1.5},children:i?.summary||"Deine Antwort wurde analysiert."})]})]}),i?.scores&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:o.cardBg,borderRadius:"12px"},children:[e.jsx(ve,{score:i.scores.content,label:"Inhalt",primaryAccent:b,branding:o}),e.jsx(ve,{score:i.scores.structure,label:"Struktur",primaryAccent:b,branding:o}),e.jsx(ve,{score:i.scores.relevance,label:"Relevanz",primaryAccent:b,branding:o})]}),e.jsx(le,{title:"Transkript",icon:pe,defaultOpen:!0,primaryAccent:b,branding:o,children:e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:o.cardBgHover,fontStyle:"italic",color:o.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verf√ºgbar.",'"']})}),d&&e.jsx(le,{title:"Deine Aufnahme",icon:Et,defaultOpen:!0,primaryAccent:b,branding:o,children:e.jsx(is,{audioUrl:d,primaryAccent:b,branding:o})}),i?.strengths?.length>0&&e.jsx(le,{title:"St√§rken",icon:ut,defaultOpen:!0,primaryAccent:b,branding:o,children:i.strengths.map((u,R)=>e.jsx(Le,{text:u,type:"strength",primaryAccent:b,primaryAccentLight:j,branding:o},R))}),i?.improvements?.length>0&&e.jsx(le,{title:"Verbesserungen",icon:xt,defaultOpen:!0,primaryAccent:b,branding:o,children:i.improvements.map((u,R)=>e.jsx(Le,{text:u,type:"improvement",primaryAccent:b,primaryAccentLight:j,branding:o},R))}),i?.tips?.length>0&&e.jsx(le,{title:"Tipps",icon:W,defaultOpen:!1,primaryAccent:b,branding:o,children:i.tips.map((u,R)=>e.jsx(Le,{text:u,type:"tip",primaryAccent:b,primaryAccentLight:j,branding:o},R))}),c&&e.jsx(le,{title:"Sprechanalyse",icon:K,defaultOpen:!1,primaryAccent:b,branding:o,children:e.jsx(as,{metrics:c,branding:o})}),!y&&e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[n&&e.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${o.borderColor}`,backgroundColor:o.cardBg,color:o.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:u=>{u.target.style.borderColor=b,u.target.style.color=b},onMouseLeave:u=>{u.target.style.borderColor=o.borderColor,u.target.style.color=o.textSecondary},children:[e.jsx(He,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),e.jsx("button",{onClick:N?m:s,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:h,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${b}4d`,transition:"all 0.2s"},onMouseEnter:u=>{u.target.style.transform="translateY(-2px)",u.target.style.boxShadow=`0 6px 16px ${b}66`},onMouseLeave:u=>{u.target.style.transform="none",u.target.style.boxShadow=`0 4px 12px ${b}4d`},children:N?e.jsxs(e.Fragment,{children:[e.jsx(mt,{style:{width:"18px",height:"18px"}}),"Training abschlie√üen"]}):e.jsxs(e.Fragment,{children:["N√§chste Frage",e.jsx(Oe,{style:{width:"18px",height:"18px"}})]})})]})]})},ls=({tips:t,primaryAccent:r,tipsLabel:c,branding:d})=>{const n=se(),s=d||n,[m,N]=a.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:s.cardBg,borderRadius:s.radius.xl,border:`1px solid ${s.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>N(!m),style:{width:"100%",padding:`${s.space[4]} ${s.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:s.space[2],fontSize:s.fontSize.base,fontWeight:s.fontWeight.semibold,color:s.textMain},children:[e.jsx(W,{size:s.iconSize.md,color:r}),c||"Tipps f√ºr diese Frage"]}),e.jsx(Me,{size:s.iconSize.md,color:s.textMuted,style:{transform:m?"rotate(180deg)":"none",transition:s.transition.normal}})]}),e.jsx(It,{children:m&&e.jsx(Bt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${s.space[6]} ${s.space[6]}`},children:t.map((y,S)=>e.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.md,backgroundColor:s.warningLight,marginBottom:S<t.length-1?s.space[2]:0},children:[e.jsx(W,{style:{width:s.iconSize.sm,height:s.iconSize.sm,color:s.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:s.textSecondary,margin:0,lineHeight:1.5},children:y.replace(/^Tipp \d+:\s*/i,"")})]},S))})})})]})},cs=({seconds:t,maxSeconds:r,isRecording:c,branding:d})=>{const n=se(),s=d||n,m=r>0?t/r*100:0,N=m>75,y=m>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.lg,backgroundColor:y?s.errorLight:N?s.warningLight:s.cardBgHover},children:[e.jsx(X,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:y?s.error:N?s.warning:s.textSecondary}}),e.jsx("span",{style:{fontSize:s.fontSize.xl,fontWeight:s.fontWeight.semibold,fontFamily:"monospace",color:y?s.error:N?s.warning:s.textSecondary},children:ze(t)}),e.jsxs("span",{style:{fontSize:s.fontSize.base,color:s.textMuted},children:["/ ",ze(r)]})]})},nt=({onRecordingComplete:t,timeLimit:r,disabled:c,deviceId:d,themedGradient:n,primaryAccent:s,isSubmitting:m,labels:N,onOpenSettings:y,branding:S,isMobile:o,onStreamChange:h})=>{const b=se(),j=S||b,[i,u]=a.useState("idle"),[R,B]=a.useState(0),[_,p]=a.useState(0),[g,l]=a.useState(!1),v=a.useRef(null),w=a.useRef([]),C=a.useRef(null),M=a.useRef(null),$=a.useRef(null),E=a.useRef(null),q=a.useRef(null),f=a.useRef(0),x=a.useRef(!1);a.useEffect(()=>()=>{k()},[]),a.useEffect(()=>{i==="recording"&&R>=r&&O()},[R,r,i]);const k=()=>{C.current&&clearInterval(C.current),E.current&&cancelAnimationFrame(E.current),M.current&&(M.current.close(),M.current=null),q.current&&(q.current.getTracks().forEach(I=>I.stop()),q.current=null,h&&h(null))},F=async()=>{try{l(!1),w.current=[],B(0);let I;const ne={audio:d?{deviceId:{exact:d}}:!0};try{I=await navigator.mediaDevices.getUserMedia(ne)}catch(D){throw console.error("[SIMULATOR] Selected device unavailable:",D),D.name==="OverconstrainedError"||D.name==="NotFoundError"?(l(!1),new Error("Das ausgew√§hlte Mikrofon ist nicht verf√ºgbar. Bitte w√§hle ein anderes Mikrofon in den Einstellungen.")):D}q.current=I,h&&h(I),M.current=new(window.AudioContext||window.webkitAudioContext),$.current=M.current.createAnalyser(),M.current.createMediaStreamSource(I).connect($.current),$.current.fftSize=256;const de=()=>{if($.current&&x.current){const D=new Uint8Array($.current.frequencyBinCount);$.current.getByteFrequencyData(D);const Ee=D.reduce((ae,Re)=>ae+Re)/D.length;p(Ee/255)}E.current=requestAnimationFrame(de)};x.current=!0,de();const Z=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";v.current=new MediaRecorder(I,{mimeType:Z}),v.current.ondataavailable=D=>{D.data.size>0&&w.current.push(D.data)},v.current.onstop=()=>{const D=new Blob(w.current,{type:Z});t(D,f.current)},v.current.start(1e3),u("recording"),C.current=setInterval(()=>{B(D=>D+1)},1e3)}catch(I){console.error("Error starting recording:",I),(I.name==="NotAllowedError"||I.name==="PermissionDeniedError")&&l(!0)}},T=()=>{v.current&&v.current.state==="recording"&&(v.current.pause(),u("paused"),x.current=!1,C.current&&(clearInterval(C.current),C.current=null),p(0))},z=()=>{v.current&&v.current.state==="paused"&&(v.current.resume(),u("recording"),x.current=!0,C.current=setInterval(()=>{B(I=>I+1)},1e3))},O=()=>{f.current=R,x.current=!1,C.current&&(clearInterval(C.current),C.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),M.current&&(M.current.close(),M.current=null),v.current&&v.current.state!=="inactive"&&v.current.stop(),q.current&&(q.current.getTracks().forEach(I=>I.stop()),q.current=null),u("idle"),p(0),B(0)},L=()=>{i==="idle"?F():i==="recording"?T():i==="paused"&&z()};if(g)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:j.errorLight},children:[e.jsx($t,{className:"w-12 h-12 mb-3 mx-auto",style:{color:j.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:j.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:j.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const re=()=>{const I={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:o?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:o?"15px":"16px",fontWeight:600,cursor:c||m?"not-allowed":"pointer",flex:o?1:"none"};return c||m?{...I,background:j.borderColor,boxShadow:"none"}:i==="idle"?{...I,background:j.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:i==="recording"?{...I,background:j.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...I,background:j.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:j.cardBg,border:`1px solid ${j.borderColor}`},children:[o&&e.jsx("button",{onClick:y,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:j.cardBgHover,border:`1px solid ${j.borderColor}`},children:e.jsx(Ve,{size:18,style:{color:j.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(cs,{seconds:R,maxSeconds:r,isRecording:i==="recording",branding:j})}),i==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{audioLevel:_,isActive:!0,variant:"bars",size:"sm",accentColor:s})}),i==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:j.warning},children:[e.jsx(K,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!o&&e.jsx("button",{onClick:y,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:j.cardBgHover,border:`1px solid ${j.borderColor}`},children:e.jsx(Ve,{size:20,style:{color:j.textMuted}})}),e.jsxs("button",{onClick:L,disabled:c||m,style:re(),children:[i==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5"}),"Aufnahme starten"]}),i==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),i==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(i==="recording"||i==="paused")&&e.jsxs("button",{onClick:O,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:o?"14px 16px":"14px 24px",flex:o?1:"none",backgroundColor:j.cardBgHover,color:j.textMain,fontSize:o?"15px":"16px"},children:[e.jsx(fe,{className:"w-[18px] h-[18px]",style:{color:j.success}}),N?.submitButton||"Antwort abgeben"]})]}),i==="idle"&&!m&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:j.textMuted},children:N?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),m&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Ze,{className:"w-8 h-8 animate-spin",style:{color:s}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:j.textSecondary},children:N?.analyzing||"Antwort wird analysiert..."})]})]})},at={target:te,clock:X,mic:K,"message-square":pe,lightbulb:W,brain:Pe,info:ge,settings:Ve,check:fe,Target:te,Clock:X,Mic:K,MessageSquare:pe,Lightbulb:W,Brain:Pe},ds=({scenario:t,variables:r,questions:c,onStart:d,onBack:n,selectedMicrophoneId:s,onMicrophoneChange:m,onMicrophoneTest:N,themedGradient:y,primaryAccent:S,primaryAccentLight:o,isLoading:h,branding:b})=>{const j=se(),i=b||j,u=t?.mode==="SIMULATION",R=u?"Situationen":"Fragen",B=u?"Zeit pro Situation":"Zeit pro Frage",_=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) f√ºr Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${u?"Situation":"Frage"}. ${u?"Reagiere":"Antworte"} pr√§zise, aber ausf√ºhrlich genug.`},{icon:K,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind v√∂llig in Ordnung."},{icon:pe,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo m√∂glich."}],p=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((w,C)=>typeof w=="string"?{icon:W,title:`Tipp ${C+1}`,description:w}:{icon:at[w.icon]||at[w.icon?.toLowerCase()]||W,title:w.title||`Tipp ${C+1}`,description:w.text||w.description||""}):_,g=a.useMemo(()=>{if(!t?.input_configuration)return{};try{const w=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(w)?w.reduce((C,M)=>(M.key&&M.label&&(C[M.key]=M.label),C),{}):{}}catch{return{}}},[t?.input_configuration]),l=r?Object.entries(r).filter(([w,C])=>C&&C.trim&&C.trim()!=="").map(([w,C])=>({label:g[w]||w.replace(/_/g," ").replace(/\b\w/g,M=>M.toUpperCase()),value:C})):[],v=w=>{if(!w||!r)return w;let C=w;return Object.entries(r).forEach(([M,$])=>{$&&(C=C.replace(new RegExp(`\\$\\{${M}\\}`,"g"),$),C=C.replace(new RegExp(`\\{${M}\\}`,"g"),$))}),C};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:i.textSecondary},children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:y},children:e.jsx(W,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:i.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:i.textSecondary},children:[t.title,c.length>0?` ‚Ä¢ ${c.length} ${R}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:y},children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:i.textMain},children:"Deine Aufgabe"}),e.jsx("p",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:i.textSecondary},children:v(t.long_description?.replace(/\/n/g,`
`))})]})]})}),l.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:o},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:S},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:l.map((w,C)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:w.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:i.textMain},children:w.value})]},C))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(K,{className:"w-[22px] h-[22px]",style:{color:S}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Mikrofon testen"})]}),e.jsx(gt,{selectedDeviceId:s,onDeviceChange:m,onTestClick:N})]}),e.jsxs("button",{onClick:d,disabled:h,className:"w-full py-[18px] px-7 rounded-[14px] border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 transition-all",style:{background:h?i.borderColor:y,boxShadow:h?"none":`0 4px 12px ${S}4d`,cursor:h?"not-allowed":"pointer"},children:[e.jsx(Ge,{className:"w-6 h-6"}),"Gespr√§ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(W,{className:"w-[22px] h-[22px]",style:{color:i.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Tipps f√ºr dein Gespr√§ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:p.map((w,C)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:i.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:o},children:e.jsx(w.icon,{className:"w-[22px] h-[22px]",style:{color:S}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:i.textMain},children:w.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:i.textSecondary},children:w.description})]})]},C))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:i.cardBgHover},children:[c.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:R}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:c.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:B}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},us=({isOpen:t,onClose:r,onConfirm:c,answeredCount:d,totalCount:n,labels:s})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:r,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(pt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),d>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:s.answeredCount(d,n)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["M√∂chtest du das Training jetzt mit den bisherigen Antworten abschlie√üen oder weitere ",s.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",s.questionsLabel," beantwortet. M√∂chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,xs=({isOpen:t,onClose:r,onConfirm:c,answeredCount:d,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:r,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(he,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",d>0?` (${d} ${n.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Zur√ºck"}),e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,ms=({number:t,size:r="md"})=>{const c={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${c[r]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},De=({question:t,index:r,labels:c,isMobile:d})=>e.jsxs(ke,{className:d?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(ms,{number:r+1,size:d?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||c.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${d?"text-[15px]":"text-lg"} mb-0`,children:t?.question||c.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:d?14:16}),c.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),it=({error:t,onRetry:r,isMobile:c})=>e.jsxs("div",{className:`flex flex-col items-center ${c?"p-4":"p-5 mt-4"} rounded-xl bg-red-50`,children:[e.jsx(he,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500 font-medium text-sm text-center",children:t}),e.jsx(ce,{variant:"danger",size:"sm",onClick:r,className:"mt-3",children:"Erneut versuchen"})]}),ps=({session:t,questions:r,scenario:c,variables:d,preloadedQuestions:n,onSessionCreated:s,onComplete:m,onExit:N,startFromQuestion:y=0,initialMicrophoneId:S})=>{const o=Kt(),[h,b]=a.useState(t),[j,i]=a.useState(r||[]),[u,R]=a.useState(!1),[B,_]=a.useState(null),{demoCode:p,branding:g}=Ke(),l=c?.mode==="SIMULATION",v={questionLabel:l?"Situation / Aussage des Gegen√ºbers:":"Interviewfrage:",questionFallback:l?"Situation":"Frage",questionLoading:l?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:l?"Deine Reaktion...":"Deine Antwort...",submitButton:l?"Reaktion abgeben":"Antwort abgeben",submitHint:l?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:l?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,V)=>l?`Situation ${A} von ${V}`:`Frage ${A} von ${V}`,questionsCount:A=>l?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,V)=>l?`${A} von ${V} Situationen`:`${A} von ${V} Fragen`,tipsLabel:l?"Tipps f√ºr diese Situation":"Tipps f√ºr diese Frage",nextButton:l?"N√§chste Situation":"N√§chste Frage",timePerQuestion:l?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:l?"Situationen":"Fragen",recommendedTime:l?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},w=y>0,C=w?Array.from({length:y},(A,V)=>V):[],[M,$]=a.useState(w?"interview":"preparation"),[E,q]=a.useState(y||h?.current_question_index||0),[f,x]=a.useState(null),[k,F]=a.useState(!1),[T,z]=a.useState(!1),[O,L]=a.useState(null),[re,I]=a.useState([]),[ne,Qe]=a.useState(C),de="karriereheld_selected_microphone",[Z,D]=a.useState(()=>{if(S)return S;try{return localStorage.getItem(de)||null}catch{return null}}),[Ee,ae]=a.useState(!1),[Re,ue]=a.useState(!1),be=a.useRef(null),je=a.useCallback(()=>{be.current&&(be.current.getTracks().forEach(A=>A.stop()),be.current=null)},[]),Ue=a.useCallback(A=>{be.current=A},[]);a.useEffect(()=>()=>{je()},[je]),a.useEffect(()=>{if(Z)try{localStorage.setItem(de,Z)}catch{}},[Z]);const[jt,Fe]=a.useState(!1),[yt,Te]=a.useState(!1),[ye,Je]=a.useState(!1),[xe,we]=a.useState(null),[U,Xe]=a.useState(!1),J=j[E],ie=E===j.length-1,Ye=E===0,et=async(A,V)=>{if(V<2){L("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),L("Die Aufnahme enth√§lt keine verwertbaren Audiodaten. Bitte sprechen Sie w√§hrend der Aufnahme und versuchen Sie es erneut.");return}z(!0),L(null);try{const P=await Q.submitSimulatorAnswer(h.id,A,E,J.question,J.category,V);if(!P.success)throw new Error(P.message||"Fehler beim Analysieren der Antwort");if(x(P.data),F(!0),I(G=>[...G.filter(Y=>Y.questionIndex!==E),{questionIndex:E,feedback:P.data}]),Qe(G=>G.includes(E)?G:[...G,E]),l&&!U){Je(!0),we(null);const G=ne.includes(E);try{const Y=await Q.generateNextTurn(h.id);if(Y.success){const oe=Y.data.next_question;Y.data.is_finished?(we(oe),i(G?ee=>{const me=[...ee];return me[E+1]=oe,me.slice(0,E+2)}:ee=>[...ee,oe]),Xe(!0)):(we(oe),G?(i(ee=>{const me=[...ee];return me[E+1]=oe,me.slice(0,E+2)}),Xe(!1)):i(ee=>[...ee,oe]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{Je(!1)}}}catch(P){console.error("Error submitting answer:",P),L(P.message||"Ein Fehler ist aufgetreten")}finally{z(!1)}},Ie=()=>{x(null),F(!1),L(null)},Be=()=>{if(x(null),F(!1),L(null),l){if(xe){q(A=>A+1),we(null);return}if(U){Se();return}}else ie||q(A=>A+1)},wt=()=>{x(null),F(!1),L(null),Ye||q(A=>A-1)},St=()=>{Fe(!0)},Se=async()=>{Fe(!1),ue(!1),ae(!1),je();try{const A=await Q.completeSimulatorSession(h.id);A.success?m(A.data):m({session:{...h,status:"completed"}})}catch(A){console.error("Error completing session:",A),m({session:{...h,status:"completed"}})}},vt=()=>{Te(!0)},Nt=()=>{Te(!1),ue(!1),ae(!1),je(),N()},kt=async()=>{if(h&&j.length>0){$("interview");return}R(!0),_(null);try{const A=await Q.createSimulatorSession({scenario_id:c.id,variables:d,demo_code:p||null,questions:n||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const V=A.data.session;let P;if(n&&n.length>0)P=n,await Q.updateSimulatorSessionQuestions(V.id,P);else{const G=await Q.generateSimulatorQuestions(V.id);if(!G.success)throw new Error(G.message||"Fehler beim Generieren der Fragen");P=G.data.questions}b({...V,questions_json:P}),i(P),s&&s({session:{...V,questions_json:P},questions:P,selectedMicrophoneId:Z}),$("interview")}catch(A){console.error("Error creating session:",A),_(A.message||"Ein Fehler ist aufgetreten")}finally{R(!1)}};if(M==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(ds,{scenario:c,variables:d,questions:j,onStart:kt,onBack:N,selectedMicrophoneId:Z,onMicrophoneChange:D,onMicrophoneTest:()=>ae(!0),themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],primaryAccentLight:g?.["--primary-accent-light"],isLoading:u}),e.jsx(ft,{isOpen:Ee,onClose:()=>ae(!1),deviceId:Z}),B&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:B}),e.jsx(bt,{isLoading:u,message:l?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const Ct=k&&(l&&U&&!xe||!l&&ie);return e.jsxs("div",{className:`${o?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${o?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${o?"text-lg":"text-xl"} font-semibold text-slate-900`,children:c?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${o?"justify-between":"justify-end"}`,children:[!Ct&&e.jsxs("button",{onClick:St,className:`${o?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 transition-colors`,children:[e.jsx(pt,{size:16}),o?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:vt,className:`${o?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Dt,{size:16}),"Abbrechen"]})]})]}),e.jsx(us,{isOpen:jt,onClose:()=>Fe(!1),onConfirm:Se,answeredCount:ne.length,totalCount:j.length,labels:v}),e.jsx(xs,{isOpen:yt,onClose:()=>Te(!1),onConfirm:Nt,answeredCount:ne.length,labels:v}),!k&&!l&&e.jsxs("div",{className:`flex ${o?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(ce,{variant:"secondary",size:o?"sm":"md",icon:e.jsx(qt,{size:16}),onClick:wt,disabled:Ye,className:o?"flex-1":"",children:"Zur√ºck"}),e.jsx(ce,{variant:"secondary",size:o?"sm":"md",iconPosition:"right",icon:e.jsx(Oe,{size:16}),onClick:Be,disabled:ie,className:o?"flex-1":"",children:o?"√úberspringen":"Frage √ºberspringen"})]}),e.jsx(Qt,{current:E,total:j.length,answeredQuestions:ne,primaryAccent:g?.["--primary-accent"],labels:v}),k?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[c.allow_retry&&e.jsx(ce,{variant:"secondary",icon:e.jsx(He,{size:16}),onClick:Ie,children:"Nochmal versuchen"}),e.jsxs(ce,{onClick:l?U&&!xe?Se:Be:ie?Se:Be,disabled:l&&ye&&!U,icon:ye?e.jsx(Ze,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[l&&ye&&!U?"Gespr√§chspartner tippt...":l?U&&!xe?"Training abschlie√üen":v.nextButton:ie?"Training abschlie√üen":v.nextButton,!ye&&!(l?U&&!xe:ie)&&e.jsx(Oe,{size:16,className:"ml-1"})]})]}),e.jsx(De,{question:J,index:E,labels:v,isMobile:o}),e.jsx("div",{className:"mt-4",children:e.jsx(os,{transcript:f.transcript,feedback:f.feedback,audioMetrics:f.audio_analysis,audioUrl:f.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${o?"gap-4":"gap-6"}`,children:[o?e.jsxs(e.Fragment,{children:[e.jsx(De,{question:J,index:E,labels:v,isMobile:!0}),e.jsx(nt,{onRecordingComplete:et,timeLimit:c.time_limit_per_question||120,disabled:!1,deviceId:Z,themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],isSubmitting:T,labels:v,onOpenSettings:()=>ue(!0),isMobile:!0,onStreamChange:Ue}),O&&e.jsx(it,{error:O,onRetry:Ie,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(nt,{onRecordingComplete:et,timeLimit:c.time_limit_per_question||120,disabled:!1,deviceId:Z,themedGradient:g?.["--button-gradient"]||g?.["--header-gradient"],primaryAccent:g?.["--primary-accent"],isSubmitting:T,labels:v,onOpenSettings:()=>ue(!0),isMobile:!1,onStreamChange:Ue}),O&&e.jsx(it,{error:O,onRetry:Ie,isMobile:!1})]}),e.jsx(De,{question:J,index:E,labels:v,isMobile:!1})]}),J?.tips&&J.tips.length>0&&e.jsx(ls,{tips:J.tips,primaryAccent:g?.["--primary-accent"],tipsLabel:v.tipsLabel})]}),e.jsx(Jt,{isOpen:Re,onClose:()=>ue(!1),mode:"audio",selectedMicrophoneId:Z,onMicrophoneChange:D})]})},Ne=({score:t,label:r,primaryAccent:c,b:d})=>{const n=t!=null?t*10:null,s=Zt(n,c);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:s},children:n!=null?Math.round(n):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:r})]})},qe=({icon:t,value:r,label:c,primaryAccent:d,b:n})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:d}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:r}),e.jsx("div",{className:"text-xs text-slate-500",children:c})]})]}),hs=({session:t,scenario:r,onBackToDashboard:c,onStartNew:d})=>{const n=se(),s=t.summary_feedback||t.summary_feedback_json,m=s?typeof s=="string"?JSON.parse(s):s:null,N=t.overall_score||m?.overall_score||0,y=N<=10?N*10:N,o=(h=>h>=90?{text:"Ausgezeichnet!",emoji:"üåü"}:h>=80?{text:"Sehr gut!",emoji:"üéâ"}:h>=70?{text:"Gut!",emoji:"üëè"}:h>=60?{text:"Solide Leistung",emoji:"üëç"}:h>=50?{text:"Ausbauf√§hig",emoji:"üí™"}:{text:"Weiter √ºben!",emoji:"üìö"})(y);return e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:n.headerGradient,boxShadow:`0 8px 24px ${n.primaryAccent}4d`},children:e.jsx(mt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",o.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[r?.title||"Skill Training"," - ",o.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${n.primaryAccent}`,backgroundColor:n.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:n.primaryAccent},children:y?Math.round(y):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:y?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(qe,{icon:fe,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:n.primaryAccent,b:n}),e.jsx(qe,{icon:te,value:m?.average_content_score?Math.round(m.average_content_score*10):"-",label:"√ò Inhalt",primaryAccent:n.primaryAccent,b:n}),e.jsx(qe,{icon:Ot,value:m?.average_delivery_score?Math.round(m.average_delivery_score*10):"-",label:"√ò Pr√§sentation",primaryAccent:n.primaryAccent,b:n})]}),m?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Ne,{score:m.scores.content,label:"Inhalt",primaryAccent:n.primaryAccent,b:n}),e.jsx(Ne,{score:m.scores.structure,label:"Struktur",primaryAccent:n.primaryAccent,b:n}),e.jsx(Ne,{score:m.scores.relevance,label:"Relevanz",primaryAccent:n.primaryAccent,b:n}),e.jsx(Ne,{score:m.scores.delivery,label:"Pr√§sentation",primaryAccent:n.primaryAccent,b:n})]}),m?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:m.summary})]}),m?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"üí° Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:m.key_takeaways.map((h,b)=>e.jsx("li",{className:"mb-2",children:h},b))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur √úbersicht"]}),e.jsxs("button",{onClick:d,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-none text-white text-base font-semibold cursor-pointer transition-all hover:-translate-y-0.5",style:{background:n.buttonGradient,boxShadow:`0 4px 12px ${n.primaryAccent}4d`},children:[e.jsx(He,{className:"w-[18px] h-[18px]"}),"Nochmal √ºben"]})]})]})},H={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Is=({isAuthenticated:t,requireAuth:r,setPendingAction:c,pendingContinueSession:d,clearPendingContinueSession:n,pendingRepeatSession:s,clearPendingRepeatSession:m,onNavigateToHistory:N})=>{const[y,S]=a.useState(H.DASHBOARD),[o,h]=a.useState(null),[b,j]=a.useState(null),[i,u]=a.useState([]),[R,B]=a.useState({}),[_,p]=a.useState(null),[g,l]=a.useState(null),[v,w]=a.useState(null),[C,M]=a.useState(0);a.useEffect(()=>{v&&t&&(h(v),S(H.VARIABLES),w(null))},[v,t]),a.useEffect(()=>{if(d&&t){const{session:z,scenario:O}=d,L=z.questions||z.questions_json,re=typeof L=="string"?JSON.parse(L):L||[],I=z.completed_questions||z.answered_count||0;h(O||{id:z.scenario_id,title:z.scenario_title}),j(z),u(re),B({}),M(I),S(H.SESSION),n&&n()}},[d,t,n]),a.useEffect(()=>{if(s&&t){const{session:z,scenario:O}=s,L=z.questions||z.questions_json,re=typeof L=="string"?JSON.parse(L):L||[];h(O||{id:z.scenario_id,title:z.scenario_title}),u(re),B({}),M(0),S(H.SESSION),m&&m()}},[s,t,m]),a.useEffect(()=>{window.scrollTo(0,0)},[y]);const $=a.useCallback(z=>{h(z),S(H.VARIABLES)},[]),E=a.useCallback(()=>{h(null),j(null),u([]),B({}),p(null),M(0),l(null),S(H.DASHBOARD)},[]),q=a.useCallback(z=>{B(z),S(H.SESSION)},[]),f=a.useCallback(z=>{j(z.session),u(z.questions),z.selectedMicrophoneId&&l(z.selectedMicrophoneId)},[]),x=a.useCallback(z=>{p(z.session),S(H.COMPLETE)},[]),k=a.useCallback(()=>{E()},[E]),F=a.useCallback(()=>{j(null),u([]),p(null),M(0),l(null),S(H.VARIABLES)},[]),T=()=>{switch(y){case H.DASHBOARD:return e.jsx(rt,{onSelectScenario:$,isAuthenticated:t,requireAuth:r,setPendingScenario:w,onNavigateToHistory:N});case H.VARIABLES:return e.jsx(ns,{scenario:o,onBack:E,onNext:q});case H.SESSION:return e.jsx(ps,{session:b,questions:i,scenario:o,variables:R,preloadedQuestions:i.length>0?i:null,onSessionCreated:f,onComplete:x,onExit:k,startFromQuestion:C,initialMicrophoneId:g});case H.COMPLETE:return e.jsx(hs,{session:_,scenario:o,onBackToDashboard:E,onStartNew:F});default:return e.jsx(rt,{onSelectScenario:$,isAuthenticated:t,requireAuth:r,setPendingScenario:w,onNavigateToHistory:N})}};return e.jsx("div",{className:"min-h-full",children:T()})},ot={target:te,clock:X,mic:K,"message-square":pe,lightbulb:W,brain:Pe,info:ge,check:fe,sparkles:_e},gs=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) f√ºr Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte pr√§zise, aber ausf√ºhrlich genug."},{icon:K,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind v√∂llig in Ordnung."}],Bs=({scenario:t,onBack:r,onStart:c,preloadedQuestions:d})=>{const[n,s]=a.useState({}),[m,N]=a.useState({}),[y,S]=a.useState(!1),[o,h]=a.useState(null),[b,j]=a.useState(null),[i,u]=a.useState(!1),[R,B]=a.useState([]),[_,p]=a.useState(!1),{demoCode:g}=Ke(),l=ht.useMemo(()=>{if(!t?.input_configuration)return[];try{const f=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(f)?f.filter(x=>x.user_input!==!1):[]}catch(f){return console.error("Error parsing input_configuration:",f),[]}},[t?.input_configuration]);a.useEffect(()=>{const f={};l.forEach(x=>{x.default&&(f[x.key]=x.default)}),s(f)},[l]);const v=(f,x)=>{if(!f)return f;let k=f;return Object.entries(x||{}).forEach(([F,T])=>{T&&(k=k.replace(new RegExp(`\\$\\{${F}\\}`,"g"),T),k=k.replace(new RegExp(`\\{${F}\\}`,"g"),T))}),k},w=(f,x)=>{s(k=>({...k,[f]:x})),m[f]&&N(k=>{const F={...k};return delete F[f],F})},C=()=>{B(f=>[...f,{key:"",value:""}])},M=(f,x,k)=>{B(F=>{const T=[...F];return T[f]={...T[f],[x]:k},T})},$=f=>{B(x=>x.filter((k,F)=>F!==f))},E=()=>{const f={};return l.forEach(x=>{const k=n[x.key];if(x.required&&(!k||k.trim()==="")){f[x.key]="Dieses Feld ist erforderlich";return}if(!(!k||k.trim()==="")&&x.validation){const{minLength:F,maxLength:T,min:z,max:O,pattern:L}=x.validation;F&&k.length<F&&(f[x.key]=`Mindestens ${F} Zeichen erforderlich`),T&&k.length>T&&(f[x.key]=`Maximal ${T} Zeichen erlaubt`),z!==void 0&&Number(k)<z&&(f[x.key]=`Mindestens ${z}`),O!==void 0&&Number(k)>O&&(f[x.key]=`Maximal ${O}`),L&&!new RegExp(L).test(k)&&(f[x.key]="Ung√ºltiges Format")}}),N(f),Object.keys(f).length===0},q=async f=>{if(f.preventDefault(),h(null),!!E()){S(!0);try{const x={...n};R.forEach(z=>{z.key&&z.value&&(x[z.key]=z.value)});const k=await Q.createSimulatorSession({scenario_id:t.id,variables:x,demo_code:g||null,questions:d||null});if(!k.success)throw new Error(k.message||"Fehler beim Erstellen der Session");const F=k.data.session;let T;if(d&&d.length>0)T=d,await Q.updateSimulatorSessionQuestions(F.id,T);else{const z=await Q.generateSimulatorQuestions(F.id);if(!z.success)throw new Error(z.message||"Fehler beim Generieren der Fragen");T=z.data.questions}c({session:{...F,questions_json:T},questions:T,scenario:t,variables:x,selectedMicrophoneId:b})}catch(x){console.error("Error starting session:",x),h(x.message||"Ein Fehler ist aufgetreten")}finally{S(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(_e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ke,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:v(t.long_description?.replace(/\/n/g,`
`),n)})]})]})}),(()=>{const f=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((x,k)=>typeof x=="string"?{icon:W,title:`Tipp ${k+1}`,description:x}:{icon:ot[x.icon]||ot[x.icon?.toLowerCase()]||W,title:x.title||`Tipp ${k+1}`,description:x.text||x.description||""}):gs;return e.jsxs(ke,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps f√ºr dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:f.map((x,k)=>{const F=x.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(F,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:x.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:x.description})]})]},k)})})]})})(),e.jsxs("form",{onSubmit:q,children:[l.length>0?l.map(f=>e.jsx(Xt,{field:f,value:n[f.key],onChange:w,error:m[f.key]},f.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(fe,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zus√§tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>p(!_),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${_?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[_?e.jsx(We,{size:18}):e.jsx(Me,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"Zus√§tzliche Variablen hinzuf√ºgen (optional)"})]}),_&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"F√ºge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflie√üen sollen."}),R.length>0&&e.jsx("div",{className:"mb-3",children:R.map((f,x)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:f.key||"",onChange:k=>M(x,"key",k.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>$(x),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(ct,{size:18})})]}),e.jsx("textarea",{value:f.value||"",onChange:k=>M(x,"value",k.target.value),placeholder:"Wert eingeben... (mehrzeilig m√∂glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},x))}),e.jsxs("button",{type:"button",onClick:C,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Ce,{size:16}),"Variable hinzuf√ºgen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ke,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(K,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon ausw√§hlen"})]}),e.jsx(gt,{selectedDeviceId:b,onDeviceChange:j,onTestClick:()=>u(!0)})]}),o&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(he,{className:"w-[18px] h-[18px]"}),o]}),e.jsx(ce,{type:"submit",disabled:y,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(dt,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(ft,{isOpen:i,onClose:()=>u(!1),deviceId:b}),e.jsx(bt,{isLoading:y,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{xs as CancelConfirmDialog,us as CompleteConfirmDialog,os as ImmediateFeedback,ds as PreSessionView,ls as QuestionTips,hs as SessionComplete,cs as SessionTimer,Is as SimulatorApp,nt as SimulatorAudioRecorder,rt as SimulatorDashboard,ps as SimulatorSession,Bs as SimulatorWizard};
