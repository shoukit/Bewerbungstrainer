import{j as e,e as G,i as Et,g as Y,a as $e,l as te,aj as Tt,w as Mt,ak as zt,B as xt,M as ie,y as V,al as je,a1 as he,E as Me,I as ce,v as we,f as Ge,x as Ue,C as Ie,af as ze,O as mt,z as ye,a7 as Ft,ab as ht,T as pt,_ as He,am as gt,h as Ke,a2 as Rt,L as Qe,a3 as $t,a4 as Je,a5 as It,A as Bt,m as Lt,J as Ot,an as Dt,b as bt,X as Pt,q as qt,a0 as Vt}from"./ui-vendor-Dm6q_mjH.js";import{a as s,d as Fe}from"./react-vendor-uDOJF2jQ.js";import{k as Wt,F as Zt,g as Kt,a as Gt,b as pe,C as qe,l as Re,u as ft,w as H,m as Ut}from"./FeatureInfoButton-DP9rw1S0.js";import{S as Ht}from"./ScenarioDashboard-AgR2Zuf6.js";import{M as Xe,a as Ye,A as Qt}from"./MicrophoneTestDialog-DphhjfUi.js";import{C as oe,B as me}from"./select-native-aziB-GZa.js";import"./dialog-17kXcCTd.js";import{B as Jt}from"./button-BJJ4Phrm.js";import{u as Xt}from"./useMobile-YxjH166V.js";import{P as Yt}from"./progress-bar-CSH9xEo9.js";import{D as es}from"./DeviceSettingsDialog-qbuiGPOe.js";import{F as jt}from"./fullscreen-loader-C4Ss9De3.js";import{u as ts}from"./Confetti-B8Caa1ip.js";import{D as ss}from"./DynamicFormField-D55yhb8i.js";import"./ScenarioCard-CqLEv9uN.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./DeviceSetupPage-C_DoUwQb.js";const at="[SIMULATOR_DASHBOARD]",ns={briefcase:xt,banknote:zt,user:Mt,presentation:Tt,target:te,mic:G},rs=async()=>{const t=await fetch(`${Kt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Gt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const l=await t.json();if(l.success&&l.data?.scenarios)return l.data.scenarios;throw new Error("Keine Szenarien gefunden")},as=t=>ns[t.icon]||xt,is=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:Y,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],it=({onSelectScenario:t,isAuthenticated:l,requireAuth:a,setPendingScenario:c,onNavigateToHistory:i})=>(s.useEffect(()=>(console.log(`${at} ðŸ”µ MOUNT`),()=>{console.log(`${at} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Wt,{featureId:"simulator",showOnMount:!0}),e.jsx(Ht,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:$e,headerActions:e.jsx(Zt,{featureId:"simulator",size:"sm"}),fetchScenarios:rs,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:i,onSelectScenario:t,renderCardMeta:is,getIconForScenario:as,cardActionLabel:"Starten",cardActionIcon:Et,categoryField:"category",emptyStateIcon:G,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:l,requireAuth:a,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]})),ls=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,lt={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:V,brain:je,info:ce,settings:Me,check:he,Target:te,Clock:Y,Mic:G,MessageSquare:ie,Lightbulb:V,Brain:je},os=({scenario:t,onBack:l,onNext:a,hasVariables:c=!1})=>{const[i,n]=Fe.useState(null),[v,k]=Fe.useState(!1),p=t?.mode==="SIMULATION",h=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Y,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t?.time_limit_per_question||120)/60)} Minuten pro ${p?"Situation":"Frage"}. ${p?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ie,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],j=s.useMemo(()=>!t?.tips||!Array.isArray(t.tips)||t.tips.length===0?h:t.tips.map((y,f)=>typeof y=="string"?{icon:V,title:`Tipp ${f+1}`,description:y}:{icon:lt[y.icon]||lt[y.icon?.toLowerCase()]||V,title:y.title||`Tipp ${f+1}`,description:y.text||y.description||""}),[t?.tips,p]),g=()=>{a({selectedMicrophoneId:i})};return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(we,{size:18}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(V,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Vorbereitung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:t?.title})]})]})]}),t?.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:ls(t.long_description?.replace(/\/n/g,`
`))})]})]})}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps fÃ¼r dein GesprÃ¤ch"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise fÃ¼r optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:j.map((y,f)=>{const o=y.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(o,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("div",{className:"pt-0.5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 mb-0.5",children:y.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0",children:y.description})]})]},f)})})]}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:i,onDeviceChange:n,onTestClick:()=>k(!0)})]}),e.jsxs(Jt,{onClick:g,disabled:!i,size:"lg",className:"w-full gap-2.5",children:[c?"Weiter zur Konfiguration":"Training starten",e.jsx(Ge,{className:"w-5 h-5"})]}),e.jsx(Ye,{isOpen:v,onClose:()=>k(!1),deviceId:i})]})},cs=({field:t,value:l,onChange:a,error:c,focusColor:i,branding:n})=>{const v=i||qe.blue[400],k="w-full rounded-lg text-base outline-none transition-all",p="px-4 py-3",h=c?"border-2 border-red-500":"border-2 border-slate-200",j={borderColor:v,boxShadow:`0 0 0 3px ${v}1a`},g=o=>{Object.assign(o.target.style,j),setTimeout(()=>{const N=o.target;if(N){const w=N.closest("div");w&&w.scrollIntoView({behavior:"smooth",block:"center"})}},300)},y=o=>{o.target.style.borderColor=c?qe.red[500]:qe.slate[200],o.target.style.boxShadow="none"},f=()=>{const o=`${k} ${p} ${h} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:l||"",onChange:N=>a(t.key,N.target.value),placeholder:t.placeholder||"",className:o,onFocus:g,onBlur:y});case"textarea":return e.jsx("textarea",{value:l||"",onChange:N=>a(t.key,N.target.value),placeholder:t.placeholder||"",rows:4,className:`${o} resize-vertical min-h-[100px]`,onFocus:g,onBlur:y});case"select":return e.jsxs("select",{value:l||t.default||"",onChange:N=>a(t.key,N.target.value),className:`${o} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:g,onBlur:y,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.slice().sort((N,w)=>N.label.localeCompare(w.label,"de")).map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))]});case"number":return e.jsx("input",{type:"number",value:l||"",onChange:N=>a(t.key,N.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:o,onFocus:g,onBlur:y});default:return e.jsx("input",{type:"text",value:l||"",onChange:N=>a(t.key,N.target.value),placeholder:t.placeholder||"",className:o,onFocus:g,onBlur:y})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),f(),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),t.hint]})]})},ds=({scenario:t,onBack:l,onNext:a})=>{const[c,i]=s.useState({}),[n,v]=s.useState({}),[k,p]=s.useState([]),[h,j]=s.useState(!1),g=pe(),y=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const b=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(b)?b.filter(d=>d.user_input!==!1):[]}catch(b){return console.error("Error parsing input_configuration:",b),[]}},[t?.input_configuration]);s.useEffect(()=>{const b={};y.forEach(d=>{d.default&&(b[d.key]=d.default)}),i(b)},[y]);const f=(b,d)=>{i(r=>({...r,[b]:d})),n[b]&&v(r=>{const _={...r};return delete _[b],_})},o=()=>{p(b=>[...b,{key:"",value:""}])},N=(b,d,r)=>{p(_=>{const $=[..._];return $[b]={...$[b],[d]:r},$})},w=b=>{p(d=>d.filter((r,_)=>_!==b))},M=()=>{const b={};return y.forEach(d=>{const r=c[d.key];if(d.required&&(!r||r.trim()==="")){b[d.key]="Dieses Feld ist erforderlich";return}if(!(!r||r.trim()==="")&&d.validation){const{minLength:_,maxLength:$,min:m,max:C,pattern:E}=d.validation;_&&r.length<_&&(b[d.key]=`Mindestens ${_} Zeichen erforderlich`),$&&r.length>$&&(b[d.key]=`Maximal ${$} Zeichen erlaubt`),m!==void 0&&Number(r)<m&&(b[d.key]=`Mindestens ${m}`),C!==void 0&&Number(r)>C&&(b[d.key]=`Maximal ${C}`),E&&!new RegExp(E).test(r)&&(b[d.key]="UngÃ¼ltiges Format")}}),v(b),Object.keys(b).length===0},W=(b,d)=>{if(b.type!=="select"||!b.options||!d)return null;const r=b.options.find(_=>_.value===d);return r?r.label:d},O=b=>{if(b.preventDefault(),!M())return;const d={...c};k.forEach(r=>{r.key&&r.value&&(d[r.key]=r.value)}),y.forEach(r=>{if(r.type==="select"&&c[r.key]){const _=W(r,c[r.key]);_&&(d[`${r.key}_label`]=_)}}),a(d)};return s.useEffect(()=>{y.length===0&&a({})},[y,a]),y.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:g.headerGradient},children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:O,children:[y.map(b=>e.jsx(cs,{field:b,value:c[b.key],onChange:f,error:n[b.key],focusColor:g.primaryAccent,branding:g},b.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>j(!h),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:h?g.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[h?e.jsx(Ue,{size:18}):e.jsx(Ie,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),h&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),k.length>0&&e.jsx("div",{className:"mb-3",children:k.map((b,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:b.key||"",onChange:r=>N(d,"key",r.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>w(d),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(mt,{size:16})})]}),e.jsx("textarea",{value:b.value||"",onChange:r=>N(d,"value",r.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},d))}),e.jsxs("button",{type:"button",onClick:o,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(Ge,{className:"w-5 h-5"})]})]})]})},Ee=({score:t,label:l,size:a="normal",variant:c="default"})=>{const i=t!=null?t*10:null,v=(p=>c==="white"?"bg-white/20 border-white text-white":p>=80?"bg-green-50 border-green-500 text-green-600":p>=60?"bg-blue-50 border-blue-500 text-blue-600":p>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(i),k=a==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${k?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${v}
      `,children:e.jsx("span",{className:`
          ${k?"text-3xl":"text-2xl"}
          font-bold
        `,children:i!=null?Math.round(i):"-"})}),e.jsx("span",{className:`
        ${k?"text-sm":"text-xs"}
        ${c==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:l})]})},xe=({title:t,icon:l,children:a,defaultOpen:c=!0})=>{const[i,n]=s.useState(c);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(!i),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),i?e.jsx(Ue,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ie,{className:"w-5 h-5 text-slate-400"})]}),i&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:a})]})},Ve=({text:t,type:l})=>{const a={strength:{icon:ht,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:pt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:V,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:c,iconClass:i,bgClass:n}=a[l]||a.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${n} mb-2`,children:[e.jsx(c,{className:`w-5 h-5 ${i} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},us=({metrics:t})=>{if(!t)return null;const a=(i=>{switch(i){case"optimal":return{label:"Optimal",colorClass:"text-green-600"};case"zu_schnell":return{label:"Zu schnell",colorClass:"text-amber-600"};case"zu_langsam":return{label:"Zu langsam",colorClass:"text-amber-600"};default:return{label:i||"N/A",colorClass:"text-slate-400"}}})(t.speech_rate),c=i=>{switch(i){case"niedrig":return"text-green-600";case"mittel":return"text-amber-600";case"hoch":return"text-red-600";default:return"text-slate-400"}};return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Sprechtempo"}),e.jsx("span",{className:`text-lg font-semibold ${a.colorClass}`,children:a.label})]}),t.filler_words&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{className:`text-lg font-semibold ${c(t.filler_words.severity)}`,children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{className:"text-xs font-normal ml-2",children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Selbstbewusstsein"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.confidence_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.confidence_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Klarheit"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.clarity_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.clarity_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2 p-4 rounded-xl bg-blue-50 text-sm text-slate-700 leading-relaxed",children:["ðŸ’¡ ",t.notes]})]})},xs=({audioUrl:t})=>{const l=s.useRef(null),[a,c]=s.useState(!1),[i,n]=s.useState(0),[v,k]=s.useState(0),[p,h]=s.useState(!0),[j,g]=s.useState(null);s.useEffect(()=>{if(!t)return;h(!0),g(null);const w=new Audio;l.current=w,w.preload="auto";const M=()=>{const r=w.duration;r&&isFinite(r)&&r>0&&k(r)},W=()=>{if(M(),h(!1),!isFinite(w.duration)||w.duration===0){const r=w.currentTime;w.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{M(),w.currentTime=r},100)}},O=()=>{h(!1),M()},b=()=>{M()},d=()=>{n(w.currentTime),M()};return w.addEventListener("loadedmetadata",W),w.addEventListener("canplaythrough",O),w.addEventListener("durationchange",b),w.addEventListener("timeupdate",d),w.addEventListener("play",()=>c(!0)),w.addEventListener("pause",()=>c(!1)),w.addEventListener("ended",()=>c(!1)),w.addEventListener("error",()=>{g("Audio nicht verfÃ¼gbar"),h(!1)}),w.src=t,w.load(),()=>{w.pause(),w.src=""}},[t]);const y=()=>{l.current&&(a?l.current.pause():l.current.play())},f=w=>{const M=w.currentTarget.getBoundingClientRect(),W=(w.clientX-M.left)/M.width;l.current&&v>0&&(l.current.currentTime=W*v)},o=w=>{l.current&&(l.current.currentTime=Math.max(0,Math.min(l.current.currentTime+w,v)))};if(!t)return null;if(j)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(ye,{size:16})," ",j]});const N=v>0?i/v*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:f,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${N}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>o(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:y,disabled:p,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${p?"cursor-wait opacity-70":"cursor-pointer"}`,children:p?e.jsx(Qe,{size:20,className:"animate-spin"}):a?e.jsx($t,{size:20,fill:"white"}):e.jsx(Je,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>o(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(It,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[Re(i)," / ",Re(v)]})]})},ms=({transcript:t,feedback:l,audioMetrics:a,audioUrl:c,onRetry:i,onNext:n,onComplete:v,isLastQuestion:k,hideButtons:p=!1})=>{const h=typeof l=="string"?JSON.parse(l):l;return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(Ee,{score:h?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:h?.summary||"Deine Antwort wurde analysiert."})]})]}),h?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(Ee,{score:h.scores.content,label:"Inhalt"}),e.jsx(Ee,{score:h.scores.structure,label:"Struktur"}),e.jsx(Ee,{score:h.scores.relevance,label:"Relevanz"})]}),e.jsx(xe,{title:"Transkript",icon:ie,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),c&&e.jsx(xe,{title:"Deine Aufnahme",icon:Ft,defaultOpen:!0,children:e.jsx(xs,{audioUrl:c})}),h?.strengths?.length>0&&e.jsx(xe,{title:"StÃ¤rken",icon:ht,defaultOpen:!0,children:h.strengths.map((j,g)=>e.jsx(Ve,{text:j,type:"strength"},g))}),h?.improvements?.length>0&&e.jsx(xe,{title:"Verbesserungen",icon:pt,defaultOpen:!0,children:h.improvements.map((j,g)=>e.jsx(Ve,{text:j,type:"improvement"},g))}),h?.tips?.length>0&&e.jsx(xe,{title:"Tipps",icon:V,defaultOpen:!0,children:h.tips.map((j,g)=>e.jsx(Ve,{text:j,type:"tip"},g))}),a&&e.jsx(xe,{title:"Sprechanalyse",icon:G,defaultOpen:!0,children:e.jsx(us,{metrics:a})}),!p&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(He,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:k?v:n,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:k?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(Ke,{className:"w-4 h-4"})]})})]})]})},hs=({tips:t,primaryAccent:l,tipsLabel:a,branding:c})=>{const i=pe(),n=c||i,[v,k]=s.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>k(!v),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(V,{size:n.iconSize.md,color:l}),a||"Tipps fÃ¼r diese Frage"]}),e.jsx(Ie,{size:n.iconSize.md,color:n.textMuted,style:{transform:v?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx(Bt,{children:v&&e.jsx(Lt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((p,h)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:h<t.length-1?n.space[2]:0},children:[e.jsx(V,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:p.replace(/^Tipp \d+:\s*/i,"")})]},h))})})})]})},ps=({seconds:t,maxSeconds:l,isRecording:a,branding:c})=>{const i=pe(),n=c||i,v=l>0?t/l*100:0,k=v>75,p=v>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:p?n.errorLight:k?n.warningLight:n.cardBgHover},children:[e.jsx(Y,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:p?n.error:k?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:p?n.error:k?n.warning:n.textSecondary},children:Re(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",Re(l)]})]})},ot=({onRecordingComplete:t,timeLimit:l,disabled:a,deviceId:c,themedGradient:i,primaryAccent:n,isSubmitting:v,labels:k,onOpenSettings:p,branding:h,isMobile:j,onStreamChange:g})=>{const y=pe(),f=h||y,[o,N]=s.useState("idle"),[w,M]=s.useState(0),[W,O]=s.useState(0),[b,d]=s.useState(!1),r=s.useRef(null),_=s.useRef([]),$=s.useRef(null),m=s.useRef(null),C=s.useRef(null),E=s.useRef(null),F=s.useRef(null),u=s.useRef(0),x=s.useRef(!1);s.useEffect(()=>()=>{S()},[]),s.useEffect(()=>{o==="recording"&&w>=l&&Q()},[w,l,o]);const S=()=>{$.current&&clearInterval($.current),E.current&&cancelAnimationFrame(E.current),m.current&&(m.current.close(),m.current=null),F.current&&(F.current.getTracks().forEach(z=>z.stop()),F.current=null,g&&g(null))},R=async()=>{try{d(!1),_.current=[],M(0);let z;const T={audio:c?{deviceId:{exact:c}}:!0};try{z=await navigator.mediaDevices.getUserMedia(T)}catch(D){throw console.error("[SIMULATOR] Selected device unavailable:",D),D.name==="OverconstrainedError"||D.name==="NotFoundError"?(d(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):D}F.current=z,g&&g(z),m.current=new(window.AudioContext||window.webkitAudioContext),C.current=m.current.createAnalyser(),m.current.createMediaStreamSource(z).connect(C.current),C.current.fftSize=256;const K=()=>{if(C.current&&x.current){const D=new Uint8Array(C.current.frequencyBinCount);C.current.getByteFrequencyData(D);const U=D.reduce((Ne,Be)=>Ne+Be)/D.length;O(U/255)}E.current=requestAnimationFrame(K)};x.current=!0,K();const ee=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";r.current=new MediaRecorder(z,{mimeType:ee}),r.current.ondataavailable=D=>{D.data.size>0&&_.current.push(D.data)},r.current.onstop=()=>{const D=new Blob(_.current,{type:ee});t(D,u.current)},r.current.start(1e3),N("recording"),$.current=setInterval(()=>{M(D=>D+1)},1e3)}catch(z){console.error("Error starting recording:",z),(z.name==="NotAllowedError"||z.name==="PermissionDeniedError")&&d(!0)}},I=()=>{r.current&&r.current.state==="recording"&&(r.current.pause(),N("paused"),x.current=!1,$.current&&(clearInterval($.current),$.current=null),O(0))},L=()=>{r.current&&r.current.state==="paused"&&(r.current.resume(),N("recording"),x.current=!0,$.current=setInterval(()=>{M(z=>z+1)},1e3))},Q=()=>{u.current=w,x.current=!1,$.current&&(clearInterval($.current),$.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),m.current&&(m.current.close(),m.current=null),r.current&&r.current.state!=="inactive"&&r.current.stop(),F.current&&(F.current.getTracks().forEach(z=>z.stop()),F.current=null),N("idle"),O(0),M(0)},se=()=>{o==="idle"?R():o==="recording"?I():o==="paused"&&L()};if(b)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:f.errorLight},children:[e.jsx(Ot,{className:"w-12 h-12 mb-3 mx-auto",style:{color:f.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:f.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:f.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const ne=()=>{const z={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:j?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:j?"15px":"16px",fontWeight:600,cursor:a||v?"not-allowed":"pointer",flex:j?1:"none"};return a||v?{...z,background:f.borderColor,boxShadow:"none"}:o==="idle"?{...z,background:f.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:o==="recording"?{...z,background:f.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...z,background:f.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:f.cardBg,border:`1px solid ${f.borderColor}`},children:[j&&e.jsx("button",{onClick:p,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:f.cardBgHover,border:`1px solid ${f.borderColor}`},children:e.jsx(Me,{size:18,style:{color:f.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(ps,{seconds:w,maxSeconds:l,isRecording:o==="recording",branding:f})}),o==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Qt,{audioLevel:W,isActive:!0,variant:"bars",size:"sm",accentColor:n})}),o==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:f.warning},children:[e.jsx(G,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!j&&e.jsx("button",{onClick:p,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:f.cardBgHover,border:`1px solid ${f.borderColor}`},children:e.jsx(Me,{size:20,style:{color:f.textMuted}})}),e.jsxs("button",{onClick:se,disabled:a||v,style:ne(),children:[o==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Aufnahme starten"]}),o==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),o==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(o==="recording"||o==="paused")&&e.jsxs("button",{onClick:Q,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:j?"14px 16px":"14px 24px",flex:j?1:"none",backgroundColor:f.cardBgHover,color:f.textMain,fontSize:j?"15px":"16px"},children:[e.jsx(he,{className:"w-[18px] h-[18px]",style:{color:f.success}}),k?.submitButton||"Antwort abgeben"]})]}),o==="idle"&&!v&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:f.textMuted},children:k?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),v&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Qe,{className:"w-8 h-8 animate-spin",style:{color:n}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:f.textSecondary},children:k?.analyzing||"Antwort wird analysiert..."})]})]})},gs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,ct={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:V,brain:je,info:ce,settings:Me,check:he,Target:te,Clock:Y,Mic:G,MessageSquare:ie,Lightbulb:V,Brain:je},bs=({scenario:t,variables:l,questions:a,onStart:c,onBack:i,selectedMicrophoneId:n,onMicrophoneChange:v,onMicrophoneTest:k,themedGradient:p,primaryAccent:h,primaryAccentLight:j,isLoading:g,branding:y})=>{const f=pe(),o=y||f,N=t?.mode==="SIMULATION",w=N?"Situationen":"Fragen",M=N?"Zeit pro Situation":"Zeit pro Frage",W=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Y,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${N?"Situation":"Frage"}. ${N?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ie,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],O=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((m,C)=>typeof m=="string"?{icon:V,title:`Tipp ${C+1}`,description:m}:{icon:ct[m.icon]||ct[m.icon?.toLowerCase()]||V,title:m.title||`Tipp ${C+1}`,description:m.text||m.description||""}):W,{inputConfigLabels:b,selectOptionsMap:d}=s.useMemo(()=>{if(!t?.input_configuration)return{inputConfigLabels:{},selectOptionsMap:{}};try{const m=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;if(!Array.isArray(m))return{inputConfigLabels:{},selectOptionsMap:{}};const C={},E={};return m.forEach(F=>{F.key&&F.label&&(C[F.key]=F.label),F.type==="select"&&F.options&&(E[F.key]=F.options)}),{inputConfigLabels:C,selectOptionsMap:E}}catch{return{inputConfigLabels:{},selectOptionsMap:{}}}},[t?.input_configuration]),r=(m,C)=>{if(m.endsWith("_label"))return null;if(l[`${m}_label`])return l[`${m}_label`];if(d[m]){const E=d[m].find(F=>F.value===C);if(E)return E.label}return C},_=l?Object.entries(l).filter(([m,C])=>m.endsWith("_label")?!1:C&&(typeof C=="string"?C.trim()!=="":!0)).map(([m,C])=>({label:b[m]||m.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),value:r(m,C)})).filter(m=>m.value):[],$=m=>{if(!m||!l)return m;let C=m;return Object.entries(l).forEach(([E,F])=>{F&&(C=C.replace(new RegExp(`\\$\\{${E}\\}`,"g"),F),C=C.replace(new RegExp(`\\{${E}\\}`,"g"),F))}),C};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:o.textSecondary},children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:p},children:e.jsx(V,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:o.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:o.textSecondary},children:[t.title,a.length>0?` â€¢ ${a.length} ${w}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:p},children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:o.textMain},children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:o.textSecondary},children:gs($(t.long_description?.replace(/\/n/g,`
`)))})]})]})}),_.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:j},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:h},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:_.map((m,C)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:m.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:o.textMain},children:m.value})]},C))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px]",style:{color:h}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:n,onDeviceChange:v,onTestClick:k})]}),e.jsxs("button",{onClick:c,disabled:g,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Je,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(V,{className:"w-[22px] h-[22px]",style:{color:o.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:O.map((m,C)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:o.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:j},children:e.jsx(m.icon,{className:"w-[22px] h-[22px]",style:{color:h}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:o.textMain},children:m.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:o.textSecondary},children:m.description})]})]},C))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:o.cardBgHover},children:[a.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:w}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:a.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:M}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},fs=({isOpen:t,onClose:l,onConfirm:a,answeredCount:c,totalCount:i,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(bt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),c>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:n.answeredCount(c,i)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",n.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",n.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,js=({isOpen:t,onClose:l,onConfirm:a,answeredCount:c,labels:i})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(ye,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",c>0?` (${c} ${i.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,ws=({number:t,size:l="md"})=>{const a={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${a[l]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},We=({question:t,index:l,labels:a,isMobile:c})=>e.jsxs(oe,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(ws,{number:l+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||a.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||a.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(Y,{size:c?14:16}),a.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),dt=({error:t,onRetry:l,isMobile:a})=>e.jsxs("div",{className:`flex flex-col items-center ${a?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(ye,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(me,{variant:"danger",size:"sm",onClick:l,className:"mt-3",children:"Erneut versuchen"})]}),ys=({session:t,questions:l,scenario:a,variables:c,preloadedQuestions:i,onSessionCreated:n,onComplete:v,onExit:k,startFromQuestion:p=0,initialMicrophoneId:h,skipPreSession:j=!1})=>{const g=Xt(),[y,f]=s.useState(t),[o,N]=s.useState(l||[]),[w,M]=s.useState(!1),[W,O]=s.useState(null),{demoCode:b,branding:d}=ft(),r=a?.mode==="SIMULATION",_={questionLabel:r?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:r?"Situation":"Frage",questionLoading:r?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:r?"Deine Reaktion...":"Deine Antwort...",submitButton:r?"Reaktion abgeben":"Antwort abgeben",submitHint:r?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:r?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,B)=>r?`Situation ${A} von ${B}`:`Frage ${A} von ${B}`,questionsCount:A=>r?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,B)=>r?`${A} von ${B} Situationen`:`${A} von ${B} Fragen`,tipsLabel:r?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:r?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:r?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:r?"Situationen":"Fragen",recommendedTime:r?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},$=p>0,m=$?Array.from({length:p},(A,B)=>B):[],C=$||j,[E,F]=s.useState(C?"interview":"preparation"),[u,x]=s.useState(p||y?.current_question_index||0),[S,R]=s.useState(null),[I,L]=s.useState(!1),[Q,se]=s.useState(!1),[ne,z]=s.useState(null),[T,J]=s.useState([]),[K,ee]=s.useState(m),D="karriereheld_selected_microphone",[U,Ne]=s.useState(()=>{if(h)return h;try{return localStorage.getItem(D)||null}catch{return null}}),[Be,ve]=s.useState(!1),[wt,ge]=s.useState(!1),Se=s.useRef(null),ke=s.useCallback(()=>{Se.current&&(Se.current.getTracks().forEach(A=>A.stop()),Se.current=null)},[]),et=s.useCallback(A=>{Se.current=A},[]);s.useEffect(()=>()=>{ke()},[ke]),s.useEffect(()=>{if(U)try{localStorage.setItem(D,U)}catch{}},[U]),s.useEffect(()=>{C&&E==="interview"&&!y&&!w&&(async()=>{M(!0),O(null);try{const B=await H.createSimulatorSession({scenario_id:a.id,variables:c,demo_code:b||null,questions:i||null});if(!B.success)throw new Error(B.message||"Fehler beim Erstellen der Session");const P=B.data.session;let q;if(i&&i.length>0)q=i,await H.updateSimulatorSessionQuestions(P.id,q);else{const X=await H.generateSimulatorQuestions(P.id);if(!X.success)throw new Error(X.message||"Fehler beim Generieren der Fragen");q=X.data.questions}f({...P,questions_json:q}),N(q),n&&n({session:{...P,questions_json:q},questions:q,selectedMicrophoneId:U})}catch(B){console.error("Error creating session:",B),O(B.message||"Ein Fehler ist aufgetreten")}finally{M(!1)}})()},[C,E,y,w,a,c,b,i,U,n]);const[yt,Le]=s.useState(!1),[Nt,Oe]=s.useState(!1),[Ce,tt]=s.useState(!1),[be,_e]=s.useState(null),[re,st]=s.useState(!1),ae=o[u],de=u===o.length-1,nt=u===0,rt=async(A,B)=>{if(B<2){z("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),z("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}se(!0),z(null);try{const P=await H.submitSimulatorAnswer(y.id,A,u,ae.question,ae.category,B);if(!P.success)throw new Error(P.message||"Fehler beim Analysieren der Antwort");if(R(P.data),L(!0),J(q=>[...q.filter(X=>X.questionIndex!==u),{questionIndex:u,feedback:P.data}]),ee(q=>q.includes(u)?q:[...q,u]),r&&!re){tt(!0),_e(null);const q=K.includes(u);try{const X=await H.generateNextTurn(y.id);if(X.success){const ue=X.data.next_question;X.data.is_finished?(_e(ue),N(q?le=>{const fe=[...le];return fe[u+1]=ue,fe.slice(0,u+2)}:le=>[...le,ue]),st(!0)):(_e(ue),q?(N(le=>{const fe=[...le];return fe[u+1]=ue,fe.slice(0,u+2)}),st(!1)):N(le=>[...le,ue]))}}catch(X){console.error("Error generating next turn:",X)}finally{tt(!1)}}}catch(P){console.error("Error submitting answer:",P),z(P.message||"Ein Fehler ist aufgetreten")}finally{se(!1)}},De=()=>{R(null),L(!1),z(null)},Pe=()=>{if(R(null),L(!1),z(null),r){if(be){x(A=>A+1),_e(null);return}if(re){Ae();return}}else de||x(A=>A+1)},vt=()=>{R(null),L(!1),z(null),nt||x(A=>A-1)},St=()=>{Le(!0)},Ae=async()=>{Le(!1),ge(!1),ve(!1),ke();try{const A=await H.completeSimulatorSession(y.id);A.success?v(A.data):v({session:{...y,status:"completed"}})}catch(A){console.error("Error completing session:",A),v({session:{...y,status:"completed"}})}},kt=()=>{Oe(!0)},Ct=()=>{Oe(!1),ge(!1),ve(!1),ke(),k()},_t=async()=>{if(y&&o.length>0){F("interview");return}M(!0),O(null);try{const A=await H.createSimulatorSession({scenario_id:a.id,variables:c,demo_code:b||null,questions:i||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const B=A.data.session;let P;if(i&&i.length>0)P=i,await H.updateSimulatorSessionQuestions(B.id,P);else{const q=await H.generateSimulatorQuestions(B.id);if(!q.success)throw new Error(q.message||"Fehler beim Generieren der Fragen");P=q.data.questions}f({...B,questions_json:P}),N(P),n&&n({session:{...B,questions_json:P},questions:P,selectedMicrophoneId:U}),F("interview")}catch(A){console.error("Error creating session:",A),O(A.message||"Ein Fehler ist aufgetreten")}finally{M(!1)}};if(E==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(bs,{scenario:a,variables:c,questions:o,onStart:_t,onBack:k,selectedMicrophoneId:U,onMicrophoneChange:Ne,onMicrophoneTest:()=>ve(!0),themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],primaryAccentLight:d?.["--primary-accent-light"],isLoading:w}),e.jsx(Ye,{isOpen:Be,onClose:()=>ve(!1),deviceId:U}),W&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:W}),e.jsx(jt,{isLoading:w,message:r?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const At=I&&(r&&re&&!be||!r&&de);return e.jsxs("div",{className:`${g?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${g?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${g?"text-lg":"text-xl"} font-semibold text-slate-900`,children:a?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${g?"justify-between":"justify-end"}`,children:[!At&&e.jsxs("button",{onClick:St,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(bt,{size:16}),g?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:kt,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Pt,{size:16}),"Abbrechen"]})]})]}),e.jsx(fs,{isOpen:yt,onClose:()=>Le(!1),onConfirm:Ae,answeredCount:K.length,totalCount:o.length,labels:_}),e.jsx(js,{isOpen:Nt,onClose:()=>Oe(!1),onConfirm:Ct,answeredCount:K.length,labels:_}),!I&&!r&&e.jsxs("div",{className:`flex ${g?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(me,{variant:"secondary",size:g?"sm":"md",icon:e.jsx(qt,{size:16}),onClick:vt,disabled:nt,className:g?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(me,{variant:"secondary",size:g?"sm":"md",iconPosition:"right",icon:e.jsx(Ke,{size:16}),onClick:Pe,disabled:de,className:g?"flex-1":"",children:g?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Yt,{current:u,total:o.length,answeredQuestions:K,primaryAccent:d?.["--primary-accent"],labels:_}),I?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[a.allow_retry&&e.jsx(me,{variant:"secondary",icon:e.jsx(He,{size:16}),onClick:De,children:"Nochmal versuchen"}),e.jsxs(me,{onClick:r?re&&!be?Ae:Pe:de?Ae:Pe,disabled:r&&Ce&&!re,icon:Ce?e.jsx(Qe,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[r&&Ce&&!re?"GesprÃ¤chspartner tippt...":r?re&&!be?"Training abschlieÃŸen":_.nextButton:de?"Training abschlieÃŸen":_.nextButton,!Ce&&!(r?re&&!be:de)&&e.jsx(Ke,{size:16,className:"ml-1"})]})]}),e.jsx(We,{question:ae,index:u,labels:_,isMobile:g}),e.jsx("div",{className:"mt-4",children:e.jsx(ms,{transcript:S.transcript,feedback:S.feedback,audioMetrics:S.audio_analysis,audioUrl:S.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${g?"gap-4":"gap-6"}`,children:[g?e.jsxs(e.Fragment,{children:[e.jsx(We,{question:ae,index:u,labels:_,isMobile:!0}),e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:Q,labels:_,onOpenSettings:()=>ge(!0),isMobile:!0,onStreamChange:et}),ne&&e.jsx(dt,{error:ne,onRetry:De,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:Q,labels:_,onOpenSettings:()=>ge(!0),isMobile:!1,onStreamChange:et}),ne&&e.jsx(dt,{error:ne,onRetry:De,isMobile:!1})]}),e.jsx(We,{question:ae,index:u,labels:_,isMobile:!1})]}),ae?.tips&&ae.tips.length>0&&e.jsx(hs,{tips:ae.tips,primaryAccent:d?.["--primary-accent"],tipsLabel:_.tipsLabel})]}),e.jsx(es,{isOpen:wt,onClose:()=>ge(!1),mode:"audio",selectedMicrophoneId:U,onMicrophoneChange:Ne})]})},Te=({score:t,label:l,primaryAccent:a,b:c})=>{const i=t!=null?t*10:null,n=Ut(i,a);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:n},children:i!=null?Math.round(i):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:l})]})},Ze=({icon:t,value:l,label:a,primaryAccent:c,b:i})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:c}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:l}),e.jsx("div",{className:"text-xs text-slate-500",children:a})]})]}),Ns=({session:t,scenario:l,onBackToDashboard:a,onStartNew:c})=>{const i=pe(),{triggerConfetti:n,ConfettiComponent:v}=ts(),k=t.summary_feedback||t.summary_feedback_json,p=k?typeof k=="string"?JSON.parse(k):k:null,h=t.overall_score||p?.overall_score||0,j=h<=10?h*10:h,y=(f=>f>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:f>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:f>=70?{text:"Gut!",emoji:"ðŸ‘"}:f>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:f>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(j);return s.useEffect(()=>{j>=70&&n()},[j,n]),e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:i.headerGradient,boxShadow:`0 8px 24px ${i.primaryAccent}4d`},children:e.jsx(gt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",y.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[l?.title||"Skill Training"," - ",y.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${i.primaryAccent}`,backgroundColor:i.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:i.primaryAccent},children:j?Math.round(j):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:j?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(Ze,{icon:he,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ze,{icon:te,value:p?.average_content_score?Math.round(p.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ze,{icon:Vt,value:p?.average_delivery_score?Math.round(p.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),p?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Te,{score:p.scores.content,label:"Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Te,{score:p.scores.structure,label:"Struktur",primaryAccent:i.primaryAccent,b:i}),e.jsx(Te,{score:p.scores.relevance,label:"Relevanz",primaryAccent:i.primaryAccent,b:i}),e.jsx(Te,{score:p.scores.delivery,label:"PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),p?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:p.summary})]}),p?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:p.key_takeaways.map((f,o)=>e.jsx("li",{className:"mb-2",children:f},o))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(He,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})]})},Z={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Vs=({isAuthenticated:t,requireAuth:l,setPendingAction:a,pendingContinueSession:c,clearPendingContinueSession:i,pendingRepeatSession:n,clearPendingRepeatSession:v,onNavigateToHistory:k})=>{const[p,h]=s.useState(Z.DASHBOARD),[j,g]=s.useState(null),[y,f]=s.useState(null),[o,N]=s.useState([]),[w,M]=s.useState({}),[W,O]=s.useState(null),[b,d]=s.useState(null),[r,_]=s.useState(null),[$,m]=s.useState(0),[C,E]=s.useState(!1),F=s.useMemo(()=>{if(!j?.input_configuration)return!1;try{const T=typeof j.input_configuration=="string"?JSON.parse(j.input_configuration):j.input_configuration;return Array.isArray(T)?T.filter(J=>J.user_input!==!1).length>0:!1}catch{return!1}},[j?.input_configuration]);s.useEffect(()=>{r&&t&&(g(r),h(Z.PREPARATION),_(null))},[r,t]),s.useEffect(()=>{if(c&&t){const{session:T,scenario:J}=c,K=T.questions||T.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[],D=T.completed_questions||T.answered_count||0;g(J||{id:T.scenario_id,title:T.scenario_title}),f(T),N(ee),M({}),m(D),E(!0),h(Z.SESSION),i&&i()}},[c,t,i]),s.useEffect(()=>{if(n&&t){const{session:T,scenario:J}=n,K=T.questions||T.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[];g(J||{id:T.scenario_id,title:T.scenario_title}),N(ee),M({}),m(0),h(Z.PREPARATION),v&&v()}},[n,t,v]),s.useEffect(()=>{window.scrollTo(0,0)},[p]);const u=s.useCallback(T=>{g(T),h(Z.PREPARATION)},[]),x=s.useCallback(()=>{g(null),f(null),N([]),M({}),O(null),m(0),d(null),E(!1),h(Z.DASHBOARD)},[]),S=s.useCallback(T=>{if(d(T.selectedMicrophoneId),j?.input_configuration){const J=typeof j.input_configuration=="string"?JSON.parse(j.input_configuration):j.input_configuration;if(Array.isArray(J)&&J.filter(ee=>ee.user_input!==!1).length>0){h(Z.VARIABLES);return}}E(!0),h(Z.SESSION)},[j]),R=s.useCallback(()=>{h(Z.PREPARATION)},[]),I=s.useCallback(T=>{M(T),E(!0),h(Z.SESSION)},[]),L=s.useCallback(T=>{f(T.session),N(T.questions),T.selectedMicrophoneId&&d(T.selectedMicrophoneId)},[]),Q=s.useCallback(T=>{O(T.session),h(Z.COMPLETE)},[]),se=s.useCallback(()=>{x()},[x]),ne=s.useCallback(()=>{f(null),N([]),O(null),m(0),d(null),E(!1),h(Z.PREPARATION)},[]),z=()=>{switch(p){case Z.DASHBOARD:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:l,setPendingScenario:_,onNavigateToHistory:k});case Z.PREPARATION:return e.jsx(os,{scenario:j,onBack:x,onNext:S,hasVariables:F});case Z.VARIABLES:return e.jsx(ds,{scenario:j,onBack:R,onNext:I});case Z.SESSION:return e.jsx(ys,{session:y,questions:o,scenario:j,variables:w,preloadedQuestions:o.length>0?o:null,onSessionCreated:L,onComplete:Q,onExit:se,startFromQuestion:$,initialMicrophoneId:b,skipPreSession:C});case Z.COMPLETE:return e.jsx(Ns,{session:W,scenario:j,onBackToDashboard:x,onStartNew:ne});default:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:l,setPendingScenario:_,onNavigateToHistory:k})}};return e.jsx("div",{className:"min-h-full",children:z()})},vs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,ut={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:V,brain:je,info:ce,check:he,sparkles:$e},Ss=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:Y,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:G,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Ws=({scenario:t,onBack:l,onStart:a,preloadedQuestions:c})=>{const[i,n]=s.useState({}),[v,k]=s.useState({}),[p,h]=s.useState(!1),[j,g]=s.useState(null),[y,f]=s.useState(null),[o,N]=s.useState(!1),[w,M]=s.useState([]),[W,O]=s.useState(!1),{demoCode:b}=ft(),d=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const u=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(u)?u.filter(x=>x.user_input!==!1):[]}catch(u){return console.error("Error parsing input_configuration:",u),[]}},[t?.input_configuration]);s.useEffect(()=>{const u={};d.forEach(x=>{x.default&&(u[x.key]=x.default)}),n(u)},[d]);const r=(u,x)=>{if(!u)return u;let S=u;return Object.entries(x||{}).forEach(([R,I])=>{I&&(S=S.replace(new RegExp(`\\$\\{${R}\\}`,"g"),I),S=S.replace(new RegExp(`\\{${R}\\}`,"g"),I))}),S},_=(u,x)=>{n(S=>({...S,[u]:x})),v[u]&&k(S=>{const R={...S};return delete R[u],R})},$=()=>{M(u=>[...u,{key:"",value:""}])},m=(u,x,S)=>{M(R=>{const I=[...R];return I[u]={...I[u],[x]:S},I})},C=u=>{M(x=>x.filter((S,R)=>R!==u))},E=()=>{const u={};return d.forEach(x=>{const S=i[x.key];if(x.required&&(!S||S.trim()==="")){u[x.key]="Dieses Feld ist erforderlich";return}if(!(!S||S.trim()==="")&&x.validation){const{minLength:R,maxLength:I,min:L,max:Q,pattern:se}=x.validation;R&&S.length<R&&(u[x.key]=`Mindestens ${R} Zeichen erforderlich`),I&&S.length>I&&(u[x.key]=`Maximal ${I} Zeichen erlaubt`),L!==void 0&&Number(S)<L&&(u[x.key]=`Mindestens ${L}`),Q!==void 0&&Number(S)>Q&&(u[x.key]=`Maximal ${Q}`),se&&!new RegExp(se).test(S)&&(u[x.key]="UngÃ¼ltiges Format")}}),k(u),Object.keys(u).length===0},F=async u=>{if(u.preventDefault(),g(null),!!E()){h(!0);try{const x={...i};w.forEach(L=>{L.key&&L.value&&(x[L.key]=L.value)});const S=await H.createSimulatorSession({scenario_id:t.id,variables:x,demo_code:b||null,questions:c||null});if(!S.success)throw new Error(S.message||"Fehler beim Erstellen der Session");const R=S.data.session;let I;if(c&&c.length>0)I=c,await H.updateSimulatorSessionQuestions(R.id,I);else{const L=await H.generateSimulatorQuestions(R.id);if(!L.success)throw new Error(L.message||"Fehler beim Generieren der Fragen");I=L.data.questions}a({session:{...R,questions_json:I},questions:I,scenario:t,variables:x,selectedMicrophoneId:y})}catch(x){console.error("Error starting session:",x),g(x.message||"Ein Fehler ist aufgetreten")}finally{h(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:vs(r(t.long_description?.replace(/\/n/g,`
`),i))})]})]})}),(()=>{const u=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((x,S)=>typeof x=="string"?{icon:V,title:`Tipp ${S+1}`,description:x}:{icon:ut[x.icon]||ut[x.icon?.toLowerCase()]||V,title:x.title||`Tipp ${S+1}`,description:x.text||x.description||""}):Ss;return e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:u.map((x,S)=>{const R=x.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:x.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:x.description})]})]},S)})})]})})(),e.jsxs("form",{onSubmit:F,children:[d.length>0?d.map(u=>e.jsx(ss,{field:u,value:i[u.key],onChange:_,error:v[u.key]},u.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(he,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>O(!W),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${W?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[W?e.jsx(Ue,{size:18}):e.jsx(Ie,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),W&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),w.length>0&&e.jsx("div",{className:"mb-3",children:w.map((u,x)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:u.key||"",onChange:S=>m(x,"key",S.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>C(x),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(mt,{size:18})})]}),e.jsx("textarea",{value:u.value||"",onChange:S=>m(x,"value",S.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},x))}),e.jsxs("button",{type:"button",onClick:$,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(oe,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Xe,{selectedDeviceId:y,onDeviceChange:f,onTestClick:()=>N(!0)})]}),j&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),j]}),e.jsx(me,{type:"submit",disabled:p,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(Ge,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(Ye,{isOpen:o,onClose:()=>N(!1),deviceId:y}),e.jsx(jt,{isLoading:p,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{js as CancelConfirmDialog,fs as CompleteConfirmDialog,ms as ImmediateFeedback,bs as PreSessionView,hs as QuestionTips,Ns as SessionComplete,ps as SessionTimer,Vs as SimulatorApp,ot as SimulatorAudioRecorder,it as SimulatorDashboard,ys as SimulatorSession,Ws as SimulatorWizard};
