import{j as e,L as Te,I as Ne,a2 as me,T as xs,E as ie,X as Ce,V as G,i as us,g as ye,a as Xe,al as hs,l as Ye,e as xe,ak as ps,r as fs,x as ce,w as Ee,z as te,J as Ae,M as es,ao as De,f as ss,u as ze,C as ts,ap as Le,q as Be,h as Ie,b as Ke,m as M,aq as gs,A as as,am as bs,a1 as ns,a0 as Ue,a4 as js}from"./ui-vendor-zeH2bUSD.js";import{a as t}from"./react-vendor-uDOJF2jQ.js";import{C as S,k as vs,F as Ns,g as Re,a as de,u as Me,l as ys,m as rs}from"./FeatureInfoButton-CSO-N4qQ.js";import{S as ws}from"./ScenarioDashboard-beOIR-Xl.js";import{B as ve}from"./button-C6grF3c1.js";import{C as H,B as oe}from"./select-native-CSFtBRq_.js";import"./dialog-CxUaA3gX.js";import{M as Ss,a as ks,A as We}from"./MicrophoneTestDialog-fz4CO27n.js";import{I as ke}from"./input-Dvr3Lmdt.js";import{T as Cs}from"./textarea-BfSRTQPu.js";import{u as As}from"./useMobile-YxjH166V.js";import{D as Is}from"./DeviceSettingsDialog-Dc176VPG.js";import{P as Ts}from"./progress-bar-CYpV3lye.js";import{u as Es}from"./Confetti-DIaGxLMB.js";import{n as Ds,h as zs,A as Rs}from"./audioMetricsAdapter-Deh5rdpP.js";import{F as Ms}from"./fullscreen-loader-CRudiTEg.js";const qe={error:{bg:S.red[50],border:S.red[200],text:S.red[600],icon:ie},warning:{bg:S.amber[50],border:S.amber[200],text:S.amber[600],icon:xs},success:{bg:S.green[50],border:S.green[200],text:S.green[600],icon:me},info:{bg:S.blue[50],border:S.blue[200],text:S.blue[500],icon:Ne},loading:{bg:S.blue[50],border:S.blue[200],text:S.blue[500],icon:Te}},_s=({variant:s="info",message:a,children:n,isToast:i=!1,onDismiss:o,className:d="",style:m={}})=>{const r=qe[s]||qe.info,c=r.icon,j=s==="loading";return e.jsxs("div",{className:`flex items-center gap-3 py-3 px-4 rounded-xl text-sm font-medium ${i?"fixed bottom-6 left-1/2 -translate-x-1/2 shadow-lg z-[1000] max-w-[90%]":""} ${d}`,style:{backgroundColor:r.bg,border:`1px solid ${r.border}`,color:r.text,...m},children:[e.jsx(c,{size:20,className:`flex-shrink-0 ${j?"animate-spin":""}`}),e.jsx("span",{className:"flex-1",children:n||a}),o&&e.jsx("button",{onClick:o,className:"bg-transparent border-none p-1 cursor-pointer flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity",style:{color:r.text},"aria-label":"Schließen",children:e.jsx(Ce,{size:16})})]})},Vs=({message:s,onDismiss:a,...n})=>e.jsx(_s,{variant:"error",message:s,isToast:!0,onDismiss:a,...n}),Fs={video:G,user:ce,briefcase:fs,presentation:ps,mic:xe,target:Ye,banknote:hs},Ps=async()=>{const s=await fetch(`${Re()}/video-training/scenarios`,{headers:{"X-WP-Nonce":de()}});if(!s.ok)throw new Error("Fehler beim Laden der Szenarien");const a=await s.json();if(a.success&&a.data?.scenarios)return a.data.scenarios;throw new Error("Ungültige Antwort vom Server")},Os=s=>Fs[s.icon]||G,$s=s=>[{text:`${s.question_count} Fragen`},{icon:ye,text:`~${Math.round(s.total_time_limit/60)} Min.`}],Ls=()=>e.jsx("div",{className:"mt-10 p-5 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed m-0",children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Ge=({onSelectScenario:s,isAuthenticated:a,requireAuth:n,setPendingScenario:i,onNavigateToHistory:o})=>e.jsxs(e.Fragment,{children:[e.jsx(vs,{featureId:"videotraining",showOnMount:!0}),e.jsx(ws,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:G,headerActions:e.jsx(Ns,{featureId:"videotraining",size:"sm"}),fetchScenarios:Ps,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:o,onSelectScenario:s,renderCardMeta:$s,getIconForScenario:Os,cardActionLabel:"Starten",cardActionIcon:us,categoryField:"category",emptyStateIcon:G,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:Ls,isAuthenticated:a,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."})]}),Bs=s=>s?s.split(/(\*\*.*?\*\*)/g).map((n,i)=>n.startsWith("**")&&n.endsWith("**")?e.jsx("strong",{children:n.slice(2,-2)},i):n):null,Qe={target:Ye,clock:ye,mic:xe,camera:De,video:G,"message-square":es,lightbulb:te,brain:te,info:Ne,settings:Ae,check:me,sparkles:Xe,user:ce,x:ie},Ks=[{icon:"camera",text:"Schaue direkt in die Kamera für Augenkontakt."},{icon:"lightbulb",text:"Achte auf gute Beleuchtung von vorne."},{icon:"target",text:"Struktur: Wer → Was → Warum."},{icon:"mic",text:"Sprich deutlich und in ruhigem Tempo."}],Us=({type:s,devices:a,selectedDeviceId:n,onDeviceChange:i,isLoading:o,error:d,onRefresh:m})=>{const[r,c]=t.useState(!1),j=s==="video"?De:xe,g=s==="video"?"Kamera":"Mikrofon",l=x=>{if(x.label){let p=x.label;return p=p.replace(/^Default - /,""),p=p.replace(/^Kommunikation - /,""),p=p.replace(/^Standard - /,""),p.length>40&&(p=p.substring(0,37)+"..."),p}return`${g} ${a.indexOf(x)+1}`},h=a.find(x=>x.deviceId===n),u=x=>{i?.(x),c(!1)};return e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{type:"button",onClick:()=>!o&&c(!r),disabled:o,className:`flex-1 flex items-center justify-between gap-3 px-[18px] py-3.5 rounded-[14px] border-2 transition-all duration-200 ${d?"border-red-500 bg-red-50":"border-slate-200 bg-white"} ${o?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${d?"bg-red-50":"bg-brand-gradient"}`,children:d?e.jsx(ie,{className:"w-6 h-6 text-red-500"}):e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[13px] text-slate-500 font-medium mb-0.5",children:g}),e.jsx("div",{className:`text-[15px] font-semibold ${d?"text-red-700":"text-slate-900"}`,children:o?"Lade...":d||(h?l(h):"Bitte wählen")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&m&&e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),m()},className:"flex items-center justify-center p-2 rounded-lg border-0 bg-slate-50 cursor-pointer",children:e.jsx(ze,{className:"w-[18px] h-[18px] text-slate-600"})}),e.jsx(ts,{className:`w-[22px] h-[22px] text-slate-400 transition-transform duration-200 ${r?"rotate-180":"rotate-0"}`})]})]})}),r&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>c(!1),className:"fixed inset-0 z-40"}),e.jsx("div",{className:"absolute top-[calc(100%+8px)] left-0 right-0 bg-white rounded-[14px] shadow-[0_10px_40px_rgba(0,0,0,0.15)] border border-slate-200 z-50 overflow-hidden max-h-[300px] overflow-y-auto",children:a.map((x,p)=>e.jsxs("button",{type:"button",onClick:()=>u(x.deviceId),className:`w-full py-3.5 px-4 text-left flex items-center gap-3 border-0 cursor-pointer transition-colors duration-150 ${n===x.deviceId?"bg-primary/10":"bg-transparent hover:bg-slate-50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-[10px] flex items-center justify-center ${n===x.deviceId?"bg-primary":"bg-slate-50"}`,children:e.jsx(j,{className:`w-5 h-5 ${n===x.deviceId?"text-white":"text-slate-400"}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:`text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap ${n===x.deviceId?"text-primary":"text-slate-900"}`,children:l(x)})}),n===x.deviceId&&e.jsx(me,{className:"w-5 h-5 text-primary"})]},x.deviceId||p))})]})]})},Ws=({deviceId:s})=>{const a=t.useRef(null),n=t.useRef(null),[i,o]=t.useState(null);return t.useEffect(()=>(s&&(async()=>{try{n.current&&n.current.getTracks().forEach(r=>r.stop());const m=await navigator.mediaDevices.getUserMedia({video:s?{deviceId:{exact:s}}:!0});n.current=m,a.current&&(a.current.srcObject=m),o(null)}catch(m){console.error("Error starting camera preview:",m),o("Kamera-Vorschau nicht verfügbar")}})(),()=>{n.current&&n.current.getTracks().forEach(m=>m.stop())}),[s]),i?e.jsx("div",{className:"aspect-video bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 text-sm",children:i}):e.jsx("div",{className:"aspect-video bg-slate-900 rounded-xl overflow-hidden",children:e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"})})},qs=({scenario:s,onBack:a,onNext:n,hasVariables:i=!1})=>{const[o,d]=t.useState([]),[m,r]=t.useState([]),[c,j]=t.useState(null),[g,l]=t.useState(null),[h,u]=t.useState(!0),[x,p]=t.useState(null),[D,k]=t.useState(null),[b,A]=t.useState(!1),y=t.useRef(0),V=t.useRef(!1),W=t.useRef(null),Q=t.useRef(null);W.current=c,Q.current=g;const L=t.useCallback(async(C=!1)=>{if(!V.current&&!(C&&Date.now()-y.current<2e3)){V.current=!0,y.current=Date.now(),u(!0),p(null),k(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(z=>z.stop());const P=await navigator.mediaDevices.enumerateDevices(),O=P.filter(z=>z.kind==="audioinput"),B=P.filter(z=>z.kind==="videoinput");if(O.length===0)p("Kein Mikrofon gefunden"),d([]);else if(d(O),!W.current){const z=O.find(J=>J.deviceId==="default")||O[0];j(z.deviceId)}if(B.length===0)k("Keine Kamera gefunden"),r([]);else if(r(B),!Q.current){const z=B.find(J=>J.deviceId==="default")||B[0];l(z.deviceId)}}catch(w){console.error("Error loading devices:",w),w.name==="NotAllowedError"||w.name==="PermissionDeniedError"?(p("Zugriff verweigert"),k("Zugriff verweigert")):w.name==="NotFoundError"?(p("Kein Mikrofon gefunden"),k("Keine Kamera gefunden")):(p("Fehler beim Laden"),k("Fehler beim Laden"))}finally{u(!1),V.current=!1,y.current=Date.now()}}},[]);t.useEffect(()=>{L(!1);let C=null;const w=()=>{C&&clearTimeout(C),C=setTimeout(()=>L(!0),500)};return navigator.mediaDevices?.addEventListener("devicechange",w),()=>{C&&clearTimeout(C),navigator.mediaDevices?.removeEventListener("devicechange",w)}},[L]);const F=()=>{n({selectedMicrophoneId:c,selectedCameraId:g})},Z=c&&!x&&g&&!D,q=s?.tips&&Array.isArray(s.tips)&&s.tips.length>0?s.tips:Ks;return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(Ee,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(G,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600 m-0 mb-1",children:"Vorbereitung"}),e.jsx("h1",{className:"text-[24px] font-bold text-slate-900 m-0",children:s?.title||"Training"})]})]})]}),s?.long_description&&e.jsx(H,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:Bs(s.long_description)})]})]})}),q.length>0&&e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(te,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps für dein Training"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise für optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:q.map((C,w)=>{const P=Qe[C.icon]||Qe[C.icon?.toLowerCase()]||te;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(P,{className:"w-4 h-4 text-slate-600"})}),e.jsx("p",{className:"text-sm text-slate-700 m-0 pt-1",children:C.text||C.description})]},w)})})]}),h?e.jsx(H,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Te,{className:"w-8 h-8 text-primary mb-4 animate-spin"}),e.jsx("p",{className:"text-slate-600 m-0",children:"Geräte werden geladen..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"p-5 md:p-6 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(De,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Kamera auswählen"})]}),e.jsx(Us,{type:"video",devices:m,selectedDeviceId:g,onDeviceChange:l,isLoading:h,error:D,onRefresh:L}),g&&!D&&e.jsx(Ws,{deviceId:g})]}),e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(xe,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(Ss,{selectedDeviceId:c,onDeviceChange:j,onTestClick:()=>A(!0)})]})]}),e.jsxs(ve,{onClick:F,disabled:!Z,size:"lg",className:"w-full gap-2.5",children:[i?"Weiter zur Konfiguration":"Video-Training starten",e.jsx(ss,{className:"w-5 h-5"})]}),e.jsx(ks,{isOpen:b,onClose:()=>A(!1),deviceId:c})]})},is=(s,a)=>{if(!a)return null;if(s.type==="select"&&s.options){const n=s.options.find(i=>i.value===a);return n?n.label:a}return a},Gs=({field:s,value:a,onChange:n,error:i})=>{const o=m=>{setTimeout(()=>{const r=m.target;if(r){const c=r.closest("div");c&&c.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=()=>{const m=i?"border-red-500":"";switch(s.type){case"text":return e.jsx(ke,{type:"text",value:a||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",className:m,onFocus:o});case"textarea":return e.jsx(Cs,{value:a||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",rows:4,className:`${m} min-h-[100px] resize-y`,onFocus:o});case"select":return e.jsxs("select",{value:a||s.default||"",onChange:r=>n(s.key,r.target.value),className:`w-full px-4 py-3 rounded-xl border-2 text-base text-slate-900 bg-white outline-none transition-all cursor-pointer appearance-none bg-[url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%236b7280%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e')] bg-[position:right_12px_center] bg-no-repeat bg-[length:20px] pr-11 focus:border-primary focus:ring-2 focus:ring-primary/20 ${i?"border-red-500":"border-slate-200"}`,onFocus:o,children:[!s.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),s.options?.slice().sort((r,c)=>r.label.localeCompare(c.label,"de")).map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"number":return e.jsx(ke,{type:"number",value:a||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",min:s.validation?.min,max:s.validation?.max,className:m,onFocus:o});default:return e.jsx(ke,{type:"text",value:a||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",className:m,onFocus:o})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[s.label,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),d(),i&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-red-500 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),i]}),s.hint&&!i&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-slate-500 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),s.hint]})]})},Qs=({inputConfig:s,formValues:a})=>{const n=s.filter(i=>{const o=a[i.key];return o&&(typeof o!="string"||o.trim()!=="")});return n.length===0?null:e.jsxs(H,{className:"p-4 mb-5 bg-slate-50 border-slate-200",children:[e.jsx("div",{className:"text-xs font-semibold text-primary uppercase tracking-wide mb-3",children:"Dein Profil"}),e.jsx("div",{className:"space-y-2",children:n.map(i=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-slate-500",children:i.label}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:is(i,a[i.key])})]},i.key))})]})},Zs=({scenario:s,onBack:a,onNext:n})=>{const[i,o]=t.useState({}),[d,m]=t.useState({}),r=t.useMemo(()=>{if(!s?.input_configuration)return[];try{return(Array.isArray(s.input_configuration)?s.input_configuration:[]).filter(h=>h.user_input!==!1)}catch(l){return console.error("Error parsing input_configuration:",l),[]}},[s?.input_configuration]);t.useEffect(()=>{const l={};r.forEach(h=>{h.default&&(l[h.key]=h.default)}),o(l)},[r]);const c=(l,h)=>{o(u=>({...u,[l]:h})),d[l]&&m(u=>{const x={...u};return delete x[l],x})},j=()=>{const l={};return r.forEach(h=>{const u=i[h.key];if(h.required&&(!u||typeof u=="string"&&u.trim()==="")){l[h.key]="Dieses Feld ist erforderlich";return}if(!(!u||typeof u=="string"&&u.trim()==="")&&h.validation){const{minLength:x,maxLength:p,min:D,max:k,pattern:b}=h.validation;x&&u.length<x&&(l[h.key]=`Mindestens ${x} Zeichen erforderlich`),p&&u.length>p&&(l[h.key]=`Maximal ${p} Zeichen erlaubt`),D!==void 0&&Number(u)<D&&(l[h.key]=`Mindestens ${D}`),k!==void 0&&Number(u)>k&&(l[h.key]=`Maximal ${k}`),b&&!new RegExp(b).test(u)&&(l[h.key]="Ungültiges Format")}}),m(l),Object.keys(l).length===0},g=l=>{if(l.preventDefault(),!j())return;const h={...i};r.forEach(u=>{u.type==="select"&&i[u.key]&&(h[`${u.key}_label`]=is(u,i[u.key]))}),n(h)};return t.useEffect(()=>{r.length===0&&n({})},[r,n]),r.length===0?null:e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(Ee,{size:18}),"Zurück"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(ce,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Personalisierung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:s?.title})]})]})]}),e.jsx(Qs,{inputConfig:r,formValues:i}),e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Dein Profil anpassen"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Diese Informationen personalisieren die Fragen"})]})]}),e.jsx("form",{onSubmit:g,id:"variables-form",children:r.map(l=>e.jsx(Gs,{field:l,value:i[l.key],onChange:c,error:d[l.key]},l.key))})]}),e.jsxs(ve,{type:"submit",form:"variables-form",size:"lg",className:"w-full gap-2.5",children:["Video-Training starten",e.jsx(ss,{className:"w-5 h-5"})]})]})},Hs=({tips:s,primaryAccent:a})=>{const[n,i]=t.useState(!1);return!s||s.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(te,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(Ie,{size:18,className:`text-slate-500 transition-transform duration-200 ${n?"rotate-90":""}`})]}),e.jsx(as,{children:n&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:s.map((o,d)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:o},d))})})})})]})},Js=({number:s,size:a="md"})=>{const n={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${n[a]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:s})},Ze=({question:s,index:a,scenario:n,isMobile:i})=>e.jsxs(H,{className:i?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Js,{number:a+1,size:i?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:s?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${i?"text-[15px]":"text-lg"} mb-0`,children:s?.question||"Frage wird geladen..."}),s?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(ye,{size:i?14:16}),"Empfohlene Antwortzeit: ~",Math.round(s.estimated_time/60)," Min."]}),n?.enable_tips&&s?.tips&&e.jsx(Hs,{tips:s.tips})]}),He=({time:s,isRecording:a})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[a?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(ye,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:ys(s)})]}),Je=({error:s,onRetry:a})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(gs,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:s}),e.jsx(oe,{onClick:a,icon:e.jsx(ze,{size:16}),children:"Erneut versuchen"})]}),Xs=({isUploading:s,isAnalyzing:a})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-indigo-50/30 to-violet-50/30 flex items-center justify-center p-4",children:e.jsxs(M.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx(Te,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:s?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:s?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),Ys=({session:s,questions:a,scenario:n,variables:i,onComplete:o,onExit:d,selectedMicrophoneId:m,selectedCameraId:r})=>{const[c,j]=t.useState(0),[g,l]=t.useState(!1),[h,u]=t.useState(!1),[x,p]=t.useState(0),[D,k]=t.useState([]),[b,A]=t.useState([]),[y,V]=t.useState(null),[W,Q]=t.useState(null),[L,F]=t.useState(!1),[Z,q]=t.useState(!1),[C,w]=t.useState(null),[P,O]=t.useState(m||null),[B,z]=t.useState(r||null),[J,ae]=t.useState(!1),[ue,he]=t.useState(0),X=As(),ne=t.useRef(null),v=t.useRef(null),I=t.useRef(null),_=t.useRef(null),T=t.useRef(null),K=t.useRef(null),{branding:pe}=Me(),Y=pe?.["--primary-accent"],re=a[c];t.useEffect(()=>(U(),()=>{we(),I.current&&clearInterval(I.current),K.current&&cancelAnimationFrame(K.current),_.current&&_.current.close()}),[]);const fe=f=>{try{_.current&&_.current.close();const R=new(window.AudioContext||window.webkitAudioContext);_.current=R;const N=R.createAnalyser();N.fftSize=256,N.smoothingTimeConstant=.8,T.current=N,R.createMediaStreamSource(f).connect(N);const ee=new Uint8Array(N.frequencyBinCount),se=()=>{if(!T.current)return;T.current.getByteFrequencyData(ee);const Se=ee.reduce((ds,ms)=>ds+ms,0)/ee.length;he(Se/255),K.current=requestAnimationFrame(se)};se()}catch(R){console.error("[VIDEO TRAINING] Audio analysis error:",R)}},ge=()=>{K.current&&(cancelAnimationFrame(K.current),K.current=null),he(0)},U=async(f=P,R=B)=>{try{Q(null),y&&y.getTracks().forEach(se=>se.stop());const N=R?{deviceId:{exact:R},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},$=f?{deviceId:{exact:f}}:!0,ee=await navigator.mediaDevices.getUserMedia({video:N,audio:$});V(ee),ne.current&&(ne.current.srcObject=ee)}catch(N){console.error("[VIDEO TRAINING] Camera error:",N),Q("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},ls=f=>{O(f),g||U(f,B)},os=f=>{z(f),g||U(P,f)},we=()=>{y&&(y.getTracks().forEach(f=>f.stop()),V(null))},_e=()=>{if(!y){U();return}try{const f=new MediaRecorder(y,{mimeType:"video/webm;codecs=vp9,opus"});v.current=f;const R=[];f.ondataavailable=N=>{N.data.size>0&&(R.push(N.data),k($=>[...$,N.data]))},f.onstop=()=>{},f.start(1e3),l(!0),u(!1),fe(y),A(N=>[...N,{question_index:c,start_time:x}]),I.current=setInterval(()=>{p(N=>N+1)},1e3)}catch(f){console.error("[VIDEO TRAINING] Recording error:",f),w("Fehler beim Starten der Aufnahme")}},be=()=>{v.current&&g&&(v.current.stop(),l(!1),ge(),I.current&&(clearInterval(I.current),I.current=null))},Ve=()=>{c<a.length-1&&(g&&A(f=>[...f,{question_index:c+1,start_time:x}]),j(f=>f+1))},Fe=()=>{c>0&&j(f=>f-1)},Pe=async()=>{be(),we(),F(!0),w(null);try{const f=new Blob(D,{type:"video/webm"}),R=Re(),N=new FormData;N.append("video",f,`video_${s.id}.webm`),N.append("video_duration",x.toString()),N.append("timeline",JSON.stringify(b));const $=await fetch(`${R}/video-training/sessions/${s.id}/video`,{method:"POST",headers:{"X-WP-Nonce":de()},body:N});if(!$.ok){const Se=await $.text();throw console.error("[VIDEO TRAINING] Upload failed:",$.status,Se),$.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+$.status)}const ee=await $.json();F(!1),q(!0);const se=await fetch(`${R}/video-training/sessions/${s.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()}});if(!se.ok)throw new Error("Fehler bei der Video-Analyse");const le=await se.json();o({session:le.data?.session||s,analysis:le.data?.analysis,categoryScores:le.data?.category_scores,overallScore:le.data?.overall_score})}catch(f){console.error("[VIDEO TRAINING] Upload/Analysis error:",f),w(f.message),F(!1),q(!1)}},cs=()=>{be(),we(),d()};if(L||Z)return e.jsx(Xs,{isUploading:L,isAnalyzing:Z});const je=D.length>0,Oe=n?.enable_navigation&&c>0,$e=n?.enable_navigation&&c<a.length-1;return e.jsxs("div",{className:`${X?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${X?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${X?"text-lg":"text-xl"} font-semibold text-slate-900`,children:n?.title}),e.jsxs("button",{onClick:cs,className:`${X?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Ce,{size:16}),"Abbrechen"]})]}),e.jsx(Ts,{current:c,total:a.length,primaryAccent:Y,showCompleted:!1}),X?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Ze,{question:re,index:c,scenario:n,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[W?e.jsx(Je,{error:W,onRetry:U}):e.jsx("video",{ref:ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(g||x>0)&&e.jsx(He,{time:x,isRecording:g})]}),g&&e.jsx("div",{className:"mt-4",children:e.jsx(We,{audioLevel:ue,isActive:!0,variant:"bars",size:"sm",accentColor:Y})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>ae(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(Ae,{size:20,className:"text-slate-500"})}),g?e.jsxs("button",{onClick:be,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(Le,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:_e,disabled:!y,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${y?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(G,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[Oe&&e.jsx(oe,{variant:"secondary",size:"sm",icon:e.jsx(Be,{size:16}),onClick:Fe,className:"flex-1",children:"Zurück"}),$e&&e.jsx(oe,{size:"sm",iconPosition:"right",icon:e.jsx(Ie,{size:16}),onClick:Ve,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Pe,disabled:!je,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${je?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Ke,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[W?e.jsx(Je,{error:W,onRetry:U}):e.jsx("video",{ref:ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(g||x>0)&&e.jsx(He,{time:x,isRecording:g})]}),g&&e.jsx("div",{className:"mt-5",children:e.jsx(We,{audioLevel:ue,isActive:!0,variant:"bars",size:"sm",accentColor:Y})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>ae(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(Ae,{size:20,className:"text-slate-500"})}),g?e.jsxs("button",{onClick:be,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(Le,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:_e,disabled:!y,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${y?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(G,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[Oe&&e.jsx(oe,{variant:"secondary",icon:e.jsx(Be,{size:18}),onClick:Fe,children:"Vorherige"}),$e&&e.jsx(oe,{iconPosition:"right",icon:e.jsx(Ie,{size:18}),onClick:Ve,children:"Nächste"}),e.jsxs("button",{onClick:Pe,disabled:!je,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${je?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Ke,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(Ze,{question:re,index:c,scenario:n,isMobile:!1})]}),C&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(ie,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:C}),e.jsx("button",{onClick:()=>w(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(Ce,{size:16,className:"text-red-500"})})]}),e.jsx(Is,{isOpen:J,onClose:()=>ae(!1),mode:"audio-video",selectedMicrophoneId:P,onMicrophoneChange:ls,selectedCameraId:B,onCameraChange:os})]})},et={auftreten:js,selbstbewusstsein:Ue,koerpersprache:ce,kommunikation:es,professionalitaet:Ue,inhalt:te},st=({score:s,size:a=120,strokeWidth:n=10,primaryAccent:i})=>{const o=(a-n)/2,d=o*2*Math.PI,m=d-s/100*d,r=rs(s,i);return e.jsxs("div",{className:"relative mx-auto",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"-rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:o,fill:"none",stroke:S.slate[200],strokeWidth:n}),e.jsx(M.circle,{cx:a/2,cy:a/2,r:o,fill:"none",stroke:r,strokeWidth:n,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:m},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold text-slate-600",style:{fontSize:a/3,color:r},children:Math.round(s)}),e.jsx("span",{className:"text-slate-500",style:{fontSize:a/10},children:"von 100"})]})]})},tt=({category:s,primaryAccent:a})=>{const[n,i]=t.useState(!1),o=et[s.category]||ns,d=rs(s.score,a);return e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-slate-200 overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:`${d}15`},children:e.jsx(o,{size:20,color:d})}),e.jsxs("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"text-[15px] font-semibold text-slate-900 mb-0.5",children:s.label}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[s.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",style:{color:d},children:Math.round(s.score)}),e.jsx(ts,{size:20,className:"text-slate-500 transition-transform duration-200",style:{transform:n?"rotate(180deg)":"none"}})]})]}),e.jsx(as,{children:n&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:s.feedback}),s.strengths&&s.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-green-600 mb-2 flex items-center gap-1.5",children:[e.jsx(me,{size:14}),"Stärken"]}),e.jsx("ul",{className:"m-0 pl-5",children:s.strengths.map((m,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:m},r))})]}),s.improvements&&s.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-amber-600 mb-2 flex items-center gap-1.5",children:[e.jsx(ie,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:s.improvements.map((m,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:m},r))})]})]})})})]})},at=({session:s,scenario:a,onBackToDashboard:n,onStartNew:i})=>{const{branding:o}=Me(),d=o?.["--primary-accent"]||S.indigo[500],m=t.useRef(null),{triggerConfetti:r,ConfettiComponent:c}=Es(),j=s?.overall_score||0,g=s?.category_scores||[],l=s?.analysis||{},h=s?.summary_feedback||"",u=t.useMemo(()=>l&&(l.filler_words||l.speech_metrics)?{filler_words:l.filler_words,speech_metrics:l.speech_metrics}:null,[l]),x=t.useMemo(()=>Ds(u),[u]),p=zs(u),D=b=>{m.current&&(m.current.currentTime=b,m.current.play())},k=b=>b>=90?"Ausgezeichnet!":b>=80?"Sehr gut!":b>=70?"Gut!":b>=60?"Solide Leistung":b>=50?"Ausbaufähig":"Weiter üben!";return t.useEffect(()=>{j>=70&&r()},[j,r]),e.jsxs(e.Fragment,{children:[e.jsx(c,{}),e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs(M.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-brand-gradient flex items-center justify-center mx-auto mb-5 shadow-xl",children:e.jsx(bs,{size:40,color:S.white})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Training abgeschlossen!"}),e.jsxs("p",{className:"text-base text-slate-600",children:[a?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"bg-white rounded-2xl p-8 text-center border border-slate-200 shadow-md mb-6",children:[e.jsx(st,{score:j,size:160,primaryAccent:d}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mt-5 mb-2",children:k(j)}),e.jsx("p",{className:"text-[15px] text-slate-600 max-w-lg mx-auto leading-relaxed",children:h||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),g.length>0&&e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(ns,{size:20,color:d}),"Detaillierte Bewertung"]}),g.map((b,A)=>e.jsx(tt,{category:b,primaryAccent:d},b.category||A))]}),l&&(l.key_strengths?.length>0||l.actionable_tips?.length>0)&&e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[l.key_strengths&&l.key_strengths.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-base font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(me,{size:18}),"Deine Stärken"]}),e.jsx("ul",{className:"m-0 pl-6",children:l.key_strengths.map((b,A)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:b},A))})]}),l.actionable_tips&&l.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-base font-semibold mb-3 flex items-center gap-2",style:{color:d},children:[e.jsx(te,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-6",children:l.actionable_tips.map((b,A)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:b},A))})]})]}),p&&e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.45},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(xe,{size:18,color:d}),"Sprechanalyse"]}),e.jsx(Rs,{audioAnalysis:x,primaryAccent:d,onJumpToTimestamp:D})]}),s?.video_url&&e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(G,{size:18,color:d}),"Deine Aufnahme"]}),e.jsx("video",{ref:m,src:s.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]}),e.jsxs(M.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex gap-4 justify-center",children:[e.jsxs(ve,{onClick:n,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(Ee,{size:18}),"Zur Übersicht"]}),e.jsxs(ve,{onClick:i,size:"lg",className:"gap-2 shadow-lg",children:[e.jsx(ze,{size:18}),"Nochmal üben"]})]})]})]})},E={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},vt=({isAuthenticated:s,requireAuth:a,setPendingAction:n,pendingScenario:i,clearPendingScenario:o,onNavigateToHistory:d})=>{const[m,r]=t.useState(E.DASHBOARD),[c,j]=t.useState(null),[g,l]=t.useState(null),[h,u]=t.useState([]),[x,p]=t.useState({}),[D,k]=t.useState(null),[b,A]=t.useState(null),[y,V]=t.useState(null),[W,Q]=t.useState(!1),[L,F]=t.useState(null),[Z,q]=t.useState(null),{demoCode:C}=Me(),w=t.useMemo(()=>{if(!c?.input_configuration)return!1;try{return(Array.isArray(c.input_configuration)?c.input_configuration:[]).filter(I=>I.user_input!==!1).length>0}catch{return!1}},[c?.input_configuration]);t.useEffect(()=>{(async()=>{if(i&&s){let I=i;if(i.id&&!i.title)try{const _=window.bewerbungstrainerData?.restUrl||"/wp-json/bewerbungstrainer/v1",T=await fetch(`${_}/video-training/scenarios/${i.id}`);if(T.ok)I=await T.json(),console.log("[VideoTrainingApp] Fetched scenario:",I.title);else{console.error("[VideoTrainingApp] Failed to fetch scenario:",T.status),o&&o();return}}catch(_){console.error("[VideoTrainingApp] Error fetching scenario:",_),o&&o();return}j(I),r(E.PREPARATION),o&&o()}})()},[i,s,o]),t.useEffect(()=>{Z&&s&&(j(Z),r(E.PREPARATION),q(null))},[Z,s]),t.useEffect(()=>{window.scrollTo(0,0)},[m]);const P=t.useCallback(v=>{j(v),r(E.PREPARATION)},[]),O=t.useCallback(()=>{j(null),l(null),u([]),p({}),k(null),A(null),V(null),F(null),r(E.DASHBOARD)},[]),B=t.useCallback(v=>{if(A(v.selectedMicrophoneId),V(v.selectedCameraId),c?.input_configuration&&(Array.isArray(c.input_configuration)?c.input_configuration:[]).filter(T=>T.user_input!==!1).length>0){r(E.VARIABLES);return}ae({},v.selectedMicrophoneId,v.selectedCameraId)},[c]),z=t.useCallback(()=>{r(E.PREPARATION)},[]),J=t.useCallback(v=>{p(v),ae(v,b,y)},[b,y]),ae=async(v,I,_)=>{Q(!0),F(null);try{const T=Re(),K=await fetch(`${T}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()},body:JSON.stringify({scenario_id:c.id,variables:v,demo_code:C||null})});if(!K.ok){const U=await K.json().catch(()=>({}));throw new Error(U.message||"Fehler beim Erstellen der Session")}const pe=await K.json(),Y=pe.data?.session||pe.session;if(!Y)throw new Error("Keine Session-ID erhalten");const re=await fetch(`${T}/video-training/sessions/${Y.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()},body:JSON.stringify({variables:v})});if(!re.ok){const U=await re.json().catch(()=>({}));throw new Error(U.message||"Fehler beim Generieren der Fragen")}const fe=await re.json(),ge=fe.data?.questions||fe.questions||[];l({...Y,questions:ge}),u(ge),p(v),A(I),V(_),r(E.SESSION)}catch(T){console.error("Error starting session:",T),F(T.message)}finally{Q(!1)}},ue=t.useCallback(v=>{k(v.session),r(E.COMPLETE)},[]),he=t.useCallback(()=>{O()},[O]),X=t.useCallback(()=>{l(null),u([]),k(null),A(null),V(null),F(null),r(E.PREPARATION)},[]),ne=()=>{switch(m){case E.DASHBOARD:return e.jsx(Ge,{onSelectScenario:P,isAuthenticated:s,requireAuth:a,setPendingScenario:q,onNavigateToHistory:d});case E.PREPARATION:return e.jsx(qs,{scenario:c,onBack:O,onNext:B,hasVariables:w});case E.VARIABLES:return e.jsx(Zs,{scenario:c,onBack:z,onNext:J});case E.SESSION:return e.jsx(Ys,{session:g,questions:h,scenario:c,variables:x,onComplete:ue,onExit:he,selectedMicrophoneId:b,selectedCameraId:y});case E.COMPLETE:return e.jsx(at,{session:D,scenario:c,onBackToDashboard:O,onStartNew:X});default:return e.jsx(Ge,{onSelectScenario:P,isAuthenticated:s,requireAuth:a,setPendingScenario:q,onNavigateToHistory:d})}};return e.jsxs("div",{className:"min-h-full",children:[ne(),L&&e.jsx(Vs,{message:L,onDismiss:()=>F(null)}),e.jsx(Ms,{isLoading:W,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{vt as V,Ge as a,Ys as b,at as c};
