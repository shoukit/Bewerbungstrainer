import{j as e,O as G,F as P,h as Te,y as Q,ae as L,au as et,av as W,i as tt,aw as _e,ad as st,R as Y,c as ie,S as le,a0 as oe,ax as ce,ay as de,a8 as me,l as X,as as ee,w as xe,U as he,aj as te,B as se,v as Re,x as ke,C as ue,z as H,a as pe,Q as Ie,b as Be,Y as ze,t as rt,az as Ee,L as be,m as q,a9 as we,X as Pe,aA as Ae,aB as nt,A as Se,aC as Le}from"./ui-vendor-BaF13Yzb.js";import{a as n}from"./react-vendor-uDOJF2jQ.js";import{w as V,k as at,F as it,C as lt}from"./FeatureInfoButton-DPifsdNw.js";import{S as ot}from"./ScenarioDashboard-C7460fIX.js";import{B as Z,C as J}from"./select-native-DR-o3jUm.js";import"./dialog-CNQsgZ9g.js";import{F as ct}from"./fullscreen-loader-DcEMdeyR.js";import{D as dt}from"./DynamicFormField-CV2R65su.js";import{a as mt,B as xt}from"./BriefingWorkbook-Dz61T_dp.js";import{u as ht}from"./useMobile-YxjH166V.js";import"./ScenarioCard-Dxee9Sfp.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";const ut={"file-text":P,briefcase:se,banknote:te,users:he,user:xe,"message-circle":ee,target:X,award:me,book:de,clipboard:ce,star:oe,lightbulb:Q,shield:le,compass:ie,rocket:Y,heart:st,folder:_e,"trending-up":tt},Ne={shortLabel:"Meine",color:"#7C3AED",bgColor:"#EDE9FE"},pt=({onSelectTemplate:s,onShowList:j,onCreateTemplate:x,onEditTemplate:c,onCopyTemplate:b,isAuthenticated:i,requireAuth:d,setPendingAction:h,demoCode:g})=>{const[y,p]=n.useState(null),[r,m]=n.useState(0),a=n.useCallback(async()=>{const N=new URLSearchParams;g&&N.append("demo_code",g);const w=await V.request(`/smartbriefing/templates?${N.toString()}`,{method:"GET"});if(w.success&&w.data?.templates)return w.data.templates;throw new Error("Unerwartete API-Antwort")},[g,r]),f=()=>{if(!i&&!g){d&&(h(()=>x),d());return}x?.()},u=(N,w)=>{N.stopPropagation(),c?.(w)},k=(N,w)=>{N.stopPropagation(),p(w)},l=(N,w)=>{if(N.stopPropagation(),!i&&!g){d&&(h(()=>()=>b?.({...w,title:`${w.title} (Kopie)`,id:null,is_custom:!0})),d());return}b?.({...w,title:`${w.title} (Kopie)`,id:null,is_custom:!0})},B=async()=>{if(y)try{const N=new URLSearchParams;g&&N.append("demo_code",g),(await V.request(`/smartbriefing/templates/${y.id}?${N.toString()}`,{method:"DELETE"})).success&&m(T=>T+1)}catch(N){console.error("[SmartBriefing] Error deleting template:",N)}finally{p(null)}},D=N=>ut[N.icon]||P,I=N=>{const w=N.variables_schema?.length||0;return[{text:`${w} Eingabefeld${w!==1?"er":""}`}]},_=(N,w)=>{const T=N.category?w(N.category):null;return e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[T&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-2xl text-[11px] font-semibold",style:{backgroundColor:T.bgColor,color:T.color},children:[T.IconComponent&&e.jsx(T.IconComponent,{style:{width:"12px",height:"12px"}}),T.shortLabel]}),N.is_custom&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-2xl text-[11px] font-semibold",style:{backgroundColor:Ne.bgColor,color:Ne.color},children:[e.jsx(_e,{style:{width:"12px",height:"12px"}}),Ne.shortLabel]})]})},O=N=>N.is_custom?"ring-2 ring-violet-200 bg-violet-50/30":"",S=N=>N.is_custom?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:w=>u(w,N),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-slate-100 hover:text-primary",title:"Template bearbeiten",children:e.jsx(et,{size:16})}),e.jsx("button",{onClick:w=>k(w,N),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-red-50 hover:text-red-500",title:"Template lÃ¶schen",children:e.jsx(G,{size:16})})]}):b?e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:w=>l(w,N),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Als eigenes Template kopieren",children:e.jsx(W,{size:16})})}):null,v=(i||g)&&x?e.jsxs("button",{onClick:f,className:"flex items-center gap-2 py-2.5 px-4 rounded-xl border-2 border-dashed border-indigo-200 bg-white text-indigo-500 text-sm font-medium cursor-pointer transition-all whitespace-nowrap hover:border-indigo-400 hover:bg-indigo-50 hover:shadow-sm",children:[e.jsx(L,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"persÃ¶nliches Template"}),e.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,z=()=>e.jsx("div",{className:"mt-12 py-5 px-6 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{size:20,className:"text-indigo-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-1",children:"So funktioniert Smart Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed",children:"WÃ¤hle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein maÃŸgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren RÃ¼ckfragen."})]})]})}),E=y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>p(null),children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[400px] w-full shadow-2xl transform transition-all",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center",children:e.jsx(G,{size:24,className:"text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Template lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden."})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-xl p-3 mb-5",children:e.jsx("p",{className:"text-sm text-slate-700",children:e.jsx("strong",{children:y.title})})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(Z,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(Z,{variant:"danger",onClick:B,children:"LÃ¶schen"})]})]})});return e.jsxs(e.Fragment,{children:[e.jsx(at,{featureId:"smartbriefing",showOnMount:!0}),e.jsx(ot,{title:"Smart Briefing",subtitle:"Dein KI-gestÃ¼tzter Vorbereitungs-Assistent",headerIcon:P,headerActions:e.jsx(it,{featureId:"smartbriefing",size:"sm"}),fetchScenarios:a,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:j,onSelectScenario:s,renderCardMeta:I,renderCategoryBadge:_,getIconForScenario:D,getCardCustomActions:S,getCardClassName:O,cardActionLabel:"Briefing erstellen",cardActionIcon:Te,categoryField:"category",emptyStateIcon:P,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:v,renderInfoBox:z,extraContent:E,isAuthenticated:i,requireAuth:d,setPendingAction:h,demoCode:g,loadingMessage:"Templates werden geladen..."},r)]})},bt=({variable:s,index:j,onChange:x,onDelete:c})=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:s.key||"",onChange:b=>x(j,"key",b.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-md border border-slate-200 text-sm font-mono bg-slate-50 mr-2 outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"}),e.jsx("button",{type:"button",onClick:()=>c(j),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center hover:bg-red-50 rounded-md transition-colors",children:e.jsx(G,{size:18})})]}),e.jsx("textarea",{value:s.value||"",onChange:b=>x(j,"value",b.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2.5 px-3 rounded-md border border-slate-200 text-sm resize-y min-h-[80px] box-border outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"})]}),gt=({template:s,onBack:j,onBriefingGenerated:x,isAuthenticated:c})=>{const[b,i]=n.useState({}),[d,h]=n.useState({}),[g,y]=n.useState(!1),[p,r]=n.useState(null),[m,a]=n.useState([]),[f,u]=n.useState(!1),k=mt(s?.icon);n.useEffect(()=>{if(s?.variables_schema){const S={};s.variables_schema.forEach(v=>{v.default&&(S[v.key]=v.default)}),i(S)}a([]),u(!1)},[s]);const l=()=>{a([...m,{key:"",value:""}])},B=(S,v,z)=>{const E=[...m];E[S][v]=z,a(E)},D=S=>{a(m.filter((v,z)=>z!==S))},I=(S,v)=>{i(z=>({...z,[S]:v})),d[S]&&h(z=>{const E={...z};return delete E[S],E})},_=()=>{const S={};return s?.variables_schema?.forEach(v=>{v.required&&!b[v.key]&&(S[v.key]="Dieses Feld ist erforderlich")}),S},O=async S=>{S.preventDefault();const v=_();if(Object.keys(v).length>0){h(v);return}y(!0),r(null);try{const z={};m.forEach(w=>{w.key&&w.value&&(z[w.key]=w.value)});const E={template_id:s.id,variables:b};Object.keys(z).length>0&&(E.custom_variables=z);const N=await V.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(E)});if(N.success&&N.data?.briefing)x(N.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(z){console.error("[SmartBriefing] Error generating briefing:",z),r(z.message||"Fehler beim Generieren des Briefings")}finally{y(!1)}};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 pt-8 max-w-[700px] mx-auto",children:[e.jsxs("button",{onClick:j,disabled:g,className:`flex items-center gap-2 py-2 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer mb-6 transition-opacity ${g?"opacity-50 cursor-not-allowed":"hover:text-slate-700"}`,children:[e.jsx(Re,{size:18}),e.jsx("span",{className:"leading-relaxed",children:"ZurÃ¼ck zur Ãœbersicht"})]}),e.jsx(J,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(k,{size:28,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[22px] font-bold text-slate-900 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsxs(J,{className:"p-6",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900 mb-5 pb-4 border-b border-slate-100",children:"Deine Angaben"}),e.jsxs("form",{onSubmit:O,children:[s.variables_schema?.map(S=>e.jsx(dt,{field:S,value:b[S.key],onChange:I,error:d[S.key]},S.key)),s.allow_custom_variables&&e.jsxs("div",{className:"mt-6 mb-5 pt-5 border-t border-slate-100",children:[e.jsxs("button",{type:"button",onClick:()=>u(!f),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${f?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[f?e.jsx(ke,{size:18}):e.jsx(ue,{size:18}),e.jsx(L,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),f&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Briefing-Generierung einflieÃŸen sollen."}),m.length>0&&e.jsx("div",{className:"mb-3",children:m.map((S,v)=>e.jsx(bt,{variable:S,index:v,onChange:B,onDelete:D},v))}),e.jsxs("button",{type:"button",onClick:l,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-500 text-[13px] cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(L,{size:14}),"Variable hinzufÃ¼gen"]})]})]}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-5 flex items-start gap-3",children:[e.jsx(H,{size:20,className:"text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:p})]}),e.jsx(Z,{type:"submit",disabled:g,size:"lg",fullWidth:!0,icon:e.jsx(pe,{size:20}),children:"Briefing generieren"})]})]})]}),e.jsx(ct,{isLoading:g,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein maÃŸgeschneidertes Briefing."})]}):null},ft={"file-text":P,briefcase:se,banknote:te,users:he,user:xe,"message-circle":ee,target:X,award:me,book:de,clipboard:ce,star:oe,lightbulb:Q,shield:le,compass:ie,rocket:Y},jt=({content:s})=>{if(!s)return null;const j=c=>{const b=c.split(`
`),i=[];let d=[],h=null;const g=()=>{d.length>0&&(i.push(e.jsx("ul",{className:"my-3 pl-6 list-none",children:d.map((y,p)=>e.jsxs("li",{className:"mb-2 text-[15px] leading-relaxed text-gray-700 relative pl-5",children:[e.jsx("span",{className:"absolute left-0 text-primary font-bold",children:h==="number"?`${p+1}.`:"â€¢"}),x(y)]},p))},`list-${i.length}`)),d=[],h=null)};return b.forEach((y,p)=>{const r=y.trim();if(!r){g();return}if(r.startsWith("### ")){g(),i.push(e.jsx("h3",{className:`text-lg font-bold text-slate-900 my-6 mb-3 pt-4 flex items-center gap-2 ${p>0?"border-t border-slate-100":""}`,children:x(r.substring(4))},`h3-${p}`));return}if(r.startsWith("## ")){g(),i.push(e.jsx("h2",{className:"text-xl font-bold text-slate-900 my-7 mb-3.5",children:x(r.substring(3))},`h2-${p}`));return}if(r.startsWith("# ")){g(),i.push(e.jsx("h1",{className:"text-2xl font-bold text-slate-900 my-8 mb-4",children:x(r.substring(2))},`h1-${p}`));return}if(r.startsWith("- ")||r.startsWith("* ")){h!=="bullet"&&(g(),h="bullet"),d.push(r.substring(2));return}const m=r.match(/^(\d+)\.\s/);if(m){h!=="number"&&(g(),h="number"),d.push(r.substring(m[0].length));return}g(),i.push(e.jsx("p",{className:"my-3 text-[15px] leading-relaxed text-gray-700",children:x(r)},`p-${p}`))}),g(),i},x=c=>{const b=[];let i=c,d=0;for(;i.length>0;){const h=i.match(/\*\*(.+?)\*\*/),g=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),y=i.match(/`([^`]+)`/),p=[{match:h,type:"bold"},{match:g,type:"italic"},{match:y,type:"code"}].filter(m=>m.match);if(p.length===0){b.push(i);break}const r=p.reduce((m,a)=>(m.match?.index??1/0)<(a.match?.index??1/0)?m:a);switch(r.match.index>0&&b.push(i.substring(0,r.match.index)),r.type){case"bold":b.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:r.match[1]},d++));break;case"italic":b.push(e.jsx("em",{className:"italic",children:r.match[1]||r.match[2]},d++));break;case"code":b.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-[13px] font-mono text-primary",children:r.match[1]},d++));break}i=i.substring(r.match.index+r.match[0].length)}return b};return e.jsx("div",{children:j(s)})},yt=({briefing:s,template:j,onBack:x,onCreateNew:c,onGenerateAnother:b})=>{const i=ht(),[d,h]=n.useState(!1),g=n.useRef(null),y=ft[j?.icon||s?.template_icon]||P,p=a=>a?new Date(a).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",r=async()=>{try{await navigator.clipboard.writeText(s.content_markdown),h(!0),setTimeout(()=>h(!1),2e3)}catch(a){console.error("[SmartBriefing] Failed to copy:",a)}},m=()=>{const a=`${j?.title||s?.template_title}
${"=".repeat(50)}

Erstellt am: ${p(s.created_at)}

${s.content_markdown}`,f=new Blob([a],{type:"text/plain;charset=utf-8"}),u=URL.createObjectURL(f),k=document.createElement("a");k.href=u,k.download=`briefing-${s.id}.txt`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(u)};return s?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`bg-brand-gradient sticky top-0 z-40 ${i?"px-4 py-5":"px-8 py-6"}`,children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[x&&e.jsxs("button",{onClick:x,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Re,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:`flex items-center gap-6 ${i?"flex-col items-start gap-4":""}`,children:[e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 ${i?"w-[70px] h-[70px]":"w-[90px] h-[90px]"}`,children:e.jsx(y,{size:i?32:40,color:lt.white})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsxs("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-primary flex items-center gap-1",children:[e.jsx(pe,{size:12}),"Fertig!"]})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${i?"text-xl":"text-2xl"}`,children:j?.title||s?.template_title}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(Ie,{size:14}),p(s.created_at)]})})]}),!i&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:r,className:`flex items-center gap-2 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium border border-white/30 transition-colors ${d?"bg-green-500/30":"bg-white/20 hover:bg-white/30"}`,children:[d?e.jsx(Be,{size:16}):e.jsx(W,{size:16}),d?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-white/30 transition-colors",children:[e.jsx(ze,{size:16}),"Speichern"]})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${i?"p-4":"px-8 py-6"}`,children:[i&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:r,className:`flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border text-[13px] font-medium cursor-pointer transition-colors ${d?"bg-green-50 border-green-200 text-green-700":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[d?e.jsx(Be,{size:16}):e.jsx(W,{size:16}),d?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:m,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-[13px] font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(ze,{size:16}),"Speichern"]})]}),e.jsx("div",{ref:g,className:"bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200",children:e.jsx("div",{className:i?"p-5":"p-8",children:e.jsx(jt,{content:s.content_markdown})})}),e.jsxs("div",{className:"flex gap-3 mt-6 flex-wrap",children:[e.jsxs("button",{onClick:b,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-2 border-primary bg-white text-primary text-[15px] font-semibold cursor-pointer transition-all hover:bg-primary/5",children:[e.jsx(rt,{size:18}),"Mit anderen Angaben neu generieren"]}),e.jsxs("button",{onClick:c,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-none bg-brand-gradient text-white text-[15px] font-semibold cursor-pointer transition-all shadow-primary/40 shadow-lg hover:shadow-xl",children:[e.jsx(L,{size:18}),"Neues Briefing erstellen"]})]})]})]}):null},Nt={"file-text":P,briefcase:se,banknote:te,users:he,user:xe,"message-circle":ee,target:X,award:me,book:de,clipboard:ce,star:oe,lightbulb:Q,shield:le,compass:ie,rocket:Y},wt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",vt=({briefing:s,onOpen:j,onDelete:x,isDeleting:c})=>{const[b,i]=n.useState(!1),[d,h]=n.useState(!1),g=Nt[s.template_icon]||P,y=p=>{p.stopPropagation(),d?(x(s.id),h(!1)):(h(!0),setTimeout(()=>h(!1),3e3))};return e.jsxs(J,{onClick:()=>j(s),onMouseEnter:()=>i(!0),onMouseLeave:()=>{i(!1),h(!1)},className:`p-5 cursor-pointer transition-all duration-300 relative ${b?"border-primary shadow-lg -translate-y-0.5":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-[10px] bg-primary/10 flex items-center justify-center",children:e.jsx(g,{size:22,className:"text-primary"})}),e.jsx("button",{onClick:y,disabled:c,className:`p-2 rounded-lg border-none cursor-pointer transition-all ${d?"bg-red-50 text-red-500":b?"bg-slate-100 text-slate-400":"bg-transparent text-slate-400"} ${b||d?"opacity-100":"opacity-0"} ${c?"cursor-not-allowed":""}`,children:c?e.jsx(be,{size:18,className:"animate-spin"}):e.jsx(G,{size:18})})]}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 leading-tight truncate",children:s.title||"Unbenanntes Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:s.template_title}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-xs",children:[e.jsx(Ie,{size:14}),wt(s.created_at)]}),e.jsxs("div",{className:"flex items-center gap-1 text-primary text-[13px] font-medium",children:["Ã–ffnen",e.jsx(Te,{size:16})]})]}),d&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-50 border border-red-200 rounded-lg py-2 px-3 text-xs text-red-600 font-medium z-10",onClick:p=>p.stopPropagation(),children:"Nochmal klicken zum LÃ¶schen"})]})},kt=({onOpenBriefing:s,onCreateNew:j,isAuthenticated:x})=>{const[c,b]=n.useState([]),[i,d]=n.useState(!0),[h,g]=n.useState(null),[y,p]=n.useState(null);n.useEffect(()=>{(async()=>{if(!x){d(!1);return}try{d(!0),g(null);const a=await V.request("/smartbriefing/briefings",{method:"GET"});if(a.success&&a.data?.briefings){const f=a.data.briefings.filter(u=>u.status==="completed");b(f)}else throw new Error("Unerwartete API-Antwort")}catch(a){console.error("[SmartBriefing] Error fetching briefings:",a),g(a.message||"Fehler beim Laden der Briefings")}finally{d(!1)}})()},[x]);const r=async m=>{try{if(p(m),(await V.request(`/smartbriefing/briefings/${m}`,{method:"DELETE"})).success)b(f=>f.filter(u=>u.id!==m));else throw new Error("Fehler beim LÃ¶schen")}catch(a){console.error("[SmartBriefing] Error deleting briefing:",a),g(a.message||"Fehler beim LÃ¶schen des Briefings")}finally{p(null)}};return x?e.jsxs("div",{className:"p-6 max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Meine Briefings"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[c.length," gespeicherte Briefings"]})]}),e.jsx(Z,{onClick:j,icon:e.jsx(L,{size:18}),children:"Neues Briefing"})]}),i&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(be,{size:40,className:"text-primary animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-500",children:"Briefings werden geladen..."})]}),h&&!i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 flex items-start gap-3",children:[e.jsx(H,{size:24,className:"text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base text-red-600 font-medium mb-1",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-sm text-red-700",children:h})]})]}),!i&&!h&&e.jsx(e.Fragment,{children:c.length===0?e.jsxs(J,{className:"py-12 px-6 text-center",children:[e.jsx(Ee,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Noch keine Briefings"}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Erstelle dein erstes Briefing, um loszulegen."}),e.jsx(Z,{onClick:j,icon:e.jsx(L,{size:18}),children:"Briefing erstellen"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:c.map(m=>e.jsx(vt,{briefing:m,onOpen:s,onDelete:r,isDeleting:y===m.id},m.id))})})]}):e.jsx("div",{className:"p-6 max-w-[800px] mx-auto",children:e.jsxs(J,{className:"py-12 px-6 text-center",children:[e.jsx(Ee,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},Fe=[{key:"file-text",icon:P,label:"Dokument"},{key:"briefcase",icon:se,label:"Koffer"},{key:"banknote",icon:te,label:"Geld"},{key:"users",icon:he,label:"Team"},{key:"user",icon:xe,label:"Person"},{key:"target",icon:X,label:"Ziel"},{key:"lightbulb",icon:Q,label:"Idee"},{key:"star",icon:oe,label:"Stern"},{key:"shield",icon:le,label:"Schutz"},{key:"compass",icon:ie,label:"Kompass"},{key:"rocket",icon:Y,label:"Rakete"},{key:"message-circle",icon:ee,label:"Nachricht"},{key:"award",icon:me,label:"Auszeichnung"},{key:"book",icon:de,label:"Buch"},{key:"clipboard",icon:ce,label:"Checkliste"}],$e=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],De=[{key:"empty",label:"--- Vorlage wÃ¤hlen ---",icon:P,aiRole:"",sections:[],aiBehavior:"",variables:[]},{key:"sales",label:"ðŸŽ¯ Sales / KundengesprÃ¤ch",icon:X,aiRole:"Du bist ein erfahrener Sales-Coach und Vertriebsexperte mit 15+ Jahren Erfahrung im B2B-Vertrieb.",sections:[{id:"hook",title:"The Hook ðŸª",instruction:"Erstelle einen packenden GesprÃ¤chseinstieg fÃ¼r ${customer_type} Kunden"},{id:"discovery",title:"Discovery Questions ðŸ”",instruction:"Formuliere 5-7 offene Fragen um Bedarf zu wecken und Pain Points zu identifizieren"},{id:"value",title:"Value Proposition ðŸ’Ž",instruction:"Beschreibe den Mehrwert basierend auf ${product_service}"},{id:"objections",title:"Einwandbehandlung ðŸ›¡ï¸",instruction:"Liste typische EinwÃ¤nde und passende Antworten"},{id:"closing",title:"Closing Path ðŸŽ¯",instruction:"Entwickle einen Weg zum Ziel: ${meeting_goal}"}],aiBehavior:"Schreibe praxisnah und actionable. Jeder Punkt soll direkt umsetzbar sein. Vermeide Theorie - fokussiere auf konkrete Formulierungen und Techniken.",variables:[{key:"customer_type",label:"Kundentyp",type:"text",placeholder:"z.B. Enterprise, KMU, Startup"},{key:"product_service",label:"Produkt/Service",type:"text",placeholder:"Was verkaufst du?"},{key:"meeting_goal",label:"Ziel des GesprÃ¤chs",type:"text",placeholder:"z.B. Demo-Termin, Angebot"}]},{key:"career",label:"ðŸ’¼ Karriere / VorstellungsgesprÃ¤ch",icon:se,aiRole:"Du bist ein erfahrener Karriere-Coach und HR-Experte mit umfassender Erfahrung in Bewerbungsprozessen.",sections:[{id:"company",title:"Unternehmens-Insights ðŸ¢",instruction:"Recherchiere wichtige Fakten Ã¼ber ${unternehmen} die im GesprÃ¤ch relevant sind"},{id:"position",title:"Positions-Analyse ðŸ“‹",instruction:"Analysiere die Anforderungen fÃ¼r ${position} und wie der Kandidat diese erfÃ¼llt"},{id:"questions",title:"Typische Fragen â“",instruction:"Liste die 10 wahrscheinlichsten Interviewfragen mit Antwortstrategien"},{id:"stories",title:"STAR-Stories â­",instruction:"Entwickle 3-5 Erfolgsgeschichten nach der STAR-Methode"},{id:"questions_to_ask",title:"Eigene Fragen ðŸ™‹",instruction:"Formuliere 5-7 kluge RÃ¼ckfragen an den Interviewer"}],aiBehavior:"Sei konkret und praxisorientiert. Gib FormulierungsvorschlÃ¤ge die direkt verwendet werden kÃ¶nnen. BerÃ¼cksichtige deutsche GeschÃ¤ftskultur.",variables:[{key:"unternehmen",label:"Unternehmen",type:"text",placeholder:"Name des Unternehmens"},{key:"position",label:"Position",type:"text",placeholder:"Stelle, auf die du dich bewirbst"}]},{key:"negotiation",label:"ðŸ’° Gehaltsverhandlung",icon:te,aiRole:"Du bist ein Experte fÃ¼r Gehaltsverhandlungen und Karriereentwicklung.",sections:[{id:"market",title:"Marktanalyse ðŸ“Š",instruction:"Analysiere Gehaltsspannen fÃ¼r ${position} in ${branche} und ${region}"},{id:"arguments",title:"Argumente ðŸ’ª",instruction:"Entwickle 5-7 Ã¼berzeugende Argumente fÃ¼r eine GehaltserhÃ¶hung basierend auf ${erfolge}"},{id:"counter",title:"Konterstrategien ðŸ›¡ï¸",instruction:"Bereite Antworten auf typische Gegenargumente des Arbeitgebers vor"},{id:"tactics",title:"Verhandlungstaktiken ðŸŽ¯",instruction:"Beschreibe bewÃ¤hrte Taktiken fÃ¼r die Gehaltsverhandlung"},{id:"alternatives",title:"Alternativen ðŸ”„",instruction:"Liste nicht-monetÃ¤re Benefits die verhandelbar sind"}],aiBehavior:"Fokussiere auf konkrete Zahlen und Formulierungen. Sei selbstbewusst aber nicht arrogant im Ton.",variables:[{key:"position",label:"Position",type:"text",placeholder:"Deine aktuelle/angestrebte Position"},{key:"branche",label:"Branche",type:"text",placeholder:"z.B. IT, Finanzen, Marketing"},{key:"region",label:"Region",type:"text",placeholder:"z.B. MÃ¼nchen, Berlin, Remote"},{key:"erfolge",label:"Deine Erfolge",type:"textarea",placeholder:"Beschreibe deine wichtigsten Leistungen"}]},{key:"presentation",label:"ðŸŽ¤ PrÃ¤sentation / Pitch",icon:Y,aiRole:"Du bist ein PrÃ¤sentations-Coach und Storytelling-Experte.",sections:[{id:"hook",title:"ErÃ¶ffnung ðŸŽ¬",instruction:"Erstelle einen aufmerksamkeitsstarken Einstieg fÃ¼r ${thema}"},{id:"problem",title:"Problem/Herausforderung âš¡",instruction:"Beschreibe das Problem das ${zielgruppe} hat"},{id:"solution",title:"LÃ¶sung/Angebot ðŸ’¡",instruction:"PrÃ¤sentiere die LÃ¶sung klar und Ã¼berzeugend"},{id:"proof",title:"Beweise/Beispiele ðŸ“ˆ",instruction:"Liste Erfolgsbeispiele, Zahlen und Social Proof"},{id:"cta",title:"Call-to-Action ðŸŽ¯",instruction:"Formuliere einen klaren nÃ¤chsten Schritt"}],aiBehavior:"Schreibe in aktivem, energetischem Stil. Jeder Abschnitt soll eine klare Botschaft haben. Nutze Storytelling-Elemente.",variables:[{key:"thema",label:"Thema der PrÃ¤sentation",type:"text",placeholder:"WorÃ¼ber prÃ¤sentierst du?"},{key:"zielgruppe",label:"Zielgruppe",type:"text",placeholder:"Wer ist dein Publikum?"}]},{key:"feedback",label:"ðŸ’¬ Feedback-GesprÃ¤ch",icon:ee,aiRole:"Du bist ein erfahrener Leadership-Coach und Experte fÃ¼r MitarbeiterfÃ¼hrung.",sections:[{id:"context",title:"GesprÃ¤chsrahmen ðŸ“‹",instruction:"Bereite den Rahmen fÃ¼r das Feedback-GesprÃ¤ch mit ${mitarbeiter_name} vor"},{id:"positive",title:"StÃ¤rken & Erfolge â­",instruction:"Liste konkrete positive Beobachtungen und Erfolge"},{id:"development",title:"Entwicklungsfelder ðŸŒ±",instruction:"Beschreibe Verbesserungspotenziale konstruktiv"},{id:"goals",title:"Zielvereinbarung ðŸŽ¯",instruction:"Formuliere SMART-Ziele fÃ¼r die nÃ¤chste Periode"},{id:"support",title:"UnterstÃ¼tzungsangebote ðŸ¤",instruction:"Liste mÃ¶gliche UnterstÃ¼tzungsmaÃŸnahmen"}],aiBehavior:"Schreibe wertschÃ¤tzend und konstruktiv. Fokussiere auf Verhalten, nicht auf PersÃ¶nlichkeit. Nutze die SBI-Methode (Situation-Behavior-Impact).",variables:[{key:"mitarbeiter_name",label:"Name des Mitarbeiters",type:"text",placeholder:'Vorname oder "der Mitarbeiter"'}]}],F=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,St=()=>({id:F(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),Ct=()=>({id:F(),value:"",label:""}),Bt=()=>({id:F(),title:"",instruction:""}),zt=({variable:s,index:j,total:x,onChange:c,onDelete:b,onMoveUp:i,onMoveDown:d})=>{const[h,g]=n.useState(!0),[y,p]=n.useState(s.label);n.useEffect(()=>{p(s.label)},[s.label]);const r=(l,B)=>{c({...s,[l]:B})},m=()=>{const l=[...s.options||[],Ct()];c({...s,options:l})},a=(l,B,D)=>{const I=s.options.map(_=>_.id===l?{..._,[B]:D}:_);c({...s,options:I})},f=l=>{const B=s.options.filter(D=>D.id!==l);c({...s,options:B})},u=l=>l.toLowerCase().replace(/[Ã¤Ã¶Ã¼ÃŸ]/g,B=>({Ã¤:"ae",Ã¶:"oe",Ã¼:"ue",ÃŸ:"ss"})[B]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),k=()=>{if(y!==s.label){const l={label:y};(!s.key||s.key===u(s.label))&&(l.key=u(y)),c({...s,...l})}};return e.jsxs("div",{className:"bg-slate-50 rounded-xl border border-slate-200 mb-3 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 bg-white cursor-pointer ${h?"border-b border-slate-200":""}`,onClick:()=>g(!h),children:[e.jsx(Le,{size:16,className:"text-slate-400 cursor-grab"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:s.label||`Variable ${j+1}`}),s.key&&e.jsxs("span",{className:"ml-2 text-slate-500 text-xs",children:["$","{","$",s.key,"}"]})]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-[11px] font-medium bg-primary/10 text-primary",children:$e.find(l=>l.value===s.type)?.label||s.type}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),i()},disabled:j===0,className:`p-1 border-none bg-transparent ${j===0?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(ke,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),d()},disabled:j===x-1,className:`p-1 border-none bg-transparent ${j===x-1?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(ue,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),b()},className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(G,{size:16})})]}),e.jsx(Se,{children:h&&e.jsx(q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:e.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldbezeichnung *"}),e.jsx("input",{type:"text",value:y,onChange:l=>p(l.target.value),onBlur:k,placeholder:"z.B. Unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Variablenname *"}),e.jsx("input",{type:"text",value:s.key,onChange:l=>r("key",l.target.value),placeholder:"z.B. unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm font-mono"})]})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldtyp"}),e.jsx("select",{value:s.type,onChange:l=>r("type",l.target.value),className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm bg-white",children:$e.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 py-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.required,onChange:l=>r("required",l.target.checked),className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Pflichtfeld"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Platzhalter-Text (optional)"}),e.jsx("input",{type:"text",value:s.placeholder,onChange:l=>r("placeholder",l.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),s.type==="select"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-2",children:"Auswahloptionen"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[(s.options||[]).map(l=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:l.value,onChange:B=>a(l.id,"value",B.target.value),placeholder:"Wert",className:"flex-1 px-2.5 py-2 rounded-md border border-slate-200 text-[13px] font-mono"}),e.jsx("input",{type:"text",value:l.label,onChange:B=>a(l.id,"label",B.target.value),placeholder:"Anzeigename",className:"flex-[2] px-2.5 py-2 rounded-md border border-slate-200 text-[13px]"}),e.jsx("button",{onClick:()=>f(l.id),className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(G,{size:14})})]},l.id)),e.jsxs("button",{onClick:m,className:"flex items-center gap-1.5 px-3 py-2 border border-dashed border-slate-300 rounded-md bg-transparent text-slate-500 text-[13px] cursor-pointer mt-1 hover:bg-slate-50",children:[e.jsx(L,{size:14}),"Option hinzufÃ¼gen"]})]})]})]})})})]})},Et=({section:s,index:j,total:x,variables:c,onChange:b,onDelete:i,onMoveUp:d,onMoveDown:h,onInsertVariable:g})=>{const y=n.useRef(null),p=(m,a)=>{b({...s,[m]:a})},r=m=>{const a=y.current;if(a){const f=a.selectionStart,u=a.selectionEnd,k=s.instruction,l=`\${${m}}`,B=k.substring(0,f)+l+k.substring(u);p("instruction",B),setTimeout(()=>{a.focus(),a.setSelectionRange(f+l.length,f+l.length)},0)}else p("instruction",s.instruction+`\${${m}}`)};return e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 mb-3 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-indigo-50 to-violet-50 border-b border-slate-200",children:[e.jsx(Le,{size:16,className:"text-slate-400 cursor-grab"}),e.jsx("span",{className:"w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 text-xs font-bold flex items-center justify-center",children:j+1}),e.jsx("input",{type:"text",value:s.title,onChange:m=>p("title",m.target.value),placeholder:"Abschnittstitel (z.B. 'Discovery Questions ðŸ”')",className:"flex-1 px-2 py-1 rounded border-0 bg-transparent text-sm font-semibold text-slate-800 placeholder:text-slate-400"}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:d,disabled:j===0,className:`p-1 border-none bg-transparent ${j===0?"opacity-30":"cursor-pointer"}`,children:e.jsx(ke,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:h,disabled:j===x-1,className:`p-1 border-none bg-transparent ${j===x-1?"opacity-30":"cursor-pointer"}`,children:e.jsx(ue,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:i,className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500 hover:bg-red-50 rounded",children:e.jsx(G,{size:16})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600",children:"Anweisung fÃ¼r diesen Abschnitt"}),c.length>0&&e.jsx(ve,{variables:c,onSelect:r})]}),e.jsx("textarea",{ref:y,value:s.instruction,onChange:m=>p("instruction",m.target.value),placeholder:"z.B. 'Erstelle 5-7 offene Fragen um Bedarf zu wecken basierend auf ${customer_type}'",rows:2,className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm resize-y"})]})]})},ve=({variables:s,onSelect:j})=>{const[x,c]=n.useState(!1),b=n.useRef(null);return n.useEffect(()=>{const i=d=>{b.current&&!b.current.contains(d.target)&&c(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),s.length===0?null:e.jsxs("div",{className:"relative",ref:b,children:[e.jsxs("button",{onClick:()=>c(!x),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-indigo-50 text-indigo-600 text-xs font-medium border-none cursor-pointer hover:bg-indigo-100 transition-colors",children:[e.jsx(L,{size:14}),"Variable einfÃ¼gen",e.jsx(ue,{size:14,className:`transition-transform ${x?"rotate-180":""}`})]}),e.jsx(Se,{children:x&&e.jsx(q.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-slate-200 z-50 min-w-[180px] py-1",children:s.map(i=>e.jsxs("button",{onClick:()=>{j(i.key),c(!1)},className:"w-full px-3 py-2.5 text-left text-sm hover:bg-indigo-50 border-none bg-transparent cursor-pointer flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-slate-800 font-medium",children:i.label}),e.jsxs("code",{className:"text-xs text-indigo-700 bg-indigo-100 px-2 py-1 rounded font-mono font-semibold whitespace-nowrap",children:["$","{","$",i.key,"}"]})]},i.id))})})]})},At=({selectedIcon:s,onSelect:j})=>e.jsx("div",{className:"flex flex-wrap gap-3",children:Fe.map(({key:x,icon:c,label:b})=>{const i=s===x;return e.jsx("button",{onClick:()=>j(x),title:b,className:`w-[60px] h-[60px] rounded-xl border-2 flex items-center justify-center cursor-pointer transition-all ${i?"border-primary bg-primary/10":"border-slate-200 bg-white hover:border-primary/40"}`,children:e.jsx(c,{size:28,className:i?"text-primary":"text-slate-500"})},x)})}),$t=({isOpen:s,onClose:j,templateData:x,variables:c})=>{const[b,i]=n.useState(!1),[d,h]=n.useState(null),[g,y]=n.useState(null),[p,r]=n.useState({});n.useEffect(()=>{const a={};c.forEach(f=>{a[f.key]=f.placeholder||`[${f.label}]`}),r(a),h(null)},[c]);const m=async()=>{i(!0),y(null);try{if(!V.getGeminiApiKey())throw new Error("Kein Gemini API-Key konfiguriert");let f=x.aiRole+`

`;x.sections.length>0&&(f+=`Erstelle ein strukturiertes Briefing mit folgenden Abschnitten:

`,x.sections.forEach((u,k)=>{f+=`### ${k+1}. ${u.title}
${u.instruction}

`})),x.aiBehavior&&(f+=`

WICHTIG: ${x.aiBehavior}`),Object.entries(p).forEach(([u,k])=>{f=f.replace(new RegExp(`\\$\\{${u}\\}`,"g"),k)}),h({prompt:f,sections:x.sections.map(u=>({title:u.title,instruction:u.instruction.replace(/\$\{(\w+)\}/g,(k,l)=>p[l]||`[${l}]`)}))})}catch(a){y(a.message)}finally{i(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4",children:e.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl w-full max-w-[800px] max-h-[85vh] flex flex-col shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex items-center justify-between bg-gradient-to-r from-indigo-50 to-violet-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{size:20,className:"text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Template Vorschau"})]}),e.jsx("button",{onClick:j,className:"p-2 border-none bg-white/80 rounded-lg cursor-pointer hover:bg-white transition-colors",children:e.jsx(Pe,{size:18,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[c.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Testwerte fÃ¼r Variablen:"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:c.map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:a.label}),e.jsx("input",{type:"text",value:p[a.key]||"",onChange:f=>r(u=>({...u,[a.key]:f.target.value})),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm"})]},a.id))})]}),e.jsx("button",{onClick:m,disabled:b,className:"w-full mb-6 flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-violet-500 text-white font-semibold border-none cursor-pointer disabled:opacity-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18,className:"animate-spin"}),"Generiere Vorschau..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18}),"Vorschau generieren"]})}),g&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 mb-4 flex items-center gap-2",children:[e.jsx(H,{size:18,className:"text-red-500"}),e.jsx("span",{className:"text-red-700 text-sm",children:g})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-500 uppercase mb-2",children:"KI-Rolle"}),e.jsx("p",{className:"text-sm text-slate-700",children:x.aiRole})]}),d.sections.map((a,f)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:a.title}),e.jsx("p",{className:"text-sm text-slate-600",children:a.instruction})]},f)),x.aiBehavior&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-amber-600 uppercase mb-2",children:"Verhalten"}),e.jsx("p",{className:"text-sm text-amber-800",children:x.aiBehavior})]}),e.jsxs("div",{className:"bg-slate-900 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-400 uppercase",children:"VollstÃ¤ndiger Prompt"}),e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(d.prompt),className:"flex items-center gap-1.5 px-2 py-1 rounded bg-slate-800 text-slate-300 text-xs border-none cursor-pointer hover:bg-slate-700",children:[e.jsx(W,{size:12}),"Kopieren"]})]}),e.jsx("pre",{className:"text-sm text-slate-300 whitespace-pre-wrap font-mono leading-relaxed max-h-[300px] overflow-auto",children:d.prompt})]})]})]})]})}):null},Dt=({isOpen:s,onClose:j,onSave:x,editTemplate:c=null,demoCode:b})=>{const[i,d]=n.useState(""),[h,g]=n.useState(""),[y,p]=n.useState("file-text"),[r,m]=n.useState([]),[a,f]=n.useState(""),[u,k]=n.useState([]),[l,B]=n.useState(""),[D,I]=n.useState("empty"),[_,O]=n.useState(!1),[S,v]=n.useState(null),[z,E]=n.useState("basics"),[N,w]=n.useState(!1),[T,U]=n.useState(null),re=n.useRef(null),ne=n.useRef(null);n.useEffect(()=>{if(c){if(d(c.title||""),g(c.description||""),p(c.icon||"file-text"),m((c.variables_schema||[]).map(t=>({...t,id:t.id||F(),options:(t.options||[]).map(o=>({...o,id:o.id||F()}))}))),c.ai_role?f(c.ai_role):c.system_prompt&&f(c.system_prompt),c.ai_task)try{const t=JSON.parse(c.ai_task);Array.isArray(t)&&k(t.map(o=>({...o,id:o.id||F()})))}catch{k([{id:F(),title:"Hauptabschnitt",instruction:c.ai_task}])}B(c.ai_behavior||""),I("empty")}else d(""),g(""),p("file-text"),m([]),f(""),k([]),B(""),I("empty");E("basics"),v(null)},[c,s]);const ge=()=>a.trim()||u.length>0||l.trim()||r.length>0,fe=t=>{const o=De.find(C=>C.key===t);if(!o||t==="empty"){I("empty");return}ge()?U(o):ae(o)},ae=t=>{I(t.key),f(t.aiRole),k(t.sections.map(o=>({...o,id:F()}))),B(t.aiBehavior),p(Fe.find(o=>o.icon===t.icon)?.key||"file-text"),t.variables&&t.variables.length>0&&m(t.variables.map(o=>({...o,id:F(),required:!0,options:[]}))),U(null)},A=()=>{U(null)},K=()=>{m([...r,St()])},Ve=(t,o)=>{const C=[...r];C[t]=o,m(C)},Oe=t=>{m(r.filter((o,C)=>C!==t))},Me=t=>{if(t===0)return;const o=[...r];[o[t-1],o[t]]=[o[t],o[t-1]],m(o)},Ke=t=>{if(t===r.length-1)return;const o=[...r];[o[t],o[t+1]]=[o[t+1],o[t]],m(o)},Ge=()=>{k([...u,Bt()])},Ue=(t,o)=>{const C=[...u];C[t]=o,k(C)},We=t=>{k(u.filter((o,C)=>C!==t))},He=t=>{if(t===0)return;const o=[...u];[o[t-1],o[t]]=[o[t],o[t-1]],k(o)},qe=t=>{if(t===u.length-1)return;const o=[...u];[o[t],o[t+1]]=[o[t+1],o[t]],k(o)},Ce=(t,o,C,R)=>{const M=t.current;if(M){const je=M.selectionStart,Ye=M.selectionEnd,ye=`\${${R}}`,Xe=C.substring(0,je)+ye+C.substring(Ye);o(Xe),setTimeout(()=>{M.focus(),M.setSelectionRange(je+ye.length,je+ye.length)},0)}else o(C+`\${${R}}`)},Ze=()=>{let t=a+`

`;return u.length>0&&(t+=`Erstelle ein strukturiertes Briefing mit folgenden Abschnitten:

`,u.forEach((o,C)=>{t+=`### ${C+1}. ${o.title}
${o.instruction}

`})),l&&(t+=`
WICHTIG: ${l}`),t},Je=()=>{if(!i.trim())return v("Bitte gib einen Titel ein."),E("basics"),!1;if(!a.trim())return v("Bitte definiere eine KI-Rolle."),E("prompt"),!1;if(u.length===0)return v("Bitte fÃ¼ge mindestens einen Abschnitt hinzu."),E("prompt"),!1;for(const t of u)if(!t.title.trim())return v("Alle Abschnitte benÃ¶tigen einen Titel."),E("prompt"),!1;for(const t of r){if(!t.key.trim()||!t.label.trim())return v("Alle Variablen benÃ¶tigen einen Namen und eine Bezeichnung."),E("variables"),!1;if(t.type==="select"&&(!t.options||t.options.length===0))return v(`Variable "${t.label}" benÃ¶tigt mindestens eine Auswahloption.`),E("variables"),!1}return!0},Qe=async()=>{if(v(null),!!Je()){O(!0);try{const t=r.map(R=>({key:R.key,label:R.label,type:R.type,required:R.required,placeholder:R.placeholder,...R.type==="select"?{options:R.options.map(M=>({value:M.value,label:M.label}))}:{}})),o={title:i.trim(),description:h.trim(),icon:y,ai_role:a,ai_task:JSON.stringify(u.map(R=>({title:R.title,instruction:R.instruction}))),ai_behavior:l,system_prompt:Ze(),variables_schema:t,...b?{demo_code:b}:{}};let C;if(c?C=await V.request(`/smartbriefing/templates/${c.id}`,{method:"PUT",body:JSON.stringify(o)}):C=await V.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(o)}),C.success)x?.(C.data.template),j();else throw new Error(C.message||"Fehler beim Speichern")}catch(t){console.error("[CreateTemplateDialog] Save error:",t),v(t.message||"Fehler beim Speichern des Templates")}finally{O(!1)}}};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-[750px] max-h-[90vh] flex flex-col shadow-2xl overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-slate-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 text-xl font-bold text-slate-900",children:c?"Template bearbeiten":"Neues Template erstellen"}),e.jsx("p",{className:"mt-1 mb-0 text-sm text-slate-500",children:"Erstelle ein persÃ¶nliches Briefing-Template"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-1.5 px-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(we,{size:16}),"Vorschau"]}),e.jsx("button",{onClick:j,className:"p-2 border-none bg-slate-100 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors",children:e.jsx(Pe,{size:20,className:"text-slate-500"})})]})]}),e.jsx("div",{className:"flex border-b border-slate-200 px-6",children:[{key:"basics",label:"1. Grundlagen"},{key:"variables",label:"2. Eingabefelder"},{key:"prompt",label:"3. KI-Anweisung"}].map(t=>e.jsx("button",{onClick:()=>E(t.key),className:`px-5 py-3 border-none bg-transparent text-sm font-semibold cursor-pointer -mb-px transition-all ${z===t.key?"text-primary border-b-[3px] border-primary":"text-slate-500 border-b-[3px] border-transparent hover:text-slate-700"}`,children:t.label},t.key))}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 mb-4 flex items-center gap-2",children:[e.jsx(H,{size:18,className:"text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:S})]}),z==="basics"&&e.jsxs("div",{className:"flex flex-col gap-5",children:[!c&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-violet-50 rounded-xl p-4 border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(pe,{size:18,className:"text-indigo-600"}),e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Schnellstart mit Vorlage"})]}),e.jsx("select",{value:D,onChange:t=>fe(t.target.value),className:"w-full px-3.5 py-3 rounded-xl border border-indigo-200 text-sm bg-white cursor-pointer",children:De.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Eine Vorlage fÃ¼llt Eingabefelder und KI-Anweisungen automatisch aus."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Titel *"}),e.jsx("input",{type:"text",value:i,onChange:t=>d(t.target.value),placeholder:"z.B. Sales Discovery Call Prep",className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-[15px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Beschreibung"}),e.jsx("textarea",{value:h,onChange:t=>g(t.target.value),placeholder:"Kurze Beschreibung, wofÃ¼r dieses Template verwendet wird...",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Symbol"}),e.jsx(At,{selectedIcon:y,onSelect:p})]})]}),z==="variables"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ae,{size:16,className:"text-slate-500"}),e.jsxs("span",{className:"text-[13px] text-slate-500",children:["Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausfÃ¼llen soll. Diese kÃ¶nnen dann im Prompt als $","{variablenname}"," verwendet werden."]})]})}),r.map((t,o)=>e.jsx(zt,{variable:t,index:o,total:r.length,onChange:C=>Ve(o,C),onDelete:()=>Oe(o),onMoveUp:()=>Me(o),onMoveDown:()=>Ke(o)},t.id)),e.jsxs("button",{onClick:K,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3.5 rounded-xl border-2 border-dashed border-slate-300 bg-white text-slate-500 text-sm font-medium cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(L,{size:18}),"Eingabefeld hinzufÃ¼gen"]}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Noch keine Eingabefelder definiert."})]}),z==="prompt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"KI-Rolle *"}),r.length>0&&e.jsx(ve,{variables:r,onSelect:t=>Ce(re,f,a,t)})]}),e.jsx("textarea",{ref:re,value:a,onChange:t=>f(t.target.value),placeholder:"z.B. 'Du bist ein erfahrener Sales-Coach mit 15+ Jahren B2B-Vertriebserfahrung...'",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Briefing-Abschnitte *"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[u.length," Abschnitt",u.length!==1?"e":""]})]}),u.map((t,o)=>e.jsx(Et,{section:t,index:o,total:u.length,variables:r,onChange:C=>Ue(o,C),onDelete:()=>We(o),onMoveUp:()=>He(o),onMoveDown:()=>qe(o)},t.id)),e.jsxs("button",{onClick:Ge,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3 rounded-xl border-2 border-dashed border-indigo-300 bg-indigo-50/50 text-indigo-600 text-sm font-medium cursor-pointer transition-all hover:bg-indigo-100",children:[e.jsx(L,{size:18}),"Abschnitt hinzufÃ¼gen"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Verhalten & Stil (optional)"}),r.length>0&&e.jsx(ve,{variables:r,onSelect:t=>Ce(ne,B,l,t)})]}),e.jsx("textarea",{ref:ne,value:l,onChange:t=>B(t.target.value),placeholder:"z.B. 'Schreibe praxisnah und actionable. Vermeide Theorie - fokussiere auf konkrete Formulierungen.'",rows:2,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),r.length>0&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ae,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"VerfÃ¼gbare Variablen (klicken zum Kopieren)"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(t=>e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`\${${t.key}}`)},className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-white rounded-lg border border-slate-200 text-xs cursor-pointer hover:border-indigo-300 hover:bg-indigo-50 transition-colors",children:[e.jsx("span",{className:"text-slate-600",children:t.label}),e.jsxs("code",{className:"font-mono text-indigo-600",children:["$","{","$",t.key,"}"]}),e.jsx(W,{size:12,className:"text-slate-400"})]},t.id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 flex justify-between items-center gap-3",children:[e.jsx("button",{onClick:j,className:"px-6 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Abbrechen"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(we,{size:16}),"Vorschau"]}),e.jsx("button",{onClick:Qe,disabled:_,className:`flex items-center gap-2 px-6 py-3 rounded-xl border-none bg-brand-gradient text-white text-sm font-semibold transition-all ${_?"cursor-not-allowed opacity-70":"cursor-pointer"}`,children:_?e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18,className:"animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:18}),c?"Speichern":"Template erstellen"]})})]})]})]})}),e.jsx($t,{isOpen:N,onClose:()=>w(!1),templateData:{aiRole:a,sections:u,aiBehavior:l},variables:r}),e.jsx(Se,{children:T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[70] p-4",children:e.jsxs(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-[420px] shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-amber-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{size:24,className:"text-amber-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Daten Ã¼berschreiben?"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-slate-600 text-sm mb-4",children:["Du hast bereits Eingabefelder oder KI-Anweisungen definiert. Wenn du die Vorlage ",e.jsxs("strong",{children:['"',T.label,'"']})," anwendest, werden diese Daten Ã¼berschrieben."]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 font-medium mb-1",children:"Was wird Ã¼berschrieben:"}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[r.length>0&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),r.length," Eingabefeld",r.length!==1?"er":""]}),a&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),"KI-Rolle"]}),u.length>0&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),u.length," Briefing-Abschnitt",u.length!==1?"e":""]}),l&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),"Verhalten & Stil"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:A,className:"flex-1 px-4 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 font-medium text-sm cursor-pointer hover:bg-slate-50 transition-colors",children:"Abbrechen"}),e.jsx("button",{onClick:()=>ae(T),className:"flex-1 px-4 py-2.5 rounded-xl border-none bg-amber-500 text-white font-medium text-sm cursor-pointer hover:bg-amber-600 transition-colors",children:"Ãœberschreiben"})]})]})]})})})]}):null},$={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},Wt=({isAuthenticated:s,requireAuth:j,setPendingAction:x,onNavigateToSimulator:c,onNavigateToHistory:b,demoCode:i})=>{const[d,h]=n.useState($.DASHBOARD),[g,y]=n.useState(null),[p,r]=n.useState(null),[m,a]=n.useState(null),[f,u]=n.useState(null),[k,l]=n.useState(!1),[B,D]=n.useState(null),[I,_]=n.useState(0);n.useEffect(()=>{f&&s&&(y(f),h($.FORM),u(null))},[f,s]),n.useEffect(()=>{window.scrollTo(0,0)},[d]);const O=n.useCallback(A=>{y(A),h($.FORM)},[]),S=n.useCallback(()=>{y(null),r(null),a(null),h($.DASHBOARD)},[]),v=n.useCallback(A=>{r(A),a(A),h($.WORKBOOK)},[]),z=n.useCallback(()=>{r(null),a(null),y(null),h($.DASHBOARD)},[]),E=n.useCallback(()=>{r(null),a(null),h($.FORM)},[]);n.useCallback(()=>{h($.LIST)},[]);const N=n.useCallback(A=>{a(A),h($.WORKBOOK)},[]);n.useCallback(()=>{a(null),h($.LIST)},[]);const w=n.useCallback(A=>{c&&c(A)},[c]),T=n.useCallback(async A=>{try{if((await V.request(`/smartbriefing/briefings/${A.id}`,{method:"DELETE"})).success)a(null),h($.DASHBOARD);else throw new Error("Fehler beim LÃ¶schen")}catch(K){throw console.error("[SmartBriefing] Error deleting briefing:",K),K}},[]),U=n.useCallback(()=>{D(null),l(!0)},[]),re=n.useCallback(A=>{D(A),l(!0)},[]),ne=n.useCallback(A=>{D(A),l(!0)},[]),ge=n.useCallback(()=>{l(!1),D(null)},[]),fe=n.useCallback(A=>{_(K=>K+1)},[]),ae=()=>{switch(d){case $.FORM:return e.jsx(gt,{template:g,onBack:S,onBriefingGenerated:v,isAuthenticated:s});case $.RESULT:return e.jsx(yt,{briefing:p,template:g,onBack:S,onCreateNew:z,onGenerateAnother:E});case $.LIST:return e.jsx(kt,{onOpenBriefing:N,onCreateNew:z,isAuthenticated:s});case $.WORKBOOK:return e.jsx(xt,{briefing:m,onBack:S,onDelete:T,onStartSimulation:c?w:null});case $.DASHBOARD:default:return e.jsx(pt,{onSelectTemplate:O,onShowList:b,onCreateTemplate:U,onEditTemplate:re,onCopyTemplate:ne,isAuthenticated:s,requireAuth:j,setPendingAction:x,demoCode:i},I)}};return e.jsxs("div",{className:"min-h-full",children:[ae(),e.jsx(Dt,{isOpen:k,onClose:ge,onSave:fe,editTemplate:B,demoCode:i})]})};export{kt as BriefingList,yt as BriefingResult,xt as BriefingWorkbook,Wt as SmartBriefingApp,pt as SmartBriefingDashboard,gt as SmartBriefingForm};
