import{j as e,L as Ee,I as ve,a1 as me,T as xt,z as ie,X as Ce,V as q,i as ut,g as Ne,a as Je,aq as ht,l as Ye,e as ye,ap as pt,B as ft,w as ce,v as Te,y as se,E as Ae,M as et,at as De,f as tt,t as Re,C as st,au as Be,q as Le,h as Ie,b as Ke,m as T,av as gt,A as at,ag as bt,a0 as nt,a8 as We,a9 as jt}from"./ui-vendor-Mj2_BHwd.js";import{a as s}from"./react-vendor-uDOJF2jQ.js";import{C as w,k as vt,F as Nt,g as ze,a as de,u as Me,l as yt,m as rt}from"./FeatureInfoButton-CmzxY1Ui.js";import{S as wt}from"./ScenarioDashboard-CkrE9pLw.js";import{B as je}from"./button-aST1fZsy.js";import{C as H,B as oe}from"./select-native-BCoWFCMQ.js";import"./dialog-DNcIzlLr.js";import{M as St,a as kt,A as Ue}from"./MicrophoneTestDialog-HXRqarTW.js";import{I as ke}from"./input-8NGOBwP_.js";import{T as Ct}from"./textarea-Cvie9LXd.js";import{u as At}from"./useMobile-YxjH166V.js";import{D as It}from"./DeviceSettingsDialog-CEGK6wHO.js";import{P as Et}from"./progress-bar-8cu-jki7.js";import{u as Tt}from"./Confetti-Bk9-L6q2.js";import{F as Dt}from"./fullscreen-loader-Bo9ovZS3.js";const qe={error:{bg:w.red[50],border:w.red[200],text:w.red[600],icon:ie},warning:{bg:w.amber[50],border:w.amber[200],text:w.amber[600],icon:xt},success:{bg:w.green[50],border:w.green[200],text:w.green[600],icon:me},info:{bg:w.blue[50],border:w.blue[200],text:w.blue[500],icon:ve},loading:{bg:w.blue[50],border:w.blue[200],text:w.blue[500],icon:Ee}},Rt=({variant:t="info",message:a,children:n,isToast:i=!1,onDismiss:d,className:m="",style:u={}})=>{const r=qe[t]||qe.info,l=r.icon,v=t==="loading";return e.jsxs("div",{className:`flex items-center gap-3 py-3 px-4 rounded-xl text-sm font-medium ${i?"fixed bottom-6 left-1/2 -translate-x-1/2 shadow-lg z-[1000] max-w-[90%]":""} ${m}`,style:{backgroundColor:r.bg,border:`1px solid ${r.border}`,color:r.text,...u},children:[e.jsx(l,{size:20,className:`flex-shrink-0 ${v?"animate-spin":""}`}),e.jsx("span",{className:"flex-1",children:n||a}),d&&e.jsx("button",{onClick:d,className:"bg-transparent border-none p-1 cursor-pointer flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity",style:{color:r.text},"aria-label":"Schließen",children:e.jsx(Ce,{size:16})})]})},zt=({message:t,onDismiss:a,...n})=>e.jsx(Rt,{variant:"error",message:t,isToast:!0,onDismiss:a,...n}),Mt={video:q,user:ce,briefcase:ft,presentation:pt,mic:ye,target:Ye,banknote:ht},Pt=async()=>{const t=await fetch(`${ze()}/video-training/scenarios`,{headers:{"X-WP-Nonce":de()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const a=await t.json();if(a.success&&a.data?.scenarios)return a.data.scenarios;throw new Error("Ungültige Antwort vom Server")},_t=t=>Mt[t.icon]||q,Vt=t=>[{text:`${t.question_count} Fragen`},{icon:Ne,text:`~${Math.round(t.total_time_limit/60)} Min.`}],Ft=()=>e.jsx("div",{className:"mt-10 p-5 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Je,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed m-0",children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Ge=({onSelectScenario:t,isAuthenticated:a,requireAuth:n,setPendingScenario:i,onNavigateToHistory:d})=>e.jsxs(e.Fragment,{children:[e.jsx(vt,{featureId:"videotraining",showOnMount:!0}),e.jsx(wt,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:q,headerActions:e.jsx(Nt,{featureId:"videotraining",size:"sm"}),fetchScenarios:Pt,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:d,onSelectScenario:t,renderCardMeta:Vt,getIconForScenario:_t,cardActionLabel:"Starten",cardActionIcon:ut,categoryField:"category",emptyStateIcon:q,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:Ft,isAuthenticated:a,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."})]}),Ot=t=>t?t.split(/(\*\*.*?\*\*)/g).map((n,i)=>n.startsWith("**")&&n.endsWith("**")?e.jsx("strong",{children:n.slice(2,-2)},i):n):null,Qe={target:Ye,clock:Ne,mic:ye,camera:De,video:q,"message-square":et,lightbulb:se,brain:se,info:ve,settings:Ae,check:me,sparkles:Je,user:ce,x:ie},$t=[{icon:"camera",text:"Schaue direkt in die Kamera für Augenkontakt."},{icon:"lightbulb",text:"Achte auf gute Beleuchtung von vorne."},{icon:"target",text:"Struktur: Wer → Was → Warum."},{icon:"mic",text:"Sprich deutlich und in ruhigem Tempo."}],Bt=({type:t,devices:a,selectedDeviceId:n,onDeviceChange:i,isLoading:d,error:m,onRefresh:u})=>{const[r,l]=s.useState(!1),v=t==="video"?De:ye,h=t==="video"?"Kamera":"Mikrofon",x=c=>{if(c.label){let g=c.label;return g=g.replace(/^Default - /,""),g=g.replace(/^Kommunikation - /,""),g=g.replace(/^Standard - /,""),g.length>40&&(g=g.substring(0,37)+"..."),g}return`${h} ${a.indexOf(c)+1}`},p=a.find(c=>c.deviceId===n),o=c=>{i?.(c),l(!1)};return e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("button",{type:"button",onClick:()=>!d&&l(!r),disabled:d,className:`flex-1 flex items-center justify-between gap-3 px-[18px] py-3.5 rounded-[14px] border-2 transition-all duration-200 ${m?"border-red-500 bg-red-50":"border-slate-200 bg-white"} ${d?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${m?"bg-red-50":"bg-brand-gradient"}`,children:m?e.jsx(ie,{className:"w-6 h-6 text-red-500"}):e.jsx(v,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[13px] text-slate-500 font-medium mb-0.5",children:h}),e.jsx("div",{className:`text-[15px] font-semibold ${m?"text-red-700":"text-slate-900"}`,children:d?"Lade...":m||(p?x(p):"Bitte wählen")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&u&&e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),u()},className:"flex items-center justify-center p-2 rounded-lg border-0 bg-slate-50 cursor-pointer",children:e.jsx(Re,{className:"w-[18px] h-[18px] text-slate-600"})}),e.jsx(st,{className:`w-[22px] h-[22px] text-slate-400 transition-transform duration-200 ${r?"rotate-180":"rotate-0"}`})]})]})}),r&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>l(!1),className:"fixed inset-0 z-40"}),e.jsx("div",{className:"absolute top-[calc(100%+8px)] left-0 right-0 bg-white rounded-[14px] shadow-[0_10px_40px_rgba(0,0,0,0.15)] border border-slate-200 z-50 overflow-hidden max-h-[300px] overflow-y-auto",children:a.map((c,g)=>e.jsxs("button",{type:"button",onClick:()=>o(c.deviceId),className:`w-full py-3.5 px-4 text-left flex items-center gap-3 border-0 cursor-pointer transition-colors duration-150 ${n===c.deviceId?"bg-primary/10":"bg-transparent hover:bg-slate-50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-[10px] flex items-center justify-center ${n===c.deviceId?"bg-primary":"bg-slate-50"}`,children:e.jsx(v,{className:`w-5 h-5 ${n===c.deviceId?"text-white":"text-slate-400"}`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:`text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap ${n===c.deviceId?"text-primary":"text-slate-900"}`,children:x(c)})}),n===c.deviceId&&e.jsx(me,{className:"w-5 h-5 text-primary"})]},c.deviceId||g))})]})]})},Lt=({deviceId:t})=>{const a=s.useRef(null),n=s.useRef(null),[i,d]=s.useState(null);return s.useEffect(()=>(t&&(async()=>{try{n.current&&n.current.getTracks().forEach(r=>r.stop());const u=await navigator.mediaDevices.getUserMedia({video:t?{deviceId:{exact:t}}:!0});n.current=u,a.current&&(a.current.srcObject=u),d(null)}catch(u){console.error("Error starting camera preview:",u),d("Kamera-Vorschau nicht verfügbar")}})(),()=>{n.current&&n.current.getTracks().forEach(u=>u.stop())}),[t]),i?e.jsx("div",{className:"aspect-video bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 text-sm",children:i}):e.jsx("div",{className:"aspect-video bg-slate-900 rounded-xl overflow-hidden",children:e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"})})},Kt=({scenario:t,onBack:a,onNext:n,hasVariables:i=!1})=>{const[d,m]=s.useState([]),[u,r]=s.useState([]),[l,v]=s.useState(null),[h,x]=s.useState(null),[p,o]=s.useState(!0),[c,g]=s.useState(null),[E,k]=s.useState(null),[F,O]=s.useState(!1),N=s.useRef(0),D=s.useRef(!1),W=s.useRef(null),G=s.useRef(null);W.current=l,G.current=h;const $=s.useCallback(async(S=!1)=>{if(!D.current&&!(S&&Date.now()-N.current<2e3)){D.current=!0,N.current=Date.now(),o(!0),g(null),k(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(A=>A.stop());const z=await navigator.mediaDevices.enumerateDevices(),M=z.filter(A=>A.kind==="audioinput"),B=z.filter(A=>A.kind==="videoinput");if(M.length===0)g("Kein Mikrofon gefunden"),m([]);else if(m(M),!W.current){const A=M.find(X=>X.deviceId==="default")||M[0];v(A.deviceId)}if(B.length===0)k("Keine Kamera gefunden"),r([]);else if(r(B),!G.current){const A=B.find(X=>X.deviceId==="default")||B[0];x(A.deviceId)}}catch(y){console.error("Error loading devices:",y),y.name==="NotAllowedError"||y.name==="PermissionDeniedError"?(g("Zugriff verweigert"),k("Zugriff verweigert")):y.name==="NotFoundError"?(g("Kein Mikrofon gefunden"),k("Keine Kamera gefunden")):(g("Fehler beim Laden"),k("Fehler beim Laden"))}finally{o(!1),D.current=!1,N.current=Date.now()}}},[]);s.useEffect(()=>{$(!1);let S=null;const y=()=>{S&&clearTimeout(S),S=setTimeout(()=>$(!0),500)};return navigator.mediaDevices?.addEventListener("devicechange",y),()=>{S&&clearTimeout(S),navigator.mediaDevices?.removeEventListener("devicechange",y)}},[$]);const R=()=>{n({selectedMicrophoneId:l,selectedCameraId:h})},Q=l&&!c&&h&&!E,U=t?.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips:$t;return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(Te,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(q,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Vorbereitung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:t?.title})]})]})]}),t?.long_description&&e.jsx(H,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ve,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:Ot(t.long_description)})]})]})}),U.length>0&&e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(se,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps für dein Training"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise für optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:U.map((S,y)=>{const z=Qe[S.icon]||Qe[S.icon?.toLowerCase()]||se;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(z,{className:"w-4 h-4 text-slate-600"})}),e.jsx("p",{className:"text-sm text-slate-700 m-0 pt-1",children:S.text||S.description})]},y)})})]}),p?e.jsx(H,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ee,{className:"w-8 h-8 text-primary mb-4 animate-spin"}),e.jsx("p",{className:"text-slate-600 m-0",children:"Geräte werden geladen..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(H,{className:"p-5 md:p-6 mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(De,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Kamera auswählen"})]}),e.jsx(Bt,{type:"video",devices:u,selectedDeviceId:h,onDeviceChange:x,isLoading:p,error:E,onRefresh:$}),h&&!E&&e.jsx(Lt,{deviceId:h})]}),e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(ye,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(St,{selectedDeviceId:l,onDeviceChange:v,onTestClick:()=>O(!0)})]})]}),e.jsxs(je,{onClick:R,disabled:!Q,size:"lg",className:"w-full gap-2.5",children:[i?"Weiter zur Konfiguration":"Video-Training starten",e.jsx(tt,{className:"w-5 h-5"})]}),e.jsx(kt,{isOpen:F,onClose:()=>O(!1),deviceId:l})]})},it=(t,a)=>{if(!a)return null;if(t.type==="select"&&t.options){const n=t.options.find(i=>i.value===a);return n?n.label:a}return a},Wt=({field:t,value:a,onChange:n,error:i})=>{const d=u=>{setTimeout(()=>{const r=u.target;if(r){const l=r.closest("div");l&&l.scrollIntoView({behavior:"smooth",block:"center"})}},300)},m=()=>{const u=i?"border-red-500":"";switch(t.type){case"text":return e.jsx(ke,{type:"text",value:a||"",onChange:r=>n(t.key,r.target.value),placeholder:t.placeholder||"",className:u,onFocus:d});case"textarea":return e.jsx(Ct,{value:a||"",onChange:r=>n(t.key,r.target.value),placeholder:t.placeholder||"",rows:4,className:`${u} min-h-[100px] resize-y`,onFocus:d});case"select":return e.jsxs("select",{value:a||t.default||"",onChange:r=>n(t.key,r.target.value),className:`w-full px-4 py-3 rounded-xl border-2 text-base text-slate-900 bg-white outline-none transition-all cursor-pointer appearance-none bg-[url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%236b7280%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e')] bg-[position:right_12px_center] bg-no-repeat bg-[length:20px] pr-11 focus:border-primary focus:ring-2 focus:ring-primary/20 ${i?"border-red-500":"border-slate-200"}`,onFocus:d,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),t.options?.slice().sort((r,l)=>r.label.localeCompare(l.label,"de")).map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"number":return e.jsx(ke,{type:"number",value:a||"",onChange:r=>n(t.key,r.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:u,onFocus:d});default:return e.jsx(ke,{type:"text",value:a||"",onChange:r=>n(t.key,r.target.value),placeholder:t.placeholder||"",className:u,onFocus:d})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m(),i&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-red-500 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3.5 h-3.5"}),i]}),t.hint&&!i&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-slate-500 flex items-center gap-1",children:[e.jsx(ve,{className:"w-3.5 h-3.5"}),t.hint]})]})},Ut=({inputConfig:t,formValues:a})=>{const n=t.filter(i=>{const d=a[i.key];return d&&(typeof d!="string"||d.trim()!=="")});return n.length===0?null:e.jsxs(H,{className:"p-4 mb-5 bg-slate-50 border-slate-200",children:[e.jsx("div",{className:"text-xs font-semibold text-primary uppercase tracking-wide mb-3",children:"Dein Profil"}),e.jsx("div",{className:"space-y-2",children:n.map(i=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-slate-500",children:i.label}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:it(i,a[i.key])})]},i.key))})]})},qt=({scenario:t,onBack:a,onNext:n})=>{const[i,d]=s.useState({}),[m,u]=s.useState({}),r=s.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(p=>p.user_input!==!1)}catch(x){return console.error("Error parsing input_configuration:",x),[]}},[t?.input_configuration]);s.useEffect(()=>{const x={};r.forEach(p=>{p.default&&(x[p.key]=p.default)}),d(x)},[r]);const l=(x,p)=>{d(o=>({...o,[x]:p})),m[x]&&u(o=>{const c={...o};return delete c[x],c})},v=()=>{const x={};return r.forEach(p=>{const o=i[p.key];if(p.required&&(!o||typeof o=="string"&&o.trim()==="")){x[p.key]="Dieses Feld ist erforderlich";return}if(!(!o||typeof o=="string"&&o.trim()==="")&&p.validation){const{minLength:c,maxLength:g,min:E,max:k,pattern:F}=p.validation;c&&o.length<c&&(x[p.key]=`Mindestens ${c} Zeichen erforderlich`),g&&o.length>g&&(x[p.key]=`Maximal ${g} Zeichen erlaubt`),E!==void 0&&Number(o)<E&&(x[p.key]=`Mindestens ${E}`),k!==void 0&&Number(o)>k&&(x[p.key]=`Maximal ${k}`),F&&!new RegExp(F).test(o)&&(x[p.key]="Ungültiges Format")}}),u(x),Object.keys(x).length===0},h=x=>{if(x.preventDefault(),!v())return;const p={...i};r.forEach(o=>{o.type==="select"&&i[o.key]&&(p[`${o.key}_label`]=it(o,i[o.key]))}),n(p)};return s.useEffect(()=>{r.length===0&&n({})},[r,n]),r.length===0?null:e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(Te,{size:18}),"Zurück"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(ce,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Personalisierung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:t?.title})]})]})]}),e.jsx(Ut,{inputConfig:r,formValues:i}),e.jsxs(H,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Dein Profil anpassen"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Diese Informationen personalisieren die Fragen"})]})]}),e.jsx("form",{onSubmit:h,id:"variables-form",children:r.map(x=>e.jsx(Wt,{field:x,value:i[x.key],onChange:l,error:m[x.key]},x.key))})]}),e.jsxs(je,{type:"submit",form:"variables-form",size:"lg",className:"w-full gap-2.5",children:["Video-Training starten",e.jsx(tt,{className:"w-5 h-5"})]})]})},Gt=({tips:t,primaryAccent:a})=>{const[n,i]=s.useState(!1);return!t||t.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(se,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(Ie,{size:18,className:`text-slate-500 transition-transform duration-200 ${n?"rotate-90":""}`})]}),e.jsx(at,{children:n&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:t.map((d,m)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:d},m))})})})})]})},Qt=({number:t,size:a="md"})=>{const n={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${n[a]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},Ze=({question:t,index:a,scenario:n,isMobile:i})=>e.jsxs(H,{className:i?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Qt,{number:a+1,size:i?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${i?"text-[15px]":"text-lg"} mb-0`,children:t?.question||"Frage wird geladen..."}),t?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(Ne,{size:i?14:16}),"Empfohlene Antwortzeit: ~",Math.round(t.estimated_time/60)," Min."]}),n?.enable_tips&&t?.tips&&e.jsx(Gt,{tips:t.tips})]}),He=({time:t,isRecording:a})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[a?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(Ne,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:yt(t)})]}),Xe=({error:t,onRetry:a})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(gt,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:t}),e.jsx(oe,{onClick:a,icon:e.jsx(Re,{size:16}),children:"Erneut versuchen"})]}),Zt=({isUploading:t,isAnalyzing:a})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-indigo-50/30 to-violet-50/30 flex items-center justify-center p-4",children:e.jsxs(T.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx(Ee,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:t?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:t?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),Ht=({session:t,questions:a,scenario:n,variables:i,onComplete:d,onExit:m,selectedMicrophoneId:u,selectedCameraId:r})=>{const[l,v]=s.useState(0),[h,x]=s.useState(!1),[p,o]=s.useState(!1),[c,g]=s.useState(0),[E,k]=s.useState([]),[F,O]=s.useState([]),[N,D]=s.useState(null),[W,G]=s.useState(null),[$,R]=s.useState(!1),[Q,U]=s.useState(!1),[S,y]=s.useState(null),[z,M]=s.useState(u||null),[B,A]=s.useState(r||null),[X,ae]=s.useState(!1),[xe,ue]=s.useState(0),J=At(),ne=s.useRef(null),j=s.useRef(null),P=s.useRef(null),Z=s.useRef(null),_=s.useRef(null),L=s.useRef(null),{branding:he}=Me(),Y=he?.["--primary-accent"],re=a[l];s.useEffect(()=>(K(),()=>{we(),P.current&&clearInterval(P.current),L.current&&cancelAnimationFrame(L.current),Z.current&&Z.current.close()}),[]);const pe=f=>{try{Z.current&&Z.current.close();const I=new(window.AudioContext||window.webkitAudioContext);Z.current=I;const b=I.createAnalyser();b.fftSize=256,b.smoothingTimeConstant=.8,_.current=b,I.createMediaStreamSource(f).connect(b);const ee=new Uint8Array(b.frequencyBinCount),te=()=>{if(!_.current)return;_.current.getByteFrequencyData(ee);const Se=ee.reduce((dt,mt)=>dt+mt,0)/ee.length;ue(Se/255),L.current=requestAnimationFrame(te)};te()}catch(I){console.error("[VIDEO TRAINING] Audio analysis error:",I)}},fe=()=>{L.current&&(cancelAnimationFrame(L.current),L.current=null),ue(0)},K=async(f=z,I=B)=>{try{G(null),N&&N.getTracks().forEach(te=>te.stop());const b=I?{deviceId:{exact:I},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},V=f?{deviceId:{exact:f}}:!0,ee=await navigator.mediaDevices.getUserMedia({video:b,audio:V});D(ee),ne.current&&(ne.current.srcObject=ee)}catch(b){console.error("[VIDEO TRAINING] Camera error:",b),G("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},lt=f=>{M(f),h||K(f,B)},ot=f=>{A(f),h||K(z,f)},we=()=>{N&&(N.getTracks().forEach(f=>f.stop()),D(null))},Pe=()=>{if(!N){K();return}try{const f=new MediaRecorder(N,{mimeType:"video/webm;codecs=vp9,opus"});j.current=f;const I=[];f.ondataavailable=b=>{b.data.size>0&&(I.push(b.data),k(V=>[...V,b.data]))},f.onstop=()=>{},f.start(1e3),x(!0),o(!1),pe(N),O(b=>[...b,{question_index:l,start_time:c}]),P.current=setInterval(()=>{g(b=>b+1)},1e3)}catch(f){console.error("[VIDEO TRAINING] Recording error:",f),y("Fehler beim Starten der Aufnahme")}},ge=()=>{j.current&&h&&(j.current.stop(),x(!1),fe(),P.current&&(clearInterval(P.current),P.current=null))},_e=()=>{l<a.length-1&&(h&&O(f=>[...f,{question_index:l+1,start_time:c}]),v(f=>f+1))},Ve=()=>{l>0&&v(f=>f-1)},Fe=async()=>{ge(),we(),R(!0),y(null);try{const f=new Blob(E,{type:"video/webm"}),I=ze(),b=new FormData;b.append("video",f,`video_${t.id}.webm`),b.append("video_duration",c.toString()),b.append("timeline",JSON.stringify(F));const V=await fetch(`${I}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":de()},body:b});if(!V.ok){const Se=await V.text();throw console.error("[VIDEO TRAINING] Upload failed:",V.status,Se),V.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+V.status)}const ee=await V.json();R(!1),U(!0);const te=await fetch(`${I}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()}});if(!te.ok)throw new Error("Fehler bei der Video-Analyse");const le=await te.json();d({session:le.data?.session||t,analysis:le.data?.analysis,categoryScores:le.data?.category_scores,overallScore:le.data?.overall_score})}catch(f){console.error("[VIDEO TRAINING] Upload/Analysis error:",f),y(f.message),R(!1),U(!1)}},ct=()=>{ge(),we(),m()};if($||Q)return e.jsx(Zt,{isUploading:$,isAnalyzing:Q});const be=E.length>0,Oe=n?.enable_navigation&&l>0,$e=n?.enable_navigation&&l<a.length-1;return e.jsxs("div",{className:`${J?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${J?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${J?"text-lg":"text-xl"} font-semibold text-slate-900`,children:n?.title}),e.jsxs("button",{onClick:ct,className:`${J?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Ce,{size:16}),"Abbrechen"]})]}),e.jsx(Et,{current:l,total:a.length,primaryAccent:Y,showCompleted:!1}),J?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Ze,{question:re,index:l,scenario:n,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[W?e.jsx(Xe,{error:W,onRetry:K}):e.jsx("video",{ref:ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(h||c>0)&&e.jsx(He,{time:c,isRecording:h})]}),h&&e.jsx("div",{className:"mt-4",children:e.jsx(Ue,{audioLevel:xe,isActive:!0,variant:"bars",size:"sm",accentColor:Y})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>ae(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(Ae,{size:20,className:"text-slate-500"})}),h?e.jsxs("button",{onClick:ge,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(Be,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Pe,disabled:!N,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(q,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[Oe&&e.jsx(oe,{variant:"secondary",size:"sm",icon:e.jsx(Le,{size:16}),onClick:Ve,className:"flex-1",children:"Zurück"}),$e&&e.jsx(oe,{size:"sm",iconPosition:"right",icon:e.jsx(Ie,{size:16}),onClick:_e,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Fe,disabled:!be,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${be?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Ke,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[W?e.jsx(Xe,{error:W,onRetry:K}):e.jsx("video",{ref:ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(h||c>0)&&e.jsx(He,{time:c,isRecording:h})]}),h&&e.jsx("div",{className:"mt-5",children:e.jsx(Ue,{audioLevel:xe,isActive:!0,variant:"bars",size:"sm",accentColor:Y})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>ae(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(Ae,{size:20,className:"text-slate-500"})}),h?e.jsxs("button",{onClick:ge,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(Be,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Pe,disabled:!N,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(q,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[Oe&&e.jsx(oe,{variant:"secondary",icon:e.jsx(Le,{size:18}),onClick:Ve,children:"Vorherige"}),$e&&e.jsx(oe,{iconPosition:"right",icon:e.jsx(Ie,{size:18}),onClick:_e,children:"Nächste"}),e.jsxs("button",{onClick:Fe,disabled:!be,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${be?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Ke,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(Ze,{question:re,index:l,scenario:n,isMobile:!1})]}),S&&e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(ie,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:S}),e.jsx("button",{onClick:()=>y(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(Ce,{size:16,className:"text-red-500"})})]}),e.jsx(It,{isOpen:X,onClose:()=>ae(!1),mode:"audio-video",selectedMicrophoneId:z,onMicrophoneChange:lt,selectedCameraId:B,onCameraChange:ot})]})},Xt={auftreten:jt,selbstbewusstsein:We,koerpersprache:ce,kommunikation:et,professionalitaet:We,inhalt:se},Jt=({score:t,size:a=120,strokeWidth:n=10,primaryAccent:i})=>{const d=(a-n)/2,m=d*2*Math.PI,u=m-t/100*m,r=rt(t,i);return e.jsxs("div",{className:"relative mx-auto",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"-rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:w.slate[200],strokeWidth:n}),e.jsx(T.circle,{cx:a/2,cy:a/2,r:d,fill:"none",stroke:r,strokeWidth:n,strokeLinecap:"round",strokeDasharray:m,initial:{strokeDashoffset:m},animate:{strokeDashoffset:u},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold text-slate-600",style:{fontSize:a/3,color:r},children:Math.round(t)}),e.jsx("span",{className:"text-slate-500",style:{fontSize:a/10},children:"von 100"})]})]})},Yt=({category:t,primaryAccent:a})=>{const[n,i]=s.useState(!1),d=Xt[t.category]||nt,m=rt(t.score,a);return e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-slate-200 overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>i(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:`${m}15`},children:e.jsx(d,{size:20,color:m})}),e.jsxs("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"text-[15px] font-semibold text-slate-900 mb-0.5",children:t.label}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[t.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",style:{color:m},children:Math.round(t.score)}),e.jsx(st,{size:20,className:"text-slate-500 transition-transform duration-200",style:{transform:n?"rotate(180deg)":"none"}})]})]}),e.jsx(at,{children:n&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:t.feedback}),t.strengths&&t.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-green-600 mb-2 flex items-center gap-1.5",children:[e.jsx(me,{size:14}),"Stärken"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.strengths.map((u,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:u},r))})]}),t.improvements&&t.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-amber-600 mb-2 flex items-center gap-1.5",children:[e.jsx(ie,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.improvements.map((u,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:u},r))})]})]})})})]})},es=({session:t,scenario:a,onBackToDashboard:n,onStartNew:i})=>{const{branding:d}=Me(),m=d?.["--primary-accent"]||w.indigo[500],{triggerConfetti:u,ConfettiComponent:r}=Tt(),l=t?.overall_score||0,v=t?.category_scores||[],h=t?.analysis||{},x=t?.summary_feedback||"",p=o=>o>=90?"Ausgezeichnet!":o>=80?"Sehr gut!":o>=70?"Gut!":o>=60?"Solide Leistung":o>=50?"Ausbaufähig":"Weiter üben!";return s.useEffect(()=>{l>=70&&u()},[l,u]),e.jsxs(e.Fragment,{children:[e.jsx(r,{}),e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs(T.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-brand-gradient flex items-center justify-center mx-auto mb-5 shadow-xl",children:e.jsx(bt,{size:40,color:w.white})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Training abgeschlossen!"}),e.jsxs("p",{className:"text-base text-slate-600",children:[a?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(T.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"bg-white rounded-2xl p-8 text-center border border-slate-200 shadow-md mb-6",children:[e.jsx(Jt,{score:l,size:160,primaryAccent:m}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mt-5 mb-2",children:p(l)}),e.jsx("p",{className:"text-[15px] text-slate-600 max-w-lg mx-auto leading-relaxed",children:x||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),v.length>0&&e.jsxs(T.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(nt,{size:20,color:m}),"Detaillierte Bewertung"]}),v.map((o,c)=>e.jsx(Yt,{category:o,primaryAccent:m},o.category||c))]}),h&&(h.key_strengths?.length>0||h.actionable_tips?.length>0)&&e.jsxs(T.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[h.key_strengths&&h.key_strengths.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-base font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(me,{size:18}),"Deine Stärken"]}),e.jsx("ul",{className:"m-0 pl-6",children:h.key_strengths.map((o,c)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:o},c))})]}),h.actionable_tips&&h.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-base font-semibold mb-3 flex items-center gap-2",style:{color:m},children:[e.jsx(se,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-6",children:h.actionable_tips.map((o,c)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:o},c))})]})]}),t?.video_url&&e.jsxs(T.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(q,{size:18,color:m}),"Deine Aufnahme"]}),e.jsx("video",{src:t.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]}),e.jsxs(T.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex gap-4 justify-center",children:[e.jsxs(je,{onClick:n,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(Te,{size:18}),"Zur Übersicht"]}),e.jsxs(je,{onClick:i,size:"lg",className:"gap-2 shadow-lg",children:[e.jsx(Re,{size:18}),"Nochmal üben"]})]})]})]})},C={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},fs=({isAuthenticated:t,requireAuth:a,setPendingAction:n,pendingScenario:i,clearPendingScenario:d,onNavigateToHistory:m})=>{const[u,r]=s.useState(C.DASHBOARD),[l,v]=s.useState(null),[h,x]=s.useState(null),[p,o]=s.useState([]),[c,g]=s.useState({}),[E,k]=s.useState(null),[F,O]=s.useState(null),[N,D]=s.useState(null),[W,G]=s.useState(!1),[$,R]=s.useState(null),[Q,U]=s.useState(null),{demoCode:S}=Me(),y=s.useMemo(()=>{if(!l?.input_configuration)return!1;try{return(Array.isArray(l.input_configuration)?l.input_configuration:[]).filter(P=>P.user_input!==!1).length>0}catch{return!1}},[l?.input_configuration]);s.useEffect(()=>{i&&t&&(v(i),r(C.PREPARATION),d&&d())},[i,t,d]),s.useEffect(()=>{Q&&t&&(v(Q),r(C.PREPARATION),U(null))},[Q,t]),s.useEffect(()=>{window.scrollTo(0,0)},[u]);const z=s.useCallback(j=>{v(j),r(C.PREPARATION)},[]),M=s.useCallback(()=>{v(null),x(null),o([]),g({}),k(null),O(null),D(null),R(null),r(C.DASHBOARD)},[]),B=s.useCallback(j=>{if(O(j.selectedMicrophoneId),D(j.selectedCameraId),l?.input_configuration&&(Array.isArray(l.input_configuration)?l.input_configuration:[]).filter(_=>_.user_input!==!1).length>0){r(C.VARIABLES);return}ae({},j.selectedMicrophoneId,j.selectedCameraId)},[l]),A=s.useCallback(()=>{r(C.PREPARATION)},[]),X=s.useCallback(j=>{g(j),ae(j,F,N)},[F,N]),ae=async(j,P,Z)=>{G(!0),R(null);try{const _=ze(),L=await fetch(`${_}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()},body:JSON.stringify({scenario_id:l.id,variables:j,demo_code:S||null})});if(!L.ok){const K=await L.json().catch(()=>({}));throw new Error(K.message||"Fehler beim Erstellen der Session")}const he=await L.json(),Y=he.data?.session||he.session;if(!Y)throw new Error("Keine Session-ID erhalten");const re=await fetch(`${_}/video-training/sessions/${Y.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":de()},body:JSON.stringify({variables:j})});if(!re.ok){const K=await re.json().catch(()=>({}));throw new Error(K.message||"Fehler beim Generieren der Fragen")}const pe=await re.json(),fe=pe.data?.questions||pe.questions||[];x({...Y,questions:fe}),o(fe),g(j),O(P),D(Z),r(C.SESSION)}catch(_){console.error("Error starting session:",_),R(_.message)}finally{G(!1)}},xe=s.useCallback(j=>{k(j.session),r(C.COMPLETE)},[]),ue=s.useCallback(()=>{M()},[M]),J=s.useCallback(()=>{x(null),o([]),k(null),O(null),D(null),R(null),r(C.PREPARATION)},[]),ne=()=>{switch(u){case C.DASHBOARD:return e.jsx(Ge,{onSelectScenario:z,isAuthenticated:t,requireAuth:a,setPendingScenario:U,onNavigateToHistory:m});case C.PREPARATION:return e.jsx(Kt,{scenario:l,onBack:M,onNext:B,hasVariables:y});case C.VARIABLES:return e.jsx(qt,{scenario:l,onBack:A,onNext:X});case C.SESSION:return e.jsx(Ht,{session:h,questions:p,scenario:l,variables:c,onComplete:xe,onExit:ue,selectedMicrophoneId:F,selectedCameraId:N});case C.COMPLETE:return e.jsx(es,{session:E,scenario:l,onBackToDashboard:M,onStartNew:J});default:return e.jsx(Ge,{onSelectScenario:z,isAuthenticated:t,requireAuth:a,setPendingScenario:U,onNavigateToHistory:m})}};return e.jsxs("div",{className:"min-h-full",children:[ne(),$&&e.jsx(zt,{message:$,onDismiss:()=>R(null)}),e.jsx(Dt,{isLoading:W,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{fs as V,Ge as a,Ht as b,es as c};
