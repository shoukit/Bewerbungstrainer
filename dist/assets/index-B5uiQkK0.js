import{j as e,l as Q,e as ee,z as je,I as Ne,k as te,a1 as ge,y as we,D as ye,ak as ve,T as Se,q as X,b as P,Z as ke,ar as Re,R as H,m as S,v as F,as as se,t as Ce,A as ae,p as re,a as _e,a4 as ne,at as Te,Y as le,al as Me,a7 as De}from"./ui-vendor-BmgxlMsf.js";import{d as h,a as o}from"./react-vendor-uDOJF2jQ.js";import{u as Ie}from"./useMobile-YxjH166V.js";import{k as Ae,v as Ee,l as Oe,m as ze,M as Fe,n as Ge}from"./index.js";import{e as Be,w as V}from"./FeatureInfoButton-nGplUxMY.js";import{M as Pe,a as Le}from"./MicrophoneTestDialog-3Mxy0Xdd.js";import{c as m}from"./utils-BEHD0UYf.js";import{V as We,S as Ue,a as Ve}from"./ScenarioCard-GiVmDvNr.js";import"./dialog-DnUGiHGA.js";import{c as He}from"./index-CklPxmEV.js";import"./useBranding-D1cHbBzE.js";const k=h.forwardRef(({children:t,className:s,variant:a="default",padding:r=!0,onClick:n,...l},i)=>{const c={default:"card",elevated:"card-elevated",interactive:"card-interactive",outline:"card border-2"};return e.jsx("div",{ref:i,className:m(c[a],r&&"p-4 md:p-6",n&&"cursor-pointer",s),onClick:n,...l,children:t})});k.displayName="Card";const ie=h.forwardRef(({children:t,className:s,gradient:a=!1,...r},n)=>e.jsx("div",{ref:n,className:m(a?"card-header-gradient rounded-t-card":"card-header","-m-4 md:-m-6 mb-4 md:mb-6",s),...r,children:t}));ie.displayName="CardHeader";const ce=h.forwardRef(({children:t,className:s,as:a="h3",...r},n)=>e.jsx(a,{ref:n,className:m("text-lg font-semibold",s),...r,children:t}));ce.displayName="CardTitle";const oe=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("p",{ref:r,className:m("text-sm text-body-muted mt-1",s),...a,children:t}));oe.displayName="CardDescription";const de=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("div",{ref:r,className:m("space-y-4",s),...a,children:t}));de.displayName="CardBody";const me=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("div",{ref:r,className:m("card-footer","-m-4 md:-m-6 mt-4 md:mt-6",s),...a,children:t}));me.displayName="CardFooter";const xe=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("div",{ref:r,className:m("flex items-center gap-2",s),...a,children:t}));xe.displayName="CardActions";k.Header=ie;k.Title=ce;k.Description=oe;k.Body=de;k.Footer=me;k.Actions=xe;const T=h.forwardRef(({children:t,className:s,variant:a="primary",size:r="md",icon:n,iconPosition:l="left",loading:i=!1,disabled:c=!1,fullWidth:d=!1,type:p="button",...x},y)=>{const b={primary:"btn-primary",secondary:"btn-secondary",ghost:"btn-ghost",danger:"btn-danger"},R={sm:"btn-sm",md:"",lg:"btn-lg"},M=c||i;return e.jsxs("button",{ref:y,type:p,disabled:M,className:m(b[a],R[r],d&&"w-full",s),...x,children:[i&&e.jsx(Q,{className:"icon-md animate-spin"}),!i&&n&&l==="left"&&e.jsx("span",{className:"icon-md",children:n}),t,!i&&n&&l==="right"&&e.jsx("span",{className:"icon-md",children:n})]})});T.displayName="Button";const Ze=h.forwardRef(({children:t,className:s,variant:a="ghost",size:r="md",label:n,loading:l=!1,disabled:i=!1,...c},d)=>{const p={primary:"btn-primary",secondary:"btn-secondary",ghost:"btn-ghost",danger:"btn-danger"},x={sm:"w-9 h-9 min-h-0 p-0",md:"w-11 h-11 min-h-0 p-0",lg:"w-13 h-13 min-h-0 p-0"},y={sm:"icon-sm",md:"icon-md",lg:"icon-lg"},b=i||l;return e.jsx("button",{ref:d,type:"button",disabled:b,"aria-label":n,title:n,className:m(p[a],x[r],"rounded-lg",s),...c,children:l?e.jsx(Q,{className:m(y[r],"animate-spin")}):e.jsx("span",{className:y[r],children:t})})});Ze.displayName="IconButton";const Ke=h.forwardRef(({children:t,className:s,orientation:a="horizontal",...r},n)=>e.jsx("div",{ref:n,className:m("flex gap-2",a==="vertical"&&"flex-col",s),...r,children:t}));Ke.displayName="ButtonGroup";const Z=({children:t,label:s,error:a,required:r,className:n,htmlFor:l})=>e.jsxs("div",{className:m("space-y-1.5",n),children:[s&&e.jsxs("label",{htmlFor:l,className:"input-label",children:[s,r&&e.jsx("span",{className:"text-status-error ml-1",children:"*"})]}),t,a&&e.jsxs("p",{className:"input-error-message flex items-center gap-1",children:[e.jsx(je,{className:"icon-sm"}),a]})]}),$e=h.forwardRef(({className:t,type:s="text",label:a,error:r,required:n,id:l,...i},c)=>{const d=l||a?.toLowerCase().replace(/\s+/g,"-");return e.jsx(Z,{label:a,error:r,required:n,htmlFor:d,children:e.jsx("input",{ref:c,id:d,type:s,required:n,className:m("input",r&&"input-error",t),...i})})});$e.displayName="Input";const Ye=h.forwardRef(({className:t,label:s,error:a,required:r,id:n,rows:l=4,...i},c)=>{const d=n||s?.toLowerCase().replace(/\s+/g,"-");return e.jsx(Z,{label:s,error:a,required:r,htmlFor:d,children:e.jsx("textarea",{ref:c,id:d,required:r,rows:l,className:m("textarea",a&&"input-error",t),...i})})});Ye.displayName="Textarea";const qe=h.forwardRef(({className:t,label:s,error:a,required:r,id:n,options:l=[],placeholder:i="AuswÃ¤hlen...",...c},d)=>{const p=n||s?.toLowerCase().replace(/\s+/g,"-");return e.jsx(Z,{label:s,error:a,required:r,htmlFor:p,children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{ref:d,id:p,required:r,className:m("input appearance-none pr-10",a&&"input-error",t),...c,children:[i&&e.jsx("option",{value:"",disabled:!0,children:i}),l.map(x=>e.jsx("option",{value:x.value,disabled:x.disabled,children:x.label},x.value))]}),e.jsx(ee,{className:"absolute right-3 top-1/2 -translate-y-1/2 icon-md pointer-events-none",style:{color:"var(--text-muted)"}})]})})});qe.displayName="Select";const Je=h.forwardRef(({className:t,label:s,error:a,id:r,...n},l)=>{const i=r||s?.toLowerCase().replace(/\s+/g,"-");return e.jsxs("div",{className:m("flex items-start gap-3",t),children:[e.jsx("input",{ref:l,id:i,type:"checkbox",className:m("w-5 h-5 rounded-md border-2 cursor-pointer mt-0.5","checked:bg-brand checked:border-brand","focus:ring-2 focus:ring-offset-2",a&&"border-status-error"),style:{borderColor:a?"var(--color-error)":"var(--border-color)",accentColor:"var(--primary-accent)"},...n}),s&&e.jsx("label",{htmlFor:i,className:"text-sm cursor-pointer",style:{color:"var(--text-secondary)"},children:s})]})});Je.displayName="Checkbox";const Xe=h.forwardRef(({children:t,className:s,columns:a=1,...r},n)=>{const l={1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"};return e.jsx("div",{ref:n,className:m("grid gap-4",l[a],s),...r,children:t})});Xe.displayName="FormGroup";const ue=h.forwardRef(({children:t,className:s,variant:a="default",size:r="md",icon:n,dot:l=!1,...i},c)=>{const d={default:"badge-default",success:"badge-success",error:"badge-error",warning:"badge-warning",info:"badge-info",brand:"badge-brand"},p={sm:"text-[10px] px-2 py-0.5",md:"",lg:"text-sm px-3 py-1.5"};return e.jsxs("span",{ref:c,className:m(d[a],p[r],s),...i,children:[l&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:a==="default"?"var(--text-muted)":"currentColor"}}),n&&!l&&e.jsx("span",{className:"icon-xs",children:n}),t]})});ue.displayName="Badge";const Qe=h.forwardRef(({children:t,className:s,gradient:a=!1,...r},n)=>e.jsx("div",{ref:n,className:m("flex-shrink-0 px-6 pt-6 pb-4",a&&"bg-brand-gradient text-white -mx-0 -mt-0 rounded-t-card px-6 py-5",s),...r,children:t}));Qe.displayName="DialogHeader";const et=h.forwardRef(({children:t,className:s,as:a="h2",...r},n)=>e.jsx(a,{ref:n,className:m("text-lg font-semibold",s),style:{color:"inherit"},...r,children:t}));et.displayName="DialogTitle";const tt=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("p",{ref:r,className:m("text-sm mt-1 opacity-80",s),style:{color:"inherit"},...a,children:t}));tt.displayName="DialogDescription";const st=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("div",{ref:r,className:m("flex-1 overflow-y-auto px-6 py-4",s),...a,children:t}));st.displayName="DialogBody";const at=h.forwardRef(({children:t,className:s,...a},r)=>e.jsx("div",{ref:r,className:m("flex-shrink-0 flex items-center justify-end gap-3 px-6 py-4","border-t",s),style:{borderColor:"var(--border-color-light)"},...a,children:t}));at.displayName="DialogFooter";o.createContext(null);const rt=He("mt-3 p-3 rounded-lg border",{variants:{variant:{default:"bg-blue-50 border-blue-200",success:"bg-green-50 border-green-200",warning:"bg-amber-50 border-amber-200",info:"bg-slate-50 border-slate-200"}},defaultVariants:{variant:"default"}}),nt={default:"text-blue-800",success:"text-green-800",warning:"text-amber-800",info:"text-slate-700"},lt={default:"text-blue-500",success:"text-green-500",warning:"text-amber-500",info:"text-slate-500"},it={default:we,success:ge,warning:te,info:Ne},ct=o.forwardRef(({className:t,variant:s="default",icon:a,children:r,...n},l)=>{const i=a||it[s],c=nt[s],d=lt[s];return e.jsx("div",{ref:l,className:m(rt({variant:s,className:t})),...n,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(i,{className:m("w-4 h-4 flex-shrink-0 mt-0.5",d)}),e.jsx("p",{className:m("text-xs leading-relaxed",c),children:r})]})})});ct.displayName="FeedbackTip";const ot=o.forwardRef(({className:t,...s},a)=>e.jsx("label",{ref:a,className:m("text-sm font-semibold text-slate-700 leading-none","peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...s}));ot.displayName="Label";const dt=o.forwardRef(({className:t,children:s,...a},r)=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{ref:r,className:m("flex h-11 w-full appearance-none rounded-xl border-2 bg-white pl-4 pr-10 py-2 text-sm text-slate-900","border-slate-200 shadow-sm","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","hover:border-slate-300","cursor-pointer","transition-all duration-200",t),...a,children:s}),e.jsx(ee,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}));dt.displayName="SelectNative";const pe={rocket:H,shuffle:Re,zap:ke},B=({icon:t,label:s,value:a,isMobile:r})=>e.jsxs(k,{className:"p-3 md:p-4",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-md md:rounded-lg bg-primary-light flex-center mb-2 md:mb-3",children:e.jsx(t,{className:"w-4 h-4 md:w-5 md:h-5 text-primary"})}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-slate-900",children:a}),e.jsx("div",{className:"text-[10px] md:text-xs text-slate-500",children:s})]}),mt=({mode:t,onBack:s,onStart:a})=>{const[r,n]=o.useState(""),[l,i]=o.useState(!1),[c,d]=o.useState(null),[p,x]=o.useState(!1),y=pe[t.icon]||H;o.useEffect(()=>{t.id==="klassiker"?n(t.topic):t.getTopic&&n(t.getTopic())},[t]);const b=()=>{if(!t.getTopic)return;i(!0);const M=1500,I=100;let E=0;const g=setInterval(()=>{n(t.getTopic()),E+=I,E>=M&&(clearInterval(g),i(!1))},I)},R=()=>{a({mode:t,topic:r,duration:t.duration,selectedMicrophoneId:c})};return e.jsxs("div",{className:"min-h-full flex flex-col p-6",children:[e.jsx(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:e.jsx(T,{variant:"secondary",size:"sm",icon:e.jsx(F,{}),onClick:s,className:"mb-8 w-fit",children:"ZurÃ¼ck zur Auswahl"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center max-w-[600px] mx-auto w-full",children:[e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-brand-gradient flex-center mx-auto mb-5 shadow-brand",children:e.jsx(y,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:t.title}),e.jsxs("p",{className:"text-base text-slate-500",children:[t.duration," Sekunden â€¢ ",t.subtitle]})]}),e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"w-full bg-brand-gradient rounded-2xl p-8 mb-6 shadow-brand",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-white/90",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold text-base",children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&e.jsxs(S.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:b,disabled:l,className:"flex items-center gap-2 px-4 py-2.5 bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg text-white text-sm font-semibold disabled:cursor-not-allowed",children:[e.jsx(Ce,{className:`w-4 h-4 ${l?"animate-spin":""}`}),l?"Dreht...":"Neu wÃ¼rfeln"]})]}),e.jsx(ae,{mode:"wait",children:e.jsxs(S.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-2xl font-semibold text-white leading-relaxed min-h-[66px]",children:['"',r,'"']},r)})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(k,{className:"w-full mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4 text-slate-700",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Pe,{selectedDeviceId:c,onDeviceChange:d,onTestClick:()=>x(!0)})]})}),e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"w-full bg-slate-50 rounded-xl p-5 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-slate-700",children:[e.jsx(_e,{className:"w-4.5 h-4.5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-sm",children:"Tipps fÃ¼r deine Antwort"})]}),e.jsxs("ul",{className:"m-0 pl-5 text-slate-600 text-sm leading-relaxed list-disc",children:[e.jsx("li",{children:"Atme tief durch bevor du beginnst"}),e.jsx("li",{children:"Sprich in einem ruhigen, gleichmÃ¤ÃŸigen Tempo"}),e.jsx("li",{children:'Mache bewusst Pausen statt "Ã„hm" zu sagen'}),e.jsx("li",{children:"Strukturiere deine Antwort: Einleitung â†’ Hauptteil â†’ Schluss"})]})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"w-full max-w-[400px]",children:e.jsx(T,{size:"lg",icon:e.jsx(ne,{}),onClick:R,fullWidth:!0,children:"Aufnahme starten"})})]}),e.jsx(Le,{isOpen:p,onClose:()=>x(!1),deviceId:c})]})},z={MODES:"modes",TOPIC:"topic"},Mt=({onStartGame:t,isAuthenticated:s,requireAuth:a,setPendingAction:r})=>{const[n,l]=o.useState(z.MODES),[i,c]=o.useState(null),[d,p]=o.useState("grid"),[x,y]=o.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),b=Ie(),[R,M]=o.useState(null);o.useEffect(()=>{const j=async()=>{try{const f=await V.getGameStats();f.success&&f.data&&y({totalGames:f.data.total_games||0,bestScore:f.data.best_score||0,avgScore:f.data.avg_score||0,totalPracticeTime:f.data.total_practice_time||0})}catch(f){console.error("Failed to load stats:",f)}};n===z.MODES&&j()},[n]),o.useEffect(()=>{R&&s&&(c(R),l(z.TOPIC),M(null))},[R,s]),o.useEffect(()=>{window.scrollTo(0,0)},[n]);const I=j=>{if(!s){M(j),a&&a(()=>{},null);return}c(j),l(z.TOPIC)},E=()=>{c(null),l(z.MODES)},g=j=>{t(j)},A=Object.values(Ae);return n===z.TOPIC&&i?e.jsx(mt,{mode:i,onBack:E,onStart:g}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{featureId:"rhetorikgym",showOnMount:!0}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"mb-5 md:mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2.5 md:gap-3 mb-2 md:mb-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl bg-brand-gradient flex-center",children:e.jsx(ye,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Der FÃ¼llwort-Killer"})]}),e.jsx("p",{className:"text-sm md:text-base text-slate-600 max-w-[600px] mx-auto",children:"Trainiere deine Rhetorik - sprich flÃ¼ssig und Ã¼berzeugend ohne Ã„hm und Ã–h!"})]}),e.jsxs("div",{className:"px-2 md:px-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2.5 md:gap-4 mb-6 md:mb-8",children:[e.jsx(B,{icon:ve,label:"Highscore",value:x.bestScore||"-",isMobile:b}),e.jsx(B,{icon:Se,label:"Spiele",value:x.totalGames||0,isMobile:b}),e.jsx(B,{icon:X,label:"Durchschnitt",value:x.avgScore?Math.round(x.avgScore):"-",isMobile:b}),e.jsx(B,{icon:P,label:"Trainingszeit",value:x.totalPracticeTime?`${Math.round(x.totalPracticeTime/60)}m`:"0m",isMobile:b})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"WÃ¤hle deinen Modus"}),e.jsx(We,{viewMode:d,onViewChange:p})]}),e.jsx(Ue,{minCardWidth:"280px",viewMode:d,children:A.map(j=>{const f=pe[j.icon]||H;return e.jsx(Ve,{title:j.title,subtitle:j.subtitle,description:j.description,icon:f,meta:[{icon:P,text:`${j.duration} Sekunden`}],action:{label:"Starten",icon:X},onClick:()=>I(j),viewMode:d},j.id)})})]})]})]})},N={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},xt=({count:t})=>e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-slate-900/90 flex-center z-50",children:e.jsxs(S.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},className:"text-white text-center",children:[e.jsx("div",{className:"text-[120px] font-bold mb-4",children:t}),e.jsx("div",{className:"text-2xl text-slate-400",children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),ut=({seconds:t,total:s,isWarning:a})=>{const r=t/s*100,n=Math.floor(t/60),l=t%60;return e.jsxs("div",{children:[e.jsxs("div",{className:`text-[64px] font-bold font-mono text-center ${a?"text-red-500":"text-slate-900"}`,children:[n,":",l.toString().padStart(2,"0")]}),e.jsx("div",{className:"mt-4 h-2 bg-slate-200 rounded overflow-hidden",children:e.jsx(S.div,{className:`h-full rounded ${a?"bg-red-500":"bg-primary"}`,initial:{width:"100%"},animate:{width:`${r}%`},transition:{duration:.5}})})]})},pt=({word:t,count:s})=>e.jsxs(ue,{variant:"error",className:"gap-1",children:['"',t,'"',e.jsxs("span",{className:"bg-red-500/20 px-1.5 py-0.5 rounded text-xs",children:[s,"x"]})]}),ht=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(s=>s.length>0).length,ft=t=>!t||!Array.isArray(t)?0:t.reduce((s,a)=>s+(a.count||0),0),bt=(t,s,a,r)=>{const n=ht(t),l=ft(s),i=n>0?l/n*100:0,c=r>0?Math.round(n/r*60):0;let d=0;n>=60?d=25:n>=40?d=15:n>=20?d=10:n>=10&&(d=5);let p=25;i>25?p=0:i>15?p=10:i>10?p=15:i>5&&(p=20);let x=0,y="keine_sprache";n>0&&(c>=100&&c<=140?(x=10,y="optimal"):c>=80&&c<100||c>140&&c<=160?(x=5,y=c<100?"zu_langsam":"zu_schnell"):(x=0,y=c<80?"zu_langsam":"zu_schnell"));const b=Math.min(40,Math.max(0,a||0)),R=d+p+x+b;return{total_words:n,filler_count:l,filler_percentage:i,words_per_minute:c,pace_feedback:y,score:R,score_breakdown:{words_score:d,filler_score:p,tempo_score:x,content_score:b}}},jt=({result:t,onPlayAgain:s,onBack:a})=>{const r=Ge(t.score),n=t.score>=70,l=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]",i=l?"bg-gradient-to-br from-slate-500 to-slate-600":n?"bg-gradient-to-br from-green-500 to-primary":"bg-gradient-to-br from-amber-500 to-orange-500";return e.jsxs("div",{className:"max-w-[600px] mx-auto",children:[e.jsxs("div",{className:`${i} rounded-2xl p-8 mb-6 text-white text-center`,children:[e.jsx("div",{className:"text-5xl mb-2",children:l?"ðŸŽ¤":r.emoji}),e.jsx("div",{className:"text-[72px] font-bold mb-2",children:t.score}),e.jsx("div",{className:"text-xl opacity-90 mb-4",children:"Punkte"}),e.jsx("p",{className:"text-lg",children:l?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":r.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs(k,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-primary mb-1.5",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:"WÃ¶rter"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:t.total_words}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"gesprochen"})]}),e.jsxs(k,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-red-500 mb-1.5",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:"FÃ¼llwÃ¶rter"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:t.filler_count}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.filler_percentage?.toFixed(1)||"0","%"]})]}),e.jsxs(k,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-primary mb-1.5",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:"Tempo"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:t.words_per_minute}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"WPM"})]}),e.jsxs(k,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600 mb-1.5",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:"Sprechzeit"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:t.duration_seconds||0}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"Sekunden"})]})]}),t.filler_words&&t.filler_words.length>0&&e.jsxs(k,{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-3 text-[15px]",children:"Erkannte FÃ¼llwÃ¶rter"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.filler_words.map((c,d)=>e.jsx(pt,{word:c.word,count:c.count},d))})]}),!l&&e.jsxs("div",{className:"bg-primary-light border border-primary/15 rounded-xl p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-primary mb-3 text-[15px]",children:"Bewertung im Detail"}),t.score_breakdown&&e.jsxs("div",{className:`grid grid-cols-2 gap-2 ${t.content_feedback?"mb-3":""}`,children:[e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸ“ Wortanzahl: ",e.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸš« FÃ¼llwÃ¶rter: ",e.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["â±ï¸ Tempo: ",e.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),e.jsxs("div",{className:"text-[13px] text-slate-600",children:["ðŸ’¡ Inhalt: ",e.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&e.jsx("div",{className:"pt-3 border-t border-primary/15",children:e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed",children:[e.jsx("strong",{children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&e.jsxs("div",{className:"bg-amber-50 border border-amber-500/25 rounded-xl p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-amber-600 mb-2 text-[15px]",children:"Tempo-Hinweis"}),e.jsx("p",{className:"text-sm text-slate-600",children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine PrÃ¤sentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&e.jsxs(k,{className:"mb-8 bg-slate-50",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-3 text-[15px]",children:"Transkript"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:t.transcript})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(T,{icon:e.jsx(le,{}),onClick:s,fullWidth:!0,children:"Nochmal spielen"}),e.jsx(T,{variant:"secondary",icon:e.jsx(F,{}),onClick:a,fullWidth:!0,children:"ZurÃ¼ck"})]})]})},Dt=({gameConfig:t,onBack:s,onComplete:a})=>{const[r,n]=o.useState(N.COUNTDOWN),[l,i]=o.useState(3),[c,d]=o.useState(t.duration),[p,x]=o.useState(null),[y,b]=o.useState(null),[R,M]=o.useState(0),[I,E]=o.useState(!1),g=o.useRef(null),A=o.useRef([]),j=o.useRef(null),f=o.useRef(null),_=o.useRef(null),L=o.useRef(null),W=o.useRef(null),K=V.getGeminiApiKey(),G=o.useCallback(()=>{j.current&&clearInterval(j.current),L.current&&cancelAnimationFrame(L.current),_.current&&(_.current.close(),_.current=null),g.current&&g.current.state!=="inactive"&&g.current.stop()},[]);o.useEffect(()=>G,[G]),o.useEffect(()=>{I||(E(!0),he())},[I]);const he=async()=>{n(N.COUNTDOWN),i(3);try{const v=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,w=await navigator.mediaDevices.getUserMedia({audio:v});_.current=new(window.AudioContext||window.webkitAudioContext);const D=_.current.createMediaStreamSource(w);f.current=_.current.createAnalyser(),f.current.fftSize=256,D.connect(f.current),g.current=new MediaRecorder(w,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),A.current=[],g.current.ondataavailable=C=>{C.data.size>0&&A.current.push(C.data)};let u=3;const O=setInterval(()=>{u--,i(u),u===0&&(clearInterval(O),Y())},1e3)}catch(v){console.error("Microphone access denied:",v),b("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),n(N.ERROR)}},$=o.useCallback(async()=>{n(N.COUNTDOWN),i(3);try{const v=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,w=await navigator.mediaDevices.getUserMedia({audio:v});_.current=new(window.AudioContext||window.webkitAudioContext);const D=_.current.createMediaStreamSource(w);f.current=_.current.createAnalyser(),f.current.fftSize=256,D.connect(f.current),g.current=new MediaRecorder(w,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),A.current=[],g.current.ondataavailable=C=>{C.data.size>0&&A.current.push(C.data)};let u=3;const O=setInterval(()=>{u--,i(u),u===0&&(clearInterval(O),Y())},1e3)}catch(v){console.error("Microphone access denied:",v),b("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),n(N.ERROR)}},[t.selectedMicrophoneId]),Y=o.useCallback(()=>{n(N.RECORDING),d(t.duration),W.current=Date.now(),g.current.start();const v=()=>{if(f.current){const w=new Uint8Array(f.current.frequencyBinCount);f.current.getByteFrequencyData(w);const D=w.reduce((u,O)=>u+O)/w.length;M(D/255)}L.current=requestAnimationFrame(v)};v(),j.current=setInterval(()=>{d(w=>w<=1?(q(),0):w-1)},1e3)},[t.duration]),q=o.useCallback(()=>{const v=W.current?Math.round((Date.now()-W.current)/1e3):t.duration;G(),n(N.PROCESSING),g.current.onstop=async()=>{const w=new Blob(A.current,{type:g.current.mimeType});g.current.stream.getTracks().forEach(u=>u.stop());const D=Ee(w,{minSize:Fe});if(!D.valid){console.warn("[GameSession] Audio validation failed:",D.error,"Size:",w.size);const u={...Oe("game"),score:0,word_count:0,filler_count:0,words_per_minute:0,duration_seconds:v};x(u),n(N.RESULTS);return}try{const u=await ze(w,K,t.topic,t.duration),C={...bt(u.transcript,u.filler_words,u.content_score,v),transcript:u.transcript||"[Keine Sprache erkannt]",filler_words:u.filler_words||[],content_feedback:u.content_feedback||"",duration_seconds:v};x(C),n(N.RESULTS);try{const U={game_type:t.mode.id,topic:t.topic,duration_seconds:v,score:C.score,filler_count:C.filler_count,words_per_minute:C.words_per_minute,transcript:C.transcript,analysis_json:JSON.stringify(C)};await V.createGameSession(U)}catch(U){console.error("[GameSession] Failed to save game session:",U)}}catch(u){console.error("Analysis failed:",u),b(`Analyse fehlgeschlagen: ${u.message}`),n(N.ERROR)}},g.current.stop()},[K,t,G]),fe=()=>{q()},J=()=>{x(null),b(null),d(t.duration),$()},be=()=>{switch(r){case N.READY:return e.jsx("div",{className:"text-center py-10 px-5",children:e.jsxs("div",{className:"max-w-[500px] mx-auto",children:[e.jsx("div",{className:"text-6xl mb-6",children:"ðŸŽ¤"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Bereit?"}),e.jsx("p",{className:"text-base text-slate-600 mb-6 leading-relaxed",children:t.topic}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full text-slate-600 text-sm mb-8",children:[e.jsx(P,{className:"w-4 h-4"}),t.duration," Sekunden"]}),e.jsx("div",{children:e.jsx(T,{size:"lg",icon:e.jsx(ne,{}),onClick:$,children:"Aufnahme starten"})}),e.jsxs("button",{onClick:s,className:"mt-6 px-5 py-2.5 border-none bg-transparent text-slate-400 text-sm cursor-pointer inline-flex items-center gap-1.5",children:[e.jsx(F,{className:"w-4 h-4"}),"ZurÃ¼ck zur Auswahl"]})]})});case N.RECORDING:return e.jsx("div",{className:"text-center py-10 px-5",children:e.jsxs("div",{className:"max-w-[500px] mx-auto",children:[e.jsx(ut,{seconds:c,total:t.duration,isWarning:c<=10}),e.jsxs("div",{className:"mt-8 mb-8 p-4 bg-slate-100 rounded-xl",children:[e.jsx("p",{className:"text-[13px] text-slate-500 mb-1",children:"Dein Thema:"}),e.jsx("p",{className:"text-[15px] font-medium text-slate-900",children:t.topic})]}),e.jsx("div",{className:"mb-8",children:e.jsx(S.div,{className:"h-20 bg-brand-gradient rounded-2xl flex-center",animate:{opacity:.6+R*.4},children:e.jsx(S.div,{className:"w-14 h-14 rounded-full bg-white/30 flex-center",animate:{scale:1+R*.3},children:e.jsx(re,{className:"w-7 h-7 text-white"})})})}),e.jsxs("div",{className:"flex-center gap-2 mb-8",children:[e.jsx(S.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"font-medium text-red-500 text-sm",children:"Aufnahme lÃ¤uft..."})]}),e.jsx(T,{variant:"danger",icon:e.jsx(Me,{}),onClick:fe,children:"Aufnahme beenden"})]})});case N.PROCESSING:return e.jsxs("div",{className:"text-center py-20 px-5",children:[e.jsx(S.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-14 h-14 border-4 border-primary border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Analysiere deine Aufnahme..."}),e.jsx("p",{className:"text-slate-500",children:"Der FÃ¼llwort-Killer zÃ¤hlt nach"})]});case N.RESULTS:return e.jsx(jt,{result:p,onPlayAgain:J,onBack:s});case N.ERROR:return e.jsx("div",{className:"text-center py-16 px-5",children:e.jsxs("div",{className:"max-w-[400px] mx-auto",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex-center mx-auto mb-6",children:e.jsx(Te,{className:"w-8 h-8 text-red-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-3",children:"Fehler"}),e.jsx("p",{className:"text-slate-600 mb-6",children:y}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(T,{icon:e.jsx(le,{}),onClick:J,children:"Erneut versuchen"}),e.jsx(T,{variant:"secondary",icon:e.jsx(F,{}),onClick:s,children:"ZurÃ¼ck"})]})]})});default:return null}};return e.jsxs("div",{className:"min-h-full pb-8",children:[e.jsx(ae,{children:r===N.COUNTDOWN&&e.jsx(xt,{count:l})}),r!==N.COUNTDOWN&&r!==N.RECORDING&&e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-[600px] mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 border-none bg-transparent text-slate-600 text-sm cursor-pointer",children:[e.jsx(F,{className:"w-4.5 h-4.5"}),"ZurÃ¼ck"]}),e.jsx("h1",{className:"font-semibold text-slate-900 text-base",children:t.mode.title}),e.jsx("div",{className:"w-[60px]"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-[600px] mx-auto",children:be()})})]})};export{Dt as GameSession,Mt as RhetorikGym};
