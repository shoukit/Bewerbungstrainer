import{a as g,w as j,j as t,k as r,L as M}from"./colors-uXoD1ofg.js";import{D as B}from"./DeviceSetupPage-CUivRes0.js";import{u as _}from"./useBranding-Cxdgj0iN.js";import{M as G,a as O,I as C}from"./index.js";import{S as $}from"./server-BdkxEoE-.js";import{G as D}from"./globe-CYsFAgb8.js";import{R as F}from"./refresh-cw-CISYsOw3.js";import{C as z}from"./circle-check-ZmDrGT7a.js";import"./MicrophoneTestDialog-BMhIyrd3.js";import"./circle-alert-EMpUppYH.js";import"./utils-BEHD0UYf.js";import"./circle-check-big-i8yN9nVa.js";import"./volume-2-DsiN52jK.js";import"./square-CwZKSRSa.js";import"./play-q3i8YB9n.js";import"./formatting-B67Bmjxp.js";import"./arrow-left-CtCRDCiU.js";import"./designTokens-DbcSlXo4.js";const N="wss://karriereheld-ws-proxy.onrender.com/ws";async function U(i,d=5e3){if(!i)return{success:!1,error:"No agent ID provided"};const u=`wss://api.elevenlabs.io/v1/convai/conversation?agent_id=${i}`,n=Date.now();return new Promise(p=>{let o=null,a=!1;const c=()=>{if(o){try{o.close()}catch{}o=null}},l=s=>{a||(a=!0,c(),p(s))},e=setTimeout(()=>{l({success:!1,error:"Connection timeout - WebSocket may be blocked by firewall"})},d);try{o=new WebSocket(u),o.onopen=()=>{clearTimeout(e);const s=Date.now()-n;l({success:!0,latency:s})},o.onerror=s=>{clearTimeout(e),l({success:!1,error:"WebSocket connection failed - may be blocked by firewall"})},o.onclose=s=>{clearTimeout(e),a||(s.code===1e3?l({success:!0,latency:Date.now()-n}):l({success:!1,error:`Connection closed: ${s.code} ${s.reason||""}`.trim()}))}}catch(s){clearTimeout(e),l({success:!1,error:s.message||"Failed to create WebSocket connection"})}})}async function W(i,d=5e3){if(!i)return{success:!1,error:"No agent ID provided"};const u=`${N}?agent_id=${i}`,n=Date.now();return new Promise(p=>{let o=null,a=!1;const c=()=>{if(o){try{o.close()}catch{}o=null}},l=s=>{a||(a=!0,c(),p(s))},e=setTimeout(()=>{l({success:!1,error:"Proxy connection timeout"})},d);try{o=new WebSocket(u),o.onopen=()=>{clearTimeout(e);const s=Date.now()-n;l({success:!0,latency:s})},o.onerror=s=>{clearTimeout(e),l({success:!1,error:"Proxy connection failed"})},o.onclose=s=>{clearTimeout(e),a||(s.code===1e3?l({success:!0,latency:Date.now()-n}):l({success:!1,error:`Proxy connection closed: ${s.code}`}))}}catch(s){clearTimeout(e),l({success:!1,error:s.message||"Failed to connect to proxy"})}})}function K(){return typeof WebSocket<"u"}async function q(i){if(!K())return{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Browser unterstützt keine WebSocket-Verbindungen"};const d=await U(i,5e3);if(d.success)return{mode:"websocket",directAvailable:!0,proxyAvailable:!1,directLatency:d.latency};const u=await W(i,5e3);return u.success?{mode:"proxy",directAvailable:!1,proxyAvailable:!0,proxyLatency:u.latency,error:d.error}:{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Alle WebSocket-Verbindungen werden durch Firewall blockiert"}}const X=({mode:i,isChecking:d,latency:u,proxyLatency:n,error:p,onSwitchMode:o,onRetry:a,directAvailable:c,proxyAvailable:l,b:e})=>d?t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:e.space[2.5],padding:`${e.space[3.5]} ${e.space[4]}`,backgroundColor:r.blue[50],border:`1px solid ${r.blue[200]}`,borderRadius:e.radius.lg},children:[t.jsx(M,{style:{width:"20px",height:"20px",color:r.blue[500]},className:"animate-spin"}),t.jsx("span",{style:{fontSize:e.fontSize.base,fontWeight:e.fontWeight.medium,color:r.blue[700]},children:"Prüfe Verbindung..."})]}):p&&!c&&!l?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:e.space[3]},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:e.space[2.5],padding:`${e.space[3.5]} ${e.space[4]}`,backgroundColor:r.red[50],border:`1px solid ${r.red[200]}`,borderRadius:e.radius.lg},children:[t.jsx(O,{style:{width:"20px",height:"20px",color:r.red[600]}}),t.jsx("div",{style:{flex:1},children:t.jsx("span",{style:{fontSize:e.fontSize.base,fontWeight:e.fontWeight.medium,color:r.red[800]},children:"Keine Verbindung möglich"})})]}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:e.space[2.5],padding:`${e.space[3.5]} ${e.space[4]}`,backgroundColor:r.slate[50],border:`1px solid ${r.slate[200]}`,borderRadius:e.radius.lg},children:[t.jsx(C,{style:{width:"16px",height:"16px",color:r.slate[500],flexShrink:0,marginTop:"2px"}}),t.jsxs("div",{style:{fontSize:e.fontSize.xs,color:r.slate[600]},children:[t.jsx("p",{style:{margin:0,fontWeight:e.fontWeight.medium,marginBottom:e.space[1]},children:"WebSocket-Verbindungen blockiert"}),t.jsx("p",{style:{margin:0},children:p})]})]}),t.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:e.space[1.5],fontSize:e.fontSize.xs,color:r.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",padding:0},children:[t.jsx(F,{style:{width:"12px",height:"12px"}}),"Verbindung erneut prüfen"]})]}):i==="websocket"?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:e.space[2]},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:e.space[2.5],padding:`${e.space[3.5]} ${e.space[4]}`,backgroundColor:r.green[50],border:`1px solid ${r.green[200]}`,borderRadius:e.radius.lg},children:[t.jsx(D,{style:{width:"20px",height:"20px",color:r.green[500]}}),t.jsxs("div",{style:{flex:1},children:[t.jsx("span",{style:{fontSize:e.fontSize.base,fontWeight:e.fontWeight.medium,color:r.green[700]},children:"Direkte Echtzeit-Verbindung"}),u&&t.jsxs("span",{style:{fontSize:e.fontSize.xs,color:r.green[600],marginLeft:e.space[2]},children:["(",u,"ms)"]})]}),t.jsx(z,{style:{width:"20px",height:"20px",color:r.green[500]}})]}),t.jsx("button",{onClick:()=>o("proxy"),style:{fontSize:e.fontSize.xs,color:r.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Proxy-Modus testen"})]}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:e.space[2]},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:e.space[2.5],padding:`${e.space[3.5]} ${e.space[4]}`,backgroundColor:r.blue[50],border:`1px solid ${r.blue[200]}`,borderRadius:e.radius.lg},children:[t.jsx($,{style:{width:"20px",height:"20px",color:r.blue[500]}}),t.jsxs("div",{style:{flex:1},children:[t.jsx("span",{style:{fontSize:e.fontSize.base,fontWeight:e.fontWeight.medium,color:r.blue[700]},children:"Proxy-Modus (Echtzeit via Server)"}),n&&t.jsxs("span",{style:{fontSize:e.fontSize.xs,color:r.blue[500],marginLeft:e.space[2]},children:["(",n,"ms)"]})]}),t.jsx(z,{style:{width:"20px",height:"20px",color:r.blue[500]}})]}),!c&&t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:e.space[2.5],padding:`${e.space[3]} ${e.space[4]}`,backgroundColor:r.slate[50],border:`1px solid ${r.slate[200]}`,borderRadius:e.radius.lg},children:[t.jsx(C,{style:{width:"14px",height:"14px",color:r.slate[500],flexShrink:0,marginTop:"2px"}}),t.jsx("div",{style:{fontSize:e.fontSize.xs,color:r.slate[600]},children:t.jsx("p",{style:{margin:0},children:"Direkte Verbindung blockiert. Der Proxy-Server ermöglicht Echtzeit-Gespräche trotz Firewall."})})]}),c&&t.jsx("button",{onClick:()=>o("websocket"),style:{fontSize:e.fontSize.xs,color:r.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Direkte Verbindung nutzen"})]}),xe=({scenario:i,onBack:d,onStart:u})=>{const n=_(),[p,o]=g.useState("websocket"),[a,c]=g.useState(!0),[l,e]=g.useState(null),[s,A]=g.useState(null),[I,w]=g.useState(null),[R,b]=g.useState(!1),[k,y]=g.useState(!1);g.useEffect(()=>{v()},[i]);const v=async()=>{c(!0),e(null);try{const x=i?.agent_id||j.getElevenLabsAgentId();if(!x){o("websocket"),e("Keine Agent-ID konfiguriert"),b(!1),y(!1),c(!1);return}const f=await q(x);o(f.mode),b(f.directAvailable),y(f.proxyAvailable),A(f.directLatency||null),w(f.proxyLatency||null),e(f.error||null)}catch(x){console.error("[DeviceSetup] Connection check failed:",x),o("websocket"),e(x.message),b(!1),y(!1)}finally{c(!1)}},P=async x=>{const f=i?.agent_id||j.getElevenLabsAgentId();if(x==="proxy"&&!k&&f){c(!0);const S=await W(f,5e3);if(c(!1),S.success)y(!0),w(S.latency),o("proxy");else{e("Proxy-Verbindung nicht verfügbar: "+S.error);return}}else o(x)},L=()=>{v()},T=({selectedMicrophoneId:x})=>{u({selectedMicrophoneId:x,connectionMode:p})},h=i?.interviewer_profile?.name;let m;p==="proxy"?m=h?`${h} anrufen (Proxy)`:"Gespräch starten (Proxy)":h?m=`${h} anrufen`:m="Gespräch starten";const V=()=>p==="proxy"?t.jsx($,{style:{width:"20px",height:"20px",color:n.primaryAccent}}):t.jsx(D,{style:{width:"20px",height:"20px",color:n.primaryAccent}}),E=t.jsxs("div",{style:{padding:n.space[5],backgroundColor:"white",borderRadius:n.radius.xl,border:`1px solid ${r.slate[200]}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2.5],marginBottom:n.space[4]},children:[V(),t.jsx("h3",{style:{fontSize:n.fontSize.lg,fontWeight:n.fontWeight.semibold,color:r.slate[900],margin:0},children:"Verbindungsmodus"})]}),t.jsx(X,{mode:p,isChecking:a,latency:s,proxyLatency:I,error:l,onSwitchMode:P,onRetry:L,directAvailable:R,proxyAvailable:k,b:n})]});return t.jsx(B,{mode:"audio",scenario:i,onBack:d,onStart:T,title:i?.title,startButtonLabel:m,icon:G,disabled:a,extraContent:E})};export{xe as default};
