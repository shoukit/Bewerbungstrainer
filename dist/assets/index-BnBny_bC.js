import{V as Ve,c as Ke,a as Le,b as $e}from"./VideoTrainingApp-q7XHZXo4.js";import{j as e,v as le,V as ee,m as b,I as A,y as B,an as M,p as $,T as te,a as ie,a1 as de,E as ne,am as ce,M as pe,b as xe,z as _,h as ue,e as ge,t as fe}from"./ui-vendor-BmgxlMsf.js";import{a as s}from"./react-vendor-uDOJF2jQ.js";import{u as he,g as me,b as J}from"./FeatureInfoButton-nGplUxMY.js";import{F as ye}from"./fullscreen-loader-DD3Nz0k1.js";import"./ScenarioDashboard-BzFUdSvS.js";import"./ScenarioCard-GiVmDvNr.js";import"./useBranding-D1cHbBzE.js";import"./dialog-DnUGiHGA.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-CHKUzrBR.js";import"./MicrophoneTestDialog-3Mxy0Xdd.js";import"./useMobile-YxjH166V.js";import"./DeviceSettingsDialog-Bk-hr9U4.js";import"./progress-bar-CZJEIjJp.js";const Y={target:te,clock:xe,mic:$,camera:M,video:ee,"message-square":pe,lightbulb:B,brain:ce,info:A,settings:ne,check:de,sparkles:ie},be=[{icon:M,title:"Blick in die Kamera",description:"Schaue direkt in die Kamera, um Augenkontakt zu simulieren."},{icon:B,title:"Gute Beleuchtung",description:"Achte auf ausreichend Licht von vorne, um professionell zu wirken."},{icon:$,title:"Klare Aussprache",description:"Sprich deutlich und in angemessenem Tempo."},{icon:te,title:"Strukturierte Antworten",description:"Nutze die STAR-Methode: Situation, Task, Action, Result."}],Q=({type:t,devices:g,selectedDeviceId:c,onDeviceChange:u,isLoading:h,error:l,onRefresh:m,primaryAccent:p,themedGradient:v})=>{const[r,k]=s.useState(!1),E=t==="video"?M:$,S=t==="video"?"Kamera":"Mikrofon",D=o=>{if(o.label){let d=o.label;return d=d.replace(/^Default - /,""),d=d.replace(/^Kommunikation - /,""),d=d.replace(/^Standard - /,""),d.length>35&&(d=d.substring(0,32)+"..."),d}return`${S} ${g.indexOf(o)+1}`},w=g.find(o=>o.deviceId===c),I=o=>{u?.(o),k(!1)};return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:[e.jsxs("button",{type:"button",onClick:()=>!h&&k(!r),disabled:h,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${l?"#ef4444":"#e2e8f0"}`,backgroundColor:l?"#fef2f2":"#fff",cursor:h?"not-allowed":"pointer",opacity:h?.6:1,transition:"all 0.2s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:l?"#fee2e2":v},children:l?e.jsx(_,{style:{width:"22px",height:"22px",color:"#ef4444"}}):e.jsx(E,{style:{width:"22px",height:"22px",color:"#fff"}})}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#64748b",fontWeight:500,marginBottom:"2px"},children:S}),e.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:l?"#dc2626":"#1e293b"},children:h?"Lade...":l||(w?D(w):"Bitte wählen")})]})]}),e.jsx(ge,{style:{width:"20px",height:"20px",color:"#94a3b8",transform:r?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]}),l&&m&&e.jsx("button",{type:"button",onClick:m,style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 16px",borderRadius:"12px",border:"2px solid #e2e8f0",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s"},children:e.jsx(fe,{style:{width:"20px",height:"20px",color:"#475569"}})})]}),r&&g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>k(!1),style:{position:"fixed",inset:0,zIndex:40}}),e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:"#fff",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:"1px solid #e2e8f0",zIndex:50,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:g.map((o,d)=>e.jsxs("button",{type:"button",onClick:()=>I(o.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:c===o.deviceId?`${p}15`:"transparent",cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:C=>{c!==o.deviceId&&(C.currentTarget.style.backgroundColor="#f8fafc")},onMouseLeave:C=>{C.currentTarget.style.backgroundColor=c===o.deviceId?`${p}15`:"transparent"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:c===o.deviceId?p:"#f1f5f9"},children:e.jsx(E,{style:{width:"18px",height:"18px",color:c===o.deviceId?"#fff":"#64748b"}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:c===o.deviceId?p:"#1e293b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D(o)}),o.deviceId==="default"&&e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Systemstandard"})]}),c===o.deviceId&&e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:p}})]},o.deviceId||d))})]})]})},je=({field:t,value:g,onChange:c,error:u,primaryAccent:h})=>{const l={width:"100%",padding:"12px 16px",borderRadius:"10px",border:`2px solid ${u?"#ef4444":"#e2e8f0"}`,fontSize:"16px",transition:"all 0.2s ease",outline:"none",background:"#fff"},m=r=>{r.target.style.borderColor=h,r.target.style.boxShadow=`0 0 0 3px ${h}20`},p=r=>{r.target.style.borderColor=u?"#ef4444":"#e2e8f0",r.target.style.boxShadow="none"},v=()=>{switch(t.type){case"select":return e.jsxs("select",{value:g||t.default||"",onChange:r=>c(t.key,r.target.value),style:{...l,cursor:"pointer"},onFocus:m,onBlur:p,required:t.required,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte auswählen..."}),t.options?.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"textarea":return e.jsx("textarea",{value:g||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,style:{...l,minHeight:"100px",resize:"vertical"},onFocus:m,onBlur:p,required:t.required});case"number":return e.jsx("input",{type:"number",value:g||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,style:l,onFocus:m,onBlur:p,required:t.required,min:t.min,max:t.max});default:return e.jsx("input",{type:"text",value:g||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,style:l,onFocus:m,onBlur:p,required:t.required})}};return e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"8px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),v(),t.hint&&e.jsx("p",{style:{fontSize:"13px",color:"#94a3b8",marginTop:"4px"},children:t.hint}),u&&e.jsxs("p",{style:{fontSize:"13px",color:"#ef4444",marginTop:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(_,{size:14}),u]})]})},Ae=({scenario:t,onBack:g,onStart:c})=>{const[u,h]=s.useState(()=>{const i=t?.input_configuration||[],n={};return i.forEach(a=>{a.default&&(n[a.key]=a.default)}),n}),[l,m]=s.useState({}),[p,v]=s.useState(!1),[r,k]=s.useState(null),[E,S]=s.useState([]),[D,w]=s.useState([]),[I,o]=s.useState(null),[d,C]=s.useState(null),[N,O]=s.useState(!0),[P,T]=s.useState(null),[G,R]=s.useState(null),q=s.useRef(0),F=s.useRef(!1),V=s.useRef(!0),K=s.useRef(0),H=s.useRef(null),Z=s.useRef(null),{branding:U,demoCode:re}=he(),z=U?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",f=U?.primaryAccent||"#3A7FA7";H.current=I,Z.current=d;const W=s.useCallback(async(i=!1)=>{if(F.current){console.log("[VideoTraining] Skipping loadDevices - already loading");return}if(i){if(V.current){console.log("[VideoTraining] Skipping devicechange - ignore flag set");return}const n=Date.now()-q.current;if(n<5e3){console.log("[VideoTraining] Skipping devicechange - too soon:",n,"ms");return}if(K.current+=1,K.current>3){console.log("[VideoTraining] Skipping devicechange - too many events:",K.current);return}}F.current=!0,q.current=Date.now(),O(!0),T(null),R(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(x=>x.stop());const a=await navigator.mediaDevices.enumerateDevices(),y=a.filter(x=>x.kind==="audioinput"),j=a.filter(x=>x.kind==="videoinput");if(y.length===0)T("Kein Mikrofon gefunden"),S([]);else if(S(y),!H.current){const x=y.find(L=>L.deviceId==="default")||y[0];o(x.deviceId)}if(j.length===0)R("Keine Kamera gefunden"),w([]);else if(w(j),!Z.current){const x=j.find(L=>L.deviceId==="default")||j[0];C(x.deviceId)}}catch(n){console.error("Error loading devices:",n),n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?(T("Zugriff verweigert"),R("Zugriff verweigert")):n.name==="NotFoundError"?(T("Kein Mikrofon gefunden"),R("Keine Kamera gefunden")):(T("Fehler beim Laden"),R("Fehler beim Laden")),S([]),w([])}finally{O(!1),F.current=!1,q.current=Date.now(),i||setTimeout(()=>{V.current=!1,console.log("[VideoTraining] Now accepting devicechange events")},5e3)}},[]);s.useEffect(()=>{W(!1);let i=null;const n=()=>{V.current||F.current||(i&&clearTimeout(i),i=setTimeout(()=>{W(!0)},1e3))};return navigator.mediaDevices?.addEventListener("devicechange",n),()=>{i&&clearTimeout(i),navigator.mediaDevices?.removeEventListener("devicechange",n)}},[]);const oe=s.useCallback((i,n)=>{h(a=>({...a,[i]:n})),l[i]&&m(a=>{const y={...a};return delete y[i],y})},[l]),se=s.useCallback(()=>{const i={};return(t?.input_configuration||[]).forEach(a=>{a.required&&!u[a.key]&&(i[a.key]=`${a.label} ist erforderlich`)}),m(i),Object.keys(i).length===0},[t,u]),ae=async()=>{if(se()){v(!0),k(null);try{const i=me(),n=await fetch(`${i}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":J()},body:JSON.stringify({scenario_id:t.id,variables:u,demo_code:re||null})});if(!n.ok)throw new Error("Fehler beim Erstellen der Sitzung");const a=await n.json();if(!a.success||!a.data?.session)throw new Error("Ungültige Antwort beim Erstellen der Sitzung");const y=a.data.session,j=await fetch(`${i}/video-training/sessions/${y.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":J()}});if(!j.ok)throw new Error("Fehler beim Generieren der Fragen");const x=await j.json();if(!x.success||!x.data?.questions)throw new Error("Fehler beim Generieren der Fragen");c({session:x.data.session,questions:x.data.questions,variables:u,selectedMicrophoneId:I,selectedCameraId:d})}catch(i){console.error("[VIDEO TRAINING] Error starting session:",i),k(i.message)}finally{v(!1)}}},X=t?.input_configuration||[];return e.jsxs("div",{style:{padding:"32px",maxWidth:"700px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"14px",padding:"8px 0",marginBottom:"16px"},children:[e.jsx(le,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:z,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ee,{size:28,color:"#fff"})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginBottom:"4px"},children:t?.title}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b"},children:"Konfiguriere deine Wirkungs-Analyse"})]})]})]}),e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{padding:"16px 20px",background:`linear-gradient(135deg, ${f}10 0%, ${f}05 100%)`,borderRadius:"12px",border:`1px solid ${f}20`,marginBottom:"32px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx(A,{size:20,color:f,style:{flexShrink:0,marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px",fontSize:"14px"},children:"So funktioniert es"}),e.jsxs("p",{style:{fontSize:"13px",color:"#64748b",lineHeight:1.5},children:["Die KI generiert ",t?.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),t?.long_description&&e.jsx(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},style:{padding:"20px 24px",borderRadius:"14px",backgroundColor:"white",border:"1px solid #e2e8f0",marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:z,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(A,{style:{width:"20px",height:"20px",color:"white"}})}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",margin:"0 0 8px 0"},children:"Deine Aufgabe"}),e.jsx("p",{style:{fontSize:"14px",lineHeight:"1.6",color:"#475569",margin:0,whiteSpace:"pre-wrap"},children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[e.jsx(B,{size:20,color:f}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Tipps für dein Video-Training"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"16px"},children:(t?.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((i,n)=>typeof i=="string"?{icon:B,title:`Tipp ${n+1}`,description:i}:{icon:Y[i.icon]||Y[i.icon?.toLowerCase()]||B,title:i.title||`Tipp ${n+1}`,description:i.text||i.description||""}):be).map((i,n)=>{const a=i.icon;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",padding:"16px",borderRadius:"12px",backgroundColor:"#f8fafc"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:z,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(a,{style:{width:"18px",height:"18px",color:"#fff"}})}),e.jsxs("div",{children:[e.jsx("h4",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px",marginBottom:"4px"},children:i.title}),e.jsx("p",{style:{fontSize:"13px",color:"#64748b",lineHeight:1.5,margin:0},children:i.description})]})]},n)})})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},style:{background:"#fff",borderRadius:"16px",padding:"28px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"24px"},children:[e.jsx(ne,{size:20,color:f}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Personalisiere dein Training"})]}),X.map(i=>e.jsx(je,{field:i,value:u[i.key],onChange:oe,error:l[i.key],primaryAccent:f},i.key)),X.length===0&&e.jsx("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"Keine zusätzliche Konfiguration erforderlich."})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},style:{background:"#fff",borderRadius:"16px",padding:"28px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"24px"},children:[e.jsx(M,{size:20,color:f}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Kamera & Mikrofon"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(Q,{type:"video",devices:D,selectedDeviceId:d,onDeviceChange:C,isLoading:N,error:G,onRefresh:W,primaryAccent:f,themedGradient:z}),e.jsx(Q,{type:"audio",devices:E,selectedDeviceId:I,onDeviceChange:o,isLoading:N,error:P,onRefresh:W,primaryAccent:f,themedGradient:z})]}),(P||G)&&e.jsxs("p",{style:{fontSize:"13px",color:"#94a3b8",marginTop:"16px",display:"flex",alignItems:"flex-start",gap:"8px"},children:[e.jsx(A,{size:16,style:{flexShrink:0,marginTop:"2px"}}),"Bitte erlaube den Zugriff auf Kamera und Mikrofon in deinen Browser-Einstellungen, um die Geräte nutzen zu können."]})]}),r&&e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",marginBottom:"24px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(_,{size:20,color:"#ef4444"}),e.jsx("p",{style:{color:"#dc2626",fontSize:"14px"},children:r})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#f8fafc",borderRadius:"12px",padding:"20px",marginBottom:"32px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[e.jsx(ie,{size:18,color:f}),e.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px"},children:"Training-Details"})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Fragen"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:t?.question_count||5})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Zeit pro Frage"}),e.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:["~",Math.round((t?.time_limit_per_question||120)/60)," Min."]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Gesamtdauer"}),e.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:["~",Math.round((t?.total_time_limit||900)/60)," Min."]})]})]})]}),e.jsxs(b.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},onClick:ae,disabled:p,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",background:p?"#94a3b8":z,color:"#fff",border:"none",cursor:p?"not-allowed":"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)",transition:"all 0.2s ease"},children:["Video Training starten",e.jsx(ue,{size:20})]}),e.jsx(ye,{isLoading:p,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{Ve as VideoTrainingApp,Ke as VideoTrainingComplete,Le as VideoTrainingDashboard,$e as VideoTrainingSession,Ae as VideoTrainingWizard};
