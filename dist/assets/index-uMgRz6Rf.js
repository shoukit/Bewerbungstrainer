import{j as r,S as j}from"./ui-vendor-BAEfSb-X.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{a as k,D as v}from"./DecisionBoardResult-DnLgolFW.js";import{w as p,c as A,C as x}from"./designTokens-LSOQEIoP.js";import{F as P}from"./index.js";import{u as T,a as _,F as L}from"./useScrollToTop-D1M7Geea.js";import"./card-CRd_k1Xo.js";import"./utils-BEHD0UYf.js";import"./button-C27wFDRr.js";import"./input-B2p07toF.js";import"./textarea-AQGmZicy.js";import"./useBranding-CRmuKfX5.js";import"./AudioRecorder-LFdSK1H4.js";const c={INPUT:"input",RESULT:"result"},ee=({isAuthenticated:m,requireAuth:h,setPendingAction:M,onNavigateToHistory:i})=>{const[y,d]=o.useState(c.INPUT),[I,D]=o.useState(null),[C,u]=o.useState(null),[t,a]=o.useState(null),[N,O]=o.useState(!1),l=o.useRef(!1),B=A(x.teal[500],x.teal[400]);T(m,h),_({dependencies:[y]});const b=o.useCallback(async e=>{if(l.current||!e.topic?.trim())return null;try{const s={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},n=await p.createDecision(s);if(n?.id)return l.current=!0,a(n.id),console.log("[DecisionBoard] Draft session saved with ID:",n.id),n.id}catch(s){console.error("[DecisionBoard] Failed to save draft session:",s)}return null},[]),S=o.useCallback(async(e,s)=>{if(e)try{const n={topic:s.topic,context:s.context||null,pros:s.pros||[],cons:s.cons||[],pro_score:s.proScore||0,contra_score:s.contraScore||0,analysis:s.analysis||null,status:s.status||"completed"};await p.updateDecision(e,n),console.log("[DecisionBoard] Session updated:",e)}catch(n){console.error("[DecisionBoard] Failed to update session:",n)}},[]),w=o.useCallback(async e=>{if(e)try{await p.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(s){console.error("[DecisionBoard] Failed to delete session:",s)}},[]),g=o.useCallback(async(e,s)=>{D(e),u(s),d(c.RESULT);try{if(t)await S(t,{...e,analysis:s,status:"completed"});else{const n={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:s,status:"completed"},f=await p.createDecision(n);f?.id&&(a(f.id),l.current=!0,console.log("[DecisionBoard] Decision saved with ID:",f.id))}}catch(n){console.error("[DecisionBoard] Failed to save decision:",n)}},[t,S]),E=o.useCallback(()=>{D(null),u(null),a(null),l.current=!1,d(c.INPUT)},[]),R=o.useCallback(()=>{u(null),d(c.INPUT)},[]),F=o.useCallback(async()=>{t&&await w(t),D(null),u(null),a(null),l.current=!1,i&&i()},[t,w,i]),U=()=>{switch(y){case c.RESULT:return r.jsx(v,{decisionData:I,analysisResult:C,onStartNew:E,onEditDecision:R});case c.INPUT:default:return r.jsx(k,{initialData:I,onAnalysisComplete:g,onCancel:i?F:null,isAuthenticated:m,requireAuth:h,savedDecisionId:t,onSaveDraft:b,onUpdateSession:S,onDecisionIdChange:a})}};return r.jsxs(r.Fragment,{children:[r.jsx(P,{featureId:"decisionboard",showOnMount:!0}),r.jsxs("div",{style:{minHeight:"100%"},children:[r.jsx(L,{featureId:"decisionboard",icon:j,title:"Entscheidungs-Board",subtitle:"Strukturierte Entscheidungsfindung",gradient:B,historyLabel:"Meine Entscheidungen",onNavigateToHistory:i}),U()]})]})};export{ee as DecisionBoardApp,k as DecisionBoardInput,v as DecisionBoardResult};
