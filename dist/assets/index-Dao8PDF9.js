import{j as e,e as G,i as Et,g as Q,a as $e,l as te,aj as Mt,w as Tt,ak as zt,B as xt,M as ne,y as V,al as je,a1 as pe,E as Te,I as ce,v as ye,f as Ge,x as Ue,C as Ie,af as ze,O as mt,z as we,a7 as Ft,ab as ht,T as pt,_ as He,am as gt,h as Ke,a2 as Rt,L as Qe,a3 as $t,a4 as Je,a5 as It,A as Bt,m as Lt,J as Ot,an as qt,b as bt,X as Dt,q as Pt,a0 as Vt}from"./ui-vendor-BZiLMcnz.js";import{a as s,d as Fe}from"./react-vendor-uDOJF2jQ.js";import{k as Wt,F as Zt,g as Kt,a as Gt,b as de,C as Pe,l as Re,u as ft,w as H,m as Ut}from"./FeatureInfoButton-KkBWzq8f.js";import{S as Ht}from"./ScenarioDashboard-DhbD5C2_.js";import{M as Xe,a as Ye,A as Qt}from"./MicrophoneTestDialog-DwIaRYP1.js";import{C as oe,B as he}from"./select-native-CiFZ8kbq.js";import"./dialog-nVUWt95t.js";import{B as Jt}from"./button-DeLH3L4x.js";import{u as Xt}from"./useMobile-YxjH166V.js";import{P as Yt}from"./progress-bar-5ePVPwrO.js";import{D as es}from"./DeviceSettingsDialog-DL8tP8Fc.js";import{F as jt}from"./fullscreen-loader-CFloo_9Q.js";import{u as ts}from"./Confetti-CJH1AGR3.js";import{D as ss}from"./DynamicFormField-3En-4vA9.js";import"./ScenarioCard-Bc1zQKFL.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./DeviceSetupPage-BAbiebkj.js";const at="[SIMULATOR_DASHBOARD]",ns={briefcase:xt,banknote:zt,user:Tt,presentation:Mt,target:te,mic:G},rs=async()=>{const t=await fetch(`${Kt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Gt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const l=await t.json();if(l.success&&l.data?.scenarios)return l.data.scenarios;throw new Error("Keine Szenarien gefunden")},as=t=>ns[t.icon]||xt,is=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:Q,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],it=({onSelectScenario:t,isAuthenticated:l,requireAuth:a,setPendingScenario:c,onNavigateToHistory:i})=>(s.useEffect(()=>(console.log(`${at} ðŸ”µ MOUNT`),()=>{console.log(`${at} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Wt,{featureId:"simulator",showOnMount:!0}),e.jsx(Ht,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:$e,headerActions:e.jsx(Zt,{featureId:"simulator",size:"sm"}),fetchScenarios:rs,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:i,onSelectScenario:t,renderCardMeta:is,getIconForScenario:as,cardActionLabel:"Starten",cardActionIcon:Et,categoryField:"category",emptyStateIcon:G,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:l,requireAuth:a,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]})),ls=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,lt={target:te,clock:Q,mic:G,"message-square":ne,lightbulb:V,brain:je,info:ce,settings:Te,check:pe,Target:te,Clock:Q,Mic:G,MessageSquare:ne,Lightbulb:V,Brain:je},os=({scenario:t,onBack:l,onNext:a,hasVariables:c=!1})=>{const[i,n]=Fe.useState(null),[N,S]=Fe.useState(!1);de();const p=t?.mode==="SIMULATION",g=p?"Situationen":"Fragen",j=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Q,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t?.time_limit_per_question||120)/60)} Minuten pro ${p?"Situation":"Frage"}. ${p?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ne,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],b=s.useMemo(()=>!t?.tips||!Array.isArray(t.tips)||t.tips.length===0?j:t.tips.map((m,o)=>typeof m=="string"?{icon:V,title:`Tipp ${o+1}`,description:m}:{icon:lt[m.icon]||lt[m.icon?.toLowerCase()]||V,title:m.title||`Tipp ${o+1}`,description:m.text||m.description||""}),[t?.tips,p]),C=()=>{a({selectedMicrophoneId:i})};return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(ye,{size:18}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(V,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Vorbereitung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:t?.title})]})]})]}),t?.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:ls(t.long_description?.replace(/\/n/g,`
`))})]})]})}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:i,onDeviceChange:n,onTestClick:()=>S(!0)})]}),e.jsxs(Jt,{onClick:C,disabled:!i,size:"lg",className:"w-full mb-6 gap-2.5",children:[c?"Weiter zur Konfiguration":"Training starten",e.jsx(Ge,{className:"w-5 h-5"})]}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps fÃ¼r dein GesprÃ¤ch"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise fÃ¼r optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:b.map((m,o)=>{const w=m.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(w,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("div",{className:"pt-0.5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 mb-0.5",children:m.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0",children:m.description})]})]},o)})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:16}),e.jsxs("span",{children:[t?.question_count_min,"-",t?.question_count_max," ",g]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:16}),e.jsxs("span",{children:[Math.round((t?.time_limit_per_question||120)/60)," Min/",p?"Situation":"Frage"]})]})]}),e.jsx(Ye,{isOpen:N,onClose:()=>S(!1),deviceId:i})]})},cs=({field:t,value:l,onChange:a,error:c,focusColor:i,branding:n})=>{const N=i||Pe.blue[400],S="w-full rounded-lg text-base outline-none transition-all",p="px-4 py-3",g=c?"border-2 border-red-500":"border-2 border-slate-200",j={borderColor:N,boxShadow:`0 0 0 3px ${N}1a`},b=o=>{Object.assign(o.target.style,j),setTimeout(()=>{const w=o.target;if(w){const y=w.closest("div");y&&y.scrollIntoView({behavior:"smooth",block:"center"})}},300)},C=o=>{o.target.style.borderColor=c?Pe.red[500]:Pe.slate[200],o.target.style.boxShadow="none"},m=()=>{const o=`${S} ${p} ${g} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:l||"",onChange:w=>a(t.key,w.target.value),placeholder:t.placeholder||"",className:o,onFocus:b,onBlur:C});case"textarea":return e.jsx("textarea",{value:l||"",onChange:w=>a(t.key,w.target.value),placeholder:t.placeholder||"",rows:4,className:`${o} resize-vertical min-h-[100px]`,onFocus:b,onBlur:C});case"select":return e.jsxs("select",{value:l||t.default||"",onChange:w=>a(t.key,w.target.value),className:`${o} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:b,onBlur:C,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.slice().sort((w,y)=>w.label.localeCompare(y.label,"de")).map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))]});case"number":return e.jsx("input",{type:"number",value:l||"",onChange:w=>a(t.key,w.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:o,onFocus:b,onBlur:C});default:return e.jsx("input",{type:"text",value:l||"",onChange:w=>a(t.key,w.target.value),placeholder:t.placeholder||"",className:o,onFocus:b,onBlur:C})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m(),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(we,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),t.hint]})]})},ds=({scenario:t,onBack:l,onNext:a})=>{const[c,i]=s.useState({}),[n,N]=s.useState({}),[S,p]=s.useState([]),[g,j]=s.useState(!1),b=de(),C=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const f=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(f)?f.filter(d=>d.user_input!==!1):[]}catch(f){return console.error("Error parsing input_configuration:",f),[]}},[t?.input_configuration]);s.useEffect(()=>{const f={};C.forEach(d=>{d.default&&(f[d.key]=d.default)}),i(f)},[C]);const m=(f,d)=>{i(r=>({...r,[f]:d})),n[f]&&N(r=>{const _={...r};return delete _[f],_})},o=()=>{p(f=>[...f,{key:"",value:""}])},w=(f,d,r)=>{p(_=>{const $=[..._];return $[f]={...$[f],[d]:r},$})},y=f=>{p(d=>d.filter((r,_)=>_!==f))},T=()=>{const f={};return C.forEach(d=>{const r=c[d.key];if(d.required&&(!r||r.trim()==="")){f[d.key]="Dieses Feld ist erforderlich";return}if(!(!r||r.trim()==="")&&d.validation){const{minLength:_,maxLength:$,min:h,max:k,pattern:E}=d.validation;_&&r.length<_&&(f[d.key]=`Mindestens ${_} Zeichen erforderlich`),$&&r.length>$&&(f[d.key]=`Maximal ${$} Zeichen erlaubt`),h!==void 0&&Number(r)<h&&(f[d.key]=`Mindestens ${h}`),k!==void 0&&Number(r)>k&&(f[d.key]=`Maximal ${k}`),E&&!new RegExp(E).test(r)&&(f[d.key]="UngÃ¼ltiges Format")}}),N(f),Object.keys(f).length===0},W=(f,d)=>{if(f.type!=="select"||!f.options||!d)return null;const r=f.options.find(_=>_.value===d);return r?r.label:d},O=f=>{if(f.preventDefault(),!T())return;const d={...c};S.forEach(r=>{r.key&&r.value&&(d[r.key]=r.value)}),C.forEach(r=>{if(r.type==="select"&&c[r.key]){const _=W(r,c[r.key]);_&&(d[`${r.key}_label`]=_)}}),a(d)};return s.useEffect(()=>{C.length===0&&a({})},[C,a]),C.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:b.headerGradient},children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:O,children:[C.map(f=>e.jsx(cs,{field:f,value:c[f.key],onChange:m,error:n[f.key],focusColor:b.primaryAccent,branding:b},f.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>j(!g),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:g?b.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[g?e.jsx(Ue,{size:18}):e.jsx(Ie,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),g&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),S.length>0&&e.jsx("div",{className:"mb-3",children:S.map((f,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:f.key||"",onChange:r=>w(d,"key",r.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>y(d),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(mt,{size:16})})]}),e.jsx("textarea",{value:f.value||"",onChange:r=>w(d,"value",r.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},d))}),e.jsxs("button",{type:"button",onClick:o,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:b.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(Ge,{className:"w-5 h-5"})]})]})]})},Ee=({score:t,label:l,size:a="normal",variant:c="default"})=>{const i=t!=null?t*10:null,N=(p=>c==="white"?"bg-white/20 border-white text-white":p>=80?"bg-green-50 border-green-500 text-green-600":p>=60?"bg-blue-50 border-blue-500 text-blue-600":p>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(i),S=a==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${S?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${N}
      `,children:e.jsx("span",{className:`
          ${S?"text-3xl":"text-2xl"}
          font-bold
        `,children:i!=null?Math.round(i):"-"})}),e.jsx("span",{className:`
        ${S?"text-sm":"text-xs"}
        ${c==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:l})]})},me=({title:t,icon:l,children:a,defaultOpen:c=!0})=>{const[i,n]=s.useState(c);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(!i),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),i?e.jsx(Ue,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ie,{className:"w-5 h-5 text-slate-400"})]}),i&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:a})]})},Ve=({text:t,type:l})=>{const a={strength:{icon:ht,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:pt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:V,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:c,iconClass:i,bgClass:n}=a[l]||a.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${n} mb-2`,children:[e.jsx(c,{className:`w-5 h-5 ${i} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},us=({metrics:t})=>{if(!t)return null;const a=(i=>{switch(i){case"optimal":return{label:"Optimal",colorClass:"text-green-600"};case"zu_schnell":return{label:"Zu schnell",colorClass:"text-amber-600"};case"zu_langsam":return{label:"Zu langsam",colorClass:"text-amber-600"};default:return{label:i||"N/A",colorClass:"text-slate-400"}}})(t.speech_rate),c=i=>{switch(i){case"niedrig":return"text-green-600";case"mittel":return"text-amber-600";case"hoch":return"text-red-600";default:return"text-slate-400"}};return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Sprechtempo"}),e.jsx("span",{className:`text-lg font-semibold ${a.colorClass}`,children:a.label})]}),t.filler_words&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{className:`text-lg font-semibold ${c(t.filler_words.severity)}`,children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{className:"text-xs font-normal ml-2",children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Selbstbewusstsein"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.confidence_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.confidence_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Klarheit"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.clarity_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.clarity_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2 p-4 rounded-xl bg-blue-50 text-sm text-slate-700 leading-relaxed",children:["ðŸ’¡ ",t.notes]})]})},xs=({audioUrl:t})=>{const l=s.useRef(null),[a,c]=s.useState(!1),[i,n]=s.useState(0),[N,S]=s.useState(0),[p,g]=s.useState(!0),[j,b]=s.useState(null);s.useEffect(()=>{if(!t)return;g(!0),b(null);const y=new Audio;l.current=y,y.preload="auto";const T=()=>{const r=y.duration;r&&isFinite(r)&&r>0&&S(r)},W=()=>{if(T(),g(!1),!isFinite(y.duration)||y.duration===0){const r=y.currentTime;y.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{T(),y.currentTime=r},100)}},O=()=>{g(!1),T()},f=()=>{T()},d=()=>{n(y.currentTime),T()};return y.addEventListener("loadedmetadata",W),y.addEventListener("canplaythrough",O),y.addEventListener("durationchange",f),y.addEventListener("timeupdate",d),y.addEventListener("play",()=>c(!0)),y.addEventListener("pause",()=>c(!1)),y.addEventListener("ended",()=>c(!1)),y.addEventListener("error",()=>{b("Audio nicht verfÃ¼gbar"),g(!1)}),y.src=t,y.load(),()=>{y.pause(),y.src=""}},[t]);const C=()=>{l.current&&(a?l.current.pause():l.current.play())},m=y=>{const T=y.currentTarget.getBoundingClientRect(),W=(y.clientX-T.left)/T.width;l.current&&N>0&&(l.current.currentTime=W*N)},o=y=>{l.current&&(l.current.currentTime=Math.max(0,Math.min(l.current.currentTime+y,N)))};if(!t)return null;if(j)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(we,{size:16})," ",j]});const w=N>0?i/N*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:m,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${w}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>o(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:C,disabled:p,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${p?"cursor-wait opacity-70":"cursor-pointer"}`,children:p?e.jsx(Qe,{size:20,className:"animate-spin"}):a?e.jsx($t,{size:20,fill:"white"}):e.jsx(Je,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>o(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(It,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[Re(i)," / ",Re(N)]})]})},ms=({transcript:t,feedback:l,audioMetrics:a,audioUrl:c,onRetry:i,onNext:n,onComplete:N,isLastQuestion:S,hideButtons:p=!1})=>{const g=typeof l=="string"?JSON.parse(l):l;return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(Ee,{score:g?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:g?.summary||"Deine Antwort wurde analysiert."})]})]}),g?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(Ee,{score:g.scores.content,label:"Inhalt"}),e.jsx(Ee,{score:g.scores.structure,label:"Struktur"}),e.jsx(Ee,{score:g.scores.relevance,label:"Relevanz"})]}),e.jsx(me,{title:"Transkript",icon:ne,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),c&&e.jsx(me,{title:"Deine Aufnahme",icon:Ft,defaultOpen:!0,children:e.jsx(xs,{audioUrl:c})}),g?.strengths?.length>0&&e.jsx(me,{title:"StÃ¤rken",icon:ht,defaultOpen:!0,children:g.strengths.map((j,b)=>e.jsx(Ve,{text:j,type:"strength"},b))}),g?.improvements?.length>0&&e.jsx(me,{title:"Verbesserungen",icon:pt,defaultOpen:!0,children:g.improvements.map((j,b)=>e.jsx(Ve,{text:j,type:"improvement"},b))}),g?.tips?.length>0&&e.jsx(me,{title:"Tipps",icon:V,defaultOpen:!0,children:g.tips.map((j,b)=>e.jsx(Ve,{text:j,type:"tip"},b))}),a&&e.jsx(me,{title:"Sprechanalyse",icon:G,defaultOpen:!0,children:e.jsx(us,{metrics:a})}),!p&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(He,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:S?N:n,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:S?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(Ke,{className:"w-4 h-4"})]})})]})]})},hs=({tips:t,primaryAccent:l,tipsLabel:a,branding:c})=>{const i=de(),n=c||i,[N,S]=s.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>S(!N),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(V,{size:n.iconSize.md,color:l}),a||"Tipps fÃ¼r diese Frage"]}),e.jsx(Ie,{size:n.iconSize.md,color:n.textMuted,style:{transform:N?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx(Bt,{children:N&&e.jsx(Lt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((p,g)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:g<t.length-1?n.space[2]:0},children:[e.jsx(V,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:p.replace(/^Tipp \d+:\s*/i,"")})]},g))})})})]})},ps=({seconds:t,maxSeconds:l,isRecording:a,branding:c})=>{const i=de(),n=c||i,N=l>0?t/l*100:0,S=N>75,p=N>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:p?n.errorLight:S?n.warningLight:n.cardBgHover},children:[e.jsx(Q,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:p?n.error:S?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:p?n.error:S?n.warning:n.textSecondary},children:Re(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",Re(l)]})]})},ot=({onRecordingComplete:t,timeLimit:l,disabled:a,deviceId:c,themedGradient:i,primaryAccent:n,isSubmitting:N,labels:S,onOpenSettings:p,branding:g,isMobile:j,onStreamChange:b})=>{const C=de(),m=g||C,[o,w]=s.useState("idle"),[y,T]=s.useState(0),[W,O]=s.useState(0),[f,d]=s.useState(!1),r=s.useRef(null),_=s.useRef([]),$=s.useRef(null),h=s.useRef(null),k=s.useRef(null),E=s.useRef(null),F=s.useRef(null),u=s.useRef(0),x=s.useRef(!1);s.useEffect(()=>()=>{v()},[]),s.useEffect(()=>{o==="recording"&&y>=l&&J()},[y,l,o]);const v=()=>{$.current&&clearInterval($.current),E.current&&cancelAnimationFrame(E.current),h.current&&(h.current.close(),h.current=null),F.current&&(F.current.getTracks().forEach(z=>z.stop()),F.current=null,b&&b(null))},R=async()=>{try{d(!1),_.current=[],T(0);let z;const M={audio:c?{deviceId:{exact:c}}:!0};try{z=await navigator.mediaDevices.getUserMedia(M)}catch(q){throw console.error("[SIMULATOR] Selected device unavailable:",q),q.name==="OverconstrainedError"||q.name==="NotFoundError"?(d(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):q}F.current=z,b&&b(z),h.current=new(window.AudioContext||window.webkitAudioContext),k.current=h.current.createAnalyser(),h.current.createMediaStreamSource(z).connect(k.current),k.current.fftSize=256;const K=()=>{if(k.current&&x.current){const q=new Uint8Array(k.current.frequencyBinCount);k.current.getByteFrequencyData(q);const U=q.reduce((Ne,Be)=>Ne+Be)/q.length;O(U/255)}E.current=requestAnimationFrame(K)};x.current=!0,K();const ee=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";r.current=new MediaRecorder(z,{mimeType:ee}),r.current.ondataavailable=q=>{q.data.size>0&&_.current.push(q.data)},r.current.onstop=()=>{const q=new Blob(_.current,{type:ee});t(q,u.current)},r.current.start(1e3),w("recording"),$.current=setInterval(()=>{T(q=>q+1)},1e3)}catch(z){console.error("Error starting recording:",z),(z.name==="NotAllowedError"||z.name==="PermissionDeniedError")&&d(!0)}},I=()=>{r.current&&r.current.state==="recording"&&(r.current.pause(),w("paused"),x.current=!1,$.current&&(clearInterval($.current),$.current=null),O(0))},L=()=>{r.current&&r.current.state==="paused"&&(r.current.resume(),w("recording"),x.current=!0,$.current=setInterval(()=>{T(z=>z+1)},1e3))},J=()=>{u.current=y,x.current=!1,$.current&&(clearInterval($.current),$.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),h.current&&(h.current.close(),h.current=null),r.current&&r.current.state!=="inactive"&&r.current.stop(),F.current&&(F.current.getTracks().forEach(z=>z.stop()),F.current=null),w("idle"),O(0),T(0)},se=()=>{o==="idle"?R():o==="recording"?I():o==="paused"&&L()};if(f)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:m.errorLight},children:[e.jsx(Ot,{className:"w-12 h-12 mb-3 mx-auto",style:{color:m.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:m.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:m.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const re=()=>{const z={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:j?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:j?"15px":"16px",fontWeight:600,cursor:a||N?"not-allowed":"pointer",flex:j?1:"none"};return a||N?{...z,background:m.borderColor,boxShadow:"none"}:o==="idle"?{...z,background:m.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:o==="recording"?{...z,background:m.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...z,background:m.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:m.cardBg,border:`1px solid ${m.borderColor}`},children:[j&&e.jsx("button",{onClick:p,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:m.cardBgHover,border:`1px solid ${m.borderColor}`},children:e.jsx(Te,{size:18,style:{color:m.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(ps,{seconds:y,maxSeconds:l,isRecording:o==="recording",branding:m})}),o==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Qt,{audioLevel:W,isActive:!0,variant:"bars",size:"sm",accentColor:n})}),o==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:m.warning},children:[e.jsx(G,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!j&&e.jsx("button",{onClick:p,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:m.cardBgHover,border:`1px solid ${m.borderColor}`},children:e.jsx(Te,{size:20,style:{color:m.textMuted}})}),e.jsxs("button",{onClick:se,disabled:a||N,style:re(),children:[o==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Aufnahme starten"]}),o==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),o==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(o==="recording"||o==="paused")&&e.jsxs("button",{onClick:J,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:j?"14px 16px":"14px 24px",flex:j?1:"none",backgroundColor:m.cardBgHover,color:m.textMain,fontSize:j?"15px":"16px"},children:[e.jsx(pe,{className:"w-[18px] h-[18px]",style:{color:m.success}}),S?.submitButton||"Antwort abgeben"]})]}),o==="idle"&&!N&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:m.textMuted},children:S?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),N&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Qe,{className:"w-8 h-8 animate-spin",style:{color:n}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:m.textSecondary},children:S?.analyzing||"Antwort wird analysiert..."})]})]})},gs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,ct={target:te,clock:Q,mic:G,"message-square":ne,lightbulb:V,brain:je,info:ce,settings:Te,check:pe,Target:te,Clock:Q,Mic:G,MessageSquare:ne,Lightbulb:V,Brain:je},bs=({scenario:t,variables:l,questions:a,onStart:c,onBack:i,selectedMicrophoneId:n,onMicrophoneChange:N,onMicrophoneTest:S,themedGradient:p,primaryAccent:g,primaryAccentLight:j,isLoading:b,branding:C})=>{const m=de(),o=C||m,w=t?.mode==="SIMULATION",y=w?"Situationen":"Fragen",T=w?"Zeit pro Situation":"Zeit pro Frage",W=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Q,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${w?"Situation":"Frage"}. ${w?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ne,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],O=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((h,k)=>typeof h=="string"?{icon:V,title:`Tipp ${k+1}`,description:h}:{icon:ct[h.icon]||ct[h.icon?.toLowerCase()]||V,title:h.title||`Tipp ${k+1}`,description:h.text||h.description||""}):W,{inputConfigLabels:f,selectOptionsMap:d}=s.useMemo(()=>{if(!t?.input_configuration)return{inputConfigLabels:{},selectOptionsMap:{}};try{const h=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;if(!Array.isArray(h))return{inputConfigLabels:{},selectOptionsMap:{}};const k={},E={};return h.forEach(F=>{F.key&&F.label&&(k[F.key]=F.label),F.type==="select"&&F.options&&(E[F.key]=F.options)}),{inputConfigLabels:k,selectOptionsMap:E}}catch{return{inputConfigLabels:{},selectOptionsMap:{}}}},[t?.input_configuration]),r=(h,k)=>{if(h.endsWith("_label"))return null;if(l[`${h}_label`])return l[`${h}_label`];if(d[h]){const E=d[h].find(F=>F.value===k);if(E)return E.label}return k},_=l?Object.entries(l).filter(([h,k])=>h.endsWith("_label")?!1:k&&(typeof k=="string"?k.trim()!=="":!0)).map(([h,k])=>({label:f[h]||h.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),value:r(h,k)})).filter(h=>h.value):[],$=h=>{if(!h||!l)return h;let k=h;return Object.entries(l).forEach(([E,F])=>{F&&(k=k.replace(new RegExp(`\\$\\{${E}\\}`,"g"),F),k=k.replace(new RegExp(`\\{${E}\\}`,"g"),F))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:o.textSecondary},children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:p},children:e.jsx(V,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:o.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:o.textSecondary},children:[t.title,a.length>0?` â€¢ ${a.length} ${y}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:p},children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:o.textMain},children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:o.textSecondary},children:gs($(t.long_description?.replace(/\/n/g,`
`)))})]})]})}),_.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:j},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:g},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:_.map((h,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:h.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:o.textMain},children:h.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px]",style:{color:g}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:n,onDeviceChange:N,onTestClick:S})]}),e.jsxs("button",{onClick:c,disabled:b,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Je,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(V,{className:"w-[22px] h-[22px]",style:{color:o.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:O.map((h,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:o.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:j},children:e.jsx(h.icon,{className:"w-[22px] h-[22px]",style:{color:g}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:o.textMain},children:h.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:o.textSecondary},children:h.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:o.cardBgHover},children:[a.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:y}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:a.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:T}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},fs=({isOpen:t,onClose:l,onConfirm:a,answeredCount:c,totalCount:i,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(bt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),c>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:n.answeredCount(c,i)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",n.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",n.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,js=({isOpen:t,onClose:l,onConfirm:a,answeredCount:c,labels:i})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(we,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",c>0?` (${c} ${i.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,ys=({number:t,size:l="md"})=>{const a={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${a[l]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},We=({question:t,index:l,labels:a,isMobile:c})=>e.jsxs(oe,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(ys,{number:l+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||a.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||a.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(Q,{size:c?14:16}),a.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),dt=({error:t,onRetry:l,isMobile:a})=>e.jsxs("div",{className:`flex flex-col items-center ${a?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(we,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(he,{variant:"danger",size:"sm",onClick:l,className:"mt-3",children:"Erneut versuchen"})]}),ws=({session:t,questions:l,scenario:a,variables:c,preloadedQuestions:i,onSessionCreated:n,onComplete:N,onExit:S,startFromQuestion:p=0,initialMicrophoneId:g,skipPreSession:j=!1})=>{const b=Xt(),[C,m]=s.useState(t),[o,w]=s.useState(l||[]),[y,T]=s.useState(!1),[W,O]=s.useState(null),{demoCode:f,branding:d}=ft(),r=a?.mode==="SIMULATION",_={questionLabel:r?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:r?"Situation":"Frage",questionLoading:r?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:r?"Deine Reaktion...":"Deine Antwort...",submitButton:r?"Reaktion abgeben":"Antwort abgeben",submitHint:r?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:r?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,B)=>r?`Situation ${A} von ${B}`:`Frage ${A} von ${B}`,questionsCount:A=>r?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,B)=>r?`${A} von ${B} Situationen`:`${A} von ${B} Fragen`,tipsLabel:r?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:r?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:r?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:r?"Situationen":"Fragen",recommendedTime:r?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},$=p>0,h=$?Array.from({length:p},(A,B)=>B):[],k=$||j,[E,F]=s.useState(k?"interview":"preparation"),[u,x]=s.useState(p||C?.current_question_index||0),[v,R]=s.useState(null),[I,L]=s.useState(!1),[J,se]=s.useState(!1),[re,z]=s.useState(null),[M,X]=s.useState([]),[K,ee]=s.useState(h),q="karriereheld_selected_microphone",[U,Ne]=s.useState(()=>{if(g)return g;try{return localStorage.getItem(q)||null}catch{return null}}),[Be,ve]=s.useState(!1),[yt,ge]=s.useState(!1),Se=s.useRef(null),ke=s.useCallback(()=>{Se.current&&(Se.current.getTracks().forEach(A=>A.stop()),Se.current=null)},[]),et=s.useCallback(A=>{Se.current=A},[]);s.useEffect(()=>()=>{ke()},[ke]),s.useEffect(()=>{if(U)try{localStorage.setItem(q,U)}catch{}},[U]),s.useEffect(()=>{k&&E==="interview"&&!C&&!y&&(async()=>{T(!0),O(null);try{const B=await H.createSimulatorSession({scenario_id:a.id,variables:c,demo_code:f||null,questions:i||null});if(!B.success)throw new Error(B.message||"Fehler beim Erstellen der Session");const D=B.data.session;let P;if(i&&i.length>0)P=i,await H.updateSimulatorSessionQuestions(D.id,P);else{const Y=await H.generateSimulatorQuestions(D.id);if(!Y.success)throw new Error(Y.message||"Fehler beim Generieren der Fragen");P=Y.data.questions}m({...D,questions_json:P}),w(P),n&&n({session:{...D,questions_json:P},questions:P,selectedMicrophoneId:U})}catch(B){console.error("Error creating session:",B),O(B.message||"Ein Fehler ist aufgetreten")}finally{T(!1)}})()},[k,E,C,y,a,c,f,i,U,n]);const[wt,Le]=s.useState(!1),[Nt,Oe]=s.useState(!1),[Ce,tt]=s.useState(!1),[be,_e]=s.useState(null),[ae,st]=s.useState(!1),ie=o[u],ue=u===o.length-1,nt=u===0,rt=async(A,B)=>{if(B<2){z("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),z("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}se(!0),z(null);try{const D=await H.submitSimulatorAnswer(C.id,A,u,ie.question,ie.category,B);if(!D.success)throw new Error(D.message||"Fehler beim Analysieren der Antwort");if(R(D.data),L(!0),X(P=>[...P.filter(Y=>Y.questionIndex!==u),{questionIndex:u,feedback:D.data}]),ee(P=>P.includes(u)?P:[...P,u]),r&&!ae){tt(!0),_e(null);const P=K.includes(u);try{const Y=await H.generateNextTurn(C.id);if(Y.success){const xe=Y.data.next_question;Y.data.is_finished?(_e(xe),w(P?le=>{const fe=[...le];return fe[u+1]=xe,fe.slice(0,u+2)}:le=>[...le,xe]),st(!0)):(_e(xe),P?(w(le=>{const fe=[...le];return fe[u+1]=xe,fe.slice(0,u+2)}),st(!1)):w(le=>[...le,xe]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{tt(!1)}}}catch(D){console.error("Error submitting answer:",D),z(D.message||"Ein Fehler ist aufgetreten")}finally{se(!1)}},qe=()=>{R(null),L(!1),z(null)},De=()=>{if(R(null),L(!1),z(null),r){if(be){x(A=>A+1),_e(null);return}if(ae){Ae();return}}else ue||x(A=>A+1)},vt=()=>{R(null),L(!1),z(null),nt||x(A=>A-1)},St=()=>{Le(!0)},Ae=async()=>{Le(!1),ge(!1),ve(!1),ke();try{const A=await H.completeSimulatorSession(C.id);A.success?N(A.data):N({session:{...C,status:"completed"}})}catch(A){console.error("Error completing session:",A),N({session:{...C,status:"completed"}})}},kt=()=>{Oe(!0)},Ct=()=>{Oe(!1),ge(!1),ve(!1),ke(),S()},_t=async()=>{if(C&&o.length>0){F("interview");return}T(!0),O(null);try{const A=await H.createSimulatorSession({scenario_id:a.id,variables:c,demo_code:f||null,questions:i||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const B=A.data.session;let D;if(i&&i.length>0)D=i,await H.updateSimulatorSessionQuestions(B.id,D);else{const P=await H.generateSimulatorQuestions(B.id);if(!P.success)throw new Error(P.message||"Fehler beim Generieren der Fragen");D=P.data.questions}m({...B,questions_json:D}),w(D),n&&n({session:{...B,questions_json:D},questions:D,selectedMicrophoneId:U}),F("interview")}catch(A){console.error("Error creating session:",A),O(A.message||"Ein Fehler ist aufgetreten")}finally{T(!1)}};if(E==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(bs,{scenario:a,variables:c,questions:o,onStart:_t,onBack:S,selectedMicrophoneId:U,onMicrophoneChange:Ne,onMicrophoneTest:()=>ve(!0),themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],primaryAccentLight:d?.["--primary-accent-light"],isLoading:y}),e.jsx(Ye,{isOpen:Be,onClose:()=>ve(!1),deviceId:U}),W&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:W}),e.jsx(jt,{isLoading:y,message:r?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const At=I&&(r&&ae&&!be||!r&&ue);return e.jsxs("div",{className:`${b?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${b?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${b?"text-lg":"text-xl"} font-semibold text-slate-900`,children:a?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${b?"justify-between":"justify-end"}`,children:[!At&&e.jsxs("button",{onClick:St,className:`${b?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(bt,{size:16}),b?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:kt,className:`${b?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Dt,{size:16}),"Abbrechen"]})]})]}),e.jsx(fs,{isOpen:wt,onClose:()=>Le(!1),onConfirm:Ae,answeredCount:K.length,totalCount:o.length,labels:_}),e.jsx(js,{isOpen:Nt,onClose:()=>Oe(!1),onConfirm:Ct,answeredCount:K.length,labels:_}),!I&&!r&&e.jsxs("div",{className:`flex ${b?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(he,{variant:"secondary",size:b?"sm":"md",icon:e.jsx(Pt,{size:16}),onClick:vt,disabled:nt,className:b?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(he,{variant:"secondary",size:b?"sm":"md",iconPosition:"right",icon:e.jsx(Ke,{size:16}),onClick:De,disabled:ue,className:b?"flex-1":"",children:b?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Yt,{current:u,total:o.length,answeredQuestions:K,primaryAccent:d?.["--primary-accent"],labels:_}),I?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[a.allow_retry&&e.jsx(he,{variant:"secondary",icon:e.jsx(He,{size:16}),onClick:qe,children:"Nochmal versuchen"}),e.jsxs(he,{onClick:r?ae&&!be?Ae:De:ue?Ae:De,disabled:r&&Ce&&!ae,icon:Ce?e.jsx(Qe,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[r&&Ce&&!ae?"GesprÃ¤chspartner tippt...":r?ae&&!be?"Training abschlieÃŸen":_.nextButton:ue?"Training abschlieÃŸen":_.nextButton,!Ce&&!(r?ae&&!be:ue)&&e.jsx(Ke,{size:16,className:"ml-1"})]})]}),e.jsx(We,{question:ie,index:u,labels:_,isMobile:b}),e.jsx("div",{className:"mt-4",children:e.jsx(ms,{transcript:v.transcript,feedback:v.feedback,audioMetrics:v.audio_analysis,audioUrl:v.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${b?"gap-4":"gap-6"}`,children:[b?e.jsxs(e.Fragment,{children:[e.jsx(We,{question:ie,index:u,labels:_,isMobile:!0}),e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:J,labels:_,onOpenSettings:()=>ge(!0),isMobile:!0,onStreamChange:et}),re&&e.jsx(dt,{error:re,onRetry:qe,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:J,labels:_,onOpenSettings:()=>ge(!0),isMobile:!1,onStreamChange:et}),re&&e.jsx(dt,{error:re,onRetry:qe,isMobile:!1})]}),e.jsx(We,{question:ie,index:u,labels:_,isMobile:!1})]}),ie?.tips&&ie.tips.length>0&&e.jsx(hs,{tips:ie.tips,primaryAccent:d?.["--primary-accent"],tipsLabel:_.tipsLabel})]}),e.jsx(es,{isOpen:yt,onClose:()=>ge(!1),mode:"audio",selectedMicrophoneId:U,onMicrophoneChange:Ne})]})},Me=({score:t,label:l,primaryAccent:a,b:c})=>{const i=t!=null?t*10:null,n=Ut(i,a);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:n},children:i!=null?Math.round(i):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:l})]})},Ze=({icon:t,value:l,label:a,primaryAccent:c,b:i})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:c}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:l}),e.jsx("div",{className:"text-xs text-slate-500",children:a})]})]}),Ns=({session:t,scenario:l,onBackToDashboard:a,onStartNew:c})=>{const i=de(),{triggerConfetti:n,ConfettiComponent:N}=ts(),S=t.summary_feedback||t.summary_feedback_json,p=S?typeof S=="string"?JSON.parse(S):S:null,g=t.overall_score||p?.overall_score||0,j=g<=10?g*10:g,C=(m=>m>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:m>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:m>=70?{text:"Gut!",emoji:"ðŸ‘"}:m>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:m>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(j);return s.useEffect(()=>{j>=70&&n()},[j,n]),e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:i.headerGradient,boxShadow:`0 8px 24px ${i.primaryAccent}4d`},children:e.jsx(gt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",C.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[l?.title||"Skill Training"," - ",C.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${i.primaryAccent}`,backgroundColor:i.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:i.primaryAccent},children:j?Math.round(j):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:j?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(Ze,{icon:pe,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ze,{icon:te,value:p?.average_content_score?Math.round(p.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ze,{icon:Vt,value:p?.average_delivery_score?Math.round(p.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),p?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Me,{score:p.scores.content,label:"Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Me,{score:p.scores.structure,label:"Struktur",primaryAccent:i.primaryAccent,b:i}),e.jsx(Me,{score:p.scores.relevance,label:"Relevanz",primaryAccent:i.primaryAccent,b:i}),e.jsx(Me,{score:p.scores.delivery,label:"PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),p?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:p.summary})]}),p?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:p.key_takeaways.map((m,o)=>e.jsx("li",{className:"mb-2",children:m},o))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(He,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})]})},Z={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Vs=({isAuthenticated:t,requireAuth:l,setPendingAction:a,pendingContinueSession:c,clearPendingContinueSession:i,pendingRepeatSession:n,clearPendingRepeatSession:N,onNavigateToHistory:S})=>{const[p,g]=s.useState(Z.DASHBOARD),[j,b]=s.useState(null),[C,m]=s.useState(null),[o,w]=s.useState([]),[y,T]=s.useState({}),[W,O]=s.useState(null),[f,d]=s.useState(null),[r,_]=s.useState(null),[$,h]=s.useState(0),[k,E]=s.useState(!1),F=s.useMemo(()=>{if(!j?.input_configuration)return!1;try{const M=typeof j.input_configuration=="string"?JSON.parse(j.input_configuration):j.input_configuration;return Array.isArray(M)?M.filter(X=>X.user_input!==!1).length>0:!1}catch{return!1}},[j?.input_configuration]);s.useEffect(()=>{r&&t&&(b(r),g(Z.PREPARATION),_(null))},[r,t]),s.useEffect(()=>{if(c&&t){const{session:M,scenario:X}=c,K=M.questions||M.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[],q=M.completed_questions||M.answered_count||0;b(X||{id:M.scenario_id,title:M.scenario_title}),m(M),w(ee),T({}),h(q),E(!0),g(Z.SESSION),i&&i()}},[c,t,i]),s.useEffect(()=>{if(n&&t){const{session:M,scenario:X}=n,K=M.questions||M.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[];b(X||{id:M.scenario_id,title:M.scenario_title}),w(ee),T({}),h(0),g(Z.PREPARATION),N&&N()}},[n,t,N]),s.useEffect(()=>{window.scrollTo(0,0)},[p]);const u=s.useCallback(M=>{b(M),g(Z.PREPARATION)},[]),x=s.useCallback(()=>{b(null),m(null),w([]),T({}),O(null),h(0),d(null),E(!1),g(Z.DASHBOARD)},[]),v=s.useCallback(M=>{if(d(M.selectedMicrophoneId),j?.input_configuration){const X=typeof j.input_configuration=="string"?JSON.parse(j.input_configuration):j.input_configuration;if(Array.isArray(X)&&X.filter(ee=>ee.user_input!==!1).length>0){g(Z.VARIABLES);return}}E(!0),g(Z.SESSION)},[j]),R=s.useCallback(()=>{g(Z.PREPARATION)},[]),I=s.useCallback(M=>{T(M),E(!0),g(Z.SESSION)},[]),L=s.useCallback(M=>{m(M.session),w(M.questions),M.selectedMicrophoneId&&d(M.selectedMicrophoneId)},[]),J=s.useCallback(M=>{O(M.session),g(Z.COMPLETE)},[]),se=s.useCallback(()=>{x()},[x]),re=s.useCallback(()=>{m(null),w([]),O(null),h(0),d(null),E(!1),g(Z.PREPARATION)},[]),z=()=>{switch(p){case Z.DASHBOARD:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:l,setPendingScenario:_,onNavigateToHistory:S});case Z.PREPARATION:return e.jsx(os,{scenario:j,onBack:x,onNext:v,hasVariables:F});case Z.VARIABLES:return e.jsx(ds,{scenario:j,onBack:R,onNext:I});case Z.SESSION:return e.jsx(ws,{session:C,questions:o,scenario:j,variables:y,preloadedQuestions:o.length>0?o:null,onSessionCreated:L,onComplete:J,onExit:se,startFromQuestion:$,initialMicrophoneId:f,skipPreSession:k});case Z.COMPLETE:return e.jsx(Ns,{session:W,scenario:j,onBackToDashboard:x,onStartNew:re});default:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:l,setPendingScenario:_,onNavigateToHistory:S})}};return e.jsx("div",{className:"min-h-full",children:z()})},vs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,c)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},c):a):null,ut={target:te,clock:Q,mic:G,"message-square":ne,lightbulb:V,brain:je,info:ce,check:pe,sparkles:$e},Ss=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:Q,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:G,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Ws=({scenario:t,onBack:l,onStart:a,preloadedQuestions:c})=>{const[i,n]=s.useState({}),[N,S]=s.useState({}),[p,g]=s.useState(!1),[j,b]=s.useState(null),[C,m]=s.useState(null),[o,w]=s.useState(!1),[y,T]=s.useState([]),[W,O]=s.useState(!1),{demoCode:f}=ft(),d=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const u=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(u)?u.filter(x=>x.user_input!==!1):[]}catch(u){return console.error("Error parsing input_configuration:",u),[]}},[t?.input_configuration]);s.useEffect(()=>{const u={};d.forEach(x=>{x.default&&(u[x.key]=x.default)}),n(u)},[d]);const r=(u,x)=>{if(!u)return u;let v=u;return Object.entries(x||{}).forEach(([R,I])=>{I&&(v=v.replace(new RegExp(`\\$\\{${R}\\}`,"g"),I),v=v.replace(new RegExp(`\\{${R}\\}`,"g"),I))}),v},_=(u,x)=>{n(v=>({...v,[u]:x})),N[u]&&S(v=>{const R={...v};return delete R[u],R})},$=()=>{T(u=>[...u,{key:"",value:""}])},h=(u,x,v)=>{T(R=>{const I=[...R];return I[u]={...I[u],[x]:v},I})},k=u=>{T(x=>x.filter((v,R)=>R!==u))},E=()=>{const u={};return d.forEach(x=>{const v=i[x.key];if(x.required&&(!v||v.trim()==="")){u[x.key]="Dieses Feld ist erforderlich";return}if(!(!v||v.trim()==="")&&x.validation){const{minLength:R,maxLength:I,min:L,max:J,pattern:se}=x.validation;R&&v.length<R&&(u[x.key]=`Mindestens ${R} Zeichen erforderlich`),I&&v.length>I&&(u[x.key]=`Maximal ${I} Zeichen erlaubt`),L!==void 0&&Number(v)<L&&(u[x.key]=`Mindestens ${L}`),J!==void 0&&Number(v)>J&&(u[x.key]=`Maximal ${J}`),se&&!new RegExp(se).test(v)&&(u[x.key]="UngÃ¼ltiges Format")}}),S(u),Object.keys(u).length===0},F=async u=>{if(u.preventDefault(),b(null),!!E()){g(!0);try{const x={...i};y.forEach(L=>{L.key&&L.value&&(x[L.key]=L.value)});const v=await H.createSimulatorSession({scenario_id:t.id,variables:x,demo_code:f||null,questions:c||null});if(!v.success)throw new Error(v.message||"Fehler beim Erstellen der Session");const R=v.data.session;let I;if(c&&c.length>0)I=c,await H.updateSimulatorSessionQuestions(R.id,I);else{const L=await H.generateSimulatorQuestions(R.id);if(!L.success)throw new Error(L.message||"Fehler beim Generieren der Fragen");I=L.data.questions}a({session:{...R,questions_json:I},questions:I,scenario:t,variables:x,selectedMicrophoneId:C})}catch(x){console.error("Error starting session:",x),b(x.message||"Ein Fehler ist aufgetreten")}finally{g(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx($e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:vs(r(t.long_description?.replace(/\/n/g,`
`),i))})]})]})}),(()=>{const u=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((x,v)=>typeof x=="string"?{icon:V,title:`Tipp ${v+1}`,description:x}:{icon:ut[x.icon]||ut[x.icon?.toLowerCase()]||V,title:x.title||`Tipp ${v+1}`,description:x.text||x.description||""}):Ss;return e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:u.map((x,v)=>{const R=x.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:x.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:x.description})]})]},v)})})]})})(),e.jsxs("form",{onSubmit:F,children:[d.length>0?d.map(u=>e.jsx(ss,{field:u,value:i[u.key],onChange:_,error:N[u.key]},u.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(pe,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>O(!W),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${W?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[W?e.jsx(Ue,{size:18}):e.jsx(Ie,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),W&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),y.length>0&&e.jsx("div",{className:"mb-3",children:y.map((u,x)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:u.key||"",onChange:v=>h(x,"key",v.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>k(x),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(mt,{size:18})})]}),e.jsx("textarea",{value:u.value||"",onChange:v=>h(x,"value",v.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},x))}),e.jsxs("button",{type:"button",onClick:$,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(oe,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Xe,{selectedDeviceId:C,onDeviceChange:m,onTestClick:()=>w(!0)})]}),j&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),j]}),e.jsx(he,{type:"submit",disabled:p,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(Ge,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(Ye,{isOpen:o,onClose:()=>w(!1),deviceId:C}),e.jsx(jt,{isLoading:p,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{js as CancelConfirmDialog,fs as CompleteConfirmDialog,ms as ImmediateFeedback,bs as PreSessionView,hs as QuestionTips,Ns as SessionComplete,ps as SessionTimer,Vs as SimulatorApp,ot as SimulatorAudioRecorder,it as SimulatorDashboard,ws as SimulatorSession,Ws as SimulatorWizard};
