import{j as e,e as G,i as Tt,g as Y,a as Ie,l as te,ap as Et,w as Mt,aq as zt,B as mt,M as ie,y as W,ar as je,a1 as he,E as Me,I as ce,v as ye,f as Ge,x as Ue,C as $e,al as ze,O as xt,z as we,a7 as Rt,ab as ht,T as pt,_ as He,ag as gt,h as Ke,a2 as Ft,L as Qe,a3 as It,a4 as Je,a5 as $t,A as Bt,m as Ot,J as Lt,as as Dt,b as bt,X as Pt,q as qt,a0 as Vt}from"./ui-vendor-Mj2_BHwd.js";import{a as s,d as Re}from"./react-vendor-uDOJF2jQ.js";import{k as Wt,F as Zt,g as Kt,a as Gt,b as pe,C as qe,l as Fe,u as ft,w as H,m as Ut}from"./FeatureInfoButton-CmzxY1Ui.js";import{S as Ht}from"./ScenarioDashboard-CkrE9pLw.js";import{M as Xe,a as Ye,A as Qt}from"./MicrophoneTestDialog-HXRqarTW.js";import{C as oe,B as xe}from"./select-native-BCoWFCMQ.js";import"./dialog-DNcIzlLr.js";import{B as Jt}from"./button-aST1fZsy.js";import{u as Xt}from"./useMobile-YxjH166V.js";import{n as Yt,h as es,A as ts}from"./audioMetricsAdapter-BAupHAAX.js";import{P as ss}from"./progress-bar-8cu-jki7.js";import{D as ns}from"./DeviceSettingsDialog-CEGK6wHO.js";import{F as jt}from"./fullscreen-loader-Bo9ovZS3.js";import{u as rs}from"./Confetti-Bk9-L6q2.js";import{D as as}from"./DynamicFormField-CRXhbWvw.js";import"./ScenarioCard-BuOF_cVh.js";import"./utils-09jiQjc0.js";import"./index-CXo7hDKg.js";import"./DeviceSetupPage-BeEmVlVS.js";const at="[SIMULATOR_DASHBOARD]",is={briefcase:mt,banknote:zt,user:Mt,presentation:Et,target:te,mic:G},ls=async()=>{const t=await fetch(`${Kt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Gt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const c=await t.json();if(c.success&&c.data?.scenarios)return c.data.scenarios;throw new Error("Keine Szenarien gefunden")},os=t=>is[t.icon]||mt,cs=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:Y,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],it=({onSelectScenario:t,isAuthenticated:c,requireAuth:a,setPendingScenario:o,onNavigateToHistory:l})=>(s.useEffect(()=>(console.log(`${at} ðŸ”µ MOUNT`),()=>{console.log(`${at} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Wt,{featureId:"simulator",showOnMount:!0}),e.jsx(Ht,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ie,headerActions:e.jsx(Zt,{featureId:"simulator",size:"sm"}),fetchScenarios:ls,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:l,onSelectScenario:t,renderCardMeta:cs,getIconForScenario:os,cardActionLabel:"Starten",cardActionIcon:Tt,categoryField:"category",emptyStateIcon:G,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:c,requireAuth:a,setPendingScenario:o,loadingMessage:"Szenarien werden geladen..."})]})),ds=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,o)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},o):a):null,lt={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:W,brain:je,info:ce,settings:Me,check:he,Target:te,Clock:Y,Mic:G,MessageSquare:ie,Lightbulb:W,Brain:je},us=({scenario:t,onBack:c,onNext:a,hasVariables:o=!1})=>{const[l,n]=Re.useState(null),[N,S]=Re.useState(!1),p=t?.mode==="SIMULATION",w=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Y,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t?.time_limit_per_question||120)/60)} Minuten pro ${p?"Situation":"Frage"}. ${p?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ie,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],x=s.useMemo(()=>!t?.tips||!Array.isArray(t.tips)||t.tips.length===0?w:t.tips.map((j,g)=>typeof j=="string"?{icon:W,title:`Tipp ${g+1}`,description:j}:{icon:lt[j.icon]||lt[j.icon?.toLowerCase()]||W,title:j.title||`Tipp ${g+1}`,description:j.text||j.description||""}),[t?.tips,p]),y=()=>{a({selectedMicrophoneId:l})};return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(ye,{size:18}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(W,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Vorbereitung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:t?.title})]})]})]}),t?.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:ds(t.long_description?.replace(/\/n/g,`
`))})]})]})}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(W,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps fÃ¼r dein GesprÃ¤ch"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise fÃ¼r optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:x.map((j,g)=>{const i=j.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(i,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("div",{className:"pt-0.5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 mb-0.5",children:j.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0",children:j.description})]})]},g)})})]}),e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:l,onDeviceChange:n,onTestClick:()=>S(!0)})]}),e.jsxs(Jt,{onClick:y,disabled:!l,size:"lg",className:"w-full gap-2.5",children:[o?"Weiter zur Konfiguration":"Training starten",e.jsx(Ge,{className:"w-5 h-5"})]}),e.jsx(Ye,{isOpen:N,onClose:()=>S(!1),deviceId:l})]})},ms=({field:t,value:c,onChange:a,error:o,focusColor:l,branding:n})=>{const N=l||qe.blue[400],S="w-full rounded-lg text-base outline-none transition-all",p="px-4 py-3",w=o?"border-2 border-red-500":"border-2 border-slate-200",x={borderColor:N,boxShadow:`0 0 0 3px ${N}1a`},y=i=>{Object.assign(i.target.style,x),setTimeout(()=>{const f=i.target;if(f){const F=f.closest("div");F&&F.scrollIntoView({behavior:"smooth",block:"center"})}},300)},j=i=>{i.target.style.borderColor=o?qe.red[500]:qe.slate[200],i.target.style.boxShadow="none"},g=()=>{const i=`${S} ${p} ${w} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:c||"",onChange:f=>a(t.key,f.target.value),placeholder:t.placeholder||"",className:i,onFocus:y,onBlur:j});case"textarea":return e.jsx("textarea",{value:c||"",onChange:f=>a(t.key,f.target.value),placeholder:t.placeholder||"",rows:4,className:`${i} resize-vertical min-h-[100px]`,onFocus:y,onBlur:j});case"select":return e.jsxs("select",{value:c||t.default||"",onChange:f=>a(t.key,f.target.value),className:`${i} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:y,onBlur:j,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.slice().sort((f,F)=>f.label.localeCompare(F.label,"de")).map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))]});case"number":return e.jsx("input",{type:"number",value:c||"",onChange:f=>a(t.key,f.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:i,onFocus:y,onBlur:j});default:return e.jsx("input",{type:"text",value:c||"",onChange:f=>a(t.key,f.target.value),placeholder:t.placeholder||"",className:i,onFocus:y,onBlur:j})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),g(),o&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(we,{className:"w-3.5 h-3.5"}),o]}),t.hint&&!o&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),t.hint]})]})},xs=({scenario:t,onBack:c,onNext:a})=>{const[o,l]=s.useState({}),[n,N]=s.useState({}),[S,p]=s.useState([]),[w,x]=s.useState(!1),y=pe(),j=Re.useMemo(()=>{if(!t?.input_configuration)return[];try{const b=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(b)?b.filter(d=>d.user_input!==!1):[]}catch(b){return console.error("Error parsing input_configuration:",b),[]}},[t?.input_configuration]);s.useEffect(()=>{const b={};j.forEach(d=>{d.default&&(b[d.key]=d.default)}),l(b)},[j]);const g=(b,d)=>{l(r=>({...r,[b]:d})),n[b]&&N(r=>{const A={...r};return delete A[b],A})},i=()=>{p(b=>[...b,{key:"",value:""}])},f=(b,d,r)=>{p(A=>{const T=[...A];return T[b]={...T[b],[d]:r},T})},F=b=>{p(d=>d.filter((r,A)=>A!==b))},O=()=>{const b={};return j.forEach(d=>{const r=o[d.key];if(d.required&&(!r||r.trim()==="")){b[d.key]="Dieses Feld ist erforderlich";return}if(!(!r||r.trim()==="")&&d.validation){const{minLength:A,maxLength:T,min:h,max:k,pattern:E}=d.validation;A&&r.length<A&&(b[d.key]=`Mindestens ${A} Zeichen erforderlich`),T&&r.length>T&&(b[d.key]=`Maximal ${T} Zeichen erlaubt`),h!==void 0&&Number(r)<h&&(b[d.key]=`Mindestens ${h}`),k!==void 0&&Number(r)>k&&(b[d.key]=`Maximal ${k}`),E&&!new RegExp(E).test(r)&&(b[d.key]="UngÃ¼ltiges Format")}}),N(b),Object.keys(b).length===0},C=(b,d)=>{if(b.type!=="select"||!b.options||!d)return null;const r=b.options.find(A=>A.value===d);return r?r.label:d},$=b=>{if(b.preventDefault(),!O())return;const d={...o};S.forEach(r=>{r.key&&r.value&&(d[r.key]=r.value)}),j.forEach(r=>{if(r.type==="select"&&o[r.key]){const A=C(r,o[r.key]);A&&(d[`${r.key}_label`]=A)}}),a(d)};return s.useEffect(()=>{j.length===0&&a({})},[j,a]),j.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:y.headerGradient},children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:$,children:[j.map(b=>e.jsx(ms,{field:b,value:o[b.key],onChange:g,error:n[b.key],focusColor:y.primaryAccent,branding:y},b.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>x(!w),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:w?y.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[w?e.jsx(Ue,{size:18}):e.jsx($e,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),w&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),S.length>0&&e.jsx("div",{className:"mb-3",children:S.map((b,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:b.key||"",onChange:r=>f(d,"key",r.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>F(d),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(xt,{size:16})})]}),e.jsx("textarea",{value:b.value||"",onChange:r=>f(d,"value",r.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},d))}),e.jsxs("button",{type:"button",onClick:i,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(Ge,{className:"w-5 h-5"})]})]})]})},Te=({score:t,label:c,size:a="normal",variant:o="default"})=>{const l=t!=null?t*10:null,N=(p=>o==="white"?"bg-white/20 border-white text-white":p>=80?"bg-green-50 border-green-500 text-green-600":p>=60?"bg-blue-50 border-blue-500 text-blue-600":p>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(l),S=a==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${S?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${N}
      `,children:e.jsx("span",{className:`
          ${S?"text-3xl":"text-2xl"}
          font-bold
        `,children:l!=null?Math.round(l):"-"})}),e.jsx("span",{className:`
        ${S?"text-sm":"text-xs"}
        ${o==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:c})]})},me=({title:t,icon:c,children:a,defaultOpen:o=!0})=>{const[l,n]=s.useState(o);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(!l),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),l?e.jsx(Ue,{className:"w-5 h-5 text-slate-400"}):e.jsx($e,{className:"w-5 h-5 text-slate-400"})]}),l&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:a})]})},Ve=({text:t,type:c})=>{const a={strength:{icon:ht,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:pt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:W,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:o,iconClass:l,bgClass:n}=a[c]||a.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${n} mb-2`,children:[e.jsx(o,{className:`w-5 h-5 ${l} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},hs=({audioUrl:t,externalAudioRef:c})=>{const a=s.useRef(null),o=c||a,[l,n]=s.useState(!1),[N,S]=s.useState(0),[p,w]=s.useState(0),[x,y]=s.useState(!0),[j,g]=s.useState(null);s.useEffect(()=>{if(!t)return;y(!0),g(null);const C=new Audio;o.current=C,C.preload="auto";const $=()=>{const T=C.duration;T&&isFinite(T)&&T>0&&w(T)},b=()=>{if($(),y(!1),!isFinite(C.duration)||C.duration===0){const T=C.currentTime;C.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{$(),C.currentTime=T},100)}},d=()=>{y(!1),$()},r=()=>{$()},A=()=>{S(C.currentTime),$()};return C.addEventListener("loadedmetadata",b),C.addEventListener("canplaythrough",d),C.addEventListener("durationchange",r),C.addEventListener("timeupdate",A),C.addEventListener("play",()=>n(!0)),C.addEventListener("pause",()=>n(!1)),C.addEventListener("ended",()=>n(!1)),C.addEventListener("error",()=>{g("Audio nicht verfÃ¼gbar"),y(!1)}),C.src=t,C.load(),()=>{C.pause(),C.src=""}},[t]);const i=()=>{o.current&&(l?o.current.pause():o.current.play())},f=C=>{const $=C.currentTarget.getBoundingClientRect(),b=(C.clientX-$.left)/$.width;o.current&&p>0&&(o.current.currentTime=b*p)},F=C=>{o.current&&(o.current.currentTime=Math.max(0,Math.min(o.current.currentTime+C,p)))};if(!t)return null;if(j)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(we,{size:16})," ",j]});const O=p>0?N/p*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:f,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${O}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>F(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Ft,{size:20})}),e.jsx("button",{onClick:i,disabled:x,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${x?"cursor-wait opacity-70":"cursor-pointer"}`,children:x?e.jsx(Qe,{size:20,className:"animate-spin"}):l?e.jsx(It,{size:20,fill:"white"}):e.jsx(Je,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>F(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx($t,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[Fe(N)," / ",Fe(p)]})]})},ps=({transcript:t,feedback:c,audioMetrics:a,audioUrl:o,onRetry:l,onNext:n,onComplete:N,isLastQuestion:S,hideButtons:p=!1})=>{const w=s.useRef(null),x=typeof c=="string"?JSON.parse(c):c,y=s.useMemo(()=>Yt(a),[a]),j=es(a),g=i=>{w.current&&(w.current.currentTime=i,w.current.play())};return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(Te,{score:x?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:x?.summary||"Deine Antwort wurde analysiert."})]})]}),x?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(Te,{score:x.scores.content,label:"Inhalt"}),e.jsx(Te,{score:x.scores.structure,label:"Struktur"}),e.jsx(Te,{score:x.scores.relevance,label:"Relevanz"})]}),e.jsx(me,{title:"Transkript",icon:ie,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),o&&e.jsx(me,{title:"Deine Aufnahme",icon:Rt,defaultOpen:!0,children:e.jsx(hs,{audioUrl:o,externalAudioRef:w})}),x?.strengths?.length>0&&e.jsx(me,{title:"StÃ¤rken",icon:ht,defaultOpen:!0,children:x.strengths.map((i,f)=>e.jsx(Ve,{text:i,type:"strength"},f))}),x?.improvements?.length>0&&e.jsx(me,{title:"Verbesserungen",icon:pt,defaultOpen:!0,children:x.improvements.map((i,f)=>e.jsx(Ve,{text:i,type:"improvement"},f))}),x?.tips?.length>0&&e.jsx(me,{title:"Tipps",icon:W,defaultOpen:!0,children:x.tips.map((i,f)=>e.jsx(Ve,{text:i,type:"tip"},f))}),j&&e.jsx(me,{title:"Sprechanalyse",icon:G,defaultOpen:!0,children:e.jsx(ts,{audioAnalysis:y,onJumpToTimestamp:g})}),!p&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[l&&e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(He,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:S?N:n,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:S?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(Ke,{className:"w-4 h-4"})]})})]})]})},gs=({tips:t,primaryAccent:c,tipsLabel:a,branding:o})=>{const l=pe(),n=o||l,[N,S]=s.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>S(!N),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(W,{size:n.iconSize.md,color:c}),a||"Tipps fÃ¼r diese Frage"]}),e.jsx($e,{size:n.iconSize.md,color:n.textMuted,style:{transform:N?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx(Bt,{children:N&&e.jsx(Ot.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((p,w)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:w<t.length-1?n.space[2]:0},children:[e.jsx(W,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:p.replace(/^Tipp \d+:\s*/i,"")})]},w))})})})]})},bs=({seconds:t,maxSeconds:c,isRecording:a,branding:o})=>{const l=pe(),n=o||l,N=c>0?t/c*100:0,S=N>75,p=N>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:p?n.errorLight:S?n.warningLight:n.cardBgHover},children:[e.jsx(Y,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:p?n.error:S?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:p?n.error:S?n.warning:n.textSecondary},children:Fe(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",Fe(c)]})]})},ot=({onRecordingComplete:t,timeLimit:c,disabled:a,deviceId:o,themedGradient:l,primaryAccent:n,isSubmitting:N,labels:S,onOpenSettings:p,branding:w,isMobile:x,onStreamChange:y})=>{const j=pe(),g=w||j,[i,f]=s.useState("idle"),[F,O]=s.useState(0),[C,$]=s.useState(0),[b,d]=s.useState(!1),r=s.useRef(null),A=s.useRef([]),T=s.useRef(null),h=s.useRef(null),k=s.useRef(null),E=s.useRef(null),R=s.useRef(null),u=s.useRef(0),m=s.useRef(!1);s.useEffect(()=>()=>{v()},[]),s.useEffect(()=>{i==="recording"&&F>=c&&Q()},[F,c,i]);const v=()=>{T.current&&clearInterval(T.current),E.current&&cancelAnimationFrame(E.current),h.current&&(h.current.close(),h.current=null),R.current&&(R.current.getTracks().forEach(z=>z.stop()),R.current=null,y&&y(null))},I=async()=>{try{d(!1),A.current=[],O(0);let z;const M={audio:o?{deviceId:{exact:o}}:!0};try{z=await navigator.mediaDevices.getUserMedia(M)}catch(P){throw console.error("[SIMULATOR] Selected device unavailable:",P),P.name==="OverconstrainedError"||P.name==="NotFoundError"?(d(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):P}R.current=z,y&&y(z),h.current=new(window.AudioContext||window.webkitAudioContext),k.current=h.current.createAnalyser(),h.current.createMediaStreamSource(z).connect(k.current),k.current.fftSize=256;const K=()=>{if(k.current&&m.current){const P=new Uint8Array(k.current.frequencyBinCount);k.current.getByteFrequencyData(P);const U=P.reduce((Ne,Be)=>Ne+Be)/P.length;$(U/255)}E.current=requestAnimationFrame(K)};m.current=!0,K();const ee=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";r.current=new MediaRecorder(z,{mimeType:ee}),r.current.ondataavailable=P=>{P.data.size>0&&A.current.push(P.data)},r.current.onstop=()=>{const P=new Blob(A.current,{type:ee});t(P,u.current)},r.current.start(1e3),f("recording"),T.current=setInterval(()=>{O(P=>P+1)},1e3)}catch(z){console.error("Error starting recording:",z),(z.name==="NotAllowedError"||z.name==="PermissionDeniedError")&&d(!0)}},B=()=>{r.current&&r.current.state==="recording"&&(r.current.pause(),f("paused"),m.current=!1,T.current&&(clearInterval(T.current),T.current=null),$(0))},D=()=>{r.current&&r.current.state==="paused"&&(r.current.resume(),f("recording"),m.current=!0,T.current=setInterval(()=>{O(z=>z+1)},1e3))},Q=()=>{u.current=F,m.current=!1,T.current&&(clearInterval(T.current),T.current=null),E.current&&(cancelAnimationFrame(E.current),E.current=null),h.current&&(h.current.close(),h.current=null),r.current&&r.current.state!=="inactive"&&r.current.stop(),R.current&&(R.current.getTracks().forEach(z=>z.stop()),R.current=null),f("idle"),$(0),O(0)},se=()=>{i==="idle"?I():i==="recording"?B():i==="paused"&&D()};if(b)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:g.errorLight},children:[e.jsx(Lt,{className:"w-12 h-12 mb-3 mx-auto",style:{color:g.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:g.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:g.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const ne=()=>{const z={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:x?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:x?"15px":"16px",fontWeight:600,cursor:a||N?"not-allowed":"pointer",flex:x?1:"none"};return a||N?{...z,background:g.borderColor,boxShadow:"none"}:i==="idle"?{...z,background:g.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:i==="recording"?{...z,background:g.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...z,background:g.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:g.cardBg,border:`1px solid ${g.borderColor}`},children:[x&&e.jsx("button",{onClick:p,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:g.cardBgHover,border:`1px solid ${g.borderColor}`},children:e.jsx(Me,{size:18,style:{color:g.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(bs,{seconds:F,maxSeconds:c,isRecording:i==="recording",branding:g})}),i==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Qt,{audioLevel:C,isActive:!0,variant:"bars",size:"sm",accentColor:n})}),i==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:g.warning},children:[e.jsx(G,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!x&&e.jsx("button",{onClick:p,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:g.cardBgHover,border:`1px solid ${g.borderColor}`},children:e.jsx(Me,{size:20,style:{color:g.textMuted}})}),e.jsxs("button",{onClick:se,disabled:a||N,style:ne(),children:[i==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Aufnahme starten"]}),i==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),i==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(i==="recording"||i==="paused")&&e.jsxs("button",{onClick:Q,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:x?"14px 16px":"14px 24px",flex:x?1:"none",backgroundColor:g.cardBgHover,color:g.textMain,fontSize:x?"15px":"16px"},children:[e.jsx(he,{className:"w-[18px] h-[18px]",style:{color:g.success}}),S?.submitButton||"Antwort abgeben"]})]}),i==="idle"&&!N&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:g.textMuted},children:S?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),N&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Qe,{className:"w-8 h-8 animate-spin",style:{color:n}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:g.textSecondary},children:S?.analyzing||"Antwort wird analysiert..."})]})]})},fs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,o)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},o):a):null,ct={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:W,brain:je,info:ce,settings:Me,check:he,Target:te,Clock:Y,Mic:G,MessageSquare:ie,Lightbulb:W,Brain:je},js=({scenario:t,variables:c,questions:a,onStart:o,onBack:l,selectedMicrophoneId:n,onMicrophoneChange:N,onMicrophoneTest:S,themedGradient:p,primaryAccent:w,primaryAccentLight:x,isLoading:y,branding:j})=>{const g=pe(),i=j||g,f=t?.mode==="SIMULATION",F=f?"Situationen":"Fragen",O=f?"Zeit pro Situation":"Zeit pro Frage",C=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:Y,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${f?"Situation":"Frage"}. ${f?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ie,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],$=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((h,k)=>typeof h=="string"?{icon:W,title:`Tipp ${k+1}`,description:h}:{icon:ct[h.icon]||ct[h.icon?.toLowerCase()]||W,title:h.title||`Tipp ${k+1}`,description:h.text||h.description||""}):C,{inputConfigLabels:b,selectOptionsMap:d}=s.useMemo(()=>{if(!t?.input_configuration)return{inputConfigLabels:{},selectOptionsMap:{}};try{const h=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;if(!Array.isArray(h))return{inputConfigLabels:{},selectOptionsMap:{}};const k={},E={};return h.forEach(R=>{R.key&&R.label&&(k[R.key]=R.label),R.type==="select"&&R.options&&(E[R.key]=R.options)}),{inputConfigLabels:k,selectOptionsMap:E}}catch{return{inputConfigLabels:{},selectOptionsMap:{}}}},[t?.input_configuration]),r=(h,k)=>{if(h.endsWith("_label"))return null;if(c[`${h}_label`])return c[`${h}_label`];if(d[h]){const E=d[h].find(R=>R.value===k);if(E)return E.label}return k},A=c?Object.entries(c).filter(([h,k])=>h.endsWith("_label")?!1:k&&(typeof k=="string"?k.trim()!=="":!0)).map(([h,k])=>({label:b[h]||h.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),value:r(h,k)})).filter(h=>h.value):[],T=h=>{if(!h||!c)return h;let k=h;return Object.entries(c).forEach(([E,R])=>{R&&(k=k.replace(new RegExp(`\\$\\{${E}\\}`,"g"),R),k=k.replace(new RegExp(`\\{${E}\\}`,"g"),R))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:i.textSecondary},children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:p},children:e.jsx(W,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:i.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:i.textSecondary},children:[t.title,a.length>0?` â€¢ ${a.length} ${F}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:p},children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:i.textMain},children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:i.textSecondary},children:fs(T(t.long_description?.replace(/\/n/g,`
`)))})]})]})}),A.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:x},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:w},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:A.map((h,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:h.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:i.textMain},children:h.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px]",style:{color:w}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:n,onDeviceChange:N,onTestClick:S})]}),e.jsxs("button",{onClick:o,disabled:y,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Je,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(W,{className:"w-[22px] h-[22px]",style:{color:i.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:$.map((h,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:i.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:x},children:e.jsx(h.icon,{className:"w-[22px] h-[22px]",style:{color:w}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:i.textMain},children:h.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:i.textSecondary},children:h.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:i.cardBgHover},children:[a.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:F}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:a.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:O}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},ys=({isOpen:t,onClose:c,onConfirm:a,answeredCount:o,totalCount:l,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(bt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),o>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:n.answeredCount(o,l)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",n.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",n.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,ws=({isOpen:t,onClose:c,onConfirm:a,answeredCount:o,labels:l})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(we,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",o>0?` (${o} ${l.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,Ns=({number:t,size:c="md"})=>{const a={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${a[c]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},We=({question:t,index:c,labels:a,isMobile:o})=>e.jsxs(oe,{className:o?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Ns,{number:c+1,size:o?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||a.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${o?"text-[15px]":"text-lg"} mb-0`,children:t?.question||a.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(Y,{size:o?14:16}),a.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),dt=({error:t,onRetry:c,isMobile:a})=>e.jsxs("div",{className:`flex flex-col items-center ${a?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(we,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(xe,{variant:"danger",size:"sm",onClick:c,className:"mt-3",children:"Erneut versuchen"})]}),vs=({session:t,questions:c,scenario:a,variables:o,preloadedQuestions:l,onSessionCreated:n,onComplete:N,onExit:S,startFromQuestion:p=0,initialMicrophoneId:w,skipPreSession:x=!1})=>{const y=Xt(),[j,g]=s.useState(t),[i,f]=s.useState(c||[]),[F,O]=s.useState(!1),[C,$]=s.useState(null),{demoCode:b,branding:d}=ft(),r=a?.mode==="SIMULATION",A={questionLabel:r?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:r?"Situation":"Frage",questionLoading:r?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:r?"Deine Reaktion...":"Deine Antwort...",submitButton:r?"Reaktion abgeben":"Antwort abgeben",submitHint:r?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:r?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(_,L)=>r?`Situation ${_} von ${L}`:`Frage ${_} von ${L}`,questionsCount:_=>r?`${_} Situationen`:`${_} Fragen`,answeredCount:(_,L)=>r?`${_} von ${L} Situationen`:`${_} von ${L} Fragen`,tipsLabel:r?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:r?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:r?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:r?"Situationen":"Fragen",recommendedTime:r?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},T=p>0,h=T?Array.from({length:p},(_,L)=>L):[],k=T||x,[E,R]=s.useState(k?"interview":"preparation"),[u,m]=s.useState(p||j?.current_question_index||0),[v,I]=s.useState(null),[B,D]=s.useState(!1),[Q,se]=s.useState(!1),[ne,z]=s.useState(null),[M,J]=s.useState([]),[K,ee]=s.useState(h),P="karriereheld_selected_microphone",[U,Ne]=s.useState(()=>{if(w)return w;try{return localStorage.getItem(P)||null}catch{return null}}),[Be,ve]=s.useState(!1),[yt,ge]=s.useState(!1),Se=s.useRef(null),ke=s.useCallback(()=>{Se.current&&(Se.current.getTracks().forEach(_=>_.stop()),Se.current=null)},[]),et=s.useCallback(_=>{Se.current=_},[]);s.useEffect(()=>()=>{ke()},[ke]),s.useEffect(()=>{if(U)try{localStorage.setItem(P,U)}catch{}},[U]),s.useEffect(()=>{k&&E==="interview"&&!j&&!F&&(async()=>{O(!0),$(null);try{const L=await H.createSimulatorSession({scenario_id:a.id,variables:o,demo_code:b||null,questions:l||null});if(!L.success)throw new Error(L.message||"Fehler beim Erstellen der Session");const q=L.data.session;let V;if(l&&l.length>0)V=l,await H.updateSimulatorSessionQuestions(q.id,V);else{const X=await H.generateSimulatorQuestions(q.id);if(!X.success)throw new Error(X.message||"Fehler beim Generieren der Fragen");V=X.data.questions}g({...q,questions_json:V}),f(V),n&&n({session:{...q,questions_json:V},questions:V,selectedMicrophoneId:U})}catch(L){console.error("Error creating session:",L),$(L.message||"Ein Fehler ist aufgetreten")}finally{O(!1)}})()},[k,E,j,F,a,o,b,l,U,n]);const[wt,Oe]=s.useState(!1),[Nt,Le]=s.useState(!1),[Ce,tt]=s.useState(!1),[be,Ae]=s.useState(null),[re,st]=s.useState(!1),ae=i[u],de=u===i.length-1,nt=u===0,rt=async(_,L)=>{if(L<2){z("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(_.size<5e3){console.warn("[SimulatorSession] Audio too small:",_.size,"bytes"),z("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}se(!0),z(null);try{const q=await H.submitSimulatorAnswer(j.id,_,u,ae.question,ae.category,L);if(!q.success)throw new Error(q.message||"Fehler beim Analysieren der Antwort");if(I(q.data),D(!0),J(V=>[...V.filter(X=>X.questionIndex!==u),{questionIndex:u,feedback:q.data}]),ee(V=>V.includes(u)?V:[...V,u]),r&&!re){tt(!0),Ae(null);const V=K.includes(u);try{const X=await H.generateNextTurn(j.id);if(X.success){const ue=X.data.next_question;X.data.is_finished?(Ae(ue),f(V?le=>{const fe=[...le];return fe[u+1]=ue,fe.slice(0,u+2)}:le=>[...le,ue]),st(!0)):(Ae(ue),V?(f(le=>{const fe=[...le];return fe[u+1]=ue,fe.slice(0,u+2)}),st(!1)):f(le=>[...le,ue]))}}catch(X){console.error("Error generating next turn:",X)}finally{tt(!1)}}}catch(q){console.error("Error submitting answer:",q),z(q.message||"Ein Fehler ist aufgetreten")}finally{se(!1)}},De=()=>{I(null),D(!1),z(null)},Pe=()=>{if(I(null),D(!1),z(null),r){if(be){m(_=>_+1),Ae(null);return}if(re){_e();return}}else de||m(_=>_+1)},vt=()=>{I(null),D(!1),z(null),nt||m(_=>_-1)},St=()=>{Oe(!0)},_e=async()=>{Oe(!1),ge(!1),ve(!1),ke();try{const _=await H.completeSimulatorSession(j.id);_.success?N(_.data):N({session:{...j,status:"completed"}})}catch(_){console.error("Error completing session:",_),N({session:{...j,status:"completed"}})}},kt=()=>{Le(!0)},Ct=()=>{Le(!1),ge(!1),ve(!1),ke(),S()},At=async()=>{if(j&&i.length>0){R("interview");return}O(!0),$(null);try{const _=await H.createSimulatorSession({scenario_id:a.id,variables:o,demo_code:b||null,questions:l||null});if(!_.success)throw new Error(_.message||"Fehler beim Erstellen der Session");const L=_.data.session;let q;if(l&&l.length>0)q=l,await H.updateSimulatorSessionQuestions(L.id,q);else{const V=await H.generateSimulatorQuestions(L.id);if(!V.success)throw new Error(V.message||"Fehler beim Generieren der Fragen");q=V.data.questions}g({...L,questions_json:q}),f(q),n&&n({session:{...L,questions_json:q},questions:q,selectedMicrophoneId:U}),R("interview")}catch(_){console.error("Error creating session:",_),$(_.message||"Ein Fehler ist aufgetreten")}finally{O(!1)}};if(E==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(js,{scenario:a,variables:o,questions:i,onStart:At,onBack:S,selectedMicrophoneId:U,onMicrophoneChange:Ne,onMicrophoneTest:()=>ve(!0),themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],primaryAccentLight:d?.["--primary-accent-light"],isLoading:F}),e.jsx(Ye,{isOpen:Be,onClose:()=>ve(!1),deviceId:U}),C&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:C}),e.jsx(jt,{isLoading:F,message:r?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const _t=B&&(r&&re&&!be||!r&&de);return e.jsxs("div",{className:`${y?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${y?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${y?"text-lg":"text-xl"} font-semibold text-slate-900`,children:a?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${y?"justify-between":"justify-end"}`,children:[!_t&&e.jsxs("button",{onClick:St,className:`${y?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(bt,{size:16}),y?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:kt,className:`${y?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Pt,{size:16}),"Abbrechen"]})]})]}),e.jsx(ys,{isOpen:wt,onClose:()=>Oe(!1),onConfirm:_e,answeredCount:K.length,totalCount:i.length,labels:A}),e.jsx(ws,{isOpen:Nt,onClose:()=>Le(!1),onConfirm:Ct,answeredCount:K.length,labels:A}),!B&&!r&&e.jsxs("div",{className:`flex ${y?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(xe,{variant:"secondary",size:y?"sm":"md",icon:e.jsx(qt,{size:16}),onClick:vt,disabled:nt,className:y?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(xe,{variant:"secondary",size:y?"sm":"md",iconPosition:"right",icon:e.jsx(Ke,{size:16}),onClick:Pe,disabled:de,className:y?"flex-1":"",children:y?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(ss,{current:u,total:i.length,answeredQuestions:K,primaryAccent:d?.["--primary-accent"],labels:A}),B?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[a.allow_retry&&e.jsx(xe,{variant:"secondary",icon:e.jsx(He,{size:16}),onClick:De,children:"Nochmal versuchen"}),e.jsxs(xe,{onClick:r?re&&!be?_e:Pe:de?_e:Pe,disabled:r&&Ce&&!re,icon:Ce?e.jsx(Qe,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[r&&Ce&&!re?"GesprÃ¤chspartner tippt...":r?re&&!be?"Training abschlieÃŸen":A.nextButton:de?"Training abschlieÃŸen":A.nextButton,!Ce&&!(r?re&&!be:de)&&e.jsx(Ke,{size:16,className:"ml-1"})]})]}),e.jsx(We,{question:ae,index:u,labels:A,isMobile:y}),e.jsx("div",{className:"mt-4",children:e.jsx(ps,{transcript:v.transcript,feedback:v.feedback,audioMetrics:v.audio_analysis,audioUrl:v.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${y?"gap-4":"gap-6"}`,children:[y?e.jsxs(e.Fragment,{children:[e.jsx(We,{question:ae,index:u,labels:A,isMobile:!0}),e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:Q,labels:A,onOpenSettings:()=>ge(!0),isMobile:!0,onStreamChange:et}),ne&&e.jsx(dt,{error:ne,onRetry:De,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(ot,{onRecordingComplete:rt,timeLimit:a.time_limit_per_question||120,disabled:!1,deviceId:U,themedGradient:d?.["--button-gradient"]||d?.["--header-gradient"],primaryAccent:d?.["--primary-accent"],isSubmitting:Q,labels:A,onOpenSettings:()=>ge(!0),isMobile:!1,onStreamChange:et}),ne&&e.jsx(dt,{error:ne,onRetry:De,isMobile:!1})]}),e.jsx(We,{question:ae,index:u,labels:A,isMobile:!1})]}),ae?.tips&&ae.tips.length>0&&e.jsx(gs,{tips:ae.tips,primaryAccent:d?.["--primary-accent"],tipsLabel:A.tipsLabel})]}),e.jsx(ns,{isOpen:yt,onClose:()=>ge(!1),mode:"audio",selectedMicrophoneId:U,onMicrophoneChange:Ne})]})},Ee=({score:t,label:c,primaryAccent:a,b:o})=>{const l=t!=null?t*10:null,n=Ut(l,a);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:n},children:l!=null?Math.round(l):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:c})]})},Ze=({icon:t,value:c,label:a,primaryAccent:o,b:l})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:o}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:c}),e.jsx("div",{className:"text-xs text-slate-500",children:a})]})]}),Ss=({session:t,scenario:c,onBackToDashboard:a,onStartNew:o})=>{const l=pe(),{triggerConfetti:n,ConfettiComponent:N}=rs(),S=t.summary_feedback||t.summary_feedback_json,p=S?typeof S=="string"?JSON.parse(S):S:null,w=t.overall_score||p?.overall_score||0,x=w<=10?w*10:w,j=(g=>g>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:g>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:g>=70?{text:"Gut!",emoji:"ðŸ‘"}:g>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:g>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(x);return s.useEffect(()=>{x>=70&&n()},[x,n]),e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:l.headerGradient,boxShadow:`0 8px 24px ${l.primaryAccent}4d`},children:e.jsx(gt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",j.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[c?.title||"Skill Training"," - ",j.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${l.primaryAccent}`,backgroundColor:l.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:l.primaryAccent},children:x?Math.round(x):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:x?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(Ze,{icon:he,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:l.primaryAccent,b:l}),e.jsx(Ze,{icon:te,value:p?.average_content_score?Math.round(p.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:l.primaryAccent,b:l}),e.jsx(Ze,{icon:Vt,value:p?.average_delivery_score?Math.round(p.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:l.primaryAccent,b:l})]}),p?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Ee,{score:p.scores.content,label:"Inhalt",primaryAccent:l.primaryAccent,b:l}),e.jsx(Ee,{score:p.scores.structure,label:"Struktur",primaryAccent:l.primaryAccent,b:l}),e.jsx(Ee,{score:p.scores.relevance,label:"Relevanz",primaryAccent:l.primaryAccent,b:l}),e.jsx(Ee,{score:p.scores.delivery,label:"PrÃ¤sentation",primaryAccent:l.primaryAccent,b:l})]}),p?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:p.summary})]}),p?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:p.key_takeaways.map((g,i)=>e.jsx("li",{className:"mb-2",children:g},i))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:a,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(He,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})]})},Z={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Ks=({isAuthenticated:t,requireAuth:c,setPendingAction:a,pendingContinueSession:o,clearPendingContinueSession:l,pendingRepeatSession:n,clearPendingRepeatSession:N,onNavigateToHistory:S})=>{const[p,w]=s.useState(Z.DASHBOARD),[x,y]=s.useState(null),[j,g]=s.useState(null),[i,f]=s.useState([]),[F,O]=s.useState({}),[C,$]=s.useState(null),[b,d]=s.useState(null),[r,A]=s.useState(null),[T,h]=s.useState(0),[k,E]=s.useState(!1),R=s.useMemo(()=>{if(!x?.input_configuration)return!1;try{const M=typeof x.input_configuration=="string"?JSON.parse(x.input_configuration):x.input_configuration;return Array.isArray(M)?M.filter(J=>J.user_input!==!1).length>0:!1}catch{return!1}},[x?.input_configuration]);s.useEffect(()=>{r&&t&&(y(r),w(Z.PREPARATION),A(null))},[r,t]),s.useEffect(()=>{if(o&&t){const{session:M,scenario:J}=o,K=M.questions||M.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[],P=M.completed_questions||M.answered_count||0;y(J||{id:M.scenario_id,title:M.scenario_title}),g(M),f(ee),O({}),h(P),E(!0),w(Z.SESSION),l&&l()}},[o,t,l]),s.useEffect(()=>{if(n&&t){const{session:M,scenario:J}=n,K=M.questions||M.questions_json,ee=typeof K=="string"?JSON.parse(K):K||[];y(J||{id:M.scenario_id,title:M.scenario_title}),f(ee),O({}),h(0),w(Z.PREPARATION),N&&N()}},[n,t,N]),s.useEffect(()=>{window.scrollTo(0,0)},[p]);const u=s.useCallback(M=>{y(M),w(Z.PREPARATION)},[]),m=s.useCallback(()=>{y(null),g(null),f([]),O({}),$(null),h(0),d(null),E(!1),w(Z.DASHBOARD)},[]),v=s.useCallback(M=>{if(d(M.selectedMicrophoneId),x?.input_configuration){const J=typeof x.input_configuration=="string"?JSON.parse(x.input_configuration):x.input_configuration;if(Array.isArray(J)&&J.filter(ee=>ee.user_input!==!1).length>0){w(Z.VARIABLES);return}}E(!0),w(Z.SESSION)},[x]),I=s.useCallback(()=>{w(Z.PREPARATION)},[]),B=s.useCallback(M=>{O(M),E(!0),w(Z.SESSION)},[]),D=s.useCallback(M=>{g(M.session),f(M.questions),M.selectedMicrophoneId&&d(M.selectedMicrophoneId)},[]),Q=s.useCallback(M=>{$(M.session),w(Z.COMPLETE)},[]),se=s.useCallback(()=>{m()},[m]),ne=s.useCallback(()=>{g(null),f([]),$(null),h(0),d(null),E(!1),w(Z.PREPARATION)},[]),z=()=>{switch(p){case Z.DASHBOARD:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:c,setPendingScenario:A,onNavigateToHistory:S});case Z.PREPARATION:return e.jsx(us,{scenario:x,onBack:m,onNext:v,hasVariables:R});case Z.VARIABLES:return e.jsx(xs,{scenario:x,onBack:I,onNext:B});case Z.SESSION:return e.jsx(vs,{session:j,questions:i,scenario:x,variables:F,preloadedQuestions:i.length>0?i:null,onSessionCreated:D,onComplete:Q,onExit:se,startFromQuestion:T,initialMicrophoneId:b,skipPreSession:k});case Z.COMPLETE:return e.jsx(Ss,{session:C,scenario:x,onBackToDashboard:m,onStartNew:ne});default:return e.jsx(it,{onSelectScenario:u,isAuthenticated:t,requireAuth:c,setPendingScenario:A,onNavigateToHistory:S})}};return e.jsx("div",{className:"min-h-full",children:z()})},ks=t=>t?t.split(/(\*\*.*?\*\*)/g).map((a,o)=>a.startsWith("**")&&a.endsWith("**")?e.jsx("strong",{children:a.slice(2,-2)},o):a):null,ut={target:te,clock:Y,mic:G,"message-square":ie,lightbulb:W,brain:je,info:ce,check:he,sparkles:Ie},Cs=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:Y,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:G,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Gs=({scenario:t,onBack:c,onStart:a,preloadedQuestions:o})=>{const[l,n]=s.useState({}),[N,S]=s.useState({}),[p,w]=s.useState(!1),[x,y]=s.useState(null),[j,g]=s.useState(null),[i,f]=s.useState(!1),[F,O]=s.useState([]),[C,$]=s.useState(!1),{demoCode:b}=ft(),d=Re.useMemo(()=>{if(!t?.input_configuration)return[];try{const u=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(u)?u.filter(m=>m.user_input!==!1):[]}catch(u){return console.error("Error parsing input_configuration:",u),[]}},[t?.input_configuration]);s.useEffect(()=>{const u={};d.forEach(m=>{m.default&&(u[m.key]=m.default)}),n(u)},[d]);const r=(u,m)=>{if(!u)return u;let v=u;return Object.entries(m||{}).forEach(([I,B])=>{B&&(v=v.replace(new RegExp(`\\$\\{${I}\\}`,"g"),B),v=v.replace(new RegExp(`\\{${I}\\}`,"g"),B))}),v},A=(u,m)=>{n(v=>({...v,[u]:m})),N[u]&&S(v=>{const I={...v};return delete I[u],I})},T=()=>{O(u=>[...u,{key:"",value:""}])},h=(u,m,v)=>{O(I=>{const B=[...I];return B[u]={...B[u],[m]:v},B})},k=u=>{O(m=>m.filter((v,I)=>I!==u))},E=()=>{const u={};return d.forEach(m=>{const v=l[m.key];if(m.required&&(!v||v.trim()==="")){u[m.key]="Dieses Feld ist erforderlich";return}if(!(!v||v.trim()==="")&&m.validation){const{minLength:I,maxLength:B,min:D,max:Q,pattern:se}=m.validation;I&&v.length<I&&(u[m.key]=`Mindestens ${I} Zeichen erforderlich`),B&&v.length>B&&(u[m.key]=`Maximal ${B} Zeichen erlaubt`),D!==void 0&&Number(v)<D&&(u[m.key]=`Mindestens ${D}`),Q!==void 0&&Number(v)>Q&&(u[m.key]=`Maximal ${Q}`),se&&!new RegExp(se).test(v)&&(u[m.key]="UngÃ¼ltiges Format")}}),S(u),Object.keys(u).length===0},R=async u=>{if(u.preventDefault(),y(null),!!E()){w(!0);try{const m={...l};F.forEach(D=>{D.key&&D.value&&(m[D.key]=D.value)});const v=await H.createSimulatorSession({scenario_id:t.id,variables:m,demo_code:b||null,questions:o||null});if(!v.success)throw new Error(v.message||"Fehler beim Erstellen der Session");const I=v.data.session;let B;if(o&&o.length>0)B=o,await H.updateSimulatorSessionQuestions(I.id,B);else{const D=await H.generateSimulatorQuestions(I.id);if(!D.success)throw new Error(D.message||"Fehler beim Generieren der Fragen");B=D.data.questions}a({session:{...I,questions_json:B},questions:B,scenario:t,variables:m,selectedMicrophoneId:j})}catch(m){console.error("Error starting session:",m),y(m.message||"Ein Fehler ist aufgetreten")}finally{w(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(oe,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:ks(r(t.long_description?.replace(/\/n/g,`
`),l))})]})]})}),(()=>{const u=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((m,v)=>typeof m=="string"?{icon:W,title:`Tipp ${v+1}`,description:m}:{icon:ut[m.icon]||ut[m.icon?.toLowerCase()]||W,title:m.title||`Tipp ${v+1}`,description:m.text||m.description||""}):Cs;return e.jsxs(oe,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:u.map((m,v)=>{const I=m.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(I,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:m.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:m.description})]})]},v)})})]})})(),e.jsxs("form",{onSubmit:R,children:[d.length>0?d.map(u=>e.jsx(as,{field:u,value:l[u.key],onChange:A,error:N[u.key]},u.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(he,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>$(!C),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${C?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[C?e.jsx(Ue,{size:18}):e.jsx($e,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),C&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),F.length>0&&e.jsx("div",{className:"mb-3",children:F.map((u,m)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:u.key||"",onChange:v=>h(m,"key",v.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>k(m),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(xt,{size:18})})]}),e.jsx("textarea",{value:u.value||"",onChange:v=>h(m,"value",v.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},m))}),e.jsxs("button",{type:"button",onClick:T,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(oe,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Xe,{selectedDeviceId:j,onDeviceChange:g,onTestClick:()=>f(!0)})]}),x&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(we,{className:"w-[18px] h-[18px]"}),x]}),e.jsx(xe,{type:"submit",disabled:p,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(Ge,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(Ye,{isOpen:i,onClose:()=>f(!1),deviceId:j}),e.jsx(jt,{isLoading:p,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{ws as CancelConfirmDialog,ys as CompleteConfirmDialog,ps as ImmediateFeedback,js as PreSessionView,gs as QuestionTips,Ss as SessionComplete,bs as SessionTimer,Ks as SimulatorApp,ot as SimulatorAudioRecorder,it as SimulatorDashboard,vs as SimulatorSession,Gs as SimulatorWizard};
