import{g as _v,r as Nv,a as f,R as Ed,j as s,c as X,u as Fe,L as ge,S as It,C as ti,D as ve,T as dr,b as Bt,V as pt,w as me,d as ni,e as Lt,M as Ji,U as Nn,B as Mn,f as Av,h as Mv,I as Pv,Z as Dv,i as Ov,k as Lv,F as zv,l as Bv,m as Fv,n as Uv,o as Wv,p as R,q as ur,s as We,t as Jt,v as lt,x as Et,y as je,A as pn,z as he,E as Yt,G as $i,H as Xn,J as Vv,K as Gr,N as Xt,O as $v,P as Gv,Q as ma,W as nh,X as Rd,Y as Hv,_ as qv}from"./button-M9vmrOUV.js";var Gm=Nv();const Kv=_v(Gm);function Hr(){return Hr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Hr.apply(this,arguments)}var Oi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Oi||(Oi={}));const ih="popstate";function Jv(t){t===void 0&&(t={});function e(r,o){let{pathname:a="/",search:l="",hash:c=""}=vs(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),bc("",{pathname:a,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){let a=r.document.querySelector("base"),l="";if(a&&a.getAttribute("href")){let c=r.location.href,d=c.indexOf("#");l=d===-1?c:c.slice(0,d)}return l+"#"+(typeof o=="string"?o:Hm(o))}function i(r,o){Wa(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return Xv(e,n,i,t)}function Mt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Wa(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Yv(){return Math.random().toString(36).substr(2,8)}function sh(t,e){return{usr:t.state,key:t.key,idx:e}}function bc(t,e,n,i){return n===void 0&&(n=null),Hr({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?vs(e):e,{state:n,key:e&&e.key||i||Yv()})}function Hm(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function vs(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function Xv(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:o=!1}=i,a=r.history,l=Oi.Pop,c=null,d=u();d==null&&(d=0,a.replaceState(Hr({},a.state,{idx:d}),""));function u(){return(a.state||{idx:null}).idx}function p(){l=Oi.Pop;let y=u(),v=y==null?null:y-d;d=y,c&&c({action:l,location:g.location,delta:v})}function h(y,v){l=Oi.Push;let w=bc(g.location,y,v);n&&n(w,y),d=u()+1;let k=sh(w,d),S=g.createHref(w);try{a.pushState(k,"",S)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;r.location.assign(S)}o&&c&&c({action:l,location:g.location,delta:1})}function m(y,v){l=Oi.Replace;let w=bc(g.location,y,v);n&&n(w,y),d=u();let k=sh(w,d),S=g.createHref(w);a.replaceState(k,"",S),o&&c&&c({action:l,location:g.location,delta:0})}function x(y){let v=r.location.origin!=="null"?r.location.origin:r.location.href,w=typeof y=="string"?y:Hm(y);return w=w.replace(/ $/,"%20"),Mt(v,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,v)}let g={get action(){return l},get location(){return t(r,a)},listen(y){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(ih,p),c=y,()=>{r.removeEventListener(ih,p),c=null}},createHref(y){return e(r,y)},createURL:x,encodeLocation(y){let v=x(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:h,replace:m,go(y){return a.go(y)}};return g}var rh;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(rh||(rh={}));function Zv(t,e,n){return n===void 0&&(n="/"),Qv(t,e,n)}function Qv(t,e,n,i){let r=typeof e=="string"?vs(e):e,o=Jm(r.pathname||"/",n);if(o==null)return null;let a=qm(t);e1(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=h1(o);l=c1(a[c],d)}return l}function qm(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(o,a,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};c.relativePath.startsWith("/")&&(Mt(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let d=ls([i,c.relativePath]),u=n.concat(c);o.children&&o.children.length>0&&(Mt(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),qm(o.children,e,u,d)),!(o.path==null&&!o.index)&&e.push({path:d,score:a1(d,o.index),routesMeta:u})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))r(o,a);else for(let c of Km(o.path))r(o,a,c)}),e}function Km(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(i.length===0)return r?[o,""]:[o];let a=Km(i.join("/")),l=[];return l.push(...a.map(c=>c===""?o:[o,c].join("/"))),r&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function e1(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:l1(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const t1=/^:[\w-]+$/,n1=3,i1=2,s1=1,r1=10,o1=-2,oh=t=>t==="*";function a1(t,e){let n=t.split("/"),i=n.length;return n.some(oh)&&(i+=o1),e&&(i+=i1),n.filter(r=>!oh(r)).reduce((r,o)=>r+(t1.test(o)?n1:o===""?s1:r1),i)}function l1(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function c1(t,e,n){let{routesMeta:i}=t,r={},o="/",a=[];for(let l=0;l<i.length;++l){let c=i[l],d=l===i.length-1,u=o==="/"?e:e.slice(o.length)||"/",p=d1({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),h=c.route;if(!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:ls([o,p.pathname]),pathnameBase:b1(ls([o,p.pathnameBase])),route:h}),p.pathnameBase!=="/"&&(o=ls([o,p.pathnameBase]))}return a}function d1(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=u1(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let o=r[0],a=o.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:i.reduce((d,u,p)=>{let{paramName:h,isOptional:m}=u;if(h==="*"){let g=l[p]||"";a=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[p];return m&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:a,pattern:t}}function u1(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Wa(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(i.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function h1(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Wa(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Jm(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const p1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,f1=t=>p1.test(t);function m1(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?vs(t):t,o;if(n)if(f1(n))o=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),Wa(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+n))}n.startsWith("/")?o=ah(n.substring(1),"/"):o=ah(n,e)}else o=e;return{pathname:o,search:v1(i),hash:S1(r)}}function ah(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function yl(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function g1(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function x1(t,e){let n=g1(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function y1(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=vs(t):(r=Hr({},t),Mt(!r.pathname||!r.pathname.includes("?"),yl("?","pathname","search",r)),Mt(!r.pathname||!r.pathname.includes("#"),yl("#","pathname","hash",r)),Mt(!r.search||!r.search.includes("#"),yl("#","search","hash",r)));let o=t===""||r.pathname==="",a=o?"/":r.pathname,l;if(a==null)l=n;else{let p=e.length-1;if(!i&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),p-=1;r.pathname=h.join("/")}l=p>=0?e[p]:"/"}let c=m1(r,l),d=a&&a!=="/"&&a.endsWith("/"),u=(o||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const ls=t=>t.join("/").replace(/\/\/+/g,"/"),b1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),v1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,S1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function k1(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Ym=["post","put","patch","delete"];new Set(Ym);const w1=["get",...Ym];new Set(w1);function qr(){return qr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},qr.apply(this,arguments)}const Id=f.createContext(null),C1=f.createContext(null),Va=f.createContext(null),$a=f.createContext(null),hr=f.createContext({outlet:null,matches:[],isDataRoute:!1}),Xm=f.createContext(null);function Ga(){return f.useContext($a)!=null}function _d(){return Ga()||Mt(!1),f.useContext($a).location}function Zm(t){f.useContext(Va).static||f.useLayoutEffect(t)}function j1(){let{isDataRoute:t}=f.useContext(hr);return t?z1():T1()}function T1(){Ga()||Mt(!1);let t=f.useContext(Id),{basename:e,future:n,navigator:i}=f.useContext(Va),{matches:r}=f.useContext(hr),{pathname:o}=_d(),a=JSON.stringify(x1(r,n.v7_relativeSplatPath)),l=f.useRef(!1);return Zm(()=>{l.current=!0}),f.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){i.go(d);return}let p=y1(d,JSON.parse(a),o,u.relative==="path");t==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:ls([e,p.pathname])),(u.replace?i.replace:i.push)(p,u.state,u)},[e,i,a,o,t])}function E1(t,e){return R1(t,e)}function R1(t,e,n,i){Ga()||Mt(!1);let{navigator:r}=f.useContext(Va),{matches:o}=f.useContext(hr),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=_d(),u;if(e){var p;let y=typeof e=="string"?vs(e):e;c==="/"||(p=y.pathname)!=null&&p.startsWith(c)||Mt(!1),u=y}else u=d;let h=u.pathname||"/",m=h;if(c!=="/"){let y=c.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=Zv(t,{pathname:m}),g=M1(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:ls([c,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:ls([c,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,n,i);return e&&g?f.createElement($a.Provider,{value:{location:qr({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Oi.Pop}},g):g}function I1(){let t=L1(),e=k1(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},e),n?f.createElement("pre",{style:r},n):null,null)}const _1=f.createElement(I1,null);class N1 extends f.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?f.createElement(hr.Provider,{value:this.props.routeContext},f.createElement(Xm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function A1(t){let{routeContext:e,match:n,children:i}=t,r=f.useContext(Id);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),f.createElement(hr.Provider,{value:e},i)}function M1(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=i)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(r=n)==null?void 0:r.errors;if(l!=null){let u=a.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);u>=0||Mt(!1),a=a.slice(0,Math.min(a.length,u+1))}let c=!1,d=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<a.length;u++){let p=a[u];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=u),p.route.id){let{loaderData:h,errors:m}=n,x=p.route.loader&&h[p.route.id]===void 0&&(!m||m[p.route.id]===void 0);if(p.route.lazy||x){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((u,p,h)=>{let m,x=!1,g=null,y=null;n&&(m=l&&p.route.id?l[p.route.id]:void 0,g=p.route.errorElement||_1,c&&(d<0&&h===0?(B1("route-fallback"),x=!0,y=null):d===h&&(x=!0,y=p.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,h+1)),w=()=>{let k;return m?k=g:x?k=y:p.route.Component?k=f.createElement(p.route.Component,null):p.route.element?k=p.route.element:k=u,f.createElement(A1,{match:p,routeContext:{outlet:u,matches:v,isDataRoute:n!=null},children:k})};return n&&(p.route.ErrorBoundary||p.route.errorElement||h===0)?f.createElement(N1,{location:n.location,revalidation:n.revalidation,component:g,error:m,children:w(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):w()},null)}var Qm=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(Qm||{}),eg=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(eg||{});function P1(t){let e=f.useContext(Id);return e||Mt(!1),e}function D1(t){let e=f.useContext(C1);return e||Mt(!1),e}function O1(t){let e=f.useContext(hr);return e||Mt(!1),e}function tg(t){let e=O1(),n=e.matches[e.matches.length-1];return n.route.id||Mt(!1),n.route.id}function L1(){var t;let e=f.useContext(Xm),n=D1(),i=tg();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function z1(){let{router:t}=P1(Qm.UseNavigateStable),e=tg(eg.UseNavigateStable),n=f.useRef(!1);return Zm(()=>{n.current=!0}),f.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,qr({fromRouteId:e},o)))},[t,e])}const lh={};function B1(t,e,n){lh[t]||(lh[t]=!0)}function F1(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function gt(t){Mt(!1)}function U1(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Oi.Pop,navigator:o,static:a=!1,future:l}=t;Ga()&&Mt(!1);let c=e.replace(/^\/*/,"/"),d=f.useMemo(()=>({basename:c,navigator:o,static:a,future:qr({v7_relativeSplatPath:!1},l)}),[c,l,o,a]);typeof i=="string"&&(i=vs(i));let{pathname:u="/",search:p="",hash:h="",state:m=null,key:x="default"}=i,g=f.useMemo(()=>{let y=Jm(u,c);return y==null?null:{location:{pathname:y,search:p,hash:h,state:m,key:x},navigationType:r}},[c,u,p,h,m,x,r]);return g==null?null:f.createElement(Va.Provider,{value:d},f.createElement($a.Provider,{children:n,value:g}))}function W1(t){let{children:e,location:n}=t;return E1(vc(e),n)}new Promise(()=>{});function vc(t,e){e===void 0&&(e=[]);let n=[];return f.Children.forEach(t,(i,r)=>{if(!f.isValidElement(i))return;let o=[...e,r];if(i.type===f.Fragment){n.push.apply(n,vc(i.props.children,o));return}i.type!==gt&&Mt(!1),!i.props.index||!i.props.children||Mt(!1);let a={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=vc(i.props.children,o)),n.push(a)}),n}const V1="6";try{window.__reactRouterVersion=V1}catch{}const $1="startTransition",ch=Ed[$1];function G1(t){let{basename:e,children:n,future:i,window:r}=t,o=f.useRef();o.current==null&&(o.current=Jv({window:r,v5Compat:!0}));let a=o.current,[l,c]=f.useState({action:a.action,location:a.location}),{v7_startTransition:d}=i||{},u=f.useCallback(p=>{d&&ch?ch(()=>c(p)):c(p)},[c,d]);return f.useLayoutEffect(()=>a.listen(u),[a,u]),f.useEffect(()=>F1(i),[i]),f.createElement(U1,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:i})}var dh;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(dh||(dh={}));var uh;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(uh||(uh={}));const Nd=f.createContext({});function Ad(t){const e=f.useRef(null);return e.current===null&&(e.current=t()),e.current}const Md=typeof window<"u",ng=Md?f.useLayoutEffect:f.useEffect,Ha=f.createContext(null);function Pd(t,e){t.indexOf(e)===-1&&t.push(e)}function Dd(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const vi=(t,e,n)=>n>e?e:n<t?t:n;let Od=()=>{};const Si={},ig=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function sg(t){return typeof t=="object"&&t!==null}const rg=t=>/^0[^.\s]+$/u.test(t);function Ld(t){let e;return()=>(e===void 0&&(e=t()),e)}const Tn=t=>t,H1=(t,e)=>n=>e(t(n)),fo=(...t)=>t.reduce(H1),Kr=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i};class zd{constructor(){this.subscriptions=[]}add(e){return Pd(this.subscriptions,e),()=>Dd(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Zn=t=>t*1e3,wn=t=>t/1e3;function og(t,e){return e?t*(1e3/e):0}const ag=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,q1=1e-7,K1=12;function J1(t,e,n,i,r){let o,a,l=0;do a=e+(n-e)/2,o=ag(a,i,r)-t,o>0?n=a:e=a;while(Math.abs(o)>q1&&++l<K1);return a}function mo(t,e,n,i){if(t===e&&n===i)return Tn;const r=o=>J1(o,0,1,t,n);return o=>o===0||o===1?o:ag(r(o),e,i)}const lg=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,cg=t=>e=>1-t(1-e),dg=mo(.33,1.53,.69,.99),Bd=cg(dg),ug=lg(Bd),hg=t=>(t*=2)<1?.5*Bd(t):.5*(2-Math.pow(2,-10*(t-1))),Fd=t=>1-Math.sin(Math.acos(t)),pg=cg(Fd),fg=lg(Fd),Y1=mo(.42,0,1,1),X1=mo(0,0,.58,1),mg=mo(.42,0,.58,1),Z1=t=>Array.isArray(t)&&typeof t[0]!="number",gg=t=>Array.isArray(t)&&typeof t[0]=="number",Q1={linear:Tn,easeIn:Y1,easeInOut:mg,easeOut:X1,circIn:Fd,circInOut:fg,circOut:pg,backIn:Bd,backInOut:ug,backOut:dg,anticipate:hg},eS=t=>typeof t=="string",hh=t=>{if(gg(t)){Od(t.length===4);const[e,n,i,r]=t;return mo(e,n,i,r)}else if(eS(t))return Q1[t];return t},Eo=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function tS(t,e){let n=new Set,i=new Set,r=!1,o=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){a.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,p=!1,h=!1)=>{const x=h&&r?n:i;return p&&a.add(u),x.has(u)||x.add(u),u},cancel:u=>{i.delete(u),a.delete(u)},process:u=>{if(l=u,r){o=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,o&&(o=!1,d.process(u))}};return d}const nS=40;function xg(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Eo.reduce((k,S)=>(k[S]=tS(o),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:p,preRender:h,render:m,postRender:x}=a,g=()=>{const k=Si.useManualTiming?r.timestamp:performance.now();n=!1,Si.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(k-r.timestamp,nS),1)),r.timestamp=k,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),p.process(r),h.process(r),m.process(r),x.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(g))},y=()=>{n=!0,i=!0,r.isProcessing||t(g)};return{schedule:Eo.reduce((k,S)=>{const b=a[S];return k[S]=(j,C=!1,T=!1)=>(n||y(),b.schedule(j,C,T)),k},{}),cancel:k=>{for(let S=0;S<Eo.length;S++)a[Eo[S]].cancel(k)},state:r,steps:a}}const{schedule:ct,cancel:Gi,state:Wt,steps:bl}=xg(typeof requestAnimationFrame<"u"?requestAnimationFrame:Tn,!0);let qo;function iS(){qo=void 0}const un={now:()=>(qo===void 0&&un.set(Wt.isProcessing||Si.useManualTiming?Wt.timestamp:performance.now()),qo),set:t=>{qo=t,queueMicrotask(iS)}},yg=t=>e=>typeof e=="string"&&e.startsWith(t),Ud=yg("--"),sS=yg("var(--"),Wd=t=>sS(t)?rS.test(t.split("/*")[0].trim()):!1,rS=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,pr={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Jr={...pr,transform:t=>vi(0,1,t)},Ro={...pr,default:1},Mr=t=>Math.round(t*1e5)/1e5,Vd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function oS(t){return t==null}const aS=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,$d=(t,e)=>n=>!!(typeof n=="string"&&aS.test(n)&&n.startsWith(t)||e&&!oS(n)&&Object.prototype.hasOwnProperty.call(n,e)),bg=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,o,a,l]=i.match(Vd);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},lS=t=>vi(0,255,t),vl={...pr,transform:t=>Math.round(lS(t))},rs={test:$d("rgb","red"),parse:bg("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+vl.transform(t)+", "+vl.transform(e)+", "+vl.transform(n)+", "+Mr(Jr.transform(i))+")"};function cS(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Sc={test:$d("#"),parse:cS,transform:rs.transform},go=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),_i=go("deg"),Qn=go("%"),ye=go("px"),dS=go("vh"),uS=go("vw"),ph={...Qn,parse:t=>Qn.parse(t)/100,transform:t=>Qn.transform(t*100)},Ls={test:$d("hsl","hue"),parse:bg("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+Qn.transform(Mr(e))+", "+Qn.transform(Mr(n))+", "+Mr(Jr.transform(i))+")"},jt={test:t=>rs.test(t)||Sc.test(t)||Ls.test(t),parse:t=>rs.test(t)?rs.parse(t):Ls.test(t)?Ls.parse(t):Sc.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?rs.transform(t):Ls.transform(t),getAnimatableNone:t=>{const e=jt.parse(t);return e.alpha=0,jt.transform(e)}},hS=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function pS(t){return isNaN(t)&&typeof t=="string"&&(t.match(Vd)?.length||0)+(t.match(hS)?.length||0)>0}const vg="number",Sg="color",fS="var",mS="var(",fh="${}",gS=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Yr(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const l=e.replace(gS,c=>(jt.test(c)?(i.color.push(o),r.push(Sg),n.push(jt.parse(c))):c.startsWith(mS)?(i.var.push(o),r.push(fS),n.push(c)):(i.number.push(o),r.push(vg),n.push(parseFloat(c))),++o,fh)).split(fh);return{values:n,split:l,indexes:i,types:r}}function kg(t){return Yr(t).values}function wg(t){const{split:e,types:n}=Yr(t),i=e.length;return r=>{let o="";for(let a=0;a<i;a++)if(o+=e[a],r[a]!==void 0){const l=n[a];l===vg?o+=Mr(r[a]):l===Sg?o+=jt.transform(r[a]):o+=r[a]}return o}}const xS=t=>typeof t=="number"?0:jt.test(t)?jt.getAnimatableNone(t):t;function yS(t){const e=kg(t);return wg(t)(e.map(xS))}const Hi={test:pS,parse:kg,createTransformer:wg,getAnimatableNone:yS};function Sl(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function bS({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,o=0,a=0;if(!e)r=o=a=n;else{const l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=Sl(c,l,t+1/3),o=Sl(c,l,t),a=Sl(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:i}}function ga(t,e){return n=>n>0?e:t}const ut=(t,e,n)=>t+(e-t)*n,kl=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},vS=[Sc,rs,Ls],SS=t=>vS.find(e=>e.test(t));function mh(t){const e=SS(t);if(!e)return!1;let n=e.parse(t);return e===Ls&&(n=bS(n)),n}const gh=(t,e)=>{const n=mh(t),i=mh(e);if(!n||!i)return ga(t,e);const r={...n};return o=>(r.red=kl(n.red,i.red,o),r.green=kl(n.green,i.green,o),r.blue=kl(n.blue,i.blue,o),r.alpha=ut(n.alpha,i.alpha,o),rs.transform(r))},kc=new Set(["none","hidden"]);function kS(t,e){return kc.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function wS(t,e){return n=>ut(t,e,n)}function Gd(t){return typeof t=="number"?wS:typeof t=="string"?Wd(t)?ga:jt.test(t)?gh:TS:Array.isArray(t)?Cg:typeof t=="object"?jt.test(t)?gh:CS:ga}function Cg(t,e){const n=[...t],i=n.length,r=t.map((o,a)=>Gd(o)(o,e[a]));return o=>{for(let a=0;a<i;a++)n[a]=r[a](o);return n}}function CS(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=Gd(t[r])(t[r],e[r]));return r=>{for(const o in i)n[o]=i[o](r);return n}}function jS(t,e){const n=[],i={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const o=e.types[r],a=t.indexes[o][i[o]],l=t.values[a]??0;n[r]=l,i[o]++}return n}const TS=(t,e)=>{const n=Hi.createTransformer(e),i=Yr(t),r=Yr(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?kc.has(t)&&!r.values.length||kc.has(e)&&!i.values.length?kS(t,e):fo(Cg(jS(i,r),r.values),n):ga(t,e)};function jg(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ut(t,e,n):Gd(t)(t,e)}const ES=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>ct.update(e,n),stop:()=>Gi(e),now:()=>Wt.isProcessing?Wt.timestamp:un.now()}},Tg=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let o=0;o<r;o++)i+=Math.round(t(o/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},xa=2e4;function Hd(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<xa;)e+=n,i=t.next(e);return e>=xa?1/0:e}function RS(t,e=100,n){const i=n({...t,keyframes:[0,e]}),r=Math.min(Hd(i),xa);return{type:"keyframes",ease:o=>i.next(r*o).value/e,duration:wn(r)}}const IS=5;function Eg(t,e,n){const i=Math.max(e-IS,0);return og(n-t(i),e-i)}const xt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},wl=.001;function _S({duration:t=xt.duration,bounce:e=xt.bounce,velocity:n=xt.velocity,mass:i=xt.mass}){let r,o,a=1-e;a=vi(xt.minDamping,xt.maxDamping,a),t=vi(xt.minDuration,xt.maxDuration,wn(t)),a<1?(r=d=>{const u=d*a,p=u*t,h=u-n,m=wc(d,a),x=Math.exp(-p);return wl-h/m*x},o=d=>{const p=d*a*t,h=p*n+n,m=Math.pow(a,2)*Math.pow(d,2)*t,x=Math.exp(-p),g=wc(Math.pow(d,2),a);return(-r(d)+wl>0?-1:1)*((h-m)*x)/g}):(r=d=>{const u=Math.exp(-d*t),p=(d-n)*t+1;return-wl+u*p},o=d=>{const u=Math.exp(-d*t),p=(n-d)*(t*t);return u*p});const l=5/t,c=AS(r,o,l);if(t=Zn(t),isNaN(c))return{stiffness:xt.stiffness,damping:xt.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:a*2*Math.sqrt(i*d),duration:t}}}const NS=12;function AS(t,e,n){let i=n;for(let r=1;r<NS;r++)i=i-t(i)/e(i);return i}function wc(t,e){return t*Math.sqrt(1-e*e)}const MS=["duration","bounce"],PS=["stiffness","damping","mass"];function xh(t,e){return e.some(n=>t[n]!==void 0)}function DS(t){let e={velocity:xt.velocity,stiffness:xt.stiffness,damping:xt.damping,mass:xt.mass,isResolvedFromDuration:!1,...t};if(!xh(t,PS)&&xh(t,MS))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,o=2*vi(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:xt.mass,stiffness:r,damping:o}}else{const n=_S(t);e={...e,...n,mass:xt.mass},e.isResolvedFromDuration=!0}return e}function ya(t=xt.visualDuration,e=xt.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:p,velocity:h,isResolvedFromDuration:m}=DS({...n,velocity:-wn(n.velocity||0)}),x=h||0,g=d/(2*Math.sqrt(c*u)),y=a-o,v=wn(Math.sqrt(c/u)),w=Math.abs(y)<5;i||(i=w?xt.restSpeed.granular:xt.restSpeed.default),r||(r=w?xt.restDelta.granular:xt.restDelta.default);let k;if(g<1){const b=wc(v,g);k=j=>{const C=Math.exp(-g*v*j);return a-C*((x+g*v*y)/b*Math.sin(b*j)+y*Math.cos(b*j))}}else if(g===1)k=b=>a-Math.exp(-v*b)*(y+(x+v*y)*b);else{const b=v*Math.sqrt(g*g-1);k=j=>{const C=Math.exp(-g*v*j),T=Math.min(b*j,300);return a-C*((x+g*v*y)*Math.sinh(T)+b*y*Math.cosh(T))/b}}const S={calculatedDuration:m&&p||null,next:b=>{const j=k(b);if(m)l.done=b>=p;else{let C=b===0?x:0;g<1&&(C=b===0?Zn(x):Eg(k,b,j));const T=Math.abs(C)<=i,_=Math.abs(a-j)<=r;l.done=T&&_}return l.value=l.done?a:j,l},toString:()=>{const b=Math.min(Hd(S),xa),j=Tg(C=>S.next(b*C).value,b,30);return b+"ms "+j},toTransition:()=>{}};return S}ya.applyToOptions=t=>{const e=RS(t,100,ya);return t.ease=e.ease,t.duration=Zn(e.duration),t.type="keyframes",t};function Cc({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:u}){const p=t[0],h={done:!1,value:p},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,x=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let g=n*e;const y=p+g,v=a===void 0?y:a(y);v!==y&&(g=v-p);const w=T=>-g*Math.exp(-T/i),k=T=>v+w(T),S=T=>{const _=w(T),E=k(T);h.done=Math.abs(_)<=d,h.value=h.done?v:E};let b,j;const C=T=>{m(h.value)&&(b=T,j=ya({keyframes:[h.value,x(h.value)],velocity:Eg(k,T,h.value),damping:r,stiffness:o,restDelta:d,restSpeed:u}))};return C(0),{calculatedDuration:null,next:T=>{let _=!1;return!j&&b===void 0&&(_=!0,S(T),C(T)),b!==void 0&&T>=b?j.next(T-b):(!_&&S(T),h)}}}function OS(t,e,n){const i=[],r=n||Si.mix||jg,o=t.length-1;for(let a=0;a<o;a++){let l=r(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||Tn:e;l=fo(c,l)}i.push(l)}return i}function LS(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const o=t.length;if(Od(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=OS(e,i,r),c=l.length,d=u=>{if(a&&u<t[0])return e[0];let p=0;if(c>1)for(;p<t.length-2&&!(u<t[p+1]);p++);const h=Kr(t[p],t[p+1],u);return l[p](h)};return n?u=>d(vi(t[0],t[o-1],u)):d}function zS(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=Kr(0,e,i);t.push(ut(n,1,r))}}function BS(t){const e=[0];return zS(e,t.length-1),e}function FS(t,e){return t.map(n=>n*e)}function US(t,e){return t.map(()=>e||mg).splice(0,t.length-1)}function Pr({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=Z1(i)?i.map(hh):hh(i),o={done:!1,value:e[0]},a=FS(n&&n.length===e.length?n:BS(e),t),l=LS(a,e,{ease:Array.isArray(r)?r:US(e,r)});return{calculatedDuration:t,next:c=>(o.value=l(c),o.done=c>=t,o)}}const WS=t=>t!==null;function qd(t,{repeat:e,repeatType:n="loop"},i,r=1){const o=t.filter(WS),l=r<0||e&&n!=="loop"&&e%2===1?0:o.length-1;return!l||i===void 0?o[l]:i}const VS={decay:Cc,inertia:Cc,tween:Pr,keyframes:Pr,spring:ya};function Rg(t){typeof t.type=="string"&&(t.type=VS[t.type])}class Kd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const $S=t=>t/100;class Jd extends Kd{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==un.now()&&this.tick(un.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Rg(e);const{type:n=Pr,repeat:i=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=e;let{keyframes:l}=e;const c=n||Pr;c!==Pr&&typeof l[0]!="number"&&(this.mixKeyframes=fo($S,jg(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=Hd(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:i,totalDuration:r,mixKeyframes:o,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:p,repeatType:h,repeatDelay:m,type:x,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const v=this.currentTime-d*(this.playbackSpeed>=0?1:-1),w=this.playbackSpeed>=0?v<0:v>r;this.currentTime=Math.max(v,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let k=this.currentTime,S=i;if(p){const T=Math.min(this.currentTime,r)/l;let _=Math.floor(T),E=T%1;!E&&T>=1&&(E=1),E===1&&_--,_=Math.min(_,p+1),!!(_%2)&&(h==="reverse"?(E=1-E,m&&(E-=m/l)):h==="mirror"&&(S=a)),k=vi(0,1,E)*l}const b=w?{done:!1,value:u[0]}:S.next(k);o&&(b.value=o(b.value));let{done:j}=b;!w&&c!==null&&(j=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return C&&x!==Cc&&(b.value=qd(u,this.options,y,this.speed)),g&&g(b.value),C&&this.finish(),b}then(e,n){return this.finished.then(e,n)}get duration(){return wn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+wn(e)}get time(){return wn(this.currentTime)}set time(e){e=Zn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(un.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=wn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=ES,startTime:n}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(un.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function GS(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const os=t=>t*180/Math.PI,jc=t=>{const e=os(Math.atan2(t[1],t[0]));return Tc(e)},HS={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:jc,rotateZ:jc,skewX:t=>os(Math.atan(t[1])),skewY:t=>os(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Tc=t=>(t=t%360,t<0&&(t+=360),t),yh=jc,bh=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),vh=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),qS={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:bh,scaleY:vh,scale:t=>(bh(t)+vh(t))/2,rotateX:t=>Tc(os(Math.atan2(t[6],t[5]))),rotateY:t=>Tc(os(Math.atan2(-t[2],t[0]))),rotateZ:yh,rotate:yh,skewX:t=>os(Math.atan(t[4])),skewY:t=>os(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Ec(t){return t.includes("scale")?1:0}function Rc(t,e){if(!t||t==="none")return Ec(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=qS,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=HS,r=l}if(!r)return Ec(e);const o=i[e],a=r[1].split(",").map(JS);return typeof o=="function"?o(a):a[o]}const KS=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return Rc(n,e)};function JS(t){return parseFloat(t.trim())}const fr=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],mr=new Set(fr),Sh=t=>t===pr||t===ye,YS=new Set(["x","y","z"]),XS=fr.filter(t=>!YS.has(t));function ZS(t){const e=[];return XS.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const cs={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Rc(e,"x"),y:(t,{transform:e})=>Rc(e,"y")};cs.translateX=cs.x;cs.translateY=cs.y;const ds=new Set;let Ic=!1,_c=!1,Nc=!1;function Ig(){if(_c){const t=Array.from(ds).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=ZS(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([o,a])=>{i.getValue(o)?.set(a)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}_c=!1,Ic=!1,ds.forEach(t=>t.complete(Nc)),ds.clear()}function _g(){ds.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(_c=!0)})}function QS(){Nc=!0,_g(),Ig(),Nc=!1}class Yd{constructor(e,n,i,r,o,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(ds.add(this),Ic||(Ic=!0,ct.read(_g),ct.resolveKeyframes(Ig))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;if(e[0]===null){const o=r?.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const l=i.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}GS(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),ds.delete(this)}cancel(){this.state==="scheduled"&&(ds.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const ek=t=>t.startsWith("--");function tk(t,e,n){ek(e)?t.style.setProperty(e,n):t.style[e]=n}const nk=Ld(()=>window.ScrollTimeline!==void 0),ik={};function sk(t,e){const n=Ld(t);return()=>ik[e]??n()}const Ng=sk(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ir=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,kh={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ir([0,.65,.55,1]),circOut:Ir([.55,0,1,.45]),backIn:Ir([.31,.01,.66,-.59]),backOut:Ir([.33,1.53,.69,.99])};function Ag(t,e){if(t)return typeof t=="function"?Ng()?Tg(t,e):"ease-out":gg(t)?Ir(t):Array.isArray(t)?t.map(n=>Ag(n,e)||kh.easeOut):kh[t]}function rk(t,e,n,{delay:i=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:n};c&&(u.offset=c);const p=Ag(l,r);Array.isArray(p)&&(u.easing=p);const h={delay:i,duration:r,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),t.animate(u,h)}function Mg(t){return typeof t=="function"&&"applyToOptions"in t}function ok({type:t,...e}){return Mg(t)&&Ng()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class ak extends Kd{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:i,keyframes:r,pseudoElement:o,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!o,this.allowFlatten=a,this.options=e,Od(typeof e.type!="string");const d=ok(e);this.animation=rk(n,i,r,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=qd(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):tk(n,i,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return wn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+wn(e)}get time(){return wn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Zn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&nk()?(this.animation.timeline=e,Tn):n(this)}}const Pg={anticipate:hg,backInOut:ug,circInOut:fg};function lk(t){return t in Pg}function ck(t){typeof t.ease=="string"&&lk(t.ease)&&(t.ease=Pg[t.ease])}const wh=10;class dk extends ak{constructor(e){ck(e),Rg(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:i,onComplete:r,element:o,...a}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const l=new Jd({...a,autoplay:!1}),c=Zn(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-wh).value,l.sample(c).value,wh),l.stop()}}const Ch=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Hi.test(t)||t==="0")&&!t.startsWith("url("));function uk(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function hk(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=Ch(r,e),l=Ch(o,e);return!a||!l?!1:uk(t)||(n==="spring"||Mg(n))&&i}function Ac(t){t.duration=0,t.type="keyframes"}const pk=new Set(["opacity","clipPath","filter","transform"]),fk=Ld(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function mk(t){const{motionValue:e,name:n,repeatDelay:i,repeatType:r,damping:o,type:a}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return fk()&&n&&pk.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&o!==0&&a!=="inertia"}const gk=40;class xk extends Kd{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",keyframes:l,name:c,motionValue:d,element:u,...p}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=un.now();const h={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:o,repeatType:a,name:c,motionValue:d,element:u,...p},m=u?.KeyframeResolver||Yd;this.keyframeResolver=new m(l,(x,g,y)=>this.onKeyframesResolved(x,g,h,!y),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,n,i,r){this.keyframeResolver=void 0;const{name:o,type:a,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=un.now(),hk(e,o,a,l)||((Si.instantAnimations||!c)&&u?.(qd(e,i,n)),e[0]=e[e.length-1],Ac(i),i.repeat=0);const h={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>gk?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:e},m=!d&&mk(h)?new dk({...h,element:h.motionValue.owner.current}):new Jd(h);m.finished.then(()=>this.notifyFinished()).catch(Tn),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),QS()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const yk=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function bk(t){const e=yk.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function Dg(t,e,n=1){const[i,r]=bk(t);if(!i)return;const o=window.getComputedStyle(e).getPropertyValue(i);if(o){const a=o.trim();return ig(a)?parseFloat(a):a}return Wd(r)?Dg(r,e,n+1):r}function Xd(t,e){return t?.[e]??t?.default??t}const Og=new Set(["width","height","top","left","right","bottom",...fr]),vk={test:t=>t==="auto",parse:t=>t},Lg=t=>e=>e.test(t),zg=[pr,ye,Qn,_i,uS,dS,vk],jh=t=>zg.find(Lg(t));function Sk(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||rg(t):!0}const kk=new Set(["brightness","contrast","saturate","opacity"]);function wk(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(Vd)||[];if(!i)return t;const r=n.replace(i,"");let o=kk.has(e)?1:0;return i!==n&&(o*=100),e+"("+o+r+")"}const Ck=/\b([a-z-]*)\(.*?\)/gu,Mc={...Hi,getAnimatableNone:t=>{const e=t.match(Ck);return e?e.map(wk).join(" "):t}},Th={...pr,transform:Math.round},jk={rotate:_i,rotateX:_i,rotateY:_i,rotateZ:_i,scale:Ro,scaleX:Ro,scaleY:Ro,scaleZ:Ro,skew:_i,skewX:_i,skewY:_i,distance:ye,translateX:ye,translateY:ye,translateZ:ye,x:ye,y:ye,z:ye,perspective:ye,transformPerspective:ye,opacity:Jr,originX:ph,originY:ph,originZ:ye},Zd={borderWidth:ye,borderTopWidth:ye,borderRightWidth:ye,borderBottomWidth:ye,borderLeftWidth:ye,borderRadius:ye,radius:ye,borderTopLeftRadius:ye,borderTopRightRadius:ye,borderBottomRightRadius:ye,borderBottomLeftRadius:ye,width:ye,maxWidth:ye,height:ye,maxHeight:ye,top:ye,right:ye,bottom:ye,left:ye,padding:ye,paddingTop:ye,paddingRight:ye,paddingBottom:ye,paddingLeft:ye,margin:ye,marginTop:ye,marginRight:ye,marginBottom:ye,marginLeft:ye,backgroundPositionX:ye,backgroundPositionY:ye,...jk,zIndex:Th,fillOpacity:Jr,strokeOpacity:Jr,numOctaves:Th},Tk={...Zd,color:jt,backgroundColor:jt,outlineColor:jt,fill:jt,stroke:jt,borderColor:jt,borderTopColor:jt,borderRightColor:jt,borderBottomColor:jt,borderLeftColor:jt,filter:Mc,WebkitFilter:Mc},Bg=t=>Tk[t];function Fg(t,e){let n=Bg(t);return n!==Mc&&(n=Hi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Ek=new Set(["auto","none","0"]);function Rk(t,e,n){let i=0,r;for(;i<t.length&&!r;){const o=t[i];typeof o=="string"&&!Ek.has(o)&&Yr(o).values.length&&(r=t[i]),i++}if(r&&n)for(const o of e)t[o]=Fg(n,r)}class Ik extends Yd{constructor(e,n,i,r,o){super(e,n,i,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),Wd(d))){const u=Dg(d,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!Og.has(i)||e.length!==2)return;const[r,o]=e,a=jh(r),l=jh(o);if(a!==l)if(Sh(a)&&Sh(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else cs[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)(e[r]===null||Sk(e[r]))&&i.push(r);i.length&&Rk(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=cs[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){const{element:e,name:n,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const r=e.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,a=i[o];i[o]=cs[n](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function _k(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const Ug=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function Wg(t){return sg(t)&&"offsetHeight"in t}const Eh=30,Nk=t=>!isNaN(parseFloat(t));class Ak{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=un.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=un.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Nk(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new zd);const i=this.events[e].add(n);return e==="change"?()=>{i(),ct.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=un.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Eh)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Eh);return og(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function sr(t,e){return new Ak(t,e)}const{schedule:Qd}=xg(queueMicrotask,!1),On={x:!1,y:!1};function Vg(){return On.x||On.y}function Mk(t){return t==="x"||t==="y"?On[t]?null:(On[t]=!0,()=>{On[t]=!1}):On.x||On.y?null:(On.x=On.y=!0,()=>{On.x=On.y=!1})}function $g(t,e){const n=_k(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function Rh(t){return!(t.pointerType==="touch"||Vg())}function Pk(t,e,n={}){const[i,r,o]=$g(t,n),a=l=>{if(!Rh(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=p=>{Rh(p)&&(d(p),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return i.forEach(l=>{l.addEventListener("pointerenter",a,r)}),o}const Gg=(t,e)=>e?t===e?!0:Gg(t,e.parentElement):!1,eu=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,Dk=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Ok(t){return Dk.has(t.tagName)||t.tabIndex!==-1}const Ko=new WeakSet;function Ih(t){return e=>{e.key==="Enter"&&t(e)}}function Cl(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Lk=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=Ih(()=>{if(Ko.has(n))return;Cl(n,"down");const r=Ih(()=>{Cl(n,"up")}),o=()=>Cl(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function _h(t){return eu(t)&&!Vg()}function zk(t,e,n={}){const[i,r,o]=$g(t,n),a=l=>{const c=l.currentTarget;if(!_h(l))return;Ko.add(c);const d=e(c,l),u=(m,x)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",h),Ko.has(c)&&Ko.delete(c),_h(m)&&typeof d=="function"&&d(m,{success:x})},p=m=>{u(m,c===window||c===document||n.useGlobalTarget||Gg(c,m.target))},h=m=>{u(m,!1)};window.addEventListener("pointerup",p,r),window.addEventListener("pointercancel",h,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",a,r),Wg(l)&&(l.addEventListener("focus",d=>Lk(d,r)),!Ok(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function Hg(t){return sg(t)&&"ownerSVGElement"in t}function Bk(t){return Hg(t)&&t.tagName==="svg"}const Kt=t=>!!(t&&t.getVelocity),Fk=[...zg,jt,Hi],Uk=t=>Fk.find(Lg(t)),tu=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Nh(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Wk(...t){return e=>{let n=!1;const i=t.map(r=>{const o=Nh(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():Nh(t[r],null)}}}}function Vk(...t){return f.useCallback(Wk(...t),t)}class $k extends f.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=Wg(i)&&i.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=r-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Gk({children:t,isPresent:e,anchorX:n,root:i}){const r=f.useId(),o=f.useRef(null),a=f.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=f.useContext(tu),c=Vk(o,t?.ref);return f.useInsertionEffect(()=>{const{width:d,height:u,top:p,left:h,right:m}=a.current;if(e||!o.current||!d||!u)return;const x=n==="left"?`left: ${h}`:`right: ${m}`;o.current.dataset.motionPopId=r;const g=document.createElement("style");l&&(g.nonce=l);const y=i??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${x}px !important;
            top: ${p}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[e]),s.jsx($k,{isPresent:e,childRef:o,sizeRef:a,children:f.cloneElement(t,{ref:c})})}const Hk=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:o,mode:a,anchorX:l,root:c})=>{const d=Ad(qk),u=f.useId();let p=!0,h=f.useMemo(()=>(p=!1,{id:u,initial:e,isPresent:n,custom:r,onExitComplete:m=>{d.set(m,!0);for(const x of d.values())if(!x)return;i&&i()},register:m=>(d.set(m,!1),()=>d.delete(m))}),[n,d,i]);return o&&p&&(h={...h}),f.useMemo(()=>{d.forEach((m,x)=>d.set(x,!1))},[n]),f.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),a==="popLayout"&&(t=s.jsx(Gk,{isPresent:n,anchorX:l,root:c,children:t})),s.jsx(Ha.Provider,{value:h,children:t})};function qk(){return new Map}function qg(t=!0){const e=f.useContext(Ha);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,o=f.useId();f.useEffect(()=>{if(t)return r(o)},[t]);const a=f.useCallback(()=>t&&i&&i(o),[o,i,t]);return!n&&i?[!1,a]:[!0]}const Io=t=>t.key||"";function Ah(t){const e=[];return f.Children.forEach(t,n=>{f.isValidElement(n)&&e.push(n)}),e}const He=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[d,u]=qg(a),p=f.useMemo(()=>Ah(t),[t]),h=a&&!d?[]:p.map(Io),m=f.useRef(!0),x=f.useRef(p),g=Ad(()=>new Map),[y,v]=f.useState(p),[w,k]=f.useState(p);ng(()=>{m.current=!1,x.current=p;for(let j=0;j<w.length;j++){const C=Io(w[j]);h.includes(C)?g.delete(C):g.get(C)!==!0&&g.set(C,!1)}},[w,h.length,h.join("-")]);const S=[];if(p!==y){let j=[...p];for(let C=0;C<w.length;C++){const T=w[C],_=Io(T);h.includes(_)||(j.splice(C,0,T),S.push(T))}return o==="wait"&&S.length&&(j=S),k(Ah(j)),v(p),null}const{forceRender:b}=f.useContext(Nd);return s.jsx(s.Fragment,{children:w.map(j=>{const C=Io(j),T=a&&!d?!1:p===w||h.includes(C),_=()=>{if(g.has(C))g.set(C,!0);else return;let E=!0;g.forEach(N=>{N||(E=!1)}),E&&(b?.(),k(x.current),a&&u?.(),i&&i())};return s.jsx(Hk,{isPresent:T,initial:!m.current||n?void 0:!1,custom:e,presenceAffectsLayout:r,mode:o,root:c,onExitComplete:T?void 0:_,anchorX:l,children:j},C)})})},Kg=f.createContext({strict:!1}),Mh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},rr={};for(const t in Mh)rr[t]={isEnabled:e=>Mh[t].some(n=>!!e[n])};function Kk(t){for(const e in t)rr[e]={...rr[e],...t[e]}}const Jk=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ba(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Jk.has(t)}let Jg=t=>!ba(t);function Yk(t){typeof t=="function"&&(Jg=e=>e.startsWith("on")?!ba(e):t(e))}try{Yk(require("@emotion/is-prop-valid").default)}catch{}function Xk(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(Jg(r)||n===!0&&ba(r)||!e&&!ba(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const qa=f.createContext({});function Ka(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Xr(t){return typeof t=="string"||Array.isArray(t)}const nu=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],iu=["initial",...nu];function Ja(t){return Ka(t.animate)||iu.some(e=>Xr(t[e]))}function Yg(t){return!!(Ja(t)||t.variants)}function Zk(t,e){if(Ja(t)){const{initial:n,animate:i}=t;return{initial:n===!1||Xr(n)?n:void 0,animate:Xr(i)?i:void 0}}return t.inherit!==!1?e:{}}function Qk(t){const{initial:e,animate:n}=Zk(t,f.useContext(qa));return f.useMemo(()=>({initial:e,animate:n}),[Ph(e),Ph(n)])}function Ph(t){return Array.isArray(t)?t.join(" "):t}const Zr={};function ew(t){for(const e in t)Zr[e]=t[e],Ud(e)&&(Zr[e].isCSSVariable=!0)}function Xg(t,{layout:e,layoutId:n}){return mr.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Zr[t]||t==="opacity")}const tw={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},nw=fr.length;function iw(t,e,n){let i="",r=!0;for(let o=0;o<nw;o++){const a=fr[o],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=Ug(l,Zd[a]);if(!c){r=!1;const u=tw[a]||a;i+=`${u}(${d}) `}n&&(e[a]=d)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function su(t,e,n){const{style:i,vars:r,transformOrigin:o}=t;let a=!1,l=!1;for(const c in e){const d=e[c];if(mr.has(c)){a=!0;continue}else if(Ud(c)){r[c]=d;continue}else{const u=Ug(d,Zd[c]);c.startsWith("origin")?(l=!0,o[c]=u):i[c]=u}}if(e.transform||(a||n?i.transform=iw(e,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${c} ${d} ${u}`}}const ru=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Zg(t,e,n){for(const i in e)!Kt(e[i])&&!Xg(i,n)&&(t[i]=e[i])}function sw({transformTemplate:t},e){return f.useMemo(()=>{const n=ru();return su(n,e,t),Object.assign({},n.vars,n.style)},[e])}function rw(t,e){const n=t.style||{},i={};return Zg(i,n,t),Object.assign(i,sw(t,e)),i}function ow(t,e){const n={},i=rw(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const aw={offset:"stroke-dashoffset",array:"stroke-dasharray"},lw={offset:"strokeDashoffset",array:"strokeDasharray"};function cw(t,e,n=1,i=0,r=!0){t.pathLength=1;const o=r?aw:lw;t[o.offset]=ye.transform(-i);const a=ye.transform(e),l=ye.transform(n);t[o.array]=`${a} ${l}`}function Qg(t,{attrX:e,attrY:n,attrScale:i,pathLength:r,pathSpacing:o=1,pathOffset:a=0,...l},c,d,u){if(su(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:p,style:h}=t;p.transform&&(h.transform=p.transform,delete p.transform),(h.transform||p.transformOrigin)&&(h.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),h.transform&&(h.transformBox=u?.transformBox??"fill-box",delete p.transformBox),e!==void 0&&(p.x=e),n!==void 0&&(p.y=n),i!==void 0&&(p.scale=i),r!==void 0&&cw(p,r,o,a,!1)}const ex=()=>({...ru(),attrs:{}}),tx=t=>typeof t=="string"&&t.toLowerCase()==="svg";function dw(t,e,n,i){const r=f.useMemo(()=>{const o=ex();return Qg(o,e,tx(i),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};Zg(o,t.style,t),r.style={...o,...r.style}}return r}const uw=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ou(t){return typeof t!="string"||t.includes("-")?!1:!!(uw.indexOf(t)>-1||/[A-Z]/u.test(t))}function hw(t,e,n,{latestValues:i},r,o=!1){const l=(ou(t)?dw:ow)(e,i,r,t),c=Xk(e,typeof t=="string",o),d=t!==f.Fragment?{...c,...l,ref:n}:{},{children:u}=e,p=f.useMemo(()=>Kt(u)?u.get():u,[u]);return f.createElement(t,{...d,children:p})}function Dh(t){const e=[{},{}];return t?.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function au(t,e,n,i){if(typeof e=="function"){const[r,o]=Dh(i);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=Dh(i);e=e(n!==void 0?n:t.custom,r,o)}return e}function Jo(t){return Kt(t)?t.get():t}function pw({scrapeMotionValuesFromProps:t,createRenderState:e},n,i,r){return{latestValues:fw(n,i,r,t),renderState:e()}}function fw(t,e,n,i){const r={},o=i(t,{});for(const h in o)r[h]=Jo(o[h]);let{initial:a,animate:l}=t;const c=Ja(t),d=Yg(t);e&&d&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let u=n?n.initial===!1:!1;u=u||a===!1;const p=u?l:a;if(p&&typeof p!="boolean"&&!Ka(p)){const h=Array.isArray(p)?p:[p];for(let m=0;m<h.length;m++){const x=au(t,h[m]);if(x){const{transitionEnd:g,transition:y,...v}=x;for(const w in v){let k=v[w];if(Array.isArray(k)){const S=u?k.length-1:0;k=k[S]}k!==null&&(r[w]=k)}for(const w in g)r[w]=g[w]}}}return r}const nx=t=>(e,n)=>{const i=f.useContext(qa),r=f.useContext(Ha),o=()=>pw(t,e,i,r);return n?o():Ad(o)};function lu(t,e,n){const{style:i}=t,r={};for(const o in i)(Kt(i[o])||e.style&&Kt(e.style[o])||Xg(o,t)||n?.getValue(o)?.liveStyle!==void 0)&&(r[o]=i[o]);return r}const mw=nx({scrapeMotionValuesFromProps:lu,createRenderState:ru});function ix(t,e,n){const i=lu(t,e,n);for(const r in t)if(Kt(t[r])||Kt(e[r])){const o=fr.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[o]=t[r]}return i}const gw=nx({scrapeMotionValuesFromProps:ix,createRenderState:ex}),xw=Symbol.for("motionComponentSymbol");function zs(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function yw(t,e,n){return f.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):zs(n)&&(n.current=i))},[e])}const cu=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),bw="framerAppearId",sx="data-"+cu(bw),rx=f.createContext({});function vw(t,e,n,i,r){const{visualElement:o}=f.useContext(qa),a=f.useContext(Kg),l=f.useContext(Ha),c=f.useContext(tu).reducedMotion,d=f.useRef(null);i=i||a.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:o,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,p=f.useContext(rx);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&Sw(d.current,n,r,p);const h=f.useRef(!1);f.useInsertionEffect(()=>{u&&h.current&&u.update(n,l)});const m=n[sx],x=f.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return ng(()=>{u&&(h.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),f.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),x.current=!1),u.enteringChildren=void 0)}),u}function Sw(t,e,n,i){const{layoutId:r,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:ox(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||l&&zs(l),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function ox(t){if(t)return t.options.allowProjection!==!1?t.projection:ox(t.parent)}function jl(t,{forwardMotionProps:e=!1}={},n,i){n&&Kk(n);const r=ou(t)?gw:mw;function o(l,c){let d;const u={...f.useContext(tu),...l,layoutId:kw(l)},{isStatic:p}=u,h=Qk(l),m=r(l,p);if(!p&&Md){ww();const x=Cw(u);d=x.MeasureLayout,h.visualElement=vw(t,m,u,i,x.ProjectionNode)}return s.jsxs(qa.Provider,{value:h,children:[d&&h.visualElement?s.jsx(d,{visualElement:h.visualElement,...u}):null,hw(t,l,yw(m,h.visualElement,c),m,p,e)]})}o.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=f.forwardRef(o);return a[xw]=t,a}function kw({layoutId:t}){const e=f.useContext(Nd).id;return e&&t!==void 0?e+"-"+t:t}function ww(t,e){f.useContext(Kg).strict}function Cw(t){const{drag:e,layout:n}=rr;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function jw(t,e){if(typeof Proxy>"u")return jl;const n=new Map,i=(o,a)=>jl(o,a,t,e),r=(o,a)=>i(o,a);return new Proxy(r,{get:(o,a)=>a==="create"?i:(n.has(a)||n.set(a,jl(a,void 0,t,e)),n.get(a))})}function ax({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function Tw({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function Ew(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Tl(t){return t===void 0||t===1}function Pc({scale:t,scaleX:e,scaleY:n}){return!Tl(t)||!Tl(e)||!Tl(n)}function ns(t){return Pc(t)||lx(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function lx(t){return Oh(t.x)||Oh(t.y)}function Oh(t){return t&&t!=="0%"}function va(t,e,n){const i=t-n,r=e*i;return n+r}function Lh(t,e,n,i,r){return r!==void 0&&(t=va(t,r,i)),va(t,n,i)+e}function Dc(t,e=0,n=1,i,r){t.min=Lh(t.min,e,n,i,r),t.max=Lh(t.max,e,n,i,r)}function cx(t,{x:e,y:n}){Dc(t.x,e.translate,e.scale,e.originPoint),Dc(t.y,n.translate,n.scale,n.originPoint)}const zh=.999999999999,Bh=1.0000000000001;function Rw(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let o,a;for(let l=0;l<r;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Fs(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,cx(t,a)),i&&ns(o.latestValues)&&Fs(t,o.latestValues))}e.x<Bh&&e.x>zh&&(e.x=1),e.y<Bh&&e.y>zh&&(e.y=1)}function Bs(t,e){t.min=t.min+e,t.max=t.max+e}function Fh(t,e,n,i,r=.5){const o=ut(t.min,t.max,r);Dc(t,e,n,o,i)}function Fs(t,e){Fh(t.x,e.x,e.scaleX,e.scale,e.originX),Fh(t.y,e.y,e.scaleY,e.scale,e.originY)}function dx(t,e){return ax(Ew(t.getBoundingClientRect(),e))}function Iw(t,e,n){const i=dx(t,n),{scroll:r}=e;return r&&(Bs(i.x,r.offset.x),Bs(i.y,r.offset.y)),i}const Uh=()=>({translate:0,scale:1,origin:0,originPoint:0}),Us=()=>({x:Uh(),y:Uh()}),Wh=()=>({min:0,max:0}),_t=()=>({x:Wh(),y:Wh()}),Oc={current:null},ux={current:!1};function _w(){if(ux.current=!0,!!Md)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Oc.current=t.matches;t.addEventListener("change",e),e()}else Oc.current=!1}const Nw=new WeakMap;function Aw(t,e,n){for(const i in e){const r=e[i],o=n[i];if(Kt(r))t.addValue(i,r);else if(Kt(o))t.addValue(i,sr(r,{owner:t}));else if(o!==r)if(t.hasValue(i)){const a=t.getValue(i);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=t.getStaticValue(i);t.addValue(i,sr(a!==void 0?a:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const Vh=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Mw{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Yd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=un.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,ct.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=Ja(n),this.isVariantNode=Yg(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...p}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in p){const m=p[h];c[h]!==void 0&&Kt(m)&&m.set(c[h])}}mount(e){this.current=e,Nw.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),ux.current||_w(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Oc.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Gi(this.notifyUpdate),Gi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=mr.has(e);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&ct.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in rr){const n=rr[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):_t()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Vh.length;i++){const r=Vh[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=e[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=Aw(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=sr(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(ig(i)||rg(i))?i=parseFloat(i):!Uk(i)&&Hi.test(n)&&(i=Fg(e,n)),this.setBaseTarget(e,Kt(i)?i.get():i)),Kt(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const o=au(this.props,n,this.presenceContext?.custom);o&&(i=o[e])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Kt(r)?r:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new zd),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Qd.render(this.render)}}class hx extends Mw{constructor(){super(...arguments),this.KeyframeResolver=Ik}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Kt(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function px(t,{style:e,vars:n},i,r){const o=t.style;let a;for(a in e)o[a]=e[a];r?.applyProjectionStyles(o,i);for(a in n)o.setProperty(a,n[a])}function Pw(t){return window.getComputedStyle(t)}class Dw extends hx{constructor(){super(...arguments),this.type="html",this.renderInstance=px}readValueFromInstance(e,n){if(mr.has(n))return this.projection?.isProjecting?Ec(n):KS(e,n);{const i=Pw(e),r=(Ud(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return dx(e,n)}build(e,n,i){su(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return lu(e,n,i)}}const fx=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ow(t,e,n,i){px(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(fx.has(r)?r:cu(r),e.attrs[r])}class Lw extends hx{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=_t}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(mr.has(n)){const i=Bg(n);return i&&i.default||0}return n=fx.has(n)?n:cu(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return ix(e,n,i)}build(e,n,i){Qg(e,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,n,i,r){Ow(e,n,i,r)}mount(e){this.isSVGTag=tx(e.tagName),super.mount(e)}}const zw=(t,e)=>ou(t)?new Lw(e):new Dw(e,{allowProjection:t!==f.Fragment});function Hs(t,e,n){const i=t.getProps();return au(i,e,n!==void 0?n:i.custom,t)}const Lc=t=>Array.isArray(t);function Bw(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,sr(n))}function Fw(t){return Lc(t)?t[t.length-1]||0:t}function Uw(t,e){const n=Hs(t,e);let{transitionEnd:i={},transition:r={},...o}=n||{};o={...o,...i};for(const a in o){const l=Fw(o[a]);Bw(t,a,l)}}function Ww(t){return!!(Kt(t)&&t.add)}function zc(t,e){const n=t.getValue("willChange");if(Ww(n))return n.add(e);if(!n&&Si.WillChange){const i=new Si.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function mx(t){return t.props[sx]}const Vw=t=>t!==null;function $w(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(Vw),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return r[o]}const Gw={type:"spring",stiffness:500,damping:25,restSpeed:10},Hw=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),qw={type:"keyframes",duration:.8},Kw={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Jw=(t,{keyframes:e})=>e.length>2?qw:mr.has(t)?t.startsWith("scale")?Hw(e[1]):Gw:Kw;function Yw({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const du=(t,e,n,i={},r,o)=>a=>{const l=Xd(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Zn(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:h=>{e.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:o?void 0:r};Yw(l)||Object.assign(u,Jw(t,u)),u.duration&&(u.duration=Zn(u.duration)),u.repeatDelay&&(u.repeatDelay=Zn(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Ac(u),u.delay===0&&(p=!0)),(Si.instantAnimations||Si.skipAnimations)&&(p=!0,Ac(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,p&&!o&&e.get()!==void 0){const h=$w(u.keyframes,l);if(h!==void 0){ct.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new Jd(u):new xk(u)};function Xw({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function gx(t,e,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(o=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const p=t.getValue(u,t.latestValues[u]??null),h=l[u];if(h===void 0||d&&Xw(d,u))continue;const m={delay:n,...Xd(o||{},u)},x=p.get();if(x!==void 0&&!p.isAnimating&&!Array.isArray(h)&&h===x&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const v=mx(t);if(v){const w=window.MotionHandoffAnimation(v,u,ct);w!==null&&(m.startTime=w,g=!0)}}zc(t,u),p.start(du(u,p,h,t.shouldReduceMotion&&Og.has(u)?{type:!1}:m,t,g));const y=p.animation;y&&c.push(y)}return a&&Promise.all(c).then(()=>{ct.update(()=>{a&&Uw(t,a)})}),c}function xx(t,e,n,i=0,r=1){const o=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=t.size,l=(a-1)*i;return typeof n=="function"?n(o,a):r===1?o*i:l-o*i}function Bc(t,e,n={}){const i=Hs(t,e,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const o=i?()=>Promise.all(gx(t,i,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:p}=r;return Zw(t,e,c,d,u,p,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(n.delay)])}function Zw(t,e,n=0,i=0,r=0,o=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Bc(c,e,{...a,delay:n+(typeof i=="function"?0:i)+xx(t.variantChildren,c,i,r,o)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function Qw(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(o=>Bc(t,o,n));i=Promise.all(r)}else if(typeof e=="string")i=Bc(t,e,n);else{const r=typeof e=="function"?Hs(t,e,n.custom):e;i=Promise.all(gx(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}function yx(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}const eC=iu.length;function bx(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?bx(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<eC;n++){const i=iu[n],r=t.props[i];(Xr(r)||r===!1)&&(e[i]=r)}return e}const tC=[...nu].reverse(),nC=nu.length;function iC(t){return e=>Promise.all(e.map(({animation:n,options:i})=>Qw(t,n,i)))}function sC(t){let e=iC(t),n=$h(),i=!0;const r=c=>(d,u)=>{const p=Hs(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(p){const{transition:h,transitionEnd:m,...x}=p;d={...d,...x,...m}}return d};function o(c){e=c(t)}function a(c){const{props:d}=t,u=bx(t.parent)||{},p=[],h=new Set;let m={},x=1/0;for(let y=0;y<nC;y++){const v=tC[y],w=n[v],k=d[v]!==void 0?d[v]:u[v],S=Xr(k),b=v===c?w.isActive:null;b===!1&&(x=y);let j=k===u[v]&&k!==d[v]&&S;if(j&&i&&t.manuallyAnimateOnMount&&(j=!1),w.protectedKeys={...m},!w.isActive&&b===null||!k&&!w.prevProp||Ka(k)||typeof k=="boolean")continue;const C=rC(w.prevProp,k);let T=C||v===c&&w.isActive&&!j&&S||y>x&&S,_=!1;const E=Array.isArray(k)?k:[k];let N=E.reduce(r(v),{});b===!1&&(N={});const{prevResolvedValues:L={}}=w,V={...L,...N},D=B=>{T=!0,h.has(B)&&(_=!0,h.delete(B)),w.needsAnimating[B]=!0;const M=t.getValue(B);M&&(M.liveStyle=!1)};for(const B in V){const M=N[B],z=L[B];if(m.hasOwnProperty(B))continue;let U=!1;Lc(M)&&Lc(z)?U=!yx(M,z):U=M!==z,U?M!=null?D(B):h.add(B):M!==void 0&&h.has(B)?D(B):w.protectedKeys[B]=!0}w.prevProp=k,w.prevResolvedValues=N,w.isActive&&(m={...m,...N}),i&&t.blockInitialAnimation&&(T=!1);const A=j&&C;T&&(!A||_)&&p.push(...E.map(B=>{const M={type:v};if(typeof B=="string"&&i&&!A&&t.manuallyAnimateOnMount&&t.parent){const{parent:z}=t,U=Hs(z,B);if(z.enteringChildren&&U){const{delayChildren:W}=U.transition||{};M.delay=xx(z.enteringChildren,t,W)}}return{animation:B,options:M}}))}if(h.size){const y={};if(typeof d.initial!="boolean"){const v=Hs(t,Array.isArray(d.initial)?d.initial[0]:d.initial);v&&v.transition&&(y.transition=v.transition)}h.forEach(v=>{const w=t.getBaseTarget(v),k=t.getValue(v);k&&(k.liveStyle=!0),y[v]=w??null}),p.push({animation:y})}let g=!!p.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(g=!1),i=!1,g?e(p):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(p=>p.animationState?.setActive(c,d)),n[c].isActive=d;const u=a(c);for(const p in n)n[p].protectedKeys={};return u}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=$h()}}}function rC(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!yx(e,t):!1}function ts(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function $h(){return{animate:ts(!0),whileInView:ts(),whileHover:ts(),whileTap:ts(),whileDrag:ts(),whileFocus:ts(),exit:ts()}}class Yi{constructor(e){this.isMounted=!1,this.node=e}update(){}}class oC extends Yi{constructor(e){super(e),e.animationState||(e.animationState=sC(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ka(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let aC=0;class lC extends Yi{constructor(){super(...arguments),this.id=aC++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const cC={animation:{Feature:oC},exit:{Feature:lC}};function Qr(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function xo(t){return{point:{x:t.pageX,y:t.pageY}}}const dC=t=>e=>eu(e)&&t(e,xo(e));function Dr(t,e,n,i){return Qr(t,e,dC(n),i)}const vx=1e-4,uC=1-vx,hC=1+vx,Sx=.01,pC=0-Sx,fC=0+Sx;function sn(t){return t.max-t.min}function mC(t,e,n){return Math.abs(t-e)<=n}function Gh(t,e,n,i=.5){t.origin=i,t.originPoint=ut(e.min,e.max,t.origin),t.scale=sn(n)/sn(e),t.translate=ut(n.min,n.max,t.origin)-t.originPoint,(t.scale>=uC&&t.scale<=hC||isNaN(t.scale))&&(t.scale=1),(t.translate>=pC&&t.translate<=fC||isNaN(t.translate))&&(t.translate=0)}function Or(t,e,n,i){Gh(t.x,e.x,n.x,i?i.originX:void 0),Gh(t.y,e.y,n.y,i?i.originY:void 0)}function Hh(t,e,n){t.min=n.min+e.min,t.max=t.min+sn(e)}function gC(t,e,n){Hh(t.x,e.x,n.x),Hh(t.y,e.y,n.y)}function qh(t,e,n){t.min=e.min-n.min,t.max=t.min+sn(e)}function Sa(t,e,n){qh(t.x,e.x,n.x),qh(t.y,e.y,n.y)}function vn(t){return[t("x"),t("y")]}const kx=({current:t})=>t?t.ownerDocument.defaultView:null,Kh=(t,e)=>Math.abs(t-e);function xC(t,e){const n=Kh(t.x,e.x),i=Kh(t.y,e.y);return Math.sqrt(n**2+i**2)}class wx{constructor(e,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:o=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Rl(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,x=xC(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!x)return;const{point:g}=h,{timestamp:y}=Wt;this.history.push({...g,timestamp:y});const{onStart:v,onMove:w}=this.handlers;m||(v&&v(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),w&&w(this.lastMoveEvent,h)},this.handlePointerMove=(h,m)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=El(m,this.transformPagePoint),ct.update(this.updatePoint,!0)},this.handlePointerUp=(h,m)=>{this.end();const{onEnd:x,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=Rl(h.type==="pointercancel"?this.lastMoveEventInfo:El(m,this.transformPagePoint),this.history);this.startEvent&&x&&x(h,v),g&&g(h,v)},!eu(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=a,this.contextWindow=r||window;const l=xo(e),c=El(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=Wt;this.history=[{...d,timestamp:u}];const{onSessionStart:p}=n;p&&p(e,Rl(c,this.history)),this.removeListeners=fo(Dr(this.contextWindow,"pointermove",this.handlePointerMove),Dr(this.contextWindow,"pointerup",this.handlePointerUp),Dr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Gi(this.updatePoint)}}function El(t,e){return e?{point:e(t.point)}:t}function Jh(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Rl({point:t},e){return{point:t,delta:Jh(t,Cx(e)),offset:Jh(t,yC(e)),velocity:bC(e,.1)}}function yC(t){return t[0]}function Cx(t){return t[t.length-1]}function bC(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Cx(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>Zn(e)));)n--;if(!i)return{x:0,y:0};const o=wn(r.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function vC(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?ut(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?ut(n,t,i.max):Math.min(t,n)),t}function Yh(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function SC(t,{top:e,left:n,bottom:i,right:r}){return{x:Yh(t.x,n,r),y:Yh(t.y,e,i)}}function Xh(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function kC(t,e){return{x:Xh(t.x,e.x),y:Xh(t.y,e.y)}}function wC(t,e){let n=.5;const i=sn(t),r=sn(e);return r>i?n=Kr(e.min,e.max-i,t.min):i>r&&(n=Kr(t.min,t.max-r,e.min)),vi(0,1,n)}function CC(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Fc=.35;function jC(t=Fc){return t===!1?t=0:t===!0&&(t=Fc),{x:Zh(t,"left","right"),y:Zh(t,"top","bottom")}}function Zh(t,e,n){return{min:Qh(t,e),max:Qh(t,n)}}function Qh(t,e){return typeof t=="number"?t:t[e]||0}const TC=new WeakMap;class EC{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=_t(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const o=p=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(xo(p).point)},a=(p,h)=>{const{drag:m,dragPropagation:x,onDragStart:g}=this.getProps();if(m&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Mk(m),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),vn(v=>{let w=this.getAxisMotionValue(v).get()||0;if(Qn.test(w)){const{projection:k}=this.visualElement;if(k&&k.layout){const S=k.layout.layoutBox[v];S&&(w=sn(S)*(parseFloat(w)/100))}}this.originPoint[v]=w}),g&&ct.postRender(()=>g(p,h)),zc(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},l=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h;const{dragPropagation:m,dragDirectionLock:x,onDirectionLock:g,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:v}=h;if(x&&this.currentDirection===null){this.currentDirection=RC(v),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,v),this.updateAxis("y",h.point,v),this.visualElement.render(),y&&y(p,h)},c=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h,this.stop(p,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>vn(p=>this.getAnimationState(p)==="paused"&&this.getAxisMotionValue(p).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new wx(e,{onSessionStart:o,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:kx(this.visualElement)})}stop(e,n){const i=e||this.latestPointerEvent,r=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!r||!i)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&ct.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!_o(e,r,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(a=vC(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&zs(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=SC(i.layoutBox,e):this.constraints=!1,this.elastic=jC(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&vn(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=CC(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!zs(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=Iw(i,r.root,this.visualElement.getTransformPagePoint());let a=kC(r.layout.layoutBox,o);if(n){const l=n(Tw(a));this.hasMutatedConstraints=!!l,l&&(a=ax(l))}return a}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=vn(u=>{if(!_o(u,n,this.currentDirection))return;let p=c&&c[u]||{};a&&(p={min:0,max:0});const h=r?200:1e6,m=r?40:1e7,x={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...p};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return zc(this.visualElement,e),i.start(du(e,i,0,n,this.visualElement,!1))}stopAnimation(){vn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){vn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){vn(n=>{const{drag:i}=this.getProps();if(!_o(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:l}=r.layout.layoutBox[n];o.set(e[n]-ut(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!zs(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};vn(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();r[a]=wC({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),vn(a=>{if(!_o(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(ut(c,d,r[a]))})}addListeners(){if(!this.visualElement.current)return;TC.set(this.visualElement,this);const e=this.visualElement.current,n=Dr(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();zs(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),ct.read(i);const a=Qr(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(vn(u=>{const p=this.getAxisMotionValue(u);p&&(this.originPoint[u]+=c[u].translate,p.set(p.get()+c[u].translate))}),this.visualElement.render())}));return()=>{a(),n(),o(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=Fc,dragMomentum:l=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function _o(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function RC(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class IC extends Yi{constructor(e){super(e),this.removeGroupControls=Tn,this.removeListeners=Tn,this.controls=new EC(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tn}unmount(){this.removeGroupControls(),this.removeListeners()}}const ep=t=>(e,n)=>{t&&ct.postRender(()=>t(e,n))};class _C extends Yi{constructor(){super(...arguments),this.removePointerDownListener=Tn}onPointerDown(e){this.session=new wx(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:kx(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:ep(e),onStart:ep(n),onMove:i,onEnd:(o,a)=>{delete this.session,r&&ct.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=Dr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Yo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function tp(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const br={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ye.test(t))t=parseFloat(t);else return t;const n=tp(t,e.target.x),i=tp(t,e.target.y);return`${n}% ${i}%`}},NC={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=Hi.parse(t);if(r.length>5)return i;const o=Hi.createTransformer(t),a=typeof r[0]!="number"?1:0,l=n.x.scale*e.x,c=n.y.scale*e.y;r[0+a]/=l,r[1+a]/=c;const d=ut(l,c,.5);return typeof r[2+a]=="number"&&(r[2+a]/=d),typeof r[3+a]=="number"&&(r[3+a]/=d),o(r)}};let Il=!1;class AC extends f.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:o}=e;ew(MC),o&&(n.group&&n.group.add(o),i&&i.register&&r&&i.register(o),Il&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),Yo.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:o}=this.props,{projection:a}=i;return a&&(a.isPresent=o,Il=!0,r||e.layoutDependency!==n||n===void 0||e.isPresent!==o?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||ct.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Qd.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;Il=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function jx(t){const[e,n]=qg(),i=f.useContext(Nd);return s.jsx(AC,{...t,layoutGroup:i,switchLayoutGroup:f.useContext(rx),isPresent:e,safeToRemove:n})}const MC={borderRadius:{...br,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:br,borderTopRightRadius:br,borderBottomLeftRadius:br,borderBottomRightRadius:br,boxShadow:NC};function PC(t,e,n){const i=Kt(t)?t:sr(t);return i.start(du("",i,e,n)),i.animation}const DC=(t,e)=>t.depth-e.depth;class OC{constructor(){this.children=[],this.isDirty=!1}add(e){Pd(this.children,e),this.isDirty=!0}remove(e){Dd(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(DC),this.isDirty=!1,this.children.forEach(e)}}function LC(t,e){const n=un.now(),i=({timestamp:r})=>{const o=r-n;o>=e&&(Gi(i),t(o-e))};return ct.setup(i,!0),()=>Gi(i)}const Tx=["TopLeft","TopRight","BottomLeft","BottomRight"],zC=Tx.length,np=t=>typeof t=="string"?parseFloat(t):t,ip=t=>typeof t=="number"||ye.test(t);function BC(t,e,n,i,r,o){r?(t.opacity=ut(0,n.opacity??1,FC(i)),t.opacityExit=ut(e.opacity??1,0,UC(i))):o&&(t.opacity=ut(e.opacity??1,n.opacity??1,i));for(let a=0;a<zC;a++){const l=`border${Tx[a]}Radius`;let c=sp(e,l),d=sp(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||ip(c)===ip(d)?(t[l]=Math.max(ut(np(c),np(d),i),0),(Qn.test(d)||Qn.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||n.rotate)&&(t.rotate=ut(e.rotate||0,n.rotate||0,i))}function sp(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const FC=Ex(0,.5,pg),UC=Ex(.5,.95,Tn);function Ex(t,e,n){return i=>i<t?0:i>e?1:n(Kr(t,e,i))}function rp(t,e){t.min=e.min,t.max=e.max}function Pn(t,e){rp(t.x,e.x),rp(t.y,e.y)}function op(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function ap(t,e,n,i,r){return t-=e,t=va(t,1/n,i),r!==void 0&&(t=va(t,1/r,i)),t}function WC(t,e=0,n=1,i=.5,r,o=t,a=t){if(Qn.test(e)&&(e=parseFloat(e),e=ut(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=ut(o.min,o.max,i);t===o&&(l-=e),t.min=ap(t.min,e,n,l,r),t.max=ap(t.max,e,n,l,r)}function lp(t,e,[n,i,r],o,a){WC(t,e[n],e[i],e[r],e.scale,o,a)}const VC=["x","scaleX","originX"],$C=["y","scaleY","originY"];function cp(t,e,n,i){lp(t.x,e,VC,n?n.x:void 0,i?i.x:void 0),lp(t.y,e,$C,n?n.y:void 0,i?i.y:void 0)}function dp(t){return t.translate===0&&t.scale===1}function Rx(t){return dp(t.x)&&dp(t.y)}function up(t,e){return t.min===e.min&&t.max===e.max}function GC(t,e){return up(t.x,e.x)&&up(t.y,e.y)}function hp(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Ix(t,e){return hp(t.x,e.x)&&hp(t.y,e.y)}function pp(t){return sn(t.x)/sn(t.y)}function fp(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class HC{constructor(){this.members=[]}add(e){Pd(this.members,e),e.scheduleRender()}remove(e){if(Dd(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function qC(t,e,n){let i="";const r=t.x.translate/e.x,o=t.y.translate/e.y,a=n?.z||0;if((r||o||a)&&(i=`translate3d(${r}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:p,rotateY:h,skewX:m,skewY:x}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),p&&(i+=`rotateX(${p}deg) `),h&&(i+=`rotateY(${h}deg) `),m&&(i+=`skewX(${m}deg) `),x&&(i+=`skewY(${x}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const _l=["","X","Y","Z"],KC=1e3;let JC=0;function Nl(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function _x(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=mx(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",ct,!(r||o))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&_x(i)}function Nx({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(a={},l=e?.()){this.id=JC++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(ZC),this.nodes.forEach(nj),this.nodes.forEach(ij),this.nodes.forEach(QC)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new OC)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new zd),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=Hg(a)&&!Bk(a),this.instance=a;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,p=0;const h=()=>this.root.updateBlockedByResize=!1;ct.read(()=>{p=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==p&&(p=m,this.root.updateBlockedByResize=!0,u&&u(),u=LC(h,250),Yo.hasAnimatedSinceResize&&(Yo.hasAnimatedSinceResize=!1,this.nodes.forEach(xp)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:p,hasRelativeLayoutChanged:h,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||lj,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),v=!this.targetLayout||!Ix(this.targetLayout,m),w=!p&&h;if(this.options.layoutRoot||this.resumeFrom||w||p&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...Xd(x,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,w)}else p||xp(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Gi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(sj),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&_x(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(mp);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(gp);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(tj),this.nodes.forEach(YC),this.nodes.forEach(XC)):this.nodes.forEach(gp),this.clearAllSnapshots();const l=un.now();Wt.delta=vi(0,1e3/60,l-Wt.timestamp),Wt.timestamp=l,Wt.isProcessing=!0,bl.update.process(Wt),bl.preRender.process(Wt),bl.render.process(Wt),Wt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Qd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(ej),this.sharedNodes.forEach(rj)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ct.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ct.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!sn(this.snapshot.measuredBox.x)&&!sn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=_t(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Rx(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(l||ns(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),cj(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return _t();const l=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(dj))){const{scroll:d}=this.root;d&&(Bs(l.x,d.offset.x),Bs(l.y,d.offset.y))}return l}removeElementScroll(a){const l=_t();if(Pn(l,a),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:p}=d;d!==this.root&&u&&p.layoutScroll&&(u.wasRoot&&Pn(l,a),Bs(l.x,u.offset.x),Bs(l.y,u.offset.y))}return l}applyTransform(a,l=!1){const c=_t();Pn(c,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Fs(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ns(u.latestValues)&&Fs(c,u.latestValues)}return ns(this.latestValues)&&Fs(c,this.latestValues),c}removeTransform(a){const l=_t();Pn(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ns(d.latestValues))continue;Pc(d.latestValues)&&d.updateSnapshot();const u=_t(),p=d.measurePageBox();Pn(u,p),cp(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ns(this.latestValues)&&cp(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Wt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:p}=this.options;if(!this.layout||!(u||p))return;this.resolvedRelativeTargetAt=Wt.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=_t(),this.targetWithTransforms=_t()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),gC(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pn(this.target,this.layout.layoutBox),cx(this.target,this.targetDelta)):Pn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Pc(this.parent.latestValues)||lx(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=_t(),this.relativeTargetOrigin=_t(),Sa(this.relativeTargetOrigin,l,c),Pn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Wt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Pn(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,h=this.treeScale.y;Rw(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=_t());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(op(this.prevProjectionDelta.x,this.projectionDelta.x),op(this.prevProjectionDelta.y,this.projectionDelta.y)),Or(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==h||!fp(this.projectionDelta.x,this.prevProjectionDelta.x)||!fp(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Us(),this.projectionDelta=Us(),this.projectionDeltaWithTransform=Us()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},p=Us();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=_t(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,y=this.getStack(),v=!y||y.members.length<=1,w=!!(g&&!v&&this.options.crossfade===!0&&!this.path.some(aj));this.animationProgress=0;let k;this.mixTargetDelta=S=>{const b=S/1e3;yp(p.x,a.x,b),yp(p.y,a.y,b),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Sa(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),oj(this.relativeTarget,this.relativeTargetOrigin,h,b),k&&GC(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=_t()),Pn(k,this.relativeTarget)),g&&(this.animationValues=u,BC(u,d,this.latestValues,b,w,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Gi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ct.update(()=>{Yo.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=sr(0)),this.currentAnimation=PC(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(KC),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&Ax(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||_t();const p=sn(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+p;const h=sn(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+h}Pn(l,c),Fs(l,u),Or(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new HC),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Nl("z",a,d,this.animationValues);for(let u=0;u<_l.length;u++)Nl(`rotate${_l[u]}`,a,d,this.animationValues),Nl(`skew${_l[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Jo(l?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Jo(l?.pointerEvents)||""),this.hasProjected&&!ns(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=qC(this.projectionDeltaWithTransform,this.treeScale,u);c&&(p=c(u,p)),a.transform=p;const{x:h,y:m}=this.projectionDelta;a.transformOrigin=`${h.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in Zr){if(u[x]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:v}=Zr[x],w=p==="none"?u[x]:g(u[x],d);if(y){const k=y.length;for(let S=0;S<k;S++)a[y[S]]=w}else v?this.options.visualElement.renderState.vars[x]=w:a[x]=w}this.options.layoutId&&(a.pointerEvents=d===this?Jo(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(mp),this.root.sharedNodes.clear()}}}function YC(t){t.updateLayout()}function XC(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,o=e.source!==t.layout.source;r==="size"?vn(u=>{const p=o?e.measuredBox[u]:e.layoutBox[u],h=sn(p);p.min=n[u].min,p.max=p.min+h}):Ax(r,e.layoutBox,n)&&vn(u=>{const p=o?e.measuredBox[u]:e.layoutBox[u],h=sn(n[u]);p.max=p.min+h,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+h)});const a=Us();Or(a,n,e.layoutBox);const l=Us();o?Or(l,t.applyTransform(i,!0),e.measuredBox):Or(l,n,e.layoutBox);const c=!Rx(a);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:p,layout:h}=u;if(p&&h){const m=_t();Sa(m,e.layoutBox,p.layoutBox);const x=_t();Sa(x,n,h.layoutBox),Ix(m,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function ZC(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function QC(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function ej(t){t.clearSnapshot()}function mp(t){t.clearMeasurements()}function gp(t){t.isLayoutDirty=!1}function tj(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function xp(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function nj(t){t.resolveTargetDelta()}function ij(t){t.calcProjection()}function sj(t){t.resetSkewAndRotation()}function rj(t){t.removeLeadSnapshot()}function yp(t,e,n){t.translate=ut(e.translate,0,n),t.scale=ut(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function bp(t,e,n,i){t.min=ut(e.min,n.min,i),t.max=ut(e.max,n.max,i)}function oj(t,e,n,i){bp(t.x,e.x,n.x,i),bp(t.y,e.y,n.y,i)}function aj(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const lj={duration:.45,ease:[.4,0,.1,1]},vp=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Sp=vp("applewebkit/")&&!vp("chrome/")?Math.round:Tn;function kp(t){t.min=Sp(t.min),t.max=Sp(t.max)}function cj(t){kp(t.x),kp(t.y)}function Ax(t,e,n){return t==="position"||t==="preserve-aspect"&&!mC(pp(e),pp(n),.2)}function dj(t){return t!==t.root&&t.scroll?.wasRoot}const uj=Nx({attachResizeListener:(t,e)=>Qr(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Al={current:void 0},Mx=Nx({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Al.current){const t=new uj({});t.mount(window),t.setOptions({layoutScroll:!0}),Al.current=t}return Al.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),hj={pan:{Feature:_C},drag:{Feature:IC,ProjectionNode:Mx,MeasureLayout:jx}};function wp(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,o=i[r];o&&ct.postRender(()=>o(e,xo(e)))}class pj extends Yi{mount(){const{current:e}=this.node;e&&(this.unmount=Pk(e,(n,i)=>(wp(this.node,i,"Start"),r=>wp(this.node,r,"End"))))}unmount(){}}class fj extends Yi{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=fo(Qr(this.node.current,"focus",()=>this.onFocus()),Qr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Cp(t,e,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),o=i[r];o&&ct.postRender(()=>o(e,xo(e)))}class mj extends Yi{mount(){const{current:e}=this.node;e&&(this.unmount=zk(e,(n,i)=>(Cp(this.node,i,"Start"),(r,{success:o})=>Cp(this.node,r,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Uc=new WeakMap,Ml=new WeakMap,gj=t=>{const e=Uc.get(t.target);e&&e(t)},xj=t=>{t.forEach(gj)};function yj({root:t,...e}){const n=t||document;Ml.has(n)||Ml.set(n,{});const i=Ml.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(xj,{root:t,...e})),i[r]}function bj(t,e,n){const i=yj(e);return Uc.set(t,n),i.observe(t),()=>{Uc.delete(t),i.unobserve(t)}}const vj={some:0,all:1};class Sj extends Yi{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:vj[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),h=d?u:p;h&&h(c)};return bj(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(kj(e,n))&&this.startObserver()}unmount(){}}function kj({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const wj={inView:{Feature:Sj},tap:{Feature:mj},focus:{Feature:fj},hover:{Feature:pj}},Cj={layout:{ProjectionNode:Mx,MeasureLayout:jx}},jj={...cC,...wj,...hj,...Cj},P=jw(jj,zw);const Lr=X("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const Rt=X("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const yo=X("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Xi=X("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);const Tj=X("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const bo=X("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const Ej=X("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);const us=X("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const jp=X("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);const Zi=X("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const Px=X("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Ya=X("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const Rj=X("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const Ij=X("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);const wt=X("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const zi=X("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const Te=X("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const $n=X("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Dx=X("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Tp=X("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const Ep=X("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);const _j=X("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const vo=X("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const qe=X("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const Nj=X("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);const So=X("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Ox=X("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Aj=X("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const Mj=X("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const uu=X("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);const qs=X("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Lx=X("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Gt=X("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Xo=X("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Wc=X("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const ko=X("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const Pj=X("Frame",[["line",{x1:"22",x2:"2",y1:"6",y2:"6",key:"15w7dq"}],["line",{x1:"22",x2:"2",y1:"18",y2:"18",key:"1ip48p"}],["line",{x1:"6",x2:"6",y1:"2",y2:"22",key:"a2lnyx"}],["line",{x1:"18",x2:"18",y1:"2",y2:"22",key:"8vb6jd"}]]);const zx=X("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);const hu=X("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const Vc=X("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const Dj=X("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const Oj=X("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);const pu=X("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const $c=X("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const mn=X("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const Lj=X("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const zj=X("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const _r=X("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const Bj=X("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Gc=X("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const ka=X("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const Bx=X("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const Fj=X("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const Uj=X("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const Wj=X("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const Le=X("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Fx=X("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const wa=X("MicVocal",[["path",{d:"m11 7.601-5.994 8.19a1 1 0 0 0 .1 1.298l.817.818a1 1 0 0 0 1.314.087L15.09 12",key:"80a601"}],["path",{d:"M16.5 21.174C15.5 20.5 14.372 20 13 20c-2.058 0-3.928 2.356-6 2-2.072-.356-2.775-3.369-1.5-4.5",key:"j0ngtp"}],["circle",{cx:"16",cy:"7",r:"5",key:"d08jfb"}]]);const Vj=X("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);const Ux=X("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);const $j=X("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const Gj=X("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);const Hj=X("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);const qj=X("PanelTop",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}]]);const Kj=X("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);const Xa=X("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);const fu=X("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);const mu=X("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Jj=X("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const zr=X("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const Ht=X("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const An=X("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Wx=X("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);const Zt=X("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const oi=X("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);const Vx=X("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ps=X("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const gu=X("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);const ii=X("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Yj=X("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);const wi=X("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Xj=X("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);const Za=X("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);const Qa=X("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);const Zj=X("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const fs=X("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const Qj=X("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const $e=X("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const eo=X("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const $x=X("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);const Pt=X("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const yn=X("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const eT=X("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const Rp=X("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const Gn=X("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const Gx=X("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const tT=X("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);const rn=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const wo=X("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ip={"#e91e63":"#3b82f6","#ec407a":"#3b82f6","#f06292":"#3b82f6","#d81b60":"#3b82f6","#c2185b":"#3b82f6","#ad1457":"#3b82f6","#880e4f":"#3b82f6","#ff4081":"#3b82f6","#f50057":"#3b82f6","#f44336":"#3b82f6","#e53935":"#3b82f6","#d32f2f":"#3b82f6","#c62828":"#3b82f6","#b71c1c":"#3b82f6","#ff1744":"#3b82f6","#ff5252":"#3b82f6","#ef5350":"#3b82f6","#e57373":"#3b82f6","#ff5722":"#f59e0b","#e64a19":"#f59e0b","#bf360c":"#f59e0b"},nT=t=>{if(!t||typeof t!="string")return!1;const e=t.replace("#","");if(e.length!==6)return!1;const n=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,r=parseInt(e.substring(4,6),16)/255,o=Math.max(n,i,r),a=Math.min(n,i,r),l=(o+a)/2;if(o===a)return!1;const c=o-a,d=l>.5?c/(2-o-a):c/(o+a);let u;switch(o){case n:u=((i-r)/c+(i<r?6:0))/6;break;case i:u=((r-n)/c+2)/6;break;case r:u=((n-i)/c+4)/6;break;default:u=0}const p=u*360;return d>.4&&(p>=330&&p<=360||p>=0&&p<=20)},Hx=(t,e="#3b82f6")=>{if(!t||typeof t!="string")return e;const n=t.toLowerCase().trim();return Ip[n]?Ip[n]:nT(n)?e:t},iT=({setup:t,isSelected:e,onSelect:n})=>{const[i,r]=f.useState(!1),o=Hx(t.color),a=()=>e?o:i?"#d1d5db":"#f3f4f6",l=()=>e?`${o}08`:i?"#f9fafb":"white";return s.jsxs("button",{onClick:n,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),className:"relative p-4 rounded-xl text-left transition-all border-2",style:{borderColor:a(),backgroundColor:l(),boxShadow:i||e?"0 4px 6px -1px rgba(0, 0, 0, 0.1)":"none"},children:[e&&s.jsx("div",{className:"absolute top-3 right-3 w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:o},children:s.jsx(ti,{size:12,className:"text-white",strokeWidth:3})}),s.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center mb-3",style:{backgroundColor:`${o}15`},children:s.jsx("span",{className:"text-2xl",children:t.icon})}),s.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1 pr-6",children:t.name}),s.jsx("p",{className:"text-xs text-gray-500 leading-relaxed mb-3 line-clamp-2",children:t.description}),s.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[s.jsx("span",{className:"inline-flex text-[10px] px-2 py-0.5 rounded-full font-medium",style:{backgroundColor:`${o}15`,color:o},children:t.focus}),s.jsx("span",{className:"inline-flex text-[10px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 font-medium",children:t.targetGroup})]})]})},sT=()=>{const{currentSetup:t,setSelectedSetup:e,clearSelectedSetup:n,availableSetups:i,branding:r,setupsLoading:o}=Fe(),[a,l]=f.useState(!1),c=r?.["--primary-accent"]||"#3A7FA7",d=h=>{e(h),l(!1)},u=()=>{n(),l(!1)},p=t?Hx(t.color):null;return o?s.jsx("div",{className:"w-full flex items-center justify-center py-4",children:s.jsx(ge,{className:"w-5 h-5 animate-spin text-gray-400"})}):!i||i.length===0?null:s.jsxs(s.Fragment,{children:[s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"w-full",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2 px-1",children:"Filtere Trainingsszenarien nach deinem Fokus"}),s.jsxs("button",{onClick:()=>l(!0),className:"w-full flex items-center justify-between gap-3 p-3 sm:p-4 rounded-xl border border-gray-200 bg-white hover:bg-gray-50 hover:border-gray-300 transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:p?`${p}15`:"#f1f5f9"},children:t?s.jsx("span",{className:"text-xl",children:t.icon}):s.jsx(It,{size:20,className:"text-gray-400"})}),s.jsxs("div",{className:"text-left min-w-0",children:[s.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:t?t.name:"Alle Szenarien"}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:t?`${t.focus}  ${t.targetGroup}`:"Trainings-Setup whlen"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("span",{className:"text-xs font-medium text-gray-400 hidden sm:inline group-hover:text-gray-600",children:"ndern"}),s.jsx(wt,{size:18,className:"text-gray-400 group-hover:text-gray-600"})]})]})]}),s.jsx(He,{children:a&&s.jsxs(s.Fragment,{children:[s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>l(!1),className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[9999]"}),s.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center p-4 overflow-y-auto",children:s.jsxs(P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:400},className:"w-full max-w-2xl bg-white rounded-2xl shadow-2xl flex flex-col my-auto",style:{maxHeight:"calc(100vh - 2rem)"},children:[s.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-gray-100 flex-shrink-0",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Trainings-Setup whlen"}),s.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Whle deinen Schwerpunkt fr passende Trainingsszenarien"})]}),s.jsx("button",{onClick:()=>l(!1),className:"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-500 flex items-center justify-center transition-colors flex-shrink-0",children:s.jsx(rn,{size:18})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-5 overscroll-contain",style:{WebkitOverflowScrolling:"touch"},children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map(h=>s.jsx(iT,{setup:h,isSelected:t?.id===h.id,onSelect:()=>d(h.id)},h.id))})}),s.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-t border-gray-100 bg-gray-50/80 flex-shrink-0",children:[s.jsx("button",{onClick:u,className:"px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:"Alle Szenarien anzeigen"}),s.jsx("button",{onClick:()=>l(!1),className:"px-5 py-2 rounded-lg text-sm font-semibold text-white transition-all hover:opacity-90",style:{background:c},children:"Fertig"})]})]})})]})})]})},No=({onNavigate:t})=>{const{branding:e,partnerName:n,isWhiteLabel:i,dashboardTitle:r,dashboardHook:o,currentSetup:a}=Fe(),l=e?.["--header-gradient"]||ve["--header-gradient"];e?.["--header-text"]||ve["--header-text"];const c=e?.["--primary-accent"]||ve["--primary-accent"],d=[{id:"smart_briefing",icon:It,title:"Smart Briefing",subtitle:"KI-Vorbereitungs-Assistent",description:"Erhalte massgeschneiderte Briefings fr deine Gesprche. Die KI erstellt dir Insider-Wissen, fachliche Must-Haves und clevere Rckfragen - basierend auf deinen spezifischen Angaben.",highlights:["Personalisierte Gesprchsvorbereitung","Branchenspezifisches Wissen","Intelligente Rckfragen-Vorschlge"],gradient:"linear-gradient(135deg, #EC4899 0%, #DB2777 100%)",accentColor:"#EC4899"},{id:"simulator",icon:$e,title:"Szenario-Training",subtitle:"Gezielte Vorbereitung",description:"Trainiere mit vorbereiteten Fragen und erhalte sofortiges KI-Feedback zu jeder Antwort. Perfekt fr die systematische Vorbereitung auf entscheidende Gesprche, Verhandlungen und Pitches.",highlights:["Vordefinierte Business-Szenarien","Sofortiges Feedback nach jeder Antwort","Strukturierte Auswertung"],gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",accentColor:"#10B981"},{id:"video_training",icon:pt,title:"Wirkungs-Analyse",subtitle:"Auftreten & Prsenz perfektionieren",description:"Nimm dich selbst auf Video auf und erhalte eine detaillierte KI-Analyse zu Krpersprache, Mimik und rhetorischer Wirkung. Ideal fr Prsentationen, Pitches und den professionellen Auftritt.",highlights:["Video-Selbstaufnahme","Analyse von Krpersprache & Charisma","Konkrete Verbesserungsvorschlge"],gradient:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",accentColor:"#8B5CF6"},{id:"dashboard",icon:Le,title:"Live-Simulationen",subtitle:"Realistische Dialog-Szenarien",description:"Fhre echte Gesprche mit einem KI-Sparringspartner in Echtzeit. Die natrlichste Art, schwierige Gesprchssituationen zu ben  von der Verhandlung bis zum Feedbackgesprch.",highlights:["Echtzeit-Sprachkonversation","Verschiedene Gesprchspartner-Persnlichkeiten","Vollstndiges Gesprchs-Feedback"],gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",accentColor:"#3B82F6"},{id:"gym_klassiker",icon:uu,title:"Rhetorik-Gym",subtitle:"Ausdrucksweise schrfen",description:"Trainiere deine Ausdrucksweise effizient: Reduziere Fllwrter, verbessere dein Sprechtempo und wirke souverner und berzeugender in jedem Meeting.",highlights:["Fllwort-Erkennung","Sprechtempo-Analyse","Gamification & Highscores"],gradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",accentColor:"#F59E0B"}],u={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},p={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},h=m=>{t&&t(m)};return s.jsxs("div",{className:"min-h-screen py-6 lg:py-10 px-4 lg:px-6",children:[s.jsxs(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full text-center mb-10 lg:mb-14 px-4 lg:px-8",children:[s.jsxs("h1",{style:{fontSize:"clamp(28px, 5vw, 42px)",fontWeight:800,color:"#0f172a",marginBottom:"16px",lineHeight:1.2},children:["Willkommen im"," ",s.jsx("span",{style:{background:l,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Trainingscenter"})]}),(r||o)&&s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15,duration:.4},style:{marginBottom:"24px",padding:"20px 24px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 51, 234, 0.06) 100%)",borderRadius:"16px",border:"1px solid rgba(59, 130, 246, 0.15)",maxWidth:"700px",margin:"0 auto 24px"},children:[r&&s.jsx("h2",{style:{fontSize:"clamp(20px, 3vw, 26px)",fontWeight:700,color:"#0f172a",marginBottom:o?"8px":"0",lineHeight:1.3},children:r}),o&&s.jsx("p",{style:{fontSize:"clamp(15px, 2vw, 17px)",color:"#475569",margin:0,lineHeight:1.6},children:o})]}),s.jsx("p",{style:{fontSize:"clamp(16px, 2.5vw, 20px)",color:"#475569",maxWidth:"700px",margin:"0 auto 32px",lineHeight:1.6},children:"Bereite dich optimal auf Bewerbungsgesprche vor. Whle einen Trainingsbereich und starte dein persnliches Coaching."}),s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},style:{display:"flex",justifyContent:"center",gap:"32px",flexWrap:"wrap"},children:[{icon:wo,label:"KI-Feedback",value:"Sofort"},{icon:dr,label:"Trainingsmodi",value:"4"},{icon:Bt,label:"Fortschritt",value:"Messbar"}].map((m,x)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"rgba(59, 130, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(m.icon,{style:{width:"20px",height:"20px",color:c}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a"},children:m.value}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:m.label})]})]},x))})]}),s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},className:"w-full px-4 lg:px-8 mb-10",children:s.jsx(sT,{})}),s.jsx(P.div,{variants:u,initial:"hidden",animate:"visible",className:"w-full px-4 lg:px-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 280px), 1fr))",gap:"20px"},children:d.map(m=>s.jsxs(P.div,{variants:p,whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},onClick:()=>h(m.id),style:{background:"white",borderRadius:"24px",padding:"28px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)",transition:"box-shadow 0.3s ease",display:"flex",flexDirection:"column",height:"100%"},onMouseEnter:x=>{x.currentTarget.style.boxShadow="0 20px 40px -12px rgba(0, 0, 0, 0.15)"},onMouseLeave:x=>{x.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:m.gradient,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 8px 16px -4px ${m.accentColor}40`},children:s.jsx(m.icon,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:s.jsx(yo,{style:{width:"18px",height:"18px",color:"#64748b"}})})]}),s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsx("h3",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"4px"},children:m.title}),s.jsx("p",{style:{fontSize:"14px",fontWeight:500,color:m.accentColor},children:m.subtitle})]}),s.jsx("p",{style:{fontSize:"15px",color:"#475569",lineHeight:1.6,marginBottom:"20px",flex:1},children:m.description}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",paddingTop:"16px",borderTop:"1px solid #f1f5f9"},children:m.highlights.map((x,g)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx($n,{style:{width:"16px",height:"16px",color:m.accentColor,flexShrink:0}}),s.jsx("span",{style:{fontSize:"14px",color:"#334155"},children:x})]},g))})]},m.id))}),s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.4},style:{maxWidth:"700px",margin:"48px auto 0",textAlign:"center",padding:"32px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%)",borderRadius:"20px",border:"1px solid rgba(59, 130, 246, 0.1)"},children:[s.jsx("h3",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Bereit fr dein Training?"}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",marginBottom:"0"},children:"Whle einen der Trainingsbereiche oben aus und starte sofort mit deinem persnlichen Coaching."})]})]})};var _p;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(_p||(_p={}));var Np;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Np||(Np={}));var Ap;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ap||(Ap={}));const Mp=["user","model","function","system"];var Pp;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Pp||(Pp={}));var Dp;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Dp||(Dp={}));var Op;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Op||(Op={}));var Lp;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(Lp||(Lp={}));var Br;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(Br||(Br={}));var zp;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(zp||(zp={}));var Bp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Bp||(Bp={}));var Fp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Fp||(Fp={}));class dn extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Rs extends dn{constructor(e,n){super(e),this.response=n}}class qx extends dn{constructor(e,n,i,r){super(e),this.status=n,this.statusText=i,this.errorDetails=r}}class Bi extends dn{}const rT="https://generativelanguage.googleapis.com",oT="v1beta",aT="0.21.0",lT="genai-js";var ms;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(ms||(ms={}));class cT{constructor(e,n,i,r,o){this.model=e,this.task=n,this.apiKey=i,this.stream=r,this.requestOptions=o}toString(){var e,n;const i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||oT;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||rT}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function dT(t){const e=[];return t?.apiClient&&e.push(t.apiClient),e.push(`${lT}/${aT}`),e.join(" ")}async function uT(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",dT(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let i=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(r){throw new Bi(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${r.message}`)}for(const[r,o]of i.entries()){if(r==="x-goog-api-key")throw new Bi(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new Bi(`Header name ${r} can only be set using the apiClient field`);n.append(r,o)}}return n}async function hT(t,e,n,i,r,o){const a=new cT(t,e,n,i,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},gT(o)),{method:"POST",headers:await uT(a),body:r})}}async function Co(t,e,n,i,r,o={},a=fetch){const{url:l,fetchOptions:c}=await hT(t,e,n,i,r,o);return pT(l,c,a)}async function pT(t,e,n=fetch){let i;try{i=await n(t,e)}catch(r){fT(r,t)}return i.ok||await mT(i,t),i}function fT(t,e){let n=t;throw t instanceof qx||t instanceof Bi||(n=new dn(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function mT(t,e){let n="",i;try{const r=await t.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,i=r.error.details)}catch{}throw new qx(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,i)}function gT(t){const e={};if(t?.signal!==void 0||t?.timeout>=0){const n=new AbortController;t?.timeout>=0&&setTimeout(()=>n.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function xu(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Zo(t.candidates[0]))throw new Rs(`${Mi(t)}`,t);return xT(t)}else if(t.promptFeedback)throw new Rs(`Text not available. ${Mi(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Zo(t.candidates[0]))throw new Rs(`${Mi(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Up(t)[0]}else if(t.promptFeedback)throw new Rs(`Function call not available. ${Mi(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Zo(t.candidates[0]))throw new Rs(`${Mi(t)}`,t);return Up(t)}else if(t.promptFeedback)throw new Rs(`Function call not available. ${Mi(t)}`,t)},t}function xT(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function Up(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const yT=[Br.RECITATION,Br.SAFETY,Br.LANGUAGE];function Zo(t){return!!t.finishReason&&yT.includes(t.finishReason)}function Mi(t){var e,n,i;let r="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)r+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((i=t.candidates)===null||i===void 0)&&i[0]){const o=t.candidates[0];Zo(o)&&(r+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(r+=`: ${o.finishMessage}`))}return r}function to(t){return this instanceof to?(this.v=t,this):new to(t)}function bT(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(h){i[h]&&(r[h]=function(m){return new Promise(function(x,g){o.push([h,m,x,g])>1||l(h,m)})})}function l(h,m){try{c(i[h](m))}catch(x){p(o[0][3],x)}}function c(h){h.value instanceof to?Promise.resolve(h.value.v).then(d,u):p(o[0][2],h)}function d(h){l("next",h)}function u(h){l("throw",h)}function p(h,m){h(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}const Wp=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function vT(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=wT(e),[i,r]=n.tee();return{stream:kT(i),response:ST(r)}}async function ST(t){const e=[],n=t.getReader();for(;;){const{done:i,value:r}=await n.read();if(i)return xu(CT(e));e.push(r)}}function kT(t){return bT(this,arguments,function*(){const n=t.getReader();for(;;){const{value:i,done:r}=yield to(n.read());if(r)break;yield yield to(xu(i))}})}function wT(t){const e=t.getReader();return new ReadableStream({start(i){let r="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(r.trim()){i.error(new dn("Failed to parse stream"));return}i.close();return}r+=a;let c=r.match(Wp),d;for(;c;){try{d=JSON.parse(c[1])}catch{i.error(new dn(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(d),r=r.substring(c[0].length),c=r.match(Wp)}return o()})}}})}function CT(t){const e=t[t.length-1],n={promptFeedback:e?.promptFeedback};for(const i of t){if(i.candidates)for(const r of i.candidates){const o=r.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:r.index}),n.candidates[o].citationMetadata=r.citationMetadata,n.candidates[o].groundingMetadata=r.groundingMetadata,n.candidates[o].finishReason=r.finishReason,n.candidates[o].finishMessage=r.finishMessage,n.candidates[o].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[o].content||(n.candidates[o].content={role:r.content.role||"user",parts:[]});const a={};for(const l of r.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),n.candidates[o].content.parts.push(a)}}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function Kx(t,e,n,i){const r=await Co(e,ms.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),i);return vT(r)}async function Jx(t,e,n,i){const o=await(await Co(e,ms.GENERATE_CONTENT,t,!1,JSON.stringify(n),i)).json();return{response:xu(o)}}function Yx(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function no(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return jT(e)}function jT(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,r=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),r=!0):(e.parts.push(o),i=!0);if(i&&r)throw new dn("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new dn("No content is provided for sending chat message.");return i?e:n}function TT(t,e){var n;let i={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(n=e?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=t.generateContentRequest!=null;if(t.contents){if(r)throw new Bi("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=t.contents}else if(r)i=Object.assign(Object.assign({},i),t.generateContentRequest);else{const o=no(t);i.contents=[o]}return{generateContentRequest:i}}function Vp(t){let e;return t.contents?e=t:e={contents:[no(t)]},t.systemInstruction&&(e.systemInstruction=Yx(t.systemInstruction)),e}function ET(t){return typeof t=="string"||Array.isArray(t)?{content:no(t)}:t}const $p=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],RT={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function IT(t){let e=!1;for(const n of t){const{role:i,parts:r}=n;if(!e&&i!=="user")throw new dn(`First content should be with role 'user', got ${i}`);if(!Mp.includes(i))throw new dn(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Mp)}`);if(!Array.isArray(r))throw new dn("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new dn("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of r)for(const c of $p)c in l&&(o[c]+=1);const a=RT[i];for(const l of $p)if(!a.includes(l)&&o[l]>0)throw new dn(`Content with role '${i}' can't contain '${l}' part`);e=!0}}const Gp="SILENT_ERROR";class _T{constructor(e,n,i,r={}){this.model=n,this.params=i,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i?.history&&(IT(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=no(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},p=Object.assign(Object.assign({},this._requestOptions),n);let h;return this._sendPromise=this._sendPromise.then(()=>Jx(this._apiKey,this.model,u,p)).then(m=>{var x;if(m.response.candidates&&m.response.candidates.length>0){this._history.push(d);const g=Object.assign({parts:[],role:"model"},(x=m.response.candidates)===null||x===void 0?void 0:x[0].content);this._history.push(g)}else{const g=Mi(m.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}h=m}),await this._sendPromise,h}async sendMessageStream(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=no(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},p=Object.assign(Object.assign({},this._requestOptions),n),h=Kx(this._apiKey,this.model,u,p);return this._sendPromise=this._sendPromise.then(()=>h).catch(m=>{throw new Error(Gp)}).then(m=>m.response).then(m=>{if(m.candidates&&m.candidates.length>0){this._history.push(d);const x=Object.assign({},m.candidates[0].content);x.role||(x.role="model"),this._history.push(x)}else{const x=Mi(m);x&&console.warn(`sendMessageStream() was unsuccessful. ${x}. Inspect response object for details.`)}}).catch(m=>{m.message!==Gp&&console.error(m)}),h}}async function NT(t,e,n,i){return(await Co(e,ms.COUNT_TOKENS,t,!1,JSON.stringify(n),i)).json()}async function AT(t,e,n,i){return(await Co(e,ms.EMBED_CONTENT,t,!1,JSON.stringify(n),i)).json()}async function MT(t,e,n,i){const r=n.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Co(e,ms.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:r}),i)).json()}class Hp{constructor(e,n,i={}){this.apiKey=e,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=Yx(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var i;const r=Vp(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Jx(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}async generateContentStream(e,n={}){var i;const r=Vp(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Kx(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}startChat(e){var n;return new _T(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const i=TT(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return NT(this.apiKey,this.model,i,r)}async embedContent(e,n={}){const i=ET(e),r=Object.assign(Object.assign({},this._requestOptions),n);return AT(this.apiKey,this.model,i,r)}async batchEmbedContents(e,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return MT(this.apiKey,this.model,e,i)}}class Xx{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new dn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Hp(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,i){if(!e.name)throw new Bi("Cached content must contain a `name` field.");if(!e.model)throw new Bi("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const a of r)if(n?.[a]&&e[a]&&n?.[a]!==e[a]){if(a==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new Bi(`Different value for "${a}" specified in modelParams (${n[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Hp(this.apiKey,o,i)}}const Zx={FALLBACK_ORDER:["gemini-2.5-flash","gemini-2.0-flash","gemini-1.5-flash-latest"]},Pl={EXCELLENT:80,GOOD:60,FAIR:40},qp={zu_langsam:{position:15,label:"Zu langsam",isOptimal:!1},optimal:{position:50,label:"Optimal",isOptimal:!0},zu_schnell:{position:85,label:"Zu schnell",isOptimal:!1}},Kp={monoton:{icon:"",color:"text-amber-600",bg:"bg-amber-50",label:"Monoton",waveformVariance:5},natrlich:{icon:"",color:"text-blue-600",bg:"bg-blue-50",label:"Natrlich",waveformVariance:15},lebendig:{icon:"",color:"text-green-600",bg:"bg-green-50",label:"Lebendig",waveformVariance:25}},Jp={GOOD:2,MODERATE:5},PT={SKIP_SECONDS:10},Ca={positive:{all:"bg-green-50 border border-green-200 hover:bg-green-100"},negative:{all:"bg-red-50 border border-red-200 hover:bg-red-100"},warning:{all:"bg-amber-50 border border-amber-200 hover:bg-amber-100"},neutral:{all:"bg-white border border-slate-200 hover:bg-blue-50 hover:border-blue-300"}},Dl={agent:{bg:"bg-slate-50",border:"border-l-slate-400",label:"Interviewer",labelColor:"text-slate-600"},user:{bg:"bg-blue-50",border:"border-l-blue-400",label:"Bewerber",labelColor:"text-blue-600"}},io={API_KEY_MISSING:"Gemini API key is required",AUDIO_FILE_MISSING:"Audio file is required",TRANSCRIPT_EMPTY:"Transcript is empty",JSON_PARSE_FAILED:"Fehler beim Parsen der Antwort"};function DT(t,e={}){const{roleType:n="interview",userRoleLabel:i="Bewerber",agentRoleLabel:r="Gesprchspartner"}=e;return n==="simulation"?LT(t,i,r):OT(t,i,r)}function OT(t,e,n){return`Du bist ein professioneller Karriere-Coach. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des ${n} (z.B. "H. Mller", "${n}", oder hnliche Kennzeichnungen) dienen NUR als Kontext fr die Fragen.
- Dein gesamtes Feedback, alle Strken, Verbesserungen, Tipps und Bewertungen beziehen sich NUR auf die Antworten und das Verhalten des/der ${e}.
- Bewerte NICHT die Qualitt der Fragen oder das Verhalten des ${n}.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung des Gesamteindrucks des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung",
    "Strke 2: Was gut gemacht wurde",
    "Strke 3: Weitere Strken"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich",
    "Verbesserung 2: Was besser gemacht werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung",
    "Tipp 2: Praktischer Ratschlag",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Antworten des/der ${e}:
- Struktur & Klarheit der Antworten
- Inhalt & Beispiele, die genannt werden
- Motivation & Begeisterung
- Professionalitt & Selbstbewusstsein

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen.

Transkript:
${t}

JSON Feedback:`}function LT(t,e,n){return`Du bist ein professioneller Coach fr Kommunikation und Gesprchsfhrung. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

KONTEXT: Dies ist eine Simulation, bei der der/die ${e} das Gesprch fhrt und der/die ${n} darauf reagiert.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des/der ${n} dienen als Kontext fr die Reaktionen.
- Dein gesamtes Feedback bezieht sich NUR auf die Gesprchsfhrung, Reaktionen und das Verhalten des/der ${e}.
- Bewerte die Fhigkeit, das Gesprch professionell zu fhren und auf den/die ${n} einzugehen.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung der Gesprchsfhrung des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung zur Gesprchsfhrung",
    "Strke 2: Was in der Kommunikation gut gemacht wurde",
    "Strke 3: Weitere Strken im Umgang mit dem/der ${n}"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich in der Gesprchsfhrung",
    "Verbesserung 2: Wie besser auf den/die ${n} eingegangen werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung fr hnliche Situationen",
    "Tipp 2: Praktischer Ratschlag zur Gesprchsfhrung",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Gesprchsfhrung des/der ${e}:
- Gesprchsfhrung & Struktur (Wie gut wurde das Gesprch geleitet?)
- Kundenorientierung & Empathie (Wie gut wurde auf den/die ${n} eingegangen?)
- Problemlsungskompetenz (Wie effektiv wurden Anliegen bearbeitet?)
- Professionalitt & Souvernitt (Wie professionell war das Auftreten?)

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen fr die Gesprchsfhrung.

Transkript:
${t}

JSON Feedback:`}function zT(t,e){return t.replace("${transcript}",e)}const BT=["hm","h","h","Mh","Halt","Eigentlich","Sozusagen","Quasi","Irgendwie","Also","Genau","Ja also"];function Qx(){return`${BT.slice(0,9).map(e=>`"${e}"`).join(", ")}, "Also" (am Satzanfang), "Genau" (als Fllwort), "Ja also"`}function FT(t={}){const{userRoleLabel:e="Bewerber",agentRoleLabel:n="Gesprchspartner",roleType:i="interview",hasTwoVoices:r=!0,transcript:o=null}=t,a=r?`
WICHTIG - STIMMEN-TRENNUNG:
Die Aufnahme enthlt ZWEI Stimmen:
1. ${n.toUpperCase()} (KI-Stimme, synthetisch, akzentfrei)
2. ${e.toUpperCase()} (menschliche Stimme, natrliche Varianz)

Der/Die ${n} erffnet typischerweise das Gesprch.
Analysiere AUSSCHLIESSLICH die Stimme des/der ${e.toUpperCase()}.
Ignoriere alle uerungen des/der ${n} komplett.
`:`
STIMM-ANALYSE:
Die Aufnahme enthlt nur EINE Stimme: ${e.toUpperCase()}.
Analysiere diese Stimme vollstndig.
`,l=o?`
TRANSKRIPT-REFERENZ:
Das folgende Transkript zeigt, wer was gesagt hat. Nutze es zur Orientierung:

${o}

Hinweis: Das Transkript hilft bei der Zuordnung. Die paraverbale Analyse (WIE etwas gesagt wird)
basiert aber auf dem AUDIO - nicht auf dem Text.
`:"";return`Du bist ein professioneller Voice-Coach und Kommunikationsexperte bei "KarriereHeld".
Deine Aufgabe: Analysiere die paraverbale Kommunikation im Audio.

Paraverbal = WIE etwas gesagt wird (nicht WAS gesagt wird).
${a}
${l}

ANALYSE-DIMENSIONEN (nur ${e.toUpperCase()})


1. FLLWRTER (Speech Cleanliness)
   
   Erkenne diese Fllwrter: ${Qx()}

   Fr jedes Fllwort dokumentiere:
   - Exakter Zeitstempel (MM:SS)
   - Kontext (z.B. "Satzanfang", "beim Nachdenken", "Themenwechsel")

   Bewertungsmastab:
   - 0 Fllwrter: 100 Punkte (Exzellent)
   - 1-2 Fllwrter: 85-95 Punkte (Sehr gut)
   - 3-5 Fllwrter: 65-80 Punkte (Akzeptabel)
   - 6-10 Fllwrter: 40-60 Punkte (Verbesserungsbedarf)
   - 10+ Fllwrter: 0-35 Punkte (Deutlicher bungsbedarf)

2. SPRECHTEMPO (Pacing)
   
   Optimales Tempo: 120-150 Wrter pro Minute (WPM)

   Achte auf:
   - Durchschnittliches Tempo
   - Tempo-Variationen (monoton vs. dynamisch)
   - Auffllige Stellen (zu schnell/langsam) mit Zeitstempel

   Bewertung:
   - "optimal": 120-150 WPM, natrliche Variation
   - "zu_schnell": >160 WPM, gehetzt, atemlos
   - "zu_langsam": <100 WPM, schleppend, unsicher
   - "ungleichmaessig": Starke Schwankungen

3. TONALITT (Melodie & Betonung)
   
   Analysiere:
   - Stimmmelodie (monoton / natrlich / lebendig)
   - Betonungen (passend / fehlend / bertrieben)
   - Emotionale Frbung (neutral / engagiert / nervs)

   Dokumentiere Highlights und Lowlights:
   - Positive Momente: Souverne Passagen, gute Betonungen
   - Negative Momente: Unsichere Stellen, Stimmbrche, Monotonie

4. SELBSTSICHERHEIT (Confidence)
   
   Gesamteindruck: Wie sicher und kompetent wirkt die Stimme?

   Indikatoren fr hohe Confidence:
    Klare, feste Stimme
    Angemessenes Tempo
    Gute Pausen (bewusst, nicht nervs)
    Natrliche Betonungen

   Indikatoren fr niedrige Confidence:
    Zittrige oder leise Stimme
    Viele Fllwrter
    Hastiges Sprechen
    Aufsteigende Satzenden (Unsicherheit)


OUTPUT FORMAT (nur valides JSON, kein Markdown)


{
  "audio_metrics": {
    "summary_text": "2-3 Stze Gesamtfazit zur Stimmwirkung des/der ${e}. Was war gut? Was kann verbessert werden?",
    "confidence_score": <0-100>,

    "speech_cleanliness": {
      "score": <0-100>,
      "total_filler_count": <Anzahl>,
      "filler_word_analysis": [
        {
          "word": "hm",
          "count": <Anzahl>,
          "examples": [
            {"timestamp": "00:45", "context": "Satzanfang"},
            {"timestamp": "01:20", "context": "beim Nachdenken"}
          ]
        }
      ],
      "feedback": "Konkreter Tipp zur Vermeidung"
    },

    "pacing": {
      "rating": "optimal" | "zu_schnell" | "zu_langsam" | "ungleichmaessig",
      "estimated_wpm": <Zahl>,
      "issues_detected": [
        {"timestamp": "02:10", "issue": "Beschreibung des Problems"}
      ],
      "feedback": "Konkreter Tipp zum Tempo"
    },

    "tonality": {
      "rating": "monoton" | "natrlich" | "lebendig",
      "emotional_tone": "neutral" | "engagiert" | "nervs" | "enthusiastisch",
      "highlights": [
        {"timestamp": "00:30", "type": "positive", "note": "Souverner Einstieg"},
        {"timestamp": "03:15", "type": "negative", "note": "Stimme wird unsicher"}
      ],
      "feedback": "Konkreter Tipp zur Stimmmelodie"
    }
  }
}

Beginne jetzt mit der Analyse:`}const Yp=["Warum bin ich die beste Wahl fr diese Position?","Meine grte berufliche Errungenschaft","Was motiviert mich jeden Tag aufzustehen?","Wie ich mit schwierigen Kollegen umgehe","Mein Fhrungsstil in 60 Sekunden","Die wichtigste Lektion meiner Karriere","Wie ich unter Druck arbeite","Warum Teamarbeit mir wichtig ist","Wenn ich ein Tier wre, welches und warum?","Mein perfekter Tag sieht so aus...","Die beste Erfindung der Menschheit","Wenn ich die Welt verndern knnte...","Ein Buch, das mein Leben verndert hat","Mein Lieblingshobby und warum","Drei Dinge, die ich niemals machen wrde","Warum Scheitern wichtig ist","Meine kontroverseste Meinung","Wie ich mit Kritik umgehe"],Xp=["Warum sollten wir ausgerechnet Sie einstellen und nicht einen der 50 anderen Bewerber?","Ihr Lebenslauf zeigt eine Lcke. Was haben Sie in dieser Zeit wirklich gemacht?","Nennen Sie mir drei echte Schwchen - und bitte keine getarnten Strken.","Warum haben Sie Ihren letzten Job wirklich verlassen?","Wo sehen Sie sich in 5 Jahren? Und seien Sie ehrlich.","Was wrde Ihr schlimmster Feind ber Sie sagen?","Wenn ich Ihren letzten Chef anrufe - was wird er mir sagen?","Sie sind offensichtlich berqualifiziert. Werden Sie nicht schnell gelangweilt sein?","Warum haben Sie in Ihrer Karriere nicht mehr erreicht?","berzeugen Sie mich in 30 Sekunden, dass Sie kein Risiko sind.","Was war Ihr grter beruflicher Misserfolg?","Haben Sie andere Angebote? Warum sind wir nicht Ihre erste Wahl?"];function UT(t="Elevator Pitch",e=60){return`AUDIO-TRANSKRIPTION UND ANALYSE

THEMA: "${t}"

ABSOLUTE REGEL - KEINE HALLUZINATION:
Du DARFST NUR transkribieren, was TATSCHLICH in der Audio-Datei gesprochen wird.
- Bei Stille, Rauschen, oder unverstndlichem Audio: transcript = "[Keine Sprache erkannt]"
- Bei nur 1-2 Sekunden Audio ohne klare Sprache: transcript = "[Keine Sprache erkannt]"
- ERFINDE NIEMALS Wrter, Stze oder Inhalte!
- Wenn du unsicher bist, ob etwas gesagt wurde: NICHT transkribieren!

DEINE AUFGABE (NUR bei klar erkennbarer Sprache):
1. TRANSKRIBIEREN: Schreibe WRTLICH was gesprochen wird - nichts hinzufgen
2. FLLWRTER: Finde diese Wrter im Transkript: ${Qx()}
3. INHALT: Bewerte wie gut die Antwort zum Thema passt (0-40 Punkte)

INHALTSBEWERTUNG (content_score):
- 0: Keine Sprache / am Thema vorbei / unverstndlich
- 10: Nur ansatzweise zum Thema
- 20: Teilweise zum Thema, aber oberflchlich
- 30: Gut zum Thema, mit Substanz
- 40: Exzellent, strukturiert und berzeugend

OUTPUT - NUR valides JSON:
{
  "transcript": "[Keine Sprache erkannt]",
  "filler_words": [],
  "content_score": 0,
  "content_feedback": "Keine Sprache erkannt."
}

ODER bei erkannter Sprache:
{
  "transcript": "Das was tatschlich gesagt wurde...",
  "filler_words": [{"word": "hm", "count": 1}],
  "content_score": 30,
  "content_feedback": "Kurzes Feedback (1-2 Stze)"
}

ANALYSE DER AUDIO-DATEI:`}const WT={excellent:{range:[90,100],messages:["Perfekt! Du bist ein Rhetorik-Champion!","Wow! Makellose Prsentation!","Ausgezeichnet! So sieht ein Profi aus!"],emoji:""},good:{range:[70,89],messages:["Sehr gut! Nur kleine Verbesserungen ntig.","Stark! Fast perfekt!","Beeindruckend! Weiter so!"],emoji:""},medium:{range:[50,69],messages:["Solide Leistung! bung macht den Meister.","Guter Ansatz! Da geht noch mehr.","Auf dem richtigen Weg!"],emoji:""},needsWork:{range:[30,49],messages:["Nicht schlecht, aber hier ist Potenzial!","Die Fllwrter haben dich erwischt!","Bleib dran - Verbesserung ist mglich!"],emoji:""},poor:{range:[0,29],messages:["hm... da mssen wir ben!","Die Fllwrter haben gewonnen. Revanche?","Kopf hoch! Jeder Profi hat so angefangen."],emoji:""}};function VT(t){for(const[,e]of Object.entries(WT))if(t>=e.range[0]&&t<=e.range[1]){const n=Math.floor(Math.random()*e.messages.length);return{message:e.messages[n],emoji:e.emoji}}return{message:"Weiter ben!",emoji:""}}function $T(){return Yp[Math.floor(Math.random()*Yp.length)]}function GT(){return Xp[Math.floor(Math.random()*Xp.length)]}const HT={klassiker:{id:"klassiker",title:"Der Klassiker",subtitle:"Elevator Pitch",description:"60 Sekunden, um zu berzeugen. Prsentiere dich selbst ohne Fllwrter!",duration:60,icon:"rocket",color:"blue",topic:"Stelle dich selbst vor - wer bist du, was machst du, was ist dein Ziel?"},zufall:{id:"zufall",title:"Zufalls-Thema",subtitle:"Slot Machine",description:"Ein zuflliges Thema, spontan und flieend prsentiert.",duration:60,icon:"shuffle",color:"purple",getTopic:$T},stress:{id:"stress",title:"Stress-Test",subtitle:"berraschungsfrage",description:"Eine knallharte Interview-Frage. Behalte die Nerven!",duration:90,icon:"zap",color:"red",getTopic:GT}},qT={WEBM:"audio/webm"};async function KT(t){return new Promise((e,n)=>{const i=new FileReader;i.onloadend=()=>{const r=i.result.split(",")[1];e(r)},i.onerror=()=>{n(new Error("Failed to read file as base64"))},i.readAsDataURL(t)})}async function e0(t){return{inlineData:{data:await KT(t),mimeType:t.type||qT.WEBM}}}const Hc=!1;function t0(t){return t.message?.includes("404")||t.message?.includes("not found")}function JT(t){return t.message?.includes("API key")}function YT(t,e){const n=Zx.FALLBACK_ORDER.join(", ");return t0(t)?`Kein Gemini-Modell verfgbar. Versuchte Modelle: ${n}

Mgliche Lsungen:
1. berprfe, ob dein API Key gltig ist
2. Stelle sicher, dass die Gemini API aktiviert ist
3. Besuche https://ai.google.dev/ um deinen API-Key zu berprfen

Fehler: ${t.message}`:JT(t)?`API Key Problem: ${t.message}

Stelle sicher, dass:
1. VITE_GEMINI_API_KEY korrekt in der .env Datei gesetzt ist
2. Der API Key gltig ist (berprfe auf https://ai.google.dev/)`:t.message||"Unbekannter Fehler"}async function yu({apiKey:t,content:e,context:n}){const i=`[GEMINI ${n}]`;if(!t)throw console.error(` ${i} API key is missing`),new Error(io.API_KEY_MISSING);let r=null;for(const a of Zx.FALLBACK_ORDER)try{return(await(await new Xx(t).getGenerativeModel({model:a}).generateContent(e)).response).text()}catch(l){if(console.error(` ${i} Error with ${a}:`,l.message),r=l,t0(l))continue;break}const o=YT(r);throw new Error(`Fehler bei der ${n}: ${o}`)}async function XT(t,e,n="gemini-1.5-flash",i=null,r={}){if(!t||t.trim().length===0)throw console.error(" [GEMINI FEEDBACK] Transcript is empty"),new Error(io.TRANSCRIPT_EMPTY);const o=i?zT(i,t):DT(t,r),a=r.roleType==="simulation"?"Simulation":"Interview",l=r.userRoleLabel||"Bewerber";`${a}${l}`,`${t.length}`,t.substring(0,300);const c=await yu({apiKey:e,content:o,context:"FEEDBACK"});return me.logPrompt("GEMINI_LIVE_FEEDBACK",`Live-Training Feedback-Generierung (${a})`,o,{transcript_length:t.length,custom_prompt:i?"Ja":"Nein",role_type:r.roleType||"interview",user_role_label:l},c),c}async function ZT(t,e,n="gemini-1.5-flash",i={}){if(!t)throw console.error(" [GEMINI AUDIO] Audio file is missing"),new Error(io.AUDIO_FILE_MISSING);const r=i.userRoleLabel||"Bewerber",o=i.agentRoleLabel||"Gesprchspartner",a=i.roleType||"interview",l=i.hasTwoVoices!==!1,c=i.transcript||null,d=await e0(t),u=FT({userRoleLabel:r,agentRoleLabel:o,roleType:a,hasTwoVoices:l,transcript:c}),p=[u,d];`${r}`,`${Math.round(t.size/1024)}`,t.type;const h=await yu({apiKey:e,content:p,context:"AUDIO"});return me.logPrompt("GEMINI_LIVE_AUDIO_ANALYSIS",`Live-Training Audio-Analyse (${r})`,u,{audio_size_kb:Math.round(t.size/1024),audio_type:t.type,role_type:a,user_role_label:r},h),h}async function QT(t,e,n="Elevator Pitch",i=60){if(!t)throw console.error(" [GEMINI GAME] Audio file is missing"),new Error(io.AUDIO_FILE_MISSING);const r=await e0(t),a=[UT(n,i),r];`${Math.round(t.size/1024)}`;const l=await yu({apiKey:e,content:a,context:"GAME"});try{let c=l.trim();c.startsWith("```json")?c=c.replace(/```json\n?/,"").replace(/\n?```$/,""):c.startsWith("```")&&(c=c.replace(/```\n?/,"").replace(/\n?```$/,""));const d=JSON.parse(c);return{transcript:d.transcript||"[Keine Sprache erkannt]",filler_words:d.filler_words||[],content_score:Math.max(0,Math.min(40,d.content_score||0)),content_feedback:d.content_feedback||""}}catch(c){throw console.error(" [GEMINI GAME] Failed to parse response:",c),console.error(" [GEMINI GAME] Raw response:",l),new Error(`${io.JSON_PARSE_FAILED}: ${c.message}`)}}function n0(t){return!t||typeof t!="string"?t:t.replace(/\\u([0-9a-fA-F]{4})/g,(e,n)=>String.fromCharCode(parseInt(n,16))).replace(new RegExp("(?<!\\\\)u([0-9a-fA-F]{4})","g"),(e,n)=>{const i=parseInt(n,16);return i>=160&&i<=65535?String.fromCharCode(i):e})}function e2(t){if(!t||typeof t!="string")return t;let e=t.trim();return e.startsWith("```json")?e=e.replace(/^```json\s*/i,"").replace(/\s*```\s*$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```\s*$/,"")),e.trim()}function el(t,e={}){const{silent:n=!1,context:i="JSON"}=e;if(t==null)return null;if(typeof t=="object")return t;if(typeof t!="string")return n||console.warn(`[parseJSON] Expected string or object, got ${typeof t}`),null;try{let r=e2(t);return r=n0(r),JSON.parse(r)}catch(r){return n||(console.error(`[parseJSON] Failed to parse ${i}:`,r.message),console.error(`[parseJSON] Input preview: ${t.substring(0,100)}...`)),null}}function i0(t){return el(t,{context:"feedback_json"})}function s0(t){return el(t,{context:"audio_analysis_json"})}function r0(t){if(!t)return[];const e=el(t,{context:"transcript"});return Array.isArray(e)?e:[]}function t2(t){if(!t)return!1;const e=t.audio_metrics;return e?e.confidence_score!==void 0||e.speech_cleanliness!==void 0:!1}function ja(t){if(t==null)return t;if(typeof t=="string")return n0(t);if(Array.isArray(t))return t.map(ja);if(typeof t=="object"){const e={};for(const n of Object.keys(t))e[n]=ja(t[n]);return e}return t}const Ao=t=>new Promise(e=>setTimeout(e,t));async function o0(t,e={},n=null){if(!t||t.length===0)throw new Error("Transkript ist leer. Das Gesprch muss mindestens einen Austausch enthalten.");const i=n2(t,e),r=me.getGeminiApiKey();if(!r)throw new Error("Gemini API Key ist nicht konfiguriert. Bitte kontaktiere den Administrator.");const o={feedbackContent:null,audioAnalysisContent:null},a={roleType:e.role_type||"interview",userRoleLabel:e.user_role_label||"Bewerber",agentRoleLabel:e.interviewer_profile?.role||"Gesprchspartner"};try{const l=e.feedback_prompt||null;o.feedbackContent=await XT(i,r,"gemini-1.5-flash",l,a)}catch(l){throw console.error(" [Roleplay Feedback] Failed to generate feedback:",l),new Error(`Fehler bei der Feedback-Generierung: ${l.message}`)}if(n)try{o.audioAnalysisContent=await ZT(n,r,"gemini-1.5-flash",{...a,hasTwoVoices:!0,transcript:i})}catch(l){console.error(" [Roleplay Feedback] Failed to generate audio analysis:",l),o.audioAnalysisContent=JSON.stringify({error:!0,summary:"Audio-Analyse konnte nicht durchgefhrt werden.",errorMessage:l.message,troubleshooting:["Stelle sicher, dass dein Mikrofon richtig funktioniert","Versuche das Gesprch erneut zu starten","berprfe, ob keine andere Anwendung das Mikrofon blockiert"]})}return o}function n2(t,e={}){let n="";e.title&&(n+=`Rollenspiel-Szenario: ${e.title}
`),e.description&&(n+=`Beschreibung: ${e.description}
`),e.variables&&(n+=`
Kontext-Variablen:
`,Object.entries(e.variables).forEach(([o,a])=>{n+=`- ${o}: ${a}
`})),n+=`
--- Gesprchsverlauf ---

`;const i=e.user_role_label||"Bewerber",r=e.interviewer_profile?.role||"Gesprchspartner";return t.forEach(o=>{const a=o.role==="agent"?r:i;n+=`${a}: ${o.text}

`}),n}async function a0(t,e,n,i=null,r=0,o=null){try{let a=e;Array.isArray(e)&&(a=JSON.stringify(e));const l={transcript:a,feedback_json:n,duration:r};i&&(l.audio_analysis_json=i),o&&(l.conversation_id=o);const c=await me.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify(l)});if(r>0)try{await me.request(`/roleplays/sessions/${t}/duration`,{method:"POST",body:JSON.stringify({duration_seconds:r})})}catch(d){console.warn(" [Roleplay Feedback] Failed to update usage limits:",d.message)}return c.data}catch(a){throw console.error(" [Roleplay Feedback] ========= SAVE FAILED ========="),console.error(" [Roleplay Feedback] Error:",a),console.error(" [Roleplay Feedback] Error message:",a.message),new Error(`Fehler beim Speichern der Analyse: ${a.message}`)}}async function l0(t){try{return(await me.request(`/roleplays/sessions/${t}`,{method:"GET"})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to load session analysis:",e),new Error(`Fehler beim Laden der Analyse: ${e.message}`)}}async function i2(t={}){try{const e=new URLSearchParams(t).toString(),n=e?`/roleplays/sessions?${e}`:"/roleplays/sessions";return await me.request(n,{method:"GET"})}catch(e){throw console.error(" [Roleplay Feedback] Failed to load sessions:",e),new Error(`Fehler beim Laden der Sessions: ${e.message}`)}}function bu(t){return`${(window.bewerbungstrainerConfig||{apiUrl:"/wp-json/bewerbungstrainer/v1"}).apiUrl}/roleplays/sessions/${t}/audio`}async function s2(t,e=10,n=3e3){const i=bu(t);for(let r=1;r<=e;r++)try{const o=await fetch(i,{method:"GET",headers:{"X-WP-Nonce":Lt()},credentials:"same-origin"});if(o.ok){const a=await o.blob();if(a.size===0){if(console.warn(" [Roleplay Feedback] Audio blob is empty, retrying..."),r<e){await Ao(n);continue}return null}return a}if(o.status===404&&r<e){await Ao(n);continue}if(console.error(` [Roleplay Feedback] Failed to fetch audio: HTTP ${o.status}`),r<e){await Ao(n);continue}}catch(o){if(console.error(` [Roleplay Feedback] Error fetching audio on attempt ${r}:`,o),r<e){await Ao(n);continue}}return console.warn(" [Roleplay Feedback] All retry attempts failed, audio not available"),null}async function r2(t,e){try{return(await me.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify({conversation_id:e})})).data}catch(n){throw console.error(" [Roleplay Feedback] Failed to update session conversation_id:",n),new Error(`Fehler beim Aktualisieren der Session: ${n.message}`)}}async function c0(t){try{return(await me.request("/roleplays/sessions",{method:"POST",body:JSON.stringify(t)})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to create session:",e),new Error(`Fehler beim Erstellen der Session: ${e.message}`)}}async function d0(){try{const t=await fetch(`${ni()}/roleplays`,{headers:{"X-WP-Nonce":Lt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();return ja(e.data||[])}catch(t){throw console.error(" [Roleplay Feedback] Failed to load scenarios:",t),new Error(`Fehler beim Laden der Szenarien: ${t.message}`)}}async function u0(t){try{const e=await me.request(`/roleplays/${t}`,{method:"GET"});return ja(e.data)}catch(e){throw console.error(" [Roleplay Feedback] Failed to load scenario:",e),new Error(`Fehler beim Laden des Szenarios: ${e.message}`)}}const o2={briefcase:Mn,users:Nn,"trending-up":Bt,"message-circle":Ji,shield:wi,heart:pu,target:$e,folder:ko},Pi=ko,bn=t=>!t||typeof t!="string"?Pi:o2[t.toLowerCase()]||Pi,Is=t=>!t||typeof t!="string"?"":t.toLowerCase().replace(//g,"ae").replace(//g,"oe").replace(//g,"ue").replace(//g,"ss").replace(/[^a-z0-9]/g,""),Ol={career:"karriere",leadership:"fuehrung",sales:"vertrieb",communication:"kommunikation",service:"service",social:"social",karriere:"karriere",fuehrung:"fuehrung",vertrieb:"vertrieb",kommunikation:"kommunikation",meine:"meine",selfpresentation:"karriere",interview:"karriere",pitch:"vertrieb",negotiation:"vertrieb",vorstellungsgespraech:"karriere",gehaltsverhandlung:"vertrieb",fuehrungsgespraech:"fuehrung",praesentation:"kommunikation",selbstvorstellung:"karriere",training:"kommunikation"};let _s=null,Ll=null;const a2=300*1e3;function l2(){const[t,e]=f.useState(_s||[]),[n,i]=f.useState(!_s),[r,o]=f.useState(null),a=f.useCallback(async()=>{if(_s&&Ll&&Date.now()-Ll<a2)return e(_s),i(!1),_s;try{i(!0),o(null);const h=await me.getCategories();return _s=h,Ll=Date.now(),e(h),h}catch(h){return console.error("[useCategories] Failed to fetch categories:",h),o(h.message||"Failed to fetch categories"),[]}finally{i(!1)}},[]);f.useEffect(()=>{a()},[a]);const l=f.useCallback(h=>{if(!h||!t.length)return null;const m=Is(h),x=Ol[m]||m,g=t.find(y=>Is(y.slug)===x||Is(y.name)===x);return g?{...g,IconComponent:bn(g.icon),bgColor:`${g.color}15`}:null},[t]),c=f.useCallback(h=>{if(Array.isArray(h)){for(const g of h){if(typeof g!="string")continue;const y=l(g);if(y)return{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:bn(y.icon),IconComponent:bn(y.icon),color:y.color,bgColor:y.bgColor}}const x=h.find(g=>typeof g=="string")||"unknown";return{key:String(x),label:String(x),shortLabel:String(x),icon:Pi,IconComponent:Pi,color:"#64748b",bgColor:"#f1f5f9"}}if(typeof h!="string")return{key:"unknown",label:"Unbekannt",shortLabel:"Unbekannt",icon:Pi,IconComponent:Pi,color:"#64748b",bgColor:"#f1f5f9"};const m=l(h);return m?{key:m.slug,label:m.name,shortLabel:m.shortName||m.name,icon:bn(m.icon),IconComponent:bn(m.icon),color:m.color,bgColor:m.bgColor}:{key:h||"unknown",label:h||"Unbekannt",shortLabel:h||"Unbekannt",icon:Pi,IconComponent:Pi,color:"#64748b",bgColor:"#f1f5f9"}},[l]),d=f.useCallback((h=[])=>{if(!t.length)return[];if(!h.length)return t.map(x=>({key:x.slug,label:x.name,shortLabel:x.shortName||x.name,icon:bn(x.icon),IconComponent:bn(x.icon),color:x.color,bgColor:`${x.color}15`}));const m=new Map;return h.forEach(x=>{if(x){if(Array.isArray(x))x.forEach(g=>{if(!g||typeof g!="string"||!g.trim())return;const y=l(g);y&&!m.has(y.slug)&&m.set(y.slug,{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:bn(y.icon),IconComponent:bn(y.icon),color:y.color,bgColor:y.bgColor})});else if(typeof x=="string"&&x.trim()){const g=l(x);g&&!m.has(g.slug)&&m.set(g.slug,{key:g.slug,label:g.name,shortLabel:g.shortName||g.name,icon:bn(g.icon),IconComponent:bn(g.icon),color:g.color,bgColor:g.bgColor})}}}),Array.from(m.values())},[t,l]),u=f.useCallback((h,m)=>{if(!h||!m)return!1;const x=Is(m);if(Array.isArray(h))return h.some(v=>{const w=Is(v);return(Ol[w]||w)===x});const g=Is(h);return(Ol[g]||g)===x},[]),p=f.useMemo(()=>{const h=new Map;return t.forEach(m=>{h.set(m.slug,{...m,IconComponent:bn(m.icon),bgColor:`${m.color}15`})}),h},[t]);return{categories:t,categoriesMap:p,loading:n,error:r,refetch:a,getCategoryBySlug:l,getCategoryConfig:c,getCategoriesForFilter:d,matchesCategory:u}}const it=()=>{const{branding:t}=Fe();return f.useMemo(()=>{const e=n=>t?.[n]||ve[n];return{headerGradient:e("--header-gradient"),headerText:e("--header-text"),buttonGradient:t?.["--button-gradient"]||e("--header-gradient"),buttonGradientHover:e("--button-gradient-hover"),buttonSolid:e("--button-solid"),buttonSolidHover:e("--button-solid-hover"),buttonText:e("--button-text")||"#ffffff",primaryAccent:e("--primary-accent"),primaryAccentLight:e("--primary-accent-light"),primaryAccentHover:e("--primary-accent-hover"),primaryAccentDark:e("--primary-accent-hover"),appBgColor:e("--app-bg-color"),cardBgColor:e("--card-bg-color")||"#ffffff",cardBgHover:e("--card-bg-hover")||"#f8fafc",sidebarBgColor:e("--sidebar-bg-color"),sidebarTextColor:e("--sidebar-text-color"),sidebarTextMuted:e("--sidebar-text-muted"),sidebarActiveBg:e("--sidebar-active-bg"),sidebarActiveText:e("--sidebar-active-text"),sidebarHoverBg:e("--sidebar-hover-bg"),textMain:e("--text-main")||"#0f172a",textSecondary:e("--text-secondary")||"#475569",textMuted:e("--text-muted")||"#94a3b8",textPrimary:e("--text-main")||"#0f172a",borderColor:e("--border-color")||"#e2e8f0",borderColorLight:e("--border-color-light")||"#f1f5f9",iconPrimary:e("--icon-primary"),iconSecondary:e("--icon-secondary"),iconMuted:e("--icon-muted")||"#94a3b8",iconColor:e("--icon-primary"),iconActiveColor:e("--icon-secondary"),focusRing:e("--focus-ring")||"rgba(58, 127, 167, 0.3)",success:"#10b981",successLight:"#d1fae5",successDark:"#059669",error:"#ef4444",errorLight:"#fee2e2",errorDark:"#dc2626",warning:"#f59e0b",warningLight:"#fef3c7",warningDark:"#d97706",info:"#3b82f6",infoLight:"#dbeafe",infoDark:"#2563eb",overlayLight:"rgba(255, 255, 255, 0.8)",overlayDark:"rgba(0, 0, 0, 0.5)",backdropBlur:"rgba(255, 255, 255, 0.9)",white:"#ffffff",transparent:"transparent",disabledBg:"#cbd5e1",shadow:Wv,radius:Uv,breakpoint:Fv,fontSize:Bv,fontWeight:zv,space:Lv,transition:Ov,zIndex:Dv,iconSize:Pv,component:Mv,coloredShadow:Av,raw:t}},[t])},Zp={easy:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einfach"},beginner:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einsteiger"},medium:{classes:"bg-yellow-100 text-yellow-800 border-yellow-200",label:"Mittel"},intermediate:{classes:"bg-blue-100 text-blue-800 border-blue-200",label:"Fortgeschritten"},hard:{classes:"bg-red-100 text-red-800 border-red-200",label:"Schwer"},advanced:{classes:"bg-purple-100 text-purple-800 border-purple-200",label:"Experte"}},c2=t=>Zp[t]||Zp.medium,qc=({children:t,className:e="",style:n={}})=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${e}`,style:n,children:t}),h0=({icon:t,gradient:e,textColor:n,size:i="md"})=>{const r={sm:{container:"40px",icon:"20px",radius:"10px"},md:{container:"48px",icon:"24px",radius:"12px"},lg:{container:"56px",icon:"28px",radius:"14px"}},o=r[i]||r.md;return s.jsx("div",{style:{width:o.container,height:o.container,borderRadius:o.radius,background:e,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(t,{style:{width:o.icon,height:o.icon,color:n}})})},p0=({icon:t,text:e})=>s.jsxs("div",{className:"flex items-center gap-1",children:[t&&s.jsx(t,{className:"w-3 h-3"}),s.jsx("span",{children:e})]}),d2=({label:t,icon:e,color:n})=>s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold",style:{color:n},children:[s.jsx("span",{children:t}),e&&s.jsx(e,{className:"w-4 h-4"})]}),u2=({viewMode:t,onViewChange:e})=>{const n=it(),i=o=>({padding:n.space[2],borderRadius:n.radius.md,border:"none",cursor:"pointer",transition:n.transition.normal,backgroundColor:o?"#ffffff":"transparent",boxShadow:o?n.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"}),r=o=>({width:"16px",height:"16px",color:o?n.primaryAccent:R.slate[500]});return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[1],padding:n.space[1],backgroundColor:R.slate[100],borderRadius:n.radius.lg},children:[s.jsx("button",{onClick:()=>e("grid"),style:i(t==="grid"),title:"Kachelansicht",children:s.jsx(_r,{style:r(t==="grid")})}),s.jsx("button",{onClick:()=>e("list"),style:i(t==="list"),title:"Listenansicht",children:s.jsx(Gc,{style:r(t==="list")})})]})},h2=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Bt},categoryBadge:c,customActions:d,onClick:u,className:p="",style:h={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>s.jsx(P.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.02},whileTap:{scale:.98},children:s.jsxs("div",{onClick:u,className:`bg-white rounded-3xl shadow-lg hover:shadow-xl transition-shadow duration-300 p-6 cursor-pointer border border-slate-100 h-full flex flex-col ${p}`,style:h,children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i?s.jsx(h0,{icon:i,gradient:m,textColor:x,size:"lg"}):n?s.jsx(qc,{className:y.classes,children:y.label}):null,s.jsxs("div",{className:"flex flex-col items-end gap-2",children:[d&&s.jsx("div",{onClick:v=>v.stopPropagation(),children:d}),i&&n&&s.jsx(qc,{className:y.classes,children:y.label}),c,a.length>0&&s.jsx("div",{className:"flex gap-1",children:a.slice(0,2).map((v,w)=>s.jsx("span",{className:"px-2 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs",children:v},w))})]})]}),s.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:t}),r&&s.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:g},children:r}),e&&s.jsx("p",{className:"text-slate-600 text-sm mb-4 flex-1 line-clamp-3",children:e}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[s.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:o.map((v,w)=>s.jsx(p0,{icon:v.icon,text:v.text},w))}),l&&s.jsx(d2,{label:l.label,icon:l.icon,color:g})]})]})}),p2=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Bt},categoryBadge:c,customActions:d,onClick:u,className:p="",style:h={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>{const v=it();return s.jsx(P.div,{variants:{hidden:{opacity:0,x:-20},visible:{opacity:1,x:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:s.jsxs("div",{onClick:u,style:{backgroundColor:"#ffffff",borderRadius:v.radius.xl,boxShadow:v.shadow.md,padding:v.space[4],cursor:"pointer",border:"1px solid #f1f5f9",transition:v.transition.normal,...h},className:p,children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:v.space[3],marginBottom:v.space[2]},children:[i&&s.jsx(h0,{icon:i,gradient:m,textColor:x,size:"sm"}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:v.fontSize.sm,fontWeight:700,color:"#0f172a",margin:0,lineHeight:1.3},children:t}),r&&s.jsx("span",{style:{fontSize:v.fontSize.xs,fontWeight:600,color:g},children:r})]}),d&&s.jsx("div",{onClick:w=>w.stopPropagation(),children:d}),n&&s.jsx(qc,{className:y.classes,children:y.label})]}),e&&s.jsx("p",{style:{color:"#475569",fontSize:v.fontSize.xs,margin:0,marginBottom:v.space[2],lineHeight:1.4,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:v.space[2]},children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:v.space[3],fontSize:v.fontSize.xs,color:"#64748b"},children:o.slice(0,2).map((w,k)=>s.jsx(p0,{icon:w.icon,text:w.text},k))}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[2]},children:[c,l&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[1],fontSize:v.fontSize.sm,fontWeight:600,color:g},children:[s.jsx("span",{children:l.label}),l.icon&&s.jsx(l.icon,{style:{width:"16px",height:"16px"}})]})]})]})]})})},f0=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Bt},categoryBadge:c,customActions:d,onClick:u,viewMode:p="grid",className:h="",style:m={}})=>{const x=it(),g=x.headerGradient,y=x.headerText,v=x.primaryAccent,w=c2(n),k={title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o,tags:a,action:l,categoryBadge:c,customActions:d,onClick:u,className:h,style:m,headerGradient:g,headerText:y,primaryAccent:v,difficultyConfig:w};return p==="list"?s.jsx(p2,{...k}):s.jsx(h2,{...k})},m0=({children:t,minCardWidth:e="320px",viewMode:n="grid",className:i=""})=>{const r=n==="list";return s.jsx(P.div,{className:`${r?"flex flex-col gap-3":"grid gap-6"} ${i}`,style:r?{}:{gridTemplateColumns:`repeat(auto-fit, minmax(min(100%, ${e}), 1fr))`},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:r?.05:.1}}},children:t})};function Fi(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t?.(r),n===!1||!r.defaultPrevented)return e?.(r)}}function Qp(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function g0(...t){return e=>{let n=!1;const i=t.map(r=>{const o=Qp(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():Qp(t[r],null)}}}}function Ss(...t){return f.useCallback(g0(...t),t)}function f2(t,e){const n=f.createContext(e),i=o=>{const{children:a,...l}=o,c=f.useMemo(()=>l,Object.values(l));return s.jsx(n.Provider,{value:c,children:a})};i.displayName=t+"Provider";function r(o){const a=f.useContext(n);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return[i,r]}function m2(t,e=[]){let n=[];function i(o,a){const l=f.createContext(a),c=n.length;n=[...n,a];const d=p=>{const{scope:h,children:m,...x}=p,g=h?.[t]?.[c]||l,y=f.useMemo(()=>x,Object.values(x));return s.jsx(g.Provider,{value:y,children:m})};d.displayName=o+"Provider";function u(p,h){const m=h?.[t]?.[c]||l,x=f.useContext(m);if(x)return x;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${o}\``)}return[d,u]}const r=()=>{const o=n.map(a=>f.createContext(a));return function(l){const c=l?.[t]||o;return f.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return r.scopeName=t,[i,g2(r,...e)]}function g2(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const a=i.reduce((l,{useScope:c,scopeName:d})=>{const p=c(o)[`__scope${d}`];return{...l,...p}},{});return f.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}var so=globalThis?.document?f.useLayoutEffect:()=>{},x2=Ed[" useId ".trim().toString()]||(()=>{}),y2=0;function zl(t){const[e,n]=f.useState(x2());return so(()=>{n(i=>i??String(y2++))},[t]),t||(e?`radix-${e}`:"")}var b2=Ed[" useInsertionEffect ".trim().toString()]||so;function v2({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,o,a]=S2({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:r;{const u=f.useRef(t!==void 0);f.useEffect(()=>{const p=u.current;p!==l&&console.warn(`${i} is changing from ${p?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,i])}const d=f.useCallback(u=>{if(l){const p=k2(u)?u(t):u;p!==t&&a.current?.(p)}else o(u)},[l,t,o,a]);return[c,d]}function S2({defaultProp:t,onChange:e}){const[n,i]=f.useState(t),r=f.useRef(n),o=f.useRef(e);return b2(()=>{o.current=e},[e]),f.useEffect(()=>{r.current!==n&&(o.current?.(n),r.current=n)},[n,r]),[n,i,o]}function k2(t){return typeof t=="function"}function x0(t){const e=w2(t),n=f.forwardRef((i,r)=>{const{children:o,...a}=i,l=f.Children.toArray(o),c=l.find(j2);if(c){const d=c.props.children,u=l.map(p=>p===c?f.Children.count(d)>1?f.Children.only(null):f.isValidElement(d)?d.props.children:null:p);return s.jsx(e,{...a,ref:r,children:f.isValidElement(d)?f.cloneElement(d,void 0,u):null})}return s.jsx(e,{...a,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}function w2(t){const e=f.forwardRef((n,i)=>{const{children:r,...o}=n;if(f.isValidElement(r)){const a=E2(r),l=T2(o,r.props);return r.type!==f.Fragment&&(l.ref=i?g0(i,a):a),f.cloneElement(r,l)}return f.Children.count(r)>1?f.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var C2=Symbol("radix.slottable");function j2(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===C2}function T2(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...l)=>{const c=o(...l);return r(...l),c}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function E2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var R2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ci=R2.reduce((t,e)=>{const n=x0(`Primitive.${e}`),i=f.forwardRef((r,o)=>{const{asChild:a,...l}=r,c=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(c,{...l,ref:o})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function I2(t,e){t&&Gm.flushSync(()=>t.dispatchEvent(e))}function ro(t){const e=f.useRef(t);return f.useEffect(()=>{e.current=t}),f.useMemo(()=>(...n)=>e.current?.(...n),[])}function _2(t,e=globalThis?.document){const n=ro(t);f.useEffect(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var N2="DismissableLayer",Kc="dismissableLayer.update",A2="dismissableLayer.pointerDownOutside",M2="dismissableLayer.focusOutside",ef,y0=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),b0=f.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:a,onDismiss:l,...c}=t,d=f.useContext(y0),[u,p]=f.useState(null),h=u?.ownerDocument??globalThis?.document,[,m]=f.useState({}),x=Ss(e,C=>p(C)),g=Array.from(d.layers),[y]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=g.indexOf(y),w=u?g.indexOf(u):-1,k=d.layersWithOutsidePointerEventsDisabled.size>0,S=w>=v,b=O2(C=>{const T=C.target,_=[...d.branches].some(E=>E.contains(T));!S||_||(r?.(C),a?.(C),C.defaultPrevented||l?.())},h),j=L2(C=>{const T=C.target;[...d.branches].some(E=>E.contains(T))||(o?.(C),a?.(C),C.defaultPrevented||l?.())},h);return _2(C=>{w===d.layers.size-1&&(i?.(C),!C.defaultPrevented&&l&&(C.preventDefault(),l()))},h),f.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(ef=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),tf(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=ef)}},[u,h,n,d]),f.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),tf())},[u,d]),f.useEffect(()=>{const C=()=>m({});return document.addEventListener(Kc,C),()=>document.removeEventListener(Kc,C)},[]),s.jsx(Ci.div,{...c,ref:x,style:{pointerEvents:k?S?"auto":"none":void 0,...t.style},onFocusCapture:Fi(t.onFocusCapture,j.onFocusCapture),onBlurCapture:Fi(t.onBlurCapture,j.onBlurCapture),onPointerDownCapture:Fi(t.onPointerDownCapture,b.onPointerDownCapture)})});b0.displayName=N2;var P2="DismissableLayerBranch",D2=f.forwardRef((t,e)=>{const n=f.useContext(y0),i=f.useRef(null),r=Ss(e,i);return f.useEffect(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),s.jsx(Ci.div,{...t,ref:r})});D2.displayName=P2;function O2(t,e=globalThis?.document){const n=ro(t),i=f.useRef(!1),r=f.useRef(()=>{});return f.useEffect(()=>{const o=l=>{if(l.target&&!i.current){let c=function(){v0(A2,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function L2(t,e=globalThis?.document){const n=ro(t),i=f.useRef(!1);return f.useEffect(()=>{const r=o=>{o.target&&!i.current&&v0(M2,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function tf(){const t=new CustomEvent(Kc);document.dispatchEvent(t)}function v0(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?I2(r,o):r.dispatchEvent(o)}var Bl="focusScope.autoFocusOnMount",Fl="focusScope.autoFocusOnUnmount",nf={bubbles:!1,cancelable:!0},z2="FocusScope",S0=f.forwardRef((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...a}=t,[l,c]=f.useState(null),d=ro(r),u=ro(o),p=f.useRef(null),h=Ss(e,g=>c(g)),m=f.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;f.useEffect(()=>{if(i){let g=function(k){if(m.paused||!l)return;const S=k.target;l.contains(S)?p.current=S:Ni(p.current,{select:!0})},y=function(k){if(m.paused||!l)return;const S=k.relatedTarget;S!==null&&(l.contains(S)||Ni(p.current,{select:!0}))},v=function(k){if(document.activeElement===document.body)for(const b of k)b.removedNodes.length>0&&Ni(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const w=new MutationObserver(v);return l&&w.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),w.disconnect()}}},[i,l,m.paused]),f.useEffect(()=>{if(l){rf.add(m);const g=document.activeElement;if(!l.contains(g)){const v=new CustomEvent(Bl,nf);l.addEventListener(Bl,d),l.dispatchEvent(v),v.defaultPrevented||(B2($2(k0(l)),{select:!0}),document.activeElement===g&&Ni(l))}return()=>{l.removeEventListener(Bl,d),setTimeout(()=>{const v=new CustomEvent(Fl,nf);l.addEventListener(Fl,u),l.dispatchEvent(v),v.defaultPrevented||Ni(g??document.body,{select:!0}),l.removeEventListener(Fl,u),rf.remove(m)},0)}}},[l,d,u,m]);const x=f.useCallback(g=>{if(!n&&!i||m.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,v=document.activeElement;if(y&&v){const w=g.currentTarget,[k,S]=F2(w);k&&S?!g.shiftKey&&v===S?(g.preventDefault(),n&&Ni(k,{select:!0})):g.shiftKey&&v===k&&(g.preventDefault(),n&&Ni(S,{select:!0})):v===w&&g.preventDefault()}},[n,i,m.paused]);return s.jsx(Ci.div,{tabIndex:-1,...a,ref:h,onKeyDown:x})});S0.displayName=z2;function B2(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(Ni(i,{select:e}),document.activeElement!==n)return}function F2(t){const e=k0(t),n=sf(e,t),i=sf(e.reverse(),t);return[n,i]}function k0(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function sf(t,e){for(const n of t)if(!U2(n,{upTo:e}))return n}function U2(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function W2(t){return t instanceof HTMLInputElement&&"select"in t}function Ni(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&W2(t)&&e&&t.select()}}var rf=V2();function V2(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=of(t,e),t.unshift(e)},remove(e){t=of(t,e),t[0]?.resume()}}}function of(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function $2(t){return t.filter(e=>e.tagName!=="A")}var G2="Portal",w0=f.forwardRef((t,e)=>{const{container:n,...i}=t,[r,o]=f.useState(!1);so(()=>o(!0),[]);const a=n||r&&globalThis?.document?.body;return a?Kv.createPortal(s.jsx(Ci.div,{...i,ref:e}),a):null});w0.displayName=G2;function H2(t,e){return f.useReducer((n,i)=>e[n][i]??n,t)}var tl=t=>{const{present:e,children:n}=t,i=q2(e),r=typeof n=="function"?n({present:i.isPresent}):f.Children.only(n),o=Ss(i.ref,K2(r));return typeof n=="function"||i.isPresent?f.cloneElement(r,{ref:o}):null};tl.displayName="Presence";function q2(t){const[e,n]=f.useState(),i=f.useRef(null),r=f.useRef(t),o=f.useRef("none"),a=t?"mounted":"unmounted",[l,c]=H2(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return f.useEffect(()=>{const d=Mo(i.current);o.current=l==="mounted"?d:"none"},[l]),so(()=>{const d=i.current,u=r.current;if(u!==t){const h=o.current,m=Mo(d);t?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&h!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,c]),so(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,p=m=>{const g=Mo(i.current).includes(CSS.escape(m.animationName));if(m.target===e&&g&&(c("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},h=m=>{m.target===e&&(o.current=Mo(i.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",p),e.addEventListener("animationend",p),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",p),e.removeEventListener("animationend",p)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:f.useCallback(d=>{i.current=d?getComputedStyle(d):null,n(d)},[])}}function Mo(t){return t?.animationName||"none"}function K2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Ul=0;function J2(){f.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??af()),document.body.insertAdjacentElement("beforeend",t[1]??af()),Ul++,()=>{Ul===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ul--}},[])}function af(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Yn=function(){return Yn=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Yn.apply(this,arguments)};function C0(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function Y2(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}var Qo="right-scroll-bar-position",ea="width-before-scroll-bar",X2="with-scroll-bars-hidden",Z2="--removed-body-scroll-bar-size";function Wl(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Q2(t,e){var n=f.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var eE=typeof window<"u"?f.useLayoutEffect:f.useEffect,lf=new WeakMap;function tE(t,e){var n=Q2(null,function(i){return t.forEach(function(r){return Wl(r,i)})});return eE(function(){var i=lf.get(n);if(i){var r=new Set(i),o=new Set(t),a=n.current;r.forEach(function(l){o.has(l)||Wl(l,null)}),o.forEach(function(l){r.has(l)||Wl(l,a)})}lf.set(n,t)},[t]),n}function nE(t){return t}function iE(t,e){e===void 0&&(e=nE);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var a=e(o,i);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(i=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){i=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var u=a;a=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){a.push(u),d()},filter:function(u){return a=a.filter(u),n}}}};return r}function sE(t){t===void 0&&(t={});var e=iE(null);return e.options=Yn({async:!0,ssr:!1},t),e}var j0=function(t){var e=t.sideCar,n=C0(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return f.createElement(i,Yn({},n))};j0.isSideCarExport=!0;function rE(t,e){return t.useMedium(e),j0}var T0=sE(),Vl=function(){},nl=f.forwardRef(function(t,e){var n=f.useRef(null),i=f.useState({onScrollCapture:Vl,onWheelCapture:Vl,onTouchMoveCapture:Vl}),r=i[0],o=i[1],a=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,p=t.shards,h=t.sideCar,m=t.noRelative,x=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,k=t.gapMode,S=C0(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=h,j=tE([n,e]),C=Yn(Yn({},S),r);return f.createElement(f.Fragment,null,u&&f.createElement(b,{sideCar:T0,removeScrollBar:d,shards:p,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!y,lockRef:n,gapMode:k}),a?f.cloneElement(f.Children.only(l),Yn(Yn({},C),{ref:j})):f.createElement(w,Yn({},C,{className:c,ref:j}),l))});nl.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nl.classNames={fullWidth:ea,zeroRight:Qo};var oE=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function aE(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=oE();return e&&t.setAttribute("nonce",e),t}function lE(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function cE(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var dE=function(){var t=0,e=null;return{add:function(n){t==0&&(e=aE())&&(lE(e,n),cE(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},uE=function(){var t=dE();return function(e,n){f.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},E0=function(){var t=uE(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},hE={left:0,top:0,right:0,gap:0},$l=function(t){return parseInt(t||"",10)||0},pE=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[$l(n),$l(i),$l(r)]},fE=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return hE;var e=pE(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},mE=E0(),Ks="data-scroll-locked",gE=function(t,e,n,i){var r=t.left,o=t.top,a=t.right,l=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(X2,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(l,"px ").concat(i,`;
  }
  body[`).concat(Ks,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Qo,` {
    right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(ea,` {
    margin-right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(Qo," .").concat(Qo,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(ea," .").concat(ea,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Ks,`] {
    `).concat(Z2,": ").concat(l,`px;
  }
`)},cf=function(){var t=parseInt(document.body.getAttribute(Ks)||"0",10);return isFinite(t)?t:0},xE=function(){f.useEffect(function(){return document.body.setAttribute(Ks,(cf()+1).toString()),function(){var t=cf()-1;t<=0?document.body.removeAttribute(Ks):document.body.setAttribute(Ks,t.toString())}},[])},yE=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;xE();var o=f.useMemo(function(){return fE(r)},[r]);return f.createElement(mE,{styles:gE(o,!e,r,n?"":"!important")})},Jc=!1;if(typeof window<"u")try{var Po=Object.defineProperty({},"passive",{get:function(){return Jc=!0,!0}});window.addEventListener("test",Po,Po),window.removeEventListener("test",Po,Po)}catch{Jc=!1}var Ns=Jc?{passive:!1}:!1,bE=function(t){return t.tagName==="TEXTAREA"},R0=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!bE(t)&&n[e]==="visible")},vE=function(t){return R0(t,"overflowY")},SE=function(t){return R0(t,"overflowX")},df=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=I0(t,i);if(r){var o=_0(t,i),a=o[1],l=o[2];if(a>l)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},kE=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},wE=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},I0=function(t,e){return t==="v"?vE(e):SE(e)},_0=function(t,e){return t==="v"?kE(e):wE(e)},CE=function(t,e){return t==="h"&&e==="rtl"?-1:1},jE=function(t,e,n,i,r){var o=CE(t,window.getComputedStyle(e).direction),a=o*i,l=n.target,c=e.contains(l),d=!1,u=a>0,p=0,h=0;do{if(!l)break;var m=_0(t,l),x=m[0],g=m[1],y=m[2],v=g-y-o*x;(x||v)&&I0(t,l)&&(p+=v,h+=x);var w=l.parentNode;l=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(p)<1||!u&&Math.abs(h)<1)&&(d=!0),d},Do=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},uf=function(t){return[t.deltaX,t.deltaY]},hf=function(t){return t&&"current"in t?t.current:t},TE=function(t,e){return t[0]===e[0]&&t[1]===e[1]},EE=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},RE=0,As=[];function IE(t){var e=f.useRef([]),n=f.useRef([0,0]),i=f.useRef(),r=f.useState(RE++)[0],o=f.useState(E0)[0],a=f.useRef(t);f.useEffect(function(){a.current=t},[t]),f.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var g=Y2([t.lockRef.current],(t.shards||[]).map(hf),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var l=f.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!a.current.allowPinchZoom;var v=Do(g),w=n.current,k="deltaX"in g?g.deltaX:w[0]-v[0],S="deltaY"in g?g.deltaY:w[1]-v[1],b,j=g.target,C=Math.abs(k)>Math.abs(S)?"h":"v";if("touches"in g&&C==="h"&&j.type==="range")return!1;var T=df(C,j);if(!T)return!0;if(T?b=C:(b=C==="v"?"h":"v",T=df(C,j)),!T)return!1;if(!i.current&&"changedTouches"in g&&(k||S)&&(i.current=b),!b)return!0;var _=i.current||b;return jE(_,y,g,_==="h"?k:S)},[]),c=f.useCallback(function(g){var y=g;if(!(!As.length||As[As.length-1]!==o)){var v="deltaY"in y?uf(y):Do(y),w=e.current.filter(function(b){return b.name===y.type&&(b.target===y.target||y.target===b.shadowParent)&&TE(b.delta,v)})[0];if(w&&w.should){y.cancelable&&y.preventDefault();return}if(!w){var k=(a.current.shards||[]).map(hf).filter(Boolean).filter(function(b){return b.contains(y.target)}),S=k.length>0?l(y,k[0]):!a.current.noIsolation;S&&y.cancelable&&y.preventDefault()}}},[]),d=f.useCallback(function(g,y,v,w){var k={name:g,delta:y,target:v,should:w,shadowParent:_E(v)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(S){return S!==k})},1)},[]),u=f.useCallback(function(g){n.current=Do(g),i.current=void 0},[]),p=f.useCallback(function(g){d(g.type,uf(g),g.target,l(g,t.lockRef.current))},[]),h=f.useCallback(function(g){d(g.type,Do(g),g.target,l(g,t.lockRef.current))},[]);f.useEffect(function(){return As.push(o),t.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:h}),document.addEventListener("wheel",c,Ns),document.addEventListener("touchmove",c,Ns),document.addEventListener("touchstart",u,Ns),function(){As=As.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Ns),document.removeEventListener("touchmove",c,Ns),document.removeEventListener("touchstart",u,Ns)}},[]);var m=t.removeScrollBar,x=t.inert;return f.createElement(f.Fragment,null,x?f.createElement(o,{styles:EE(r)}):null,m?f.createElement(yE,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function _E(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const NE=rE(T0,IE);var N0=f.forwardRef(function(t,e){return f.createElement(nl,Yn({},t,{ref:e,sideCar:NE}))});N0.classNames=nl.classNames;var AE=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Ms=new WeakMap,Oo=new WeakMap,Lo={},Gl=0,A0=function(t){return t&&(t.host||A0(t.parentNode))},ME=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=A0(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},PE=function(t,e,n,i){var r=ME(e,Array.isArray(t)?t:[t]);Lo[n]||(Lo[n]=new WeakMap);var o=Lo[n],a=[],l=new Set,c=new Set(r),d=function(p){!p||l.has(p)||(l.add(p),d(p.parentNode))};r.forEach(d);var u=function(p){!p||c.has(p)||Array.prototype.forEach.call(p.children,function(h){if(l.has(h))u(h);else try{var m=h.getAttribute(i),x=m!==null&&m!=="false",g=(Ms.get(h)||0)+1,y=(o.get(h)||0)+1;Ms.set(h,g),o.set(h,y),a.push(h),g===1&&x&&Oo.set(h,!0),y===1&&h.setAttribute(n,"true"),x||h.setAttribute(i,"true")}catch(v){console.error("aria-hidden: cannot operate on ",h,v)}})};return u(e),l.clear(),Gl++,function(){a.forEach(function(p){var h=Ms.get(p)-1,m=o.get(p)-1;Ms.set(p,h),o.set(p,m),h||(Oo.has(p)||p.removeAttribute(i),Oo.delete(p)),m||p.removeAttribute(n)}),Gl--,Gl||(Ms=new WeakMap,Ms=new WeakMap,Oo=new WeakMap,Lo={})}},DE=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=AE(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),PE(i,r,n,"aria-hidden")):function(){return null}},il="Dialog",[M0]=m2(il),[OE,qn]=M0(il),P0=t=>{const{__scopeDialog:e,children:n,open:i,defaultOpen:r,onOpenChange:o,modal:a=!0}=t,l=f.useRef(null),c=f.useRef(null),[d,u]=v2({prop:i,defaultProp:r??!1,onChange:o,caller:il});return s.jsx(OE,{scope:e,triggerRef:l,contentRef:c,contentId:zl(),titleId:zl(),descriptionId:zl(),open:d,onOpenChange:u,onOpenToggle:f.useCallback(()=>u(p=>!p),[u]),modal:a,children:n})};P0.displayName=il;var D0="DialogTrigger",LE=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=qn(D0,n),o=Ss(e,r.triggerRef);return s.jsx(Ci.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":ku(r.open),...i,ref:o,onClick:Fi(t.onClick,r.onOpenToggle)})});LE.displayName=D0;var vu="DialogPortal",[zE,O0]=M0(vu,{forceMount:void 0}),L0=t=>{const{__scopeDialog:e,forceMount:n,children:i,container:r}=t,o=qn(vu,e);return s.jsx(zE,{scope:e,forceMount:n,children:f.Children.map(i,a=>s.jsx(tl,{present:n||o.open,children:s.jsx(w0,{asChild:!0,container:r,children:a})}))})};L0.displayName=vu;var Ta="DialogOverlay",z0=f.forwardRef((t,e)=>{const n=O0(Ta,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=qn(Ta,t.__scopeDialog);return o.modal?s.jsx(tl,{present:i||o.open,children:s.jsx(FE,{...r,ref:e})}):null});z0.displayName=Ta;var BE=x0("DialogOverlay.RemoveScroll"),FE=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=qn(Ta,n);return s.jsx(N0,{as:BE,allowPinchZoom:!0,shards:[r.contentRef],children:s.jsx(Ci.div,{"data-state":ku(r.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),gs="DialogContent",B0=f.forwardRef((t,e)=>{const n=O0(gs,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=qn(gs,t.__scopeDialog);return s.jsx(tl,{present:i||o.open,children:o.modal?s.jsx(UE,{...r,ref:e}):s.jsx(WE,{...r,ref:e})})});B0.displayName=gs;var UE=f.forwardRef((t,e)=>{const n=qn(gs,t.__scopeDialog),i=f.useRef(null),r=Ss(e,n.contentRef,i);return f.useEffect(()=>{const o=i.current;if(o)return DE(o)},[]),s.jsx(F0,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fi(t.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Fi(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:Fi(t.onFocusOutside,o=>o.preventDefault())})}),WE=f.forwardRef((t,e)=>{const n=qn(gs,t.__scopeDialog),i=f.useRef(!1),r=f.useRef(!1);return s.jsx(F0,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(i.current||n.triggerRef.current?.focus(),o.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const a=o.target;n.triggerRef.current?.contains(a)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),F0=f.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,...a}=t,l=qn(gs,n),c=f.useRef(null),d=Ss(e,c);return J2(),s.jsxs(s.Fragment,{children:[s.jsx(S0,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:o,children:s.jsx(b0,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":ku(l.open),...a,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),s.jsxs(s.Fragment,{children:[s.jsx(VE,{titleId:l.titleId}),s.jsx(GE,{contentRef:c,descriptionId:l.descriptionId})]})]})}),Su="DialogTitle",U0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=qn(Su,n);return s.jsx(Ci.h2,{id:r.titleId,...i,ref:e})});U0.displayName=Su;var W0="DialogDescription",V0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=qn(W0,n);return s.jsx(Ci.p,{id:r.descriptionId,...i,ref:e})});V0.displayName=W0;var $0="DialogClose",G0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=qn($0,n);return s.jsx(Ci.button,{type:"button",...i,ref:e,onClick:Fi(t.onClick,()=>r.onOpenChange(!1))})});G0.displayName=$0;function ku(t){return t?"open":"closed"}var H0="DialogTitleWarning",[mD,q0]=f2(H0,{contentName:gs,titleName:Su,docsSlug:"dialog"}),VE=({titleId:t})=>{const e=q0(H0),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return f.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},$E="DialogDescriptionWarning",GE=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${q0($E).contentName}}.`;return f.useEffect(()=>{const r=t.current?.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},HE=P0,qE=L0,K0=z0,J0=B0,Y0=U0,X0=V0,KE=G0;function Z0(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=Z0(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function Q0(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=Z0(t))&&(i&&(i+=" "),i+=e);return i}const wu="-",JE=t=>{const e=XE(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:a=>{const l=a.split(wu);return l[0]===""&&l.length!==1&&l.shift(),ey(l,e)||YE(a)},getConflictingClassGroupIds:(a,l)=>{const c=n[a]||[];return l&&i[a]?[...c,...i[a]]:c}}},ey=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],i=e.nextPart.get(n),r=i?ey(t.slice(1),i):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join(wu);return e.validators.find(({validator:a})=>a(o))?.classGroupId},pf=/^\[(.+)\]$/,YE=t=>{if(pf.test(t)){const e=pf.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},XE=t=>{const{theme:e,prefix:n}=t,i={nextPart:new Map,validators:[]};return QE(Object.entries(t.classGroups),n).forEach(([o,a])=>{Yc(a,i,o,e)}),i},Yc=(t,e,n,i)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:ff(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(ZE(r)){Yc(r(i),e,n,i);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,a])=>{Yc(a,ff(e,o),n,i)})})},ff=(t,e)=>{let n=t;return e.split(wu).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n},ZE=t=>t.isThemeGetter,QE=(t,e)=>e?t.map(([n,i])=>{const r=i.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,l])=>[e+a,l])):o);return[n,r]}):t,eR=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,i=new Map;const r=(o,a)=>{n.set(o,a),e++,e>t&&(e=0,i=n,n=new Map)};return{get(o){let a=n.get(o);if(a!==void 0)return a;if((a=i.get(o))!==void 0)return r(o,a),a},set(o,a){n.has(o)?n.set(o,a):r(o,a)}}},ty="!",tR=t=>{const{separator:e,experimentalParseClassName:n}=t,i=e.length===1,r=e[0],o=e.length,a=l=>{const c=[];let d=0,u=0,p;for(let y=0;y<l.length;y++){let v=l[y];if(d===0){if(v===r&&(i||l.slice(y,y+o)===e)){c.push(l.slice(u,y)),u=y+o;continue}if(v==="/"){p=y;continue}}v==="["?d++:v==="]"&&d--}const h=c.length===0?l:l.substring(u),m=h.startsWith(ty),x=m?h.substring(1):h,g=p&&p>u?p-u:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:x,maybePostfixModifierPosition:g}};return n?l=>n({className:l,parseClassName:a}):a},nR=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(i=>{i[0]==="["?(e.push(...n.sort(),i),n=[]):n.push(i)}),e.push(...n.sort()),e},iR=t=>({cache:eR(t.cacheSize),parseClassName:tR(t),...JE(t)}),sR=/\s+/,rR=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r}=e,o=[],a=t.trim().split(sR);let l="";for(let c=a.length-1;c>=0;c-=1){const d=a[c],{modifiers:u,hasImportantModifier:p,baseClassName:h,maybePostfixModifierPosition:m}=n(d);let x=!!m,g=i(x?h.substring(0,m):h);if(!g){if(!x){l=d+(l.length>0?" "+l:l);continue}if(g=i(h),!g){l=d+(l.length>0?" "+l:l);continue}x=!1}const y=nR(u).join(":"),v=p?y+ty:y,w=v+g;if(o.includes(w))continue;o.push(w);const k=r(g,x);for(let S=0;S<k.length;++S){const b=k[S];o.push(v+b)}l=d+(l.length>0?" "+l:l)}return l};function oR(){let t=0,e,n,i="";for(;t<arguments.length;)(e=arguments[t++])&&(n=ny(e))&&(i&&(i+=" "),i+=n);return i}const ny=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=ny(t[i]))&&(n&&(n+=" "),n+=e);return n};function aR(t,...e){let n,i,r,o=a;function a(c){const d=e.reduce((u,p)=>p(u),t());return n=iR(d),i=n.cache.get,r=n.cache.set,o=l,l(c)}function l(c){const d=i(c);if(d)return d;const u=rR(c,n);return r(c,u),u}return function(){return o(oR.apply(null,arguments))}}const rt=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},iy=/^\[(?:([a-z-]+):)?(.+)\]$/i,lR=/^\d+\/\d+$/,cR=new Set(["px","full","screen"]),dR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,uR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,hR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,pR=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,fR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,di=t=>Js(t)||cR.has(t)||lR.test(t),Ti=t=>gr(t,"length",kR),Js=t=>!!t&&!Number.isNaN(Number(t)),Hl=t=>gr(t,"number",Js),vr=t=>!!t&&Number.isInteger(Number(t)),mR=t=>t.endsWith("%")&&Js(t.slice(0,-1)),we=t=>iy.test(t),Ei=t=>dR.test(t),gR=new Set(["length","size","percentage"]),xR=t=>gr(t,gR,sy),yR=t=>gr(t,"position",sy),bR=new Set(["image","url"]),vR=t=>gr(t,bR,CR),SR=t=>gr(t,"",wR),Sr=()=>!0,gr=(t,e,n)=>{const i=iy.exec(t);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):n(i[2]):!1},kR=t=>uR.test(t)&&!hR.test(t),sy=()=>!1,wR=t=>pR.test(t),CR=t=>fR.test(t),jR=()=>{const t=rt("colors"),e=rt("spacing"),n=rt("blur"),i=rt("brightness"),r=rt("borderColor"),o=rt("borderRadius"),a=rt("borderSpacing"),l=rt("borderWidth"),c=rt("contrast"),d=rt("grayscale"),u=rt("hueRotate"),p=rt("invert"),h=rt("gap"),m=rt("gradientColorStops"),x=rt("gradientColorStopPositions"),g=rt("inset"),y=rt("margin"),v=rt("opacity"),w=rt("padding"),k=rt("saturate"),S=rt("scale"),b=rt("sepia"),j=rt("skew"),C=rt("space"),T=rt("translate"),_=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],N=()=>["auto",we,e],L=()=>[we,e],V=()=>["",di,Ti],D=()=>["auto",Js,we],A=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],F=()=>["solid","dashed","dotted","double","none"],B=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],M=()=>["start","end","center","between","around","evenly","stretch"],z=()=>["","0",we],U=()=>["auto","avoid","all","avoid-page","page","left","right","column"],W=()=>[Js,we];return{cacheSize:500,separator:":",theme:{colors:[Sr],spacing:[di,Ti],blur:["none","",Ei,we],brightness:W(),borderColor:[t],borderRadius:["none","","full",Ei,we],borderSpacing:L(),borderWidth:V(),contrast:W(),grayscale:z(),hueRotate:W(),invert:z(),gap:L(),gradientColorStops:[t],gradientColorStopPositions:[mR,Ti],inset:N(),margin:N(),opacity:W(),padding:L(),saturate:W(),scale:W(),sepia:z(),skew:W(),space:L(),translate:L()},classGroups:{aspect:[{aspect:["auto","square","video",we]}],container:["container"],columns:[{columns:[Ei]}],"break-after":[{"break-after":U()}],"break-before":[{"break-before":U()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...A(),we]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:_()}],"overscroll-x":[{"overscroll-x":_()}],"overscroll-y":[{"overscroll-y":_()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",vr,we]}],basis:[{basis:N()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",we]}],grow:[{grow:z()}],shrink:[{shrink:z()}],order:[{order:["first","last","none",vr,we]}],"grid-cols":[{"grid-cols":[Sr]}],"col-start-end":[{col:["auto",{span:["full",vr,we]},we]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[Sr]}],"row-start-end":[{row:["auto",{span:[vr,we]},we]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",we]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",we]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...M()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...M(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...M(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[w]}],px:[{px:[w]}],py:[{py:[w]}],ps:[{ps:[w]}],pe:[{pe:[w]}],pt:[{pt:[w]}],pr:[{pr:[w]}],pb:[{pb:[w]}],pl:[{pl:[w]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",we,e]}],"min-w":[{"min-w":[we,e,"min","max","fit"]}],"max-w":[{"max-w":[we,e,"none","full","min","max","fit","prose",{screen:[Ei]},Ei]}],h:[{h:[we,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[we,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[we,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[we,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ei,Ti]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Hl]}],"font-family":[{font:[Sr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",we]}],"line-clamp":[{"line-clamp":["none",Js,Hl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",di,we]}],"list-image":[{"list-image":["none",we]}],"list-style-type":[{list:["none","disc","decimal",we]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...F(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",di,Ti]}],"underline-offset":[{"underline-offset":["auto",di,we]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:L()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...A(),yR]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",xR]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},vR]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...F(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:F()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...F()]}],"outline-offset":[{"outline-offset":[di,we]}],"outline-w":[{outline:[di,Ti]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:V()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[di,Ti]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ei,SR]}],"shadow-color":[{shadow:[Sr]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...B(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":B()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ei,we]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[p]}],saturate:[{saturate:[k]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[p]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[k]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",we]}],duration:[{duration:W()}],ease:[{ease:["linear","in","out","in-out",we]}],delay:[{delay:W()}],animate:[{animate:["none","spin","ping","pulse","bounce",we]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[S]}],"scale-x":[{"scale-x":[S]}],"scale-y":[{"scale-y":[S]}],rotate:[{rotate:[vr,we]}],"translate-x":[{"translate-x":[T]}],"translate-y":[{"translate-y":[T]}],"skew-x":[{"skew-x":[j]}],"skew-y":[{"skew-y":[j]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",we]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",we]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":L()}],"scroll-mx":[{"scroll-mx":L()}],"scroll-my":[{"scroll-my":L()}],"scroll-ms":[{"scroll-ms":L()}],"scroll-me":[{"scroll-me":L()}],"scroll-mt":[{"scroll-mt":L()}],"scroll-mr":[{"scroll-mr":L()}],"scroll-mb":[{"scroll-mb":L()}],"scroll-ml":[{"scroll-ml":L()}],"scroll-p":[{"scroll-p":L()}],"scroll-px":[{"scroll-px":L()}],"scroll-py":[{"scroll-py":L()}],"scroll-ps":[{"scroll-ps":L()}],"scroll-pe":[{"scroll-pe":L()}],"scroll-pt":[{"scroll-pt":L()}],"scroll-pr":[{"scroll-pr":L()}],"scroll-pb":[{"scroll-pb":L()}],"scroll-pl":[{"scroll-pl":L()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",we]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[di,Ti,Hl]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},TR=aR(jR);function pe(...t){return TR(Q0(t))}const En=f.forwardRef(({onOpenChange:t,...e},n)=>{const i=f.useCallback(r=>{t&&t(r)},[t]);return s.jsx(HE,{onOpenChange:i,...e})});En.displayName="Dialog";const ER=qE,ry=f.forwardRef(({className:t,...e},n)=>s.jsx(K0,{ref:n,className:pe("fixed inset-0 z-[99] bg-slate-900/60 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));ry.displayName=K0.displayName;const Rn=f.forwardRef(({className:t,children:e,...n},i)=>s.jsxs(ER,{children:[s.jsx(ry,{}),s.jsxs(J0,{ref:i,className:pe("fixed left-[50%] top-[50%] z-[99] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4","border border-slate-200 bg-white p-6 shadow-2xl rounded-2xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...n,children:[e,s.jsxs(KE,{style:{position:"absolute",right:"16px",top:"16px",borderRadius:"8px",padding:"6px",color:"#94a3b8",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:r=>{r.currentTarget.style.color="#475569",r.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.color="#94a3b8",r.currentTarget.style.backgroundColor="transparent"},children:[s.jsx(rn,{style:{width:"20px",height:"20px"}}),s.jsx("span",{className:"sr-only",children:"Schlieen"})]})]})]}));Rn.displayName=J0.displayName;const In=({className:t,...e})=>s.jsx("div",{className:pe("flex flex-col space-y-2 text-center sm:text-left",t),...e});In.displayName="DialogHeader";const Wn=({className:t,...e})=>s.jsx("div",{className:pe("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end pt-4",t),...e});Wn.displayName="DialogFooter";const _n=f.forwardRef(({className:t,...e},n)=>s.jsx(Y0,{ref:n,className:pe("text-xl font-semibold text-slate-900 leading-none tracking-tight",t),...e}));_n.displayName=Y0.displayName;const Vn=f.forwardRef(({className:t,...e},n)=>s.jsx(X0,{ref:n,className:pe("text-sm text-slate-600 leading-relaxed",t),...e}));Vn.displayName=X0.displayName;const mf=768,RR=()=>{const[t,e]=f.useState(typeof window<"u"?window.innerWidth<mf:!1);return ur.useEffect(()=>{const n=()=>{e(window.innerWidth<mf)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t},zo=({label:t,icon:e,isSelected:n,onClick:i,color:r,bgColor:o})=>{const a=it(),l=r||a.primaryAccent,c=o||`${a.primaryAccent}15`;return s.jsxs("button",{onClick:i,style:{display:"inline-flex",alignItems:"center",gap:a.space[2],padding:`${a.space[2]} ${a.space[3]}`,borderRadius:a.radius.full,fontSize:a.fontSize.sm,fontWeight:600,border:`2px solid ${n?l:R.slate[200]}`,backgroundColor:n?c:"white",color:n?l:R.slate[600],cursor:"pointer",transition:a.transition.normal,whiteSpace:"nowrap"},children:[e&&s.jsx(e,{style:{width:"14px",height:"14px"}}),t]})},IR=({count:t})=>{const e=it();return t===0?null:s.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"18px",height:"18px",padding:`0 ${e.space[1]}`,borderRadius:e.radius.md,backgroundColor:"#ef4444",color:"white",fontSize:e.fontSize.xs,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center"},children:t})},_R=({searchQuery:t,onSearchChange:e,searchPlaceholder:n="Durchsuchen...",showSearch:i=!0,categories:r=[],selectedCategory:o,onCategoryChange:a,showCategories:l=!0,difficultyOptions:c=[],selectedDifficulty:d,onDifficultyChange:u,showDifficulty:p=!1,viewMode:h,onViewModeChange:m,showViewToggle:x=!0,renderCustomFilters:g,customActions:y,children:v})=>{const[w,k]=f.useState(!1),S=RR(),b=it(),j=[o?1:0,d&&d!=="all"?1:0,t?.trim()?1:0].reduce((C,T)=>C+T,0);return S?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[3]},children:[s.jsxs("div",{style:{display:"flex",gap:b.space[2],alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1"},children:[s.jsx(ps,{style:{position:"absolute",left:b.space[3],top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:C=>e(C.target.value),style:{width:"100%",padding:`${b.space[2]} ${b.space[3]} ${b.space[2]} 38px`,borderRadius:b.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",outline:"none"}})]}),s.jsxs("button",{onClick:()=>k(!0),style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"44px",borderRadius:b.radius.md,border:`1px solid ${j>0?b.primaryAccent:R.slate[200]}`,backgroundColor:j>0?`${b.primaryAccent}10`:"white",cursor:"pointer",flexShrink:0},children:[s.jsx(Xo,{style:{width:"18px",height:"18px",color:j>0?b.primaryAccent:R.slate[500]}}),s.jsx(IR,{count:j})]}),x&&h&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",padding:"3px",backgroundColor:R.slate[100],borderRadius:b.radius.md,flexShrink:0},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:h==="grid"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(_r,{style:{width:"14px",height:"14px",color:h==="grid"?b.primaryAccent:R.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:h==="list"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Gc,{style:{width:"14px",height:"14px",color:h==="list"?b.primaryAccent:R.slate[500]}})})]})]}),y&&s.jsx("div",{style:{marginTop:b.space[2]},children:y}),s.jsx(En,{open:w,onOpenChange:k,children:s.jsxs(Rn,{style:{position:"fixed",bottom:0,left:0,right:0,top:"auto",transform:"none",maxWidth:"100%",width:"100%",borderRadius:`${b.radius.xl} ${b.radius.xl} 0 0`,maxHeight:"80vh",overflow:"auto"},children:[s.jsx(In,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(_n,{style:{display:"flex",alignItems:"center",gap:b.space[2]},children:[s.jsx(Xo,{style:{width:"20px",height:"20px",color:b.primaryAccent}}),"Filter"]}),j>0&&s.jsx("button",{onClick:()=>{a?.(null),u?.("all"),e?.("")},style:{padding:`${b.space[1]} ${b.space[3]}`,borderRadius:b.radius.sm,border:"none",backgroundColor:R.slate[100],color:R.slate[600],fontSize:b.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Zurcksetzen"})]})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[5],padding:`${b.space[2]} 0`},children:[p&&c.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:b.space[2]},children:"Schwierigkeit"}),s.jsx("select",{value:d,onChange:C=>u(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px`,borderRadius:b.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(C=>s.jsx("option",{value:C.value,children:C.label},C.value))})]}),l&&r.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:b.space[2]},children:"Kategorie"}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[s.jsx(zo,{label:"Alle",icon:_r,isSelected:!o,onClick:()=>a(null)}),r.map(C=>s.jsx(zo,{label:C.label,icon:C.icon,isSelected:o===C.key,onClick:()=>a(C.key),color:C.color,bgColor:C.bgColor},C.key))]})]}),g&&s.jsx("div",{children:g()})]}),s.jsx("button",{onClick:()=>k(!1),style:{width:"100%",padding:b.space[3],marginTop:b.space[3],borderRadius:b.radius.lg,border:"none",background:`linear-gradient(135deg, ${b.primaryAccent} 0%, ${b.primaryAccent}dd 100%)`,color:"white",fontSize:b.fontSize.md,fontWeight:600,cursor:"pointer"},children:"Filter anwenden"})]})}),v]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[4]},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[3],alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[s.jsx(ps,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:C=>e(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 44px`,borderRadius:b.radius.lg,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",outline:"none",transition:b.transition.normal},onFocus:C=>{C.target.style.borderColor=b.primaryAccent,C.target.style.boxShadow=`0 0 0 3px ${b.primaryAccent}20`},onBlur:C=>{C.target.style.borderColor=R.slate[200],C.target.style.boxShadow="none"}})]}),p&&c.length>0&&s.jsxs("div",{style:{position:"relative",minWidth:"180px"},children:[s.jsx(Xo,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("select",{value:d,onChange:C=>u(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 40px`,borderRadius:b.radius.lg,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(C=>s.jsx("option",{value:C.value,children:C.label},C.value))})]}),g&&g(),y,x&&h&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:b.space[1],padding:b.space[1],backgroundColor:R.slate[100],borderRadius:b.radius.md},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:h==="grid"?"#ffffff":"transparent",boxShadow:h==="grid"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Kachelansicht",children:s.jsx(_r,{style:{width:"16px",height:"16px",color:h==="grid"?b.primaryAccent:R.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:h==="list"?"#ffffff":"transparent",boxShadow:h==="list"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Listenansicht",children:s.jsx(Gc,{style:{width:"16px",height:"16px",color:h==="list"?b.primaryAccent:R.slate[500]}})})]})]}),l&&r.length>0&&s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[s.jsx(zo,{label:"Alle",icon:_r,isSelected:!o,onClick:()=>a(null)}),r.map(C=>s.jsx(zo,{label:C.label,icon:C.icon,isSelected:o===C.key,onClick:()=>a(C.key),color:C.color,bgColor:C.bgColor},C.key))]}),v]})},gf=({category:t,getCategoryConfig:e})=>{const n=e(t);if(!n)return null;const i=n.IconComponent||n.icon||ko;return s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:n.bgColor,color:n.color},children:[s.jsx(i,{style:{width:"12px",height:"12px"}}),n.shortLabel]})},NR=({category:t,getCategoryConfig:e})=>Array.isArray(t)?s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:t.map((n,i)=>s.jsx(gf,{category:n,getCategoryConfig:e},i))}):s.jsx(gf,{category:t,getCategoryConfig:e}),sl=({title:t,subtitle:e,headerIcon:n,fetchScenarios:i,moduleKey:r,historyButtonLabel:o="Meine Sessions",onNavigateToHistory:a,showHistoryButton:l=!0,onSelectScenario:c,renderCardMeta:d,renderCategoryBadge:u,getIconForScenario:p,cardActionLabel:h="Starten",cardActionIcon:m,getCardCustomActions:x,categoryField:g="category",customCategoryConfig:y,emptyStateIcon:v,emptyStateTitle:w="Keine Szenarien verfgbar",emptyStateMessage:k="Bitte kontaktieren Sie den Administrator.",searchPlaceholder:S="Durchsuchen...",headerActions:b,filterActions:j,renderInfoBox:C,extraContent:T,isAuthenticated:_,requireAuth:E,setPendingAction:N,setPendingScenario:L,demoCode:V,pendingScenario:D,clearPendingScenario:A,loadingMessage:F="Szenarien werden geladen...",errorRetryLabel:B="Erneut versuchen"})=>{const[M,z]=f.useState([]),[U,W]=f.useState(!0),[q,le]=f.useState(null),[de,ue]=f.useState(null),[$,Se]=f.useState("grid"),[xe,Ke]=f.useState(""),{branding:st,filterScenariosBySetupAndPartner:Ve}=Fe(),{getCategoryConfig:ft,getCategoriesForFilter:St,matchesCategory:Ze}=l2(),Ct=st?.["--header-gradient"]||ve["--header-gradient"],qt=st?.["--header-text"]||ve["--header-text"],Ge=st?.["--primary-accent"]||ve["--primary-accent"],Qe=f.useCallback(async()=>{try{W(!0),le(null);const K=await i();z(K||[])}catch(K){console.error(`[${t}] Error loading scenarios:`,K),le(K.message||"Fehler beim Laden")}finally{W(!1)}},[i,t]);f.useEffect(()=>{Qe()},[Qe]);const ze=f.useRef(!1);f.useEffect(()=>{D&&_&&!ze.current&&(ze.current=!0,A&&A(),c(D))},[D,_,A,c]);const et=f.useMemo(()=>Ve([...M],r),[M,Ve,r]),se=f.useMemo(()=>{if(y){const Q=new Set;return et.forEach(ce=>{const Ee=ce[g];Ee&&y[Ee]&&Q.add(Ee)}),Array.from(Q)}const K=et.flatMap(Q=>{const ce=Q[g];return Array.isArray(ce)?ce.filter(Ee=>Ee&&typeof Ee=="string"&&Ee.trim()):ce&&typeof ce=="string"&&ce.trim()?[ce]:[]});return[...new Set(K)]},[et,g,y]),Z=f.useMemo(()=>y?se.filter(Q=>et.some(ce=>ce[g]===Q)).map(Q=>({key:Q,label:y[Q]?.label||Q,shortLabel:y[Q]?.label||Q,color:y[Q]?.color,bgColor:y[Q]?.bgColor,icon:y[Q]?.icon,IconComponent:y[Q]?.icon})):St(se).filter(Q=>!Q||!Q.label||!Q.label.trim()?!1:et.some(ce=>Ze(ce[g],Q.key))),[se,y,St,et,g,Ze]),re=f.useMemo(()=>{let K=[...et];if(de&&(y?K=K.filter(Q=>Q[g]===de):K=K.filter(Q=>Ze(Q[g],de))),xe.trim()){const Q=xe.toLowerCase();K=K.filter(ce=>ce.title?.toLowerCase().includes(Q)||ce.description?.toLowerCase().includes(Q))}return K},[et,de,xe,g,y,Ze]),te=f.useCallback(K=>{if(!_&&!V){L?L(K):N&&N({type:"SELECT_SCENARIO",scenario:K}),E&&E(()=>{c(K)},{type:"SELECT_SCENARIO",scenario:K});return}c(K)},[_,V,L,N,E,c]),fe=f.useCallback(K=>{const Q=K[g];if(!Q)return null;if(u)return u(K,ft);if(y&&y[Q]){const ce=y[Q];return s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:ce.bgColor,color:ce.color},children:[ce.icon&&s.jsx(ce.icon,{style:{width:"12px",height:"12px"}}),ce.label]})}return s.jsx(NR,{category:Q,getCategoryConfig:ft})},[g,u,y,ft]);return U?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(ge,{style:{width:"48px",height:"48px",color:Ge,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{color:R.slate[600],fontSize:"16px"},children:F}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}):q?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(Te,{style:{width:"48px",height:"48px",color:"#ef4444"}}),s.jsx("p",{style:{color:"#ef4444",fontSize:"16px",textAlign:"center"},children:q}),s.jsx("button",{onClick:Qe,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:Ge,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer"},children:B})]}):s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:Ct,display:"flex",alignItems:"center",justifyContent:"center"},children:n&&s.jsx(n,{style:{width:"24px",height:"24px",color:qt}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:R.slate[900],margin:0},children:t}),s.jsx("p",{style:{fontSize:"14px",color:R.slate[600],margin:0},children:e})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[b,l&&_&&a&&s.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${Ge}`,backgroundColor:"white",color:Ge,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(Wc,{size:18}),o]})]})]}),s.jsx("div",{style:{marginTop:"24px"},children:s.jsx(_R,{searchQuery:xe,onSearchChange:Ke,searchPlaceholder:S,categories:Z.map(K=>({key:K.key,label:K.label,shortLabel:K.shortLabel||K.label,color:K.color,bgColor:K.bgColor,icon:K.IconComponent||K.icon})),selectedCategory:de,onCategoryChange:ue,showCategories:Z.length>0,showDifficulty:!1,viewMode:$,onViewModeChange:Se,customActions:j})})]}),re.length>0?s.jsx(m0,{minCardWidth:"340px",viewMode:$,children:re.map(K=>{const Q=p?p(K):null,ce=d?d(K):[],Ee=x?x(K):null;return s.jsx(f0,{title:K.title,description:K.description,icon:Q,categoryBadge:fe(K),meta:ce,action:m?{label:h,icon:m}:{label:h},onClick:()=>te(K),viewMode:$,customActions:Ee},K.id)})}):s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",backgroundColor:"white",borderRadius:"16px",border:"1px solid #e2e8f0"},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:v?s.jsx(v,{style:{width:"48px",height:"48px",color:"#cbd5e1"}}):s.jsx(ko,{style:{width:"48px",height:"48px",color:"#cbd5e1"}})}),s.jsx("h3",{style:{color:"#64748b",margin:"0 0 8px 0",fontWeight:500},children:w}),s.jsx("p",{style:{color:"#94a3b8",margin:0,fontSize:"14px"},children:de?"In der ausgewhlten Kategorie sind keine Szenarien verfgbar.":k}),de&&et.length>0&&s.jsx("button",{onClick:()=>ue(null),style:{marginTop:"16px",padding:"10px 20px",borderRadius:"20px",border:`2px solid ${Ge}`,backgroundColor:"white",color:Ge,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"Alle Szenarien anzeigen"})]}),C&&C(),T]})},AR=t=>{const e=[];return t.variables_schema&&t.variables_schema.length>0&&e.push({icon:$e,text:`${t.variables_schema.length} Variablen`}),e.push({icon:qe,text:"~10 Min"}),e},MR=()=>Mn,PR=({onSelectScenario:t,onBack:e,onOpenHistory:n,isAuthenticated:i,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,onNavigateToHistory:c})=>s.jsx(sl,{title:"Live-Simulationen",subtitle:"Live Simulationen mit KI-Interviewer",headerIcon:Le,fetchScenarios:d0,moduleKey:"roleplay",historyButtonLabel:"Meine Live-Simulationen",onNavigateToHistory:c,onSelectScenario:t,renderCardMeta:AR,getIconForScenario:MR,cardActionLabel:"Starten",cardActionIcon:Bt,categoryField:"category",emptyStateIcon:It,emptyStateTitle:"Keine Szenarien gefunden.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:i,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,loadingMessage:"Szenarien werden geladen..."}),Cu=({selectedDeviceId:t,onDeviceChange:e,onTestClick:n,disabled:i=!1})=>{const[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,p]=f.useState(!1),h=f.useRef(0),m=f.useRef(!1),x=it(),g=async(k=!1)=>{if(!m.current&&!(k&&Date.now()-h.current<2e3)){m.current=!0,h.current=Date.now(),l(!0),d(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(C=>C.stop());const b=await navigator.mediaDevices.enumerateDevices();console.log("[MicrophoneSelector] All detected devices:",b.map(C=>({kind:C.kind,label:C.label||"(no label)",deviceId:C.deviceId?.substring(0,8)+"..."})));const j=b.filter(C=>C.kind==="audioinput");if(console.log("[MicrophoneSelector] Audio input devices:",j.length,j.map(C=>C.label||C.deviceId?.substring(0,8))),j.length===0)console.warn("[MicrophoneSelector] No audioinput devices found. All device kinds:",[...new Set(b.map(C=>C.kind))]),d("Kein Mikrofon gefunden"),o([]);else if(o(j),!t&&j.length>0){const C=j.find(T=>T.deviceId==="default")||j[0];e?.(C.deviceId)}}catch(S){console.error("Error loading microphone devices:",S),S.name==="NotAllowedError"||S.name==="PermissionDeniedError"?d("Mikrofonzugriff verweigert"):S.name==="NotFoundError"?d("Kein Mikrofon gefunden"):d("Fehler beim Laden der Mikrofone"),o([])}finally{l(!1),m.current=!1,h.current=Date.now()}}};f.useEffect(()=>{g(!1);let k=null;const S=()=>{k&&clearTimeout(k),k=setTimeout(()=>{g(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",S),()=>{k&&clearTimeout(k),navigator.mediaDevices?.removeEventListener("devicechange",S)}},[]);const y=k=>{if(k.label){let S=k.label;return S=S.replace(/^Default - /,""),S=S.replace(/^Kommunikation - /,""),S=S.replace(/^Standard - /,""),S.length>35&&(S=S.substring(0,32)+"..."),S}return`Mikrofon ${r.indexOf(k)+1}`},v=k=>{e?.(k),p(!1)},w=r.find(k=>k.deviceId===t);return s.jsxs("div",{className:"microphone-selector",style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:x.space[3]},children:[s.jsxs("button",{type:"button",onClick:()=>!i&&!a&&p(!u),disabled:i||a,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:x.space[3],padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${c?R.red[500]:R.slate[200]}`,backgroundColor:c?R.red[50]:R.white,cursor:i||a?"not-allowed":"pointer",opacity:i||a?.6:1,transition:x.transition.normal},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:x.space[3]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:x.radius.md,display:"flex",alignItems:"center",justifyContent:"center",background:c?R.red[100]:x.headerGradient},children:c?s.jsx(Te,{style:{width:"22px",height:"22px",color:R.red[500]}}):s.jsx(We,{style:{width:"22px",height:"22px",color:x.headerText}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:x.fontSize.xs,color:R.slate[500],fontWeight:500,marginBottom:"2px"},children:"Mikrofon"}),s.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:600,color:c?R.red[600]:R.slate[800]},children:a?"Lade...":c||(w?y(w):"Bitte whlen")})]})]}),s.jsx(wt,{style:{width:"20px",height:"20px",color:R.slate[400],transform:u?"rotate(180deg)":"rotate(0)",transition:x.transition.normal}})]}),n&&!c&&s.jsxs("button",{type:"button",onClick:n,disabled:i||a||!t,style:{flex:"0 0 auto",display:"flex",alignItems:"center",gap:x.space[2],padding:`${x.space[3]} ${x.space[5]}`,borderRadius:x.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,cursor:i||a||!t?"not-allowed":"pointer",opacity:i||a||!t?.5:1,transition:x.transition.normal,whiteSpace:"nowrap"},children:[s.jsx(We,{style:{width:"18px",height:"18px",color:x.primaryAccent}}),s.jsx("span",{style:{fontSize:x.fontSize.base,fontWeight:600,color:R.slate[700]},children:"Testen"})]}),s.jsx("button",{type:"button",onClick:()=>g(!1),disabled:a,title:"Gerteliste aktualisieren",style:{display:"flex",alignItems:"center",justifyContent:"center",padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,cursor:a?"not-allowed":"pointer",opacity:a?.5:1,transition:x.transition.normal},children:s.jsx(Zt,{style:{width:"20px",height:"20px",color:R.slate[600],animation:a?"spin 1s linear infinite":"none"}})})]}),u&&r.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>p(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:R.white,borderRadius:x.radius.lg,boxShadow:x.shadow.lg,border:`1px solid ${R.slate[200]}`,zIndex:x.zIndex.overlay,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:r.map((k,S)=>s.jsxs("button",{type:"button",onClick:()=>v(k.deviceId),style:{width:"100%",padding:`${x.space[3.5]} ${x.space[4]}`,textAlign:"left",display:"flex",alignItems:"center",gap:x.space[3],border:"none",backgroundColor:t===k.deviceId?x.primaryAccentLight:"transparent",cursor:"pointer",transition:x.transition.fast},onMouseEnter:b=>{t!==k.deviceId&&(b.currentTarget.style.backgroundColor=R.slate[50])},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=t===k.deviceId?x.primaryAccentLight:"transparent"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:x.radius.sm,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t===k.deviceId?x.primaryAccent:R.slate[100]},children:s.jsx(We,{style:{width:"18px",height:"18px",color:t===k.deviceId?R.white:R.slate[500]}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:500,color:t===k.deviceId?x.primaryAccent:R.slate[800],overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y(k)}),k.deviceId==="default"&&s.jsx("div",{style:{fontSize:x.fontSize.xs,color:R.slate[400]},children:"Systemstandard"})]}),t===k.deviceId&&s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:x.radius.full,backgroundColor:x.primaryAccent}})]},k.deviceId||S))})]}),!c&&r.length>0&&r.length<3&&s.jsx("div",{style:{marginTop:x.space[2.5],fontSize:x.fontSize.xs,color:R.slate[500],lineHeight:1.4},children:'Dein Headset wird nicht angezeigt? Klicke auf "Aktualisieren" nach dem Anschlieen oder prfe die Bluetooth-Verbindung (Headset-Modus statt Audio-Modus).'}),c==="Kein Mikrofon gefunden"&&s.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:R.amber[50],border:`1px solid ${R.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:R.amber[800],lineHeight:1.5},children:[s.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" Tipps zur Fehlerbehebung:"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[s.jsxs("li",{children:["Bei ",s.jsx("strong",{children:"Bluetooth-Headsets"}),': Stelle sicher, dass das Headset im "Headset"- oder "Hands-Free"-Modus verbunden ist (nicht nur "Audio")']}),s.jsxs("li",{children:["Bei ",s.jsx("strong",{children:"USB-Headsets"}),": Trenne das Gert kurz und schliee es erneut an"]}),s.jsxs("li",{children:["Prfe die ",s.jsx("strong",{children:"Systemeinstellungen"})," deines Computers, ob das Mikrofon dort erkannt wird"]}),s.jsxs("li",{children:["Versuche einen anderen ",s.jsx("strong",{children:"Browser"})," (Chrome/Edge empfohlen)"]})]})]}),c==="Mikrofonzugriff verweigert"&&s.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:R.amber[50],border:`1px solid ${R.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:R.amber[800],lineHeight:1.5},children:[s.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" So erlaubst du den Mikrofonzugriff:"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[s.jsxs("li",{children:["Klicke auf das ",s.jsx("strong",{children:"Schloss-Symbol"})," in der Adressleiste deines Browsers"]}),s.jsxs("li",{children:['Setze "Mikrofon" auf ',s.jsx("strong",{children:'"Zulassen"'})]}),s.jsx("li",{children:"Lade die Seite neu und versuche es erneut"})]})]}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},or=({audioLevel:t=0,isActive:e=!1,variant:n="spectrum",size:i="md",className:r,accentColor:o})=>{const a=t>1?t/100:t,l=f.useMemo(()=>({sm:{height:48,barCount:40,barWidth:3,gap:2},md:{height:64,barCount:50,barWidth:4,gap:2},lg:{height:80,barCount:60,barWidth:5,gap:3}}),[]),c=l[i]||l.md;switch(n){case"waveform":return s.jsx(OR,{level:a,isActive:e,config:c,className:r,accentColor:o});case"bars":return s.jsx(LR,{level:a,isActive:e,config:c,className:r,accentColor:o});case"pulse":return s.jsx(zR,{level:a,isActive:e,size:i,className:r,accentColor:o});case"minimal":return s.jsx(BR,{level:a,isActive:e,className:r,accentColor:o});case"spectrum":default:return s.jsx(DR,{level:a,isActive:e,config:c,className:r,accentColor:o})}},DR=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const[o,a]=f.useState([]),l=f.useRef(null),c=f.useRef(0),d=r||"#3b82f6",u=r?`${r}60`:"rgba(59, 130, 246, 0.4)";return f.useEffect(()=>{const p=n.barCount,h=()=>{const m=Date.now();if(m-c.current<50){l.current=requestAnimationFrame(h);return}c.current=m;const x=Array.from({length:p},(g,y)=>{if(!e)return 8+Math.random()*12;const v=Math.pow(t,.5),w=15+v*60,k=Math.sin(y/p*Math.PI*2+m*.003)*.3+.7,S=(Math.random()-.5)*v*40,b=Math.sin(y/p*Math.PI*3+m*.005)*v*15,j=w*k+S+b;return Math.min(95,Math.max(8,j))});a(x),l.current=requestAnimationFrame(h)};return h(),()=>{l.current&&cancelAnimationFrame(l.current)}},[e,t,n.barCount]),s.jsxs("div",{className:pe("relative w-full flex items-end justify-center",i),style:{height:n.height},children:[e&&t>.1&&s.jsx("div",{className:"absolute inset-0 rounded-lg opacity-30",style:{background:`radial-gradient(ellipse at center, ${u} 0%, transparent 70%)`}}),s.jsx("div",{className:"flex items-end justify-center h-full",style:{gap:n.gap},children:o.map((p,h)=>s.jsx("div",{className:"rounded-full transition-all",style:{width:n.barWidth,height:`${p}%`,background:e?`linear-gradient(to top, ${d}, ${hs(d,40)})`:`linear-gradient(to top, ${hs(d,-30)}, ${hs(d,10)})`,opacity:e?.85+t*.15:.4,boxShadow:e&&t>.2?`0 0 ${4+t*8}px ${u}`:"none",transition:"height 0.08s ease-out, opacity 0.15s ease-out"}},h))})]})},OR=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const o=f.useRef(null),a=f.useRef(null),l=f.useRef(0),c=r||"#3b82f6";return f.useEffect(()=>{const d=o.current;if(!d)return;const u=d.getContext("2d"),p=d.width,h=d.height,m=()=>{u.clearRect(0,0,p,h);const x=e?.3+t*.5:.15,g=e?2+t:1.5;l.current+=e?.08+t*.04:.02;const y=u.createLinearGradient(0,0,p,0);y.addColorStop(0,hs(c,-20)+"80"),y.addColorStop(.5,c),y.addColorStop(1,hs(c,-20)+"80"),u.beginPath(),u.moveTo(0,h/2);for(let v=0;v<=p;v++){const w=v/p,k=Math.sin(w*Math.PI*g+l.current)*x,S=Math.sin(w*Math.PI*g*1.5+l.current*1.3)*x*.5,b=Math.sin(w*Math.PI*g*2.5+l.current*.7)*x*.25,j=Math.sin(w*Math.PI),C=h/2+(k+S+b)*h*j;u.lineTo(v,C)}u.strokeStyle=y,u.lineWidth=3,u.lineCap="round",u.stroke(),u.globalAlpha=.3,u.beginPath(),u.moveTo(0,h/2);for(let v=0;v<=p;v++){const w=v/p,k=Math.sin(w*Math.PI*g+l.current+.5)*x*.6,S=Math.sin(w*Math.PI),b=h/2+k*h*S;u.lineTo(v,b)}u.strokeStyle=y,u.lineWidth=2,u.stroke(),u.globalAlpha=1,a.current=requestAnimationFrame(m)};return m(),()=>{a.current&&cancelAnimationFrame(a.current)}},[e,t,c]),s.jsx("div",{className:pe("relative w-full",i),style:{height:n.height},children:s.jsx("canvas",{ref:o,width:500,height:n.height,className:"w-full h-full",style:{filter:e&&t>.2?`drop-shadow(0 0 8px ${c}60)`:"none"}})})},LR=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const o=n.barCount,a=r||"#3b82f6",c=(()=>{if(!e)return Array.from({length:o},()=>8+Math.random()*10);const d=Math.pow(t,.6);return Array.from({length:o},(u,p)=>{const h=20+d*55,m=Math.random()*d*30,x=Math.sin(p/o*Math.PI*4+Date.now()*.005)*d*10;return Math.min(95,Math.max(10,h+m+x))})})();return s.jsx("div",{className:pe("flex items-end justify-center w-full",i),style:{height:n.height,gap:n.gap},children:c.map((d,u)=>s.jsx(P.div,{className:"rounded-sm",style:{width:n.barWidth,background:`linear-gradient(to top, ${a}, ${hs(a,50)})`,boxShadow:e&&t>.15?`0 0 ${4+t*10}px ${a}50`:"none"},animate:{height:`${d}%`,opacity:e?.8+t*.2:.35},transition:{duration:.08,ease:"easeOut"}},u))})},zR=({level:t,isActive:e,size:n,className:i,accentColor:r})=>{const o={sm:{container:"w-16 h-16",icon:"w-6 h-6",ring:"w-20 h-20"},md:{container:"w-20 h-20",icon:"w-8 h-8",ring:"w-28 h-28"},lg:{container:"w-24 h-24",icon:"w-10 h-10",ring:"w-36 h-36"}},a=o[n]||o.md,l=r||"#3b82f6";return s.jsxs("div",{className:pe("relative flex items-center justify-center",i),children:[e&&s.jsxs(s.Fragment,{children:[s.jsx(P.div,{className:pe("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.3+t*.4],opacity:[.4,0]},transition:{duration:1,repeat:1/0,ease:"easeOut"}}),s.jsx(P.div,{className:pe("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.2+t*.3],opacity:[.3,0]},transition:{duration:1,repeat:1/0,ease:"easeOut",delay:.3}})]}),s.jsx(P.div,{className:pe("rounded-full flex items-center justify-center",a.container),style:{background:`linear-gradient(135deg, ${l}, ${hs(l,-20)})`,boxShadow:e?`0 0 ${20+t*30}px ${l}40`:`0 4px 12px ${l}20`},animate:{scale:e?1+t*.15:1},transition:{duration:.1},children:s.jsx(We,{className:pe(a.icon,"text-white")})})]})},BR=({level:t,isActive:e,className:n,accentColor:i})=>{const r=i||"#3b82f6",o=()=>e?t>.7?"rgb(34, 197, 94)":t>.3?r:"rgb(148, 163, 184)":"rgb(148, 163, 184)";return s.jsx("div",{className:pe("h-3 bg-slate-200 rounded-full overflow-hidden",n),children:s.jsx(P.div,{className:"h-full rounded-full",style:{backgroundColor:o()},animate:{width:`${Math.max(5,t*100)}%`},transition:{duration:.1,ease:"easeOut"}})})};function hs(t,e){const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n){const i=Math.min(255,Math.max(0,parseInt(n[1])+e)),r=Math.min(255,Math.max(0,parseInt(n[2])+e)),o=Math.min(255,Math.max(0,parseInt(n[3])+e));return`rgb(${i}, ${r}, ${o})`}if(t.startsWith("#")){const i=t.slice(1);let r;i.length===3?r=parseInt(i[0]+i[0]+i[1]+i[1]+i[2]+i[2],16):r=parseInt(i,16);const o=Math.min(255,Math.max(0,(r>>16&255)+e)),a=Math.min(255,Math.max(0,(r>>8&255)+e)),l=Math.min(255,Math.max(0,(r&255)+e));return`rgb(${o}, ${a}, ${l})`}return t}const ju=({isOpen:t,onClose:e,deviceId:n})=>{const[i,r]=f.useState("idle"),[o,a]=f.useState(0),[l,c]=f.useState(null),[d,u]=f.useState(0),[p,h]=f.useState(null),m=it(),x=f.useRef(null),g=f.useRef([]),y=f.useRef(null),v=f.useRef(null),w=f.useRef(null),k=f.useRef(null),S=f.useRef(null),b=f.useRef(null),j=10;f.useEffect(()=>()=>T(),[]),f.useEffect(()=>{t?C():T()},[t]);const C=()=>{r("idle"),a(0),u(0),h(null),l&&(URL.revokeObjectURL(l),c(null))},T=()=>{if(S.current&&(clearInterval(S.current),S.current=null),k.current&&(cancelAnimationFrame(k.current),k.current=null),x.current&&x.current.state!=="inactive")try{x.current.stop()}catch{}if(v.current){try{v.current.close()}catch{}v.current=null}y.current&&(y.current.getTracks().forEach(D=>D.stop()),y.current=null),b.current&&(b.current.pause(),b.current.src="")},_=async()=>{try{h(null),g.current=[],u(0);const D={audio:n?{deviceId:{exact:n}}:!0},A=await navigator.mediaDevices.getUserMedia(D);y.current=A,v.current=new(window.AudioContext||window.webkitAudioContext),w.current=v.current.createAnalyser(),v.current.createMediaStreamSource(A).connect(w.current),w.current.fftSize=256;const B=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";x.current=new MediaRecorder(A,{mimeType:B}),x.current.ondataavailable=z=>{z.data.size>0&&g.current.push(z.data)},x.current.onstop=()=>{const z=new Blob(g.current,{type:B}),U=URL.createObjectURL(z);c(U),r("recorded"),a(0)},x.current.start(100),r("recording");const M=()=>{if(w.current){const z=new Uint8Array(w.current.frequencyBinCount);w.current.getByteFrequencyData(z);const U=z.reduce((W,q)=>W+q,0)/z.length;a(U/255)}k.current=requestAnimationFrame(M)};M(),S.current=setInterval(()=>{u(z=>z>=j-1?(E(),j):z+1)},1e3)}catch(D){console.error("Error starting recording:",D),D.name==="NotAllowedError"?h("Mikrofonzugriff verweigert"):D.name==="NotFoundError"?h("Kein Mikrofon gefunden"):h("Fehler beim Starten der Aufnahme")}},E=()=>{S.current&&(clearInterval(S.current),S.current=null),k.current&&(cancelAnimationFrame(k.current),k.current=null),v.current&&(v.current.close(),v.current=null),x.current&&x.current.state!=="inactive"&&x.current.stop(),y.current&&(y.current.getTracks().forEach(D=>D.stop()),y.current=null)},N=()=>{l&&(b.current&&b.current.pause(),b.current=new Audio(l),b.current.onended=()=>r("recorded"),b.current.play(),r("playing"))},L=()=>{b.current&&(b.current.pause(),b.current.currentTime=0),r("recorded")},V=()=>{l&&URL.revokeObjectURL(l),c(null),u(0),r("idle")};return t?s.jsx(He,{children:s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:m.space[5]},children:s.jsxs(P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:D=>D.stopPropagation(),style:{backgroundColor:R.white,borderRadius:m.radius["2xl"],width:"100%",maxWidth:"400px",boxShadow:m.shadow.xl,overflow:"hidden"},children:[s.jsxs("div",{style:{padding:`${m.space[5]} ${m.space[6]}`,borderBottom:`1px solid ${R.slate[200]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:m.space[3]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:m.radius.md,background:m.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{style:{width:"20px",height:"20px",color:R.white}})}),s.jsxs("div",{children:[s.jsx("h2",{style:{fontSize:m.fontSize.xl,fontWeight:600,color:R.slate[900],margin:0},children:"Mikrofon testen"}),s.jsx("p",{style:{fontSize:m.fontSize.sm,color:R.slate[500],margin:0},children:"Prfe deine Audioqualitt"})]})]}),s.jsx("button",{onClick:e,style:{width:"44px",height:"44px",borderRadius:m.radius.lg,border:"none",backgroundColor:R.slate[100],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:m.transition.normal},onMouseEnter:D=>D.currentTarget.style.backgroundColor=R.slate[200],onMouseLeave:D=>D.currentTarget.style.backgroundColor=R.slate[100],children:s.jsx(rn,{style:{width:"24px",height:"24px",color:R.slate[600]}})})]}),s.jsxs("div",{style:{padding:`${m.space[8]} ${m.space[6]}`},children:[p&&s.jsxs("div",{style:{marginBottom:m.space[6],padding:m.space[4],backgroundColor:R.red[50],border:`1px solid ${R.red[100]}`,borderRadius:m.radius.lg,display:"flex",alignItems:"center",gap:m.space[3]},children:[s.jsx(Te,{style:{width:"20px",height:"20px",color:R.red[500]}}),s.jsx("p",{style:{fontSize:m.fontSize.base,color:R.red[600],margin:0},children:p})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:m.space[6]},children:s.jsxs("div",{style:{position:"relative"},children:[s.jsxs(P.div,{style:{width:"120px",height:"120px",borderRadius:"50%",backgroundColor:i==="recording"?R.red[50]:i==="playing"?R.green[50]:i==="recorded"?R.green[50]:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center"},children:[i==="recording"&&s.jsx(P.div,{style:{position:"absolute",inset:0,borderRadius:"50%",border:`3px solid ${R.red[500]}`},animate:{scale:[1,1+o*.3],opacity:[1,.3]},transition:{duration:.3,repeat:1/0}}),i==="idle"&&s.jsx(We,{style:{width:"48px",height:"48px",color:R.slate[400]}}),i==="recording"&&s.jsx(We,{style:{width:"48px",height:"48px",color:R.red[500]}}),i==="recorded"&&s.jsx(Jt,{style:{width:"48px",height:"48px",color:R.green[500]}}),i==="playing"&&s.jsx(Gn,{style:{width:"48px",height:"48px",color:R.green[600]}})]}),i==="recording"&&s.jsxs("div",{style:{position:"absolute",bottom:"-8px",left:"50%",transform:"translateX(-50%)",padding:`${m.space[1]} ${m.space[3]}`,backgroundColor:R.red[500],color:R.white,borderRadius:m.radius["2xl"],fontSize:m.fontSize.sm,fontWeight:600,fontFamily:"monospace"},children:[d,"s / ",j,"s"]})]})}),i==="recording"&&s.jsx("div",{style:{marginBottom:m.space[6]},children:s.jsx(or,{audioLevel:o,isActive:!0,variant:"bars",size:"sm"})}),s.jsxs("p",{style:{textAlign:"center",fontSize:m.fontSize.md,color:R.slate[600],marginBottom:m.space[6]},children:[i==="idle"&&'Klicke auf "Aufnahme starten" um dein Mikrofon zu testen.',i==="recording"&&"Sprich jetzt in dein Mikrofon...",i==="recorded"&&"Aufnahme fertig! Hre dir das Ergebnis an.",i==="playing"&&"Wiedergabe luft..."]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:m.space[3]},children:[i==="idle"&&s.jsxs("button",{onClick:_,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(We,{style:{width:"18px",height:"18px"}}),"Aufnahme starten"]}),i==="recording"&&s.jsxs("button",{onClick:E,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",backgroundColor:R.red[500],color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(fs,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),i==="recorded"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(Ht,{style:{width:"18px",height:"18px"}}),"Anhren"]}),s.jsxs("button",{onClick:V,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(Zt,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]}),i==="playing"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(fs,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),s.jsxs("button",{onClick:V,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(Zt,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]})]})]})]})})}):null},FR=({type:t,devices:e,selectedDeviceId:n,onDeviceChange:i,isLoading:r,error:o,onRefresh:a,branding:l})=>{const[c,d]=f.useState(!1),u=t==="video"?Px:We,p=t==="video"?"Kamera":"Mikrofon",h=g=>{if(g.label){let y=g.label;return y=y.replace(/^Default - /,""),y=y.replace(/^Kommunikation - /,""),y=y.replace(/^Standard - /,""),y.length>40&&(y=y.substring(0,37)+"..."),y}return`${p} ${e.indexOf(g)+1}`},m=e.find(g=>g.deviceId===n),x=g=>{i?.(g),d(!1)};return s.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:s.jsxs("button",{type:"button",onClick:()=>!r&&d(!c),disabled:r,style:{flex:"1 1 100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"14px 18px",borderRadius:"14px",border:`2px solid ${o?l.error:l.borderColor}`,backgroundColor:o?l.errorLight:l.cardBgColor,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:o?l.errorLight:l.headerGradient},children:o?s.jsx(Te,{style:{width:"24px",height:"24px",color:l.error}}):s.jsx(u,{style:{width:"24px",height:"24px",color:l.white}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"13px",color:l.textMuted,fontWeight:500,marginBottom:"2px"},children:p}),s.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:o?l.errorDark:l.textMain},children:r?"Lade...":o||(m?h(m):"Bitte whlen")})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o&&a&&s.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),a()},style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l.cardBgHover,cursor:"pointer"},children:s.jsx(Zt,{style:{width:"18px",height:"18px",color:l.textSecondary}})}),s.jsx(wt,{style:{width:"22px",height:"22px",color:l.textMuted,transform:c?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]})]})}),c&&e.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>d(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:l.cardBgColor,borderRadius:"14px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:`1px solid ${l.borderColor}`,zIndex:50,overflow:"hidden",maxHeight:"300px",overflowY:"auto"},children:e.map((g,y)=>s.jsxs("button",{type:"button",onClick:()=>x(g.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:n===g.deviceId?l.primaryAccentLight:l.transparent,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:v=>{n!==g.deviceId&&(v.currentTarget.style.backgroundColor=l.cardBgHover)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=n===g.deviceId?l.primaryAccentLight:l.transparent},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:n===g.deviceId?l.primaryAccent:l.cardBgHover},children:s.jsx(u,{style:{width:"20px",height:"20px",color:n===g.deviceId?l.white:l.textMuted}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:n===g.deviceId?l.primaryAccent:l.textMain,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:h(g)}),g.deviceId==="default"&&s.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:"Systemstandard"})]}),n===g.deviceId&&s.jsx(Jt,{style:{width:"20px",height:"20px",color:l.primaryAccent}})]},g.deviceId||y))})]})]})},UR=({deviceId:t,branding:e})=>{const[n,i]=f.useState(!1),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(null),[u,p]=f.useState(0),h=f.useRef(null),m=f.useRef(null),x=f.useRef(null),g=f.useRef(null),y=f.useRef(null),v=f.useRef([]),w=f.useRef(null),k=f.useRef(null),S=async()=>{try{d(null),p(0),v.current=[];const _=await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:{exact:t}}:!0});h.current=_;const E=new(window.AudioContext||window.webkitAudioContext);g.current=E;const N=E.createMediaStreamSource(_),L=E.createAnalyser();L.fftSize=256,N.connect(L),m.current=L;const V=new MediaRecorder(_,{mimeType:"audio/webm"});y.current=V,V.ondataavailable=B=>{B.data.size>0&&v.current.push(B.data)},V.onstop=()=>{const B=new Blob(v.current,{type:"audio/webm"});d(B)},V.start(),i(!0);const D=Date.now();k.current=setInterval(()=>{p(Math.floor((Date.now()-D)/1e3))},100);const A=new Uint8Array(L.frequencyBinCount),F=()=>{L.getByteFrequencyData(A);const B=A.reduce((M,z)=>M+z,0)/A.length;l(Math.min(100,B/128*100)),x.current=requestAnimationFrame(F)};F()}catch(_){console.error("Error starting recording:",_)}},b=()=>{k.current&&(clearInterval(k.current),k.current=null),x.current&&(cancelAnimationFrame(x.current),x.current=null),y.current&&y.current.state!=="inactive"&&y.current.stop(),h.current&&(h.current.getTracks().forEach(_=>_.stop()),h.current=null),g.current&&(g.current.close(),g.current=null),i(!1),l(0)},j=()=>{if(!c)return;const _=URL.createObjectURL(c),E=new Audio(_);w.current=E,E.onplay=()=>o(!0),E.onended=()=>{o(!1),URL.revokeObjectURL(_)},E.onerror=()=>{o(!1),URL.revokeObjectURL(_)},E.play()},C=()=>{w.current&&(w.current.pause(),w.current.currentTime=0,w.current=null),o(!1)},T=()=>{C(),d(null),p(0)};return f.useEffect(()=>()=>{b(),C()},[]),f.useEffect(()=>{n&&b(),T()},[t]),s.jsxs("div",{style:{padding:"16px",backgroundColor:e.cardBgHover,borderRadius:"12px",marginTop:"8px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsx("button",{type:"button",onClick:n?b:S,disabled:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"none",backgroundColor:n?e.error:e.primaryAccent,color:e.white,fontSize:"14px",fontWeight:600,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:n?s.jsxs(s.Fragment,{children:[s.jsx(fs,{style:{width:"16px",height:"16px"}}),"Stoppen (",lt(u),")"]}):s.jsxs(s.Fragment,{children:[s.jsx(We,{style:{width:"16px",height:"16px"}}),"Aufnehmen"]})}),c&&!n&&s.jsx("button",{type:"button",onClick:r?C:j,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:`2px solid ${e.primaryAccent}`,backgroundColor:r?e.primaryAccentLight:e.cardBgColor,color:e.primaryAccent,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:r?s.jsxs(s.Fragment,{children:[s.jsx(fs,{style:{width:"16px",height:"16px"}}),"Stoppen"]}):s.jsxs(s.Fragment,{children:[s.jsx(Ht,{style:{width:"16px",height:"16px"}}),"Abspielen"]})}),n&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.error,fontSize:"13px"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:e.error,animation:"pulse 1s infinite"}}),"Aufnahme luft..."]}),r&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.successDark,fontSize:"13px"},children:[s.jsx(Gn,{style:{width:"16px",height:"16px"}}),"Wiedergabe..."]}),c&&!n&&!r&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.textMuted,fontSize:"13px"},children:[s.jsx(Jt,{style:{width:"16px",height:"16px",color:e.success}}),"Aufnahme bereit (",lt(u),")"]})]}),n&&s.jsx(or,{audioLevel:a/100,isActive:!0,variant:"bars",size:"sm"}),!n&&!c&&s.jsxs("p",{style:{margin:0,fontSize:"13px",color:e.textMuted,display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Gn,{style:{width:"14px",height:"14px"}}),"Nimm etwas auf und spiele es ab, um dein Mikrofon zu testen."]}),s.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})},WR=({deviceId:t,branding:e})=>{const n=f.useRef(null),i=f.useRef(null),[r,o]=f.useState(null);return f.useEffect(()=>(t&&(async()=>{try{i.current&&i.current.getTracks().forEach(c=>c.stop());const l=await navigator.mediaDevices.getUserMedia({video:t?{deviceId:{exact:t}}:!0});i.current=l,n.current&&(n.current.srcObject=l),o(null)}catch(l){console.error("Error starting camera preview:",l),o("Kamera-Vorschau nicht verfgbar")}})(),()=>{i.current&&i.current.getTracks().forEach(l=>l.stop())}),[t]),r?s.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.cardBgHover,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:e.textMuted,fontSize:"14px"},children:r}):s.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.textMain,borderRadius:"12px",overflow:"hidden"},children:s.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}})})},oy=({mode:t="audio",scenario:e,onBack:n,onStart:i,title:r,startButtonLabel:o="Training starten",icon:a,extraContent:l=null,disabled:c=!1})=>{const[d,u]=f.useState([]),[p,h]=f.useState([]),[m,x]=f.useState(null),[g,y]=f.useState(null),[v,w]=f.useState(!0),[k,S]=f.useState(null),[b,j]=f.useState(null),[C,T]=f.useState(!1),_=f.useRef(0),E=f.useRef(!1),N=f.useRef(null),L=f.useRef(null),V=it(),D=t==="audio-video";N.current=m,L.current=g;const A=f.useCallback(async(M=!1)=>{if(!E.current&&!(M&&Date.now()-_.current<2e3)){E.current=!0,_.current=Date.now(),w(!0),S(null),D&&j(null);try{const z={audio:!0};D&&(z.video=!0),(await navigator.mediaDevices.getUserMedia(z)).getTracks().forEach(de=>de.stop());const W=await navigator.mediaDevices.enumerateDevices();console.log("[DeviceSetupPage] All detected devices:",W.map(de=>({kind:de.kind,label:de.label||"(no label)",deviceId:de.deviceId?.substring(0,8)+"..."})));const q=W.filter(de=>de.kind==="audioinput"),le=W.filter(de=>de.kind==="videoinput");if(console.log("[DeviceSetupPage] Audio inputs:",q.length,"Video inputs:",le.length),q.length===0)console.warn("[DeviceSetupPage] No audioinput devices found"),S("Kein Mikrofon gefunden"),u([]);else if(u(q),!N.current){const de=q.find(ue=>ue.deviceId==="default")||q[0];x(de.deviceId)}if(D){if(le.length===0)j("Keine Kamera gefunden"),h([]);else if(h(le),!L.current){const de=le.find(ue=>ue.deviceId==="default")||le[0];y(de.deviceId)}}}catch(z){console.error("Error loading devices:",z),z.name==="NotAllowedError"||z.name==="PermissionDeniedError"?(S("Zugriff verweigert"),D&&j("Zugriff verweigert")):z.name==="NotFoundError"?(S("Kein Mikrofon gefunden"),D&&j("Keine Kamera gefunden")):(S("Fehler beim Laden"),D&&j("Fehler beim Laden"))}finally{w(!1),E.current=!1,_.current=Date.now()}}},[D]);f.useEffect(()=>{A(!1);let M=null;const z=()=>{M&&clearTimeout(M),M=setTimeout(()=>{A(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",z),()=>{M&&clearTimeout(M),navigator.mediaDevices?.removeEventListener("devicechange",z)}},[]);const F=()=>{i({selectedMicrophoneId:m,selectedCameraId:D?g:null})},B=m&&!k&&(!D||g&&!b)&&!c;return s.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:V.transparent,color:V.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:M=>M.target.style.background=V.cardBgHover,onMouseLeave:M=>M.target.style.background=V.transparent,children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:V.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:a?s.jsx(a,{style:{width:"28px",height:"28px",color:V.headerText}}):s.jsx(We,{style:{width:"28px",height:"28px",color:V.headerText}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:V.textMain,margin:0},children:r||e?.title||"Gerte einrichten"}),s.jsx("p",{style:{fontSize:"14px",color:V.textSecondary,margin:"4px 0 0 0"},children:D?"Kamera und Mikrofon auswhlen":"Mikrofon auswhlen und testen"})]})]})]}),v&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 24px",backgroundColor:V.cardBgHover,borderRadius:"16px"},children:[s.jsx(ge,{style:{width:"32px",height:"32px",color:V.primaryAccent,marginBottom:"16px"},className:"animate-spin"}),s.jsx("p",{style:{color:V.textSecondary,margin:0},children:"Gerte werden geladen..."})]}),!v&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[D&&s.jsxs("div",{style:{padding:"24px",backgroundColor:V.cardBgColor,borderRadius:"16px",border:`1px solid ${V.borderColor}`,marginBottom:"20px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Px,{style:{width:"22px",height:"22px",color:V.primaryAccent}}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:V.textMain,margin:0},children:"Kamera auswhlen"})]}),s.jsx(FR,{type:"video",devices:p,selectedDeviceId:g,onDeviceChange:y,isLoading:v,error:b,onRefresh:A,branding:V}),g&&!b&&s.jsx(WR,{deviceId:g,branding:V})]}),s.jsxs("div",{style:{padding:"24px",backgroundColor:V.cardBgColor,borderRadius:"16px",border:`1px solid ${V.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(We,{style:{width:"22px",height:"22px",color:V.primaryAccent}}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:V.textMain,margin:0},children:"Mikrofon testen"})]}),s.jsx(Cu,{selectedDeviceId:m,onDeviceChange:x,onTestClick:()=>T(!0)})]}),l&&s.jsx("div",{style:{marginBottom:"24px"},children:l}),s.jsxs("button",{onClick:F,disabled:!B,style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:B?V.buttonGradient:V.disabledBg,color:V.white,fontSize:"16px",fontWeight:600,cursor:B?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:B?`0 4px 12px ${V.primaryAccent}4d`:"none"},onMouseEnter:M=>{B&&(M.target.style.transform="translateY(-2px)",M.target.style.boxShadow=`0 6px 16px ${V.primaryAccent}66`)},onMouseLeave:M=>{M.target.style.transform="none",M.target.style.boxShadow=B?`0 4px 12px ${V.primaryAccent}4d`:"none"},children:[o,s.jsx(yo,{style:{width:"20px",height:"20px"}})]})]}),s.jsx(ju,{isOpen:C,onClose:()=>T(!1),deviceId:m})]})},VR="wss://karriereheld-ws-proxy.onrender.com/ws";async function $R(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`wss://api.elevenlabs.io/v1/convai/conversation?agent_id=${t}`,i=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Connection timeout - WebSocket may be blocked by firewall"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-i;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"WebSocket connection failed - may be blocked by firewall"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-i}):c({success:!1,error:`Connection closed: ${u.code} ${u.reason||""}`.trim()}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to create WebSocket connection"})}})}async function ay(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`${VR}?agent_id=${t}`,i=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Proxy connection timeout"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-i;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"Proxy connection failed"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-i}):c({success:!1,error:`Proxy connection closed: ${u.code}`}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to connect to proxy"})}})}function GR(){return typeof WebSocket<"u"}async function HR(t){if(!GR())return{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Browser untersttzt keine WebSocket-Verbindungen"};const e=await $R(t,5e3);if(e.success)return{mode:"websocket",directAvailable:!0,proxyAvailable:!1,directLatency:e.latency};const n=await ay(t,5e3);return n.success?{mode:"proxy",directAvailable:!1,proxyAvailable:!0,proxyLatency:n.latency,error:e.error}:{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Alle WebSocket-Verbindungen werden durch Firewall blockiert"}}const qR=({mode:t,isChecking:e,latency:n,proxyLatency:i,error:r,onSwitchMode:o,onRetry:a,directAvailable:l,proxyAvailable:c,b:d})=>e?s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:d.radius.lg},children:[s.jsx(ge,{style:{width:"20px",height:"20px",color:"#3b82f6"},className:"animate-spin"}),s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:"#1d4ed8"},children:"Prfe Verbindung..."})]}):r&&!l&&!c?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[3]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:d.radius.lg},children:[s.jsx(yn,{style:{width:"20px",height:"20px",color:"#dc2626"}}),s.jsx("div",{style:{flex:1},children:s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:"#991b1b"},children:"Keine Verbindung mglich"})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.slate[50],border:`1px solid ${R.slate[200]}`,borderRadius:d.radius.lg},children:[s.jsx(mn,{style:{width:"16px",height:"16px",color:R.slate[500],flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{style:{fontSize:d.fontSize.xs,color:R.slate[600]},children:[s.jsx("p",{style:{margin:0,fontWeight:d.fontWeight.medium,marginBottom:d.space[1]},children:"WebSocket-Verbindungen blockiert"}),s.jsx("p",{style:{margin:0},children:r})]})]}),s.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:d.space[1.5],fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",padding:0},children:[s.jsx(Zt,{style:{width:"12px",height:"12px"}}),"Verbindung erneut prfen"]})]}):t==="websocket"?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:d.radius.lg},children:[s.jsx(hu,{style:{width:"20px",height:"20px",color:"#22c55e"}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:"#15803d"},children:"Direkte Echtzeit-Verbindung"}),n&&s.jsxs("span",{style:{fontSize:d.fontSize.xs,color:"#16a34a",marginLeft:d.space[2]},children:["(",n,"ms)"]})]}),s.jsx($n,{style:{width:"20px",height:"20px",color:"#22c55e"}})]}),s.jsx("button",{onClick:()=>o("proxy"),style:{fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Proxy-Modus testen"})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:d.radius.lg},children:[s.jsx(gu,{style:{width:"20px",height:"20px",color:"#3b82f6"}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:"#1d4ed8"},children:"Proxy-Modus (Echtzeit via Server)"}),i&&s.jsxs("span",{style:{fontSize:d.fontSize.xs,color:"#3b82f6",marginLeft:d.space[2]},children:["(",i,"ms)"]})]}),s.jsx($n,{style:{width:"20px",height:"20px",color:"#3b82f6"}})]}),!l&&s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3]} ${d.space[4]}`,backgroundColor:R.slate[50],border:`1px solid ${R.slate[200]}`,borderRadius:d.radius.lg},children:[s.jsx(mn,{style:{width:"14px",height:"14px",color:R.slate[500],flexShrink:0,marginTop:"2px"}}),s.jsx("div",{style:{fontSize:d.fontSize.xs,color:R.slate[600]},children:s.jsx("p",{style:{margin:0},children:"Direkte Verbindung blockiert. Der Proxy-Server ermglicht Echtzeit-Gesprche trotz Firewall."})})]}),l&&s.jsx("button",{onClick:()=>o("websocket"),style:{fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Direkte Verbindung nutzen"})]}),KR=({scenario:t,onBack:e,onStart:n})=>{const i=it(),[r,o]=f.useState("websocket"),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,p]=f.useState(null),[h,m]=f.useState(null),[x,g]=f.useState(!1),[y,v]=f.useState(!1);f.useEffect(()=>{w()},[t]);const w=async()=>{l(!0),d(null);try{const E=t?.agent_id||me.getElevenLabsAgentId();if(!E){o("websocket"),d("Keine Agent-ID konfiguriert"),g(!1),v(!1),l(!1);return}const N=await HR(E);o(N.mode),g(N.directAvailable),v(N.proxyAvailable),p(N.directLatency||null),m(N.proxyLatency||null),d(N.error||null)}catch(E){console.error("[DeviceSetup] Connection check failed:",E),o("websocket"),d(E.message),g(!1),v(!1)}finally{l(!1)}},k=async E=>{const N=t?.agent_id||me.getElevenLabsAgentId();if(E==="proxy"&&!y&&N){l(!0);const L=await ay(N,5e3);if(l(!1),L.success)v(!0),m(L.latency),o("proxy");else{d("Proxy-Verbindung nicht verfgbar: "+L.error);return}}else o(E)},S=()=>{w()},b=({selectedMicrophoneId:E})=>{n({selectedMicrophoneId:E,connectionMode:r})},j=t?.interviewer_profile?.name;let C;r==="proxy"?C=j?`${j} anrufen (Proxy)`:"Gesprch starten (Proxy)":j?C=`${j} anrufen`:C="Gesprch starten";const T=()=>r==="proxy"?s.jsx(gu,{style:{width:"20px",height:"20px",color:i.primaryAccent}}):s.jsx(hu,{style:{width:"20px",height:"20px",color:i.primaryAccent}}),_=s.jsxs("div",{style:{padding:i.space[5],backgroundColor:"white",borderRadius:i.radius.xl,border:`1px solid ${R.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2.5],marginBottom:i.space[4]},children:[T(),s.jsx("h3",{style:{fontSize:i.fontSize.lg,fontWeight:i.fontWeight.semibold,color:R.slate[900],margin:0},children:"Verbindungsmodus"})]}),s.jsx(qR,{mode:r,isChecking:a,latency:u,proxyLatency:h,error:c,onSwitchMode:k,onRetry:S,directAvailable:x,proxyAvailable:y,b:i})]});return s.jsx(oy,{mode:"audio",scenario:t,onBack:e,onStart:b,title:t?.title,startButtonLabel:C,icon:Le,disabled:a,extraContent:_})},JR=t=>{setTimeout(()=>{const e=t.target;if(e){const n=e.closest("div");n&&n.scrollIntoView({behavior:"smooth",block:"center"})}},300)},YR=({field:t,value:e,onChange:n,error:i,focusColor:r})=>{const o=it(),a=r||"#4a9ec9",l={width:"100%",padding:`${o.space[3]} ${o.space[4]}`,borderRadius:o.radius.lg,border:`2px solid ${i?R.red[500]:R.slate[200]}`,fontSize:o.fontSize.base,color:R.slate[900],backgroundColor:"white",outline:"none",transition:`border-color ${o.transition.normal}, box-shadow ${o.transition.normal}`},c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=h=>{Object.assign(h.target.style,c),JR(h)},u=h=>{h.target.style.borderColor=i?R.red[500]:R.slate[200],h.target.style.boxShadow="none"},p=()=>{switch(t.type){case"textarea":return s.jsx("textarea",{value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.default||t.placeholder||`${t.label} eingeben...`,rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:h=>n(t.key,h.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(h=>s.jsx("option",{value:h.value||h,children:h.label||h},h.value||h))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.default||t.placeholder||`${t.label} eingeben...`,style:l,onFocus:d,onBlur:u});default:return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.default||t.placeholder||`${t.label} eingeben...`,style:l,onFocus:d,onBlur:u})}};return s.jsxs("div",{style:{marginBottom:o.space[5]},children:[s.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:o.space[1]},children:"*"})]}),p(),i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:R.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(Te,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:R.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(mn,{style:{width:"14px",height:"14px"}}),t.hint]})]})},XR=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),l=it(),c=m=>{if(!m)return m;let x=m;return Object.entries(i).forEach(([g,y])=>{const v=new RegExp(`\\{\\{${g}\\}\\}`,"g");x=x.replace(v,y||"")}),x},d=ur.useMemo(()=>t?.variables_schema?t.variables_schema.filter(m=>m.user_input!==!1):[],[t?.variables_schema]);f.useEffect(()=>{if(t?.variables_schema){const m={};t.variables_schema.forEach(x=>{x.default&&(m[x.key]=x.default)}),r(m)}},[t?.variables_schema]);const u=(m,x)=>{r(g=>({...g,[m]:x})),o[m]&&a(g=>{const y={...g};return delete y[m],y})},p=()=>{const m={};return d.forEach(x=>{const g=i[x.key];x.required&&(!g||g.toString().trim()==="")&&(m[x.key]=`${x.label} ist ein Pflichtfeld`)}),a(m),Object.keys(m).length===0},h=m=>{m.preventDefault(),p()&&n(i)};return f.useEffect(()=>{if(d.length===0){const m={};t?.variables_schema?.forEach(x=>{x.default&&(m[x.key]=x.default)}),n(m)}},[d,t,n]),d.length===0?null:s.jsxs("div",{style:{padding:l.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:l.space[8]},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:l.space[2],padding:`${l.space[2]} ${l.space[3]}`,marginBottom:l.space[4],border:"none",background:"transparent",color:R.slate[600],fontSize:l.fontSize.sm,cursor:"pointer",borderRadius:l.radius.md,transition:`background ${l.transition.normal}`},onMouseEnter:m=>m.target.style.background=R.slate[100],onMouseLeave:m=>m.target.style.background="transparent",children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[4]},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:l.radius.xl,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(It,{style:{width:"28px",height:"28px",color:l.headerText}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:l.fontSize.xl,fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[600],margin:`${l.space[1]} 0 0 0`},children:"Personalisiere dein Rollenspiel"})]})]})]}),t.long_description&&s.jsx("div",{style:{padding:`${l.space[5]} ${l.space[6]}`,borderRadius:l.radius.xl,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,marginBottom:l.space[6]},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:l.space[3.5]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:l.radius.lg,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(mn,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900],margin:`0 0 ${l.space[2]} 0`},children:"Deine Aufgabe"}),s.jsx("p",{style:{fontSize:l.fontSize.sm,lineHeight:"1.6",color:R.slate[700],margin:0,whiteSpace:"pre-wrap"},children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),!t.long_description&&t.description&&s.jsx("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:R.slate[100],marginBottom:l.space[6]},children:s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),t.interviewer_profile&&s.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,border:`1px solid ${R.slate[200]}`,marginBottom:l.space[6],display:"flex",alignItems:"center",gap:l.space[4]},children:[t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:c(t.interviewer_profile.name),style:{width:"48px",height:"48px",borderRadius:l.radius.full,objectFit:"cover"}}):s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:l.radius.full,background:l.primaryAccentLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Et,{style:{width:"24px",height:"24px",color:l.primaryAccent}})}),s.jsxs("div",{children:[s.jsxs("p",{style:{fontSize:l.fontSize.sm,fontWeight:600,color:R.slate[900],margin:0},children:["Dein Gesprchspartner: ",c(t.interviewer_profile.name)]}),t.interviewer_profile.role&&s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[600],margin:`${l.space[.5]} 0 0 0`},children:c(t.interviewer_profile.role)})]})]}),s.jsxs("form",{onSubmit:h,children:[d.map(m=>s.jsx(YR,{field:m,value:i[m.key],onChange:u,error:o[m.key],focusColor:l.primaryAccent},m.key)),s.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:l.primaryAccentLight,marginTop:l.space[6],marginBottom:l.space[6],display:"flex",gap:l.space[5],flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsxs("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:[s.jsx(qe,{style:{width:"12px",height:"12px",display:"inline",marginRight:l.space[1]}}),"Dauer"]}),s.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:"ca. 10 Min"})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:"Typ"}),s.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:"Live-Gesprch"})]})]}),s.jsxs("button",{type:"submit",style:{width:"100%",padding:`${l.space[4]} ${l.space[6]}`,borderRadius:l.radius.xl,border:"none",background:l.buttonGradient,color:"white",fontSize:l.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:l.space[2.5],transition:`transform ${l.transition.normal}, box-shadow ${l.transition.normal}`,boxShadow:`0 4px 12px ${l.primaryAccent}4d`},onMouseEnter:m=>{m.target.style.transform="translateY(-2px)",m.target.style.boxShadow=`0 6px 16px ${l.primaryAccent}66`},onMouseLeave:m=>{m.target.style.transform="none",m.target.style.boxShadow=`0 4px 12px ${l.primaryAccent}4d`},children:["Weiter",s.jsx(yo,{style:{width:"20px",height:"20px"}})]})]})]})},ks=(t=768)=>{const[e,n]=f.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return f.useEffect(()=>{const i=()=>{n(window.innerWidth<t)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[t]),e};var xf={};function ZR(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var QR=Object.defineProperty,eI=(t,e,n)=>e in t?QR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yf=(t,e,n)=>eI(t,typeof e!="symbol"?e+"":e,n);let on=class{constructor(){yf(this,"_locking"),yf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function bt(t,e){if(!t)throw new Error(e)}const tI=34028234663852886e22,nI=-34028234663852886e22,iI=4294967295,sI=2147483647,rI=-2147483648;function ta(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>sI||t<rI)throw new Error("invalid int 32: "+t)}function Xc(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>iI||t<0)throw new Error("invalid uint 32: "+t)}function ly(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>tI||t<nI))throw new Error("invalid float 32: "+t)}const cy=Symbol("@bufbuild/protobuf/enum-type");function oI(t){const e=t[cy];return bt(e,"missing enum type on enum object"),e}function dy(t,e,n,i){t[cy]=uy(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function uy(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of e){const l=hy(a);o.push(l),i[a.name]=l,r[a.no]=l}return{typeName:t,values:o,findName(a){return i[a]},findNumber(a){return r[a]}}}function aI(t,e,n){const i={};for(const r of e){const o=hy(r);i[o.localName]=o.no,i[o.no]=o.localName}return dy(i,t,e),i}function hy(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Tu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function lI(t,e,n,i){var r;const o=(r=i?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[o]:function(l){t.util.initFields(this),t.util.initPartial(l,this)}}[o];return Object.setPrototypeOf(a.prototype,new Tu),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(l,c){return new a().fromBinary(l,c)},fromJson(l,c){return new a().fromJson(l,c)},fromJsonString(l,c){return new a().fromJsonString(l,c)},equals(l,c){return t.util.equals(a,l,c)}}),a}function cI(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function ql(t,e,n){for(let o=0;o<28;o=o+7){const a=t>>>o,l=!(!(a>>>7)&&e==0),c=(l?a|128:a)&255;if(n.push(c),!l)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const a=e>>>o,l=!!(a>>>7),c=(l?a|128:a)&255;if(n.push(c),!l)return}n.push(e>>>31&1)}}const na=4294967296;function bf(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(a,l){const c=Number(t.slice(a,l));r*=n,i=i*n+c,i>=na&&(r=r+(i/na|0),i=i%na)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?fy(i,r):Eu(i,r)}function dI(t,e){let n=Eu(t,e);const i=n.hi&2147483648;i&&(n=fy(n.lo,n.hi));const r=py(n.lo,n.hi);return i?"-"+r:r}function py(t,e){if({lo:t,hi:e}=uI(t,e),e<=2097151)return String(na*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,a=i+r*8147497,l=r*2;const c=1e7;return o>=c&&(a+=Math.floor(o/c),o%=c),a>=c&&(l+=Math.floor(a/c),a%=c),l.toString()+vf(a)+vf(o)}function uI(t,e){return{lo:t>>>0,hi:e>>>0}}function Eu(t,e){return{lo:t|0,hi:e|0}}function fy(t,e){return e=~e,t?t=~t+1:e+=1,Eu(t,e)}const vf=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Sf(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function hI(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function pI(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof xf!="object"||xf.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>o||d<r)throw new Error("int64 invalid: ".concat(c));return d},uParse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>l||d<a)throw new Error("uint64 invalid: ".concat(c));return d},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigInt64(0,!0)},uDec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigUint64(0,!0)}}}const n=r=>bt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>bt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),bf(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),bf(r)},dec(r,o){return dI(r,o)},uDec(r,o){return py(r,o)}}}const at=pI();var H;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(H||(H={}));var qi;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(qi||(qi={}));function Ri(t,e,n){if(e===n)return!0;if(t==H.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return e==n}return!1}function ar(t,e){switch(t){case H.BOOL:return!1;case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return e==0?at.zero:"0";case H.DOUBLE:case H.FLOAT:return 0;case H.BYTES:return new Uint8Array(0);case H.STRING:return"";default:return 0}}function my(t,e){switch(t){case H.BOOL:return e===!1;case H.STRING:return e==="";case H.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var kt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(kt||(kt={}));class fI{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Xc(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ta(e),Sf(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){ly(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Xc(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){ta(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return ta(e),e=(e<<1^e>>31)>>>0,Sf(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=at.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=at.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=at.enc(e);return ql(n.lo,n.hi,this.buf),this}sint64(e){let n=at.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return ql(r,o,this.buf),this}uint64(e){let n=at.uEnc(e);return ql(n.lo,n.hi,this.buf),this}}class mI{constructor(e,n){this.varint64=cI,this.uint32=hI,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case kt.Varint:for(;this.buf[this.pos++]&128;);break;case kt.Bit64:this.pos+=4;case kt.Bit32:this.pos+=4;break;case kt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case kt.StartGroup:for(;;){const[o,a]=this.tag();if(a===kt.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(a,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return at.dec(...this.varint64())}uint64(){return at.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,at.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return at.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return at.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function gI(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function gy(t){const e=t.field.localName,n=Object.create(null);return n[e]=xI(t),[n,()=>n[e]]}function xI(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return ar(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function yI(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),rl=[];for(let t=0;t<mi.length;t++)rl[mi[t].charCodeAt(0)]=t;rl[45]=mi.indexOf("+");rl[95]=mi.indexOf("/");const xy={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,a=0;for(let l=0;l<t.length;l++){if(o=rl[t.charCodeAt(l)],o===void 0)switch(t[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=o,r=1;break;case 1:n[i++]=a<<2|(o&48)>>4,a=o,r=2;break;case 2:n[i++]=(a&15)<<4|(o&60)>>2,a=o,r=3;break;case 3:n[i++]=(a&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=mi[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=mi[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=mi[r|i>>6],e+=mi[i&63],n=0;break}return n&&(e+=mi[r],e+="=",n==1&&(e+="=")),e}};function bI(t,e,n){by(e,t);const i=e.runtime.bin.makeReadOptions(n),r=yI(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,a]=gy(e);for(const l of r)e.runtime.bin.readField(o,i.readerFactory(l.data),e.field,l.wireType,i);return a()}function vI(t,e,n,i){by(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(yy(t,e)){const d=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of d)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const a=o.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[d,u]=c.tag(),p=c.skip(u,d);t.getType().runtime.bin.onUnknownField(t,d,u,p)}}function yy(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function by(t,e){bt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function vy(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!my(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function kf(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?ar(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function gi(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Tu.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Sy(t,e){return gi(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}H.DOUBLE,H.FLOAT,H.INT64,H.UINT64,H.INT32,H.UINT32,H.BOOL,H.STRING,H.BYTES;const wf={ignoreUnknownFields:!1},Cf={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function SI(t){return t?Object.assign(Object.assign({},wf),t):wf}function kI(t){return t?Object.assign(Object.assign({},Cf),t):Cf}const Ea=Symbol(),ia=Symbol();function wI(){return{makeReadOptions:SI,makeWriteOptions:kI,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Jn(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[a,l]of Object.entries(e)){const c=t.fields.findJsonName(a);if(c){if(c.oneof){if(l===null&&c.kind=="scalar")continue;const d=r.get(c.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(d,'", "').concat(a,'"'));r.set(c.oneof,a)}jf(i,l,c,n,t)}else{let d=!1;if(o?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=o.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==t.typeName){d=!0;const[p,h]=gy(u);jf(p,l,u.field,n,u),vI(i,u,h(),n)}}if(!d&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!vy(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!jI(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],l=Tf(r,a,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const l=o.findExtensionFor(n.typeName,a.no);if(l&&yy(t,l)){const c=bI(t,l,e),d=Tf(l.field,c,e);d!==void 0&&(i[l.field.jsonName]=d)}}}catch(o){const a=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),l=o instanceof Error?o.message:String(o);throw new Error(a+(l.length>0?": ".concat(l):""))}return i},readScalar(t,e,n){return Fr(t,e,n??qi.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||my(t,e)))return sa(t,e)},debug:Jn}}function Jn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function jf(t,e,n,i,r){let o=n.localName;if(n.repeated){if(bt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(e)));const a=t[o];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(l)));switch(n.kind){case"message":a.push(n.T.fromJson(l,i));break;case"enum":const c=Kl(n.T,l,i.ignoreUnknownFields,!0);c!==ia&&a.push(c);break;case"scalar":try{a.push(Fr(n.T,l,n.L,!0))}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(l));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(e)));const a=t[o];for(const[l,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let d;try{d=CI(n.K,l)}catch(u){let p="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(e));throw u instanceof Error&&u.message.length>0&&(p+=": ".concat(u.message)),new Error(p)}switch(n.V.kind){case"message":a[d]=n.V.T.fromJson(c,i);break;case"enum":const u=Kl(n.V.T,c,i.ignoreUnknownFields,!0);u!==ia&&(a[d]=u);break;case"scalar":try{a[d]=Fr(n.V.T,c,qi.BIGINT,!0)}catch(p){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(e));throw p instanceof Error&&p.message.length>0&&(h+=": ".concat(p.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let l=t[o];gi(l)?l.fromJson(e,i):(t[o]=l=a.fromJson(e,i),a.fieldWrapper&&!n.oneof&&(t[o]=a.fieldWrapper.unwrapField(l)));break;case"enum":const c=Kl(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Ea:kf(n,t);break;case ia:break;default:t[o]=c;break}break;case"scalar":try{const d=Fr(n.T,e,n.L,!1);switch(d){case Ea:kf(n,t);break;default:t[o]=d;break}}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Jn(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}function CI(t,e){if(t===H.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Fr(t,e,qi.BIGINT,!0).toString()}function Fr(t,e,n,i){if(e===null)return i?ar(t,n):Ea;switch(t){case H.DOUBLE:case H.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==H.FLOAT&&ly(r),r;case H.INT32:case H.FIXED32:case H.SFIXED32:case H.SINT32:case H.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==H.UINT32||t==H.FIXED32?Xc(o):ta(o),o;case H.INT64:case H.SFIXED64:case H.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=at.parse(e);return n?a.toString():a;case H.FIXED64:case H.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=at.uParse(e);return n?l.toString():l;case H.BOOL:if(typeof e!="boolean")break;return e;case H.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case H.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return xy.dec(e)}throw new Error}function Kl(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Ea;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return ia;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Jn(e)))}function jI(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Tf(t,e,n){if(t.kind=="map"){bt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,l]of r)i[a.toString()]=sa(t.V.T,l);break;case"message":for(const[a,l]of r)i[a.toString()]=l.toJson(n);break;case"enum":const o=t.V.T;for(const[a,l]of r)i[a.toString()]=Jl(o,l,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){bt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(sa(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Jl(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return sa(t.T,e);case"enum":return Jl(t.T,e,n.enumAsInteger);case"message":return Sy(t.T,e).toJson(n)}}function Jl(t,e,n){var i;if(bt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r?.name)!==null&&i!==void 0?i:e}function sa(t,e){switch(t){case H.INT32:case H.SFIXED32:case H.SINT32:case H.FIXED32:case H.UINT32:return bt(typeof e=="number"),e;case H.FLOAT:case H.DOUBLE:return bt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case H.STRING:return bt(typeof e=="string"),e;case H.BOOL:return bt(typeof e=="boolean"),e;case H.UINT64:case H.FIXED64:case H.INT64:case H.SFIXED64:case H.SINT64:return bt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case H.BYTES:return bt(e instanceof Uint8Array),xy.enc(e)}}const Ps=Symbol("@bufbuild/protobuf/unknown-fields"),Ef={readUnknownFields:!0,readerFactory:t=>new mI(t)},Rf={writeUnknownFields:!0,writerFactory:()=>new fI};function TI(t){return t?Object.assign(Object.assign({},Ef),t):Ef}function EI(t){return t?Object.assign(Object.assign({},Rf),t):Rf}function RI(){return{makeReadOptions:TI,makeWriteOptions:EI,listUnknownFields(t){var e;return(e=t[Ps])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Ps]},writeUnknownFields(t,e){const i=t[Ps];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Ps])||(r[Ps]=[]),r[Ps].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),a=r?e.len:e.pos+n;let l,c;for(;e.pos<a&&([l,c]=e.tag(),!(r===!0&&c==kt.EndGroup));){const d=o.fields.find(l);if(!d){const u=e.skip(c,l);i.readUnknownFields&&this.onUnknownField(t,l,c,u);continue}If(t,e,d,c,i)}if(r&&(c!=kt.EndGroup||l!==n))throw new Error("invalid end group tag")},readField:If,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!vy(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];_f(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&_f(t,e,n,i)}}}function If(t,e,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const l=n.kind=="enum"?H.INT32:n.T;let c=Ra;if(n.kind=="scalar"&&n.L>0&&(c=_I),o){let h=t[a];if(i==kt.LengthDelimited&&l!=H.STRING&&l!=H.BYTES){let x=e.uint32()+e.pos;for(;e.pos<x;)h.push(c(e,l))}else h.push(c(e,l))}else t[a]=c(e,l);break;case"message":const d=n.T;o?t[a].push(ra(e,new d,r,n)):gi(t[a])?ra(e,t[a],r,n):(t[a]=ra(e,new d,r,n),d.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=d.fieldWrapper.unwrapField(t[a])));break;case"map":let[u,p]=II(n,e,r);t[a][u]=p;break}}function ra(t,e,n,i){const r=e.getType().runtime.bin,o=i?.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function II(t,e,n){const i=e.uint32(),r=e.pos+i;let o,a;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:o=Ra(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=Ra(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=ra(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=ar(t.K,qi.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(t.V.kind){case"scalar":a=ar(t.V.T,qi.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[o,a]}function _I(t,e){const n=Ra(t,e);return typeof n=="bigint"?n.toString():n}function Ra(t,e){switch(e){case H.STRING:return t.string();case H.BOOL:return t.bool();case H.DOUBLE:return t.double();case H.FLOAT:return t.float();case H.INT32:return t.int32();case H.INT64:return t.int64();case H.UINT64:return t.uint64();case H.FIXED64:return t.fixed64();case H.BYTES:return t.bytes();case H.FIXED32:return t.fixed32();case H.SFIXED32:return t.sfixed32();case H.SFIXED64:return t.sfixed64();case H.SINT64:return t.sint64();case H.UINT32:return t.uint32();case H.SINT32:return t.sint32()}}function _f(t,e,n,i){bt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?H.INT32:t.T;if(r)if(bt(Array.isArray(e)),t.packed)AI(n,o,t.no,e);else for(const a of e)Ur(n,o,t.no,a);else Ur(n,o,t.no,e);break;case"message":if(r){bt(Array.isArray(e));for(const a of e)Nf(n,i,t,a)}else Nf(n,i,t,e);break;case"map":bt(typeof e=="object"&&e!=null);for(const[a,l]of Object.entries(e))NI(n,i,t,a,l);break}}function NI(t,e,n,i,r){t.tag(n.no,kt.LengthDelimited),t.fork();let o=i;switch(n.K){case H.INT32:case H.FIXED32:case H.UINT32:case H.SFIXED32:case H.SINT32:o=Number.parseInt(i);break;case H.BOOL:bt(i=="true"||i=="false"),o=i=="true";break}switch(Ur(t,n.K,1,o),n.V.kind){case"scalar":Ur(t,n.V.T,2,r);break;case"enum":Ur(t,H.INT32,2,r);break;case"message":bt(r!==void 0),t.tag(2,kt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Nf(t,e,n,i){const r=Sy(n.T,i);n.delimited?t.tag(n.no,kt.StartGroup).raw(r.toBinary(e)).tag(n.no,kt.EndGroup):t.tag(n.no,kt.LengthDelimited).bytes(r.toBinary(e))}function Ur(t,e,n,i){bt(i!==void 0);let[r,o]=ky(e);t.tag(n,r)[o](i)}function AI(t,e,n,i){if(!i.length)return;t.tag(n,kt.LengthDelimited).fork();let[,r]=ky(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function ky(t){let e=kt.Varint;switch(t){case H.BYTES:case H.STRING:e=kt.LengthDelimited;break;case H.DOUBLE:case H.FIXED64:case H.SFIXED64:e=kt.Bit64;break;case H.FIXED32:case H.SFIXED32:case H.FLOAT:e=kt.Bit32;break}const n=H[t].toLowerCase();return[e,n]}function MI(){return{setEnumType:dy,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,a=t;if(a[r]!=null)switch(i.kind){case"oneof":const l=a[r].case;if(l===void 0)continue;const c=i.findField(l);let d=a[r].value;c&&c.kind=="message"&&!gi(d,c.T)?d=new c.T(d):c&&c.kind==="scalar"&&c.T===H.BYTES&&(d=kr(d)),o[r]={case:l,value:d};break;case"scalar":case"enum":let u=a[r];i.T===H.BYTES&&(u=i.repeated?u.map(kr):kr(u)),o[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===H.BYTES)for(const[m,x]of Object.entries(a[r]))o[r][m]=kr(x);else Object.assign(o[r],a[r]);break;case"message":const h=i.V.T;for(const m of Object.keys(a[r])){let x=a[r][m];h.fieldWrapper||(x=new h(x)),o[r][m]=x}break}break;case"message":const p=i.T;if(i.repeated)o[r]=a[r].map(h=>gi(h,p)?h:new p(h));else{const h=a[r];p.fieldWrapper?p.typeName==="google.protobuf.BytesValue"?o[r]=kr(h):o[r]=h:o[r]=gi(h,p)?h:new p(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((a,l)=>i.T.equals(a,o[l]));case"scalar":return r.every((a,l)=>Ri(i.T,a,o[l]));case"enum":return r.every((a,l)=>Ri(H.INT32,a,o[l]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let a=r,l=o;return i.T.fieldWrapper&&(a!==void 0&&!gi(a)&&(a=i.T.fieldWrapper.wrapField(a)),l!==void 0&&!gi(l)&&(l=i.T.fieldWrapper.wrapField(l))),i.T.equals(a,l);case"enum":return Ri(H.INT32,r,o);case"scalar":return Ri(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return Ri(H.INT32,r.value,o.value);case"scalar":return Ri(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const d=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const u=i.V.T;return d.every(h=>u.equals(r[h],o[h]));case"enum":return d.every(h=>Ri(H.INT32,r[h],o[h]));case"scalar":const p=i.V.T;return d.every(h=>Ri(p,r[h],o[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let a;if(r.repeated)a=o.map(Bo);else if(r.kind=="map"){a=i[r.localName];for(const[l,c]of Object.entries(o))a[l]=Bo(c)}else r.kind=="oneof"?a=r.findField(o.case)?{case:o.case,value:Bo(o.value)}:{case:void 0}:a=Bo(o);i[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Bo(t){if(t===void 0)return t;if(gi(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function kr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function PI(t,e,n){return{syntax:t,json:wI(),bin:RI(),util:Object.assign(Object.assign({},MI()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return lI(this,i,r,o)},makeEnum:aI,makeEnumType:uy,getEnumType:oI,makeExtension(i,r,o){return gI(this,i,r,o)}}}class DI{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function wy(t,e){const n=Cy(t);return e?n:UI(FI(n))}function OI(t){return wy(t,!1)}const LI=Cy;function Cy(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const zI=new Set(["constructor","toString","toJSON","valueOf"]),BI=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),jy=t=>"".concat(t,"$"),FI=t=>BI.has(t)?jy(t):t,UI=t=>zI.has(t)?jy(t):t;class WI{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=OI(e)}addField(e){bt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function VI(t,e){var n,i,r,o,a,l;const c=[];let d;for(const u of typeof t=="function"?t():t){const p=u;if(p.localName=wy(u.name,u.oneof!==void 0),p.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:LI(u.name),p.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(p.L=(r=u.L)!==null&&r!==void 0?r:qi.BIGINT),p.delimited=(o=u.delimited)!==null&&o!==void 0?o:!1,p.req=(a=u.req)!==null&&a!==void 0?a:!1,p.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(p.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=H.BYTES&&u.T!=H.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!d||d.name!=h)&&(d=new WI(h)),p.oneof=d,d.addField(p)}c.push(p)}return c}const O=PI("proto3",t=>new DI(t,e=>VI(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=ar(e.T,e.L);break}}});class cn extends Tu{constructor(e){super(),this.seconds=at.zero,this.nanos=0,O.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(O.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=at.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return cn.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new cn({seconds:at.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new cn().fromBinary(e,n)}static fromJson(e,n){return new cn().fromJson(e,n)}static fromJsonString(e,n){return new cn().fromJsonString(e,n)}static equals(e,n){return O.util.equals(cn,e,n)}}cn.runtime=O;cn.typeName="google.protobuf.Timestamp";cn.fields=O.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const $I=O.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:cn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:GI,repeated:!0},{no:5,name:"events",kind:"message",T:qI,repeated:!0}]),GI=O.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:HI,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),HI=O.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:cn},{no:3,name:"value",kind:"scalar",T:2}]),qI=O.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:cn},{no:7,name:"normalized_end_timestamp",kind:"message",T:cn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Ty=O.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zn=O.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Tt=O.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ru=O.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Nr=O.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),oo=O.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Un=O.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),is=O.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),KI=O.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Dt=O.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),ol=O.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ia,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:By}]),Ia=O.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),JI=O.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:O.getEnumType(Tt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),xs=O.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:O.getEnumType(Ys)},{no:4,name:"tracks",kind:"message",T:Ws,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:JI},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:O.getEnumType(ao)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:O.getEnumType(Un)},{no:18,name:"kind_details",kind:"enum",T:O.getEnumType(YI),repeated:!0}]),Ys=O.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ao=O.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),YI=O.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),At=O.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),XI=O.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ui,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:O.getEnumType(Ey)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ws=O.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:O.getEnumType(zn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:O.getEnumType(Tt)},{no:10,name:"layers",kind:"message",T:Ui,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:XI,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:O.getEnumType(At)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:By},{no:19,name:"audio_features",kind:"enum",T:O.getEnumType(Dt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:O.getEnumType(Ty)}]),Ui=O.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:O.getEnumType(Ru)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ey=O.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),nn=O.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:O.getEnumType(_e)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Iu,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ZI,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Ny,oneof:"value"},{no:7,name:"transcription",kind:"message",T:QI,oneof:"value"},{no:8,name:"metrics",kind:"message",T:$I,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:_a,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:_u,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Nu,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Au,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Na,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Aa,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ma,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Ry,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),_e=O.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Ry=O.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:O.getEnumType(At)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Iy=O.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Iu,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:_a,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:_u,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Nu,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Au,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Na,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Aa,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Ma,oneof:"value"}]),ZI=O.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:_y,repeated:!0}]),_y=O.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Iu=O.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Ny=O.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),QI=O.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:e_,repeated:!0}]),e_=O.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),_a=O.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),_u=O.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Nu=O.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Au=O.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Ay,oneof:"value"}]),Ay=O.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),My=O.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Py=O.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:O.getEnumType(Dy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Dy=O.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Oy=O.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:O.getEnumType(Ly)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Ly=O.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),zy=O.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Af},{no:2,name:"screen",kind:"message",T:Af},{no:3,name:"resume_connection",kind:"enum",T:O.getEnumType(oo)},{no:4,name:"disabled_codecs",kind:"message",T:t_},{no:5,name:"force_relay",kind:"enum",T:O.getEnumType(oo)}]),Af=O.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:O.getEnumType(oo)}]),t_=O.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ia,repeated:!0},{no:2,name:"publish",kind:"message",T:Ia,repeated:!0}]),By=O.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Zc=O.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Fy=O.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:O.getEnumType(Zc)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Uy=O.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Na=O.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:O.getEnumType(At)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Fy,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Uy,oneof:"content_header"}],{localName:"DataStream_Header"}),Aa=O.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ma=O.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),n_=O.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Bn=O.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Qc=O.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),i_=O.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),s_=O.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ki,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ki,oneof:"message"},{no:3,name:"trickle",kind:"message",T:al,oneof:"message"},{no:4,name:"add_track",kind:"message",T:lo,oneof:"message"},{no:5,name:"mute",kind:"message",T:ll,oneof:"message"},{no:6,name:"subscription",kind:"message",T:cl,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Wy,oneof:"message"},{no:8,name:"leave",kind:"message",T:dl,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:$y,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:qy,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Lu,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Kn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Du,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Yy,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Pu,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Vy,oneof:"message"}]),Mf=O.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:r_,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ki,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ki,oneof:"message"},{no:4,name:"trickle",kind:"message",T:al,oneof:"message"},{no:5,name:"update",kind:"message",T:l_,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Mu,oneof:"message"},{no:8,name:"leave",kind:"message",T:dl,oneof:"message"},{no:9,name:"mute",kind:"message",T:ll,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:c_,oneof:"message"},{no:11,name:"room_update",kind:"message",T:d_,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:h_,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:f_,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:g_,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:y_,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:a_,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:o_,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:v_,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:w_,oneof:"message"},{no:22,name:"request_response",kind:"message",T:C_,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:j_,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:b_,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:I_,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:x_,oneof:"message"}]),ed=O.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ui,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:O.getEnumType(Ey)}]),lo=O.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:O.getEnumType(zn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:O.getEnumType(Tt)},{no:9,name:"layers",kind:"message",T:Ui,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:ed,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:O.getEnumType(At)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:O.getEnumType(Ty)},{no:17,name:"audio_features",kind:"enum",T:O.getEnumType(Dt),repeated:!0}]),al=O.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:O.getEnumType(Bn)},{no:3,name:"final",kind:"scalar",T:8}]),ll=O.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),r_=O.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:ol},{no:2,name:"participant",kind:"message",T:xs},{no:3,name:"other_participants",kind:"message",T:xs,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Gy,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:zy},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Py},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ia,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),o_=O.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Gy,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:zy},{no:3,name:"server_info",kind:"message",T:Py},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Mu=O.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ws}]),a_=O.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ki=O.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),l_=O.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:xs,repeated:!0}]),cl=O.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:My,repeated:!0}]),Wy=O.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:O.getEnumType(Ru)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Pu=O.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:O.getEnumType(Dt),repeated:!0}]),Vy=O.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),dl=O.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:O.getEnumType(Un)},{no:3,name:"action",kind:"enum",T:O.getEnumType(Xs)},{no:4,name:"regions",kind:"message",T:S_}]),Xs=O.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),$y=O.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Ui,repeated:!0}]),Du=O.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Gy=O.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),c_=O.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:_y,repeated:!0}]),d_=O.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:ol}]),u_=O.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:O.getEnumType(Nr)},{no:3,name:"score",kind:"scalar",T:2}]),h_=O.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:u_,repeated:!0}]),p_=O.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:O.getEnumType(Qc)}]),f_=O.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:p_,repeated:!0}]),Ou=O.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:O.getEnumType(Ru)},{no:2,name:"enabled",kind:"scalar",T:8}]),m_=O.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Ou,repeated:!0}]),g_=O.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Ou,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:m_,repeated:!0}]),x_=O.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:n_,repeated:!0}]),Hy=O.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),qy=O.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Hy,repeated:!0}]),y_=O.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),b_=O.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:ol},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:xs},{no:4,name:"other_participants",kind:"message",T:xs,repeated:!0}]),Lu=O.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ki},{no:2,name:"subscription",kind:"message",T:cl},{no:3,name:"publish_tracks",kind:"message",T:Mu,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Jy,repeated:!0},{no:5,name:"offer",kind:"message",T:Ki},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Ky,repeated:!0}]),Ky=O.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Jy=O.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:O.getEnumType(Bn)}]),Kn=O.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:O.getEnumType(i_),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Yy=O.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),v_=O.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),S_=O.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:k_,repeated:!0}]),k_=O.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),w_=O.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:O.getEnumType(KI)}]),C_=O.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:O.getEnumType(zu)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:al,oneof:"request"},{no:5,name:"add_track",kind:"message",T:lo,oneof:"request"},{no:6,name:"mute",kind:"message",T:ll,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Du,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Pu,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Vy,oneof:"request"}]),zu=O.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),j_=O.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Xy=O.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),T_=O.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Oy},{no:2,name:"connection_settings",kind:"message",T:Xy},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:lo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Ki},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:O.getEnumType(is)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Lu}]),E_=O.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:O.getEnumType(R_)},{no:2,name:"join_request",kind:"scalar",T:12}]),R_=O.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),I_=O.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function __(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oa={exports:{}},N_=oa.exports,Pf;function A_(){return Pf||(Pf=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(N_,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},a=null;function l(g,y){var v=g[y];if(typeof v.bind=="function")return v.bind(g);try{return Function.prototype.bind.call(v,g)}catch{return function(){return Function.prototype.apply.apply(v,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?c:console[g]!==void 0?l(console,g):console.log!==void 0?l(console,"log"):e}function u(){for(var g=this.getLevel(),y=0;y<r.length;y++){var v=r[y];this[v]=y<g?e:this.methodFactory(v,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function p(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function h(g,y,v){return d(g)||p.apply(this,arguments)}function m(g,y){var v=this,w,k,S,b="loglevel";typeof g=="string"?b+=":"+g:typeof g=="symbol"&&(b=void 0);function j(N){var L=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=L;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+L+";"}catch{}}}function C(){var N;if(!(typeof window===n||!b)){try{N=window.localStorage[b]}catch{}if(typeof N===n)try{var L=window.document.cookie,V=encodeURIComponent(b),D=L.indexOf(V+"=");D!==-1&&(N=/^([^;]+)/.exec(L.slice(D+V.length+1))[1])}catch{}return v.levels[N]===void 0&&(N=void 0),N}}function T(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function _(N){var L=N;if(typeof L=="string"&&v.levels[L.toUpperCase()]!==void 0&&(L=v.levels[L.toUpperCase()]),typeof L=="number"&&L>=0&&L<=v.levels.SILENT)return L;throw new TypeError("log.setLevel() called with invalid level: "+N)}v.name=g,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=y||h,v.getLevel=function(){return S??k??w},v.setLevel=function(N,L){return S=_(N),L!==!1&&j(S),u.call(v)},v.setDefaultLevel=function(N){k=_(N),C()||v.setLevel(N,!1)},v.resetLevel=function(){S=null,T(),u.call(v)},v.enableAll=function(N){v.setLevel(v.levels.TRACE,N)},v.disableAll=function(N){v.setLevel(v.levels.SILENT,N)},v.rebuild=function(){if(a!==v&&(w=_(a.getLevel())),u.call(v),a===v)for(var N in o)o[N].rebuild()},w=_(a?a.getLevel():"WARN");var E=C();E!=null&&(S=_(E)),u.call(v)}a=new m,a.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var v=o[y];return v||(v=o[y]=new m(y,a.methodFactory)),v};var x=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=x),a},a.getLoggers=function(){return o},a.default=a,a})})(oa)),oa.exports}var ul=A_(),td;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(td||(td={}));var Hn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Hn||(Hn={}));let Ce=ul.getLogger("livekit");Object.values(Hn).map(t=>ul.getLogger(t));Ce.setDefaultLevel(td.info);function ki(t){const e=ul.getLogger(t);return e.setDefaultLevel(Ce.getLevel()),e}const M_=ul.getLogger("lk-e2ee"),wr=7e3,P_=[0,300,4*300,9*300,16*300,wr,wr,wr,wr,wr];class D_{constructor(e){this._retryDelays=e!==void 0?[...e]:P_}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function O_(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function I(t,e,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(u){try{d(i.next(u))}catch(p){a(p)}}function c(u){try{d(i.throw(u))}catch(p){a(p)}}function d(u){u.done?o(u.value):r(u.value).then(l,c)}d((i=i.apply(t,e||[])).next())})}function Df(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Df=="function"?Df(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(a){return new Promise(function(l,c){a=t[o](a),r(l,c,a.done,a.value)})}}function r(o,a,l,c){Promise.resolve(c).then(function(d){o({value:d,done:l})},a)}}var Fo={exports:{}},Of;function L_(){if(Of)return Fo.exports;Of=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,j,C){return Function.prototype.apply.call(b,j,C)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(S){console&&console.warn&&console.warn(S)}var r=Number.isNaN||function(b){return b!==b};function o(){o.init.call(this)}Fo.exports=o,Fo.exports.once=v,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");a=S}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function c(S){return S._maxListeners===void 0?o.defaultMaxListeners:S._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(b){for(var j=[],C=1;C<arguments.length;C++)j.push(arguments[C]);var T=b==="error",_=this._events;if(_!==void 0)T=T&&_.error===void 0;else if(!T)return!1;if(T){var E;if(j.length>0&&(E=j[0]),E instanceof Error)throw E;var N=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw N.context=E,N}var L=_[b];if(L===void 0)return!1;if(typeof L=="function")e(L,this,j);else for(var V=L.length,D=x(L,V),C=0;C<V;++C)e(D[C],this,j);return!0};function d(S,b,j,C){var T,_,E;if(l(j),_=S._events,_===void 0?(_=S._events=Object.create(null),S._eventsCount=0):(_.newListener!==void 0&&(S.emit("newListener",b,j.listener?j.listener:j),_=S._events),E=_[b]),E===void 0)E=_[b]=j,++S._eventsCount;else if(typeof E=="function"?E=_[b]=C?[j,E]:[E,j]:C?E.unshift(j):E.push(j),T=c(S),T>0&&E.length>T&&!E.warned){E.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=S,N.type=b,N.count=E.length,i(N)}return S}o.prototype.addListener=function(b,j){return d(this,b,j,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(b,j){return d(this,b,j,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(S,b,j){var C={fired:!1,wrapFn:void 0,target:S,type:b,listener:j},T=u.bind(C);return T.listener=j,C.wrapFn=T,T}o.prototype.once=function(b,j){return l(j),this.on(b,p(this,b,j)),this},o.prototype.prependOnceListener=function(b,j){return l(j),this.prependListener(b,p(this,b,j)),this},o.prototype.removeListener=function(b,j){var C,T,_,E,N;if(l(j),T=this._events,T===void 0)return this;if(C=T[b],C===void 0)return this;if(C===j||C.listener===j)--this._eventsCount===0?this._events=Object.create(null):(delete T[b],T.removeListener&&this.emit("removeListener",b,C.listener||j));else if(typeof C!="function"){for(_=-1,E=C.length-1;E>=0;E--)if(C[E]===j||C[E].listener===j){N=C[E].listener,_=E;break}if(_<0)return this;_===0?C.shift():g(C,_),C.length===1&&(T[b]=C[0]),T.removeListener!==void 0&&this.emit("removeListener",b,N||j)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(b){var j,C,T;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[b]),this;if(arguments.length===0){var _=Object.keys(C),E;for(T=0;T<_.length;++T)E=_[T],E!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(j=C[b],typeof j=="function")this.removeListener(b,j);else if(j!==void 0)for(T=j.length-1;T>=0;T--)this.removeListener(b,j[T]);return this};function h(S,b,j){var C=S._events;if(C===void 0)return[];var T=C[b];return T===void 0?[]:typeof T=="function"?j?[T.listener||T]:[T]:j?y(T):x(T,T.length)}o.prototype.listeners=function(b){return h(this,b,!0)},o.prototype.rawListeners=function(b){return h(this,b,!1)},o.listenerCount=function(S,b){return typeof S.listenerCount=="function"?S.listenerCount(b):m.call(S,b)},o.prototype.listenerCount=m;function m(S){var b=this._events;if(b!==void 0){var j=b[S];if(typeof j=="function")return 1;if(j!==void 0)return j.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function x(S,b){for(var j=new Array(b),C=0;C<b;++C)j[C]=S[C];return j}function g(S,b){for(;b+1<S.length;b++)S[b]=S[b+1];S.pop()}function y(S){for(var b=new Array(S.length),j=0;j<b.length;++j)b[j]=S[j].listener||S[j];return b}function v(S,b){return new Promise(function(j,C){function T(E){S.removeListener(b,_),C(E)}function _(){typeof S.removeListener=="function"&&S.removeListener("error",T),j([].slice.call(arguments))}k(S,b,_,{once:!0}),b!=="error"&&w(S,T,{once:!0})})}function w(S,b,j){typeof S.on=="function"&&k(S,"error",b,j)}function k(S,b,j,C){if(typeof S.on=="function")C.once?S.once(b,j):S.on(b,j);else if(typeof S.addEventListener=="function")S.addEventListener(b,function T(_){C.once&&S.removeEventListener(b,T),j(_)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return Fo.exports}var ai=L_();let Zy=!0,Qy=!0;function Ar(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function ws(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=i.removeEventListener;i.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function z_(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Zy=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function B_(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Qy=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function eb(){if(typeof window=="object"){if(Zy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Bu(t,e){Qy&&console.warn(t+" is deprecated, please use "+e+" instead.")}function F_(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ar(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ar(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ar(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ar(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Lf(t){return Object.prototype.toString.call(t)==="[object Object]"}function tb(t){return Lf(t)?Object.keys(t).reduce(function(e,n){const i=Lf(t[n]),r=i?tb(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function nd(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?nd(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{nd(t,t.get(r),n)})}))}function zf(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(l=>{l.type===i&&l.trackId===a.id&&nd(t,l,r)})}),r}const Bf=eb;function nb(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const p=function(h,m){return h?h+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[p("min",d)]=u.ideal,c.optional.push(h),h={},h[p("max",d)]=u.ideal,c.optional.push(h)):(h[p("",d)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",d)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(h,d)]=u[h])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,p,h){p in u&&!(h in u)&&(u[h]=u[p],delete u[p])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let p;if(d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(x=>x.kind==="videoinput");let m=h.find(x=>p.some(g=>x.label.toLowerCase().includes(g)));return!m&&h.length&&p.includes("back")&&(m=h[h.length-1]),m&&(l.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=i(l.video),Bf("chrome: "+JSON.stringify(l)),c(l)})}l.video=i(l.video)}return Bf("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,d){r(l,u=>{n.webkitGetUserMedia(u,c,p=>{d&&d(o(p))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function ib(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function sb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ws(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function rb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=r.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ob(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>zf(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),ws(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>zf(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,a;return this.getSenders().forEach(l=>{l.track===i&&(r?a=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===i&&(o?a=!0:o=l),l.track===i)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function ab(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function lb(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return ab(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(m=>m.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new t.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[p.id];if(x)x.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[p.id]=g,this._reverseStreams[g.id]=p,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function o(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(h=>{const m=d._reverseStreams[h],x=d._streams[m.id];p=p.replace(new RegExp(x.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:p})}function a(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(h=>{const m=d._reverseStreams[h],x=d._streams[m.id];p=p.replace(new RegExp(m.id,"g"),x.id)}),new RTCSessionDescription({type:u.type,sdp:p})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],p={[d](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[x=>{const g=o(this,x);h[0].apply(null,[g])},x=>{h[1]&&h[1].apply(null,x)},arguments[2]]):u.apply(this,arguments).then(x=>o(this,x))}};t.RTCPeerConnection.prototype[d]=p[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(h=this._streams[m])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function id(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function cb(t,e){ws(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Ff=Object.freeze({__proto__:null,fixNegotiationNeeded:cb,shimAddTrackRemoveTrack:lb,shimAddTrackRemoveTrackWithNative:ab,shimGetSendersWithDtmf:rb,shimGetUserMedia:nb,shimMediaStream:ib,shimOnTrack:sb,shimPeerConnection:id,shimSenderReceiverGetStats:ob});function db(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,a){Bu("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function U_(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function ub(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sd(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return i.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,p)=>{c.set(p,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,l)}}function hb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function pb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),ws(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function fb(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Bu("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function mb(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function gb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function xb(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function yb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function bb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Uf=Object.freeze({__proto__:null,shimAddTransceiver:gb,shimCreateAnswer:bb,shimCreateOffer:yb,shimGetDisplayMedia:U_,shimGetParameters:xb,shimGetUserMedia:db,shimOnTrack:ub,shimPeerConnection:sd,shimRTCDataChannel:mb,shimReceiverGetStats:pb,shimRemoveStream:fb,shimSenderGetStats:hb});function vb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function Sb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function kb(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[p]);return u?(h.then(d,u),Promise.resolve()):h},e.createAnswer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[p]);return u?(h.then(d,u),Promise.resolve()):h};let l=function(c,d,u){const p=r.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p};e.setLocalDescription=l,l=function(c,d,u){const p=o.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.setRemoteDescription=l,l=function(c,d,u){const p=a.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.addIceCandidate=l}function wb(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Cb(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function Cb(t){return t&&t.video!==void 0?Object.assign({},t,{video:tb(t.video)}):t}function jb(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let a=0;a<i.iceServers.length;a++){let l=i.iceServers[a];l.urls===void 0&&l.url?(Bu("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(i.iceServers[a])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Tb(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Eb(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Rb(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Wf=Object.freeze({__proto__:null,shimAudioContext:Rb,shimCallbacksAPI:kb,shimConstraints:Cb,shimCreateOfferLegacy:Eb,shimGetUserMedia:wb,shimLocalStreamsAPI:vb,shimRTCIceServerUrls:jb,shimRemoteStreamsAPI:Sb,shimTrackEventTransceiver:Tb}),Yl={exports:{}},Vf;function W_(){return Vf||(Vf=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)r=o[a].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=p.length?e.parseFmtp(p[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{a.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let o=0;return i.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(x=>parseInt(x,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&d&&(m.rtx={ssrc:d}),i.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(m))}}),i.length===0&&c&&i.push({ssrc:c});let p=e.matchPrefix(n,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substring(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substring(5),10)*1e3*.95-2e3*8:p=void 0,i.forEach(h=>{h.maxBitrate=p})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const a=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(Yl)),Yl.exports}var Ib=W_(),Zs=__(Ib),V_=ZR({__proto__:null,default:Zs},[Ib]);function aa(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=Zs.parseCandidate(i.candidate);for(const a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,ws(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function rd(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ws(t,"icecandidate",e=>{if(e.candidate){const n=Zs.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function la(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Zs.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Zs.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Zs.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),d=r(c),u=o(arguments[0],c);let p;d===0&&u===0?p=Number.POSITIVE_INFINITY:d===0||u===0?p=Math.max(d,u):p=Math.min(d,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return p}}),this._sctp=h}return a.apply(this,arguments)}}function ca(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},ws(t,"datachannel",i=>(e(i.channel,i.target),i))}function od(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ad(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function da(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ua(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var $_=Object.freeze({__proto__:null,removeExtmapAllowMixed:ad,shimAddIceCandidateNullOrEmpty:da,shimConnectionState:od,shimMaxMessageSize:la,shimParameterlessSetLocalDescription:ua,shimRTCIceCandidate:aa,shimRTCIceCandidateRelayProtocol:rd,shimSendThrowTypeError:ca});function G_(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=eb,i=F_(t),r={browserDetails:i,commonShim:$_,extractVersion:Ar,disableLog:z_,disableWarnings:B_,sdp:V_};switch(i.browser){case"chrome":if(!Ff||!id||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Ff,da(t,i),ua(t),nb(t,i),ib(t),id(t,i),sb(t),lb(t,i),rb(t),ob(t),cb(t,i),aa(t),rd(t),od(t),la(t,i),ca(t),ad(t,i);break;case"firefox":if(!Uf||!sd||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Uf,da(t,i),ua(t),db(t,i),sd(t,i),ub(t),fb(t),hb(t),pb(t),mb(t),gb(t),xb(t),yb(t),bb(t),aa(t),od(t),la(t,i),ca(t);break;case"safari":if(!Wf||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Wf,da(t,i),ua(t),jb(t),Eb(t),kb(t),vb(t),Sb(t),Tb(t),wb(t),Rb(t),aa(t),rd(t),la(t,i),ca(t),ad(t,i);break;default:n("Unsupported browser!");break}return r}G_({window:typeof window>"u"?void 0:window});const H_=/version\/(\d+(\.?_?\d+)+)/i;let Xl;function fn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Xl===void 0||e){const i=q_.find(r=>{let{test:o}=r;return o.test(n)});Xl=i?.describe(n)}return Xl}const q_=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:ha(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Zl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:ha(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Zl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:ha(H_,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Zl(t)}}}];function ha(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Zl(t){return t.includes("mac os")?ha(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var K_="2.16.1";const J_=K_,Y_=16;class li extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var ot;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(ot||(ot={}));class be extends li{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=ot[n]}static notAllowed(e,n,i){return new be(e,ot.NotAllowed,n,i)}static timeout(e){return new be(e,ot.Timeout)}static leaveRequest(e,n){return new be(e,ot.LeaveRequest,void 0,n)}static internal(e,n){return new be(e,ot.InternalError,void 0,n)}static cancelled(e){return new be(e,ot.Cancelled)}static serverUnreachable(e,n){return new be(e,ot.ServerUnreachable,n)}static websocket(e,n,i){return new be(e,ot.WebSocket,n,i)}}class Fu extends li{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class yi extends li{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class X_ extends li{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Nt extends li{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ld extends li{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class $f extends li{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Gf extends li{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:zu[n]}}var tn;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(tn||(tn={}));class kn extends li{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=tn[n]}}class Ds extends li{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Pa;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Pa||(Pa={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Pa||(Pa={}));class Vt{}Vt.setTimeout=function(){return setTimeout(...arguments)};Vt.setInterval=function(){return setInterval(...arguments)};Vt.clearTimeout=function(){return clearTimeout(...arguments)};Vt.clearInterval=function(){return clearInterval(...arguments)};var Y;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(Y||(Y={}));var ae;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(ae||(ae={}));var oe;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(oe||(oe={}));var ne;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(ne||(ne={}));function Z_(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Xe{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const Q_=["vp8","h264"],eN=["vp8","h264","vp9","av1","h265"];function tN(t){return!!Q_.find(e=>e===t)}const nN=tN;var Hf;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Hf||(Hf={}));var cd;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(cd||(cd={}));const co={h90:new Xe(160,90,9e4,20),h180:new Xe(320,180,16e4,20),h216:new Xe(384,216,18e4,20),h360:new Xe(640,360,45e4,20),h540:new Xe(960,540,8e5,25),h720:new Xe(1280,720,17e5,30),h1080:new Xe(1920,1080,3e6,30),h1440:new Xe(2560,1440,5e6,30),h2160:new Xe(3840,2160,8e6,30)},dd={h120:new Xe(160,120,7e4,20),h180:new Xe(240,180,125e3,20),h240:new Xe(320,240,14e4,20),h360:new Xe(480,360,33e4,20),h480:new Xe(640,480,5e5,20),h540:new Xe(720,540,6e5,25),h720:new Xe(960,720,13e5,30),h1080:new Xe(1440,1080,23e5,30),h1440:new Xe(1920,1440,38e5,30)},Uu={h360fps3:new Xe(640,360,2e5,3,"medium"),h360fps15:new Xe(640,360,4e5,15,"medium"),h720fps5:new Xe(1280,720,8e5,5,"medium"),h720fps15:new Xe(1280,720,15e5,15,"medium"),h720fps30:new Xe(1280,720,2e6,30,"medium"),h1080fps15:new Xe(1920,1080,25e5,15,"medium"),h1080fps30:new Xe(1920,1080,5e6,30,"medium"),original:new Xe(0,0,7e6,30,"medium")};function _b(t,e,n){var i,r,o,a;const{optionsWithoutProcessor:l,audioProcessor:c,videoProcessor:d}=Mb(t??{}),u=e?.processor,p=n?.processor,h=l??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(ud(h.audio,e),(i=(o=h.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(ud(h.video,n),(r=(a=h.video).deviceId)!==null&&r!==void 0||(a.deviceId={ideal:"default"}),(d||p)&&(h.video.processor=d??p)),h}function ud(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Wu(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const a={},l=a,c=t.video;Object.keys(c).forEach(d=>{switch(d){case"resolution":ud(l,c.resolution);break;default:l[d]=c[d]}}),o.video=a,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Nb(t){return I(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=Ab();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,a=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield $t(n),r.getByteTimeDomainData(a);const c=a.some(d=>d!==128&&d!==0);return i.close(),!c}return!1})()})}function Ab(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>I(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function iN(t){return t==="audioinput"?G.Source.Microphone:t==="videoinput"?G.Source.Camera:G.Source.Unknown}function hd(t){return t===G.Source.Microphone?"audioinput":t===G.Source.Camera?"videoinput":void 0}function sN(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,bs()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Wr(t){return t.split("/")[1].toLowerCase()}function rN(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Mu({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Ne(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Ne(t.track):{})}}function oN(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function aN(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function Mb(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:Z_(e)}}function lN(t){switch(t){case Tt.CAMERA:return G.Source.Camera;case Tt.MICROPHONE:return G.Source.Microphone;case Tt.SCREEN_SHARE:return G.Source.ScreenShare;case Tt.SCREEN_SHARE_AUDIO:return G.Source.ScreenShareAudio;default:return G.Source.Unknown}}function qf(t,e){return t.width*t.height<e.width*e.height}function cN(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const dN=5e3,Cr=[];var xn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(xn||(xn={}));class G extends ai.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=G.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ce,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),dN):this.handleAppVisibilityChanged()},this.log=ki((r=i.loggerName)!==null&&r!==void 0?r:Hn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=G.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ne(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===G.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===G.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Cr.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Cr.splice(Cr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Vs(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?ne.AudioPlaybackStarted:ne.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?ne.AudioPlaybackFailed:ne.VideoPlaybackFailed,o):o.name==="AbortError"?Ce.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Ce.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ne.ElementAttached,e),e}detach(e){try{if(e){Qs(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(ne.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Qs(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(ne.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ki(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Cr.forEach(i=>{i.parentElement||(n=!1)}),n&&Cr.push(e)}}handleAppVisibilityChanged(){return I(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===G.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){hn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){hn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Vs(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!bs()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(bs()||ys())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Qs(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(d){switch(d){case e.Audio:return zn.AUDIO;case e.Video:return zn.VIDEO;default:return zn.DATA}}t.kindToProto=r;function o(d){switch(d){case zn.AUDIO:return e.Audio;case zn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function a(d){switch(d){case n.Camera:return Tt.CAMERA;case n.Microphone:return Tt.MICROPHONE;case n.ScreenShare:return Tt.SCREEN_SHARE;case n.ScreenShareAudio:return Tt.SCREEN_SHARE_AUDIO;default:return Tt.UNKNOWN}}t.sourceToProto=a;function l(d){switch(d){case Tt.CAMERA:return n.Camera;case Tt.MICROPHONE:return n.Microphone;case Tt.SCREEN_SHARE:return n.ScreenShare;case Tt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=l;function c(d){switch(d){case Qc.ACTIVE:return i.Active;case Qc.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(G||(G={}));const uN="|",Kf="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function hN(t){const e=t.split(uN);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function $t(t){return I(this,void 0,void 0,function*(){return new Promise(e=>Vt.setTimeout(e,t))})}function pd(){return"addTransceiver"in RTCPeerConnection.prototype}function fd(){return"addTrack"in RTCPeerConnection.prototype}function pN(){if(!("getCapabilities"in RTCRtpSender)||bs()||ys())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function fN(){if(!("getCapabilities"in RTCRtpSender)||ys())return!1;if(bs()){const n=fn();if(n?.version&&ri(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&ri(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Fn(t){return t==="av1"||t==="vp9"}function md(t){return!document||uo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function mN(){return typeof RTCPeerConnection>"u"?!1:pd()||fd()}function ys(){var t;return((t=fn())===null||t===void 0?void 0:t.name)==="Firefox"}function Jf(){const t=fn();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function bs(){var t;return((t=fn())===null||t===void 0?void 0:t.name)==="Safari"}function uo(){const t=fn();return t?.name==="Safari"||t?.os==="iOS"}function gN(){const t=fn();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&ri(t.osVersion,"17")>=0}function xN(t){return t||(t=fn()),t?.name==="Safari"&&ri(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&ri(t.osVersion,"18.3")>0}function Pb(){var t,e;return hn()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function yN(){const t=fn(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ri(t.osVersion,e)>=0?!0:t.name==="Safari"&&ri(t.version,e)>=0}function hn(){return typeof document<"u"}function si(){return navigator.product=="ReactNative"}function lr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Ql(t){return lr(t)?t.hostname.split(".")[0]:null}function Db(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Ob(){if(!si())return;let t=Db();if(t)return t.platform}function Yf(){if(hn())return window.devicePixelRatio;if(si()){let t=Db();if(t)return t.devicePixelRatio}return 1}function ri(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const a=parseInt(n[o],10),l=parseInt(i[o],10);if(a>l)return 1;if(a<l)return-1;if(o===r-1&&a===l)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function bN(t){for(const e of t)e.target.handleResize(e)}function vN(t){for(const e of t)e.target.handleVisibilityChanged(e)}let ec=null;const Xf=()=>(ec||(ec=new ResizeObserver(bN)),ec);let tc=null;const Zf=()=>(tc||(tc=new IntersectionObserver(vN,{root:null,rootMargin:"0px"})),tc);function SN(){var t;const e=new Oy({sdk:Ly.JS,protocol:Y_,version:J_});return si()&&(e.os=(t=Ob())!==null&&t!==void 0?t:""),e}function Qf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[l]=a.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=n,l}let jr;function nc(){if(!jr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[jr]=i.stream.getAudioTracks(),!jr)throw Error("Could not get empty media stream audio track");jr.enabled=!1}return jr.clone()}class Cn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>I(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function kN(t){return eN.includes(t)}function Wi(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function wN(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ho(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function CN(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:a,endTime:l,final:c}=n;var d;const u=(d=e.get(i))!==null&&d!==void 0?d:Date.now(),p=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(l.toString()),final:c,language:o,firstReceivedTime:u,lastReceivedTime:p}})}function jN(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function em(t){switch(t.reason){case ot.LeaveRequest:return t.context;case ot.Cancelled:return Un.CLIENT_INITIATED;case ot.NotAllowed:return Un.USER_REJECTED;case ot.ServerUnreachable:return Un.JOIN_FAILURE;default:return Un.UNKNOWN_REASON}}function pa(t){return t!==void 0?Number(t):void 0}function ss(t){return t!==void 0?BigInt(t):void 0}function er(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ei(t){return!!t&&t.kind==G.Kind.Audio}function Qi(t){return!!t&&t.kind==G.Kind.Video}function Ii(t){return er(t)&&Qi(t)}function hi(t){return er(t)&&ei(t)}function gd(t){return!!t&&!t.isLocal}function TN(t){return!!t&&!t.isLocal}function ic(t){return gd(t)&&Qi(t)}function EN(t){return t.isLocal}function RN(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function IN(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function _N(t,e){const n=new URL(wN(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),zb(n,"rtc")}function NN(t){const e=new URL(ho(t));return zb(e,"validate")}function Lb(t){return t.endsWith("/")?t:"".concat(t,"/")}function zb(t,e){return t.pathname="".concat(Lb(t.pathname)).concat(e),t.toString()}function tm(t){if(typeof t=="string")return Mf.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Mf.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function AN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const MN=10,Tr="lk_e2ee",PN="LKFrameEncryptionKey",DN={sharedKey:!1,ratchetSalt:PN,ratchetWindowSize:8,failureTolerance:MN,keyringSize:16};var Vi;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Vi||(Vi={}));var nm;(function(t){t.KeyRatcheted="keyRatcheted"})(nm||(nm={}));var Li;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Li||(Li={}));var im;(function(t){t.Error="cryptorError"})(im||(im={}));function ON(){return LN()||xd()}function xd(){return typeof window.RTCRtpScriptTransform<"u"}function LN(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function zN(t){var e,n,i,r,o;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=t.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new Iy({value:t.value})}class xD extends ai.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Ce.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},DN),e),this.on(Vi.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Vi.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Vi.RatchetRequest,e,n)}}var sm;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(sm||(sm={}));class BN extends ai.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,o;const{kind:a,data:l}=i.data;switch(a){case"error":if(Ce.error(l.error.message),l.uuid){const u=this.decryptDataRequests.get(l.uuid);if(u?.reject){u.reject(l.error);break}const p=this.encryptDataRequests.get(l.uuid);if(p?.reject){p.reject(l.error);break}}this.emit(Li.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Li.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const u=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(l.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit(Li.ParticipantEncryptionStatusChanged,l.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Vi.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(l.uuid);c?.resolve&&c.resolve(l);break;case"encryptDataResponse":const d=this.encryptDataRequests.get(l.uuid);d?.resolve&&d.resolve(l);break}},this.onWorkerError=i=>{Ce.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Li.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!ON())throw new Fu("tried to setup end-to-end encryption on an unsupported browser");if(Ce.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:M_.getLevel()}};this.worker&&(Ce.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ce.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ce.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(oe.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(Y.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==At.NONE,r.identity)),e.on(Y.ConnectionStateChanged,i=>{i===Ue.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==At.NONE,r.identity)})})}).on(Y.TrackUnsubscribed,(i,r,o)=>{var a;const l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(l)}).on(Y.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(Y.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ae.LocalSenderCreated,(i,r)=>I(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(ae.LocalTrackPublished,i=>{if(!Qi(i.track)||!uo())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Wr(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Vi.SetKey,i=>this.postKey(i)).on(Vi.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return I(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Cn;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:n,participantIdentity:i,keyIndex:r}},l=new Cn;return l.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,l),this.worker.postMessage(a),l.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Wr(i.mimeType):void 0)}}setupE2EESender(e,n){if(!er(e)||!n){n||Ce.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return I(this,void 0,void 0,function*(){if(this.worker){if(xd()&&!Jf()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Tr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,a=c.readable}const l={kind:"decode",data:{readableStream:a,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:Tr in e}};this.worker.postMessage(l,[a,o])}e[Tr]=!0}})}handleSender(e,n,i){var r;if(!(Tr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(xd()&&!Jf()){Ce.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Ce.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[o.readable,o.writable])}e[Tr]=!0}}}const FN=500,UN=15e3;class tr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new tr),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Ql(i);if(!r)return;let o=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,$t(Math.min(FN*Math.pow(2,o),UN)))}getBackOffPromise(e){const n=new URL(e),i=n&&Ql(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Ql(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}tr._instance=null;const sc="default";class Ot{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ot),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=Ot.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){Ce.debug("awaiting getUserMedia promise");try{n?yield Ot.userMediaPromiseMap.get(n):yield Promise.all(Ot.userMediaPromiseMap.values())}catch{Ce.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(r&&!(bs()&&i.hasDeviceInUse(n))&&(a.filter(c=>c.kind===n).length===0||a.some(c=>{const d=c.label==="",u=n?c.kind===n:!0;return d&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},d=yield navigator.mediaDevices.getUserMedia(c);a=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=a,n&&(a=a.filter(l=>l.kind===n)),a})()})}normalizeDeviceId(e,n,i){return I(this,void 0,void 0,function*(){if(n!==sc)return n;const r=yield this.getDevices(e),o=r.find(l=>l.deviceId===sc);if(!o){Ce.warn("could not reliably determine default device");return}const a=r.find(l=>l.deviceId!==sc&&l.groupId===(i??o.groupId));if(!a){Ce.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(e){return e?Ot.userMediaPromiseMap.has(e):Ot.userMediaPromiseMap.size>0}}Ot.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ot.userMediaPromiseMap=new Map;var Vr;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Vr||(Vr={}));class WN{constructor(){this.pendingTasks=new Map,this.taskMutex=new on,this.nextTaskIndex=0}run(e){return I(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Vr.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Vr.RUNNING,yield e()}finally{n.status=Vr.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return I(this,void 0,void 0,function*(){return this.run(()=>I(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class VN{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const a=function(){let{closeCode:l,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(l,c)};this.opened=new Promise((l,c)=>{o.onopen=()=>{l({readable:new ReadableStream({start(d){o.onmessage=u=>{let{data:p}=u;return d.enqueue(p)},o.onerror=u=>d.error(u)},cancel:a}),writable:new WritableStream({write(d){o.send(d)},abort(){o.close()},close:a}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",c)},o.addEventListener("error",c)}),this.closed=new Promise((l,c)=>{const d=()=>I(this,void 0,void 0,function*(){const u=new Promise(h=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",m=>{h(m)},{once:!0})}),p=yield Promise.race([$t(250),u]);p?l(p):c(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=u=>{let{code:p,reason:h}=u;l({closeCode:p,reason:h}),o.removeEventListener("error",d)},o.addEventListener("error",d)}),n.signal&&(n.signal.onabort=()=>o.close()),this.close=a}}const $N=["syncState","trickle","offer","answer","simulate","leave"];function GN(t){const e=$N.indexOf(t.case)>=0;return Ce.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var nt;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(nt||(nt={}));const HN=250;class Vu{get currentState(){return this.state}get isDisconnected(){return this.state===nt.DISCONNECTING||this.state===nt.DISCONNECTED}get isEstablishingConnection(){return this.state===nt.CONNECTING||this.state===nt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=nt.DISCONNECTED,this.log=Ce,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ki((i=n.loggerName)!==null&&i!==void 0?i:Hn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new WN,this.queuedRequests=[],this.closingLock=new on,this.connectionLock=new on,this.state=nt.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return I(this,void 0,void 0,function*(){return this.state=nt.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=nt.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return I(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=i;const a=SN(),l=i.singlePeerConnection?KN(n,a,i):qN(n,a,i),c=_N(e,l),d=NN(c);return new Promise((u,p)=>I(this,void 0,void 0,function*(){var h,m;try{let x=!1;const g=S=>I(this,void 0,void 0,function*(){if(x)return;x=!0;const b=S instanceof Event?S.currentTarget:S,j=AN(b,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(j)).catch(C=>{this.log.error(C),this.close()}):this.close(),y(),p(be.cancelled(j))});r?.addEventListener("abort",g);const y=()=>{clearTimeout(v),r?.removeEventListener("abort",g)},v=setTimeout(()=>{g(be.timeout("room connection has timed out (signal)"))},i.websocketTimeout),w=(S,b)=>{this.handleSignalConnected(S,v,b)},k=new URL(c);k.searchParams.has("access_token")&&k.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(k),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new VN(c);try{this.ws.closed.then(E=>{var N;this.isEstablishingConnection&&p(be.internal("Websocket got closed during a (re)connection attempt: ".concat(E.reason))),E.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:E.reason,code:E.closeCode,wasClean:E.closeCode===1e3,state:this.state})),this.state===nt.CONNECTED&&this.handleOnClose((N=E.reason)!==null&&N!==void 0?N:"Unexpected WS error"))}).catch(E=>{this.isEstablishingConnection&&p(be.internal("Websocket error during a (re)connection attempt: ".concat(E)))});const S=yield this.ws.opened.catch(E=>I(this,void 0,void 0,function*(){if(this.state!==nt.CONNECTED){this.state=nt.DISCONNECTED,clearTimeout(v);const N=yield this.handleConnectionError(E,d);p(N);return}this.handleWSError(E),p(E)}));if(clearTimeout(v),!S)return;const b=S.readable.getReader();this.streamWriter=S.writable.getWriter();const j=yield b.read();if(b.releaseLock(),!j.value)throw be.internal("no message received as first message");const C=tm(j.value),T=this.validateFirstMessage(C,(h=i.reconnect)!==null&&h!==void 0?h:!1);if(!T.isValid){p(T.error);return}((m=C.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=C.message.value.pingTimeout,this.pingIntervalDuration=C.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const _=T.shouldProcessFirstMessage?C:void 0;w(S,_),u(T.response)}catch(S){p(S)}finally{y()}}finally{o()}}))})}startReadingLoop(e,n){return I(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield $t(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const o=tm(r);this.handleSignalResponse(o)}})}close(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([nt.DISCONNECTING||nt.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=nt.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,$t(HN)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{n&&(e.state=nt.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:$s(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:$s(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new al({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ll({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Du({requestId:l,metadata:i,name:r,attributes:a})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new $y({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new qy({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:at.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Yy({timestamp:at.parse(Date.now()),rtt:at.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Pu({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new dl({reason:Un.CLIENT_INITIATED,action:Xs.DISCONNECT})})}sendRequest(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!GN(n)&&i.state===nt.RECONNECTING){i.queuedRequests.push(()=>I(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield $t(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const a=new s_({message:n});try{i.useJSON?yield i.streamWriter.write(a.toJsonString()):yield i.streamWriter.write(a.toBinary())}catch(l){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:l}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const a=rm(r.value);this.onAnswer&&this.onAnswer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const a=rm(r.value);this.onOffer&&this.onOffer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const a=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(a,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return I(this,void 0,void 0,function*(){if(this.state===nt.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Vt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Vt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Vt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Vt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=nt.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,o,a,l;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===nt.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=e.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:be.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:be.internal("Unexpected first message")}:{isValid:!1,error:be.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,n){return I(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return be.notAllowed(r,i.status)}else return e instanceof be?e:be.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof be?i:be.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function rm(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function $s(t,e){return new Ki({sdp:t.sdp,type:t.type,id:e})}function qN(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",si()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function KN(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new T_({clientInfo:e,connectionSettings:new Xy({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const o=new E_({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class om{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class JN{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Dn={},rc={},oc={exports:{}},am;function $u(){if(am)return oc.exports;am=1;var t=oc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),oc.exports}var lm;function YN(){return lm||(lm=1,(function(t){var e=function(l){return String(Number(l))===l?Number(l):l},n=function(l,c,d,u){if(u&&!d)c[u]=e(l[1]);else for(var p=0;p<d.length;p+=1)l[p+1]!=null&&(c[d[p]]=e(l[p+1]))},i=function(l,c,d){var u=l.name&&l.names;l.push&&!c[l.push]?c[l.push]=[]:u&&!c[l.name]&&(c[l.name]={});var p=l.push?{}:u?c[l.name]:c;n(d.match(l.reg),p,l.names,l.name),l.push&&c[l.push].push(p)},r=$u(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(l){var c={},d=[],u=c;return l.split(/(\r\n|\r|\n)/).filter(o).forEach(function(p){var h=p[0],m=p.slice(2);h==="m"&&(d.push({rtp:[],fmtp:[]}),u=d[d.length-1]);for(var x=0;x<(r[h]||[]).length;x+=1){var g=r[h][x];if(g.reg.test(m))return i(g,u,m)}}),c.media=d,c};var a=function(l,c){var d=c.split(/=(.+)/,2);return d.length===2?l[d[0]]=e(d[1]):d.length===1&&c.length>1&&(l[d[0]]=void 0),l};t.parseParams=function(l){return l.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(l){return l.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(l){for(var c=[],d=l.split(" ").map(e),u=0;u<d.length;u+=3)c.push({component:d[u],ip:d[u+1],port:d[u+2]});return c},t.parseImageAttributes=function(l){return l.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(l){return l.split(";").map(function(c){return c.split(",").map(function(d){var u,p=!1;return d[0]!=="~"?u=e(d):(u=e(d.substring(1,d.length)),p=!0),{scid:u,paused:p}})})}})(rc)),rc}var ac,cm;function XN(){if(cm)return ac;cm=1;var t=$u(),e=/%[sdv%]/g,n=function(a){var l=1,c=arguments,d=c.length;return a.replace(e,function(u){if(l>=d)return u;var p=c[l];switch(l+=1,u){case"%%":return"%";case"%s":return String(p);case"%d":return Number(p);case"%v":return""}})},i=function(a,l,c){var d=l.format instanceof Function?l.format(l.push?c:c[l.name]):l.format,u=[a+"="+d];if(l.names)for(var p=0;p<l.names.length;p+=1){var h=l.names[p];l.name?u.push(c[l.name][h]):u.push(c[l.names[p]])}else u.push(c[l.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ac=function(a,l){l=l||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(p){p.payloads==null&&(p.payloads="")});var c=l.outerOrder||r,d=l.innerOrder||o,u=[];return c.forEach(function(p){t[p].forEach(function(h){h.name in a&&a[h.name]!=null?u.push(i(p,h,a)):h.push in a&&a[h.push]!=null&&a[h.push].forEach(function(m){u.push(i(p,h,m))})})}),a.media.forEach(function(p){u.push(i("m",t.m[0],p)),d.forEach(function(h){t[h].forEach(function(m){m.name in p&&p[m.name]!=null?u.push(i(h,m,p)):m.push in p&&p[m.push]!=null&&p[m.push].forEach(function(x){u.push(i(h,m,x))})})})}),u.join(`\r
`)+`\r
`},ac}var dm;function ZN(){if(dm)return Dn;dm=1;var t=YN(),e=XN(),n=$u();return Dn.grammar=n,Dn.write=e,Dn.parse=t.parse,Dn.parseParams=t.parseParams,Dn.parseFmtpConfig=t.parseFmtpConfig,Dn.parsePayloads=t.parsePayloads,Dn.parseRemoteCandidates=t.parseRemoteCandidates,Dn.parseImageAttributes=t.parseImageAttributes,Dn.parseSimulcastStreamList=t.parseSimulcastStreamList,Dn}var Ai=ZN();function Gu(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var a=(i=n.isImmediate)!=null&&i,l=(r=n.callback)!=null&&r,c=n.maxWait,d=Date.now(),u=[];function p(){if(c!==void 0){var m=Date.now()-d;if(m+e>=c)return c-m}return e}var h=function(){var m=[].slice.call(arguments),x=this;return new Promise(function(g,y){var v=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,d=Date.now(),!a){var k=t.apply(x,m);l&&l(k),u.forEach(function(S){return(0,S.resolve)(k)}),u=[]}},p()),v){var w=t.apply(x,m);return l&&l(w),g(w)}u.push({resolve:g,reject:y})})};return h.cancel=function(m){o!==void 0&&clearTimeout(o),u.forEach(function(x){return(0,x.reject)(m)}),u=[]},h}const QN=.7,eA=20,nr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class um extends ai.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ce,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Gu(r=>I(this,void 0,void 0,function*(){this.emit(nr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),eA),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ki((i=n.loggerName)!==null&&i!==void 0?i:Hn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new on}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return I(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return I(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:a}=tA(e);this.remoteStereoMids=o,this.remoteNackMids=a}else if(e.type==="answer"){const o=Ai.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(a=>{const l=Hu(a.mid);a.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||l!=c.transceiver.mid)return!1;let d=0;if(a.rtp.some(p=>p.codec.toUpperCase()===c.codec.toUpperCase()?(d=p.payload,!0):!1),d===0)return!0;let u=!1;for(const p of a.fmtp)if(p.payload===d){p.config=p.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(p.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&a.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Ai.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(nr.NegotiationComplete),e.sdp&&Ai.parse(e.sdp).media.forEach(a=>{a.type==="video"&&this.emit(nr.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const a=Ai.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(l=>{pm(l),l.type==="audio"?hm(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(c=>{if(!l.msid||!c.cid||!l.msid.includes(c.cid))return!1;let d=0;if(l.rtp.some(p=>p.codec.toUpperCase()===c.codec.toUpperCase()?(d=p.payload,!0):!1),d===0||(Fn(c.codec)&&!bs()&&this.ensureVideoDDExtensionForSVC(l,a),!Fn(c.codec)))return!0;const u=Math.round(c.maxbr*QN);for(const p of l.fmtp)if(p.payload===d){p.config.includes("x-google-start-bitrate")||(p.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,Ai.write(a)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Ai.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{pm(r),r.type==="audio"&&hm(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Ai.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Nt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Nt("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return I(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":n=l.selectedCandidatePairId;break;case"candidate-pair":n===""&&l.selected&&(n=l.id),i.set(l.id,l);break;case"remote-candidate":r.set(l.id,"".concat(l.address,":").concat(l.port));break}}),n==="")return;const a=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}setMungedSDP(e,n,i){return I(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const a={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new ld(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(a=>a.uri===Kf))){if(this.ddExtID===0){let a=0;n.media.forEach(l=>{var c;l.type==="video"&&((c=l.ext)===null||c===void 0||c.forEach(d=>{d.value>a&&(a=d.value)}))}),this.ddExtID=a+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Kf})}}}function hm(t,e,n){const i=Hu(t.mid);let r=0;t.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function tA(t){var e;const n=[],i=[],r=Ai.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(a=>{var l;const c=Hu(a.mid);a.type==="audio"&&(a.rtp.some(d=>d.codec==="opus"?(o=d.payload,!0):!1),!((l=a.rtcpFb)===null||l===void 0)&&l.some(d=>d.payload===o&&d.type==="nack")&&i.push(c),a.fmtp.some(d=>d.payload===o?(d.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function pm(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Hu(t){return typeof t=="number"?t.toFixed(0):t}const yd="vp8",nA={audioPreset:cd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Uu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:yd,backupCodec:!0,preConnectBuffer:!1},Bb={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Fb={deviceId:{ideal:"default"},resolution:co.h720.resolution},iA={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new D_,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},qu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var yt;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(yt||(yt={}));class sA{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=qu.peerConnectionTimeout,this.log=Ce,this.updateState=()=>{var o,a;const l=this.state,c=this.requiredTransports.map(d=>d.getConnectionState());c.every(d=>d==="connected")?this.state=yt.CONNECTED:c.some(d=>d==="failed")?this.state=yt.FAILED:c.some(d=>d==="connecting")?this.state=yt.CONNECTING:c.every(d=>d==="closed")?this.state=yt.CLOSED:c.some(d=>d==="closed")?this.state=yt.CLOSING:c.every(d=>d==="new")&&(this.state=yt.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(yt[l]," to ").concat(yt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=ki((r=i.loggerName)!==null&&r!==void 0?r:Hn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new um(e,i),n!=="publisher-only"&&(this.subscriber=new um(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Bn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,o)},this.subscriber.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Bn.PUBLISHER)},this.publisher.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)},this.publisher.onOffer=(o,a)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,o,a)},this.state=yt.NEW,this.connectionLock=new on,this.remoteOfferLock=new on}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return I(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return I(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return I(this,void 0,void 0,function*(){var i;n===Bn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return I(this,void 0,void 0,function*(){var i,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return I(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return I(this,void 0,void 0,function*(){return new Promise((n,i)=>I(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(nr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(nr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(a=>{clearTimeout(r),i(a)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Bn.PUBLISHER?this.publisher.getConnectedAddress():e===Bn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((c,d)=>I(o,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Vt.clearTimeout(p),d(be.cancelled("room connection has been cancelled"))};r?.signal.aborted&&u(),r?.signal.addEventListener("abort",u);const p=Vt.setTimeout(()=>{r?.signal.removeEventListener("abort",u),d(be.internal("could not establish pc connection"))},a);for(;this.state!==yt.CONNECTED;)if(yield $t(50),r?.signal.aborted){d(be.cancelled("room connection has been cancelled"));return}Vt.clearTimeout(p),r?.signal.removeEventListener("abort",u),c()}))})()})}}const Ub=5e3,rA=3e4;class Be{static fetchRegionSettings(e,n,i){return I(this,void 0,void 0,function*(){const r=yield Be.fetchLock.lock();try{const o=yield fetch("".concat(oA(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(o.ok){const a=IN(o.headers),l=a?a*1e3:Ub;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw o.status===401?be.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):be.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof be?o:i?.aborted?be.cancelled("Region fetching was aborted"):be.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,n,i){return I(this,void 0,void 0,function*(){const r=Be.settingsTimeouts.get(e.hostname);clearTimeout(r),Be.settingsTimeouts.set(e.hostname,setTimeout(()=>I(this,void 0,void 0,function*(){try{const o=yield Be.fetchRegionSettings(e,n);Be.updateCachedRegionSettings(e,n,o)}catch(o){if(o instanceof be&&o.reason===ot.NotAllowed){Ce.debug("token is not valid, cancelling auto region refresh");return}Ce.debug("auto refetching of region settings failed",{error:o}),Be.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Be.cache.set(e.hostname,i),Be.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Be.settingsTimeouts.get(e);n&&(clearTimeout(n),Be.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Be.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Be.connectionTrackers.get(e);i&&i.connectionCount===0&&(Ce.debug("stopping region refetch after disconnect delay",{hostname:e}),Be.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},rA))}static cancelCleanup(e){const n=Be.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Be.connectionTrackers.get(e);n||(n={connectionCount:0},Be.connectionTrackers.set(e,n)),n.connectionCount++,Be.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Be.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Be.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return lr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return I(this,void 0,void 0,function*(){return Be.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return I(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Be.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Be.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Ce.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Be.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Be.cache=new Map;Be.settingsTimeouts=new Map;Be.connectionTrackers=new Map;Be.fetchLock=new on;function oA(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class vt extends Error{constructor(e,n,i){super(n),this.code=e,this.message=fm(n,vt.MAX_MESSAGE_BYTES),this.data=i?fm(i,vt.MAX_DATA_BYTES):void 0}static fromProto(e){return new vt(e.code,e.message,e.data)}toProto(){return new Ay({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new vt(vt.ErrorCode[e],vt.ErrorMessage[e],n)}}vt.MAX_MESSAGE_BYTES=256;vt.MAX_DATA_BYTES=15360;vt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};vt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Wb=15360;function Ku(t){return new TextEncoder().encode(t).length}function fm(t,e){if(Ku(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const Ju=2e3;function hl(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Yu=typeof MediaRecorder<"u";class aA{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const lA=Yu?MediaRecorder:aA;class cA extends lA{constructor(e,n){if(!Yu)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,a=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r?.close(),r=void 0},l=c=>{r?.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=d=>I(this,void 0,void 0,function*(){let u;if(d.data.arrayBuffer){const p=yield d.data.arrayBuffer();u=new Uint8Array(p)}else if(d.data.byteArray)u=d.data.byteArray;else throw new Error("no data available!");o()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",l)}}function dA(){return Yu}const uA=1e3,hA=1e4;class Vb extends G{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Gu(()=>I(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>I(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ne.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new on,this.pauseUpstreamLock=new on,this.trackChangeLock=new on,this.trackChangeLock.lock().then(a=>I(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{a()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==G.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return I(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{Qs(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Vs(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Vs(r??e,o)}))})}waitForDimensions(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:uA;return(function*(){var i;if(e.kind===G.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=fn())===null||i===void 0?void 0:i.os)==="iOS"&&(yield $t(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield $t(50)}throw new yi("unable to get track dimensions after timeout")})()})}setDeviceId(e){return I(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Wi(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Wi(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===G.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===G.Kind.Audio?"audioinput":"videoinput";return n?Ot.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return I(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new yi("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return I(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=O_(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===G.Kind.Video?a.video=i||r?{deviceId:i,facingMode:r}:!0:a.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(d=>{Qs(this.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===G.Kind.Video&&(yield c.applyConstraints(o)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(ne.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ne.Muted:ne.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Pb()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ne.UpstreamPaused,this);const i=fn();if(i?.name==="Safari"&&ri(i.version,"12.0")<0)throw new Fu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ne.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const a=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const l=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:l,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Vs(i._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>{d instanceof DOMException&&d.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:d})),setTimeout(()=>{l.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:d}))}),i.processor=n,i.processorElement=l,i.processor.processedTrack){for(const d of i.attachedElements)d!==i.processorElement&&r&&(Qs(i._mediaStreamTrack,d),Vs(i.processor.processedTrack,d));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(ne.TrackProcessorUpdate,i.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ne.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!dA()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new cA(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},hA)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Da extends Vb{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,G.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}a&&this.prevStats&&(this._currentBitrate=hl(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ne.AudioTrackFeatureUpdate,this,Dt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ne.AudioTrackFeatureUpdate,this,Dt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Wi(this._constraints.deviceId);return this.source===G.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return I(this,void 0,void 0,function*(){let n;if(e){const i=Wu({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return I(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){hn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ju)))}setProcessor(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!si()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ne.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return I(this,void 0,void 0,function*(){const e=yield Nb(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ne.AudioSilenceDetected)),e})}}function pA(t,e,n){switch(t.kind){case"audio":return new Da(t,e,!1,void 0,n);case"video":return new Oa(t,e,!1,n);default:throw new yi("unsupported track type: ".concat(t.kind))}}const fA=Object.values(co),mA=Object.values(dd),gA=Object.values(Uu),xA=[co.h180,co.h360],yA=[dd.h180,dd.h360],bA=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Xe(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),bd=["q","h","f"];function vd(t,e,n,i){var r,o;let a=i?.videoEncoding;t&&(a=i?.screenShareEncoding);const l=i?.simulcast,c=i?.scalabilityMode,d=i?.videoCodec;if(!a&&!l&&!c||!e||!n)return[{}];a||(a=SA(t,e,n,d),Ce.debug("using video encoding",a));const u=a.maxFramerate,p=new Xe(e,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&Fn(d)){const x=new $b(c),g=[];if(x.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const y=fn();if(uo()||si()||y?.name==="Chrome"&&ri(y?.version,"113")<0){const v=x.suffix=="h"?2:3,w=xN(y);for(let k=0;k<x.spatial;k+=1)g.push({rid:bd[2-k],maxBitrate:a.maxBitrate/Math.pow(v,k),maxFramerate:p.encoding.maxFramerate,scaleResolutionDownBy:w?Math.pow(2,k):void 0});g[0].scalabilityMode=c}else g.push({maxBitrate:a.maxBitrate,maxFramerate:p.encoding.maxFramerate,scalabilityMode:c});return p.encoding.priority&&(g[0].priority=p.encoding.priority,g[0].networkPriority=p.encoding.priority),Ce.debug("using svc encoding",{encodings:g}),g}if(!l)return[a];let h=[];t?h=(r=gm(i?.screenShareSimulcastLayers))!==null&&r!==void 0?r:mm(t,p):h=(o=gm(i?.videoSimulcastLayers))!==null&&o!==void 0?o:mm(t,p);let m;if(h.length>0){const x=h[0];h.length>1&&([,m]=h);const g=Math.max(e,n);if(g>=960&&m)return lc(e,n,[x,m,p],u);if(g>=480)return lc(e,n,[x,p],u)}return lc(e,n,[p])}function vA(t,e,n){var i,r,o,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ce.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const l=t.mediaStreamTrack.getSettings(),c=(i=l.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,d=(o=l.height)!==null&&o!==void 0?o:(a=t.dimensions)===null||a===void 0?void 0:a.height;return t.source===G.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),vd(t.source===G.Source.ScreenShare,c,d,n)}function SA(t,e,n,i){const r=kA(t,e,n);let{encoding:o}=r[0];const a=Math.max(e,n);for(let l=0;l<r.length;l+=1){const c=r[l];if(o=c.encoding,c.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function kA(t,e,n){if(t)return gA;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?fA:mA}function mm(t,e){if(t)return bA(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?xA:yA}function lc(t,e,n,i){const r=[];if(n.forEach((o,a)=>{if(a>=bd.length)return;const l=Math.min(t,e),d={rid:bd[a],scaleResolutionDownBy:Math.max(1,l/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},u=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;u&&(d.maxFramerate=u);const p=ys()||a===0;o.encoding.priority&&p&&(d.priority=o.encoding.priority,d.networkPriority=o.encoding.priority),r.push(d)}),si()&&Ob()==="ios"){let o;r.forEach(l=>{o?l.maxFramerate&&l.maxFramerate>o&&(o=l.maxFramerate):o=l.maxFramerate});let a=!0;r.forEach(l=>{var c;l.maxFramerate!=o&&(a&&(a=!1,Ce.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ce.info('Setting framerate of encoding "'.concat((c=l.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),l.maxFramerate=o)})}return r}function gm(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class $b{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function wA(t){return t.source===G.Source.ScreenShare||t.constraints.height&&Wi(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const CA=5e3;class Oa extends Vb{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,G.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const a=new Map(o.map(c=>[c.rid,c])),l=o.some(c=>c.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(ne.CpuConstrained)),this.prevStats){let c=0;a.forEach((d,u)=>{var p;const h=(p=this.prevStats)===null||p===void 0?void 0:p.get(u);c+=hl(d,h)}),this._currentBitrate=c}this.prevStats=a}),this.senderLock=new on}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!hn())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ju))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.pauseUpstream.call(this);try{for(var l=!0,c=xi(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0)o=d.value,l=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.resumeUpstream.call(this);try{for(var l=!0,c=xi(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0){o=d.value,l=!1;const u=o;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===G.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},l=i.get(r.remoteId);l&&(a.jitter=l.jitter,a.packetsLost=l.packetsLost,a.roundTripTime=l.roundTripTime),n.push(a)}}),n.sort((r,o)=>{var a,l;return((a=o.frameWidth)!==null&&a!==void 0?a:0)-((l=r.frameWidth)!==null&&l!==void 0?l:0)}),n})}setPublishingQuality(e){const n=[];for(let i=xn.LOW;i<=xn.HIGH;i+=1)n.push(new Ou({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Fn(this.codec),n)}restartTrack(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a;let l;if(e){const p=Wu({video:e});typeof p.video!="boolean"&&(l=p.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var c=!0,d=xi(this.simulcastCodecs.values()),u;u=yield d.next(),n=u.done,!n;c=!0){o=u.value,c=!1;const p=o;p.sender&&((a=p.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(p.mediaStreamTrack=this.mediaStreamTrack.clone(),yield p.sender.replaceTrack(p.mediaStreamTrack))}}catch(p){i={error:p}}finally{try{!c&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return I(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,l,c,d,u,p;if(yield n.setProcessor.call(r,i,o),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,m=xi(r.simulcastCodecs.values()),x;x=yield m.next(),a=x.done,!a;h=!0)d=x.value,h=!1,yield(p=d.sender)===null||p===void 0?void 0:p.replaceTrack(r.processor.processedTrack)}catch(g){l={error:g}}finally{try{!h&&!a&&(c=m.return)&&(yield c.call(m))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return I(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},CA))}setPublishingCodecs(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a,l,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Fn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const d=[];try{for(n=!0,i=xi(e);r=yield i.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Fn(u.codec),u.qualities);else{const p=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:p})),!p||!p.sender){for(const h of u.qualities)if(h.enabled){d.push(u.codec);break}}else p.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield xm(p.sender,p.encodings,u.qualities,this.senderLock,Fn(u.codec),this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!n&&!o&&(l=i.return)&&(yield l.call(i))}finally{if(a)throw a.error}}return d})}setPublishingLayers(e,n){return I(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield xm(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return I(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&Fn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Pb()&&this.isInBackground&&this.source===G.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function xm(t,e,n,i,r,o,a){return I(this,void 0,void 0,function*(){const l=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:d}=c;if(!d)return;if(d.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:d,senderEncodings:e}));return}let u=!1;!1&&d[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),d.forEach((h,m)=>{var x;let g=(x=h.rid)!==null&&x!==void 0?x:"";g===""&&(g="q");const y=Gb(g),v=n.find(w=>w.quality===y);v&&h.active!==v.enabled&&(u=!0,h.active=v.enabled,o.debug("setting layer ".concat(v.quality," to ").concat(h.active?"enabled":"disabled"),a),ys()&&(v.enabled?(h.scaleResolutionDownBy=e[m].scaleResolutionDownBy,h.maxBitrate=e[m].maxBitrate,h.maxFrameRate=e[m].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=d,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:c.encodings})),yield t.setParameters(c))}finally{l()}})}function Gb(t){switch(t){case"f":return xn.HIGH;case"h":return xn.MEDIUM;case"q":return xn.LOW;default:return xn.HIGH}}function ym(t,e,n,i){if(!n)return[new Ui({quality:xn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new $b(r),a=[],l=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let d=0;d<o.spatial;d+=1)a.push(new Ui({quality:Math.min(xn.HIGH,o.spatial-1)-d,width:Math.ceil(t/Math.pow(l,d)),height:Math.ceil(e/Math.pow(l,d)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,d)):0,ssrc:0}));return a}return n.map(r=>{var o,a,l;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let d=Gb((a=r.rid)!==null&&a!==void 0?a:"");return new Ui({quality:d,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(l=r.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const bm="_lossy",vm="_reliable",jA=2*1e3,cc="leave-reconnect",TA=3e4,EA=8*1024,RA=256*1024;var Sn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Sn||(Sn={}));class IA extends ai.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=qu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Sn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ce,this.reliableDataSequence=1,this.reliableMessageBuffer=new om,this.reliableReceivedState=new JN(TA),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>I(this,[i],void 0,function(r){var o=this;let{channel:a}=r;return(function*(){if(a){if(a.label===vm)o.reliableDCSub=a;else if(a.label===bm)o.lossyDCSub=a;else return;o.log.debug("on data channel ".concat(a.id,", ").concat(a.label),o.logContext),a.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>I(this,void 0,void 0,function*(){var r,o,a,l,c;const d=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const p=nn.fromBinary(new Uint8Array(u));if(p.sequence>0&&p.participantSid!==""){const h=this.reliableReceivedState.get(p.participantSid);if(h&&p.sequence<=h)return;this.reliableReceivedState.set(p.participantSid,p.sequence)}if(((r=p.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(oe.ActiveSpeakersUpdate,p.value.value.speakers);else if(((o=p.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(p.value.value.encryptedValue,p.value.value.iv,p.participantIdentity,p.value.value.keyIndex),m=Iy.fromBinary(h.payload),x=new nn({value:m.value,participantIdentity:p.participantIdentity,participantSid:p.participantSid});((l=x.value)===null||l===void 0?void 0:l.case)==="user"&&Sm(x,x.value.value),this.emit(oe.DataPacketReceived,x,p.value.value.encryptionType)}else((c=p.value)===null||c===void 0?void 0:c.case)==="user"&&Sm(p,p.value.value),this.emit(oe.DataPacketReceived,p,At.NONE)}finally{d()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?_e.LOSSY:_e.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(oe.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(l===null){o(a);return}i===cc&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Vt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Sn.Connected&&i();const o=()=>{this.off(oe.Disconnected,a),i()},a=()=>{this.off(oe.Restarted,o),r()};this.once(oe.Restarted,o),this.once(oe.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{if(i===_e.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(oe.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>I(this,void 0,void 0,function*(){!this.url||!(yield fetch(ho(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===nt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===nt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(is.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>I(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ho(this.url),{method:"HEAD"}),$t(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ki((n=e.loggerName)!==null&&n!==void 0?n:Hn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Vu(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new on,this.dataProcessLock=new on,this.dcBufferStatus=new Map([[_e.LOSSY,!0],[_e.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(oe.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(oe.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(oe.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(oe.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(oe.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(oe.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(oe.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(oe.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,a;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(e,n,i,r){return I(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate().catch(a=>{Ce.error(a,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(oe.SignalConnected,o),o}catch(o){if(o instanceof be&&o.reason===ot.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return I(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(oe.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return I(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new om,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return I(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new yi("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(be.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return I(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return I(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==yt.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new sA(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(oe.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>I(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===yt.CONNECTED){const u=this.pcState===Sn.New;this.pcState=Sn.Connected,u&&this.emit(oe.Connected,e)}else o===yt.FAILED&&(this.pcState===Sn.Connected||this.pcState===Sn.Reconnecting)&&(this.pcState=Sn.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?is.RR_SUBSCRIBER_FAILED:is.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===nt.RECONNECTING,d=[yt.FAILED,yt.CLOSING,yt.CLOSED].includes(o);c&&d&&!this._isClosed&&this.emit(oe.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(oe.MediaTrackAdded,o.track,o.streams[0],o.receiver)},_A((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>I(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>I(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(oe.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(oe.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(oe.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(oe.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(oe.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",is.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Ub,regionSettings:e.regions})),e.action){case Xs.DISCONNECT:this.emit(oe.Disconnected,e?.reason),this.close();break;case Xs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(cc);break;case Xs.RESUME:this.handleDisconnect(cc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),r.push(a)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===oo.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(bm,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(vm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(_e.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,EA),RA)}},1e3))}createSender(e,n,i){return I(this,void 0,void 0,function*(){if(pd())return yield this.createTransceiverRTCRtpSender(e,n,i);if(fd())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Nt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(pd())return this.createSimulcastTransceiverSender(e,n,i,r);if(fd())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Nt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Qi(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nt("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return I(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Ce.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===oo.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:yt.NEW)===yt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof Nt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof Ds||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",is.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(oe.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return I(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Nt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(oe.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ds;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof be&&a.reason===ot.NotAllowed?new Nt("could not reconnect, token might be expired"):new Ds}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(oe.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new Ds("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(oe.Restarted)}catch(o){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return I(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Nt("could not reconnect, url or token not saved");if(!this.pcManager)throw new Nt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(oe.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof be&&r.reason===ot.NotAllowed?new Nt("could not reconnect, token might be expired"):r instanceof be&&r.reason===ot.LeaveRequest?r:new Ds(o)}if(this.emit(oe.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new Ds("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(oe.Resumed)})}waitForPCInitialConnection(e,n){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new Nt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return I(this,void 0,void 0,function*(){this.pcState=Sn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield $t(jA),!this.pcManager)throw new Nt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Sn.Connected}catch(e){throw this.pcState=Sn.Disconnected,be.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return I(this,void 0,void 0,function*(){const o=new nn({destinationIdentities:[e],kind:_e.RELIABLE,value:{case:"rpcResponse",value:new Au({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,_e.RELIABLE)})}publishRpcAck(e,n){return I(this,void 0,void 0,function*(){const i=new nn({destinationIdentities:[e],kind:_e.RELIABLE,value:{case:"rpcAck",value:new Nu({requestId:n})}});yield this.sendDataPacket(i,_e.RELIABLE)})}sendDataPacket(e,n){return I(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=zN(e);if(o){const a=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Ry({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===_e.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===_e.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return I(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(_e.RELIABLE);const n=this.dataChannelForKind(_e.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(_e.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>I(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(oe.Closing,r);!this.dcBufferStatus.get(e);)yield $t(10);this.off(oe.Closing,r),n()}}))}ensureDataTransportConnected(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new Nt("PC manager is closed");const a=r?i.pcManager.subscriber:i.pcManager.publisher,l=r?"Subscriber":"Publisher";if(!a)throw be.internal("".concat(l," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(p=>{Ce.error(p,i.logContext)});const d=i.dataChannelForKind(n,r);if(d?.readyState==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(a.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield $t(50)}throw be.internal("could not establish ".concat(l," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(e){return I(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==yt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return I(this,void 0,void 0,function*(){return new Promise((e,n)=>I(this,void 0,void 0,function*(){if(!this.pcManager){n(new ld("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(oe.Closing,r),this.pcManager.publisher.once(nr.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(l=>{const c=l.codec.toLowerCase();kN(c)&&a.set(l.payload,c)}),this.emit(oe.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof ld&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",is.RR_UNKNOWN),n(o)}finally{this.off(oe.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===_e.LOSSY)return this.lossyDCSub;if(e===_e.RELIABLE)return this.reliableDCSub}else{if(e===_e.LOSSY)return this.lossyDC;if(e===_e.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,o,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),d=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),p=(a=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&a!==void 0?a:!0,h=new Array,m=new Array;e.forEach(x=>{x.isDesired!==p&&h.push(x.trackSid),x.isEnabled||m.push(x.trackSid)}),this.client.sendSyncState(new Lu({answer:this.options.singlePeerConnection?c?$s({sdp:c.sdp,type:c.type}):void 0:u?$s({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?l?$s({sdp:l.sdp,type:l.type}):void 0:d?$s({sdp:d.sdp,type:d.type}):void 0,subscription:new cl({trackSids:h,subscribe:!p,participantTracks:[]}),publishTracks:rN(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((x,g)=>new Ky({publisherSid:g,lastSeq:x}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{i?.id!==void 0&&i.id!==null&&e.push(new Jy({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(_e.LOSSY),Bn.PUBLISHER),n(this.dataChannelForKind(_e.RELIABLE),Bn.PUBLISHER),n(this.dataChannelForKind(_e.LOSSY,!0),Bn.SUBSCRIBER),n(this.dataChannelForKind(_e.RELIABLE,!0),Bn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Vt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){hn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){hn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(o=>{let[a]=o;return a===i});if(r)return r[1]}}}function _A(t){return t!==void 0&&t>13}function Sm(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Hb{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new kn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),tn.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new kn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),tn.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class NA extends Hb{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Cn,i=null,r=null;if(this.signal){const a=this.signal;r=()=>{var l;(l=n.reject)===null||l===void 0||l.call(n,a.reason)},a.addEventListener("abort",r),i=a}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:d}=yield Promise.race([e.read(),n.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(d),{done:!1,value:d.content})}catch(c){throw o(),c}}),return(){return I(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=xi(c),p;p=yield u.next(),i=p.done,!i;d=!0){a=p.value,d=!1;const h=a;l.add(h)}}catch(h){r={error:h}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return Array.from(l)})()})}}class AA extends Hb{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=pa(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Cn,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,l.reason)},l.addEventListener("abort",o),r=l}const a=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var l,c;try{const{done:d,value:u}=yield Promise.race([e.read(),i.promise,(c=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(d)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let p;try{p=n.decode(u.content)}catch(h){throw new kn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),tn.DecodeFailed)}return{done:!1,value:p}}}catch(d){throw a(),d}}),return(){return I(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=xi(c),p;p=yield u.next(),i=p.done,!i;d=!0)a=p.value,d=!1,l+=a}catch(h){r={error:h}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return l})()})}}class MA{constructor(){this.log=Ce,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new kn('A text stream handler for topic "'.concat(e,'" has already been set.'),tn.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new kn('A byte stream handler for topic "'.concat(e,'" has already been set.'),tn.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,o;const a=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(a.length>0||l.length>0){const c=new kn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),tn.AbnormalEnd);for(const[d,u]of l)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(d);for(const[d,u]of a)(o=(r=u.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,c),this.textStreamControllers.delete(d)}}handleDataStreamPacket(e,n){return I(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return I(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const l=new Cn;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:pa(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new kn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),tn.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new NA(c,d,pa(e.totalLength),l),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const l=new Cn;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new kn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),tn.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new AA(c,d,pa(e.totalLength),l),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new kn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),tn.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new kn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),tn.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new kn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),tn.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new kn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),tn.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class qb{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return I(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class PA extends qb{}class DA extends qb{}const km=15e3;class OA{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return I(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,l=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(l?l.length+1:1).fill(0),d=(p,h)=>{var m;c[h]=p;const x=c.reduce((g,y)=>g+y,0);(m=n?.onProgress)===null||m===void 0||m.call(n,x)},u=yield this.streamText({streamId:r,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:l,attributes:n?.attributes});return yield u.write(e),d(1,0),yield u.close(),n?.attachments&&l&&(yield Promise.all(n.attachments.map((p,h)=>I(this,void 0,void 0,function*(){return this._sendFile(l[h],p,{topic:n.topic,mimeType:p.type,onProgress:m=>{d(m,h+1)}})})))),u.info})}streamText(e){return I(this,void 0,void 0,function*(){var n,i,r;const o=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?At.GCM:At.NONE},l=new Na({streamId:o,mimeType:a.mimeType,topic:a.topic,timestamp:ss(a.timestamp),totalLength:ss(e?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new Fy({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Zc.UPDATE:Zc.CREATE})}}),c=e?.destinationIdentities,d=new nn({destinationIdentities:c,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,_e.RELIABLE);let u=0;const p=this.engine,h=new WritableStream({write(g){return I(this,void 0,void 0,function*(){for(const y of RN(g,km)){const v=new Aa({content:y,streamId:o,chunkIndex:ss(u)}),w=new nn({destinationIdentities:c,value:{case:"streamChunk",value:v}});yield p.sendDataPacket(w,_e.RELIABLE),u+=1}})},close(){return I(this,void 0,void 0,function*(){const g=new Ma({streamId:o}),y=new nn({destinationIdentities:c,value:{case:"streamTrailer",value:g}});yield p.sendDataPacket(y,_e.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let m=()=>I(this,void 0,void 0,function*(){yield x.close()});p.once(oe.Closing,m);const x=new PA(h,a,()=>this.engine.off(oe.Closing,m));return x})}sendFile(e,n){return I(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return I(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i?.mimeType)!==null&&r!==void 0?r:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:l,value:c}=yield a.read();if(l)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a,l;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),d=e?.destinationIdentities,u={id:c,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?At.GCM:At.NONE},p=new Na({totalLength:ss((l=u.size)!==null&&l!==void 0?l:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:ss(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new Uy({name:u.name})}}),h=new nn({destinationIdentities:d,value:{case:"streamHeader",value:p}});yield this.engine.sendDataPacket(h,_e.RELIABLE);let m=0;const x=new on,g=this.engine,y=this.log,v=new WritableStream({write(k){return I(this,void 0,void 0,function*(){const S=yield x.lock();let b=0;try{for(;b<k.byteLength;){const j=k.slice(b,b+km),C=new nn({destinationIdentities:d,value:{case:"streamChunk",value:new Aa({content:j,streamId:c,chunkIndex:ss(m)})}});yield g.sendDataPacket(C,_e.RELIABLE),m+=1,b+=j.byteLength}}finally{S()}})},close(){return I(this,void 0,void 0,function*(){const k=new Ma({streamId:c}),S=new nn({destinationIdentities:d,value:{case:"streamTrailer",value:k}});yield g.sendDataPacket(S,_e.RELIABLE)})},abort(k){y.error("Sink error:",k)}});return new DA(v,u)})}}class Kb extends G{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ne.Muted:ne.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ne.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Ju)),oN()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(ne.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class LA extends Kb{constructor(e,n,i,r,o,a){super(e,n,G.Kind.Audio,i,a),this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=hl(l,this.prevStats)),this.prevStats=l}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;si()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(si())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return I(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(md(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&md(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ne.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(ne.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const dc=100;class zA extends Kb{constructor(e,n,i,r,o){super(e,n,G.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=hl(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=Gu(()=>{this.updateDimensions()},dc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===G.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Qs(this._mediaStreamTrack,n):Vs(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new BA(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,d)=>Math.max(c,d.visibilityChangedAt||0),0),o=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,a=this.elementInfos.some(c=>c.pictureInPicture),l=this.elementInfos.some(c=>c.visible)&&!o||a;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-r<dc){Vt.setTimeout(()=>{this.updateVisibility()},dc);return}this.lastVisible=l,this.emit(ne.VisibilityChanged,l,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const l=a.width()*o,c=a.height()*o;l+c>i+r&&(i=l,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(ne.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Yf():n||(Yf()>2?2:1)}}class BA{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:a}=i;o===this.element&&(this.isIntersecting=a,this.isPiP=Er(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Er(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Er(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Sd(e),this.isPiP=hn()&&Er(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Sd(this.element),this.isPiP=Er(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Zf().observe(this.element),Xf().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=Zf())===null||e===void 0||e.unobserve(this.element),(n=Xf())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Er(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Sd(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Sd(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,a=t.offsetHeight,{hidden:l}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!l&&c!=="none"}class pi extends ai.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=At.NONE,this.log=Ce,this.handleMuted=()=>{this.emit(ne.Muted)},this.handleUnmuted=()=>{this.emit(ne.Unmuted)},this.log=ki((o=r?.loggerName)!==null&&o!==void 0?o:Hn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=G.Source.Unknown}setTrack(e){this.track&&(this.track.off(ne.Muted,this.handleMuted),this.track.off(ne.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ne.Muted,this.handleMuted),e.on(ne.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ne(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==At.NONE}get audioTrack(){if(ei(this.track))return this.track}get videoTrack(){if(Qi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=G.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===G.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(pi||(pi={}));class kd extends pi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ne.Ended)},this.handleCpuConstrained=()=>{this.track&&Qi(this.track)&&this.emit(ne.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(ne.Ended,this.handleTrackEnded),this.track.off(ne.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ne.Ended,this.handleTrackEnded),e.on(ne.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ei(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Dt.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Dt.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Dt.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Dt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Dt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Dt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function pl(t,e){return I(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=Mb(t);let a=o.audio,l=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const p=o.audio.deviceId;o.audio.deviceId={exact:p},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:p}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const p=o.video.deviceId;o.video.deviceId={exact:p},n=!0,l=Object.assign(Object.assign({},o.video),{deviceId:{ideal:p}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=_b(o,Bb,Fb),d=Wu(c),u=navigator.mediaDevices.getUserMedia(d);o.audio&&(Ot.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Ot.userMediaPromiseMap.delete("audioinput"))),o.video&&(Ot.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Ot.userMediaPromiseMap.delete("videoinput")));try{const p=yield u;return yield Promise.all(p.getTracks().map(h=>I(this,void 0,void 0,function*(){const m=h.kind==="audio";let x=m?c.audio:c.video;(typeof x=="boolean"||!x)&&(x={});let g;const y=m?d.audio:d.video;typeof y!="boolean"&&(g=y);const v=h.getSettings().deviceId;g?.deviceId&&Wi(g.deviceId)!==v?g.deviceId=v:g||(g={deviceId:v});const w=pA(h,g,e);return w.kind===G.Kind.Video?w.source=G.Source.Camera:w.kind===G.Kind.Audio&&(w.source=G.Source.Microphone),w.mediaStream=p,ei(w)&&i?yield w.setProcessor(i):Qi(w)&&r&&(yield w.setProcessor(r)),w})))}catch(p){if(!n)throw p;return pl(Object.assign(Object.assign({},t),{audio:a,video:l}),e)}})}function FA(t){return I(this,void 0,void 0,function*(){return(yield pl({audio:!1,video:!0}))[0]})}function Jb(t){return I(this,void 0,void 0,function*(){return(yield pl({audio:t??!0,video:!1}))[0]})}var Di;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Di||(Di={}));function UA(t){switch(t){case Nr.EXCELLENT:return Di.Excellent;case Nr.GOOD:return Di.Good;case Nr.POOR:return Di.Poor;case Nr.LOST:return Di.Lost;default:return Di.Unknown}}class Yb extends ai.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===ao.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Ys.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,a){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ao.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Di.Unknown,this.log=Ce,this.log=ki((c=a?.loggerName)!==null&&c!==void 0?c:Hn.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Cn,this.once(ae.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(G.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(G.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(G.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Ys.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Ys.ACTIVE&&this.emit(ae.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(ae.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(ae.ParticipantNameChanged,e)}_setAttributes(e){const n=aN(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(ae.AttributesChanged,n)}setPermissions(e){var n,i,r,o,a,l;const c=this.permissions,d=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,p)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[p])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,d&&this.emit(ae.ParticipantPermissionsChanged,c),d}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ae.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=UA(e),n!==this._connectionQuality&&this.emit(ae.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ei(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(ne.Muted,()=>{this.emit(ae.TrackMuted,e)}),e.on(ne.Unmuted,()=>{this.emit(ae.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case G.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case G.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function WA(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Hy({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class VA extends Yb{constructor(e,n,i,r,o,a){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=At.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Cn)},this.handleReconnected=()=>{var l,c;(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||c===void 0||c.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,c,d,u,p,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||c===void 0||c.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(d=this.signalConnectedFuture).reject)===null||u===void 0||u.call(d,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(p=this.activeAgentFuture)===null||p===void 0?void 0:p.reject)===null||h===void 0||h.call(p,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var c,d;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Cn),(d=(c=this.signalConnectedFuture).resolve)===null||d===void 0||d.call(c)},this.handleSignalRequestResponse=l=>{const{requestId:c,reason:d,message:u}=l,p=this.pendingSignalRequests.get(c);p&&(d!==zu.OK&&p.reject(new Gf(u,d)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let c=l.value.value,d=null,u=null;c.value.case==="payload"?d=c.value.value:c.value.case==="error"&&(u=vt.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,d,u);break;case"rpcAck":let p=l.value.value;this.handleIncomingRpcAck(p.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>WA(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,c)=>{if(c===void 0&&(c=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ne(l)));return}this.engine.updateMuteStatus(l.sid,c)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ne(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ne(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const c=this.audioTrackPublications.get(l.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(l,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ne(c))),this.emit(ae.LocalTrackCpuConstrained,l,c)},this.handleSubscribedQualityUpdate=l=>I(this,void 0,void 0,function*(){var c,d,u,p,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const m=this.videoTrackPublications.get(l.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!m.videoTrack)return;const x=yield m.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var g=!0,y=xi(x),v;v=yield y.next(),c=v.done,!c;g=!0){p=v.value,g=!1;const w=p;nN(w)&&(this.log.debug("publish ".concat(w," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ne(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,w,m.options))}}catch(w){d={error:w}}finally{try{!g&&!c&&(u=y.return)&&(yield u.call(y))}finally{if(d)throw d.error}}}),this.handleLocalTrackUnpublished=l=>{const c=this.trackPublications.get(l.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=l=>I(this,void 0,void 0,function*(){if(l.source===G.Source.ScreenShare||l.source===G.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ne(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(hi(l)||Ii(l))try{if(hn())try{const c=yield navigator?.permissions.query({name:l.source===G.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),Ne(l))),c.onchange=()=>{c.state!=="denied"&&(l.isMuted||l.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ne(l))),hi(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ne(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==At.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(oe.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(oe.Connected,this.handleReconnected).on(oe.SignalConnected,this.handleSignalConnected).on(oe.SignalRestarted,this.handleReconnected).on(oe.SignalResumed,this.handleReconnected).on(oe.Restarting,this.handleReconnecting).on(oe.Resuming,this.handleReconnecting).on(oe.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(oe.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(oe.Closing,this.handleClosing).on(oe.SignalRequestResponse,this.handleSignalRequestResponse).on(oe.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return I(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:a}=n;return(function*(){return new Promise((l,c)=>I(i,void 0,void 0,function*(){var d,u;try{let p=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((d=r??this.metadata)!==null&&d!==void 0?d:"",(u=o??this.name)!==null&&u!==void 0?u:"",a),m=performance.now();for(this.pendingSignalRequests.set(h,{resolve:l,reject:x=>{c(x),p=!0},values:{name:o,metadata:r,attributes:a}});performance.now()-m<5e3&&!p;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!a||Object.entries(a).every(x=>{let[g,y]=x;return this.attributes[g]===y||y===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(h),l();return}yield $t(50)}c(new Gf("Request to update local metadata timed out","TimeoutError"))}catch(p){p instanceof Error&&c(p)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(G.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(G.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(G.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){this.encryptionType=e?At.GCM:At.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return I(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(n)if(l)yield l.unmute();else{let c;if(this.pendingPublishing.has(e)){const d=yield this.waitForPendingPublicationOfSource(e);return d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield d?.unmute(),d}this.pendingPublishing.add(e);try{switch(e){case G.Source.Camera:c=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case G.Source.Microphone:c=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case G.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new yi(e)}}catch(d){throw c?.forEach(u=>{u.stop()}),d instanceof Error&&this.emit(ae.MediaDevicesError,d,hd(e)),this.pendingPublishing.delete(e),d}for(const d of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===G.Source.Microphone&&ei(d)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),d.startPreConnectBuffer())}try{const d=[];for(const p of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ne(p))),d.push(this.publishTrack(p,r));[l]=yield Promise.all(d)}catch(d){throw c?.forEach(u=>{u.stop()}),d}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===G.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const c=this.getTrackPublication(G.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return I(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(G.Source.Camera)||this.pendingPublishing.has(G.Source.Microphone))){this.pendingPublishing.add(G.Source.Camera),this.pendingPublishing.add(G.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(G.Source.Camera),this.pendingPublishing.delete(G.Source.Microphone)}}})}createTracks(e){return I(this,void 0,void 0,function*(){var n,i;e??(e={});const r=_b(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield pl(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(ei(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=G.Source.Microphone,this.emit(ae.AudioStreamAcquired)),Qi(l)&&(this.cameraError=void 0,l.source=G.Source.Camera),l))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return I(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Fu("getDisplayMedia not supported");e.resolution===void 0&&!gN()&&(e.resolution=Uu.h1080fps30.resolution);const n=sN(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new yi("no video track found");const o=new Oa(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=G.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(ae.AudioStreamAcquired);const l=new Da(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=G.Source.ScreenShareAudio,a.push(l)}return a})}publishTrack(e,n){return I(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,c,d,u;hi(i)&&i.setAudioContext(o.audioContext),yield(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise,o.republishPromise&&!a&&(yield o.republishPromise),er(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let p;if(i instanceof MediaStreamTrack)p=i.getConstraints();else{p=i.constraints;let v;switch(i.source){case G.Source.Microphone:v="audioinput";break;case G.Source.Camera:v="videoinput"}v&&o.activeDeviceMap.has(v)&&(p=Object.assign(Object.assign({},p),{deviceId:o.activeDeviceMap.get(v)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Da(i,p,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Oa(i,p,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new yi("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let h;if(o.trackPublications.forEach(v=>{v.track&&v.track===i&&(h=v)}),h)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Ne(h))),h;const m=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),x="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=m.forceStereo)!==null&&c!==void 0?c:x;g&&(m.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Ne(i))),m.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(d=m.dtx)!==null&&d!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!yN()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const y=new Promise((v,w)=>I(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==nt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ne(i)}));let k=!1;const S=setTimeout(()=>{k=!0,i.stop(),w(new $f("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(S),k)return;const b=yield this.publish(i,m,g);v(b)}else try{const k=yield this.publish(i,m,g);v(k)}catch(k){w(k)}}catch(k){w(k)}}));o.pendingPublishPromises.set(i,y);try{return yield y}catch(v){throw v}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Cn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ne(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>lN(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ne(e))),!1)}publish(e,n,i){return I(this,void 0,void 0,function*(){var r,o,a,l,c,d,u,p,h,m;if(!this.hasPermissionsToPublish(e))throw new $f("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(_=>er(e)&&_.source===e.source)&&e.source!==G.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ne(e))),n.stopMicTrackOnMute&&ei(e)&&(e.stopOnMute=!0),e.source===G.Source.ScreenShare&&ys()&&(n.simulcast=!1),n.videoCodec==="av1"&&!pN()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!fN()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=yd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(_=>n.videoCodec===Wr(_.mime))||(n.videoCodec=Wr(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(ne.Muted,this.onTrackMuted),e.on(ne.Unmuted,this.onTrackUnmuted),e.on(ne.Ended,this.handleTrackEnded),e.on(ne.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ne.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ne.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),w=e.getSourceTrackSettings();w.autoGainControl&&y.push(Dt.TF_AUTO_GAIN_CONTROL),w.echoCancellation&&y.push(Dt.TF_ECHO_CANCELLATION),w.noiseSuppression&&y.push(Dt.TF_NOISE_SUPPRESSION),w.channelCount&&w.channelCount>1&&y.push(Dt.TF_STEREO),v&&y.push(Dt.TF_NO_DTX),hi(e)&&e.hasPreConnectBuffer&&y.push(Dt.TF_PRECONNECT_BUFFER);const k=new lo({cid:e.mediaStreamTrack.id,name:n.name,type:G.kindToProto(e.kind),muted:e.isMuted,source:G.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:y});let S;if(e.kind===G.Kind.Video){let _={width:0,height:0};try{_=yield e.waitForDimensions()}catch{const N=(l=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&l!==void 0?l:co.h720.resolution;_={width:N.width,height:N.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{dims:_}))}k.width=_.width,k.height=_.height,Ii(e)&&(Fn(g)&&(e.source===G.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ne(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),k.simulcastCodecs=[new ed({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:yd}),n.backupCodec&&g!==n.backupCodec.codec&&k.encryption===At.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),k.simulcastCodecs.push(new ed({codec:n.backupCodec.codec,cid:""})))),S=vd(e.source===G.Source.ScreenShare,k.width,k.height,n),k.layers=ym(k.width,k.height,S,Fn(n.videoCodec))}else e.kind===G.Kind.Audio&&(S=[{maxBitrate:(d=n.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(p=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&p!==void 0?p:"high",networkPriority:(m=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Nt("cannot publish track when not connected");const b=()=>I(this,void 0,void 0,function*(){var _,E,N;if(!this.engine.pcManager)throw new Nt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,S),this.emit(ae.LocalSenderCreated,e.sender,e),Ii(e)&&((_=n.degradationPreference)!==null&&_!==void 0||(n.degradationPreference=wA(e)),e.setDegradationPreference(n.degradationPreference)),S)if(ys()&&e.kind===G.Kind.Audio){let L;for(const V of this.engine.pcManager.publisher.getTransceivers())if(V.sender===e.sender){L=V;break}L&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:L,codec:"opus",maxbr:!((E=S[0])===null||E===void 0)&&E.maxBitrate?S[0].maxBitrate/1e3:0})}else e.codec&&Fn(e.codec)&&(!((N=S[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:k.cid,codec:e.codec,maxbr:S[0].maxBitrate/1e3});yield this.engine.negotiate()});let j;const C=new Promise((_,E)=>I(this,void 0,void 0,function*(){var N;try{j=yield this.engine.addTrack(k),_(j)}catch(L){e.sender&&(!((N=this.engine.pcManager)===null||N===void 0)&&N.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(V=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{error:V}))})),E(L)}}));if(this.enabledPublishVideoCodecs.length>0)j=(yield Promise.all([C,b()]))[0];else{j=yield C;let _;if(j.codecs.forEach(E=>{_===void 0&&(_=E.mimeType)}),_&&e.kind===G.Kind.Video){const E=Wr(_);E!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{codec:E})),n.videoCodec=E,S=vd(e.source===G.Source.ScreenShare,k.width,k.height,n))}yield b()}const T=new kd(e.kind,j,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(T.on(ne.CpuConstrained,_=>this.onTrackCpuConstrained(_,T)),T.options=n,e.sid=j.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:S,trackInfo:j})),Ii(e)?e.startMonitor(this.engine.client):hi(e)&&e.startMonitor(),this.addTrackPublication(T),this.emit(ae.LocalTrackPublished,T),hi(e)&&j.audioFeatures.includes(Dt.TF_PRECONNECT_BUFFER)){const _=e.getPreConnectBuffer(),E=e.getPreConnectBufferMimeType();this.on(ae.LocalTrackSubscribed,N=>{if(N.trackSid===j.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ne(e))),e.stopPreConnectBuffer()}}),_&&new Promise((L,V)=>I(this,void 0,void 0,function*(){var D,A,F,B,M,z;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ne(e)));const le=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),de=yield this.waitUntilActiveAgentPresent();clearTimeout(le),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ne(e)));const ue=yield this.streamBytes({name:"preconnect-buffer",mimeType:E,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[de.identity],attributes:{trackId:T.trackSid,sampleRate:String((M=w.sampleRate)!==null&&M!==void 0?M:"48000"),channels:String((z=w.channelCount)!==null&&z!==void 0?z:"1")}});try{for(var U=!0,W=xi(_),q;q=yield W.next(),D=q.done,!D;U=!0){B=q.value,U=!1;const $=B;yield ue.write($)}}catch($){A={error:$}}finally{try{!U&&!D&&(F=W.return)&&(yield F.call(W))}finally{if(A)throw A.error}}yield ue.close(),L()}catch(le){V(le)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ne(e)))}).catch(L=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{error:L}))})}return T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return I(this,void 0,void 0,function*(){var r;if(this.encryptionType!==At.NONE)return;let o;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(o=m)}),!o)throw new yi("track is not published");if(!Ii(e))throw new yi("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),l=vA(e,n,a);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ne(e)));return}const c=e.addSimulcastTrack(n,l);if(!c)return;const d=new lo({cid:c.mediaStreamTrack.id,type:G.kindToProto(e.kind),muted:e.isMuted,source:G.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:c.mediaStreamTrack.id}]});if(d.layers=ym(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new Nt("cannot publish track when not connected");const u=()=>I(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,a,l),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(d),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:h}))})}unpublishTrack(e,n){return I(this,void 0,void 0,function*(){var i,r;if(er(e)){const d=this.pendingPublishPromises.get(e);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ne(e))),yield d)}const o=this.getPublicationForTrack(e),a=o?Ne(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(ne.Muted,this.onTrackMuted),e.off(ne.Unmuted,this.onTrackUnmuted),e.off(ne.Ended,this.handleTrackEnded),e.off(ne.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ne.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ne.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let l=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<yt.FAILED&&c)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===c&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(c)&&(l=!0),Ii(e)){for(const[,d]of e.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);e.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:d}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case G.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case G.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(ae.LocalTrackUnpublished,o),o.setTrack(void 0),l&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return I(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,a)=>I(i,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),l.push(c))}),yield Promise.all(l.map(c=>I(this,void 0,void 0,function*(){const d=c.track;yield this.unpublishTrack(d,!1),r&&!d.isMuted&&d.source!==G.Source.ScreenShare&&d.source!==G.Source.ScreenShareAudio&&(hi(d)||Ii(d))&&!d.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield d.restartTrack()),yield this.publishOrRepublishTrack(d,c.options,!0)}))),o()}catch(l){a(l)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?_e.RELIABLE:_e.LOSSY,a=r.destinationIdentities,l=r.topic;let c=new Iu({participantIdentity:i.identity,payload:n,destinationIdentities:a,topic:l});const d=new nn({kind:o,value:{case:"user",value:c}});yield i.engine.sendDataPacket(d,o)})()})}publishDtmf(e,n){return I(this,void 0,void 0,function*(){const i=new nn({kind:_e.RELIABLE,value:{case:"sipDtmf",value:new Ny({code:e,digit:n})}});yield this.engine.sendDataPacket(i,_e.RELIABLE)})}sendChatMessage(e,n){return I(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},r=new nn({value:{case:"chatMessage",value:new _a(Object.assign(Object.assign({},i),{timestamp:at.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,_e.RELIABLE),this.emit(ae.ChatMessage,i),i})}editChatMessage(e,n){return I(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new nn({value:{case:"chatMessage",value:new _a(Object.assign(Object.assign({},i),{timestamp:at.parse(i.timestamp),editTimestamp:at.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,_e.RELIABLE),this.emit(ae.ChatMessage,i),i})}sendText(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return I(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:a,responseTimeout:l=15e3}=n;return(function*(){return new Promise((u,p)=>I(i,void 0,void 0,function*(){var h,m,x,g;if(Ku(a)>Wb){p(vt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||m===void 0)&&m.version&&ri((g=(x=this.engine.latestJoinResponse)===null||x===void 0?void 0:x.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){p(vt.builtIn("UNSUPPORTED_SERVER"));return}const y=Math.max(l,8e3),v=crypto.randomUUID();yield this.publishRpcRequest(r,v,o,a,y);const w=setTimeout(()=>{this.pendingAcks.delete(v),p(vt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(k)},7e3);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(w)},participantIdentity:r});const k=setTimeout(()=>{this.pendingResponses.delete(v),p(vt.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(v,{resolve:(S,b)=>{clearTimeout(k),this.pendingAcks.has(v)&&(this.log.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(w)),b?p(b):u(S??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return I(this,void 0,void 0,function*(){const a=new nn({destinationIdentities:[e],kind:_e.RELIABLE,value:{case:"rpcRequest",value:new _u({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(a,_e.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,vt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const a=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Cn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(hi(r)||Ii(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return I(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[a]=o;return a.source===e});if(r)return r[1];yield $t(20)}})}}class $A extends pi{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ne.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new cl({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new My({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ne.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?pi.SubscriptionStatus.Unsubscribed:super.isSubscribed?pi.SubscriptionStatus.Subscribed:pi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?pi.PermissionStatus.Allowed:pi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(ic(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&ic(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:xn.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(ne.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(ne.VisibilityChanged,this.handleVisibilityChange),r.off(ne.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(ne.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ne.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ne.VisibilityChanged,this.handleVisibilityChange),e.on(ne.Ended,this.handleEnded),this.emit(ne.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(ne.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?ne.Muted:ne.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(ne.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ne.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return ic(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Wy({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===G.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)qf(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=cN(this.trackInfo,this.requestedMaxQuality);i&&qf(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:xn.HIGH})),e.quality=xn.HIGH)}this.emit(ne.UpdateSettings,e)}}class La extends Yb{static fromParticipantInfo(e,n,i){return new La(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,a,l){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ao.STANDARD;super(n,i||"",r,o,a,l,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ne.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(ne.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(ne.SubscriptionPermissionChanged,n=>{this.emit(ae.TrackSubscriptionPermissionChanged,e,n)}),e.on(ne.SubscriptionStatusChanged,n=>{this.emit(ae.TrackSubscriptionStatusChanged,e,n)}),e.on(ne.Subscribed,n=>{this.emit(ae.TrackSubscribed,n,e)}),e.on(ne.Unsubscribed,n=>{this.emit(ae.TrackUnsubscribed,n,e)}),e.on(ne.SubscriptionFailed,n=>{this.emit(ae.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:G.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,a){let l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(u=>{!l&&e.kind===u.kind.toString()&&(l=u)}),!l){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(ae.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ne(l))),this.emit(ae.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let d;return c?d=new zA(e,n,r,o):d=new LA(e,n,r,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(i),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&gd(d)&&ei(d)&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,a;let l=this.getTrackPublicationBySid(r.sid);if(l)l.updateInfo(r);else{const c=G.kindFromProto(r.type);if(!c)return;l=new $A(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),l.updateInfo(r),i.set(r.sid,l);const d=Array.from(this.trackPublications.values()).find(u=>u.source===l?.source);d&&l.source!==G.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ne(d),newTrack:Ne(l)})),this.addTrackPublication(l)}n.set(r.sid,l)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ne(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(ae.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case G.Kind.Audio:this.audioTrackPublications.delete(e);break;case G.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(ae.TrackUnpublished,i)}setAudioOutput(e){return I(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;ei(i.track)&&gd(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ue;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Ue||(Ue={}));const GA=4*1e3;class cr extends ai.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,o;if(super(),n=this,this.state=Ue.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ce,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>I(this,void 0,void 0,function*(){var d;if(!mN())throw si()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Ue.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Ue.Connecting),((d=this.regionUrlProvider)===null||d===void 0?void 0:d.getServerUrl().toString())!==Lb(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),lr(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Be(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(m=>{var x;(x=this.regionUrlProvider)===null||x===void 0||x.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const p=(m,x,g)=>I(this,void 0,void 0,function*(){var y,v;this.abortController&&this.abortController.abort();const w=new AbortController;this.abortController=w,u?.();try{if(yield tr.getInstance().getBackOffPromise(a),w.signal.aborted)throw be.cancelled("Connection attempt aborted");yield this.attemptConnection(g??a,l,c,w),this.abortController=void 0,m()}catch(k){if(this.regionUrlProvider&&k instanceof be&&k.reason!==ot.Cancelled&&k.reason!==ot.NotAllowed){let S=null;try{this.log.debug("Fetching next region"),S=yield this.regionUrlProvider.getNextBestRegionUrl((y=this.abortController)===null||y===void 0?void 0:y.signal)}catch(b){if(b instanceof be&&(b.status===401||b.reason===ot.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),x(b);return}}[ot.InternalError,ot.ServerUnreachable,ot.Timeout].includes(k.reason)&&(this.log.debug("Adding failed connection attempt to back off"),tr.getInstance().addFailedConnectionAttempt(a)),S&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(S),this.logContext),this.recreateEngine(),yield p(m,x,S)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,em(k)),x(k))}else{let S=Un.UNKNOWN_REASON;k instanceof be&&(S=em(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,S),x(k)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Cn((m,x)=>{p(m,x,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,d,u,p)=>I(this,void 0,void 0,function*(){var h,m,x;const g=yield c.join(a,l,{autoSubscribe:d.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout,singlePeerConnection:u.singlePeerConnection},p.signal);let y=g.serverInfo;if(y||(y={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=y,this.log.debug("connected to Livekit Server ".concat(Object.entries(y).map(v=>{let[w,k]=v;return"".concat(w,": ").concat(k)}).join(", ")),{room:(h=g.room)===null||h===void 0?void 0:h.name,roomSid:(m=g.room)===null||m===void 0?void 0:m.sid,identity:(x=g.participant)===null||x===void 0?void 0:x.identity}),!y.version)throw new X_("unknown server version");return y.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),g}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,d)=>I(this,void 0,void 0,function*(){var u,p;this.state===Ue.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((p=this.regionUrlProvider)===null||p===void 0)&&p.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},qu),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,d);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const m=d.signal.aborted?be.cancelled("Signal connection aborted"):be.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(m.message="".concat(m.message,": ").concat(h.message)),h instanceof be&&(m.reason=h.reason,m.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),m}if(d.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),be.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}hn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),hn()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ue.Connected),this.emit(Y.Connected),tr.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return I(n,[...l],void 0,function(){var d=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var p,h,m;const x=yield d.disconnectLock.lock();try{if(d.state===Ue.Disconnected){d.log.debug("already disconnected",d.logContext);return}if(d.log.info("disconnect from room",Object.assign({},d.logContext)),d.state===Ue.Connecting||d.state===Ue.Reconnecting||d.isResuming){const g="Abort connection attempt due to user initiated disconnect";d.log.warn(g,d.logContext),(p=d.abortController)===null||p===void 0||p.abort(g),(m=(h=d.connectFuture)===null||h===void 0?void 0:h.reject)===null||m===void 0||m.call(h,be.cancelled("Client initiated disconnect")),d.connectFuture=void 0}d.engine&&(d.engine.client.isDisconnected||(yield d.engine.client.sendLeave()),yield d.engine.close()),d.handleDisconnect(u,Un.CLIENT_INITIATED),d.engine=void 0}finally{x()}})()})},this.onPageLeave=()=>I(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>I(this,void 0,void 0,function*(){const a=[],l=fn();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let d=document.getElementById(c);if(!d){d=document.createElement("audio"),d.id=c,d.autoplay=!0,d.hidden=!0;const u=nc();u.enabled=!0;const p=new MediaStream([u]);d.srcObject=p,document.addEventListener("visibilitychange",()=>{d&&(d.srcObject=document.hidden?null:p,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(d),this.once(Y.Disconnected,()=>{d?.remove(),d=null})}a.push(d)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(d=>{d.track&&d.track.attachedElements.forEach(u=>{a.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>I(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var d;(d=c.track)===null||d===void 0||d.attachedElements.forEach(u=>{a.includes(u)||a.push(u)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(Ue.Reconnecting)&&this.emit(Y.Reconnecting)},this.handleSignalRestarted=a=>I(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ue.Connected),this.emit(Y.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let d=this.remoteParticipants.get(l.identity);l.state===Ys.DISCONNECTED?this.handleParticipantDisconnected(l.identity,d):d=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(d=>{if(c[d.sid]=!0,d.sid===this.localParticipant.sid)this.localParticipant.audioLevel=d.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(d.sid);u&&(u.audioLevel=d.level,u.setIsSpeaking(!0),l.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(d=>{c[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(Y.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(d=>{const u=this.remoteParticipants.get(d.identity);u&&u.sid!==d.sid||l.set(d.sid,d)}),a.forEach(d=>{let u=this.getRemoteParticipantBySid(d.sid);d.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=d.level,u.setIsSpeaking(d.active),d.active?l.set(d.sid,u):l.delete(d.sid))});const c=Array.from(l.values());c.sort((d,u)=>u.audioLevel-d.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(Y.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const d=c.getTrackPublicationBySid(l.trackSid);if(!d||!d.track)return;const u=G.streamStateFromProto(l.state);d.track.setStreamState(u),u!==d.track.streamState&&(c.emit(ae.TrackStreamStateChanged,d,d.track.streamState),this.emitWhenConnected(Y.TrackStreamStateChanged,d,d.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(d=>d.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const d=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,d.id,d.method,d.payload,d.responseTimeoutMs,d.version)}},this.handleUserPacket=(a,l,c,d)=>{this.emit(Y.DataReceived,l.payload,a,c,l.topic,d),a?.emit(ae.DataReceived,l.payload,c,d)},this.handleSipDtmf=(a,l)=>{this.emit(Y.SipDTMFReceived,l,a),a?.emit(ae.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),d=c?.trackPublications.get(l.trackId),u=CN(l,this.transcriptionReceivedTimes);d?.emit(ne.TranscriptionReceived,u),c?.emit(ae.TranscriptionReceived,u,d),this.emit(Y.TranscriptionReceived,u,c,d)},this.handleChatMessage=(a,l)=>{const c=jN(l);this.emit(Y.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(Y.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Y.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Y.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Y.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Y.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>I(this,void 0,void 0,function*(){var a;((a=fn())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Y.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(Y.RoomMetadataChanged,a.metadata),l?.activeRecording!==a.activeRecording&&this.emitWhenConnected(Y.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(Y.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(Y.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(Y.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(Y.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(Y.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a?.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>I(this,void 0,void 0,function*(){var l,c,d,u,p,h;(l=a.track)===null||l===void 0||l.on(ne.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(ne.Restarted,this.onLocalTrackRestarted),(p=(u=(d=a.track)===null||d===void 0?void 0:d.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||p===void 0||p.call(u,this),this.emit(Y.LocalTrackPublished,a,this.localParticipant),hi(a.track)&&(yield a.track.checkForSilence())&&this.emit(Y.LocalAudioSilenceDetected,a);const m=yield(h=a.track)===null||h===void 0?void 0:h.getDeviceId(!1),x=hd(a.source);x&&m&&m!==this.localParticipant.activeDeviceMap.get(x)&&(this.localParticipant.activeDeviceMap.set(x,m),this.emit(Y.ActiveDeviceChanged,x,m))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(ne.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(ne.Restarted,this.onLocalTrackRestarted),this.emit(Y.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>I(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=hd(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(Y.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(Y.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(Y.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(Y.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(Y.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},iA),e),this.log=ki((i=this.options.loggerName)!==null&&i!==void 0?i:Hn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Bb),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Fb),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},nA),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new MA,this.outgoingDataStreamManager=new OA(this.engine,this.log),this.disconnectLock=new on,this.localParticipant=new VA("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Wi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Wi(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Wi(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),hn()){const a=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),cr.cleanupRegistry&&cr.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new BN(i,n),this.e2eeManager.on(Li.ParticipantEncryptionStatusChanged,(r,o)=>{EN(o)&&(this.isE2EEEnabled=r),this.emit(Y.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on(Li.EncryptionError,(r,o)=>{const a=o?this.getParticipantByIdentity(o):void 0;this.emit(Y.EncryptionError,r,a)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return I(this,void 0,void 0,function*(){return this.state===Ue.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(oe.RoomUpdate,i),e(r.sid))};this.engine.on(oe.RoomUpdate,i),this.once(Y.Disconnected,()=>{this.engine.off(oe.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new IA(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(oe.ParticipantUpdate,this.handleParticipantUpdates).on(oe.RoomUpdate,this.handleRoomUpdate).on(oe.SpeakersChanged,this.handleSpeakersChanged).on(oe.StreamStateChanged,this.handleStreamStateUpdate).on(oe.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(oe.SubscriptionError,this.handleSubscriptionError).on(oe.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(oe.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(oe.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(oe.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(oe.DataPacketReceived,this.handleDataPacket).on(oe.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ue.SignalReconnecting)&&this.emit(Y.SignalReconnecting)}).on(oe.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ue.Connected)&&this.emit(Y.Reconnected)}).on(oe.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ue.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(oe.Restarting,this.handleRestarting).on(oe.SignalRestarted,this.handleSignalRestarted).on(oe.Offline,()=>{this.setAndEmitConnectionState(Ue.Reconnecting)&&this.emit(Y.Reconnecting)}).on(oe.DCBufferStatusChanged,(e,n)=>{this.emit(Y.DCBufferStatusChanged,e,n)}).on(oe.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ae.LocalTrackSubscribed,n),this.emitWhenConnected(Y.LocalTrackSubscribed,n,this.localParticipant)}).on(oe.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(Y.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ot.getInstance().getDevices(e,n)}prepareConnection(e,n){return I(this,void 0,void 0,function*(){if(this.state===Ue.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(lr(new URL(e))&&n){this.regionUrlProvider=new Be(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ue.Disconnected&&(this.regionUrl=i,yield fetch(ho(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ho(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return I(this,void 0,void 0,function*(){let i=()=>I(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Kn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Kn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Kn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Kn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Kn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>I(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new dl({reason:Un.CLIENT_INITIATED,action:Xs.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Kn({scenario:{case:"subscriberBandwidth",value:ss(n)}});break;case"leave-full-reconnect":r=new Kn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,c,d,u,p,h,m;let x=!0,g=!1;const y=a?{exact:r}:r;if(i==="audioinput"){g=o.localParticipant.audioTrackPublications.size===0;const v=(l=o.getActiveDevice(i))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=y;const w=Array.from(o.localParticipant.audioTrackPublications.values()).filter(S=>S.source===G.Source.Microphone);try{x=(yield Promise.all(w.map(S=>{var b;return(b=S.audioTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(S=>S===!0)}catch(S){throw o.options.audioCaptureDefaults.deviceId=v,S}const k=w.some(S=>{var b,j;return(j=(b=S.track)===null||b===void 0?void 0:b.isMuted)!==null&&j!==void 0?j:!1});x&&k&&(g=!0)}else if(i==="videoinput"){g=o.localParticipant.videoTrackPublications.size===0;const v=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=y;const w=Array.from(o.localParticipant.videoTrackPublications.values()).filter(S=>S.source===G.Source.Camera);try{x=(yield Promise.all(w.map(S=>{var b;return(b=S.videoTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(S=>S===!0)}catch(S){throw o.options.videoCaptureDefaults.deviceId=v,S}const k=w.some(S=>{var b,j;return(j=(b=S.track)===null||b===void 0?void 0:b.isMuted)!==null&&j!==void 0?j:!1});x&&k&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!md()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(d=yield Ot.getInstance().normalizeDeviceId("audiooutput",r))!==null&&d!==void 0?d:""),(u=(m=o.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const v=(p=o.getActiveDevice(i))!==null&&p!==void 0?p:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((h=o.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(w=>w.setAudioOutput({deviceId:r})))}catch(w){throw o.options.audioOutput.deviceId=v,w}}return g&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(Y.ActiveDeviceChanged,i,r)),x})()})}setupLocalParticipantEvents(){this.localParticipant.on(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ae.AttributesChanged,this.onLocalAttributesChanged).on(ae.TrackMuted,this.onLocalTrackMuted).on(ae.TrackUnmuted,this.onLocalTrackUnmuted).on(ae.LocalTrackPublished,this.onLocalTrackPublished).on(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ae.MediaDevicesError,this.onMediaDevicesError).on(ae.AudioStreamAcquired,this.startAudio).on(ae.ChatMessage,this.onLocalChatMessageSent).on(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Ue.Connecting||this.state===Ue.Reconnecting){const p=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(Y.Reconnected,p),this.off(Y.Connected,p),this.off(Y.Disconnected,h)};this.once(Y.Reconnected,p),this.once(Y.Connected,p),this.once(Y.Disconnected,h);return}if(this.state===Ue.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=hN(n.id),o=r[0];let a=r[1],l=e.id;if(a&&a.startsWith("TR")&&(l=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(p=>p.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!l.startsWith("TR")){const p=this.engine.getTrackIdForReceiver(i);if(!p){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}l=p}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(a,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:a,trackId:l}));let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={});const u=c.addSubscribedMediaTrack(e,l,n,i,d);u?.isEncrypted&&!this.e2eeManager&&this.emit(Y.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ue.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,l;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ae.AttributesChanged,this.onLocalAttributesChanged).off(ae.TrackMuted,this.onLocalTrackMuted).off(ae.TrackUnmuted,this.onLocalTrackUnmuted).off(ae.LocalTrackPublished,this.onLocalTrackPublished).off(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ae.MediaDevicesError,this.onMediaDevicesError).off(ae.AudioStreamAcquired,this.startAudio).off(ae.ChatMessage,this.onLocalChatMessageSent).off(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),hn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ue.Disconnected),this.emit(Y.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(Y.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,o,a){return I(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),a!==1){yield this.engine.publishRpcResponse(e,n,null,vt.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(i);if(!l){yield this.engine.publishRpcResponse(e,n,null,vt.builtIn("UNSUPPORTED_METHOD"));return}let c=null,d=null;try{const u=yield l({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});Ku(u)>Wb?(c=vt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):d=u}catch(u){u instanceof vt?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=vt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,d,c)})}selectDefaultDevices(){return I(this,void 0,void 0,function*(){var e,n,i;const r=Ot.getInstance().previousDevices,o=yield Ot.getInstance().getDevices(void 0,!1),a=fn();if(a?.name==="Chrome"&&a.os!=="iOS")for(let c of o){const d=r.find(u=>u.deviceId===c.deviceId);d&&d.label!==""&&d.kind===c.kind&&d.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(Y.ActiveDeviceChanged,c.kind,c.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let c of l){const d=iN(c),u=this.localParticipant.getTrackPublication(d);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const p=o.filter(m=>m.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&p.length>0&&((i=p[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,p[0].deviceId);continue}c==="audioinput"&&!uo()||c==="videoinput"||p.length>0&&!p.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!uo())&&(yield this.switchActiveDevice(c,p[0].deviceId))}})}acquireAudioContext(){return I(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Ab())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),$t(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(Y.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=La.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new La(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(Y.ParticipantConnected,i),i.on(ae.TrackPublished,r=>{this.emitWhenConnected(Y.TrackPublished,r,i)}).on(ae.TrackSubscribed,(r,o)=>{r.kind===G.Kind.Audio?(r.on(ne.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(ne.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===G.Kind.Video&&(r.on(ne.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(ne.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Y.TrackSubscribed,r,o,i)}).on(ae.TrackUnpublished,r=>{this.emit(Y.TrackUnpublished,r,i)}).on(ae.TrackUnsubscribed,(r,o)=>{this.emit(Y.TrackUnsubscribed,r,o,i)}).on(ae.TrackMuted,r=>{this.emitWhenConnected(Y.TrackMuted,r,i)}).on(ae.TrackUnmuted,r=>{this.emitWhenConnected(Y.TrackUnmuted,r,i)}).on(ae.ParticipantMetadataChanged,r=>{this.emitWhenConnected(Y.ParticipantMetadataChanged,r,i)}).on(ae.ParticipantNameChanged,r=>{this.emitWhenConnected(Y.ParticipantNameChanged,r,i)}).on(ae.AttributesChanged,r=>{this.emitWhenConnected(Y.ParticipantAttributesChanged,r,i)}).on(ae.ConnectionQualityChanged,r=>{this.emitWhenConnected(Y.ConnectionQualityChanged,r,i)}).on(ae.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(Y.ParticipantPermissionsChanged,r,i)}).on(ae.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(Y.TrackSubscriptionStatusChanged,r,o,i)}).on(ae.TrackSubscriptionFailed,(r,o)=>{this.emit(Y.TrackSubscriptionFailed,r,i,o)}).on(ae.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(Y.TrackSubscriptionPermissionChanged,r,o,i)}).on(ae.Active,()=>{this.emitWhenConnected(Y.ParticipantActive,i),i.kind===ao.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&TN(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Vt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Un.STATE_MISMATCH))):e=0},GA)}clearConnectionReconcile(){this.connectionReconcileInterval&&Vt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(Y.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Ue.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ue.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return I(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new ol({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:at.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new xs({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected),this.emit(Y.Connected),this.setAndEmitConnectionState(Ue.Connected),r.video){const a=new kd(G.Kind.Video,new Ws({source:Tt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zn.AUDIO,name:"video-dummy"}),new Oa(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Qf(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(ae.LocalTrackPublished,a)}if(r.audio){const a=new kd(G.Kind.Audio,new Ws({source:Tt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zn.AUDIO}),new Da(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:nc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(ae.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let l=new xs({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:Ys.ACTIVE,tracks:[],joinedAt:at.parse(Date.now())});const c=this.getOrCreateParticipant(l.identity,l);if(o.video){const d=Qf(160*((i=o.aspectRatios[a%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Ws({source:Tt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}if(o.audio){const d=nc(),u=new Ws({source:Tt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}c.updateInfo(l)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==Y.ActiveSpeakersChanged&&e!==Y.TranscriptionReceived){const o=Xb(i).filter(a=>a!==void 0);(e===Y.TrackSubscribed||e===Y.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}cr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Xb(t){return t.map(e=>{if(e)return Array.isArray(e)?Xb(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ln;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ln||(Ln={}));class es extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ln.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new cr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return I(this,void 0,void 0,function*(){if(this.status!==Ln.IDLE)throw Error("check is running already");this.setStatus(Ln.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ln.SKIPPED&&this.setStatus(this.isSuccess()?Ln.SUCCESS:Ln.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return I(this,void 0,void 0,function*(){return this.room.state===Ue.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return I(this,void 0,void 0,function*(){this.room&&this.room.state!==Ue.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ln.SKIPPED)}switchProtocol(e){return I(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(Y.Reconnecting,()=>{n=!0}),this.room.once(Y.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield $t(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class HA extends es{get description(){return"Cloud regions"}perform(){return I(this,void 0,void 0,function*(){const e=new Be(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const l=yield this.checkCloudRegion(a);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),n.push(l)}n.sort((o,a)=>(o.duration-a.duration)*.5+(o.rtt-a.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return I(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,c=1e6/a,d="A".repeat(a),u=Date.now();for(let x=0;x<c;x++)yield o.write(d);yield o.close();const p=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),m={region:r,rtt:1e4,duration:p-u};return h?.forEach(x=>{x.type==="candidate-pair"&&x.nominated&&(m.rtt=x.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const uc=1e4;class qA extends es{get description(){return"Connection via UDP vs TCP"}perform(){return I(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(uc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(uc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return I(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const l=n.captureStream(30).getVideoTracks()[0],d=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},p=setInterval(()=>I(this,void 0,void 0,function*(){const h=yield d.getRTCStatsReport();h?.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,uc)),clearInterval(p),l.stop(),n.remove(),yield this.disconnect(),u})}}class KA extends es{get description(){return"Can publish audio"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield Jb();if(yield Nb(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(l=>setTimeout(l,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let a=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(a=l.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class JA extends es{get description(){return"Can publish video"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield FA();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(o+=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return I(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,a,l,c;const d=document.createElement("canvas"),u=e.getSettings(),p=(a=(o=u.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&a!==void 0?a:1280,h=(c=(l=u.height)!==null&&l!==void 0?l:i.videoHeight)!==null&&c!==void 0?c:720;d.width=p,d.height=h;const m=d.getContext("2d");m.drawImage(i,0,0);const g=m.getImageData(0,0,d.width,d.height).data;let y=!0;for(let v=0;v<g.length;v+=4)if(g[v]!==0||g[v+1]!==0||g[v+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class YA extends es{get description(){return"Resuming connection after interruption"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const a=new Promise(d=>{setTimeout(d,5e3),o=d}),l=()=>{i=!0};n.on(Y.SignalReconnecting,l).on(Y.Reconnecting,l).on(Y.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,i){if(!r||n.state!==Ue.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class XA extends es{get description(){return"Can connect via TURN"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;lr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Be(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new Vu,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let a=!1,l=!1,c=!1;for(let d of o.iceServers)for(let u of d.urls)u.startsWith("turn:")?(l=!0,c=!0):u.startsWith("turns:")&&(l=!0,c=!0,a=!0),u.startsWith("stun:")&&(c=!0);c?l&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(d=>setTimeout(d,0)))})}}class ZA extends es{get description(){return"Establishing WebRTC connection"}perform(){return I(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(Y.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,a)=>{if(o.candidate){const l=new RTCIceCandidate(o);let c="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(QA(l.address)?c+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,c+=" (passive)"):l.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(o,a)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),Ce.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function QA(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class eM extends es{get description(){return"Connecting to signal connection via WebSocket"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Vu,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(a){if(lr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const c=yield new Be(this.url,this.token).getNextBestRegionUrl();c&&(o=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Dy.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class yD extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ln.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ln.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return I(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=a=>{this.updateCheck(n,a)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(eM)})}checkWebRTC(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(ZA)})}checkTURN(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(XA)})}checkReconnect(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(YA)})}checkPublishAudio(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(KA)})}checkPublishVideo(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(JA)})}checkConnectionProtocol(){return I(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(qA);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(HA)})}}function Ae(t,e,n){return(e=nM(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tM(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function nM(t){var e=tM(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class an extends Error{constructor(e,n){var i;super(e,n),Ae(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Ae(an,"code","ERR_JOSE_GENERIC");class iM extends an{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ae(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ae(this,"claim",void 0),Ae(this,"reason",void 0),Ae(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ae(iM,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class sM extends an{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ae(this,"code","ERR_JWT_EXPIRED"),Ae(this,"claim",void 0),Ae(this,"reason",void 0),Ae(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ae(sM,"code","ERR_JWT_EXPIRED");class rM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ae(rM,"code","ERR_JOSE_ALG_NOT_ALLOWED");class oM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ae(oM,"code","ERR_JOSE_NOT_SUPPORTED");class aM extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ae(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ae(aM,"code","ERR_JWE_DECRYPTION_FAILED");class lM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JWE_INVALID")}}Ae(lM,"code","ERR_JWE_INVALID");class cM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JWS_INVALID")}}Ae(cM,"code","ERR_JWS_INVALID");class dM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JWT_INVALID")}}Ae(dM,"code","ERR_JWT_INVALID");class uM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JWK_INVALID")}}Ae(uM,"code","ERR_JWK_INVALID");class hM extends an{constructor(){super(...arguments),Ae(this,"code","ERR_JWKS_INVALID")}}Ae(hM,"code","ERR_JWKS_INVALID");class pM extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ae(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ae(pM,"code","ERR_JWKS_NO_MATCHING_KEY");class fM extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ae(this,Symbol.asyncIterator,void 0),Ae(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ae(fM,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class mM extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ae(this,"code","ERR_JWKS_TIMEOUT")}}Ae(mM,"code","ERR_JWKS_TIMEOUT");class gM extends an{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ae(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ae(gM,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function bi(){return bi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},bi.apply(null,arguments)}const wm=new Uint8Array(0);class po{static getFullOptions(e){return bi({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(o){i.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i?.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return wm}getOutputByteFrequencyData(){return wm}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let Zb=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function za(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const Qb="0.12.0";function wd(t){return!!t.type}const ev="conversation_initiation_client_data";function tv(t){var e;const n={type:ev};var i,r,o,a,l;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(a=t.overrides.tts)==null?void 0:a.voiceId},conversation:{text_only:(l=t.overrides.conversation)==null?void 0:l.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let Cd=class nv extends Zb{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const a=JSON.parse(o.data);if(!wd(a))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(a)}catch(a){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:a instanceof Error?a.message:String(a),data:o.data})}})}static async create(e){let n=null;try{var i,r,o;const l=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||Qb,u=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const w=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${w}source=${u}&version=${d}`}else c=`${l}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${d}`;const p=["convai"];e.authorization&&p.push(`bearer.${e.authorization}`),n=new WebSocket(c,p);const h=await new Promise((w,k)=>{n.addEventListener("open",()=>{var S;const b=tv(e);(S=n)==null||S.send(JSON.stringify(b))},{once:!0}),n.addEventListener("error",S=>{setTimeout(()=>k(S),0)}),n.addEventListener("close",k),n.addEventListener("message",S=>{const b=JSON.parse(S.data);wd(b)&&(b.type==="conversation_initiation_metadata"?w(b.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:m,agent_output_audio_format:x,user_input_audio_format:g}=h,y=za(g??"pcm_16000"),v=za(x);return new nv(n,m,y,v)}catch(l){var a;throw(a=n)==null||a.close(),l}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function iv(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function xM(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Uo=new Map;function sv(t,e){return async(n,i)=>{const r=Uo.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Uo.set(t,i)}catch(l){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${l}`)}const o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o);try{return await n.addModule(a),void Uo.set(t,a)}catch{URL.revokeObjectURL(a)}try{const l=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(l),Uo.set(t,l)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const rv=sv("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class fi extends Zb{constructor(e,n,i,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,o;const d=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||Qb,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",p=`${a=(o=e.origin)!=null?o:"https://api.elevenlabs.io",a.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${d}`,h=await fetch(p);if(!h.ok)throw new Error(`ElevenLabs API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(d){let u=d instanceof Error?d.message:String(d);throw d instanceof Error&&d.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var a;const l=new cr;try{const d=`room_${Date.now()}`,u=za("pcm_48000"),p=za("pcm_48000"),h=new fi(l,d,u,p,e),m=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await l.connect(m,n),await new Promise(g=>{if(h.isConnected)g();else{const y=()=>{l.off(Y.Connected,y),g()};l.on(Y.Connected,y)}}),l.name&&(h.conversationId=((c=l.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||l.name),await l.localParticipant.setMicrophoneEnabled(!0);const x=tv(e);return h.debug({type:ev,message:x}),await h.sendMessage(x),h}catch(d){throw await l.disconnect(),d}}setupRoomEventListeners(){var e=this;this.room.on(Y.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(Y.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(Y.ConnectionStateChanged,n=>{n===Ue.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(Y.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;wd(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(Y.TrackSubscribed,async function(n,i,r){if(n.kind===G.Kind.Audio&&r.identity.includes("agent")){const o=n,a=o.attach();if(a.autoplay=!0,a.controls=!1,e.outputDeviceId&&a.setSinkId)try{await a.setSinkId(e.outputDeviceId)}catch(l){console.warn("Failed to set output device for new audio element:",l)}a.style.display="none",document.body.appendChild(a),e.audioElements.push(a),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(Y.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(Y.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(G.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await rv(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=a=>{const[l,c]=a.data;if(c>.01){const d=iv(l.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:d,event_id:u}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(G.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await Jb(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:G.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function ov(t){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(t);switch(e){case"websocket":return Cd.create(t);case"webrtc":return fi.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function jd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function av(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(jd()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Xu extends po{static async startSession(e){const n=po.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await av(n.connectionDelay),i=await ov(e),new Xu(n,i)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),o}}}const Cm={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class ir{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:o,libsampleratePath:a}){let l=null,c=null;try{const p=bi({sampleRate:{ideal:e}},Cm);if(jd()&&i){const v=(await window.navigator.mediaDevices.enumerateDevices()).find(w=>w.kind==="audioinput"&&["airpod","headphone","earphone"].find(k=>w.label.toLowerCase().includes(k)));v&&(p.deviceId={ideal:v.deviceId})}r&&(p.deviceId=ir.getDeviceIdConstraint(r));const h=navigator.mediaDevices.getSupportedConstraints().sampleRate;l=new window.AudioContext(h?{sampleRate:e}:{});const m=l.createAnalyser();if(!h){const v=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await l.audioWorklet.addModule(v)}await rv(l.audioWorklet,o?.rawAudioProcessor);const x=bi({voiceIsolation:!0},p);c=await navigator.mediaDevices.getUserMedia({audio:x});const g=l.createMediaStreamSource(c),y=new AudioWorkletNode(l,"rawAudioProcessor");return y.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(m),m.connect(y),await l.resume(),new ir(l,m,y,c,g)}catch(p){var d,u;throw(d=c)==null||d.getTracks().forEach(h=>{h.stop()}),(u=l)==null||u.close(),p}}static getDeviceIdConstraint(e){if(e)return jd()?{ideal:e}:{exact:e}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=bi({},Cm);e&&(n.deviceId=ir.getDeviceIdConstraint(e));const i=bi({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(o=>{o.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const yM=sv("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class Ba{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let o=null,a=null;try{o=new AudioContext({sampleRate:e});const d=o.createAnalyser(),u=o.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const p=o.createMediaStreamDestination();a.srcObject=p.stream,u.connect(d),d.connect(p),await yM(o.audioWorklet,r?.audioConcatProcessor);const h=new AudioWorkletNode(o,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(u),await o.resume(),i&&a.setSinkId&&await a.setSinkId(i),new Ba(o,d,u,h,a)}catch(d){var l,c;throw(l=a)!=null&&l.parentNode&&a.parentNode.removeChild(a),(c=a)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),d}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Zu extends po{static async startSession(e){var n;const i=po.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,a=null,l=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var d;return l=await navigator.mediaDevices.getUserMedia({audio:!0}),await av(i.connectionDelay),o=await ov(e),[r,a]=await Promise.all([ir.create(bi({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Ba.create(bi({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(d=l)==null||d.getTracks().forEach(g=>{g.stop()}),l=null,new Zu(i,o,r,a,c)}catch(g){var u,p,h,m;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=l)==null||u.getTracks().forEach(y=>{y.stop()}),(p=o)==null||p.close(),await((h=r)==null?void 0:h.close()),await((m=a)==null?void 0:m.close());try{var x;await((x=c)==null?void 0:x.release()),c=null}catch{}throw g}}constructor(e,n,i,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:iv(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:xM(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=a=>{if(a.length===0)return 0;let l=0;for(let c=0;c<a.length;c++)l+=a[c]/255;return l/=a.length,l<0?0:l>1?1:l},this.setVolume=({volume:a})=>{const l=Number.isFinite(a)?Math.min(1,Math.max(0,a)):1;this.volume=l,this.connection instanceof fi?this.connection.setAudioVolume(l):this.output.gain.gain.value=l},this.input=i,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof fi||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof fi?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof fi?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof Cd)try{return await this.input.setInputDevice(r),this.input}catch(a){console.warn("Failed to change device on existing input, recreating:",a)}this.connection instanceof fi&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await ir.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof Cd)try{return await this.output.setOutputDevice(i),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof fi&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await Ba.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var jm;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(jm||(jm={}));var Tm,Em;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Tm||(Tm={})),(function(t){t.MANUAL="manual",t.VAD="vad"})(Em||(Em={}));class bM extends po{static startSession(e){return e.textOnly?Xu.startSession(e):Zu.startSession(e)}}function $r(){return $r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},$r.apply(null,arguments)}const vM=["micMuted","volume","serverLocation"];function SM(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function kM(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function wM(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function CM(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=(function(g,y){if(g==null)return{};var v={};for(var w in g)if({}.hasOwnProperty.call(g,w)){if(y.indexOf(w)!==-1)continue;v[w]=g[w]}return v})(t,vM),o=f.useRef(null),a=f.useRef(null),[l,c]=f.useState("disconnected"),[d,u]=f.useState(!1),[p,h]=f.useState("listening"),m=f.useRef(e),x=f.useRef(n);return m.current=e,x.current=n,f.useEffect(()=>{var g;e!==void 0&&(o==null||(g=o.current)==null||g.setMicMuted(e))},[e]),f.useEffect(()=>{var g;n!==void 0&&(o==null||(g=o.current)==null||g.setVolume({volume:n}))},[n]),f.useEffect(()=>()=>{var g;(g=o.current)==null||g.endSession()},[]),{startSession:async g=>{var y;if((y=o.current)!=null&&y.isOpen())return o.current.getId();if(a.current)return(await a.current).getId();try{var v,w,k,S,b,j,C,T,_,E;const N=SM(g?.serverLocation||i),L=kM(N),V=wM(N);return a.current=bM.startSession($r({},r??{},g??{},{origin:L,livekitUrl:g?.livekitUrl||r?.livekitUrl||V,overrides:$r({},(v=r?.overrides)!=null?v:{},(w=g?.overrides)!=null?w:{},{client:$r({},(k=r==null||(S=r.overrides)==null?void 0:S.client)!=null?k:{},(b=g==null||(j=g.overrides)==null?void 0:j.client)!=null?b:{},{source:(g==null||(C=g.overrides)==null||(C=C.client)==null?void 0:C.source)||(r==null||(T=r.overrides)==null||(T=T.client)==null?void 0:T.source)||"react_sdk",version:(g==null||(_=g.overrides)==null||(_=_.client)==null?void 0:_.version)||(r==null||(E=r.overrides)==null||(E=E.client)==null?void 0:E.version)||"0.12.1"})}),onConnect:g?.onConnect||r?.onConnect,onDisconnect:g?.onDisconnect||r?.onDisconnect,onError:g?.onError||r?.onError,onMessage:g?.onMessage||r?.onMessage,onAudio:g?.onAudio||r?.onAudio,onDebug:g?.onDebug||r?.onDebug,onUnhandledClientToolCall:g?.onUnhandledClientToolCall||r?.onUnhandledClientToolCall,onVadScore:g?.onVadScore||r?.onVadScore,onInterruption:g?.onInterruption||r?.onInterruption,onAgentToolRequest:g?.onAgentToolRequest||r?.onAgentToolRequest,onAgentToolResponse:g?.onAgentToolResponse||r?.onAgentToolResponse,onConversationMetadata:g?.onConversationMetadata||r?.onConversationMetadata,onMCPToolCall:g?.onMCPToolCall||r?.onMCPToolCall,onMCPConnectionStatus:g?.onMCPConnectionStatus||r?.onMCPConnectionStatus,onAsrInitiationMetadata:g?.onAsrInitiationMetadata||r?.onAsrInitiationMetadata,onAgentChatResponsePart:g?.onAgentChatResponsePart||r?.onAgentChatResponsePart,onModeChange:({mode:D})=>{var A;h(D),(A=g?.onModeChange||r?.onModeChange)==null||A({mode:D})},onStatusChange:({status:D})=>{var A;c(D),(A=g?.onStatusChange||r?.onStatusChange)==null||A({status:D})},onCanSendFeedbackChange:({canSendFeedback:D})=>{var A;u(D),(A=g?.onCanSendFeedbackChange||r?.onCanSendFeedbackChange)==null||A({canSendFeedback:D})}})),o.current=await a.current,m.current!==void 0&&o.current.setMicMuted(m.current),x.current!==void 0&&o.current.setVolume({volume:x.current}),o.current.getId()}finally{a.current=null}},endSession:async()=>{const g=o.current;o.current=null,await g?.endSession()},setVolume:({volume:g})=>{var y;(y=o.current)==null||y.setVolume({volume:g})},getInputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getOutputByteFrequencyData()},getInputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getInputVolume())!=null?g:0},getOutputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getOutputVolume())!=null?g:0},sendFeedback:g=>{var y;(y=o.current)==null||y.sendFeedback(g)},getId:()=>{var g;return(g=o.current)==null?void 0:g.getId()},sendContextualUpdate:g=>{var y;(y=o.current)==null||y.sendContextualUpdate(g)},sendUserMessage:g=>{var y;(y=o.current)==null||y.sendUserMessage(g)},sendUserActivity:()=>{var g;(g=o.current)==null||g.sendUserActivity()},sendMCPToolApprovalResult:(g,y)=>{var v;(v=o.current)==null||v.sendMCPToolApprovalResult(g,y)},changeInputDevice:async g=>{if(o.current&&"changeInputDevice"in o.current)return await o.current.changeInputDevice(g);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async g=>{if(o.current&&"changeOutputDevice"in o.current)return await o.current.changeOutputDevice(g);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:d,micMuted:e,isSpeaking:p==="speaking"}}const lv=({profile:t,replaceVariables:e=n=>n})=>{const[n,i]=f.useState({properties:!0,objections:!1,questions:!1}),r=it(),o=m=>{i(x=>({...x,[m]:!x[m]}))};if(!t||!t.name)return null;const a=m=>m?e(m).split(/\n|,/).map(g=>g.trim()).filter(Boolean):[],l=a(t.properties),c=a(t.typical_objections),d=a(t.important_questions),u={width:"100%",padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:R.slate[50],border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:`background-color ${r.transition.normal}`},p={...u,backgroundColor:r.primaryAccentLight},h={padding:r.space[4],backgroundColor:"white"};return s.jsxs("div",{style:{padding:r.space[4],display:"flex",flexDirection:"column",gap:r.space[2]},children:[l.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("properties"),style:n.properties?p:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.properties?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Eigenschaften"}),n.properties?s.jsx(zi,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(wt,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.properties&&s.jsx("div",{style:h,children:s.jsx("p",{style:{fontSize:r.fontSize.sm,color:R.slate[600],lineHeight:1.6,margin:0},children:l.join(", ")})})]}),c.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("objections"),style:n.objections?p:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.objections?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Typische Einwnde"}),n.objections?s.jsx(zi,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(wt,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.objections&&s.jsx("div",{style:h,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:c.map((m,x)=>s.jsxs("li",{style:{fontSize:r.fontSize.sm,color:R.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:r.space[2]},children:""}),s.jsx("span",{children:m})]},x))})})]}),d.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("questions"),style:n.questions?p:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.questions?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Wichtige Fragen"}),n.questions?s.jsx(zi,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(wt,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.questions&&s.jsx("div",{style:h,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:d.map((m,x)=>s.jsxs("li",{style:{fontSize:r.fontSize.sm,color:R.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:r.space[2]},children:""}),s.jsx("span",{children:m})]},x))})})]}),s.jsx("div",{style:{marginTop:r.space[4],padding:r.space[3],backgroundColor:r.primaryAccentLight,borderRadius:r.radius.lg,border:`1px solid ${r.primaryAccent}33`},children:s.jsx("p",{style:{fontSize:r.fontSize.xs,color:r.primaryAccent,textAlign:"center",margin:0},children:" Fr ein optimales Erlebnis empfiehlt sich die Nutzung von Kopfhrern mit Mikrofon."})})]})},cv=({hints:t,dynamicCoaching:e=null,isGenerating:n=!1,isConnected:i=!1})=>{const{branding:r}=Fe(),o=r?.["--header-gradient"]||ve["--header-gradient"],a=r?.["--header-text"]||ve["--header-text"],l=r?.["--icon-primary"]||ve["--icon-primary"],c=r?.["--primary-accent-light"]||ve["--primary-accent-light"],u=(m=>m?m.split(/\n/).map(x=>x.trim()).filter(Boolean):[])(t),p=e&&(e.content_impulses&&e.content_impulses.length>0||e.behavioral_cue||e.strategic_bridge),h=i&&(p||n);return s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden h-full flex flex-col min-h-0",children:[s.jsxs("div",{style:{background:o},className:"px-4 py-3 flex items-center gap-2 flex-shrink-0",children:[s.jsx(je,{className:"w-5 h-5",style:{color:a}}),s.jsx("h3",{className:"font-bold text-sm",style:{color:a},children:"Live Coaching"}),n&&s.jsx(ge,{className:"w-4 h-4 animate-spin ml-auto",style:{color:a}})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0",children:s.jsx(He,{mode:"wait",children:h?s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"space-y-4",children:n&&!p?s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(ge,{className:"w-8 h-8 mx-auto mb-2 animate-spin"}),s.jsx("p",{className:"text-xs",children:"Analysiere..."})]})}):s.jsxs(s.Fragment,{children:[e?.content_impulses?.length>0&&s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-500 uppercase tracking-wide",children:[s.jsx(Le,{className:"w-3.5 h-3.5"}),"Inhalt"]}),s.jsx("div",{className:"space-y-2",children:e.content_impulses.map((m,x)=>s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1+x*.05},className:"flex gap-2 items-start",children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:s.jsx("span",{className:"text-xs font-bold",style:{color:l},children:x+1})}),s.jsx("p",{className:"text-sm text-slate-700 leading-snug font-medium",children:m})]},x))})]}),e?.behavioral_cue&&s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.25},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-amber-600 uppercase tracking-wide",children:[s.jsx(wo,{className:"w-3.5 h-3.5"}),"Tonfall"]}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-amber-800",children:e.behavioral_cue})})]}),e?.strategic_bridge&&s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.35},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-emerald-600 uppercase tracking-wide",children:[s.jsx($e,{className:"w-3.5 h-3.5"}),"Strategie"]}),s.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-emerald-800",children:e.strategic_bridge})})]}),!p&&!n&&s.jsx("div",{className:"h-full flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(je,{className:"w-10 h-10 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-xs",children:"Warte auf Gesprchspartner..."})]})})]})},"dynamic-coaching"):s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:u.length===0?s.jsx("div",{className:"h-full flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(je,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]})}):s.jsx("div",{className:"space-y-3",children:u.map((m,x)=>s.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:x*.1},className:"flex gap-3 items-start",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:s.jsx(je,{className:"w-3.5 h-3.5",style:{color:l}})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:m})})]},x))})},"static-hints")})}),s.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-200 flex-shrink-0",children:s.jsx("p",{className:"text-xs text-slate-500 text-center",children:h?" Echtzeit-Coaching basierend auf dem Gesprch":" Hilfreiche Tipps fr ein erfolgreiches Gesprch"})})]})},jM=({isOpen:t,onClose:e,feedbackContent:n,audioAnalysisContent:i,isLoading:r})=>{const o=f.useCallback(h=>{h||e()},[e]),a=f.useMemo(()=>{if(!n)return null;try{let h=n.trim();return h.startsWith("```json")?h=h.replace(/```json\s*/g,"").replace(/```\s*$/g,""):h.startsWith("```")&&(h=h.replace(/```\s*/g,"").replace(/```\s*$/g,"")),JSON.parse(h)}catch(h){return console.error("Error parsing feedback JSON:",h),null}},[n]),l=f.useMemo(()=>{if(!i)return null;try{let h=i.trim();return h.startsWith("```json")?h=h.replace(/```json\s*/g,"").replace(/```\s*$/g,""):h.startsWith("```")&&(h=h.replace(/```\s*/g,"").replace(/```\s*$/g,"")),JSON.parse(h)}catch(h){return console.error("Error parsing audio analysis JSON:",h),null}},[i]),c=h=>{const m=Math.floor(h),x=h%1>=.5;return s.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(10)].map((g,y)=>s.jsx(Yt,{className:`w-4 h-4 ${y<m?"fill-amber-400 text-amber-400":y===m&&x?"fill-amber-200 text-amber-400":"text-slate-200"}`},y)),s.jsxs("span",{className:"ml-2 text-sm font-semibold text-slate-700",children:[h,"/10"]})]})},d=()=>a?s.jsxs("div",{className:"space-y-5",children:[a.summary&&s.jsx("div",{className:"p-4 bg-ocean-blue-50 border-l-4 border-ocean-blue-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Le,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-2",children:"Gesamteindruck"}),s.jsx("p",{className:"text-sm text-ocean-blue-800 leading-relaxed",children:a.summary})]})]})}),a.rating&&s.jsx("div",{className:"p-4 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50 border border-ocean-blue-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(pn,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-3",children:"Bewertung"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.rating.overall!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Gesamt"}),c(a.rating.overall)]}),a.rating.communication!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Kommunikation"}),c(a.rating.communication)]}),a.rating.motivation!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Motivation"}),c(a.rating.motivation)]}),a.rating.professionalism!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Professionalitt"}),c(a.rating.professionalism)]})]})]})]})}),a.strengths&&a.strengths.length>0&&s.jsx("div",{className:"p-4 bg-green-50 border-l-4 border-green-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($n,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-3",children:"Das hast du gut gemacht"}),s.jsx("ul",{className:"space-y-2",children:a.strengths.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-green-800 leading-relaxed",children:h})]},m))})]})]})}),a.improvements&&a.improvements.length>0&&s.jsx("div",{className:"p-4 bg-amber-50 border-l-4 border-amber-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Bt,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-amber-900 mb-3",children:"Das kann noch besser werden"}),s.jsx("ul",{className:"space-y-2",children:a.improvements.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-amber-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-amber-800 leading-relaxed",children:h})]},m))})]})]})}),a.tips&&a.tips.length>0&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border-l-4 border-ocean-teal-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(je,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-teal-900 mb-3",children:"Praktische Tipps fr dich"}),s.jsx("ul",{className:"space-y-2",children:a.tips.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx($e,{className:"w-4 h-4 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsx("span",{className:"text-sm text-ocean-teal-800 leading-relaxed",children:h})]},m))})]})]})})]}):s.jsx("div",{className:"space-y-4",children:s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Te,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-amber-800 font-medium mb-2",children:"Feedback konnte nicht strukturiert werden"}),s.jsx("div",{className:"text-sm text-amber-700 whitespace-pre-wrap",children:n})]})]})})}),u=()=>l?l.error?s.jsxs("div",{className:"space-y-4 mt-8",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b-2 border-amber-300",children:[s.jsx(wa,{className:"w-6 h-6 text-amber-600"}),s.jsx("h2",{className:"text-xl font-bold text-amber-900",children:"Audio-Analyse"})]}),s.jsx("div",{className:"p-4 bg-amber-50 border-l-4 border-amber-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(yn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-amber-900 mb-2",children:"Audio-Analyse nicht verfgbar"}),s.jsx("p",{className:"text-sm text-amber-800 leading-relaxed",children:l.summary}),l.errorMessage&&s.jsxs("div",{className:"text-xs text-amber-700 mt-3 p-3 bg-amber-100 rounded-lg",children:[s.jsx("span",{className:"font-semibold",children:"Details:"}),s.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-xs",children:l.errorMessage})]}),l.troubleshooting&&l.troubleshooting.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-xs font-semibold text-amber-900 mb-2",children:"Lsungsvorschlge:"}),s.jsx("ul",{className:"space-y-1",children:l.troubleshooting.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2 text-xs text-amber-800",children:[s.jsx("span",{className:"text-amber-600 mt-0.5",children:""}),s.jsx("span",{children:h})]},m))})]}),!l.troubleshooting&&s.jsxs("p",{className:"text-xs text-amber-600 mt-3",children:[s.jsx("span",{className:"font-semibold",children:"Tipp:"})," Dies kann passieren, wenn das Mikrofon bereits von ElevenLabs verwendet wird. Versuche das Gesprch erneut zu starten."]})]})]})})]}):s.jsxs("div",{className:"space-y-5 mt-8",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b-2 border-ocean-blue-300",children:[s.jsx(wa,{className:"w-6 h-6 text-ocean-blue-600"}),s.jsx("h2",{className:"text-xl font-bold text-ocean-blue-900",children:"Audio-Analyse deiner Sprechweise"})]}),l.summary&&s.jsx("div",{className:"p-4 bg-ocean-blue-50 border-l-4 border-ocean-blue-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Ux,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-2",children:"Gesamteindruck"}),s.jsx("p",{className:"text-sm text-ocean-blue-800 leading-relaxed",children:l.summary})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.clarity&&s.jsx("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Gn,{className:"w-5 h-5 text-slate-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Deutlichkeit"}),c(l.clarity.rating),s.jsx("p",{className:"text-xs text-slate-700 mt-2",children:l.clarity.feedback})]})]})}),l.pace&&s.jsx("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($x,{className:"w-5 h-5 text-slate-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Sprechgeschwindigkeit"}),c(l.pace.rating),l.pace.wordsPerMinute&&s.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:["~",l.pace.wordsPerMinute," Wrter/Min"]}),s.jsx("p",{className:"text-xs text-slate-700 mt-2",children:l.pace.feedback})]})]})}),l.fillerWords&&s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(yn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-2",children:"Fllwrter"}),c(l.fillerWords.rating),l.fillerWords.count!==void 0&&s.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Anzahl: ",l.fillerWords.count]}),l.fillerWords.examples&&l.fillerWords.examples.length>0&&s.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Beispiele: ",l.fillerWords.examples.join(", ")]}),s.jsx("p",{className:"text-xs text-amber-800 mt-2",children:l.fillerWords.feedback})]})]})}),l.nervousness&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Lr,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-red-900 mb-2",children:"Nervositt"}),c(l.nervousness.rating),l.nervousness.indicators&&l.nervousness.indicators.length>0&&s.jsx("ul",{className:"text-xs text-red-700 mt-2 space-y-1",children:l.nervousness.indicators.map((h,m)=>s.jsxs("li",{children:[" ",h]},m))}),s.jsx("p",{className:"text-xs text-red-800 mt-2",children:l.nervousness.feedback})]})]})}),l.confidence&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(pn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-2",children:"Selbstsicherheit"}),c(l.confidence.rating),s.jsx("p",{className:"text-xs text-green-700 mt-2",children:l.confidence.feedback})]})]})}),l.tonalModulation&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border border-ocean-teal-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Ya,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-ocean-teal-900 mb-2",children:"Tonmodulation"}),c(l.tonalModulation.rating),s.jsx("p",{className:"text-xs text-ocean-teal-700 mt-2",children:l.tonalModulation.feedback})]})]})})]}),l.strengths&&l.strengths.length>0&&s.jsx("div",{className:"p-4 bg-green-50 border-l-4 border-green-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($n,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-3",children:"Strken deiner Sprechweise"}),s.jsx("ul",{className:"space-y-2",children:l.strengths.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-green-800 leading-relaxed",children:h})]},m))})]})]})}),l.overallImprovement&&l.overallImprovement.length>0&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border-l-4 border-ocean-teal-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(je,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-teal-900 mb-3",children:"Verbesserungsvorschlge"}),s.jsx("ul",{className:"space-y-2",children:l.overallImprovement.map((h,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx($e,{className:"w-4 h-4 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsx("span",{className:"text-sm text-ocean-teal-800 leading-relaxed",children:h})]},m))})]})]})})]}):null,p=()=>r?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ocean-blue-600"}),s.jsx("p",{className:"mt-4 text-slate-600",children:"Feedback wird generiert..."}),s.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Das kann einen Moment dauern"})]}):n?s.jsxs("div",{className:"space-y-6 max-h-[65vh] overflow-y-auto pr-2",children:[d(),u()]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Te,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-600",children:"Kein Feedback verfgbar."})]});return s.jsx(En,{open:t,onOpenChange:o,children:s.jsxs(Rn,{className:"max-w-3xl max-h-[90vh] flex flex-col",children:[s.jsxs(In,{className:"flex-shrink-0",children:[s.jsxs(_n,{className:"text-2xl flex items-center gap-2",children:[s.jsx(pn,{className:"w-6 h-6 text-ocean-blue-600"}),"Dein Bewerbungsgesprch-Feedback"]}),s.jsx(Vn,{children:"Hier ist deine persnliche Auswertung basierend auf dem gefhrten Gesprch"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto py-2",children:p()}),s.jsx(Wn,{className:"flex-shrink-0 pt-4 border-t border-slate-100",children:s.jsx(he,{onClick:e,className:"w-full sm:w-auto",children:"Schlieen"})})]})})},fl=({isOpen:t,onClose:e,mode:n="audio",selectedMicrophoneId:i,onMicrophoneChange:r,selectedCameraId:o,onCameraChange:a})=>{const[l,c]=f.useState([]),[d,u]=f.useState([]),[p,h]=f.useState(!0),[m,x]=f.useState(null),[g,y]=f.useState(i),[v,w]=f.useState(o),k=it();f.useEffect(()=>{t&&(S(),y(i),w(o))},[t,i,o]);const S=async()=>{h(!0),x(null);try{const C=n==="audio-video"?{audio:!0,video:!0}:{audio:!0};(await navigator.mediaDevices.getUserMedia(C)).getTracks().forEach(L=>L.stop());const _=await navigator.mediaDevices.enumerateDevices(),E=_.filter(L=>L.kind==="audioinput"),N=_.filter(L=>L.kind==="videoinput");c(E),n==="audio-video"&&u(N)}catch(C){console.error("Error loading devices:",C),C.name==="NotAllowedError"||C.name==="PermissionDeniedError"?x("Zugriff auf Gerte verweigert"):x("Fehler beim Laden der Gerte")}finally{h(!1)}},b=()=>{g!==i&&r?.(g),n==="audio-video"&&v!==o&&a?.(v),e()},j=(C,T,_)=>{if(C.label){let E=C.label;return E=E.replace(/^Default - /,""),E=E.replace(/^Kommunikation - /,""),E=E.replace(/^Standard - /,""),E.length>40&&(E=E.substring(0,37)+"..."),E}return _==="audio"?`Mikrofon ${T+1}`:`Kamera ${T+1}`};return t?s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3}}),s.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",borderRadius:k.radius.xl,width:"90%",maxWidth:"480px",maxHeight:"80vh",overflow:"hidden",boxShadow:k.shadow.xl,zIndex:1001},onClick:C=>C.stopPropagation(),children:[s.jsxs("div",{style:{background:k.headerGradient,padding:`${k.space[4]} ${k.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:k.space["2.5"],color:"white"},children:[s.jsx(ii,{size:20}),s.jsx("h3",{style:{margin:0,fontSize:k.fontSize.base,fontWeight:600},children:"Gerte-Einstellungen"})]}),s.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:k.radius.md,padding:k.space["1.5"],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(rn,{size:18,color:"white"})})]}),s.jsx("div",{style:{padding:k.space[5],maxHeight:"calc(80vh - 140px)",overflowY:"auto"},children:p?s.jsxs("div",{style:{textAlign:"center",padding:k.space[8]},children:[s.jsx("div",{style:{width:"40px",height:"40px",border:`3px solid ${R.slate[200]}`,borderTopColor:k.primaryAccent,borderRadius:"50%",animation:"spin 1s linear infinite",margin:`0 auto ${k.space[3]}`}}),s.jsx("p",{style:{color:R.slate[500],fontSize:k.fontSize.sm},children:"Gerte werden geladen..."}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):m?s.jsxs("div",{style:{textAlign:"center",padding:k.space[6]},children:[s.jsx(Te,{size:40,color:R.red[500],style:{marginBottom:k.space[3]}}),s.jsx("p",{style:{color:R.red[600],fontWeight:500},children:m}),s.jsxs("button",{onClick:S,style:{marginTop:k.space[4],display:"inline-flex",alignItems:"center",gap:k.space[2],padding:`${k.space["2.5"]} ${k.space[4]}`,borderRadius:k.radius.md,border:`1px solid ${R.slate[300]}`,background:"white",cursor:"pointer",fontSize:k.fontSize.sm,color:R.slate[700]},children:[s.jsx(Zt,{size:16}),"Erneut versuchen"]})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:k.space[5]},children:[s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:k.space[2],fontSize:k.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:k.space["2.5"]},children:[s.jsx(We,{size:18,color:k.primaryAccent}),"Mikrofon"]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:k.space["1.5"]},children:l.map((C,T)=>s.jsxs("button",{onClick:()=>y(C.deviceId),style:{display:"flex",alignItems:"center",gap:k.space[3],padding:`${k.space[3]} ${k.space["3.5"]}`,borderRadius:k.radius.md,border:g===C.deviceId?`2px solid ${k.primaryAccent}`:`1px solid ${R.slate[200]}`,background:g===C.deviceId?`${k.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:k.transition.normal},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:k.radius.md,background:g===C.deviceId?k.primaryAccent:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(We,{size:16,color:g===C.deviceId?"white":R.slate[500]})}),s.jsx("span",{style:{flex:1,fontSize:k.fontSize.sm,color:g===C.deviceId?k.primaryAccent:R.slate[700],fontWeight:g===C.deviceId?500:400},children:j(C,T,"audio")}),g===C.deviceId&&s.jsx(ti,{size:18,color:k.primaryAccent})]},C.deviceId||T))}),g&&s.jsx("div",{style:{marginTop:k.space[3]},children:s.jsx(UR,{deviceId:g,branding:k})})]}),n==="audio-video"&&d.length>0&&s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:k.space[2],fontSize:k.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:k.space["2.5"]},children:[s.jsx(pt,{size:18,color:k.primaryAccent}),"Kamera"]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:k.space["1.5"]},children:d.map((C,T)=>s.jsxs("button",{onClick:()=>w(C.deviceId),style:{display:"flex",alignItems:"center",gap:k.space[3],padding:`${k.space[3]} ${k.space["3.5"]}`,borderRadius:k.radius.md,border:v===C.deviceId?`2px solid ${k.primaryAccent}`:`1px solid ${R.slate[200]}`,background:v===C.deviceId?`${k.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:k.transition.normal},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:k.radius.md,background:v===C.deviceId?k.primaryAccent:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(pt,{size:16,color:v===C.deviceId?"white":R.slate[500]})}),s.jsx("span",{style:{flex:1,fontSize:k.fontSize.sm,color:v===C.deviceId?k.primaryAccent:R.slate[700],fontWeight:v===C.deviceId?500:400},children:j(C,T,"video")}),v===C.deviceId&&s.jsx(ti,{size:18,color:k.primaryAccent})]},C.deviceId||T))})]})]})}),!p&&!m&&s.jsxs("div",{style:{padding:`${k.space[4]} ${k.space[5]}`,borderTop:`1px solid ${R.slate[200]}`,display:"flex",gap:k.space[3],justifyContent:"flex-end"},children:[s.jsx("button",{onClick:e,style:{padding:`${k.space["2.5"]} ${k.space[5]}`,borderRadius:k.radius.md,border:`1px solid ${R.slate[300]}`,background:"white",color:R.slate[600],fontSize:k.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:b,style:{padding:`${k.space["2.5"]} ${k.space[5]}`,borderRadius:k.radius.md,border:"none",background:k.primaryAccent,color:"white",fontSize:k.fontSize.sm,fontWeight:600,cursor:"pointer"},children:"Speichern"})]})]})]}):null};function TM({userRole:t="Bewerber",agentRole:e="Interviewer",agentProperties:n="",agentPainPoints:i="",transcriptHistory:r=[],nextAgentInput:o=""}){const a=r.slice(-4).map(l=>`${l.role==="agent"?e:t}: ${l.text}`).join(`
`);return`# SYSTEM ROLLE
Du bist die "Live-Coaching-Engine" der Karriereplattform "KarriereHeld".
Deine Aufgabe ist es, Echtzeit-Coaching whrend eines Gesprchs mit einem KI-Agenten zu liefern.

# INPUT DATEN

## Rolle des Users
${t}

## Rolle der KI (Gesprchspartner)
${e}

## Eigenschaften des KI-Agenten
${n||"Keine spezifischen Eigenschaften definiert"}

## Typische Einwnde/Pain Points des Agenten
${i||"Keine spezifischen Pain Points definiert"}

## Transkript-Historie (letzte Wechsel)
${a||"[Gesprch hat gerade begonnen]"}

## Nchste Aussage des Agenten (Vorschau)
"${o}"

# DEINE AUFGABE
Analysiere die nchste Aussage des Agenten und generiere sofort Coaching-Impulse fr den User.

# LOGIK & STRATEGIE
1. **Inhaltliche Brcke:** Was sollte der User inhaltlich antworten? Welche konkreten Punkte oder Beispiele sollte er/sie einbringen?

2. **Einwand-Vorwegnahme:** Prfe die Pain Points des Agenten. Wenn die Frage auch nur entfernt damit zu tun hat, gib dem User einen Tipp, wie er/sie diesen Einwand proaktiv entkrften kann.

3. **Verhalten (Soft Skills):** Gib einen Hinweis zum Tonfall und Auftreten, basierend auf den Eigenschaften des Agenten:
   - Bei "netter Typ"  offen, freundlich, persnlich
   - Bei "streng"  przise, faktenbasiert, strukturiert
   - Bei "kritisch"  selbstbewusst, konkrete Belege liefern

# OUTPUT REGELN
- Antworte AUSSCHLIESSLICH im JSON-Format
- Fasse dich extrem kurz (max. 3-4 Wrter pro Stichpunkt)
- KEINE ganzen Stze zum Vorlesen
- Sprache der Ausgabe: Deutsch
- Maximal 3 content_impulses

# JSON STRUKTUR (strikt einhalten!)
{
  "content_impulses": ["Stichpunkt 1", "Stichpunkt 2", "Stichpunkt 3"],
  "behavioral_cue": "Kurzer Tonfall-Hinweis",
  "strategic_bridge": "Strategischer Tipp zu Pain Points"
}

Antworte NUR mit dem JSON, keine Erklrungen davor oder danach.`}const EM=["gemini-2.0-flash-exp","gemini-2.0-flash","gemini-1.5-flash-latest"],fa={content_impulses:[],behavioral_cue:"",strategic_bridge:""};function RM(t){let e=t.trim();e.startsWith("```json")?e=e.replace(/```json\n?/,"").replace(/\n?```$/,""):e.startsWith("```")&&(e=e.replace(/```\n?/,"").replace(/\n?```$/,""));try{const n=JSON.parse(e);return{content_impulses:Array.isArray(n.content_impulses)?n.content_impulses.slice(0,3):[],behavioral_cue:typeof n.behavioral_cue=="string"?n.behavioral_cue:"",strategic_bridge:typeof n.strategic_bridge=="string"?n.strategic_bridge:""}}catch(n){return console.error("[COACHING] Failed to parse response:",n),console.error("[COACHING] Raw response:",t),fa}}function IM(t){return t.message?.includes("404")||t.message?.includes("not found")}async function dv({apiKey:t,nextAgentInput:e,transcriptHistory:n=[],scenarioContext:i={}}){const r="[COACHING]";if(!t)return console.error(`${r} API key is missing`),fa;if(!e||e.trim().length===0)return fa;const o=TM({userRole:i.userRole||"Bewerber",agentRole:i.agentRole||"Interviewer",agentProperties:i.agentProperties||"",agentPainPoints:i.agentPainPoints||"",transcriptHistory:n,nextAgentInput:e});for(const a of EM)try{const p=(await(await new Xx(t).getGenerativeModel({model:a}).generateContent(o)).response).text();return RM(p)}catch(l){if(console.error(`${r} Error with ${a}:`,l.message),IM(l))continue;break}return console.error(`${r} All models failed, returning default coaching`),fa}function uv(t){if(t.role!=="agent"||t.text.length<20)return!1;const e=["mhm","ja","okay","verstehe","interessant","gut"],n=t.text.toLowerCase().trim();return!e.some(i=>n===i)}function hv(t){const e=t.interviewer_profile||{};return{userRole:t.user_role_label||"Bewerber",agentRole:e.role||"Interviewer",agentProperties:e.properties||"",agentPainPoints:Array.isArray(e.typical_objections)?e.typical_objections.join(`
`):e.typical_objections||""}}const _M=({scenario:t,variables:e={},selectedMicrophoneId:n,onEnd:i,onNavigateToSession:r})=>{const{branding:o,demoCode:a}=Fe(),l=J=>{if(!J)return J;let ke=J;return Object.entries(e).forEach(([Pe,Me])=>{const ln=new RegExp(`\\{\\{${Pe}\\}\\}`,"g");ke=ke.replace(ln,Me||"")}),ke},c=f.useMemo(()=>{const J=o?.["--header-gradient"]||ve["--header-gradient"],ke=o?.["--header-text"]||ve["--header-text"],Pe=o?.["--icon-primary"]||ve["--icon-primary"],Me=o?.["--icon-secondary"]||ve["--icon-secondary"],ln=o?.["--app-bg-color"]||ve["--app-bg-color"],ci=o?.["--primary-accent"]||ve["--primary-accent"],Es=o?.["--primary-accent-light"]||ve["--primary-accent-light"];return{headerGradient:J,headerText:ke,iconPrimary:Pe,iconSecondary:Me,appBgColor:ln,primaryAccent:ci,primaryAccentLight:Es,userBubbleGradient:"linear-gradient(to bottom right, #14b8a6, #0d9488)",agentAvatarGradient:J}},[o]),[d,u]=f.useState(null),[p,h]=f.useState(null),[m,x]=f.useState(0),[g,y]=f.useState(null),[v,w]=f.useState(!1),[k,S]=f.useState([]),[b,j]=f.useState(!0),[C,T]=f.useState(!1),[_,E]=f.useState(!1),[N,L]=f.useState(null),[V,D]=f.useState(null),[A,F]=f.useState(!1),[B,M]=f.useState(!1),[z,U]=f.useState(!1),[W,q]=f.useState(!0),le=ks(1024),[de,ue]=f.useState(n),[$,Se]=f.useState(!1),[xe,Ke]=f.useState(null),[st,Ve]=f.useState(!1),[ft,St]=f.useState(80),Ze=f.useRef(null),[Ct,qt]=f.useState(0),Ge=f.useRef(null),Qe=f.useRef(null);f.useRef(!1);const ze=f.useRef(null),et=f.useRef(null),se=f.useRef(0),Z=f.useRef([]),re=f.useRef(null),te=f.useRef(null),fe=f.useRef(null),K=f.useRef(null);me.getElevenLabsApiKey();const Q=t.agent_id||me.getElevenLabsAgentId(),Ee=t.voice_id||"kaGxVtjLwllv1bi2GFag",dt=()=>{let J=t.content||"";return t.interviewer_profile&&(J+=`

## Dein Profil:
`,t.interviewer_profile.name&&(J+=`
Dein Name: ${t.interviewer_profile.name}`),t.interviewer_profile.role&&(J+=`
Deine Rolle: ${t.interviewer_profile.role}`),t.interviewer_profile.properties&&(J+=`

### Deine Eigenschaften:
${t.interviewer_profile.properties}`),t.interviewer_profile.typical_objections&&(J+=`

### Typische Einwnde, die du vorbringen solltest:
${t.interviewer_profile.typical_objections}`),t.interviewer_profile.important_questions&&(J+=`

### Wichtige Fragen, die du stellen solltest:
${t.interviewer_profile.important_questions}`)),J},tt=async()=>{try{const J=de?{audio:{deviceId:{exact:de}}}:{audio:!0},ke=await navigator.mediaDevices.getUserMedia(J);K.current=ke;const Pe=new(window.AudioContext||window.webkitAudioContext);re.current=Pe;const Me=Pe.createAnalyser();Me.fftSize=256,Me.smoothingTimeConstant=.8,te.current=Me,Pe.createMediaStreamSource(ke).connect(Me);const ci=new Uint8Array(Me.frequencyBinCount),Es=()=>{if(!te.current)return;te.current.getByteFrequencyData(ci);const gl=ci.reduce((xl,To)=>xl+To,0)/ci.length;qt(gl/255),fe.current=requestAnimationFrame(Es)};Es()}catch(J){console.error("[ROLEPLAY] Audio analysis error:",J)}},Re=()=>{fe.current&&(cancelAnimationFrame(fe.current),fe.current=null),re.current&&(re.current.close(),re.current=null),K.current&&(K.current.getTracks().forEach(J=>J.stop()),K.current=null),qt(0)},mt=async(J,ke)=>{const Pe=me.getGeminiApiKey();if(!Pe){console.warn("[COACHING] No Gemini API key available");return}if(uv({role:"agent",text:J}))try{Ve(!0),Ke(null);const Me=await dv({apiKey:Pe,nextAgentInput:J,transcriptHistory:ke.slice(-4),scenarioContext:hv(t)});Ke(Me)}catch(Me){console.error("[COACHING] Failed to generate coaching:",Me)}finally{Ve(!1)}},Je=CM({onConnect:()=>{const J=Date.now();h(J),et.current=J},onDisconnect:()=>{},onMessage:J=>{if(J.source==="ai"||J.source==="user"){const ke=et.current,Pe=Date.now(),Me=se.current,ln=ke?Math.floor((Pe-ke)/1e3):0;se.current=ln;const ci=Math.floor(Me/60),Es=Me%60,th=`${ci.toString().padStart(2,"0")}:${Es.toString().padStart(2,"0")}`,gl={role:J.source==="ai"?"agent":"user",text:J.message,timestamp:Pe,elapsedTime:Me,timeLabel:th};S(xl=>{const To=[...xl,gl];return Z.current=To,To}),J.source==="ai"&&setTimeout(()=>{mt(J.message,Z.current)},100)}},onError:J=>{console.error(" [RoleplaySession] Error:",J),y(J.message||"Ein Fehler ist aufgetreten.")}});f.useEffect(()=>{ze.current&&ze.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},[k]),f.useEffect(()=>{Je.status==="disconnected"&&k.length>0&&!A&&!_&&Ts()},[Je.status,k.length,A,_]),f.useEffect(()=>(Je.status==="connected"&&p?Ge.current=setInterval(()=>{const J=Math.floor((Date.now()-p)/1e3);x(J)},1e3):Ge.current&&clearInterval(Ge.current),()=>{Ge.current&&clearInterval(Ge.current)}),[Je.status,p]),f.useEffect(()=>(Je.status==="connected"?tt():Re(),()=>{Re()}),[Je.status]),f.useEffect(()=>()=>{Je.status==="connected"&&Je.endSession()},[]),f.useEffect(()=>{const J=()=>{const Pe=document.querySelector('header, .site-header, [role="banner"]');if(Pe){const Me=Pe.offsetHeight;St(Me)}};J();const ke=document.querySelector('header, .site-header, [role="banner"]');if(ke){const Pe=new ResizeObserver(J);Pe.observe(ke),Ze.current=Pe}return window.addEventListener("resize",J),()=>{Ze.current&&Ze.current.disconnect(),window.removeEventListener("resize",J)}},[]),f.useEffect(()=>{window.scrollTo(0,0)},[]);const ji=async()=>{w(!0);const J=Date.now();h(J),et.current=J,await xr()},xr=async()=>{try{y(null);const J=me.getCurrentUser(),ke={agent_id:Q,scenario_id:t.id>0?t.id:null,variables:e,user_name:J.firstName||"Gast",demo_code:a||null},Pe=await c0(ke);u(Pe.id);const Me={...e};t.interviewer_profile&&(t.interviewer_profile.name&&(Me.interviewer_name=t.interviewer_profile.name),t.interviewer_profile.role&&(Me.interviewer_role=t.interviewer_profile.role));const ln={agentId:Q,connectionType:"websocket",dynamicVariables:Me,...de&&{inputDeviceId:de},overrides:{agent:{prompt:{prompt:dt()},firstMessage:t.initial_message||"Hallo! Ich freue mich auf unser Gesprch."},...t.voice_id&&{tts:{voiceId:t.voice_id}}}};t.voice_id&&console.log("[RoleplaySession] Using voice override:",t.voice_id),Qe.current=await Je.startSession(ln);const ci=dt();me.logPrompt("ELEVENLABS_LIVE_SESSION",`Live-Training gestartet: ${t.title}`,ci,{scenario_id:t.id,scenario_title:t.title,agent_id:Q,voice_id:Ee,conversation_id:Qe.current,first_message:t.initial_message,variables:JSON.stringify(Me)})}catch(J){console.error(" [RoleplaySession] Failed to start:",J),y(J.message||"Verbindung fehlgeschlagen.")}},Ts=async()=>{if(T(!1),Je.status==="connected"&&Je.endSession(),k.length===0){y("Das Gesprch war zu kurz. Bitte versuche es erneut.");return}try{F(!0);const J={title:t.title,description:t.description,variables:e,role_type:t.role_type||"interview",user_role_label:t.user_role_label||"Bewerber",interviewer_profile:t.interviewer_profile,feedback_prompt:t.feedback_prompt};let ke=null;if(d&&Qe.current)try{await r2(d,Qe.current),ke=await s2(d,10,3e3)}catch(Me){console.warn("[RoleplaySession] Could not fetch audio for analysis:",Me.message)}const Pe=await o0(k,J,ke);if(d&&Qe.current&&await a0(d,k,Pe.feedbackContent,Pe.audioAnalysisContent,m,Qe.current),F(!1),r&&d){const Me={id:d,scenario_id:t.id,transcript:JSON.stringify(k),feedback_json:Pe.feedbackContent,audio_analysis_json:Pe.audioAnalysisContent,duration:m,conversation_id:Qe.current,created_at:new Date().toISOString()};r(Me)}else L(Pe.feedbackContent),D(Pe.audioAnalysisContent),E(!0)}catch(J){console.error(" [RoleplaySession] Analysis failed:",J),y(J.message||"Fehler bei der Analyse."),F(!1)}},yr=()=>{E(!1),i&&i()},ee=J=>{switch(J){case"easy":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"hard":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},De=J=>{switch(J){case"easy":return"Einfach";case"medium":return"Mittel";case"hard":return"Schwer";default:return J}},Ye=J=>J?J.split(/\n/).map(ke=>ke.trim()).filter(Boolean):[];return g?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(Te,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Verbindungsfehler"}),s.jsx("p",{className:"text-slate-600 mb-6",children:g}),s.jsx(he,{onClick:i,className:"w-full",children:"Zurck zur bersicht"})]})}):A?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ge,{className:"w-16 h-16 animate-spin mx-auto mb-4",style:{color:c.iconPrimary}}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Feedback wird generiert..."}),s.jsx("p",{className:"text-slate-600",children:"Das kann einen Moment dauern"}),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:s.jsx(P.div,{className:"h-full",style:{background:c.headerGradient},initial:{width:"0%"},animate:{width:"100%"},transition:{duration:3,repeat:1/0}})})})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{height:"calc(100vh - 120px)",minHeight:"600px"},className:"bewerbungstrainer-session-layout bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-2 lg:p-4 overflow-hidden",children:[s.jsxs("div",{className:"w-full h-full gap-3 lg:gap-4 overflow-hidden",style:{display:le?"flex":"grid",flexDirection:le?"column":void 0,gridTemplateColumns:le?void 0:"minmax(250px, 1fr) minmax(350px, 2fr) minmax(250px, 1fr)",gridTemplateRows:le?void 0:"1fr",alignItems:le?void 0:"stretch",padding:"0 8px"},children:[!le&&s.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"relative h-full min-h-0",children:s.jsx(cv,{hints:t.coaching_hints,dynamicCoaching:xe,isGenerating:st,isConnected:Je.status==="connected"})}),s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col min-h-[400px] order-1 lg:order-none",children:s.jsx("div",{className:"flex-1 overflow-y-auto",children:t.interviewer_profile&&t.interviewer_profile.name?s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{style:{background:c.headerGradient},className:"rounded-t-2xl px-4 lg:px-6 py-3 lg:py-4 shadow-xl",children:[le&&s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:l(t.interviewer_profile.name),className:"w-12 h-12 rounded-full border-2 border-white shadow-lg object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-white shadow-lg bg-white flex items-center justify-center",children:s.jsx(Et,{className:"w-6 h-6 text-slate-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-lg font-bold text-white",children:l(t.interviewer_profile.name)}),t.interviewer_profile.role&&s.jsx("p",{className:"text-blue-100 text-xs font-medium",children:l(t.interviewer_profile.role)})]})]}),!le&&s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center justify-center gap-4 mb-4",children:t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:l(t.interviewer_profile.name),className:"w-20 h-20 rounded-full border-4 border-white shadow-lg object-cover"}):s.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-lg bg-white flex items-center justify-center",children:s.jsx(Et,{className:"w-10 h-10 text-slate-400"})})}),s.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-1",children:l(t.interviewer_profile.name)}),t.interviewer_profile.role&&s.jsx("p",{className:"text-blue-100 text-center text-sm font-medium mb-3",children:l(t.interviewer_profile.role)})]}),v&&s.jsxs("div",{className:"flex items-center justify-center gap-3 pt-3 border-t border-white/20",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[Je.status==="connecting"&&s.jsxs(s.Fragment,{children:[s.jsx(ge,{className:"w-4 h-4 text-white animate-spin"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbinde..."})]}),Je.status==="connected"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbunden"})]})]}),s.jsx("div",{className:"h-4 w-px bg-white/30"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(qe,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"font-mono text-sm font-semibold text-white",children:lt(m)})]})]})]}),s.jsxs("div",{className:"bg-white px-4 py-3 shadow-xl flex justify-center gap-3",children:[s.jsx("button",{onClick:()=>Se(!0),className:"p-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-colors",title:"Gerte-Einstellungen",children:s.jsx(ii,{className:"w-5 h-5 text-slate-600"})}),v?Je.status==="connected"?s.jsxs(he,{onClick:()=>T(!0),size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[s.jsx(rn,{className:"w-5 h-5 mr-2"}),"Gesprch beenden"]}):Je.status==="disconnected"?s.jsxs(he,{disabled:!0,size:"lg",className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg opacity-70 cursor-not-allowed",children:[s.jsx(ge,{className:"w-5 h-5 mr-2 animate-spin"}),"Gesprch wurde beendet..."]}):s.jsxs(he,{disabled:!0,size:"lg",className:"bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg opacity-50 cursor-not-allowed",children:[s.jsx(ge,{className:"w-5 h-5 mr-2 animate-spin"}),"Verbindung wird hergestellt..."]}):s.jsxs(he,{onClick:ji,size:"lg",disabled:!de,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(We,{className:"w-5 h-5 mr-2"}),t.interviewer_profile?.name?`${l(t.interviewer_profile.name)} anrufen`:"Anrufen"]})]}),Je.status==="connected"&&s.jsx("div",{className:"bg-white px-4 py-3 border-t border-slate-100",children:s.jsx(or,{audioLevel:Ct,isActive:Ct>.05,variant:"bars",size:"md",accentColor:c.primaryAccent})}),le&&s.jsx("div",{className:"bg-white px-4 py-2",children:s.jsxs("button",{onClick:()=>q(!W),className:"w-full flex items-center justify-between text-sm font-medium text-slate-700 hover:text-blue-600 transition-colors",children:[s.jsx("span",{children:"Profil-Details"}),s.jsx(wt,{className:`w-4 h-4 transition-transform ${W?"rotate-180":""}`})]})}),s.jsx(He,{children:(W||!le)&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"lg:flex-1 lg:overflow-y-auto bg-white lg:rounded-b-2xl shadow-xl overflow-hidden",children:s.jsx(lv,{profile:t.interviewer_profile,replaceVariables:l})})})]}):s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8 text-center",children:[s.jsx("div",{className:"w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center",style:{background:c.headerGradient},children:s.jsx(us,{className:"w-12 h-12",style:{color:c.headerText}})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:t.title}),s.jsx("p",{className:"text-slate-600 text-sm mb-6",children:t.description}),s.jsx("span",{className:`inline-block px-3 py-1 rounded-lg text-xs font-semibold ${ee(t.difficulty)}`,children:De(t.difficulty)})]})})})}),!le&&s.jsx(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full min-h-0 overflow-hidden",children:s.jsxs("div",{className:"h-full min-h-0 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col",children:[s.jsx("div",{style:{background:c.headerGradient},className:"px-4 py-3 flex items-center flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-2",style:{color:c.headerText},children:[s.jsx(Le,{className:"w-4 h-4"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-3",children:k.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(Le,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):s.jsxs(He,{children:[k.map((J,ke)=>s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:`flex gap-2 ${J.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:J.role==="agent"?t.interviewer_profile&&t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:l(t.interviewer_profile.name)||"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:c.headerGradient},children:s.jsx(us,{className:"w-4 h-4",style:{color:c.headerText}})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(Et,{className:"w-4 h-4 text-white"})}),J.timeLabel&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:J.timeLabel})]})}),s.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${J.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:s.jsx("p",{className:"text-xs leading-relaxed",children:J.text})})]},ke)),s.jsx("div",{ref:ze})]})})]})})]}),le&&s.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-3 z-50",children:[s.jsxs(P.button,{onClick:()=>M(!B),style:{background:c.headerGradient,color:c.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[s.jsx(je,{className:"w-6 h-6"}),t.coaching_hints&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-orange-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:t.coaching_hints.split(`
`).filter(Boolean).length})]}),s.jsxs(P.button,{onClick:()=>U(!z),style:{background:c.headerGradient,color:c.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[s.jsx(Le,{className:"w-6 h-6"}),k.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:k.length})]})]}),s.jsx(He,{children:B&&le&&s.jsxs(s.Fragment,{children:[s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>M(!1),className:"fixed inset-0 bg-black/50 z-40"}),s.jsx(P.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 max-h-[70vh] rounded-t-3xl overflow-hidden",children:s.jsxs("div",{className:"bg-white h-full flex flex-col",children:[s.jsxs("div",{style:{background:c.headerGradient},className:"px-4 py-3 flex items-center justify-between flex-shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:c.headerText},children:[s.jsx(je,{className:"w-5 h-5"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Coaching"}),st&&s.jsx(ge,{className:"w-4 h-4 animate-spin"})]}),s.jsx("button",{onClick:()=>M(!1),style:{color:c.headerText},children:s.jsx(rn,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:Je.status==="connected"&&(xe||st)?s.jsx(s.Fragment,{children:st&&!xe?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(ge,{className:"w-8 h-8 mx-auto mb-2 animate-spin"}),s.jsx("p",{className:"text-xs",children:"Analysiere..."})]})}):xe?s.jsxs(s.Fragment,{children:[xe.content_impulses?.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-500 uppercase tracking-wide",children:[s.jsx(Le,{className:"w-3.5 h-3.5"}),"Inhalt"]}),xe.content_impulses.map((J,ke)=>s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:ke*.05},className:"flex gap-2 items-start",children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c.primaryAccentLight},children:s.jsx("span",{className:"text-xs font-bold",style:{color:c.iconPrimary},children:ke+1})}),s.jsx("p",{className:"text-sm text-slate-700 leading-snug font-medium",children:J})]},ke))]}),xe.behavioral_cue&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-amber-600 uppercase tracking-wide",children:[s.jsx(Bt,{className:"w-3.5 h-3.5"}),"Tonfall"]}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-amber-800",children:xe.behavioral_cue})})]}),xe.strategic_bridge&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-emerald-600 uppercase tracking-wide",children:[s.jsx(Bt,{className:"w-3.5 h-3.5"}),"Strategie"]}),s.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-emerald-800",children:xe.strategic_bridge})})]})]}):s.jsxs("div",{className:"text-center text-slate-400 py-8",children:[s.jsx(je,{className:"w-10 h-10 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-xs",children:"Warte auf Gesprchspartner..."})]})}):Ye(t.coaching_hints).length===0?s.jsxs("div",{className:"text-center text-slate-400 py-8",children:[s.jsx(je,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]}):Ye(t.coaching_hints).map((J,ke)=>s.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:ke*.1},className:"flex gap-3 items-start p-3 rounded-lg",style:{backgroundColor:c.primaryAccentLight},children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{backgroundColor:c.primaryAccentLight},children:s.jsx(je,{className:"w-3.5 h-3.5",style:{color:c.iconPrimary}})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:J})})]},ke))}),s.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-200 flex-shrink-0",children:s.jsx("p",{className:"text-xs text-slate-500 text-center",children:Je.status==="connected"?" Echtzeit-Coaching basierend auf dem Gesprch":" Hilfreiche Tipps fr ein erfolgreiches Gesprch"})})]})})]})}),s.jsx(He,{children:z&&le&&s.jsxs(s.Fragment,{children:[s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>U(!1),className:"fixed inset-0 bg-black/50 z-40"}),s.jsx(P.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 max-h-[70vh] rounded-t-3xl overflow-hidden",children:s.jsxs("div",{className:"bg-white h-full flex flex-col",children:[s.jsxs("div",{style:{background:c.headerGradient},className:"px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:c.headerText},children:[s.jsx(Le,{className:"w-5 h-5"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]}),s.jsx("button",{onClick:()=>U(!1),style:{color:c.headerText},children:s.jsx(rn,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:k.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(Le,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):s.jsxs(He,{children:[k.map((J,ke)=>s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:`flex gap-2 ${J.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:J.role==="agent"?t.interviewer_profile&&t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:l(t.interviewer_profile.name)||"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:c.headerGradient},children:s.jsx(us,{className:"w-4 h-4",style:{color:c.headerText}})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(Et,{className:"w-4 h-4 text-white"})}),J.timeLabel&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:J.timeLabel})]})}),s.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${J.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:s.jsx("p",{className:"text-xs leading-relaxed",children:J.text})})]},ke)),s.jsx("div",{ref:ze})]})})]})})]})})]}),s.jsx(En,{open:C,onOpenChange:T,children:s.jsxs(Rn,{children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Gesprch beenden?"}),s.jsx(Vn,{children:"Mchtest du das Rollenspiel wirklich beenden? Du erhltst anschlieend dein Feedback."})]}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>T(!1),children:"Abbrechen"}),s.jsxs(he,{onClick:Ts,children:[s.jsx($n,{className:"w-4 h-4 mr-2"}),"Beenden & Feedback erhalten"]})]})]})}),_&&s.jsx(jM,{isOpen:_,onClose:yr,feedbackContent:N,audioAnalysisContent:V,isLoading:!1}),s.jsx(fl,{isOpen:$,onClose:()=>Se(!1),mode:"audio",selectedMicrophoneId:de,onMicrophoneChange:ue})]})},NM="wss://karriereheld-ws-proxy.onrender.com/ws",AM=({scenario:t,variables:e={},selectedMicrophoneId:n,onEnd:i,onNavigateToSession:r})=>{const{branding:o,demoCode:a}=Fe(),l=f.useMemo(()=>{const Z=o?.["--header-gradient"]||ve["--header-gradient"],re=o?.["--header-text"]||ve["--header-text"],te=o?.["--primary-accent"]||ve["--primary-accent"];return{headerGradient:Z,headerText:re,primaryAccent:te}},[o]),[c,d]=f.useState(null),[u,p]=f.useState("disconnected"),[h,m]=f.useState(null),[x,g]=f.useState([]),[y,v]=f.useState(!1),[w,k]=f.useState(null),[S,b]=f.useState(0),[j,C]=f.useState(!1),[T,_]=f.useState(!1),[E,N]=f.useState(!1),[L,V]=f.useState(n),D=ks(1024),A=f.useRef(null),F=f.useRef(null),B=f.useRef(null),M=f.useRef(null),z=f.useRef(null),U=f.useRef([]),W=f.useRef(!1),q=f.useRef(0),le=f.useRef(null),de=f.useRef(null),ue=f.useRef([]),$=f.useRef(null),Se=f.useRef(null),[xe,Ke]=f.useState(null),[st,Ve]=f.useState(!1);f.useEffect(()=>(u==="connected"&&w&&(de.current=setInterval(()=>{b(Math.floor((Date.now()-w)/1e3))},1e3)),()=>{de.current&&clearInterval(de.current)}),[u,w]),f.useEffect(()=>{le.current&&le.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[x]),f.useEffect(()=>()=>{et()},[]);const ft=async()=>{p("connecting"),m(null);try{const Z=t.agent_id||me.getElevenLabsAgentId();if(!Z)throw new Error("Keine Agent-ID konfiguriert");const re={agent_id:Z,scenario_id:t.id,variables:e,user_name:"Gast",demo_code:a||null,connection_mode:"proxy"},te=await c0(re);d(te.id);const fe=await navigator.mediaDevices.getUserMedia({audio:{deviceId:L?{exact:L}:void 0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});B.current=fe;const K=`${NM}?agent_id=${Z}`,Q=new WebSocket(K);A.current=Q,Q.binaryType="arraybuffer",Q.onopen=()=>{},Q.onmessage=ce=>{St(ce)},Q.onclose=ce=>{u!=="analyzing"&&p("disconnected")},Q.onerror=ce=>{console.error("[ProxySession] WebSocket error:",ce),m("Verbindung zum Proxy fehlgeschlagen"),p("disconnected")}}catch(Z){console.error("[ProxySession] Start failed:",Z),m(Z.message||"Verbindung fehlgeschlagen"),p("disconnected")}},St=Z=>{if(Z.data instanceof ArrayBuffer){Ge(Z.data);return}try{const re=JSON.parse(Z.data);switch(re.type){case"conversation_initiation_metadata":re.conversation_initiation_metadata_event?.conversation_id&&(Se.current=re.conversation_initiation_metadata_event.conversation_id);const fe={type:"conversation_initiation_client_data",dynamic_variables:{...e,interviewer_name:t?.interviewer_profile?.name||"Interviewer",interviewer_role:t?.interviewer_profile?.role||"",interviewer_company:t?.interviewer_profile?.company||""},conversation_config_override:{agent:{prompt:{prompt:t?.content||""},first_message:t?.initial_message||"Hallo! Ich freue mich auf unser Gesprch."}}};if(A.current?.readyState===WebSocket.OPEN){A.current.send(JSON.stringify(fe));const K=Date.now();p("connected"),k(K),$.current=K,B.current&&qt(B.current,A.current)}break;case"audio":if(re.audio_event?.audio_base_64){const K=atob(re.audio_event.audio_base_64),Q=new Uint8Array(K.length);for(let ce=0;ce<K.length;ce++)Q[ce]=K.charCodeAt(ce);Ge(Q.buffer)}break;case"agent_response":re.agent_response_event?.agent_response&&(Ze("agent",re.agent_response_event.agent_response),setTimeout(()=>{Ct(re.agent_response_event.agent_response,ue.current)},100));break;case"user_transcript":re.user_transcription_event?.user_transcript&&Ze("user",re.user_transcription_event.user_transcript);break;case"interruption":U.current=[];break;case"ping":A.current?.readyState===WebSocket.OPEN&&A.current.send(JSON.stringify({type:"pong",event_id:re.ping_event?.event_id}));break;case"internal_vad_score":case"internal_turn_probability":case"internal_tentative_agent_response":break;case"error":console.error("[ProxySession] Server error:",re),m(re.message||re.error_message||"Server-Fehler");break;default:break}}catch(re){console.error("[ProxySession] Message parse error:",re)}},Ze=(Z,re)=>{if(!re||re.trim()==="")return;const te={role:Z,text:re,timestamp:Date.now(),timeLabel:lt(Math.floor((Date.now()-($.current||Date.now()))/1e3))};g(fe=>{const K=[...fe,te];return ue.current=K,K})},Ct=async(Z,re)=>{const te=me.getGeminiApiKey();if(!te){console.warn("[COACHING] No Gemini API key available");return}if(uv({role:"agent",text:Z}))try{Ve(!0),Ke(null);const fe=await dv({apiKey:te,nextAgentInput:Z,transcriptHistory:re.slice(-4),scenarioContext:hv(t)});Ke(fe)}catch(fe){console.error("[COACHING] Failed to generate coaching:",fe)}finally{Ve(!1)}},qt=async(Z,re)=>{try{const te=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});M.current=te;const fe=te.createMediaStreamSource(Z),K=te.createScriptProcessor(4096,1,1);K.onaudioprocess=Q=>{if(re.readyState!==WebSocket.OPEN||T)return;const ce=Q.inputBuffer.getChannelData(0),Ee=new Int16Array(ce.length);for(let mt=0;mt<ce.length;mt++){const Je=Math.max(-1,Math.min(1,ce[mt]));Ee[mt]=Je<0?Je*32768:Je*32767}const dt=new Uint8Array(Ee.buffer);let tt="";for(let mt=0;mt<dt.length;mt++)tt+=String.fromCharCode(dt[mt]);const Re=btoa(tt);re.send(JSON.stringify({user_audio_chunk:Re}))},fe.connect(K),K.connect(te.destination),F.current={processor:K,source:fe,audioContext:te}}catch(te){console.error("[ProxySession] Failed to start audio capture:",te)}},Ge=Z=>{U.current.push(Z),W.current||Qe()},Qe=async()=>{if(U.current.length===0){W.current=!1;return}W.current=!0;const Z=U.current.shift();try{(!z.current||z.current.state==="closed")&&(z.current=new(window.AudioContext||window.webkitAudioContext),q.current=0);const te=z.current;te.state==="suspended"&&await te.resume();const fe=new Int16Array(Z),K=new Float32Array(fe.length);for(let tt=0;tt<fe.length;tt++)K[tt]=fe[tt]/32768;const Q=te.createBuffer(1,K.length,16e3);Q.getChannelData(0).set(K);const ce=te.createBufferSource();ce.buffer=Q,ce.connect(te.destination);const Ee=te.currentTime,dt=Math.max(Ee,q.current);ce.start(dt),q.current=dt+Q.duration,ce.onended=()=>{Qe()}}catch(re){console.error("[ProxySession] Audio playback error:",re),Qe()}},ze=async()=>{C(!1),A.current&&(A.current.close(),A.current=null),U.current=[],W.current=!1,q.current=0,F.current&&(F.current.processor&&F.current.processor.disconnect(),F.current.source&&F.current.source.disconnect(),F.current=null),B.current&&(B.current.getTracks().forEach(re=>re.stop()),B.current=null),z.current&&z.current.state!=="closed"&&(z.current.close().catch(()=>{}),z.current=null),M.current&&M.current.state!=="closed"&&(M.current.close().catch(()=>{}),M.current=null);const Z=$.current?Math.floor((Date.now()-$.current)/1e3):S;if(!c){console.error("[ProxySession] No session ID, cannot save"),et(),i&&i();return}if(ue.current.length===0){m("Das Gesprch war zu kurz. Bitte versuche es erneut.");return}try{v(!0);const re={title:t.title||"Live-Simulation",description:t.description||"",variables:e,role_type:t.role_type||"simulation",user_role_label:t.user_role_label||"Teilnehmer",interviewer_profile:t.interviewer_profile,feedback_prompt:t.feedback_prompt};let te=null,fe=null;if(Se.current)try{if(fe=(await me.saveAudioFromElevenLabs(Se.current,c))?.data?.url,fe)try{const ce=await fetch(fe);ce.ok&&(te=await ce.blob())}catch(ce){console.warn("[ProxySession] Failed to fetch audio blob:",ce.message)}}catch(Q){console.warn("[ProxySession] Failed to save audio:",Q.message)}const K=await o0(ue.current,re,te);if(await a0(c,ue.current,K.feedbackContent,K.audioAnalysisContent,Z,Se.current),v(!1),r&&c){const Q={id:c,scenario_id:t.id,transcript:JSON.stringify(ue.current),feedback_json:K.feedbackContent,audio_analysis_json:K.audioAnalysisContent,duration:Z,conversation_id:Se.current,created_at:new Date().toISOString()};r(Q)}}catch(re){console.error(" [ProxySession] Analysis failed:",re),m(re.message||"Fehler bei der Analyse."),v(!1)}},et=()=>{A.current&&(A.current.close(),A.current=null),F.current&&(F.current.processor&&F.current.processor.disconnect(),F.current.source&&F.current.source.disconnect(),F.current=null),M.current&&M.current.state!=="closed"&&(M.current.close(),M.current=null),z.current&&z.current.state!=="closed"&&(z.current.close(),z.current=null),q.current=0,B.current&&(B.current.getTracks().forEach(Z=>Z.stop()),B.current=null),U.current=[],Se.current=null,p("disconnected")},se=()=>{_(!T),B.current&&B.current.getAudioTracks().forEach(Z=>{Z.enabled=T})};return y?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ge,{className:"w-16 h-16 animate-spin mx-auto mb-4",style:{color:l.primaryAccent}}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Feedback wird generiert..."}),s.jsx("p",{className:"text-slate-600",children:"Das kann einen Moment dauern"}),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:s.jsx(P.div,{className:"h-full",style:{background:l.headerGradient},initial:{width:"0%"},animate:{width:"100%"},transition:{duration:3,repeat:1/0}})})})]})}):h&&u==="disconnected"?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(Te,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Verbindungsfehler"}),s.jsx("p",{className:"text-slate-600 mb-6",children:h}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(he,{onClick:i,variant:"outline",className:"flex-1",children:"Zurck"}),s.jsx(he,{onClick:ft,className:"flex-1",children:"Erneut versuchen"})]})]})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{height:"calc(100vh - 120px)",minHeight:"600px"},className:"bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-2 lg:p-4 overflow-hidden",children:s.jsxs("div",{className:"w-full h-full gap-3 lg:gap-4 overflow-hidden",style:{display:D?"flex":"grid",flexDirection:D?"column":void 0,gridTemplateColumns:D?void 0:"minmax(250px, 1fr) minmax(350px, 2fr) minmax(250px, 1fr)",padding:"0 8px"},children:[!D&&s.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"relative h-full",children:s.jsx(cv,{hints:t.coaching_hints,dynamicCoaching:xe,isGenerating:st,isConnected:u==="connected"})}),s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col min-h-[400px]",children:[s.jsxs("div",{style:{background:l.headerGradient},className:"rounded-t-2xl px-4 lg:px-6 py-3 lg:py-4 shadow-xl",children:[s.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-white/20 rounded-full",children:[s.jsx(tT,{className:"w-3.5 h-3.5 text-white"}),s.jsx("span",{className:"text-xs font-medium text-white",children:"Proxy Modus (WebSocket)"})]})}),s.jsx("div",{className:"flex items-center justify-center gap-4 mb-3",children:t.interviewer_profile?.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:t.interviewer_profile.name,className:"w-16 h-16 lg:w-20 lg:h-20 rounded-full border-4 border-white shadow-lg object-cover"}):s.jsx("div",{className:"w-16 h-16 lg:w-20 lg:h-20 rounded-full border-4 border-white shadow-lg bg-white flex items-center justify-center",children:s.jsx(Et,{className:"w-8 h-8 lg:w-10 lg:h-10 text-slate-400"})})}),s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-white text-center mb-1",children:t.interviewer_profile?.name||t.title}),u==="connected"&&s.jsxs("div",{className:"flex items-center justify-center gap-3 pt-3 border-t border-white/20",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbunden"})]}),s.jsx("div",{className:"h-4 w-px bg-white/30"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(qe,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"font-mono text-sm font-semibold text-white",children:lt(S)})]})]})]}),s.jsxs("div",{className:"bg-white px-4 py-3 shadow-xl flex justify-center gap-3",children:[s.jsx("button",{onClick:()=>N(!0),className:"p-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-colors",children:s.jsx(ii,{className:"w-5 h-5 text-slate-600"})}),u==="disconnected"?s.jsxs(he,{onClick:ft,size:"lg",className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[s.jsx(zr,{className:"w-5 h-5 mr-2"}),"Gesprch starten"]}):u==="connecting"?s.jsxs(he,{disabled:!0,size:"lg",className:"bg-slate-400 text-white font-semibold text-base py-6 px-8 rounded-xl",children:[s.jsx(ge,{className:"w-5 h-5 mr-2 animate-spin"}),"Verbinde..."]}):s.jsxs(s.Fragment,{children:[s.jsx(he,{onClick:se,size:"lg",variant:T?"destructive":"outline",className:"rounded-xl",children:T?s.jsx(Fx,{className:"w-5 h-5"}):s.jsx(We,{className:"w-5 h-5"})}),s.jsxs(he,{onClick:()=>C(!0),size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[s.jsx(Jj,{className:"w-5 h-5 mr-2"}),"Beenden"]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto bg-white rounded-b-2xl shadow-xl",children:t.interviewer_profile&&s.jsx(lv,{profile:t.interviewer_profile})})]}),!D&&s.jsx(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full min-h-0 overflow-hidden",children:s.jsxs("div",{className:"h-full min-h-0 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col",children:[s.jsx("div",{style:{background:l.headerGradient},className:"px-4 py-3 flex items-center flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-2",style:{color:l.headerText},children:[s.jsx(Le,{className:"w-4 h-4"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live-Transkript"})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-3",children:x.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(Le,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Das Gesprch erscheint hier in Echtzeit"})]})}):s.jsxs(He,{children:[x.map((Z,re)=>s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-2 ${Z.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"flex-shrink-0",children:Z.role==="agent"?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:l.headerGradient},children:s.jsx(us,{className:"w-4 h-4 text-white"})}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(Et,{className:"w-4 h-4 text-white"})})}),s.jsxs("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${Z.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:[s.jsx("p",{className:"text-xs leading-relaxed",children:Z.text}),s.jsx("span",{className:`text-[10px] mt-1 block ${Z.role==="agent"?"text-slate-400":"text-teal-100"}`,children:Z.timeLabel})]})]},re)),s.jsx("div",{ref:le})]})})]})})]})}),s.jsx(En,{open:j,onOpenChange:C,children:s.jsxs(Rn,{children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Gesprch beenden?"}),s.jsx(Vn,{children:"Mchtest du das Gesprch beenden und zur Analyse gehen?"})]}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>C(!1),children:"Weitermachen"}),s.jsx(he,{onClick:ze,children:"Beenden & Analyse"})]})]})}),s.jsx(fl,{isOpen:E,onClose:()=>N(!1),mode:"audio",selectedMicrophoneId:L,onMicrophoneChange:V})]})},MM={auftreten:Lx,selbstbewusstsein:pn,koerpersprache:Et,kommunikation:Le,professionalitaet:pn,inhalt:je},PM=(t,e)=>{const n=t;return n>=90?"Ausgezeichnet!":n>=80?"Sehr gut!":n>=70?"Gut!":n>=60?"Solide Leistung":n>=50?"Ausbaufhig":"Weiter ben!"},DM=({score:t,size:e=120,primaryAccent:n,isHeader:i=!1,branding:r})=>{const o=Math.min(100,Math.max(0,t||0)),a=(e-12)/2,l=a*2*Math.PI,c=l-o/100*l,d=Xn(t,n);return s.jsxs("div",{style:{position:"relative",width:e,height:e},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r:a,fill:"none",stroke:i?"rgba(255,255,255,0.3)":r.borderColor,strokeWidth:10}),s.jsx(P.circle,{cx:e/2,cy:e/2,r:a,fill:"none",stroke:d,strokeWidth:10,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:c},transition:{duration:1,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3.5,fontWeight:700,color:d},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:i?"#ffffff":r.textMuted},children:"von 100"})]})]})},OM=({audioUrl:t,primaryAccent:e,durationHint:n,branding:i})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(0),[d,u]=f.useState(n||0),[p,h]=f.useState(!0),[m,x]=f.useState(null);f.useEffect(()=>{if(!t)return;h(!0),x(null),u(n||0);const k=new Audio;r.current=k;const S=()=>{const C=k.duration;C&&isFinite(C)&&C>0&&u(C),h(!1)},b=()=>{const C=k.duration;C&&isFinite(C)&&C>0&&u(C)},j=()=>{h(!1);const C=k.duration;C&&isFinite(C)&&C>0&&u(C)};return k.addEventListener("loadedmetadata",S),k.addEventListener("durationchange",b),k.addEventListener("canplaythrough",j),k.addEventListener("timeupdate",()=>c(k.currentTime)),k.addEventListener("play",()=>a(!0)),k.addEventListener("pause",()=>a(!1)),k.addEventListener("ended",()=>a(!1)),k.addEventListener("error",()=>{x("Audio nicht verfgbar"),h(!1)}),k.src=t,k.load(),()=>{k.pause(),k.removeEventListener("loadedmetadata",S),k.removeEventListener("durationchange",b),k.removeEventListener("canplaythrough",j),k.src=""}},[t,n]);const g=()=>{r.current&&(o?r.current.pause():r.current.play())},y=k=>{const S=k.currentTarget.getBoundingClientRect(),b=(k.clientX-S.left)/S.width;r.current&&(r.current.currentTime=b*d)},v=k=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+k,d)))};if(m)return s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px",color:i.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Te,{size:16})," ",m]});if(!t)return null;const w=d>0?l/d*100:0;return s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsx("div",{onClick:y,style:{height:"8px",background:i.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${w}%`,height:"100%",background:e||"#0d9488",borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>v(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(Za,{size:20})}),s.jsx("button",{onClick:g,disabled:p,style:{width:"48px",height:"48px",borderRadius:"50%",background:e||"#0d9488",border:"none",cursor:p?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:p?.7:1},children:p?s.jsx(ge,{size:22,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):o?s.jsx(Xa,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx(Ht,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>v(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(Qa,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:i.textMuted},children:[lt(l)," / ",lt(d)]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},LM=({sessionId:t,conversationId:e,primaryAccent:n,branding:i})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(!1),[d,u]=f.useState(0),[p,h]=f.useState(0),[m,x]=f.useState(null),[g,y]=f.useState(!0);f.useEffect(()=>{if(!e){y(!1),x("Keine Audio-Aufnahme verfgbar");return}const b=bu(t);return y(!0),x(null),fetch(b,{headers:{"X-WP-Nonce":Lt()},credentials:"same-origin"}).then(j=>{if(!j.ok)throw new Error(`HTTP ${j.status}`);return j.blob()}).then(j=>{const C=URL.createObjectURL(j),T=new Audio(C);r.current=T,T._objectUrl=C,T.addEventListener("loadedmetadata",()=>{h(T.duration),y(!1)}),T.addEventListener("timeupdate",()=>u(T.currentTime)),T.addEventListener("play",()=>a(!0)),T.addEventListener("pause",()=>a(!1)),T.addEventListener("ended",()=>a(!1)),T.addEventListener("error",()=>{x("Audio konnte nicht abgespielt werden."),y(!1)})}).catch(()=>{x("Audio nicht verfgbar."),y(!1)}),()=>{r.current&&(r.current.pause(),r.current._objectUrl&&URL.revokeObjectURL(r.current._objectUrl),r.current=null)}},[t,e]);const v=()=>{r.current&&(o?r.current.pause():r.current.play())},w=()=>{r.current&&(r.current.muted=!l,c(!l))},k=b=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+b,p)))},S=b=>{const j=b.currentTarget.getBoundingClientRect(),C=(b.clientX-j.left)/j.width;r.current&&(r.current.currentTime=C*p)};return g?s.jsxs("div",{style:{background:i.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ge,{size:24,color:n,style:{animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:i.textMuted,marginTop:"8px"},children:"Audio wird geladen..."})]}):m?s.jsxs("div",{style:{background:i.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(Te,{size:24,color:i.textMuted,style:{margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:i.textMuted,marginTop:"8px"},children:m})]}):s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:i.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(We,{size:18,color:n})," Gesprchsaufnahme"]}),s.jsx("div",{onClick:S,style:{height:"8px",background:i.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${d/p*100||0}%`,height:"100%",background:n,borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>k(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(Za,{size:20})}),s.jsx("button",{onClick:v,style:{width:"48px",height:"48px",borderRadius:"50%",background:n,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:o?s.jsx(Xa,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx(Ht,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>k(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(Qa,{size:20})}),s.jsx("button",{onClick:w,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted,marginLeft:"auto"},children:l?s.jsx(Gx,{size:20}):s.jsx(Gn,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:i.textMuted},children:[lt(d)," / ",lt(p)]})]})},zM=({entry:t,index:e,primaryAccent:n,branding:i})=>{const r=t.role==="user";return s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",flexShrink:0,background:r?n:i.disabledBg,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Et,{size:16,color:r?"#fff":i.textSecondary})}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:r?n:i.textMuted,marginBottom:"4px"},children:r?"Du":"Interviewer"}),s.jsx("p",{style:{fontSize:"14px",color:i.textMain,lineHeight:1.6,margin:0},children:t.text||t.message})]})]})},BM=({answer:t,index:e,primaryAccent:n,branding:i})=>{const[r,o]=f.useState(!1),a=t.feedback?typeof t.feedback=="string"?JSON.parse(t.feedback):t.feedback:null,l=t.audio_analysis?typeof t.audio_analysis=="string"?JSON.parse(t.audio_analysis):t.audio_analysis:null,c=t.transcript==="[Keine Sprache erkannt]"||l?.speech_rate==="keine_sprache";return s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:e*.05},style:{background:"#fff",borderRadius:"16px",border:`1px solid ${i.borderColor}`,overflow:"hidden",marginBottom:"16px"},children:[s.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:"16px 20px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",textAlign:"left"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",color:n,fontWeight:700,fontSize:"14px",flexShrink:0},children:e+1}),s.jsx("div",{style:{flex:1,minWidth:0},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:i.textMain,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.question_text||`Frage ${e+1}`})}),t.overall_score!==null&&t.overall_score!==void 0&&s.jsx("span",{style:{fontSize:"16px",fontWeight:700,color:c?i.textMuted:Xn(t.overall_score*10,n)},children:c?"":Math.round(t.overall_score*10)}),s.jsx(wt,{size:18,color:i.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(He,{children:r&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 20px 20px",borderTop:`1px solid ${i.borderColor}`,paddingTop:"16px"},children:[t.audio_url&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(We,{size:14,color:n})," Deine Aufnahme"]}),s.jsx(OM,{audioUrl:t.audio_url,primaryAccent:n,durationHint:t.audio_duration_seconds,branding:i})]}),t.transcript&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Gt,{size:14,color:n})," Transkript"]}),s.jsxs("p",{style:{fontSize:"13px",color:c?i.textMuted:i.textSecondary,lineHeight:1.6,background:i.cardBgHover,padding:"12px 16px",borderRadius:"10px",margin:0,fontStyle:"italic"},children:['"',t.transcript,'"']})]}),a?.scores&&!c&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Yt,{size:14,color:n})," Bewertung"]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"8px"},children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Prsentation"},{key:"overall",label:"Gesamt"}].map(({key:d,label:u})=>{const p=a.scores[d],h=p!=null?p*10:null;return s.jsxs("div",{style:{padding:"10px 8px",background:d==="overall"?`${n}15`:i.cardBgHover,borderRadius:"8px",textAlign:"center",border:d==="overall"?`1px solid ${n}30`:"none"},children:[s.jsx("div",{style:{fontSize:"16px",fontWeight:700,color:h!=null?Xn(h,n):i.textMuted},children:h!=null?Math.round(h):"-"}),s.jsx("div",{style:{fontSize:"10px",color:i.textMuted,marginTop:"2px"},children:u})]},d)})})]}),a?.summary&&s.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,lineHeight:1.5,marginBottom:"12px"},children:a.summary}),a?.strengths?.length>0&&!c&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:i.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Jt,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.strengths.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.improvements?.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:i.warning,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Te,{size:12})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.improvements.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.tips?.length>0&&!c&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(je,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.tips.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),l&&!c&&s.jsxs("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${i.borderColor}`},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(We,{size:14,color:n})," Sprechanalyse"]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:[l.speech_rate&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Sprechtempo"}),s.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:i.textMain,textTransform:"capitalize"},children:l.speech_rate==="optimal"?" Optimal":l.speech_rate==="zu_schnell"?" Zu schnell":l.speech_rate==="zu_langsam"?" Zu langsam":l.speech_rate})]}),l.filler_words&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Fllwrter"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:l.filler_words.count<=2?i.success:l.filler_words.count<=5?i.warning:i.error},children:[l.filler_words.count||0," erkannt"]}),l.filler_words.words?.length>0&&s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginTop:"4px"},children:l.filler_words.words.slice(0,5).join(", ")})]}),l.confidence_score!=null&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Selbstsicherheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Xn(l.confidence_score,n)},children:[l.confidence_score,"%"]})]}),l.clarity_score!=null&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Xn(l.clarity_score,n)},children:[l.clarity_score,"%"]})]})]}),l.notes&&s.jsx("p",{style:{fontSize:"12px",color:i.textMuted,marginTop:"10px",fontStyle:"italic"},children:l.notes})]})]})})})]})},FM=({isOpen:t,onClose:e,onConfirm:n,isDeleting:i,primaryAccent:r,branding:o})=>t?s.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:e,children:s.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:o.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Pt,{size:24,color:o.error})}),s.jsx("div",{children:s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:o.textMain,margin:0},children:"Session lschen?"})})]}),s.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,lineHeight:1.6,marginBottom:"24px"},children:"Mchtest du diese Session wirklich lschen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:e,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:`1px solid ${o.disabledBg}`,backgroundColor:"white",color:o.textMain,fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",opacity:i?.5:1},children:"Abbrechen"}),s.jsx("button",{onClick:n,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:"none",backgroundColor:o.error,color:"white",fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",opacity:i?.7:1},children:i?s.jsxs(s.Fragment,{children:[s.jsx(ge,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Pt,{size:16}),"Lschen"]})})]})]})}):null,UM=({category:t,primaryAccent:e,branding:n})=>{const[i,r]=f.useState(!1),o=MM[t.category]||Yt,a=Xn(t.score,e);return s.jsxs("div",{style:{background:"#fff",borderRadius:"12px",border:`1px solid ${n.borderColor}`,overflow:"hidden",marginBottom:"10px"},children:[s.jsxs("button",{onClick:()=>r(!i),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${a}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(o,{size:18,color:a})}),s.jsx("div",{style:{flex:1,textAlign:"left"},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:n.textMain,margin:0},children:t.label})}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:700,color:a},children:[Math.round(t.score),"%"]}),s.jsx(wt,{size:18,color:n.textMuted,style:{transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(He,{children:i&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${n.borderColor}`,paddingTop:"12px"},children:[t.feedback&&s.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,lineHeight:1.5,marginBottom:"10px"},children:t.feedback}),t.strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"10px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.success,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Jt,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.strengths.map((l,c)=>s.jsx("li",{children:l},c))})]}),t.improvements?.length>0&&s.jsxs("div",{children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.warning,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(je,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.improvements.map((l,c)=>s.jsx("li",{children:l},c))})]})]})})})]})},WM=({session:t,type:e,scenario:n,onBack:i,onContinueSession:r,onRepeatSession:o,onDeleteSession:a})=>{const l=it(),c=l.headerGradient,d=l.primaryAccent,[u,p]=f.useState([]),[h,m]=f.useState(!0),[x,g]=f.useState(null),[y,v]=f.useState(!1),[w,k]=f.useState(!1),[S,b]=f.useState(null),[j,C]=f.useState(n),T=e==="video",_=e==="simulator",E=e==="roleplay",N=(()=>{const W=t?.questions||t?.questions_json;if(!W)return!1;try{const q=typeof W=="string"?JSON.parse(W):W;return Array.isArray(q)&&q.length>0}catch{return!1}})(),L=(()=>{if(!_||!N)return!1;const W=t?.total_questions||0,q=t?.completed_questions||0;return W>0&&q<W})(),V=async()=>{if(a){k(!0);try{await a(t,e)}catch(W){console.error("Failed to delete session:",W),k(!1),v(!1)}}};f.useEffect(()=>{_&&t?.id?D():E&&t?.id?A():m(!1)},[t?.id,e]);const D=async()=>{try{m(!0);const q=await(await fetch(`${ni()}/simulator/sessions/${t.id}/answers`,{headers:{"X-WP-Nonce":Lt()}})).json();q.success&&q.data?.answers?p(q.data.answers):Array.isArray(q.data)&&p(q.data)}catch(W){console.error("Failed to load answers:",W),g("Fehler beim Laden der Antworten")}finally{m(!1)}},A=async()=>{try{m(!0);const W=await l0(t.id);if(b({...t,...W,feedback:i0(W.feedback_json||t.feedback_json),audioAnalysis:s0(W.audio_analysis_json||t.audio_analysis_json),transcript:r0(W.transcript||t.transcript)}),!n&&W.scenario_id)try{const q=await u0(W.scenario_id);C(q)}catch(q){console.warn("Could not load scenario:",q)}}catch(W){console.error("Failed to load roleplay data:",W),g("Fehler beim Laden der Gesprchsdaten")}finally{m(!1)}},F=t?.summary_feedback_json?typeof t.summary_feedback_json=="string"?JSON.parse(t.summary_feedback_json):t.summary_feedback_json:null,B=t?.category_scores||[],M=t?.analysis||{},U=(()=>{let W=0;return E&&S?.feedback?.rating?.overall?W=S.feedback.rating.overall:W=t?.overall_score||F?.overall_score||0,(_||E)&&W<=10?W*10:W})();return h?s.jsxs("div",{style:{width:"100%",minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(ge,{size:48,color:d,style:{animation:"spin 1s linear infinite",display:"block",margin:"0 auto"}}),s.jsx("p",{style:{color:l.textMuted,marginTop:"16px"},children:"Analyse wird geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):x?s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:"24px"},children:[s.jsx(Te,{size:48,color:l.error,style:{margin:"0 auto 16px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:l.textMain,marginBottom:"8px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:l.textSecondary,marginBottom:"24px"},children:x}),s.jsx("button",{onClick:i,style:{padding:"12px 24px",borderRadius:"10px",background:l.cardBgHover,border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Zurck"})]})}):s.jsxs("div",{style:{padding:"24px"},children:[s.jsx("style",{children:`
        .detail-grid { display: grid; grid-template-columns: 1fr 400px; gap: 24px; padding: 0 24px; }
        @media (max-width: 900px) { .detail-grid { grid-template-columns: 1fr; } }
      `}),s.jsxs("div",{style:{margin:"0 0 24px",padding:"0 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",background:l.cardBgHover,border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500,color:l.textMain,transition:"all 0.2s"},onMouseEnter:W=>{W.currentTarget.style.background=l.borderColor},onMouseLeave:W=>{W.currentTarget.style.background=l.cardBgHover},children:[s.jsx(Rt,{size:18}),"Zurck zur bersicht"]}),_&&a&&s.jsxs("button",{onClick:()=>v(!0),style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",background:l.errorLight,border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500,color:l.error,transition:"all 0.2s"},onMouseEnter:W=>{W.currentTarget.style.background=l.error,W.currentTarget.style.color="white"},onMouseLeave:W=>{W.currentTarget.style.background=l.errorLight,W.currentTarget.style.color=l.error},children:[s.jsx(Pt,{size:18}),"Session lschen"]})]}),s.jsxs("div",{className:"detail-grid",children:[s.jsxs("div",{children:[s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:c,borderRadius:"20px",padding:"24px",marginBottom:"20px",color:"#fff"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[s.jsx(DM,{score:U,size:100,primaryAccent:"#fff",isHeader:!0,branding:l}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",opacity:.9},children:[T?s.jsx(pt,{size:16}):E?s.jsx(Le,{size:16}):s.jsx($e,{size:16}),s.jsx("span",{style:{fontSize:"13px",fontWeight:500},children:T?"Wirkungs-Analyse":E?"Live-Simulation":"Szenario-Training"})]}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:700,margin:"0 0 6px 0"},children:(E?j?.title:n?.title)||t?.scenario_title||t?.position||"Training"}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,margin:"0 0 8px 0",opacity:.9},children:PM(U)}),s.jsx("div",{style:{display:"flex",gap:"12px",fontSize:"12px",opacity:.8},children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(qe,{size:12}),new Date(t.created_at).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})})]})]})}),T&&t?.video_url&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(pt,{size:18,color:d})," Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),_&&u.length>0&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("h3",{style:{fontSize:"16px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Le,{size:18,color:d})," Deine Antworten (",u.length,")"]}),u.map((W,q)=>s.jsx(BM,{answer:W,index:q,primaryAccent:d,branding:l},W.id||q)),L&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px",padding:"20px",background:l.cardBgHover,borderRadius:"12px",border:`1px dashed ${l.disabledBg}`},children:[s.jsx("p",{style:{width:"100%",textAlign:"center",color:l.textSecondary,fontSize:"14px",marginBottom:"12px"},children:"Diese Session ist noch nicht abgeschlossen."}),r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:d,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${d}4d`},children:[s.jsx(Tp,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx($i,{size:18}),"Erneut starten"]})]})]}),_&&u.length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",background:l.cardBgHover,borderRadius:"16px"},children:[s.jsx(Te,{size:48,color:l.textMuted,style:{margin:"0 auto 16px"}}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:l.textMain,marginBottom:"8px"},children:"Keine Antworten vorhanden"}),s.jsx("p",{style:{color:l.textMuted,marginBottom:N?"24px":"0"},children:N?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),L&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px"},children:[r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:d,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${d}4d`},children:[s.jsx(Tp,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx($i,{size:18}),"Erneut starten"]})]})]}),E&&S&&s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{marginBottom:"20px"},children:s.jsx(LM,{sessionId:t.id,conversationId:S.conversation_id,primaryAccent:d,branding:l})}),E&&S?.transcript?.length>0&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Gt,{size:18,color:d})," Gesprchsverlauf"]}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:S.transcript.map((W,q)=>s.jsx(zM,{entry:W,index:q,primaryAccent:d,branding:l},q))})]})]}),s.jsxs("div",{children:[T&&B.length>0&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Yt,{size:16,color:d})," Detaillierte Bewertung"]}),B.map((W,q)=>s.jsx(UM,{category:W,primaryAccent:d,branding:l},W.category||q))]}),T&&(M.key_strengths?.length>0||M.actionable_tips?.length>0)&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[M.key_strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Jt,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:M.key_strengths.map((W,q)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:W},q))})]}),M.actionable_tips?.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:d,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(je,{size:16})," Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:M.actionable_tips.map((W,q)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:W},q))})]})]}),T&&t?.summary_feedback&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:t.summary_feedback})]}),_&&F&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[F.summary&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:F.summary})]}),F.scores&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"12px"},children:"Bewertung"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:Object.entries(F.scores).map(([W,q])=>{const le=q!=null?q*10:null;return s.jsxs("div",{style:{padding:"12px",background:l.cardBgHover,borderRadius:"10px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:Xn(le,d)},children:le!=null?Math.round(le):"-"}),s.jsx("div",{style:{fontSize:"11px",color:l.textMuted,textTransform:"capitalize"},children:W})]},W)})})]}),F.key_takeaways?.length>0&&s.jsxs("div",{style:{background:l.successLight,borderRadius:"16px",padding:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(je,{size:16})," Wichtigste Erkenntnisse"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:l.textMain,lineHeight:1.5},children:F.key_takeaways.map((W,q)=>s.jsx("li",{style:{marginBottom:"6px"},children:W},q))})]})]}),E&&S?.feedback&&s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[S.feedback.rating&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Yt,{size:16,color:d})," Bewertungskriterien"]}),s.jsx("div",{style:{display:"grid",gap:"10px"},children:Object.entries(S.feedback.rating).filter(([W])=>W!=="overall").map(([W,q])=>{const le=q*10;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:l.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{flex:1,fontSize:"13px",fontWeight:500,color:l.textMain,textTransform:"capitalize"},children:W.replace(/_/g," ")}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{width:"80px",height:"6px",background:l.borderColor,borderRadius:"3px"},children:s.jsx("div",{style:{width:`${le}%`,height:"100%",background:Xn(le,d),borderRadius:"3px"}})}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:Xn(le,d),minWidth:"45px"},children:Math.round(le)})]})]},W)})})]}),S.feedback.strengths?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Jt,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:S.feedback.strengths.map((W,q)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:W},q))})]}),S.feedback.improvements?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.warning,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(je,{size:16})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:S.feedback.improvements.map((W,q)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:W},q))})]}),S.feedback.summary&&s.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:S.feedback.summary})]})]}),E&&!S?.feedback&&s.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(Te,{size:32,color:l.textMuted,style:{margin:"0 auto 12px"}}),s.jsx("p",{style:{fontSize:"14px",color:l.textMuted,margin:0},children:"Keine Analyse verfgbar fr dieses Gesprch."})]})]})]}),s.jsx(FM,{isOpen:y,onClose:()=>v(!1),onConfirm:V,isDeleting:w,primaryAccent:d,branding:l})]})},VM={"file-text":Gt,briefcase:Mn,banknote:Xi,users:Nn,user:Et,"message-circle":Ji,target:$e,award:pn,book:bo,clipboard:vo,star:Yt,lightbulb:je,shield:wi,compass:So,rocket:oi,calendar:Zi,sparkles:It,video:pt,mic:We,play:Ht,"check-circle":Jt,"alert-circle":Te,"help-circle":Dx,settings:ii,home:Vv,"trending-up":Bt,"bar-chart":Rj,"pie-chart":Ij,activity:Lr,zap:wo,heart:pu,"thumbs-up":eo,"message-square":Le,mail:Fj,phone:zr,"map-pin":Uj,clock:qe,bell:Tj,search:ps,filter:Xo,edit:Zj,trash:Pt,plus:An,minus:Vj,check:ti,x:rn,info:mn,warning:yn,refresh:Zt,loader:ge,globe:hu,link:Bj,bookmark:Ej,tag:Qj,code:Nj,database:Aj,server:gu,pen:fu,bot:us},$M={"file-text":Gt,briefcase:Mn,banknote:Xi,users:Nn},pv=(t,e=Gt)=>VM[t]||e,GM=t=>$M[t]||Gt,HM={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprchsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprchsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fhigkeiten",strengths:"Strken",challenges:"Herausforderungen"},qM=t=>HM[t]||t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),Td=(t,e)=>{if(!t)return null;const n=[];let i=t,r=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),a=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),l=i.match(/`([^`]+)`/),c=[{match:o,type:"bold"},{match:a,type:"italic"},{match:l,type:"code"}].filter(u=>u.match);if(c.length===0){n.push(i);break}const d=c.reduce((u,p)=>(u.match?.index??1/0)<(p.match?.index??1/0)?u:p);switch(d.match.index>0&&n.push(i.substring(0,d.match.index)),d.type){case"bold":n.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:d.match[1]},r++));break;case"italic":n.push(s.jsx("em",{style:{fontStyle:"italic"},children:d.match[1]||d.match[2]},r++));break;case"code":n.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:d.match[1]},r++));break}i=i.substring(d.match.index+d.match[0].length)}return n},fv=({content:t,primaryAccent:e})=>{if(!t)return null;const n=i=>{const r=i.split(`
`),o=[];let a=[],l=null;const c=()=>{a.length>0&&(o.push(s.jsx("ul",{style:{margin:"8px 0",paddingLeft:"20px",listStyle:"none"},children:a.map((d,u)=>s.jsxs("li",{style:{marginBottom:"6px",fontSize:"14px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"16px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:l==="number"?`${u+1}.`:""}),Td(d,e)]},u))},`list-${o.length}`)),a=[],l=null)};return r.forEach((d,u)=>{const p=d.trim();if(!p){c();return}if(p.startsWith("- ")||p.startsWith("* ")){l!=="bullet"&&(c(),l="bullet"),a.push(p.substring(2));return}const h=p.match(/^(\d+)\.\s/);if(h){l!=="number"&&(c(),l="number"),a.push(p.substring(h[0].length));return}c(),o.push(s.jsx("p",{style:{margin:"8px 0",fontSize:"14px",lineHeight:1.6,color:"#374151"},children:Td(p,e)},`p-${u}`))}),c(),o};return s.jsx("div",{children:n(t)})},Rm=({item:t,sectionId:e,primaryAccent:n,onUpdateItem:i,branding:r})=>{const[o,a]=f.useState(t.user_note||""),[l,c]=f.useState(!1),[d,u]=f.useState(!1),[p,h]=f.useState(!1),[m,x]=f.useState(!!t.user_note);f.useEffect(()=>{h(o!==(t.user_note||""))},[o,t.user_note]);const g=async()=>{c(!0);try{await i(e,t.id,{user_note:o}),u(!0),h(!1),setTimeout(()=>u(!1),2e3)}catch(w){console.error("Error saving note:",w)}finally{c(!1)}},y=async()=>{try{await i(e,t.id,{deleted:!0})}catch(w){console.error("Error deleting item:",w)}},v=async()=>{try{await i(e,t.id,{deleted:!1})}catch(w){console.error("Error restoring item:",w)}};return t.deleted?s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderRadius:"10px",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:.6},children:[s.jsxs("span",{style:{fontSize:"14px",color:r.textMuted,fontStyle:"italic"},children:[s.jsx("s",{children:t.label})," - gelscht"]}),s.jsxs("button",{onClick:v,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",borderRadius:"6px",border:"none",backgroundColor:r.borderColor,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:[s.jsx($i,{size:12}),"Wiederherstellen"]})]}):s.jsxs("div",{style:{backgroundColor:r.cardBg,borderRadius:"12px",border:`1px solid ${r.borderColor}`,marginBottom:"10px",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"14px 16px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:n,flexShrink:0}}),s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:r.textMain,margin:0},children:t.label})]}),t.content&&s.jsx("p",{style:{fontSize:"13px",color:r.textMuted,margin:"0 0 0 14px",lineHeight:1.5},children:Td(t.content,n)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",flexShrink:0},children:[t.user_note&&!m&&s.jsx("span",{style:{fontSize:"11px",color:n,backgroundColor:`${n}15`,padding:"2px 6px",borderRadius:"4px"},children:"Notiz"}),s.jsx("button",{onClick:()=>x(!m),title:"Notiz hinzufgen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:m?`${n}15`:"transparent",color:m?n:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(fu,{size:16})}),s.jsx("button",{onClick:y,title:"Lschen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Pt,{size:16})})]})]}),m&&s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderTop:`1px solid ${r.borderColor}`},children:[s.jsx("textarea",{value:o,onChange:w=>a(w.target.value),placeholder:"Deine Notiz zu diesem Punkt...",style:{width:"100%",minHeight:"60px",padding:"10px",borderRadius:"8px",border:`1px solid ${r.borderColor}`,fontSize:"13px",color:r.textSecondary,resize:"vertical",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:w=>{w.target.style.borderColor=n},onBlur:w=>{w.target.style.borderColor=r.borderColor}}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"8px",gap:"8px"},children:[s.jsx("button",{onClick:()=>{x(!1),a(t.user_note||"")},style:{padding:"6px 12px",borderRadius:"6px",border:`1px solid ${r.borderColor}`,backgroundColor:r.cardBg,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:"Abbrechen"}),s.jsxs("button",{onClick:g,disabled:l||!p,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:d?r.successLight:p?n:r.cardBgHover,color:d?r.success:p?"white":r.textMuted,fontSize:"12px",fontWeight:500,cursor:p&&!l?"pointer":"default"},children:[l?s.jsx(ge,{size:12,style:{animation:"spin 1s linear infinite"}}):d?s.jsx(ti,{size:12}):s.jsx(Vx,{size:12}),d?"Gespeichert!":"Speichern"]})]})]}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},KM=({section:t,primaryAccent:e,onUpdateItem:n,onGenerateMore:i,isExpanded:r,onToggle:o,branding:a})=>{const[l,c]=f.useState(!1),d=async()=>{c(!0);try{await i(t.id)}catch(v){console.error("Error generating more items:",v)}finally{c(!1)}},u=f.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const v=JSON.parse(t.ai_content);if(v&&Array.isArray(v.items))return{type:"items",items:v.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:p,items:h,content:m}=u(),x=h.filter(v=>!v.deleted),g=h.filter(v=>v.deleted),y=h.some(v=>v.user_note&&!v.deleted);return s.jsxs("div",{style:{backgroundColor:a.cardBgColor,borderRadius:a.radius.xl,boxShadow:a.shadow.xs,overflow:"hidden",marginBottom:a.space[4]},children:[s.jsxs("button",{onClick:o,style:{width:"100%",padding:`${a.space[4]} ${a.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",background:"none",cursor:"pointer",borderBottom:r?`1px solid ${a.borderColorLight}`:"none"},children:[s.jsx("h3",{style:{fontSize:a.fontSize.lg,fontWeight:a.fontWeight.semibold,color:a.textMain,margin:0,textAlign:"left"},children:t.section_title}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2]},children:[p==="items"&&s.jsxs("span",{style:{fontSize:a.fontSize.xs,color:a.textMuted,backgroundColor:a.borderColorLight,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[x.length," Punkte"]}),y&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:a.space[1],fontSize:a.fontSize.xs,color:e,backgroundColor:`${e}15`,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[s.jsx(fu,{size:a.iconSize.xs}),"Notizen"]}),r?s.jsx(zi,{size:a.iconSize.lg,style:{color:a.textMuted}}):s.jsx(wt,{size:a.iconSize.lg,style:{color:a.textMuted}})]})]}),r&&s.jsx("div",{style:{padding:`${a.space[4]} ${a.space[5]}`},children:p==="items"?s.jsxs(s.Fragment,{children:[x.map(v=>s.jsx(Rm,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id)),i&&s.jsx("button",{onClick:d,disabled:l,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px 16px",marginTop:"12px",marginBottom:"8px",borderRadius:"10px",border:`1px dashed ${e}40`,backgroundColor:`${e}08`,color:e,fontSize:"13px",fontWeight:500,cursor:l?"wait":"pointer",transition:"all 0.2s"},onMouseEnter:v=>{l||(v.currentTarget.style.backgroundColor=`${e}15`,v.currentTarget.style.borderColor=`${e}60`)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=`${e}08`,v.currentTarget.style.borderColor=`${e}40`},children:l?s.jsxs(s.Fragment,{children:[s.jsx(ge,{size:16,style:{animation:"spin 1s linear infinite"}}),"Generiere 5 weitere Punkte..."]}):s.jsxs(s.Fragment,{children:[s.jsx(It,{size:16}),"5 weitere Punkte generieren"]})}),g.length>0&&s.jsxs("div",{style:{marginTop:"16px"},children:[s.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Pt,{size:12}),g.length," gelschte ",g.length===1?"Punkt":"Punkte"]}),g.map(v=>s.jsx(Rm,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id))]})]}):p==="markdown"?s.jsxs("div",{style:{backgroundColor:"#f8fafc",padding:"16px",borderRadius:"10px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx(us,{size:16,style:{color:e}}),s.jsx("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.5px"},children:"KI-Empfehlung"})]}),s.jsx(fv,{content:m,primaryAccent:e})]}):s.jsx("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Kein Inhalt verfgbar"})})]})},mv=({briefing:t,onBack:e})=>{const{config:n}=Fe(),i=it(),[r,o]=f.useState(t),[a,l]=f.useState(!t?.sections),[c,d]=f.useState(null),[u,p]=f.useState({}),[h,m]=f.useState(!1),x=n?.buttonGradientStart||"#3A7FA7",g=pv(r?.template_icon);f.useEffect(()=>{const k=async()=>{if(r?.sections){const S={};r.sections.forEach(b=>{S[b.id]=!0}),p(S),l(!1);return}try{l(!0);const S=await me.request(`/smartbriefing/briefings/${r.id}`,{method:"GET"});if(S.success&&S.data?.briefing){o(S.data.briefing);const b={};S.data.briefing.sections?.forEach(j=>{b[j.id]=!0}),p(b)}else throw new Error("Fehler beim Laden des Briefings")}catch(S){console.error("[SmartBriefing] Error fetching briefing:",S),d(S.message)}finally{l(!1)}};r?.id&&k()},[r?.id]);const y=f.useCallback(k=>{p(S=>({...S,[k]:!S[k]}))},[]),v=f.useCallback(async(k,S,b)=>{const j=await me.request(`/smartbriefing/sections/${k}/items/${S}`,{method:"PATCH",body:JSON.stringify(b)});if(!j.success)throw new Error("Fehler beim Speichern");o(C=>({...C,sections:C.sections.map(T=>T.id===k?j.data.section:T)}))},[]),w=f.useCallback(async k=>{const S=await me.request(`/smartbriefing/sections/${k}/generate-more`,{method:"POST"});if(!S.success)throw new Error(S.message||"Fehler beim Generieren");return o(b=>({...b,sections:b.sections.map(j=>j.id===k?S.data.section:j)})),S.data.new_items_count},[]);return r?s.jsxs("div",{style:{padding:"24px",maxWidth:"900px",margin:"0 auto"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:"24px"},children:[s.jsx(Rt,{size:18}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{backgroundColor:i.cardBgColor,borderRadius:i.radius.xl,padding:i.space[6],marginBottom:i.space[6],boxShadow:i.shadow.xs},children:[s.jsx("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",flexWrap:"wrap",gap:i.space[4]},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[4],flex:1},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:i.radius.lg,background:`linear-gradient(135deg, ${x}15, ${x}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(g,{size:28,style:{color:x}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h1",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0",overflow:"hidden",textOverflow:"ellipsis"},children:r.title||"Briefing"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:r.template_title}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#94a3b8"},children:[s.jsx(Zi,{size:12}),Gr(r.created_at)]})]})]})]})}),r.variables&&Object.keys(r.variables).length>0&&s.jsxs("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("button",{onClick:()=>m(!h),style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"0",border:"none",background:"none",cursor:"pointer"},children:[s.jsxs("span",{style:{fontSize:"13px",fontWeight:500,color:"#64748b"},children:["Deine Angaben (",Object.keys(r.variables).length,")"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#94a3b8"},children:[s.jsx("span",{style:{fontSize:"12px"},children:h?"Einklappen":"Ausklappen"}),h?s.jsx(zi,{size:16}):s.jsx(wt,{size:16})]})]}),h&&s.jsx("div",{style:{marginTop:"12px",display:"flex",flexWrap:"wrap",gap:"8px"},children:Object.entries(r.variables).map(([k,S])=>s.jsxs("span",{style:{backgroundColor:"#f1f5f9",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",color:"#64748b"},children:[s.jsxs("strong",{style:{color:"#374151"},children:[qM(k),":"]})," ",S]},k))})]})]}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(ge,{size:40,style:{color:x,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefing wird geladen..."})]}),c&&!a&&s.jsx("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",textAlign:"center"},children:s.jsx("p",{style:{color:"#dc2626",margin:0},children:c})}),!a&&!c&&r.sections&&s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(It,{size:18,style:{color:x}}),s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:"Briefing-Inhalte"}),s.jsxs("span",{style:{fontSize:"13px",color:"#94a3b8"},children:["(",r.sections.length," Abschnitte)"]})]}),r.sections.map(k=>s.jsx(KM,{section:k,primaryAccent:x,onUpdateItem:v,onGenerateMore:w,isExpanded:u[k.id],onToggle:()=>y(k.id),branding:i},k.id))]}),!a&&!c&&(!r.sections||r.sections.length===0)&&r.content_markdown&&s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsx(fv,{content:r.content_markdown,primaryAccent:x})}),s.jsx("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${x}08`,borderRadius:"12px",border:`1px solid ${x}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(je,{size:18,style:{color:x,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"Tipp: Personalisiere dein Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.5},children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufgen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):null},Fa=({isOpen:t,onClose:e,onConfirm:n,title:i="Lschen besttigen",description:r="Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:o=!1,confirmLabel:a="Lschen",cancelLabel:l="Abbrechen"})=>{const{branding:c}=Fe(),d=c?.["--primary-accent"]||ve["--primary-accent"];return s.jsx(En,{open:t,onOpenChange:e,children:s.jsxs(Rn,{style:{maxWidth:"400px"},children:[s.jsxs(In,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Pt,{style:{width:"20px",height:"20px",color:"#fff"}})}),s.jsx(_n,{children:i})]}),s.jsx(Vn,{children:r})]}),s.jsxs(Wn,{style:{marginTop:"16px"},children:[s.jsx("button",{onClick:e,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:`2px solid ${d}`,backgroundColor:"white",color:d,fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s"},children:l}),s.jsx("button",{onClick:n,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:o?s.jsxs(s.Fragment,{children:[s.jsx(ge,{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"}}),a,"..."]}):a})]})]})})},JM=({briefing:t,onClick:e,onDelete:n,headerGradient:i,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=ks(900),p=GM(t.template_icon),h=x=>{x.stopPropagation(),d(!0)},m=async()=>{l(!0);try{await n(t.id),d(!1)}catch(x){console.error("Error deleting briefing:",x)}finally{l(!1)}};return u?s.jsxs(P.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[s.jsxs("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(p,{style:{width:"22px",height:"22px",color:o}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.title||"Briefing"}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Gr(t.created_at)})]}),s.jsx("button",{onClick:h,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(Pt,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"4px 10px",borderRadius:"10px",fontSize:"12px",fontWeight:500,maxWidth:"70%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.template_title}),s.jsx(Xt,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),s.jsx(Fa,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):s.jsxs(P.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:x=>{x.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",x.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:x=>{x.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",x.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(p,{style:{width:"24px",height:"24px",color:o}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title||"Briefing"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"2px 8px",borderRadius:"10px",fontSize:"12px",fontWeight:500},children:t.template_title}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Zi,{size:14}),Gr(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[s.jsx("button",{onClick:h,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(Pt,{size:18})}),s.jsx(Xt,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(Fa,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},ui={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},YM=({session:t,type:e,scenario:n,onClick:i,onContinueSession:r,onDeleteSession:o,headerGradient:a,headerText:l,primaryAccent:c})=>{const[d,u]=f.useState(!1),[p,h]=f.useState(!1),m=ks(900),x=()=>{let D=null;if(e===ui.SIMULATOR)D=t.overall_score||t.average_score;else if(e===ui.VIDEO)D=t.overall_score;else if(t.feedback_json)try{let A=t.feedback_json;if(typeof A=="string"){let F=A.trim();F.startsWith("```json")?F=F.replace(/```json\s*/g,"").replace(/```\s*$/g,""):F.startsWith("```")&&(F=F.replace(/```\s*/g,"").replace(/```\s*$/g,"")),A=JSON.parse(F)}D=A.rating?.overall||null}catch{D=null}return D==null||isNaN(D)||D===0?null:D},g=()=>e===ui.SIMULATOR||e===ui.VIDEO?t.status:t.feedback_json?"completed":"pending",y=x(),w=g()==="completed",k=t.total_questions>0&&(t.completed_questions||0)<t.total_questions,S=e===ui.SIMULATOR&&k,b=()=>{if(!S)return null;const D=t.completed_questions||0,A=t.total_questions||0;return`${D}/${A} Fragen`},j=D=>{D.stopPropagation(),r&&r(t,n)},C=D=>{D.stopPropagation(),h(!0)},T=async()=>{u(!0);try{await o(t,e),h(!1)}catch(D){console.error("Error deleting session:",D)}finally{u(!1)}},E=(()=>{if(y==null||isNaN(y))return null;if(e===ui.SIMULATOR||e===ui.ROLEPLAY){const D=y<=10?y*10:y;return isNaN(D)?null:D}return isNaN(y)?null:y})(),N=D=>{if(!D&&D!==0)return{background:"#f1f5f9",color:"#64748b"};const A=parseFloat(D);return A>=80?{background:"#dcfce7",color:"#166534"}:A>=60?{background:"#fef9c3",color:"#854d0e"}:{background:"#fee2e2",color:"#991b1b"}},V=(()=>{switch(e){case ui.SIMULATOR:return $e;case ui.VIDEO:return pt;default:return Le}})();return m?s.jsxs(P.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[s.jsxs("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(V,{style:{width:"22px",height:"22px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Gr(t.created_at)})]}),o&&s.jsx("button",{onClick:C,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:d?s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(Pt,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[!w&&!S&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(qe,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"5px 10px",borderRadius:"20px",fontSize:"13px",fontWeight:600,...N(E)},children:[s.jsx(Yt,{size:13}),E!==null?`${Math.round(E)}%`:"-- %"]}),(t.duration||t.video_duration_seconds)&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#64748b"},children:[s.jsx(qe,{size:12}),lt(t.duration||t.video_duration_seconds)]}),S&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()})]}),S&&r?s.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,flexShrink:0},children:[s.jsx(Ht,{size:14}),"Fortsetzen"]}):s.jsx(Xt,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),s.jsx(Fa,{isOpen:p,onClose:()=>h(!1),onConfirm:T,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]}):s.jsxs(P.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:D=>{D.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",D.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:D=>{D.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",D.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(V,{style:{width:"24px",height:"24px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Zi,{size:14}),Gr(t.created_at)]}),t.duration||t.video_duration_seconds?s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(qe,{size:14}),lt(t.duration||t.video_duration_seconds)]}):null]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},children:[S&&r&&s.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,transition:"all 0.2s"},onMouseEnter:D=>{D.currentTarget.style.transform="scale(1.02)",D.currentTarget.style.boxShadow=`0 4px 12px ${c||"#3B82F6"}50`},onMouseLeave:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow=`0 2px 8px ${c||"#3B82F6"}40`},children:[s.jsx(Ht,{size:14}),"Fortsetzen"]}),S&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()}),!w&&!S&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(qe,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"20px",fontSize:"14px",fontWeight:600,...N(E)},children:[s.jsx(Yt,{size:14}),E!==null?`${Math.round(E)}%`:"-- %"]}),o&&s.jsx("button",{onClick:C,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:D=>{D.currentTarget.style.color="#ef4444"},onMouseLeave:D=>{D.currentTarget.style.color="#94a3b8"},title:"Lschen",children:d?s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(Pt,{size:18})}),s.jsx(Xt,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(Fa,{isOpen:p,onClose:()=>h(!1),onConfirm:T,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]})},Ie={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings"},hc=[{id:Ie.BRIEFINGS,label:"Smart Briefings",icon:It},{id:Ie.SIMULATOR,label:"Szenario-Training",icon:$e},{id:Ie.VIDEO,label:"Wirkungs-Analyse",icon:pt},{id:Ie.ROLEPLAY,label:"Live-Simulationen",icon:Le}],Wo=Ie,XM=({onBack:t,onSelectSession:e,isAuthenticated:n,onLoginClick:i,onContinueSession:r,onRepeatSession:o,initialTab:a,onNavigateToModule:l})=>{const{branding:c,demoCode:d,isDemoUser:u}=Fe(),p=it(),h=c?.["--header-gradient"]||ve["--header-gradient"],m=c?.["--header-text"]||ve["--header-text"],x=c?.["--primary-accent"]||ve["--primary-accent"],[g,y]=f.useState(a||Ie.BRIEFINGS);f.useEffect(()=>{a&&y(a)},[a]);const[v,w]=f.useState(null),[k,S]=f.useState(null);f.useEffect(()=>{window.scrollTo(0,0)},[g,v]);const[b,j]=f.useState([]),[C,T]=f.useState([]),[_,E]=f.useState([]),[N,L]=f.useState([]),[V,D]=f.useState([]),[A,F]=f.useState([]),[B,M]=f.useState([]),[z,U]=f.useState(null),[W,q]=f.useState(!0),[le,de]=f.useState(null);f.useEffect(()=>{n?ue():q(!1)},[n]);const ue=async()=>{q(!0),de(null);try{const se=ni(),Z=d?`&demo_code=${encodeURIComponent(d)}`:"",[re,te,fe,K,Q,ce,Ee]=await Promise.all([i2({limit:50,...d&&{demo_code:d}}).catch(()=>({data:[]})),fetch(`${se}/simulator/sessions?limit=50${Z}`,{headers:{"X-WP-Nonce":Lt()}}).then(Re=>Re.json()).catch(()=>({data:[]})),fetch(`${se}/video-training/sessions?limit=50${Z}`,{headers:{"X-WP-Nonce":Lt()}}).then(Re=>Re.json()).catch(()=>({data:[]})),me.request(`/smartbriefing/briefings?limit=50${d?`&demo_code=${encodeURIComponent(d)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),d0().catch(()=>[]),fetch(`${se}/simulator/scenarios`,{headers:{"X-WP-Nonce":Lt()}}).then(Re=>Re.json()).catch(()=>({data:[]})),fetch(`${se}/video-training/scenarios`,{headers:{"X-WP-Nonce":Lt()}}).then(Re=>Re.json()).catch(()=>({data:[]}))]),dt=(Re,mt="sessions")=>Array.isArray(Re?.data)?Re.data:Array.isArray(Re?.data?.[mt])?Re.data[mt]:Array.isArray(Re?.[mt])?Re[mt]:Array.isArray(Re)?Re:[],tt=Re=>Array.isArray(Re?.data?.scenarios)?Re.data.scenarios:Array.isArray(Re?.data)?Re.data:Array.isArray(Re)?Re:[];j(dt(re)),T(dt(te)),E(dt(fe)),L(K?.data?.briefings||[]),D(tt(Q)),F(tt(ce)),M(tt(Ee))}catch(se){console.error("Failed to load sessions:",se),de(se.message||"Fehler beim Laden der Daten")}finally{q(!1)}},$=f.useMemo(()=>{const se={};return V.forEach(Z=>{se[Z.id]=Z}),se},[V]),Se=f.useMemo(()=>{const se={};return A.forEach(Z=>{se[Z.id]=Z}),se},[A]),xe=f.useMemo(()=>{const se={};return B.forEach(Z=>{se[Z.id]=Z}),se},[B]),Ke=()=>{switch(g){case Ie.SIMULATOR:return C;case Ie.VIDEO:return _;case Ie.BRIEFINGS:return N;default:return b}},st=()=>{switch(g){case Ie.SIMULATOR:return Se;case Ie.VIDEO:return xe;default:return $}},Ve=b.length+C.length+_.length+N.length,ft=async se=>{(await me.request(`/smartbriefing/briefings/${se}`,{method:"DELETE"})).success&&L(re=>re.filter(te=>te.id!==se))},St=se=>{U(se)},Ze=()=>{U(null)},Ct=se=>{w(se),S(g)},qt=()=>{w(null),S(null)},Ge=async(se,Z)=>{const re=ni();try{let te,fe;switch(Z){case Ie.SIMULATOR:te=`${re}/simulator/sessions/${se.id}`,fe=()=>T(ce=>ce.filter(Ee=>Ee.id!==se.id));break;case Ie.ROLEPLAY:te=`${re}/sessions/${se.id}`,fe=()=>j(ce=>ce.filter(Ee=>Ee.id!==se.id));break;case Ie.VIDEO:te=`${re}/video-training/sessions/${se.id}`,fe=()=>E(ce=>ce.filter(Ee=>Ee.id!==se.id));break;default:throw new Error("Unknown session type")}const Q=await(await fetch(te,{method:"DELETE",headers:{"X-WP-Nonce":Lt()}})).json();if(Q.success)fe(),v&&qt();else throw new Error(Q.message||"Delete failed")}catch(te){throw console.error("Failed to delete session:",te),te}},Qe=(se,Z)=>(Z===Ie.SIMULATOR?Se:Z===Ie.VIDEO?xe:$)[se?.scenario_id];if(z)return s.jsx(mv,{briefing:z,onBack:Ze});if(v)return s.jsx(WM,{session:v,type:k,scenario:Qe(v,k),onBack:qt,onContinueSession:r,onRepeatSession:o,onDeleteSession:Ge});if(!n)return s.jsxs("div",{style:{padding:p.space[6]},children:[s.jsxs("div",{style:{marginBottom:p.space[8],textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:p.space[3],marginBottom:p.space[3]},children:[s.jsx("div",{style:{width:p.space[12],height:p.space[12],borderRadius:p.radius.lg,background:h,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx($c,{style:{width:p.iconSize["2xl"],height:p.iconSize["2xl"],color:m}})}),s.jsx("h1",{style:{fontSize:p.fontSize["5xl"],fontWeight:p.fontWeight.bold,color:p.textMain,margin:0},children:"Meine Sessions"})]}),s.jsx("p",{style:{fontSize:p.fontSize.lg,color:p.textSecondary,maxWidth:"600px",margin:"0 auto"},children:"Hier findest du deine gespeicherten bungen und Fortschritte"})]}),s.jsxs("div",{style:{maxWidth:"500px",margin:`${p.space[15]} auto`,textAlign:"center",padding:p.space[10],backgroundColor:p.cardBg,borderRadius:p.radius["2xl"],boxShadow:p.shadow.md},children:[s.jsx("div",{style:{width:p.space[16],height:p.space[16],borderRadius:p.radius.xl,background:h,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${p.space[5]}`},children:s.jsx(ka,{style:{width:p.iconSize["3xl"],height:p.iconSize["3xl"],color:m}})}),s.jsx("h2",{style:{fontSize:p.fontSize["3xl"],fontWeight:p.fontWeight.bold,color:p.textMain,marginBottom:p.space[3]},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{fontSize:p.fontSize.md,color:p.textMuted,marginBottom:p.space[6],lineHeight:1.6},children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),s.jsxs("button",{onClick:i,style:{padding:`${p.space[3.5]} ${p.space[8]}`,borderRadius:p.radius.lg,border:"none",background:h,color:m,fontSize:p.fontSize.lg,fontWeight:p.fontWeight.semibold,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:p.space[2.5],boxShadow:p.coloredShadow(x,"md")},children:[s.jsx(ka,{style:{width:p.iconSize.lg,height:p.iconSize.lg}}),"Jetzt anmelden"]})]})]});if(W)return s.jsxs("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:p.space[10]},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(ge,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:x,animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{color:p.textMuted,marginTop:p.space[4]},children:"Sessions werden geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]});if(le)return s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:p.space[6]},children:[s.jsx(Te,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:p.error,margin:`0 auto ${p.space[4]}`}}),s.jsx("h2",{style:{fontSize:p.fontSize["2xl"],fontWeight:p.fontWeight.bold,color:p.textMain,marginBottom:p.space[2]},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:p.textMuted,marginBottom:p.space[6]},children:le}),s.jsx(he,{onClick:ue,children:"Erneut versuchen"})]})});const ze=Ke(),et=st();return s.jsxs("div",{style:{padding:p.space[6]},children:[s.jsxs("div",{style:{marginBottom:p.space[8],textAlign:"center",position:"relative"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:p.space[3],marginBottom:p.space[3]},children:[s.jsx("div",{style:{width:p.space[12],height:p.space[12],borderRadius:p.radius.lg,background:h,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx($c,{style:{width:p.iconSize["2xl"],height:p.iconSize["2xl"],color:m}})}),s.jsx("h1",{style:{fontSize:p.fontSize["5xl"],fontWeight:p.fontWeight.bold,color:p.textMain,margin:0},children:"Meine Sessions"})]}),s.jsxs("p",{style:{fontSize:p.fontSize.lg,color:p.textSecondary,maxWidth:"600px",margin:"0 auto"},children:[Ve," ",Ve===1?"bung":"bungen"," gespeichert"]})]}),s.jsx("style",{children:`
        .session-tabs-desktop {
          margin: 0 24px 24px;
          display: flex;
          gap: 8px;
          background: #f1f5f9;
          padding: 6px;
          border-radius: 14px;
        }
        .session-tab-btn-desktop {
          flex: 1;
          padding: 12px 16px;
          border-radius: 10px;
          border: none;
          font-size: 14px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: all 0.2s;
        }
        .session-tabs-mobile {
          margin: 0 16px 16px;
        }
        .session-tabs-mobile-icons {
          display: flex;
          gap: 8px;
          justify-content: center;
          margin-bottom: 12px;
        }
        .session-tab-btn-mobile {
          flex: 1;
          max-width: 80px;
          padding: 12px 8px;
          border-radius: 12px;
          border: none;
          cursor: pointer;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 4px;
          transition: all 0.2s;
        }
        .session-tab-mobile-label {
          text-align: center;
          font-size: 15px;
          font-weight: 600;
          color: #0f172a;
          padding: 8px 16px;
          background: #fff;
          border-radius: 10px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .mobile-refresh-btn {
          display: none;
        }
        .desktop-actions {
          margin: 0 24px 24px;
          display: flex;
          justify-content: flex-end;
          gap: 12px;
        }
        .sessions-list-container {
          margin: 0 24px;
        }
        @media (min-width: 641px) {
          .session-tabs-mobile { display: none; }
        }
        @media (max-width: 640px) {
          .session-tabs-desktop { display: none; }
          .desktop-actions { display: none; }
          .mobile-refresh-btn {
            display: flex !important;
            position: absolute;
            top: 0;
            right: 0;
          }
          .sessions-list-container {
            margin: 0 16px;
          }
        }
      `}),s.jsx("button",{onClick:ue,disabled:W,className:"mobile-refresh-btn",style:{padding:p.space[2.5],borderRadius:p.radius.md,border:`1px solid ${p.borderColor}`,background:p.cardBgColor,color:p.textSecondary,cursor:W?"not-allowed":"pointer",opacity:W?.5:1,boxShadow:p.shadow.sm,alignItems:"center",justifyContent:"center"},children:s.jsx(Zt,{style:{width:p.iconSize.md,height:p.iconSize.md},className:W?"animate-spin":""})}),s.jsx("div",{className:"session-tabs-desktop",children:hc.map(se=>{const Z=se.icon,re=g===se.id,te=se.id===Ie.SIMULATOR?C.length:se.id===Ie.VIDEO?_.length:se.id===Ie.BRIEFINGS?N.length:b.length;return s.jsxs("button",{onClick:()=>y(se.id),className:"session-tab-btn-desktop",style:{background:re?"#fff":"transparent",color:re?"#0f172a":"#64748b",fontWeight:re?600:500,boxShadow:re?"0 2px 8px rgba(0, 0, 0, 0.08)":"none"},children:[s.jsx(Z,{size:18}),s.jsx("span",{children:se.label}),s.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",background:re?x:"#e2e8f0",color:re?"#fff":"#64748b",fontSize:"12px",fontWeight:600},children:te})]},se.id)})}),s.jsxs("div",{className:"session-tabs-mobile",children:[s.jsx("div",{className:"session-tabs-mobile-icons",children:hc.map(se=>{const Z=se.icon,re=g===se.id,te=se.id===Ie.SIMULATOR?C.length:se.id===Ie.VIDEO?_.length:se.id===Ie.BRIEFINGS?N.length:b.length;return s.jsxs("button",{onClick:()=>y(se.id),className:"session-tab-btn-mobile",style:{background:re?"#fff":"#f1f5f9",boxShadow:re?"0 2px 8px rgba(0, 0, 0, 0.1)":"none",border:re?`2px solid ${x}`:"2px solid transparent"},children:[s.jsx(Z,{size:20,style:{color:re?x:"#64748b"}}),s.jsx("span",{style:{padding:"2px 6px",borderRadius:"8px",background:re?x:"#e2e8f0",color:re?"#fff":"#64748b",fontSize:"11px",fontWeight:600},children:te})]},se.id)})}),s.jsx("div",{className:"session-tab-mobile-label",children:hc.find(se=>se.id===g)?.label})]}),s.jsxs("div",{className:"desktop-actions",children:[s.jsxs(he,{variant:"outline",onClick:ue,disabled:W,children:[s.jsx(Zt,{style:{width:"16px",height:"16px",marginRight:"8px"},className:W?"animate-spin":""}),"Aktualisieren"]}),l&&s.jsxs(he,{onClick:()=>{const se={[Ie.BRIEFINGS]:"smart_briefing",[Ie.SIMULATOR]:"simulator",[Ie.VIDEO]:"video_training",[Ie.ROLEPLAY]:"dashboard"};l(se[g]||"overview")},style:{background:h,color:m},children:[s.jsx(An,{style:{width:"16px",height:"16px",marginRight:"8px"}}),g===Ie.BRIEFINGS?"Neues Briefing":g===Ie.SIMULATOR?"Neues Szenario-Training":g===Ie.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),s.jsx("div",{className:"sessions-list-container",children:ze.length===0?s.jsxs("div",{style:{textAlign:"center",padding:`${p.space[15]} ${p.space[6]}`,background:p.cardBg,borderRadius:p.radius["2xl"],boxShadow:p.shadow.sm},children:[g===Ie.SIMULATOR&&s.jsx($e,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:p.textMuted,margin:`0 auto ${p.space[4]}`,display:"block"}}),g===Ie.ROLEPLAY&&s.jsx(Le,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:p.textMuted,margin:`0 auto ${p.space[4]}`,display:"block"}}),g===Ie.VIDEO&&s.jsx(pt,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:p.textMuted,margin:`0 auto ${p.space[4]}`,display:"block"}}),g===Ie.BRIEFINGS&&s.jsx(It,{style:{width:p.iconSize["4xl"],height:p.iconSize["4xl"],color:p.textMuted,margin:`0 auto ${p.space[4]}`,display:"block"}}),s.jsxs("h3",{style:{fontSize:p.fontSize["2xl"],fontWeight:p.fontWeight.semibold,color:p.textSecondary,marginBottom:p.space[2]},children:["Noch keine ",g===Ie.SIMULATOR?"Szenario-Trainings":g===Ie.VIDEO?"Wirkungs-Analysen":g===Ie.BRIEFINGS?"Smart Briefings":"Live-Simulationen"]}),s.jsx("p",{style:{color:p.textMuted,fontSize:p.fontSize.base,marginBottom:p.space[6]},children:g===Ie.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),s.jsxs(he,{onClick:t,children:[s.jsx(Ht,{style:{width:p.iconSize.sm,height:p.iconSize.sm,marginRight:p.space[2]}}),g===Ie.BRIEFINGS?"Briefing erstellen":"Training starten"]})]}):s.jsx(P.div,{style:{display:"flex",flexDirection:"column",gap:p.space[3]},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:g===Ie.BRIEFINGS?N.map(se=>s.jsx(JM,{briefing:se,onClick:()=>St(se),onDelete:ft,headerGradient:h,headerText:m,primaryAccent:x},se.id)):ze.map(se=>{const Z=et[se.scenario_id];return s.jsx(YM,{session:se,type:g,scenario:Z,onClick:()=>Ct(se),onContinueSession:r,onDeleteSession:Ge,headerGradient:h,headerText:m,primaryAccent:x},se.id)})})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},Im=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,_m=Q0,jo=(t,e)=>n=>{var i;if(e?.variants==null)return _m(t,n?.class,n?.className);const{variants:r,defaultVariants:o}=e,a=Object.keys(r).map(d=>{const u=n?.[d],p=o?.[d];if(u===null)return null;const h=Im(u)||Im(p);return r[d][h]}),l=n&&Object.entries(n).reduce((d,u)=>{let[p,h]=u;return h===void 0||(d[p]=h),d},{}),c=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((d,u)=>{let{class:p,className:h,...m}=u;return Object.entries(m).every(x=>{let[g,y]=x;return Array.isArray(y)?y.includes({...o,...l}[g]):{...o,...l}[g]===y})?[...d,p,h]:d},[]);return _m(t,a,c,n?.class,n?.className)},ZM=jo("rounded-xl border bg-white",{variants:{variant:{default:"border-slate-200",elevated:"border-slate-200 shadow-xl",outline:"border-ocean-blue-200",ghost:"border-transparent bg-transparent",gradient:"border-ocean-blue-100 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50",ocean:"border-ocean-blue-200 bg-ocean-blue-50"},padding:{none:"p-0",sm:"p-3",default:"p-4",lg:"p-6"}},defaultVariants:{variant:"default",padding:"default"}}),ht=f.forwardRef(({className:t,variant:e,padding:n,...i},r)=>s.jsx("div",{ref:r,className:pe(ZM({variant:e,padding:n,className:t})),...i}));ht.displayName="Card";const Cs=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:pe("flex items-center justify-between mb-3",t),...e}));Cs.displayName="CardHeader";const QM=jo("flex items-center gap-2",{variants:{size:{sm:"text-sm",default:"text-base",lg:"text-lg"}},defaultVariants:{size:"sm"}}),js=f.forwardRef(({className:t,size:e,icon:n,iconColor:i,children:r,...o},a)=>s.jsxs("div",{ref:a,className:pe(QM({size:e,className:t})),...o,children:[n&&s.jsx(n,{className:pe("w-4 h-4",i)}),s.jsx("span",{className:"font-semibold text-slate-800",children:r})]}));js.displayName="CardTitle";const gv=f.forwardRef(({className:t,...e},n)=>s.jsx("p",{ref:n,className:pe("text-sm text-slate-500",t),...e}));gv.displayName="CardDescription";const zt=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:pe("",t),...e}));zt.displayName="CardContent";const eP=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:pe("mt-3 pt-3 border-t border-slate-100",t),...e}));eP.displayName="CardFooter";const Nm={positive:"bg-green-500 hover:bg-green-600",negative:"bg-red-500 hover:bg-red-600",tip:"bg-blue-500 hover:bg-blue-600",default:"bg-slate-500 hover:bg-slate-600"};function Am(t){return Nm[t]||Nm.default}function tP({isLoading:t,audioError:e,isPlaying:n,isMuted:i,currentTime:r,duration:o,timelineMarkers:a=[],onTogglePlay:l,onToggleMute:c,onSkip:d,onSeek:u,progressRef:p}){const h=m=>{if(!p?.current||!o)return;const x=p.current.getBoundingClientRect(),v=(m.clientX-x.left)/x.width*o;u?.(v)};return s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsxs(ht,{variant:"elevated",padding:"lg",children:[s.jsx(Cs,{className:"mb-4",children:s.jsx(js,{icon:Gn,iconColor:"text-slate-800",size:"default",children:"Gesprchsaufnahme"})}),s.jsxs("div",{className:"relative mb-4",children:[t&&s.jsx("div",{className:"flex items-center justify-center bg-slate-100 rounded-lg py-8",children:s.jsx(ge,{className:"icon-lg text-blue-600 animate-spin"})}),e&&s.jsx("div",{className:"flex items-center justify-center bg-slate-100 rounded-lg py-6",children:s.jsxs("div",{className:"text-center px-4",children:[s.jsx(Te,{className:"icon-lg text-orange-500 mx-auto mb-2"}),s.jsx("p",{className:"text-body",children:e})]})}),!e&&!t&&s.jsxs("div",{ref:p,onClick:h,className:"relative w-full h-12 bg-slate-100 rounded-lg cursor-pointer overflow-hidden group",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-100",style:{width:o>0?`${r/o*100}%`:"0%"}}),s.jsx("div",{className:"absolute inset-0 bg-blue-400 opacity-0 group-hover:opacity-10 transition-opacity"}),a.length>0&&a.map((m,x)=>s.jsx("button",{onClick:g=>{g.stopPropagation(),u?.(m.timestamp)},className:pe("absolute top-1 w-3 h-3 rounded-full cursor-pointer transform -translate-x-1/2","transition-transform hover:scale-150 z-10",Am(m.type)),style:{left:`${m.position}%`},title:m.text},x)),s.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-blue-800 transform -translate-x-1/2",style:{left:o>0?`${r/o*100}%`:"0%"}})]})]}),!e&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(he,{variant:"ghost",size:"icon",onClick:()=>d?.(-10),disabled:t,children:s.jsx(Za,{className:"icon-sm"})}),s.jsx(he,{onClick:l,disabled:t,className:"w-12 h-12 rounded-full",children:n?s.jsx(Xa,{className:"icon-md"}):s.jsx(Ht,{className:"icon-md ml-0.5"})}),s.jsx(he,{variant:"ghost",size:"icon",onClick:()=>d?.(PT.SKIP_SECONDS),disabled:t,children:s.jsx(Qa,{className:"icon-sm"})})]}),s.jsxs("div",{className:"flex-1 text-center text-sm text-slate-600",children:[lt(r)," / ",lt(o)]}),s.jsx(he,{variant:"ghost",size:"icon",onClick:c,disabled:t,children:i?s.jsx(Gx,{className:"icon-sm"}):s.jsx(Gn,{className:"icon-sm"})})]}),a.length>0&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[s.jsx("p",{className:"text-label mb-2",children:"Feedback-Marker (klicken zum Springen):"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((m,x)=>s.jsxs("button",{onClick:()=>u?.(m.timestamp),className:pe("px-3 py-1.5 rounded-lg text-xs text-white transition-opacity hover:opacity-80",Am(m.type)),children:[lt(m.timestamp)," - ",m.text?.substring(0,30),m.text?.length>30?"...":""]},x))})]})]})})}function nP(t){return t===void 0?null:lt(t)}function iP({transcript:t=[],activeIndex:e=-1,isPlaying:n=!1,scenario:i,onSeekToEntry:r}){const o=f.useRef(null),{branding:a}=Fe(),l=a?.["--primary-accent"]||ve["--primary-accent"];return f.useEffect(()=>{if(!n||e<0||!o.current)return;const c=o.current,d=c.children[e];if(d){const u=c.getBoundingClientRect(),p=d.getBoundingClientRect();if(p.top<u.top||p.bottom>u.bottom){const h=d.offsetTop-c.offsetTop-c.clientHeight/2+d.clientHeight/2;c.scrollTo({top:Math.max(0,h),behavior:"smooth"})}}},[e,n]),s.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.jsxs(ht,{variant:"elevated",padding:"lg",children:[s.jsx(Cs,{className:"mb-4",children:s.jsx(js,{icon:Le,iconColor:"text-slate-800",size:"default",children:"Gesprchsverlauf"})}),t.length===0?s.jsx("p",{className:"text-slate-500 text-center py-8",children:"Kein Transkript verfgbar."}):s.jsx("div",{ref:o,className:"space-y-3 overflow-y-auto pr-2 scroll-smooth pt-1",style:{maxHeight:"calc(100vh - 400px)",minHeight:"200px"},children:t.map((c,d)=>{const u=d===e,p=c.role==="agent",h=c.timeLabel||nP(c.elapsedTime);return Dl[c.role]||Dl.user,s.jsxs(P.div,{initial:{opacity:.8},animate:{opacity:u?1:.8},onClick:()=>r?.(d),className:pe("flex gap-2 cursor-pointer transition-all w-full",c.role==="user"?"flex-row-reverse":"flex-row",u?"scale-[1.01]":"hover:scale-[1.005]"),children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:p?i?.interviewer_profile?.image_url?s.jsx("img",{src:i.interviewer_profile.image_url,alt:i.interviewer_profile.name||Dl.agent.label,className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-blue-500 to-blue-600",children:s.jsx(us,{className:"icon-sm text-white"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(Et,{className:"icon-sm text-white"})}),h&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:h})]})}),s.jsx("div",{className:pe("max-w-[92%] px-3 py-2 rounded-xl shadow-sm transition-all",p?"bg-slate-50 border":"bg-gradient-to-br from-teal-500 to-teal-600 text-white",u&&"ring-2 ring-offset-1"),style:{...p&&{borderColor:`${l}40`},...u&&{"--tw-ring-color":l}},children:s.jsx("p",{className:pe("text-xs leading-relaxed",p?"text-slate-700":"text-white"),children:c.text})})]},d)})})]})})}function sP(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function rP({session:t,scenario:e,feedback:n}){const i=it(),r=n?.rating?.overall;return s.jsx("div",{style:{backgroundColor:i.primaryAccentLight,borderBottom:`1px solid ${R.slate[200]}`,position:"sticky",top:0,zIndex:10},children:s.jsxs("div",{style:{width:"100%",padding:`${i.space[3]} ${i.space[8]}`,display:"flex",alignItems:"center",gap:i.space[6],flexWrap:"wrap"},children:[s.jsx("h1",{style:{fontSize:i.fontSize.lg,fontWeight:700,color:R.slate[900],margin:0,whiteSpace:"nowrap"},children:e?.title||`Session #${t?.id}`}),s.jsx("div",{style:{width:"1px",height:"20px",backgroundColor:R.slate[200]}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[4],fontSize:i.fontSize.sm,color:R.slate[600]},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:i.space[1.5]},children:[s.jsx(Zi,{style:{width:"16px",height:"16px",color:R.slate[400]}}),sP(t?.created_at)]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:i.space[1.5]},children:[s.jsx(qe,{style:{width:"16px",height:"16px",color:R.slate[400]}}),lt(t?.duration)]}),r&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:i.space[1],backgroundColor:"#fef3c7",color:"#92400e",padding:`${i.space[1]} ${i.space[2.5]}`,borderRadius:i.radius.full,fontSize:i.fontSize.xs,fontWeight:600},children:[s.jsx(Yt,{style:{width:"14px",height:"14px",fill:R.amber[400],color:R.amber[500]}}),r,"/10"]})]})]})})}const Mm=({score:t,size:e="large",maxScore:n=100})=>{const i=e==="large",r=i?54:28,o=i?8:4,a=i?128:72,l=a/2,c=2*Math.PI*r,d=t/n*100,u=d/100*c,p={"text-green-600":{stroke:"#10b981",text:"text-green-600"},"text-blue-600":{stroke:"#3b82f6",text:"text-blue-600"},"text-amber-600":{stroke:"#f59e0b",text:"text-amber-600"},"text-red-600":{stroke:"#ef4444",text:"text-red-600"}},h=$v(d),m=p[h.text]||p["text-red-600"];return s.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[s.jsxs("svg",{className:i?"w-28 h-28":"w-16 h-16",viewBox:`0 0 ${a} ${a}`,children:[s.jsx("circle",{cx:l,cy:l,r,fill:"none",stroke:"#e2e8f0",strokeWidth:o}),s.jsx(P.circle,{cx:l,cy:l,r,fill:"none",stroke:m.stroke,strokeWidth:o,strokeDasharray:c,strokeLinecap:"round",transform:`rotate(-90 ${l} ${l})`,initial:{strokeDashoffset:c},animate:{strokeDashoffset:c-u},transition:{duration:1,ease:"easeOut"}})]}),s.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:s.jsxs(P.span,{className:pe("font-bold",m.text,i?"text-2xl":"text-sm"),initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[Math.round(t),"%"]})})]})},xv=({rating:t,maxRating:e=10,showLabel:n=!0})=>{const i=t/e*100,r=a=>a>=80?"#22c55e":a>=60?"#3b82f6":a>=40?"#f59e0b":"#ef4444",o=a=>a>=80?"#16a34a":a>=60?"#2563eb":a>=40?"#d97706":"#dc2626";return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:"#e2e8f0",borderRadius:"9999px",overflow:"hidden"},children:s.jsx(P.div,{style:{height:"100%",borderRadius:"9999px",backgroundColor:r(i)},initial:{width:0},animate:{width:`${i}%`},transition:{duration:.5,ease:"easeOut"}})}),n&&s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,minWidth:"2.5rem",textAlign:"right",color:o(i)},children:[t,"/",e]})]})},oP=({score:t,fillerWords:e=[]})=>{const n=o=>o>=80?"bg-green-500":o>=50?"bg-amber-500":"bg-red-500",r=(o=>o>=80?{text:"Sehr gut",color:"text-green-600"}:o>=50?{text:"Okay",color:"text-amber-600"}:{text:"Verbesserbar",color:"text-red-600"})(t);return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center",children:s.jsx(wa,{className:"w-4 h-4 text-blue-600"})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Redefluss"})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:s.jsx(P.div,{className:pe("h-full rounded-full",n(t)),initial:{width:0},animate:{width:`${t}%`},transition:{duration:.5,ease:"easeOut"}})}),s.jsxs("div",{className:"flex justify-between items-center mt-1",children:[s.jsx("span",{className:pe("text-xs font-medium",r.color),children:r.text}),s.jsxs("span",{className:"text-xs text-slate-500",children:[t,"%"]})]})]}),e&&e.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1",children:e.map((o,a)=>s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-slate-100 text-slate-600",children:[o.word," (",o.count,"x)"]},a))})]})},aP=({rating:t,feedback:e})=>{const n={zu_langsam:15,optimal:50,zu_schnell:85},i={zu_langsam:{text:"Langsam",color:"text-amber-600"},optimal:{text:"Optimal",color:"text-green-600"},zu_schnell:{text:"Schnell",color:"text-amber-600"}},r=n[t]||50,o=i[t]||i.optimal;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-7 h-7 rounded-lg bg-ocean-blue-100 flex items-center justify-center",children:s.jsx(zx,{className:"w-4 h-4 text-ocean-blue-600"})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Sprechtempo"})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx("div",{className:"h-2 bg-gradient-to-r from-amber-200 via-green-300 to-amber-200 rounded-full"}),s.jsx(P.div,{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white border-2 border-slate-800 rounded-full shadow-md",initial:{left:"50%"},animate:{left:`${r}%`},transition:{duration:.5,ease:"easeOut"},style:{marginLeft:"-8px"}})]}),s.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400 mb-1",children:[s.jsx("span",{children:"Langsam"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Optimal"}),s.jsx("span",{children:"Schnell"})]}),s.jsx("p",{className:pe("text-xs font-medium text-center",o.color),children:o.text}),e&&s.jsx("p",{className:"text-[10px] text-slate-500 text-center mt-1 line-clamp-2",children:e})]})},lP=({rating:t,feedback:e})=>{const n={monoton:{icon:Lr,label:"Monoton",color:"text-amber-600",bgColor:"bg-amber-100",bars:[20,20,20,20,20]},natrlich:{icon:Lr,label:"Natrlich",color:"text-blue-600",bgColor:"bg-blue-100",bars:[30,50,40,60,45]},lebendig:{icon:Lr,label:"Lebendig",color:"text-green-600",bgColor:"bg-green-100",bars:[20,80,40,90,60]}},i=n[t]||n.natrlich,r=i.icon;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:pe("w-7 h-7 rounded-lg flex items-center justify-center",i.bgColor),children:s.jsx(r,{className:pe("w-4 h-4",i.color)})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Betonung"})]}),s.jsx("div",{className:"flex items-end justify-center gap-1 h-8 mb-2",children:i.bars.map((o,a)=>s.jsx(P.div,{className:pe("w-2 rounded-full",i.bgColor),initial:{height:4},animate:{height:`${o}%`},transition:{duration:.3,delay:a*.1}},a))}),s.jsx("p",{className:pe("text-xs font-medium text-center",i.color),children:i.label}),e&&s.jsx("p",{className:"text-[10px] text-slate-500 text-center mt-1 line-clamp-2",children:e})]})},pc=({label:t,rating:e,maxRating:n=10,description:i,index:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),d=e/n*100,p=(m=>m>=80?{icon:$n,color:"#22c55e"}:m>=40?{icon:Bt,color:"#f59e0b"}:{icon:yn,color:"#ef4444"})(d),h=p.icon;return s.jsxs(P.div,{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.05},children:[s.jsxs("button",{onClick:()=>i&&a(!o),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),disabled:!i,style:{width:"100%",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",transition:"background-color 0.2s",backgroundColor:l&&i?"#f8fafc":"transparent",cursor:i?"pointer":"default",border:"none",textAlign:"left"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1,minWidth:0},children:[s.jsx(h,{style:{width:"20px",height:"20px",flexShrink:0,color:p.color}}),s.jsx("span",{style:{fontWeight:500,color:"#1e293b",fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"80px"},children:s.jsx(xv,{rating:e,maxRating:n})}),i&&s.jsx(P.div,{animate:{rotate:o?180:0},transition:{duration:.2},children:s.jsx(wt,{style:{width:"16px",height:"16px",color:"#94a3b8"}})})]})]}),s.jsx(He,{children:o&&i&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"4px 16px 16px 16px",borderTop:"1px solid #f1f5f9"},children:s.jsx("p",{style:{fontSize:"14px",color:"#475569",lineHeight:1.6,margin:0},children:i})})})})]})},cP=({item:t,index:e})=>{const[n,i]=f.useState(!1),r=t.rating||3,o=5,a=r/o*100,c=(p=>p>=80?{icon:$n,color:"text-green-500"}:p>=40?{icon:Bt,color:"text-amber-500"}:{icon:yn,color:"text-red-500"})(a),d=c.icon,u=t.observation||t.quote_evidence||t.improvement_suggestion;return s.jsxs(P.div,{className:"bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:e*.05},children:[s.jsxs("button",{onClick:()=>u&&i(!n),disabled:!u,className:pe("w-full px-4 py-3 flex items-center justify-between gap-3 transition-colors",u?"hover:bg-slate-50 cursor-pointer":"cursor-default"),children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(d,{className:pe("w-5 h-5 flex-shrink-0",c.color)}),s.jsx("span",{className:"font-medium text-slate-800 text-sm truncate",children:t.criterion})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-20",children:s.jsx(xv,{rating:r,maxRating:o})}),u&&s.jsx(P.div,{animate:{rotate:n?180:0},transition:{duration:.2},children:s.jsx(wt,{className:"w-4 h-4 text-slate-400"})})]})]}),s.jsx(He,{children:n&&u&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsxs("div",{className:"px-4 pb-4 pt-1 border-t border-slate-100 space-y-2",children:[t.observation&&s.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:t.observation}),t.quote_evidence&&s.jsxs("blockquote",{className:"text-xs text-slate-500 italic border-l-2 border-slate-200 pl-2",children:['"',t.quote_evidence,'"']}),t.improvement_suggestion&&s.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-700 bg-blue-50 rounded-lg p-2",children:[s.jsx(je,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:t.improvement_suggestion})]})]})})})]})},Vo={"text-green-800":"#166534","text-green-700":"#15803d","text-green-600":"#16a34a","text-green-500":"#22c55e","text-amber-800":"#92400e","text-amber-700":"#b45309","text-amber-600":"#d97706","text-amber-500":"#f59e0b","text-blue-800":"#1e40af","text-blue-700":"#1d4ed8","text-blue-600":"#2563eb","text-blue-500":"#3b82f6"},fc=({title:t,icon:e,items:n,bgColor:i,borderColor:r,headerBgColor:o,iconColor:a,titleColor:l,textColor:c,bulletColor:d,bulletIcon:u,defaultOpen:p=!1})=>{const[h,m]=f.useState(p);if(!n||n.length===0)return null;const x=Vo[l]||l,g=Vo[a]||a,y=Vo[c]||c,v=Vo[d]||d;return s.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},className:pe("border rounded-xl overflow-hidden",i,r),children:[s.jsxs("button",{onClick:()=>m(!h),className:pe("w-full px-4 py-3 flex items-center justify-between gap-3 transition-opacity hover:opacity-90",i),style:{border:"none",background:"transparent"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:pe("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",o),children:s.jsx(e,{className:"w-4 h-4",style:{color:g}})}),s.jsx("h4",{className:"text-sm font-bold",style:{color:x},children:t})]}),s.jsx(P.div,{animate:{rotate:h?180:0},transition:{duration:.2},children:s.jsx(wt,{className:"w-5 h-5",style:{color:g}})})]}),s.jsx(He,{initial:!1,children:h&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsx("div",{className:"px-4 pb-4",children:s.jsx("ul",{className:"space-y-2",children:n.map((w,k)=>s.jsxs("li",{className:"flex items-start gap-2 text-sm",style:{color:y},children:[u?s.jsx(u,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:v}}):s.jsx("span",{className:"mt-0.5 flex-shrink-0",style:{color:v},children:""}),s.jsx("span",{className:"leading-relaxed",children:w})]},k))})})})})]})};function dP({feedback:t,isLoading:e=!1}){const n=f.useMemo(()=>{if(!t)return null;if(typeof t=="string")try{let o=t.trim();return o.startsWith("```json")?o=o.replace(/```json\s*/g,"").replace(/```\s*$/g,""):o.startsWith("```")&&(o=o.replace(/```\s*/g,"").replace(/```\s*$/g,"")),JSON.parse(o)}catch(o){return console.error(" [FEEDBACK_DISPLAY] Failed to parse feedback:",o),null}return t},[t]),i=n?.overall_analysis!==void 0;if(e)return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:s.jsx(ge,{className:"w-10 h-10 text-blue-600"})}),s.jsx("p",{className:"mt-3 text-slate-600 text-sm",children:"Feedback wird geladen..."})]});if(!n)return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(Ya,{className:"w-12 h-12 text-slate-200 mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Kein Feedback verfgbar."}),s.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Das Feedback erscheint hier nach dem Gesprch."})]});if(i){const{overall_analysis:o,audio_metrics:a,categories:l}=n,c=o?.total_score||0;return s.jsxs("div",{className:"space-y-5",children:[s.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-4",children:[s.jsx("div",{className:"bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(Mm,{score:c,size:"large"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-1 flex items-center gap-2",children:[s.jsx(pn,{className:"w-4 h-4 text-blue-600"}),"Gesamtbewertung"]}),o?.summary_text&&s.jsx("p",{className:"text-xs text-slate-600 leading-relaxed line-clamp-3",children:o.summary_text})]})]})}),a&&s.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2",children:[s.jsx(Gn,{className:"w-4 h-4 text-blue-600"}),"Audio & Stimme"]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[s.jsx(oP,{score:a.speech_cleanliness_score||0,fillerWords:a.filler_words_detected}),s.jsx(aP,{rating:a.pacing?.rating||"optimal",feedback:a.pacing?.feedback}),s.jsx(lP,{rating:a.tonality?.rating||"natrlich",feedback:a.tonality?.feedback})]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o?.top_strength&&s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 border border-green-200 rounded-xl",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0",children:s.jsx(eo,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide",children:"Deine Superkraft"}),s.jsx("p",{className:"text-sm text-green-900 mt-0.5 leading-relaxed",children:typeof o.top_strength=="string"?o.top_strength:o.top_strength?.text||o.top_strength?.description||JSON.stringify(o.top_strength)})]})]}),o?.primary_weakness&&s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0",children:s.jsx($e,{className:"w-4 h-4 text-amber-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:"Dein Trainingsfeld"}),s.jsx("p",{className:"text-sm text-amber-900 mt-0.5 leading-relaxed",children:typeof o.primary_weakness=="string"?o.primary_weakness:o.primary_weakness?.text||o.primary_weakness?.description||JSON.stringify(o.primary_weakness)})]})]})]})]}),l&&l.length>0&&s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"space-y-4",children:l.map((d,u)=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[s.jsx(It,{className:"w-4 h-4 text-blue-600"}),d.title]}),d.score!==void 0&&s.jsxs("span",{className:"text-xs font-semibold text-slate-500",children:[d.score,"%"]})]}),s.jsx("div",{className:"space-y-2",children:d.items?.map((p,h)=>s.jsx(cP,{item:p,index:h},h))})]},d.id||u))})]})}const r=n.rating?.overall?Math.round(n.rating.overall/10*100):null;return s.jsxs("div",{className:"space-y-5",children:[s.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-4",children:[s.jsx("div",{className:"bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[r!==null&&s.jsx(Mm,{score:r,size:"large"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-1 flex items-center gap-2",children:[s.jsx(pn,{className:"w-4 h-4 text-blue-600"}),"Gesamtbewertung"]}),n.summary&&s.jsx("p",{className:"text-xs text-slate-600 leading-relaxed line-clamp-3",children:n.summary})]})]})}),n.strengths?.length>0&&s.jsx(fc,{title:"Deine Superkrfte",icon:eo,items:n.strengths,bgColor:"bg-green-50",borderColor:"border-green-200",headerBgColor:"bg-green-100",iconColor:"text-green-600",titleColor:"text-green-800",textColor:"text-green-700",bulletColor:"text-green-500",defaultOpen:!0}),n.improvements?.length>0&&s.jsx(fc,{title:"Dein Trainingsfeld",icon:$e,items:n.improvements,bgColor:"bg-amber-50",borderColor:"border-amber-200",headerBgColor:"bg-amber-100",iconColor:"text-amber-600",titleColor:"text-amber-800",textColor:"text-amber-700",bulletColor:"text-amber-500",defaultOpen:!0}),n.tips?.length>0&&s.jsx(fc,{title:"Praktische Tipps",icon:je,items:n.tips,bgColor:"bg-blue-50",borderColor:"border-blue-200",headerBgColor:"bg-blue-100",iconColor:"text-blue-600",titleColor:"text-blue-800",textColor:"text-blue-700",bulletColor:"text-blue-500",bulletIcon:wo,defaultOpen:!0})]}),n.rating&&s.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2",children:[s.jsx(It,{className:"w-4 h-4 text-blue-600"}),"Bewertungskriterien"]}),s.jsxs("div",{className:"space-y-2",children:[n.rating.communication!==void 0&&s.jsx(pc,{label:"Kommunikation",rating:n.rating.communication,maxRating:10,description:"Wie klar und verstndlich du dich whrend des Gesprchs ausgedrckt hast.",index:0}),n.rating.motivation!==void 0&&s.jsx(pc,{label:"Motivation",rating:n.rating.motivation,maxRating:10,description:"Wie motiviert und engagiert du whrend des Gesprchs gewirkt hast.",index:1}),n.rating.professionalism!==void 0&&s.jsx(pc,{label:"Professionalitt",rating:n.rating.professionalism,maxRating:10,description:"Dein professionelles Auftreten und Verhalten im Gesprch.",index:2})]})]})]})}function uP(t){return t>=Pl.EXCELLENT?{stroke:"#22c55e",bg:"from-green-50 to-green-100",text:"text-green-600",label:"Sehr selbstsicher"}:t>=Pl.GOOD?{stroke:"#3b82f6",bg:"from-blue-50 to-blue-100",text:"text-blue-600",label:"Selbstsicher"}:t>=Pl.FAIR?{stroke:"#f59e0b",bg:"from-amber-50 to-amber-100",text:"text-amber-600",label:"Ausbaufhig"}:{stroke:"#ef4444",bg:"from-red-50 to-red-100",text:"text-red-600",label:"Unsicher"}}function yv({score:t,size:e=160}){const n=e/2-15,i=Math.PI*n,r=Math.max(0,Math.min(100,t)),o=i-r/100*i,a=uP(t);return s.jsxs("div",{className:pe("relative flex flex-col items-center p-4 rounded-2xl bg-gradient-to-br",a.bg),children:[s.jsxs("div",{className:"relative",style:{width:e,height:e/2+20},children:[s.jsxs("svg",{width:e,height:e/2+20,viewBox:`0 0 ${e} ${e/2+20}`,className:"overflow-visible",children:[s.jsx("path",{d:`M 15 ${e/2} A ${n} ${n} 0 0 1 ${e-15} ${e/2}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"12",strokeLinecap:"round"}),s.jsx(P.path,{d:`M 15 ${e/2} A ${n} ${n} 0 0 1 ${e-15} ${e/2}`,fill:"none",stroke:a.stroke,strokeWidth:"12",strokeLinecap:"round",strokeDasharray:i,initial:{strokeDashoffset:i},animate:{strokeDashoffset:o},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-end pb-2",children:[s.jsx(P.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.3},className:pe("text-4xl font-bold",a.text),children:t}),s.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"/ 100"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.jsx(zx,{className:pe("w-4 h-4",a.text)}),s.jsx("span",{className:pe("text-sm font-semibold",a.text),children:a.label})]})]})}const hP=jo("inline-flex items-center justify-center rounded text-xs font-medium transition-colors",{variants:{variant:{default:"bg-slate-100 text-slate-700",secondary:"bg-slate-200 text-slate-800",outline:"border border-slate-300 text-slate-700",success:"bg-green-100 text-green-800",warning:"bg-amber-100 text-amber-800",error:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800","success-soft":"bg-green-50 text-green-700 border border-green-200","warning-soft":"bg-amber-50 text-amber-700 border border-amber-200","error-soft":"bg-red-50 text-red-700 border border-red-200","info-soft":"bg-blue-50 text-blue-700 border border-blue-200"},size:{sm:"px-1.5 py-0.5 text-[10px]",default:"px-2 py-1",lg:"px-2.5 py-1.5 text-sm"}},defaultVariants:{variant:"default",size:"default"}}),ml=f.forwardRef(({className:t,variant:e,size:n,...i},r)=>s.jsx("span",{ref:r,className:pe(hP({variant:e,size:n,className:t})),...i}));ml.displayName="Badge";const pP=jo("inline-flex items-center gap-1 font-mono text-xs rounded",{variants:{variant:{default:"bg-slate-100 text-slate-600",positive:"bg-green-200 text-green-800",negative:"bg-red-200 text-red-800",warning:"bg-amber-200 text-amber-800",info:"bg-blue-200 text-blue-800"},size:{sm:"px-1 py-0.5 text-[10px]",default:"px-1.5 py-0.5"}},defaultVariants:{variant:"default",size:"default"}}),Qu=f.forwardRef(({className:t,variant:e,size:n,...i},r)=>s.jsx("span",{ref:r,className:pe(pP({variant:e,size:n,className:t})),...i}));Qu.displayName="TimestampBadge";function bv({rating:t,wpm:e,feedback:n}){const i=qp[t]||qp.optimal,{position:r,isOptimal:o}=i;return s.jsxs(ht,{children:[s.jsxs(Cs,{children:[s.jsx(js,{icon:$x,iconColor:"text-blue-500",children:"Sprechtempo"}),e&&s.jsx(ml,{variant:"default",className:"font-mono",children:e})]}),s.jsxs("div",{className:"relative h-8 mb-3",children:[s.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-2 rounded-full bg-gradient-to-r from-blue-200 via-green-300 to-red-200"}),s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-4 bg-green-400/30 rounded-full border border-green-400"}),s.jsxs("div",{className:"absolute inset-x-0 -bottom-1 flex justify-between px-2",children:[s.jsx("span",{className:"text-[10px] text-slate-400",children:"Langsam"}),s.jsx("span",{className:"text-[10px] text-green-600 font-medium",children:"Optimal"}),s.jsx("span",{className:"text-[10px] text-slate-400",children:"Schnell"})]}),s.jsx(P.div,{initial:{left:"50%"},animate:{left:`${r}%`},transition:{duration:.8,ease:"easeOut"},className:pe("absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-5 h-5 rounded-full shadow-lg border-2 border-white",o?"bg-green-500":"bg-amber-500")})]}),n&&s.jsx("p",{className:"text-body-muted mt-4",children:n})]})}function vv({rating:t,highlights:e,feedback:n,onJumpToTimestamp:i}){const r=Kp[t]||Kp.natrlich,o=f.useMemo(()=>{const a=[],l=t==="monoton"?30:t==="lebendig"?20:25,c=r.waveformVariance;for(let d=0;d<30;d++){const u=Math.sin(d*12.9898)*43758.5453%1,p=l+Math.sin(d*.5)*c+u*(c/2);a.push(Math.max(10,Math.min(100,p)))}return a},[t,r.waveformVariance]);return s.jsxs(ht,{children:[s.jsxs(Cs,{children:[s.jsx(js,{icon:Ux,iconColor:"text-ocean-teal-600",children:"Betonung & Melodie"}),s.jsxs(ml,{variant:"default",className:pe(r.bg,r.color),children:[r.icon," ",r.label]})]}),s.jsx("div",{className:"flex items-center justify-center gap-0.5 h-12 mb-3",children:o.map((a,l)=>s.jsx(P.div,{initial:{height:0},animate:{height:`${a}%`},transition:{duration:.5,delay:l*.02},className:pe("w-1 rounded-full",r.bg.replace("50","400"))},l))}),e&&e.length>0&&s.jsx("div",{className:"space-y-1.5 mb-3",children:e.map((a,l)=>{const c=a.type==="positive"?Ca.positive:Ca.negative;return s.jsxs("button",{onClick:()=>i?.(a.timestamp),className:pe("w-full flex items-center gap-2 px-2 py-1.5 rounded-lg text-left","interactive-scale",c.all),children:[s.jsx(Qu,{variant:a.type==="positive"?"positive":"negative",children:a.timestamp}),a.type==="positive"?s.jsx($n,{className:"icon-sm text-green-500 flex-shrink-0"}):s.jsx(yn,{className:"icon-sm text-red-500 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-slate-700 flex-1 truncate",children:a.note}),s.jsx(Ht,{className:"icon-xs text-slate-400"})]},l)})}),n&&s.jsx("p",{className:"text-body-muted",children:n})]})}const fP=jo("mt-3 p-3 rounded-lg border",{variants:{variant:{default:"bg-blue-50 border-blue-200",success:"bg-green-50 border-green-200",warning:"bg-amber-50 border-amber-200",info:"bg-slate-50 border-slate-200"}},defaultVariants:{variant:"default"}}),mP={default:"text-blue-800",success:"text-green-800",warning:"text-amber-800",info:"text-slate-700"},gP={default:"text-blue-500",success:"text-green-500",warning:"text-amber-500",info:"text-slate-500"},xP={default:je,success:Jt,warning:yn,info:mn},Sv=f.forwardRef(({className:t,variant:e="default",icon:n,children:i,...r},o)=>{const a=n||xP[e],l=mP[e],c=gP[e];return s.jsx("div",{ref:o,className:pe(fP({variant:e,className:t})),...r,children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(a,{className:pe("w-4 h-4 flex-shrink-0 mt-0.5",c)}),s.jsx("p",{className:pe("text-xs leading-relaxed",l),children:i})]})})});Sv.displayName="FeedbackTip";function yP(t){return t<=Jp.GOOD?"text-green-500":t<=Jp.MODERATE?"text-amber-500":"text-red-500"}function bP({fillerWordAnalysis:t,score:e,feedback:n,onJumpToTimestamp:i}){const[r,o]=f.useState(null),a=t?.reduce((l,c)=>l+(c.count||0),0)||0;return s.jsxs(ht,{children:[s.jsxs(Cs,{children:[s.jsx(js,{icon:Le,iconColor:"text-orange-500",children:"Fllwrter"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(ml,{variant:"default",children:[a,"x gesamt"]}),e!==void 0&&s.jsxs("span",{className:pe("text-sm font-bold",Gv(e)),children:[e,"/100"]})]})]}),t&&t.length>0?s.jsx("div",{className:"space-y-2",children:t.map((l,c)=>s.jsxs("div",{className:"border border-slate-100 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>o(r===c?null:c),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(P.div,{animate:{rotate:r===c?90:0},transition:{duration:.2},children:s.jsx(Xt,{className:"icon-sm text-slate-400"})}),s.jsxs("span",{className:"font-medium text-slate-700 text-sm",children:['"',l.word,'"']})]}),s.jsxs("span",{className:pe("text-sm font-bold",yP(l.count)),children:[l.count,"x"]})]}),s.jsx(He,{children:r===c&&l.examples&&l.examples.length>0&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsxs("div",{className:"px-3 pb-3 pt-1 bg-slate-50 border-t border-slate-100",children:[s.jsx("p",{className:"text-label mb-2",children:"Klicke zum Anhren:"}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.examples.map((d,u)=>s.jsxs("button",{onClick:p=>{p.stopPropagation(),i?.(d.timestamp)},className:pe("inline-flex items-center gap-1.5 px-2 py-1 rounded-md transition-all group",Ca.neutral.all),children:[s.jsx("span",{className:"font-mono text-xs text-blue-600 group-hover:text-blue-700",children:d.timestamp}),d.context&&s.jsxs("span",{className:"text-[10px] text-slate-400 group-hover:text-slate-500",children:["(",d.context,")"]}),s.jsx(Ht,{className:"icon-xs text-blue-400 group-hover:text-blue-600"})]},u))})]})})})]},c))}):s.jsxs("div",{className:"flex items-center gap-2 text-green-600 py-2",children:[s.jsx($n,{className:"icon-sm"}),s.jsx("span",{className:"text-sm",children:"Keine Fllwrter erkannt!"})]}),n&&s.jsx(Sv,{children:n})]})}function vP({issues:t,onJumpToTimestamp:e}){return!t||t.length===0?null:s.jsxs("div",{className:"mt-3 space-y-1.5",children:[s.jsx("p",{className:"text-label font-medium",children:"Auffllige Stellen:"}),t.map((n,i)=>s.jsxs("button",{onClick:()=>e?.(n.timestamp),className:pe("w-full flex items-center gap-2 px-2 py-1.5 rounded-lg text-left","interactive-scale",Ca.warning.all),children:[s.jsx(Qu,{variant:"warning",children:n.timestamp}),s.jsx(yn,{className:"icon-sm text-amber-500 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-slate-700 flex-1 truncate",children:n.issue}),s.jsx(Ht,{className:"icon-xs text-slate-400"})]},i))]})}function SP(){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:s.jsx(ge,{className:"w-10 h-10 text-blue-600"})}),s.jsx("p",{className:"mt-3 text-slate-600 text-sm",children:"Audio wird analysiert..."})]})}function kP(){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(wa,{className:"w-12 h-12 text-slate-200 mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Keine Audio-Analyse verfgbar."}),s.jsx("p",{className:"text-slate-400 text-xs mt-1 text-center",children:"Die Stimmanalyse erscheint hier nach der Aufnahme."})]})}function wP({message:t}){return s.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:[s.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Audio-Analyse nicht verfgbar"}),s.jsx("p",{className:"text-xs text-amber-600 mt-1",children:t})]})}function CP({audioMetrics:t,onJumpToTimestamp:e}){return s.jsxs("div",{className:"space-y-4",children:[t.confidence_score!==void 0&&s.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-2 flex items-center gap-2",children:[s.jsx(It,{className:"w-4 h-4 text-amber-500"}),"Selbstsicherheit"]}),s.jsx(yv,{score:t.confidence_score,size:160})]}),t.summary_text&&s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.4},className:"p-3 bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:t.summary_text})}),t.speech_cleanliness&&s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},children:s.jsx(bP,{fillerWordAnalysis:t.speech_cleanliness.filler_word_analysis,score:t.speech_cleanliness.score,feedback:t.speech_cleanliness.feedback,onJumpToTimestamp:e})}),t.pacing&&s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},children:[s.jsx(bv,{rating:t.pacing.rating,wpm:t.pacing.perceived_wpm,feedback:t.pacing.feedback}),s.jsx(vP,{issues:t.pacing.issues_detected,onJumpToTimestamp:e})]}),t.tonality&&s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},children:s.jsx(vv,{rating:t.tonality.rating,highlights:t.tonality.highlights,feedback:t.tonality.feedback,onJumpToTimestamp:e})})]})}function jP({data:t,onJumpToTimestamp:e}){const n=t.audio_metrics||t;return s.jsxs("div",{className:"space-y-4",children:[t.overall_analysis&&s.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-br from-blue-50 to-slate-50 border border-blue-200 rounded-xl",children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-2 flex items-center gap-2",children:[s.jsx(Gn,{className:"w-4 h-4 text-blue-500"}),"Gesamtbewertung"]}),s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:typeof t.overall_analysis=="string"?t.overall_analysis:t.overall_analysis?.summary_text||t.overall_analysis?.summary||"Audio-Analyse verfgbar"}),t.overall_analysis?.total_score!==void 0&&s.jsx("div",{className:"mt-2",children:s.jsx(yv,{score:t.overall_analysis.total_score,size:140})})]}),n.pacing&&s.jsx(bv,{rating:n.pacing.rating,feedback:n.pacing.feedback}),n.tonality&&s.jsx(vv,{rating:n.tonality.rating,feedback:n.tonality.feedback,onJumpToTimestamp:e}),!t.overall_analysis&&!n.pacing&&!n.tonality&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Ya,{className:"w-12 h-12 text-slate-200 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Keine detaillierten Metriken verfgbar."})]})]})}function TP({audioAnalysis:t,isLoading:e=!1,onJumpToTimestamp:n}){const i=f.useMemo(()=>el(t,{context:"audio_analysis"}),[t]),r=t2(i);return e?s.jsx(SP,{}):i?i.error?s.jsx(wP,{message:i.summary||i.errorMessage||"Unbekannter Fehler"}):r&&i.audio_metrics?s.jsx(CP,{audioMetrics:i.audio_metrics,onJumpToTimestamp:n}):s.jsx(jP,{data:i,onJumpToTimestamp:n}):s.jsx(kP,{})}const EP=({session:t,scenario:e,feedback:n,audioAnalysis:i,coachingComments:r=[],onRetry:o,onCollapse:a,onJumpToTimestamp:l,isCollapsed:c=!1,className:d})=>{const[u,p]=f.useState("coaching"),[h,m]=f.useState(null),x=it(),g=f.useMemo(()=>n?.rating?.overall?Math.round(n.rating.overall/10*100):null,[n]),y=f.useMemo(()=>`session-sidebar-${Math.random().toString(36).substr(2,9)}`,[]),v=f.useMemo(()=>`
    /* Override ALL Elementor/WordPress button styles for this sidebar's tabs */
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"],
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:link,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:visited,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:hover,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:focus,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:active {
      background-color: transparent !important;
      background-image: none !important;
      color: ${x.textMuted} !important;
      border: none !important;
      border-bottom: 2px solid transparent !important;
      border-color: transparent !important;
      outline: none !important;
      box-shadow: none !important;
      text-decoration: none !important;
    }
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:hover,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:focus {
      background-color: ${x.cardBgHover} !important;
      color: ${x.textSecondary} !important;
      border-bottom: 2px solid transparent !important;
    }
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"],
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"]:link,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"]:visited,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"]:hover,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"]:focus,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"][data-active="true"]:active {
      background-color: ${x.primaryAccentLight} !important;
      color: ${x.primaryAccent} !important;
      border: none !important;
      border-bottom: 2px solid ${x.primaryAccent} !important;
    }
    /* Also override icon colors inside buttons */
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"] svg,
    #bewerbungstrainer-app [data-sidebar-id="${y}"] button[data-tab-button="true"]:hover svg {
      color: inherit !important;
      fill: currentColor !important;
    }
  `,[y,x]);return c?s.jsxs(P.div,{initial:{width:0,opacity:0},animate:{width:48,opacity:1},style:{backgroundColor:x.cardBgColor,borderLeft:`1px solid ${x.borderColor}`,display:"flex",flexDirection:"column",alignItems:"center",padding:"16px 0"},children:[s.jsx(he,{variant:"ghost",size:"icon",onClick:a,style:{marginBottom:"16px"},children:s.jsx(Xt,{style:{width:"16px",height:"16px"}})}),s.jsx("div",{style:{writingMode:"vertical-rl",fontSize:"12px",color:x.textMuted,fontWeight:500},children:"Feedback Panel"})]}):s.jsxs(s.Fragment,{children:[s.jsx("style",{children:v}),s.jsxs(P.div,{"data-sidebar-id":y,initial:{width:0,opacity:0},animate:{width:"100%",opacity:1},style:{backgroundColor:x.cardBgColor,borderLeft:`1px solid ${x.borderColor}`,display:"flex",flexDirection:"column",overflow:"hidden",height:"calc(100vh - 120px)",maxHeight:"800px"},children:[s.jsxs("div",{style:{background:x.headerGradient,padding:"16px",flexShrink:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(dr,{style:{width:"20px",height:"20px",color:x.warning}}),s.jsx("span",{style:{color:x.headerText,fontWeight:600,fontSize:"14px"},children:"Rollenspiel abgeschlossen"})]}),s.jsx(he,{size:"sm",onClick:o,style:{backgroundColor:x.overlayLight,color:x.headerText,border:"none",fontSize:"12px"},children:"Erneut ben"})]}),g!==null&&s.jsxs("p",{style:{color:`${x.headerText}CC`,fontSize:"12px",margin:0},children:["Ihre Punktzahl war ",s.jsxs("span",{style:{color:x.headerText,fontWeight:700},children:[g,"%"]})]})]}),s.jsxs("div",{style:{display:"flex",borderBottom:`1px solid ${x.borderColor}`,flexShrink:0},children:[s.jsx("button",{onClick:a,style:{padding:"12px",borderRight:`1px solid ${x.borderColor}`,color:x.textMuted,backgroundColor:x.transparent,border:"none",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:w=>{w.currentTarget.style.backgroundColor=x.cardBgHover,w.currentTarget.style.color=x.textSecondary},onMouseLeave:w=>{w.currentTarget.style.backgroundColor=x.transparent,w.currentTarget.style.color=x.textMuted},title:"Panel einklappen",children:s.jsx(Hj,{style:{width:"16px",height:"16px"}})}),s.jsxs("button",{"data-tab-button":"true","data-active":u==="coaching"?"true":void 0,onClick:()=>p("coaching"),onMouseEnter:()=>m("coaching"),onMouseLeave:()=>m(null),style:{flex:1,padding:"12px 16px",fontSize:"14px",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:u==="coaching"?x.primaryAccentLight:h==="coaching"?x.cardBgHover:x.transparent,color:u==="coaching"?x.primaryAccent:h==="coaching"?x.textMain:x.textMuted,borderBottom:u==="coaching"?`2px solid ${x.primaryAccent}`:"2px solid transparent"},children:[s.jsx(Le,{style:{width:"16px",height:"16px"}}),"Coaching"]}),s.jsxs("button",{"data-tab-button":"true","data-active":u==="analysen"?"true":void 0,onClick:()=>p("analysen"),onMouseEnter:()=>m("analysen"),onMouseLeave:()=>m(null),style:{flex:1,padding:"12px 16px",fontSize:"14px",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:u==="analysen"?x.primaryAccentLight:h==="analysen"?x.cardBgHover:x.transparent,color:u==="analysen"?x.primaryAccent:h==="analysen"?x.textMain:x.textMuted,borderBottom:u==="analysen"?`2px solid ${x.primaryAccent}`:"2px solid transparent"},children:[s.jsx(Ya,{style:{width:"16px",height:"16px"}}),"Analysen"]})]}),s.jsx("div",{style:{flex:1,overflowY:"auto"},children:s.jsxs(He,{mode:"wait",children:[u==="coaching"&&s.jsx(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},style:{padding:"16px"},children:s.jsx(dP,{feedback:n,isLoading:!1})},"coaching"),u==="analysen"&&s.jsx(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},style:{padding:"16px"},children:s.jsx(TP,{audioAnalysis:i,isLoading:!1,onJumpToTimestamp:l})},"analysen")]})})]})]})};function RP(t,e){const n=f.useRef(null),i=f.useRef(null),[r,o]=f.useState(!1),[a,l]=f.useState(!1),[c,d]=f.useState(0),[u,p]=f.useState(0),[h,m]=f.useState(null),[x,g]=f.useState(!0);f.useEffect(()=>{if(!e)return;const S=bu(t);return g(!0),m(null),fetch(S,{method:"GET",headers:{"X-WP-Nonce":Lt()},credentials:"same-origin"}).then(b=>{if(!b.ok)throw new Error(`HTTP ${b.status}`);return b.blob()}).then(b=>{const j=URL.createObjectURL(b),C=new Audio(j);n.current=C,C._objectUrl=j,C.addEventListener("loadedmetadata",()=>{p(C.duration),g(!1)}),C.addEventListener("timeupdate",()=>d(C.currentTime)),C.addEventListener("play",()=>o(!0)),C.addEventListener("pause",()=>o(!1)),C.addEventListener("ended",()=>o(!1)),C.addEventListener("error",()=>{m("Audio konnte nicht abgespielt werden."),g(!1)})}).catch(b=>{console.error(" [AUDIO] Load error:",b),m("Audio nicht verfgbar."),g(!1)}),()=>{n.current&&(n.current.pause(),n.current._objectUrl&&URL.revokeObjectURL(n.current._objectUrl),n.current=null)}},[t,e]);const y=f.useCallback(()=>{n.current&&(r?n.current.pause():n.current.play())},[r]),v=f.useCallback(()=>{n.current&&(n.current.muted=!a,l(!a))},[a]),w=f.useCallback(S=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+S,u)))},[u]),k=f.useCallback(S=>{n.current&&u>0&&(n.current.currentTime=S)},[u]);return{audioRef:n,progressRef:i,isPlaying:r,isMuted:a,currentTime:c,duration:u,audioError:h,isLoading:x,togglePlay:y,toggleMute:v,skip:w,seekToTime:k}}function IP(t,e){return f.useMemo(()=>{if(!t?.length)return-1;let n=-1;for(let i=0;i<t.length&&(t[i].elapsedTime??0)<=e;i++)n=i;return n},[t,e])}function _P({session:t,onBack:e}){const[n,i]=f.useState(t),[r,o]=f.useState(null),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,p]=f.useState(!1),h=RP(n?.id,n?.conversation_id),m=f.useMemo(()=>i0(n?.feedback_json),[n?.feedback_json]),x=f.useMemo(()=>s0(n?.audio_analysis_json),[n?.audio_analysis_json]),g=f.useMemo(()=>r0(n?.transcript),[n?.transcript]),y=IP(g,h.currentTime),v=f.useMemo(()=>!m?.timeline||!h.duration?[]:m.timeline.map(j=>({...j,position:j.timestamp/h.duration*100})),[m,h.duration]);f.useEffect(()=>{w()},[t?.id]);const w=async()=>{try{l(!0),d(null);const j=await l0(t.id);if(i(C=>({...j,feedback_json:j.feedback_json||C?.feedback_json,audio_analysis_json:j.audio_analysis_json||C?.audio_analysis_json,transcript:j.transcript||C?.transcript,conversation_id:j.conversation_id||C?.conversation_id})),j.scenario_id)try{const C=await u0(j.scenario_id);o(C)}catch(C){console.warn("Could not load scenario:",C)}}catch(j){console.error("Failed to load session:",j),d(j.message||"Fehler beim Laden der Session")}finally{l(!1)}},k=f.useCallback(j=>{if(!j)return 0;const C=j.split(":");return C.length===2?(parseInt(C[0],10)||0)*60+(parseInt(C[1],10)||0):0},[]),S=f.useCallback(j=>{const C=k(j);h.seekToTime(C),h.audioRef.current&&!h.isPlaying&&h.audioRef.current.play().catch(()=>{})},[k,h]),b=f.useCallback(j=>{const C=g[j];C?.elapsedTime!==void 0&&h.seekToTime(C.elapsedTime)},[g,h]);return a?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ge,{className:"w-12 h-12 text-ocean-blue-600 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Gesprchsanalyse wird geladen..."})]})}):c?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[s.jsx(Te,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),s.jsx("p",{className:"text-slate-600 mb-4",children:c}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx(he,{variant:"outline",onClick:e,children:"Zurck"}),s.jsx(he,{onClick:w,children:"Erneut versuchen"})]})]})}):s.jsxs("div",{className:"min-h-screen pb-8",children:[s.jsx(rP,{session:n,scenario:r,feedback:m}),s.jsx("div",{className:"w-full px-4 lg:px-8 py-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 items-start",children:[s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[s.jsx(tP,{isLoading:h.isLoading,audioError:h.audioError,isPlaying:h.isPlaying,isMuted:h.isMuted,currentTime:h.currentTime,duration:h.duration,timelineMarkers:v,onTogglePlay:h.togglePlay,onToggleMute:h.toggleMute,onSkip:h.skip,onSeek:h.seekToTime,progressRef:h.progressRef}),s.jsx(iP,{transcript:g,activeIndex:y,isPlaying:h.isPlaying,scenario:r,onSeekToEntry:b})]}),s.jsx("div",{className:pe("lg:col-span-2 self-start",u&&"lg:col-span-1"),children:s.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:s.jsx(EP,{session:n,scenario:r,feedback:m,audioAnalysis:x,coachingComments:[],onRetry:()=>{r&&(window.location.href=`?scenario=${r.id}`)},onCollapse:()=>p(!u),onJumpToTimestamp:S,isCollapsed:u})})})]})})]})}const NP={briefcase:Mn,banknote:Xi,user:Et,presentation:Wx,target:$e,mic:We},AP=async()=>{const t=await fetch(`${ni()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Lt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Keine Szenarien gefunden")},MP=t=>NP[t.icon]||Mn,PP=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:qe,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],Pm=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>s.jsx(sl,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:It,fetchScenarios:AP,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:PP,getIconForScenario:MP,cardActionLabel:"Starten",cardActionIcon:Bt,categoryField:"category",emptyStateIcon:We,emptyStateTitle:"Keine Trainingsszenarien verfgbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:e,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."}),DP=({field:t,value:e,onChange:n,error:i,focusColor:r,branding:o})=>{const a=r||"#4a9ec9",l={width:"100%",padding:`${o.space[3]} ${o.space[4]}`,borderRadius:o.radius.lg,border:`2px solid ${i?R.red[500]:R.slate[200]}`,fontSize:o.fontSize.base,color:R.slate[900],backgroundColor:"white",outline:"none",transition:o.transition.normal},c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=h=>{Object.assign(h.target.style,c),setTimeout(()=>{const m=h.target;if(m){const x=m.closest("div");x&&x.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=h=>{h.target.style.borderColor=i?R.red[500]:R.slate[200],h.target.style.boxShadow="none"},p=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u});case"textarea":return s.jsx("textarea",{value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:h=>n(t.key,h.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(h=>s.jsx("option",{value:h.value,children:h.label},h.value))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:l,onFocus:d,onBlur:u});default:return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u})}};return s.jsxs("div",{style:{marginBottom:o.space[5]},children:[s.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:o.space[1]},children:"*"})]}),p(),i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:R.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(Te,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:R.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(mn,{style:{width:"14px",height:"14px"}}),t.hint]})]})},OP=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),l=it(),c=ur.useMemo(()=>{if(!t?.input_configuration)return[];try{const h=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(h)?h.filter(m=>m.user_input!==!1):[]}catch(h){return console.error("Error parsing input_configuration:",h),[]}},[t?.input_configuration]);f.useEffect(()=>{const h={};c.forEach(m=>{m.default&&(h[m.key]=m.default)}),r(h)},[c]);const d=(h,m)=>{r(x=>({...x,[h]:m})),o[h]&&a(x=>{const g={...x};return delete g[h],g})},u=()=>{const h={};return c.forEach(m=>{const x=i[m.key];if(m.required&&(!x||x.trim()==="")){h[m.key]="Dieses Feld ist erforderlich";return}if(!(!x||x.trim()==="")&&m.validation){const{minLength:g,maxLength:y,min:v,max:w,pattern:k}=m.validation;g&&x.length<g&&(h[m.key]=`Mindestens ${g} Zeichen erforderlich`),y&&x.length>y&&(h[m.key]=`Maximal ${y} Zeichen erlaubt`),v!==void 0&&Number(x)<v&&(h[m.key]=`Mindestens ${v}`),w!==void 0&&Number(x)>w&&(h[m.key]=`Maximal ${w}`),k&&!new RegExp(k).test(x)&&(h[m.key]="Ungltiges Format")}}),a(h),Object.keys(h).length===0},p=h=>{h.preventDefault(),u()&&n(i)};return f.useEffect(()=>{c.length===0&&n({})},[c,n]),c.length===0?null:s.jsxs("div",{style:{padding:l.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:l.space[8]},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:l.space[2],padding:`${l.space[2]} ${l.space[3]}`,marginBottom:l.space[4],border:"none",background:"transparent",color:R.slate[600],fontSize:l.fontSize.sm,cursor:"pointer",borderRadius:l.radius.md,transition:l.transition.normal},onMouseEnter:h=>h.target.style.background=R.slate[100],onMouseLeave:h=>h.target.style.background="transparent",children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[4]},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:l.radius.xl,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(It,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:l.fontSize["2xl"],fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[600],margin:`${l.space[1]} 0 0 0`},children:"Personalisiere dein Training"})]})]})]}),s.jsx("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:R.slate[100],marginBottom:l.space[6]},children:s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),s.jsxs("form",{onSubmit:p,children:[c.map(h=>s.jsx(DP,{field:h,value:i[h.key],onChange:d,error:o[h.key],focusColor:l.primaryAccent,branding:l},h.key)),s.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:l.primaryAccentLight,marginTop:l.space[6],marginBottom:l.space[6],display:"flex",gap:l.space[5],flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:"Fragen"}),s.jsxs("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:[t.question_count_min,"-",t.question_count_max]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:"Zeit pro Frage"}),s.jsxs("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),s.jsxs("button",{type:"submit",style:{width:"100%",padding:`${l.space[4]} ${l.space[6]}`,borderRadius:l.radius.xl,border:"none",background:l.buttonGradient,color:"white",fontSize:l.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:l.space[2.5],transition:l.transition.normal,boxShadow:`0 4px 12px ${l.primaryAccent}4d`},onMouseEnter:h=>{h.target.style.transform="translateY(-2px)",h.target.style.boxShadow=`0 6px 16px ${l.primaryAccent}66`},onMouseLeave:h=>{h.target.style.transform="none",h.target.style.boxShadow=`0 4px 12px ${l.primaryAccent}4d`},children:["Weiter",s.jsx(yo,{style:{width:"20px",height:"20px"}})]})]})]})},$o=({score:t,label:e,size:n="normal",primaryAccent:i,branding:r})=>{const o=t!=null?t*10:null,l=(d=>d>=80?r.success:d>=60?i:d>=40?r.warning:r.error)(o),c=n==="large";return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:r.space[1]},children:[s.jsx("div",{style:{width:c?"80px":"56px",height:c?"80px":"56px",borderRadius:r.radius.full,backgroundColor:`${l}15`,border:`3px solid ${l}`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("span",{style:{fontSize:c?r.fontSize["5xl"]:r.fontSize["2xl"],fontWeight:r.fontWeight.bold,color:l},children:o!=null?Math.round(o):"-"})}),s.jsx("span",{style:{fontSize:c?r.fontSize.base:r.fontSize.xs,color:r.textSecondary,fontWeight:r.fontWeight.medium},children:e})]})},Rr=({title:t,icon:e,children:n,defaultOpen:i=!0,primaryAccent:r,branding:o})=>{const[a,l]=f.useState(i);return s.jsxs("div",{style:{borderRadius:o.radius.lg,border:`1px solid ${o.borderColor}`,backgroundColor:o.cardBg,overflow:"hidden",marginBottom:o.space[4]},children:[s.jsxs("button",{onClick:()=>l(!a),style:{width:"100%",padding:`${o.space[4]} ${o.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3]},children:[s.jsx(e,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:r}}),s.jsx("span",{style:{fontSize:o.fontSize.md,fontWeight:o.fontWeight.semibold,color:o.textMain},children:t})]}),a?s.jsx(zi,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}}):s.jsx(wt,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}})]}),a&&s.jsx("div",{style:{padding:`0 ${o.space[5]} ${o.space[5]} ${o.space[5]}`,borderTop:`1px solid ${o.cardBgHover}`,paddingTop:o.space[4]},children:n})]})},mc=({text:t,type:e,primaryAccent:n,primaryAccentLight:i,branding:r})=>{const o={strength:{icon:eo,color:r.success,bg:r.successLight},improvement:{icon:yn,color:r.warning,bg:r.warningLight},tip:{icon:je,color:n,bg:i}},{icon:a,color:l,bg:c}=o[e]||o.tip;return s.jsxs("div",{style:{display:"flex",gap:r.space[3],padding:r.space[3],borderRadius:r.radius.md,backgroundColor:c,marginBottom:r.space[2]},children:[s.jsx(a,{style:{width:r.iconSize.md,height:r.iconSize.md,color:l,flexShrink:0,marginTop:"2px"}}),s.jsx("span",{style:{fontSize:r.fontSize.base,color:r.textSecondary,lineHeight:1.5},children:t})]})},LP=({metrics:t,branding:e})=>{if(!t)return null;const i=(o=>{switch(o){case"optimal":return{label:"Optimal",color:e.success};case"zu_schnell":return{label:"Zu schnell",color:e.warning};case"zu_langsam":return{label:"Zu langsam",color:e.warning};default:return{label:o||"N/A",color:e.textMuted}}})(t.speech_rate),r=o=>{switch(o){case"niedrig":return e.success;case"mittel":return e.warning;case"hoch":return e.error;default:return e.textMuted}};return s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:e.space[4]},children:[s.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Sprechtempo"}),s.jsx("span",{style:{fontSize:e.fontSize.lg,fontWeight:e.fontWeight.semibold,color:i.color},children:i.label})]}),t.filler_words&&s.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Fllwrter"}),s.jsxs("span",{style:{fontSize:e.fontSize.lg,fontWeight:600,color:r(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&s.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?e.success:e.warning,borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?e.success:e.warning,borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&s.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:e.primaryAccentLight,fontSize:"14px",color:e.textSecondary,lineHeight:1.5},children:[" ",t.notes]})]})},zP=({audioUrl:t,primaryAccent:e,branding:n})=>{const i=f.useRef(null),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(0),[u,p]=f.useState(!0),[h,m]=f.useState(null);f.useEffect(()=>{if(!t)return;p(!0),m(null);const w=new Audio;i.current=w;const k=()=>{const b=w.duration;b&&isFinite(b)&&b>0&&d(b),p(!1)},S=()=>{p(!1);const b=w.duration;b&&isFinite(b)&&b>0&&d(b)};return w.addEventListener("loadedmetadata",k),w.addEventListener("canplaythrough",S),w.addEventListener("timeupdate",()=>l(w.currentTime)),w.addEventListener("play",()=>o(!0)),w.addEventListener("pause",()=>o(!1)),w.addEventListener("ended",()=>o(!1)),w.addEventListener("error",()=>{m("Audio nicht verfgbar"),p(!1)}),w.src=t,w.load(),()=>{w.pause(),w.src=""}},[t]);const x=()=>{i.current&&(r?i.current.pause():i.current.play())},g=w=>{const k=w.currentTarget.getBoundingClientRect(),S=(w.clientX-k.left)/k.width;i.current&&c>0&&(i.current.currentTime=S*c)},y=w=>{i.current&&(i.current.currentTime=Math.max(0,Math.min(i.current.currentTime+w,c)))};if(!t)return null;if(h)return s.jsxs("div",{style:{padding:"12px 16px",background:n.cardBgHover,borderRadius:"10px",color:n.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Te,{size:16})," ",h]});const v=c>0?a/c*100:0;return s.jsxs("div",{style:{background:n.cardBg,borderRadius:"12px",padding:"16px",border:`1px solid ${n.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",fontSize:"13px",fontWeight:600,color:n.textSecondary},children:[s.jsx(Gn,{size:16,color:e}),"Deine Aufnahme"]}),s.jsx("div",{onClick:g,style:{height:"6px",background:n.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:s.jsx("div",{style:{width:`${v}%`,height:"100%",background:e,borderRadius:"3px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[s.jsx("button",{onClick:()=>y(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:s.jsx(Za,{size:18})}),s.jsx("button",{onClick:x,disabled:u,style:{width:"44px",height:"44px",borderRadius:"50%",background:e,border:"none",cursor:u?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:u?.7:1},children:u?s.jsx(ge,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):r?s.jsx(Xa,{size:20,color:"#ffffff",fill:"#ffffff"}):s.jsx(Ht,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>y(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:s.jsx(Qa,{size:18})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:n.textMuted},children:[lt(a)," / ",lt(c)]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},BP=({transcript:t,feedback:e,audioMetrics:n,audioUrl:i,onRetry:r,onNext:o,onComplete:a,isLastQuestion:l,hideButtons:c=!1})=>{const{branding:d}=Fe(),u=it(),p=d?.["--button-gradient"]||d?.["--header-gradient"]||ve["--header-gradient"],h=d?.["--primary-accent"]||ve["--primary-accent"],m=d?.["--primary-accent-light"]||ve["--primary-accent-light"],x=typeof e=="string"?JSON.parse(e):e;return s.jsxs("div",{style:{backgroundColor:u.cardBgHover,borderRadius:u.radius.xl,padding:u.space[6]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:u.space[5],backgroundColor:u.cardBg,borderRadius:u.radius.lg},children:[s.jsx($o,{score:x?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:h,branding:u}),s.jsxs("div",{style:{flex:1},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:u.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),s.jsx("p",{style:{fontSize:"14px",color:u.textSecondary,margin:0,lineHeight:1.5},children:x?.summary||"Deine Antwort wurde analysiert."})]})]}),x?.scores&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:u.cardBg,borderRadius:"12px"},children:[s.jsx($o,{score:x.scores.content,label:"Inhalt",primaryAccent:h,branding:u}),s.jsx($o,{score:x.scores.structure,label:"Struktur",primaryAccent:h,branding:u}),s.jsx($o,{score:x.scores.relevance,label:"Relevanz",primaryAccent:h,branding:u})]}),s.jsxs(Rr,{title:"Transkript",icon:Le,defaultOpen:!0,primaryAccent:h,branding:u,children:[s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:u.cardBgHover,fontStyle:"italic",color:u.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verfgbar.",'"']}),i&&s.jsx("div",{style:{marginTop:"16px"},children:s.jsx(zP,{audioUrl:i,primaryAccent:h,branding:u})})]}),x?.strengths?.length>0&&s.jsx(Rr,{title:"Strken",icon:eo,defaultOpen:!0,primaryAccent:h,branding:u,children:x.strengths.map((g,y)=>s.jsx(mc,{text:g,type:"strength",primaryAccent:h,primaryAccentLight:m,branding:u},y))}),x?.improvements?.length>0&&s.jsx(Rr,{title:"Verbesserungen",icon:yn,defaultOpen:!0,primaryAccent:h,branding:u,children:x.improvements.map((g,y)=>s.jsx(mc,{text:g,type:"improvement",primaryAccent:h,primaryAccentLight:m,branding:u},y))}),x?.tips?.length>0&&s.jsx(Rr,{title:"Tipps",icon:je,defaultOpen:!1,primaryAccent:h,branding:u,children:x.tips.map((g,y)=>s.jsx(mc,{text:g,type:"tip",primaryAccent:h,primaryAccentLight:m,branding:u},y))}),n&&s.jsx(Rr,{title:"Sprechanalyse",icon:We,defaultOpen:!1,primaryAccent:h,branding:u,children:s.jsx(LP,{metrics:n,branding:u})}),!c&&s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[r&&s.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${u.borderColor}`,backgroundColor:u.cardBg,color:u.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.borderColor=h,g.target.style.color=h},onMouseLeave:g=>{g.target.style.borderColor=u.borderColor,g.target.style.color=u.textSecondary},children:[s.jsx($i,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),s.jsx("button",{onClick:l?a:o,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:p,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${h}4d`,transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.transform="translateY(-2px)",g.target.style.boxShadow=`0 6px 16px ${h}66`},onMouseLeave:g=>{g.target.style.transform="none",g.target.style.boxShadow=`0 4px 12px ${h}4d`},children:l?s.jsxs(s.Fragment,{children:[s.jsx(dr,{style:{width:"18px",height:"18px"}}),"Training abschlieen"]}):s.jsxs(s.Fragment,{children:["Nchste Frage",s.jsx(Xt,{style:{width:"18px",height:"18px"}})]})})]})]})},kv=({current:t,total:e,answeredQuestions:n=[],primaryAccent:i,b:r,labels:o,showCompleted:a=!0})=>{const l=(t+1)/e*100,c=o?.questionFallback||"Frage",d=h=>{const m=h===t,x=n.length>0?n.includes(h):h<t;return m?i:x?R.green[500]:R.slate[300]},u=h=>{const m=n.length>0?n.includes(h):h<t;return`${c} ${h+1}${m?" (beantwortet)":""}`},p=()=>o?.questionCounter?o.questionCounter(t+1,e):`${c} ${t+1} von ${e}`;return s.jsxs("div",{style:{marginBottom:r.space[6]},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:r.space[2]},children:[s.jsx("span",{style:{fontSize:r.fontSize.sm,fontWeight:600,color:R.slate[700]},children:p()}),s.jsxs("span",{style:{fontSize:r.fontSize.sm,fontWeight:a?400:600,color:a?R.slate[500]:i},children:[Math.round(l),"%",a?" abgeschlossen":""]})]}),s.jsx("div",{style:{height:"8px",backgroundColor:R.slate[200],borderRadius:r.radius.sm,overflow:"hidden",marginBottom:r.space[3]},children:s.jsx(P.div,{initial:{width:0},animate:{width:`${l}%`},transition:{duration:parseFloat(r.transition.normal.replace("s",""))},style:{height:"100%",background:i,borderRadius:r.radius.sm}})}),s.jsx("div",{style:{display:"flex",gap:r.space[1.5],justifyContent:"center"},children:Array.from({length:e},(h,m)=>s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:d(m),transition:`all ${r.transition.normal}`},title:u(m)},m))})]})},eh=({isLoading:t,message:e="Wird geladen...",subMessage:n=null})=>{const{branding:i}=Fe(),r=i?.["--header-gradient"]||ve["--header-gradient"];return s.jsx(He,{children:t&&s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:s.jsxs(P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3,delay:.1},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"40px 60px",backgroundColor:"white",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.15)"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:r,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ge,{style:{width:"32px",height:"32px",color:"white",animation:"spin 1s linear infinite"}})}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("p",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:e}),n&&s.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginTop:"8px",margin:"8px 0 0 0"},children:n})]})]})})})},Dm={target:$e,clock:qe,mic:We,"message-square":Le,lightbulb:je,brain:jp,info:mn,settings:ii,check:Jt,Target:$e,Clock:qe,Mic:We,MessageSquare:Le,Lightbulb:je,Brain:jp},FP=({tips:t,primaryAccent:e,tipsLabel:n,branding:i})=>{const[r,o]=f.useState(!0);return!t||t.length===0?null:s.jsxs("div",{style:{background:i.cardBg,borderRadius:i.radius.xl,border:`1px solid ${i.borderColor}`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:`${i.space[4]} ${i.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:i.space[2],fontSize:i.fontSize.base,fontWeight:i.fontWeight.semibold,color:i.textMain},children:[s.jsx(je,{size:i.iconSize.md,color:e}),n||"Tipps fr diese Frage"]}),s.jsx(wt,{size:i.iconSize.md,color:i.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:i.transition.normal}})]}),s.jsx(He,{children:r&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:`0 ${i.space[6]} ${i.space[6]}`},children:t.map((a,l)=>s.jsxs("div",{style:{display:"flex",gap:i.space[3],padding:`${i.space[3]} ${i.space[4]}`,borderRadius:i.radius.md,backgroundColor:i.warningLight,marginBottom:l<t.length-1?i.space[2]:0},children:[s.jsx(je,{style:{width:i.iconSize.sm,height:i.iconSize.sm,color:i.warning,flexShrink:0,marginTop:"2px"}}),s.jsx("p",{style:{fontSize:i.fontSize.base,color:i.textSecondary,margin:0,lineHeight:1.5},children:a.replace(/^Tipp \d+:\s*/i,"")})]},l))})})})]})},UP=({seconds:t,maxSeconds:e,isRecording:n,branding:i})=>{const r=e>0?t/e*100:0,o=r>75,a=r>90;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[3],padding:`${i.space[3]} ${i.space[4]}`,borderRadius:i.radius.lg,backgroundColor:a?i.errorLight:o?i.warningLight:i.cardBgHover},children:[s.jsx(qe,{style:{width:i.iconSize.lg,height:i.iconSize.lg,color:a?i.error:o?i.warning:i.textSecondary}}),s.jsx("span",{style:{fontSize:i.fontSize.xl,fontWeight:i.fontWeight.semibold,fontFamily:"monospace",color:a?i.error:o?i.warning:i.textSecondary},children:lt(t)}),s.jsxs("span",{style:{fontSize:i.fontSize.base,color:i.textMuted},children:["/ ",lt(e)]})]})},Om=({onRecordingComplete:t,timeLimit:e,disabled:n,deviceId:i,themedGradient:r,primaryAccent:o,isSubmitting:a,labels:l,onOpenSettings:c,branding:d})=>{const[u,p]=f.useState("idle"),[h,m]=f.useState(0),[x,g]=f.useState(0),[y,v]=f.useState(!1),w=f.useRef(null),k=f.useRef([]),S=f.useRef(null),b=f.useRef(null),j=f.useRef(null),C=f.useRef(null),T=f.useRef(null),_=f.useRef(0),E=f.useRef(!1);f.useEffect(()=>()=>{N()},[]),f.useEffect(()=>{u==="recording"&&h>=e&&A()},[h,e,u]);const N=()=>{S.current&&clearInterval(S.current),C.current&&cancelAnimationFrame(C.current),b.current&&(b.current.close(),b.current=null),T.current&&(T.current.getTracks().forEach(B=>B.stop()),T.current=null)},L=async()=>{try{v(!1),k.current=[],m(0);let B;const M={audio:i?{deviceId:{exact:i}}:!0};try{B=await navigator.mediaDevices.getUserMedia(M)}catch(q){throw console.error("[SIMULATOR] Selected device unavailable:",q),q.name==="OverconstrainedError"||q.name==="NotFoundError"?(v(!1),new Error("Das ausgewhlte Mikrofon ist nicht verfgbar. Bitte whle ein anderes Mikrofon in den Einstellungen.")):q}T.current=B,b.current=new(window.AudioContext||window.webkitAudioContext),j.current=b.current.createAnalyser(),b.current.createMediaStreamSource(B).connect(j.current),j.current.fftSize=256;const U=()=>{if(j.current&&E.current){const q=new Uint8Array(j.current.frequencyBinCount);j.current.getByteFrequencyData(q);const le=q.reduce((de,ue)=>de+ue)/q.length;g(le/255)}C.current=requestAnimationFrame(U)};E.current=!0,U();const W=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";w.current=new MediaRecorder(B,{mimeType:W}),w.current.ondataavailable=q=>{q.data.size>0&&k.current.push(q.data)},w.current.onstop=()=>{const q=new Blob(k.current,{type:W});t(q,_.current)},w.current.start(1e3),p("recording"),S.current=setInterval(()=>{m(q=>q+1)},1e3)}catch(B){console.error("Error starting recording:",B),(B.name==="NotAllowedError"||B.name==="PermissionDeniedError")&&v(!0)}},V=()=>{w.current&&w.current.state==="recording"&&(w.current.pause(),p("paused"),E.current=!1,S.current&&(clearInterval(S.current),S.current=null),g(0))},D=()=>{w.current&&w.current.state==="paused"&&(w.current.resume(),p("recording"),E.current=!0,S.current=setInterval(()=>{m(B=>B+1)},1e3))},A=()=>{_.current=h,E.current=!1,S.current&&(clearInterval(S.current),S.current=null),C.current&&(cancelAnimationFrame(C.current),C.current=null),b.current&&(b.current.close(),b.current=null),w.current&&w.current.state!=="inactive"&&w.current.stop(),T.current&&(T.current.getTracks().forEach(B=>B.stop()),T.current=null),p("idle"),g(0),m(0)},F=()=>{u==="idle"?L():u==="recording"?V():u==="paused"&&D()};return y?s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.errorLight,textAlign:"center"},children:[s.jsx(Fx,{style:{width:"48px",height:"48px",color:d.error,marginBottom:"12px"}}),s.jsx("p",{style:{color:d.error,fontWeight:600,margin:0},children:"Mikrofonzugriff verweigert"}),s.jsx("p",{style:{color:d.textSecondary,fontSize:"14px",marginTop:"8px"},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]}):s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.cardBg,border:`1px solid ${d.borderColor}`},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:s.jsx(UP,{seconds:h,maxSeconds:e,isRecording:u==="recording",branding:d})}),u==="recording"&&s.jsx("div",{style:{marginBottom:"24px"},children:s.jsx(or,{audioLevel:x,isActive:!0,variant:"bars",size:"sm",accentColor:o})}),u==="paused"&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"60px",marginBottom:"24px",color:d.warning},children:[s.jsx(We,{size:24}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600},children:"Aufnahme pausiert"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[s.jsx("button",{onClick:c,style:{padding:"14px",borderRadius:"12px",background:d.cardBgHover,border:`1px solid ${d.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:d.textMuted})}),s.jsxs("button",{onClick:F,disabled:n||a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:"14px 28px",borderRadius:"12px",border:"none",background:u==="idle"?n||a?d.borderColor:d.error:u==="recording"?d.warning:d.success,color:"white",fontSize:"16px",fontWeight:600,cursor:n||a?"not-allowed":"pointer",boxShadow:n||a?"none":"0 4px 14px rgba(0, 0, 0, 0.2)"},children:[u==="idle"&&s.jsxs(s.Fragment,{children:[s.jsx(We,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]}),u==="recording"&&s.jsxs(s.Fragment,{children:[s.jsx(fs,{style:{width:"18px",height:"18px"}}),"Pausieren"]}),u==="paused"&&s.jsxs(s.Fragment,{children:[s.jsx(Ht,{style:{width:"18px",height:"18px"}}),"Fortsetzen"]})]}),(u==="recording"||u==="paused")&&s.jsxs("button",{onClick:A,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",backgroundColor:d.cardBgHover,color:d.textMain,fontSize:"16px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Jt,{style:{width:"18px",height:"18px",color:d.success}}),l?.submitButton||"Antwort abgeben"]})]}),u==="idle"&&!a&&s.jsx("p",{style:{textAlign:"center",marginTop:"16px",color:d.textMuted,fontSize:"14px"},children:l?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"24px"},children:[s.jsx(ge,{style:{width:"32px",height:"32px",color:o,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"12px",color:d.textSecondary,fontSize:"14px"},children:l?.analyzing||"Antwort wird analysiert..."})]}),s.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      `})]})},WP=({scenario:t,variables:e,questions:n,onStart:i,onBack:r,selectedMicrophoneId:o,onMicrophoneChange:a,onMicrophoneTest:l,themedGradient:c,primaryAccent:d,primaryAccentLight:u,isLoading:p,branding:h})=>{const m=t?.mode==="SIMULATION",x=m?"Situationen":"Fragen",g=m?"Zeit pro Situation":"Zeit pro Frage",y=[{icon:$e,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fr Beispiele aus deiner Erfahrung."},{icon:qe,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${m?"Situation":"Frage"}. ${m?"Reagiere":"Antworte"} przise, aber ausfhrlich genug.`},{icon:We,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vllig in Ordnung."},{icon:Le,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mglich."}],v=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((S,b)=>typeof S=="string"?{icon:je,title:`Tipp ${b+1}`,description:S}:{icon:Dm[S.icon]||Dm[S.icon?.toLowerCase()]||je,title:S.title||`Tipp ${b+1}`,description:S.text||S.description||""}):y,w=ur.useMemo(()=>{if(!t?.input_configuration)return{};try{const S=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(S)?S.reduce((b,j)=>(j.key&&j.label&&(b[j.key]=j.label),b),{}):{}}catch{return{}}},[t?.input_configuration]),k=e?Object.entries(e).filter(([S,b])=>b&&b.trim&&b.trim()!=="").map(([S,b])=>({label:w[S]||S.replace(/_/g," ").replace(/\b\w/g,j=>j.toUpperCase()),value:b})):[];return s.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:r,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:h.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px"},children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(je,{style:{width:"32px",height:"32px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:h.textMain,margin:0},children:"Vorbereitung"}),s.jsxs("p",{style:{fontSize:"16px",color:h.textSecondary,margin:"4px 0 0 0"},children:[t.title,n.length>0?`  ${n.length} ${x}`:""]})]})]})]}),t.long_description&&s.jsx("div",{style:{padding:"20px 24px",borderRadius:"16px",backgroundColor:h.cardBg,border:`1px solid ${h.borderColor}`,marginBottom:"24px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:c,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(mn,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:h.textMain,margin:"0 0 8px 0"},children:"Deine Aufgabe"}),s.jsx("p",{style:{fontSize:"15px",lineHeight:"1.6",color:h.textSecondary,margin:0,whiteSpace:"pre-wrap"},children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),k.length>0&&s.jsxs("div",{style:{padding:"20px",borderRadius:"16px",backgroundColor:u,marginBottom:"24px"},children:[s.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:d,margin:"0 0 12px 0",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dein Profil"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:k.map((S,b)=>s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:h.textMuted,display:"block"},children:S.label}),s.jsx("span",{style:{fontSize:"15px",fontWeight:500,color:h.textMain},children:S.value})]},b))})]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:h.cardBg,border:`1px solid ${h.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(We,{style:{width:"22px",height:"22px",color:d}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:h.textMain,margin:0},children:"Mikrofon testen"})]}),s.jsx(Cu,{selectedDeviceId:o,onDeviceChange:a,onTestClick:l})]}),s.jsxs("button",{onClick:i,disabled:p,style:{width:"100%",padding:"18px 28px",borderRadius:"14px",border:"none",background:p?h.borderColor:c,color:"white",fontSize:"18px",fontWeight:600,cursor:p?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:p?"none":`0 4px 12px ${d}4d`,marginBottom:"24px",opacity:p?.7:1},children:[s.jsx(Ht,{style:{width:"24px",height:"24px"}}),"Gesprch starten"]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:h.cardBg,border:`1px solid ${h.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[s.jsx(je,{style:{width:"22px",height:"22px",color:h.warning}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:h.textMain,margin:0},children:"Tipps fr dein Gesprch"})]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:v.map((S,b)=>s.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"12px",backgroundColor:h.cardBgHover},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:u,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(S.icon,{style:{width:"22px",height:"22px",color:d}})}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:h.textMain,margin:"0 0 4px 0"},children:S.title}),s.jsx("p",{style:{fontSize:"14px",color:h.textSecondary,margin:0,lineHeight:1.5},children:S.description})]})]},b))})]}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:h.cardBgHover,display:"flex",gap:"24px",flexWrap:"wrap"},children:[n.length>0&&s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:h.textMuted,display:"block"},children:x}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:h.textMain},children:n.length})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:h.textMuted,display:"block"},children:g}),s.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:h.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:h.textMuted,display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:h.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},VP=({session:t,questions:e,scenario:n,variables:i,preloadedQuestions:r,onSessionCreated:o,onComplete:a,onExit:l,startFromQuestion:c=0,initialMicrophoneId:d})=>{const u=ks(),[p,h]=f.useState(t),[m,x]=f.useState(e||[]),[g,y]=f.useState(!1),[v,w]=f.useState(null),{demoCode:k}=Fe(),S=n?.mode==="SIMULATION",b={questionLabel:S?"Situation / Aussage des Gegenbers:":"Interviewfrage:",questionFallback:S?"Situation":"Frage",questionLoading:S?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:S?"Deine Reaktion...":"Deine Antwort...",submitButton:S?"Reaktion abgeben":"Antwort abgeben",submitHint:S?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:S?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(ee,De)=>S?`Situation ${ee} von ${De}`:`Frage ${ee} von ${De}`,questionsCount:ee=>S?`${ee} Situationen`:`${ee} Fragen`,answeredCount:(ee,De)=>S?`${ee} von ${De} Situationen`:`${ee} von ${De} Fragen`,tipsLabel:S?"Tipps fr diese Situation":"Tipps fr diese Frage",nextButton:S?"Nchste Situation":"Nchste Frage",timePerQuestion:S?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:S?"Situationen":"Fragen",recommendedTime:S?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},j=c>0;r&&r.length>0;const C=j?Array.from({length:c},(ee,De)=>De):[],[T,_]=f.useState(j?"interview":"preparation"),[E,N]=f.useState(c||p?.current_question_index||0),[L,V]=f.useState(null),[D,A]=f.useState(!1),[F,B]=f.useState(!1),[M,z]=f.useState(null),[U,W]=f.useState([]),[q,le]=f.useState(C),de="karriereheld_selected_microphone",[ue,$]=f.useState(()=>{if(d)return d;try{return localStorage.getItem(de)||null}catch{return null}}),[Se,xe]=f.useState(!1),[Ke,st]=f.useState(!1);f.useEffect(()=>{if(ue)try{localStorage.setItem(de,ue)}catch{}},[ue]);const[Ve,ft]=f.useState(!1),[St,Ze]=f.useState(!1),[Ct,qt]=f.useState(!1),[Ge,Qe]=f.useState(null),[ze,et]=f.useState(!1),{branding:se}=Fe(),Z=it(),re=se?.["--header-gradient"]||ve["--header-gradient"],te=se?.["--button-gradient"]||re,fe=se?.["--primary-accent"]||ve["--primary-accent"],K=se?.["--primary-accent-light"]||ve["--primary-accent-light"],Q=m[E],ce=E===m.length-1,Ee=E===0,dt=async(ee,De)=>{if(De<2){z("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(ee.size<1024){z("Die Aufnahme enthlt keine verwertbaren Audiodaten. Bitte versuchen Sie es erneut.");return}B(!0),z(null);try{const Ye=await me.submitSimulatorAnswer(p.id,ee,E,Q.question,Q.category,De);if(!Ye.success)throw new Error(Ye.message||"Fehler beim Analysieren der Antwort");if(V(Ye.data),A(!0),W(J=>[...J.filter(ke=>ke.questionIndex!==E),{questionIndex:E,feedback:Ye.data}]),le(J=>J.includes(E)?J:[...J,E]),S&&!ze){qt(!0),Qe(null);const J=q.includes(E);try{const ke=await me.generateNextTurn(p.id);if(ke.success){const Pe=ke.data.next_question;ke.data.is_finished?(Qe(Pe),x(J?Me=>{const ln=[...Me];return ln[E+1]=Pe,ln.slice(0,E+2)}:Me=>[...Me,Pe]),et(!0)):(Qe(Pe),J?(x(Me=>{const ln=[...Me];return ln[E+1]=Pe,ln.slice(0,E+2)}),et(!1)):x(Me=>[...Me,Pe]))}}catch(ke){console.error("Error generating next turn:",ke)}finally{qt(!1)}}}catch(Ye){console.error("Error submitting answer:",Ye),z(Ye.message||"Ein Fehler ist aufgetreten")}finally{B(!1)}},tt=()=>{V(null),A(!1),z(null)},Re=()=>{if(V(null),A(!1),z(null),S){if(Ge){N(ee=>ee+1),Qe(null);return}if(ze){ji();return}}else ce||N(ee=>ee+1)},mt=()=>{V(null),A(!1),z(null),Ee||N(ee=>ee-1)},Je=()=>{ft(!0)},ji=async()=>{ft(!1);try{const ee=await me.completeSimulatorSession(p.id);ee.success?a(ee.data):a({session:{...p,status:"completed"}})}catch(ee){console.error("Error completing session:",ee),a({session:{...p,status:"completed"}})}},xr=()=>{Ze(!0)},Ts=()=>{Ze(!1),l()},yr=async()=>{if(p&&m.length>0){_("interview");return}y(!0),w(null);try{const ee=await me.createSimulatorSession({scenario_id:n.id,variables:i,demo_code:k||null,questions:r||null});if(!ee.success)throw new Error(ee.message||"Fehler beim Erstellen der Session");const De=ee.data.session;let Ye;if(r&&r.length>0)Ye=r,await me.updateSimulatorSessionQuestions(De.id,Ye);else{const J=await me.generateSimulatorQuestions(De.id);if(!J.success)throw new Error(J.message||"Fehler beim Generieren der Fragen");Ye=J.data.questions}h({...De,questions_json:Ye}),x(Ye),o&&o({session:{...De,questions_json:Ye},questions:Ye,selectedMicrophoneId:ue}),_("interview")}catch(ee){console.error("Error creating session:",ee),w(ee.message||"Ein Fehler ist aufgetreten")}finally{y(!1)}};return T==="preparation"?s.jsxs(s.Fragment,{children:[s.jsx(WP,{scenario:n,variables:i,questions:m,onStart:yr,onBack:l,selectedMicrophoneId:ue,onMicrophoneChange:$,onMicrophoneTest:()=>xe(!0),themedGradient:te,primaryAccent:fe,primaryAccentLight:K,isLoading:g,branding:Z}),s.jsx(ju,{isOpen:Se,onClose:()=>xe(!1),deviceId:ue}),v&&s.jsx("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",fontSize:"14px",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100},children:v}),s.jsx(eh,{isLoading:g,message:S?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]}):s.jsxs("div",{style:{padding:u?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:u?"column":"row",justifyContent:"space-between",alignItems:u?"stretch":"center",gap:u?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:u?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:u?"space-between":"flex-end"},children:[!(D&&(S&&ze&&!Ge||!S&&ce))&&s.jsxs("button",{onClick:Je,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#22c55e",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"white",fontSize:"14px",fontWeight:600,boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)",flex:u?1:"none",justifyContent:"center"},children:[s.jsx(ti,{size:16}),u?"Beenden":"Training beenden"]}),s.jsxs("button",{onClick:xr,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",flex:u?1:"none",justifyContent:"center"},children:[s.jsx(rn,{size:16}),"Abbrechen"]})]})]}),Ve&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>ft(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:ee=>ee.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ti,{size:24,color:"#22c55e"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training beenden?"})]}),q.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"8px"},children:["Du hast ",s.jsx("strong",{children:b.answeredCount(q.length,m.length)})," beantwortet."]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Mchtest du das Training jetzt mit den bisherigen Antworten abschlieen oder weitere ",b.questionsLabel," beantworten?"]})]}):s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Du hast noch keine ",b.questionsLabel," beantwortet. Mchtest du das Training wirklich beenden?"]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>ft(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Weiter trainieren"}),s.jsx("button",{onClick:ji,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#22c55e",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)"},children:"Training beenden"})]})]})}),St&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>Ze(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:ee=>ee.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Te,{size:24,color:"#ef4444"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training abbrechen?"})]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:[s.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",q.length>0?` (${q.length} ${b.questionsLabel})`:""," ",s.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>Ze(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Zurck zum Training"}),s.jsx("button",{onClick:Ts,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:"Training abbrechen"})]})]})}),!D&&!S&&s.jsxs("div",{style:{display:"flex",gap:u?"8px":"12px",justifyContent:"center",marginBottom:"16px"},children:[s.jsxs("button",{onClick:mt,disabled:Ee,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${Z.borderColor}`,backgroundColor:Z.cardBg,color:Ee?Z.textMuted:Z.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:Ee?"not-allowed":"pointer",opacity:Ee?.5:1,flex:u?1:"none",justifyContent:"center"},children:[s.jsx(ma,{size:16}),"Zurck"]}),s.jsxs("button",{onClick:Re,disabled:ce,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${Z.borderColor}`,backgroundColor:Z.cardBg,color:ce?Z.textMuted:Z.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:ce?"not-allowed":"pointer",opacity:ce?.5:1,flex:u?1:"none",justifyContent:"center"},children:[u?"berspringen":"Frage berspringen",s.jsx(Xt,{size:16})]})]}),s.jsx(kv,{current:E,total:m.length,answeredQuestions:q,primaryAccent:fe,labels:b}),D?s.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px",justifyContent:"flex-end"},children:[n.allow_retry&&s.jsxs("button",{onClick:tt,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:`2px solid ${Z.borderColor}`,backgroundColor:Z.cardBg,color:Z.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx($i,{size:16}),"Nochmal versuchen"]}),s.jsxs("button",{onClick:S?ze&&!Ge?ji:Re:ce?ji:Re,disabled:S&&Ct&&!ze,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:"none",background:S&&Ct&&!ze?Z.textMuted:te,color:"white",fontSize:"14px",fontWeight:600,cursor:S&&Ct&&!ze?"wait":"pointer",boxShadow:S&&Ct&&!ze?"none":`0 4px 12px ${fe}4d`,opacity:S&&Ct&&!ze?.7:1},children:[S&&Ct&&!ze?s.jsxs(s.Fragment,{children:[s.jsx(ge,{size:16,className:"animate-spin",style:{animation:"spin 1s linear infinite"}}),"Gesprchspartner tippt..."]}):S?ze&&!Ge?"Training abschlieen":b.nextButton:ce?"Training abschlieen":b.nextButton,!Ct&&!(S?ze&&!Ge:ce)&&s.jsx(Xt,{size:16})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:"1px solid #e2e8f0",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:te,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:E+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:Q?.category||b.questionFallback})]}),s.jsx("p",{style:{fontSize:"16px",fontWeight:500,color:"#0f172a",margin:0,lineHeight:1.5},children:Q?.question||b.questionLoading})]}),s.jsx(BP,{transcript:L.transcript,feedback:L.feedback,audioMetrics:L.audio_analysis,audioUrl:L.audio_url,hideButtons:!0})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:u?"16px":"24px"},children:[u?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:te,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:E+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:Q?.category||b.questionFallback})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:Q?.question||b.questionLoading}),Q?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(qe,{size:14}),b.recommendedTime,": ca. ",Math.round(Q.estimated_answer_time/60)," Min"]})]}),s.jsx(Om,{onRecordingComplete:dt,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:ue,themedGradient:te,primaryAccent:fe,isSubmitting:F,labels:b,onOpenSettings:()=>st(!0),branding:Z}),M&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"16px",borderRadius:"12px",backgroundColor:Z.errorLight},children:[s.jsx(Te,{style:{width:"24px",height:"24px",color:Z.error}}),s.jsx("p",{style:{marginTop:"8px",color:Z.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:M}),s.jsx("button",{onClick:tt,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:Z.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsx(Om,{onRecordingComplete:dt,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:ue,themedGradient:te,primaryAccent:fe,isSubmitting:F,labels:b,onOpenSettings:()=>st(!0),branding:Z}),M&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",marginTop:"16px",borderRadius:"12px",backgroundColor:Z.errorLight},children:[s.jsx(Te,{style:{width:"24px",height:"24px",color:Z.error}}),s.jsx("p",{style:{marginTop:"8px",color:Z.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:M}),s.jsx("button",{onClick:tt,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:Z.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:te,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:E+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:Q?.category||b.questionFallback})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:Q?.question||b.questionLoading}),Q?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(qe,{size:16}),b.recommendedTime,": ca. ",Math.round(Q.estimated_answer_time/60)," Min"]})]})]}),Q?.tips&&Q.tips.length>0&&s.jsx(FP,{tips:Q.tips,primaryAccent:fe,tipsLabel:b.tipsLabel,branding:Z})]}),s.jsx(fl,{isOpen:Ke,onClose:()=>st(!1),mode:"audio",selectedMicrophoneId:ue,onMicrophoneChange:$})]})},Go=({score:t,label:e,primaryAccent:n,b:i})=>{const r=t!=null?t*10:null,o=Xn(r,n);return s.jsxs("div",{style:{textAlign:"center",padding:i.space[4],backgroundColor:R.slate[100],borderRadius:i.radius.lg},children:[s.jsx("div",{style:{fontSize:i.fontSize["4xl"],fontWeight:700,color:o,marginBottom:"4px"},children:r!=null?Math.round(r):"-"}),s.jsx("div",{style:{fontSize:i.fontSize.sm,color:R.slate[600]},children:e})]})},gc=({icon:t,value:e,label:n,primaryAccent:i,b:r})=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[3],padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:R.slate[100],borderRadius:r.radius.md},children:[s.jsx(t,{style:{width:"20px",height:"20px",color:i}}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:r.fontSize.xl,fontWeight:600,color:R.slate[900]},children:e}),s.jsx("div",{style:{fontSize:r.fontSize.xs,color:R.slate[500]},children:n})]})]}),$P=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const r=it(),o=t.summary_feedback||t.summary_feedback_json,a=o?typeof o=="string"?JSON.parse(o):o:null,l=t.overall_score||a?.overall_score||0,c=l<=10?l*10:l,u=(p=>p>=90?{text:"Ausgezeichnet!",emoji:""}:p>=80?{text:"Sehr gut!",emoji:""}:p>=70?{text:"Gut!",emoji:""}:p>=60?{text:"Solide Leistung",emoji:""}:p>=50?{text:"Ausbaufhig",emoji:""}:{text:"Weiter ben!",emoji:""})(c);return s.jsxs("div",{style:{padding:r.space[6],maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:r.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:s.jsx(dr,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsxs("h1",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:R.slate[900],margin:"0 0 8px 0"},children:["Training abgeschlossen! ",u.emoji]}),s.jsxs("p",{style:{fontSize:r.fontSize.lg,color:R.slate[600],margin:0},children:[e?.title||"Skill Training"," - ",u.text]})]}),s.jsxs("div",{style:{padding:r.space[6],borderRadius:r.radius.xl,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,textAlign:"center",marginBottom:r.space[6]},children:[s.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",border:`6px solid ${r.primaryAccent}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",backgroundColor:r.primaryAccentLight},children:s.jsx("span",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:r.primaryAccent},children:c?Math.round(c):"-"})}),s.jsx("p",{style:{fontSize:r.fontSize.base,color:R.slate[500],margin:0},children:c?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[s.jsx(gc,{icon:Jt,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),s.jsx(gc,{icon:$e,value:a?.average_content_score?Math.round(a.average_content_score*10):"-",label:" Inhalt",primaryAccent:r.primaryAccent,b:r}),s.jsx(gc,{icon:Yt,value:a?.average_delivery_score?Math.round(a.average_delivery_score*10):"-",label:" Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.scores&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[s.jsx(Go,{score:a.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),s.jsx(Go,{score:a.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),s.jsx(Go,{score:a.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),s.jsx(Go,{score:a.scores.delivery,label:"Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.summary&&s.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:R.slate[100],marginBottom:r.space[6]},children:[s.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:R.slate[700],margin:"0 0 8px 0"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:r.fontSize.base,color:R.slate[600],margin:0,lineHeight:1.6},children:a.summary})]}),a?.key_takeaways?.length>0&&s.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:R.green[100],marginBottom:r.space[6]},children:[s.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:R.green[500],margin:"0 0 12px 0"},children:" Die wichtigsten Erkenntnisse"}),s.jsx("ul",{style:{margin:0,paddingLeft:r.space[5],color:R.slate[700],fontSize:r.fontSize.base,lineHeight:1.6},children:a.key_takeaways.map((p,h)=>s.jsx("li",{style:{marginBottom:"8px"},children:p},h))})]}),s.jsxs("div",{style:{display:"flex",gap:r.space[3],marginTop:"32px"},children:[s.jsxs("button",{onClick:n,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:`2px solid ${R.slate[300]}`,backgroundColor:"white",color:R.slate[700],fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:p=>{p.target.style.borderColor=r.primaryAccent,p.target.style.color=r.primaryAccent},onMouseLeave:p=>{p.target.style.borderColor=R.slate[300],p.target.style.color=R.slate[700]},children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:"none",background:r.buttonGradient,color:"white",fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${r.primaryAccent}4d`,transition:"all 0.2s"},onMouseEnter:p=>{p.target.style.transform="translateY(-2px)",p.target.style.boxShadow=`0 6px 16px ${r.primaryAccent}66`},onMouseLeave:p=>{p.target.style.transform="none",p.target.style.boxShadow=`0 4px 12px ${r.primaryAccent}4d`},children:[s.jsx($i,{style:{width:"18px",height:"18px"}}),"Nochmal ben"]})]})]})},gn={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},GP=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingContinueSession:i,clearPendingContinueSession:r,pendingRepeatSession:o,clearPendingRepeatSession:a,onNavigateToHistory:l})=>{const[c,d]=f.useState(gn.DASHBOARD),[u,p]=f.useState(null),[h,m]=f.useState(null),[x,g]=f.useState([]),[y,v]=f.useState({}),[w,k]=f.useState(null),[S,b]=f.useState(null),[j,C]=f.useState(null),[T,_]=f.useState(0);f.useEffect(()=>{j&&t&&(p(j),d(gn.VARIABLES),C(null))},[j,t]),f.useEffect(()=>{if(i&&t){const{session:M,scenario:z}=i,U=M.questions||M.questions_json,W=typeof U=="string"?JSON.parse(U):U||[],q=M.completed_questions||M.answered_count||0;p(z||{id:M.scenario_id,title:M.scenario_title}),m(M),g(W),v({}),_(q),d(gn.SESSION),r&&r()}},[i,t,r]),f.useEffect(()=>{if(o&&t){const{session:M,scenario:z}=o,U=M.questions||M.questions_json,W=typeof U=="string"?JSON.parse(U):U||[];p(z||{id:M.scenario_id,title:M.scenario_title}),g(W),v({}),_(0),d(gn.SESSION),a&&a()}},[o,t,a]),f.useEffect(()=>{window.scrollTo(0,0)},[c]);const E=f.useCallback(M=>{p(M),d(gn.VARIABLES)},[]),N=f.useCallback(()=>{p(null),m(null),g([]),v({}),k(null),_(0),b(null),d(gn.DASHBOARD)},[]),L=f.useCallback(M=>{v(M),d(gn.SESSION)},[]),V=f.useCallback(M=>{m(M.session),g(M.questions),M.selectedMicrophoneId&&b(M.selectedMicrophoneId)},[]),D=f.useCallback(M=>{k(M.session),d(gn.COMPLETE)},[]),A=f.useCallback(()=>{N()},[N]),F=f.useCallback(()=>{m(null),g([]),k(null),_(0),b(null),d(gn.VARIABLES)},[]),B=()=>{switch(c){case gn.DASHBOARD:return s.jsx(Pm,{onSelectScenario:E,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:l});case gn.VARIABLES:return s.jsx(OP,{scenario:u,onBack:N,onNext:L});case gn.SESSION:return s.jsx(VP,{session:h,questions:x,scenario:u,variables:y,preloadedQuestions:x.length>0?x:null,onSessionCreated:V,onComplete:D,onExit:A,startFromQuestion:T,initialMicrophoneId:S});case gn.COMPLETE:return s.jsx($P,{session:w,scenario:u,onBackToDashboard:N,onStartNew:F});default:return s.jsx(Pm,{onSelectScenario:E,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:l})}};return s.jsx("div",{style:{minHeight:"100%"},children:B()})},HP={video:pt,user:Et,briefcase:Mn,presentation:Wx,mic:We,target:$e,banknote:Xi},qP={self_presentation:{label:"Selbstprsentation",icon:Et,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgesprch",icon:Mn,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:oi,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:Oj,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:$e,color:"#64748b",bgColor:"#f1f5f9"}},KP=async()=>{const t=await fetch(`${ni()}/video-training/scenarios`,{headers:{"X-WP-Nonce":Lt()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Ungltige Antwort vom Server")},JP=t=>HP[t.icon]||pt,YP=t=>[{text:`${t.question_count} Fragen`},{icon:qe,text:`~${Math.round(t.total_time_limit/60)} Min.`}],XP=t=>s.jsx("div",{style:{marginTop:"40px",padding:"20px",background:`linear-gradient(135deg, ${t}10 0%, ${t}05 100%)`,borderRadius:"12px",border:`1px solid ${t}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(It,{size:20,color:t,style:{flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Wie funktioniert das Video Training?"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,margin:0},children:["1. Whle ein Szenario und konfiguriere dein Training",s.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",s.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Krpersprache und Kommunikation"]})]})]})}),Lm=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>{const{branding:o}=Fe(),a=o?.primaryAccent||o?.["--primary-accent"]||"#3A7FA7";return s.jsx(sl,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:pt,fetchScenarios:KP,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:YP,getIconForScenario:JP,cardActionLabel:"Starten",cardActionIcon:Bt,categoryField:"scenario_type",customCategoryConfig:qP,emptyStateIcon:pt,emptyStateTitle:"Keine Szenarien verfgbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:()=>XP(a),isAuthenticated:e,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."})},ZP=({field:t,value:e,onChange:n,error:i,focusColor:r})=>{const o=r||"#4a9ec9",a={width:"100%",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${i?R.red[500]:R.slate[200]}`,fontSize:"16px",color:R.slate[900],backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},l={borderColor:o,boxShadow:`0 0 0 3px ${o}1a`},c=p=>{Object.assign(p.target.style,l),setTimeout(()=>{const h=p.target;if(h){const m=h.closest("div");m&&m.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=p=>{p.target.style.borderColor=i?R.red[500]:R.slate[200],p.target.style.boxShadow="none"},u=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d});case"textarea":return s.jsx("textarea",{value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",rows:4,style:{...a,resize:"vertical",minHeight:"100px"},onFocus:c,onBlur:d});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:p=>n(t.key,p.target.value),style:{...a,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:c,onBlur:d,children:[!t.default&&s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(p=>s.jsx("option",{value:p.value,children:p.label},p.value))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:a,onFocus:c,onBlur:d});default:return s.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:"4px"},children:"*"})]}),u(),i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:R.red[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Te,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:R.slate[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(mn,{style:{width:"14px",height:"14px"}}),t.hint]})]})},QP=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),{branding:l}=Fe(),c=l?.["--header-gradient"]||ve["--header-gradient"],d=l?.["--button-gradient"]||c,u=l?.["--primary-accent"]||ve["--primary-accent"],p=l?.["--primary-accent-light"]||ve["--primary-accent-light"],h=f.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(v=>v.user_input!==!1)}catch(y){return console.error("Error parsing input_configuration:",y),[]}},[t?.input_configuration]);f.useEffect(()=>{const y={};h.forEach(v=>{v.default&&(y[v.key]=v.default)}),r(y)},[h]);const m=(y,v)=>{r(w=>({...w,[y]:v})),o[y]&&a(w=>{const k={...w};return delete k[y],k})},x=()=>{const y={};return h.forEach(v=>{const w=i[v.key];if(v.required&&(!w||typeof w=="string"&&w.trim()==="")){y[v.key]="Dieses Feld ist erforderlich";return}if(!(!w||typeof w=="string"&&w.trim()==="")&&v.validation){const{minLength:k,maxLength:S,min:b,max:j,pattern:C}=v.validation;k&&w.length<k&&(y[v.key]=`Mindestens ${k} Zeichen erforderlich`),S&&w.length>S&&(y[v.key]=`Maximal ${S} Zeichen erlaubt`),b!==void 0&&Number(w)<b&&(y[v.key]=`Mindestens ${b}`),j!==void 0&&Number(w)>j&&(y[v.key]=`Maximal ${j}`),C&&!new RegExp(C).test(w)&&(y[v.key]="Ungltiges Format")}}),a(y),Object.keys(y).length===0},g=y=>{y.preventDefault(),x()&&n(i)};return f.useEffect(()=>{h.length===0&&n({})},[h,n]),h.length===0?null:s.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:R.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:y=>y.target.style.background=R.slate[100],onMouseLeave:y=>y.target.style.background="transparent",children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(pt,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:R.slate[600],margin:"4px 0 0 0"},children:"Personalisiere dein Training"})]})]})]}),t.description&&s.jsx("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:R.slate[100],marginBottom:"24px"},children:s.jsx("p",{style:{fontSize:"14px",color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:p,marginBottom:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(mn,{style:{width:"20px",height:"20px",color:u,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("p",{style:{fontSize:"14px",fontWeight:600,color:R.slate[900],margin:"0 0 4px 0"},children:"So funktioniert es"}),s.jsxs("p",{style:{fontSize:"13px",color:R.slate[600],margin:0,lineHeight:1.5},children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschlieend detailliertes Feedback."]})]})]}),s.jsxs("form",{onSubmit:g,children:[h.map(y=>s.jsx(ZP,{field:y,value:i[y.key],onChange:m,error:o[y.key],focusColor:u},y.key)),s.jsxs("button",{type:"submit",style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:d,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:`0 4px 12px ${u}4d`,marginTop:"24px"},onMouseEnter:y=>{y.target.style.transform="translateY(-2px)",y.target.style.boxShadow=`0 6px 16px ${u}66`},onMouseLeave:y=>{y.target.style.transform="none",y.target.style.boxShadow=`0 4px 12px ${u}4d`},children:["Weiter",s.jsx(yo,{style:{width:"20px",height:"20px"}})]})]})]})},e4=({scenario:t,variables:e,onBack:n,onStart:i})=>{const[r,o]=f.useState(!1),[a,l]=f.useState(null),{demoCode:c}=Fe(),d=async({selectedMicrophoneId:u,selectedCameraId:p})=>{l(null),o(!0);try{const h=ni(),m=await fetch(`${h}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Lt()},body:JSON.stringify({scenario_id:t.id,variables:e,demo_code:c||null})});if(!m.ok){const k=await m.json().catch(()=>({}));throw new Error(k.message||"Fehler beim Erstellen der Session")}const x=await m.json(),g=x.data?.session||x.session;if(!g)throw new Error("Keine Session-ID erhalten");const y=await fetch(`${h}/video-training/sessions/${g.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Lt()},body:JSON.stringify({variables:e})});if(!y.ok){const k=await y.json().catch(()=>({}));throw new Error(k.message||"Fehler beim Generieren der Fragen")}const v=await y.json(),w=v.data?.questions||v.questions||[];i({session:{...g,questions:w},questions:w,scenario:t,variables:e,selectedMicrophoneId:u,selectedCameraId:p})}catch(h){console.error("[VIDEO TRAINING] Error starting session:",h),l(h.message||"Ein Fehler ist aufgetreten"),o(!1)}};return s.jsxs(s.Fragment,{children:[s.jsx(oy,{mode:"audio-video",scenario:t,onBack:n,onStart:d,title:t?.title,startButtonLabel:"Video-Training starten",icon:pt}),a&&s.jsx("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",fontSize:"14px",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100},children:a}),s.jsx(eh,{isLoading:r,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},zm=({tips:t,primaryAccent:e})=>{const[n,i]=f.useState(!1);return!t||t.length===0?null:s.jsxs("div",{style:{marginTop:"16px",background:`linear-gradient(135deg, ${e}08 0%, ${e}04 100%)`,borderRadius:"12px",border:`1px solid ${e}15`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:600,color:"#0f172a"},children:[s.jsx(je,{size:18,color:e}),"Tipps fr diese Frage"]}),s.jsx(Xt,{size:18,color:"#64748b",style:{transform:n?"rotate(90deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(He,{children:n&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.map((r,o)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:r},o))})})})})]})},t4=({session:t,questions:e,scenario:n,variables:i,onComplete:r,onExit:o,selectedMicrophoneId:a,selectedCameraId:l})=>{const[c,d]=f.useState(0),[u,p]=f.useState(!1),[h,m]=f.useState(!1),[x,g]=f.useState(0),[y,v]=f.useState([]),[w,k]=f.useState([]),[S,b]=f.useState(null),[j,C]=f.useState(null),[T,_]=f.useState(!1),[E,N]=f.useState(!1),[L,V]=f.useState(null),[D,A]=f.useState(a||null),[F,B]=f.useState(l||null),[M,z]=f.useState(!1),[U,W]=f.useState(0),q=ks(),le=f.useRef(null),de=f.useRef(null),ue=f.useRef(null),$=f.useRef(null),Se=f.useRef(null),xe=f.useRef(null),{primaryAccent:Ke,headerGradient:st}=it(),Ve=e[c];f.useEffect(()=>(Ze(),()=>{Ge(),ue.current&&clearInterval(ue.current),xe.current&&cancelAnimationFrame(xe.current),$.current&&$.current.close()}),[]);const ft=te=>{try{$.current&&$.current.close();const fe=new(window.AudioContext||window.webkitAudioContext);$.current=fe;const K=fe.createAnalyser();K.fftSize=256,K.smoothingTimeConstant=.8,Se.current=K,fe.createMediaStreamSource(te).connect(K);const ce=new Uint8Array(K.frequencyBinCount),Ee=()=>{if(!Se.current)return;Se.current.getByteFrequencyData(ce);const tt=ce.reduce((Re,mt)=>Re+mt,0)/ce.length;W(tt/255),xe.current=requestAnimationFrame(Ee)};Ee()}catch(fe){console.error("[VIDEO TRAINING] Audio analysis error:",fe)}},St=()=>{xe.current&&(cancelAnimationFrame(xe.current),xe.current=null),W(0)},Ze=async(te=D,fe=F)=>{try{C(null),S&&S.getTracks().forEach(Ee=>Ee.stop());const K=fe?{deviceId:{exact:fe},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},Q=te?{deviceId:{exact:te}}:!0,ce=await navigator.mediaDevices.getUserMedia({video:K,audio:Q});b(ce),le.current&&(le.current.srcObject=ce)}catch(K){console.error("[VIDEO TRAINING] Camera error:",K),C("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Ct=te=>{A(te),u||Ze(te,F)},qt=te=>{B(te),u||Ze(D,te)},Ge=()=>{S&&(S.getTracks().forEach(te=>te.stop()),b(null))},Qe=()=>{if(!S){Ze();return}try{const te=new MediaRecorder(S,{mimeType:"video/webm;codecs=vp9,opus"});de.current=te;const fe=[];te.ondataavailable=K=>{K.data.size>0&&(fe.push(K.data),v(Q=>[...Q,K.data]))},te.onstop=()=>{},te.start(1e3),p(!0),m(!1),ft(S),k(K=>[...K,{question_index:c,start_time:x}]),ue.current=setInterval(()=>{g(K=>K+1)},1e3)}catch(te){console.error("[VIDEO TRAINING] Recording error:",te),V("Fehler beim Starten der Aufnahme")}},ze=()=>{de.current&&u&&(de.current.stop(),p(!1),St(),ue.current&&(clearInterval(ue.current),ue.current=null))},et=()=>{c<e.length-1&&(u&&k(te=>[...te,{question_index:c+1,start_time:x}]),d(te=>te+1))},se=()=>{c>0&&d(te=>te-1)},Z=async()=>{ze(),_(!0),V(null);try{const te=new Blob(y,{type:"video/webm"}),fe=ni(),K=new FormData;K.append("video",te,`video_${t.id}.webm`),K.append("video_duration",x.toString()),K.append("timeline",JSON.stringify(w));const Q=await fetch(`${fe}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":Lt()},body:K});if(!Q.ok){const tt=await Q.text();throw console.error("[VIDEO TRAINING] Upload failed:",Q.status,tt),Q.status===413?new Error("Das Video ist zu gro zum Hochladen. Bitte versuche eine krzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+Q.status)}const ce=await Q.json();_(!1),N(!0);const Ee=await fetch(`${fe}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Lt()}});if(!Ee.ok)throw new Error("Fehler bei der Video-Analyse");const dt=await Ee.json();r({session:dt.data?.session||t,analysis:dt.data?.analysis,categoryScores:dt.data?.category_scores,overallScore:dt.data?.overall_score})}catch(te){console.error("[VIDEO TRAINING] Upload/Analysis error:",te),V(te.message),_(!1),N(!1)}},re=()=>{ze(),Ge(),o()};return T||E?s.jsxs("div",{style:{padding:"32px",textAlign:"center",maxWidth:"600px",margin:"0 auto"},children:[s.jsxs(P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{background:"#fff",borderRadius:"20px",padding:"48px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:`${Ke}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(ge,{size:40,color:Ke,style:{animation:"spin 1s linear infinite"}})}),s.jsx("h2",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"12px"},children:T?"Video wird hochgeladen...":"KI analysiert dein Video..."}),s.jsx("p",{style:{color:"#64748b",fontSize:"15px",lineHeight:1.6},children:T?"Dein Video wird sicher bertragen. Dies kann je nach Dateigre einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Krpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):s.jsxs("div",{style:{padding:q?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:q?"column":"row",justifyContent:"space-between",alignItems:q?"stretch":"center",gap:q?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:q?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:s.jsxs("button",{onClick:re,style:{padding:q?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(rn,{size:16}),"Abbrechen"]})})]}),s.jsx(kv,{current:c,total:e.length,primaryAccent:Ke,showCompleted:!1}),q?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:st,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:c+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:Ve?.category||"Frage"})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:Ve?.question||"Frage wird geladen..."}),Ve?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(qe,{size:14}),"Empfohlene Antwortzeit: ~",Math.round(Ve.estimated_time/60)," Min."]}),n?.enable_tips&&Ve?.tips&&s.jsx(zm,{tips:Ve.tips,primaryAccent:Ke})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[j?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"16px",textAlign:"center"},children:[s.jsx(Rp,{size:40,style:{marginBottom:"12px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"12px",fontSize:"14px"},children:j}),s.jsxs("button",{onClick:Ze,style:{padding:"10px 16px",borderRadius:"8px",background:Ke,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},children:[s.jsx(Zt,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:le,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"13px",fontWeight:500},children:lt(x)})]}),!u&&x>0&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx(qe,{size:14,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"13px"},children:lt(x)})]})]}),u&&s.jsx("div",{style:{marginTop:"16px"},children:s.jsx(or,{audioLevel:U,isActive:!0,variant:"bars",size:"sm",accentColor:Ke})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[s.jsx("button",{onClick:()=>z(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:"#64748b"})}),u?s.jsxs("button",{onClick:ze,style:{padding:"14px 24px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center"},children:[s.jsx(Ep,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:Qe,disabled:!S,style:{padding:"14px 24px",borderRadius:"12px",background:S?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:S?"pointer":"not-allowed",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center",boxShadow:S?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(pt,{size:20}),"Aufnahme starten"]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n?.enable_navigation&&c>0&&s.jsxs("button",{onClick:se,style:{padding:"10px 14px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",flex:1},children:[s.jsx(ma,{size:16}),"Zurck"]}),n?.enable_navigation&&c<e.length-1&&s.jsxs("button",{onClick:et,style:{padding:"10px 14px",borderRadius:"8px",background:Ke,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:500,flex:1},children:["Nchste",s.jsx(Xt,{size:16})]}),s.jsxs("button",{onClick:Z,disabled:y.length===0,style:{padding:"10px 14px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:600,flex:1,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(ti,{size:16}),"Abschlieen"]})]})]})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[j?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"20px",textAlign:"center"},children:[s.jsx(Rp,{size:48,style:{marginBottom:"16px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"16px"},children:j}),s.jsxs("button",{onClick:Ze,style:{padding:"10px 20px",borderRadius:"8px",background:Ke,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Zt,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:le,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"14px",fontWeight:500},children:lt(x)})]}),!u&&x>0&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx(qe,{size:16,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:lt(x)})]})]}),u&&s.jsx("div",{style:{marginTop:"20px"},children:s.jsx(or,{audioLevel:U,isActive:!0,variant:"bars",size:"sm",accentColor:Ke})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginTop:"20px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[s.jsx("button",{onClick:()=>z(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:"#64748b"})}),u?s.jsxs("button",{onClick:ze,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(Ep,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:Qe,disabled:!S,style:{padding:"14px 28px",borderRadius:"12px",background:S?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:S?"pointer":"not-allowed",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",boxShadow:S?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(pt,{size:20}),"Aufnahme starten"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",flexWrap:"wrap"},children:[n?.enable_navigation&&c>0&&s.jsxs("button",{onClick:se,style:{padding:"10px 16px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px"},children:[s.jsx(ma,{size:18}),"Vorherige"]}),n?.enable_navigation&&c<e.length-1&&s.jsxs("button",{onClick:et,style:{padding:"10px 16px",borderRadius:"8px",background:Ke,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:500},children:["Nchste",s.jsx(Xt,{size:18})]}),s.jsxs("button",{onClick:Z,disabled:y.length===0,style:{padding:"10px 20px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:600,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(ti,{size:18}),"Training abschlieen"]})]})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:st,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:c+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:Ve?.category||"Frage"})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:Ve?.question||"Frage wird geladen..."}),Ve?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",marginBottom:"16px"},children:[s.jsx(qe,{size:16}),"Empfohlene Antwortzeit: ~",Math.round(Ve.estimated_time/60)," Min."]}),n?.enable_tips&&Ve?.tips&&s.jsx(zm,{tips:Ve.tips,primaryAccent:Ke})]})]}),L&&s.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{marginTop:"24px",padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(Te,{size:20,color:"#ef4444"}),s.jsx("p",{style:{color:"#dc2626",fontSize:"14px",flex:1},children:L}),s.jsx("button",{onClick:()=>V(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:s.jsx(rn,{size:16,color:"#ef4444"})})]}),s.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          @keyframes spin { to { transform: rotate(360deg); } }
        `}),s.jsx(fl,{isOpen:M,onClose:()=>z(!1),mode:"audio-video",selectedMicrophoneId:D,onMicrophoneChange:Ct,selectedCameraId:F,onCameraChange:qt})]})},n4={auftreten:Lx,selbstbewusstsein:pn,koerpersprache:Et,kommunikation:Le,professionalitaet:pn,inhalt:je},i4=({score:t,size:e=120,strokeWidth:n=10,primaryAccent:i})=>{const r=(e-n)/2,o=r*2*Math.PI,a=o-t/100*o,l=()=>t>=80?"#22c55e":t>=60?i:t>=40?"#f59e0b":"#ef4444";return s.jsxs("div",{style:{position:"relative",width:e,height:e,margin:"0 auto"},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r,fill:"none",stroke:"#e2e8f0",strokeWidth:n}),s.jsx(P.circle,{cx:e/2,cy:e/2,r,fill:"none",stroke:l(),strokeWidth:n,strokeLinecap:"round",strokeDasharray:o,initial:{strokeDashoffset:o},animate:{strokeDashoffset:a},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3,fontWeight:700,color:l()},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:"#64748b"},children:"von 100"})]})]})},s4=({category:t,primaryAccent:e})=>{const[n,i]=f.useState(!1),r=n4[t.category]||Yt,o=a=>a>=80?"#22c55e":a>=60?e:a>=40?"#f59e0b":"#ef4444";return s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:"#fff",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden",marginBottom:"12px"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${o(t.score)}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(r,{size:20,color:o(t.score)})}),s.jsxs("div",{style:{flex:1,textAlign:"left"},children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"2px"},children:t.label}),s.jsxs("p",{style:{fontSize:"13px",color:"#64748b",margin:0},children:[t.feedback?.substring(0,60),"..."]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("span",{style:{fontSize:"20px",fontWeight:700,color:o(t.score)},children:Math.round(t.score)}),s.jsx(wt,{size:20,color:"#64748b",style:{transform:n?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),s.jsx(He,{children:n&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #e2e8f0",paddingTop:"16px"},children:[s.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"16px"},children:t.feedback}),t.strengths&&t.strengths.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#22c55e",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Jt,{size:14}),"Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.strengths.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]}),t.improvements&&t.improvements.length>0&&s.jsxs("div",{children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#f59e0b",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Te,{size:14}),"Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.improvements.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]})]})})})]})},r4=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const{branding:r}=Fe(),o=r?.primaryAccent||"#3A7FA7",a=r?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",l=t?.overall_score||0,c=t?.category_scores||[],d=t?.analysis||{},u=t?.summary_feedback||"",p=h=>h>=90?"Ausgezeichnet!":h>=80?"Sehr gut!":h>=70?"Gut!":h>=60?"Solide Leistung":h>=50?"Ausbaufhig":"Weiter ben!";return s.jsxs("div",{style:{padding:"32px",maxWidth:"900px",margin:"0 auto"},children:[s.jsxs(P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{textAlign:"center",marginBottom:"40px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:a,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.15)"},children:s.jsx(dr,{size:40,color:"#fff"})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Training abgeschlossen!"}),s.jsxs("p",{style:{fontSize:"16px",color:"#64748b"},children:[e?.title," - Deine Auswertung ist bereit"]})]}),s.jsxs(P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},style:{background:"#fff",borderRadius:"20px",padding:"32px",textAlign:"center",border:"1px solid #e2e8f0",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[s.jsx(i4,{score:l,size:160,primaryAccent:o}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginTop:"20px",marginBottom:"8px"},children:p(l)}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",maxWidth:"500px",margin:"0 auto",lineHeight:1.6},children:u||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),c.length>0&&s.jsxs(P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{marginBottom:"24px"},children:[s.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Yt,{size:20,color:o}),"Detaillierte Bewertung"]}),c.map((h,m)=>s.jsx(s4,{category:h,primaryAccent:o},h.category||m))]}),d&&(d.key_strengths?.length>0||d.actionable_tips?.length>0)&&s.jsxs(P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[d.key_strengths&&d.key_strengths.length>0&&s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#22c55e",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Jt,{size:18}),"Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.key_strengths.map((h,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:h},m))})]}),d.actionable_tips&&d.actionable_tips.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:o,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(je,{size:18}),"Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.actionable_tips.map((h,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:h},m))})]})]}),t?.video_url&&s.jsxs(P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(pt,{size:18,color:o}),"Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),s.jsxs(P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},style:{display:"flex",gap:"16px",justifyContent:"center"},children:[s.jsxs("button",{onClick:n,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Rt,{size:18}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{padding:"14px 28px",borderRadius:"12px",background:a,color:"#fff",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)"},children:[s.jsx(Zt,{size:18}),"Nochmal ben"]})]})]})},Qt={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},o4=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingScenario:i,clearPendingScenario:r,onNavigateToHistory:o})=>{const[a,l]=f.useState(Qt.DASHBOARD),[c,d]=f.useState(null),[u,p]=f.useState(null),[h,m]=f.useState([]),[x,g]=f.useState({}),[y,v]=f.useState(null),[w,k]=f.useState(null),[S,b]=f.useState(null),[j,C]=f.useState(null);f.useEffect(()=>{i&&t&&(d(i),l(Qt.VARIABLES),r&&r())},[i,t,r]),f.useEffect(()=>{j&&t&&(d(j),l(Qt.VARIABLES),C(null))},[j,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const T=f.useCallback(B=>{d(B),l(Qt.VARIABLES)},[]),_=f.useCallback(()=>{d(null),p(null),m([]),g({}),v(null),k(null),b(null),l(Qt.DASHBOARD)},[]),E=f.useCallback(B=>{g(B),l(Qt.DEVICE_SETUP)},[]),N=f.useCallback(()=>{l(Qt.VARIABLES)},[]),L=f.useCallback(B=>{p(B.session),m(B.questions),g(B.variables),k(B.selectedMicrophoneId),b(B.selectedCameraId),l(Qt.SESSION)},[]),V=f.useCallback(B=>{v(B.session),l(Qt.COMPLETE)},[]),D=f.useCallback(()=>{_()},[_]),A=f.useCallback(()=>{p(null),m([]),v(null),k(null),b(null),l(Qt.VARIABLES)},[]),F=()=>{switch(a){case Qt.DASHBOARD:return s.jsx(Lm,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:o});case Qt.VARIABLES:return s.jsx(QP,{scenario:c,onBack:_,onNext:E});case Qt.DEVICE_SETUP:return s.jsx(e4,{scenario:c,variables:x,onBack:N,onStart:L});case Qt.SESSION:return s.jsx(t4,{session:u,questions:h,scenario:c,variables:x,onComplete:V,onExit:D,selectedMicrophoneId:w,selectedCameraId:S});case Qt.COMPLETE:return s.jsx(r4,{session:y,scenario:c,onBackToDashboard:_,onStartNew:A});default:return s.jsx(Lm,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:o})}};return s.jsx("div",{style:{minHeight:"100%"},children:F()})},wv={rocket:oi,shuffle:Xj,zap:wo},Ho=({icon:t,label:e,value:n,primaryAccent:i,primaryAccentLight:r,isMobile:o,b:a})=>s.jsxs("div",{style:{backgroundColor:"white",borderRadius:o?a.radius.md:a.radius.lg,padding:o?a.space[3]:a.space[4],border:`1px solid ${R.slate[200]}`},children:[s.jsx("div",{style:{width:o?"32px":"40px",height:o?"32px":"40px",borderRadius:o?a.radius.sm:a.radius.md,backgroundColor:r,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:o?a.space[2]:a.space[3]},children:s.jsx(t,{style:{width:o?"16px":"20px",height:o?"16px":"20px",color:i}})}),s.jsx("div",{style:{fontSize:o?a.fontSize.xl:a.fontSize["2xl"],fontWeight:700,color:R.slate[900]},children:n}),s.jsx("div",{style:{fontSize:o?a.fontSize["2xs"]:a.fontSize.xs,color:R.slate[500]},children:e})]}),a4=({mode:t,onBack:e,onStart:n})=>{const[i,r]=f.useState(""),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),p=wv[t.icon]||oi;nh[t.id]||nh.klassiker;const h=it();f.useEffect(()=>{t.id==="klassiker"?r(t.topic):t.getTopic&&r(t.getTopic())},[t]);const m=()=>{if(!t.getTopic)return;a(!0);const g=1500,y=100;let v=0;const w=setInterval(()=>{r(t.getTopic()),v+=y,v>=g&&(clearInterval(w),a(!1))},y)},x=()=>{n({mode:t,topic:i,duration:t.duration,selectedMicrophoneId:l})};return s.jsxs("div",{style:{minHeight:"100%",display:"flex",flexDirection:"column",padding:h.space[6]},children:[s.jsxs(P.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:e,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2.5]} ${h.space[4]}`,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,borderRadius:h.radius.md,color:R.slate[600],fontSize:h.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:h.space[8],width:"fit-content"},children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck zur Auswahl"]}),s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"600px",margin:"0 auto",width:"100%"},children:[s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{textAlign:"center",marginBottom:h.space[8]},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:h.radius["2xl"],background:h.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${h.space[5]}`,boxShadow:h.coloredShadow(h.primaryAccent,"lg")},children:s.jsx(p,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsx("h1",{style:{fontSize:h.fontSize["3xl"],fontWeight:700,color:R.slate[900],margin:`0 0 ${h.space[2]} 0`},children:t.title}),s.jsxs("p",{style:{fontSize:h.fontSize.md,color:R.slate[500],margin:0},children:[t.duration," Sekunden  ",t.subtitle]})]}),s.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{width:"100%",background:h.headerGradient,borderRadius:h.radius["2xl"],padding:h.space[8],marginBottom:h.space[6],boxShadow:h.coloredShadow(h.primaryAccent,"xl")},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:h.space[5]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:h.space[2.5],color:"rgba(255,255,255,0.9)"},children:[s.jsx(Ji,{style:{width:"20px",height:"20px"}}),s.jsx("span",{style:{fontWeight:600,fontSize:h.fontSize.md},children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&s.jsxs(P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:m,disabled:o,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2.5]} ${h.space[4.5]}`,backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:h.radius.md,color:"white",fontSize:h.fontSize.sm,fontWeight:600,cursor:o?"not-allowed":"pointer"},children:[s.jsx(Zt,{style:{width:"16px",height:"16px",animation:o?"spin 0.5s linear infinite":"none"}}),o?"Dreht...":"Neu wrfeln"]})]}),s.jsx(He,{mode:"wait",children:s.jsxs(P.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{fontSize:h.fontSize["2xl"],fontWeight:600,color:"white",margin:0,lineHeight:1.5,minHeight:"66px"},children:['"',i,'"']},i)})]}),s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{width:"100%",backgroundColor:"white",borderRadius:h.radius.xl,padding:h.space[6],marginBottom:h.space[6],border:`1px solid ${R.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:h.space[2.5],marginBottom:h.space[4],color:R.slate[700]},children:[s.jsx(We,{style:{width:"20px",height:"20px",color:h.primaryAccent}}),s.jsx("span",{style:{fontWeight:600,fontSize:h.fontSize.md},children:"Mikrofon auswhlen"})]}),s.jsx(Cu,{selectedDeviceId:l,onDeviceChange:c,onTestClick:()=>u(!0)})]}),s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{width:"100%",backgroundColor:R.slate[50],borderRadius:h.radius.xl,padding:h.space[5],marginBottom:h.space[8]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:h.space[2],marginBottom:h.space[3],color:R.slate[700]},children:[s.jsx(It,{style:{width:"18px",height:"18px",color:R.amber[500]}}),s.jsx("span",{style:{fontWeight:600,fontSize:h.fontSize.sm},children:"Tipps fr deine Antwort"})]}),s.jsxs("ul",{style:{margin:0,paddingLeft:h.space[5],color:R.slate[600],fontSize:h.fontSize.sm,lineHeight:1.7},children:[s.jsx("li",{children:"Atme tief durch bevor du beginnst"}),s.jsx("li",{children:"Sprich in einem ruhigen, gleichmigen Tempo"}),s.jsx("li",{children:'Mache bewusst Pausen statt "hm" zu sagen'}),s.jsx("li",{children:"Strukturiere deine Antwort: Einleitung  Hauptteil  Schluss"})]})]}),s.jsxs(P.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,style:{width:"100%",maxWidth:"400px",padding:`${h.space[4.5]} ${h.space[8]}`,borderRadius:h.radius.xl,border:"none",background:h.buttonGradient,color:"white",fontSize:h.fontSize.lg,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:h.space[3],boxShadow:h.coloredShadow(h.primaryAccent,"md")},children:[s.jsx(Ht,{style:{width:"22px",height:"22px"}}),"Aufnahme starten"]})]}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),s.jsx(ju,{isOpen:d,onClose:()=>u(!1),deviceId:l})]})},Os={MODES:"modes",TOPIC:"topic"},l4=({onStartGame:t,isAuthenticated:e,requireAuth:n,setPendingAction:i})=>{const[r,o]=f.useState(Os.MODES),[a,l]=f.useState(null),[c,d]=f.useState("grid"),[u,p]=f.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),h=ks(),[m,x]=f.useState(null),g=it();f.useEffect(()=>{const S=async()=>{try{const b=await me.getGameStats();b.success&&b.data&&p({totalGames:b.data.total_games||0,bestScore:b.data.best_score||0,avgScore:b.data.avg_score||0,totalPracticeTime:b.data.total_practice_time||0})}catch(b){console.error("Failed to load stats:",b)}};r===Os.MODES&&S()},[r]),f.useEffect(()=>{m&&e&&(l(m),o(Os.TOPIC),x(null))},[m,e]),f.useEffect(()=>{window.scrollTo(0,0)},[r]);const y=S=>{if(!e){x(S),n&&n(()=>{},null);return}l(S),o(Os.TOPIC)},v=()=>{l(null),o(Os.MODES)},w=S=>{t(S)},k=Object.values(HT);return r===Os.TOPIC&&a?s.jsx(a4,{mode:a,onBack:v,onStart:w}):s.jsxs("div",{style:{padding:h?g.space[4]:g.space[6]},children:[s.jsxs("div",{style:{marginBottom:h?g.space[5]:g.space[8],textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:h?g.space[2.5]:g.space[3],marginBottom:h?g.space[2]:g.space[3]},children:[s.jsx("div",{style:{width:h?"40px":"48px",height:h?"40px":"48px",borderRadius:h?g.radius.lg:g.radius.xl,background:g.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(uu,{style:{width:h?"20px":"24px",height:h?"20px":"24px",color:g.headerText}})}),s.jsx("h1",{style:{fontSize:h?g.fontSize["2xl"]:g.fontSize["3xl"],fontWeight:700,color:R.slate[900],margin:0},children:"Der Fllwort-Killer"})]}),s.jsx("p",{style:{fontSize:h?g.fontSize.sm:g.fontSize.base,color:R.slate[600],maxWidth:"600px",margin:"0 auto"},children:"Trainiere deine Rhetorik - sprich flssig und berzeugend ohne hm und h!"})]}),s.jsxs("div",{style:{padding:h?`0 ${g.space[2]}`:`0 ${g.space[6]}`},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:h?"repeat(2, 1fr)":"repeat(auto-fit, minmax(150px, 1fr))",gap:h?g.space[2.5]:g.space[4],marginBottom:h?g.space[6]:g.space[8]},children:[s.jsx(Ho,{icon:dr,label:"Highscore",value:u.bestScore||"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:h,b:g}),s.jsx(Ho,{icon:$e,label:"Spiele",value:u.totalGames||0,primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:h,b:g}),s.jsx(Ho,{icon:Bt,label:"Durchschnitt",value:u.avgScore?Math.round(u.avgScore):"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:h,b:g}),s.jsx(Ho,{icon:qe,label:"Trainingszeit",value:u.totalPracticeTime?`${Math.round(u.totalPracticeTime/60)}m`:"0m",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:h,b:g})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:g.space[4]},children:[s.jsx("h2",{style:{fontSize:g.fontSize.lg,fontWeight:600,color:R.slate[800],margin:0},children:"Whle deinen Modus"}),s.jsx(u2,{viewMode:c,onViewChange:d})]}),s.jsx(m0,{minCardWidth:"280px",viewMode:c,children:k.map(S=>{const b=wv[S.icon]||oi;return s.jsx(f0,{title:S.title,subtitle:S.subtitle,description:S.description,icon:b,meta:[{icon:qe,text:`${S.duration} Sekunden`}],action:{label:"Starten",icon:Bt},onClick:()=>y(S),viewMode:c},S.id)})})]})]})},Ft={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},c4=({count:t,branding:e})=>s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:s.jsxs(P.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},style:{color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"120px",fontWeight:700,marginBottom:"16px"},children:t}),s.jsx("div",{style:{fontSize:"24px",color:e.textMuted},children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),d4=({seconds:t,total:e,isWarning:n,primaryAccent:i,branding:r})=>{const o=t/e*100,a=Math.floor(t/60),l=t%60;return s.jsxs("div",{children:[s.jsxs("div",{style:{fontSize:"64px",fontWeight:700,fontFamily:"monospace",textAlign:"center",color:n?r.error:r.textMain},children:[a,":",l.toString().padStart(2,"0")]}),s.jsx("div",{style:{marginTop:"16px",height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx(P.div,{style:{height:"100%",backgroundColor:n?r.error:i,borderRadius:"4px"},initial:{width:"100%"},animate:{width:`${o}%`},transition:{duration:.5}})})]})},u4=({word:t,count:e,branding:n})=>s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:n.space[1],padding:`${n.space[1.5]} ${n.space[3]}`,backgroundColor:n.errorLight,color:n.error,borderRadius:n.radius["2xl"],fontSize:n.fontSize.base,fontWeight:n.fontWeight.medium},children:['"',t,'"',s.jsxs("span",{style:{backgroundColor:`${n.error}30`,padding:`${n.space[.5]||"2px"} ${n.space[1.5]}`,borderRadius:n.radius.md,fontSize:n.fontSize.xs},children:[e,"x"]})]}),h4=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(e=>e.length>0).length,p4=t=>!t||!Array.isArray(t)?0:t.reduce((e,n)=>e+(n.count||0),0),f4=(t,e,n,i)=>{const r=h4(t),o=p4(e),a=r>0?o/r*100:0,l=i>0?Math.round(r/i*60):0;let c=0;r>=60?c=25:r>=40?c=15:r>=20?c=10:r>=10&&(c=5);let d=25;a>25?d=0:a>15?d=10:a>10?d=15:a>5&&(d=20);let u=0,p="keine_sprache";r>0&&(l>=100&&l<=140?(u=10,p="optimal"):l>=80&&l<100||l>140&&l<=160?(u=5,p=l<100?"zu_langsam":"zu_schnell"):(u=0,p=l<80?"zu_langsam":"zu_schnell"));const h=Math.min(40,Math.max(0,n||0)),m=c+d+u+h;return{total_words:r,filler_count:o,filler_percentage:a,words_per_minute:l,pace_feedback:p,score:m,score_breakdown:{words_score:c,filler_score:d,tempo_score:u,content_score:h}}},m4=({result:t,onPlayAgain:e,onBack:n,buttonGradient:i,primaryAccent:r,primaryAccentLight:o,branding:a})=>{const l=VT(t.score),c=t.score>=70,d=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]";return s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[s.jsxs("div",{style:{borderRadius:a.radius["2xl"],padding:a.space[8],marginBottom:a.space[6],background:d?`linear-gradient(135deg, ${a.textSecondary} 0%, ${a.textMuted} 100%)`:c?`linear-gradient(135deg, ${a.success} 0%, ${r} 100%)`:`linear-gradient(135deg, ${a.warning} 0%, ${a.warningDark||a.warning} 100%)`,color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:a.iconSize["4xl"],marginBottom:a.space[2]},children:d?"":l.emoji}),s.jsx("div",{style:{fontSize:"72px",fontWeight:a.fontWeight.bold,marginBottom:a.space[2]},children:t.score}),s.jsx("div",{style:{fontSize:a.fontSize.xl,opacity:.9,marginBottom:a.space[4]},children:"Punkte"}),s.jsx("p",{style:{fontSize:a.fontSize.lg,margin:0},children:d?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":l.message})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:a.space[3],marginBottom:a.space[6]},children:[s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[1.5],color:r,marginBottom:a.space[1.5]},children:[s.jsx(Ji,{style:{width:a.iconSize.sm,height:a.iconSize.sm}}),s.jsx("span",{style:{fontWeight:a.fontWeight.medium,fontSize:a.fontSize.sm},children:"Wrter"})]}),s.jsx("div",{style:{fontSize:a.fontSize["4xl"],fontWeight:a.fontWeight.bold,color:a.textMain},children:t.total_words}),s.jsx("div",{style:{fontSize:a.fontSize["2xs"],color:a.textMuted},children:"gesprochen"})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.error,marginBottom:"6px"},children:[s.jsx(yn,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Fllwrter"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.filler_count}),s.jsxs("div",{style:{fontSize:"11px",color:a.textMuted},children:[t.filler_percentage?.toFixed(1)||"0","%"]})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r,marginBottom:"6px"},children:[s.jsx(Gn,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Tempo"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.words_per_minute}),s.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"WPM"})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.textSecondary,marginBottom:"6px"},children:[s.jsx(qe,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Sprechzeit"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.duration_seconds||0}),s.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"Sekunden"})]})]}),t.filler_words&&t.filler_words.length>0&&s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"16px",border:`1px solid ${a.borderColor}`,marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Erkannte Fllwrter"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:t.filler_words.map((u,p)=>s.jsx(u4,{word:u.word,count:u.count,branding:a},p))})]}),!d&&s.jsxs("div",{style:{backgroundColor:o,border:`1px solid ${r}26`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:r,marginBottom:"12px",fontSize:"15px"},children:"Bewertung im Detail"}),t.score_breakdown&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:t.content_feedback?"12px":0},children:[s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Wortanzahl: ",s.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Fllwrter: ",s.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Tempo: ",s.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Inhalt: ",s.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&s.jsx("div",{style:{paddingTop:"12px",borderTop:`1px solid ${r}26`},children:s.jsxs("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0,lineHeight:1.5},children:[s.jsx("strong",{children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&s.jsxs("div",{style:{backgroundColor:a.warningLight,border:`1px solid ${a.warning}40`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.warning,marginBottom:"8px",fontSize:"15px"},children:"Tempo-Hinweis"}),s.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0},children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine Prsentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&s.jsxs("div",{style:{backgroundColor:a.cardBgHover,borderRadius:"12px",border:`1px solid ${a.borderColor}`,padding:"16px",marginBottom:"32px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Transkript"}),s.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,lineHeight:1.6,margin:0},children:t.transcript})]}),s.jsxs("div",{style:{display:"flex",gap:"16px"},children:[s.jsxs("button",{onClick:e,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:"none",background:i,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx($i,{style:{width:"18px",height:"18px"}}),"Nochmal spielen"]}),s.jsxs("button",{onClick:n,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:`1px solid ${a.borderColor}`,backgroundColor:a.cardBg,color:a.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck"]})]})]})},g4=({gameConfig:t,onBack:e,onComplete:n})=>{const[i,r]=f.useState(Ft.COUNTDOWN),[o,a]=f.useState(3),[l,c]=f.useState(t.duration),[d,u]=f.useState(null),[p,h]=f.useState(null),[m,x]=f.useState(0),[g,y]=f.useState(!1),{branding:v}=Fe(),w=v?.["--header-gradient"]||ve["--header-gradient"],k=v?.["--button-gradient"]||w,S=v?.["--primary-accent"]||ve["--primary-accent"],b=v?.["--primary-accent-light"]||ve["--primary-accent-light"],j=it(),C=f.useRef(null),T=f.useRef([]),_=f.useRef(null),E=f.useRef(null),N=f.useRef(null),L=f.useRef(null),V=f.useRef(null),D=me.getGeminiApiKey(),A=f.useCallback(()=>{_.current&&clearInterval(_.current),L.current&&cancelAnimationFrame(L.current),N.current&&(N.current.close(),N.current=null),C.current&&C.current.state!=="inactive"&&C.current.stop()},[]);f.useEffect(()=>A,[A]),f.useEffect(()=>{g||(y(!0),F())},[g]);const F=async()=>{r(Ft.COUNTDOWN),a(3);try{const le=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,de=await navigator.mediaDevices.getUserMedia({audio:le});N.current=new(window.AudioContext||window.webkitAudioContext);const ue=N.current.createMediaStreamSource(de);E.current=N.current.createAnalyser(),E.current.fftSize=256,ue.connect(E.current),C.current=new MediaRecorder(de,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),T.current=[],C.current.ondataavailable=xe=>{xe.data.size>0&&T.current.push(xe.data)};let $=3;const Se=setInterval(()=>{$--,a($),$===0&&(clearInterval(Se),M())},1e3)}catch(le){console.error("Microphone access denied:",le),h("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(Ft.ERROR)}},B=f.useCallback(async()=>{r(Ft.COUNTDOWN),a(3);try{const le=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,de=await navigator.mediaDevices.getUserMedia({audio:le});N.current=new(window.AudioContext||window.webkitAudioContext);const ue=N.current.createMediaStreamSource(de);E.current=N.current.createAnalyser(),E.current.fftSize=256,ue.connect(E.current),C.current=new MediaRecorder(de,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),T.current=[],C.current.ondataavailable=xe=>{xe.data.size>0&&T.current.push(xe.data)};let $=3;const Se=setInterval(()=>{$--,a($),$===0&&(clearInterval(Se),M())},1e3)}catch(le){console.error("Microphone access denied:",le),h("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(Ft.ERROR)}},[t.selectedMicrophoneId]),M=f.useCallback(()=>{r(Ft.RECORDING),c(t.duration),V.current=Date.now(),C.current.start();const le=()=>{if(E.current){const de=new Uint8Array(E.current.frequencyBinCount);E.current.getByteFrequencyData(de);const ue=de.reduce(($,Se)=>$+Se)/de.length;x(ue/255)}L.current=requestAnimationFrame(le)};le(),_.current=setInterval(()=>{c(de=>de<=1?(z(),0):de-1)},1e3)},[t.duration]),z=f.useCallback(()=>{const le=V.current?Math.round((Date.now()-V.current)/1e3):t.duration;A(),r(Ft.PROCESSING),C.current.onstop=async()=>{const de=new Blob(T.current,{type:C.current.mimeType});C.current.stream.getTracks().forEach(ue=>ue.stop());try{const ue=await QT(de,D,t.topic,t.duration),Se={...f4(ue.transcript,ue.filler_words,ue.content_score,le),transcript:ue.transcript||"[Keine Sprache erkannt]",filler_words:ue.filler_words||[],content_feedback:ue.content_feedback||"",duration_seconds:le};u(Se),r(Ft.RESULTS);try{const xe={game_type:t.mode.id,topic:t.topic,duration_seconds:le,score:Se.score,filler_count:Se.filler_count,words_per_minute:Se.words_per_minute,transcript:Se.transcript,analysis_json:JSON.stringify(Se)};await me.createGameSession(xe)}catch(xe){console.error("[GameSession] Failed to save game session:",xe)}}catch(ue){console.error("Analysis failed:",ue),h(`Analyse fehlgeschlagen: ${ue.message}`),r(Ft.ERROR)}},C.current.stop()},[D,t,A]),U=()=>{z()},W=()=>{u(null),h(null),c(t.duration),B()},q=()=>{switch(i){case Ft.READY:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:""}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:j.textMain,marginBottom:"12px"},children:"Bereit?"}),s.jsx("p",{style:{fontSize:"16px",color:j.textSecondary,marginBottom:"24px",lineHeight:1.6},children:t.topic}),s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:j.cardBgHover,borderRadius:"20px",color:j.textSecondary,fontSize:"14px",marginBottom:"32px"},children:[s.jsx(qe,{style:{width:"16px",height:"16px"}}),t.duration," Sekunden"]}),s.jsx("div",{children:s.jsxs("button",{onClick:B,style:{padding:"16px 40px",borderRadius:"14px",border:"none",background:k,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 14px ${S}66`},children:[s.jsx(Ht,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]})}),s.jsxs("button",{onClick:e,style:{marginTop:"24px",padding:"10px 20px",border:"none",backgroundColor:"transparent",color:j.textMuted,fontSize:"14px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},children:[s.jsx(Rt,{style:{width:"16px",height:"16px"}}),"Zurck zur Auswahl"]})]})});case Ft.RECORDING:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx(d4,{seconds:l,total:t.duration,isWarning:l<=10,primaryAccent:S,branding:j}),s.jsxs("div",{style:{marginTop:"32px",marginBottom:"32px",padding:"16px",backgroundColor:j.cardBgHover,borderRadius:"12px"},children:[s.jsx("p",{style:{fontSize:"13px",color:j.textMuted,marginBottom:"4px"},children:"Dein Thema:"}),s.jsx("p",{style:{fontSize:"15px",fontWeight:500,color:j.textMain,margin:0},children:t.topic})]}),s.jsx("div",{style:{marginBottom:"32px"},children:s.jsx(P.div,{style:{height:"80px",background:k,borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},animate:{opacity:.6+m*.4},children:s.jsx(P.div,{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},animate:{scale:1+m*.3},children:s.jsx(We,{style:{width:"28px",height:"28px",color:"white"}})})})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"32px"},children:[s.jsx(P.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:j.error}}),s.jsx("span",{style:{fontWeight:500,color:j.error,fontSize:"14px"},children:"Aufnahme luft..."})]}),s.jsxs("button",{onClick:U,style:{padding:"12px 24px",borderRadius:"12px",border:"none",backgroundColor:j.error,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(fs,{style:{width:"16px",height:"16px"}}),"Aufnahme beenden"]})]})});case Ft.PROCESSING:return s.jsxs("div",{style:{textAlign:"center",padding:"80px 20px"},children:[s.jsx(P.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},style:{width:"56px",height:"56px",border:`4px solid ${S}`,borderTopColor:"transparent",borderRadius:"50%",margin:"0 auto 24px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:j.textMain,marginBottom:"8px"},children:"Analysiere deine Aufnahme..."}),s.jsx("p",{style:{color:j.textMuted},children:"Der Fllwort-Killer zhlt nach"})]});case Ft.RESULTS:return s.jsx(m4,{result:d,onPlayAgain:W,onBack:e,buttonGradient:k,primaryAccent:S,primaryAccentLight:b,branding:j});case Ft.ERROR:return s.jsx("div",{style:{textAlign:"center",padding:"60px 20px"},children:s.jsxs("div",{style:{maxWidth:"400px",margin:"0 auto"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:j.errorLight,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(_j,{style:{width:"32px",height:"32px",color:j.error}})}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:j.textMain,marginBottom:"12px"},children:"Fehler"}),s.jsx("p",{style:{color:j.textSecondary,marginBottom:"24px"},children:p}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[s.jsxs("button",{onClick:W,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:k,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx($i,{style:{width:"16px",height:"16px"}}),"Erneut versuchen"]}),s.jsxs("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"12px",border:`1px solid ${j.borderColor}`,backgroundColor:j.cardBg,color:j.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(Rt,{style:{width:"16px",height:"16px"}}),"Zurck"]})]})]})});default:return null}};return s.jsxs("div",{style:{minHeight:"100%",paddingBottom:"32px"},children:[s.jsx(He,{children:i===Ft.COUNTDOWN&&s.jsx(c4,{count:o,branding:j})}),i!==Ft.COUNTDOWN&&i!==Ft.RECORDING&&s.jsx("div",{style:{padding:"16px 24px",borderBottom:`1px solid ${j.borderColor}`,backgroundColor:j.cardBg,position:"sticky",top:0,zIndex:10},children:s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",border:"none",backgroundColor:"transparent",color:j.textSecondary,fontSize:"14px",cursor:"pointer"},children:[s.jsx(Rt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsx("h1",{style:{fontWeight:600,color:j.textMain,fontSize:"16px",margin:0},children:t.mode.title}),s.jsx("div",{style:{width:"60px"}})]})}),s.jsx("div",{style:{padding:"24px"},children:s.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:q()})})]})},x4={"file-text":Gt,briefcase:Mn,banknote:Xi,users:Nn,user:Et,"message-circle":Ji,target:$e,award:pn,book:bo,clipboard:vo,star:Yt,lightbulb:je,shield:wi,compass:So,rocket:oi,heart:pu,folder:ko,"trending-up":Bt},y4=({onSelectTemplate:t,onShowList:e,onCreateTemplate:n,onEditTemplate:i,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l})=>{const{branding:c}=Fe(),d=c?.["--primary-accent"]||ve["--primary-accent"],[u,p]=f.useState(null),[h,m]=f.useState(0),x=f.useCallback(async()=>{const _=new URLSearchParams;l&&_.append("demo_code",l);const E=await me.request(`/smartbriefing/templates?${_.toString()}`,{method:"GET"});if(E.success&&E.data?.templates)return E.data.templates;throw new Error("Unerwartete API-Antwort")},[l,h]),g=()=>{if(!r&&!l){o&&(a(()=>n),o());return}n?.()},y=(_,E)=>{_.stopPropagation(),i?.(E)},v=(_,E)=>{_.stopPropagation(),p(E)},w=async()=>{if(u)try{const _=new URLSearchParams;l&&_.append("demo_code",l),(await me.request(`/smartbriefing/templates/${u.id}?${_.toString()}`,{method:"DELETE"})).success&&m(N=>N+1)}catch(_){console.error("[SmartBriefing] Error deleting template:",_)}finally{p(null)}},k=_=>x4[_.icon]||Gt,S=_=>{const E=_.variables_schema?.length||0;return[{text:`${E} Eingabefeld${E!==1?"er":""}`}]},b=_=>_.is_custom?s.jsxs("div",{style:{display:"flex",gap:"4px"},children:[s.jsx("button",{onClick:E=>y(E,_),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:E=>{E.currentTarget.style.backgroundColor="#f1f5f9",E.currentTarget.style.color=d},onMouseLeave:E=>{E.currentTarget.style.backgroundColor="transparent",E.currentTarget.style.color="#64748b"},title:"Template bearbeiten",children:s.jsx(mu,{size:16})}),s.jsx("button",{onClick:E=>v(E,_),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:E=>{E.currentTarget.style.backgroundColor="#fef2f2",E.currentTarget.style.color="#ef4444"},onMouseLeave:E=>{E.currentTarget.style.backgroundColor="transparent",E.currentTarget.style.color="#64748b"},title:"Template lschen",children:s.jsx(Pt,{size:16})})]}):null,j=(r||l)&&n?s.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s",whiteSpace:"nowrap"},onMouseEnter:_=>{_.currentTarget.style.borderColor=d,_.currentTarget.style.color=d},onMouseLeave:_=>{_.currentTarget.style.borderColor="#cbd5e1",_.currentTarget.style.color="#64748b"},children:[s.jsx(An,{size:18}),s.jsx("span",{className:"hidden sm:inline",children:"persnliches Template"}),s.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,C=()=>s.jsx("div",{style:{marginTop:"48px",padding:"20px 24px",backgroundColor:`${d}08`,borderRadius:"12px",border:`1px solid ${d}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(je,{size:20,style:{color:d,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"So funktioniert Smart Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.6},children:"Wahle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein massgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren Ruckfragen."})]})]})}),T=u&&s.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},onClick:()=>p(null),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"100%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:_=>_.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fef2f2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Pt,{size:24,style:{color:"#ef4444"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Template lschen?"}),s.jsx("p",{style:{margin:0,fontSize:"14px",color:"#64748b"},children:"Diese Aktion kann nicht rckgngig gemacht werden."})]})]}),s.jsx("div",{style:{backgroundColor:"#f8fafc",borderRadius:"8px",padding:"12px",marginBottom:"20px"},children:s.jsx("p",{style:{margin:0,fontSize:"14px",color:"#475569"},children:s.jsx("strong",{children:u.title})})}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>p(null),style:{padding:"10px 20px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:w,style:{padding:"10px 20px",borderRadius:"8px",border:"none",backgroundColor:"#ef4444",color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Lschen"})]})]})});return s.jsx(sl,{title:"Smart Briefing",subtitle:"Dein KI-gesttzter Vorbereitungs-Assistent",headerIcon:Gt,fetchScenarios:x,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:e,onSelectScenario:t,renderCardMeta:S,getIconForScenario:k,getCardCustomActions:b,cardActionLabel:"Briefing erstellen",cardActionIcon:Xt,categoryField:"category",emptyStateIcon:Gt,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:j,renderInfoBox:C,extraContent:T,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l,loadingMessage:"Templates werden geladen..."},h)},b4=({field:t,value:e,onChange:n,error:i,primaryAccent:r})=>{const o={width:"100%",padding:"14px 16px",borderRadius:"12px",border:`2px solid ${i?"#ef4444":"#e2e8f0"}`,fontSize:"16px",color:"#0f172a",backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s",boxSizing:"border-box"},a=d=>{d.target.style.borderColor=r,d.target.style.boxShadow=`0 0 0 3px ${r}1a`},l=d=>{d.target.style.borderColor=i?"#ef4444":"#e2e8f0",d.target.style.boxShadow="none"},c=()=>{switch(t.type){case"textarea":return s.jsx("textarea",{value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",rows:4,style:{...o,minHeight:"120px",resize:"vertical"},onFocus:a,onBlur:l});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:d=>n(t.key,d.target.value),style:{...o,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"20px",paddingRight:"44px"},onFocus:a,onBlur:l,children:[s.jsx("option",{value:"",children:"Bitte wahlen..."}),t.options?.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))]});case"text":default:return s.jsx("input",{type:"text",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",style:o,onFocus:a,onBlur:l})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#374151",marginBottom:"8px"},children:[t.label,t.required&&s.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),c(),i&&s.jsx("p",{style:{color:"#ef4444",fontSize:"13px",marginTop:"6px",margin:"6px 0 0 0"},children:i})]})},v4=({variable:t,index:e,onChange:n,onDelete:i,primaryAccent:r})=>s.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsx("input",{type:"text",value:t.key||"",onChange:o=>n(e,"key",o.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",flex:1,marginRight:"8px"}}),s.jsx("button",{type:"button",onClick:()=>i(e),style:{padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Pt,{size:18})})]}),s.jsx("textarea",{value:t.value||"",onChange:o=>n(e,"value",o.target.value),placeholder:"Wert eingeben... (mehrzeilig mglich)",rows:3,style:{width:"100%",padding:"10px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical",minHeight:"80px",boxSizing:"border-box"}})]}),S4=({template:t,onBack:e,onBriefingGenerated:n,isAuthenticated:i})=>{const{branding:r}=Fe(),[o,a]=f.useState({}),[l,c]=f.useState({}),[d,u]=f.useState(!1),[p,h]=f.useState(null),[m,x]=f.useState([]),[g,y]=f.useState(!1),v=r?.["--primary-accent"]||ve["--primary-accent"],w=r?.["--button-gradient"]||ve["--button-gradient"],k=pv(t?.icon);f.useEffect(()=>{if(t?.variables_schema){const E={};t.variables_schema.forEach(N=>{N.default&&(E[N.key]=N.default)}),a(E)}x([]),y(!1)},[t]);const S=()=>{x([...m,{key:"",value:""}])},b=(E,N,L)=>{const V=[...m];V[E][N]=L,x(V)},j=E=>{x(m.filter((N,L)=>L!==E))},C=(E,N)=>{a(L=>({...L,[E]:N})),l[E]&&c(L=>{const V={...L};return delete V[E],V})},T=()=>{const E={};return t?.variables_schema?.forEach(N=>{N.required&&!o[N.key]&&(E[N.key]="Dieses Feld ist erforderlich")}),E},_=async E=>{E.preventDefault();const N=T();if(Object.keys(N).length>0){c(N);return}u(!0),h(null);try{const L={};m.forEach(A=>{A.key&&A.value&&(L[A.key]=A.value)});const V={template_id:t.id,variables:o};Object.keys(L).length>0&&(V.custom_variables=L);const D=await me.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(V)});if(D.success&&D.data?.briefing)n(D.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(L){console.error("[SmartBriefing] Error generating briefing:",L),h(L.message||"Fehler beim Generieren des Briefings")}finally{u(!1)}};return t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{padding:"24px",paddingTop:"32px",maxWidth:"700px",margin:"0 auto"},children:[s.jsxs("button",{onClick:e,disabled:d,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:d?"not-allowed":"pointer",marginBottom:"24px",opacity:d?.5:1},children:[s.jsx(Rt,{size:18}),"Zuruck zur Ubersicht"]}),s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",marginBottom:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`linear-gradient(135deg, ${v}15, ${v}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(k,{size:28,style:{color:v}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:t.description})]})]})}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 20px 0",paddingBottom:"16px",borderBottom:"1px solid #f1f5f9"},children:"Deine Angaben"}),s.jsxs("form",{onSubmit:_,children:[t.variables_schema?.map(E=>s.jsx(b4,{field:E,value:o[E.key],onChange:C,error:l[E.key],primaryAccent:v},E.key)),t.allow_custom_variables&&s.jsxs("div",{style:{marginTop:"24px",marginBottom:"20px",paddingTop:"20px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("button",{type:"button",onClick:()=>y(!g),style:{display:"flex",alignItems:"center",gap:"8px",padding:"0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:g?"16px":"0"},children:[g?s.jsx(zi,{size:18}):s.jsx(wt,{size:18}),s.jsx(An,{size:16}),"Zustzliche Variablen hinzufgen (optional)"]}),g&&s.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",padding:"16px"},children:[s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:"Fge eigene Variablen hinzu, die in die Briefing-Generierung einflieen sollen."}),m.length>0&&s.jsx("div",{style:{marginBottom:"12px"},children:m.map((E,N)=>s.jsx(v4,{variable:E,index:N,onChange:b,onDelete:j,primaryAccent:v},N))}),s.jsxs("button",{type:"button",onClick:S,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"8px",backgroundColor:"white",color:"#64748b",fontSize:"13px",cursor:"pointer"},children:[s.jsx(An,{size:14}),"Variable hinzufgen"]})]})]}),p&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"16px",marginBottom:"20px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Te,{size:20,style:{color:"#ef4444",flexShrink:0}}),s.jsx("div",{children:s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:p})})]}),s.jsxs("button",{type:"submit",disabled:d,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",border:"none",background:w,color:"white",fontSize:"16px",fontWeight:600,cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s",boxShadow:`0 4px 14px ${v}40`,opacity:d?.7:1},children:[s.jsx(It,{size:20}),"Briefing generieren"]})]})]})]}),s.jsx(eh,{isLoading:d,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein mageschneidertes Briefing."})]}):null},k4={"file-text":Gt,briefcase:Mn,banknote:Xi,users:Nn,user:Et,"message-circle":Ji,target:$e,award:pn,book:bo,clipboard:vo,star:Yt,lightbulb:je,shield:wi,compass:So,rocket:oi},w4=({content:t,primaryAccent:e})=>{if(!t)return null;const n=r=>{const o=r.split(`
`),a=[];let l=[],c=null;const d=()=>{l.length>0&&(a.push(s.jsx("ul",{style:{margin:"12px 0",paddingLeft:"24px",listStyle:"none"},children:l.map((u,p)=>s.jsxs("li",{style:{marginBottom:"8px",fontSize:"15px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"20px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:c==="number"?`${p+1}.`:""}),i(u)]},p))},`list-${a.length}`)),l=[],c=null)};return o.forEach((u,p)=>{const h=u.trim();if(!h){d();return}if(h.startsWith("### ")){d(),a.push(s.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"24px 0 12px 0",paddingTop:"16px",borderTop:p>0?"1px solid #f1f5f9":"none",display:"flex",alignItems:"center",gap:"8px"},children:i(h.substring(4))},`h3-${p}`));return}if(h.startsWith("## ")){d(),a.push(s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"28px 0 14px 0"},children:i(h.substring(3))},`h2-${p}`));return}if(h.startsWith("# ")){d(),a.push(s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"32px 0 16px 0"},children:i(h.substring(2))},`h1-${p}`));return}if(h.startsWith("- ")||h.startsWith("* ")){c!=="bullet"&&(d(),c="bullet"),l.push(h.substring(2));return}const m=h.match(/^(\d+)\.\s/);if(m){c!=="number"&&(d(),c="number"),l.push(h.substring(m[0].length));return}d(),a.push(s.jsx("p",{style:{margin:"12px 0",fontSize:"15px",lineHeight:1.7,color:"#374151"},children:i(h)},`p-${p}`))}),d(),a},i=r=>{const o=[];let a=r,l=0;for(;a.length>0;){const c=a.match(/\*\*(.+?)\*\*/),d=a.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),u=a.match(/`([^`]+)`/),p=[{match:c,type:"bold"},{match:d,type:"italic"},{match:u,type:"code"}].filter(m=>m.match);if(p.length===0){o.push(a);break}const h=p.reduce((m,x)=>(m.match?.index??1/0)<(x.match?.index??1/0)?m:x);switch(h.match.index>0&&o.push(a.substring(0,h.match.index)),h.type){case"bold":o.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:h.match[1]},l++));break;case"italic":o.push(s.jsx("em",{style:{fontStyle:"italic"},children:h.match[1]||h.match[2]},l++));break;case"code":o.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:h.match[1]},l++));break}a=a.substring(h.match.index+h.match[0].length)}return o};return s.jsx("div",{children:n(t)})},C4=({briefing:t,template:e,onBack:n,onCreateNew:i,onGenerateAnother:r})=>{const{config:o}=Fe(),[a,l]=f.useState(!1),c=f.useRef(null),d=o?.buttonGradientStart||"#3A7FA7",u=k4[e?.icon||t?.template_icon]||Gt,p=x=>x?new Date(x).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",h=async()=>{try{await navigator.clipboard.writeText(t.content_markdown),l(!0),setTimeout(()=>l(!1),2e3)}catch(x){console.error("[SmartBriefing] Failed to copy:",x)}},m=()=>{const x=`${e?.title||t?.template_title}
${"=".repeat(50)}

Erstellt am: ${p(t.created_at)}

${t.content_markdown}`,g=new Blob([x],{type:"text/plain;charset=utf-8"}),y=URL.createObjectURL(g),v=document.createElement("a");v.href=y,v.download=`briefing-${t.id}.txt`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(y)};return t?s.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:"24px"},children:[s.jsx(Rt,{size:18}),"Zuruck zur Ubersicht"]}),s.jsx("div",{style:{backgroundColor:`${d}10`,borderRadius:"16px",padding:"20px 24px",marginBottom:"24px",border:`1px solid ${d}30`},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:d,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(It,{size:22,style:{color:"white"}})}),s.jsxs("div",{children:[s.jsx("h2",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Dein Briefing ist fertig!"}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:e?.title||t?.template_title})]})]})}),s.jsxs("div",{ref:c,style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`linear-gradient(135deg, ${d}15, ${d}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(u,{size:20,style:{color:d}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:e?.title||t?.template_title}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#94a3b8",marginTop:"2px"},children:[s.jsx(Zi,{size:12}),p(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsxs("button",{onClick:h,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:a?"#dcfce7":"white",color:a?"#16a34a":"#64748b",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},children:[a?s.jsx(ti,{size:16}):s.jsx(Ox,{size:16}),a?"Kopiert!":"Kopieren"]}),s.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#64748b",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(Mj,{size:16}),"Speichern"]})]})]}),s.jsx("div",{style:{padding:"24px"},children:s.jsx(w4,{content:t.content_markdown,primaryAccent:d})})]}),s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",flexWrap:"wrap"},children:[s.jsxs("button",{onClick:r,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${d}`,backgroundColor:"white",color:d,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(Zt,{size:18}),"Mit anderen Angaben neu generieren"]}),s.jsxs("button",{onClick:i,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${d}, ${d}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 14px ${d}40`},children:[s.jsx(An,{size:18}),"Neues Briefing erstellen"]})]})]}):null},j4={"file-text":Gt,briefcase:Mn,banknote:Xi,users:Nn,user:Et,"message-circle":Ji,target:$e,award:pn,book:bo,clipboard:vo,star:Yt,lightbulb:je,shield:wi,compass:So,rocket:oi},T4=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",E4=({briefing:t,onOpen:e,onDelete:n,primaryAccent:i,isDeleting:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),d=j4[t.template_icon]||Gt,u=p=>{p.stopPropagation(),l?(n(t.id),c(!1)):(c(!0),setTimeout(()=>c(!1),3e3))};return s.jsxs("div",{onClick:()=>e(t),onMouseEnter:()=>a(!0),onMouseLeave:()=>{a(!1),c(!1)},style:{backgroundColor:"white",borderRadius:"16px",padding:"20px",border:`2px solid ${o?i:"#e2e8f0"}`,boxShadow:o?`0 10px 25px -5px rgba(0,0,0,0.1), 0 0 0 1px ${i}20`:"0 1px 3px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease",transform:o?"translateY(-2px)":"translateY(0)",position:"relative"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"10px",background:`linear-gradient(135deg, ${i}15, ${i}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(d,{size:22,style:{color:i}})}),s.jsx("button",{onClick:u,disabled:r,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l?"#fef2f2":o?"#f1f5f9":"transparent",color:l?"#ef4444":"#94a3b8",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",opacity:o||l?1:0},children:r?s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(Pt,{size:18})})]}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 4px 0",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||"Unbenanntes Briefing"}),s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:t.template_title}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#94a3b8",fontSize:"12px"},children:[s.jsx(Zi,{size:14}),T4(t.created_at)]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:i,fontSize:"13px",fontWeight:500},children:["Offnen",s.jsx(Xt,{size:16})]})]}),l&&s.jsx("div",{style:{position:"absolute",top:"8px",right:"8px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"8px 12px",fontSize:"12px",color:"#dc2626",fontWeight:500,zIndex:10},onClick:p=>p.stopPropagation(),children:"Nochmal klicken zum Loschen"}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},R4=({onOpenBriefing:t,onCreateNew:e,isAuthenticated:n})=>{const{config:i}=Fe(),[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,p]=f.useState(null),h=i?.buttonGradientStart||"#3A7FA7";f.useEffect(()=>{(async()=>{if(!n){l(!1);return}try{l(!0),d(null);const g=await me.request("/smartbriefing/briefings",{method:"GET"});if(g.success&&g.data?.briefings){const y=g.data.briefings.filter(v=>v.status==="completed");o(y)}else throw new Error("Unerwartete API-Antwort")}catch(g){console.error("[SmartBriefing] Error fetching briefings:",g),d(g.message||"Fehler beim Laden der Briefings")}finally{l(!1)}})()},[n]);const m=async x=>{try{if(p(x),(await me.request(`/smartbriefing/briefings/${x}`,{method:"DELETE"})).success)o(y=>y.filter(v=>v.id!==x));else throw new Error("Fehler beim Loschen")}catch(g){console.error("[SmartBriefing] Error deleting briefing:",g),d(g.message||"Fehler beim Loschen des Briefings")}finally{p(null)}};return n?s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Meine Briefings"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[r.length," gespeicherte Briefings"]})]}),s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${h}, ${h}dd)`,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${h}40`},children:[s.jsx(An,{size:18}),"Neues Briefing"]})]}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(ge,{size:40,style:{color:h,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefings werden geladen..."})]}),c&&!a&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Te,{size:24,style:{color:"#ef4444",flexShrink:0}}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:"0 0 4px 0",color:"#dc2626",fontSize:"16px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:c})]})]}),!a&&!c&&s.jsx(s.Fragment,{children:r.length===0?s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(Wc,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Noch keine Briefings"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Erstelle dein erstes Briefing, um loszulegen."}),s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${h}, ${h}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${h}40`},children:[s.jsx(An,{size:18}),"Briefing erstellen"]})]}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:r.map(x=>s.jsx(E4,{briefing:x,onOpen:t,onDelete:m,primaryAccent:h,isDeleting:u===x.id},x.id))})})]}):s.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(Wc,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},I4=[{key:"file-text",icon:Gt,label:"Dokument"},{key:"briefcase",icon:Mn,label:"Koffer"},{key:"banknote",icon:Xi,label:"Geld"},{key:"users",icon:Nn,label:"Team"},{key:"user",icon:Et,label:"Person"},{key:"target",icon:$e,label:"Ziel"},{key:"lightbulb",icon:je,label:"Idee"},{key:"star",icon:Yt,label:"Stern"},{key:"shield",icon:wi,label:"Schutz"},{key:"compass",icon:So,label:"Kompass"},{key:"rocket",icon:oi,label:"Rakete"},{key:"message-circle",icon:Ji,label:"Nachricht"},{key:"award",icon:pn,label:"Auszeichnung"},{key:"book",icon:bo,label:"Buch"},{key:"clipboard",icon:vo,label:"Checkliste"}],Bm=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],Ua=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,_4=()=>({id:Ua(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),N4=()=>({id:Ua(),value:"",label:""}),A4=({variable:t,index:e,total:n,onChange:i,onDelete:r,onMoveUp:o,onMoveDown:a,primaryAccent:l})=>{const[c,d]=f.useState(!0),[u,p]=f.useState(t.label);f.useEffect(()=>{p(t.label)},[t.label]);const h=(w,k)=>{i({...t,[w]:k})},m=()=>{const w=[...t.options||[],N4()];i({...t,options:w})},x=(w,k,S)=>{const b=t.options.map(j=>j.id===w?{...j,[k]:S}:j);i({...t,options:b})},g=w=>{const k=t.options.filter(S=>S.id!==w);i({...t,options:k})},y=w=>w.toLowerCase().replace(/[]/g,k=>({:"ae",:"oe",:"ue",:"ss"})[k]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),v=()=>{if(u!==t.label){const w={label:u};(!t.key||t.key===y(t.label))&&(w.key=y(u)),i({...t,...w})}};return s.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0",marginBottom:"12px",overflow:"hidden"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 16px",backgroundColor:"white",borderBottom:c?"1px solid #e2e8f0":"none",cursor:"pointer"},onClick:()=>d(!c),children:[s.jsx(Dj,{size:16,style:{color:"#94a3b8",cursor:"grab"}}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px"},children:t.label||`Variable ${e+1}`}),t.key&&s.jsxs("span",{style:{marginLeft:"8px",color:"#64748b",fontSize:"12px"},children:["$","{","$",t.key,"}"]})]}),s.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:500,backgroundColor:`${l}15`,color:l},children:Bm.find(w=>w.value===t.type)?.label||t.type}),s.jsxs("div",{style:{display:"flex",gap:"2px"},children:[s.jsx("button",{onClick:w=>{w.stopPropagation(),o()},disabled:e===0,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===0?"not-allowed":"pointer",opacity:e===0?.3:1},children:s.jsx(zi,{size:16,style:{color:"#64748b"}})}),s.jsx("button",{onClick:w=>{w.stopPropagation(),a()},disabled:e===n-1,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===n-1?"not-allowed":"pointer",opacity:e===n-1?.3:1},children:s.jsx(wt,{size:16,style:{color:"#64748b"}})})]}),s.jsx("button",{onClick:w=>{w.stopPropagation(),r()},style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},title:"Variable lschen",children:s.jsx(Pt,{size:16})})]}),s.jsx(He,{children:c&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:s.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldbezeichnung *"}),s.jsx("input",{type:"text",value:u,onChange:w=>p(w.target.value),onBlur:v,placeholder:"z.B. Unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Variablenname *"}),s.jsx("input",{type:"text",value:t.key,onChange:w=>h("key",w.target.value),placeholder:"z.B. unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"12px",alignItems:"end"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldtyp"}),s.jsx("select",{value:t.type,onChange:w=>h("type",w.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",backgroundColor:"white"},children:Bm.map(w=>s.jsx("option",{value:w.value,children:w.label},w.value))})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 0",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:t.required,onChange:w=>h("required",w.target.checked),style:{width:"16px",height:"16px",accentColor:l}}),s.jsx("span",{style:{fontSize:"14px",color:"#475569"},children:"Pflichtfeld"})]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Platzhalter-Text (optional)"}),s.jsx("input",{type:"text",value:t.placeholder,onChange:w=>h("placeholder",w.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),t.type==="select"&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"8px"},children:"Auswahloptionen"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(t.options||[]).map((w,k)=>s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx("input",{type:"text",value:w.value,onChange:S=>x(w.id,"value",S.target.value),placeholder:"Wert",style:{flex:1,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px",fontFamily:"monospace"}}),s.jsx("input",{type:"text",value:w.label,onChange:S=>x(w.id,"label",S.target.value),placeholder:"Anzeigename",style:{flex:2,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px"}}),s.jsx("button",{onClick:()=>g(w.id),style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},children:s.jsx(Pt,{size:14})})]},w.id)),s.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"6px",backgroundColor:"transparent",color:"#64748b",fontSize:"13px",cursor:"pointer",marginTop:"4px"},children:[s.jsx(An,{size:14}),"Option hinzufgen"]})]})]})]})})})]})},M4=({selectedIcon:t,onSelect:e,primaryAccent:n})=>s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:I4.map(({key:i,icon:r,label:o})=>{const a=t===i;return s.jsx("button",{onClick:()=>e(i),title:o,style:{width:"60px",height:"60px",borderRadius:"12px",border:`2px solid ${a?n:"#e2e8f0"}`,backgroundColor:a?`${n}15`:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s"},children:s.jsx(r,{size:28,style:{color:a?n:"#64748b"}})},i)})}),P4=({isOpen:t,onClose:e,onSave:n,editTemplate:i=null,demoCode:r})=>{const{branding:o,config:a}=Fe(),l=o?.["--primary-accent"]||a?.buttonGradientStart||"#3A7FA7",[c,d]=f.useState(""),[u,p]=f.useState(""),[h,m]=f.useState("file-text"),[x,g]=f.useState(""),[y,v]=f.useState([]),[w,k]=f.useState(!1),[S,b]=f.useState(null),[j,C]=f.useState("basics");f.useEffect(()=>{i?(d(i.title||""),p(i.description||""),m(i.icon||"file-text"),g(i.system_prompt||""),v((i.variables_schema||[]).map(A=>({...A,id:A.id||Ua(),options:(A.options||[]).map(F=>({...F,id:F.id||Ua()}))})))):(d(""),p(""),m("file-text"),g(""),v([])),C("basics"),b(null)},[i,t]);const T=()=>{v([...y,_4()])},_=(A,F)=>{const B=[...y];B[A]=F,v(B)},E=A=>{v(y.filter((F,B)=>B!==A))},N=A=>{if(A===0)return;const F=[...y];[F[A-1],F[A]]=[F[A],F[A-1]],v(F)},L=A=>{if(A===y.length-1)return;const F=[...y];[F[A],F[A+1]]=[F[A+1],F[A]],v(F)},V=()=>{if(!c.trim())return b("Bitte gib einen Titel ein."),C("basics"),!1;if(!x.trim())return b("Bitte gib einen System-Prompt ein."),C("prompt"),!1;for(const A of y){if(!A.key.trim()||!A.label.trim())return b("Alle Variablen bentigen einen Namen und eine Bezeichnung."),C("variables"),!1;if(A.type==="select"&&(!A.options||A.options.length===0))return b(`Variable "${A.label}" bentigt mindestens eine Auswahloption.`),C("variables"),!1}return!0},D=async()=>{if(b(null),!!V()){k(!0);try{const A=y.map(M=>({key:M.key,label:M.label,type:M.type,required:M.required,placeholder:M.placeholder,...M.type==="select"?{options:M.options.map(z=>({value:z.value,label:z.label}))}:{}})),F={title:c.trim(),description:u.trim(),icon:h,system_prompt:x,variables_schema:A,...r?{demo_code:r}:{}};let B;if(i?B=await me.request(`/smartbriefing/templates/${i.id}`,{method:"PUT",body:JSON.stringify(F)}):B=await me.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(F)}),B.success)n?.(B.data.template),e();else throw new Error(B.message||"Fehler beim Speichern")}catch(A){console.error("[CreateTemplateDialog] Save error:",A),b(A.message||"Fehler beim Speichern des Templates")}finally{k(!1)}}};return t?s.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},children:s.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"20px",width:"100%",maxWidth:"700px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden"},onClick:A=>A.stopPropagation(),children:[s.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{children:[s.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:700,color:"#0f172a"},children:i?"Template bearbeiten":"Neues Template erstellen"}),s.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"#64748b"},children:"Erstelle ein persnliches Briefing-Template"})]}),s.jsx("button",{onClick:e,style:{padding:"8px",border:"none",backgroundColor:"#f1f5f9",borderRadius:"8px",cursor:"pointer"},children:s.jsx(rn,{size:20,style:{color:"#64748b"}})})]}),s.jsx("div",{style:{display:"flex",borderBottom:"1px solid #e2e8f0",padding:"0 24px"},children:[{key:"basics",label:"Grundlagen"},{key:"variables",label:"Eingabefelder"},{key:"prompt",label:"KI-Anweisung"}].map(A=>s.jsx("button",{onClick:()=>C(A.key),style:{padding:"12px 20px",border:"none",backgroundColor:"transparent",fontSize:"14px",fontWeight:600,cursor:"pointer",color:j===A.key?l:"#64748b",borderBottom:`3px solid ${j===A.key?l:"transparent"}`,marginBottom:"-1px",transition:"all 0.2s"},children:A.label},A.key))}),s.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px"},children:[S&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px 16px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Te,{size:18,style:{color:"#ef4444",flexShrink:0}}),s.jsx("span",{style:{color:"#dc2626",fontSize:"14px"},children:S})]}),j==="basics"&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Titel *"}),s.jsx("input",{type:"text",value:c,onChange:A=>d(A.target.value),placeholder:"z.B. Projektprsentation Vorbereitung",style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"15px"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Beschreibung"}),s.jsx("textarea",{value:u,onChange:A=>p(A.target.value),placeholder:"Kurze Beschreibung, wofr dieses Template verwendet wird...",rows:3,style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"8px"},children:"Symbol"}),s.jsx(M4,{selectedIcon:h,onSelect:m,primaryAccent:l})]})]}),j==="variables"&&s.jsxs("div",{children:[s.jsx("div",{style:{marginBottom:"16px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[s.jsx(Dx,{size:16,style:{color:"#64748b"}}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:"Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausfllen soll."})]})}),y.map((A,F)=>s.jsx(A4,{variable:A,index:F,total:y.length,onChange:B=>_(F,B),onDelete:()=>E(F),onMoveUp:()=>N(F),onMoveDown:()=>L(F),primaryAccent:l},A.id)),s.jsxs("button",{onClick:T,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"14px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:A=>{A.currentTarget.style.borderColor=l,A.currentTarget.style.color=l},onMouseLeave:A=>{A.currentTarget.style.borderColor="#cbd5e1",A.currentTarget.style.color="#64748b"},children:[s.jsx(An,{size:18}),"Eingabefeld hinzufgen"]}),y.length===0&&s.jsx("div",{style:{textAlign:"center",padding:"32px",color:"#94a3b8",fontSize:"14px"},children:"Noch keine Eingabefelder definiert."})]}),j==="prompt"&&s.jsxs("div",{children:[s.jsx("div",{style:{backgroundColor:"#f0f9ff",borderRadius:"10px",padding:"16px",marginBottom:"16px",border:"1px solid #bae6fd"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[s.jsx(je,{size:18,style:{color:"#0284c7",flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:"14px",fontWeight:600,color:"#0369a1"},children:"Tipps fr effektive Prompts"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"16px",fontSize:"13px",color:"#0369a1",lineHeight:1.6},children:[s.jsxs("li",{children:["Verwende ",s.jsxs("code",{style:{backgroundColor:"#e0f2fe",padding:"1px 4px",borderRadius:"3px"},children:["$","{variablenname}"]})," um auf Eingabefelder zu verweisen"]}),s.jsx("li",{children:'Beschreibe die Rolle der KI (z.B. "Du bist ein erfahrener Karriere-Coach...")'}),s.jsx("li",{children:"Definiere die Struktur des gewnschten Outputs"}),s.jsx("li",{children:"Gib Beispiele fr den Ton und Stil"})]})]})]})}),y.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsx("span",{style:{fontSize:"12px",color:"#64748b"},children:"Verfgbare Variablen: "}),y.map(A=>s.jsxs("code",{style:{display:"inline-block",padding:"2px 6px",marginRight:"6px",marginBottom:"4px",backgroundColor:"#f1f5f9",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",color:"#475569",cursor:"pointer"},onClick:()=>{const F=`\${${A.key}}`;g(B=>B+F)},title:"Klicken zum Einfgen",children:["$","{"+A.key+"}"]},A.id))]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"System-Prompt *"}),s.jsx("textarea",{value:x,onChange:A=>g(A.target.value),placeholder:`Du bist ein erfahrener Experte fr...

Erstelle ein strukturiertes Briefing fr den Nutzer basierend auf folgenden Informationen:
- Position: \${position}
- Unternehmen: \${unternehmen}

Das Briefing soll folgende Abschnitte enthalten:
1. ...
2. ...

Formatiere jeden Abschnitt mit einem Titel und 5-8 konkreten Bullet Points.`,rows:15,style:{width:"100%",padding:"14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",resize:"vertical",lineHeight:1.5}})]})]})]}),s.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},children:[s.jsx("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"10px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:D,disabled:w,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"10px",border:"none",background:`linear-gradient(135deg, ${l} 0%, ${l}dd 100%)`,color:"white",fontSize:"14px",fontWeight:600,cursor:w?"not-allowed":"pointer",opacity:w?.7:1},children:w?s.jsxs(s.Fragment,{children:[s.jsx(ge,{size:18,style:{animation:"spin 1s linear infinite"}}),"Speichern..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Vx,{size:18}),i?"Speichern":"Template erstellen"]})})]}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}):null},en={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},D4=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToSimulator:i,onNavigateToHistory:r,demoCode:o})=>{const[a,l]=f.useState(en.DASHBOARD),[c,d]=f.useState(null),[u,p]=f.useState(null),[h,m]=f.useState(null),[x,g]=f.useState(null),[y,v]=f.useState(!1),[w,k]=f.useState(null),[S,b]=f.useState(0);f.useEffect(()=>{x&&t&&(d(x),l(en.FORM),g(null))},[x,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const j=f.useCallback(M=>{d(M),l(en.FORM)},[]),C=f.useCallback(()=>{d(null),p(null),m(null),l(en.DASHBOARD)},[]),T=f.useCallback(M=>{p(M),m(M),l(en.WORKBOOK)},[]),_=f.useCallback(()=>{p(null),m(null),d(null),l(en.DASHBOARD)},[]),E=f.useCallback(()=>{p(null),m(null),l(en.FORM)},[]);f.useCallback(()=>{l(en.LIST)},[]);const N=f.useCallback(M=>{m(M),l(en.WORKBOOK)},[]);f.useCallback(()=>{m(null),l(en.LIST)},[]);const L=f.useCallback(M=>{i&&i(M)},[i]),V=f.useCallback(()=>{k(null),v(!0)},[]),D=f.useCallback(M=>{k(M),v(!0)},[]),A=f.useCallback(()=>{v(!1),k(null)},[]),F=f.useCallback(M=>{b(z=>z+1)},[]),B=()=>{switch(a){case en.FORM:return s.jsx(S4,{template:c,onBack:C,onBriefingGenerated:T,isAuthenticated:t});case en.RESULT:return s.jsx(C4,{briefing:u,template:c,onBack:C,onCreateNew:_,onGenerateAnother:E});case en.LIST:return s.jsx(R4,{onOpenBriefing:N,onCreateNew:_,isAuthenticated:t});case en.WORKBOOK:return s.jsx(mv,{briefing:h,onBack:C,onStartSimulation:i?L:null});case en.DASHBOARD:default:return s.jsx(y4,{onSelectTemplate:j,onShowList:r,onCreateTemplate:V,onEditTemplate:D,isAuthenticated:t,requireAuth:e,setPendingAction:n,demoCode:o},S)}};return s.jsxs("div",{style:{minHeight:"100%"},children:[B(),s.jsx(P4,{isOpen:y,onClose:A,onSave:F,editTemplate:w,demoCode:o})]})},O4=({onNavigateToRoleplay:t,compact:e=!1})=>{const{branding:n,demoCode:i}=Fe(),[r,o]=f.useState(!0),[a,l]=f.useState(null),[c,d]=f.useState(null),u=f.useMemo(()=>{const w=n?.["--header-gradient"]||ve["--header-gradient"],k=n?.["--header-text"]||ve["--header-text"],S=n?.["--primary-accent"]||ve["--primary-accent"],b=n?.["--primary-accent-light"]||ve["--primary-accent-light"];return{headerGradient:w,headerText:k,primaryAccent:S,primaryAccentLight:b}},[n]),p=async()=>{try{o(!0),l(null);const w=await me.getUsageLimits(i);d(w)}catch(w){console.error("[UsageLimits] Error fetching usage data:",w),l(w.message||"Fehler beim Laden der Nutzungsdaten")}finally{o(!1)}};f.useEffect(()=>{p()},[i]);const h=f.useMemo(()=>!c||c.monthly_limit===0?0:Math.min(100,c.used_minutes/c.monthly_limit*100),[c]),m=(w,k)=>{const S=w/k*100;return S<=0?"#ef4444":S<=20?"#f59e0b":S<=50?"#eab308":"#22c55e"},x=w=>w?new Date(w).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",g=w=>w==null?"0 Min.":`${Math.round(w*10)/10} Min.`;if(r)return s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(ge,{className:"w-8 h-8 animate-spin text-slate-400"})});if(a)return s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[s.jsx(Te,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-red-700 text-sm font-medium",children:a})}),s.jsxs(he,{variant:"outline",size:"sm",onClick:p,children:[s.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(e){const w=m(c?.remaining_minutes||0,c?.monthly_limit||10),k=c?.has_minutes!==!1;return s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:t,title:k?"Live-Gesprch starten":"Keine Minuten mehr verfgbar",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:u.headerGradient},children:s.jsx(zr,{className:"w-5 h-5",style:{color:u.headerText}})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gesprche"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold text-lg",style:{color:w},children:g(c?.remaining_minutes||0)}),s.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",c?.monthly_limit||10," Min."]})]})]}),!k&&s.jsx(Te,{className:"w-5 h-5 text-red-500"})]}),s.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${h}%`,background:w}})})]})}const y=m(c?.remaining_minutes||0,c?.monthly_limit||10),v=c?.has_minutes!==!1;return s.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4",style:{background:u.headerGradient},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:s.jsx(zr,{className:"w-6 h-6",style:{color:u.headerText}})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",style:{color:u.headerText},children:"Live-Gesprche"}),s.jsx("p",{className:"text-sm opacity-80",style:{color:u.headerText},children:"Monatliches Kontingent"})]})]}),s.jsx(he,{variant:"ghost",size:"icon",onClick:p,className:"text-white hover:bg-white/10",children:s.jsx(Zt,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"text-center mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:y,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-h)*2.827} 282.7`,className:"transition-all duration-500"})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[s.jsx("span",{className:"text-3xl font-bold",style:{color:y},children:g(c?.remaining_minutes||0)}),s.jsx("span",{className:"text-sm text-slate-500",children:"verfgbar"})]})]})}),s.jsx(He,{mode:"wait",children:v?h>80?s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Te,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),s.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",g(c?.remaining_minutes)," weise."]})]})]})},"low-minutes"):s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($n,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfgbar"}),s.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gesprch zum ben."})]})]})},"ok"):s.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Te,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),s.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",x(c?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(Bt,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),s.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[c?.monthly_limit||10," Min."]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(qe,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),s.jsx("span",{className:"text-lg font-bold text-slate-700",children:g(c?.used_minutes||0)})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(Zi,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),s.jsx("span",{className:"text-sm font-bold text-slate-700",children:x(c?.next_reset)})]})]}),s.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",x(c?.period_start)," - ",x(c?.period_end)]}),t&&s.jsxs(he,{onClick:t,disabled:!v,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:v?u.headerGradient:"#94a3b8",color:u.headerText},children:[s.jsx(zr,{className:"w-5 h-5 mr-2"}),v?"Live-Gesprch starten":"Keine Minuten verfgbar"]}),c?.is_demo_user&&c?.demo_code&&s.jsx("div",{className:"mt-4 text-center",children:s.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",s.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:c.demo_code})]})})]})]})},Cv=f.createContext(null),Fm={success:{bgColor:"#10b981",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},error:{bgColor:"#ef4444",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},info:{bgColor:"#3b82f6",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},warning:{bgColor:"#f59e0b",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}};function L4({id:t,message:e,type:n="success",duration:i=3e3,onDismiss:r}){const o=Fm[n]||Fm.info;return f.useEffect(()=>{if(i>0){const a=setTimeout(()=>{r(t)},i);return()=>clearTimeout(a)}},[t,i,r]),s.jsxs(P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px",padding:"14px 20px",backgroundColor:o.bgColor,color:"#ffffff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",fontSize:"15px",fontWeight:500,minWidth:"280px",maxWidth:"400px"},children:[s.jsx("span",{style:{flexShrink:0},children:o.icon}),s.jsx("span",{style:{flex:1},children:e}),s.jsx("button",{onClick:()=>r(t),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"6px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",flexShrink:0},onMouseEnter:a=>a.target.style.background="rgba(255, 255, 255, 0.3)",onMouseLeave:a=>a.target.style.background="rgba(255, 255, 255, 0.2)",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function z4({toasts:t,onDismiss:e}){return s.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:s.jsx(He,{children:t.map(n=>s.jsx(L4,{...n,onDismiss:e},n.id))})})}function B4({children:t}){const[e,n]=f.useState([]),i=f.useCallback((u,p="success",h=3e3)=>{const m=Date.now()+Math.random();return n(x=>[...x,{id:m,message:u,type:p,duration:h}]),m},[]),r=f.useCallback(u=>{n(p=>p.filter(h=>h.id!==u))},[]),o=f.useCallback((u,p)=>i(u,"success",p),[i]),a=f.useCallback((u,p)=>i(u,"error",p),[i]),l=f.useCallback((u,p)=>i(u,"info",p),[i]),c=f.useCallback((u,p)=>i(u,"warning",p),[i]),d={addToast:i,dismissToast:r,showSuccess:o,showError:a,showInfo:l,showWarning:c};return s.jsxs(Cv.Provider,{value:d,children:[t,s.jsx(z4,{toasts:e,onDismiss:r})]})}function jv(){const t=f.useContext(Cv);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}const Oe={blue:{50:"#E8F4F8",600:"#3A7FA7",700:"#2D6485"},teal:{500:"#3DA389"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",400:"#94a3b8",700:"#334155",900:"#0f172a"}},Tv=t=>t?{sidebarBg:t["--sidebar-bg-color"]||Oe.slate[50],sidebarText:t["--sidebar-text-color"]||Oe.slate[900],sidebarTextMuted:t["--sidebar-text-muted"]||Oe.slate[400],sidebarActiveBg:t["--sidebar-active-bg"]||Oe.blue[50],sidebarActiveText:t["--sidebar-active-text"]||Oe.blue[700],sidebarHoverBg:t["--sidebar-hover-bg"]||Oe.slate[50],primaryAccent:t["--primary-accent"]||Oe.blue[600],borderColor:t["--border-color"]||Oe.slate[200],borderColorLight:t["--border-color-light"]||Oe.slate[100]}:null,Ev=[{id:"overview",moduleId:"overview",label:"bersicht",shortLabel:"bersicht",icon:zj,description:"Alle Trainingsmglichkeiten",alwaysVisible:!0},{id:"smart_briefing",moduleId:"smart_briefing",label:"Smart Briefing",shortLabel:"Briefing",icon:It,description:"KI-Vorbereitungs-Assistent"},{id:"simulator",moduleId:"simulator",label:"Szenario-Training",shortLabel:"Szenario",icon:$e,description:"Frage-Antwort Training mit KI-Feedback"},{id:"video_training",moduleId:"video_training",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:pt,description:"Video-Aufnahme mit Wirkungs-Analyse"},{id:"dashboard",moduleId:"roleplay",label:"Live-Simulationen",shortLabel:"Live",icon:Le,description:"Live Simulationen mit KI-Interviewer"},{id:"gym",moduleId:"gym",label:"Rhetorik-Gym",shortLabel:"Gym",icon:uu,description:"Spielerisch Rhetorik trainieren",subItems:[{id:"gym_klassiker",label:"Der Fllwort-Killer",shortLabel:"Klassiker",icon:oi,description:"60s Elevator Pitch"}]},{id:"history",moduleId:"history",label:"Meine Sessions",shortLabel:"Sessions",icon:$c,description:"Vergangene bungen ansehen"},{id:"usage_limits",moduleId:"roleplay",label:"Mein Kontingent",shortLabel:"Kontingent",icon:qe,description:"Verfgbare Gesprchsminuten"}],Rv=[{id:"admin",label:"Administration",shortLabel:"Admin",icon:wi,description:"Inhalte verwalten",adminOnly:!0,subItems:[{id:"admin_roleplays",label:"Live-Simulationen",shortLabel:"Live",icon:Le,description:"Simulations-Szenarien verwalten"},{id:"admin_simulator",label:"Szenario-Training",shortLabel:"Simulator",icon:$e,description:"Simulator-Szenarien verwalten"},{id:"admin_video",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:pt,description:"Wirkungs-Analysen verwalten"},{id:"admin_partners",label:"Partner-Branding",shortLabel:"Partner",icon:Nn,description:"White-Label Partner verwalten"}]}],F4=({isCollapsed:t,onToggleCollapse:e,activeView:n,onNavigate:i,headerOffset:r=0,onLoginClick:o})=>{const[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:p,checkModuleAllowed:h}=Fe(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=Rd(),{showSuccess:v}=jv(),w=Tv(c),k=f.useMemo(()=>{const T=Ev.filter(_=>{if(_.alwaysVisible)return!0;const E=_.moduleId||_.id;return h(E)});return g?[...T,...Rv]:T},[h,g]),S=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>w?{sidebarBg:w.sidebarBg,sidebarText:w.sidebarText,sidebarTextMuted:w.sidebarTextMuted,activeBg:w.sidebarActiveBg,activeText:w.sidebarActiveText,hoverBg:w.sidebarHoverBg,primaryAccent:w.primaryAccent,borderColor:w.borderColor,borderColorLight:w.borderColorLight}:{sidebarBg:"#ffffff",sidebarText:Oe.slate[900],sidebarTextMuted:Oe.slate[400],activeBg:Oe.blue[50],activeText:Oe.blue[700],hoverBg:Oe.slate[50],primaryAccent:Oe.blue[600],borderColor:Oe.slate[200],borderColorLight:Oe.slate[100]},[w]),j=T=>{l(_=>_.includes(T)?_.filter(E=>E!==T):[..._,T])},C=T=>{T.subItems&&!t?j(T.id):i(T.id)};return s.jsxs(P.aside,{initial:!1,animate:{width:t?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{position:"fixed",left:0,top:r,bottom:0,zIndex:40,backgroundColor:b.sidebarBg,borderRight:`1px solid ${b.borderColor}`,display:"flex",flexDirection:"column",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:[s.jsx("div",{style:{height:"64px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${b.borderColorLight}`},children:s.jsx(He,{mode:"wait",children:t?s.jsx(P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",margin:"0 auto",overflow:"hidden"},children:p?s.jsx("img",{src:p,alt:u,style:{width:"100%",height:"100%",objectFit:"contain"}}):s.jsx(Vc,{style:{width:"20px",height:"20px",color:"white"}})},"logo-collapsed"):s.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px"},children:[p?s.jsx("img",{src:p,alt:u,style:{width:"40px",height:"40px",borderRadius:"12px",objectFit:"contain"}}):s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:s.jsx(Vc,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsx("div",{style:{display:"flex",flexDirection:"column"},children:d?s.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.4"},children:u}):s.jsxs(s.Fragment,{children:[s.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.2"},children:"Karriere"}),s.jsx("span",{style:{fontWeight:700,color:b.primaryAccent,fontSize:"14px",lineHeight:"1.2"},children:"Navigation"})]})})]},"logo-full")})}),s.jsx("nav",{style:{flex:1,padding:"8px 12px",overflowY:"auto"},children:k.map((T,_)=>{const E=T.icon,N=n===T.id||T.id==="dashboard"&&n==="roleplay"||T.id==="gym"&&n.startsWith("gym")||T.id==="admin"&&n.startsWith("admin"),L=T.subItems&&T.subItems.length>0,V=a.includes(T.id),D=T.adminOnly;return s.jsxs("div",{children:[D&&s.jsx("div",{style:{margin:"12px 0",padding:t?"0":"0 4px",borderTop:`1px solid ${b.borderColor}`},children:!t&&s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.sidebarTextMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"12px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>C(T),style:{width:"100%",borderRadius:"12px",display:"flex",alignItems:"center",gap:"12px",position:"relative",padding:t?"12px":"12px 16px",justifyContent:t?"center":"flex-start",backgroundColor:N?b.activeBg:"transparent",color:N?b.activeText:b.sidebarText,fontWeight:N?600:400,fontSize:"14px",border:"none",cursor:"pointer",marginBottom:"4px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:A=>{N||(A.currentTarget.style.backgroundColor=b.hoverBg,A.currentTarget.style.color=b.sidebarText)},onMouseLeave:A=>{N||(A.currentTarget.style.backgroundColor="transparent",A.currentTarget.style.color=b.sidebarText)},children:[N&&s.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:"4px",height:"32px",backgroundColor:b.primaryAccent,borderTopRightRadius:"9999px",borderBottomRightRadius:"9999px"}}),s.jsx(E,{style:{width:"20px",height:"20px",flexShrink:0,color:N?b.primaryAccent:b.sidebarTextMuted}}),!t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",flex:1,minWidth:0},children:[s.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:T.label}),s.jsx("span",{style:{fontSize:"12px",color:b.sidebarTextMuted,whiteSpace:"normal",lineHeight:1.3},children:T.description})]}),L&&s.jsx(wt,{style:{width:"16px",height:"16px",color:b.sidebarTextMuted,transition:"transform 0.2s",transform:V?"rotate(180deg)":"rotate(0deg)"}})]})]}),L&&!t&&s.jsx(He,{children:V&&s.jsx(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},style:{overflow:"hidden",marginLeft:"16px"},children:T.subItems.map(A=>{const F=A.icon,B=n===A.id;return s.jsxs("button",{onClick:()=>i(A.id),style:{width:"100%",borderRadius:"10px",display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",backgroundColor:B?b.activeBg:"transparent",color:B?b.activeText:b.sidebarText,fontWeight:B?600:400,fontSize:"13px",border:"none",cursor:"pointer",marginBottom:"2px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:M=>{B||(M.currentTarget.style.backgroundColor=b.hoverBg,M.currentTarget.style.color=b.sidebarText)},onMouseLeave:M=>{B||(M.currentTarget.style.backgroundColor="transparent",M.currentTarget.style.color=b.sidebarText)},children:[s.jsx(F,{style:{width:"16px",height:"16px",flexShrink:0,color:B?b.primaryAccent:b.sidebarTextMuted}}),s.jsx("span",{style:{whiteSpace:"nowrap"},children:A.label})]},A.id)})})})]},T.id)})}),s.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${b.borderColorLight}`},children:x&&m?s.jsxs("div",{style:{marginBottom:"8px"},children:[!t&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"14px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:b.sidebarText,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"12px",color:b.sidebarText,opacity:.7,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.email})]})]}),s.jsxs("button",{onClick:S,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Abmelden",children:[s.jsx(Bx,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:o,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,cursor:"pointer",fontSize:"13px",fontWeight:500,transition:"all 0.2s",marginBottom:"8px"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Anmelden",children:[s.jsx(ka,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Anmelden"})]})}),s.jsx("div",{style:{padding:"0 12px 12px 12px"},children:s.jsx("button",{onClick:e,style:{width:"100%",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"12px",justifyContent:t?"center":"flex-start",color:b.sidebarTextMuted,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg,T.currentTarget.style.color=b.sidebarText},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent",T.currentTarget.style.color=b.sidebarTextMuted},children:t?s.jsx(Xt,{style:{width:"20px",height:"20px"}}):s.jsxs(s.Fragment,{children:[s.jsx(ma,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Einklappen"})]})})})]})},U4=({activeView:t,onNavigate:e,headerOffset:n=0,onLoginClick:i})=>{const[r,o]=f.useState(!1),[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:p,checkModuleAllowed:h}=Fe(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=Rd(),{showSuccess:v}=jv(),w=Tv(c),k=f.useMemo(()=>{const T=Ev.filter(_=>{const E=_.moduleId||_.id;return h(E)});return g?[...T,...Rv]:T},[h,g]),S=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>w?{headerBg:w.sidebarBg,headerText:w.sidebarText,headerTextMuted:w.sidebarTextMuted,menuBg:"#ffffff",activeBg:w.sidebarActiveBg,activeText:w.sidebarActiveText,hoverBg:w.sidebarHoverBg,primaryAccent:w.primaryAccent,borderColor:w.borderColor,textMain:Oe.slate[700],textMuted:Oe.slate[400]}:{headerBg:"#ffffff",headerText:Oe.slate[900],headerTextMuted:Oe.slate[400],menuBg:"#ffffff",activeBg:Oe.blue[50],activeText:Oe.blue[700],hoverBg:Oe.slate[50],primaryAccent:Oe.blue[600],borderColor:Oe.slate[200],textMain:Oe.slate[700],textMuted:Oe.slate[400]},[w]),j=T=>{e(T),o(!1)},C=T=>{l(_=>_.includes(T)?_.filter(E=>E!==T):[..._,T])};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{position:"fixed",top:n,left:0,right:0,height:"56px",backgroundColor:b.headerBg,borderBottom:`1px solid ${b.borderColor}`,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",zIndex:50,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",transition:"top 0.15s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[p?s.jsx("img",{src:p,alt:u,style:{width:"36px",height:"36px",borderRadius:"10px",objectFit:"contain"}}):s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Vc,{style:{width:"18px",height:"18px",color:"white"}})}),s.jsx("span",{style:{fontWeight:700,color:b.headerText,fontSize:"15px"},children:d?u:"Karriere Navigation"})]}),s.jsx("button",{onClick:()=>o(!r),style:{width:"56px",height:"56px",borderRadius:"12px",border:"none",backgroundColor:r?b.hoverBg:"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:r?s.jsx(rn,{style:{width:"40px",height:"40px",color:b.headerText}}):s.jsx(Wj,{style:{width:"40px",height:"40px",color:b.headerText}})})]}),s.jsx(He,{children:r&&s.jsxs(s.Fragment,{children:[s.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(!1),style:{position:"fixed",top:n+56,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:40}}),s.jsxs(P.nav,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},style:{position:"fixed",top:n+56,left:0,right:0,backgroundColor:b.menuBg,zIndex:45,padding:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderBottomLeftRadius:"16px",borderBottomRightRadius:"16px",maxHeight:"70vh",overflowY:"auto"},children:[k.map(T=>{const _=T.icon,E=t===T.id||T.id==="dashboard"&&t==="roleplay"||T.id==="gym"&&t.startsWith("gym")||T.id==="admin"&&t.startsWith("admin"),N=T.subItems&&T.subItems.length>0,L=a.includes(T.id),V=T.adminOnly;return s.jsxs("div",{children:[V&&s.jsx("div",{style:{margin:"12px 8px",borderTop:`1px solid ${b.borderColor}`},children:s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.textMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"8px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>N?C(T.id):j(T.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:"none",backgroundColor:E?b.activeBg:"transparent",color:E?b.activeText:b.textMain,fontSize:"15px",fontWeight:E?600:500,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx(_,{style:{width:"22px",height:"22px",color:E?b.primaryAccent:b.textMuted}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{children:T.label}),s.jsx("div",{style:{fontSize:"12px",color:b.textMuted,fontWeight:400},children:T.description})]}),N&&s.jsx(wt,{style:{width:"18px",height:"18px",color:b.textMuted,transition:"transform 0.2s",transform:L?"rotate(180deg)":"rotate(0deg)"}})]}),N&&L&&s.jsx("div",{style:{marginLeft:"20px",marginBottom:"8px"},children:T.subItems.map(D=>{const A=D.icon,F=t===D.id;return s.jsxs("button",{onClick:()=>j(D.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",borderRadius:"10px",border:"none",backgroundColor:F?b.activeBg:"transparent",color:F?b.activeText:b.textMain,fontSize:"14px",fontWeight:F?600:400,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx(A,{style:{width:"18px",height:"18px",color:F?b.primaryAccent:b.textMuted}}),s.jsx("span",{children:D.label})]},D.id)})})]},T.id)}),s.jsx("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${b.borderColor}`},children:x&&m?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"16px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:b.textMain},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"13px",color:b.textMain,opacity:.7},children:m.email})]})]}),s.jsxs("button",{onClick:()=>{S(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:"none",backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:500,cursor:"pointer",textAlign:"left"},children:[s.jsx(Bx,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:()=>{i&&i(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:`1px solid ${b.borderColor}`,backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:600,cursor:"pointer",textAlign:"left"},children:[s.jsx(ka,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Anmelden"})]})})]})]})})]})},W4=({children:t,activeView:e,onNavigate:n,headerOffset:i=0,onLoginClick:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),{branding:d}=Fe(),u=f.useMemo(()=>{if(d){const h=d["--app-bg-start"]||"#f8fafc",m=d["--app-bg-mid"]||"#eff6ff",x=d["--app-bg-end"]||"#f0fdfa";return`linear-gradient(135deg, ${h} 0%, ${m} 50%, ${x} 100%)`}return"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)"},[d]);f.useEffect(()=>{const h=()=>{c(window.innerWidth<768)};h(),window.addEventListener("resize",h);const m=localStorage.getItem("sidebar-collapsed");return m!==null&&a(JSON.parse(m)),()=>window.removeEventListener("resize",h)},[]);const p=()=>{const h=!o;a(h),localStorage.setItem("sidebar-collapsed",JSON.stringify(h))};return l?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(U4,{activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx("main",{"data-main-content":!0,style:{paddingTop:"56px",minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(F4,{isCollapsed:o,onToggleCollapse:p,activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx(P.main,{"data-main-content":!0,initial:!1,animate:{marginLeft:o?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]})};function V4({isOpen:t,onClose:e,onSuccess:n}){const{branding:i,partnerName:r,logoUrl:o}=Fe(),[a,l]=f.useState(1),[c,d]=f.useState(""),[u,p]=f.useState(""),[h,m]=f.useState(""),[x,g]=f.useState(""),[y,v]=f.useState(""),[w,k]=f.useState(""),[S,b]=f.useState(!1),[j,C]=f.useState(""),[T,_]=f.useState(!1),[E,N]=f.useState(!1),L=i?.["--primary-accent"]||"#3A7FA7",V=i?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",D=i?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",A=i?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",F=i?.["--header-text"]||"#ffffff",B=i?.["--sidebar-text-color"]||"#ffffff",M=async $=>{if($.preventDefault(),C(""),!c.trim()){C("Bitte geben Sie Ihren Demo-Code ein.");return}if(c.trim().length!==5){C("Der Demo-Code muss 5 Zeichen lang sein.");return}_(!0);try{const Se=ni(),xe=Lt(),st=await(await fetch(`${Se}/demo/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":xe},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim()})})).json();if(!st.valid){C("Der Demo-Code ist ungltig. Bitte berprfen Sie Ihre Eingabe.");return}st.is_activated?(N(!0),n&&n(c.toUpperCase().trim())):l(2)}catch(Se){console.error("[DEMO] Validation error:",Se),C("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{_(!1)}},z=async $=>{if($.preventDefault(),C(""),!u.trim()){C("Bitte geben Sie den Firmennamen ein.");return}if(!h.trim()){C("Bitte geben Sie den Namen des Ansprechpartners ein.");return}if(!y.trim()){C("Bitte geben Sie eine Kontakt-E-Mail ein.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)){C("Bitte geben Sie eine gltige E-Mail-Adresse ein.");return}if(!S){C("Bitte stimmen Sie den Datenschutzbestimmungen zu.");return}_(!0);try{const xe=ni(),Ke=Lt(),Ve=await(await fetch(`${xe}/demo/activate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Ke},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim(),company_name:u.trim(),contact_name:h.trim(),homepage:x.trim(),contact_email:y.trim(),phone:w.trim(),privacy_accepted:S})})).json();Ve.success?(N(!0),n&&n(c.toUpperCase().trim())):C(Ve.error?.message||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}catch(xe){console.error("[DEMO] Activation error:",xe),C("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{_(!1)}},U=()=>{E||(l(1),d(""),p(""),m(""),g(""),v(""),k(""),b(!1),C(""),e&&e())},W=()=>{l(1),C("")},q=$=>{$.target===$.currentTarget&&U()};if(ur.useEffect(()=>{const $=Se=>{Se.key==="Escape"&&t&&U()};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[t,E]),!t)return null;const le={width:"100%",padding:"10px 14px",fontSize:"14px",border:"1px solid #e2e8f0",borderRadius:"10px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},de={borderColor:L,boxShadow:`0 0 0 3px ${A}`,backgroundColor:"#ffffff"},ue={display:"block",fontSize:"13px",fontWeight:"500",color:"#374151",marginBottom:"6px"};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:q,role:"dialog","aria-modal":"true","aria-labelledby":"demo-modal-title",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:D,color:F},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[a===2&&s.jsx("button",{onClick:W,className:"p-1.5 rounded-lg transition-colors",style:{color:F,backgroundColor:"transparent"},onMouseEnter:$=>$.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:$=>$.target.style.backgroundColor="transparent","aria-label":"Zurck",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h2",{id:"demo-modal-title",className:"text-xl font-semibold",style:{color:F},children:a===1?"Demo-Code eingeben":"Kontaktdaten"})]}),s.jsx("button",{onClick:U,className:"p-2 rounded-xl transition-colors",style:{color:F,backgroundColor:"transparent"},onMouseEnter:$=>$.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:$=>$.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o&&a===1&&s.jsx("div",{className:"mt-3 mb-1 flex justify-center",children:s.jsx("img",{src:o,alt:`${r} Logo`,style:{height:"4rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:F,opacity:a>=1?1:.3}}),s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:F,opacity:a>=2?1:.3}})]})]}),a===1&&s.jsxs("form",{onSubmit:M,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-700 text-sm",children:s.jsx("p",{children:"Willkommen zur Demo! Bitte geben Sie den Demo-Code ein, den Sie von uns erhalten haben."})}),j&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:j})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"demo-code",style:ue,children:["Demo-Code ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"demo-code",value:c,onChange:$=>d($.target.value.toUpperCase()),style:{...le,fontFamily:"monospace",fontSize:"24px",fontWeight:"600",letterSpacing:"4px",textAlign:"center",padding:"16px 14px"},onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"XXXXX",maxLength:5,disabled:T,autoComplete:"off",autoFocus:!0})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:B,background:T?"#94a3b8":V,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:$=>{T||($.target.style.transform="translateY(-1px)",$.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:$=>{$.target.style.transform="translateY(0)",$.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:B,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:B},children:"Wird berprft..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:B,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),s.jsx("span",{style:{color:B},children:"Weiter"})]})}),s.jsxs("p",{className:"text-xs text-center text-gray-500 pt-2",children:["Haben Sie keinen Demo-Code? Kontaktieren Sie uns unter"," ",s.jsx("a",{href:"mailto:info@karriereheld.de",className:"underline",style:{color:L},children:"info@karriereheld.de"})]})]}),a===2&&s.jsxs("form",{onSubmit:z,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Code gltig!"})," Bitte geben Sie noch Ihre Kontaktdaten ein, um die Demo zu starten."]})}),j&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:j})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"company-name",style:ue,children:["Firma ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"company-name",value:u,onChange:$=>p($.target.value),style:le,onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"Ihre Firma",disabled:T,autoComplete:"organization",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-name",style:ue,children:["Ansprechpartner ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"contact-name",value:h,onChange:$=>m($.target.value),style:le,onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"Ihr Name",disabled:T,autoComplete:"name"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-email",style:ue,children:["E-Mail ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"email",id:"contact-email",value:y,onChange:$=>v($.target.value),style:le,onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"email@firma.de",disabled:T,autoComplete:"email"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"homepage",style:ue,children:["Homepage ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"url",id:"homepage",value:x,onChange:$=>g($.target.value),style:le,onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"https://www.ihre-firma.de",disabled:T,autoComplete:"url"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"phone",style:ue,children:["Telefon ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"tel",id:"phone",value:w,onChange:$=>k($.target.value),style:le,onFocus:$=>Object.assign($.target.style,de),onBlur:$=>{$.target.style.borderColor="#e2e8f0",$.target.style.boxShadow="none"},placeholder:"+49 123 456789",disabled:T,autoComplete:"tel"})]}),s.jsxs("div",{className:"flex items-start gap-3 pt-2",children:[s.jsx("input",{type:"checkbox",id:"privacy-accepted",checked:S,onChange:$=>b($.target.checked),className:"mt-1 w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:T,style:{accentColor:L}}),s.jsxs("label",{htmlFor:"privacy-accepted",className:"text-sm text-gray-600",children:["Ich stimme den"," ",s.jsx("a",{href:"/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-gray-900",style:{color:L},children:"Datenschutzbestimmungen"})," ","zu. ",s.jsx("span",{className:"text-red-500",children:"*"})]})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:B,background:T?"#94a3b8":V,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:$=>{T||($.target.style.transform="translateY(-1px)",$.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:$=>{$.target.style.transform="translateY(0)",$.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:B,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:B},children:"Wird aktiviert..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:B,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),s.jsx("span",{style:{color:B},children:"Demo starten"})]})})]})]})})}const $4="demo";function G4({isOpen:t,onClose:e,onLoginSuccess:n}){const{login:i,logout:r,branding:o,partnerName:a,logoUrl:l,setDemoCode:c}=Fe(),[d,u]=f.useState(""),[p,h]=f.useState(""),[m,x]=f.useState(""),[g,y]=f.useState(!1),[v,w]=f.useState(!1),[k,S]=f.useState(null),b=o?.["--primary-accent"]||"#3A7FA7",j=o?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",C=o?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",T=o?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",_=o?.["--header-text"]||"#ffffff",E=o?.["--sidebar-text-color"]||"#ffffff",N=async M=>{if(M.preventDefault(),x(""),!d.trim()||!p.trim()){x("Bitte geben Sie Benutzername und Passwort ein.");return}y(!0);try{const z=await i(d,p);z.success?d.toLowerCase()===$4?(localStorage.setItem("bewerbungstrainer_demo_pending","true"),S(z.user),w(!0),h("")):(u(""),h(""),n&&n(z.user),e&&e()):x(z.error||"Login fehlgeschlagen. Bitte versuchen Sie es erneut.")}catch(z){console.error("Login error:",z),x("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{y(!1)}},L=M=>{localStorage.removeItem("bewerbungstrainer_demo_pending"),c&&c(M),u(""),h(""),w(!1),n&&k&&n(k),e&&e()},V=async()=>{localStorage.removeItem("bewerbungstrainer_demo_pending");try{r&&await r()}catch(M){console.error("[LOGIN] Error logging out demo user:",M)}w(!1),S(null),u(""),h("")},D=()=>{x(""),u(""),h(""),e&&e()},A=M=>{M.target===M.currentTarget&&D()};if(ur.useEffect(()=>{const M=z=>{z.key==="Escape"&&t&&D()};return document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)},[t]),!t)return null;const F={width:"100%",padding:"12px 16px",fontSize:"15px",border:"1px solid #e2e8f0",borderRadius:"12px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},B={borderColor:b,boxShadow:`0 0 0 3px ${T}`,backgroundColor:"#ffffff"};return s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:A,role:"dialog","aria-modal":"true","aria-labelledby":"login-modal-title",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:C,color:_},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{id:"login-modal-title",className:"text-xl font-semibold",style:{color:_},children:"Anmelden"}),s.jsx("button",{onClick:D,className:"p-2 rounded-xl transition-colors",style:{color:_,backgroundColor:"transparent"},onMouseEnter:M=>M.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:M=>M.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l&&s.jsx("div",{className:"mt-4 mb-2 flex justify-center",children:s.jsx("img",{src:l,alt:`${a} Logo`,style:{height:"8.5rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("p",{className:"text-sm mt-1",style:{color:_,opacity:.8},children:["Bei ",a," anmelden"]})]}),s.jsxs("form",{onSubmit:N,className:"p-6 space-y-5",children:[m&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:m})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Benutzername oder E-Mail"}),s.jsx("input",{type:"text",id:"login-username",value:d,onChange:M=>u(M.target.value),style:F,onFocus:M=>Object.assign(M.target.style,B),onBlur:M=>{M.target.style.borderColor="#e2e8f0",M.target.style.boxShadow="none",M.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Benutzername",disabled:g,autoComplete:"username",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort"}),s.jsx("input",{type:"password",id:"login-password",value:p,onChange:M=>h(M.target.value),style:F,onFocus:M=>Object.assign(M.target.style,B),onBlur:M=>{M.target.style.borderColor="#e2e8f0",M.target.style.boxShadow="none",M.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Passwort",disabled:g,autoComplete:"current-password"})]}),s.jsx("button",{type:"submit",disabled:g,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:E,background:g?"#94a3b8":j,border:"none",borderRadius:"12px",cursor:g?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:g?.7:1,boxShadow:g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:M=>{g||(M.target.style.transform="translateY(-1px)",M.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:M=>{M.target.style.transform="translateY(0)",M.target.style.boxShadow=g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:g?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:E,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:E,fontSize:"16px",fontWeight:600},children:"Wird angemeldet..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:E,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),s.jsx("span",{style:{color:E,fontSize:"16px",fontWeight:600},children:"Anmelden"})]})}),s.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:"Verwenden Sie Ihre WordPress-Zugangsdaten zur Anmeldung."})]})]}),s.jsx(V4,{isOpen:v,onClose:V,onSuccess:L})]})}function H4({isOpen:t,onClose:e,onAcknowledge:n}){const{branding:i,partnerName:r}=Fe(),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),[p,h]=f.useState(""),m=i?.["--primary-accent"]||"#3A7FA7",x=i?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",g=i?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",y=i?.["--header-text"]||"#ffffff",v=i?.["--sidebar-text-color"]||"#ffffff";f.useEffect(()=>{t&&w()},[t]);const w=async()=>{try{const j=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",T=await(await fetch(`${j}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();T.success&&T.disclaimer&&c(T.disclaimer)}catch(j){console.error("[DISCLAIMER] Error fetching status:",j),h("Fehler beim Laden des Hinweises")}},k=async()=>{if(l){u(!0),h("");try{const j=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",T=await(await fetch(`${j}/disclaimer/acknowledge`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin",body:JSON.stringify({disclaimer_id:l.id,dont_show_again:o})})).json();T.success?(n&&n(o),e&&e()):h(T.message||"Fehler bei der Besttigung")}catch(j){console.error("[DISCLAIMER] Error acknowledging:",j),h("Ein Fehler ist aufgetreten")}finally{u(!1)}}},S=j=>{j.stopPropagation()};if(f.useEffect(()=>{const j=C=>{C.key==="Escape"&&t&&C.preventDefault()};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[t]),!t||!l)return null;const b=j=>j?j.split(`
`).map((C,T)=>C.trim()?s.jsx("p",{className:"mb-3 last:mb-0",children:C},T):null):null;return s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",style:{zIndex:99999},onClick:S,role:"dialog","aria-modal":"true","aria-labelledby":"disclaimer-modal-title",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full flex flex-col",style:{maxHeight:"min(85vh, 600px)",maxWidth:"520px",width:"100%"},children:[s.jsx("div",{className:"px-4 sm:px-6 py-4 flex-shrink-0 rounded-t-2xl",style:{background:g,color:y},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-xl hidden sm:flex",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:s.jsx(wi,{className:"w-5 h-5",style:{color:y}})}),s.jsxs("div",{children:[s.jsx("h2",{id:"disclaimer-modal-title",className:"text-lg sm:text-xl font-semibold",style:{color:y},children:l.title}),s.jsxs("p",{className:"text-xs sm:text-sm mt-0.5",style:{color:y,opacity:.8},children:["Version ",l.version]})]})]})}),s.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto flex-1",children:[p&&s.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx(yn,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:p})]}),s.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4 overflow-y-auto",style:{maxHeight:"180px"},children:s.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:b(l.content)})}),s.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 p-3 sm:p-4 bg-blue-50 rounded-xl border border-blue-100 mb-4",children:[s.jsx(mn,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 flex-shrink-0 mt-0.5"}),s.jsxs("p",{className:"text-xs sm:text-sm text-blue-700",children:["Mit der Besttigung akzeptieren Sie diese Nutzungshinweise fr ",r,"."]})]}),s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group mb-4 sm:mb-5",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",checked:o,onChange:j=>a(j.target.checked),className:"sr-only"}),s.jsx("div",{className:"w-5 h-5 rounded border-2 transition-all flex items-center justify-center",style:{borderColor:o?m:"#cbd5e1",backgroundColor:o?m:"transparent"},children:o&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),s.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900 transition-colors",children:"Diesen Hinweis nicht mehr anzeigen"})]}),s.jsx("button",{onClick:k,disabled:d,style:{width:"100%",padding:"12px 20px",fontSize:"15px",fontWeight:600,color:v,background:d?"#94a3b8":x,border:"none",borderRadius:"12px",cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:d?.7:1,boxShadow:d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:j=>{d||(j.target.style.transform="translateY(-1px)",j.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:j=>{j.target.style.transform="translateY(0)",j.target.style.boxShadow=d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:d?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"18px",height:"18px",color:v,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Wird gespeichert..."})]}):s.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Verstanden"})}),s.jsx("p",{className:"text-xs text-center text-gray-500 mt-3",children:o?"Sie werden diesen Hinweis bei zuknftigen Anmeldungen nicht mehr sehen.":"Dieser Hinweis wird bei jeder Anmeldung angezeigt."})]})]}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]})}function q4(){const[t,e]=f.useState(!1),[n,i]=f.useState(!1),[r,o]=f.useState(!1);return{isOpen:t,needsDisclaimer:n,isChecking:r,openDisclaimerModal:()=>e(!0),closeDisclaimerModal:()=>{e(!1),i(!1)},checkDisclaimerStatus:async()=>{o(!0);try{const d=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",p=await(await fetch(`${d}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();if(p.success){const h=p.needs_acknowledgment;return i(h),h&&e(!0),h}return!1}catch(d){return console.error("[DISCLAIMER] Error checking status:",d),!1}finally{o(!1)}}}}const ie={HOME:"/",OVERVIEW:"/uebersicht",LIVE_TRAINING:"/live-training",LIVE_TRAINING_SETUP:"/live-training/vorbereitung",LIVE_TRAINING_DEVICES:"/live-training/geraete",LIVE_TRAINING_SESSION:"/live-training/session",LIVE_TRAINING_PROXY:"/live-training/session-proxy",SCENARIO_TRAINING:"/szenario-training",VIDEO_TRAINING:"/wirkungs-analyse",SMART_BRIEFING:"/smart-briefing",RHETORIK_GYM:"/rhetorik-gym",RHETORIK_GYM_SESSION:"/rhetorik-gym/session",HISTORY:"/verlauf",SESSION_DETAIL:"/verlauf/:sessionType/:sessionId",USAGE_LIMITS:"/nutzung",ADMIN:"/admin",ADMIN_ROLEPLAYS:"/admin/szenarien",ADMIN_SIMULATOR:"/admin/simulator",ADMIN_VIDEO:"/admin/video",ADMIN_PARTNERS:"/admin/partner"},K4={overview:ie.OVERVIEW,dashboard:ie.LIVE_TRAINING,roleplay_variables:ie.LIVE_TRAINING_SETUP,roleplay_device_setup:ie.LIVE_TRAINING_DEVICES,roleplay:ie.LIVE_TRAINING_SESSION,roleplay_proxy:ie.LIVE_TRAINING_PROXY,simulator:ie.SCENARIO_TRAINING,video_training:ie.VIDEO_TRAINING,smart_briefing:ie.SMART_BRIEFING,history:ie.HISTORY,session_detail:ie.SESSION_DETAIL,usage_limits:ie.USAGE_LIMITS,gym:ie.RHETORIK_GYM,gym_klassiker:ie.RHETORIK_GYM,gym_session:ie.RHETORIK_GYM_SESSION,admin:ie.ADMIN,admin_roleplays:ie.ADMIN_ROLEPLAYS,admin_simulator:ie.ADMIN_SIMULATOR,admin_video:ie.ADMIN_VIDEO,admin_partners:ie.ADMIN_PARTNERS},Um={[ie.HOME]:"overview",[ie.OVERVIEW]:"overview",[ie.LIVE_TRAINING]:"dashboard",[ie.LIVE_TRAINING_SETUP]:"dashboard",[ie.LIVE_TRAINING_DEVICES]:"dashboard",[ie.LIVE_TRAINING_SESSION]:"dashboard",[ie.LIVE_TRAINING_PROXY]:"dashboard",[ie.SCENARIO_TRAINING]:"simulator",[ie.VIDEO_TRAINING]:"video_training",[ie.SMART_BRIEFING]:"smart_briefing",[ie.RHETORIK_GYM]:"gym_klassiker",[ie.RHETORIK_GYM_SESSION]:"gym_klassiker",[ie.HISTORY]:"history",[ie.USAGE_LIMITS]:"usage_limits",[ie.ADMIN]:"admin",[ie.ADMIN_ROLEPLAYS]:"admin_roleplays",[ie.ADMIN_SIMULATOR]:"admin_simulator",[ie.ADMIN_VIDEO]:"admin_video",[ie.ADMIN_PARTNERS]:"admin_partners"};function J4(t){return Um[t]?Um[t]:t.startsWith("/verlauf/")?"history":"overview"}function Y4({onNavigate:t}){const e=[{id:"admin_roleplays",title:"Live-Simulationen",description:"Verwalten Sie Szenarien fr Live-Voice-Interviews mit KI-Gesprchspartnern.",icon:Le,color:"text-blue-600",bgColor:"bg-blue-50",stats:null},{id:"admin_simulator",title:"Szenario-Training",description:"Konfigurieren Sie strukturierte Trainingsszenarien mit Fragen und Feedback.",icon:$e,color:"text-green-600",bgColor:"bg-green-50",stats:null},{id:"admin_video",title:"Wirkungs-Analyse",description:"Verwalten Sie Video-basierte Wirkungs-Analysen und bungen.",icon:pt,color:"text-purple-600",bgColor:"bg-purple-50",stats:null},{id:"admin_partners",title:"Partner-Branding",description:"White-Label Partner verwalten: Farben, Logos und Modul-Zugriff.",icon:Nn,color:"text-orange-600",bgColor:"bg-orange-50",stats:null}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[s.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 shadow-lg",children:s.jsx(wi,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[var(--text-main)]",children:"Administration"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:"Verwalten Sie Szenarien, Trainings und Partner-Konfigurationen"})]})]}),s.jsx(ht,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(ii,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Admin-Bereich"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Dieser Bereich ist nur fr WordPress-Administratoren sichtbar. Hier knnen Sie alle Inhalte und Konfigurationen der Plattform verwalten."})]})]})})}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.map(n=>s.jsx(ht,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-[var(--primary-accent)] group",onClick:()=>t(n.id),children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:`p-3 rounded-xl ${n.bgColor} transition-transform group-hover:scale-110`,children:s.jsx(n.icon,{className:`w-6 h-6 ${n.color}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)] group-hover:text-[var(--primary-accent)] transition-colors",children:n.title}),s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mt-1",children:n.description})]})]}),s.jsx(Xt,{className:"w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--primary-accent)] group-hover:translate-x-1 transition-all"})]})})},n.id))}),s.jsxs(ht,{children:[s.jsxs(Cs,{children:[s.jsx(js,{className:"text-lg",children:"Schnellaktionen"}),s.jsx(gv,{children:"Hufig verwendete Admin-Funktionen"})]}),s.jsx(zt,{children:s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs(he,{variant:"outline",onClick:()=>t("admin_roleplays"),className:"flex items-center gap-2",children:[s.jsx(Le,{className:"w-4 h-4"}),"Neues Roleplay erstellen"]}),s.jsxs(he,{variant:"outline",onClick:()=>t("admin_partners"),className:"flex items-center gap-2",children:[s.jsx(Nn,{className:"w-4 h-4"}),"Neuen Partner anlegen"]})]})})]})]})}const jn=f.forwardRef(({className:t,type:e,...n},i)=>s.jsx("input",{type:e,className:pe("flex h-11 w-full rounded-xl border-2 bg-white px-4 py-2 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","file:border-0 file:bg-ocean-blue-50 file:text-ocean-blue-700 file:text-sm file:font-medium file:mr-4 file:px-4 file:py-2 file:rounded-lg","hover:border-slate-300","transition-all duration-200",t),ref:i,...n}));jn.displayName="Input";const Gs=f.forwardRef(({className:t,...e},n)=>s.jsx("textarea",{className:pe("flex min-h-[100px] w-full rounded-xl border-2 bg-white px-4 py-3 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","hover:border-slate-300","resize-none","transition-all duration-200",t),ref:n,...e}));Gs.displayName="Textarea";function as({title:t,subtitle:e,icon:n,accentColor:i="blue",children:r,defaultExpanded:o=!1,badge:a}){const[l,c]=f.useState(o),[d,u]=f.useState(!1),p={blue:{headerBg:"#e0f2fe",headerBgHover:"#bae6fd",iconBg:"#ffffff",iconText:"#0284c7",titleText:"#075985"},green:{headerBg:"#d1fae5",headerBgHover:"#a7f3d0",iconBg:"#ffffff",iconText:"#059669",titleText:"#065f46"},purple:{headerBg:"#ede9fe",headerBgHover:"#ddd6fe",iconBg:"#ffffff",iconText:"#7c3aed",titleText:"#5b21b6"},orange:{headerBg:"#fef3c7",headerBgHover:"#fde68a",iconBg:"#ffffff",iconText:"#d97706",titleText:"#92400e"},teal:{headerBg:"#ccfbf1",headerBgHover:"#99f6e4",iconBg:"#ffffff",iconText:"#0d9488",titleText:"#115e59"}},h=p[i]||p.blue,m={width:"100%",display:"block",backgroundColor:"#ffffff",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",marginBottom:"0"},x={width:"100%",display:"block",backgroundColor:d?h.headerBgHover:h.headerBg,transition:"background-color 0.2s ease",border:"none",margin:0,padding:0},g={width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",textAlign:"left",cursor:"pointer",border:"none",background:"none",backgroundColor:"transparent",margin:0,outline:"none",fontFamily:"inherit"},y={width:"36px",height:"36px",minWidth:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:h.iconBg,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},v={flex:1,minWidth:0,overflow:"hidden"},w={fontWeight:600,fontSize:"14px",lineHeight:"1.4",display:"block",color:h.titleText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",margin:0,padding:0},k={fontSize:"12px",lineHeight:"1.4",color:"#64748b",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginTop:"2px",padding:0},S={fontSize:"12px",fontWeight:500,color:"#64748b",backgroundColor:"rgba(255,255,255,0.9)",padding:"4px 10px",borderRadius:"9999px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},b={padding:"12px 16px 16px 16px",borderTop:"1px solid #f1f5f9",backgroundColor:"rgba(248, 250, 252, 0.5)"};return s.jsxs(P.div,{style:m,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[s.jsx("div",{style:x,children:s.jsxs("button",{type:"button",onClick:()=>c(!l),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:g,children:[n&&s.jsx("div",{style:y,children:s.jsx(n,{style:{width:"20px",height:"20px",color:h.iconText}})}),s.jsxs("div",{style:v,children:[s.jsx("span",{style:w,children:t}),e&&s.jsx("span",{style:k,children:e})]}),a&&s.jsx("span",{style:S,children:a})]})}),s.jsx(He,{children:l&&s.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsx("div",{style:b,children:r})})})]})}function Iv({children:t,className:e}){const n={display:"flex",flexDirection:"column",gap:"12px",width:"100%"};return s.jsx("div",{style:n,className:e,children:t})}function X4({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[p,h]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,w]=f.useState(!1),[k,S]=f.useState({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),[b,j]=f.useState(null);f.useEffect(()=>{C()},[]);const C=async()=>{try{r(!0),a(null);const U=await me.adminGetRoleplayScenarios();if(U.success)n(U.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(U){a(U.message),T("error","Fehler beim Laden der Szenarien")}finally{r(!1)}},T=(U,W)=>{j({type:U,message:W}),setTimeout(()=>j(null),4e3)},_=()=>{S({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),u(!0)},E=U=>{y(U),S({title:U.title||"",description:U.description||"",agent_id:U.agent_id||"",initial_message:U.initial_message||"",difficulty:U.difficulty||"medium",status:U.status||"draft",coaching_hints:U.coaching_hints||"",interviewer_profile:{name:U.interviewer_profile?.name||"",role:U.interviewer_profile?.role||"",properties:U.interviewer_profile?.properties||""}}),h(!0)},N=U=>{y(U),x(!0)},L=async()=>{if(!k.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(w(!0),(await me.adminCreateRoleplayScenario(k)).success)T("success","Szenario erfolgreich erstellt"),u(!1),C();else throw new Error("Fehler beim Erstellen")}catch(U){T("error",U.message)}finally{w(!1)}},V=async()=>{if(!k.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(w(!0),(await me.adminUpdateRoleplayScenario(g.id,k)).success)T("success","Szenario erfolgreich aktualisiert"),h(!1),C();else throw new Error("Fehler beim Aktualisieren")}catch(U){T("error",U.message)}finally{w(!1)}},D=async()=>{try{if(w(!0),(await me.adminDeleteRoleplayScenario(g.id)).success)T("success","Szenario erfolgreich gelscht"),x(!1),C();else throw new Error("Fehler beim Lschen")}catch(U){T("error",U.message)}finally{w(!1)}},A=e.filter(U=>U.title?.toLowerCase().includes(l.toLowerCase())||U.description?.toLowerCase().includes(l.toLowerCase())),F=U=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[U]||U,B=U=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[U]||"bg-gray-100 text-gray-700",M=U=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[U]||U,z=U=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[U]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[b&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?s.jsx(Jt,{className:"w-5 h-5"}):s.jsx(Te,{className:"w-5 h-5"}),b.message,s.jsx("button",{onClick:()=>j(null),className:"ml-2 hover:opacity-80",children:s.jsx(rn,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(he,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(Rt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(Le,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Live-Simulationen (Roleplays)"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]}),s.jsxs(he,{onClick:_,className:"flex items-center gap-2",children:[s.jsx(An,{className:"w-4 h-4"}),"Neues Szenario"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(jn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:U=>c(U.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ge,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(ht,{className:"border-red-200 bg-red-50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(Te,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(he,{variant:"outline",size:"sm",onClick:C,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:A.length===0?s.jsx(ht,{children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Le,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsx(he,{onClick:_,className:"mt-4",children:"Erstes Szenario erstellen"})]})})}):A.map(U=>s.jsx(ht,{className:"hover:shadow-md transition-shadow",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:U.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${z(U.status)}`,children:M(U.status)}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${B(U.difficulty)}`,children:F(U.difficulty)})]}),U.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:U.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[U.agent_id&&s.jsxs("span",{children:["Agent: ",U.agent_id.substring(0,12),"..."]}),s.jsxs("span",{children:["ID: ",U.id]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>E(U),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(mu,{className:"w-4 h-4"})}),s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>N(U),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(Pt,{className:"w-4 h-4"})})]})]})})},U.id))}),s.jsx(En,{open:d,onOpenChange:u,children:s.jsxs(Rn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Neues Szenario erstellen"}),s.jsx(Vn,{children:"Erstellen Sie ein neues Roleplay-Szenario fr Live-Simulationen."})]}),s.jsx(Wm,{formData:k,setFormData:S}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(he,{onClick:L,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(En,{open:p,onOpenChange:h,children:s.jsxs(Rn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Szenario bearbeiten"}),s.jsx(Vn,{children:"Bearbeiten Sie das ausgewhlte Roleplay-Szenario."})]}),s.jsx(Wm,{formData:k,setFormData:S}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>h(!1),children:"Abbrechen"}),s.jsxs(he,{onClick:V,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(En,{open:m,onOpenChange:x,children:s.jsxs(Rn,{children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Szenario lschen"}),s.jsxs(Vn,{children:['Sind Sie sicher, dass Sie das Szenario "',g?.title,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),s.jsxs(he,{variant:"destructive",onClick:D,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function Wm({formData:t,setFormData:e}){return s.jsxs(Iv,{children:[s.jsx(as,{title:"Grundinformationen",subtitle:"Titel, Beschreibung und Basiseinstellungen",icon:Gt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Titel ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(jn,{value:t.title,onChange:n=>e({...t,title:n.target.value}),placeholder:"z.B. Vorstellungsgesprch IT-Consultant"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(Gs,{value:t.description,onChange:n=>e({...t,description:n.target.value}),placeholder:"Kurze Beschreibung des Szenarios...",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:n=>e({...t,status:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Verffentlicht"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Schwierigkeit"}),s.jsxs("select",{value:t.difficulty,onChange:n=>e({...t,difficulty:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"easy",children:"Einfach"}),s.jsx("option",{value:"medium",children:"Mittel"}),s.jsx("option",{value:"hard",children:"Schwer"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"ElevenLabs Agent ID"}),s.jsx(jn,{value:t.agent_id,onChange:n=>e({...t,agent_id:n.target.value}),placeholder:"agent_xxx..."}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Die Agent ID aus Ihrem ElevenLabs Dashboard"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Erste Nachricht"}),s.jsx(Gs,{value:t.initial_message,onChange:n=>e({...t,initial_message:n.target.value}),placeholder:"Die erste Nachricht des KI-Gesprchspartners...",rows:3}),s.jsxs("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:["Platzhalter: ","{{user_name}}",", ","{{company_name}}",", ","{{position}}"]})]})]})}),s.jsx(as,{title:"Gesprchspartner-Profil",subtitle:"Name, Rolle und Eigenschaften des KI-Interviewers",icon:Et,accentColor:"teal",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),s.jsx(jn,{value:t.interviewer_profile.name,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,name:n.target.value}}),placeholder:"z.B. Dr. Maria Schmidt"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rolle/Position"}),s.jsx(jn,{value:t.interviewer_profile.role,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,role:n.target.value}}),placeholder:"z.B. HR-Leiterin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Eigenschaften"}),s.jsx(Gs,{value:t.interviewer_profile.properties,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,properties:n.target.value}}),placeholder:"Charaktereigenschaften (eine pro Zeile)...",rows:3})]})]})}),s.jsx(as,{title:"Erweiterte Einstellungen",subtitle:"Coaching-Hinweise und zustzliche Konfiguration",icon:ii,accentColor:"purple",children:s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Coaching-Hinweise"}),s.jsx(Gs,{value:t.coaching_hints,onChange:n=>e({...t,coaching_hints:n.target.value}),placeholder:"Tipps fr den Benutzer whrend des Gesprchs (eine pro Zeile)...",rows:4}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Diese Hinweise werden im Live-Coaching-Panel angezeigt"})]})})})]})}function Z4({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await me.adminGetSimulatorScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),p=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,h=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(he,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(Rt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:s.jsx($e,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Szenario-Training"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(ht,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(mn,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Szenario-Training-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(he,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=simulator_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(qs,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(jn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ge,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(ht,{className:"border-red-200 bg-red-50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(Te,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(he,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(ht,{children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx($e,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsxs(he,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=simulator_scenario","_blank"),children:[s.jsx(qs,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>s.jsx(ht,{className:"hover:shadow-md transition-shadow",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${h(g.status)}`,children:p(g.status)}),g.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&s.jsxs("span",{children:["Kategorie: ",g.category]}),g.questions_count&&s.jsxs("span",{children:[g.questions_count," Fragen"]}),s.jsxs("span",{children:["ID: ",g.id]})]})]}),s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(qs,{className:"w-4 h-4"})})]})})},g.id))})]})}function Q4({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await me.adminGetVideoTrainingScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),p=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,h=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(he,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(Rt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:s.jsx(pt,{className:"w-6 h-6 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Wirkungs-Analyse"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(ht,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(mn,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Wirkungs-Analyse-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(he,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=video_training_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(qs,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(jn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ge,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(ht,{className:"border-red-200 bg-red-50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(Te,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(he,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(ht,{children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(pt,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Wirkungs-Analyse-Szenarien vorhanden"}),!l&&s.jsxs(he,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=video_training_scenario","_blank"),children:[s.jsx(qs,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>s.jsx(ht,{className:"hover:shadow-md transition-shadow",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${h(g.status)}`,children:p(g.status)}),g.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&s.jsxs("span",{children:["Kategorie: ",g.category]}),s.jsxs("span",{children:["ID: ",g.id]})]})]}),s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(qs,{className:"w-4 h-4"})})]})})},g.id))})]})}const eD=[{id:"overview",label:"bersicht"},{id:"dashboard",label:"Dashboard"},{id:"roleplay",label:"Live-Simulation (Roleplay)"},{id:"simulator",label:"Szenario-Training (Simulator)"},{id:"video_training",label:"Wirkungs-Analyse"},{id:"gym",label:"Rhetorik-Gym (Game)"},{id:"history",label:"Verlauf / History"}],Ut={"--app-bg-start":"#f8fafc","--app-bg-mid":"#eff6ff","--app-bg-end":"#f0fdfa","--card-bg-color":"#ffffff","--sidebar-bg-color":"#ffffff","--sidebar-text-color":"#0f172a","--sidebar-text-muted":"#64748b","--sidebar-active-bg":"#E8F4F8","--sidebar-active-text":"#2D6485","--primary-accent":"#3A7FA7","--primary-accent-hover":"#2D6485","--button-solid":"#3A7FA7","--button-text":"#ffffff","--header-gradient-start":"#3A7FA7","--header-gradient-end":"#3DA389","--header-text":"#ffffff","--icon-primary":"#3A7FA7","--icon-secondary":"#3DA389","--icon-muted":"#94a3b8","--text-main":"#0f172a","--text-secondary":"#475569","--text-muted":"#94a3b8","--border-color":"#e2e8f0","--border-color-light":"#f1f5f9","--focus-ring":"rgba(58, 127, 167, 0.3)"},tD=[{id:"app",title:"App / Allgemein",subtitle:"Hintergrundfarben der Anwendung",accentColor:"blue",iconName:"Layout",fields:[{key:"--app-bg-start",label:"App Hintergrund (Start)",type:"color"},{key:"--app-bg-mid",label:"App Hintergrund (Mitte)",type:"color"},{key:"--app-bg-end",label:"App Hintergrund (Ende)",type:"color"},{key:"--card-bg-color",label:"Karten Hintergrund",type:"color"}]},{id:"sidebar",title:"Sidebar",subtitle:"Farben der Seitennavigation",accentColor:"teal",iconName:"PanelLeft",fields:[{key:"--sidebar-bg-color",label:"Sidebar Hintergrund",type:"color"},{key:"--sidebar-text-color",label:"Sidebar Text",type:"color"},{key:"--sidebar-text-muted",label:"Sidebar Text (gedmpft)",type:"color"},{key:"--sidebar-active-bg",label:"Sidebar Aktiv Hintergrund",type:"color"},{key:"--sidebar-active-text",label:"Sidebar Aktiv Text",type:"color"}]},{id:"accent",title:"Akzentfarben",subtitle:"Primre Markenfarben",accentColor:"purple",iconName:"Sparkles",fields:[{key:"--primary-accent",label:"Primrfarbe",type:"color"},{key:"--primary-accent-hover",label:"Primrfarbe (Hover)",type:"color"}]},{id:"buttons",title:"Buttons",subtitle:"Schaltflchenfarben",accentColor:"green",iconName:"Square",fields:[{key:"--button-solid",label:"Button Farbe",type:"color"},{key:"--button-text",label:"Button Text",type:"color"}]},{id:"header",title:"Header",subtitle:"Kopfzeilenfarben",accentColor:"orange",iconName:"PanelTop",fields:[{key:"--header-gradient-start",label:"Header Gradient (Start)",type:"color"},{key:"--header-gradient-end",label:"Header Gradient (Ende)",type:"color"},{key:"--header-text",label:"Header Text",type:"color"}]},{id:"icons",title:"Icons",subtitle:"Symbolfarben",accentColor:"blue",iconName:"Shapes",fields:[{key:"--icon-primary",label:"Icon Primr",type:"color"},{key:"--icon-secondary",label:"Icon Sekundr",type:"color"},{key:"--icon-muted",label:"Icon (gedmpft)",type:"color"}]},{id:"text",title:"Text",subtitle:"Textfarben",accentColor:"teal",iconName:"Type",fields:[{key:"--text-main",label:"Text Hauptfarbe",type:"color"},{key:"--text-secondary",label:"Text Sekundr",type:"color"},{key:"--text-muted",label:"Text (gedmpft)",type:"color"}]},{id:"borders",title:"Rahmen & Focus",subtitle:"Rahmen- und Fokusfarben",accentColor:"purple",iconName:"Frame",fields:[{key:"--border-color",label:"Rahmenfarbe",type:"color"},{key:"--border-color-light",label:"Rahmenfarbe (hell)",type:"color"},{key:"--focus-ring",label:"Focus Ring",type:"color"}]}],nD={Layout:Kj,PanelLeft:Gj,Sparkles:It,Square:fs,PanelTop:qj,Shapes:Yj,Type:eT,Frame:Pj};function iD({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[p,h]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,w]=f.useState(!1),[k,S]=f.useState({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Ut}}),[b,j]=f.useState(null);f.useEffect(()=>{C()},[]);const C=async()=>{try{r(!0),a(null);const z=await me.adminGetPartners();if(z.success)n(z.data||[]);else throw new Error("Fehler beim Laden der Partner")}catch(z){a(z.message),T("error","Fehler beim Laden der Partner")}finally{r(!1)}},T=(z,U)=>{j({type:z,message:U}),setTimeout(()=>j(null),4e3)},_=()=>{S({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Ut}}),u(!0)},E=z=>{y(z),S({name:z.name||"",slug:z.slug||"",description:z.description||"",status:z.status||"draft",modules:z.modules||[],branding:{...Ut,...z.branding}}),h(!0)},N=z=>{y(z),x(!0)},L=async()=>{if(!k.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}const z={...k,slug:k.slug||k.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")};try{if(w(!0),(await me.adminCreatePartner(z)).success)T("success","Partner erfolgreich erstellt"),u(!1),C();else throw new Error("Fehler beim Erstellen")}catch(U){T("error",U.message)}finally{w(!1)}},V=async()=>{if(!k.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}try{if(w(!0),(await me.adminUpdatePartner(g.id,k)).success)T("success","Partner erfolgreich aktualisiert"),h(!1),C();else throw new Error("Fehler beim Aktualisieren")}catch(z){T("error",z.message)}finally{w(!1)}},D=async()=>{try{if(w(!0),(await me.adminDeletePartner(g.id)).success)T("success","Partner erfolgreich gelscht"),x(!1),C();else throw new Error("Fehler beim Lschen")}catch(z){T("error",z.message)}finally{w(!1)}},A=z=>{const U=`${window.location.origin}${window.location.pathname}?partner=${z}`;navigator.clipboard.writeText(U),T("success","URL in Zwischenablage kopiert")},F=e.filter(z=>z.name?.toLowerCase().includes(l.toLowerCase())||z.slug?.toLowerCase().includes(l.toLowerCase())),B=z=>({publish:"Aktiv",draft:"Entwurf",pending:"Ausstehend"})[z]||z,M=z=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[z]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[b&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?s.jsx(Jt,{className:"w-5 h-5"}):s.jsx(Te,{className:"w-5 h-5"}),b.message,s.jsx("button",{onClick:()=>j(null),className:"ml-2 hover:opacity-80",children:s.jsx(rn,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(he,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(Rt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-orange-100",children:s.jsx(Nn,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Partner-Branding"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Partner"]})]})]})]}),s.jsxs(he,{onClick:_,className:"flex items-center gap-2",children:[s.jsx(An,{className:"w-4 h-4"}),"Neuer Partner"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(jn,{placeholder:"Partner durchsuchen...",value:l,onChange:z=>c(z.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ge,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(ht,{className:"border-red-200 bg-red-50",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(Te,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(he,{variant:"outline",size:"sm",onClick:C,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:F.length===0?s.jsx(ht,{children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Nn,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Partner gefunden":"Noch keine Partner vorhanden"}),!l&&s.jsx(he,{onClick:_,className:"mt-4",children:"Ersten Partner erstellen"})]})})}):F.map(z=>s.jsx(ht,{className:"hover:shadow-md transition-shadow",children:s.jsx(zt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg border shadow-sm",style:{background:z.branding?.["--primary-accent"]||Ut["--primary-accent"]}}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:z.name}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${M(z.status)}`,children:B(z.status)})]}),s.jsxs("p",{className:"text-sm text-[var(--text-muted)]",children:["Slug: ",z.slug]})]})]}),z.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-1",children:z.description}),s.jsx("div",{className:"flex items-center gap-2 text-xs text-[var(--text-muted)]",children:z.modules?.length>0?s.jsxs("span",{children:[z.modules.length," Module aktiv"]}):s.jsx("span",{children:"Alle Module aktiv"})})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>A(z.slug),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"URL kopieren",children:s.jsx(Ox,{className:"w-4 h-4"})}),s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>E(z),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(mu,{className:"w-4 h-4"})}),s.jsx(he,{variant:"ghost",size:"sm",onClick:()=>N(z),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(Pt,{className:"w-4 h-4"})})]})]})})},z.id))}),s.jsx(En,{open:d,onOpenChange:u,children:s.jsxs(Rn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Neuen Partner erstellen"}),s.jsx(Vn,{children:"Erstellen Sie einen neuen White-Label Partner mit eigenem Branding."})]}),s.jsx(Vm,{formData:k,setFormData:S}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(he,{onClick:L,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(En,{open:p,onOpenChange:h,children:s.jsxs(Rn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Partner bearbeiten"}),s.jsx(Vn,{children:"Bearbeiten Sie die Konfiguration des ausgewhlten Partners."})]}),s.jsx(Vm,{formData:k,setFormData:S}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>h(!1),children:"Abbrechen"}),s.jsxs(he,{onClick:V,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(En,{open:m,onOpenChange:x,children:s.jsxs(Rn,{children:[s.jsxs(In,{children:[s.jsx(_n,{children:"Partner lschen"}),s.jsxs(Vn,{children:['Sind Sie sicher, dass Sie den Partner "',g?.name,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(Wn,{children:[s.jsx(he,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),s.jsxs(he,{variant:"destructive",onClick:D,disabled:v,children:[v&&s.jsx(ge,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function sD({label:t,value:e,defaultValue:n,onChange:i}){const o=e?.startsWith("rgba")||n?.startsWith("rgba")?"#3A7FA7":e||n||"#000000";return s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"color",value:o,onChange:a=>i(a.target.value),className:"w-10 h-8 rounded border cursor-pointer"}),s.jsx(jn,{value:e||"",onChange:a=>i(a.target.value),placeholder:n,className:"flex-1 text-xs"})]})]})}function rD({branding:t}){const e=t?.["--app-bg-start"]||Ut["--app-bg-start"],n=t?.["--app-bg-mid"]||Ut["--app-bg-mid"],i=t?.["--app-bg-end"]||Ut["--app-bg-end"],r=t?.["--card-bg-color"]||Ut["--card-bg-color"],o=t?.["--header-gradient-start"]||Ut["--header-gradient-start"],a=t?.["--header-gradient-end"]||Ut["--header-gradient-end"],l=t?.["--header-text"]||Ut["--header-text"],c=t?.["--text-main"]||Ut["--text-main"],d=t?.["--text-secondary"]||Ut["--text-secondary"],u=t?.["--button-solid"]||Ut["--button-solid"],p=t?.["--button-text"]||Ut["--button-text"],h=t?.["--border-color"]||Ut["--border-color"];return s.jsxs("div",{className:"rounded-lg p-4 mb-4",style:{background:`linear-gradient(135deg, ${e} 0%, ${n} 50%, ${i} 100%)`},children:[s.jsx("div",{className:"rounded-t-lg px-3 py-2 mb-2",style:{background:`linear-gradient(135deg, ${o} 0%, ${a} 100%)`},children:s.jsx("span",{className:"text-xs font-medium",style:{color:l},children:"Header Vorschau"})}),s.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:r,border:`1px solid ${h}`},children:[s.jsx("p",{className:"text-sm font-medium mb-1",style:{color:c},children:"Karten-Titel"}),s.jsx("p",{className:"text-xs mb-3",style:{color:d},children:"Sekundrer Text"}),s.jsx("button",{type:"button",className:"px-3 py-1.5 rounded text-xs font-medium",style:{backgroundColor:u,color:p},children:"Button"})]})]})}function Vm({formData:t,setFormData:e}){const n=r=>{const o=t.modules||[];o.includes(r)?e({...t,modules:o.filter(a=>a!==r)}):e({...t,modules:[...o,r]})},i=(r,o)=>{e({...t,branding:{...t.branding,[r]:o}})};return s.jsxs(Iv,{children:[s.jsx(as,{title:"Grundinformationen",subtitle:"Name, Slug und Status des Partners",icon:Gt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(jn,{value:t.name,onChange:r=>e({...t,name:r.target.value}),placeholder:"z.B. Vertriebsakademie Mller"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Slug (URL-ID)"}),s.jsx(jn,{value:t.slug,onChange:r=>e({...t,slug:r.target.value.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}),placeholder:"z.B. vertriebsakademie-mueller"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Wird in der URL verwendet: ?partner=",t.slug||"ihr-slug"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(Gs,{value:t.description,onChange:r=>e({...t,description:r.target.value}),placeholder:"Optionale Beschreibung des Partners...",rows:2})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:r=>e({...t,status:r.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Aktiv"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]})]})}),s.jsx(as,{title:"Erlaubte Module",subtitle:"Welche Funktionen fr diesen Partner verfgbar sind",icon:Lj,accentColor:"green",badge:t.modules?.length>0?`${t.modules.length} ausgewhlt`:"Alle",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Keine Auswahl = Alle Module sind erlaubt"}),s.jsx("div",{className:"space-y-2",children:eD.map(r=>s.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 cursor-pointer transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t.modules?.includes(r.id)||!1,onChange:()=>n(r.id),className:"rounded border-gray-300"}),s.jsx("span",{className:"text-sm",children:r.label})]},r.id))})]})}),s.jsxs(as,{title:"Branding Vorschau",subtitle:"Live-Vorschau der konfigurierten Farben",icon:$j,accentColor:"orange",defaultExpanded:!0,children:[s.jsx(rD,{branding:t.branding}),s.jsx("p",{className:"text-xs text-slate-500 text-center",children:"ndern Sie die Farben in den Sektionen unten"})]}),tD.map(r=>{const o=nD[r.iconName];return s.jsx(as,{title:r.title,subtitle:r.subtitle,icon:o,accentColor:r.accentColor,children:s.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.fields.map(a=>s.jsx(sD,{label:a.label,value:t.branding?.[a.key],defaultValue:Ut[a.key],onChange:l=>i(a.key,l)},a.key))})},r.id)})]})}const oD=()=>s.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",zIndex:9999},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[s.jsx(ge,{style:{width:"48px",height:"48px",color:"#3A7FA7",animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{fontSize:"16px",color:"#64748b",fontWeight:500,margin:0},children:"Trainingscenter wird geladen..."})]}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}),$m=()=>{requestAnimationFrame(()=>{window.scrollTo(0,0);const t=document.getElementById("bewerbungstrainer-app");t&&(t.scrollTop=0);const e=document.querySelector("[data-main-content]");e&&(e.scrollTop=0),document.querySelectorAll('.overflow-y-auto, .overflow-auto, [style*="overflow"]').forEach(i=>{i.scrollTop>0&&(i.scrollTop=0)})})};function aD(){const t=document.getElementById("wpadminbar");return t?t.offsetHeight:0}function lD(){const t=document.getElementById("bewerbungstrainer-app"),e=aD(),n=document.elementFromPoint(window.innerWidth/2,e+10);if(n){let r=n;for(;r&&r!==document.body;){const o=r.tagName?.toLowerCase();if((o==="header"||o==="nav"||r.classList?.contains("site-header")||r.classList?.contains("elementor-location-header")||r.id==="masthead")&&(!t||!t.contains(r))){const c=r.getBoundingClientRect().bottom;return c<=e?e:Math.max(e,c)}r=r.parentElement}}const i=["header.site-header","#masthead",".site-header",".elementor-location-header",'[data-elementor-type="header"]',".ast-header-wrap","#starter-header",".header-wrapper","header"];for(const r of i){const o=document.querySelector(r);if(o&&(!t||!t.contains(o))){const l=o.getBoundingClientRect().bottom;return l<=e?e:Math.max(e,l)}}if(t){let r=t.previousElementSibling;for(;r;){const o=r.getBoundingClientRect();if(o.height>30&&o.top<100){const a=o.bottom;return a<=e?e:Math.max(e,a)}r=r.previousElementSibling}}return e}function cD(){const t=j1(),e=_d(),{isAuthenticated:n,authLoading:i,isLoading:r,demoCode:o}=Fe(),{isAdmin:a}=Rd(),l=J4(e.pathname),[c,d]=f.useState(0),[u,p]=f.useState(null),[h,m]=f.useState({}),[x,g]=f.useState(null),[y,v]=f.useState("websocket"),[w,k]=f.useState(null),[S,b]=f.useState(null),[j,C]=f.useState(null),[T,_]=f.useState(!1),E=()=>_(!0),N=()=>_(!1),{isOpen:L,closeDisclaimerModal:V,checkDisclaimerStatus:D}=q4(),[A,F]=f.useState(null),[B,M]=f.useState(null),[z,U]=f.useState(null),[W,q]=f.useState(null),[le,de]=f.useState(null),[ue,$]=f.useState(null),[Se,xe]=f.useState(null),[Ke,st]=f.useState(0);f.useEffect(()=>{n&&!i&&D()},[n,i]);const Ve=f.useCallback(ee=>{if(ee)switch(ee.type){case"SELECT_ROLEPLAY_SCENARIO":M(ee.scenario),t(ie.LIVE_TRAINING);break;case"SELECT_SIMULATOR_SCENARIO":U(ee.scenario),t(ie.SCENARIO_TRAINING);break;case"START_GYM_GAME":C(ee.config),t(ie.RHETORIK_GYM_SESSION,{state:{gameConfig:ee.config}});break;case"SELECT_GYM_MODE":q(ee.mode),t(ie.RHETORIK_GYM);break;case"SELECT_VIDEO_TRAINING_SCENARIO":de(ee.scenario),t(ie.VIDEO_TRAINING);break;default:console.warn("Unknown pending action type:",ee.type)}},[t]),ft=f.useCallback((ee,De=null)=>n?(ee(),!0):(De&&F(De),E(),!1),[n]);f.useEffect(()=>{const ee=()=>{const J=lD();d(J)},De=(J=0)=>{ee(),J<5&&setTimeout(()=>De(J+1),200)};requestAnimationFrame(()=>{setTimeout(()=>De(),50)});const Ye=()=>setTimeout(ee,100);return window.addEventListener("load",Ye),window.addEventListener("resize",ee),window.addEventListener("scroll",ee,{passive:!0}),()=>{window.removeEventListener("load",Ye),window.removeEventListener("resize",ee),window.removeEventListener("scroll",ee)}},[]),f.useEffect(()=>{$m()},[e.pathname]);const St=f.useCallback(ee=>{$m(),ee==="video_training"&&st(Ye=>Ye+1);const De=K4[ee];t(De||ie.OVERVIEW)},[t]),Ze=f.useCallback(ee=>{p(ee),m({}),g(null),t(ie.LIVE_TRAINING_SETUP,{state:{scenario:ee}})},[t]),Ct=f.useCallback(ee=>{m(ee),t(ie.LIVE_TRAINING_DEVICES,{state:{scenario:u,variables:ee}})},[t,u]),qt=f.useCallback(()=>{p(null),m({}),t(ie.LIVE_TRAINING)},[t]),Ge=f.useCallback(({selectedMicrophoneId:ee,connectionMode:De="websocket"})=>{g(ee),v(De);const Ye=De==="proxy"?ie.LIVE_TRAINING_PROXY:ie.LIVE_TRAINING_SESSION;t(Ye,{state:{scenario:u,variables:h,microphoneId:ee}})},[t,u,h]),Qe=f.useCallback(()=>{g(null),t(ie.LIVE_TRAINING_SETUP,{state:{scenario:u}})},[t,u]),ze=f.useCallback(()=>{p(null),m({}),t(ie.LIVE_TRAINING)},[t]),et=f.useCallback(ee=>{p(null),m({}),k(ee),t(`/verlauf/${ee.type||"roleplay"}/${ee.id}`,{state:{session:ee}})},[t]),se=f.useCallback((ee=null)=>{b(ee),t(ie.HISTORY,{state:{initialTab:ee}})},[t]),Z=f.useCallback(()=>{b(null),t(ie.LIVE_TRAINING)},[t]),re=f.useCallback(ee=>{const Ye={briefings:Wo.BRIEFINGS,simulator:Wo.SIMULATOR,video:Wo.VIDEO,roleplay:Wo.ROLEPLAY}[ee]||null;b(Ye),t(ie.HISTORY,{state:{initialTab:Ye}})},[t]),te=f.useCallback(ee=>{k(ee),t(`/verlauf/${ee.type||"roleplay"}/${ee.id}`,{state:{session:ee}})},[t]),fe=f.useCallback(()=>{k(null),t(ie.HISTORY)},[t]),K=f.useCallback((ee,De)=>{$({session:ee,scenario:De}),t(ie.SCENARIO_TRAINING)},[t]),Q=f.useCallback((ee,De)=>{xe({session:ee,scenario:De}),t(ie.SCENARIO_TRAINING)},[t]),ce=f.useCallback(ee=>{C(ee),t(ie.RHETORIK_GYM_SESSION,{state:{gameConfig:ee}})},[t]),Ee=f.useCallback(()=>{C(null),t(ie.RHETORIK_GYM)},[t]),dt=f.useCallback(ee=>{},[]),tt=f.useCallback(({children:ee})=>a?ee:s.jsx(No,{onNavigate:St}),[a,St]);if(r)return s.jsx(oD,{});const Re=()=>e.state?.scenario||u,mt=()=>e.state?.variables||h,Je=()=>e.state?.microphoneId||x,ji=()=>e.state?.gameConfig||j,xr=()=>e.state?.session||w,Ts=()=>e.state?.initialTab||S,yr=()=>s.jsxs(W1,{children:[s.jsx(gt,{path:"/",element:s.jsx(No,{onNavigate:St})}),s.jsx(gt,{path:ie.OVERVIEW,element:s.jsx(No,{onNavigate:St})}),s.jsx(gt,{path:ie.LIVE_TRAINING,element:s.jsx(PR,{onSelectScenario:Ze,onOpenHistory:se,isAuthenticated:n,requireAuth:ft,setPendingAction:F,pendingScenario:B,clearPendingScenario:()=>M(null),onNavigateToHistory:()=>re("roleplay")})}),s.jsx(gt,{path:ie.LIVE_TRAINING_SETUP,element:s.jsx(XR,{scenario:Re(),onBack:qt,onNext:Ct})}),s.jsx(gt,{path:ie.LIVE_TRAINING_DEVICES,element:s.jsx(KR,{scenario:Re(),onBack:Qe,onStart:Ge})}),s.jsx(gt,{path:ie.LIVE_TRAINING_SESSION,element:s.jsx(_M,{scenario:Re(),variables:mt(),selectedMicrophoneId:Je(),onEnd:ze,onNavigateToSession:et})}),s.jsx(gt,{path:ie.LIVE_TRAINING_PROXY,element:s.jsx(AM,{scenario:Re(),variables:mt(),selectedMicrophoneId:Je(),onEnd:ze,onNavigateToSession:et})}),s.jsx(gt,{path:ie.SCENARIO_TRAINING,element:s.jsx(GP,{isAuthenticated:n,requireAuth:ft,setPendingAction:F,pendingContinueSession:ue,clearPendingContinueSession:()=>$(null),pendingRepeatSession:Se,clearPendingRepeatSession:()=>xe(null),onNavigateToHistory:()=>re("simulator")})}),s.jsx(gt,{path:ie.VIDEO_TRAINING,element:s.jsx(o4,{isAuthenticated:n,requireAuth:ft,setPendingAction:F,pendingScenario:le,clearPendingScenario:()=>de(null),onNavigateToHistory:()=>re("video")},Ke)}),s.jsx(gt,{path:ie.SMART_BRIEFING,element:s.jsx(D4,{isAuthenticated:n,requireAuth:ft,setPendingAction:F,demoCode:o,onNavigateToSimulator:()=>t(ie.SCENARIO_TRAINING),onNavigateToHistory:()=>re("briefings")})}),s.jsx(gt,{path:ie.RHETORIK_GYM,element:s.jsx(l4,{onStartGame:ce,isAuthenticated:n,requireAuth:ft,setPendingAction:F})}),s.jsx(gt,{path:ie.RHETORIK_GYM_SESSION,element:s.jsx(g4,{gameConfig:ji(),onBack:Ee,onComplete:dt})}),s.jsx(gt,{path:ie.HISTORY,element:s.jsx(XM,{onBack:Z,onSelectSession:te,isAuthenticated:n,onLoginClick:E,onContinueSession:K,onRepeatSession:Q,initialTab:Ts(),onNavigateToModule:St})}),s.jsx(gt,{path:"/verlauf/:sessionType/:sessionId",element:s.jsx(_P,{session:xr(),onBack:fe})}),s.jsx(gt,{path:ie.USAGE_LIMITS,element:s.jsx("div",{style:{padding:"24px",maxWidth:"600px",margin:"0 auto"},children:s.jsx(O4,{onNavigateToRoleplay:()=>t(ie.LIVE_TRAINING)})})}),s.jsx(gt,{path:ie.ADMIN,element:s.jsx(tt,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(Y4,{onNavigate:St})})})}),s.jsx(gt,{path:ie.ADMIN_ROLEPLAYS,element:s.jsx(tt,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(X4,{onBack:()=>t(ie.ADMIN)})})})}),s.jsx(gt,{path:ie.ADMIN_SIMULATOR,element:s.jsx(tt,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(Z4,{onBack:()=>t(ie.ADMIN)})})})}),s.jsx(gt,{path:ie.ADMIN_VIDEO,element:s.jsx(tt,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(Q4,{onBack:()=>t(ie.ADMIN)})})})}),s.jsx(gt,{path:ie.ADMIN_PARTNERS,element:s.jsx(tt,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(iD,{onBack:()=>t(ie.ADMIN)})})})}),s.jsx(gt,{path:"*",element:s.jsx(No,{onNavigate:St})})]});return s.jsxs(s.Fragment,{children:[s.jsx(W4,{activeView:l,onNavigate:St,headerOffset:c,onLoginClick:E,children:yr()}),s.jsx(G4,{isOpen:T,onClose:()=>{N(),F(null)},onLoginSuccess:async ee=>{await D(),A&&(Ve(A),F(null))}}),s.jsx(H4,{isOpen:L,onClose:V,onAcknowledge:ee=>{V()}})]})}function dD(){return s.jsx(G1,{children:s.jsx(Hv,{children:s.jsx(B4,{children:s.jsx(cD,{})})})})}let xc=!1,yc=null;function uD(){if(xc)return;const t=document.getElementById("bewerbungstrainer-app")||document.getElementById("root");if(!t){console.error(" Bewerbungstrainer: Root element not found! Looking for #bewerbungstrainer-app or #root");return}if(t._reactRootContainer||t.__reactRoot||yc){console.warn(" Bewerbungstrainer: Root element already has a React root, skipping re-mount..."),xc=!0;return}try{for(;t.firstChild;)t.removeChild(t.firstChild);yc=qv.createRoot(t),yc.render(s.jsx(f.StrictMode,{children:s.jsx(dD,{})})),xc=!0}catch(e){console.error(" Bewerbungstrainer: Failed to mount React app:",e)}}function hD(){const t=()=>{requestAnimationFrame(()=>{try{uD()}catch(e){console.error(" Bewerbungstrainer: Error during mount:",e)}})};if(document.getElementById("bewerbungstrainer-app")||document.getElementById("root")){setTimeout(t,50);return}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>setTimeout(t,50));else{let e=0;const n=50,i=setInterval(()=>{e++,document.getElementById("bewerbungstrainer-app")||document.getElementById("root")?(clearInterval(i),setTimeout(t,50)):e>=n&&(clearInterval(i),console.error(" Bewerbungstrainer: Element not found after 5 seconds"))},100)}}hD();
