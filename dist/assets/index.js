import{r as Hv,g as qv,a as f,R as Vd,j as i,c as J,u as qe,b as ll,D as _e,d as Kv,C as E,M as Ue,V as jt,e as Et,T as gn,w as ce,f as vn,h as At,i as Oi,U as wn,B as jn,k as Jv,l as Yv,I as Xv,Z as Zv,m as Qv,S as e1,F as t1,n as n1,o as i1,p as s1,q as r1,s as Cn,L as me,t as st,v as Jt,x as yt,y as Qt,z as Be,A as Pn,E as de,G as rn,H as Ai,J as Vt,K as li,N as o1,O as Di,P as cl,Q as Oa,W as Sh,X as a1,Y as l1}from"./button-RqG5c3N3.js";var fm=Hv();const c1=qv(fm);function yo(){return yo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},yo.apply(this,arguments)}var ts;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ts||(ts={}));const kh="popstate";function d1(t){t===void 0&&(t={});function e(r,o){let{pathname:a="/",search:l="",hash:c=""}=Us(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),zc("",{pathname:a,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){let a=r.document.querySelector("base"),l="";if(a&&a.getAttribute("href")){let c=r.location.href,d=c.indexOf("#");l=d===-1?c:c.slice(0,d)}return l+"#"+(typeof o=="string"?o:gm(o))}function s(r,o){dl(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return h1(e,n,s,t)}function Nt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dl(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function u1(){return Math.random().toString(36).substr(2,8)}function wh(t,e){return{usr:t.state,key:t.key,idx:e}}function zc(t,e,n,s){return n===void 0&&(n=null),yo({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Us(e):e,{state:n,key:e&&e.key||s||u1()})}function gm(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Us(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function h1(t,e,n,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:o=!1}=s,a=r.history,l=ts.Pop,c=null,d=u();d==null&&(d=0,a.replaceState(yo({},a.state,{idx:d}),""));function u(){return(a.state||{idx:null}).idx}function h(){l=ts.Pop;let y=u(),v=y==null?null:y-d;d=y,c&&c({action:l,location:g.location,delta:v})}function p(y,v){l=ts.Push;let k=zc(g.location,y,v);n&&n(k,y),d=u()+1;let S=wh(k,d),w=g.createHref(k);try{a.pushState(S,"",w)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;r.location.assign(w)}o&&c&&c({action:l,location:g.location,delta:1})}function m(y,v){l=ts.Replace;let k=zc(g.location,y,v);n&&n(k,y),d=u();let S=wh(k,d),w=g.createHref(k);a.replaceState(S,"",w),o&&c&&c({action:l,location:g.location,delta:0})}function x(y){let v=r.location.origin!=="null"?r.location.origin:r.location.href,k=typeof y=="string"?y:gm(y);return k=k.replace(/ $/,"%20"),Nt(v,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,v)}let g={get action(){return l},get location(){return t(r,a)},listen(y){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(kh,h),c=y,()=>{r.removeEventListener(kh,h),c=null}},createHref(y){return e(r,y)},createURL:x,encodeLocation(y){let v=x(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:p,replace:m,go(y){return a.go(y)}};return g}var Ch;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ch||(Ch={}));function p1(t,e,n){return n===void 0&&(n="/"),f1(t,e,n)}function f1(t,e,n,s){let r=typeof e=="string"?Us(e):e,o=ym(r.pathname||"/",n);if(o==null)return null;let a=mm(t);g1(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=E1(o);l=C1(a[c],d)}return l}function mm(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let r=(o,a,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};c.relativePath.startsWith("/")&&(Nt(c.relativePath.startsWith(s),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(s.length));let d=Rs([s,c.relativePath]),u=n.concat(c);o.children&&o.children.length>0&&(Nt(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),mm(o.children,e,u,d)),!(o.path==null&&!o.index)&&e.push({path:d,score:k1(d,o.index),routesMeta:u})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))r(o,a);else for(let c of xm(o.path))r(o,a,c)}),e}function xm(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(s.length===0)return r?[o,""]:[o];let a=xm(s.join("/")),l=[];return l.push(...a.map(c=>c===""?o:[o,c].join("/"))),r&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function g1(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:w1(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const m1=/^:[\w-]+$/,x1=3,y1=2,b1=1,v1=10,S1=-2,jh=t=>t==="*";function k1(t,e){let n=t.split("/"),s=n.length;return n.some(jh)&&(s+=S1),e&&(s+=y1),n.filter(r=>!jh(r)).reduce((r,o)=>r+(m1.test(o)?x1:o===""?b1:v1),s)}function w1(t,e){return t.length===e.length&&t.slice(0,-1).every((s,r)=>s===e[r])?t[t.length-1]-e[e.length-1]:0}function C1(t,e,n){let{routesMeta:s}=t,r={},o="/",a=[];for(let l=0;l<s.length;++l){let c=s[l],d=l===s.length-1,u=o==="/"?e:e.slice(o.length)||"/",h=j1({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:Rs([o,h.pathname]),pathnameBase:D1(Rs([o,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(o=Rs([o,h.pathnameBase]))}return a}function j1(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=T1(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let o=r[0],a=o.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:s.reduce((d,u,h)=>{let{paramName:p,isOptional:m}=u;if(p==="*"){let g=l[h]||"";a=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[h];return m&&!x?d[p]=void 0:d[p]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:a,pattern:t}}function T1(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),dl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function E1(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dl(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function ym(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}const I1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,R1=t=>I1.test(t);function A1(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:r=""}=typeof t=="string"?Us(t):t,o;if(n)if(R1(n))o=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),dl(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+n))}n.startsWith("/")?o=Th(n.substring(1),"/"):o=Th(n,e)}else o=e;return{pathname:o,search:N1(s),hash:z1(r)}}function Th(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Ll(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function _1(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function M1(t,e){let n=_1(t);return e?n.map((s,r)=>r===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function P1(t,e,n,s){s===void 0&&(s=!1);let r;typeof t=="string"?r=Us(t):(r=yo({},t),Nt(!r.pathname||!r.pathname.includes("?"),Ll("?","pathname","search",r)),Nt(!r.pathname||!r.pathname.includes("#"),Ll("#","pathname","hash",r)),Nt(!r.search||!r.search.includes("#"),Ll("#","search","hash",r)));let o=t===""||r.pathname==="",a=o?"/":r.pathname,l;if(a==null)l=n;else{let h=e.length-1;if(!s&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),h-=1;r.pathname=p.join("/")}l=h>=0?e[h]:"/"}let c=A1(r,l),d=a&&a!=="/"&&a.endsWith("/"),u=(o||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const Rs=t=>t.join("/").replace(/\/\/+/g,"/"),D1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),N1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,z1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function L1(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const bm=["post","put","patch","delete"];new Set(bm);const O1=["get",...bm];new Set(O1);function bo(){return bo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},bo.apply(this,arguments)}const Gd=f.createContext(null),B1=f.createContext(null),ul=f.createContext(null),hl=f.createContext(null),Lr=f.createContext({outlet:null,matches:[],isDataRoute:!1}),vm=f.createContext(null);function pl(){return f.useContext(hl)!=null}function Hd(){return pl()||Nt(!1),f.useContext(hl).location}function Sm(t){f.useContext(ul).static||f.useLayoutEffect(t)}function F1(){let{isDataRoute:t}=f.useContext(Lr);return t?Q1():W1()}function W1(){pl()||Nt(!1);let t=f.useContext(Gd),{basename:e,future:n,navigator:s}=f.useContext(ul),{matches:r}=f.useContext(Lr),{pathname:o}=Hd(),a=JSON.stringify(M1(r,n.v7_relativeSplatPath)),l=f.useRef(!1);return Sm(()=>{l.current=!0}),f.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){s.go(d);return}let h=P1(d,JSON.parse(a),o,u.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Rs([e,h.pathname])),(u.replace?s.replace:s.push)(h,u.state,u)},[e,s,a,o,t])}function $1(t,e){return U1(t,e)}function U1(t,e,n,s){pl()||Nt(!1);let{navigator:r}=f.useContext(ul),{matches:o}=f.useContext(Lr),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=Hd(),u;if(e){var h;let y=typeof e=="string"?Us(e):e;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||Nt(!1),u=y}else u=d;let p=u.pathname||"/",m=p;if(c!=="/"){let y=c.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=p1(t,{pathname:m}),g=K1(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:Rs([c,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:Rs([c,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,n,s);return e&&g?f.createElement(hl.Provider,{value:{location:bo({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ts.Pop}},g):g}function V1(){let t=Z1(),e=L1(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},e),n?f.createElement("pre",{style:r},n):null,null)}const G1=f.createElement(V1,null);class H1 extends f.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?f.createElement(Lr.Provider,{value:this.props.routeContext},f.createElement(vm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function q1(t){let{routeContext:e,match:n,children:s}=t,r=f.useContext(Gd);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),f.createElement(Lr.Provider,{value:e},s)}function K1(t,e,n,s){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=s)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(r=n)==null?void 0:r.errors;if(l!=null){let u=a.findIndex(h=>h.route.id&&l?.[h.route.id]!==void 0);u>=0||Nt(!1),a=a.slice(0,Math.min(a.length,u+1))}let c=!1,d=-1;if(n&&s&&s.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(d=u),h.route.id){let{loaderData:p,errors:m}=n,x=h.route.loader&&p[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||x){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((u,h,p)=>{let m,x=!1,g=null,y=null;n&&(m=l&&h.route.id?l[h.route.id]:void 0,g=h.route.errorElement||G1,c&&(d<0&&p===0?(eS("route-fallback"),x=!0,y=null):d===p&&(x=!0,y=h.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,p+1)),k=()=>{let S;return m?S=g:x?S=y:h.route.Component?S=f.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,f.createElement(q1,{match:h,routeContext:{outlet:u,matches:v,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?f.createElement(H1,{location:n.location,revalidation:n.revalidation,component:g,error:m,children:k(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):k()},null)}var km=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(km||{}),wm=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(wm||{});function J1(t){let e=f.useContext(Gd);return e||Nt(!1),e}function Y1(t){let e=f.useContext(B1);return e||Nt(!1),e}function X1(t){let e=f.useContext(Lr);return e||Nt(!1),e}function Cm(t){let e=X1(),n=e.matches[e.matches.length-1];return n.route.id||Nt(!1),n.route.id}function Z1(){var t;let e=f.useContext(vm),n=Y1(),s=Cm();return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function Q1(){let{router:t}=J1(km.UseNavigateStable),e=Cm(wm.UseNavigateStable),n=f.useRef(!1);return Sm(()=>{n.current=!0}),f.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,bo({fromRouteId:e},o)))},[t,e])}const Eh={};function eS(t,e,n){Eh[t]||(Eh[t]=!0)}function tS(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function ct(t){Nt(!1)}function nS(t){let{basename:e="/",children:n=null,location:s,navigationType:r=ts.Pop,navigator:o,static:a=!1,future:l}=t;pl()&&Nt(!1);let c=e.replace(/^\/*/,"/"),d=f.useMemo(()=>({basename:c,navigator:o,static:a,future:bo({v7_relativeSplatPath:!1},l)}),[c,l,o,a]);typeof s=="string"&&(s=Us(s));let{pathname:u="/",search:h="",hash:p="",state:m=null,key:x="default"}=s,g=f.useMemo(()=>{let y=ym(u,c);return y==null?null:{location:{pathname:y,search:h,hash:p,state:m,key:x},navigationType:r}},[c,u,h,p,m,x,r]);return g==null?null:f.createElement(ul.Provider,{value:d},f.createElement(hl.Provider,{children:n,value:g}))}function iS(t){let{children:e,location:n}=t;return $1(Lc(e),n)}new Promise(()=>{});function Lc(t,e){e===void 0&&(e=[]);let n=[];return f.Children.forEach(t,(s,r)=>{if(!f.isValidElement(s))return;let o=[...e,r];if(s.type===f.Fragment){n.push.apply(n,Lc(s.props.children,o));return}s.type!==ct&&Nt(!1),!s.props.index||!s.props.children||Nt(!1);let a={id:s.props.id||o.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=Lc(s.props.children,o)),n.push(a)}),n}const sS="6";try{window.__reactRouterVersion=sS}catch{}const rS="startTransition",Ih=Vd[rS];function oS(t){let{basename:e,children:n,future:s,window:r}=t,o=f.useRef();o.current==null&&(o.current=d1({window:r,v5Compat:!0}));let a=o.current,[l,c]=f.useState({action:a.action,location:a.location}),{v7_startTransition:d}=s||{},u=f.useCallback(h=>{d&&Ih?Ih(()=>c(h)):c(h)},[c,d]);return f.useLayoutEffect(()=>a.listen(u),[a,u]),f.useEffect(()=>tS(s),[s]),f.createElement(nS,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:s})}var Rh;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Rh||(Rh={}));var Ah;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Ah||(Ah={}));const qd=f.createContext({});function Kd(t){const e=f.useRef(null);return e.current===null&&(e.current=t()),e.current}const Jd=typeof window<"u",jm=Jd?f.useLayoutEffect:f.useEffect,fl=f.createContext(null);function Yd(t,e){t.indexOf(e)===-1&&t.push(e)}function Xd(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Ni=(t,e,n)=>n>e?e:n<t?t:n;let Zd=()=>{};const zi={},Tm=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function Em(t){return typeof t=="object"&&t!==null}const Im=t=>/^0[^.\s]+$/u.test(t);function Qd(t){let e;return()=>(e===void 0&&(e=t()),e)}const Mn=t=>t,aS=(t,e)=>n=>e(t(n)),Bo=(...t)=>t.reduce(aS),vo=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s};class eu{constructor(){this.subscriptions=[]}add(e){return Yd(this.subscriptions,e),()=>Xd(this.subscriptions,e)}notify(e,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,s);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ei=t=>t*1e3,An=t=>t/1e3;function Rm(t,e){return e?t*(1e3/e):0}const Am=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,lS=1e-7,cS=12;function dS(t,e,n,s,r){let o,a,l=0;do a=e+(n-e)/2,o=Am(a,s,r)-t,o>0?n=a:e=a;while(Math.abs(o)>lS&&++l<cS);return a}function Fo(t,e,n,s){if(t===e&&n===s)return Mn;const r=o=>dS(o,0,1,t,n);return o=>o===0||o===1?o:Am(r(o),e,s)}const _m=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Mm=t=>e=>1-t(1-e),Pm=Fo(.33,1.53,.69,.99),tu=Mm(Pm),Dm=_m(tu),Nm=t=>(t*=2)<1?.5*tu(t):.5*(2-Math.pow(2,-10*(t-1))),nu=t=>1-Math.sin(Math.acos(t)),zm=Mm(nu),Lm=_m(nu),uS=Fo(.42,0,1,1),hS=Fo(0,0,.58,1),Om=Fo(.42,0,.58,1),pS=t=>Array.isArray(t)&&typeof t[0]!="number",Bm=t=>Array.isArray(t)&&typeof t[0]=="number",fS={linear:Mn,easeIn:uS,easeInOut:Om,easeOut:hS,circIn:nu,circInOut:Lm,circOut:zm,backIn:tu,backInOut:Dm,backOut:Pm,anticipate:Nm},gS=t=>typeof t=="string",_h=t=>{if(Bm(t)){Zd(t.length===4);const[e,n,s,r]=t;return Fo(e,n,s,r)}else if(gS(t))return fS[t];return t},Yo=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function mS(t,e){let n=new Set,s=new Set,r=!1,o=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){a.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,h=!1,p=!1)=>{const x=p&&r?n:s;return h&&a.add(u),x.has(u)||x.add(u),u},cancel:u=>{s.delete(u),a.delete(u)},process:u=>{if(l=u,r){o=!0;return}r=!0,[n,s]=[s,n],n.forEach(c),n.clear(),r=!1,o&&(o=!1,d.process(u))}};return d}const xS=40;function Fm(t,e){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Yo.reduce((S,w)=>(S[w]=mS(o),S),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:x}=a,g=()=>{const S=zi.useManualTiming?r.timestamp:performance.now();n=!1,zi.useManualTiming||(r.delta=s?1e3/60:Math.max(Math.min(S-r.timestamp,xS),1)),r.timestamp=S,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),h.process(r),p.process(r),m.process(r),x.process(r),r.isProcessing=!1,n&&e&&(s=!1,t(g))},y=()=>{n=!0,s=!0,r.isProcessing||t(g)};return{schedule:Yo.reduce((S,w)=>{const b=a[w];return S[w]=(T,C=!1,j=!1)=>(n||y(),b.schedule(T,C,j)),S},{}),cancel:S=>{for(let w=0;w<Yo.length;w++)a[Yo[w]].cancel(S)},state:r,steps:a}}const{schedule:ht,cancel:ls,state:Ht,steps:Ol}=Fm(typeof requestAnimationFrame<"u"?requestAnimationFrame:Mn,!0);let ma;function yS(){ma=void 0}const hn={now:()=>(ma===void 0&&hn.set(Ht.isProcessing||zi.useManualTiming?Ht.timestamp:performance.now()),ma),set:t=>{ma=t,queueMicrotask(yS)}},Wm=t=>e=>typeof e=="string"&&e.startsWith(t),iu=Wm("--"),bS=Wm("var(--"),su=t=>bS(t)?vS.test(t.split("/*")[0].trim()):!1,vS=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Or={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},So={...Or,transform:t=>Ni(0,1,t)},Xo={...Or,default:1},oo=t=>Math.round(t*1e5)/1e5,ru=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function SS(t){return t==null}const kS=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ou=(t,e)=>n=>!!(typeof n=="string"&&kS.test(n)&&n.startsWith(t)||e&&!SS(n)&&Object.prototype.hasOwnProperty.call(n,e)),$m=(t,e,n)=>s=>{if(typeof s!="string")return s;const[r,o,a,l]=s.match(ru);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},wS=t=>Ni(0,255,t),Bl={...Or,transform:t=>Math.round(wS(t))},Ts={test:ou("rgb","red"),parse:$m("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+Bl.transform(t)+", "+Bl.transform(e)+", "+Bl.transform(n)+", "+oo(So.transform(s))+")"};function CS(t){let e="",n="",s="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Oc={test:ou("#"),parse:CS,transform:Ts.transform},Wo=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Ji=Wo("deg"),ti=Wo("%"),ke=Wo("px"),jS=Wo("vh"),TS=Wo("vw"),Mh={...ti,parse:t=>ti.parse(t)/100,transform:t=>ti.transform(t*100)},ar={test:ou("hsl","hue"),parse:$m("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+ti.transform(oo(e))+", "+ti.transform(oo(n))+", "+oo(So.transform(s))+")"},It={test:t=>Ts.test(t)||Oc.test(t)||ar.test(t),parse:t=>Ts.test(t)?Ts.parse(t):ar.test(t)?ar.parse(t):Oc.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Ts.transform(t):ar.transform(t),getAnimatableNone:t=>{const e=It.parse(t);return e.alpha=0,It.transform(e)}},ES=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function IS(t){return isNaN(t)&&typeof t=="string"&&(t.match(ru)?.length||0)+(t.match(ES)?.length||0)>0}const Um="number",Vm="color",RS="var",AS="var(",Ph="${}",_S=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ko(t){const e=t.toString(),n=[],s={color:[],number:[],var:[]},r=[];let o=0;const l=e.replace(_S,c=>(It.test(c)?(s.color.push(o),r.push(Vm),n.push(It.parse(c))):c.startsWith(AS)?(s.var.push(o),r.push(RS),n.push(c)):(s.number.push(o),r.push(Um),n.push(parseFloat(c))),++o,Ph)).split(Ph);return{values:n,split:l,indexes:s,types:r}}function Gm(t){return ko(t).values}function Hm(t){const{split:e,types:n}=ko(t),s=e.length;return r=>{let o="";for(let a=0;a<s;a++)if(o+=e[a],r[a]!==void 0){const l=n[a];l===Um?o+=oo(r[a]):l===Vm?o+=It.transform(r[a]):o+=r[a]}return o}}const MS=t=>typeof t=="number"?0:It.test(t)?It.getAnimatableNone(t):t;function PS(t){const e=Gm(t);return Hm(t)(e.map(MS))}const cs={test:IS,parse:Gm,createTransformer:Hm,getAnimatableNone:PS};function Fl(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function DS({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let r=0,o=0,a=0;if(!e)r=o=a=n;else{const l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=Fl(c,l,t+1/3),o=Fl(c,l,t),a=Fl(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:s}}function Ba(t,e){return n=>n>0?e:t}const xt=(t,e,n)=>t+(e-t)*n,Wl=(t,e,n)=>{const s=t*t,r=n*(e*e-s)+s;return r<0?0:Math.sqrt(r)},NS=[Oc,Ts,ar],zS=t=>NS.find(e=>e.test(t));function Dh(t){const e=zS(t);if(!e)return!1;let n=e.parse(t);return e===ar&&(n=DS(n)),n}const Nh=(t,e)=>{const n=Dh(t),s=Dh(e);if(!n||!s)return Ba(t,e);const r={...n};return o=>(r.red=Wl(n.red,s.red,o),r.green=Wl(n.green,s.green,o),r.blue=Wl(n.blue,s.blue,o),r.alpha=xt(n.alpha,s.alpha,o),Ts.transform(r))},Bc=new Set(["none","hidden"]);function LS(t,e){return Bc.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function OS(t,e){return n=>xt(t,e,n)}function au(t){return typeof t=="number"?OS:typeof t=="string"?su(t)?Ba:It.test(t)?Nh:WS:Array.isArray(t)?qm:typeof t=="object"?It.test(t)?Nh:BS:Ba}function qm(t,e){const n=[...t],s=n.length,r=t.map((o,a)=>au(o)(o,e[a]));return o=>{for(let a=0;a<s;a++)n[a]=r[a](o);return n}}function BS(t,e){const n={...t,...e},s={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(s[r]=au(t[r])(t[r],e[r]));return r=>{for(const o in s)n[o]=s[o](r);return n}}function FS(t,e){const n=[],s={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const o=e.types[r],a=t.indexes[o][s[o]],l=t.values[a]??0;n[r]=l,s[o]++}return n}const WS=(t,e)=>{const n=cs.createTransformer(e),s=ko(t),r=ko(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?Bc.has(t)&&!r.values.length||Bc.has(e)&&!s.values.length?LS(t,e):Bo(qm(FS(s,r),r.values),n):Ba(t,e)};function Km(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?xt(t,e,n):au(t)(t,e)}const $S=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>ht.update(e,n),stop:()=>ls(e),now:()=>Ht.isProcessing?Ht.timestamp:hn.now()}},Jm=(t,e,n=10)=>{let s="";const r=Math.max(Math.round(e/n),2);for(let o=0;o<r;o++)s+=Math.round(t(o/(r-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},Fa=2e4;function lu(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<Fa;)e+=n,s=t.next(e);return e>=Fa?1/0:e}function US(t,e=100,n){const s=n({...t,keyframes:[0,e]}),r=Math.min(lu(s),Fa);return{type:"keyframes",ease:o=>s.next(r*o).value/e,duration:An(r)}}const VS=5;function Ym(t,e,n){const s=Math.max(e-VS,0);return Rm(n-t(s),e-s)}const St={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},$l=.001;function GS({duration:t=St.duration,bounce:e=St.bounce,velocity:n=St.velocity,mass:s=St.mass}){let r,o,a=1-e;a=Ni(St.minDamping,St.maxDamping,a),t=Ni(St.minDuration,St.maxDuration,An(t)),a<1?(r=d=>{const u=d*a,h=u*t,p=u-n,m=Fc(d,a),x=Math.exp(-h);return $l-p/m*x},o=d=>{const h=d*a*t,p=h*n+n,m=Math.pow(a,2)*Math.pow(d,2)*t,x=Math.exp(-h),g=Fc(Math.pow(d,2),a);return(-r(d)+$l>0?-1:1)*((p-m)*x)/g}):(r=d=>{const u=Math.exp(-d*t),h=(d-n)*t+1;return-$l+u*h},o=d=>{const u=Math.exp(-d*t),h=(n-d)*(t*t);return u*h});const l=5/t,c=qS(r,o,l);if(t=ei(t),isNaN(c))return{stiffness:St.stiffness,damping:St.damping,duration:t};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:t}}}const HS=12;function qS(t,e,n){let s=n;for(let r=1;r<HS;r++)s=s-t(s)/e(s);return s}function Fc(t,e){return t*Math.sqrt(1-e*e)}const KS=["duration","bounce"],JS=["stiffness","damping","mass"];function zh(t,e){return e.some(n=>t[n]!==void 0)}function YS(t){let e={velocity:St.velocity,stiffness:St.stiffness,damping:St.damping,mass:St.mass,isResolvedFromDuration:!1,...t};if(!zh(t,JS)&&zh(t,KS))if(t.visualDuration){const n=t.visualDuration,s=2*Math.PI/(n*1.2),r=s*s,o=2*Ni(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:St.mass,stiffness:r,damping:o}}else{const n=GS(t);e={...e,...n,mass:St.mass},e.isResolvedFromDuration=!0}return e}function Wa(t=St.visualDuration,e=St.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:s,restDelta:r}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=YS({...n,velocity:-An(n.velocity||0)}),x=p||0,g=d/(2*Math.sqrt(c*u)),y=a-o,v=An(Math.sqrt(c/u)),k=Math.abs(y)<5;s||(s=k?St.restSpeed.granular:St.restSpeed.default),r||(r=k?St.restDelta.granular:St.restDelta.default);let S;if(g<1){const b=Fc(v,g);S=T=>{const C=Math.exp(-g*v*T);return a-C*((x+g*v*y)/b*Math.sin(b*T)+y*Math.cos(b*T))}}else if(g===1)S=b=>a-Math.exp(-v*b)*(y+(x+v*y)*b);else{const b=v*Math.sqrt(g*g-1);S=T=>{const C=Math.exp(-g*v*T),j=Math.min(b*T,300);return a-C*((x+g*v*y)*Math.sinh(j)+b*y*Math.cosh(j))/b}}const w={calculatedDuration:m&&h||null,next:b=>{const T=S(b);if(m)l.done=b>=h;else{let C=b===0?x:0;g<1&&(C=b===0?ei(x):Ym(S,b,T));const j=Math.abs(C)<=s,R=Math.abs(a-T)<=r;l.done=j&&R}return l.value=l.done?a:T,l},toString:()=>{const b=Math.min(lu(w),Fa),T=Jm(C=>w.next(b*C).value,b,30);return b+"ms "+T},toTransition:()=>{}};return w}Wa.applyToOptions=t=>{const e=US(t,100,Wa);return t.ease=e.ease,t.duration=ei(e.duration),t.type="keyframes",t};function Wc({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=t[0],p={done:!1,value:h},m=j=>l!==void 0&&j<l||c!==void 0&&j>c,x=j=>l===void 0?c:c===void 0||Math.abs(l-j)<Math.abs(c-j)?l:c;let g=n*e;const y=h+g,v=a===void 0?y:a(y);v!==y&&(g=v-h);const k=j=>-g*Math.exp(-j/s),S=j=>v+k(j),w=j=>{const R=k(j),I=S(j);p.done=Math.abs(R)<=d,p.value=p.done?v:I};let b,T;const C=j=>{m(p.value)&&(b=j,T=Wa({keyframes:[p.value,x(p.value)],velocity:Ym(S,j,p.value),damping:r,stiffness:o,restDelta:d,restSpeed:u}))};return C(0),{calculatedDuration:null,next:j=>{let R=!1;return!T&&b===void 0&&(R=!0,w(j),C(j)),b!==void 0&&j>=b?T.next(j-b):(!R&&w(j),p)}}}function XS(t,e,n){const s=[],r=n||zi.mix||Km,o=t.length-1;for(let a=0;a<o;a++){let l=r(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||Mn:e;l=Bo(c,l)}s.push(l)}return s}function ZS(t,e,{clamp:n=!0,ease:s,mixer:r}={}){const o=t.length;if(Zd(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=XS(e,s,r),c=l.length,d=u=>{if(a&&u<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const p=vo(t[h],t[h+1],u);return l[h](p)};return n?u=>d(Ni(t[0],t[o-1],u)):d}function QS(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const r=vo(0,e,s);t.push(xt(n,1,r))}}function ek(t){const e=[0];return QS(e,t.length-1),e}function tk(t,e){return t.map(n=>n*e)}function nk(t,e){return t.map(()=>e||Om).splice(0,t.length-1)}function ao({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const r=pS(s)?s.map(_h):_h(s),o={done:!1,value:e[0]},a=tk(n&&n.length===e.length?n:ek(e),t),l=ZS(a,e,{ease:Array.isArray(r)?r:nk(e,r)});return{calculatedDuration:t,next:c=>(o.value=l(c),o.done=c>=t,o)}}const ik=t=>t!==null;function cu(t,{repeat:e,repeatType:n="loop"},s,r=1){const o=t.filter(ik),l=r<0||e&&n!=="loop"&&e%2===1?0:o.length-1;return!l||s===void 0?o[l]:s}const sk={decay:Wc,inertia:Wc,tween:ao,keyframes:ao,spring:Wa};function Xm(t){typeof t.type=="string"&&(t.type=sk[t.type])}class du{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const rk=t=>t/100;class uu extends du{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==hn.now()&&this.tick(hn.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Xm(e);const{type:n=ao,repeat:s=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=e;let{keyframes:l}=e;const c=n||ao;c!==ao&&typeof l[0]!="number"&&(this.mixKeyframes=Bo(rk,Km(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=lu(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(s+1)-r,this.generator=d}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:s,totalDuration:r,mixKeyframes:o,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:x,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const v=this.currentTime-d*(this.playbackSpeed>=0?1:-1),k=this.playbackSpeed>=0?v<0:v>r;this.currentTime=Math.max(v,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let S=this.currentTime,w=s;if(h){const j=Math.min(this.currentTime,r)/l;let R=Math.floor(j),I=j%1;!I&&j>=1&&(I=1),I===1&&R--,R=Math.min(R,h+1),!!(R%2)&&(p==="reverse"?(I=1-I,m&&(I-=m/l)):p==="mirror"&&(w=a)),S=Ni(0,1,I)*l}const b=k?{done:!1,value:u[0]}:w.next(S);o&&(b.value=o(b.value));let{done:T}=b;!k&&c!==null&&(T=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return C&&x!==Wc&&(b.value=cu(u,this.options,y,this.speed)),g&&g(b.value),C&&this.finish(),b}then(e,n){return this.finished.then(e,n)}get duration(){return An(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+An(e)}get time(){return An(this.currentTime)}set time(e){e=ei(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(hn.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=An(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=$S,startTime:n}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=n??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(hn.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function ok(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Es=t=>t*180/Math.PI,$c=t=>{const e=Es(Math.atan2(t[1],t[0]));return Uc(e)},ak={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:$c,rotateZ:$c,skewX:t=>Es(Math.atan(t[1])),skewY:t=>Es(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Uc=t=>(t=t%360,t<0&&(t+=360),t),Lh=$c,Oh=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Bh=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),lk={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Oh,scaleY:Bh,scale:t=>(Oh(t)+Bh(t))/2,rotateX:t=>Uc(Es(Math.atan2(t[6],t[5]))),rotateY:t=>Uc(Es(Math.atan2(-t[2],t[0]))),rotateZ:Lh,rotate:Lh,skewX:t=>Es(Math.atan(t[4])),skewY:t=>Es(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Vc(t){return t.includes("scale")?1:0}function Gc(t,e){if(!t||t==="none")return Vc(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,r;if(n)s=lk,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=ak,r=l}if(!r)return Vc(e);const o=s[e],a=r[1].split(",").map(dk);return typeof o=="function"?o(a):a[o]}const ck=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return Gc(n,e)};function dk(t){return parseFloat(t.trim())}const Br=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fr=new Set(Br),Fh=t=>t===Or||t===ke,uk=new Set(["x","y","z"]),hk=Br.filter(t=>!uk.has(t));function pk(t){const e=[];return hk.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e}const As={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Gc(e,"x"),y:(t,{transform:e})=>Gc(e,"y")};As.translateX=As.x;As.translateY=As.y;const _s=new Set;let Hc=!1,qc=!1,Kc=!1;function Zm(){if(qc){const t=Array.from(_s).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),n=new Map;e.forEach(s=>{const r=pk(s);r.length&&(n.set(s,r),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=n.get(s);r&&r.forEach(([o,a])=>{s.getValue(o)?.set(a)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}qc=!1,Hc=!1,_s.forEach(t=>t.complete(Kc)),_s.clear()}function Qm(){_s.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(qc=!0)})}function fk(){Kc=!0,Qm(),Zm(),Kc=!1}class hu{constructor(e,n,s,r,o,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=s,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(_s.add(this),Hc||(Hc=!0,ht.read(Qm),ht.resolveKeyframes(Zm))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:s,motionValue:r}=this;if(e[0]===null){const o=r?.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(s&&n){const l=s.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}ok(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),_s.delete(this)}cancel(){this.state==="scheduled"&&(_s.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const gk=t=>t.startsWith("--");function mk(t,e,n){gk(e)?t.style.setProperty(e,n):t.style[e]=n}const xk=Qd(()=>window.ScrollTimeline!==void 0),yk={};function bk(t,e){const n=Qd(t);return()=>yk[e]??n()}const ex=bk(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),to=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,Wh={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:to([0,.65,.55,1]),circOut:to([.55,0,1,.45]),backIn:to([.31,.01,.66,-.59]),backOut:to([.33,1.53,.69,.99])};function tx(t,e){if(t)return typeof t=="function"?ex()?Jm(t,e):"ease-out":Bm(t)?to(t):Array.isArray(t)?t.map(n=>tx(n,e)||Wh.easeOut):Wh[t]}function vk(t,e,n,{delay:s=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:n};c&&(u.offset=c);const h=tx(l,r);Array.isArray(h)&&(u.easing=h);const p={delay:s,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),t.animate(u,p)}function nx(t){return typeof t=="function"&&"applyToOptions"in t}function Sk({type:t,...e}){return nx(t)&&ex()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class kk extends du{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:s,keyframes:r,pseudoElement:o,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!o,this.allowFlatten=a,this.options=e,Zd(typeof e.type!="string");const d=Sk(e);this.animation=vk(n,s,r,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=cu(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):mk(n,s,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return An(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+An(e)}get time(){return An(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ei(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&xk()?(this.animation.timeline=e,Mn):n(this)}}const ix={anticipate:Nm,backInOut:Dm,circInOut:Lm};function wk(t){return t in ix}function Ck(t){typeof t.ease=="string"&&wk(t.ease)&&(t.ease=ix[t.ease])}const $h=10;class jk extends kk{constructor(e){Ck(e),Xm(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:s,onComplete:r,element:o,...a}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const l=new uu({...a,autoplay:!1}),c=ei(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-$h).value,l.sample(c).value,$h),l.stop()}}const Uh=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(cs.test(t)||t==="0")&&!t.startsWith("url("));function Tk(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function Ek(t,e,n,s){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=Uh(r,e),l=Uh(o,e);return!a||!l?!1:Tk(t)||(n==="spring"||nx(n))&&s}function Jc(t){t.duration=0,t.type="keyframes"}const Ik=new Set(["opacity","clipPath","filter","transform"]),Rk=Qd(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Ak(t){const{motionValue:e,name:n,repeatDelay:s,repeatType:r,damping:o,type:a}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return Rk()&&n&&Ik.has(n)&&(n!=="transform"||!d)&&!c&&!s&&r!=="mirror"&&o!==0&&a!=="inertia"}const _k=40;class Mk extends du{constructor({autoplay:e=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=hn.now();const p={autoplay:e,delay:n,type:s,repeat:r,repeatDelay:o,repeatType:a,name:c,motionValue:d,element:u,...h},m=u?.KeyframeResolver||hu;this.keyframeResolver=new m(l,(x,g,y)=>this.onKeyframesResolved(x,g,p,!y),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,n,s,r){this.keyframeResolver=void 0;const{name:o,type:a,velocity:l,delay:c,isHandoff:d,onUpdate:u}=s;this.resolvedAt=hn.now(),Ek(e,o,a,l)||((zi.instantAnimations||!c)&&u?.(cu(e,s,n)),e[0]=e[e.length-1],Jc(s),s.repeat=0);const p={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>_k?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...s,keyframes:e},m=!d&&Ak(p)?new jk({...p,element:p.motionValue.owner.current}):new uu(p);m.finished.then(()=>this.notifyFinished()).catch(Mn),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),fk()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Pk=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Dk(t){const e=Pk.exec(t);if(!e)return[,];const[,n,s,r]=e;return[`--${n??s}`,r]}function sx(t,e,n=1){const[s,r]=Dk(t);if(!s)return;const o=window.getComputedStyle(e).getPropertyValue(s);if(o){const a=o.trim();return Tm(a)?parseFloat(a):a}return su(r)?sx(r,e,n+1):r}function pu(t,e){return t?.[e]??t?.default??t}const rx=new Set(["width","height","top","left","right","bottom",...Br]),Nk={test:t=>t==="auto",parse:t=>t},ox=t=>e=>e.test(t),ax=[Or,ke,ti,Ji,TS,jS,Nk],Vh=t=>ax.find(ox(t));function zk(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Im(t):!0}const Lk=new Set(["brightness","contrast","saturate","opacity"]);function Ok(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(ru)||[];if(!s)return t;const r=n.replace(s,"");let o=Lk.has(e)?1:0;return s!==n&&(o*=100),e+"("+o+r+")"}const Bk=/\b([a-z-]*)\(.*?\)/gu,Yc={...cs,getAnimatableNone:t=>{const e=t.match(Bk);return e?e.map(Ok).join(" "):t}},Gh={...Or,transform:Math.round},Fk={rotate:Ji,rotateX:Ji,rotateY:Ji,rotateZ:Ji,scale:Xo,scaleX:Xo,scaleY:Xo,scaleZ:Xo,skew:Ji,skewX:Ji,skewY:Ji,distance:ke,translateX:ke,translateY:ke,translateZ:ke,x:ke,y:ke,z:ke,perspective:ke,transformPerspective:ke,opacity:So,originX:Mh,originY:Mh,originZ:ke},fu={borderWidth:ke,borderTopWidth:ke,borderRightWidth:ke,borderBottomWidth:ke,borderLeftWidth:ke,borderRadius:ke,radius:ke,borderTopLeftRadius:ke,borderTopRightRadius:ke,borderBottomRightRadius:ke,borderBottomLeftRadius:ke,width:ke,maxWidth:ke,height:ke,maxHeight:ke,top:ke,right:ke,bottom:ke,left:ke,padding:ke,paddingTop:ke,paddingRight:ke,paddingBottom:ke,paddingLeft:ke,margin:ke,marginTop:ke,marginRight:ke,marginBottom:ke,marginLeft:ke,backgroundPositionX:ke,backgroundPositionY:ke,...Fk,zIndex:Gh,fillOpacity:So,strokeOpacity:So,numOctaves:Gh},Wk={...fu,color:It,backgroundColor:It,outlineColor:It,fill:It,stroke:It,borderColor:It,borderTopColor:It,borderRightColor:It,borderBottomColor:It,borderLeftColor:It,filter:Yc,WebkitFilter:Yc},lx=t=>Wk[t];function cx(t,e){let n=lx(t);return n!==Yc&&(n=cs),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const $k=new Set(["auto","none","0"]);function Uk(t,e,n){let s=0,r;for(;s<t.length&&!r;){const o=t[s];typeof o=="string"&&!$k.has(o)&&ko(o).values.length&&(r=t[s]),s++}if(r&&n)for(const o of e)t[o]=cx(n,r)}class Vk extends hu{constructor(e,n,s,r,o){super(e,n,s,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),su(d))){const u=sx(d,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!rx.has(s)||e.length!==2)return;const[r,o]=e,a=Vh(r),l=Vh(o);if(a!==l)if(Fh(a)&&Fh(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else As[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,s=[];for(let r=0;r<e.length;r++)(e[r]===null||zk(e[r]))&&s.push(r);s.length&&Uk(e,s,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=As[s](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){const{element:e,name:n,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const r=e.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=s.length-1,a=s[o];s[o]=As[n](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function Gk(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let s=document;const r=n?.[t]??s.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const dx=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function ux(t){return Em(t)&&"offsetHeight"in t}const Hh=30,Hk=t=>!isNaN(parseFloat(t));class qk{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const r=hn.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=hn.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Hk(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new eu);const s=this.events[e].add(n);return e==="change"?()=>{s(),ht.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=hn.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Hh)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Hh);return Rm(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ir(t,e){return new qk(t,e)}const{schedule:gu}=Fm(queueMicrotask,!1),On={x:!1,y:!1};function hx(){return On.x||On.y}function Kk(t){return t==="x"||t==="y"?On[t]?null:(On[t]=!0,()=>{On[t]=!1}):On.x||On.y?null:(On.x=On.y=!0,()=>{On.x=On.y=!1})}function px(t,e){const n=Gk(t),s=new AbortController,r={passive:!0,...e,signal:s.signal};return[n,r,()=>s.abort()]}function qh(t){return!(t.pointerType==="touch"||hx())}function Jk(t,e,n={}){const[s,r,o]=px(t,n),a=l=>{if(!qh(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=h=>{qh(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return s.forEach(l=>{l.addEventListener("pointerenter",a,r)}),o}const fx=(t,e)=>e?t===e?!0:fx(t,e.parentElement):!1,mu=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,Yk=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Xk(t){return Yk.has(t.tagName)||t.tabIndex!==-1}const xa=new WeakSet;function Kh(t){return e=>{e.key==="Enter"&&t(e)}}function Ul(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Zk=(t,e)=>{const n=t.currentTarget;if(!n)return;const s=Kh(()=>{if(xa.has(n))return;Ul(n,"down");const r=Kh(()=>{Ul(n,"up")}),o=()=>Ul(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",s,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),e)};function Jh(t){return mu(t)&&!hx()}function Qk(t,e,n={}){const[s,r,o]=px(t,n),a=l=>{const c=l.currentTarget;if(!Jh(l))return;xa.add(c);const d=e(c,l),u=(m,x)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),xa.has(c)&&xa.delete(c),Jh(m)&&typeof d=="function"&&d(m,{success:x})},h=m=>{u(m,c===window||c===document||n.useGlobalTarget||fx(c,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",p,r)};return s.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",a,r),ux(l)&&(l.addEventListener("focus",d=>Zk(d,r)),!Xk(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function gx(t){return Em(t)&&"ownerSVGElement"in t}function ew(t){return gx(t)&&t.tagName==="svg"}const Zt=t=>!!(t&&t.getVelocity),tw=[...ax,It,cs],nw=t=>tw.find(ox(t)),xu=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Yh(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function iw(...t){return e=>{let n=!1;const s=t.map(r=>{const o=Yh(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<s.length;r++){const o=s[r];typeof o=="function"?o():Yh(t[r],null)}}}}function sw(...t){return f.useCallback(iw(...t),t)}class rw extends f.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const s=n.offsetParent,r=ux(s)&&s.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=r-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ow({children:t,isPresent:e,anchorX:n,root:s}){const r=f.useId(),o=f.useRef(null),a=f.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=f.useContext(xu),c=sw(o,t?.ref);return f.useInsertionEffect(()=>{const{width:d,height:u,top:h,left:p,right:m}=a.current;if(e||!o.current||!d||!u)return;const x=n==="left"?`left: ${p}`:`right: ${m}`;o.current.dataset.motionPopId=r;const g=document.createElement("style");l&&(g.nonce=l);const y=s??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${x}px !important;
            top: ${h}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[e]),i.jsx(rw,{isPresent:e,childRef:o,sizeRef:a,children:f.cloneElement(t,{ref:c})})}const aw=({children:t,initial:e,isPresent:n,onExitComplete:s,custom:r,presenceAffectsLayout:o,mode:a,anchorX:l,root:c})=>{const d=Kd(lw),u=f.useId();let h=!0,p=f.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:n,custom:r,onExitComplete:m=>{d.set(m,!0);for(const x of d.values())if(!x)return;s&&s()},register:m=>(d.set(m,!1),()=>d.delete(m))}),[n,d,s]);return o&&h&&(p={...p}),f.useMemo(()=>{d.forEach((m,x)=>d.set(x,!1))},[n]),f.useEffect(()=>{!n&&!d.size&&s&&s()},[n]),a==="popLayout"&&(t=i.jsx(ow,{isPresent:n,anchorX:l,root:c,children:t})),i.jsx(fl.Provider,{value:p,children:t})};function lw(){return new Map}function mx(t=!0){const e=f.useContext(fl);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:s,register:r}=e,o=f.useId();f.useEffect(()=>{if(t)return r(o)},[t]);const a=f.useCallback(()=>t&&s&&s(o),[o,s,t]);return!n&&s?[!1,a]:[!0]}const Zo=t=>t.key||"";function Xh(t){const e=[];return f.Children.forEach(t,n=>{f.isValidElement(n)&&e.push(n)}),e}const Ve=({children:t,custom:e,initial:n=!0,onExitComplete:s,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[d,u]=mx(a),h=f.useMemo(()=>Xh(t),[t]),p=a&&!d?[]:h.map(Zo),m=f.useRef(!0),x=f.useRef(h),g=Kd(()=>new Map),[y,v]=f.useState(h),[k,S]=f.useState(h);jm(()=>{m.current=!1,x.current=h;for(let T=0;T<k.length;T++){const C=Zo(k[T]);p.includes(C)?g.delete(C):g.get(C)!==!0&&g.set(C,!1)}},[k,p.length,p.join("-")]);const w=[];if(h!==y){let T=[...h];for(let C=0;C<k.length;C++){const j=k[C],R=Zo(j);p.includes(R)||(T.splice(C,0,j),w.push(j))}return o==="wait"&&w.length&&(T=w),S(Xh(T)),v(h),null}const{forceRender:b}=f.useContext(qd);return i.jsx(i.Fragment,{children:k.map(T=>{const C=Zo(T),j=a&&!d?!1:h===k||p.includes(C),R=()=>{if(g.has(C))g.set(C,!0);else return;let I=!0;g.forEach(A=>{A||(I=!1)}),I&&(b?.(),S(x.current),a&&u?.(),s&&s())};return i.jsx(aw,{isPresent:j,initial:!m.current||n?void 0:!1,custom:e,presenceAffectsLayout:r,mode:o,root:c,onExitComplete:j?void 0:R,anchorX:l,children:T},C)})})},xx=f.createContext({strict:!1}),Zh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Rr={};for(const t in Zh)Rr[t]={isEnabled:e=>Zh[t].some(n=>!!e[n])};function cw(t){for(const e in t)Rr[e]={...Rr[e],...t[e]}}const dw=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $a(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||dw.has(t)}let yx=t=>!$a(t);function uw(t){typeof t=="function"&&(yx=e=>e.startsWith("on")?!$a(e):t(e))}try{uw(require("@emotion/is-prop-valid").default)}catch{}function hw(t,e,n){const s={};for(const r in t)r==="values"&&typeof t.values=="object"||(yx(r)||n===!0&&$a(r)||!e&&!$a(r)||t.draggable&&r.startsWith("onDrag"))&&(s[r]=t[r]);return s}const gl=f.createContext({});function ml(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function wo(t){return typeof t=="string"||Array.isArray(t)}const yu=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],bu=["initial",...yu];function xl(t){return ml(t.animate)||bu.some(e=>wo(t[e]))}function bx(t){return!!(xl(t)||t.variants)}function pw(t,e){if(xl(t)){const{initial:n,animate:s}=t;return{initial:n===!1||wo(n)?n:void 0,animate:wo(s)?s:void 0}}return t.inherit!==!1?e:{}}function fw(t){const{initial:e,animate:n}=pw(t,f.useContext(gl));return f.useMemo(()=>({initial:e,animate:n}),[Qh(e),Qh(n)])}function Qh(t){return Array.isArray(t)?t.join(" "):t}const Co={};function gw(t){for(const e in t)Co[e]=t[e],iu(e)&&(Co[e].isCSSVariable=!0)}function vx(t,{layout:e,layoutId:n}){return Fr.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Co[t]||t==="opacity")}const mw={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},xw=Br.length;function yw(t,e,n){let s="",r=!0;for(let o=0;o<xw;o++){const a=Br[o],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=dx(l,fu[a]);if(!c){r=!1;const u=mw[a]||a;s+=`${u}(${d}) `}n&&(e[a]=d)}}return s=s.trim(),n?s=n(e,r?"":s):r&&(s="none"),s}function vu(t,e,n){const{style:s,vars:r,transformOrigin:o}=t;let a=!1,l=!1;for(const c in e){const d=e[c];if(Fr.has(c)){a=!0;continue}else if(iu(c)){r[c]=d;continue}else{const u=dx(d,fu[c]);c.startsWith("origin")?(l=!0,o[c]=u):s[c]=u}}if(e.transform||(a||n?s.transform=yw(e,t.transform,n):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;s.transformOrigin=`${c} ${d} ${u}`}}const Su=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Sx(t,e,n){for(const s in e)!Zt(e[s])&&!vx(s,n)&&(t[s]=e[s])}function bw({transformTemplate:t},e){return f.useMemo(()=>{const n=Su();return vu(n,e,t),Object.assign({},n.vars,n.style)},[e])}function vw(t,e){const n=t.style||{},s={};return Sx(s,n,t),Object.assign(s,bw(t,e)),s}function Sw(t,e){const n={},s=vw(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=s,n}const kw={offset:"stroke-dashoffset",array:"stroke-dasharray"},ww={offset:"strokeDashoffset",array:"strokeDasharray"};function Cw(t,e,n=1,s=0,r=!0){t.pathLength=1;const o=r?kw:ww;t[o.offset]=ke.transform(-s);const a=ke.transform(e),l=ke.transform(n);t[o.array]=`${a} ${l}`}function kx(t,{attrX:e,attrY:n,attrScale:s,pathLength:r,pathSpacing:o=1,pathOffset:a=0,...l},c,d,u){if(vu(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:p}=t;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),s!==void 0&&(h.scale=s),r!==void 0&&Cw(h,r,o,a,!1)}const wx=()=>({...Su(),attrs:{}}),Cx=t=>typeof t=="string"&&t.toLowerCase()==="svg";function jw(t,e,n,s){const r=f.useMemo(()=>{const o=wx();return kx(o,e,Cx(s),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};Sx(o,t.style,t),r.style={...o,...r.style}}return r}const Tw=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ku(t){return typeof t!="string"||t.includes("-")?!1:!!(Tw.indexOf(t)>-1||/[A-Z]/u.test(t))}function Ew(t,e,n,{latestValues:s},r,o=!1){const l=(ku(t)?jw:Sw)(e,s,r,t),c=hw(e,typeof t=="string",o),d=t!==f.Fragment?{...c,...l,ref:n}:{},{children:u}=e,h=f.useMemo(()=>Zt(u)?u.get():u,[u]);return f.createElement(t,{...d,children:h})}function ep(t){const e=[{},{}];return t?.values.forEach((n,s)=>{e[0][s]=n.get(),e[1][s]=n.getVelocity()}),e}function wu(t,e,n,s){if(typeof e=="function"){const[r,o]=ep(s);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=ep(s);e=e(n!==void 0?n:t.custom,r,o)}return e}function ya(t){return Zt(t)?t.get():t}function Iw({scrapeMotionValuesFromProps:t,createRenderState:e},n,s,r){return{latestValues:Rw(n,s,r,t),renderState:e()}}function Rw(t,e,n,s){const r={},o=s(t,{});for(const p in o)r[p]=ya(o[p]);let{initial:a,animate:l}=t;const c=xl(t),d=bx(t);e&&d&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let u=n?n.initial===!1:!1;u=u||a===!1;const h=u?l:a;if(h&&typeof h!="boolean"&&!ml(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const x=wu(t,p[m]);if(x){const{transitionEnd:g,transition:y,...v}=x;for(const k in v){let S=v[k];if(Array.isArray(S)){const w=u?S.length-1:0;S=S[w]}S!==null&&(r[k]=S)}for(const k in g)r[k]=g[k]}}}return r}const jx=t=>(e,n)=>{const s=f.useContext(gl),r=f.useContext(fl),o=()=>Iw(t,e,s,r);return n?o():Kd(o)};function Cu(t,e,n){const{style:s}=t,r={};for(const o in s)(Zt(s[o])||e.style&&Zt(e.style[o])||vx(o,t)||n?.getValue(o)?.liveStyle!==void 0)&&(r[o]=s[o]);return r}const Aw=jx({scrapeMotionValuesFromProps:Cu,createRenderState:Su});function Tx(t,e,n){const s=Cu(t,e,n);for(const r in t)if(Zt(t[r])||Zt(e[r])){const o=Br.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[o]=t[r]}return s}const _w=jx({scrapeMotionValuesFromProps:Tx,createRenderState:wx}),Mw=Symbol.for("motionComponentSymbol");function lr(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Pw(t,e,n){return f.useCallback(s=>{s&&t.onMount&&t.onMount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):lr(n)&&(n.current=s))},[e])}const ju=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Dw="framerAppearId",Ex="data-"+ju(Dw),Ix=f.createContext({});function Nw(t,e,n,s,r){const{visualElement:o}=f.useContext(gl),a=f.useContext(xx),l=f.useContext(fl),c=f.useContext(xu).reducedMotion,d=f.useRef(null);s=s||a.renderer,!d.current&&s&&(d.current=s(t,{visualState:e,parent:o,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,h=f.useContext(Ix);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&zw(d.current,n,r,h);const p=f.useRef(!1);f.useInsertionEffect(()=>{u&&p.current&&u.update(n,l)});const m=n[Ex],x=f.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return jm(()=>{u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),f.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),x.current=!1),u.enteringChildren=void 0)}),u}function zw(t,e,n,s){const{layoutId:r,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:Rx(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||l&&lr(l),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:c,layoutRoot:d})}function Rx(t){if(t)return t.options.allowProjection!==!1?t.projection:Rx(t.parent)}function Vl(t,{forwardMotionProps:e=!1}={},n,s){n&&cw(n);const r=ku(t)?_w:Aw;function o(l,c){let d;const u={...f.useContext(xu),...l,layoutId:Lw(l)},{isStatic:h}=u,p=fw(l),m=r(l,h);if(!h&&Jd){Ow();const x=Bw(u);d=x.MeasureLayout,p.visualElement=Nw(t,m,u,s,x.ProjectionNode)}return i.jsxs(gl.Provider,{value:p,children:[d&&p.visualElement?i.jsx(d,{visualElement:p.visualElement,...u}):null,Ew(t,l,Pw(m,p.visualElement,c),m,h,e)]})}o.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=f.forwardRef(o);return a[Mw]=t,a}function Lw({layoutId:t}){const e=f.useContext(qd).id;return e&&t!==void 0?e+"-"+t:t}function Ow(t,e){f.useContext(xx).strict}function Bw(t){const{drag:e,layout:n}=Rr;if(!e&&!n)return{};const s={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function Fw(t,e){if(typeof Proxy>"u")return Vl;const n=new Map,s=(o,a)=>Vl(o,a,t,e),r=(o,a)=>s(o,a);return new Proxy(r,{get:(o,a)=>a==="create"?s:(n.has(a)||n.set(a,Vl(a,void 0,t,e)),n.get(a))})}function Ax({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function Ww({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function $w(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function Gl(t){return t===void 0||t===1}function Xc({scale:t,scaleX:e,scaleY:n}){return!Gl(t)||!Gl(e)||!Gl(n)}function ws(t){return Xc(t)||_x(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function _x(t){return tp(t.x)||tp(t.y)}function tp(t){return t&&t!=="0%"}function Ua(t,e,n){const s=t-n,r=e*s;return n+r}function np(t,e,n,s,r){return r!==void 0&&(t=Ua(t,r,s)),Ua(t,n,s)+e}function Zc(t,e=0,n=1,s,r){t.min=np(t.min,e,n,s,r),t.max=np(t.max,e,n,s,r)}function Mx(t,{x:e,y:n}){Zc(t.x,e.translate,e.scale,e.originPoint),Zc(t.y,n.translate,n.scale,n.originPoint)}const ip=.999999999999,sp=1.0000000000001;function Uw(t,e,n,s=!1){const r=n.length;if(!r)return;e.x=e.y=1;let o,a;for(let l=0;l<r;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&o.options.layoutScroll&&o.scroll&&o!==o.root&&dr(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,Mx(t,a)),s&&ws(o.latestValues)&&dr(t,o.latestValues))}e.x<sp&&e.x>ip&&(e.x=1),e.y<sp&&e.y>ip&&(e.y=1)}function cr(t,e){t.min=t.min+e,t.max=t.max+e}function rp(t,e,n,s,r=.5){const o=xt(t.min,t.max,r);Zc(t,e,n,o,s)}function dr(t,e){rp(t.x,e.x,e.scaleX,e.scale,e.originX),rp(t.y,e.y,e.scaleY,e.scale,e.originY)}function Px(t,e){return Ax($w(t.getBoundingClientRect(),e))}function Vw(t,e,n){const s=Px(t,n),{scroll:r}=e;return r&&(cr(s.x,r.offset.x),cr(s.y,r.offset.y)),s}const op=()=>({translate:0,scale:1,origin:0,originPoint:0}),ur=()=>({x:op(),y:op()}),ap=()=>({min:0,max:0}),Mt=()=>({x:ap(),y:ap()}),Qc={current:null},Dx={current:!1};function Gw(){if(Dx.current=!0,!!Jd)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Qc.current=t.matches;t.addEventListener("change",e),e()}else Qc.current=!1}const Hw=new WeakMap;function qw(t,e,n){for(const s in e){const r=e[s],o=n[s];if(Zt(r))t.addValue(s,r);else if(Zt(o))t.addValue(s,Ir(r,{owner:t}));else if(o!==r)if(t.hasValue(s)){const a=t.getValue(s);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=t.getStaticValue(s);t.addValue(s,Ir(a!==void 0?a:r,{owner:t}))}}for(const s in n)e[s]===void 0&&t.removeValue(s);return e}const lp=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Kw{scrapeMotionValuesFromProps(e,n,s){return{}}constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=hu,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=hn.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,ht.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=xl(n),this.isVariantNode=bx(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const m=h[p];c[p]!==void 0&&Zt(m)&&m.set(c[p])}}mount(e){this.current=e,Hw.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),Dx.current||Gw(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Qc.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ls(this.notifyUpdate),ls(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=Fr.has(e);s&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&ht.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Rr){const n=Rr[e];if(!n)continue;const{isEnabled:s,Feature:r}=n;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Mt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<lp.length;s++){const r=lp[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=e[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=qw(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const s=this.values.get(e);n!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=Ir(n===null?void 0:n,{owner:this}),this.addValue(e,s)),s}readValue(e,n){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(Tm(s)||Im(s))?s=parseFloat(s):!nw(s)&&cs.test(n)&&(s=cx(e,n)),this.setBaseTarget(e,Zt(s)?s.get():s)),Zt(s)?s.get():s}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){const{initial:n}=this.props;let s;if(typeof n=="string"||typeof n=="object"){const o=wu(this.props,n,this.presenceContext?.custom);o&&(s=o[e])}if(n&&s!==void 0)return s;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Zt(r)?r:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new eu),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){gu.render(this.render)}}class Nx extends Kw{constructor(){super(...arguments),this.KeyframeResolver=Vk}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Zt(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function zx(t,{style:e,vars:n},s,r){const o=t.style;let a;for(a in e)o[a]=e[a];r?.applyProjectionStyles(o,s);for(a in n)o.setProperty(a,n[a])}function Jw(t){return window.getComputedStyle(t)}class Yw extends Nx{constructor(){super(...arguments),this.type="html",this.renderInstance=zx}readValueFromInstance(e,n){if(Fr.has(n))return this.projection?.isProjecting?Vc(n):ck(e,n);{const s=Jw(e),r=(iu(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return Px(e,n)}build(e,n,s){vu(e,n,s.transformTemplate)}scrapeMotionValuesFromProps(e,n,s){return Cu(e,n,s)}}const Lx=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Xw(t,e,n,s){zx(t,e,void 0,s);for(const r in e.attrs)t.setAttribute(Lx.has(r)?r:ju(r),e.attrs[r])}class Zw extends Nx{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Mt}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Fr.has(n)){const s=lx(n);return s&&s.default||0}return n=Lx.has(n)?n:ju(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,s){return Tx(e,n,s)}build(e,n,s){kx(e,n,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,n,s,r){Xw(e,n,s,r)}mount(e){this.isSVGTag=Cx(e.tagName),super.mount(e)}}const Qw=(t,e)=>ku(t)?new Zw(e):new Yw(e,{allowProjection:t!==f.Fragment});function mr(t,e,n){const s=t.getProps();return wu(s,e,n!==void 0?n:s.custom,t)}const ed=t=>Array.isArray(t);function eC(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Ir(n))}function tC(t){return ed(t)?t[t.length-1]||0:t}function nC(t,e){const n=mr(t,e);let{transitionEnd:s={},transition:r={},...o}=n||{};o={...o,...s};for(const a in o){const l=tC(o[a]);eC(t,a,l)}}function iC(t){return!!(Zt(t)&&t.add)}function td(t,e){const n=t.getValue("willChange");if(iC(n))return n.add(e);if(!n&&zi.WillChange){const s=new zi.WillChange("auto");t.addValue("willChange",s),s.add(e)}}function Ox(t){return t.props[Ex]}const sC=t=>t!==null;function rC(t,{repeat:e,repeatType:n="loop"},s){const r=t.filter(sC),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return r[o]}const oC={type:"spring",stiffness:500,damping:25,restSpeed:10},aC=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),lC={type:"keyframes",duration:.8},cC={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dC=(t,{keyframes:e})=>e.length>2?lC:Fr.has(t)?t.startsWith("scale")?aC(e[1]):oC:cC;function uC({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Tu=(t,e,n,s={},r,o)=>a=>{const l=pu(s,t)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-ei(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:p=>{e.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:o?void 0:r};uC(l)||Object.assign(u,dC(t,u)),u.duration&&(u.duration=ei(u.duration)),u.repeatDelay&&(u.repeatDelay=ei(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Jc(u),u.delay===0&&(h=!0)),(zi.instantAnimations||zi.skipAnimations)&&(h=!0,Jc(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!o&&e.get()!==void 0){const p=rC(u.keyframes,l);if(p!==void 0){ht.update(()=>{u.onUpdate(p),u.onComplete()});return}}return l.isSync?new uu(u):new Mk(u)};function hC({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function Bx(t,e,{delay:n=0,transitionOverride:s,type:r}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;s&&(o=s);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const h=t.getValue(u,t.latestValues[u]??null),p=l[u];if(p===void 0||d&&hC(d,u))continue;const m={delay:n,...pu(o||{},u)},x=h.get();if(x!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===x&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const v=Ox(t);if(v){const k=window.MotionHandoffAnimation(v,u,ht);k!==null&&(m.startTime=k,g=!0)}}td(t,u),h.start(Tu(u,h,p,t.shouldReduceMotion&&rx.has(u)?{type:!1}:m,t,g));const y=h.animation;y&&c.push(y)}return a&&Promise.all(c).then(()=>{ht.update(()=>{a&&nC(t,a)})}),c}function Fx(t,e,n,s=0,r=1){const o=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=t.size,l=(a-1)*s;return typeof n=="function"?n(o,a):r===1?o*s:l-o*s}function nd(t,e,n={}){const s=mr(t,e,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(r=n.transitionOverride);const o=s?()=>Promise.all(Bx(t,s,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=r;return pC(t,e,c,d,u,h,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(n.delay)])}function pC(t,e,n=0,s=0,r=0,o=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(nd(c,e,{...a,delay:n+(typeof s=="function"?0:s)+Fx(t.variantChildren,c,s,r,o)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function fC(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(o=>nd(t,o,n));s=Promise.all(r)}else if(typeof e=="string")s=nd(t,e,n);else{const r=typeof e=="function"?mr(t,e,n.custom):e;s=Promise.all(Bx(t,r,n))}return s.then(()=>{t.notify("AnimationComplete",e)})}function Wx(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}const gC=bu.length;function $x(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?$x(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<gC;n++){const s=bu[n],r=t.props[s];(wo(r)||r===!1)&&(e[s]=r)}return e}const mC=[...yu].reverse(),xC=yu.length;function yC(t){return e=>Promise.all(e.map(({animation:n,options:s})=>fC(t,n,s)))}function bC(t){let e=yC(t),n=cp(),s=!0;const r=c=>(d,u)=>{const h=mr(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:m,...x}=h;d={...d,...x,...m}}return d};function o(c){e=c(t)}function a(c){const{props:d}=t,u=$x(t.parent)||{},h=[],p=new Set;let m={},x=1/0;for(let y=0;y<xC;y++){const v=mC[y],k=n[v],S=d[v]!==void 0?d[v]:u[v],w=wo(S),b=v===c?k.isActive:null;b===!1&&(x=y);let T=S===u[v]&&S!==d[v]&&w;if(T&&s&&t.manuallyAnimateOnMount&&(T=!1),k.protectedKeys={...m},!k.isActive&&b===null||!S&&!k.prevProp||ml(S)||typeof S=="boolean")continue;const C=vC(k.prevProp,S);let j=C||v===c&&k.isActive&&!T&&w||y>x&&w,R=!1;const I=Array.isArray(S)?S:[S];let A=I.reduce(r(v),{});b===!1&&(A={});const{prevResolvedValues:L={}}=k,B={...L,...A},P=W=>{j=!0,p.has(W)&&(R=!0,p.delete(W)),k.needsAnimating[W]=!0;const D=t.getValue(W);D&&(D.liveStyle=!1)};for(const W in B){const D=A[W],N=L[W];if(m.hasOwnProperty(W))continue;let F=!1;ed(D)&&ed(N)?F=!Wx(D,N):F=D!==N,F?D!=null?P(W):p.add(W):D!==void 0&&p.has(W)?P(W):k.protectedKeys[W]=!0}k.prevProp=S,k.prevResolvedValues=A,k.isActive&&(m={...m,...A}),s&&t.blockInitialAnimation&&(j=!1);const _=T&&C;j&&(!_||R)&&h.push(...I.map(W=>{const D={type:v};if(typeof W=="string"&&s&&!_&&t.manuallyAnimateOnMount&&t.parent){const{parent:N}=t,F=mr(N,W);if(N.enteringChildren&&F){const{delayChildren:ne}=F.transition||{};D.delay=Fx(N.enteringChildren,t,ne)}}return{animation:W,options:D}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const v=mr(t,Array.isArray(d.initial)?d.initial[0]:d.initial);v&&v.transition&&(y.transition=v.transition)}p.forEach(v=>{const k=t.getBaseTarget(v),S=t.getValue(v);S&&(S.liveStyle=!0),y[v]=k??null}),h.push({animation:y})}let g=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,d)),n[c].isActive=d;const u=a(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=cp()}}}function vC(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!Wx(e,t):!1}function ks(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function cp(){return{animate:ks(!0),whileInView:ks(),whileHover:ks(),whileTap:ks(),whileDrag:ks(),whileFocus:ks(),exit:ks()}}class gs{constructor(e){this.isMounted=!1,this.node=e}update(){}}class SC extends gs{constructor(e){super(e),e.animationState||(e.animationState=bC(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ml(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let kC=0;class wC extends gs{constructor(){super(...arguments),this.id=kC++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const CC={animation:{Feature:SC},exit:{Feature:wC}};function jo(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}function $o(t){return{point:{x:t.pageX,y:t.pageY}}}const jC=t=>e=>mu(e)&&t(e,$o(e));function lo(t,e,n,s){return jo(t,e,jC(n),s)}const Ux=1e-4,TC=1-Ux,EC=1+Ux,Vx=.01,IC=0-Vx,RC=0+Vx;function on(t){return t.max-t.min}function AC(t,e,n){return Math.abs(t-e)<=n}function dp(t,e,n,s=.5){t.origin=s,t.originPoint=xt(e.min,e.max,t.origin),t.scale=on(n)/on(e),t.translate=xt(n.min,n.max,t.origin)-t.originPoint,(t.scale>=TC&&t.scale<=EC||isNaN(t.scale))&&(t.scale=1),(t.translate>=IC&&t.translate<=RC||isNaN(t.translate))&&(t.translate=0)}function co(t,e,n,s){dp(t.x,e.x,n.x,s?s.originX:void 0),dp(t.y,e.y,n.y,s?s.originY:void 0)}function up(t,e,n){t.min=n.min+e.min,t.max=t.min+on(e)}function _C(t,e,n){up(t.x,e.x,n.x),up(t.y,e.y,n.y)}function hp(t,e,n){t.min=e.min-n.min,t.max=t.min+on(e)}function Va(t,e,n){hp(t.x,e.x,n.x),hp(t.y,e.y,n.y)}function En(t){return[t("x"),t("y")]}const Gx=({current:t})=>t?t.ownerDocument.defaultView:null,pp=(t,e)=>Math.abs(t-e);function MC(t,e){const n=pp(t.x,e.x),s=pp(t.y,e.y);return Math.sqrt(n**2+s**2)}class Hx{constructor(e,n,{transformPagePoint:s,contextWindow:r=window,dragSnapToOrigin:o=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=ql(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,x=MC(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!x)return;const{point:g}=p,{timestamp:y}=Ht;this.history.push({...g,timestamp:y});const{onStart:v,onMove:k}=this.handlers;m||(v&&v(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Hl(m,this.transformPagePoint),ht.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:x,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=ql(p.type==="pointercancel"?this.lastMoveEventInfo:Hl(m,this.transformPagePoint),this.history);this.startEvent&&x&&x(p,v),g&&g(p,v)},!mu(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=r||window;const l=$o(e),c=Hl(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=Ht;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=n;h&&h(e,ql(c,this.history)),this.removeListeners=Bo(lo(this.contextWindow,"pointermove",this.handlePointerMove),lo(this.contextWindow,"pointerup",this.handlePointerUp),lo(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ls(this.updatePoint)}}function Hl(t,e){return e?{point:e(t.point)}:t}function fp(t,e){return{x:t.x-e.x,y:t.y-e.y}}function ql({point:t},e){return{point:t,delta:fp(t,qx(e)),offset:fp(t,PC(e)),velocity:DC(e,.1)}}function PC(t){return t[0]}function qx(t){return t[t.length-1]}function DC(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const r=qx(t);for(;n>=0&&(s=t[n],!(r.timestamp-s.timestamp>ei(e)));)n--;if(!s)return{x:0,y:0};const o=An(r.timestamp-s.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-s.x)/o,y:(r.y-s.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function NC(t,{min:e,max:n},s){return e!==void 0&&t<e?t=s?xt(e,t,s.min):Math.max(t,e):n!==void 0&&t>n&&(t=s?xt(n,t,s.max):Math.min(t,n)),t}function gp(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function zC(t,{top:e,left:n,bottom:s,right:r}){return{x:gp(t.x,n,r),y:gp(t.y,e,s)}}function mp(t,e){let n=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,s]=[s,n]),{min:n,max:s}}function LC(t,e){return{x:mp(t.x,e.x),y:mp(t.y,e.y)}}function OC(t,e){let n=.5;const s=on(t),r=on(e);return r>s?n=vo(e.min,e.max-s,t.min):s>r&&(n=vo(t.min,t.max-r,e.min)),Ni(0,1,n)}function BC(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const id=.35;function FC(t=id){return t===!1?t=0:t===!0&&(t=id),{x:xp(t,"left","right"),y:xp(t,"top","bottom")}}function xp(t,e,n){return{min:yp(t,e),max:yp(t,n)}}function yp(t,e){return typeof t=="number"?t:t[e]||0}const WC=new WeakMap;class $C{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Mt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:s}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const o=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor($o(h).point)},a=(h,p)=>{const{drag:m,dragPropagation:x,onDragStart:g}=this.getProps();if(m&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Kk(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),En(v=>{let k=this.getAxisMotionValue(v).get()||0;if(ti.test(k)){const{projection:S}=this.visualElement;if(S&&S.layout){const w=S.layout.layoutBox[v];w&&(k=on(w)*(parseFloat(k)/100))}}this.originPoint[v]=k}),g&&ht.postRender(()=>g(h,p)),td(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:x,onDirectionLock:g,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:v}=p;if(x&&this.currentDirection===null){this.currentDirection=UC(v),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,v),this.updateAxis("y",p.point,v),this.visualElement.render(),y&&y(h,p)},c=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>En(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Hx(e,{onSessionStart:o,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:Gx(this.visualElement)})}stop(e,n){const s=e||this.latestPointerEvent,r=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!r||!s)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&ht.postRender(()=>l(s,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,s){const{drag:r}=this.getProps();if(!s||!Qo(e,r,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=NC(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&lr(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=zC(s.layoutBox,e):this.constraints=!1,this.elastic=FC(n),r!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&En(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=BC(s.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!lr(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=Vw(s,r.root,this.visualElement.getTransformPagePoint());let a=LC(r.layout.layoutBox,o);if(n){const l=n(Ww(a));this.hasMutatedConstraints=!!l,l&&(a=Ax(l))}return a}startAnimation(e){const{drag:n,dragMomentum:s,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=En(u=>{if(!Qo(u,n,this.currentDirection))return;let h=c&&c[u]||{};a&&(h={min:0,max:0});const p=r?200:1e6,m=r?40:1e7,x={type:"inertia",velocity:s?e[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(e,n){const s=this.getAxisMotionValue(e);return td(this.visualElement,e),s.start(Tu(e,s,0,n,this.visualElement,!1))}stopAnimation(){En(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){En(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[n];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){En(n=>{const{drag:s}=this.getProps();if(!Qo(n,s,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:l}=r.layout.layoutBox[n];o.set(e[n]-xt(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!lr(n)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};En(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();r[a]=OC({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),En(a=>{if(!Qo(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(xt(c,d,r[a]))})}addListeners(){if(!this.visualElement.current)return;WC.set(this.visualElement,this);const e=this.visualElement.current,n=lo(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();lr(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),ht.read(s);const a=jo(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(En(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())}));return()=>{a(),n(),o(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=id,dragMomentum:l=!0}=e;return{...e,drag:n,dragDirectionLock:s,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function Qo(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function UC(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class VC extends gs{constructor(e){super(e),this.removeGroupControls=Mn,this.removeListeners=Mn,this.controls=new $C(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Mn}unmount(){this.removeGroupControls(),this.removeListeners()}}const bp=t=>(e,n)=>{t&&ht.postRender(()=>t(e,n))};class GC extends gs{constructor(){super(...arguments),this.removePointerDownListener=Mn}onPointerDown(e){this.session=new Hx(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Gx(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:bp(e),onStart:bp(n),onMove:s,onEnd:(o,a)=>{delete this.session,r&&ht.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=lo(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ba={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vp(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Gr={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ke.test(t))t=parseFloat(t);else return t;const n=vp(t,e.target.x),s=vp(t,e.target.y);return`${n}% ${s}%`}},HC={correct:(t,{treeScale:e,projectionDelta:n})=>{const s=t,r=cs.parse(t);if(r.length>5)return s;const o=cs.createTransformer(t),a=typeof r[0]!="number"?1:0,l=n.x.scale*e.x,c=n.y.scale*e.y;r[0+a]/=l,r[1+a]/=c;const d=xt(l,c,.5);return typeof r[2+a]=="number"&&(r[2+a]/=d),typeof r[3+a]=="number"&&(r[3+a]/=d),o(r)}};let Kl=!1;class qC extends f.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s,layoutId:r}=this.props,{projection:o}=e;gw(KC),o&&(n.group&&n.group.add(o),s&&s.register&&r&&s.register(o),Kl&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),ba.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:s,drag:r,isPresent:o}=this.props,{projection:a}=s;return a&&(a.isPresent=o,Kl=!0,r||e.layoutDependency!==n||n===void 0||e.isPresent!==o?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||ht.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),gu.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:r}=e;Kl=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Kx(t){const[e,n]=mx(),s=f.useContext(qd);return i.jsx(qC,{...t,layoutGroup:s,switchLayoutGroup:f.useContext(Ix),isPresent:e,safeToRemove:n})}const KC={borderRadius:{...Gr,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Gr,borderTopRightRadius:Gr,borderBottomLeftRadius:Gr,borderBottomRightRadius:Gr,boxShadow:HC};function JC(t,e,n){const s=Zt(t)?t:Ir(t);return s.start(Tu("",s,e,n)),s.animation}const YC=(t,e)=>t.depth-e.depth;class XC{constructor(){this.children=[],this.isDirty=!1}add(e){Yd(this.children,e),this.isDirty=!0}remove(e){Xd(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(YC),this.isDirty=!1,this.children.forEach(e)}}function ZC(t,e){const n=hn.now(),s=({timestamp:r})=>{const o=r-n;o>=e&&(ls(s),t(o-e))};return ht.setup(s,!0),()=>ls(s)}const Jx=["TopLeft","TopRight","BottomLeft","BottomRight"],QC=Jx.length,Sp=t=>typeof t=="string"?parseFloat(t):t,kp=t=>typeof t=="number"||ke.test(t);function ej(t,e,n,s,r,o){r?(t.opacity=xt(0,n.opacity??1,tj(s)),t.opacityExit=xt(e.opacity??1,0,nj(s))):o&&(t.opacity=xt(e.opacity??1,n.opacity??1,s));for(let a=0;a<QC;a++){const l=`border${Jx[a]}Radius`;let c=wp(e,l),d=wp(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||kp(c)===kp(d)?(t[l]=Math.max(xt(Sp(c),Sp(d),s),0),(ti.test(d)||ti.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||n.rotate)&&(t.rotate=xt(e.rotate||0,n.rotate||0,s))}function wp(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const tj=Yx(0,.5,zm),nj=Yx(.5,.95,Mn);function Yx(t,e,n){return s=>s<t?0:s>e?1:n(vo(t,e,s))}function Cp(t,e){t.min=e.min,t.max=e.max}function zn(t,e){Cp(t.x,e.x),Cp(t.y,e.y)}function jp(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function Tp(t,e,n,s,r){return t-=e,t=Ua(t,1/n,s),r!==void 0&&(t=Ua(t,1/r,s)),t}function ij(t,e=0,n=1,s=.5,r,o=t,a=t){if(ti.test(e)&&(e=parseFloat(e),e=xt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=xt(o.min,o.max,s);t===o&&(l-=e),t.min=Tp(t.min,e,n,l,r),t.max=Tp(t.max,e,n,l,r)}function Ep(t,e,[n,s,r],o,a){ij(t,e[n],e[s],e[r],e.scale,o,a)}const sj=["x","scaleX","originX"],rj=["y","scaleY","originY"];function Ip(t,e,n,s){Ep(t.x,e,sj,n?n.x:void 0,s?s.x:void 0),Ep(t.y,e,rj,n?n.y:void 0,s?s.y:void 0)}function Rp(t){return t.translate===0&&t.scale===1}function Xx(t){return Rp(t.x)&&Rp(t.y)}function Ap(t,e){return t.min===e.min&&t.max===e.max}function oj(t,e){return Ap(t.x,e.x)&&Ap(t.y,e.y)}function _p(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Zx(t,e){return _p(t.x,e.x)&&_p(t.y,e.y)}function Mp(t){return on(t.x)/on(t.y)}function Pp(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class aj{constructor(){this.members=[]}add(e){Yd(this.members,e),e.scheduleRender()}remove(e){if(Xd(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let s;for(let r=n;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){s=o;break}}return s?(this.promote(s),!0):!1}promote(e,n){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,n&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:s}=e;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function lj(t,e,n){let s="";const r=t.x.translate/e.x,o=t.y.translate/e.y,a=n?.z||0;if((r||o||a)&&(s=`translate3d(${r}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:x}=n;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),m&&(s+=`skewX(${m}deg) `),x&&(s+=`skewY(${x}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const Jl=["","X","Y","Z"],cj=1e3;let dj=0;function Yl(t,e,n,s){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),s&&(s[t]=0))}function Qx(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=Ox(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",ht,!(r||o))}const{parent:s}=t;s&&!s.hasCheckedOptimisedAppear&&Qx(s)}function e0({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(a={},l=e?.()){this.id=dj++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(pj),this.nodes.forEach(xj),this.nodes.forEach(yj),this.nodes.forEach(fj)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new XC)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new eu),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=gx(a)&&!ew(a),this.instance=a;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;ht.read(()=>{h=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=ZC(p,250),ba.hasAnimatedSinceResize&&(ba.hasAnimatedSinceResize=!1,this.nodes.forEach(zp)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||wj,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),v=!this.targetLayout||!Zx(this.targetLayout,m),k=!h&&p;if(this.options.layoutRoot||this.resumeFrom||k||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const S={...pu(x,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S),this.setAnimationOrigin(u,k)}else h||zp(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ls(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bj),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Qx(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Dp);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Np);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(mj),this.nodes.forEach(uj),this.nodes.forEach(hj)):this.nodes.forEach(Np),this.clearAllSnapshots();const l=hn.now();Ht.delta=Ni(0,1e3/60,l-Ht.timestamp),Ht.timestamp=l,Ht.isProcessing=!0,Ol.update.process(Ht),Ol.preRender.process(Ht),Ol.render.process(Ht),Ht.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,gu.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gj),this.sharedNodes.forEach(vj)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ht.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ht.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!on(this.snapshot.measuredBox.x)&&!on(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Mt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Xx(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(l||ws(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),Cj(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return Mt();const l=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(jj))){const{scroll:d}=this.root;d&&(cr(l.x,d.offset.x),cr(l.y,d.offset.y))}return l}removeElementScroll(a){const l=Mt();if(zn(l,a),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&zn(l,a),cr(l.x,u.offset.x),cr(l.y,u.offset.y))}return l}applyTransform(a,l=!1){const c=Mt();zn(c,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&dr(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ws(u.latestValues)&&dr(c,u.latestValues)}return ws(this.latestValues)&&dr(c,this.latestValues),c}removeTransform(a){const l=Mt();zn(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ws(d.latestValues))continue;Xc(d.latestValues)&&d.updateSnapshot();const u=Mt(),h=d.measurePageBox();zn(u,h),Ip(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ws(this.latestValues)&&Ip(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ht.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Ht.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Mt(),this.targetWithTransforms=Mt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),_C(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zn(this.target,this.layout.layoutBox),Mx(this.target,this.targetDelta)):zn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Xc(this.parent.latestValues)||_x(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Mt(),this.relativeTargetOrigin=Mt(),Va(this.relativeTargetOrigin,l,c),zn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ht.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;zn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;Uw(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Mt());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(jp(this.prevProjectionDelta.x,this.projectionDelta.x),jp(this.prevProjectionDelta.y,this.projectionDelta.y)),co(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!Pp(this.projectionDelta.x,this.prevProjectionDelta.x)||!Pp(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ur(),this.projectionDelta=ur(),this.projectionDeltaWithTransform=ur()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=ur();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=Mt(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,y=this.getStack(),v=!y||y.members.length<=1,k=!!(g&&!v&&this.options.crossfade===!0&&!this.path.some(kj));this.animationProgress=0;let S;this.mixTargetDelta=w=>{const b=w/1e3;Lp(h.x,a.x,b),Lp(h.y,a.y,b),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Va(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Sj(this.relativeTarget,this.relativeTargetOrigin,p,b),S&&oj(this.relativeTarget,S)&&(this.isProjectionDirty=!1),S||(S=Mt()),zn(S,this.relativeTarget)),g&&(this.animationValues=u,ej(u,d,this.latestValues,b,k,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ls(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ht.update(()=>{ba.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ir(0)),this.currentAnimation=JC(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(cj),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&t0(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Mt();const h=on(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const p=on(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}zn(l,c),dr(l,u),co(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new aj),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Yl("z",a,d,this.animationValues);for(let u=0;u<Jl.length;u++)Yl(`rotate${Jl[u]}`,a,d,this.animationValues),Yl(`skew${Jl[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=ya(l?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=ya(l?.pointerEvents)||""),this.hasProjected&&!ws(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=lj(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),a.transform=h;const{x:p,y:m}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in Co){if(u[x]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:v}=Co[x],k=h==="none"?u[x]:g(u[x],d);if(y){const S=y.length;for(let w=0;w<S;w++)a[y[w]]=k}else v?this.options.visualElement.renderState.vars[x]=k:a[x]=k}this.options.layoutId&&(a.pointerEvents=d===this?ya(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(Dp),this.root.sharedNodes.clear()}}}function uj(t){t.updateLayout()}function hj(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=t.layout,{animationType:r}=t.options,o=e.source!==t.layout.source;r==="size"?En(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=on(h);h.min=n[u].min,h.max=h.min+p}):t0(r,e.layoutBox,n)&&En(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=on(n[u]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+p)});const a=ur();co(a,n,e.layoutBox);const l=ur();o?co(l,t.applyTransform(s,!0),e.measuredBox):co(l,n,e.layoutBox);const c=!Xx(a);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const m=Mt();Va(m,e.layoutBox,h.layoutBox);const x=Mt();Va(x,n,p.layoutBox),Zx(m,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function pj(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function fj(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function gj(t){t.clearSnapshot()}function Dp(t){t.clearMeasurements()}function Np(t){t.isLayoutDirty=!1}function mj(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function zp(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function xj(t){t.resolveTargetDelta()}function yj(t){t.calcProjection()}function bj(t){t.resetSkewAndRotation()}function vj(t){t.removeLeadSnapshot()}function Lp(t,e,n){t.translate=xt(e.translate,0,n),t.scale=xt(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function Op(t,e,n,s){t.min=xt(e.min,n.min,s),t.max=xt(e.max,n.max,s)}function Sj(t,e,n,s){Op(t.x,e.x,n.x,s),Op(t.y,e.y,n.y,s)}function kj(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const wj={duration:.45,ease:[.4,0,.1,1]},Bp=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Fp=Bp("applewebkit/")&&!Bp("chrome/")?Math.round:Mn;function Wp(t){t.min=Fp(t.min),t.max=Fp(t.max)}function Cj(t){Wp(t.x),Wp(t.y)}function t0(t,e,n){return t==="position"||t==="preserve-aspect"&&!AC(Mp(e),Mp(n),.2)}function jj(t){return t!==t.root&&t.scroll?.wasRoot}const Tj=e0({attachResizeListener:(t,e)=>jo(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Xl={current:void 0},n0=e0({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Xl.current){const t=new Tj({});t.mount(window),t.setOptions({layoutScroll:!0}),Xl.current=t}return Xl.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Ej={pan:{Feature:GC},drag:{Feature:VC,ProjectionNode:n0,MeasureLayout:Kx}};function $p(t,e,n){const{props:s}=t;t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,o=s[r];o&&ht.postRender(()=>o(e,$o(e)))}class Ij extends gs{mount(){const{current:e}=this.node;e&&(this.unmount=Jk(e,(n,s)=>($p(this.node,s,"Start"),r=>$p(this.node,r,"End"))))}unmount(){}}class Rj extends gs{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Bo(jo(this.node.current,"focus",()=>this.onFocus()),jo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Up(t,e,n){const{props:s}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&s.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),o=s[r];o&&ht.postRender(()=>o(e,$o(e)))}class Aj extends gs{mount(){const{current:e}=this.node;e&&(this.unmount=Qk(e,(n,s)=>(Up(this.node,s,"Start"),(r,{success:o})=>Up(this.node,r,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const sd=new WeakMap,Zl=new WeakMap,_j=t=>{const e=sd.get(t.target);e&&e(t)},Mj=t=>{t.forEach(_j)};function Pj({root:t,...e}){const n=t||document;Zl.has(n)||Zl.set(n,{});const s=Zl.get(n),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(Mj,{root:t,...e})),s[r]}function Dj(t,e,n){const s=Pj(e);return sd.set(t,n),s.observe(t),()=>{sd.delete(t),s.unobserve(t)}}const Nj={some:0,all:1};class zj extends gs{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:Nj[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(c)};return Dj(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(Lj(e,n))&&this.startObserver()}unmount(){}}function Lj({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const Oj={inView:{Feature:zj},tap:{Feature:Aj},focus:{Feature:Rj},hover:{Feature:Ij}},Bj={layout:{ProjectionNode:n0,MeasureLayout:Kx}},Fj={...CC,...Oj,...Ej,...Bj},$=Fw(Fj,Qw);const Wj=J("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const ft=J("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const ds=J("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const ms=J("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);const $j=J("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const Uo=J("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const Uj=J("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);const yl=J("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const Vp=J("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);const qn=J("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const i0=J("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Vj=J("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const Gj=J("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);const bt=J("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const ni=J("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const Ie=J("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Ds=J("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const s0=J("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Gp=J("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const Hp=J("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);const Hj=J("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const Vo=J("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const Ye=J("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const qj=J("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);const Eu=J("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);const Vn=J("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const rd=J("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Kj=J("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const Ar=J("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const r0=J("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);const xr=J("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const o0=J("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const zt=J("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const va=J("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Jj=J("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);const od=J("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const Go=J("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const Yj=J("Frame",[["line",{x1:"22",x2:"2",y1:"6",y2:"6",key:"15w7dq"}],["line",{x1:"22",x2:"2",y1:"18",y2:"18",key:"1ip48p"}],["line",{x1:"6",x2:"6",y1:"2",y2:"22",key:"a2lnyx"}],["line",{x1:"18",x2:"18",y1:"2",y2:"22",key:"8vb6jd"}]]);const Ql=J("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);const Wr=J("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const To=J("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const Xj=J("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const Zj=J("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);const Vs=J("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const ad=J("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const mn=J("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const Qj=J("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const eT=J("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const no=J("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const tT=J("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const ld=J("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const Ga=J("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const a0=J("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const nT=J("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const iT=J("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const sT=J("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const Ze=J("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const l0=J("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const rT=J("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);const oT=J("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);const aT=J("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const lT=J("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);const cT=J("PanelTop",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}]]);const dT=J("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);const bl=J("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);const Ho=J("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);const Iu=J("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const uT=J("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const uo=J("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const Lt=J("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const Yt=J("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const c0=J("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);const hT=J("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);const Ot=J("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const pi=J("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);const d0=J("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ci=J("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);const Ns=J("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const pT=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const Ru=J("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);const di=J("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const fT=J("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);const Bi=J("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const gT=J("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);const vl=J("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);const qo=J("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);const mT=J("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const zs=J("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const xT=J("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const rt=J("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const us=J("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);const Gn=J("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const yT=J("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);const We=J("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const xs=J("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const bT=J("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const qp=J("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const _i=J("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const cd=J("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const u0=J("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);const vT=J("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);const Bt=J("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const Sl=J("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),ea=({onNavigate:t})=>{const{branding:e,user:n}=qe(),{isAuthenticated:s}=ll(),[r,o]=f.useState([]),[a,l]=f.useState(!1),c=e?.["--header-gradient"]||_e["--header-gradient"],d=e?.["--primary-accent"]||_e["--primary-accent"];f.useEffect(()=>{s&&u()},[s]);const u=async()=>{l(!0);try{const b=await Kv(6);o(b||[])}catch(b){console.error("Failed to load recent activities:",b),o([])}l(!1)},p=n?n.first_name?n.first_name:n.display_name?n.display_name.split(" ")[0]:n.name?n.name.split(" ")[0]:null:null,m=[{id:"ikigai",step:"1",title:"Orientierung",subtitle:"Ikigai-Kompass",description:"Finde den Schnittpunkt deiner Talente, Leidenschaften und Mglichkeiten.",icon:Vn,color:E.purple[500],bgLight:E.purple[50],gradient:`linear-gradient(135deg, ${E.purple[400]} 0%, ${E.purple[600]} 100%)`,route:"ikigai"},{id:"decision",step:"2",title:"Entscheiden",subtitle:"Decision-Navigator",description:"Lse dein Dilemma mit KI-gesttzter Pro & Contra Analyse.",icon:ci,color:E.blue[500],bgLight:E.blue[50],gradient:`linear-gradient(135deg, ${E.blue[400]} 0%, ${E.blue[600]} 100%)`,route:"decision_board"},{id:"briefing",step:"3",title:"Vorbereiten",subtitle:"Smart Briefing",description:"Erstelle deinen Schlachtplan mit personalisierten Leitfden.",icon:zt,color:E.amber[500],bgLight:E.amber[50],gradient:`linear-gradient(135deg, ${E.amber[400]} 0%, ${E.amber[600]} 100%)`,route:"smart_briefing"}],x=[{id:"simulator",title:"Szenario Training",subtitle:"Chat-Simulation",description:"be Konflikte und Cases im Messenger-Stil.",icon:Ze,tag:"Text-Chat",color:E.green[500],bgLight:E.green[50],gradient:`linear-gradient(135deg, ${E.green[400]} 0%, ${E.teal[500]} 100%)`,route:"simulator"},{id:"roleplay",title:"Live Simulation",subtitle:"Voice-Roleplay",description:"Fhre Echtzeit-Gesprche mit der KI.",icon:Ue,tag:"Voice-KI",color:E.amber[500],bgLight:E.amber[50],gradient:`linear-gradient(135deg, ${E.amber[400]} 0%, ${E.red[400]} 100%)`,route:"dashboard"},{id:"video",title:"Wirkungsanalyse",subtitle:"Video-Feedback",description:"Analysiere Prsenz, Mimik und Gestik.",icon:jt,tag:"Video-KI",color:E.red[500],bgLight:E.red[50],gradient:`linear-gradient(135deg, ${E.red[400]} 0%, ${E.purple[500]} 100%)`,route:"video_training"},{id:"gym",title:"Rhetorik Gym",subtitle:"Speed-Drills",description:"Trainiere Schlagfertigkeit und Stimme.",icon:Sl,tag:"Drills",color:E.purple[500],bgLight:E.purple[50],gradient:`linear-gradient(135deg, ${E.purple[500]} 0%, ${E.blue[500]} 100%)`,route:"gym_klassiker"}],g={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.15}}},y={hidden:{opacity:0,y:24},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.25,.1,.25,1]}}},v=b=>{t&&t(b)},k=b=>{if(!b)return"";let T=b;/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(b)&&(T=b.replace(" ","T"));const C=new Date(T);if(isNaN(C.getTime()))return"";const R=new Date-C,I=Math.floor(R/6e4),A=Math.floor(I/60),L=Math.floor(A/24);return I<0||I<1?"gerade eben":I<60?`vor ${I} Min.`:A<24?`vor ${A} Std.`:L<7?`vor ${L} Tagen`:C.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})},S=b=>({briefing:"Smart Briefing",simulator:"Szenario-Training",video:"Wirkungs-Analyse",roleplay:"Live-Simulation",game:"Rhetorik-Gym",ikigai:"Ikigai-Kompass",decision:"Entscheidungs-Navigator"})[b]||b,w=b=>({briefing:E.amber[500],simulator:E.green[500],video:E.red[500],roleplay:E.amber[600],game:E.purple[500],ikigai:E.purple[500],decision:E.blue[500]})[b]||E.slate[400];return i.jsxs("div",{className:"min-h-screen py-8 lg:py-12 px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto"},children:[i.jsxs($.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:[.25,.1,.25,1]},className:"text-center mb-14",children:[i.jsx("h1",{style:{fontSize:"clamp(26px, 4.5vw, 38px)",fontWeight:800,color:E.slate[900],marginBottom:"12px",lineHeight:1.2,letterSpacing:"-0.02em"},children:p?i.jsxs(i.Fragment,{children:["Hallo"," ",i.jsx("span",{style:{background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:p}),", wo stehst du?"]}):i.jsxs(i.Fragment,{children:["Willkommen bei"," ",i.jsx("span",{style:{background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Karriereheld"})]})}),i.jsx("p",{style:{fontSize:"clamp(15px, 2vw, 17px)",color:E.slate[500],maxWidth:"420px",margin:"0 auto",lineHeight:1.6},children:"Erst denken, dann handeln. Whle deine Phase."})]}),i.jsxs($.section,{variants:g,initial:"hidden",animate:"visible",style:{marginBottom:"48px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",marginBottom:"24px"},children:[i.jsx("span",{style:{background:`linear-gradient(135deg, ${E.slate[100]} 0%, ${E.slate[200]} 100%)`,color:E.slate[700],padding:"8px 14px",borderRadius:"10px",fontSize:"12px",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Phase 1"}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:700,color:E.slate[800],margin:0},children:"Deine Strategie"})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px"},className:"strategy-grid",children:m.map(b=>i.jsxs($.div,{variants:y,whileHover:{y:-6,transition:{duration:.2}},whileTap:{scale:.98},onClick:()=>v(b.route),style:{background:"white",borderRadius:"20px",padding:"28px",cursor:"pointer",border:`1px solid ${E.slate[100]}`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.04)",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",position:"relative",overflow:"hidden"},onMouseEnter:T=>{T.currentTarget.style.boxShadow=`0 20px 40px -12px ${b.color}25`,T.currentTarget.style.borderColor=`${b.color}30`},onMouseLeave:T=>{T.currentTarget.style.boxShadow="0 4px 20px rgba(0, 0, 0, 0.04)",T.currentTarget.style.borderColor=E.slate[100]},children:[i.jsx("div",{style:{position:"absolute",top:"-30px",right:"-30px",width:"120px",height:"120px",borderRadius:"50%",background:`${b.color}08`,pointerEvents:"none"}}),i.jsx("div",{style:{position:"absolute",top:"20px",right:"20px",width:"32px",height:"32px",borderRadius:"10px",background:b.bgLight,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:700,color:b.color},children:b.step}),i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:b.gradient,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px",boxShadow:`0 8px 20px -4px ${b.color}40`},children:i.jsx(b.icon,{style:{width:"26px",height:"26px",color:"white"}})}),i.jsx("h3",{style:{fontSize:"20px",fontWeight:700,color:E.slate[900],marginBottom:"6px"},children:b.title}),i.jsx("p",{style:{fontSize:"13px",fontWeight:600,color:b.color,marginBottom:"10px"},children:b.subtitle}),i.jsx("p",{style:{fontSize:"14px",color:E.slate[500],lineHeight:1.6,margin:0,minHeight:"44px"},children:b.description}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"10px",background:E.slate[50],display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:i.jsx(ds,{style:{width:"16px",height:"16px",color:E.slate[400]}})})})]},b.id))})]}),i.jsxs($.section,{variants:g,initial:"hidden",animate:"visible",style:{marginBottom:"48px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",marginBottom:"24px"},children:[i.jsx("span",{style:{background:`linear-gradient(135deg, ${E.green[50]} 0%, ${E.green[100]} 100%)`,color:E.green[700],padding:"8px 14px",borderRadius:"10px",fontSize:"12px",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Phase 2"}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:700,color:E.slate[800],margin:0},children:"Trainings-Arena"})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"20px"},className:"training-grid",children:x.map(b=>i.jsxs($.div,{variants:y,whileHover:{y:-6,transition:{duration:.2}},whileTap:{scale:.98},onClick:()=>v(b.route),style:{background:"white",borderRadius:"20px",padding:"26px",cursor:"pointer",border:`1px solid ${E.slate[100]}`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.04)",transition:"all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1)",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column"},onMouseEnter:T=>{T.currentTarget.style.boxShadow=`0 20px 40px -12px ${b.color}25`,T.currentTarget.style.borderColor=`${b.color}30`},onMouseLeave:T=>{T.currentTarget.style.boxShadow="0 4px 20px rgba(0, 0, 0, 0.04)",T.currentTarget.style.borderColor=E.slate[100]},children:[i.jsx("div",{style:{position:"absolute",top:"18px",right:"18px",background:b.bgLight,color:b.color,padding:"6px 12px",borderRadius:"8px",fontSize:"11px",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.3px"},children:b.tag}),i.jsx("div",{style:{width:"52px",height:"52px",borderRadius:"14px",background:b.gradient,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"18px",boxShadow:`0 8px 20px -4px ${b.color}40`},children:i.jsx(b.icon,{style:{width:"24px",height:"24px",color:"white"}})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:E.slate[900],marginBottom:"4px"},children:b.title}),i.jsx("p",{style:{fontSize:"13px",fontWeight:600,color:b.color,marginBottom:"8px"},children:b.subtitle}),i.jsx("p",{style:{fontSize:"14px",color:E.slate[500],lineHeight:1.5,margin:0,flex:1},children:b.description}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"16px"},children:i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"10px",background:E.slate[50],display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(ds,{style:{width:"16px",height:"16px",color:E.slate[400]}})})})]},b.id))})]}),s&&r.length>0&&i.jsx($.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:i.jsxs("div",{style:{background:"white",borderRadius:"20px",padding:"28px",border:`1px solid ${E.slate[100]}`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.04)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:E.slate[100],display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Ye,{style:{width:"18px",height:"18px",color:E.slate[500]}})}),i.jsx("h3",{style:{fontSize:"16px",fontWeight:700,color:E.slate[800],margin:0},children:"Letzte Aktivitten"})]}),i.jsxs("button",{onClick:()=>v("history"),style:{display:"flex",alignItems:"center",gap:"4px",color:d,fontSize:"13px",fontWeight:600,background:"none",border:"none",cursor:"pointer",padding:"6px 10px",borderRadius:"8px",transition:"background 0.2s ease"},onMouseEnter:b=>{b.currentTarget.style.background=E.slate[50]},onMouseLeave:b=>{b.currentTarget.style.background="none"},children:["Alle ansehen",i.jsx(Et,{style:{width:"16px",height:"16px"}})]})]}),a?i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:"32px",color:E.slate[500]},children:[i.jsx("div",{className:"animate-spin",style:{width:"20px",height:"20px",border:`2px solid ${E.slate[200]}`,borderTopColor:d,borderRadius:"50%"}}),"Ldt..."]}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.slice(0,5).map((b,T)=>i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*T},style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 16px",background:E.slate[50],borderRadius:"12px",cursor:"pointer",transition:"all 0.2s ease",border:"1px solid transparent"},onClick:()=>v("history"),onMouseEnter:C=>{C.currentTarget.style.background="white",C.currentTarget.style.borderColor=E.slate[200]},onMouseLeave:C=>{C.currentTarget.style.background=E.slate[50],C.currentTarget.style.borderColor="transparent"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",minWidth:0,flex:1},children:[i.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:w(b.type),flexShrink:0}}),i.jsxs("div",{style:{minWidth:0,flex:1},children:[i.jsx("p",{style:{fontSize:"14px",fontWeight:600,color:E.slate[800],margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:b.title||S(b.type)}),i.jsx("p",{style:{fontSize:"12px",color:E.slate[500],margin:"2px 0 0 0"},children:S(b.type)})]})]}),i.jsx("span",{style:{fontSize:"12px",color:E.slate[400],fontWeight:500,flexShrink:0,marginLeft:"16px"},children:k(b.created_at||b.date)})]},b.id||T))})]})}),!s&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.4},style:{textAlign:"center",padding:"40px 32px",background:"white",borderRadius:"20px",border:`1px solid ${E.slate[100]}`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.04)"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:`linear-gradient(135deg, ${E.blue[50]} 0%, ${E.purple[50]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:i.jsx(gn,{style:{width:"28px",height:"28px",color:E.blue[500]}})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:E.slate[800],marginBottom:"8px"},children:"Verfolge deinen Fortschritt"}),i.jsx("p",{style:{fontSize:"14px",color:E.slate[500],margin:0,maxWidth:"360px",marginLeft:"auto",marginRight:"auto",lineHeight:1.6},children:"Melde dich an, um deinen Fortschritt zu speichern und personalisierte Empfehlungen zu erhalten."})]})]}),i.jsx("style",{children:`
        @media (max-width: 900px) {
          .strategy-grid {
            grid-template-columns: 1fr !important;
          }
          .training-grid {
            grid-template-columns: 1fr !important;
          }
        }
        @media (min-width: 901px) and (max-width: 1100px) {
          .strategy-grid {
            grid-template-columns: repeat(3, 1fr) !important;
          }
          .training-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
        }
      `})]})};var Kp;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(Kp||(Kp={}));var Jp;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Jp||(Jp={}));var Yp;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Yp||(Yp={}));const Xp=["user","model","function","system"];var Zp;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Zp||(Zp={}));var Qp;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Qp||(Qp={}));var ef;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ef||(ef={}));var tf;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(tf||(tf={}));var ho;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(ho||(ho={}));var nf;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(nf||(nf={}));var sf;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(sf||(sf={}));var rf;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(rf||(rf={}));class un extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Ks extends un{constructor(e,n){super(e),this.response=n}}class h0 extends un{constructor(e,n,s,r){super(e),this.status=n,this.statusText=s,this.errorDetails=r}}class is extends un{}const ST="https://generativelanguage.googleapis.com",kT="v1beta",wT="0.21.0",CT="genai-js";var Ls;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ls||(Ls={}));class jT{constructor(e,n,s,r,o){this.model=e,this.task=n,this.apiKey=s,this.stream=r,this.requestOptions=o}toString(){var e,n;const s=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||kT;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||ST}/${s}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function TT(t){const e=[];return t?.apiClient&&e.push(t.apiClient),e.push(`${CT}/${wT}`),e.join(" ")}async function ET(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",TT(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let s=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(r){throw new is(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${r.message}`)}for(const[r,o]of s.entries()){if(r==="x-goog-api-key")throw new is(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new is(`Header name ${r} can only be set using the apiClient field`);n.append(r,o)}}return n}async function IT(t,e,n,s,r,o){const a=new jT(t,e,n,s,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},MT(o)),{method:"POST",headers:await ET(a),body:r})}}async function Ko(t,e,n,s,r,o={},a=fetch){const{url:l,fetchOptions:c}=await IT(t,e,n,s,r,o);return RT(l,c,a)}async function RT(t,e,n=fetch){let s;try{s=await n(t,e)}catch(r){AT(r,t)}return s.ok||await _T(s,t),s}function AT(t,e){let n=t;throw t instanceof h0||t instanceof is||(n=new un(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function _T(t,e){let n="",s;try{const r=await t.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,s=r.error.details)}catch{}throw new h0(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,s)}function MT(t){const e={};if(t?.signal!==void 0||t?.timeout>=0){const n=new AbortController;t?.timeout>=0&&setTimeout(()=>n.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function Au(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Sa(t.candidates[0]))throw new Ks(`${Zi(t)}`,t);return PT(t)}else if(t.promptFeedback)throw new Ks(`Text not available. ${Zi(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Sa(t.candidates[0]))throw new Ks(`${Zi(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),of(t)[0]}else if(t.promptFeedback)throw new Ks(`Function call not available. ${Zi(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Sa(t.candidates[0]))throw new Ks(`${Zi(t)}`,t);return of(t)}else if(t.promptFeedback)throw new Ks(`Function call not available. ${Zi(t)}`,t)},t}function PT(t){var e,n,s,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||r===void 0?void 0:r.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function of(t){var e,n,s,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||r===void 0?void 0:r.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const DT=[ho.RECITATION,ho.SAFETY,ho.LANGUAGE];function Sa(t){return!!t.finishReason&&DT.includes(t.finishReason)}function Zi(t){var e,n,s;let r="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)r+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((s=t.candidates)===null||s===void 0)&&s[0]){const o=t.candidates[0];Sa(o)&&(r+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(r+=`: ${o.finishMessage}`))}return r}function Eo(t){return this instanceof Eo?(this.v=t,this):new Eo(t)}function NT(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),r,o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(p){s[p]&&(r[p]=function(m){return new Promise(function(x,g){o.push([p,m,x,g])>1||l(p,m)})})}function l(p,m){try{c(s[p](m))}catch(x){h(o[0][3],x)}}function c(p){p.value instanceof Eo?Promise.resolve(p.value.v).then(d,u):h(o[0][2],p)}function d(p){l("next",p)}function u(p){l("throw",p)}function h(p,m){p(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}const af=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function zT(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=BT(e),[s,r]=n.tee();return{stream:OT(s),response:LT(r)}}async function LT(t){const e=[],n=t.getReader();for(;;){const{done:s,value:r}=await n.read();if(s)return Au(FT(e));e.push(r)}}function OT(t){return NT(this,arguments,function*(){const n=t.getReader();for(;;){const{value:s,done:r}=yield Eo(n.read());if(r)break;yield yield Eo(Au(s))}})}function BT(t){const e=t.getReader();return new ReadableStream({start(s){let r="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(r.trim()){s.error(new un("Failed to parse stream"));return}s.close();return}r+=a;let c=r.match(af),d;for(;c;){try{d=JSON.parse(c[1])}catch{s.error(new un(`Error parsing JSON response: "${c[1]}"`));return}s.enqueue(d),r=r.substring(c[0].length),c=r.match(af)}return o()})}}})}function FT(t){const e=t[t.length-1],n={promptFeedback:e?.promptFeedback};for(const s of t){if(s.candidates)for(const r of s.candidates){const o=r.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:r.index}),n.candidates[o].citationMetadata=r.citationMetadata,n.candidates[o].groundingMetadata=r.groundingMetadata,n.candidates[o].finishReason=r.finishReason,n.candidates[o].finishMessage=r.finishMessage,n.candidates[o].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[o].content||(n.candidates[o].content={role:r.content.role||"user",parts:[]});const a={};for(const l of r.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),n.candidates[o].content.parts.push(a)}}s.usageMetadata&&(n.usageMetadata=s.usageMetadata)}return n}async function p0(t,e,n,s){const r=await Ko(e,Ls.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),s);return zT(r)}async function f0(t,e,n,s){const o=await(await Ko(e,Ls.GENERATE_CONTENT,t,!1,JSON.stringify(n),s)).json();return{response:Au(o)}}function g0(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function Io(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return WT(e)}function WT(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let s=!1,r=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),r=!0):(e.parts.push(o),s=!0);if(s&&r)throw new un("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!r)throw new un("No content is provided for sending chat message.");return s?e:n}function $T(t,e){var n;let s={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(n=e?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=t.generateContentRequest!=null;if(t.contents){if(r)throw new is("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=t.contents}else if(r)s=Object.assign(Object.assign({},s),t.generateContentRequest);else{const o=Io(t);s.contents=[o]}return{generateContentRequest:s}}function lf(t){let e;return t.contents?e=t:e={contents:[Io(t)]},t.systemInstruction&&(e.systemInstruction=g0(t.systemInstruction)),e}function UT(t){return typeof t=="string"||Array.isArray(t)?{content:Io(t)}:t}const cf=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],VT={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function GT(t){let e=!1;for(const n of t){const{role:s,parts:r}=n;if(!e&&s!=="user")throw new un(`First content should be with role 'user', got ${s}`);if(!Xp.includes(s))throw new un(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(Xp)}`);if(!Array.isArray(r))throw new un("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new un("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of r)for(const c of cf)c in l&&(o[c]+=1);const a=VT[s];for(const l of cf)if(!a.includes(l)&&o[l]>0)throw new un(`Content with role '${s}' can't contain '${l}' part`);e=!0}}const df="SILENT_ERROR";class HT{constructor(e,n,s,r={}){this.model=n,this.params=s,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,s?.history&&(GT(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var s,r,o,a,l,c;await this._sendPromise;const d=Io(e),u={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n);let p;return this._sendPromise=this._sendPromise.then(()=>f0(this._apiKey,this.model,u,h)).then(m=>{var x;if(m.response.candidates&&m.response.candidates.length>0){this._history.push(d);const g=Object.assign({parts:[],role:"model"},(x=m.response.candidates)===null||x===void 0?void 0:x[0].content);this._history.push(g)}else{const g=Zi(m.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}p=m}),await this._sendPromise,p}async sendMessageStream(e,n={}){var s,r,o,a,l,c;await this._sendPromise;const d=Io(e),u={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n),p=p0(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>p).catch(m=>{throw new Error(df)}).then(m=>m.response).then(m=>{if(m.candidates&&m.candidates.length>0){this._history.push(d);const x=Object.assign({},m.candidates[0].content);x.role||(x.role="model"),this._history.push(x)}else{const x=Zi(m);x&&console.warn(`sendMessageStream() was unsuccessful. ${x}. Inspect response object for details.`)}}).catch(m=>{m.message!==df&&console.error(m)}),p}}async function qT(t,e,n,s){return(await Ko(e,Ls.COUNT_TOKENS,t,!1,JSON.stringify(n),s)).json()}async function KT(t,e,n,s){return(await Ko(e,Ls.EMBED_CONTENT,t,!1,JSON.stringify(n),s)).json()}async function JT(t,e,n,s){const r=n.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Ko(e,Ls.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:r}),s)).json()}class uf{constructor(e,n,s={}){this.apiKey=e,this._requestOptions=s,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=g0(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var s;const r=lf(e),o=Object.assign(Object.assign({},this._requestOptions),n);return f0(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},r),o)}async generateContentStream(e,n={}){var s;const r=lf(e),o=Object.assign(Object.assign({},this._requestOptions),n);return p0(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},r),o)}startChat(e){var n;return new HT(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const s=$T(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return qT(this.apiKey,this.model,s,r)}async embedContent(e,n={}){const s=UT(e),r=Object.assign(Object.assign({},this._requestOptions),n);return KT(this.apiKey,this.model,s,r)}async batchEmbedContents(e,n={}){const s=Object.assign(Object.assign({},this._requestOptions),n);return JT(this.apiKey,this.model,e,s)}}class m0{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new un("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new uf(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,s){if(!e.name)throw new is("Cached content must contain a `name` field.");if(!e.model)throw new is("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const a of r)if(n?.[a]&&e[a]&&n?.[a]!==e[a]){if(a==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new is(`Different value for "${a}" specified in modelParams (${n[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new uf(this.apiKey,o,s)}}const x0={FALLBACK_ORDER:["gemini-2.5-flash","gemini-2.0-flash","gemini-1.5-flash-latest"]},Ro={API_KEY_MISSING:"Gemini API key is required",AUDIO_FILE_MISSING:"Audio file is required",TRANSCRIPT_EMPTY:"Transcript is empty",JSON_PARSE_FAILED:"Fehler beim Parsen der Antwort"};function YT(t,e={}){const{roleType:n="interview",userRoleLabel:s="Bewerber",agentRoleLabel:r="Gesprchspartner"}=e;return n==="simulation"?ZT(t,s,r):XT(t,s,r)}function XT(t,e,n){return`Du bist ein professioneller Karriere-Coach. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des ${n} (z.B. "H. Mller", "${n}", oder hnliche Kennzeichnungen) dienen NUR als Kontext fr die Fragen.
- Dein gesamtes Feedback, alle Strken, Verbesserungen, Tipps und Bewertungen beziehen sich NUR auf die Antworten und das Verhalten des/der ${e}.
- Bewerte NICHT die Qualitt der Fragen oder das Verhalten des ${n}.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung des Gesamteindrucks des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung",
    "Strke 2: Was gut gemacht wurde",
    "Strke 3: Weitere Strken"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich",
    "Verbesserung 2: Was besser gemacht werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung",
    "Tipp 2: Praktischer Ratschlag",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Antworten des/der ${e}:
- Struktur & Klarheit der Antworten
- Inhalt & Beispiele, die genannt werden
- Motivation & Begeisterung
- Professionalitt & Selbstbewusstsein

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen.

Transkript:
${t}

JSON Feedback:`}function ZT(t,e,n){return`Du bist ein professioneller Coach fr Kommunikation und Gesprchsfhrung. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

KONTEXT: Dies ist eine Simulation, bei der der/die ${e} das Gesprch fhrt und der/die ${n} darauf reagiert.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des/der ${n} dienen als Kontext fr die Reaktionen.
- Dein gesamtes Feedback bezieht sich NUR auf die Gesprchsfhrung, Reaktionen und das Verhalten des/der ${e}.
- Bewerte die Fhigkeit, das Gesprch professionell zu fhren und auf den/die ${n} einzugehen.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung der Gesprchsfhrung des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung zur Gesprchsfhrung",
    "Strke 2: Was in der Kommunikation gut gemacht wurde",
    "Strke 3: Weitere Strken im Umgang mit dem/der ${n}"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich in der Gesprchsfhrung",
    "Verbesserung 2: Wie besser auf den/die ${n} eingegangen werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung fr hnliche Situationen",
    "Tipp 2: Praktischer Ratschlag zur Gesprchsfhrung",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Gesprchsfhrung des/der ${e}:
- Gesprchsfhrung & Struktur (Wie gut wurde das Gesprch geleitet?)
- Kundenorientierung & Empathie (Wie gut wurde auf den/die ${n} eingegangen?)
- Problemlsungskompetenz (Wie effektiv wurden Anliegen bearbeitet?)
- Professionalitt & Souvernitt (Wie professionell war das Auftreten?)

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen fr die Gesprchsfhrung.

Transkript:
${t}

JSON Feedback:`}function QT(t,e){return t.replace("${transcript}",e)}const e2=["hm","h","h","Mh","Halt","Eigentlich","Sozusagen","Quasi","Irgendwie","Also","Genau","Ja also"];function y0(){return`${e2.slice(0,9).map(e=>`"${e}"`).join(", ")}, "Also" (am Satzanfang), "Genau" (als Fllwort), "Ja also"`}const Ms="[Keine Sprache erkannt]";function b0(){return`ABSOLUTE REGEL - KEINE HALLUZINATION:
Du DARFST NUR transkribieren, was TATSCHLICH in der Audio-Datei gesprochen wird.
- Bei Stille, Rauschen, oder unverstndlichem Audio: transcript = "${Ms}"
- Bei nur 1-2 Sekunden Audio ohne klare Sprache: transcript = "${Ms}"
- ERFINDE NIEMALS Wrter, Stze oder Inhalte!
- Wenn du unsicher bist, ob etwas gesagt wurde: NICHT transkribieren!
- Wenn jemand nur "Wei ich nicht" oder "Keine Ahnung" sagt, transkribiere GENAU DAS
- Eine kurze Antwort wie "Ich wei es nicht" ist eine valide Transkription
- HALLUZINIERE KEINE ausfhrlichen Antworten wenn der Sprecher das nicht gesagt hat`}function _u(t="game"){const e="Es wurde keine Sprache erkannt. Bitte stellen Sie sicher, dass Ihr Mikrofon funktioniert und Sie whrend der Aufnahme sprechen.";switch(t){case"game":return{transcript:Ms,filler_words:[],content_score:0,content_feedback:e};case"analysis":return{audio_metrics:{summary_text:e,confidence_score:0,speech_cleanliness:{score:0,total_filler_count:0,filler_word_analysis:[],feedback:"Keine Sprache zur Analyse erkannt."},pacing:{rating:"keine_sprache",estimated_wpm:0,issues_detected:[],feedback:"Keine Sprache zur Analyse erkannt."},tonality:{rating:"keine_sprache",emotional_tone:"neutral",highlights:[],feedback:"Keine Sprache zur Analyse erkannt."}}};case"simulator":return{transcript:Ms,feedback:{summary:e,strengths:[],improvements:["Bitte versuchen Sie es erneut und sprechen Sie klar und deutlich ins Mikrofon."],tips:["Achten Sie darauf, dass Ihr Mikrofon funktioniert und nicht stummgeschaltet ist."],scores:{content:0,structure:0,relevance:0,delivery:0,overall:0}},audio_metrics:{speech_rate:"keine_sprache",filler_words:{count:0,words:[],severity:"keine"},confidence_score:0,clarity_score:0,notes:"Keine Sprache erkannt"}};default:return{transcript:Ms,error:e}}}const Mu=5e3;function t2(t={}){const{userRoleLabel:e="Bewerber",agentRoleLabel:n="Gesprchspartner",roleType:s="interview",hasTwoVoices:r=!0,transcript:o=null}=t,a=r?`
WICHTIG - STIMMEN-TRENNUNG:
Die Aufnahme enthlt ZWEI Stimmen:
1. ${n.toUpperCase()} (KI-Stimme, synthetisch, akzentfrei)
2. ${e.toUpperCase()} (menschliche Stimme, natrliche Varianz)

Der/Die ${n} erffnet typischerweise das Gesprch.
Analysiere AUSSCHLIESSLICH die Stimme des/der ${e.toUpperCase()}.
Ignoriere alle uerungen des/der ${n} komplett.
`:`
STIMM-ANALYSE:
Die Aufnahme enthlt nur EINE Stimme: ${e.toUpperCase()}.
Analysiere diese Stimme vollstndig.
`,l=o?`
TRANSKRIPT-REFERENZ:
Das folgende Transkript zeigt, wer was gesagt hat. Nutze es zur Orientierung:

${o}

Hinweis: Das Transkript hilft bei der Zuordnung. Die paraverbale Analyse (WIE etwas gesagt wird)
basiert aber auf dem AUDIO - nicht auf dem Text.
`:"";return`Du bist ein professioneller Voice-Coach und Kommunikationsexperte bei "KarriereHeld".
Deine Aufgabe: Analysiere die paraverbale Kommunikation im Audio.

Paraverbal = WIE etwas gesagt wird (nicht WAS gesagt wird).

${b0()}
${a}
${l}

ANALYSE-DIMENSIONEN (nur ${e.toUpperCase()})


1. FLLWRTER (Speech Cleanliness)
   
   Erkenne diese Fllwrter: ${y0()}

   Fr jedes Fllwort dokumentiere:
   - Exakter Zeitstempel (MM:SS)
   - Kontext (z.B. "Satzanfang", "beim Nachdenken", "Themenwechsel")

   Bewertungsmastab:
   - 0 Fllwrter: 100 Punkte (Exzellent)
   - 1-2 Fllwrter: 85-95 Punkte (Sehr gut)
   - 3-5 Fllwrter: 65-80 Punkte (Akzeptabel)
   - 6-10 Fllwrter: 40-60 Punkte (Verbesserungsbedarf)
   - 10+ Fllwrter: 0-35 Punkte (Deutlicher bungsbedarf)

2. SPRECHTEMPO (Pacing)
   
   Optimales Tempo: 120-150 Wrter pro Minute (WPM)

   Achte auf:
   - Durchschnittliches Tempo
   - Tempo-Variationen (monoton vs. dynamisch)
   - Auffllige Stellen (zu schnell/langsam) mit Zeitstempel

   Bewertung:
   - "optimal": 120-150 WPM, natrliche Variation
   - "zu_schnell": >160 WPM, gehetzt, atemlos
   - "zu_langsam": <100 WPM, schleppend, unsicher
   - "ungleichmaessig": Starke Schwankungen

3. TONALITT (Melodie & Betonung)
   
   Analysiere:
   - Stimmmelodie (monoton / natrlich / lebendig)
   - Betonungen (passend / fehlend / bertrieben)
   - Emotionale Frbung (neutral / engagiert / nervs)

   Dokumentiere Highlights und Lowlights:
   - Positive Momente: Souverne Passagen, gute Betonungen
   - Negative Momente: Unsichere Stellen, Stimmbrche, Monotonie

4. SELBSTSICHERHEIT (Confidence)
   
   Gesamteindruck: Wie sicher und kompetent wirkt die Stimme?

   Indikatoren fr hohe Confidence:
    Klare, feste Stimme
    Angemessenes Tempo
    Gute Pausen (bewusst, nicht nervs)
    Natrliche Betonungen

   Indikatoren fr niedrige Confidence:
    Zittrige oder leise Stimme
    Viele Fllwrter
    Hastiges Sprechen
    Aufsteigende Satzenden (Unsicherheit)


OUTPUT FORMAT (nur valides JSON, kein Markdown)


{
  "audio_metrics": {
    "summary_text": "2-3 Stze Gesamtfazit zur Stimmwirkung des/der ${e}. Was war gut? Was kann verbessert werden?",
    "confidence_score": <0-100>,

    "speech_cleanliness": {
      "score": <0-100>,
      "total_filler_count": <Anzahl>,
      "filler_word_analysis": [
        {
          "word": "hm",
          "count": <Anzahl>,
          "examples": [
            {"timestamp": "00:45", "context": "Satzanfang"},
            {"timestamp": "01:20", "context": "beim Nachdenken"}
          ]
        }
      ],
      "feedback": "Konkreter Tipp zur Vermeidung"
    },

    "pacing": {
      "rating": "optimal" | "zu_schnell" | "zu_langsam" | "ungleichmaessig",
      "estimated_wpm": <Zahl>,
      "issues_detected": [
        {"timestamp": "02:10", "issue": "Beschreibung des Problems"}
      ],
      "feedback": "Konkreter Tipp zum Tempo"
    },

    "tonality": {
      "rating": "monoton" | "natrlich" | "lebendig",
      "emotional_tone": "neutral" | "engagiert" | "nervs" | "enthusiastisch",
      "highlights": [
        {"timestamp": "00:30", "type": "positive", "note": "Souverner Einstieg"},
        {"timestamp": "03:15", "type": "negative", "note": "Stimme wird unsicher"}
      ],
      "feedback": "Konkreter Tipp zur Stimmmelodie"
    }
  }
}

Beginne jetzt mit der Analyse:`}const hf=["Warum bin ich die beste Wahl fr diese Position?","Meine grte berufliche Errungenschaft","Was motiviert mich jeden Tag aufzustehen?","Wie ich mit schwierigen Kollegen umgehe","Mein Fhrungsstil in 60 Sekunden","Die wichtigste Lektion meiner Karriere","Wie ich unter Druck arbeite","Warum Teamarbeit mir wichtig ist","Wenn ich ein Tier wre, welches und warum?","Mein perfekter Tag sieht so aus...","Die beste Erfindung der Menschheit","Wenn ich die Welt verndern knnte...","Ein Buch, das mein Leben verndert hat","Mein Lieblingshobby und warum","Drei Dinge, die ich niemals machen wrde","Warum Scheitern wichtig ist","Meine kontroverseste Meinung","Wie ich mit Kritik umgehe"],pf=["Warum sollten wir ausgerechnet Sie einstellen und nicht einen der 50 anderen Bewerber?","Ihr Lebenslauf zeigt eine Lcke. Was haben Sie in dieser Zeit wirklich gemacht?","Nennen Sie mir drei echte Schwchen - und bitte keine getarnten Strken.","Warum haben Sie Ihren letzten Job wirklich verlassen?","Wo sehen Sie sich in 5 Jahren? Und seien Sie ehrlich.","Was wrde Ihr schlimmster Feind ber Sie sagen?","Wenn ich Ihren letzten Chef anrufe - was wird er mir sagen?","Sie sind offensichtlich berqualifiziert. Werden Sie nicht schnell gelangweilt sein?","Warum haben Sie in Ihrer Karriere nicht mehr erreicht?","berzeugen Sie mich in 30 Sekunden, dass Sie kein Risiko sind.","Was war Ihr grter beruflicher Misserfolg?","Haben Sie andere Angebote? Warum sind wir nicht Ihre erste Wahl?"];function n2(t="Elevator Pitch",e=60){return`AUDIO-TRANSKRIPTION UND ANALYSE

THEMA: "${t}"

${b0()}

DEINE AUFGABE (NUR bei klar erkennbarer Sprache):
1. TRANSKRIBIEREN: Schreibe WRTLICH was gesprochen wird - nichts hinzufgen
2. FLLWRTER: Finde diese Wrter im Transkript: ${y0()}
3. INHALT: Bewerte wie gut die Antwort zum Thema passt (0-40 Punkte)

INHALTSBEWERTUNG (content_score):
- 0: Keine Sprache / am Thema vorbei / unverstndlich
- 10: Nur ansatzweise zum Thema
- 20: Teilweise zum Thema, aber oberflchlich
- 30: Gut zum Thema, mit Substanz
- 40: Exzellent, strukturiert und berzeugend

OUTPUT - NUR valides JSON:
{
  "transcript": "${Ms}",
  "filler_words": [],
  "content_score": 0,
  "content_feedback": "Keine Sprache erkannt."
}

ODER bei erkannter Sprache:
{
  "transcript": "Das was tatschlich gesagt wurde...",
  "filler_words": [{"word": "hm", "count": 1}],
  "content_score": 30,
  "content_feedback": "Kurzes Feedback (1-2 Stze)"
}

ANALYSE DER AUDIO-DATEI:`}const i2={excellent:{range:[90,100],messages:["Perfekt! Du bist ein Rhetorik-Champion!","Wow! Makellose Prsentation!","Ausgezeichnet! So sieht ein Profi aus!"],emoji:""},good:{range:[70,89],messages:["Sehr gut! Nur kleine Verbesserungen ntig.","Stark! Fast perfekt!","Beeindruckend! Weiter so!"],emoji:""},medium:{range:[50,69],messages:["Solide Leistung! bung macht den Meister.","Guter Ansatz! Da geht noch mehr.","Auf dem richtigen Weg!"],emoji:""},needsWork:{range:[30,49],messages:["Nicht schlecht, aber hier ist Potenzial!","Die Fllwrter haben dich erwischt!","Bleib dran - Verbesserung ist mglich!"],emoji:""},poor:{range:[0,29],messages:["hm... da mssen wir ben!","Die Fllwrter haben gewonnen. Revanche?","Kopf hoch! Jeder Profi hat so angefangen."],emoji:""}};function s2(t){for(const[,e]of Object.entries(i2))if(t>=e.range[0]&&t<=e.range[1]){const n=Math.floor(Math.random()*e.messages.length);return{message:e.messages[n],emoji:e.emoji}}return{message:"Weiter ben!",emoji:""}}function r2(){return hf[Math.floor(Math.random()*hf.length)]}function o2(){return pf[Math.floor(Math.random()*pf.length)]}const a2={klassiker:{id:"klassiker",title:"Der Klassiker",subtitle:"Elevator Pitch",description:"60 Sekunden, um zu berzeugen. Prsentiere dich selbst ohne Fllwrter!",duration:60,icon:"rocket",color:"blue",topic:"Stelle dich selbst vor - wer bist du, was machst du, was ist dein Ziel?"},zufall:{id:"zufall",title:"Zufalls-Thema",subtitle:"Slot Machine",description:"Ein zuflliges Thema, spontan und flieend prsentiert.",duration:60,icon:"shuffle",color:"purple",getTopic:r2},stress:{id:"stress",title:"Stress-Test",subtitle:"berraschungsfrage",description:"Eine knallharte Interview-Frage. Behalte die Nerven!",duration:90,icon:"zap",color:"red",getTopic:o2}},hr={WEBM:"audio/webm",WEBM_OPUS:"audio/webm;codecs=opus",MP3:"audio/mpeg",WAV:"audio/wav",OGG:"audio/ogg",M4A:"audio/mp4",AAC:"audio/aac"};async function v0(t){return new Promise((e,n)=>{const s=new FileReader;s.onloadend=()=>{const r=s.result.split(",")[1];e(r)},s.onerror=()=>{n(new Error("Failed to read file as base64"))},s.readAsDataURL(t)})}async function S0(t){return{inlineData:{data:await v0(t),mimeType:t.type||hr.WEBM}}}function l2(t){return typeof MediaRecorder>"u"?!1:MediaRecorder.isTypeSupported(t)}function c2(t=[hr.WEBM_OPUS,hr.WEBM,hr.OGG,hr.MP3]){for(const e of t)if(l2(e))return e;return null}function Pu(t,e={}){const{minSize:n=100,maxSize:s=100*1024*1024,allowedTypes:r=Object.values(hr)}=e;return t?t.size<n?{valid:!1,error:"Audio-Datei ist zu klein oder leer"}:t.size>s?{valid:!1,error:"Audio-Datei ist zu gro"}:r.length>0&&t.type&&!r.some(a=>t.type.startsWith(a.split(";")[0]))?{valid:!1,error:`Audio-Format nicht untersttzt: ${t.type}`}:{valid:!0}:{valid:!1,error:"Keine Audio-Datei vorhanden"}}const Os=!1;function k0(t){return t.message?.includes("404")||t.message?.includes("not found")}function d2(t){return t.message?.includes("API key")}function u2(t,e){const n=x0.FALLBACK_ORDER.join(", ");return k0(t)?`Kein Gemini-Modell verfgbar. Versuchte Modelle: ${n}

Mgliche Lsungen:
1. berprfe, ob dein API Key gltig ist
2. Stelle sicher, dass die Gemini API aktiviert ist
3. Besuche https://ai.google.dev/ um deinen API-Key zu berprfen

Fehler: ${t.message}`:d2(t)?`API Key Problem: ${t.message}

Stelle sicher, dass:
1. VITE_GEMINI_API_KEY korrekt in der .env Datei gesetzt ist
2. Der API Key gltig ist (berprfe auf https://ai.google.dev/)`:t.message||"Unbekannter Fehler"}async function Gs({apiKey:t,content:e,context:n}){const s=`[GEMINI ${n}]`;if(!t)throw console.error(` ${s} API key is missing`),new Error(Ro.API_KEY_MISSING);let r=null;for(const a of x0.FALLBACK_ORDER)try{return(await(await new m0(t).getGenerativeModel({model:a}).generateContent(e)).response).text()}catch(l){if(console.error(` ${s} Error with ${a}:`,l.message),r=l,k0(l))continue;break}const o=u2(r);throw new Error(`Fehler bei der ${n}: ${o}`)}async function h2(t,e,n="gemini-1.5-flash",s=null,r={}){if(!t||t.trim().length===0)throw console.error(" [GEMINI FEEDBACK] Transcript is empty"),new Error(Ro.TRANSCRIPT_EMPTY);const o=s?QT(s,t):YT(t,r),a=r.roleType==="simulation"?"Simulation":"Interview",l=r.userRoleLabel||"Bewerber";`${a}${l}`,`${t.length}`,t.substring(0,300);const c=await Gs({apiKey:e,content:o,context:"FEEDBACK"});return ce.logPrompt("GEMINI_LIVE_FEEDBACK",`Live-Training Feedback-Generierung (${a})`,o,{transcript_length:t.length,custom_prompt:s?"Ja":"Nein",role_type:r.roleType||"interview",user_role_label:l},c),c}async function p2(t,e,n="gemini-1.5-flash",s={}){if(!t)throw console.error(" [GEMINI AUDIO] Audio file is missing"),new Error(Ro.AUDIO_FILE_MISSING);const r=Pu(t,{minSize:Mu});if(!r.valid)return console.warn(` [GEMINI AUDIO] Audio validation failed: ${r.error}, Size: ${t.size} bytes`),JSON.stringify(_u("analysis"));const o=s.userRoleLabel||"Bewerber",a=s.agentRoleLabel||"Gesprchspartner",l=s.roleType||"interview",c=s.hasTwoVoices!==!1,d=s.transcript||null,u=await S0(t),h=t2({userRoleLabel:o,agentRoleLabel:a,roleType:l,hasTwoVoices:c,transcript:d}),p=[h,u];`${o}`,`${Math.round(t.size/1024)}`,t.type;const m=await Gs({apiKey:e,content:p,context:"AUDIO"});return ce.logPrompt("GEMINI_LIVE_AUDIO_ANALYSIS",`Live-Training Audio-Analyse (${o})`,h,{audio_size_kb:Math.round(t.size/1024),audio_type:t.type,role_type:l,user_role_label:o},m),m}async function f2(t,e,n="Elevator Pitch",s=60){if(!t)throw console.error(" [GEMINI GAME] Audio file is missing"),new Error(Ro.AUDIO_FILE_MISSING);const r=Pu(t,{minSize:Mu});if(!r.valid)return console.warn(` [GEMINI GAME] Audio validation failed: ${r.error}, Size: ${t.size} bytes`),_u("game");const o=await S0(t),l=[n2(n,s),o];`${Math.round(t.size/1024)}`;const c=await Gs({apiKey:e,content:l,context:"GAME"});try{let d=c.trim();d.startsWith("```json")?d=d.replace(/```json\n?/,"").replace(/\n?```$/,""):d.startsWith("```")&&(d=d.replace(/```\n?/,"").replace(/\n?```$/,""));const u=JSON.parse(d);return{transcript:u.transcript||Ms,filler_words:u.filler_words||[],content_score:Math.max(0,Math.min(40,u.content_score||0)),content_feedback:u.content_feedback||""}}catch(d){throw console.error(" [GEMINI GAME] Failed to parse response:",d),console.error(" [GEMINI GAME] Raw response:",c),new Error(`${Ro.JSON_PARSE_FAILED}: ${d.message}`)}}async function g2(t,e){const{topic:n,context:s,pros:r,cons:o,proScore:a,contraScore:l}=t;if(!n||n.trim().length===0)throw new Error("Entscheidungsfrage fehlt");const c=r.map(m=>`- "${m.text}" (Gewicht: ${m.weight}/10)`).join(`
`),d=o.map(m=>`- "${m.text}" (Gewicht: ${m.weight}/10)`).join(`
`),u=s?`
Situationsbeschreibung des Users:
"${s}"
`:"",h=`Du bist 'Decisio', ein analytischer Entscheidungs-Coach.
Deine Aufgabe: Analysiere die Entscheidungsmatrix des Users (Thema, Pro/Contra mit Gewichtung 1-10).
Ziel: Deck blinde Flecken auf und hinterfrage die Gewichtung kritisch. Nimm dem User die Entscheidung NICHT ab, sondern verbessere seine Datengrundlage.

INPUT:
Thema: ${n}
${u}
Pro-Liste (Gesamtpunkte: ${a}):
${c||"(keine Pro-Argumente)"}

Contra-Liste (Gesamtpunkte: ${l}):
${d||"(keine Contra-Argumente)"}

Rationaler Score: ${a>l?"Pro fhrt":l>a?"Contra fhrt":"Ausgeglichen"} (${a} vs ${l})

GENERATION RULES:
1. "Blind Spot": Welcher Lebensbereich (Gesundheit, Langzeit, Familie, Werte, Finanzen, Karriere, Work-Life-Balance) fehlt? Welche Perspektive wurde nicht bercksichtigt?
2. "Challenger": Identifiziere das INTERESSANTESTE oder KRITISCHSTE Argument (nicht unbedingt das mit der hchsten Gewichtung). Whle das Argument, das am meisten hinterfragt werden sollte - vielleicht weil die Bewertung unrealistisch wirkt, wichtige Aspekte ignoriert werden, oder es auf Annahmen basiert die geprft werden sollten.
3. "Intuition": Stelle eine systemische Frage (z.B. 10-10-10 Methode: Wie wirst du in 10 Minuten/10 Monaten/10 Jahren darber denken? Oder: Was wrdest du einem Freund in dieser Situation raten?), um das Bauchgefhl zu prfen.

WICHTIG: Antworte AUSSCHLIESSLICH mit einem validen JSON-Objekt. Kein Markdown, kein Intro, keine Erklrung auerhalb des JSON.

FORMATIERUNG DER INHALTE:
- Jede Card soll STRUKTURIERT sein, NICHT als Flietext
- Verwende kurze, prgnante Aufzhlungspunkte
- Maximal 3-5 Punkte pro Card
- Jeder Punkt soll ein konkreter, handlungsorientierter Gedanke sein

JSON SCHEMA:
{
  "analysis_summary": "Ein bis zwei Stze zum rationalen Ergebnis.",
  "cards": [
    {
      "type": "blind_spot",
      "title": "Der blinde Fleck",
      "points": [
        "Erster fehlender Aspekt oder Lebensbereich",
        "Zweiter fehlender Aspekt",
        "Dritter fehlender Aspekt (optional)"
      ]
    },
    {
      "type": "challenger",
      "title": "Der Hrtetest",
      "argument": "NUR der Text des Arguments, OHNE Gewicht (z.B. Mehr Gehalt oder Flexible Arbeitszeiten)",
      "points": [
        "Erste kritische Frage zum Argument",
        "Zweite kritische Frage",
        "Dritte kritische Frage (optional)"
      ]
    },
    {
      "type": "intuition",
      "title": "Der Bauch-Check",
      "question": "Die zentrale Reflexionsfrage (z.B. '10-10-10 Methode')",
      "points": [
        "Erster Reflexionsimpuls",
        "Zweiter Reflexionsimpuls",
        "Dritter Reflexionsimpuls (optional)"
      ]
    }
  ]
}`;r.length,o.length,Math.max(...r.map(m=>m.weight),...o.map(m=>m.weight));const p=await Gs({apiKey:e,content:h,context:"DECISION"});try{let m=p.trim();m.startsWith("```json")?m=m.replace(/^```json\s*\n?/,""):m.startsWith("```")&&(m=m.replace(/^```\s*\n?/,"")),m=m.replace(/\n?```\s*$/,"").trim(),m=m.replace(/"\s*\(Gewicht:\s*\d+\/10\)"/g,'"');const x=JSON.parse(m);if(!x.cards||!Array.isArray(x.cards))throw new Error("Invalid response structure: missing cards array");return ce.logPrompt("GEMINI_DECISION_ANALYSIS","Entscheidungs-Kompass Analyse",h,{topic:n,context:s?"vorhanden":"nicht angegeben",pro_count:r.length,contra_count:o.length,pro_score:a,contra_score:l},p),x}catch(m){throw console.error(" [GEMINI DECISION] Failed to parse response:",m),console.error(" [GEMINI DECISION] Raw response:",p),new Error(`Fehler beim Verarbeiten der Analyse: ${m.message}`)}}async function ff(t,e,n,s=null,r=[],o=[]){if(!t||t.trim().length===0)throw new Error("Entscheidungsfrage fehlt");if(!["strategist","security","feelgood","growth","future"].includes(e))throw new Error(`Ungltige Persona: ${e}`);const l=s?`
Situationsbeschreibung:
"${s}"
`:"",c=r.filter(m=>m.text?.trim()).map(m=>`- ${m.text}`),d=o.filter(m=>m.text?.trim()).map(m=>`- ${m.text}`);let u="";(c.length>0||d.length>0)&&(u=`
BEREITS ERFASSTE ARGUMENTE DES USERS:
Nutze diese als Kontext, um ERGNZENDE Perspektiven zu generieren. Wiederhole NICHT dieselben Punkte, sondern baue darauf auf oder beleuchte andere Aspekte.`,c.length>0&&(u+=`
Pro-Argumente:
${c.join(`
`)}`),d.length>0&&(u+=`
Contra-Argumente:
${d.join(`
`)}`),u+=`
`);const h=`Du bist ein kreativer Entscheidungs-Assistent fr die Karriere-Plattform 'KarriereHeld'.
Deine Aufgabe: Generiere fr eine spezifische Entscheidungsfrage Argumente aus der strikten Sicht einer gewhlten Persona.
${l?"WICHTIG: Bercksichtige unbedingt die Situationsbeschreibung des Users - seine Wnsche, ngste und Rahmenbedingungen!":""}

INPUT:
Thema: ${t}${l}${u}
Persona: ${e}

PERSONA DEFINITIONEN:
- 'strategist' (Der Stratege): Fokus auf CV, Marktwert, Geld, Macht, Karriereleiter, Prestige.
- 'security' (Der Sicherheits-Beauftragte): Fokus auf Arbeitsplatzsicherheit, Gehaltsgarantie, Risikominimierung, Bestndigkeit.
- 'feelgood' (Der Feel-Good Manager): Fokus auf Mental Health, Stresslevel, Team-Kultur, Zeit fr Familie, Spa.
- 'growth' (Der Grnder): Fokus auf steile Lernkurve, Innovation, Netzwerk, "High Risk / High Reward".
- 'future' (Das Zukunfts-Ich): Fokus auf langfristigen Sinn, "Regret Minimization" (Was werde ich in 10 Jahren bereuen?), Lebensziele.

OUTPUT FORMAT (JSON):
Generiere genau 4 Vorschlge (2 Pro, 2 Contra), die extrem kurz und knackig sind (max. 10 Wrter pro Punkt).

WICHTIG: Antworte AUSSCHLIESSLICH mit einem validen JSON-Objekt. Kein Markdown, kein Intro.

{
  "suggestions": [
    { "type": "pro", "text": "Argument fr JA aus Sicht der Persona" },
    { "type": "pro", "text": "Weiteres Argument fr JA..." },
    { "type": "con", "text": "Argument fr NEIN aus Sicht der Persona" },
    { "type": "con", "text": "Weiteres Argument fr NEIN..." }
  ]
}`,p=await Gs({apiKey:n,content:h,context:"BRAINSTORM"});try{let m=p.trim();m.startsWith("```json")?m=m.replace(/```json\n?/,"").replace(/\n?```$/,""):m.startsWith("```")&&(m=m.replace(/```\n?/,"").replace(/\n?```$/,""));const x=JSON.parse(m);if(!x.suggestions||!Array.isArray(x.suggestions))throw new Error("Invalid response structure: missing suggestions array");return ce.logPrompt("GEMINI_DECISION_BRAINSTORM",`Entscheidungs-Kompass Brainstorming (${e})`,h,{topic:t,context:s?"vorhanden":"nicht angegeben",persona:e},p),x}catch(m){throw console.error(" [GEMINI BRAINSTORM] Failed to parse response:",m),console.error(" [GEMINI BRAINSTORM] Raw response:",p),new Error(`Fehler beim Verarbeiten der Vorschlge: ${m.message}`)}}async function m2(t,e=[],n=[],s=[],r){if(!t||t.trim().length===0)throw new Error("Entscheidungsfrage fehlt");const o=e.filter(u=>u.text?.trim()).map(u=>`- ${u.text}`).join(`
`)||"(keine)",a=n.filter(u=>u.text?.trim()).map(u=>`- ${u.text}`).join(`
`)||"(keine)";let l="";s.length>0&&(l=`
BISHERIGER GESPRCHSVERLAUF:
`+s.map((u,h)=>`Frage ${h+1}: "${u.question}"
Antwort: "${u.answer}"`).join(`

`));const c=`Du bist ein einfhlsamer systemischer Coach, der Menschen hilft, versteckte Motive und Gefhle bei wichtigen Entscheidungen zu entdecken.

ENTSCHEIDUNGSTHEMA: "${t}"

BEREITS ERFASSTE ARGUMENTE:
Pro:
${o}

Contra:
${a}
${l}

DEINE AUFGABE:
1. Analysiere, welche PERSPEKTIVE oder welcher LEBENSBEREICH noch nicht beleuchtet wurde
2. Identifiziere eine LCKE (z.B. fehlen Emotionen? Langzeitperspektive? Werte? Beziehungen? ngste? Trume?)
3. Stelle GENAU EINE tiefgrndige, offene Frage, um diese Lcke zu fllen

FRAGE-TECHNIKEN (whle passend):
- Wunderfrage: "Stell dir vor, du wachst morgen auf und alles ist perfekt gelst..."
- Worst-Case: "Was ist das Schlimmste, das passieren knnte, wenn..."
- Zukunfts-Ich: "Stell dir vor, es ist 5 Jahre spter..."
- Werte-Check: "Was sagt diese Entscheidung ber das aus, was dir wirklich wichtig ist?"
- Bauchgefhl: "Wenn du ganz ehrlich bist, was sagt dein Krper dazu?"
- Mentor-Perspektive: "Was wrde dir jemand raten, der dich sehr gut kennt?"

REGELN:
- Verwende die "Du"-Form (persnlich, warm)
- Halte die Frage kurz (max. 2 Stze)
- Vermeide Wiederholungen von bereits gestellten Fragen
- Die Frage soll zum Nachdenken anregen, nicht suggestiv sein

AUSGABE (nur JSON, kein Markdown):
{
  "question": "Deine Frage hier...",
  "question_type": "wunderfrage|worst_case|zukunft|werte|bauchgefhl|mentor|andere",
  "targets_gap": "Kurze Beschreibung, welche Lcke diese Frage adressiert"
}`,d=await Gs({apiKey:r,content:c,context:"WIZARD_QUESTION"});try{let u=d.trim();u.startsWith("```json")?u=u.replace(/```json\n?/,"").replace(/\n?```$/,""):u.startsWith("```")&&(u=u.replace(/```\n?/,"").replace(/\n?```$/,""));const h=JSON.parse(u);return ce.logPrompt("GEMINI_WIZARD_QUESTION","Deep Dive Wizard - Frage generieren",c,{topic:t,existing_pros:e.length,existing_cons:n.length},d),h}catch(u){throw console.error(" [GEMINI WIZARD] Failed to parse question response:",u),new Error(`Fehler beim Generieren der Frage: ${u.message}`)}}async function x2(t,e,n,s){if(!n||n.trim().length<10)return{extracted_items:[],message:"Antwort zu kurz fr Analyse"};const r=`Du bist ein Daten-Analyst fr Entscheidungsprozesse. Deine Aufgabe ist es, aus Freitext-Antworten strukturierte Argumente zu extrahieren.

KONTEXT:
Entscheidungsthema: "${t}"
Gestellte Frage: "${e}"

ANTWORT DES USERS:
"${n}"

DEINE AUFGABE:
1. Identifiziere die KERN-ARGUMENTE im Text (max. 3 Stck)
2. Klassifiziere jedes als "pro" (spricht FR das Thema/JA) oder "con" (spricht DAGEGEN/NEIN)
3. Formuliere sie in KURZE, PRGNANTE Stichpunkte um (substantivisch, max. 8 Wrter)
4. Schtze die WICHTIGKEIT (weight 1-10) basierend auf:
   - Emotionale Intensitt der Wortwahl
   - Wie oft/ausfhrlich der Punkt erwhnt wird
   - Krperliche Reaktionen (Bauchgefhl, Stress, etc.)

BEISPIELE fr gute Extraktionen:
- "Ich kriege immer Bauchschmerzen"  "Krperliche Stressreaktion", weight: 8-9
- "Das Geld ist halt wichtig"  "Finanzielle Sicherheit", weight: 6-7
- "Ich trume davon seit Jahren"  "Langgehegter Lebenstraum", weight: 9

WICHTIG:
- Wenn der Text keine klaren Argumente enthlt (z.B. "wei nicht", zu vage), gib ein leeres Array zurck
- Extrahiere NUR das, was der User tatschlich gesagt hat - erfinde nichts dazu
- Pro/Con bezieht sich auf das THEMA, nicht auf die Frage

AUSGABE (nur JSON, kein Markdown):
{
  "extracted_items": [
    {
      "type": "pro|con",
      "text": "Kurzer prgnanter Stichpunkt",
      "weight": 1-10,
      "source_quote": "Originalzitat aus der Antwort"
    }
  ],
  "analysis_note": "Kurze Notiz, was du erkannt hast (optional)"
}`,o=await Gs({apiKey:s,content:r,context:"WIZARD_EXTRACT"});try{let a=o.trim();a.startsWith("```json")?a=a.replace(/```json\n?/,"").replace(/\n?```$/,""):a.startsWith("```")&&(a=a.replace(/```\n?/,"").replace(/\n?```$/,""));const l=JSON.parse(a);return ce.logPrompt("GEMINI_WIZARD_EXTRACT","Deep Dive Wizard - Argumente extrahieren",r,{topic:t,question_length:e.length,answer_length:n.length},o),l}catch(a){throw console.error(" [GEMINI EXTRACT] Failed to parse extraction response:",a),new Error(`Fehler beim Extrahieren der Argumente: ${a.message}`)}}function w0(t){return!t||typeof t!="string"?t:t.replace(/\\u([0-9a-fA-F]{4})/g,(e,n)=>String.fromCharCode(parseInt(n,16))).replace(new RegExp("(?<!\\\\)u([0-9a-fA-F]{4})","g"),(e,n)=>{const s=parseInt(n,16);return s>=160&&s<=65535?String.fromCharCode(s):e})}function y2(t){if(!t||typeof t!="string")return t;let e=t.trim();return e.startsWith("```json")?e=e.replace(/^```json\s*/i,"").replace(/\s*```\s*$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```\s*$/,"")),e.trim()}function Du(t,e={}){const{silent:n=!1,context:s="JSON"}=e;if(t==null)return null;if(typeof t=="object")return t;if(typeof t!="string")return n||console.warn(`[parseJSON] Expected string or object, got ${typeof t}`),null;try{let r=y2(t);return r=w0(r),JSON.parse(r)}catch(r){return n||(console.error(`[parseJSON] Failed to parse ${s}:`,r.message),console.error(`[parseJSON] Input preview: ${t.substring(0,100)}...`)),null}}function Nu(t){return Du(t,{context:"feedback_json"})}function zu(t){return Du(t,{context:"audio_analysis_json"})}function C0(t){if(!t)return[];const e=Du(t,{context:"transcript"});return Array.isArray(e)?e:[]}function Ha(t){if(t==null)return t;if(typeof t=="string")return w0(t);if(Array.isArray(t))return t.map(Ha);if(typeof t=="object"){const e={};for(const n of Object.keys(t))e[n]=Ha(t[n]);return e}return t}const ta=t=>new Promise(e=>setTimeout(e,t));async function b2(t,e={},n=null,s=null){if(!t||t.length===0)throw new Error("Transkript ist leer. Das Gesprch muss mindestens einen Austausch enthalten.");const r=v2(t,e),o=ce.getGeminiApiKey();if(!o)throw new Error("Gemini API Key ist nicht konfiguriert. Bitte kontaktiere den Administrator.");const a={feedbackContent:null,audioAnalysisContent:null},l={roleType:e.role_type||"interview",userRoleLabel:e.user_role_label||"Bewerber",agentRoleLabel:e.interviewer_profile?.role||"Gesprchspartner"};try{const c=e.feedback_prompt||null;a.feedbackContent=await h2(r,o,"gemini-1.5-flash",c,l)}catch(c){throw console.error(" [Roleplay Feedback] Failed to generate feedback:",c),new Error(`Fehler bei der Feedback-Generierung: ${c.message}`)}if(n){s&&s("audio_analysis");try{a.audioAnalysisContent=await p2(n,o,"gemini-1.5-flash",{...l,hasTwoVoices:!0,transcript:r})}catch(c){console.error(" [Roleplay Feedback] Failed to generate audio analysis:",c),a.audioAnalysisContent=JSON.stringify({error:!0,summary:"Audio-Analyse konnte nicht durchgefhrt werden.",errorMessage:c.message,troubleshooting:["Stelle sicher, dass dein Mikrofon richtig funktioniert","Versuche das Gesprch erneut zu starten","berprfe, ob keine andere Anwendung das Mikrofon blockiert"]})}}return a}function v2(t,e={}){let n="";e.title&&(n+=`Rollenspiel-Szenario: ${e.title}
`),e.description&&(n+=`Beschreibung: ${e.description}
`),e.variables&&(n+=`
Kontext-Variablen:
`,Object.entries(e.variables).forEach(([o,a])=>{n+=`- ${o}: ${a}
`})),n+=`
--- Gesprchsverlauf ---

`;const s=e.user_role_label||"Bewerber",r=e.interviewer_profile?.role||"Gesprchspartner";return t.forEach(o=>{const a=o.role==="agent"?r:s;n+=`${a}: ${o.text}

`}),n}async function S2(t,e,n,s=null,r=0,o=null){try{let a=e;Array.isArray(e)&&(a=JSON.stringify(e));const l={transcript:a,feedback_json:n,duration:r};s&&(l.audio_analysis_json=s),o&&(l.conversation_id=o);const c=await ce.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify(l)});if(r>0)try{await ce.request(`/roleplays/sessions/${t}/duration`,{method:"POST",body:JSON.stringify({duration_seconds:r})})}catch(d){console.warn(" [Roleplay Feedback] Failed to update usage limits:",d.message)}return c.data}catch(a){throw console.error(" [Roleplay Feedback] ========= SAVE FAILED ========="),console.error(" [Roleplay Feedback] Error:",a),console.error(" [Roleplay Feedback] Error message:",a.message),new Error(`Fehler beim Speichern der Analyse: ${a.message}`)}}async function Lu(t){try{return(await ce.request(`/roleplays/sessions/${t}`,{method:"GET"})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to load session analysis:",e),new Error(`Fehler beim Laden der Analyse: ${e.message}`)}}async function k2(t={}){try{const e=new URLSearchParams(t).toString(),n=e?`/roleplays/sessions?${e}`:"/roleplays/sessions";return await ce.request(n,{method:"GET"})}catch(e){throw console.error(" [Roleplay Feedback] Failed to load sessions:",e),new Error(`Fehler beim Laden der Sessions: ${e.message}`)}}function Ou(t){return`${(window.bewerbungstrainerConfig||{apiUrl:"/wp-json/bewerbungstrainer/v1"}).apiUrl}/roleplays/sessions/${t}/audio`}async function w2(t,e=10,n=3e3){const s=Ou(t);for(let r=1;r<=e;r++)try{const o=await fetch(s,{method:"GET",headers:{"X-WP-Nonce":At()},credentials:"same-origin"});if(o.ok){const a=await o.blob();if(a.size===0){if(console.warn(" [Roleplay Feedback] Audio blob is empty, retrying..."),r<e){await ta(n);continue}return null}return a}if(o.status===404&&r<e){await ta(n);continue}if(console.error(` [Roleplay Feedback] Failed to fetch audio: HTTP ${o.status}`),r<e){await ta(n);continue}}catch(o){if(console.error(` [Roleplay Feedback] Error fetching audio on attempt ${r}:`,o),r<e){await ta(n);continue}}return console.warn(" [Roleplay Feedback] All retry attempts failed, audio not available"),null}async function C2(t,e){try{return(await ce.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify({conversation_id:e})})).data}catch(n){throw console.error(" [Roleplay Feedback] Failed to update session conversation_id:",n),new Error(`Fehler beim Aktualisieren der Session: ${n.message}`)}}async function j2(t){try{return(await ce.request("/roleplays/sessions",{method:"POST",body:JSON.stringify(t)})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to create session:",e),new Error(`Fehler beim Erstellen der Session: ${e.message}`)}}async function j0(){try{const t=await fetch(`${vn()}/roleplays`,{headers:{"X-WP-Nonce":At()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();return Ha(e.data||[])}catch(t){throw console.error(" [Roleplay Feedback] Failed to load scenarios:",t),new Error(`Fehler beim Laden der Szenarien: ${t.message}`)}}async function T0(t){try{const e=await ce.request(`/roleplays/${t}`,{method:"GET"});return Ha(e.data)}catch(e){throw console.error(" [Roleplay Feedback] Failed to load scenario:",e),new Error(`Fehler beim Laden des Szenarios: ${e.message}`)}}const T2={briefcase:jn,users:wn,"trending-up":gn,"message-circle":Oi,shield:Bi,heart:Vs,target:rt,folder:Go},Qi=Go,Tn=t=>!t||typeof t!="string"?Qi:T2[t.toLowerCase()]||Qi,Js=t=>!t||typeof t!="string"?"":t.toLowerCase().replace(//g,"ae").replace(//g,"oe").replace(//g,"ue").replace(//g,"ss").replace(/[^a-z0-9]/g,""),ec={career:"karriere",leadership:"fuehrung",sales:"vertrieb",communication:"kommunikation",service:"service",social:"social",karriere:"karriere",fuehrung:"fuehrung",vertrieb:"vertrieb",kommunikation:"kommunikation",meine:"meine",selfpresentation:"karriere",interview:"karriere",pitch:"vertrieb",negotiation:"vertrieb",vorstellungsgespraech:"karriere",gehaltsverhandlung:"vertrieb",fuehrungsgespraech:"fuehrung",praesentation:"kommunikation",selbstvorstellung:"karriere",training:"kommunikation"};let Ys=null,tc=null;const E2=300*1e3;function I2(){const[t,e]=f.useState(Ys||[]),[n,s]=f.useState(!Ys),[r,o]=f.useState(null),a=f.useCallback(async()=>{if(Ys&&tc&&Date.now()-tc<E2)return e(Ys),s(!1),Ys;try{s(!0),o(null);const p=await ce.getCategories();return Ys=p,tc=Date.now(),e(p),p}catch(p){return console.error("[useCategories] Failed to fetch categories:",p),o(p.message||"Failed to fetch categories"),[]}finally{s(!1)}},[]);f.useEffect(()=>{a()},[a]);const l=f.useCallback(p=>{if(!p||!t.length)return null;const m=Js(p),x=ec[m]||m,g=t.find(y=>Js(y.slug)===x||Js(y.name)===x);return g?{...g,IconComponent:Tn(g.icon),bgColor:`${g.color}15`}:null},[t]),c=f.useCallback(p=>{if(Array.isArray(p)){for(const g of p){if(typeof g!="string")continue;const y=l(g);if(y)return{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:Tn(y.icon),IconComponent:Tn(y.icon),color:y.color,bgColor:y.bgColor}}const x=p.find(g=>typeof g=="string")||"unknown";return{key:String(x),label:String(x),shortLabel:String(x),icon:Qi,IconComponent:Qi,color:"#64748b",bgColor:"#f1f5f9"}}if(typeof p!="string")return{key:"unknown",label:"Unbekannt",shortLabel:"Unbekannt",icon:Qi,IconComponent:Qi,color:"#64748b",bgColor:"#f1f5f9"};const m=l(p);return m?{key:m.slug,label:m.name,shortLabel:m.shortName||m.name,icon:Tn(m.icon),IconComponent:Tn(m.icon),color:m.color,bgColor:m.bgColor}:{key:p||"unknown",label:p||"Unbekannt",shortLabel:p||"Unbekannt",icon:Qi,IconComponent:Qi,color:"#64748b",bgColor:"#f1f5f9"}},[l]),d=f.useCallback((p=[])=>{if(!t.length)return[];if(!p.length)return t.map(x=>({key:x.slug,label:x.name,shortLabel:x.shortName||x.name,icon:Tn(x.icon),IconComponent:Tn(x.icon),color:x.color,bgColor:`${x.color}15`}));const m=new Map;return p.forEach(x=>{if(x){if(Array.isArray(x))x.forEach(g=>{if(!g||typeof g!="string"||!g.trim())return;const y=l(g);y&&!m.has(y.slug)&&m.set(y.slug,{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:Tn(y.icon),IconComponent:Tn(y.icon),color:y.color,bgColor:y.bgColor})});else if(typeof x=="string"&&x.trim()){const g=l(x);g&&!m.has(g.slug)&&m.set(g.slug,{key:g.slug,label:g.name,shortLabel:g.shortName||g.name,icon:Tn(g.icon),IconComponent:Tn(g.icon),color:g.color,bgColor:g.bgColor})}}}),Array.from(m.values())},[t,l]),u=f.useCallback((p,m)=>{if(!p||!m)return!1;const x=Js(m);if(Array.isArray(p))return p.some(v=>{const k=Js(v);return(ec[k]||k)===x});const g=Js(p);return(ec[g]||g)===x},[]),h=f.useMemo(()=>{const p=new Map;return t.forEach(m=>{p.set(m.slug,{...m,IconComponent:Tn(m.icon),bgColor:`${m.color}15`})}),p},[t]);return{categories:t,categoriesMap:h,loading:n,error:r,refetch:a,getCategoryBySlug:l,getCategoryConfig:c,getCategoriesForFilter:d,matchesCategory:u}}const Ge=()=>{const{branding:t}=qe();return f.useMemo(()=>{const e=n=>t?.[n]||_e[n];return{headerGradient:e("--header-gradient"),headerText:e("--header-text"),buttonGradient:t?.["--button-gradient"]||e("--header-gradient"),buttonGradientHover:e("--button-gradient-hover"),buttonSolid:e("--button-solid"),buttonSolidHover:e("--button-solid-hover"),buttonText:e("--button-text")||"#ffffff",primaryAccent:e("--primary-accent"),primaryAccentLight:e("--primary-accent-light"),primaryAccentHover:e("--primary-accent-hover"),primaryAccentDark:e("--primary-accent-hover"),appBgColor:e("--app-bg-color"),cardBgColor:e("--card-bg-color")||"#ffffff",cardBgHover:e("--card-bg-hover")||"#f8fafc",sidebarBgColor:e("--sidebar-bg-color"),sidebarTextColor:e("--sidebar-text-color"),sidebarTextMuted:e("--sidebar-text-muted"),sidebarActiveBg:e("--sidebar-active-bg"),sidebarActiveText:e("--sidebar-active-text"),sidebarHoverBg:e("--sidebar-hover-bg"),textMain:e("--text-main")||"#0f172a",textSecondary:e("--text-secondary")||"#475569",textMuted:e("--text-muted")||"#94a3b8",textPrimary:e("--text-main")||"#0f172a",borderColor:e("--border-color")||"#e2e8f0",borderColorLight:e("--border-color-light")||"#f1f5f9",iconPrimary:e("--icon-primary"),iconSecondary:e("--icon-secondary"),iconMuted:e("--icon-muted")||"#94a3b8",iconColor:e("--icon-primary"),iconActiveColor:e("--icon-secondary"),focusRing:e("--focus-ring")||"rgba(58, 127, 167, 0.3)",success:"#10b981",successLight:"#d1fae5",successDark:"#059669",error:"#ef4444",errorLight:"#fee2e2",errorDark:"#dc2626",warning:"#f59e0b",warningLight:"#fef3c7",warningDark:"#d97706",info:"#3b82f6",infoLight:"#dbeafe",infoDark:"#2563eb",overlayLight:"rgba(255, 255, 255, 0.8)",overlayDark:"rgba(0, 0, 0, 0.5)",backdropBlur:"rgba(255, 255, 255, 0.9)",white:"#ffffff",transparent:"transparent",disabledBg:"#cbd5e1",shadow:r1,radius:s1,breakpoint:i1,fontSize:n1,fontWeight:t1,space:e1,transition:Qv,zIndex:Zv,iconSize:Xv,component:Yv,coloredShadow:Jv,raw:t}},[t])},gf={easy:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einfach"},beginner:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einsteiger"},medium:{classes:"bg-yellow-100 text-yellow-800 border-yellow-200",label:"Mittel"},intermediate:{classes:"bg-blue-100 text-blue-800 border-blue-200",label:"Fortgeschritten"},hard:{classes:"bg-red-100 text-red-800 border-red-200",label:"Schwer"},advanced:{classes:"bg-purple-100 text-purple-800 border-purple-200",label:"Experte"}},R2=t=>gf[t]||gf.medium,dd=({children:t,className:e="",style:n={}})=>i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${e}`,style:n,children:t}),E0=({icon:t,gradient:e,textColor:n,size:s="md"})=>{const r={sm:{container:"40px",icon:"20px",radius:"10px"},md:{container:"48px",icon:"24px",radius:"12px"},lg:{container:"56px",icon:"28px",radius:"14px"}},o=r[s]||r.md;return i.jsx("div",{style:{width:o.container,height:o.container,borderRadius:o.radius,background:e,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(t,{style:{width:o.icon,height:o.icon,color:n}})})},I0=({icon:t,text:e})=>i.jsxs("div",{className:"flex items-center gap-1",children:[t&&i.jsx(t,{className:"w-3 h-3"}),i.jsx("span",{children:e})]}),A2=({label:t,icon:e,color:n})=>i.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold",style:{color:n},children:[i.jsx("span",{children:t}),e&&i.jsx(e,{className:"w-4 h-4"})]}),_2=({viewMode:t,onViewChange:e})=>{const n=Ge(),s=o=>({padding:n.space[2],borderRadius:n.radius.md,border:"none",cursor:"pointer",transition:n.transition.normal,backgroundColor:o?"#ffffff":"transparent",boxShadow:o?n.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"}),r=o=>({width:"16px",height:"16px",color:o?n.primaryAccent:E.slate[500]});return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[1],padding:n.space[1],backgroundColor:E.slate[100],borderRadius:n.radius.lg},children:[i.jsx("button",{onClick:()=>e("grid"),style:s(t==="grid"),title:"Kachelansicht",children:i.jsx(no,{style:r(t==="grid")})}),i.jsx("button",{onClick:()=>e("list"),style:s(t==="list"),title:"Listenansicht",children:i.jsx(ld,{style:r(t==="list")})})]})},M2=({title:t,description:e,difficulty:n,icon:s,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:gn},categoryBadge:c,customActions:d,onClick:u,className:h="",style:p={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>i.jsx($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.02},whileTap:{scale:.98},children:i.jsxs("div",{onClick:u,className:`bg-white rounded-3xl shadow-lg hover:shadow-xl transition-shadow duration-300 p-6 cursor-pointer border border-slate-100 h-full flex flex-col ${h}`,style:p,children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s?i.jsx(E0,{icon:s,gradient:m,textColor:x,size:"lg"}):n?i.jsx(dd,{className:y.classes,children:y.label}):null,i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[d&&i.jsx("div",{onClick:v=>v.stopPropagation(),children:d}),s&&n&&i.jsx(dd,{className:y.classes,children:y.label}),c,a.length>0&&i.jsx("div",{className:"flex gap-1",children:a.slice(0,2).map((v,k)=>i.jsx("span",{className:"px-2 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs",children:v},k))})]})]}),i.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:t}),r&&i.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:g},children:r}),e&&i.jsx("p",{className:"text-slate-600 text-sm mb-4 flex-1 line-clamp-3",children:e}),i.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[i.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:o.map((v,k)=>i.jsx(I0,{icon:v.icon,text:v.text},k))}),l&&i.jsx(A2,{label:l.label,icon:l.icon,color:g})]})]})}),P2=({title:t,description:e,difficulty:n,icon:s,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:gn},categoryBadge:c,customActions:d,onClick:u,className:h="",style:p={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>{const v=Ge();return i.jsx($.div,{variants:{hidden:{opacity:0,x:-20},visible:{opacity:1,x:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:i.jsxs("div",{onClick:u,style:{backgroundColor:"#ffffff",borderRadius:v.radius.xl,boxShadow:v.shadow.md,padding:v.space[4],cursor:"pointer",border:"1px solid #f1f5f9",transition:v.transition.normal,...p},className:h,children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:v.space[3],marginBottom:v.space[2]},children:[s&&i.jsx(E0,{icon:s,gradient:m,textColor:x,size:"sm"}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:v.fontSize.sm,fontWeight:700,color:"#0f172a",margin:0,lineHeight:1.3},children:t}),r&&i.jsx("span",{style:{fontSize:v.fontSize.xs,fontWeight:600,color:g},children:r})]}),d&&i.jsx("div",{onClick:k=>k.stopPropagation(),children:d}),n&&i.jsx(dd,{className:y.classes,children:y.label})]}),e&&i.jsx("p",{style:{color:"#475569",fontSize:v.fontSize.xs,margin:0,marginBottom:v.space[2],lineHeight:1.4,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:v.space[2]},children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:v.space[3],fontSize:v.fontSize.xs,color:"#64748b"},children:o.slice(0,2).map((k,S)=>i.jsx(I0,{icon:k.icon,text:k.text},S))}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[2]},children:[c,l&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[1],fontSize:v.fontSize.sm,fontWeight:600,color:g},children:[i.jsx("span",{children:l.label}),l.icon&&i.jsx(l.icon,{style:{width:"16px",height:"16px"}})]})]})]})]})})},R0=({title:t,description:e,difficulty:n,icon:s,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:gn},categoryBadge:c,customActions:d,onClick:u,viewMode:h="grid",className:p="",style:m={}})=>{const x=Ge(),g=x.headerGradient,y=x.headerText,v=x.primaryAccent,k=R2(n),S={title:t,description:e,difficulty:n,icon:s,subtitle:r,meta:o,tags:a,action:l,categoryBadge:c,customActions:d,onClick:u,className:p,style:m,headerGradient:g,headerText:y,primaryAccent:v,difficultyConfig:k};return h==="list"?i.jsx(P2,{...S}):i.jsx(M2,{...S})},A0=({children:t,minCardWidth:e="320px",viewMode:n="grid",className:s=""})=>{const r=n==="list";return i.jsx($.div,{className:`${r?"flex flex-col gap-3":"grid gap-6"} ${s}`,style:r?{}:{gridTemplateColumns:`repeat(auto-fit, minmax(min(100%, ${e}), 1fr))`},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:r?.05:.1}}},children:t})};function ss(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t?.(r),n===!1||!r.defaultPrevented)return e?.(r)}}function mf(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function _0(...t){return e=>{let n=!1;const s=t.map(r=>{const o=mf(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<s.length;r++){const o=s[r];typeof o=="function"?o():mf(t[r],null)}}}}function Hs(...t){return f.useCallback(_0(...t),t)}function D2(t,e){const n=f.createContext(e),s=o=>{const{children:a,...l}=o,c=f.useMemo(()=>l,Object.values(l));return i.jsx(n.Provider,{value:c,children:a})};s.displayName=t+"Provider";function r(o){const a=f.useContext(n);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return[s,r]}function N2(t,e=[]){let n=[];function s(o,a){const l=f.createContext(a),c=n.length;n=[...n,a];const d=h=>{const{scope:p,children:m,...x}=h,g=p?.[t]?.[c]||l,y=f.useMemo(()=>x,Object.values(x));return i.jsx(g.Provider,{value:y,children:m})};d.displayName=o+"Provider";function u(h,p){const m=p?.[t]?.[c]||l,x=f.useContext(m);if(x)return x;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${o}\``)}return[d,u]}const r=()=>{const o=n.map(a=>f.createContext(a));return function(l){const c=l?.[t]||o;return f.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return r.scopeName=t,[s,z2(r,...e)]}function z2(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const s=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const a=s.reduce((l,{useScope:c,scopeName:d})=>{const h=c(o)[`__scope${d}`];return{...l,...h}},{});return f.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}var Ao=globalThis?.document?f.useLayoutEffect:()=>{},L2=Vd[" useId ".trim().toString()]||(()=>{}),O2=0;function nc(t){const[e,n]=f.useState(L2());return Ao(()=>{n(s=>s??String(O2++))},[t]),t||(e?`radix-${e}`:"")}var B2=Vd[" useInsertionEffect ".trim().toString()]||Ao;function F2({prop:t,defaultProp:e,onChange:n=()=>{},caller:s}){const[r,o,a]=W2({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:r;{const u=f.useRef(t!==void 0);f.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const d=f.useCallback(u=>{if(l){const h=$2(u)?u(t):u;h!==t&&a.current?.(h)}else o(u)},[l,t,o,a]);return[c,d]}function W2({defaultProp:t,onChange:e}){const[n,s]=f.useState(t),r=f.useRef(n),o=f.useRef(e);return B2(()=>{o.current=e},[e]),f.useEffect(()=>{r.current!==n&&(o.current?.(n),r.current=n)},[n,r]),[n,s,o]}function $2(t){return typeof t=="function"}function M0(t){const e=U2(t),n=f.forwardRef((s,r)=>{const{children:o,...a}=s,l=f.Children.toArray(o),c=l.find(G2);if(c){const d=c.props.children,u=l.map(h=>h===c?f.Children.count(d)>1?f.Children.only(null):f.isValidElement(d)?d.props.children:null:h);return i.jsx(e,{...a,ref:r,children:f.isValidElement(d)?f.cloneElement(d,void 0,u):null})}return i.jsx(e,{...a,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}function U2(t){const e=f.forwardRef((n,s)=>{const{children:r,...o}=n;if(f.isValidElement(r)){const a=q2(r),l=H2(o,r.props);return r.type!==f.Fragment&&(l.ref=s?_0(s,a):a),f.cloneElement(r,l)}return f.Children.count(r)>1?f.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var V2=Symbol("radix.slottable");function G2(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===V2}function H2(t,e){const n={...e};for(const s in e){const r=t[s],o=e[s];/^on[A-Z]/.test(s)?r&&o?n[s]=(...l)=>{const c=o(...l);return r(...l),c}:r&&(n[s]=r):s==="style"?n[s]={...r,...o}:s==="className"&&(n[s]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function q2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var K2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Fi=K2.reduce((t,e)=>{const n=M0(`Primitive.${e}`),s=f.forwardRef((r,o)=>{const{asChild:a,...l}=r,c=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:o})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function J2(t,e){t&&fm.flushSync(()=>t.dispatchEvent(e))}function _o(t){const e=f.useRef(t);return f.useEffect(()=>{e.current=t}),f.useMemo(()=>(...n)=>e.current?.(...n),[])}function Y2(t,e=globalThis?.document){const n=_o(t);f.useEffect(()=>{const s=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[n,e])}var X2="DismissableLayer",ud="dismissableLayer.update",Z2="dismissableLayer.pointerDownOutside",Q2="dismissableLayer.focusOutside",xf,P0=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),D0=f.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:a,onDismiss:l,...c}=t,d=f.useContext(P0),[u,h]=f.useState(null),p=u?.ownerDocument??globalThis?.document,[,m]=f.useState({}),x=Hs(e,C=>h(C)),g=Array.from(d.layers),[y]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=g.indexOf(y),k=u?g.indexOf(u):-1,S=d.layersWithOutsidePointerEventsDisabled.size>0,w=k>=v,b=nE(C=>{const j=C.target,R=[...d.branches].some(I=>I.contains(j));!w||R||(r?.(C),a?.(C),C.defaultPrevented||l?.())},p),T=iE(C=>{const j=C.target;[...d.branches].some(I=>I.contains(j))||(o?.(C),a?.(C),C.defaultPrevented||l?.())},p);return Y2(C=>{k===d.layers.size-1&&(s?.(C),!C.defaultPrevented&&l&&(C.preventDefault(),l()))},p),f.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(xf=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),yf(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=xf)}},[u,p,n,d]),f.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),yf())},[u,d]),f.useEffect(()=>{const C=()=>m({});return document.addEventListener(ud,C),()=>document.removeEventListener(ud,C)},[]),i.jsx(Fi.div,{...c,ref:x,style:{pointerEvents:S?w?"auto":"none":void 0,...t.style},onFocusCapture:ss(t.onFocusCapture,T.onFocusCapture),onBlurCapture:ss(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:ss(t.onPointerDownCapture,b.onPointerDownCapture)})});D0.displayName=X2;var eE="DismissableLayerBranch",tE=f.forwardRef((t,e)=>{const n=f.useContext(P0),s=f.useRef(null),r=Hs(e,s);return f.useEffect(()=>{const o=s.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),i.jsx(Fi.div,{...t,ref:r})});tE.displayName=eE;function nE(t,e=globalThis?.document){const n=_o(t),s=f.useRef(!1),r=f.useRef(()=>{});return f.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let c=function(){N0(Z2,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);s.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>s.current=!0}}function iE(t,e=globalThis?.document){const n=_o(t),s=f.useRef(!1);return f.useEffect(()=>{const r=o=>{o.target&&!s.current&&N0(Q2,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function yf(){const t=new CustomEvent(ud);document.dispatchEvent(t)}function N0(t,e,n,{discrete:s}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),s?J2(r,o):r.dispatchEvent(o)}var ic="focusScope.autoFocusOnMount",sc="focusScope.autoFocusOnUnmount",bf={bubbles:!1,cancelable:!0},sE="FocusScope",z0=f.forwardRef((t,e)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...a}=t,[l,c]=f.useState(null),d=_o(r),u=_o(o),h=f.useRef(null),p=Hs(e,g=>c(g)),m=f.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;f.useEffect(()=>{if(s){let g=function(S){if(m.paused||!l)return;const w=S.target;l.contains(w)?h.current=w:Yi(h.current,{select:!0})},y=function(S){if(m.paused||!l)return;const w=S.relatedTarget;w!==null&&(l.contains(w)||Yi(h.current,{select:!0}))},v=function(S){if(document.activeElement===document.body)for(const b of S)b.removedNodes.length>0&&Yi(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const k=new MutationObserver(v);return l&&k.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),k.disconnect()}}},[s,l,m.paused]),f.useEffect(()=>{if(l){Sf.add(m);const g=document.activeElement;if(!l.contains(g)){const v=new CustomEvent(ic,bf);l.addEventListener(ic,d),l.dispatchEvent(v),v.defaultPrevented||(rE(dE(L0(l)),{select:!0}),document.activeElement===g&&Yi(l))}return()=>{l.removeEventListener(ic,d),setTimeout(()=>{const v=new CustomEvent(sc,bf);l.addEventListener(sc,u),l.dispatchEvent(v),v.defaultPrevented||Yi(g??document.body,{select:!0}),l.removeEventListener(sc,u),Sf.remove(m)},0)}}},[l,d,u,m]);const x=f.useCallback(g=>{if(!n&&!s||m.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,v=document.activeElement;if(y&&v){const k=g.currentTarget,[S,w]=oE(k);S&&w?!g.shiftKey&&v===w?(g.preventDefault(),n&&Yi(S,{select:!0})):g.shiftKey&&v===S&&(g.preventDefault(),n&&Yi(w,{select:!0})):v===k&&g.preventDefault()}},[n,s,m.paused]);return i.jsx(Fi.div,{tabIndex:-1,...a,ref:p,onKeyDown:x})});z0.displayName=sE;function rE(t,{select:e=!1}={}){const n=document.activeElement;for(const s of t)if(Yi(s,{select:e}),document.activeElement!==n)return}function oE(t){const e=L0(t),n=vf(e,t),s=vf(e.reverse(),t);return[n,s]}function L0(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function vf(t,e){for(const n of t)if(!aE(n,{upTo:e}))return n}function aE(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function lE(t){return t instanceof HTMLInputElement&&"select"in t}function Yi(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&lE(t)&&e&&t.select()}}var Sf=cE();function cE(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=kf(t,e),t.unshift(e)},remove(e){t=kf(t,e),t[0]?.resume()}}}function kf(t,e){const n=[...t],s=n.indexOf(e);return s!==-1&&n.splice(s,1),n}function dE(t){return t.filter(e=>e.tagName!=="A")}var uE="Portal",O0=f.forwardRef((t,e)=>{const{container:n,...s}=t,[r,o]=f.useState(!1);Ao(()=>o(!0),[]);const a=n||r&&globalThis?.document?.body;return a?c1.createPortal(i.jsx(Fi.div,{...s,ref:e}),a):null});O0.displayName=uE;function hE(t,e){return f.useReducer((n,s)=>e[n][s]??n,t)}var kl=t=>{const{present:e,children:n}=t,s=pE(e),r=typeof n=="function"?n({present:s.isPresent}):f.Children.only(n),o=Hs(s.ref,fE(r));return typeof n=="function"||s.isPresent?f.cloneElement(r,{ref:o}):null};kl.displayName="Presence";function pE(t){const[e,n]=f.useState(),s=f.useRef(null),r=f.useRef(t),o=f.useRef("none"),a=t?"mounted":"unmounted",[l,c]=hE(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return f.useEffect(()=>{const d=na(s.current);o.current=l==="mounted"?d:"none"},[l]),Ao(()=>{const d=s.current,u=r.current;if(u!==t){const p=o.current,m=na(d);t?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,c]),Ao(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,h=m=>{const g=na(s.current).includes(CSS.escape(m.animationName));if(m.target===e&&g&&(c("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},p=m=>{m.target===e&&(o.current=na(s.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:f.useCallback(d=>{s.current=d?getComputedStyle(d):null,n(d)},[])}}function na(t){return t?.animationName||"none"}function fE(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var rc=0;function gE(){f.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??wf()),document.body.insertAdjacentElement("beforeend",t[1]??wf()),rc++,()=>{rc===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),rc--}},[])}function wf(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Zn=function(){return Zn=Object.assign||function(e){for(var n,s=1,r=arguments.length;s<r;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Zn.apply(this,arguments)};function B0(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function mE(t,e,n){if(n||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return t.concat(o||Array.prototype.slice.call(e))}var ka="right-scroll-bar-position",wa="width-before-scroll-bar",xE="with-scroll-bars-hidden",yE="--removed-body-scroll-bar-size";function oc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function bE(t,e){var n=f.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(s){var r=n.value;r!==s&&(n.value=s,n.callback(s,r))}}}})[0];return n.callback=e,n.facade}var vE=typeof window<"u"?f.useLayoutEffect:f.useEffect,Cf=new WeakMap;function SE(t,e){var n=bE(null,function(s){return t.forEach(function(r){return oc(r,s)})});return vE(function(){var s=Cf.get(n);if(s){var r=new Set(s),o=new Set(t),a=n.current;r.forEach(function(l){o.has(l)||oc(l,null)}),o.forEach(function(l){r.has(l)||oc(l,a)})}Cf.set(n,t)},[t]),n}function kE(t){return t}function wE(t,e){e===void 0&&(e=kE);var n=[],s=!1,r={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var a=e(o,s);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(s=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){s=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var u=a;a=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){a.push(u),d()},filter:function(u){return a=a.filter(u),n}}}};return r}function CE(t){t===void 0&&(t={});var e=wE(null);return e.options=Zn({async:!0,ssr:!1},t),e}var F0=function(t){var e=t.sideCar,n=B0(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return f.createElement(s,Zn({},n))};F0.isSideCarExport=!0;function jE(t,e){return t.useMedium(e),F0}var W0=CE(),ac=function(){},wl=f.forwardRef(function(t,e){var n=f.useRef(null),s=f.useState({onScrollCapture:ac,onWheelCapture:ac,onTouchMoveCapture:ac}),r=s[0],o=s[1],a=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,h=t.shards,p=t.sideCar,m=t.noRelative,x=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,k=v===void 0?"div":v,S=t.gapMode,w=B0(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=p,T=SE([n,e]),C=Zn(Zn({},w),r);return f.createElement(f.Fragment,null,u&&f.createElement(b,{sideCar:W0,removeScrollBar:d,shards:h,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!y,lockRef:n,gapMode:S}),a?f.cloneElement(f.Children.only(l),Zn(Zn({},C),{ref:T})):f.createElement(k,Zn({},C,{className:c,ref:T}),l))});wl.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};wl.classNames={fullWidth:wa,zeroRight:ka};var TE=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function EE(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=TE();return e&&t.setAttribute("nonce",e),t}function IE(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function RE(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var AE=function(){var t=0,e=null;return{add:function(n){t==0&&(e=EE())&&(IE(e,n),RE(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},_E=function(){var t=AE();return function(e,n){f.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},$0=function(){var t=_E(),e=function(n){var s=n.styles,r=n.dynamic;return t(s,r),null};return e},ME={left:0,top:0,right:0,gap:0},lc=function(t){return parseInt(t||"",10)||0},PE=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],s=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[lc(n),lc(s),lc(r)]},DE=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return ME;var e=PE(t),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-n+e[2]-e[0])}},NE=$0(),yr="data-scroll-locked",zE=function(t,e,n,s){var r=t.left,o=t.top,a=t.right,l=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(xE,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(yr,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(ka,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(wa,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(ka," .").concat(ka,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(wa," .").concat(wa,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(yr,`] {
    `).concat(yE,": ").concat(l,`px;
  }
`)},jf=function(){var t=parseInt(document.body.getAttribute(yr)||"0",10);return isFinite(t)?t:0},LE=function(){f.useEffect(function(){return document.body.setAttribute(yr,(jf()+1).toString()),function(){var t=jf()-1;t<=0?document.body.removeAttribute(yr):document.body.setAttribute(yr,t.toString())}},[])},OE=function(t){var e=t.noRelative,n=t.noImportant,s=t.gapMode,r=s===void 0?"margin":s;LE();var o=f.useMemo(function(){return DE(r)},[r]);return f.createElement(NE,{styles:zE(o,!e,r,n?"":"!important")})},hd=!1;if(typeof window<"u")try{var ia=Object.defineProperty({},"passive",{get:function(){return hd=!0,!0}});window.addEventListener("test",ia,ia),window.removeEventListener("test",ia,ia)}catch{hd=!1}var Xs=hd?{passive:!1}:!1,BE=function(t){return t.tagName==="TEXTAREA"},U0=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!BE(t)&&n[e]==="visible")},FE=function(t){return U0(t,"overflowY")},WE=function(t){return U0(t,"overflowX")},Tf=function(t,e){var n=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var r=V0(t,s);if(r){var o=G0(t,s),a=o[1],l=o[2];if(a>l)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},$E=function(t){var e=t.scrollTop,n=t.scrollHeight,s=t.clientHeight;return[e,n,s]},UE=function(t){var e=t.scrollLeft,n=t.scrollWidth,s=t.clientWidth;return[e,n,s]},V0=function(t,e){return t==="v"?FE(e):WE(e)},G0=function(t,e){return t==="v"?$E(e):UE(e)},VE=function(t,e){return t==="h"&&e==="rtl"?-1:1},GE=function(t,e,n,s,r){var o=VE(t,window.getComputedStyle(e).direction),a=o*s,l=n.target,c=e.contains(l),d=!1,u=a>0,h=0,p=0;do{if(!l)break;var m=G0(t,l),x=m[0],g=m[1],y=m[2],v=g-y-o*x;(x||v)&&V0(t,l)&&(h+=v,p+=x);var k=l.parentNode;l=k&&k.nodeType===Node.DOCUMENT_FRAGMENT_NODE?k.host:k}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(d=!0),d},sa=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Ef=function(t){return[t.deltaX,t.deltaY]},If=function(t){return t&&"current"in t?t.current:t},HE=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qE=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},KE=0,Zs=[];function JE(t){var e=f.useRef([]),n=f.useRef([0,0]),s=f.useRef(),r=f.useState(KE++)[0],o=f.useState($0)[0],a=f.useRef(t);f.useEffect(function(){a.current=t},[t]),f.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var g=mE([t.lockRef.current],(t.shards||[]).map(If),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var l=f.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!a.current.allowPinchZoom;var v=sa(g),k=n.current,S="deltaX"in g?g.deltaX:k[0]-v[0],w="deltaY"in g?g.deltaY:k[1]-v[1],b,T=g.target,C=Math.abs(S)>Math.abs(w)?"h":"v";if("touches"in g&&C==="h"&&T.type==="range")return!1;var j=Tf(C,T);if(!j)return!0;if(j?b=C:(b=C==="v"?"h":"v",j=Tf(C,T)),!j)return!1;if(!s.current&&"changedTouches"in g&&(S||w)&&(s.current=b),!b)return!0;var R=s.current||b;return GE(R,y,g,R==="h"?S:w)},[]),c=f.useCallback(function(g){var y=g;if(!(!Zs.length||Zs[Zs.length-1]!==o)){var v="deltaY"in y?Ef(y):sa(y),k=e.current.filter(function(b){return b.name===y.type&&(b.target===y.target||y.target===b.shadowParent)&&HE(b.delta,v)})[0];if(k&&k.should){y.cancelable&&y.preventDefault();return}if(!k){var S=(a.current.shards||[]).map(If).filter(Boolean).filter(function(b){return b.contains(y.target)}),w=S.length>0?l(y,S[0]):!a.current.noIsolation;w&&y.cancelable&&y.preventDefault()}}},[]),d=f.useCallback(function(g,y,v,k){var S={name:g,delta:y,target:v,should:k,shadowParent:YE(v)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(w){return w!==S})},1)},[]),u=f.useCallback(function(g){n.current=sa(g),s.current=void 0},[]),h=f.useCallback(function(g){d(g.type,Ef(g),g.target,l(g,t.lockRef.current))},[]),p=f.useCallback(function(g){d(g.type,sa(g),g.target,l(g,t.lockRef.current))},[]);f.useEffect(function(){return Zs.push(o),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Xs),document.addEventListener("touchmove",c,Xs),document.addEventListener("touchstart",u,Xs),function(){Zs=Zs.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Xs),document.removeEventListener("touchmove",c,Xs),document.removeEventListener("touchstart",u,Xs)}},[]);var m=t.removeScrollBar,x=t.inert;return f.createElement(f.Fragment,null,x?f.createElement(o,{styles:qE(r)}):null,m?f.createElement(OE,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function YE(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const XE=jE(W0,JE);var H0=f.forwardRef(function(t,e){return f.createElement(wl,Zn({},t,{ref:e,sideCar:XE}))});H0.classNames=wl.classNames;var ZE=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Qs=new WeakMap,ra=new WeakMap,oa={},cc=0,q0=function(t){return t&&(t.host||q0(t.parentNode))},QE=function(t,e){return e.map(function(n){if(t.contains(n))return n;var s=q0(n);return s&&t.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},eI=function(t,e,n,s){var r=QE(e,Array.isArray(t)?t:[t]);oa[n]||(oa[n]=new WeakMap);var o=oa[n],a=[],l=new Set,c=new Set(r),d=function(h){!h||l.has(h)||(l.add(h),d(h.parentNode))};r.forEach(d);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(l.has(p))u(p);else try{var m=p.getAttribute(s),x=m!==null&&m!=="false",g=(Qs.get(p)||0)+1,y=(o.get(p)||0)+1;Qs.set(p,g),o.set(p,y),a.push(p),g===1&&x&&ra.set(p,!0),y===1&&p.setAttribute(n,"true"),x||p.setAttribute(s,"true")}catch(v){console.error("aria-hidden: cannot operate on ",p,v)}})};return u(e),l.clear(),cc++,function(){a.forEach(function(h){var p=Qs.get(h)-1,m=o.get(h)-1;Qs.set(h,p),o.set(h,m),p||(ra.has(h)||h.removeAttribute(s),ra.delete(h)),m||h.removeAttribute(n)}),cc--,cc||(Qs=new WeakMap,Qs=new WeakMap,ra=new WeakMap,oa={})}},tI=function(t,e,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(t)?t:[t]),r=ZE(t);return r?(s.push.apply(s,Array.from(r.querySelectorAll("[aria-live], script"))),eI(s,r,n,"aria-hidden")):function(){return null}},Cl="Dialog",[K0]=N2(Cl),[nI,Kn]=K0(Cl),J0=t=>{const{__scopeDialog:e,children:n,open:s,defaultOpen:r,onOpenChange:o,modal:a=!0}=t,l=f.useRef(null),c=f.useRef(null),[d,u]=F2({prop:s,defaultProp:r??!1,onChange:o,caller:Cl});return i.jsx(nI,{scope:e,triggerRef:l,contentRef:c,contentId:nc(),titleId:nc(),descriptionId:nc(),open:d,onOpenChange:u,onOpenToggle:f.useCallback(()=>u(h=>!h),[u]),modal:a,children:n})};J0.displayName=Cl;var Y0="DialogTrigger",iI=f.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=Kn(Y0,n),o=Hs(e,r.triggerRef);return i.jsx(Fi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":Wu(r.open),...s,ref:o,onClick:ss(t.onClick,r.onOpenToggle)})});iI.displayName=Y0;var Bu="DialogPortal",[sI,X0]=K0(Bu,{forceMount:void 0}),Z0=t=>{const{__scopeDialog:e,forceMount:n,children:s,container:r}=t,o=Kn(Bu,e);return i.jsx(sI,{scope:e,forceMount:n,children:f.Children.map(s,a=>i.jsx(kl,{present:n||o.open,children:i.jsx(O0,{asChild:!0,container:r,children:a})}))})};Z0.displayName=Bu;var qa="DialogOverlay",Q0=f.forwardRef((t,e)=>{const n=X0(qa,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,o=Kn(qa,t.__scopeDialog);return o.modal?i.jsx(kl,{present:s||o.open,children:i.jsx(oI,{...r,ref:e})}):null});Q0.displayName=qa;var rI=M0("DialogOverlay.RemoveScroll"),oI=f.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=Kn(qa,n);return i.jsx(H0,{as:rI,allowPinchZoom:!0,shards:[r.contentRef],children:i.jsx(Fi.div,{"data-state":Wu(r.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),Bs="DialogContent",ey=f.forwardRef((t,e)=>{const n=X0(Bs,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,o=Kn(Bs,t.__scopeDialog);return i.jsx(kl,{present:s||o.open,children:o.modal?i.jsx(aI,{...r,ref:e}):i.jsx(lI,{...r,ref:e})})});ey.displayName=Bs;var aI=f.forwardRef((t,e)=>{const n=Kn(Bs,t.__scopeDialog),s=f.useRef(null),r=Hs(e,n.contentRef,s);return f.useEffect(()=>{const o=s.current;if(o)return tI(o)},[]),i.jsx(ty,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ss(t.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:ss(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:ss(t.onFocusOutside,o=>o.preventDefault())})}),lI=f.forwardRef((t,e)=>{const n=Kn(Bs,t.__scopeDialog),s=f.useRef(!1),r=f.useRef(!1);return i.jsx(ty,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(s.current||n.triggerRef.current?.focus(),o.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const a=o.target;n.triggerRef.current?.contains(a)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),ty=f.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:o,...a}=t,l=Kn(Bs,n),c=f.useRef(null),d=Hs(e,c);return gE(),i.jsxs(i.Fragment,{children:[i.jsx(z0,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:o,children:i.jsx(D0,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Wu(l.open),...a,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),i.jsxs(i.Fragment,{children:[i.jsx(cI,{titleId:l.titleId}),i.jsx(uI,{contentRef:c,descriptionId:l.descriptionId})]})]})}),Fu="DialogTitle",ny=f.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=Kn(Fu,n);return i.jsx(Fi.h2,{id:r.titleId,...s,ref:e})});ny.displayName=Fu;var iy="DialogDescription",sy=f.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=Kn(iy,n);return i.jsx(Fi.p,{id:r.descriptionId,...s,ref:e})});sy.displayName=iy;var ry="DialogClose",oy=f.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=Kn(ry,n);return i.jsx(Fi.button,{type:"button",...s,ref:e,onClick:ss(t.onClick,()=>r.onOpenChange(!1))})});oy.displayName=ry;function Wu(t){return t?"open":"closed"}var ay="DialogTitleWarning",[JN,ly]=D2(ay,{contentName:Bs,titleName:Fu,docsSlug:"dialog"}),cI=({titleId:t})=>{const e=ly(ay),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return f.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},dI="DialogDescriptionWarning",uI=({contentRef:t,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ly(dI).contentName}}.`;return f.useEffect(()=>{const r=t.current?.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(s))},[s,t,e]),null},hI=J0,pI=Z0,cy=Q0,dy=ey,uy=ny,hy=sy,fI=oy;function py(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=py(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function fy(){for(var t,e,n=0,s="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=py(t))&&(s&&(s+=" "),s+=e);return s}const $u="-",gI=t=>{const e=xI(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:a=>{const l=a.split($u);return l[0]===""&&l.length!==1&&l.shift(),gy(l,e)||mI(a)},getConflictingClassGroupIds:(a,l)=>{const c=n[a]||[];return l&&s[a]?[...c,...s[a]]:c}}},gy=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],s=e.nextPart.get(n),r=s?gy(t.slice(1),s):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join($u);return e.validators.find(({validator:a})=>a(o))?.classGroupId},Rf=/^\[(.+)\]$/,mI=t=>{if(Rf.test(t)){const e=Rf.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},xI=t=>{const{theme:e,prefix:n}=t,s={nextPart:new Map,validators:[]};return bI(Object.entries(t.classGroups),n).forEach(([o,a])=>{pd(a,s,o,e)}),s},pd=(t,e,n,s)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:Af(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(yI(r)){pd(r(s),e,n,s);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,a])=>{pd(a,Af(e,o),n,s)})})},Af=(t,e)=>{let n=t;return e.split($u).forEach(s=>{n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n},yI=t=>t.isThemeGetter,bI=(t,e)=>e?t.map(([n,s])=>{const r=s.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,l])=>[e+a,l])):o);return[n,r]}):t,vI=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,s=new Map;const r=(o,a)=>{n.set(o,a),e++,e>t&&(e=0,s=n,n=new Map)};return{get(o){let a=n.get(o);if(a!==void 0)return a;if((a=s.get(o))!==void 0)return r(o,a),a},set(o,a){n.has(o)?n.set(o,a):r(o,a)}}},my="!",SI=t=>{const{separator:e,experimentalParseClassName:n}=t,s=e.length===1,r=e[0],o=e.length,a=l=>{const c=[];let d=0,u=0,h;for(let y=0;y<l.length;y++){let v=l[y];if(d===0){if(v===r&&(s||l.slice(y,y+o)===e)){c.push(l.slice(u,y)),u=y+o;continue}if(v==="/"){h=y;continue}}v==="["?d++:v==="]"&&d--}const p=c.length===0?l:l.substring(u),m=p.startsWith(my),x=m?p.substring(1):p,g=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:x,maybePostfixModifierPosition:g}};return n?l=>n({className:l,parseClassName:a}):a},kI=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(s=>{s[0]==="["?(e.push(...n.sort(),s),n=[]):n.push(s)}),e.push(...n.sort()),e},wI=t=>({cache:vI(t.cacheSize),parseClassName:SI(t),...gI(t)}),CI=/\s+/,jI=(t,e)=>{const{parseClassName:n,getClassGroupId:s,getConflictingClassGroupIds:r}=e,o=[],a=t.trim().split(CI);let l="";for(let c=a.length-1;c>=0;c-=1){const d=a[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:m}=n(d);let x=!!m,g=s(x?p.substring(0,m):p);if(!g){if(!x){l=d+(l.length>0?" "+l:l);continue}if(g=s(p),!g){l=d+(l.length>0?" "+l:l);continue}x=!1}const y=kI(u).join(":"),v=h?y+my:y,k=v+g;if(o.includes(k))continue;o.push(k);const S=r(g,x);for(let w=0;w<S.length;++w){const b=S[w];o.push(v+b)}l=d+(l.length>0?" "+l:l)}return l};function TI(){let t=0,e,n,s="";for(;t<arguments.length;)(e=arguments[t++])&&(n=xy(e))&&(s&&(s+=" "),s+=n);return s}const xy=t=>{if(typeof t=="string")return t;let e,n="";for(let s=0;s<t.length;s++)t[s]&&(e=xy(t[s]))&&(n&&(n+=" "),n+=e);return n};function EI(t,...e){let n,s,r,o=a;function a(c){const d=e.reduce((u,h)=>h(u),t());return n=wI(d),s=n.cache.get,r=n.cache.set,o=l,l(c)}function l(c){const d=s(c);if(d)return d;const u=jI(c,n);return r(c,u),u}return function(){return o(TI.apply(null,arguments))}}const ot=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},yy=/^\[(?:([a-z-]+):)?(.+)\]$/i,II=/^\d+\/\d+$/,RI=new Set(["px","full","screen"]),AI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_I=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,MI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,PI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,DI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,bi=t=>br(t)||RI.has(t)||II.test(t),Vi=t=>$r(t,"length",$I),br=t=>!!t&&!Number.isNaN(Number(t)),dc=t=>$r(t,"number",br),Hr=t=>!!t&&Number.isInteger(Number(t)),NI=t=>t.endsWith("%")&&br(t.slice(0,-1)),Re=t=>yy.test(t),Gi=t=>AI.test(t),zI=new Set(["length","size","percentage"]),LI=t=>$r(t,zI,by),OI=t=>$r(t,"position",by),BI=new Set(["image","url"]),FI=t=>$r(t,BI,VI),WI=t=>$r(t,"",UI),qr=()=>!0,$r=(t,e,n)=>{const s=yy.exec(t);return s?s[1]?typeof e=="string"?s[1]===e:e.has(s[1]):n(s[2]):!1},$I=t=>_I.test(t)&&!MI.test(t),by=()=>!1,UI=t=>PI.test(t),VI=t=>DI.test(t),GI=()=>{const t=ot("colors"),e=ot("spacing"),n=ot("blur"),s=ot("brightness"),r=ot("borderColor"),o=ot("borderRadius"),a=ot("borderSpacing"),l=ot("borderWidth"),c=ot("contrast"),d=ot("grayscale"),u=ot("hueRotate"),h=ot("invert"),p=ot("gap"),m=ot("gradientColorStops"),x=ot("gradientColorStopPositions"),g=ot("inset"),y=ot("margin"),v=ot("opacity"),k=ot("padding"),S=ot("saturate"),w=ot("scale"),b=ot("sepia"),T=ot("skew"),C=ot("space"),j=ot("translate"),R=()=>["auto","contain","none"],I=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",Re,e],L=()=>[Re,e],B=()=>["",bi,Vi],P=()=>["auto",br,Re],_=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],O=()=>["solid","dashed","dotted","double","none"],W=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],D=()=>["start","end","center","between","around","evenly","stretch"],N=()=>["","0",Re],F=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ne=()=>[br,Re];return{cacheSize:500,separator:":",theme:{colors:[qr],spacing:[bi,Vi],blur:["none","",Gi,Re],brightness:ne(),borderColor:[t],borderRadius:["none","","full",Gi,Re],borderSpacing:L(),borderWidth:B(),contrast:ne(),grayscale:N(),hueRotate:ne(),invert:N(),gap:L(),gradientColorStops:[t],gradientColorStopPositions:[NI,Vi],inset:A(),margin:A(),opacity:ne(),padding:L(),saturate:ne(),scale:ne(),sepia:N(),skew:ne(),space:L(),translate:L()},classGroups:{aspect:[{aspect:["auto","square","video",Re]}],container:["container"],columns:[{columns:[Gi]}],"break-after":[{"break-after":F()}],"break-before":[{"break-before":F()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[..._(),Re]}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Hr,Re]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Re]}],grow:[{grow:N()}],shrink:[{shrink:N()}],order:[{order:["first","last","none",Hr,Re]}],"grid-cols":[{"grid-cols":[qr]}],"col-start-end":[{col:["auto",{span:["full",Hr,Re]},Re]}],"col-start":[{"col-start":P()}],"col-end":[{"col-end":P()}],"grid-rows":[{"grid-rows":[qr]}],"row-start-end":[{row:["auto",{span:[Hr,Re]},Re]}],"row-start":[{"row-start":P()}],"row-end":[{"row-end":P()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Re]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Re]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...D()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...D(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...D(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[k]}],px:[{px:[k]}],py:[{py:[k]}],ps:[{ps:[k]}],pe:[{pe:[k]}],pt:[{pt:[k]}],pr:[{pr:[k]}],pb:[{pb:[k]}],pl:[{pl:[k]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Re,e]}],"min-w":[{"min-w":[Re,e,"min","max","fit"]}],"max-w":[{"max-w":[Re,e,"none","full","min","max","fit","prose",{screen:[Gi]},Gi]}],h:[{h:[Re,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Re,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Re,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Re,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Gi,Vi]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",dc]}],"font-family":[{font:[qr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Re]}],"line-clamp":[{"line-clamp":["none",br,dc]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",bi,Re]}],"list-image":[{"list-image":["none",Re]}],"list-style-type":[{list:["none","disc","decimal",Re]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...O(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",bi,Vi]}],"underline-offset":[{"underline-offset":["auto",bi,Re]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:L()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Re]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Re]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[..._(),OI]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",LI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},FI]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...O(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:O()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...O()]}],"outline-offset":[{"outline-offset":[bi,Re]}],"outline-w":[{outline:[bi,Vi]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[bi,Vi]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Gi,WI]}],"shadow-color":[{shadow:[qr]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...W(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":W()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Gi,Re]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[S]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Re]}],duration:[{duration:ne()}],ease:[{ease:["linear","in","out","in-out",Re]}],delay:[{delay:ne()}],animate:[{animate:["none","spin","ping","pulse","bounce",Re]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Hr,Re]}],"translate-x":[{"translate-x":[j]}],"translate-y":[{"translate-y":[j]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Re]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Re]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":L()}],"scroll-mx":[{"scroll-mx":L()}],"scroll-my":[{"scroll-my":L()}],"scroll-ms":[{"scroll-ms":L()}],"scroll-me":[{"scroll-me":L()}],"scroll-mt":[{"scroll-mt":L()}],"scroll-mr":[{"scroll-mr":L()}],"scroll-mb":[{"scroll-mb":L()}],"scroll-ml":[{"scroll-ml":L()}],"scroll-p":[{"scroll-p":L()}],"scroll-px":[{"scroll-px":L()}],"scroll-py":[{"scroll-py":L()}],"scroll-ps":[{"scroll-ps":L()}],"scroll-pe":[{"scroll-pe":L()}],"scroll-pt":[{"scroll-pt":L()}],"scroll-pr":[{"scroll-pr":L()}],"scroll-pb":[{"scroll-pb":L()}],"scroll-pl":[{"scroll-pl":L()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Re]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[bi,Vi,dc]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},HI=EI(GI);function dt(...t){return HI(fy(t))}const ii=f.forwardRef(({onOpenChange:t,...e},n)=>{const s=f.useCallback(r=>{t&&t(r)},[t]);return i.jsx(hI,{onOpenChange:s,...e})});ii.displayName="Dialog";const qI=pI,vy=f.forwardRef(({className:t,...e},n)=>i.jsx(cy,{ref:n,className:dt("fixed inset-0 z-[99] bg-slate-900/60 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));vy.displayName=cy.displayName;const si=f.forwardRef(({className:t,children:e,...n},s)=>i.jsxs(qI,{children:[i.jsx(vy,{}),i.jsxs(dy,{ref:s,className:dt("fixed left-[50%] top-[50%] z-[99] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4","border border-slate-200 bg-white p-6 shadow-2xl rounded-2xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...n,children:[e,i.jsxs(fI,{style:{position:"absolute",right:"16px",top:"16px",borderRadius:"8px",padding:"6px",color:"#94a3b8",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:r=>{r.currentTarget.style.color="#475569",r.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.color="#94a3b8",r.currentTarget.style.backgroundColor="transparent"},children:[i.jsx(Bt,{style:{width:"20px",height:"20px"}}),i.jsx("span",{className:"sr-only",children:"Schlieen"})]})]})]}));si.displayName=dy.displayName;const ri=({className:t,...e})=>i.jsx("div",{className:dt("flex flex-col space-y-2 text-center sm:text-left",t),...e});ri.displayName="DialogHeader";const Mi=({className:t,...e})=>i.jsx("div",{className:dt("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end pt-4",t),...e});Mi.displayName="DialogFooter";const oi=f.forwardRef(({className:t,...e},n)=>i.jsx(uy,{ref:n,className:dt("text-xl font-semibold text-slate-900 leading-none tracking-tight",t),...e}));oi.displayName=uy.displayName;const Pi=f.forwardRef(({className:t,...e},n)=>i.jsx(hy,{ref:n,className:dt("text-sm text-slate-600 leading-relaxed",t),...e}));Pi.displayName=hy.displayName;const _f=768,KI=()=>{const[t,e]=f.useState(typeof window<"u"?window.innerWidth<_f:!1);return Cn.useEffect(()=>{const n=()=>{e(window.innerWidth<_f)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t},aa=({label:t,icon:e,isSelected:n,onClick:s,color:r,bgColor:o})=>{const a=Ge(),l=r||a.primaryAccent,c=o||`${a.primaryAccent}15`;return i.jsxs("button",{onClick:s,style:{display:"inline-flex",alignItems:"center",gap:a.space[2],padding:`${a.space[2]} ${a.space[3]}`,borderRadius:a.radius.full,fontSize:a.fontSize.sm,fontWeight:600,border:`2px solid ${n?l:E.slate[200]}`,backgroundColor:n?c:"white",color:n?l:E.slate[600],cursor:"pointer",transition:a.transition.normal,whiteSpace:"nowrap"},children:[e&&i.jsx(e,{style:{width:"14px",height:"14px"}}),t]})},JI=({count:t})=>{const e=Ge();return t===0?null:i.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"18px",height:"18px",padding:`0 ${e.space[1]}`,borderRadius:e.radius.md,backgroundColor:"#ef4444",color:"white",fontSize:e.fontSize.xs,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center"},children:t})},YI=({searchQuery:t,onSearchChange:e,searchPlaceholder:n="Durchsuchen...",showSearch:s=!0,categories:r=[],selectedCategory:o,onCategoryChange:a,showCategories:l=!0,difficultyOptions:c=[],selectedDifficulty:d,onDifficultyChange:u,showDifficulty:h=!1,viewMode:p,onViewModeChange:m,showViewToggle:x=!0,renderCustomFilters:g,customActions:y,children:v})=>{const[k,S]=f.useState(!1),w=KI(),b=Ge(),T=[o?1:0,d&&d!=="all"?1:0,t?.trim()?1:0].reduce((C,j)=>C+j,0);return w?i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[3]},children:[i.jsxs("div",{style:{display:"flex",gap:b.space[2],alignItems:"center"},children:[s&&i.jsxs("div",{style:{position:"relative",flex:"1"},children:[i.jsx(Ns,{style:{position:"absolute",left:b.space[3],top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:E.slate[400],pointerEvents:"none"}}),i.jsx("input",{type:"text",placeholder:n,value:t,onChange:C=>e(C.target.value),style:{width:"100%",padding:`${b.space[2]} ${b.space[3]} ${b.space[2]} 38px`,borderRadius:b.radius.md,border:`1px solid ${E.slate[200]}`,fontSize:b.fontSize.base,color:E.slate[900],backgroundColor:"#fff",outline:"none"}})]}),i.jsxs("button",{onClick:()=>S(!0),style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"44px",borderRadius:b.radius.md,border:`1px solid ${T>0?b.primaryAccent:E.slate[200]}`,backgroundColor:T>0?`${b.primaryAccent}10`:"white",cursor:"pointer",flexShrink:0},children:[i.jsx(va,{style:{width:"18px",height:"18px",color:T>0?b.primaryAccent:E.slate[500]}}),i.jsx(JI,{count:T})]}),x&&p&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",padding:"3px",backgroundColor:E.slate[100],borderRadius:b.radius.md,flexShrink:0},children:[i.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(no,{style:{width:"14px",height:"14px",color:p==="grid"?b.primaryAccent:E.slate[500]}})}),i.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(ld,{style:{width:"14px",height:"14px",color:p==="list"?b.primaryAccent:E.slate[500]}})})]})]}),y&&i.jsx("div",{style:{marginTop:b.space[2]},children:y}),i.jsx(ii,{open:k,onOpenChange:S,children:i.jsxs(si,{style:{position:"fixed",bottom:0,left:0,right:0,top:"auto",transform:"none",maxWidth:"100%",width:"100%",borderRadius:`${b.radius.xl} ${b.radius.xl} 0 0`,maxHeight:"80vh",overflow:"auto"},children:[i.jsx(ri,{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs(oi,{style:{display:"flex",alignItems:"center",gap:b.space[2]},children:[i.jsx(va,{style:{width:"20px",height:"20px",color:b.primaryAccent}}),"Filter"]}),T>0&&i.jsx("button",{onClick:()=>{a?.(null),u?.("all"),e?.("")},style:{padding:`${b.space[1]} ${b.space[3]}`,borderRadius:b.radius.sm,border:"none",backgroundColor:E.slate[100],color:E.slate[600],fontSize:b.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Zurcksetzen"})]})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[5],padding:`${b.space[2]} 0`},children:[h&&c.length>0&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:E.slate[700],marginBottom:b.space[2]},children:"Schwierigkeit"}),i.jsx("select",{value:d,onChange:C=>u(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px`,borderRadius:b.radius.md,border:`1px solid ${E.slate[200]}`,fontSize:b.fontSize.base,color:E.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(C=>i.jsx("option",{value:C.value,children:C.label},C.value))})]}),l&&r.length>0&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:E.slate[700],marginBottom:b.space[2]},children:"Kategorie"}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[i.jsx(aa,{label:"Alle",icon:no,isSelected:!o,onClick:()=>a(null)}),r.map(C=>i.jsx(aa,{label:C.label,icon:C.icon,isSelected:o===C.key,onClick:()=>a(C.key),color:C.color,bgColor:C.bgColor},C.key))]})]}),g&&i.jsx("div",{children:g()})]}),i.jsx("button",{onClick:()=>S(!1),style:{width:"100%",padding:b.space[3],marginTop:b.space[3],borderRadius:b.radius.lg,border:"none",background:`linear-gradient(135deg, ${b.primaryAccent} 0%, ${b.primaryAccent}dd 100%)`,color:"white",fontSize:b.fontSize.md,fontWeight:600,cursor:"pointer"},children:"Filter anwenden"})]})}),v]}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[4]},children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[3],alignItems:"center"},children:[s&&i.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[i.jsx(Ns,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:E.slate[400],pointerEvents:"none"}}),i.jsx("input",{type:"text",placeholder:n,value:t,onChange:C=>e(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 44px`,borderRadius:b.radius.lg,border:`1px solid ${E.slate[200]}`,fontSize:b.fontSize.base,color:E.slate[900],backgroundColor:"#fff",outline:"none",transition:b.transition.normal},onFocus:C=>{C.target.style.borderColor=b.primaryAccent,C.target.style.boxShadow=`0 0 0 3px ${b.primaryAccent}20`},onBlur:C=>{C.target.style.borderColor=E.slate[200],C.target.style.boxShadow="none"}})]}),h&&c.length>0&&i.jsxs("div",{style:{position:"relative",minWidth:"180px"},children:[i.jsx(va,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:E.slate[400],pointerEvents:"none"}}),i.jsx("select",{value:d,onChange:C=>u(C.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 40px`,borderRadius:b.radius.lg,border:`1px solid ${E.slate[200]}`,fontSize:b.fontSize.base,color:E.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(C=>i.jsx("option",{value:C.value,children:C.label},C.value))})]}),g&&g(),y,x&&p&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:b.space[1],padding:b.space[1],backgroundColor:E.slate[100],borderRadius:b.radius.md},children:[i.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",boxShadow:p==="grid"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Kachelansicht",children:i.jsx(no,{style:{width:"16px",height:"16px",color:p==="grid"?b.primaryAccent:E.slate[500]}})}),i.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",boxShadow:p==="list"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Listenansicht",children:i.jsx(ld,{style:{width:"16px",height:"16px",color:p==="list"?b.primaryAccent:E.slate[500]}})})]})]}),l&&r.length>0&&i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[i.jsx(aa,{label:"Alle",icon:no,isSelected:!o,onClick:()=>a(null)}),r.map(C=>i.jsx(aa,{label:C.label,icon:C.icon,isSelected:o===C.key,onClick:()=>a(C.key),color:C.color,bgColor:C.bgColor},C.key))]}),v]})},Mf=({category:t,getCategoryConfig:e})=>{const n=e(t);if(!n)return null;const s=n.IconComponent||n.icon||Go;return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:n.bgColor,color:n.color},children:[i.jsx(s,{style:{width:"12px",height:"12px"}}),n.shortLabel]})},XI=({category:t,getCategoryConfig:e})=>Array.isArray(t)?i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:t.map((n,s)=>i.jsx(Mf,{category:n,getCategoryConfig:e},s))}):i.jsx(Mf,{category:t,getCategoryConfig:e}),jl=({title:t,subtitle:e,headerIcon:n,fetchScenarios:s,moduleKey:r,historyButtonLabel:o="Meine Sessions",onNavigateToHistory:a,showHistoryButton:l=!0,onSelectScenario:c,renderCardMeta:d,renderCategoryBadge:u,getIconForScenario:h,cardActionLabel:p="Starten",cardActionIcon:m,getCardCustomActions:x,categoryField:g="category",customCategoryConfig:y,emptyStateIcon:v,emptyStateTitle:k="Keine Szenarien verfgbar",emptyStateMessage:S="Bitte kontaktieren Sie den Administrator.",searchPlaceholder:w="Durchsuchen...",headerActions:b,filterActions:T,renderInfoBox:C,extraContent:j,isAuthenticated:R,requireAuth:I,setPendingAction:A,setPendingScenario:L,demoCode:B,pendingScenario:P,clearPendingScenario:_,loadingMessage:O="Szenarien werden geladen...",errorRetryLabel:W="Erneut versuchen"})=>{const[D,N]=f.useState([]),[F,ne]=f.useState(!0),[re,Z]=f.useState(null),[ee,se]=f.useState(null),[z,V]=f.useState("grid"),[H,pe]=f.useState(""),{branding:Te,filterScenariosBySetupAndPartner:Le}=qe(),{getCategoryConfig:we,getCategoriesForFilter:Qe,matchesCategory:ye}=I2(),Ee=Te?.["--header-gradient"]||_e["--header-gradient"],Ke=Te?.["--header-text"]||_e["--header-text"],Me=Te?.["--primary-accent"]||_e["--primary-accent"],et=f.useCallback(async()=>{try{ne(!0),Z(null);const fe=await s();N(fe||[])}catch(fe){console.error(`[${t}] Error loading scenarios:`,fe),Z(fe.message||"Fehler beim Laden")}finally{ne(!1)}},[s,t]);f.useEffect(()=>{et()},[et]);const X=f.useRef(!1);f.useEffect(()=>{P&&R&&!X.current&&(X.current=!0,_&&_(),c(P))},[P,R,_,c]);const he=f.useMemo(()=>Le([...D],r),[D,Le,r]),be=f.useMemo(()=>{if(y){const oe=new Set;return he.forEach(xe=>{const tt=xe[g];tt&&y[tt]&&oe.add(tt)}),Array.from(oe)}const fe=he.flatMap(oe=>{const xe=oe[g];return Array.isArray(xe)?xe.filter(tt=>tt&&typeof tt=="string"&&tt.trim()):xe&&typeof xe=="string"&&xe.trim()?[xe]:[]});return[...new Set(fe)]},[he,g,y]),ue=f.useMemo(()=>y?be.filter(oe=>he.some(xe=>xe[g]===oe)).map(oe=>({key:oe,label:y[oe]?.label||oe,shortLabel:y[oe]?.label||oe,color:y[oe]?.color,bgColor:y[oe]?.bgColor,icon:y[oe]?.icon,IconComponent:y[oe]?.icon})):Qe(be).filter(oe=>!oe||!oe.label||!oe.label.trim()?!1:he.some(xe=>ye(xe[g],oe.key))),[be,y,Qe,he,g,ye]),gt=f.useMemo(()=>{let fe=[...he];if(ee&&(y?fe=fe.filter(oe=>oe[g]===ee):fe=fe.filter(oe=>ye(oe[g],ee))),H.trim()){const oe=H.toLowerCase();fe=fe.filter(xe=>xe.title?.toLowerCase().includes(oe)||xe.description?.toLowerCase().includes(oe))}return fe},[he,ee,H,g,y,ye]),lt=f.useCallback(fe=>{if(!R&&!B){L?L(fe):A&&A({type:"SELECT_SCENARIO",scenario:fe}),I&&I(()=>{c(fe)},{type:"SELECT_SCENARIO",scenario:fe});return}c(fe)},[R,B,L,A,I,c]),je=f.useCallback(fe=>{const oe=fe[g];if(!oe)return null;if(u)return u(fe,we);if(y&&y[oe]){const xe=y[oe];return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:xe.bgColor,color:xe.color},children:[xe.icon&&i.jsx(xe.icon,{style:{width:"12px",height:"12px"}}),xe.label]})}return i.jsx(XI,{category:oe,getCategoryConfig:we})},[g,u,y,we]);return F?i.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[i.jsx(me,{style:{width:"48px",height:"48px",color:Me,animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{color:E.slate[600],fontSize:"16px"},children:O}),i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}):re?i.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[i.jsx(Ie,{style:{width:"48px",height:"48px",color:E.red[500]}}),i.jsx("p",{style:{color:E.red[500],fontSize:"16px",textAlign:"center"},children:re}),i.jsx("button",{onClick:et,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:Me,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer"},children:W})]}):i.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:"32px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:Ee,display:"flex",alignItems:"center",justifyContent:"center"},children:n&&i.jsx(n,{style:{width:"24px",height:"24px",color:Ke}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:E.slate[900],margin:0},children:t}),i.jsx("p",{style:{fontSize:"14px",color:E.slate[600],margin:0},children:e})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[b,l&&R&&a&&i.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${Me}`,backgroundColor:"white",color:Me,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[i.jsx(od,{size:18}),o]})]})]}),i.jsx("div",{style:{marginTop:"24px"},children:i.jsx(YI,{searchQuery:H,onSearchChange:pe,searchPlaceholder:w,categories:ue.map(fe=>({key:fe.key,label:fe.label,shortLabel:fe.shortLabel||fe.label,color:fe.color,bgColor:fe.bgColor,icon:fe.IconComponent||fe.icon})),selectedCategory:ee,onCategoryChange:se,showCategories:ue.length>0,showDifficulty:!1,viewMode:z,onViewModeChange:V,customActions:T})})]}),gt.length>0?i.jsx(A0,{minCardWidth:"340px",viewMode:z,children:gt.map(fe=>{const oe=h?h(fe):null,xe=d?d(fe):[],tt=x?x(fe):null;return i.jsx(R0,{title:fe.title,description:fe.description,icon:oe,categoryBadge:je(fe),meta:xe,action:m?{label:p,icon:m}:{label:p},onClick:()=>lt(fe),viewMode:z,customActions:tt},fe.id)})}):i.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",backgroundColor:"white",borderRadius:"16px",border:`1px solid ${E.slate[200]}`},children:[i.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:v?i.jsx(v,{style:{width:"48px",height:"48px",color:E.slate[300]}}):i.jsx(Go,{style:{width:"48px",height:"48px",color:E.slate[300]}})}),i.jsx("h3",{style:{color:E.slate[500],margin:"0 0 8px 0",fontWeight:500},children:k}),i.jsx("p",{style:{color:E.slate[400],margin:0,fontSize:"14px"},children:ee?"In der ausgewhlten Kategorie sind keine Szenarien verfgbar.":S}),ee&&he.length>0&&i.jsx("button",{onClick:()=>se(null),style:{marginTop:"16px",padding:"10px 20px",borderRadius:"20px",border:`2px solid ${Me}`,backgroundColor:"white",color:Me,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"Alle Szenarien anzeigen"})]}),C&&C(),j]})},ZI=t=>{const e=[];return t.variables_schema&&t.variables_schema.length>0&&e.push({icon:rt,text:`${t.variables_schema.length} Variablen`}),e.push({icon:Ye,text:"~10 Min"}),e},QI=()=>jn,eR=({onSelectScenario:t,onBack:e,onOpenHistory:n,isAuthenticated:s,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,onNavigateToHistory:c})=>i.jsx(jl,{title:"Live-Simulationen",subtitle:"Live Simulationen mit KI-Interviewer",headerIcon:Ze,fetchScenarios:j0,moduleKey:"roleplay",historyButtonLabel:"Meine Live-Simulationen",onNavigateToHistory:c,onSelectScenario:t,renderCardMeta:ZI,getIconForScenario:QI,cardActionLabel:"Starten",cardActionIcon:gn,categoryField:"category",emptyStateIcon:st,emptyStateTitle:"Keine Szenarien gefunden.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:s,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,loadingMessage:"Szenarien werden geladen..."}),Uu=({selectedDeviceId:t,onDeviceChange:e,onTestClick:n,disabled:s=!1})=>{const[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(!1),p=f.useRef(0),m=f.useRef(!1),x=Ge(),g=async(S=!1)=>{if(!m.current&&!(S&&Date.now()-p.current<2e3)){m.current=!0,p.current=Date.now(),l(!0),d(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(C=>C.stop());const b=await navigator.mediaDevices.enumerateDevices();console.log("[MicrophoneSelector] All detected devices:",b.map(C=>({kind:C.kind,label:C.label||"(no label)",deviceId:C.deviceId?.substring(0,8)+"..."})));const T=b.filter(C=>C.kind==="audioinput");if(console.log("[MicrophoneSelector] Audio input devices:",T.length,T.map(C=>C.label||C.deviceId?.substring(0,8))),T.length===0)console.warn("[MicrophoneSelector] No audioinput devices found. All device kinds:",[...new Set(b.map(C=>C.kind))]),d("Kein Mikrofon gefunden"),o([]);else if(o(T),!t&&T.length>0){const C=T.find(j=>j.deviceId==="default")||T[0];e?.(C.deviceId)}}catch(w){console.error("Error loading microphone devices:",w),w.name==="NotAllowedError"||w.name==="PermissionDeniedError"?d("Mikrofonzugriff verweigert"):w.name==="NotFoundError"?d("Kein Mikrofon gefunden"):d("Fehler beim Laden der Mikrofone"),o([])}finally{l(!1),m.current=!1,p.current=Date.now()}}};f.useEffect(()=>{g(!1);let S=null;const w=()=>{S&&clearTimeout(S),S=setTimeout(()=>{g(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",w),()=>{S&&clearTimeout(S),navigator.mediaDevices?.removeEventListener("devicechange",w)}},[]);const y=S=>{if(S.label){let w=S.label;return w=w.replace(/^Default - /,""),w=w.replace(/^Kommunikation - /,""),w=w.replace(/^Standard - /,""),w.length>35&&(w=w.substring(0,32)+"..."),w}return`Mikrofon ${r.indexOf(S)+1}`},v=S=>{e?.(S),h(!1)},k=r.find(S=>S.deviceId===t);return i.jsxs("div",{className:"microphone-selector",style:{position:"relative"},children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:x.space[3]},children:[i.jsxs("button",{type:"button",onClick:()=>!s&&!a&&h(!u),disabled:s||a,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:x.space[3],padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${c?E.red[500]:E.slate[200]}`,backgroundColor:c?E.red[50]:E.white,cursor:s||a?"not-allowed":"pointer",opacity:s||a?.6:1,transition:x.transition.normal},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:x.space[3]},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:x.radius.md,display:"flex",alignItems:"center",justifyContent:"center",background:c?E.red[100]:x.headerGradient},children:c?i.jsx(Ie,{style:{width:"22px",height:"22px",color:E.red[500]}}):i.jsx(Ue,{style:{width:"22px",height:"22px",color:x.headerText}})}),i.jsxs("div",{style:{textAlign:"left"},children:[i.jsx("div",{style:{fontSize:x.fontSize.xs,color:E.slate[500],fontWeight:500,marginBottom:"2px"},children:"Mikrofon"}),i.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:600,color:c?E.red[600]:E.slate[800]},children:a?"Lade...":c||(k?y(k):"Bitte whlen")})]})]}),i.jsx(bt,{style:{width:"20px",height:"20px",color:E.slate[400],transform:u?"rotate(180deg)":"rotate(0)",transition:x.transition.normal}})]}),n&&!c&&i.jsxs("button",{type:"button",onClick:n,disabled:s||a||!t,style:{flex:"0 0 auto",display:"flex",alignItems:"center",gap:x.space[2],padding:`${x.space[3]} ${x.space[5]}`,borderRadius:x.radius.lg,border:`2px solid ${E.slate[200]}`,backgroundColor:E.white,cursor:s||a||!t?"not-allowed":"pointer",opacity:s||a||!t?.5:1,transition:x.transition.normal,whiteSpace:"nowrap"},children:[i.jsx(Ue,{style:{width:"18px",height:"18px",color:x.primaryAccent}}),i.jsx("span",{style:{fontSize:x.fontSize.base,fontWeight:600,color:E.slate[700]},children:"Testen"})]}),i.jsx("button",{type:"button",onClick:()=>g(!1),disabled:a,title:"Gerteliste aktualisieren",style:{display:"flex",alignItems:"center",justifyContent:"center",padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${E.slate[200]}`,backgroundColor:E.white,cursor:a?"not-allowed":"pointer",opacity:a?.5:1,transition:x.transition.normal},children:i.jsx(Ot,{style:{width:"20px",height:"20px",color:E.slate[600],animation:a?"spin 1s linear infinite":"none"}})})]}),u&&r.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{onClick:()=>h(!1),style:{position:"fixed",inset:0,zIndex:40}}),i.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:E.white,borderRadius:x.radius.lg,boxShadow:x.shadow.lg,border:`1px solid ${E.slate[200]}`,zIndex:x.zIndex.overlay,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:r.map((S,w)=>i.jsxs("button",{type:"button",onClick:()=>v(S.deviceId),style:{width:"100%",padding:`${x.space[3.5]} ${x.space[4]}`,textAlign:"left",display:"flex",alignItems:"center",gap:x.space[3],border:"none",backgroundColor:t===S.deviceId?x.primaryAccentLight:"transparent",cursor:"pointer",transition:x.transition.fast},onMouseEnter:b=>{t!==S.deviceId&&(b.currentTarget.style.backgroundColor=E.slate[50])},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=t===S.deviceId?x.primaryAccentLight:"transparent"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:x.radius.sm,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t===S.deviceId?x.primaryAccent:E.slate[100]},children:i.jsx(Ue,{style:{width:"18px",height:"18px",color:t===S.deviceId?E.white:E.slate[500]}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:500,color:t===S.deviceId?x.primaryAccent:E.slate[800],overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y(S)}),S.deviceId==="default"&&i.jsx("div",{style:{fontSize:x.fontSize.xs,color:E.slate[400]},children:"Systemstandard"})]}),t===S.deviceId&&i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:x.radius.full,backgroundColor:x.primaryAccent}})]},S.deviceId||w))})]}),!c&&r.length>0&&r.length<3&&i.jsx("div",{style:{marginTop:x.space[2.5],fontSize:x.fontSize.xs,color:E.slate[500],lineHeight:1.4},children:'Dein Headset wird nicht angezeigt? Klicke auf "Aktualisieren" nach dem Anschlieen oder prfe die Bluetooth-Verbindung (Headset-Modus statt Audio-Modus).'}),c==="Kein Mikrofon gefunden"&&i.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:E.amber[50],border:`1px solid ${E.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:E.amber[800],lineHeight:1.5},children:[i.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" Tipps zur Fehlerbehebung:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[i.jsxs("li",{children:["Bei ",i.jsx("strong",{children:"Bluetooth-Headsets"}),': Stelle sicher, dass das Headset im "Headset"- oder "Hands-Free"-Modus verbunden ist (nicht nur "Audio")']}),i.jsxs("li",{children:["Bei ",i.jsx("strong",{children:"USB-Headsets"}),": Trenne das Gert kurz und schliee es erneut an"]}),i.jsxs("li",{children:["Prfe die ",i.jsx("strong",{children:"Systemeinstellungen"})," deines Computers, ob das Mikrofon dort erkannt wird"]}),i.jsxs("li",{children:["Versuche einen anderen ",i.jsx("strong",{children:"Browser"})," (Chrome/Edge empfohlen)"]})]})]}),c==="Mikrofonzugriff verweigert"&&i.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:E.amber[50],border:`1px solid ${E.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:E.amber[800],lineHeight:1.5},children:[i.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" So erlaubst du den Mikrofonzugriff:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[i.jsxs("li",{children:["Klicke auf das ",i.jsx("strong",{children:"Schloss-Symbol"})," in der Adressleiste deines Browsers"]}),i.jsxs("li",{children:['Setze "Mikrofon" auf ',i.jsx("strong",{children:'"Zulassen"'})]}),i.jsx("li",{children:"Lade die Seite neu und versuche es erneut"})]})]}),i.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},_r=({audioLevel:t=0,isActive:e=!1,variant:n="spectrum",size:s="md",className:r,accentColor:o})=>{const a=t>1?t/100:t,l=f.useMemo(()=>({sm:{height:48,barCount:40,barWidth:3,gap:2},md:{height:64,barCount:50,barWidth:4,gap:2},lg:{height:80,barCount:60,barWidth:5,gap:3}}),[]),c=l[s]||l.md;switch(n){case"waveform":return i.jsx(nR,{level:a,isActive:e,config:c,className:r,accentColor:o});case"bars":return i.jsx(iR,{level:a,isActive:e,config:c,className:r,accentColor:o});case"pulse":return i.jsx(sR,{level:a,isActive:e,size:s,className:r,accentColor:o});case"minimal":return i.jsx(rR,{level:a,isActive:e,className:r,accentColor:o});case"spectrum":default:return i.jsx(tR,{level:a,isActive:e,config:c,className:r,accentColor:o})}},tR=({level:t,isActive:e,config:n,className:s,accentColor:r})=>{const[o,a]=f.useState([]),l=f.useRef(null),c=f.useRef(0),d=r||"#3b82f6",u=r?`${r}60`:"rgba(59, 130, 246, 0.4)";return f.useEffect(()=>{const h=n.barCount,p=()=>{const m=Date.now();if(m-c.current<50){l.current=requestAnimationFrame(p);return}c.current=m;const x=Array.from({length:h},(g,y)=>{if(!e)return 8+Math.random()*12;const v=Math.pow(t,.5),k=15+v*60,S=Math.sin(y/h*Math.PI*2+m*.003)*.3+.7,w=(Math.random()-.5)*v*40,b=Math.sin(y/h*Math.PI*3+m*.005)*v*15,T=k*S+w+b;return Math.min(95,Math.max(8,T))});a(x),l.current=requestAnimationFrame(p)};return p(),()=>{l.current&&cancelAnimationFrame(l.current)}},[e,t,n.barCount]),i.jsxs("div",{className:dt("relative w-full flex items-end justify-center",s),style:{height:n.height},children:[e&&t>.1&&i.jsx("div",{className:"absolute inset-0 rounded-lg opacity-30",style:{background:`radial-gradient(ellipse at center, ${u} 0%, transparent 70%)`}}),i.jsx("div",{className:"flex items-end justify-center h-full",style:{gap:n.gap},children:o.map((h,p)=>i.jsx("div",{className:"rounded-full transition-all",style:{width:n.barWidth,height:`${h}%`,background:e?`linear-gradient(to top, ${d}, ${Ps(d,40)})`:`linear-gradient(to top, ${Ps(d,-30)}, ${Ps(d,10)})`,opacity:e?.85+t*.15:.4,boxShadow:e&&t>.2?`0 0 ${4+t*8}px ${u}`:"none",transition:"height 0.08s ease-out, opacity 0.15s ease-out"}},p))})]})},nR=({level:t,isActive:e,config:n,className:s,accentColor:r})=>{const o=f.useRef(null),a=f.useRef(null),l=f.useRef(0),c=r||"#3b82f6";return f.useEffect(()=>{const d=o.current;if(!d)return;const u=d.getContext("2d"),h=d.width,p=d.height,m=()=>{u.clearRect(0,0,h,p);const x=e?.3+t*.5:.15,g=e?2+t:1.5;l.current+=e?.08+t*.04:.02;const y=u.createLinearGradient(0,0,h,0);y.addColorStop(0,Ps(c,-20)+"80"),y.addColorStop(.5,c),y.addColorStop(1,Ps(c,-20)+"80"),u.beginPath(),u.moveTo(0,p/2);for(let v=0;v<=h;v++){const k=v/h,S=Math.sin(k*Math.PI*g+l.current)*x,w=Math.sin(k*Math.PI*g*1.5+l.current*1.3)*x*.5,b=Math.sin(k*Math.PI*g*2.5+l.current*.7)*x*.25,T=Math.sin(k*Math.PI),C=p/2+(S+w+b)*p*T;u.lineTo(v,C)}u.strokeStyle=y,u.lineWidth=3,u.lineCap="round",u.stroke(),u.globalAlpha=.3,u.beginPath(),u.moveTo(0,p/2);for(let v=0;v<=h;v++){const k=v/h,S=Math.sin(k*Math.PI*g+l.current+.5)*x*.6,w=Math.sin(k*Math.PI),b=p/2+S*p*w;u.lineTo(v,b)}u.strokeStyle=y,u.lineWidth=2,u.stroke(),u.globalAlpha=1,a.current=requestAnimationFrame(m)};return m(),()=>{a.current&&cancelAnimationFrame(a.current)}},[e,t,c]),i.jsx("div",{className:dt("relative w-full",s),style:{height:n.height},children:i.jsx("canvas",{ref:o,width:500,height:n.height,className:"w-full h-full",style:{filter:e&&t>.2?`drop-shadow(0 0 8px ${c}60)`:"none"}})})},iR=({level:t,isActive:e,config:n,className:s,accentColor:r})=>{const o=n.barCount,a=r||"#3b82f6",c=(()=>{if(!e)return Array.from({length:o},()=>8+Math.random()*10);const d=Math.pow(t,.6);return Array.from({length:o},(u,h)=>{const p=20+d*55,m=Math.random()*d*30,x=Math.sin(h/o*Math.PI*4+Date.now()*.005)*d*10;return Math.min(95,Math.max(10,p+m+x))})})();return i.jsx("div",{className:dt("flex items-end justify-center w-full",s),style:{height:n.height,gap:n.gap},children:c.map((d,u)=>i.jsx($.div,{className:"rounded-sm",style:{width:n.barWidth,background:`linear-gradient(to top, ${a}, ${Ps(a,50)})`,boxShadow:e&&t>.15?`0 0 ${4+t*10}px ${a}50`:"none"},animate:{height:`${d}%`,opacity:e?.8+t*.2:.35},transition:{duration:.08,ease:"easeOut"}},u))})},sR=({level:t,isActive:e,size:n,className:s,accentColor:r})=>{const o={sm:{container:"w-16 h-16",icon:"w-6 h-6",ring:"w-20 h-20"},md:{container:"w-20 h-20",icon:"w-8 h-8",ring:"w-28 h-28"},lg:{container:"w-24 h-24",icon:"w-10 h-10",ring:"w-36 h-36"}},a=o[n]||o.md,l=r||"#3b82f6";return i.jsxs("div",{className:dt("relative flex items-center justify-center",s),children:[e&&i.jsxs(i.Fragment,{children:[i.jsx($.div,{className:dt("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.3+t*.4],opacity:[.4,0]},transition:{duration:1,repeat:1/0,ease:"easeOut"}}),i.jsx($.div,{className:dt("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.2+t*.3],opacity:[.3,0]},transition:{duration:1,repeat:1/0,ease:"easeOut",delay:.3}})]}),i.jsx($.div,{className:dt("rounded-full flex items-center justify-center",a.container),style:{background:`linear-gradient(135deg, ${l}, ${Ps(l,-20)})`,boxShadow:e?`0 0 ${20+t*30}px ${l}40`:`0 4px 12px ${l}20`},animate:{scale:e?1+t*.15:1},transition:{duration:.1},children:i.jsx(Ue,{className:dt(a.icon,"text-white")})})]})},rR=({level:t,isActive:e,className:n,accentColor:s})=>{const r=s||"#3b82f6",o=()=>e?t>.7?"rgb(34, 197, 94)":t>.3?r:"rgb(148, 163, 184)":"rgb(148, 163, 184)";return i.jsx("div",{className:dt("h-3 bg-slate-200 rounded-full overflow-hidden",n),children:i.jsx($.div,{className:"h-full rounded-full",style:{backgroundColor:o()},animate:{width:`${Math.max(5,t*100)}%`},transition:{duration:.1,ease:"easeOut"}})})};function Ps(t,e){const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n){const s=Math.min(255,Math.max(0,parseInt(n[1])+e)),r=Math.min(255,Math.max(0,parseInt(n[2])+e)),o=Math.min(255,Math.max(0,parseInt(n[3])+e));return`rgb(${s}, ${r}, ${o})`}if(t.startsWith("#")){const s=t.slice(1);let r;s.length===3?r=parseInt(s[0]+s[0]+s[1]+s[1]+s[2]+s[2],16):r=parseInt(s,16);const o=Math.min(255,Math.max(0,(r>>16&255)+e)),a=Math.min(255,Math.max(0,(r>>8&255)+e)),l=Math.min(255,Math.max(0,(r&255)+e));return`rgb(${o}, ${a}, ${l})`}return t}const Vu=({isOpen:t,onClose:e,deviceId:n})=>{const[s,r]=f.useState("idle"),[o,a]=f.useState(0),[l,c]=f.useState(null),[d,u]=f.useState(0),[h,p]=f.useState(null),m=Ge(),x=f.useRef(null),g=f.useRef([]),y=f.useRef(null),v=f.useRef(null),k=f.useRef(null),S=f.useRef(null),w=f.useRef(null),b=f.useRef(null),T=10;f.useEffect(()=>()=>j(),[]),f.useEffect(()=>{t?C():j()},[t]);const C=()=>{r("idle"),a(0),u(0),p(null),l&&(URL.revokeObjectURL(l),c(null))},j=()=>{if(w.current&&(clearInterval(w.current),w.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),x.current&&x.current.state!=="inactive")try{x.current.stop()}catch{}if(v.current){try{v.current.close()}catch{}v.current=null}y.current&&(y.current.getTracks().forEach(P=>P.stop()),y.current=null),b.current&&(b.current.pause(),b.current.src="")},R=async()=>{try{p(null),g.current=[],u(0);const P={audio:n?{deviceId:{exact:n}}:!0},_=await navigator.mediaDevices.getUserMedia(P);y.current=_,v.current=new(window.AudioContext||window.webkitAudioContext),k.current=v.current.createAnalyser(),v.current.createMediaStreamSource(_).connect(k.current),k.current.fftSize=256;const W=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";x.current=new MediaRecorder(_,{mimeType:W}),x.current.ondataavailable=N=>{N.data.size>0&&g.current.push(N.data)},x.current.onstop=()=>{const N=new Blob(g.current,{type:W}),F=URL.createObjectURL(N);c(F),r("recorded"),a(0)},x.current.start(100),r("recording");const D=()=>{if(k.current){const N=new Uint8Array(k.current.frequencyBinCount);k.current.getByteFrequencyData(N);const F=N.reduce((ne,re)=>ne+re,0)/N.length;a(F/255)}S.current=requestAnimationFrame(D)};D(),w.current=setInterval(()=>{u(N=>N>=T-1?(I(),T):N+1)},1e3)}catch(P){console.error("Error starting recording:",P),P.name==="NotAllowedError"?p("Mikrofonzugriff verweigert"):P.name==="NotFoundError"?p("Kein Mikrofon gefunden"):p("Fehler beim Starten der Aufnahme")}},I=()=>{w.current&&(clearInterval(w.current),w.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),v.current&&(v.current.close(),v.current=null),x.current&&x.current.state!=="inactive"&&x.current.stop(),y.current&&(y.current.getTracks().forEach(P=>P.stop()),y.current=null)},A=()=>{l&&(b.current&&b.current.pause(),b.current=new Audio(l),b.current.onended=()=>r("recorded"),b.current.play(),r("playing"))},L=()=>{b.current&&(b.current.pause(),b.current.currentTime=0),r("recorded")},B=()=>{l&&URL.revokeObjectURL(l),c(null),u(0),r("idle")};return t?i.jsx(Ve,{children:i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:m.space[5]},children:i.jsxs($.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:P=>P.stopPropagation(),style:{backgroundColor:E.white,borderRadius:m.radius["2xl"],width:"100%",maxWidth:"400px",boxShadow:m.shadow.xl,overflow:"hidden"},children:[i.jsxs("div",{style:{padding:`${m.space[5]} ${m.space[6]}`,borderBottom:`1px solid ${E.slate[200]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:m.space[3]},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:m.radius.md,background:m.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Ue,{style:{width:"20px",height:"20px",color:E.white}})}),i.jsxs("div",{children:[i.jsx("h2",{style:{fontSize:m.fontSize.xl,fontWeight:600,color:E.slate[900],margin:0},children:"Mikrofon testen"}),i.jsx("p",{style:{fontSize:m.fontSize.sm,color:E.slate[500],margin:0},children:"Prfe deine Audioqualitt"})]})]}),i.jsx("button",{onClick:e,style:{width:"44px",height:"44px",borderRadius:m.radius.lg,border:"none",backgroundColor:E.slate[100],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:m.transition.normal},onMouseEnter:P=>P.currentTarget.style.backgroundColor=E.slate[200],onMouseLeave:P=>P.currentTarget.style.backgroundColor=E.slate[100],children:i.jsx(Bt,{style:{width:"24px",height:"24px",color:E.slate[600]}})})]}),i.jsxs("div",{style:{padding:`${m.space[8]} ${m.space[6]}`},children:[h&&i.jsxs("div",{style:{marginBottom:m.space[6],padding:m.space[4],backgroundColor:E.red[50],border:`1px solid ${E.red[100]}`,borderRadius:m.radius.lg,display:"flex",alignItems:"center",gap:m.space[3]},children:[i.jsx(Ie,{style:{width:"20px",height:"20px",color:E.red[500]}}),i.jsx("p",{style:{fontSize:m.fontSize.base,color:E.red[600],margin:0},children:h})]}),i.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:m.space[6]},children:i.jsxs("div",{style:{position:"relative"},children:[i.jsxs($.div,{style:{width:"120px",height:"120px",borderRadius:"50%",backgroundColor:s==="recording"?E.red[50]:s==="playing"?E.green[50]:s==="recorded"?E.green[50]:E.slate[100],display:"flex",alignItems:"center",justifyContent:"center"},children:[s==="recording"&&i.jsx($.div,{style:{position:"absolute",inset:0,borderRadius:"50%",border:`3px solid ${E.red[500]}`},animate:{scale:[1,1+o*.3],opacity:[1,.3]},transition:{duration:.3,repeat:1/0}}),s==="idle"&&i.jsx(Ue,{style:{width:"48px",height:"48px",color:E.slate[400]}}),s==="recording"&&i.jsx(Ue,{style:{width:"48px",height:"48px",color:E.red[500]}}),s==="recorded"&&i.jsx(Jt,{style:{width:"48px",height:"48px",color:E.green[500]}}),s==="playing"&&i.jsx(_i,{style:{width:"48px",height:"48px",color:E.green[600]}})]}),s==="recording"&&i.jsxs("div",{style:{position:"absolute",bottom:"-8px",left:"50%",transform:"translateX(-50%)",padding:`${m.space[1]} ${m.space[3]}`,backgroundColor:E.red[500],color:E.white,borderRadius:m.radius["2xl"],fontSize:m.fontSize.sm,fontWeight:600,fontFamily:"monospace"},children:[d,"s / ",T,"s"]})]})}),s==="recording"&&i.jsx("div",{style:{marginBottom:m.space[6]},children:i.jsx(_r,{audioLevel:o,isActive:!0,variant:"bars",size:"sm"})}),i.jsxs("p",{style:{textAlign:"center",fontSize:m.fontSize.md,color:E.slate[600],marginBottom:m.space[6]},children:[s==="idle"&&'Klicke auf "Aufnahme starten" um dein Mikrofon zu testen.',s==="recording"&&"Sprich jetzt in dein Mikrofon...",s==="recorded"&&"Aufnahme fertig! Hre dir das Ergebnis an.",s==="playing"&&"Wiedergabe luft..."]}),i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:m.space[3]},children:[s==="idle"&&i.jsxs("button",{onClick:R,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:E.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(Ue,{style:{width:"18px",height:"18px"}}),"Aufnahme starten"]}),s==="recording"&&i.jsxs("button",{onClick:I,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",backgroundColor:E.red[500],color:E.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(zs,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),s==="recorded"&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:A,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:E.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(Lt,{style:{width:"18px",height:"18px"}}),"Anhren"]}),i.jsxs("button",{onClick:B,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${E.slate[200]}`,backgroundColor:E.white,color:E.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(Ot,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]}),s==="playing"&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${E.slate[200]}`,backgroundColor:E.white,color:E.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(zs,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),i.jsxs("button",{onClick:B,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${E.slate[200]}`,backgroundColor:E.white,color:E.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[i.jsx(Ot,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]})]})]})]})})}):null},oR=({type:t,devices:e,selectedDeviceId:n,onDeviceChange:s,isLoading:r,error:o,onRefresh:a,branding:l})=>{const[c,d]=f.useState(!1),u=t==="video"?i0:Ue,h=t==="video"?"Kamera":"Mikrofon",p=g=>{if(g.label){let y=g.label;return y=y.replace(/^Default - /,""),y=y.replace(/^Kommunikation - /,""),y=y.replace(/^Standard - /,""),y.length>40&&(y=y.substring(0,37)+"..."),y}return`${h} ${e.indexOf(g)+1}`},m=e.find(g=>g.deviceId===n),x=g=>{s?.(g),d(!1)};return i.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:i.jsxs("button",{type:"button",onClick:()=>!r&&d(!c),disabled:r,style:{flex:"1 1 100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"14px 18px",borderRadius:"14px",border:`2px solid ${o?l.error:l.borderColor}`,backgroundColor:o?l.errorLight:l.cardBgColor,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:o?l.errorLight:l.headerGradient},children:o?i.jsx(Ie,{style:{width:"24px",height:"24px",color:l.error}}):i.jsx(u,{style:{width:"24px",height:"24px",color:l.white}})}),i.jsxs("div",{style:{textAlign:"left"},children:[i.jsx("div",{style:{fontSize:"13px",color:l.textMuted,fontWeight:500,marginBottom:"2px"},children:h}),i.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:o?l.errorDark:l.textMain},children:r?"Lade...":o||(m?p(m):"Bitte whlen")})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o&&a&&i.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),a()},style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l.cardBgHover,cursor:"pointer"},children:i.jsx(Ot,{style:{width:"18px",height:"18px",color:l.textSecondary}})}),i.jsx(bt,{style:{width:"22px",height:"22px",color:l.textMuted,transform:c?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]})]})}),c&&e.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{onClick:()=>d(!1),style:{position:"fixed",inset:0,zIndex:40}}),i.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:l.cardBgColor,borderRadius:"14px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:`1px solid ${l.borderColor}`,zIndex:50,overflow:"hidden",maxHeight:"300px",overflowY:"auto"},children:e.map((g,y)=>i.jsxs("button",{type:"button",onClick:()=>x(g.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:n===g.deviceId?l.primaryAccentLight:l.transparent,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:v=>{n!==g.deviceId&&(v.currentTarget.style.backgroundColor=l.cardBgHover)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=n===g.deviceId?l.primaryAccentLight:l.transparent},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:n===g.deviceId?l.primaryAccent:l.cardBgHover},children:i.jsx(u,{style:{width:"20px",height:"20px",color:n===g.deviceId?l.white:l.textMuted}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:n===g.deviceId?l.primaryAccent:l.textMain,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p(g)}),g.deviceId==="default"&&i.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:"Systemstandard"})]}),n===g.deviceId&&i.jsx(Jt,{style:{width:"20px",height:"20px",color:l.primaryAccent}})]},g.deviceId||y))})]})]})},aR=({deviceId:t,branding:e})=>{const[n,s]=f.useState(!1),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(null),[u,h]=f.useState(0),p=f.useRef(null),m=f.useRef(null),x=f.useRef(null),g=f.useRef(null),y=f.useRef(null),v=f.useRef([]),k=f.useRef(null),S=f.useRef(null),w=async()=>{try{d(null),h(0),v.current=[];const R=await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:{exact:t}}:!0});p.current=R;const I=new(window.AudioContext||window.webkitAudioContext);g.current=I;const A=I.createMediaStreamSource(R),L=I.createAnalyser();L.fftSize=256,A.connect(L),m.current=L;const B=new MediaRecorder(R,{mimeType:"audio/webm"});y.current=B,B.ondataavailable=W=>{W.data.size>0&&v.current.push(W.data)},B.onstop=()=>{const W=new Blob(v.current,{type:"audio/webm"});d(W)},B.start(),s(!0);const P=Date.now();S.current=setInterval(()=>{h(Math.floor((Date.now()-P)/1e3))},100);const _=new Uint8Array(L.frequencyBinCount),O=()=>{L.getByteFrequencyData(_);const W=_.reduce((D,N)=>D+N,0)/_.length;l(Math.min(100,W/128*100)),x.current=requestAnimationFrame(O)};O()}catch(R){console.error("Error starting recording:",R)}},b=()=>{S.current&&(clearInterval(S.current),S.current=null),x.current&&(cancelAnimationFrame(x.current),x.current=null),y.current&&y.current.state!=="inactive"&&y.current.stop(),p.current&&(p.current.getTracks().forEach(R=>R.stop()),p.current=null),g.current&&(g.current.close(),g.current=null),s(!1),l(0)},T=()=>{if(!c)return;const R=URL.createObjectURL(c),I=new Audio(R);k.current=I,I.onplay=()=>o(!0),I.onended=()=>{o(!1),URL.revokeObjectURL(R)},I.onerror=()=>{o(!1),URL.revokeObjectURL(R)},I.play()},C=()=>{k.current&&(k.current.pause(),k.current.currentTime=0,k.current=null),o(!1)},j=()=>{C(),d(null),h(0)};return f.useEffect(()=>()=>{b(),C()},[]),f.useEffect(()=>{n&&b(),j()},[t]),i.jsxs("div",{style:{padding:"16px",backgroundColor:e.cardBgHover,borderRadius:"12px",marginTop:"8px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsx("button",{type:"button",onClick:n?b:w,disabled:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"none",backgroundColor:n?e.error:e.primaryAccent,color:e.white,fontSize:"14px",fontWeight:600,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:n?i.jsxs(i.Fragment,{children:[i.jsx(zs,{style:{width:"16px",height:"16px"}}),"Stoppen (",yt(u),")"]}):i.jsxs(i.Fragment,{children:[i.jsx(Ue,{style:{width:"16px",height:"16px"}}),"Aufnehmen"]})}),c&&!n&&i.jsx("button",{type:"button",onClick:r?C:T,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:`2px solid ${e.primaryAccent}`,backgroundColor:r?e.primaryAccentLight:e.cardBgColor,color:e.primaryAccent,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:r?i.jsxs(i.Fragment,{children:[i.jsx(zs,{style:{width:"16px",height:"16px"}}),"Stoppen"]}):i.jsxs(i.Fragment,{children:[i.jsx(Lt,{style:{width:"16px",height:"16px"}}),"Abspielen"]})}),n&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.error,fontSize:"13px"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:e.error,animation:"pulse 1s infinite"}}),"Aufnahme luft..."]}),r&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.successDark,fontSize:"13px"},children:[i.jsx(_i,{style:{width:"16px",height:"16px"}}),"Wiedergabe..."]}),c&&!n&&!r&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.textMuted,fontSize:"13px"},children:[i.jsx(Jt,{style:{width:"16px",height:"16px",color:e.success}}),"Aufnahme bereit (",yt(u),")"]})]}),n&&i.jsx(_r,{audioLevel:a/100,isActive:!0,variant:"bars",size:"sm"}),!n&&!c&&i.jsxs("p",{style:{margin:0,fontSize:"13px",color:e.textMuted,display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(_i,{style:{width:"14px",height:"14px"}}),"Nimm etwas auf und spiele es ab, um dein Mikrofon zu testen."]}),i.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})},lR=({deviceId:t,branding:e})=>{const n=f.useRef(null),s=f.useRef(null),[r,o]=f.useState(null);return f.useEffect(()=>(t&&(async()=>{try{s.current&&s.current.getTracks().forEach(c=>c.stop());const l=await navigator.mediaDevices.getUserMedia({video:t?{deviceId:{exact:t}}:!0});s.current=l,n.current&&(n.current.srcObject=l),o(null)}catch(l){console.error("Error starting camera preview:",l),o("Kamera-Vorschau nicht verfgbar")}})(),()=>{s.current&&s.current.getTracks().forEach(l=>l.stop())}),[t]),r?i.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.cardBgHover,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:e.textMuted,fontSize:"14px"},children:r}):i.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.textMain,borderRadius:"12px",overflow:"hidden"},children:i.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}})})},Sy=({mode:t="audio",scenario:e,onBack:n,onStart:s,title:r,startButtonLabel:o="Training starten",icon:a,extraContent:l=null,disabled:c=!1})=>{const[d,u]=f.useState(window.innerWidth<768);f.useEffect(()=>{const F=()=>u(window.innerWidth<768);return window.addEventListener("resize",F),()=>window.removeEventListener("resize",F)},[]);const[h,p]=f.useState([]),[m,x]=f.useState([]),[g,y]=f.useState(null),[v,k]=f.useState(null),[S,w]=f.useState(!0),[b,T]=f.useState(null),[C,j]=f.useState(null),[R,I]=f.useState(!1),A=f.useRef(0),L=f.useRef(!1),B=f.useRef(null),P=f.useRef(null),_=Ge(),O=t==="audio-video";B.current=g,P.current=v;const W=f.useCallback(async(F=!1)=>{if(!L.current&&!(F&&Date.now()-A.current<2e3)){L.current=!0,A.current=Date.now(),w(!0),T(null),O&&j(null);try{const ne={audio:!0};O&&(ne.video=!0),(await navigator.mediaDevices.getUserMedia(ne)).getTracks().forEach(z=>z.stop());const Z=await navigator.mediaDevices.enumerateDevices();console.log("[DeviceSetupPage] All detected devices:",Z.map(z=>({kind:z.kind,label:z.label||"(no label)",deviceId:z.deviceId?.substring(0,8)+"..."})));const ee=Z.filter(z=>z.kind==="audioinput"),se=Z.filter(z=>z.kind==="videoinput");if(console.log("[DeviceSetupPage] Audio inputs:",ee.length,"Video inputs:",se.length),ee.length===0)console.warn("[DeviceSetupPage] No audioinput devices found"),T("Kein Mikrofon gefunden"),p([]);else if(p(ee),!B.current){const z=ee.find(V=>V.deviceId==="default")||ee[0];y(z.deviceId)}if(O){if(se.length===0)j("Keine Kamera gefunden"),x([]);else if(x(se),!P.current){const z=se.find(V=>V.deviceId==="default")||se[0];k(z.deviceId)}}}catch(ne){console.error("Error loading devices:",ne),ne.name==="NotAllowedError"||ne.name==="PermissionDeniedError"?(T("Zugriff verweigert"),O&&j("Zugriff verweigert")):ne.name==="NotFoundError"?(T("Kein Mikrofon gefunden"),O&&j("Keine Kamera gefunden")):(T("Fehler beim Laden"),O&&j("Fehler beim Laden"))}finally{w(!1),L.current=!1,A.current=Date.now()}}},[O]);f.useEffect(()=>{W(!1);let F=null;const ne=()=>{F&&clearTimeout(F),F=setTimeout(()=>{W(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",ne),()=>{F&&clearTimeout(F),navigator.mediaDevices?.removeEventListener("devicechange",ne)}},[]);const D=()=>{s({selectedMicrophoneId:g,selectedCameraId:O?v:null})},N=g&&!b&&(!O||v&&!C)&&!c;return i.jsxs("div",{style:{padding:"24px",paddingBottom:d?"120px":"40px",maxWidth:"640px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:"32px"},children:[i.jsxs("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:_.transparent,color:_.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:F=>F.target.style.background=_.cardBgHover,onMouseLeave:F=>F.target.style.background=_.transparent,children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:_.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:a?i.jsx(a,{style:{width:"28px",height:"28px",color:_.headerText}}):i.jsx(Ue,{style:{width:"28px",height:"28px",color:_.headerText}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:_.textMain,margin:0},children:r||e?.title||"Gerte einrichten"}),i.jsx("p",{style:{fontSize:"14px",color:_.textSecondary,margin:"4px 0 0 0"},children:O?"Kamera und Mikrofon auswhlen":"Mikrofon auswhlen und testen"})]})]})]}),S&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 24px",backgroundColor:_.cardBgHover,borderRadius:"16px"},children:[i.jsx(me,{style:{width:"32px",height:"32px",color:_.primaryAccent,marginBottom:"16px"},className:"animate-spin"}),i.jsx("p",{style:{color:_.textSecondary,margin:0},children:"Gerte werden geladen..."})]}),!S&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[O&&i.jsxs("div",{style:{padding:"24px",backgroundColor:_.cardBgColor,borderRadius:"16px",border:`1px solid ${_.borderColor}`,marginBottom:"20px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[i.jsx(i0,{style:{width:"22px",height:"22px",color:_.primaryAccent}}),i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:_.textMain,margin:0},children:"Kamera auswhlen"})]}),i.jsx(oR,{type:"video",devices:m,selectedDeviceId:v,onDeviceChange:k,isLoading:S,error:C,onRefresh:W,branding:_}),v&&!C&&i.jsx(lR,{deviceId:v,branding:_})]}),i.jsxs("div",{style:{padding:"24px",backgroundColor:_.cardBgColor,borderRadius:"16px",border:`1px solid ${_.borderColor}`,marginBottom:"24px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[i.jsx(Ue,{style:{width:"22px",height:"22px",color:_.primaryAccent}}),i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:_.textMain,margin:0},children:"Mikrofon testen"})]}),i.jsx(Uu,{selectedDeviceId:g,onDeviceChange:y,onTestClick:()=>I(!0)})]}),l&&i.jsx("div",{style:{marginBottom:"24px"},children:l}),i.jsx("div",{style:d?{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:`linear-gradient(to top, ${_.pageBg} 80%, transparent)`,zIndex:100}:{},children:i.jsxs("button",{onClick:D,disabled:!N,style:{width:"100%",maxWidth:d?"100%":void 0,padding:"16px 24px",borderRadius:"14px",border:"none",background:N?_.buttonGradient:_.disabledBg,color:_.white,fontSize:"16px",fontWeight:600,cursor:N?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:N?`0 4px 12px ${_.primaryAccent}4d`:"none"},onMouseEnter:F=>{N&&(F.target.style.transform="translateY(-2px)",F.target.style.boxShadow=`0 6px 16px ${_.primaryAccent}66`)},onMouseLeave:F=>{F.target.style.transform="none",F.target.style.boxShadow=N?`0 4px 12px ${_.primaryAccent}4d`:"none"},children:[o,i.jsx(ds,{style:{width:"20px",height:"20px"}})]})})]}),i.jsx(Vu,{isOpen:R,onClose:()=>I(!1),deviceId:g})]})},cR="wss://karriereheld-ws-proxy.onrender.com/ws";async function dR(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`wss://api.elevenlabs.io/v1/convai/conversation?agent_id=${t}`,s=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Connection timeout - WebSocket may be blocked by firewall"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-s;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"WebSocket connection failed - may be blocked by firewall"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-s}):c({success:!1,error:`Connection closed: ${u.code} ${u.reason||""}`.trim()}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to create WebSocket connection"})}})}async function ky(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`${cR}?agent_id=${t}`,s=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Proxy connection timeout"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-s;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"Proxy connection failed"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-s}):c({success:!1,error:`Proxy connection closed: ${u.code}`}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to connect to proxy"})}})}function uR(){return typeof WebSocket<"u"}async function hR(t){if(!uR())return{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Browser untersttzt keine WebSocket-Verbindungen"};const e=await dR(t,5e3);if(e.success)return{mode:"websocket",directAvailable:!0,proxyAvailable:!1,directLatency:e.latency};const n=await ky(t,5e3);return n.success?{mode:"proxy",directAvailable:!1,proxyAvailable:!0,proxyLatency:n.latency,error:e.error}:{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Alle WebSocket-Verbindungen werden durch Firewall blockiert"}}const pR=({mode:t,isChecking:e,latency:n,proxyLatency:s,error:r,onSwitchMode:o,onRetry:a,directAvailable:l,proxyAvailable:c,b:d})=>e?i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:E.blue[50],border:`1px solid ${E.blue[200]}`,borderRadius:d.radius.lg},children:[i.jsx(me,{style:{width:"20px",height:"20px",color:E.blue[500]},className:"animate-spin"}),i.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:E.blue[700]},children:"Prfe Verbindung..."})]}):r&&!l&&!c?i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[3]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:E.red[50],border:`1px solid ${E.red[200]}`,borderRadius:d.radius.lg},children:[i.jsx(xs,{style:{width:"20px",height:"20px",color:E.red[600]}}),i.jsx("div",{style:{flex:1},children:i.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:E.red[800]},children:"Keine Verbindung mglich"})})]}),i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:E.slate[50],border:`1px solid ${E.slate[200]}`,borderRadius:d.radius.lg},children:[i.jsx(mn,{style:{width:"16px",height:"16px",color:E.slate[500],flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{style:{fontSize:d.fontSize.xs,color:E.slate[600]},children:[i.jsx("p",{style:{margin:0,fontWeight:d.fontWeight.medium,marginBottom:d.space[1]},children:"WebSocket-Verbindungen blockiert"}),i.jsx("p",{style:{margin:0},children:r})]})]}),i.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:d.space[1.5],fontSize:d.fontSize.xs,color:E.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",padding:0},children:[i.jsx(Ot,{style:{width:"12px",height:"12px"}}),"Verbindung erneut prfen"]})]}):t==="websocket"?i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:E.green[50],border:`1px solid ${E.green[200]}`,borderRadius:d.radius.lg},children:[i.jsx(Wr,{style:{width:"20px",height:"20px",color:E.green[500]}}),i.jsxs("div",{style:{flex:1},children:[i.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:E.green[700]},children:"Direkte Echtzeit-Verbindung"}),n&&i.jsxs("span",{style:{fontSize:d.fontSize.xs,color:E.green[600],marginLeft:d.space[2]},children:["(",n,"ms)"]})]}),i.jsx(Ds,{style:{width:"20px",height:"20px",color:E.green[500]}})]}),i.jsx("button",{onClick:()=>o("proxy"),style:{fontSize:d.fontSize.xs,color:E.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Proxy-Modus testen"})]}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:E.blue[50],border:`1px solid ${E.blue[200]}`,borderRadius:d.radius.lg},children:[i.jsx(Ru,{style:{width:"20px",height:"20px",color:E.blue[500]}}),i.jsxs("div",{style:{flex:1},children:[i.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:E.blue[700]},children:"Proxy-Modus (Echtzeit via Server)"}),s&&i.jsxs("span",{style:{fontSize:d.fontSize.xs,color:E.blue[500],marginLeft:d.space[2]},children:["(",s,"ms)"]})]}),i.jsx(Ds,{style:{width:"20px",height:"20px",color:E.blue[500]}})]}),!l&&i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3]} ${d.space[4]}`,backgroundColor:E.slate[50],border:`1px solid ${E.slate[200]}`,borderRadius:d.radius.lg},children:[i.jsx(mn,{style:{width:"14px",height:"14px",color:E.slate[500],flexShrink:0,marginTop:"2px"}}),i.jsx("div",{style:{fontSize:d.fontSize.xs,color:E.slate[600]},children:i.jsx("p",{style:{margin:0},children:"Direkte Verbindung blockiert. Der Proxy-Server ermglicht Echtzeit-Gesprche trotz Firewall."})})]}),l&&i.jsx("button",{onClick:()=>o("websocket"),style:{fontSize:d.fontSize.xs,color:E.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Direkte Verbindung nutzen"})]}),fR=({scenario:t,onBack:e,onStart:n})=>{const s=Ge(),[r,o]=f.useState("websocket"),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState(!1),[y,v]=f.useState(!1);f.useEffect(()=>{k()},[t]);const k=async()=>{l(!0),d(null);try{const I=t?.agent_id||ce.getElevenLabsAgentId();if(!I){o("websocket"),d("Keine Agent-ID konfiguriert"),g(!1),v(!1),l(!1);return}const A=await hR(I);o(A.mode),g(A.directAvailable),v(A.proxyAvailable),h(A.directLatency||null),m(A.proxyLatency||null),d(A.error||null)}catch(I){console.error("[DeviceSetup] Connection check failed:",I),o("websocket"),d(I.message),g(!1),v(!1)}finally{l(!1)}},S=async I=>{const A=t?.agent_id||ce.getElevenLabsAgentId();if(I==="proxy"&&!y&&A){l(!0);const L=await ky(A,5e3);if(l(!1),L.success)v(!0),m(L.latency),o("proxy");else{d("Proxy-Verbindung nicht verfgbar: "+L.error);return}}else o(I)},w=()=>{k()},b=({selectedMicrophoneId:I})=>{n({selectedMicrophoneId:I,connectionMode:r})},T=t?.interviewer_profile?.name;let C;r==="proxy"?C=T?`${T} anrufen (Proxy)`:"Gesprch starten (Proxy)":T?C=`${T} anrufen`:C="Gesprch starten";const j=()=>r==="proxy"?i.jsx(Ru,{style:{width:"20px",height:"20px",color:s.primaryAccent}}):i.jsx(Wr,{style:{width:"20px",height:"20px",color:s.primaryAccent}}),R=i.jsxs("div",{style:{padding:s.space[5],backgroundColor:"white",borderRadius:s.radius.xl,border:`1px solid ${E.slate[200]}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[2.5],marginBottom:s.space[4]},children:[j(),i.jsx("h3",{style:{fontSize:s.fontSize.lg,fontWeight:s.fontWeight.semibold,color:E.slate[900],margin:0},children:"Verbindungsmodus"})]}),i.jsx(pR,{mode:r,isChecking:a,latency:u,proxyLatency:p,error:c,onSwitchMode:S,onRetry:w,directAvailable:x,proxyAvailable:y,b:s})]});return i.jsx(Sy,{mode:"audio",scenario:t,onBack:e,onStart:b,title:t?.title,startButtonLabel:C,icon:Ze,disabled:a,extraContent:R})},gR=(t,e=300)=>{setTimeout(()=>{const n=t.target;if(n){const s=n.closest("div");s&&s.scrollIntoView({behavior:"smooth",block:"center"})}},e)},mR=(t,e=!1)=>({width:"100%",padding:`${t.space[3]} ${t.space[4]}`,borderRadius:t.radius.lg,border:`2px solid ${e?E.red[500]:E.slate[200]}`,fontSize:t.fontSize.base,color:E.slate[900],backgroundColor:"white",outline:"none",transition:`border-color ${t.transition.normal}, box-shadow ${t.transition.normal}`}),xR=`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,yR=({field:t,value:e,onChange:n,error:s,focusColor:r})=>{const o=Ge(),a=r||o.primaryAccent||E.blue[500],l=mR(o,!!s),c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=m=>{Object.assign(m.target.style,c),gR(m)},u=m=>{m.target.style.borderColor=s?E.red[500]:E.slate[200],m.target.style.boxShadow="none"},h=()=>t.placeholder||t.default||`${t.label} eingeben...`,p=()=>{switch(t.type){case"text":return i.jsx("input",{type:"text",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),style:l,onFocus:d,onBlur:u});case"textarea":return i.jsx("textarea",{value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return i.jsxs("select",{value:e||t.default||"",onChange:m=>n(t.key,m.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:xR,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[i.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(m=>{const x=m.value??m,g=m.label??m;return i.jsx("option",{value:x,children:g},x)})]});case"number":return i.jsx("input",{type:"number",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),min:t.validation?.min,max:t.validation?.max,style:l,onFocus:d,onBlur:u});default:return i.jsx("input",{type:"text",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),style:l,onFocus:d,onBlur:u})}};return i.jsxs("div",{style:{marginBottom:o.space[5]},children:[i.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:E.slate[700]},children:[t.label,t.required&&i.jsx("span",{style:{color:E.red[500],marginLeft:o.space[1]},children:"*"})]}),p(),s&&i.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:E.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[i.jsx(Ie,{style:{width:"14px",height:"14px",flexShrink:0}}),s]}),t.hint&&!s&&i.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:E.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[i.jsx(mn,{style:{width:"14px",height:"14px",flexShrink:0}}),t.hint]})]})},bR=({scenario:t,onBack:e,onNext:n})=>{const[s,r]=f.useState({}),[o,a]=f.useState({}),l=Ge(),c=m=>{if(!m)return m;let x=m;return Object.entries(s).forEach(([g,y])=>{const v=new RegExp(`\\{\\{${g}\\}\\}`,"g");x=x.replace(v,y||"")}),x},d=Cn.useMemo(()=>t?.variables_schema?t.variables_schema.filter(m=>m.user_input!==!1):[],[t?.variables_schema]);f.useEffect(()=>{if(t?.variables_schema){const m={};t.variables_schema.forEach(x=>{x.default&&(m[x.key]=x.default)}),r(m)}},[t?.variables_schema]);const u=(m,x)=>{r(g=>({...g,[m]:x})),o[m]&&a(g=>{const y={...g};return delete y[m],y})},h=()=>{const m={};return d.forEach(x=>{const g=s[x.key];x.required&&(!g||g.toString().trim()==="")&&(m[x.key]=`${x.label} ist ein Pflichtfeld`)}),a(m),Object.keys(m).length===0},p=m=>{m.preventDefault(),h()&&n(s)};return f.useEffect(()=>{if(d.length===0){const m={};t?.variables_schema?.forEach(x=>{x.default&&(m[x.key]=x.default)}),n(m)}},[d,t,n]),d.length===0?null:i.jsxs("div",{style:{padding:l.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:l.space[8]},children:[i.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:l.space[2],padding:`${l.space[2]} ${l.space[3]}`,marginBottom:l.space[4],border:"none",background:"transparent",color:E.slate[600],fontSize:l.fontSize.sm,cursor:"pointer",borderRadius:l.radius.md,transition:`background ${l.transition.normal}`},onMouseEnter:m=>m.target.style.background=E.slate[100],onMouseLeave:m=>m.target.style.background="transparent",children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[4]},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:l.radius.xl,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(st,{style:{width:"28px",height:"28px",color:l.headerText}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:l.fontSize.xl,fontWeight:700,color:E.slate[900],margin:0},children:t.title}),i.jsx("p",{style:{fontSize:l.fontSize.sm,color:E.slate[600],margin:`${l.space[1]} 0 0 0`},children:"Personalisiere dein Rollenspiel"})]})]})]}),t.long_description&&i.jsx("div",{style:{padding:`${l.space[5]} ${l.space[6]}`,borderRadius:l.radius.xl,backgroundColor:"white",border:`1px solid ${E.slate[200]}`,marginBottom:l.space[6]},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:l.space[3.5]},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:l.radius.lg,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(mn,{style:{width:"20px",height:"20px",color:"white"}})}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:l.fontSize.base,fontWeight:600,color:E.slate[900],margin:`0 0 ${l.space[2]} 0`},children:"Deine Aufgabe"}),i.jsx("p",{style:{fontSize:l.fontSize.sm,lineHeight:"1.6",color:E.slate[700],margin:0,whiteSpace:"pre-wrap"},children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),!t.long_description&&t.description&&i.jsx("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:E.slate[100],marginBottom:l.space[6]},children:i.jsx("p",{style:{fontSize:l.fontSize.sm,color:E.slate[700],margin:0,lineHeight:1.6},children:t.description})}),t.interviewer_profile&&i.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,border:`1px solid ${E.slate[200]}`,marginBottom:l.space[6],display:"flex",alignItems:"center",gap:l.space[4]},children:[t.interviewer_profile.image_url?i.jsx("img",{src:t.interviewer_profile.image_url,alt:c(t.interviewer_profile.name),style:{width:"48px",height:"48px",borderRadius:l.radius.full,objectFit:"cover"}}):i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:l.radius.full,background:l.primaryAccentLight,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Qt,{style:{width:"24px",height:"24px",color:l.primaryAccent}})}),i.jsxs("div",{children:[i.jsxs("p",{style:{fontSize:l.fontSize.sm,fontWeight:600,color:E.slate[900],margin:0},children:["Dein Gesprchspartner: ",c(t.interviewer_profile.name)]}),t.interviewer_profile.role&&i.jsx("p",{style:{fontSize:l.fontSize.sm,color:E.slate[600],margin:`${l.space[.5]} 0 0 0`},children:c(t.interviewer_profile.role)})]})]}),i.jsxs("form",{onSubmit:p,children:[d.map(m=>i.jsx(yR,{field:m,value:s[m.key],onChange:u,error:o[m.key],focusColor:l.primaryAccent},m.key)),i.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:l.primaryAccentLight,marginTop:l.space[6],marginBottom:l.space[6],display:"flex",gap:l.space[5],flexWrap:"wrap"},children:[i.jsxs("div",{children:[i.jsxs("span",{style:{fontSize:l.fontSize.xs,color:E.slate[500],display:"block"},children:[i.jsx(Ye,{style:{width:"12px",height:"12px",display:"inline",marginRight:l.space[1]}}),"Dauer"]}),i.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:E.slate[900]},children:"ca. 10 Min"})]}),i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:l.fontSize.xs,color:E.slate[500],display:"block"},children:"Typ"}),i.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:E.slate[900]},children:"Live-Gesprch"})]})]}),i.jsxs("button",{type:"submit",style:{width:"100%",padding:`${l.space[4]} ${l.space[6]}`,borderRadius:l.radius.xl,border:"none",background:l.buttonGradient,color:"white",fontSize:l.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:l.space[2.5],transition:`transform ${l.transition.normal}, box-shadow ${l.transition.normal}`,boxShadow:`0 4px 12px ${l.primaryAccent}4d`},onMouseEnter:m=>{m.target.style.transform="translateY(-2px)",m.target.style.boxShadow=`0 6px 16px ${l.primaryAccent}66`},onMouseLeave:m=>{m.target.style.transform="none",m.target.style.boxShadow=`0 4px 12px ${l.primaryAccent}4d`},children:["Weiter",i.jsx(ds,{style:{width:"20px",height:"20px"}})]})]})]})},xn=(t=768)=>{const[e,n]=f.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return f.useEffect(()=>{const s=()=>{n(window.innerWidth<t)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[t]),e},Qn={DIRECT:"direct",PROXY:"proxy"},vR="wss://karriereheld-ws-proxy.onrender.com/ws",io=t=>{if(!t)return t;let e=t.replace(/<\/p>\s*<p[^>]*>/gi,`

`).replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(p|div|h[1-6])[^>]*>/gi,`
`).replace(/<li[^>]*>/gi,`
- `).replace(/<\/li>/gi,"");const n=document.createElement("div");return n.innerHTML=e,e=n.textContent||n.innerText||"",e=e.replace(/[ \t]+/g," ").replace(/\n /g,`
`).replace(/ \n/g,`
`).replace(/\n{3,}/g,`

`).trim(),e},SR=t=>{let e=io(t?.content||"");return t?.interviewer_profile&&(e+=`

## Dein Profil:
`,t.interviewer_profile.name&&(e+=`
Dein Name: ${t.interviewer_profile.name}`),t.interviewer_profile.role&&(e+=`
Deine Rolle: ${t.interviewer_profile.role}`),t.interviewer_profile.properties&&(e+=`

### Deine Eigenschaften:
${io(t.interviewer_profile.properties)}`),t.interviewer_profile.typical_objections&&(e+=`

### Typische Einwnde, die du vorbringen solltest:
${io(t.interviewer_profile.typical_objections)}`),t.interviewer_profile.important_questions&&(e+=`

### Wichtige Fragen, die du stellen solltest:
${io(t.interviewer_profile.important_questions)}`)),e},wy=(t,e)=>{const n={...t};return e?.interviewer_profile&&(e.interviewer_profile.name&&(n.interviewer_name=e.interviewer_profile.name),e.interviewer_profile.role&&(n.interviewer_role=e.interviewer_profile.role),e.interviewer_profile.company&&(n.interviewer_company=e.interviewer_profile.company)),n};var Pf={};function kR(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(s){if(s!=="default"&&!(s in t)){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}})}),Object.freeze(t)}var wR=Object.defineProperty,CR=(t,e,n)=>e in t?wR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Df=(t,e,n)=>CR(t,typeof e!="symbol"?e+"":e,n);let an=class{constructor(){Df(this,"_locking"),Df(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),s=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),s}};function wt(t,e){if(!t)throw new Error(e)}const jR=34028234663852886e22,TR=-34028234663852886e22,ER=4294967295,IR=2147483647,RR=-2147483648;function Ca(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>IR||t<RR)throw new Error("invalid int 32: "+t)}function fd(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>ER||t<0)throw new Error("invalid uint 32: "+t)}function Cy(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>jR||t<TR))throw new Error("invalid float 32: "+t)}const jy=Symbol("@bufbuild/protobuf/enum-type");function AR(t){const e=t[jy];return wt(e,"missing enum type on enum object"),e}function Ty(t,e,n,s){t[jy]=Ey(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Ey(t,e,n){const s=Object.create(null),r=Object.create(null),o=[];for(const a of e){const l=Iy(a);o.push(l),s[a.name]=l,r[a.no]=l}return{typeName:t,values:o,findName(a){return s[a]},findNumber(a){return r[a]}}}function _R(t,e,n){const s={};for(const r of e){const o=Iy(r);s[o.localName]=o.no,s[o.no]=o.localName}return Ty(s,t,e),s}function Iy(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Gu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const s=this.getType(),r=s.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const s=this.getType(),r=s.runtime.json,o=r.makeReadOptions(n);return r.readMessage(s,e,o,this),this}fromJsonString(e,n){let s;try{s=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(s,n)}toBinary(e){const n=this.getType(),s=n.runtime.bin,r=s.makeWriteOptions(e),o=r.writerFactory();return s.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),s=n.runtime.json,r=s.makeWriteOptions(e);return s.writeMessage(this,r)}toJsonString(e){var n;const s=this.toJson(e);return JSON.stringify(s,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function MR(t,e,n,s){var r;const o=(r=s?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[o]:function(l){t.util.initFields(this),t.util.initPartial(l,this)}}[o];return Object.setPrototypeOf(a.prototype,new Gu),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(l,c){return new a().fromBinary(l,c)},fromJson(l,c){return new a().fromJson(l,c)},fromJsonString(l,c){return new a().fromJsonString(l,c)},equals(l,c){return t.util.equals(a,l,c)}}),a}function PR(){let t=0,e=0;for(let s=0;s<28;s+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<s,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let s=3;s<=31;s+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<s,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function uc(t,e,n){for(let o=0;o<28;o=o+7){const a=t>>>o,l=!(!(a>>>7)&&e==0),c=(l?a|128:a)&255;if(n.push(c),!l)return}const s=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?s|128:s)&255),!!r){for(let o=3;o<31;o=o+7){const a=e>>>o,l=!!(a>>>7),c=(l?a|128:a)&255;if(n.push(c),!l)return}n.push(e>>>31&1)}}const ja=4294967296;function Nf(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let s=0,r=0;function o(a,l){const c=Number(t.slice(a,l));r*=n,s=s*n+c,s>=ja&&(r=r+(s/ja|0),s=s%ja)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?Ay(s,r):Hu(s,r)}function DR(t,e){let n=Hu(t,e);const s=n.hi&2147483648;s&&(n=Ay(n.lo,n.hi));const r=Ry(n.lo,n.hi);return s?"-"+r:r}function Ry(t,e){if({lo:t,hi:e}=NR(t,e),e<=2097151)return String(ja*e+t);const n=t&16777215,s=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+s*6777216+r*6710656,a=s+r*8147497,l=r*2;const c=1e7;return o>=c&&(a+=Math.floor(o/c),o%=c),a>=c&&(l+=Math.floor(a/c),a%=c),l.toString()+zf(a)+zf(o)}function NR(t,e){return{lo:t>>>0,hi:e>>>0}}function Hu(t,e){return{lo:t|0,hi:e|0}}function Ay(t,e){return e=~e,t?t=~t+1:e+=1,Hu(t,e)}const zf=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Lf(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function zR(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function LR(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Pf!="object"||Pf.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>o||d<r)throw new Error("int64 invalid: ".concat(c));return d},uParse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>l||d<a)throw new Error("uint64 invalid: ".concat(c));return d},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigInt64(0,!0)},uDec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigUint64(0,!0)}}}const n=r=>wt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),s=r=>wt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),s(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Nf(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),s(r),Nf(r)},dec(r,o){return DR(r,o)},uDec(r,o){return Ry(r,o)}}}const ut=LR();var K;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(K||(K={}));var hs;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(hs||(hs={}));function Hi(t,e,n){if(e===n)return!0;if(t==K.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0}switch(t){case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return e==n}return!1}function Mr(t,e){switch(t){case K.BOOL:return!1;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return e==0?ut.zero:"0";case K.DOUBLE:case K.FLOAT:return 0;case K.BYTES:return new Uint8Array(0);case K.STRING:return"";default:return 0}}function _y(t,e){switch(t){case K.BOOL:return e===!1;case K.STRING:return e==="";case K.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Tt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Tt||(Tt={}));class OR{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),s=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],s),s+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(fd(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ca(e),Lf(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Cy(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){fd(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Ca(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Ca(e),e=(e<<1^e>>31)>>>0,Lf(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),r=ut.enc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),r=ut.uEnc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=ut.enc(e);return uc(n.lo,n.hi,this.buf),this}sint64(e){let n=ut.enc(e),s=n.hi>>31,r=n.lo<<1^s,o=(n.hi<<1|n.lo>>>31)^s;return uc(r,o,this.buf),this}uint64(e){let n=ut.uEnc(e);return uc(n.lo,n.hi,this.buf),this}}class BR{constructor(e,n){this.varint64=PR,this.uint32=zR,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,s=e&7;if(n<=0||s<0||s>5)throw new Error("illegal tag: field no "+n+" wire type "+s);return[n,s]}skip(e,n){let s=this.pos;switch(e){case Tt.Varint:for(;this.buf[this.pos++]&128;);break;case Tt.Bit64:this.pos+=4;case Tt.Bit32:this.pos+=4;break;case Tt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Tt.StartGroup:for(;;){const[o,a]=this.tag();if(a===Tt.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(a,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ut.dec(...this.varint64())}uint64(){return ut.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),s=-(e&1);return e=(e>>>1|(n&1)<<31)^s,n=n>>>1^s,ut.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ut.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ut.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function FR(t,e,n,s){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof s=="function"?s():s;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function My(t){const e=t.field.localName,n=Object.create(null);return n[e]=WR(t),[n,()=>n[e]]}function WR(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Mr(e.T,e.L);case"message":const n=e.T,s=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(s):s;case"map":throw"map fields are not allowed to be extensions"}}function $R(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Tl=[];for(let t=0;t<Ci.length;t++)Tl[Ci[t].charCodeAt(0)]=t;Tl[45]=Ci.indexOf("+");Tl[95]=Ci.indexOf("/");const Py={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),s=0,r=0,o,a=0;for(let l=0;l<t.length;l++){if(o=Tl[t.charCodeAt(l)],o===void 0)switch(t[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=o,r=1;break;case 1:n[s++]=a<<2|(o&48)>>4,a=o,r=2;break;case 2:n[s++]=(a&15)<<4|(o&60)>>2,a=o,r=3;break;case 3:n[s++]=(a&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,s)},enc(t){let e="",n=0,s,r=0;for(let o=0;o<t.length;o++)switch(s=t[o],n){case 0:e+=Ci[s>>2],r=(s&3)<<4,n=1;break;case 1:e+=Ci[r|s>>4],r=(s&15)<<2,n=2;break;case 2:e+=Ci[r|s>>6],e+=Ci[s&63],n=0;break}return n&&(e+=Ci[r],e+="=",n==1&&(e+="=")),e}};function UR(t,e,n){Ny(e,t);const s=e.runtime.bin.makeReadOptions(n),r=$R(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,a]=My(e);for(const l of r)e.runtime.bin.readField(o,s.readerFactory(l.data),e.field,l.wireType,s);return a()}function VR(t,e,n,s){Ny(e,t);const r=e.runtime.bin.makeReadOptions(s),o=e.runtime.bin.makeWriteOptions(s);if(Dy(t,e)){const d=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of d)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const a=o.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[d,u]=c.tag(),h=c.skip(u,d);t.getType().runtime.bin.onUnknownField(t,d,u,h)}}function Dy(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(s=>s.no==e.field.no)}function Ny(t,e){wt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function zy(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!_y(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Of(t,e){const n=t.localName,s=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=s?t.T.values[0].no:void 0;break;case"scalar":e[n]=s?Mr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ji(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Gu.prototype).every(s=>s in t&&typeof t[s]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Ly(t,e){return ji(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}K.DOUBLE,K.FLOAT,K.INT64,K.UINT64,K.INT32,K.UINT32,K.BOOL,K.STRING,K.BYTES;const Bf={ignoreUnknownFields:!1},Ff={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function GR(t){return t?Object.assign(Object.assign({},Bf),t):Bf}function HR(t){return t?Object.assign(Object.assign({},Ff),t):Ff}const Ka=Symbol(),Ta=Symbol();function qR(){return{makeReadOptions:GR,makeWriteOptions:HR,readMessage(t,e,n,s){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Xn(e)));s=s??new t;const r=new Map,o=n.typeRegistry;for(const[a,l]of Object.entries(e)){const c=t.fields.findJsonName(a);if(c){if(c.oneof){if(l===null&&c.kind=="scalar")continue;const d=r.get(c.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(d,'", "').concat(a,'"'));r.set(c.oneof,a)}Wf(s,l,c,n,t)}else{let d=!1;if(o?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=o.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==t.typeName){d=!0;const[h,p]=My(u);Wf(h,l,u.field,n,u),VR(s,u,p(),n)}}if(!d&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return s},writeMessage(t,e){const n=t.getType(),s={};let r;try{for(r of n.fields.byNumber()){if(!zy(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!JR(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],l=$f(r,a,e);l!==void 0&&(s[e.useProtoFieldName?r.name:r.jsonName]=l)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const l=o.findExtensionFor(n.typeName,a.no);if(l&&Dy(t,l)){const c=UR(t,l,e),d=$f(l.field,c,e);d!==void 0&&(s[l.field.jsonName]=d)}}}catch(o){const a=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),l=o instanceof Error?o.message:String(o);throw new Error(a+(l.length>0?": ".concat(l):""))}return s},readScalar(t,e,n){return po(t,e,n??hs.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||_y(t,e)))return Ea(t,e)},debug:Xn}}function Xn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Wf(t,e,n,s,r){let o=n.localName;if(n.repeated){if(wt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e)));const a=t[o];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(l)));switch(n.kind){case"message":a.push(n.T.fromJson(l,s));break;case"enum":const c=hc(n.T,l,s.ignoreUnknownFields,!0);c!==Ta&&a.push(c);break;case"scalar":try{a.push(po(n.T,l,n.L,!0))}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(l));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e)));const a=t[o];for(const[l,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let d;try{d=KR(n.K,l)}catch(u){let h="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}switch(n.V.kind){case"message":a[d]=n.V.T.fromJson(c,s);break;case"enum":const u=hc(n.V.T,c,s.ignoreUnknownFields,!0);u!==Ta&&(a[d]=u);break;case"scalar":try{a[d]=po(n.V.T,c,hs.BIGINT,!0)}catch(h){let p="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw h instanceof Error&&h.message.length>0&&(p+=": ".concat(h.message)),new Error(p)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let l=t[o];ji(l)?l.fromJson(e,s):(t[o]=l=a.fromJson(e,s),a.fieldWrapper&&!n.oneof&&(t[o]=a.fieldWrapper.unwrapField(l)));break;case"enum":const c=hc(n.T,e,s.ignoreUnknownFields,!1);switch(c){case Ka:Of(n,t);break;case Ta:break;default:t[o]=c;break}break;case"scalar":try{const d=po(n.T,e,n.L,!1);switch(d){case Ka:Of(n,t);break;default:t[o]=d;break}}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}function KR(t,e){if(t===K.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return po(t,e,hs.BIGINT,!0).toString()}function po(t,e,n,s){if(e===null)return s?Mr(t,n):Ka;switch(t){case K.DOUBLE:case K.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==K.FLOAT&&Cy(r),r;case K.INT32:case K.FIXED32:case K.SFIXED32:case K.SINT32:case K.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==K.UINT32||t==K.FIXED32?fd(o):Ca(o),o;case K.INT64:case K.SFIXED64:case K.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=ut.parse(e);return n?a.toString():a;case K.FIXED64:case K.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=ut.uParse(e);return n?l.toString():l;case K.BOOL:if(typeof e!="boolean")break;return e;case K.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case K.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Py.dec(e)}throw new Error}function hc(t,e,n,s){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:s?t.values[0].no:Ka;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Ta;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Xn(e)))}function JR(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function $f(t,e,n){if(t.kind=="map"){wt(typeof e=="object"&&e!=null);const s={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,l]of r)s[a.toString()]=Ea(t.V.T,l);break;case"message":for(const[a,l]of r)s[a.toString()]=l.toJson(n);break;case"enum":const o=t.V.T;for(const[a,l]of r)s[a.toString()]=pc(o,l,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?s:void 0}if(t.repeated){wt(Array.isArray(e));const s=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)s.push(Ea(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)s.push(pc(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)s.push(e[r].toJson(n));break}return n.emitDefaultValues||s.length>0?s:void 0}switch(t.kind){case"scalar":return Ea(t.T,e);case"enum":return pc(t.T,e,n.enumAsInteger);case"message":return Ly(t.T,e).toJson(n)}}function pc(t,e,n){var s;if(wt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(s=r?.name)!==null&&s!==void 0?s:e}function Ea(t,e){switch(t){case K.INT32:case K.SFIXED32:case K.SINT32:case K.FIXED32:case K.UINT32:return wt(typeof e=="number"),e;case K.FLOAT:case K.DOUBLE:return wt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case K.STRING:return wt(typeof e=="string"),e;case K.BOOL:return wt(typeof e=="boolean"),e;case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:return wt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case K.BYTES:return wt(e instanceof Uint8Array),Py.enc(e)}}const er=Symbol("@bufbuild/protobuf/unknown-fields"),Uf={readUnknownFields:!0,readerFactory:t=>new BR(t)},Vf={writeUnknownFields:!0,writerFactory:()=>new OR};function YR(t){return t?Object.assign(Object.assign({},Uf),t):Uf}function XR(t){return t?Object.assign(Object.assign({},Vf),t):Vf}function ZR(){return{makeReadOptions:YR,makeWriteOptions:XR,listUnknownFields(t){var e;return(e=t[er])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[er]},writeUnknownFields(t,e){const s=t[er];if(s)for(const r of s)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,s){const r=t;Array.isArray(r[er])||(r[er]=[]),r[er].push({no:e,wireType:n,data:s})},readMessage(t,e,n,s,r){const o=t.getType(),a=r?e.len:e.pos+n;let l,c;for(;e.pos<a&&([l,c]=e.tag(),!(r===!0&&c==Tt.EndGroup));){const d=o.fields.find(l);if(!d){const u=e.skip(c,l);s.readUnknownFields&&this.onUnknownField(t,l,c,u);continue}Gf(t,e,d,c,s)}if(r&&(c!=Tt.EndGroup||l!==n))throw new Error("invalid end group tag")},readField:Gf,writeMessage(t,e,n){const s=t.getType();for(const r of s.fields.byNumber()){if(!zy(r,t)){if(r.req)throw new Error("cannot encode field ".concat(s.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];Hf(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,s){e!==void 0&&Hf(t,e,n,s)}}}function Gf(t,e,n,s,r){let{repeated:o,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const l=n.kind=="enum"?K.INT32:n.T;let c=Ja;if(n.kind=="scalar"&&n.L>0&&(c=eA),o){let p=t[a];if(s==Tt.LengthDelimited&&l!=K.STRING&&l!=K.BYTES){let x=e.uint32()+e.pos;for(;e.pos<x;)p.push(c(e,l))}else p.push(c(e,l))}else t[a]=c(e,l);break;case"message":const d=n.T;o?t[a].push(Ia(e,new d,r,n)):ji(t[a])?Ia(e,t[a],r,n):(t[a]=Ia(e,new d,r,n),d.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=d.fieldWrapper.unwrapField(t[a])));break;case"map":let[u,h]=QR(n,e,r);t[a][u]=h;break}}function Ia(t,e,n,s){const r=e.getType().runtime.bin,o=s?.delimited;return r.readMessage(e,t,o?s.no:t.uint32(),n,o),e}function QR(t,e,n){const s=e.uint32(),r=e.pos+s;let o,a;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:o=Ja(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=Ja(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=Ia(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=Mr(t.K,hs.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(t.V.kind){case"scalar":a=Mr(t.V.T,hs.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[o,a]}function eA(t,e){const n=Ja(t,e);return typeof n=="bigint"?n.toString():n}function Ja(t,e){switch(e){case K.STRING:return t.string();case K.BOOL:return t.bool();case K.DOUBLE:return t.double();case K.FLOAT:return t.float();case K.INT32:return t.int32();case K.INT64:return t.int64();case K.UINT64:return t.uint64();case K.FIXED64:return t.fixed64();case K.BYTES:return t.bytes();case K.FIXED32:return t.fixed32();case K.SFIXED32:return t.sfixed32();case K.SFIXED64:return t.sfixed64();case K.SINT64:return t.sint64();case K.UINT32:return t.uint32();case K.SINT32:return t.sint32()}}function Hf(t,e,n,s){wt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?K.INT32:t.T;if(r)if(wt(Array.isArray(e)),t.packed)nA(n,o,t.no,e);else for(const a of e)fo(n,o,t.no,a);else fo(n,o,t.no,e);break;case"message":if(r){wt(Array.isArray(e));for(const a of e)qf(n,s,t,a)}else qf(n,s,t,e);break;case"map":wt(typeof e=="object"&&e!=null);for(const[a,l]of Object.entries(e))tA(n,s,t,a,l);break}}function tA(t,e,n,s,r){t.tag(n.no,Tt.LengthDelimited),t.fork();let o=s;switch(n.K){case K.INT32:case K.FIXED32:case K.UINT32:case K.SFIXED32:case K.SINT32:o=Number.parseInt(s);break;case K.BOOL:wt(s=="true"||s=="false"),o=s=="true";break}switch(fo(t,n.K,1,o),n.V.kind){case"scalar":fo(t,n.V.T,2,r);break;case"enum":fo(t,K.INT32,2,r);break;case"message":wt(r!==void 0),t.tag(2,Tt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function qf(t,e,n,s){const r=Ly(n.T,s);n.delimited?t.tag(n.no,Tt.StartGroup).raw(r.toBinary(e)).tag(n.no,Tt.EndGroup):t.tag(n.no,Tt.LengthDelimited).bytes(r.toBinary(e))}function fo(t,e,n,s){wt(s!==void 0);let[r,o]=Oy(e);t.tag(n,r)[o](s)}function nA(t,e,n,s){if(!s.length)return;t.tag(n,Tt.LengthDelimited).fork();let[,r]=Oy(e);for(let o=0;o<s.length;o++)t[r](s[o]);t.join()}function Oy(t){let e=Tt.Varint;switch(t){case K.BYTES:case K.STRING:e=Tt.LengthDelimited;break;case K.DOUBLE:case K.FIXED64:case K.SFIXED64:e=Tt.Bit64;break;case K.FIXED32:case K.SFIXED32:case K.FLOAT:e=Tt.Bit32;break}const n=K[t].toLowerCase();return[e,n]}function iA(){return{setEnumType:Ty,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const s of n.fields.byMember()){const r=s.localName,o=e,a=t;if(a[r]!=null)switch(s.kind){case"oneof":const l=a[r].case;if(l===void 0)continue;const c=s.findField(l);let d=a[r].value;c&&c.kind=="message"&&!ji(d,c.T)?d=new c.T(d):c&&c.kind==="scalar"&&c.T===K.BYTES&&(d=Kr(d)),o[r]={case:l,value:d};break;case"scalar":case"enum":let u=a[r];s.T===K.BYTES&&(u=s.repeated?u.map(Kr):Kr(u)),o[r]=u;break;case"map":switch(s.V.kind){case"scalar":case"enum":if(s.V.T===K.BYTES)for(const[m,x]of Object.entries(a[r]))o[r][m]=Kr(x);else Object.assign(o[r],a[r]);break;case"message":const p=s.V.T;for(const m of Object.keys(a[r])){let x=a[r][m];p.fieldWrapper||(x=new p(x)),o[r][m]=x}break}break;case"message":const h=s.T;if(s.repeated)o[r]=a[r].map(p=>ji(p,h)?p:new h(p));else{const p=a[r];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?o[r]=Kr(p):o[r]=p:o[r]=ji(p,h)?p:new h(p)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(s=>{const r=e[s.localName],o=n[s.localName];if(s.repeated){if(r.length!==o.length)return!1;switch(s.kind){case"message":return r.every((a,l)=>s.T.equals(a,o[l]));case"scalar":return r.every((a,l)=>Hi(s.T,a,o[l]));case"enum":return r.every((a,l)=>Hi(K.INT32,a,o[l]))}throw new Error("repeated cannot contain ".concat(s.kind))}switch(s.kind){case"message":let a=r,l=o;return s.T.fieldWrapper&&(a!==void 0&&!ji(a)&&(a=s.T.fieldWrapper.wrapField(a)),l!==void 0&&!ji(l)&&(l=s.T.fieldWrapper.wrapField(l))),s.T.equals(a,l);case"enum":return Hi(K.INT32,r,o);case"scalar":return Hi(s.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=s.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return Hi(K.INT32,r.value,o.value);case"scalar":return Hi(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const d=Object.keys(r).concat(Object.keys(o));switch(s.V.kind){case"message":const u=s.V.T;return d.every(p=>u.equals(r[p],o[p]));case"enum":return d.every(p=>Hi(K.INT32,r[p],o[p]));case"scalar":const h=s.V.T;return d.every(p=>Hi(h,r[p],o[p]))}break}})},clone(t){const e=t.getType(),n=new e,s=n;for(const r of e.fields.byMember()){const o=t[r.localName];let a;if(r.repeated)a=o.map(la);else if(r.kind=="map"){a=s[r.localName];for(const[l,c]of Object.entries(o))a[l]=la(c)}else r.kind=="oneof"?a=r.findField(o.case)?{case:o.case,value:la(o.value)}:{case:void 0}:a=la(o);s[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(s,r.no,r.wireType,r.data);return n}}}function la(t){if(t===void 0)return t;if(ji(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Kr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function sA(t,e,n){return{syntax:t,json:qR(),bin:ZR(),util:Object.assign(Object.assign({},iA()),{newFieldList:e,initFields:n}),makeMessageType(s,r,o){return MR(this,s,r,o)},makeEnum:_R,makeEnumType:Ey,getEnumType:AR,makeExtension(s,r,o){return FR(this,s,r,o)}}}class rA{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const s of this.list())n[s.jsonName]=n[s.name]=s;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const s of this.list())n[s.no]=s;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const s of this.list())s.oneof?s.oneof!==n&&(n=s.oneof,e.push(n)):e.push(s)}return this.members}}function By(t,e){const n=Fy(t);return e?n:uA(dA(n))}function oA(t){return By(t,!1)}const aA=Fy;function Fy(t){let e=!1;const n=[];for(let s=0;s<t.length;s++){let r=t.charAt(s);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const lA=new Set(["constructor","toString","toJSON","valueOf"]),cA=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Wy=t=>"".concat(t,"$"),dA=t=>cA.has(t)?Wy(t):t,uA=t=>lA.has(t)?Wy(t):t;class hA{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=oA(e)}addField(e){wt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function pA(t,e){var n,s,r,o,a,l;const c=[];let d;for(const u of typeof t=="function"?t():t){const h=u;if(h.localName=By(u.name,u.oneof!==void 0),h.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:aA(u.name),h.repeated=(s=u.repeated)!==null&&s!==void 0?s:!1,u.kind=="scalar"&&(h.L=(r=u.L)!==null&&r!==void 0?r:hs.BIGINT),h.delimited=(o=u.delimited)!==null&&o!==void 0?o:!1,h.req=(a=u.req)!==null&&a!==void 0?a:!1,h.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(h.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=K.BYTES&&u.T!=K.STRING),u.oneof!==void 0){const p=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!d||d.name!=p)&&(d=new hA(p)),h.oneof=d,d.addField(h)}c.push(h)}return c}const U=sA("proto3",t=>new rA(t,e=>pA(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,s=t;if(e.repeated){s[n]=[];continue}switch(e.kind){case"oneof":s[n]={case:void 0};break;case"enum":s[n]=0;break;case"map":s[n]={};break;case"scalar":s[n]=Mr(e.T,e.L);break}}});class dn extends Gu{constructor(e){super(),this.seconds=ut.zero,this.nanos=0,U.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(U.json.debug(e)));const s=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!s)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(s[1]+"-"+s[2]+"-"+s[3]+"T"+s[4]+":"+s[5]+":"+s[6]+(s[8]?s[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ut.parse(r/1e3),this.nanos=0,s[7]&&(this.nanos=parseInt("1"+s[7]+"0".repeat(9-s[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let s="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?s="."+r.substring(0,3)+"Z":r.substring(6)==="000"?s="."+r.substring(0,6)+"Z":s="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",s)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return dn.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new dn({seconds:ut.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new dn().fromBinary(e,n)}static fromJson(e,n){return new dn().fromJson(e,n)}static fromJsonString(e,n){return new dn().fromJsonString(e,n)}static equals(e,n){return U.util.equals(dn,e,n)}}dn.runtime=U;dn.typeName="google.protobuf.Timestamp";dn.fields=U.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const fA=U.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:dn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:gA,repeated:!0},{no:5,name:"events",kind:"message",T:xA,repeated:!0}]),gA=U.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:mA,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),mA=U.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:dn},{no:3,name:"value",kind:"scalar",T:2}]),xA=U.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:dn},{no:7,name:"normalized_end_timestamp",kind:"message",T:dn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),$y=U.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Fn=U.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Rt=U.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),qu=U.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),so=U.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Mo=U.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Un=U.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Cs=U.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),yA=U.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),$t=U.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),El=U.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ya,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:tb}]),Ya=U.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),bA=U.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:U.getEnumType(Rt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Fs=U.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(vr)},{no:4,name:"tracks",kind:"message",T:pr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:bA},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:U.getEnumType(Po)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:U.getEnumType(Un)},{no:18,name:"kind_details",kind:"enum",T:U.getEnumType(vA),repeated:!0}]),vr=U.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Po=U.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),vA=U.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Dt=U.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),SA=U.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:rs,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType(Uy)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),pr=U.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:U.getEnumType(Fn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:U.getEnumType(Rt)},{no:10,name:"layers",kind:"message",T:rs,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:SA,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:U.getEnumType(Dt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:tb},{no:19,name:"audio_features",kind:"enum",T:U.getEnumType($t),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:U.getEnumType($y)}]),rs=U.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(qu)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Uy=U.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),sn=U.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:U.getEnumType(De)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Ku,oneof:"value"},{no:3,name:"speaker",kind:"message",T:kA,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:qy,oneof:"value"},{no:7,name:"transcription",kind:"message",T:wA,oneof:"value"},{no:8,name:"metrics",kind:"message",T:fA,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Xa,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Ju,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Yu,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Xu,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Za,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Qa,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:el,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Vy,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),De=U.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Vy=U.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:U.getEnumType(Dt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Gy=U.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Ku,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Xa,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Ju,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Yu,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Xu,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Za,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Qa,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:el,oneof:"value"}]),kA=U.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Hy,repeated:!0}]),Hy=U.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Ku=U.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),qy=U.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),wA=U.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:CA,repeated:!0}]),CA=U.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Xa=U.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Ju=U.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Yu=U.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Xu=U.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Ky,oneof:"value"}]),Ky=U.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Jy=U.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Yy=U.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:U.getEnumType(Xy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Xy=U.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Zy=U.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:U.getEnumType(Qy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Qy=U.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),eb=U.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Kf},{no:2,name:"screen",kind:"message",T:Kf},{no:3,name:"resume_connection",kind:"enum",T:U.getEnumType(Mo)},{no:4,name:"disabled_codecs",kind:"message",T:jA},{no:5,name:"force_relay",kind:"enum",T:U.getEnumType(Mo)}]),Kf=U.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:U.getEnumType(Mo)}]),jA=U.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ya,repeated:!0},{no:2,name:"publish",kind:"message",T:Ya,repeated:!0}]),tb=U.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),gd=U.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),nb=U.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:U.getEnumType(gd)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),ib=U.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Za=U.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:U.getEnumType(Dt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:nb,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:ib,oneof:"content_header"}],{localName:"DataStream_Header"}),Qa=U.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),el=U.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),TA=U.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Wn=U.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),md=U.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),EA=U.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),IA=U.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ps,oneof:"message"},{no:2,name:"answer",kind:"message",T:ps,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Il,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Do,oneof:"message"},{no:5,name:"mute",kind:"message",T:Rl,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Al,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:sb,oneof:"message"},{no:8,name:"leave",kind:"message",T:_l,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:ob,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:cb,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:nh,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Yn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:eh,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:hb,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Qu,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:rb,oneof:"message"}]),Jf=U.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:RA,oneof:"message"},{no:2,name:"answer",kind:"message",T:ps,oneof:"message"},{no:3,name:"offer",kind:"message",T:ps,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Il,oneof:"message"},{no:5,name:"update",kind:"message",T:MA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Zu,oneof:"message"},{no:8,name:"leave",kind:"message",T:_l,oneof:"message"},{no:9,name:"mute",kind:"message",T:Rl,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:PA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:DA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:zA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:OA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:FA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:$A,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:_A,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:AA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:VA,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:qA,oneof:"message"},{no:22,name:"request_response",kind:"message",T:KA,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:JA,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:UA,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:QA,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:WA,oneof:"message"}]),xd=U.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:rs,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType(Uy)}]),Do=U.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:U.getEnumType(Fn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:U.getEnumType(Rt)},{no:9,name:"layers",kind:"message",T:rs,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:xd,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:U.getEnumType(Dt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:U.getEnumType($y)},{no:17,name:"audio_features",kind:"enum",T:U.getEnumType($t),repeated:!0}]),Il=U.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:U.getEnumType(Wn)},{no:3,name:"final",kind:"scalar",T:8}]),Rl=U.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),RA=U.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:El},{no:2,name:"participant",kind:"message",T:Fs},{no:3,name:"other_participants",kind:"message",T:Fs,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ab,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:eb},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Yy},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ya,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),AA=U.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:ab,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:eb},{no:3,name:"server_info",kind:"message",T:Yy},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Zu=U.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:pr}]),_A=U.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ps=U.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),MA=U.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Fs,repeated:!0}]),Al=U.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Jy,repeated:!0}]),sb=U.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:U.getEnumType(qu)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Qu=U.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:U.getEnumType($t),repeated:!0}]),rb=U.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),_l=U.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:U.getEnumType(Un)},{no:3,name:"action",kind:"enum",T:U.getEnumType(Sr)},{no:4,name:"regions",kind:"message",T:GA}]),Sr=U.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),ob=U.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:rs,repeated:!0}]),eh=U.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),ab=U.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),PA=U.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Hy,repeated:!0}]),DA=U.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:El}]),NA=U.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:U.getEnumType(so)},{no:3,name:"score",kind:"scalar",T:2}]),zA=U.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:NA,repeated:!0}]),LA=U.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(md)}]),OA=U.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:LA,repeated:!0}]),th=U.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(qu)},{no:2,name:"enabled",kind:"scalar",T:8}]),BA=U.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:th,repeated:!0}]),FA=U.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:th,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:BA,repeated:!0}]),WA=U.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:TA,repeated:!0}]),lb=U.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),cb=U.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:lb,repeated:!0}]),$A=U.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),UA=U.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:El},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Fs},{no:4,name:"other_participants",kind:"message",T:Fs,repeated:!0}]),nh=U.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ps},{no:2,name:"subscription",kind:"message",T:Al},{no:3,name:"publish_tracks",kind:"message",T:Zu,repeated:!0},{no:4,name:"data_channels",kind:"message",T:ub,repeated:!0},{no:5,name:"offer",kind:"message",T:ps},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:db,repeated:!0}]),db=U.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),ub=U.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:U.getEnumType(Wn)}]),Yn=U.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:U.getEnumType(EA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),hb=U.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),VA=U.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),GA=U.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:HA,repeated:!0}]),HA=U.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),qA=U.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:U.getEnumType(yA)}]),KA=U.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:U.getEnumType(ih)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Il,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Do,oneof:"request"},{no:6,name:"mute",kind:"message",T:Rl,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:eh,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Qu,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:rb,oneof:"request"}]),ih=U.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),JA=U.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),pb=U.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),YA=U.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Zy},{no:2,name:"connection_settings",kind:"message",T:pb},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Do,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:ps},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:U.getEnumType(Cs)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:nh}]),XA=U.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:U.getEnumType(ZA)},{no:2,name:"join_request",kind:"scalar",T:12}]),ZA=U.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),QA=U.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function e_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ra={exports:{}},t_=Ra.exports,Yf;function n_(){return Yf||(Yf=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(t_,function(){var e=function(){},n="undefined",s=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},a=null;function l(g,y){var v=g[y];if(typeof v.bind=="function")return v.bind(g);try{return Function.prototype.bind.call(v,g)}catch{return function(){return Function.prototype.apply.apply(v,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&s?c:console[g]!==void 0?l(console,g):console.log!==void 0?l(console,"log"):e}function u(){for(var g=this.getLevel(),y=0;y<r.length;y++){var v=r[y];this[v]=y<g?e:this.methodFactory(v,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,y,v){return d(g)||h.apply(this,arguments)}function m(g,y){var v=this,k,S,w,b="loglevel";typeof g=="string"?b+=":"+g:typeof g=="symbol"&&(b=void 0);function T(A){var L=(r[A]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=L;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+L+";"}catch{}}}function C(){var A;if(!(typeof window===n||!b)){try{A=window.localStorage[b]}catch{}if(typeof A===n)try{var L=window.document.cookie,B=encodeURIComponent(b),P=L.indexOf(B+"=");P!==-1&&(A=/^([^;]+)/.exec(L.slice(P+B.length+1))[1])}catch{}return v.levels[A]===void 0&&(A=void 0),A}}function j(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function R(A){var L=A;if(typeof L=="string"&&v.levels[L.toUpperCase()]!==void 0&&(L=v.levels[L.toUpperCase()]),typeof L=="number"&&L>=0&&L<=v.levels.SILENT)return L;throw new TypeError("log.setLevel() called with invalid level: "+A)}v.name=g,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=y||p,v.getLevel=function(){return w??S??k},v.setLevel=function(A,L){return w=R(A),L!==!1&&T(w),u.call(v)},v.setDefaultLevel=function(A){S=R(A),C()||v.setLevel(A,!1)},v.resetLevel=function(){w=null,j(),u.call(v)},v.enableAll=function(A){v.setLevel(v.levels.TRACE,A)},v.disableAll=function(A){v.setLevel(v.levels.SILENT,A)},v.rebuild=function(){if(a!==v&&(k=R(a.getLevel())),u.call(v),a===v)for(var A in o)o[A].rebuild()},k=R(a?a.getLevel():"WARN");var I=C();I!=null&&(w=R(I)),u.call(v)}a=new m,a.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var v=o[y];return v||(v=o[y]=new m(y,a.methodFactory)),v};var x=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=x),a},a.getLoggers=function(){return o},a.default=a,a})})(Ra)),Ra.exports}var Ml=n_(),yd;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(yd||(yd={}));var Hn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Hn||(Hn={}));let Ae=Ml.getLogger("livekit");Object.values(Hn).map(t=>Ml.getLogger(t));Ae.setDefaultLevel(yd.info);function Li(t){const e=Ml.getLogger(t);return e.setDefaultLevel(Ae.getLevel()),e}const i_=Ml.getLogger("lk-e2ee"),Jr=7e3,s_=[0,300,4*300,9*300,16*300,Jr,Jr,Jr,Jr,Jr];class r_{constructor(e){this._retryDelays=e!==void 0?[...e]:s_}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function o_(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function M(t,e,n,s){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(u){try{d(s.next(u))}catch(h){a(h)}}function c(u){try{d(s.throw(u))}catch(h){a(h)}}function d(u){u.done?o(u.value):r(u.value).then(l,c)}d((s=s.apply(t,e||[])).next())})}function Xf(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ti(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Xf=="function"?Xf(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(o){n[o]=t[o]&&function(a){return new Promise(function(l,c){a=t[o](a),r(l,c,a.done,a.value)})}}function r(o,a,l,c){Promise.resolve(c).then(function(d){o({value:d,done:l})},a)}}var ca={exports:{}},Zf;function a_(){if(Zf)return ca.exports;Zf=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,T,C){return Function.prototype.apply.call(b,T,C)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function s(w){console&&console.warn&&console.warn(w)}var r=Number.isNaN||function(b){return b!==b};function o(){o.init.call(this)}ca.exports=o,ca.exports.once=v,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(w){if(typeof w!="number"||w<0||r(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");a=w}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function c(w){return w._maxListeners===void 0?o.defaultMaxListeners:w._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(b){for(var T=[],C=1;C<arguments.length;C++)T.push(arguments[C]);var j=b==="error",R=this._events;if(R!==void 0)j=j&&R.error===void 0;else if(!j)return!1;if(j){var I;if(T.length>0&&(I=T[0]),I instanceof Error)throw I;var A=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw A.context=I,A}var L=R[b];if(L===void 0)return!1;if(typeof L=="function")e(L,this,T);else for(var B=L.length,P=x(L,B),C=0;C<B;++C)e(P[C],this,T);return!0};function d(w,b,T,C){var j,R,I;if(l(T),R=w._events,R===void 0?(R=w._events=Object.create(null),w._eventsCount=0):(R.newListener!==void 0&&(w.emit("newListener",b,T.listener?T.listener:T),R=w._events),I=R[b]),I===void 0)I=R[b]=T,++w._eventsCount;else if(typeof I=="function"?I=R[b]=C?[T,I]:[I,T]:C?I.unshift(T):I.push(T),j=c(w),j>0&&I.length>j&&!I.warned){I.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=w,A.type=b,A.count=I.length,s(A)}return w}o.prototype.addListener=function(b,T){return d(this,b,T,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(b,T){return d(this,b,T,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(w,b,T){var C={fired:!1,wrapFn:void 0,target:w,type:b,listener:T},j=u.bind(C);return j.listener=T,C.wrapFn=j,j}o.prototype.once=function(b,T){return l(T),this.on(b,h(this,b,T)),this},o.prototype.prependOnceListener=function(b,T){return l(T),this.prependListener(b,h(this,b,T)),this},o.prototype.removeListener=function(b,T){var C,j,R,I,A;if(l(T),j=this._events,j===void 0)return this;if(C=j[b],C===void 0)return this;if(C===T||C.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete j[b],j.removeListener&&this.emit("removeListener",b,C.listener||T));else if(typeof C!="function"){for(R=-1,I=C.length-1;I>=0;I--)if(C[I]===T||C[I].listener===T){A=C[I].listener,R=I;break}if(R<0)return this;R===0?C.shift():g(C,R),C.length===1&&(j[b]=C[0]),j.removeListener!==void 0&&this.emit("removeListener",b,A||T)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(b){var T,C,j;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[b]),this;if(arguments.length===0){var R=Object.keys(C),I;for(j=0;j<R.length;++j)I=R[j],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=C[b],typeof T=="function")this.removeListener(b,T);else if(T!==void 0)for(j=T.length-1;j>=0;j--)this.removeListener(b,T[j]);return this};function p(w,b,T){var C=w._events;if(C===void 0)return[];var j=C[b];return j===void 0?[]:typeof j=="function"?T?[j.listener||j]:[j]:T?y(j):x(j,j.length)}o.prototype.listeners=function(b){return p(this,b,!0)},o.prototype.rawListeners=function(b){return p(this,b,!1)},o.listenerCount=function(w,b){return typeof w.listenerCount=="function"?w.listenerCount(b):m.call(w,b)},o.prototype.listenerCount=m;function m(w){var b=this._events;if(b!==void 0){var T=b[w];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function x(w,b){for(var T=new Array(b),C=0;C<b;++C)T[C]=w[C];return T}function g(w,b){for(;b+1<w.length;b++)w[b]=w[b+1];w.pop()}function y(w){for(var b=new Array(w.length),T=0;T<b.length;++T)b[T]=w[T].listener||w[T];return b}function v(w,b){return new Promise(function(T,C){function j(I){w.removeListener(b,R),C(I)}function R(){typeof w.removeListener=="function"&&w.removeListener("error",j),T([].slice.call(arguments))}S(w,b,R,{once:!0}),b!=="error"&&k(w,j,{once:!0})})}function k(w,b,T){typeof w.on=="function"&&S(w,"error",b,T)}function S(w,b,T,C){if(typeof w.on=="function")C.once?w.once(b,T):w.on(b,T);else if(typeof w.addEventListener=="function")w.addEventListener(b,function j(R){C.once&&w.removeEventListener(b,j),T(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return ca.exports}var fi=a_();let fb=!0,gb=!0;function ro(t,e,n){const s=t.match(e);return s&&s.length>=n&&parseFloat(s[n],10)}function qs(t,e,n){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,r=s.addEventListener;s.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=s.removeEventListener;s.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function l_(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(fb=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function c_(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(gb=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function mb(){if(typeof window=="object"){if(fb)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function sh(t,e){gb&&console.warn(t+" is deprecated, please use "+e+" instead.")}function d_(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const s=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(s)return{browser:"chrome",version:parseInt(s.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ro(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ro(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ro(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ro(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Qf(t){return Object.prototype.toString.call(t)==="[object Object]"}function xb(t){return Qf(t)?Object.keys(t).reduce(function(e,n){const s=Qf(t[n]),r=s?xb(t[n]):t[n],o=s&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function bd(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?bd(t,t.get(e[s]),n):s.endsWith("Ids")&&e[s].forEach(r=>{bd(t,t.get(r),n)})}))}function eg(t,e,n){const s=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(l=>{l.type===s&&l.trackId===a.id&&bd(t,l,r)})}),r}const tg=mb;function yb(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const s=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let p={};typeof u.ideal=="number"?(p[h("min",d)]=u.ideal,c.optional.push(p),p={},p[h("max",d)]=u.ideal,c.optional.push(p)):(p[h("",d)]=u.ideal,c.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(p,d)]=u[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,p){h in u&&!(p in u)&&(u[p]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=s(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(p=>{p=p.filter(x=>x.kind==="videoinput");let m=p.find(x=>h.some(g=>x.label.toLowerCase().includes(g)));return!m&&p.length&&h.includes("back")&&(m=p[p.length-1]),m&&(l.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=s(l.video),tg("chrome: "+JSON.stringify(l)),c(l)})}l.video=s(l.video)}return tg("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,d){r(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(o(h))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function bb(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function vb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[s.stream],this.dispatchEvent(a)}),s.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[s.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else qs(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Sb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=r.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],s.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function kb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>eg(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),qs(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>eg(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let r,o,a;return this.getSenders().forEach(l=>{l.track===s&&(r?a=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===s&&(o?a=!0:o=l),l.track===s)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function wb(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],s.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function Cb(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return wb(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}s.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[h.id];if(x)x.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],x=d._streams[m.id];h=h.replace(new RegExp(x.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],x=d._streams[m.id];h=h.replace(new RegExp(m.id,"g"),x.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[x=>{const g=o(this,x);p[0].apply(null,[g])},x=>{p[1]&&p[1].apply(null,x)},arguments[2]]):u.apply(this,arguments).then(x=>o(this,x))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vd(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function jb(t,e){qs(t,"negotiationneeded",n=>{const s=n.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return n})}var ng=Object.freeze({__proto__:null,fixNegotiationNeeded:jb,shimAddTrackRemoveTrack:Cb,shimAddTrackRemoveTrackWithNative:wb,shimGetSendersWithDtmf:Sb,shimGetUserMedia:yb,shimMediaStream:bb,shimOnTrack:vb,shimPeerConnection:vd,shimSenderReceiverGetStats:kb});function Tb(t,e){const n=t&&t.navigator,s=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,a){sh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},s&&s.prototype.getSettings){const a=s.prototype.getSettings;s.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(s&&s.prototype.applyConstraints){const a=s.prototype.applyConstraints;s.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function u_(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return s.video===!0?s.video={mediaSource:e}:s.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(s)})}function Eb(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Sd(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return s.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,l)}}function Ib(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Rb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s}),qs(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ab(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){sh("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&n.getTracks().includes(s.track)&&this.removeTrack(s)})})}function _b(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Mb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const r=s.length>0;r&&s.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=s,a.sendEncodings=s,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function Pb(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const s=e.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Db(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Nb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var ig=Object.freeze({__proto__:null,shimAddTransceiver:Mb,shimCreateAnswer:Nb,shimCreateOffer:Db,shimGetDisplayMedia:u_,shimGetParameters:Pb,shimGetUserMedia:Tb,shimOnTrack:Eb,shimPeerConnection:Sd,shimRTCDataChannel:_b,shimReceiverGetStats:Rb,shimRemoveStream:Ab,shimSenderGetStats:Ib});function zb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(r=>e.call(this,r,s)),s.getVideoTracks().forEach(r=>e.call(this,r,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(n);if(s===-1)return;this._localStreams.splice(s,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function Lb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(o)>=0)return;s._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,s.dispatchEvent(a)})}),e.apply(s,arguments)}}}function Ob(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,s=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=s.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p};let l=function(c,d,u){const h=r.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=a.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function Bb(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,s=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>s(Fb(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(s,r,o){e.mediaDevices.getUserMedia(s).then(r,o)}).bind(e))}function Fb(t){return t&&t.video!==void 0?Object.assign({},t,{video:xb(t.video)}):t}function Wb(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(s,r){if(s&&s.iceServers){const o=[];for(let a=0;a<s.iceServers.length;a++){let l=s.iceServers[a];l.urls===void 0&&l.url?(sh("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(s.iceServers[a])}s.iceServers=o}return new e(s,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function $b(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ub(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Vb(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var sg=Object.freeze({__proto__:null,shimAudioContext:Vb,shimCallbacksAPI:Ob,shimConstraints:Fb,shimCreateOfferLegacy:Ub,shimGetUserMedia:Bb,shimLocalStreamsAPI:zb,shimRTCIceServerUrls:Wb,shimRemoteStreamsAPI:Lb,shimTrackEventTransceiver:$b}),fc={exports:{}},rg;function h_(){return rg||(rg=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const s=e.splitSections(n);return s&&s[0]},e.getMediaSections=function(n){const s=e.splitSections(n);return s.shift(),s},e.matchPrefix=function(n,s){return e.splitLines(n).filter(r=>r.indexOf(s)===0)},e.parseCandidate=function(n){let s;n.indexOf("a=candidate:")===0?s=n.substring(12).split(" "):s=n.substring(10).split(" ");const r={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let o=8;o<s.length;o+=2)switch(s[o]){case"raddr":r.relatedAddress=s[o+1];break;case"rport":r.relatedPort=parseInt(s[o+1],10);break;case"tcptype":r.tcpType=s[o+1];break;case"ufrag":r.ufrag=s[o+1],r.usernameFragment=s[o+1];break;default:r[s[o]]===void 0&&(r[s[o]]=s[o+1]);break}return r},e.writeCandidate=function(n){const s=[];s.push(n.foundation);const r=n.component;r==="rtp"?s.push(1):r==="rtcp"?s.push(2):s.push(r),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);const o=n.type;return s.push("typ"),s.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let s=n.substring(9).split(" ");const r={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),r.name=s[0],r.clockRate=parseInt(s[1],10),r.channels=s.length===3?parseInt(s[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const s={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)r=o[a].trim().split("="),s[r[0].trim()]=r[1];return s},e.writeFmtp=function(n){let s="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),s+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return s},e.parseRtcpFb=function(n){const s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(n){let s="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{s+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(n){const s=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,s),10)},o=n.indexOf(":",s);return o>-1?(r.attribute=n.substring(s+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(s+1),r},e.parseSsrcGroup=function(n){const s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(r=>parseInt(r,10))}},e.getMid=function(n){const s=e.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},e.parseFingerprint=function(n){const s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},e.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:e.matchPrefix(n+s,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,s){let r="a=setup:"+s+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,s){return e.matchPrefix(n+s,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,s){const r=e.matchPrefix(n+s,"a=ice-ufrag:")[0],o=e.matchPrefix(n+s,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},e.parseRtpParameters=function(n){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");s.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),s.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{s.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return s.codecs.forEach(l=>{a.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),s},e.writeRtpDescription=function(n,s){let r="";r+="m="+n+" ",r+=s.codecs.length>0?"9":"0",r+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=s.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let o=0;return s.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(n){const s=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(x=>parseInt(x,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&d&&(m.rtx={ssrc:d}),s.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},s.push(m))}}),s.length===0&&c&&s.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,s.forEach(p=>{p.maxBitrate=h})),s},e.parseRtcpParameters=function(n){const s={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(s.cname=r.value,s.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=o.length>0,s.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return s.mux=a.length>0,s},e.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},e.parseMsid=function(n){let s;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return s=r[0].substring(7).split(" "),{stream:s[0],track:s[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return s=o[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(n){const s=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:s.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,s){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&r.push("a=max-message-size:"+s.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,s,r){let o;const a=s!==void 0?s:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,s){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const s=e.splitLines(n);for(let r=0;r<s.length;r++)if(s[r].length<2||s[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(fc)),fc.exports}var Gb=h_(),kr=e_(Gb),p_=kR({__proto__:null,default:kr},[Gb]);function Aa(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const r=new e(s),o=kr.parseCandidate(s.candidate);for(const a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(s)},t.RTCIceCandidate.prototype=e.prototype,qs(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function kd(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||qs(t,"icecandidate",e=>{if(e.candidate){const n=kr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function _a(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=kr.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=kr.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},s=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=kr.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=s(arguments[0]),d=r(c),u=o(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return a.apply(this,arguments)}}function Ma(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(s,r){const o=s.send;s.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(s.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(s,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},qs(t,"datachannel",s=>(e(s.channel,s.target),s))}function wd(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const s=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Cd(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function Pa(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Da(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var f_=Object.freeze({__proto__:null,removeExtmapAllowMixed:Cd,shimAddIceCandidateNullOrEmpty:Pa,shimConnectionState:wd,shimMaxMessageSize:_a,shimParameterlessSetLocalDescription:Da,shimRTCIceCandidate:Aa,shimRTCIceCandidateRelayProtocol:kd,shimSendThrowTypeError:Ma});function g_(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=mb,s=d_(t),r={browserDetails:s,commonShim:f_,extractVersion:ro,disableLog:l_,disableWarnings:c_,sdp:p_};switch(s.browser){case"chrome":if(!ng||!vd||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=ng,Pa(t,s),Da(t),yb(t,s),bb(t),vd(t,s),vb(t),Cb(t,s),Sb(t),kb(t),jb(t,s),Aa(t),kd(t),wd(t),_a(t,s),Ma(t),Cd(t,s);break;case"firefox":if(!ig||!Sd||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=ig,Pa(t,s),Da(t),Tb(t,s),Sd(t,s),Eb(t),Ab(t),Ib(t),Rb(t),_b(t),Mb(t),Pb(t),Db(t),Nb(t),Aa(t),wd(t),_a(t,s),Ma(t);break;case"safari":if(!sg||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=sg,Pa(t,s),Da(t),Wb(t),Ub(t),Ob(t),zb(t),Lb(t),$b(t),Bb(t),Vb(t),Aa(t),kd(t),_a(t,s),Ma(t),Cd(t,s);break;default:n("Unsupported browser!");break}return r}g_({window:typeof window>"u"?void 0:window});const m_=/version\/(\d+(\.?_?\d+)+)/i;let gc;function fn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(gc===void 0||e){const s=x_.find(r=>{let{test:o}=r;return o.test(n)});gc=s?.describe(n)}return gc}const x_=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Na(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:mc(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Na(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:mc(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Na(m_,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:mc(t)}}}];function Na(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const s=e.match(t);return s&&s.length>=n&&s[n]||""}function mc(t){return t.includes("mac os")?Na(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var y_="2.16.1";const b_=y_,v_=16;class gi extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var at;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(at||(at={}));class Ce extends gi{constructor(e,n,s,r){super(1,e),this.name="ConnectionError",this.status=s,this.reason=n,this.context=r,this.reasonName=at[n]}static notAllowed(e,n,s){return new Ce(e,at.NotAllowed,n,s)}static timeout(e){return new Ce(e,at.Timeout)}static leaveRequest(e,n){return new Ce(e,at.LeaveRequest,void 0,n)}static internal(e,n){return new Ce(e,at.InternalError,void 0,n)}static cancelled(e){return new Ce(e,at.Cancelled)}static serverUnreachable(e,n){return new Ce(e,at.ServerUnreachable,n)}static websocket(e,n,s){return new Ce(e,at.WebSocket,n,s)}}class rh extends gi{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ei extends gi{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class S_ extends gi{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Pt extends gi{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class jd extends gi{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class og extends gi{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class ag extends gi{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:ih[n]}}var nn;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(nn||(nn={}));class Rn extends gi{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=nn[n]}}class tr extends gi{constructor(e){super(18,e),this.name="SignalReconnectError"}}var tl;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(tl||(tl={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(tl||(tl={}));class qt{}qt.setTimeout=function(){return setTimeout(...arguments)};qt.setInterval=function(){return setInterval(...arguments)};qt.clearTimeout=function(){return clearTimeout(...arguments)};qt.clearInterval=function(){return clearInterval(...arguments)};var Y;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(Y||(Y={}));var le;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(le||(le={}));var ae;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(ae||(ae={}));var ie;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(ie||(ie={}));function k_(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Xe{constructor(e,n,s,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&s!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:s,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const w_=["vp8","h264"],C_=["vp8","h264","vp9","av1","h265"];function j_(t){return!!w_.find(e=>e===t)}const T_=j_;var lg;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(lg||(lg={}));var Td;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Td||(Td={}));const No={h90:new Xe(160,90,9e4,20),h180:new Xe(320,180,16e4,20),h216:new Xe(384,216,18e4,20),h360:new Xe(640,360,45e4,20),h540:new Xe(960,540,8e5,25),h720:new Xe(1280,720,17e5,30),h1080:new Xe(1920,1080,3e6,30),h1440:new Xe(2560,1440,5e6,30),h2160:new Xe(3840,2160,8e6,30)},Ed={h120:new Xe(160,120,7e4,20),h180:new Xe(240,180,125e3,20),h240:new Xe(320,240,14e4,20),h360:new Xe(480,360,33e4,20),h480:new Xe(640,480,5e5,20),h540:new Xe(720,540,6e5,25),h720:new Xe(960,720,13e5,30),h1080:new Xe(1440,1080,23e5,30),h1440:new Xe(1920,1440,38e5,30)},oh={h360fps3:new Xe(640,360,2e5,3,"medium"),h360fps15:new Xe(640,360,4e5,15,"medium"),h720fps5:new Xe(1280,720,8e5,5,"medium"),h720fps15:new Xe(1280,720,15e5,15,"medium"),h720fps30:new Xe(1280,720,2e6,30,"medium"),h1080fps15:new Xe(1920,1080,25e5,15,"medium"),h1080fps30:new Xe(1920,1080,5e6,30,"medium"),original:new Xe(0,0,7e6,30,"medium")};function Hb(t,e,n){var s,r,o,a;const{optionsWithoutProcessor:l,audioProcessor:c,videoProcessor:d}=Jb(t??{}),u=e?.processor,h=n?.processor,p=l??{};return p.audio===!0&&(p.audio={}),p.video===!0&&(p.video={}),p.audio&&(Id(p.audio,e),(s=(o=p.audio).deviceId)!==null&&s!==void 0||(o.deviceId={ideal:"default"}),(c||u)&&(p.audio.processor=c??u)),p.video&&(Id(p.video,n),(r=(a=p.video).deviceId)!==null&&r!==void 0||(a.deviceId={ideal:"default"}),(d||h)&&(p.video.processor=d??h)),p}function Id(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function ah(t){var e,n,s,r;const o={};if(t.video)if(typeof t.video=="object"){const a={},l=a,c=t.video;Object.keys(c).forEach(d=>{switch(d){case"resolution":Id(l,c.resolution);break;default:l[d]=c[d]}}),o.video=a,(e=(s=o.video).deviceId)!==null&&e!==void 0||(s.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function qb(t){return M(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const s=Kb();if(s){const r=s.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,a=new Uint8Array(o);s.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Kt(n),r.getByteTimeDomainData(a);const c=a.some(d=>d!==128&&d!==0);return s.close(),!c}return!1})()})}function Kb(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const s=()=>M(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",s)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",s))}),window.document.body.addEventListener("click",s)}return n}}function E_(t){return t==="audioinput"?q.Source.Microphone:t==="videoinput"?q.Source.Camera:q.Source.Unknown}function Rd(t){return t===q.Source.Microphone?"audioinput":t===q.Source.Camera?"videoinput":void 0}function I_(t){var e,n;let s=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(s=typeof s=="boolean"?{}:s,$s()?s=Object.assign(Object.assign({},s),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):s=Object.assign(Object.assign({},s),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:s,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function go(t){return t.split("/")[1].toLowerCase()}function R_(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Zu({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Ne(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Ne(t.track):{})}}function A_(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function __(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const s=[...Object.keys(e),...Object.keys(t)],r={};for(const o of s)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function Jb(t){const e=Object.assign({},t);let n,s;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(s=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:s,optionsWithoutProcessor:k_(e)}}function M_(t){switch(t){case Rt.CAMERA:return q.Source.Camera;case Rt.MICROPHONE:return q.Source.Microphone;case Rt.SCREEN_SHARE:return q.Source.ScreenShare;case Rt.SCREEN_SHARE_AUDIO:return q.Source.ScreenShareAudio;default:return q.Source.Unknown}}function cg(t,e){return t.width*t.height<e.width*e.height}function P_(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(s=>s.quality===e)}const D_=5e3,Yr=[];var Sn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Sn||(Sn={}));class q extends fi.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=q.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ae,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),D_):this.handleAppVisibilityChanged()},this.log=Li((r=s.loggerName)!==null&&r!==void 0?r:Hn.Track),this.loggerContextCb=s.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=q.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ne(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===q.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===q.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Yr.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Yr.splice(Yr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),fr(this.mediaStreamTrack,e);const s=e.srcObject.getTracks(),r=s.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?ie.AudioPlaybackStarted:ie.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?ie.AudioPlaybackFailed:ie.VideoPlaybackFailed,o):o.name==="AbortError"?Ae.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Ae.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&s.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ie.ElementAttached,e),e}detach(e){try{if(e){wr(this.mediaStreamTrack,e);const s=this.attachedElements.indexOf(e);return s>=0&&(this.attachedElements.splice(s,1),this.recycleElement(e),this.emit(ie.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(s=>{wr(this.mediaStreamTrack,s),n.push(s),this.recycleElement(s),this.emit(ie.ElementDetached,s)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Li(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Yr.forEach(s=>{s.parentElement||(n=!1)}),n&&Yr.push(e)}}handleAppVisibilityChanged(){return M(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===q.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){pn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){pn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function fr(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let s;t.kind==="audio"?s=n.getAudioTracks():s=n.getVideoTracks(),s.includes(t)||(s.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!$s()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,($s()||Ws())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function wr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(n=t.Source||(t.Source={}));let s;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(s=t.StreamState||(t.StreamState={}));function r(d){switch(d){case e.Audio:return Fn.AUDIO;case e.Video:return Fn.VIDEO;default:return Fn.DATA}}t.kindToProto=r;function o(d){switch(d){case Fn.AUDIO:return e.Audio;case Fn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function a(d){switch(d){case n.Camera:return Rt.CAMERA;case n.Microphone:return Rt.MICROPHONE;case n.ScreenShare:return Rt.SCREEN_SHARE;case n.ScreenShareAudio:return Rt.SCREEN_SHARE_AUDIO;default:return Rt.UNKNOWN}}t.sourceToProto=a;function l(d){switch(d){case Rt.CAMERA:return n.Camera;case Rt.MICROPHONE:return n.Microphone;case Rt.SCREEN_SHARE:return n.ScreenShare;case Rt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=l;function c(d){switch(d){case md.ACTIVE:return s.Active;case md.PAUSED:return s.Paused;default:return s.Unknown}}t.streamStateFromProto=c})(q||(q={}));const N_="|",dg="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function z_(t){const e=t.split(N_);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Kt(t){return M(this,void 0,void 0,function*(){return new Promise(e=>qt.setTimeout(e,t))})}function Ad(){return"addTransceiver"in RTCPeerConnection.prototype}function _d(){return"addTrack"in RTCPeerConnection.prototype}function L_(){if(!("getCapabilities"in RTCRtpSender)||$s()||Ws())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function O_(){if(!("getCapabilities"in RTCRtpSender)||Ws())return!1;if($s()){const n=fn();if(n?.version&&hi(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&hi(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function $n(t){return t==="av1"||t==="vp9"}function Md(t){return!document||zo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function B_(){return typeof RTCPeerConnection>"u"?!1:Ad()||_d()}function Ws(){var t;return((t=fn())===null||t===void 0?void 0:t.name)==="Firefox"}function ug(){const t=fn();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function $s(){var t;return((t=fn())===null||t===void 0?void 0:t.name)==="Safari"}function zo(){const t=fn();return t?.name==="Safari"||t?.os==="iOS"}function F_(){const t=fn();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&hi(t.osVersion,"17")>=0}function W_(t){return t||(t=fn()),t?.name==="Safari"&&hi(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&hi(t.osVersion,"18.3")>0}function Yb(){var t,e;return pn()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function $_(){const t=fn(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&hi(t.osVersion,e)>=0?!0:t.name==="Safari"&&hi(t.version,e)>=0}function pn(){return typeof document<"u"}function ui(){return navigator.product=="ReactNative"}function Pr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function xc(t){return Pr(t)?t.hostname.split(".")[0]:null}function Xb(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Zb(){if(!ui())return;let t=Xb();if(t)return t.platform}function hg(){if(pn())return window.devicePixelRatio;if(ui()){let t=Xb();if(t)return t.devicePixelRatio}return 1}function hi(t,e){const n=t.split("."),s=e.split("."),r=Math.min(n.length,s.length);for(let o=0;o<r;++o){const a=parseInt(n[o],10),l=parseInt(s[o],10);if(a>l)return 1;if(a<l)return-1;if(o===r-1&&a===l)return 0}return t===""&&e!==""?-1:e===""?1:n.length==s.length?0:n.length<s.length?-1:1}function U_(t){for(const e of t)e.target.handleResize(e)}function V_(t){for(const e of t)e.target.handleVisibilityChanged(e)}let yc=null;const pg=()=>(yc||(yc=new ResizeObserver(U_)),yc);let bc=null;const fg=()=>(bc||(bc=new IntersectionObserver(V_,{root:null,rootMargin:"0px"})),bc);function G_(){var t;const e=new Zy({sdk:Qy.JS,protocol:v_,version:b_});return ui()&&(e.os=(t=Zb())!==null&&t!==void 0?t:""),e}function gg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),s&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[l]=a.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=n,l}let Xr;function vc(){if(!Xr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const s=t.createMediaStreamDestination();if(e.connect(n),n.connect(s),e.start(),[Xr]=s.stream.getAudioTracks(),!Xr)throw Error("Could not get empty media stream audio track");Xr.enabled=!1}return Xr.clone()}class _n{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((s,r)=>M(this,void 0,void 0,function*(){this.resolve=s,this.reject=r,e&&(yield e(s,r))})).finally(()=>{var s;this._isResolved=!0,(s=this.onFinally)===null||s===void 0||s.call(this)})}}function H_(t){return C_.includes(t)}function os(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function q_(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Lo(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function K_(t,e){return t.segments.map(n=>{let{id:s,text:r,language:o,startTime:a,endTime:l,final:c}=n;var d;const u=(d=e.get(s))!==null&&d!==void 0?d:Date.now(),h=Date.now();return c?e.delete(s):e.set(s,u),{id:s,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(l.toString()),final:c,language:o,firstReceivedTime:u,lastReceivedTime:h}})}function J_(t){const{id:e,timestamp:n,message:s,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:s}}function mg(t){switch(t.reason){case at.LeaveRequest:return t.context;case at.Cancelled:return Un.CLIENT_INITIATED;case at.NotAllowed:return Un.USER_REJECTED;case at.ServerUnreachable:return Un.JOIN_FAILURE;default:return Un.UNKNOWN_REASON}}function za(t){return t!==void 0?Number(t):void 0}function js(t){return t!==void 0?BigInt(t):void 0}function Cr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ai(t){return!!t&&t.kind==q.Kind.Audio}function ys(t){return!!t&&t.kind==q.Kind.Video}function qi(t){return Cr(t)&&ys(t)}function Si(t){return Cr(t)&&ai(t)}function Pd(t){return!!t&&!t.isLocal}function Y_(t){return!!t&&!t.isLocal}function Sc(t){return Pd(t)&&ys(t)}function X_(t){return t.isLocal}function Z_(t,e){const n=[];let s=new TextEncoder().encode(t);for(;s.length>e;){let r=e;for(;r>0;){const o=s[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(s.slice(0,r)),s=s.slice(r)}return s.length>0&&n.push(s),n}function Q_(t){var e;const n=t.get("Cache-Control");if(n){const s=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(s)return parseInt(s,10)}}function eM(t,e){const n=new URL(q_(t));return e.forEach((s,r)=>{n.searchParams.set(r,s)}),ev(n,"rtc")}function tM(t){const e=new URL(Lo(t));return ev(e,"validate")}function Qb(t){return t.endsWith("/")?t:"".concat(t,"/")}function ev(t,e){return t.pathname="".concat(Qb(t.pathname)).concat(e),t.toString()}function xg(t){if(typeof t=="string")return Jf.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Jf.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function nM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const iM=10,Zr="lk_e2ee",sM="LKFrameEncryptionKey",rM={sharedKey:!1,ratchetSalt:sM,ratchetWindowSize:8,failureTolerance:iM,keyringSize:16};var as;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(as||(as={}));var yg;(function(t){t.KeyRatcheted="keyRatcheted"})(yg||(yg={}));var ns;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(ns||(ns={}));var bg;(function(t){t.Error="cryptorError"})(bg||(bg={}));function oM(){return aM()||Dd()}function Dd(){return typeof window.RTCRtpScriptTransform<"u"}function aM(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function lM(t){var e,n,s,r,o;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=t.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new Gy({value:t.value})}class XN extends fi.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,s,r)=>{Ae.debug("key ratcheted event received",{ratchetResult:n,participantId:s,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},rM),e),this.on(as.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,s){const r={key:e,participantIdentity:n,keyIndex:s};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(s??0),r),this.emit(as.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(as.RatchetRequest,e,n)}}var vg;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(vg||(vg={}));class cM extends fi.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=s=>{var r,o;const{kind:a,data:l}=s.data;switch(a){case"error":if(Ae.error(l.error.message),l.uuid){const u=this.decryptDataRequests.get(l.uuid);if(u?.reject){u.reject(l.error);break}const h=this.encryptDataRequests.get(l.uuid);if(h?.reject){h.reject(l.error);break}}this.emit(ns.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(ns.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const u=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(l.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit(ns.ParticipantEncryptionStatusChanged,l.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(as.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(l.uuid);c?.resolve&&c.resolve(l);break;case"encryptDataResponse":const d=this.encryptDataRequests.get(l.uuid);d?.resolve&&d.resolve(l);break}},this.onWorkerError=s=>{Ae.error("e2ee worker encountered an error:",{error:s.error}),this.emit(ns.EncryptionError,s.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!oM())throw new rh("tried to setup end-to-end encryption on an unsupported browser");if(Ae.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:i_.getLevel()}};this.worker&&(Ae.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ae.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ae.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ae.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(Y.TrackPublished,(s,r)=>this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Dt.NONE,r.identity)),e.on(Y.ConnectionStateChanged,s=>{s===He.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==Dt.NONE,r.identity)})})}).on(Y.TrackUnsubscribed,(s,r,o)=>{var a;const l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:s.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(l)}).on(Y.TrackSubscribed,(s,r,o)=>{this.setupE2EEReceiver(s,o.identity,r.trackInfo)}).on(Y.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(s=>{this.postKey(s)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(le.LocalSenderCreated,(s,r)=>M(this,void 0,void 0,function*(){this.setupE2EESender(r,s)})),e.localParticipant.on(le.LocalTrackPublished,s=>{if(!ys(s.track)||!zo())return;const r={kind:"updateCodec",data:{trackId:s.track.mediaStreamID,codec:go(s.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(as.SetKey,s=>this.postKey(s)).on(as.RatchetRequest,(s,r)=>this.postRatchetRequest(s,r))}encryptData(e){return M(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),s={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new _n;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(s),r.promise})}handleEncryptedData(e,n,s,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:n,participantIdentity:s,keyIndex:r}},l=new _n;return l.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,l),this.worker.postMessage(a),l.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const s={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(s)}postKey(e){let{key:n,participantIdentity:s,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:s,isPublisher:s===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,n){if(this.worker){const s={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(s)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const s={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(s)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,s){if(e.receiver){if(!s?.mimeType||s.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?go(s.mimeType):void 0)}}setupE2EESender(e,n){if(!Cr(e)||!n){n||Ae.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,s,r){return M(this,void 0,void 0,function*(){if(this.worker){if(Dd()&&!ug()){const o={kind:"decode",participantIdentity:s,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Zr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:s}};this.worker.postMessage(c);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,a=c.readable}const l={kind:"decode",data:{readableStream:a,writableStream:o,trackId:n,codec:r,participantIdentity:s,isReuse:Zr in e}};this.worker.postMessage(l,[a,o])}e[Zr]=!0}})}handleSender(e,n,s){var r;if(!(Zr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Dd()&&!ug()){Ae.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:s};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Ae.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:s,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[o.readable,o.writable])}e[Zr]=!0}}}const dM=500,uM=15e3;class jr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new jr),this._instance}addFailedConnectionAttempt(e){var n;const s=new URL(e),r=xc(s);if(!r)return;let o=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,Kt(Math.min(dM*Math.pow(2,o),uM)))}getBackOffPromise(e){const n=new URL(e),s=n&&xc(n);return s&&this.backOffPromises.get(s)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),s=n&&xc(n);s&&(this.failedConnectionAttempts.set(s,0),this.backOffPromises.set(s,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}jr._instance=null;const kc="default";class Ut{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ut),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=Ut.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){Ae.debug("awaiting getUserMedia promise");try{n?yield Ut.userMediaPromiseMap.get(n):yield Promise.all(Ut.userMediaPromiseMap.values())}catch{Ae.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(r&&!($s()&&s.hasDeviceInUse(n))&&(a.filter(c=>c.kind===n).length===0||a.some(c=>{const d=c.label==="",u=n?c.kind===n:!0;return d&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},d=yield navigator.mediaDevices.getUserMedia(c);a=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(u=>{u.stop()})}return s._previousDevices=a,n&&(a=a.filter(l=>l.kind===n)),a})()})}normalizeDeviceId(e,n,s){return M(this,void 0,void 0,function*(){if(n!==kc)return n;const r=yield this.getDevices(e),o=r.find(l=>l.deviceId===kc);if(!o){Ae.warn("could not reliably determine default device");return}const a=r.find(l=>l.deviceId!==kc&&l.groupId===(s??o.groupId));if(!a){Ae.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(e){return e?Ut.userMediaPromiseMap.has(e):Ut.userMediaPromiseMap.size>0}}Ut.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ut.userMediaPromiseMap=new Map;var mo;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(mo||(mo={}));class hM{constructor(){this.pendingTasks=new Map,this.taskMutex=new an,this.nextTaskIndex=0}run(e){return M(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:mo.WAITING};this.pendingTasks.set(n.id,n);const s=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=mo.RUNNING,yield e()}finally{n.status=mo.COMPLETED,this.pendingTasks.delete(n.id),s()}})}flush(){return M(this,void 0,void 0,function*(){return this.run(()=>M(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class pM{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s,r;if(!((s=n.signal)===null||s===void 0)&&s.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const a=function(){let{closeCode:l,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(l,c)};this.opened=new Promise((l,c)=>{o.onopen=()=>{l({readable:new ReadableStream({start(d){o.onmessage=u=>{let{data:h}=u;return d.enqueue(h)},o.onerror=u=>d.error(u)},cancel:a}),writable:new WritableStream({write(d){o.send(d)},abort(){o.close()},close:a}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",c)},o.addEventListener("error",c)}),this.closed=new Promise((l,c)=>{const d=()=>M(this,void 0,void 0,function*(){const u=new Promise(p=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",m=>{p(m)},{once:!0})}),h=yield Promise.race([Kt(250),u]);h?l(h):c(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=u=>{let{code:h,reason:p}=u;l({closeCode:h,reason:p}),o.removeEventListener("error",d)},o.addEventListener("error",d)}),n.signal&&(n.signal.onabort=()=>o.close()),this.close=a}}const fM=["syncState","trickle","offer","answer","simulate","leave"];function gM(t){const e=fM.indexOf(t.case)>=0;return Ae.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var nt;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(nt||(nt={}));const mM=250;class lh{get currentState(){return this.state}get isDisconnected(){return this.state===nt.DISCONNECTING||this.state===nt.DISCONNECTED}get isEstablishingConnection(){return this.state===nt.CONNECTING||this.state===nt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;this.rtt=0,this.state=nt.DISCONNECTED,this.log=Ae,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Li((s=n.loggerName)!==null&&s!==void 0?s:Hn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new hM,this.queuedRequests=[],this.closingLock=new an,this.connectionLock=new an,this.state=nt.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,s,r){return M(this,void 0,void 0,function*(){return this.state=nt.CONNECTING,this.options=s,yield this.connect(e,n,s,r)})}reconnect(e,n,s,r){return M(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=nt.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:s,reconnectReason:r}))})}connect(e,n,s,r){return M(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=s;const a=G_(),l=s.singlePeerConnection?yM(n,a,s):xM(n,a,s),c=eM(e,l),d=tM(c);return new Promise((u,h)=>M(this,void 0,void 0,function*(){var p,m;try{let x=!1;const g=w=>M(this,void 0,void 0,function*(){if(x)return;x=!0;const b=w instanceof Event?w.currentTarget:w,T=nM(b,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(T)).catch(C=>{this.log.error(C),this.close()}):this.close(),y(),h(Ce.cancelled(T))});r?.addEventListener("abort",g);const y=()=>{clearTimeout(v),r?.removeEventListener("abort",g)},v=setTimeout(()=>{g(Ce.timeout("room connection has timed out (signal)"))},s.websocketTimeout),k=(w,b)=>{this.handleSignalConnected(w,v,b)},S=new URL(c);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:s.reconnect,reconnectReason:s.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new pM(c);try{this.ws.closed.then(I=>{var A;this.isEstablishingConnection&&h(Ce.internal("Websocket got closed during a (re)connection attempt: ".concat(I.reason))),I.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:I.reason,code:I.closeCode,wasClean:I.closeCode===1e3,state:this.state})),this.state===nt.CONNECTED&&this.handleOnClose((A=I.reason)!==null&&A!==void 0?A:"Unexpected WS error"))}).catch(I=>{this.isEstablishingConnection&&h(Ce.internal("Websocket error during a (re)connection attempt: ".concat(I)))});const w=yield this.ws.opened.catch(I=>M(this,void 0,void 0,function*(){if(this.state!==nt.CONNECTED){this.state=nt.DISCONNECTED,clearTimeout(v);const A=yield this.handleConnectionError(I,d);h(A);return}this.handleWSError(I),h(I)}));if(clearTimeout(v),!w)return;const b=w.readable.getReader();this.streamWriter=w.writable.getWriter();const T=yield b.read();if(b.releaseLock(),!T.value)throw Ce.internal("no message received as first message");const C=xg(T.value),j=this.validateFirstMessage(C,(p=s.reconnect)!==null&&p!==void 0?p:!1);if(!j.isValid){h(j.error);return}((m=C.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=C.message.value.pingTimeout,this.pingIntervalDuration=C.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const R=j.shouldProcessFirstMessage?C:void 0;k(w,R),u(j.response)}catch(w){h(w)}finally{y()}}finally{o()}}))})}startReadingLoop(e,n){return M(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Kt(this.signalLatency));const{done:s,value:r}=yield e.read();if(s)break;const o=xg(r);this.handleSignalResponse(o)}})}close(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([nt.DISCONNECTING||nt.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=nt.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:s});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Kt(mM)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{n&&(e.state=nt.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:gr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:gr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Il({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Rl({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return M(this,arguments,void 0,function(s,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new eh({requestId:l,metadata:s,name:r,attributes:a})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new ob({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new cb({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ut.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new hb({timestamp:ut.parse(Date.now()),rtt:ut.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Qu({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new _l({reason:Un.CLIENT_INITIATED,action:Sr.DISCONNECT})})}sendRequest(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!gM(n)&&s.state===nt.RECONNECTING){s.queuedRequests.push(()=>M(s,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield s.requestQueue.flush()),s.signalLatency&&(yield Kt(s.signalLatency)),s.isDisconnected){s.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!s.streamWriter){s.log.error("cannot send signal request before connected, type: ".concat(n?.case),s.logContext);return}const a=new IA({message:n});try{s.useJSON?yield s.streamWriter.write(a.toJsonString()):yield s.streamWriter.write(a.toBinary())}catch(l){s.log.error("error sending signal message",Object.assign(Object.assign({},s.logContext),{error:l}))}})()})}handleSignalResponse(e){var n,s;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const a=Sg(r.value);this.onAnswer&&this.onAnswer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const a=Sg(r.value);this.onOffer&&this.onOffer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const a=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(a,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((s=r.value.speakers)!==null&&s!==void 0?s:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return M(this,void 0,void 0,function*(){if(this.state===nt.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=qt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&qt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=qt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&qt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,s){this.state=nt.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),s)}validateFirstMessage(e,n){var s,r,o,a,l;return((s=e.message)===null||s===void 0?void 0:s.case)==="join"?{isValid:!0,response:e.message.value}:this.state===nt.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=e.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:Ce.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:Ce.internal("Unexpected first message")}:{isValid:!1,error:Ce.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,n){return M(this,void 0,void 0,function*(){try{const s=yield fetch(n);if(s.status.toFixed(0).startsWith("4")){const r=yield s.text();return Ce.notAllowed(r,s.status)}else return e instanceof Ce?e:Ce.internal("Encountered unknown websocket error during connection: ".concat(e),{status:s.status,statusText:s.statusText})}catch(s){return s instanceof Ce?s:Ce.serverUnreachable(s instanceof Error?s.message:"server was not reachable")}})}}function Sg(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function gr(t,e){return new ps({sdp:t.sdp,type:t.type,id:e})}function xM(t,e,n){var s;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",ui()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((s=navigator.connection)===null||s===void 0)&&s.type&&r.set("network",navigator.connection.type),r}function yM(t,e,n){const s=new URLSearchParams;s.set("access_token",t);const r=new YA({clientInfo:e,connectionSettings:new pb({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const o=new XA({joinRequest:r.toBinary()});return s.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),s}class kg{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class bM{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const s=Date.now();s-this._lastCleanup>this.ttl/2&&this.cleanup();const r=s+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,s]of this._map.entries())s.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,s]of this._map.entries())s.expiresAt>=Date.now()&&e(s.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],s=this.asValueMap();for(const[r,o]of s.entries())n.push(e(o,r,s));return n}asValueMap(){const e=new Map;for(const[n,s]of this._map.entries())s.expiresAt>=Date.now()&&e.set(n,s.value);return e}}var Ln={},wc={},Cc={exports:{}},wg;function ch(){if(wg)return Cc.exports;wg=1;var t=Cc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Cc.exports}var Cg;function vM(){return Cg||(Cg=1,(function(t){var e=function(l){return String(Number(l))===l?Number(l):l},n=function(l,c,d,u){if(u&&!d)c[u]=e(l[1]);else for(var h=0;h<d.length;h+=1)l[h+1]!=null&&(c[d[h]]=e(l[h+1]))},s=function(l,c,d){var u=l.name&&l.names;l.push&&!c[l.push]?c[l.push]=[]:u&&!c[l.name]&&(c[l.name]={});var h=l.push?{}:u?c[l.name]:c;n(d.match(l.reg),h,l.names,l.name),l.push&&c[l.push].push(h)},r=ch(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(l){var c={},d=[],u=c;return l.split(/(\r\n|\r|\n)/).filter(o).forEach(function(h){var p=h[0],m=h.slice(2);p==="m"&&(d.push({rtp:[],fmtp:[]}),u=d[d.length-1]);for(var x=0;x<(r[p]||[]).length;x+=1){var g=r[p][x];if(g.reg.test(m))return s(g,u,m)}}),c.media=d,c};var a=function(l,c){var d=c.split(/=(.+)/,2);return d.length===2?l[d[0]]=e(d[1]):d.length===1&&c.length>1&&(l[d[0]]=void 0),l};t.parseParams=function(l){return l.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(l){return l.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(l){for(var c=[],d=l.split(" ").map(e),u=0;u<d.length;u+=3)c.push({component:d[u],ip:d[u+1],port:d[u+2]});return c},t.parseImageAttributes=function(l){return l.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(l){return l.split(";").map(function(c){return c.split(",").map(function(d){var u,h=!1;return d[0]!=="~"?u=e(d):(u=e(d.substring(1,d.length)),h=!0),{scid:u,paused:h}})})}})(wc)),wc}var jc,jg;function SM(){if(jg)return jc;jg=1;var t=ch(),e=/%[sdv%]/g,n=function(a){var l=1,c=arguments,d=c.length;return a.replace(e,function(u){if(l>=d)return u;var h=c[l];switch(l+=1,u){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},s=function(a,l,c){var d=l.format instanceof Function?l.format(l.push?c:c[l.name]):l.format,u=[a+"="+d];if(l.names)for(var h=0;h<l.names.length;h+=1){var p=l.names[h];l.name?u.push(c[l.name][p]):u.push(c[l.names[h]])}else u.push(c[l.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return jc=function(a,l){l=l||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=l.outerOrder||r,d=l.innerOrder||o,u=[];return c.forEach(function(h){t[h].forEach(function(p){p.name in a&&a[p.name]!=null?u.push(s(h,p,a)):p.push in a&&a[p.push]!=null&&a[p.push].forEach(function(m){u.push(s(h,p,m))})})}),a.media.forEach(function(h){u.push(s("m",t.m[0],h)),d.forEach(function(p){t[p].forEach(function(m){m.name in h&&h[m.name]!=null?u.push(s(p,m,h)):m.push in h&&h[m.push]!=null&&h[m.push].forEach(function(x){u.push(s(p,m,x))})})})}),u.join(`\r
`)+`\r
`},jc}var Tg;function kM(){if(Tg)return Ln;Tg=1;var t=vM(),e=SM(),n=ch();return Ln.grammar=n,Ln.write=e,Ln.parse=t.parse,Ln.parseParams=t.parseParams,Ln.parseFmtpConfig=t.parseFmtpConfig,Ln.parsePayloads=t.parsePayloads,Ln.parseRemoteCandidates=t.parseRemoteCandidates,Ln.parseImageAttributes=t.parseImageAttributes,Ln.parseSimulcastStreamList=t.parseSimulcastStreamList,Ln}var Xi=kM();function dh(t,e,n){var s,r,o;e===void 0&&(e=50),n===void 0&&(n={});var a=(s=n.isImmediate)!=null&&s,l=(r=n.callback)!=null&&r,c=n.maxWait,d=Date.now(),u=[];function h(){if(c!==void 0){var m=Date.now()-d;if(m+e>=c)return c-m}return e}var p=function(){var m=[].slice.call(arguments),x=this;return new Promise(function(g,y){var v=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,d=Date.now(),!a){var S=t.apply(x,m);l&&l(S),u.forEach(function(w){return(0,w.resolve)(S)}),u=[]}},h()),v){var k=t.apply(x,m);return l&&l(k),g(k)}u.push({resolve:g,reject:y})})};return p.cancel=function(m){o!==void 0&&clearTimeout(o),u.forEach(function(x){return(0,x.reject)(m)}),u=[]},p}const wM=.7,CM=20,Tr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Eg extends fi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;super(),this.log=Ae,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=dh(r=>M(this,void 0,void 0,function*(){this.emit(Tr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),CM),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Li((s=n.loggerName)!==null&&s!==void 0?s:Hn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new an}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var s;n.candidate&&((s=this.onIceCandidate)===null||s===void 0||s.call(this,n.candidate))},e.onicecandidateerror=n=>{var s;(s=this.onIceCandidateError)===null||s===void 0||s.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,n)},e.ontrack=n=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return M(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return M(this,void 0,void 0,function*(){var s;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:a}=jM(e);this.remoteStereoMids=o,this.remoteNackMids=a}else if(e.type==="answer"){const o=Xi.parse((s=e.sdp)!==null&&s!==void 0?s:"");o.media.forEach(a=>{const l=uh(a.mid);a.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||l!=c.transceiver.mid)return!1;let d=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0)return!0;let u=!1;for(const h of a.fmtp)if(h.payload===d){h.config=h.config.split(";").filter(p=>!p.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&a.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Xi.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Tr.NegotiationComplete),e.sdp&&Xi.parse(e.sdp).media.forEach(a=>{a.type==="video"&&this.emit(Tr.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(e){return M(this,void 0,void 0,function*(){var n;const s=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const a=Xi.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(l=>{Rg(l),l.type==="audio"?Ig(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(c=>{if(!l.msid||!c.cid||!l.msid.includes(c.cid))return!1;let d=0;if(l.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0||($n(c.codec)&&!$s()&&this.ensureVideoDDExtensionForSVC(l,a),!$n(c.codec)))return!0;const u=Math.round(c.maxbr*wM);for(const h of l.fmtp)if(h.payload===d){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,Xi.write(a)),this.onOffer(o,this.latestOfferId)}finally{s()}})}createAndSetAnswer(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),s=Xi.parse((e=n.sdp)!==null&&e!==void 0?e:"");return s.media.forEach(r=>{Rg(r),r.type==="audio"&&Ig(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Xi.write(s)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Pt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Pt("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return M(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const s=new Map,r=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":n=l.selectedCandidatePairId;break;case"candidate-pair":n===""&&l.selected&&(n=l.id),s.set(l.id,l);break;case"remote-candidate":r.set(l.id,"".concat(l.address,":").concat(l.port));break}}),n==="")return;const a=(e=s.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}setMungedSDP(e,n,s){return M(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(s?"remote":"local"," description"),this.logContext),s?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{s?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const a={error:o,sdp:e.sdp};throw!s&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new jd(o)}})}ensureVideoDDExtensionForSVC(e,n){var s,r;if(!((s=e.ext)===null||s===void 0?void 0:s.some(a=>a.uri===dg))){if(this.ddExtID===0){let a=0;n.media.forEach(l=>{var c;l.type==="video"&&((c=l.ext)===null||c===void 0||c.forEach(d=>{d.value>a&&(a=d.value)}))}),this.ddExtID=a+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:dg})}}}function Ig(t,e,n){const s=uh(t.mid);let r=0;t.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(s)&&!t.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(s)||e.length===1&&e[0]==="all")&&t.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function jM(t){var e;const n=[],s=[],r=Xi.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(a=>{var l;const c=uh(a.mid);a.type==="audio"&&(a.rtp.some(d=>d.codec==="opus"?(o=d.payload,!0):!1),!((l=a.rtcpFb)===null||l===void 0)&&l.some(d=>d.payload===o&&d.type==="nack")&&s.push(c),a.fmtp.some(d=>d.payload===o?(d.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:s}}function Rg(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function uh(t){return typeof t=="number"?t.toFixed(0):t}const Nd="vp8",TM={audioPreset:Td.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:oh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Nd,backupCodec:!0,preConnectBuffer:!1},tv={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},nv={deviceId:{ideal:"default"},resolution:No.h720.resolution},EM={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new r_,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},hh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var kt;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(kt||(kt={}));class IM{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,s){var r;this.peerConnectionTimeout=hh.peerConnectionTimeout,this.log=Ae,this.updateState=()=>{var o,a;const l=this.state,c=this.requiredTransports.map(d=>d.getConnectionState());c.every(d=>d==="connected")?this.state=kt.CONNECTED:c.some(d=>d==="failed")?this.state=kt.FAILED:c.some(d=>d==="connecting")?this.state=kt.CONNECTING:c.every(d=>d==="closed")?this.state=kt.CLOSED:c.some(d=>d==="closed")?this.state=kt.CLOSING:c.every(d=>d==="new")&&(this.state=kt.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(kt[l]," to ").concat(kt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=Li((r=s.loggerName)!==null&&r!==void 0?r:Hn.PCManager),this.loggerOptions=s,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Eg(e,s),n!=="publisher-only"&&(this.subscriber=new Eg(e,s),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Wn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,o)},this.subscriber.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Wn.PUBLISHER)},this.publisher.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)},this.publisher.onOffer=(o,a)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,o,a)},this.state=kt.NEW,this.connectionLock=new an,this.remoteOfferLock=new an}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return M(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const s of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(s)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return M(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return M(this,void 0,void 0,function*(){var s;n===Wn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(s=this.subscriber)===null||s===void 0?void 0:s.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return M(this,void 0,void 0,function*(){var s,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(s=this.subscriber)===null||s===void 0?void 0:s.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(e,n){var s;this.publisher.setConfiguration(e),(s=this.subscriber)===null||s===void 0||s.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return M(this,void 0,void 0,function*(){var s;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((s=this.requiredTransports)===null||s===void 0?void 0:s.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return M(this,void 0,void 0,function*(){return new Promise((n,s)=>M(this,void 0,void 0,function*(){const r=setTimeout(()=>{s("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),s("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(Tr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Tr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(a=>{clearTimeout(r),s(a)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const s=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return s?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Wn.PUBLISHER?this.publisher.getConnectedAddress():e===Wn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return M(this,arguments,void 0,function(s,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(s.getConnectionState()!=="connected")return new Promise((c,d)=>M(o,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),qt.clearTimeout(h),d(Ce.cancelled("room connection has been cancelled"))};r?.signal.aborted&&u(),r?.signal.addEventListener("abort",u);const h=qt.setTimeout(()=>{r?.signal.removeEventListener("abort",u),d(Ce.internal("could not establish pc connection"))},a);for(;this.state!==kt.CONNECTED;)if(yield Kt(50),r?.signal.aborted){d(Ce.cancelled("room connection has been cancelled"));return}qt.clearTimeout(h),r?.signal.removeEventListener("abort",u),c()}))})()})}}const iv=5e3,RM=3e4;class $e{static fetchRegionSettings(e,n,s){return M(this,void 0,void 0,function*(){const r=yield $e.fetchLock.lock();try{const o=yield fetch("".concat(AM(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:s});if(o.ok){const a=Q_(o.headers),l=a?a*1e3:iv;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw o.status===401?Ce.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):Ce.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof Ce?o:s?.aborted?Ce.cancelled("Region fetching was aborted"):Ce.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,n,s){return M(this,void 0,void 0,function*(){const r=$e.settingsTimeouts.get(e.hostname);clearTimeout(r),$e.settingsTimeouts.set(e.hostname,setTimeout(()=>M(this,void 0,void 0,function*(){try{const o=yield $e.fetchRegionSettings(e,n);$e.updateCachedRegionSettings(e,n,o)}catch(o){if(o instanceof Ce&&o.reason===at.NotAllowed){Ae.debug("token is not valid, cancelling auto region refresh");return}Ae.debug("auto refetching of region settings failed",{error:o}),$e.scheduleRefetch(e,n,s)}}),s))})}static updateCachedRegionSettings(e,n,s){$e.cache.set(e.hostname,s),$e.scheduleRefetch(e,n,s.maxAgeInMs)}static stopRefetch(e){const n=$e.settingsTimeouts.get(e);n&&(clearTimeout(n),$e.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=$e.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const s=$e.connectionTrackers.get(e);s&&s.connectionCount===0&&(Ae.debug("stopping region refetch after disconnect delay",{hostname:e}),$e.stopRefetch(e)),s&&(s.cleanupTimeout=void 0)},RM))}static cancelCleanup(e){const n=$e.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=$e.connectionTrackers.get(e);n||(n={connectionCount:0},$e.connectionTrackers.set(e,n)),n.connectionCount++,$e.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=$e.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&$e.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Pr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return M(this,void 0,void 0,function*(){return $e.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return M(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=$e.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),$e.updateCachedRegionSettings(this.serverUrl,this.token,n));const s=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(s.length>0){const r=s[0];return this.attemptedRegions.push(r),Ae.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){$e.updateCachedRegionSettings(this.serverUrl,this.token,e)}}$e.cache=new Map;$e.settingsTimeouts=new Map;$e.connectionTrackers=new Map;$e.fetchLock=new an;function AM(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Ct extends Error{constructor(e,n,s){super(n),this.code=e,this.message=Ag(n,Ct.MAX_MESSAGE_BYTES),this.data=s?Ag(s,Ct.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ct(e.code,e.message,e.data)}toProto(){return new Ky({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Ct(Ct.ErrorCode[e],Ct.ErrorMessage[e],n)}}Ct.MAX_MESSAGE_BYTES=256;Ct.MAX_DATA_BYTES=15360;Ct.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Ct.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const sv=15360;function ph(t){return new TextEncoder().encode(t).length}function Ag(t,e){if(ph(t)<=e)return t;let n=0,s=t.length;const r=new TextEncoder;for(;n<s;){const o=Math.floor((n+s+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:s=o-1}return t.slice(0,n)}const fh=2e3;function Pl(t,e){if(!e)return 0;let n,s;return"bytesReceived"in t?(n=t.bytesReceived,s=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,s=e.bytesSent),n===void 0||s===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-s)*8*1e3/(t.timestamp-e.timestamp)}const gh=typeof MediaRecorder<"u";class _M{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const MM=gh?MediaRecorder:_M;class PM extends MM{constructor(e,n){if(!gh)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let s,r;const o=()=>r===void 0,a=()=>{this.removeEventListener("dataavailable",s),this.removeEventListener("stop",a),this.removeEventListener("error",l),r?.close(),r=void 0},l=c=>{r?.error(c),this.removeEventListener("dataavailable",s),this.removeEventListener("stop",a),this.removeEventListener("error",l),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,s=d=>M(this,void 0,void 0,function*(){let u;if(d.data.arrayBuffer){const h=yield d.data.arrayBuffer();u=new Uint8Array(h)}else if(d.data.byteArray)u=d.data.byteArray;else throw new Error("no data available!");o()||c.enqueue(u)}),this.addEventListener("dataavailable",s)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",l)}}function DM(){return gh}const NM=1e3,zM=1e4;class rv extends q{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=dh(()=>M(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>M(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ie.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new an,this.pauseUpstreamLock=new an,this.trackChangeLock=new an,this.trackChangeLock.lock().then(a=>M(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{a()}})),this._constraints=e.getConstraints(),s&&(this._constraints=s)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==q.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return M(this,void 0,void 0,function*(){var s;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{wr(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(fr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((s=this.sender.transport)===null||s===void 0?void 0:s.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{fr(r??e,o)}))})}waitForDimensions(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NM;return(function*(){var s;if(e.kind===q.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((s=fn())===null||s===void 0?void 0:s.os)==="iOS"&&(yield Kt(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Kt(50)}throw new Ei("unable to get track dimensions after timeout")})()})}setDeviceId(e){return M(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===os(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),os(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===q.Source.ScreenShare)return;const{deviceId:s,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===q.Kind.Audio?"audioinput":"videoinput";return n?Ut.getInstance().normalizeDeviceId(o,s,r):s})()})}mute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return M(this,void 0,void 0,function*(){const s=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ei("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{s()}})}restart(e){return M(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:s,facingMode:r}=e,o=o_(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===q.Kind.Video?a.video=s||r?{deviceId:s,facingMode:r}:!0:a.audio=s?Object.assign({deviceId:s},o):!0,this.attachedElements.forEach(d=>{wr(this.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===q.Kind.Video&&(yield c.applyConstraints(o)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(ie.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ie.Muted:ie.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Yb()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ie.UpstreamPaused,this);const s=fn();if(s?.name==="Safari"&&hi(s.version,"12.0")<0)throw new rh("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ie.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const a=yield s.trackChangeLock.lock();try{s.log.debug("setting up processor",s.logContext);const l=document.createElement(s.kind),c={kind:s.kind,track:s._mediaStreamTrack,element:l,audioContext:s.audioContext};if(yield n.init(c),s.log.debug("processor initialized",s.logContext),s.processor&&(yield s.internalStopProcessor()),s.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(fr(s._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>{d instanceof DOMException&&d.name==="AbortError"?(s.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},s.logContext),{error:d})),setTimeout(()=>{l.play().catch(u=>{s.log.error("failed to play processor element",Object.assign(Object.assign({},s.logContext),{err:u}))})},100)):s.log.error("failed to play processor element",Object.assign(Object.assign({},s.logContext),{error:d}))}),s.processor=n,s.processorElement=l,s.processor.processedTrack){for(const d of s.attachedElements)d!==s.processorElement&&r&&(wr(s._mediaStreamTrack,d),fr(s.processor.processedTrack,d));yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(s.processor.processedTrack)}s.emit(ie.TrackProcessorUpdate,s.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const s=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{s()}})()})}internalStopProcessor(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var s,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(s=e.processor.processedTrack)===null||s===void 0||s.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ie.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!DM()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new PM(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},zM)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class nl extends rv{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,q.Kind.Audio,n,s,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}a&&this.prevStats&&(this._currentBitrate=Pl(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ie.AudioTrackFeatureUpdate,this,$t.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ie.AudioTrackFeatureUpdate,this,$t.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===q.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const s=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==os(this._constraints.deviceId);return this.source===q.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||s)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return M(this,void 0,void 0,function*(){let n;if(e){const s=ah({audio:e});typeof s.audio!="boolean"&&(n=s.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return M(this,void 0,void 0,function*(){const s=yield n.restart.call(this,e);return this.checkForSilence(),s})}startMonitor(){pn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},fh)))}setProcessor(e){return M(this,void 0,void 0,function*(){var n;const s=yield this.trackChangeLock.lock();try{if(!ui()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ie.TrackProcessorUpdate,this.processor)}finally{s()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let s;return n.forEach(r=>{r.type==="outbound-rtp"&&(s={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),s})}checkForSilence(){return M(this,void 0,void 0,function*(){const e=yield qb(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ie.AudioSilenceDetected)),e})}}function LM(t,e,n){switch(t.kind){case"audio":return new nl(t,e,!1,void 0,n);case"video":return new il(t,e,!1,n);default:throw new Ei("unsupported track type: ".concat(t.kind))}}const OM=Object.values(No),BM=Object.values(Ed),FM=Object.values(oh),WM=[No.h180,No.h360],$M=[Ed.h180,Ed.h360],UM=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var s,r;return new Xe(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((s=t.encoding.maxFramerate)!==null&&s!==void 0?s:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),zd=["q","h","f"];function Ld(t,e,n,s){var r,o;let a=s?.videoEncoding;t&&(a=s?.screenShareEncoding);const l=s?.simulcast,c=s?.scalabilityMode,d=s?.videoCodec;if(!a&&!l&&!c||!e||!n)return[{}];a||(a=GM(t,e,n,d),Ae.debug("using video encoding",a));const u=a.maxFramerate,h=new Xe(e,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&$n(d)){const x=new ov(c),g=[];if(x.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const y=fn();if(zo()||ui()||y?.name==="Chrome"&&hi(y?.version,"113")<0){const v=x.suffix=="h"?2:3,k=W_(y);for(let S=0;S<x.spatial;S+=1)g.push({rid:zd[2-S],maxBitrate:a.maxBitrate/Math.pow(v,S),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:k?Math.pow(2,S):void 0});g[0].scalabilityMode=c}else g.push({maxBitrate:a.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(g[0].priority=h.encoding.priority,g[0].networkPriority=h.encoding.priority),Ae.debug("using svc encoding",{encodings:g}),g}if(!l)return[a];let p=[];t?p=(r=Mg(s?.screenShareSimulcastLayers))!==null&&r!==void 0?r:_g(t,h):p=(o=Mg(s?.videoSimulcastLayers))!==null&&o!==void 0?o:_g(t,h);let m;if(p.length>0){const x=p[0];p.length>1&&([,m]=p);const g=Math.max(e,n);if(g>=960&&m)return Tc(e,n,[x,m,h],u);if(g>=480)return Tc(e,n,[x,h],u)}return Tc(e,n,[h])}function VM(t,e,n){var s,r,o,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ae.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const l=t.mediaStreamTrack.getSettings(),c=(s=l.width)!==null&&s!==void 0?s:(r=t.dimensions)===null||r===void 0?void 0:r.width,d=(o=l.height)!==null&&o!==void 0?o:(a=t.dimensions)===null||a===void 0?void 0:a.height;return t.source===q.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Ld(t.source===q.Source.ScreenShare,c,d,n)}function GM(t,e,n,s){const r=HM(t,e,n);let{encoding:o}=r[0];const a=Math.max(e,n);for(let l=0;l<r.length;l+=1){const c=r[l];if(o=c.encoding,c.width>=a)break}if(s)switch(s){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function HM(t,e,n){if(t)return FM;const s=e>n?e/n:n/e;return Math.abs(s-16/9)<Math.abs(s-4/3)?OM:BM}function _g(t,e){if(t)return UM(e);const{width:n,height:s}=e,r=n>s?n/s:s/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?WM:$M}function Tc(t,e,n,s){const r=[];if(n.forEach((o,a)=>{if(a>=zd.length)return;const l=Math.min(t,e),d={rid:zd[a],scaleResolutionDownBy:Math.max(1,l/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},u=s&&o.encoding.maxFramerate?Math.min(s,o.encoding.maxFramerate):o.encoding.maxFramerate;u&&(d.maxFramerate=u);const h=Ws()||a===0;o.encoding.priority&&h&&(d.priority=o.encoding.priority,d.networkPriority=o.encoding.priority),r.push(d)}),ui()&&Zb()==="ios"){let o;r.forEach(l=>{o?l.maxFramerate&&l.maxFramerate>o&&(o=l.maxFramerate):o=l.maxFramerate});let a=!0;r.forEach(l=>{var c;l.maxFramerate!=o&&(a&&(a=!1,Ae.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ae.info('Setting framerate of encoding "'.concat((c=l.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),l.maxFramerate=o)})}return r}function Mg(t){if(t)return t.sort((e,n)=>{const{encoding:s}=e,{encoding:r}=n;return s.maxBitrate>r.maxBitrate?1:s.maxBitrate<r.maxBitrate?-1:s.maxBitrate===r.maxBitrate&&s.maxFramerate&&r.maxFramerate?s.maxFramerate>r.maxFramerate?1:-1:0})}class ov{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function qM(t){return t.source===q.Source.ScreenShare||t.constraints.height&&os(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const KM=5e3;class il extends rv{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,q.Kind.Video,n,s,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const a=new Map(o.map(c=>[c.rid,c])),l=o.some(c=>c.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(ie.CpuConstrained)),this.prevStats){let c=0;a.forEach((d,u)=>{var h;const p=(h=this.prevStats)===null||h===void 0?void 0:h.get(u);c+=Pl(d,p)}),this._currentBitrate=c}this.prevStats=a}),this.senderLock=new an}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!pn())return;const s=(n=this.sender)===null||n===void 0?void 0:n.getParameters();s&&(this.encodings=s.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},fh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return M(this,void 0,void 0,function*(){var n,s,r,o,a;yield e.pauseUpstream.call(this);try{for(var l=!0,c=Ti(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0)o=d.value,l=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){s={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(s)throw s.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return M(this,void 0,void 0,function*(){var n,s,r,o,a;yield e.resumeUpstream.call(this);try{for(var l=!0,c=Ti(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0){o=d.value,l=!1;const u=o;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){s={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(s)throw s.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===q.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===q.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],s=yield this.sender.getStats();return s.forEach(r=>{var o;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},l=s.get(r.remoteId);l&&(a.jitter=l.jitter,a.packetsLost=l.packetsLost,a.roundTripTime=l.roundTripTime),n.push(a)}}),n.sort((r,o)=>{var a,l;return((a=o.frameWidth)!==null&&a!==void 0?a:0)-((l=r.frameWidth)!==null&&l!==void 0?l:0)}),n})}setPublishingQuality(e){const n=[];for(let s=Sn.LOW;s<=Sn.HIGH;s+=1)n.push(new th({quality:s,enabled:s<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers($n(this.codec),n)}restartTrack(e){return M(this,void 0,void 0,function*(){var n,s,r,o,a;let l;if(e){const h=ah({video:e});typeof h.video!="boolean"&&(l=h.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var c=!0,d=Ti(this.simulcastCodecs.values()),u;u=yield d.next(),n=u.done,!n;c=!0){o=u.value,c=!1;const h=o;h.sender&&((a=h.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){s={error:h}}finally{try{!c&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(s)throw s.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return M(this,arguments,void 0,function(s){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,l,c,d,u,h;if(yield n.setProcessor.call(r,s,o),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var p=!0,m=Ti(r.simulcastCodecs.values()),x;x=yield m.next(),a=x.done,!a;p=!0)d=x.value,p=!1,yield(h=d.sender)===null||h===void 0?void 0:h.replaceTrack(r.processor.processedTrack)}catch(g){l={error:g}}finally{try{!p&&!a&&(c=m.return)&&(yield c.call(m))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return M(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const s={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,s),s}setSimulcastTrackSender(e,n){const s=this.simulcastCodecs.get(e);s&&(s.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},KM))}setPublishingCodecs(e){return M(this,void 0,void 0,function*(){var n,s,r,o,a,l,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers($n(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const d=[];try{for(n=!0,s=Ti(e);r=yield s.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers($n(u.codec),u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const p of u.qualities)if(p.enabled){d.push(u.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Pg(h.sender,h.encodings,u.qualities,this.senderLock,$n(u.codec),this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!n&&!o&&(l=s.return)&&(yield l.call(s))}finally{if(a)throw a.error}}return d})}setPublishingLayers(e,n){return M(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Pg(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return M(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((s,r)=>{var o;return Object.assign(Object.assign({},s),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&$n(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?s.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Yb()&&this.isInBackground&&this.source===q.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Pg(t,e,n,s,r,o,a){return M(this,void 0,void 0,function*(){const l=yield s.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:d}=c;if(!d)return;if(d.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:d,senderEncodings:e}));return}let u=!1;!1&&d[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),d.forEach((p,m)=>{var x;let g=(x=p.rid)!==null&&x!==void 0?x:"";g===""&&(g="q");const y=av(g),v=n.find(k=>k.quality===y);v&&p.active!==v.enabled&&(u=!0,p.active=v.enabled,o.debug("setting layer ".concat(v.quality," to ").concat(p.active?"enabled":"disabled"),a),Ws()&&(v.enabled?(p.scaleResolutionDownBy=e[m].scaleResolutionDownBy,p.maxBitrate=e[m].maxBitrate,p.maxFrameRate=e[m].maxFrameRate):(p.scaleResolutionDownBy=4,p.maxBitrate=10,p.maxFrameRate=2)))})),u&&(c.encodings=d,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:c.encodings})),yield t.setParameters(c))}finally{l()}})}function av(t){switch(t){case"f":return Sn.HIGH;case"h":return Sn.MEDIUM;case"q":return Sn.LOW;default:return Sn.HIGH}}function Dg(t,e,n,s){if(!n)return[new rs({quality:Sn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(s){const r=n[0].scalabilityMode,o=new ov(r),a=[],l=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let d=0;d<o.spatial;d+=1)a.push(new rs({quality:Math.min(Sn.HIGH,o.spatial-1)-d,width:Math.ceil(t/Math.pow(l,d)),height:Math.ceil(e/Math.pow(l,d)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,d)):0,ssrc:0}));return a}return n.map(r=>{var o,a,l;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let d=av((a=r.rid)!==null&&a!==void 0?a:"");return new rs({quality:d,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(l=r.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const Ng="_lossy",zg="_reliable",JM=2*1e3,Ec="leave-reconnect",YM=3e4,XM=8*1024,ZM=256*1024;var In;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(In||(In={}));class QM extends fi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=hh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=In.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ae,this.reliableDataSequence=1,this.reliableMessageBuffer=new kg,this.reliableReceivedState=new bM(YM),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=s=>M(this,[s],void 0,function(r){var o=this;let{channel:a}=r;return(function*(){if(a){if(a.label===zg)o.reliableDCSub=a;else if(a.label===Ng)o.lossyDCSub=a;else return;o.log.debug("on data channel ".concat(a.id,", ").concat(a.label),o.logContext),a.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=s=>M(this,void 0,void 0,function*(){var r,o,a,l,c;const d=yield this.dataProcessLock.lock();try{let u;if(s.data instanceof ArrayBuffer)u=s.data;else if(s.data instanceof Blob)u=yield s.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:s.data}));return}const h=sn.fromBinary(new Uint8Array(u));if(h.sequence>0&&h.participantSid!==""){const p=this.reliableReceivedState.get(h.participantSid);if(p&&h.sequence<=p)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((r=h.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(ae.ActiveSpeakersUpdate,h.value.value.speakers);else if(((o=h.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const p=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),m=Gy.fromBinary(p.payload),x=new sn({value:m.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((l=x.value)===null||l===void 0?void 0:l.case)==="user"&&Lg(x,x.value.value),this.emit(ae.DataPacketReceived,x,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&Lg(h,h.value.value),this.emit(ae.DataPacketReceived,h,Dt.NONE)}finally{d()}}),this.handleDataError=s=>{const o=s.currentTarget.maxRetransmits===0?"lossy":"reliable";if(s instanceof ErrorEvent&&s.error){const{error:a}=s.error;this.log.error("DataChannel error on ".concat(o,": ").concat(s.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:s}))},this.handleBufferedAmountLow=s=>{const o=s.currentTarget.maxRetransmits===0?De.LOSSY:De.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(s,r)=>{if(this._isClosed)return;this.log.warn("".concat(s," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(ae.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(l===null){o(a);return}s===Ec&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=qt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((s,r)=>{this.pcState===In.Connected&&s();const o=()=>{this.off(ae.Disconnected,a),s()},a=()=>{this.off(ae.Restarted,o),r()};this.once(ae.Restarted,o),this.once(ae.Disconnected,a)}),this.updateAndEmitDCBufferStatus=s=>{if(s===De.RELIABLE){const o=this.dataChannelForKind(s);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(s);typeof r<"u"&&r!==this.dcBufferStatus.get(s)&&(this.dcBufferStatus.set(s,r),this.emit(ae.DCBufferStatusChanged,r,s))},this.isBufferStatusLow=s=>{const r=this.dataChannelForKind(s);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>M(this,void 0,void 0,function*(){!this.url||!(yield fetch(Lo(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===nt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===nt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Cs.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>M(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Lo(this.url),{method:"HEAD"}),Kt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Li((n=e.loggerName)!==null&&n!==void 0?n:Hn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new lh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new an,this.dataProcessLock=new an,this.dcBufferStatus=new Map([[De.LOSSY,!0],[De.RELIABLE,!0]]),this.client.onParticipantUpdate=s=>this.emit(ae.ParticipantUpdate,s),this.client.onConnectionQuality=s=>this.emit(ae.ConnectionQualityUpdate,s),this.client.onRoomUpdate=s=>this.emit(ae.RoomUpdate,s),this.client.onSubscriptionError=s=>this.emit(ae.SubscriptionError,s),this.client.onSubscriptionPermissionUpdate=s=>this.emit(ae.SubscriptionPermissionUpdate,s),this.client.onSpeakersChanged=s=>this.emit(ae.SpeakersChanged,s),this.client.onStreamStateUpdate=s=>this.emit(ae.StreamStateChanged,s),this.client.onRequestResponse=s=>this.emit(ae.SignalRequestResponse,s)}get logContext(){var e,n,s,r,o,a;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.room)===null||r===void 0?void 0:r.sid,participant:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(e,n,s,r){return M(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=s,this.maxJoinAttempts=s.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,s,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate().catch(a=>{Ae.error(a,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(ae.SignalConnected,o),o}catch(o){if(o instanceof Ce&&o.reason===at.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,s,r);throw o}})}close(){return M(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ae.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return M(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=s=>{s&&(s.close(),s.onbufferedamountlow=null,s.onclose=null,s.onclosing=null,s.onerror=null,s.onmessage=null,s.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new kg,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return M(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ei("a track with the same ID has already been published");return new Promise((n,s)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],s(Ce.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),s(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return M(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return M(this,void 0,void 0,function*(){var n,s;if(this.pcManager&&this.pcManager.currentState!==kt.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new IM(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ae.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>M(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===kt.CONNECTED){const u=this.pcState===In.New;this.pcState=In.Connected,u&&this.emit(ae.Connected,e)}else o===kt.FAILED&&(this.pcState===In.Connected||this.pcState===In.Reconnecting)&&(this.pcState=In.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?Cs.RR_SUBSCRIBER_FAILED:Cs.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===nt.RECONNECTING,d=[kt.FAILED,kt.CLOSING,kt.CLOSED].includes(o);c&&d&&!this._isClosed&&this.emit(ae.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(ae.MediaTrackAdded,o.track,o.streams[0],o.receiver)},e4((s=e.serverInfo)===null||s===void 0?void 0:s.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,s)=>M(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:s})),this.midToTrackId=s,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,s)=>M(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=s;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:s}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],s(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ae.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ae.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(ae.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ae.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(ae.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,s;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(s=this.pcManager)===null||s===void 0||s.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Cs.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:iv,regionSettings:e.regions})),e.action){case Sr.DISCONNECT:this.emit(ae.Disconnected,e?.reason),this.close();break;case Sr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Ec);break;case Sr.RESUME:this.handleDisconnect(Ec)}}}makeRTCConfiguration(e){var n;const s=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),s.encodedInsertableStreams=!0),e.iceServers&&!s.iceServers){const r=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),r.push(a)}),s.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Mo.ENABLED&&(s.iceTransportPolicy="relay"),s.sdpSemantics="unified-plan",s.continualGatheringPolicy="gather_continually",s}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Ng,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(zg,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(De.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,XM),ZM)}},1e3))}createSender(e,n,s){return M(this,void 0,void 0,function*(){if(Ad())return yield this.createTransceiverRTCRtpSender(e,n,s);if(_d())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,s,r){return M(this,void 0,void 0,function*(){if(Ad())return this.createSimulcastTransceiverSender(e,n,s,r);if(_d())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,s){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),ys(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return s&&(o.sendEncodings=s),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,s,r){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pt("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(s.videoCodec)return e.setSimulcastTrackSender(s.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return M(this,void 0,void 0,function*(){var n,s,r;if(!this._isClosed){if(this.attemptingReconnect){Ae.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Mo.DISABLED||((r=(s=this.pcManager)===null||s===void 0?void 0:s.currentState)!==null&&r!==void 0?r:kt.NEW)===kt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof Pt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof tr||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",Cs.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ae.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return M(this,void 0,void 0,function*(){var n,s,r;try{if(!this.url||!this.token)throw new Pt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ae.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new tr;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof Ce&&a.reason===at.NotAllowed?new Pt("could not reconnect, token might be expired"):new tr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ae.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new tr("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(ae.Restarted)}catch(o){const a=yield(s=this.regionUrlProvider)===null||s===void 0?void 0:s.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return M(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Pt("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ae.Resuming);let s;try{this.setupSignalClientCallbacks(),s=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof Ce&&r.reason===at.NotAllowed?new Pt("could not reconnect, token might be expired"):r instanceof Ce&&r.reason===at.LeaveRequest?r:new tr(o)}if(this.emit(ae.SignalResumed),s){const r=this.makeRTCConfiguration(s);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=s.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==nt.CONNECTED)throw new tr("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),s?.lastMessageSeq&&this.resendReliableMessagesForResume(s.lastMessageSeq),this.emit(ae.Resumed)})}waitForPCInitialConnection(e,n){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return M(this,void 0,void 0,function*(){this.pcState=In.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Kt(JM),!this.pcManager)throw new Pt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=In.Connected}catch(e){throw this.pcState=In.Disconnected,Ce.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,s,r){return M(this,void 0,void 0,function*(){const o=new sn({destinationIdentities:[e],kind:De.RELIABLE,value:{case:"rpcResponse",value:new Xu({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:s??""}})}});yield this.sendDataPacket(o,De.RELIABLE)})}publishRpcAck(e,n){return M(this,void 0,void 0,function*(){const s=new sn({destinationIdentities:[e],kind:De.RELIABLE,value:{case:"rpcAck",value:new Yu({requestId:n})}});yield this.sendDataPacket(s,De.RELIABLE)})}sendDataPacket(e,n){return M(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=lM(e);if(o){const a=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Vy({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===De.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const s=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===De.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:s,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=s.byteLength}if(this.attemptingReconnect)return;r.send(s)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return M(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(De.RELIABLE);const n=this.dataChannelForKind(De.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(s=>{n.send(s.data)})),this.updateAndEmitDCBufferStatus(De.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,s)=>M(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>s("Engine closed");for(this.once(ae.Closing,r);!this.dcBufferStatus.get(e);)yield Kt(10);this.off(ae.Closing,r),n()}}))}ensureDataTransportConnected(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!s.pcManager)throw new Pt("PC manager is closed");const a=r?s.pcManager.subscriber:s.pcManager.publisher,l=r?"Subscriber":"Publisher";if(!a)throw Ce.internal("".concat(l," connection not set"));let c=!1;!r&&!s.dataChannelForKind(n,r)&&(s.createDataChannels(),c=!0),!c&&!r&&!s.pcManager.publisher.isICEConnected&&s.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&s.negotiate().catch(h=>{Ae.error(h,s.logContext)});const d=s.dataChannelForKind(n,r);if(d?.readyState==="open")return;const u=new Date().getTime()+s.peerConnectionTimeout;for(;new Date().getTime()<u;){if(a.isICEConnected&&((o=s.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Kt(50)}throw Ce.internal("could not establish ".concat(l," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(e){return M(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==kt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return M(this,void 0,void 0,function*(){return new Promise((e,n)=>M(this,void 0,void 0,function*(){if(!this.pcManager){n(new jd("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const s=new AbortController,r=()=>{s.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(ae.Closing,r),this.pcManager.publisher.once(Tr.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(l=>{const c=l.codec.toLowerCase();H_(c)&&a.set(l.payload,c)}),this.emit(ae.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(s),e()}catch(o){o instanceof jd&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Cs.RR_UNKNOWN),n(o)}finally{this.off(ae.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===De.LOSSY)return this.lossyDCSub;if(e===De.RELIABLE)return this.reliableDCSub}else{if(e===De.LOSSY)return this.lossyDC;if(e===De.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var s,r,o,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),d=(s=this.pcManager.subscriber)===null||s===void 0?void 0:s.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),h=(a=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&a!==void 0?a:!0,p=new Array,m=new Array;e.forEach(x=>{x.isDesired!==h&&p.push(x.trackSid),x.isEnabled||m.push(x.trackSid)}),this.client.sendSyncState(new nh({answer:this.options.singlePeerConnection?c?gr({sdp:c.sdp,type:c.type}):void 0:u?gr({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?l?gr({sdp:l.sdp,type:l.type}):void 0:d?gr({sdp:d.sdp,type:d.type}):void 0,subscription:new Al({trackSids:p,subscribe:!h,participantTracks:[]}),publishTracks:R_(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((x,g)=>new db({publisherSid:g,lastSeq:x}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(s,r)=>{s?.id!==void 0&&s.id!==null&&e.push(new ub({label:s.label,id:s.id,target:r}))};return n(this.dataChannelForKind(De.LOSSY),Wn.PUBLISHER),n(this.dataChannelForKind(De.RELIABLE),Wn.PUBLISHER),n(this.dataChannelForKind(De.LOSSY,!0),Wn.SUBSCRIBER),n(this.dataChannelForKind(De.RELIABLE,!0),Wn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&qt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){pn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){pn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const s=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(s){const r=Object.entries(this.midToTrackId).find(o=>{let[a]=o;return a===s});if(r)return r[1]}}}function e4(t){return t!==void 0&&t>13}function Lg(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const s=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=s,e.destinationIdentities=s}class lv{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Rn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),nn.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Rn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),nn.LengthExceeded)}}constructor(e,n,s,r){this.reader=n,this.totalByteSize=s,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class t4 extends lv{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new _n,s=null,r=null;if(this.signal){const a=this.signal;r=()=>{var l;(l=n.reject)===null||l===void 0||l.call(n,a.reason)},a.addEventListener("abort",r),s=a}const o=()=>{e.releaseLock(),s&&r&&s.removeEventListener("abort",r),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:d}=yield Promise.race([e.read(),n.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(d),{done:!1,value:d.content})}catch(c){throw o(),c}}),return(){return M(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var s,r,o,a;let l=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=Ti(c),h;h=yield u.next(),s=h.done,!s;d=!0){a=h.value,d=!1;const p=a;l.add(p)}}catch(p){r={error:p}}finally{try{!d&&!s&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return Array.from(l)})()})}}class n4 extends lv{constructor(e,n,s,r){super(e,n,s,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const s=za(e.chunkIndex),r=this.receivedChunks.get(s);if(r&&r.version>e.version)return;this.receivedChunks.set(s,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let s=new _n,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var c;(c=s.reject)===null||c===void 0||c.call(s,l.reason)},l.addEventListener("abort",o),r=l}const a=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var l,c;try{const{done:d,value:u}=yield Promise.race([e.read(),s.promise,(c=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(d)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let h;try{h=n.decode(u.content)}catch(p){throw new Rn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(p),nn.DecodeFailed)}return{done:!1,value:h}}}catch(d){throw a(),d}}),return(){return M(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var s,r,o,a;let l="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=Ti(c),h;h=yield u.next(),s=h.done,!s;d=!0)a=h.value,d=!1,l+=a}catch(p){r={error:p}}finally{try{!d&&!s&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return l})()})}}class i4{constructor(){this.log=Ae,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Rn('A text stream handler for topic "'.concat(e,'" has already been set.'),nn.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Rn('A byte stream handler for topic "'.concat(e,'" has already been set.'),nn.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,s,r,o;const a=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(a.length>0||l.length>0){const c=new Rn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),nn.AbnormalEnd);for(const[d,u]of l)(s=(n=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(n,c),this.byteStreamControllers.delete(d);for(const[d,u]of a)(o=(r=u.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,c),this.textStreamControllers.delete(d)}}handleDataStreamPacket(e,n){return M(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,s){return M(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const l=new _n;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:za(e.timestamp),attributes:e.attributes,encryptionType:s},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new Rn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),nn.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new t4(c,d,za(e.totalLength),l),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const l=new _n;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:s},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new Rn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),nn.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new n4(c,d,za(e.totalLength),l),{identity:n})}})}handleStreamChunk(e,n){const s=this.byteStreamControllers.get(e.streamId);s&&(s.info.encryptionType!==n?(s.controller.error(new Rn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),nn.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&s.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Rn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),nn.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const s=this.textStreamControllers.get(e.streamId);s&&(s.info.encryptionType!==n?s.controller.error(new Rn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),nn.EncryptionTypeMismatch)):(s.info.attributes=Object.assign(Object.assign({},s.info.attributes),e.attributes),s.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Rn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),nn.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class cv{constructor(e,n,s){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=s,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return M(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class s4 extends cv{}class r4 extends cv{}const Og=15e3;class o4{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return M(this,void 0,void 0,function*(){var s;const r=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,l=(s=n?.attachments)===null||s===void 0?void 0:s.map(()=>crypto.randomUUID()),c=new Array(l?l.length+1:1).fill(0),d=(h,p)=>{var m;c[p]=h;const x=c.reduce((g,y)=>g+y,0);(m=n?.onProgress)===null||m===void 0||m.call(n,x)},u=yield this.streamText({streamId:r,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:l,attributes:n?.attributes});return yield u.write(e),d(1,0),yield u.close(),n?.attachments&&l&&(yield Promise.all(n.attachments.map((h,p)=>M(this,void 0,void 0,function*(){return this._sendFile(l[p],h,{topic:n.topic,mimeType:h.type,onProgress:m=>{d(m,p+1)}})})))),u.info})}streamText(e){return M(this,void 0,void 0,function*(){var n,s,r;const o=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(s=e?.topic)!==null&&s!==void 0?s:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Dt.GCM:Dt.NONE},l=new Za({streamId:o,mimeType:a.mimeType,topic:a.topic,timestamp:js(a.timestamp),totalLength:js(e?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new nb({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?gd.UPDATE:gd.CREATE})}}),c=e?.destinationIdentities,d=new sn({destinationIdentities:c,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,De.RELIABLE);let u=0;const h=this.engine,p=new WritableStream({write(g){return M(this,void 0,void 0,function*(){for(const y of Z_(g,Og)){const v=new Qa({content:y,streamId:o,chunkIndex:js(u)}),k=new sn({destinationIdentities:c,value:{case:"streamChunk",value:v}});yield h.sendDataPacket(k,De.RELIABLE),u+=1}})},close(){return M(this,void 0,void 0,function*(){const g=new el({streamId:o}),y=new sn({destinationIdentities:c,value:{case:"streamTrailer",value:g}});yield h.sendDataPacket(y,De.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let m=()=>M(this,void 0,void 0,function*(){yield x.close()});h.once(ae.Closing,m);const x=new s4(p,a,()=>this.engine.off(ae.Closing,m));return x})}sendFile(e,n){return M(this,void 0,void 0,function*(){const s=crypto.randomUUID();return yield this._sendFile(s,e,n),{id:s}})}_sendFile(e,n,s){return M(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=s?.mimeType)!==null&&r!==void 0?r:n.type,topic:s?.topic,destinationIdentities:s?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:l,value:c}=yield a.read();if(l)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return M(this,void 0,void 0,function*(){var n,s,r,o,a,l;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),d=e?.destinationIdentities,u={id:c,mimeType:(s=e?.mimeType)!==null&&s!==void 0?s:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?Dt.GCM:Dt.NONE},h=new Za({totalLength:js((l=u.size)!==null&&l!==void 0?l:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:js(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new ib({name:u.name})}}),p=new sn({destinationIdentities:d,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(p,De.RELIABLE);let m=0;const x=new an,g=this.engine,y=this.log,v=new WritableStream({write(S){return M(this,void 0,void 0,function*(){const w=yield x.lock();let b=0;try{for(;b<S.byteLength;){const T=S.slice(b,b+Og),C=new sn({destinationIdentities:d,value:{case:"streamChunk",value:new Qa({content:T,streamId:c,chunkIndex:js(m)})}});yield g.sendDataPacket(C,De.RELIABLE),m+=1,b+=T.byteLength}}finally{w()}})},close(){return M(this,void 0,void 0,function*(){const S=new el({streamId:c}),w=new sn({destinationIdentities:d,value:{case:"streamTrailer",value:S}});yield g.sendDataPacket(w,De.RELIABLE)})},abort(S){y.error("Sink error:",S)}});return new r4(v,u)})}}class dv extends q{constructor(e,n,s,r,o){super(e,s,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ie.Muted:ie.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=s=>{s.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ie.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),fh)),A_()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const s=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(s){const{timestamp:r,rtpTimestamp:o}=s;o&&this.rtpTimestamp!==o&&(this.emit(ie.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class a4 extends dv{constructor(e,n,s,r,o,a){super(e,n,q.Kind.Audio,s,a),this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=Pl(l,this.prevStats)),this.prevStats=l}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const s of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):s.volume=e;ui()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ui())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return M(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(Md(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Md(e)&&e.setSinkId(this.sinkId).catch(s=>{this.log.error("Failed to set sink id on remote audio track",s,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let s=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{s.connect(r),s=r}),this.gainNode=e.createGain(),s.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ie.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(ie.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(s=>{s.type==="inbound-rtp"&&(n={type:"audio",streamId:s.id,timestamp:s.timestamp,jitter:s.jitter,bytesReceived:s.bytesReceived,concealedSamples:s.concealedSamples,concealmentEvents:s.concealmentEvents,silentConcealedSamples:s.silentConcealedSamples,silentConcealmentEvents:s.silentConcealmentEvents,totalAudioEnergy:s.totalAudioEnergy,totalSamplesDuration:s.totalSamplesDuration})}),n})}}const Ic=100;class l4 extends dv{constructor(e,n,s,r,o){super(e,n,q.Kind.Video,s,o),this.elementInfos=[],this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Pl(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=dh(()=>{this.updateDimensions()},Ic),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===q.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?wr(this._mediaStreamTrack,n):fr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new c4(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(s=>s===e);for(const s of n)s.stopObserving();this.elementInfos=this.elementInfos.filter(s=>s!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const s of n)this.stopObservingElement(s);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,s="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(s=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&s!==""&&r.get(s)&&(n.mimeType=r.get(s).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(s=>s.element===e);for(const s of n)this.stopObservingElementInfo(s)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,s;const r=this.elementInfos.reduce((c,d)=>Math.max(c,d.visibilityChangedAt||0),0),o=!((s=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&s!==void 0)||s?this.isInBackground:!1,a=this.elementInfos.some(c=>c.pictureInPicture),l=this.elementInfos.some(c=>c.visible)&&!o||a;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-r<Ic){qt.setTimeout(()=>{this.updateVisibility()},Ic);return}this.lastVisible=l,this.emit(ie.VisibilityChanged,l,this)}}updateDimensions(){var e,n;let s=0,r=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const l=a.width()*o,c=a.height()*o;l+c>s+r&&(s=l,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===s&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:s,height:r},this.emit(ie.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?hg():n||(hg()>2?2:1)}}class c4{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=s=>{var r;const{target:o,isIntersecting:a}=s;o===this.element&&(this.isIntersecting=a,this.isPiP=Qr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var s,r,o;(r=(s=window.documentPictureInPicture)===null||s===void 0?void 0:s.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Qr(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var s;this.isPiP=Qr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.element=e,this.isIntersecting=n??Od(e),this.isPiP=pn()&&Qr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,s;this.isIntersecting=Od(this.element),this.isPiP=Qr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,fg().observe(this.element),pg().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(s=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||s===void 0||s.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,s,r,o;(e=fg())===null||e===void 0||e.unobserve(this.element),(n=pg())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(s=window.documentPictureInPicture)===null||s===void 0||s.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Qr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Od(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Od(t,e){const n=e||window;let s=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,a=t.offsetHeight,{hidden:l}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,s+=t.offsetTop,r+=t.offsetLeft;return s<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&s+a>n.pageYOffset&&r+o>n.pageXOffset&&!l&&c!=="none"}class ki extends fi.EventEmitter{constructor(e,n,s,r){var o;super(),this.metadataMuted=!1,this.encryption=Dt.NONE,this.log=Ae,this.handleMuted=()=>{this.emit(ie.Muted)},this.handleUnmuted=()=>{this.emit(ie.Unmuted)},this.log=Li((o=r?.loggerName)!==null&&o!==void 0?o:Hn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=s,this.source=q.Source.Unknown}setTrack(e){this.track&&(this.track.off(ie.Muted,this.handleMuted),this.track.off(ie.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ie.Muted,this.handleMuted),e.on(ie.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ne(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Dt.NONE}get audioTrack(){if(ai(this.track))return this.track}get videoTrack(){if(ys(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=q.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===q.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(ki||(ki={}));class Bd extends ki{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,s,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ie.Ended)},this.handleCpuConstrained=()=>{this.track&&ys(this.track)&&this.emit(ie.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(s)}setTrack(e){this.track&&(this.track.off(ie.Ended,this.handleTrackEnded),this.track.off(ie.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ie.Ended,this.handleTrackEnded),e.on(ie.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ai(this.track)){const n=this.track.getSourceTrackSettings(),s=new Set;return n.autoGainControl&&s.add($t.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&s.add($t.TF_ECHO_CANCELLATION),n.noiseSuppression&&s.add($t.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&s.add($t.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||s.add($t.TF_NO_DTX),this.track.enhancedNoiseCancellation&&s.add($t.TF_ENHANCED_NOISE_CANCELLATION),Array.from(s.values())}else return[]}}function Dl(t,e){return M(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:s,videoProcessor:r,optionsWithoutProcessor:o}=Jb(t);let a=o.audio,l=o.video;if(s&&typeof o.audio=="object"&&(o.audio.processor=s),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const h=o.audio.deviceId;o.audio.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:h}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const h=o.video.deviceId;o.video.deviceId={exact:h},n=!0,l=Object.assign(Object.assign({},o.video),{deviceId:{ideal:h}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=Hb(o,tv,nv),d=ah(c),u=navigator.mediaDevices.getUserMedia(d);o.audio&&(Ut.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Ut.userMediaPromiseMap.delete("audioinput"))),o.video&&(Ut.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Ut.userMediaPromiseMap.delete("videoinput")));try{const h=yield u;return yield Promise.all(h.getTracks().map(p=>M(this,void 0,void 0,function*(){const m=p.kind==="audio";let x=m?c.audio:c.video;(typeof x=="boolean"||!x)&&(x={});let g;const y=m?d.audio:d.video;typeof y!="boolean"&&(g=y);const v=p.getSettings().deviceId;g?.deviceId&&os(g.deviceId)!==v?g.deviceId=v:g||(g={deviceId:v});const k=LM(p,g,e);return k.kind===q.Kind.Video?k.source=q.Source.Camera:k.kind===q.Kind.Audio&&(k.source=q.Source.Microphone),k.mediaStream=h,ai(k)&&s?yield k.setProcessor(s):ys(k)&&r&&(yield k.setProcessor(r)),k})))}catch(h){if(!n)throw h;return Dl(Object.assign(Object.assign({},t),{audio:a,video:l}),e)}})}function d4(t){return M(this,void 0,void 0,function*(){return(yield Dl({audio:!1,video:!0}))[0]})}function uv(t){return M(this,void 0,void 0,function*(){return(yield Dl({audio:t??!0,video:!1}))[0]})}var es;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(es||(es={}));function u4(t){switch(t){case so.EXCELLENT:return es.Excellent;case so.GOOD:return es.Good;case so.POOR:return es.Poor;case so.LOST:return es.Lost;default:return es.Unknown}}class hv extends fi.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Po.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===vr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,s,r,o,a){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Po.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=es.Unknown,this.log=Ae,this.log=Li((c=a?.loggerName)!==null&&c!==void 0?c:Hn.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=s,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new _n,this.once(le.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(q.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(q.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(q.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===vr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==vr.ACTIVE&&this.emit(le.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,s=this.metadata;this.metadata=e,n&&this.emit(le.ParticipantMetadataChanged,s)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(le.ParticipantNameChanged,e)}_setAttributes(e){const n=__(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(le.AttributesChanged,n)}setPermissions(e){var n,s,r,o,a,l;const c=this.permissions,d=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((s=this.permissions)===null||s===void 0?void 0:s.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,h)=>{var p;return u!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[h])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,d&&this.emit(le.ParticipantPermissionsChanged,c),d}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(le.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=u4(e),n!==this._connectionQuality&&this.emit(le.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ai(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(ie.Muted,()=>{this.emit(le.TrackMuted,e)}),e.on(ie.Unmuted,()=>{this.emit(le.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case q.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case q.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function h4(t){var e,n,s;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new lb({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(s=t.allowAll)!==null&&s!==void 0?s:!1,trackSids:t.allowedTrackSids||[]})}class p4 extends hv{constructor(e,n,s,r,o,a){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Dt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new _n)},this.handleReconnected=()=>{var l,c;(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||c===void 0||c.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,c,d,u,h,p;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||c===void 0||c.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(d=this.signalConnectedFuture).reject)===null||u===void 0||u.call(d,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(p=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var c,d;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new _n),(d=(c=this.signalConnectedFuture).resolve)===null||d===void 0||d.call(c)},this.handleSignalRequestResponse=l=>{const{requestId:c,reason:d,message:u}=l,h=this.pendingSignalRequests.get(c);h&&(d!==ih.OK&&h.reject(new ag(u,d)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let c=l.value.value,d=null,u=null;c.value.case==="payload"?d=c.value.value:c.value.case==="error"&&(u=Ct.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,d,u);break;case"rpcAck":let h=l.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>h4(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,c)=>{if(c===void 0&&(c=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ne(l)));return}this.engine.updateMuteStatus(l.sid,c)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ne(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ne(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const c=this.audioTrackPublications.get(l.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(l,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ne(c))),this.emit(le.LocalTrackCpuConstrained,l,c)},this.handleSubscribedQualityUpdate=l=>M(this,void 0,void 0,function*(){var c,d,u,h,p;if(!(!((p=this.roomOptions)===null||p===void 0)&&p.dynacast))return;const m=this.videoTrackPublications.get(l.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!m.videoTrack)return;const x=yield m.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var g=!0,y=Ti(x),v;v=yield y.next(),c=v.done,!c;g=!0){h=v.value,g=!1;const k=h;T_(k)&&(this.log.debug("publish ".concat(k," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ne(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,k,m.options))}}catch(k){d={error:k}}finally{try{!g&&!c&&(u=y.return)&&(yield u.call(y))}finally{if(d)throw d.error}}}),this.handleLocalTrackUnpublished=l=>{const c=this.trackPublications.get(l.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=l=>M(this,void 0,void 0,function*(){if(l.source===q.Source.ScreenShare||l.source===q.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ne(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(Si(l)||qi(l))try{if(pn())try{const c=yield navigator?.permissions.query({name:l.source===q.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),Ne(l))),c.onchange=()=>{c.state!=="denied"&&(l.isMuted||l.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ne(l))),Si(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ne(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=s,this.roomOptions=r,this.setupEngine(s),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Dt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(ae.RemoteMute,(s,r)=>{const o=this.trackPublications.get(s);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ae.Connected,this.handleReconnected).on(ae.SignalConnected,this.handleSignalConnected).on(ae.SignalRestarted,this.handleReconnected).on(ae.SignalResumed,this.handleReconnected).on(ae.Restarting,this.handleReconnecting).on(ae.Resuming,this.handleReconnecting).on(ae.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ae.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ae.Closing,this.handleClosing).on(ae.SignalRequestResponse,this.handleSignalRequestResponse).on(ae.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return M(this,arguments,void 0,function(n){var s=this;let{metadata:r,name:o,attributes:a}=n;return(function*(){return new Promise((l,c)=>M(s,void 0,void 0,function*(){var d,u;try{let h=!1;const p=yield this.engine.client.sendUpdateLocalMetadata((d=r??this.metadata)!==null&&d!==void 0?d:"",(u=o??this.name)!==null&&u!==void 0?u:"",a),m=performance.now();for(this.pendingSignalRequests.set(p,{resolve:l,reject:x=>{c(x),h=!0},values:{name:o,metadata:r,attributes:a}});performance.now()-m<5e3&&!h;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!a||Object.entries(a).every(x=>{let[g,y]=x;return this.attributes[g]===y||y===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(p),l();return}yield Kt(50)}c(new ag("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))})()})}setCameraEnabled(e,n,s){return this.setTrackEnabled(q.Source.Camera,e,n,s)}setMicrophoneEnabled(e,n,s){return this.setTrackEnabled(q.Source.Microphone,e,n,s)}setScreenShareEnabled(e,n,s){return this.setTrackEnabled(q.Source.ScreenShare,e,n,s)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){this.encryptionType=e?Dt.GCM:Dt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,s,r){return M(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(n)if(l)yield l.unmute();else{let c;if(this.pendingPublishing.has(e)){const d=yield this.waitForPendingPublicationOfSource(e);return d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield d?.unmute(),d}this.pendingPublishing.add(e);try{switch(e){case q.Source.Camera:c=yield this.createTracks({video:(o=s)!==null&&o!==void 0?o:!0});break;case q.Source.Microphone:c=yield this.createTracks({audio:(a=s)!==null&&a!==void 0?a:!0});break;case q.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},s));break;default:throw new Ei(e)}}catch(d){throw c?.forEach(u=>{u.stop()}),d instanceof Error&&this.emit(le.MediaDevicesError,d,Rd(e)),this.pendingPublishing.delete(e),d}for(const d of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),s);e===q.Source.Microphone&&ai(d)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),d.startPreConnectBuffer())}try{const d=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ne(h))),d.push(this.publishTrack(h,r));[l]=yield Promise.all(d)}catch(d){throw c?.forEach(u=>{u.stop()}),d}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===q.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const c=this.getTrackPublication(q.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return M(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(q.Source.Camera)||this.pendingPublishing.has(q.Source.Microphone))){this.pendingPublishing.add(q.Source.Camera),this.pendingPublishing.add(q.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(q.Source.Camera),this.pendingPublishing.delete(q.Source.Microphone)}}})}createTracks(e){return M(this,void 0,void 0,function*(){var n,s;e??(e={});const r=Hb(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(s=this.roomOptions)===null||s===void 0?void 0:s.videoCaptureDefaults);try{return(yield Dl(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(ai(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=q.Source.Microphone,this.emit(le.AudioStreamAcquired)),ys(l)&&(this.cameraError=void 0,l.source=q.Source.Camera),l))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return M(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new rh("getDisplayMedia not supported");e.resolution===void 0&&!F_()&&(e.resolution=oh.h1080fps30.resolution);const n=I_(e),s=yield navigator.mediaDevices.getDisplayMedia(n),r=s.getVideoTracks();if(r.length===0)throw new Ei("no video track found");const o=new il(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=q.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(s.getAudioTracks().length>0){this.emit(le.AudioStreamAcquired);const l=new nl(s.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=q.Source.ScreenShareAudio,a.push(l)}return a})}publishTrack(e,n){return M(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return M(this,arguments,void 0,function(s,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,c,d,u;Si(s)&&s.setAudioContext(o.audioContext),yield(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise,o.republishPromise&&!a&&(yield o.republishPromise),Cr(s)&&o.pendingPublishPromises.has(s)&&(yield o.pendingPublishPromises.get(s));let h;if(s instanceof MediaStreamTrack)h=s.getConstraints();else{h=s.constraints;let v;switch(s.source){case q.Source.Microphone:v="audioinput";break;case q.Source.Camera:v="videoinput"}v&&o.activeDeviceMap.has(v)&&(h=Object.assign(Object.assign({},h),{deviceId:o.activeDeviceMap.get(v)}))}if(s instanceof MediaStreamTrack)switch(s.kind){case"audio":s=new nl(s,h,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":s=new il(s,h,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Ei("unsupported MediaStreamTrack kind ".concat(s.kind))}else s.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let p;if(o.trackPublications.forEach(v=>{v.track&&v.track===s&&(p=v)}),p)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Ne(p))),p;const m=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),x="channelCount"in s.mediaStreamTrack.getSettings()&&s.mediaStreamTrack.getSettings().channelCount===2||s.mediaStreamTrack.getConstraints().channelCount===2,g=(c=m.forceStereo)!==null&&c!==void 0?c:x;g&&(m.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Ne(s))),m.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(d=m.dtx)!==null&&d!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!$_()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),m.simulcast=!1),m.source&&(s.source=m.source);const y=new Promise((v,k)=>M(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==nt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ne(s)}));let S=!1;const w=setTimeout(()=>{S=!0,s.stop(),k(new og("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(w),S)return;const b=yield this.publish(s,m,g);v(b)}else try{const S=yield this.publish(s,m,g);v(S)}catch(S){k(S)}}catch(S){k(S)}}));o.pendingPublishPromises.set(s,y);try{return yield y}catch(v){throw v}finally{o.pendingPublishPromises.delete(s)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new _n),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ne(e))),!1;const{canPublish:n,canPublishSources:s}=this.permissions;return n&&(s.length===0||s.map(r=>M_(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ne(e))),!1)}publish(e,n,s){return M(this,void 0,void 0,function*(){var r,o,a,l,c,d,u,h,p,m;if(!this.hasPermissionsToPublish(e))throw new og("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(R=>Cr(e)&&R.source===e.source)&&e.source!==q.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ne(e))),n.stopMicTrackOnMute&&ai(e)&&(e.stopOnMute=!0),e.source===q.Source.ScreenShare&&Ws()&&(n.simulcast=!1),n.videoCodec==="av1"&&!L_()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!O_()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Nd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(R=>n.videoCodec===go(R.mime))||(n.videoCodec=go(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(ie.Muted,this.onTrackMuted),e.on(ie.Unmuted,this.onTrackUnmuted),e.on(ie.Ended,this.handleTrackEnded),e.on(ie.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ie.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ie.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),k=e.getSourceTrackSettings();k.autoGainControl&&y.push($t.TF_AUTO_GAIN_CONTROL),k.echoCancellation&&y.push($t.TF_ECHO_CANCELLATION),k.noiseSuppression&&y.push($t.TF_NOISE_SUPPRESSION),k.channelCount&&k.channelCount>1&&y.push($t.TF_STEREO),v&&y.push($t.TF_NO_DTX),Si(e)&&e.hasPreConnectBuffer&&y.push($t.TF_PRECONNECT_BUFFER);const S=new Do({cid:e.mediaStreamTrack.id,name:n.name,type:q.kindToProto(e.kind),muted:e.isMuted,source:q.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:s,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:y});let w;if(e.kind===q.Kind.Video){let R={width:0,height:0};try{R=yield e.waitForDimensions()}catch{const A=(l=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&l!==void 0?l:No.h720.resolution;R={width:A.width,height:A.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{dims:R}))}S.width=R.width,S.height=R.height,qi(e)&&($n(g)&&(e.source===q.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ne(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new xd({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Nd}),n.backupCodec&&g!==n.backupCodec.codec&&S.encryption===Dt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new xd({codec:n.backupCodec.codec,cid:""})))),w=Ld(e.source===q.Source.ScreenShare,S.width,S.height,n),S.layers=Dg(S.width,S.height,w,$n(n.videoCodec))}else e.kind===q.Kind.Audio&&(w=[{maxBitrate:(d=n.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(h=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&h!==void 0?h:"high",networkPriority:(m=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pt("cannot publish track when not connected");const b=()=>M(this,void 0,void 0,function*(){var R,I,A;if(!this.engine.pcManager)throw new Pt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,w),this.emit(le.LocalSenderCreated,e.sender,e),qi(e)&&((R=n.degradationPreference)!==null&&R!==void 0||(n.degradationPreference=qM(e)),e.setDegradationPreference(n.degradationPreference)),w)if(Ws()&&e.kind===q.Kind.Audio){let L;for(const B of this.engine.pcManager.publisher.getTransceivers())if(B.sender===e.sender){L=B;break}L&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:L,codec:"opus",maxbr:!((I=w[0])===null||I===void 0)&&I.maxBitrate?w[0].maxBitrate/1e3:0})}else e.codec&&$n(e.codec)&&(!((A=w[0])===null||A===void 0)&&A.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const C=new Promise((R,I)=>M(this,void 0,void 0,function*(){var A;try{T=yield this.engine.addTrack(S),R(T)}catch(L){e.sender&&(!((A=this.engine.pcManager)===null||A===void 0)&&A.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(B=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{error:B}))})),I(L)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([C,b()]))[0];else{T=yield C;let R;if(T.codecs.forEach(I=>{R===void 0&&(R=I.mimeType)}),R&&e.kind===q.Kind.Video){const I=go(R);I!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{codec:I})),n.videoCodec=I,w=Ld(e.source===q.Source.ScreenShare,S.width,S.height,n))}yield b()}const j=new Bd(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(j.on(ie.CpuConstrained,R=>this.onTrackCpuConstrained(R,j)),j.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:T})),qi(e)?e.startMonitor(this.engine.client):Si(e)&&e.startMonitor(),this.addTrackPublication(j),this.emit(le.LocalTrackPublished,j),Si(e)&&T.audioFeatures.includes($t.TF_PRECONNECT_BUFFER)){const R=e.getPreConnectBuffer(),I=e.getPreConnectBufferMimeType();this.on(le.LocalTrackSubscribed,A=>{if(A.trackSid===T.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ne(e))),e.stopPreConnectBuffer()}}),R&&new Promise((L,B)=>M(this,void 0,void 0,function*(){var P,_,O,W,D,N;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ne(e)));const Z=setTimeout(()=>{B(new Error("agent not active within 10 seconds"))},1e4),ee=yield this.waitUntilActiveAgentPresent();clearTimeout(Z),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ne(e)));const se=yield this.streamBytes({name:"preconnect-buffer",mimeType:I,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ee.identity],attributes:{trackId:j.trackSid,sampleRate:String((D=k.sampleRate)!==null&&D!==void 0?D:"48000"),channels:String((N=k.channelCount)!==null&&N!==void 0?N:"1")}});try{for(var F=!0,ne=Ti(R),re;re=yield ne.next(),P=re.done,!P;F=!0){W=re.value,F=!1;const z=W;yield se.write(z)}}catch(z){_={error:z}}finally{try{!F&&!P&&(O=ne.return)&&(yield O.call(ne))}finally{if(_)throw _.error}}yield se.close(),L()}catch(Z){B(Z)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ne(e)))}).catch(L=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{error:L}))})}return j})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,s){return M(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Dt.NONE)return;let o;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(o=m)}),!o)throw new Ei("track is not published");if(!qi(e))throw new Ei("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),s),l=VM(e,n,a);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ne(e)));return}const c=e.addSimulcastTrack(n,l);if(!c)return;const d=new Do({cid:c.mediaStreamTrack.id,type:q.kindToProto(e.kind),muted:e.isMuted,source:q.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:c.mediaStreamTrack.id}]});if(d.layers=Dg(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new Pt("cannot publish track when not connected");const u=()=>M(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,a,l),yield this.engine.negotiate()}),p=(yield Promise.all([this.engine.addTrack(d),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:p}))})}unpublishTrack(e,n){return M(this,void 0,void 0,function*(){var s,r;if(Cr(e)){const d=this.pendingPublishPromises.get(e);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ne(e))),yield d)}const o=this.getPublicationForTrack(e),a=o?Ne(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(ie.Muted,this.onTrackMuted),e.off(ie.Unmuted,this.onTrackUnmuted),e.off(ie.Ended,this.handleTrackEnded),e.off(ie.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ie.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ie.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(s=this.roomOptions)===null||s===void 0?void 0:s.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let l=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<kt.FAILED&&c)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===c&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(c)&&(l=!0),qi(e)){for(const[,d]of e.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);e.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:d}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case q.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case q.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(le.LocalTrackUnpublished,o),o.setTrack(void 0),l&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return M(this,void 0,void 0,function*(){return(yield Promise.all(e.map(s=>this.unpublishTrack(s)))).filter(s=>!!s)})}republishAllTracks(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){s.republishPromise&&(yield s.republishPromise),s.republishPromise=new Promise((o,a)=>M(s,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),l.push(c))}),yield Promise.all(l.map(c=>M(this,void 0,void 0,function*(){const d=c.track;yield this.unpublishTrack(d,!1),r&&!d.isMuted&&d.source!==q.Source.ScreenShare&&d.source!==q.Source.ScreenShareAudio&&(Si(d)||qi(d))&&!d.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield d.restartTrack()),yield this.publishOrRepublishTrack(d,c.options,!0)}))),o()}catch(l){a(l)}finally{this.republishPromise=void 0}})),yield s.republishPromise})()})}publishData(e){return M(this,arguments,void 0,function(n){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?De.RELIABLE:De.LOSSY,a=r.destinationIdentities,l=r.topic;let c=new Ku({participantIdentity:s.identity,payload:n,destinationIdentities:a,topic:l});const d=new sn({kind:o,value:{case:"user",value:c}});yield s.engine.sendDataPacket(d,o)})()})}publishDtmf(e,n){return M(this,void 0,void 0,function*(){const s=new sn({kind:De.RELIABLE,value:{case:"sipDtmf",value:new qy({code:e,digit:n})}});yield this.engine.sendDataPacket(s,De.RELIABLE)})}sendChatMessage(e,n){return M(this,void 0,void 0,function*(){const s={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},r=new sn({value:{case:"chatMessage",value:new Xa(Object.assign(Object.assign({},s),{timestamp:ut.parse(s.timestamp)}))}});return yield this.engine.sendDataPacket(r,De.RELIABLE),this.emit(le.ChatMessage,s),s})}editChatMessage(e,n){return M(this,void 0,void 0,function*(){const s=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new sn({value:{case:"chatMessage",value:new Xa(Object.assign(Object.assign({},s),{timestamp:ut.parse(s.timestamp),editTimestamp:ut.parse(s.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,De.RELIABLE),this.emit(le.ChatMessage,s),s})}sendText(e,n){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return M(this,arguments,void 0,function(n){var s=this;let{destinationIdentity:r,method:o,payload:a,responseTimeout:l=15e3}=n;return(function*(){return new Promise((u,h)=>M(s,void 0,void 0,function*(){var p,m,x,g;if(ph(a)>sv){h(Ct.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||m===void 0)&&m.version&&hi((g=(x=this.engine.latestJoinResponse)===null||x===void 0?void 0:x.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){h(Ct.builtIn("UNSUPPORTED_SERVER"));return}const y=Math.max(l,8e3),v=crypto.randomUUID();yield this.publishRpcRequest(r,v,o,a,y);const k=setTimeout(()=>{this.pendingAcks.delete(v),h(Ct.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(S)},7e3);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(k)},participantIdentity:r});const S=setTimeout(()=>{this.pendingResponses.delete(v),h(Ct.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(v,{resolve:(w,b)=>{clearTimeout(S),this.pendingAcks.has(v)&&(this.log.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(k)),b?h(b):u(w??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,s){const r=this.pendingResponses.get(e);r?(r.resolve(n,s),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,s,r,o){return M(this,void 0,void 0,function*(){const a=new sn({destinationIdentities:[e],kind:De.RELIABLE,value:{case:"rpcRequest",value:new Ju({id:n,method:s,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(a,De.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:s}]of this.pendingAcks)s===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:s,resolve:r}]of this.pendingResponses)s===e&&(r(null,Ct.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var s,r;const o=this.trackPublications.get(n.sid);if(o){const a=o.isMuted||((r=(s=o.track)===null||s===void 0?void 0:s.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(e){var n,s,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(s=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||s===void 0||s.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new _n),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(s=>{const r=s.track;r&&(e instanceof MediaStreamTrack?(Si(r)||qi(r))&&r.mediaStreamTrack===e&&(n=s):e===r&&(n=s))}),n}waitForPendingPublicationOfSource(e){return M(this,void 0,void 0,function*(){const s=Date.now();for(;Date.now()<s+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[a]=o;return a.source===e});if(r)return r[1];yield Kt(20)}})}}class f4 extends ki{constructor(e,n,s,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ie.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=s,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,s=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Al({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Jy({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ie.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(s)}get subscriptionStatus(){return this.subscribed===!1?ki.SubscriptionStatus.Unsubscribed:super.isSubscribed?ki.SubscriptionStatus.Subscribed:ki.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ki.PermissionStatus.Allowed:ki.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,s;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((s=this.requestedVideoDimensions)===null||s===void 0?void 0:s.height)===e.height||(Sc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Sc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Sn.HIGH}setTrack(e){const n=this.subscriptionStatus,s=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(ie.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(ie.VisibilityChanged,this.handleVisibilityChange),r.off(ie.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(ie.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ie.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ie.VisibilityChanged,this.handleVisibilityChange),e.on(ie.Ended,this.handleEnded),this.emit(ie.Subscribed,e)),this.emitPermissionUpdateIfChanged(s),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,s=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(s),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(ie.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?ie.Muted:ie.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(ie.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ie.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Sc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new sb({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===q.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)cg(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const s=P_(this.trackInfo,this.requestedMaxQuality);s&&cg(this.videoDimensionsAdaptiveStream,s)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Sn.HIGH})),e.quality=Sn.HIGH)}this.emit(ie.UpdateSettings,e)}}class sl extends hv{static fromParticipantInfo(e,n,s){return new sl(e,n.sid,n.identity,n.name,n.metadata,n.attributes,s,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,s,r,o,a,l){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Po.STANDARD;super(n,s||"",r,o,a,l,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ie.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ne(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(ie.UpdateSubscription,n=>{n.participantTracks.forEach(s=>{s.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(ie.SubscriptionPermissionChanged,n=>{this.emit(le.TrackSubscriptionPermissionChanged,e,n)}),e.on(ie.SubscriptionStatusChanged,n=>{this.emit(le.TrackSubscriptionStatusChanged,e,n)}),e.on(ie.Subscribed,n=>{this.emit(le.TrackSubscribed,n,e)}),e.on(ie.Unsubscribed,n=>{this.emit(le.TrackUnsubscribed,n,e)}),e.on(ie.SubscriptionFailed,n=>{this.emit(le.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:q.Source.Microphone;this.volumeMap.set(n,e);const s=this.getTrackPublication(n);s&&s.track&&s.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:q.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,s,r,o,a){let l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(u=>{!l&&e.kind===u.kind.toString()&&(l=u)}),!l){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(le.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,s,r,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ne(l))),this.emit(le.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let d;return c?d=new l4(e,n,r,o):d=new a4(e,n,r,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(s),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&Pd(d)&&ai(d)&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,s=new Map;return e.tracks.forEach(r=>{var o,a;let l=this.getTrackPublicationBySid(r.sid);if(l)l.updateInfo(r);else{const c=q.kindFromProto(r.type);if(!c)return;l=new f4(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),l.updateInfo(r),s.set(r.sid,l);const d=Array.from(this.trackPublications.values()).find(u=>u.source===l?.source);d&&l.source!==q.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ne(d),newTrack:Ne(l)})),this.addTrackPublication(l)}n.set(r.sid,l)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ne(r))),this.unpublishTrack(r.trackSid,!0))}),s.forEach(r=>{this.emit(le.TrackPublished,r)}),!0}unpublishTrack(e,n){const s=this.trackPublications.get(e);if(!s)return;const{track:r}=s;switch(r&&(r.stop(),s.setTrack(void 0)),this.trackPublications.delete(e),s.kind){case q.Kind.Audio:this.audioTrackPublications.delete(e);break;case q.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(le.TrackUnpublished,s)}setAudioOutput(e){return M(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(s=>{var r;ai(s.track)&&Pd(s.track)&&n.push(s.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:s})),super.emit(e,...s)}}var He;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(He||(He={}));const g4=4*1e3;class Dr extends fi.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,s,r,o;if(super(),n=this,this.state=He.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ae,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>M(this,void 0,void 0,function*(){var d;if(!B_())throw ui()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===He.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(He.Connecting),((d=this.regionUrlProvider)===null||d===void 0?void 0:d.getServerUrl().toString())!==Qb(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Pr(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new $e(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(m=>{var x;(x=this.regionUrlProvider)===null||x===void 0||x.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const h=(m,x,g)=>M(this,void 0,void 0,function*(){var y,v;this.abortController&&this.abortController.abort();const k=new AbortController;this.abortController=k,u?.();try{if(yield jr.getInstance().getBackOffPromise(a),k.signal.aborted)throw Ce.cancelled("Connection attempt aborted");yield this.attemptConnection(g??a,l,c,k),this.abortController=void 0,m()}catch(S){if(this.regionUrlProvider&&S instanceof Ce&&S.reason!==at.Cancelled&&S.reason!==at.NotAllowed){let w=null;try{this.log.debug("Fetching next region"),w=yield this.regionUrlProvider.getNextBestRegionUrl((y=this.abortController)===null||y===void 0?void 0:y.signal)}catch(b){if(b instanceof Ce&&(b.status===401||b.reason===at.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),x(b);return}}[at.InternalError,at.ServerUnreachable,at.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),jr.getInstance().addFailedConnectionAttempt(a)),w&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield h(m,x,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,mg(S)),x(S))}else{let w=Un.UNKNOWN_REASON;S instanceof Ce&&(w=mg(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),x(S)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new _n((m,x)=>{h(m,x,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,d,u,h)=>M(this,void 0,void 0,function*(){var p,m,x;const g=yield c.join(a,l,{autoSubscribe:d.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout,singlePeerConnection:u.singlePeerConnection},h.signal);let y=g.serverInfo;if(y||(y={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=y,this.log.debug("connected to Livekit Server ".concat(Object.entries(y).map(v=>{let[k,S]=v;return"".concat(k,": ").concat(S)}).join(", ")),{room:(p=g.room)===null||p===void 0?void 0:p.name,roomSid:(m=g.room)===null||m===void 0?void 0:m.sid,identity:(x=g.participant)===null||x===void 0?void 0:x.identity}),!y.version)throw new S_("unknown server version");return y.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),g}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,d)=>M(this,void 0,void 0,function*(){var u,h;this.state===He.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},hh),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,d);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const m=d.signal.aborted?Ce.cancelled("Signal connection aborted"):Ce.serverUnreachable("could not establish signal connection");throw p instanceof Error&&(m.message="".concat(m.message,": ").concat(p.message)),p instanceof Ce&&(m.reason=p.reason,m.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),m}if(d.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),Ce.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}pn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),pn()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(He.Connected),this.emit(Y.Connected),jr.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return M(n,[...l],void 0,function(){var d=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var h,p,m;const x=yield d.disconnectLock.lock();try{if(d.state===He.Disconnected){d.log.debug("already disconnected",d.logContext);return}if(d.log.info("disconnect from room",Object.assign({},d.logContext)),d.state===He.Connecting||d.state===He.Reconnecting||d.isResuming){const g="Abort connection attempt due to user initiated disconnect";d.log.warn(g,d.logContext),(h=d.abortController)===null||h===void 0||h.abort(g),(m=(p=d.connectFuture)===null||p===void 0?void 0:p.reject)===null||m===void 0||m.call(p,Ce.cancelled("Client initiated disconnect")),d.connectFuture=void 0}d.engine&&(d.engine.client.isDisconnected||(yield d.engine.client.sendLeave()),yield d.engine.close()),d.handleDisconnect(u,Un.CLIENT_INITIATED),d.engine=void 0}finally{x()}})()})},this.onPageLeave=()=>M(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>M(this,void 0,void 0,function*(){const a=[],l=fn();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let d=document.getElementById(c);if(!d){d=document.createElement("audio"),d.id=c,d.autoplay=!0,d.hidden=!0;const u=vc();u.enabled=!0;const h=new MediaStream([u]);d.srcObject=h,document.addEventListener("visibilitychange",()=>{d&&(d.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(d),this.once(Y.Disconnected,()=>{d?.remove(),d=null})}a.push(d)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(d=>{d.track&&d.track.attachedElements.forEach(u=>{a.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>M(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var d;(d=c.track)===null||d===void 0||d.attachedElements.forEach(u=>{a.includes(u)||a.push(u)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(He.Reconnecting)&&this.emit(Y.Reconnecting)},this.handleSignalRestarted=a=>M(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(He.Connected),this.emit(Y.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let d=this.remoteParticipants.get(l.identity);l.state===vr.DISCONNECTED?this.handleParticipantDisconnected(l.identity,d):d=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(d=>{if(c[d.sid]=!0,d.sid===this.localParticipant.sid)this.localParticipant.audioLevel=d.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(d.sid);u&&(u.audioLevel=d.level,u.setIsSpeaking(!0),l.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(d=>{c[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(Y.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(d=>{const u=this.remoteParticipants.get(d.identity);u&&u.sid!==d.sid||l.set(d.sid,d)}),a.forEach(d=>{let u=this.getRemoteParticipantBySid(d.sid);d.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=d.level,u.setIsSpeaking(d.active),d.active?l.set(d.sid,u):l.delete(d.sid))});const c=Array.from(l.values());c.sort((d,u)=>u.audioLevel-d.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(Y.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const d=c.getTrackPublicationBySid(l.trackSid);if(!d||!d.track)return;const u=q.streamStateFromProto(l.state);d.track.setStreamState(u),u!==d.track.streamState&&(c.emit(le.TrackStreamStateChanged,d,d.track.streamState),this.emitWhenConnected(Y.TrackStreamStateChanged,d,d.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(d=>d.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const d=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,d.id,d.method,d.payload,d.responseTimeoutMs,d.version)}},this.handleUserPacket=(a,l,c,d)=>{this.emit(Y.DataReceived,l.payload,a,c,l.topic,d),a?.emit(le.DataReceived,l.payload,c,d)},this.handleSipDtmf=(a,l)=>{this.emit(Y.SipDTMFReceived,l,a),a?.emit(le.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),d=c?.trackPublications.get(l.trackId),u=K_(l,this.transcriptionReceivedTimes);d?.emit(ie.TranscriptionReceived,u),c?.emit(le.TranscriptionReceived,u,d),this.emit(Y.TranscriptionReceived,u,c,d)},this.handleChatMessage=(a,l)=>{const c=J_(l);this.emit(Y.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(Y.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Y.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Y.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Y.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Y.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>M(this,void 0,void 0,function*(){var a;((a=fn())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Y.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(Y.RoomMetadataChanged,a.metadata),l?.activeRecording!==a.activeRecording&&this.emitWhenConnected(Y.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(Y.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(Y.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(Y.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(Y.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(Y.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a?.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>M(this,void 0,void 0,function*(){var l,c,d,u,h,p;(l=a.track)===null||l===void 0||l.on(ie.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(ie.Restarted,this.onLocalTrackRestarted),(h=(u=(d=a.track)===null||d===void 0?void 0:d.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||h===void 0||h.call(u,this),this.emit(Y.LocalTrackPublished,a,this.localParticipant),Si(a.track)&&(yield a.track.checkForSilence())&&this.emit(Y.LocalAudioSilenceDetected,a);const m=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(!1),x=Rd(a.source);x&&m&&m!==this.localParticipant.activeDeviceMap.get(x)&&(this.localParticipant.activeDeviceMap.set(x,m),this.emit(Y.ActiveDeviceChanged,x,m))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(ie.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(ie.Restarted,this.onLocalTrackRestarted),this.emit(Y.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>M(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=Rd(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(Y.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(Y.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(Y.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(Y.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(Y.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},EM),e),this.log=Li((s=this.options.loggerName)!==null&&s!==void 0?s:Hn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},tv),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},nv),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},TM),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new i4,this.outgoingDataStreamManager=new o4(this.engine,this.log),this.disconnectLock=new an,this.localParticipant=new p4("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",os(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",os(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",os(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),pn()){const a=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),Dr.cleanupRegistry&&Dr.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,s=this.options.encryption||this.options.e2ee;s&&("e2eeManager"in s?(this.e2eeManager=s.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new cM(s,n),this.e2eeManager.on(ns.ParticipantEncryptionStatusChanged,(r,o)=>{X_(o)&&(this.isE2EEEnabled=r),this.emit(Y.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on(ns.EncryptionError,(r,o)=>{const a=o?this.getParticipantByIdentity(o):void 0;this.emit(Y.EncryptionError,r,a)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return M(this,void 0,void 0,function*(){return this.state===He.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const s=r=>{r.sid!==""&&(this.engine.off(ae.RoomUpdate,s),e(r.sid))};this.engine.on(ae.RoomUpdate,s),this.once(Y.Disconnected,()=>{this.engine.off(ae.RoomUpdate,s),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new QM(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ae.ParticipantUpdate,this.handleParticipantUpdates).on(ae.RoomUpdate,this.handleRoomUpdate).on(ae.SpeakersChanged,this.handleSpeakersChanged).on(ae.StreamStateChanged,this.handleStreamStateUpdate).on(ae.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ae.SubscriptionError,this.handleSubscriptionError).on(ae.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ae.MediaTrackAdded,(e,n,s)=>{this.onTrackAdded(e,n,s)}).on(ae.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ae.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ae.DataPacketReceived,this.handleDataPacket).on(ae.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(He.SignalReconnecting)&&this.emit(Y.SignalReconnecting)}).on(ae.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(He.Connected)&&this.emit(Y.Reconnected)}).on(ae.SignalResumed,()=>{this.bufferedEvents=[],(this.state===He.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ae.Restarting,this.handleRestarting).on(ae.SignalRestarted,this.handleSignalRestarted).on(ae.Offline,()=>{this.setAndEmitConnectionState(He.Reconnecting)&&this.emit(Y.Reconnecting)}).on(ae.DCBufferStatusChanged,(e,n)=>{this.emit(Y.DCBufferStatusChanged,e,n)}).on(ae.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(s=>{let{trackSid:r}=s;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(le.LocalTrackSubscribed,n),this.emitWhenConnected(Y.LocalTrackSubscribed,n,this.localParticipant)}).on(ae.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,s)=>{this.handleParticipantDisconnected(s,n)}),this.emit(Y.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ut.getInstance().getDevices(e,n)}prepareConnection(e,n){return M(this,void 0,void 0,function*(){if(this.state===He.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Pr(new URL(e))&&n){this.regionUrlProvider=new $e(e,n);const s=yield this.regionUrlProvider.getNextBestRegionUrl();s&&this.state===He.Disconnected&&(this.regionUrl=s,yield fetch(Lo(s),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(s),this.logContext))}else yield fetch(Lo(e),{method:"HEAD"})}catch(s){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:s}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return M(this,void 0,void 0,function*(){let s=()=>M(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Yn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Yn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Yn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Yn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":s=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":s=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Yn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),s=()=>M(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new _l({reason:Un.CLIENT_INITIATED,action:Sr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Yn({scenario:{case:"subscriberBandwidth",value:js(n)}});break;case"leave-full-reconnect":r=new Yn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield s())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return M(this,arguments,void 0,function(s,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,c,d,u,h,p,m;let x=!0,g=!1;const y=a?{exact:r}:r;if(s==="audioinput"){g=o.localParticipant.audioTrackPublications.size===0;const v=(l=o.getActiveDevice(s))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=y;const k=Array.from(o.localParticipant.audioTrackPublications.values()).filter(w=>w.source===q.Source.Microphone);try{x=(yield Promise.all(k.map(w=>{var b;return(b=w.audioTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(w=>w===!0)}catch(w){throw o.options.audioCaptureDefaults.deviceId=v,w}const S=k.some(w=>{var b,T;return(T=(b=w.track)===null||b===void 0?void 0:b.isMuted)!==null&&T!==void 0?T:!1});x&&S&&(g=!0)}else if(s==="videoinput"){g=o.localParticipant.videoTrackPublications.size===0;const v=(c=o.getActiveDevice(s))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=y;const k=Array.from(o.localParticipant.videoTrackPublications.values()).filter(w=>w.source===q.Source.Camera);try{x=(yield Promise.all(k.map(w=>{var b;return(b=w.videoTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(w=>w===!0)}catch(w){throw o.options.videoCaptureDefaults.deviceId=v,w}const S=k.some(w=>{var b,T;return(T=(b=w.track)===null||b===void 0?void 0:b.isMuted)!==null&&T!==void 0?T:!1});x&&S&&(g=!0)}else if(s==="audiooutput"){if(g=!0,!Md()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(d=yield Ut.getInstance().normalizeDeviceId("audiooutput",r))!==null&&d!==void 0?d:""),(u=(m=o.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const v=(h=o.getActiveDevice(s))!==null&&h!==void 0?h:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((p=o.audioContext)===null||p===void 0||p.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:r})))}catch(k){throw o.options.audioOutput.deviceId=v,k}}return g&&(o.localParticipant.activeDeviceMap.set(s,r),o.emit(Y.ActiveDeviceChanged,s,r)),x})()})}setupLocalParticipantEvents(){this.localParticipant.on(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(le.AttributesChanged,this.onLocalAttributesChanged).on(le.TrackMuted,this.onLocalTrackMuted).on(le.TrackUnmuted,this.onLocalTrackUnmuted).on(le.LocalTrackPublished,this.onLocalTrackPublished).on(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(le.MediaDevicesError,this.onMediaDevicesError).on(le.AudioStreamAcquired,this.startAudio).on(le.ChatMessage,this.onLocalChatMessageSent).on(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,s){if(this.state===He.Connecting||this.state===He.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,s),p()},p=()=>{this.off(Y.Reconnected,h),this.off(Y.Connected,h),this.off(Y.Disconnected,p)};this.once(Y.Reconnected,h),this.once(Y.Connected,h),this.once(Y.Disconnected,p);return}if(this.state===He.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=z_(n.id),o=r[0];let a=r[1],l=e.id;if(a&&a.startsWith("TR")&&(l=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!l.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(s);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}l=h}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(a,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:a,trackId:l}));let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={});const u=c.addSubscribedMediaTrack(e,l,n,s,d);u?.isEncrypted&&!this.e2eeManager&&this.emit(Y.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var s;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==He.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,l;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(le.AttributesChanged,this.onLocalAttributesChanged).off(le.TrackMuted,this.onLocalTrackMuted).off(le.TrackUnmuted,this.onLocalTrackUnmuted).off(le.LocalTrackPublished,this.onLocalTrackPublished).off(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(le.MediaDevicesError,this.onMediaDevicesError).off(le.AudioStreamAcquired,this.startAudio).off(le.ChatMessage,this.onLocalChatMessageSent).off(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),pn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=navigator.mediaDevices)===null||s===void 0||s.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(He.Disconnected),this.emit(Y.Disconnected,n)}}}handleParticipantDisconnected(e,n){var s;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(Y.ParticipantDisconnected,n),n.setDisconnected(),(s=this.localParticipant)===null||s===void 0||s.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,s,r,o,a){return M(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),a!==1){yield this.engine.publishRpcResponse(e,n,null,Ct.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(s);if(!l){yield this.engine.publishRpcResponse(e,n,null,Ct.builtIn("UNSUPPORTED_METHOD"));return}let c=null,d=null;try{const u=yield l({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});ph(u)>sv?(c=Ct.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(s))):d=u}catch(u){u instanceof Ct?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(s,". Returning APPLICATION_ERROR instead."),u),c=Ct.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,d,c)})}selectDefaultDevices(){return M(this,void 0,void 0,function*(){var e,n,s;const r=Ut.getInstance().previousDevices,o=yield Ut.getInstance().getDevices(void 0,!1),a=fn();if(a?.name==="Chrome"&&a.os!=="iOS")for(let c of o){const d=r.find(u=>u.deviceId===c.deviceId);d&&d.label!==""&&d.kind===c.kind&&d.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(Y.ActiveDeviceChanged,c.kind,c.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let c of l){const d=E_(c),u=this.localParticipant.getTrackPublication(d);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const h=o.filter(m=>m.kind===c),p=this.getActiveDevice(c);if(p===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((s=h[0])===null||s===void 0?void 0:s.deviceId)!==p){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!zo()||c==="videoinput"||h.length>0&&!h.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!zo())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return M(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Kb())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Kt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const s=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";s!==this.canPlaybackAudio&&(this.audioEnabled=s,this.emit(Y.AudioPlaybackStatusChanged,s))})}createParticipant(e,n){var s;let r;return n?r=sl.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new sl(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const s=this.createParticipant(e,n);return this.remoteParticipants.set(e,s),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(Y.ParticipantConnected,s),s.on(le.TrackPublished,r=>{this.emitWhenConnected(Y.TrackPublished,r,s)}).on(le.TrackSubscribed,(r,o)=>{r.kind===q.Kind.Audio?(r.on(ie.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(ie.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===q.Kind.Video&&(r.on(ie.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(ie.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Y.TrackSubscribed,r,o,s)}).on(le.TrackUnpublished,r=>{this.emit(Y.TrackUnpublished,r,s)}).on(le.TrackUnsubscribed,(r,o)=>{this.emit(Y.TrackUnsubscribed,r,o,s)}).on(le.TrackMuted,r=>{this.emitWhenConnected(Y.TrackMuted,r,s)}).on(le.TrackUnmuted,r=>{this.emitWhenConnected(Y.TrackUnmuted,r,s)}).on(le.ParticipantMetadataChanged,r=>{this.emitWhenConnected(Y.ParticipantMetadataChanged,r,s)}).on(le.ParticipantNameChanged,r=>{this.emitWhenConnected(Y.ParticipantNameChanged,r,s)}).on(le.AttributesChanged,r=>{this.emitWhenConnected(Y.ParticipantAttributesChanged,r,s)}).on(le.ConnectionQualityChanged,r=>{this.emitWhenConnected(Y.ConnectionQualityChanged,r,s)}).on(le.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(Y.ParticipantPermissionsChanged,r,s)}).on(le.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(Y.TrackSubscriptionStatusChanged,r,o,s)}).on(le.TrackSubscriptionFailed,(r,o)=>{this.emit(Y.TrackSubscriptionFailed,r,s,o)}).on(le.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(Y.TrackSubscriptionPermissionChanged,r,o,s)}).on(le.Active,()=>{this.emitWhenConnected(Y.ParticipantActive,s),s.kind===Po.AGENT&&this.localParticipant.setActiveAgent(s)}),n&&s.updateInfo(n),s}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((s,r)=>(s.push(...r.getTrackPublications()),s),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Y_(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=qt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Un.STATE_MISMATCH))):e=0},g4)}clearConnectionReconcile(){this.connectionReconcileInterval&&qt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(Y.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,s]=e;this.emit(n,...s)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];if(this.state===He.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,s]);else if(this.state===He.Connected)return this.emit(e,...s);return!1}simulateParticipants(e){return M(this,void 0,void 0,function*(){var n,s;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new El({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ut.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Fs({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Y.SignalConnected),this.emit(Y.Connected),this.setAndEmitConnectionState(He.Connected),r.video){const a=new Bd(q.Kind.Video,new pr({source:Rt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO,name:"video-dummy"}),new il(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:gg(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(le.LocalTrackPublished,a)}if(r.audio){const a=new Bd(q.Kind.Audio,new pr({source:Rt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO}),new nl(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:vc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(le.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let l=new Fs({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:vr.ACTIVE,tracks:[],joinedAt:ut.parse(Date.now())});const c=this.getOrCreateParticipant(l.identity,l);if(o.video){const d=gg(160*((s=o.aspectRatios[a%o.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),u=new pr({source:Rt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}if(o.audio){const d=vc(),u=new pr({source:Rt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}c.updateInfo(l)}})}emit(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];if(e!==Y.ActiveSpeakersChanged&&e!==Y.TranscriptionReceived){const o=pv(s).filter(a=>a!==void 0);(e===Y.TrackSubscribed||e===Y.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...s)}}Dr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function pv(t){return t.map(e=>{if(e)return Array.isArray(e)?pv(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Bn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Bn||(Bn={}));class bs extends fi.EventEmitter{constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Bn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Dr(s.roomOptions),this.connectOptions=s.connectOptions,this.options=s}run(e){return M(this,void 0,void 0,function*(){if(this.status!==Bn.IDLE)throw Error("check is running already");this.setStatus(Bn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Bn.SKIPPED&&this.setStatus(this.isSuccess()?Bn.SUCCESS:Bn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return M(this,void 0,void 0,function*(){return this.room.state===He.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return M(this,void 0,void 0,function*(){this.room&&this.room.state!==He.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Bn.SKIPPED)}switchProtocol(e){return M(this,void 0,void 0,function*(){let n=!1,s=!1;if(this.room.on(Y.Reconnecting,()=>{n=!0}),this.room.once(Y.Reconnected,()=>{s=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(s)return;yield Kt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class m4 extends bs{get description(){return"Cloud regions"}perform(){return M(this,void 0,void 0,function*(){const e=new $e(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],s=new Set;for(let o=0;o<3;o++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(s.has(a))continue;s.add(a);const l=yield this.checkCloudRegion(a);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),n.push(l)}n.sort((o,a)=>(o.duration-a.duration)*.5+(o.rtt-a.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return M(this,void 0,void 0,function*(){var n,s;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,c=1e6/a,d="A".repeat(a),u=Date.now();for(let x=0;x<c;x++)yield o.write(d);yield o.close();const h=Date.now(),p=yield(s=this.room.engine.pcManager)===null||s===void 0?void 0:s.publisher.getStats(),m={region:r,rtt:1e4,duration:h-u};return p?.forEach(x=>{x.type==="candidate-pair"&&x.nominated&&(m.rtt=x.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const Rc=1e4;class x4 extends bs{get description(){return"Connection via UDP vs TCP"}perform(){return M(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const s=this.bestStats;this.appendMessage("upstream bitrate: ".concat((s.bitrateTotal/s.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((s.rttTotal/s.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((s.jitterTotal/s.count*1e3).toFixed(2)," ms")),s.packetsLost>0&&this.appendWarning("packets lost: ".concat((s.packetsLost/s.packetsSent*100).toFixed(2),"%")),s.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((s.qualityLimitationDurations.bandwidth/(Rc/1e3)*100).toFixed(2),"%")),s.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((s.qualityLimitationDurations.cpu/(Rc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return M(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const s=n.getContext("2d");if(!s)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,s.fillStyle="hsl(".concat(r,", 100%, 50%)"),s.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const l=n.captureStream(30).getVideoTracks()[0],d=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>M(this,void 0,void 0,function*(){const p=yield d.getRTCStatsReport();p?.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(p=>setTimeout(p,Rc)),clearInterval(h),l.stop(),n.remove(),yield this.disconnect(),u})}}class y4 extends bs{get description(){return"Can publish audio"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect(),s=yield uv();if(yield qb(s,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(s),yield new Promise(l=>setTimeout(l,3e3));const o=yield(e=s.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let a=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(a=l.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class b4 extends bs{get description(){return"Can publish video"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect(),s=yield d4();yield this.checkForVideo(s.mediaStreamTrack),n.localParticipant.publishTrack(s),yield new Promise(a=>setTimeout(a,5e3));const r=yield(e=s.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(o+=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return M(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const s=document.createElement("video");s.srcObject=n,s.muted=!0,s.autoplay=!0,s.playsInline=!0,s.setAttribute("playsinline","true"),document.body.appendChild(s),yield new Promise(r=>{s.onplay=()=>{setTimeout(()=>{var o,a,l,c;const d=document.createElement("canvas"),u=e.getSettings(),h=(a=(o=u.width)!==null&&o!==void 0?o:s.videoWidth)!==null&&a!==void 0?a:1280,p=(c=(l=u.height)!==null&&l!==void 0?l:s.videoHeight)!==null&&c!==void 0?c:720;d.width=h,d.height=p;const m=d.getContext("2d");m.drawImage(s,0,0);const g=m.getImageData(0,0,d.width,d.height).data;let y=!0;for(let v=0;v<g.length;v+=4)if(g[v]!==0||g[v+1]!==0||g[v+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},s.play()}),n.getTracks().forEach(r=>r.stop()),s.remove()})}}class v4 extends bs{get description(){return"Resuming connection after interruption"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect();let s=!1,r=!1,o;const a=new Promise(d=>{setTimeout(d,5e3),o=d}),l=()=>{s=!0};n.on(Y.SignalReconnecting,l).on(Y.Reconnecting,l).on(Y.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,s){if(!r||n.state!==He.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class S4 extends bs{get description(){return"Can connect via TURN"}perform(){return M(this,void 0,void 0,function*(){var e,n,s;Pr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new $e(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new lh,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let a=!1,l=!1,c=!1;for(let d of o.iceServers)for(let u of d.urls)u.startsWith("turn:")?(l=!0,c=!0):u.startsWith("turns:")&&(l=!0,c=!0,a=!0),u.startsWith("stun:")&&(c=!0);c?l&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((s=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||s===void 0)&&s.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(d=>setTimeout(d,0)))})}}class k4 extends bs{get description(){return"Establishing WebRTC connection"}perform(){return M(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(Y.SignalConnected,()=>{var s;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,a)=>{if(o.candidate){const l=new RTCIceCandidate(o);let c="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(w4(l.address)?c+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,c+=" (passive)"):l.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(o,a)},!((s=this.room.engine.pcManager)===null||s===void 0)&&s.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),Ae.info("now the room is connected")}catch(s){throw this.appendWarning("ports need to be open on firewall in order to connect."),s}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function w4(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class C4 extends bs{get description(){return"Connecting to signal connection via WebSocket"}perform(){return M(this,void 0,void 0,function*(){var e,n,s;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new lh,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(a){if(Pr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const c=yield new $e(this.url,this.token).getNextBestRegionUrl();c&&(o=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Xy.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((s=o.serverInfo)===null||s===void 0?void 0:s.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class ZN extends fi.EventEmitter{constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=s}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Bn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Bn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return M(this,void 0,void 0,function*(){const n=this.getNextCheckId(),s=new e(this.url,this.token,this.options),r=a=>{this.updateCheck(n,a)};s.on("update",r);const o=yield s.run();return s.off("update",r),o})}checkWebsocket(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(C4)})}checkWebRTC(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(k4)})}checkTURN(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(S4)})}checkReconnect(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(v4)})}checkPublishAudio(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(y4)})}checkPublishVideo(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(b4)})}checkConnectionProtocol(){return M(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(x4);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(m4)})}}function ze(t,e,n){return(e=T4(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function j4(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function T4(t){var e=j4(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class ln extends Error{constructor(e,n){var s;super(e,n),ze(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(s=Error.captureStackTrace)===null||s===void 0||s.call(Error,this,this.constructor)}}ze(ln,"code","ERR_JOSE_GENERIC");class E4 extends ln{constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:s,reason:r,payload:n}}),ze(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ze(this,"claim",void 0),ze(this,"reason",void 0),ze(this,"payload",void 0),this.claim=s,this.reason=r,this.payload=n}}ze(E4,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class I4 extends ln{constructor(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:s,reason:r,payload:n}}),ze(this,"code","ERR_JWT_EXPIRED"),ze(this,"claim",void 0),ze(this,"reason",void 0),ze(this,"payload",void 0),this.claim=s,this.reason=r,this.payload=n}}ze(I4,"code","ERR_JWT_EXPIRED");class R4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ze(R4,"code","ERR_JOSE_ALG_NOT_ALLOWED");class A4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ze(A4,"code","ERR_JOSE_NOT_SUPPORTED");class _4 extends ln{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ze(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ze(_4,"code","ERR_JWE_DECRYPTION_FAILED");class M4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JWE_INVALID")}}ze(M4,"code","ERR_JWE_INVALID");class P4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JWS_INVALID")}}ze(P4,"code","ERR_JWS_INVALID");class D4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JWT_INVALID")}}ze(D4,"code","ERR_JWT_INVALID");class N4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JWK_INVALID")}}ze(N4,"code","ERR_JWK_INVALID");class z4 extends ln{constructor(){super(...arguments),ze(this,"code","ERR_JWKS_INVALID")}}ze(z4,"code","ERR_JWKS_INVALID");class L4 extends ln{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ze(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ze(L4,"code","ERR_JWKS_NO_MATCHING_KEY");class O4 extends ln{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ze(this,Symbol.asyncIterator,void 0),ze(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ze(O4,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class B4 extends ln{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ze(this,"code","ERR_JWKS_TIMEOUT")}}ze(B4,"code","ERR_JWKS_TIMEOUT");class F4 extends ln{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ze(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ze(F4,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Ii(){return Ii=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ii.apply(null,arguments)}const Bg=new Uint8Array(0);class Oo{static getFullOptions(e){return Ii({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var s=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){s.status!=="connected"&&s.status!=="connecting"||(s.updateStatus("disconnecting"),await s.handleEndSession(),s.updateStatus("disconnected"),s.options.onDisconnect&&s.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void s.handleInterruption(r);case"agent_response":return void s.handleAgentResponse(r);case"user_transcript":return void s.handleUserTranscript(r);case"internal_tentative_agent_response":return void s.handleTentativeAgentResponse(r);case"client_tool_call":try{await s.handleClientToolCall(r)}catch(o){s.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void s.handleAudio(r);case"vad_score":return void s.handleVadScore(r);case"ping":return void s.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void s.handleMCPToolCall(r);case"mcp_connection_status":return void s.handleMCPConnectionStatus(r);case"agent_tool_request":return void s.handleAgentToolRequest(r);case"agent_tool_response":return void s.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void s.handleConversationMetadata(r);case"asr_initiation_metadata":return void s.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void s.handleAgentChatResponsePart(r);case"error":return void s.handleErrorEvent(r);default:return void(s.options.onDebug&&s.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const s=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof s=="object"?JSON.stringify(s):String(s);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(s){this.onError(`Client tool execution failed with following error: ${s?.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${s?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,s=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${s}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:s,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Bg}getOutputByteFrequencyData(){return Bg}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let fv=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function rl(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const s=Number.parseInt(n);if(Number.isNaN(s))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:s}}const gv="0.12.0";function Fd(t){return!!t.type}const mv="conversation_initiation_client_data";function xv(t){var e;const n={type:mv};var s,r,o,a,l;return t.overrides&&(n.conversation_config_override={agent:{prompt:(s=t.overrides.agent)==null?void 0:s.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(a=t.overrides.tts)==null?void 0:a.voiceId},conversation:{text_only:(l=t.overrides.conversation)==null?void 0:l.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let Wd=class yv extends fv{constructor(e,n,s,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=s,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const a=JSON.parse(o.data);if(!Fd(a))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(a)}catch(a){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:a instanceof Error?a.message:String(a),data:o.data})}})}static async create(e){let n=null;try{var s,r,o;const l=(s=e.origin)!=null?s:"wss://api.elevenlabs.io";let c;const d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||gv,u=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const k=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${k}source=${u}&version=${d}`}else c=`${l}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${d}`;const h=["convai"];e.authorization&&h.push(`bearer.${e.authorization}`),n=new WebSocket(c,h);const p=await new Promise((k,S)=>{n.addEventListener("open",()=>{var w;const b=xv(e);(w=n)==null||w.send(JSON.stringify(b))},{once:!0}),n.addEventListener("error",w=>{setTimeout(()=>S(w),0)}),n.addEventListener("close",S),n.addEventListener("message",w=>{const b=JSON.parse(w.data);Fd(b)&&(b.type==="conversation_initiation_metadata"?k(b.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:m,agent_output_audio_format:x,user_input_audio_format:g}=p,y=rl(g??"pcm_16000"),v=rl(x);return new yv(n,m,y,v)}catch(l){var a;throw(a=n)==null||a.close(),l}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function bv(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function W4(t){const e=window.atob(t),n=e.length,s=new Uint8Array(n);for(let r=0;r<n;r++)s[r]=e.charCodeAt(r);return s.buffer}const da=new Map;function vv(t,e){return async(n,s)=>{const r=da.get(t);if(r)return n.addModule(r);if(s)try{return await n.addModule(s),void da.set(t,s)}catch(l){throw new Error(`Failed to load the ${t} worklet module from path: ${s}. Error: ${l}`)}const o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o);try{return await n.addModule(a),void da.set(t,a)}catch{URL.revokeObjectURL(a)}try{const l=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(l),da.set(t,l)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const Sv=vv("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class wi extends fv{constructor(e,n,s,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=s,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var s,r,o;const d=((s=e.overrides)==null||(s=s.client)==null?void 0:s.version)||gv,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",h=`${a=(o=e.origin)!=null?o:"https://api.elevenlabs.io",a.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${d}`,p=await fetch(h);if(!p.ok)throw new Error(`ElevenLabs API returned ${p.status} ${p.statusText}`);if(n=(await p.json()).token,!n)throw new Error("No conversation token received from API")}catch(d){let u=d instanceof Error?d.message:String(d);throw d instanceof Error&&d.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var a;const l=new Dr;try{const d=`room_${Date.now()}`,u=rl("pcm_48000"),h=rl("pcm_48000"),p=new wi(l,d,u,h,e),m=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await l.connect(m,n),await new Promise(g=>{if(p.isConnected)g();else{const y=()=>{l.off(Y.Connected,y),g()};l.on(Y.Connected,y)}}),l.name&&(p.conversationId=((c=l.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||l.name),await l.localParticipant.setMicrophoneEnabled(!0);const x=xv(e);return p.debug({type:mv,message:x}),await p.sendMessage(x),p}catch(d){throw await l.disconnect(),d}}setupRoomEventListeners(){var e=this;this.room.on(Y.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(Y.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(Y.ConnectionStateChanged,n=>{n===He.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(Y.DataReceived,(n,s)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;Fd(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(Y.TrackSubscribed,async function(n,s,r){if(n.kind===q.Kind.Audio&&r.identity.includes("agent")){const o=n,a=o.attach();if(a.autoplay=!0,a.controls=!1,e.outputDeviceId&&a.setSinkId)try{await a.setSinkId(e.outputDeviceId)}catch(l){console.warn("Failed to set output device for new audio element:",l)}a.style.display="none",document.body.appendChild(a),e.audioElements.push(a),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(Y.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(Y.ParticipantDisconnected,n=>{var s;(s=n.identity)!=null&&s.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(q.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const s=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(s);r.connect(this.outputAnalyser),await Sv(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=a=>{const[l,c]=a.data;if(c>.01){const d=bv(l.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:d,event_id:u}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(s){try{await s.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(q.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const s={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await uv(s);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:q.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(s){console.error("Failed to recover microphone after device switch error:",s)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function kv(t){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(t);switch(e){case"websocket":return Wd.create(t);case"webrtc":return wi.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function $d(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function wv(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if($d()){var s;e=(s=t.ios)!=null?s:e}e>0&&await new Promise(r=>setTimeout(r,e))}class mh extends Oo{static async startSession(e){const n=Oo.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let s=null;try{return await wv(n.connectionDelay),s=await kv(e),new mh(n,s)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=s)==null||r.close(),o}}}const Fg={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class Er{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:s,inputDeviceId:r,workletPaths:o,libsampleratePath:a}){let l=null,c=null;try{const h=Ii({sampleRate:{ideal:e}},Fg);if($d()&&s){const v=(await window.navigator.mediaDevices.enumerateDevices()).find(k=>k.kind==="audioinput"&&["airpod","headphone","earphone"].find(S=>k.label.toLowerCase().includes(S)));v&&(h.deviceId={ideal:v.deviceId})}r&&(h.deviceId=Er.getDeviceIdConstraint(r));const p=navigator.mediaDevices.getSupportedConstraints().sampleRate;l=new window.AudioContext(p?{sampleRate:e}:{});const m=l.createAnalyser();if(!p){const v=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await l.audioWorklet.addModule(v)}await Sv(l.audioWorklet,o?.rawAudioProcessor);const x=Ii({voiceIsolation:!0},h);c=await navigator.mediaDevices.getUserMedia({audio:x});const g=l.createMediaStreamSource(c),y=new AudioWorkletNode(l,"rawAudioProcessor");return y.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(m),m.connect(y),await l.resume(),new Er(l,m,y,c,g)}catch(h){var d,u;throw(d=c)==null||d.getTracks().forEach(p=>{p.stop()}),(u=l)==null||u.close(),h}}static getDeviceIdConstraint(e){if(e)return $d()?{ideal:e}:{exact:e}}constructor(e,n,s,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=s,this.inputStream=r,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=Ii({},Fg);e&&(n.deviceId=Er.getDeviceIdConstraint(e));const s=Ii({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:s});this.inputStream.getTracks().forEach(o=>{o.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const $4=vv("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class ol{static async create({sampleRate:e,format:n,outputDeviceId:s,workletPaths:r}){let o=null,a=null;try{o=new AudioContext({sampleRate:e});const d=o.createAnalyser(),u=o.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const h=o.createMediaStreamDestination();a.srcObject=h.stream,u.connect(d),d.connect(h),await $4(o.audioWorklet,r?.audioConcatProcessor);const p=new AudioWorkletNode(o,"audioConcatProcessor");return p.port.postMessage({type:"setFormat",format:n}),p.connect(u),await o.resume(),s&&a.setSinkId&&await a.setSinkId(s),new ol(o,d,u,p,a)}catch(d){var l,c;throw(l=a)!=null&&l.parentNode&&a.parentNode.removeChild(a),(c=a)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),d}}constructor(e,n,s,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=s,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class xh extends Oo{static async startSession(e){var n;const s=Oo.getFullOptions(e);s.onStatusChange&&s.onStatusChange({status:"connecting"}),s.onCanSendFeedbackChange&&s.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,a=null,l=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var d;return l=await navigator.mediaDevices.getUserMedia({audio:!0}),await wv(s.connectionDelay),o=await kv(e),[r,a]=await Promise.all([Er.create(Ii({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),ol.create(Ii({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(d=l)==null||d.getTracks().forEach(g=>{g.stop()}),l=null,new xh(s,o,r,a,c)}catch(g){var u,h,p,m;s.onStatusChange&&s.onStatusChange({status:"disconnected"}),(u=l)==null||u.getTracks().forEach(y=>{y.stop()}),(h=o)==null||h.close(),await((p=r)==null?void 0:p.close()),await((m=a)==null?void 0:m.close());try{var x;await((x=c)==null?void 0:x.release()),c=null}catch{}throw g}}constructor(e,n,s,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:bv(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:W4(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=a=>{if(a.length===0)return 0;let l=0;for(let c=0;c<a.length;c++)l+=a[c]/255;return l/=a.length,l<0?0:l>1?1:l},this.setVolume=({volume:a})=>{const l=Number.isFinite(a)?Math.min(1,Math.max(0,a)):1;this.volume=l,this.connection instanceof wi?this.connection.setAudioVolume(l):this.output.gain.gain.value=l},this.input=s,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,s;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(s=this.options).onAudio)==null||n.call(s,e.audio_event.audio_base_64),this.connection instanceof wi||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof wi?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof wi?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:s,inputDeviceId:r}){try{if(this.connection instanceof Wd)try{return await this.input.setInputDevice(r),this.input}catch(a){console.warn("Failed to change device on existing input, recreating:",a)}this.connection instanceof wi&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await Er.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:s,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:s}){try{if(this.connection instanceof Wd)try{return await this.output.setOutputDevice(s),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof wi&&await this.connection.setAudioOutputDevice(s||""),await this.output.close();const r=await ol.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:s,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var Wg;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(Wg||(Wg={}));var $g,Ug;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})($g||($g={})),(function(t){t.MANUAL="manual",t.VAD="vad"})(Ug||(Ug={}));class U4 extends Oo{static startSession(e){return e.textOnly?mh.startSession(e):xh.startSession(e)}}function xo(){return xo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)({}).hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},xo.apply(null,arguments)}const V4=["micMuted","volume","serverLocation"];function G4(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function H4(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function q4(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function K4(t={}){const{micMuted:e,volume:n,serverLocation:s}=t,r=(function(g,y){if(g==null)return{};var v={};for(var k in g)if({}.hasOwnProperty.call(g,k)){if(y.indexOf(k)!==-1)continue;v[k]=g[k]}return v})(t,V4),o=f.useRef(null),a=f.useRef(null),[l,c]=f.useState("disconnected"),[d,u]=f.useState(!1),[h,p]=f.useState("listening"),m=f.useRef(e),x=f.useRef(n);return m.current=e,x.current=n,f.useEffect(()=>{var g;e!==void 0&&(o==null||(g=o.current)==null||g.setMicMuted(e))},[e]),f.useEffect(()=>{var g;n!==void 0&&(o==null||(g=o.current)==null||g.setVolume({volume:n}))},[n]),f.useEffect(()=>()=>{var g;(g=o.current)==null||g.endSession()},[]),{startSession:async g=>{var y;if((y=o.current)!=null&&y.isOpen())return o.current.getId();if(a.current)return(await a.current).getId();try{var v,k,S,w,b,T,C,j,R,I;const A=G4(g?.serverLocation||s),L=H4(A),B=q4(A);return a.current=U4.startSession(xo({},r??{},g??{},{origin:L,livekitUrl:g?.livekitUrl||r?.livekitUrl||B,overrides:xo({},(v=r?.overrides)!=null?v:{},(k=g?.overrides)!=null?k:{},{client:xo({},(S=r==null||(w=r.overrides)==null?void 0:w.client)!=null?S:{},(b=g==null||(T=g.overrides)==null?void 0:T.client)!=null?b:{},{source:(g==null||(C=g.overrides)==null||(C=C.client)==null?void 0:C.source)||(r==null||(j=r.overrides)==null||(j=j.client)==null?void 0:j.source)||"react_sdk",version:(g==null||(R=g.overrides)==null||(R=R.client)==null?void 0:R.version)||(r==null||(I=r.overrides)==null||(I=I.client)==null?void 0:I.version)||"0.12.1"})}),onConnect:g?.onConnect||r?.onConnect,onDisconnect:g?.onDisconnect||r?.onDisconnect,onError:g?.onError||r?.onError,onMessage:g?.onMessage||r?.onMessage,onAudio:g?.onAudio||r?.onAudio,onDebug:g?.onDebug||r?.onDebug,onUnhandledClientToolCall:g?.onUnhandledClientToolCall||r?.onUnhandledClientToolCall,onVadScore:g?.onVadScore||r?.onVadScore,onInterruption:g?.onInterruption||r?.onInterruption,onAgentToolRequest:g?.onAgentToolRequest||r?.onAgentToolRequest,onAgentToolResponse:g?.onAgentToolResponse||r?.onAgentToolResponse,onConversationMetadata:g?.onConversationMetadata||r?.onConversationMetadata,onMCPToolCall:g?.onMCPToolCall||r?.onMCPToolCall,onMCPConnectionStatus:g?.onMCPConnectionStatus||r?.onMCPConnectionStatus,onAsrInitiationMetadata:g?.onAsrInitiationMetadata||r?.onAsrInitiationMetadata,onAgentChatResponsePart:g?.onAgentChatResponsePart||r?.onAgentChatResponsePart,onModeChange:({mode:P})=>{var _;p(P),(_=g?.onModeChange||r?.onModeChange)==null||_({mode:P})},onStatusChange:({status:P})=>{var _;c(P),(_=g?.onStatusChange||r?.onStatusChange)==null||_({status:P})},onCanSendFeedbackChange:({canSendFeedback:P})=>{var _;u(P),(_=g?.onCanSendFeedbackChange||r?.onCanSendFeedbackChange)==null||_({canSendFeedback:P})}})),o.current=await a.current,m.current!==void 0&&o.current.setMicMuted(m.current),x.current!==void 0&&o.current.setVolume({volume:x.current}),o.current.getId()}finally{a.current=null}},endSession:async()=>{const g=o.current;o.current=null,await g?.endSession()},setVolume:({volume:g})=>{var y;(y=o.current)==null||y.setVolume({volume:g})},getInputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getOutputByteFrequencyData()},getInputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getInputVolume())!=null?g:0},getOutputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getOutputVolume())!=null?g:0},sendFeedback:g=>{var y;(y=o.current)==null||y.sendFeedback(g)},getId:()=>{var g;return(g=o.current)==null?void 0:g.getId()},sendContextualUpdate:g=>{var y;(y=o.current)==null||y.sendContextualUpdate(g)},sendUserMessage:g=>{var y;(y=o.current)==null||y.sendUserMessage(g)},sendUserActivity:()=>{var g;(g=o.current)==null||g.sendUserActivity()},sendMCPToolApprovalResult:(g,y)=>{var v;(v=o.current)==null||v.sendMCPToolApprovalResult(g,y)},changeInputDevice:async g=>{if(o.current&&"changeInputDevice"in o.current)return await o.current.changeInputDevice(g);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async g=>{if(o.current&&"changeOutputDevice"in o.current)return await o.current.changeOutputDevice(g);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:d,micMuted:e,isSpeaking:h==="speaking"}}const J4=({onMessage:t,onConnect:e,onDisconnect:n,onError:s})=>{const r=f.useRef(null),o=f.useRef(null),a=f.useRef(0),l=f.useRef(0),c=K4({onConnect:()=>{const g=Date.now();o.current=g,e?.()},onDisconnect:()=>{n?.()},onMessage:g=>{if(g.source==="ai"||g.source==="user"){const y=o.current,v=Date.now(),k=y?Math.floor((v-y)/1e3):0;let S;g.source==="ai"?(S=a.current,a.current=k,l.current=k):(S=l.current,a.current=k);const w=Math.floor(S/60),b=S%60,T=`${w.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`,C={role:g.source==="ai"?"agent":"user",text:g.message,timestamp:v,elapsedTime:S,timeLabel:T};t?.(C)}},onError:g=>{console.error(" [SDKAdapter] Error:",g),s?.(new Error(g.message||"Ein Fehler ist aufgetreten."))}}),d=f.useCallback(async g=>{const{agentId:y,scenario:v,variables:k,microphoneId:S}=g;o.current=null,a.current=0,l.current=0;const w=wy(k,v),b={agentId:y,connectionType:"websocket",dynamicVariables:w,...S&&{inputDeviceId:S},overrides:{agent:{prompt:{prompt:SR(v)},firstMessage:v?.initial_message||"Hallo! Ich freue mich auf unser Gesprch."},...v?.voice_id&&{tts:{voiceId:v.voice_id}}}};return v?.voice_id&&console.log("[SDKAdapter] Using voice override:",v.voice_id),r.current=await c.startSession(b),r.current},[c]),u=f.useCallback(()=>{c.status==="connected"&&c.endSession()},[c]),h=f.useCallback(()=>c.status,[c.status]),p=f.useCallback(()=>c.isSpeaking,[c.isSpeaking]),m=f.useCallback(()=>r.current,[]),x=f.useCallback(()=>o.current,[]);return{connect:d,disconnect:u,getStatus:h,isSpeaking:p,getConversationId:m,getStartTime:x,status:c.status,speaking:c.isSpeaking}},Y4=({onMessage:t,onConnect:e,onDisconnect:n,onError:s})=>{const[r,o]=f.useState("disconnected"),[a,l]=f.useState(!1),c=f.useRef(null),d=f.useRef(null),u=f.useRef(null),h=f.useRef(null),p=f.useRef(null),m=f.useRef([]),x=f.useRef(!1),g=f.useRef(0),y=f.useRef(null),v=f.useRef(null),k=f.useRef(!1);f.useEffect(()=>()=>{I()},[]);const S=f.useCallback(async(O,W)=>{try{const D=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});u.current=D;const N=D.createMediaStreamSource(O),F=D.createScriptProcessor(4096,1,1);p.current=F,F.onaudioprocess=ne=>{if(W.readyState!==WebSocket.OPEN||k.current)return;const re=ne.inputBuffer.getChannelData(0),Z=new Int16Array(re.length);for(let V=0;V<re.length;V++){const H=Math.max(-1,Math.min(1,re[V]));Z[V]=H<0?H*32768:H*32767}const ee=new Uint8Array(Z.buffer);let se="";for(let V=0;V<ee.length;V++)se+=String.fromCharCode(ee[V]);const z=btoa(se);W.send(JSON.stringify({user_audio_chunk:z}))},N.connect(F),F.connect(D.destination)}catch(D){console.error("[ProxyAdapter] Failed to start audio capture:",D)}},[]),w=f.useCallback(O=>{m.current.push(O),x.current||b()},[]),b=f.useCallback(async()=>{if(m.current.length===0){x.current=!1;return}x.current=!0;const O=m.current.shift();try{(!h.current||h.current.state==="closed")&&(h.current=new(window.AudioContext||window.webkitAudioContext),g.current=0);const D=h.current;D.state==="suspended"&&await D.resume();const N=new Int16Array(O),F=new Float32Array(N.length);for(let se=0;se<N.length;se++)F[se]=N[se]/32768;const ne=D.createBuffer(1,F.length,16e3);ne.getChannelData(0).set(F);const re=D.createBufferSource();re.buffer=ne,re.connect(D.destination);const Z=D.currentTime,ee=Math.max(Z,g.current);re.start(ee),g.current=ee+ne.duration,re.onended=()=>{b()}}catch(W){console.error("[ProxyAdapter] Audio playback error:",W),b()}},[]),T=f.useCallback((O,W,D)=>{if(O.data instanceof ArrayBuffer){w(O.data);return}try{const N=JSON.parse(O.data);switch(N.type){case"conversation_initiation_metadata":N.conversation_initiation_metadata_event?.conversation_id&&(y.current=N.conversation_initiation_metadata_event.conversation_id);const ne={type:"conversation_initiation_client_data",dynamic_variables:wy(D,W),conversation_config_override:{agent:{prompt:{prompt:io(W?.content||"")},first_message:W?.initial_message||"Hallo! Ich freue mich auf unser Gesprch."},...W?.voice_id&&{tts:{voice_id:W.voice_id}}}};if(console.log("[ProxyAdapter] Scenario:",W),console.log("[ProxyAdapter] voice_id:",W?.voice_id),console.log("[ProxyAdapter] initMessage:",JSON.stringify(ne,null,2)),W?.voice_id?console.log("[ProxyAdapter] Using voice override:",W.voice_id):console.log("[ProxyAdapter] No voice_id in scenario"),c.current?.readyState===WebSocket.OPEN){c.current.send(JSON.stringify(ne));const re=Date.now();v.current=re,o("connected"),e?.(),d.current&&S(d.current,c.current)}break;case"audio":if(N.audio_event?.audio_base_64){const re=atob(N.audio_event.audio_base_64),Z=new Uint8Array(re.length);for(let ee=0;ee<re.length;ee++)Z[ee]=re.charCodeAt(ee);w(Z.buffer)}break;case"agent_response":if(N.agent_response_event?.agent_response){const re=C("agent",N.agent_response_event.agent_response);t?.(re)}break;case"user_transcript":if(N.user_transcription_event?.user_transcript){const re=C("user",N.user_transcription_event.user_transcript);t?.(re)}break;case"interruption":m.current=[];break;case"ping":c.current?.readyState===WebSocket.OPEN&&c.current.send(JSON.stringify({type:"pong",event_id:N.ping_event?.event_id}));break;case"internal_vad_score":case"internal_turn_probability":case"internal_tentative_agent_response":break;case"error":console.error("[ProxyAdapter] Server error:",N),s?.(new Error(N.message||N.error_message||"Server-Fehler"));break;default:break}}catch(N){console.error("[ProxyAdapter] Message parse error:",N)}},[e,t,s,w,S]),C=f.useCallback((O,W)=>{if(!W||W.trim()==="")return null;const D=Date.now(),N=v.current?Math.floor((D-v.current)/1e3):0;return{role:O,text:W,timestamp:D,elapsedTime:N,timeLabel:yt(N)}},[]),j=f.useCallback(async O=>{const{agentId:W,scenario:D,variables:N,microphoneId:F}=O;o("connecting");try{const ne=await navigator.mediaDevices.getUserMedia({audio:{deviceId:F?{exact:F}:void 0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});d.current=ne;const re=`${vR}?agent_id=${W}`,Z=new WebSocket(re);return c.current=Z,Z.binaryType="arraybuffer",Z.onopen=()=>{},Z.onmessage=ee=>{T(ee,D,N)},Z.onclose=()=>{o("disconnected"),n?.()},Z.onerror=ee=>{console.error("[ProxyAdapter] WebSocket error:",ee),s?.(new Error("Verbindung zum Proxy fehlgeschlagen")),o("disconnected")},new Promise((ee,se)=>{const z=setTimeout(()=>{se(new Error("Connection timeout"))},3e4),V=setInterval(()=>{y.current&&(clearTimeout(z),clearInterval(V),ee(y.current))},100)})}catch(ne){throw console.error("[ProxyAdapter] Start failed:",ne),o("disconnected"),ne}},[T,n,s]),R=f.useCallback(()=>{I()},[]),I=f.useCallback(()=>{c.current&&(c.current.close(),c.current=null),p.current&&(p.current.disconnect(),p.current=null),u.current&&u.current.state!=="closed"&&(u.current.close().catch(()=>{}),u.current=null),h.current&&h.current.state!=="closed"&&(h.current.close().catch(()=>{}),h.current=null),d.current&&(d.current.getTracks().forEach(O=>O.stop()),d.current=null),m.current=[],x.current=!1,g.current=0,y.current=null,o("disconnected")},[]),A=f.useCallback(()=>r,[r]),L=f.useCallback(O=>{l(O),k.current=O,d.current&&d.current.getAudioTracks().forEach(W=>{W.enabled=!O})},[]),B=f.useCallback(()=>x.current||m.current.length>0,[]),P=f.useCallback(()=>y.current,[]),_=f.useCallback(()=>v.current,[]);return{connect:j,disconnect:R,getStatus:A,isSpeaking:B,setMuted:L,getConversationId:P,getStartTime:_,status:r,speaking:x.current,muted:a}};function X4({userRole:t="Bewerber",agentRole:e="Interviewer",agentProperties:n="",agentPainPoints:s="",transcriptHistory:r=[],nextAgentInput:o=""}){const a=r.slice(-4).map(l=>`${l.role==="agent"?e:t}: ${l.text}`).join(`
`);return`# SYSTEM ROLLE
Du bist die "Live-Coaching-Engine" der Karriereplattform "KarriereHeld".
Deine Aufgabe ist es, Echtzeit-Coaching whrend eines Gesprchs mit einem KI-Agenten zu liefern.

# INPUT DATEN

## Rolle des Users
${t}

## Rolle der KI (Gesprchspartner)
${e}

## Eigenschaften des KI-Agenten
${n||"Keine spezifischen Eigenschaften definiert"}

## Typische Einwnde/Pain Points des Agenten
${s||"Keine spezifischen Pain Points definiert"}

## Transkript-Historie (letzte Wechsel)
${a||"[Gesprch hat gerade begonnen]"}

## Nchste Aussage des Agenten (Vorschau)
"${o}"

# DEINE AUFGABE
Analysiere die nchste Aussage des Agenten und generiere sofort Coaching-Impulse fr den User.

# LOGIK & STRATEGIE
1. **Inhaltliche Brcke:** Was sollte der User inhaltlich antworten? Welche konkreten Punkte oder Beispiele sollte er/sie einbringen?

2. **Einwand-Vorwegnahme:** Prfe die Pain Points des Agenten. Wenn die Frage auch nur entfernt damit zu tun hat, gib dem User einen Tipp, wie er/sie diesen Einwand proaktiv entkrften kann.

3. **Verhalten (Soft Skills):** Gib einen Hinweis zum Tonfall und Auftreten, basierend auf den Eigenschaften des Agenten:
   - Bei "netter Typ"  offen, freundlich, persnlich
   - Bei "streng"  przise, faktenbasiert, strukturiert
   - Bei "kritisch"  selbstbewusst, konkrete Belege liefern

# OUTPUT REGELN
- Antworte AUSSCHLIESSLICH im JSON-Format
- Fasse dich extrem kurz (max. 3-4 Wrter pro Stichpunkt)
- KEINE ganzen Stze zum Vorlesen
- Sprache der Ausgabe: Deutsch
- Maximal 3 content_impulses

# JSON STRUKTUR (strikt einhalten!)
{
  "content_impulses": ["Stichpunkt 1", "Stichpunkt 2", "Stichpunkt 3"],
  "behavioral_cue": "Kurzer Tonfall-Hinweis",
  "strategic_bridge": "Strategischer Tipp zu Pain Points"
}

Antworte NUR mit dem JSON, keine Erklrungen davor oder danach.`}const Z4=["gemini-2.0-flash-exp","gemini-2.0-flash","gemini-1.5-flash-latest"],La={content_impulses:[],behavioral_cue:"",strategic_bridge:""};function Q4(t){let e=t.trim();e.startsWith("```json")?e=e.replace(/```json\n?/,"").replace(/\n?```$/,""):e.startsWith("```")&&(e=e.replace(/```\n?/,"").replace(/\n?```$/,""));try{const n=JSON.parse(e);return{content_impulses:Array.isArray(n.content_impulses)?n.content_impulses.slice(0,3):[],behavioral_cue:typeof n.behavioral_cue=="string"?n.behavioral_cue:"",strategic_bridge:typeof n.strategic_bridge=="string"?n.strategic_bridge:""}}catch(n){return console.error("[COACHING] Failed to parse response:",n),console.error("[COACHING] Raw response:",t),La}}function eP(t){return t.message?.includes("404")||t.message?.includes("not found")}async function tP({apiKey:t,nextAgentInput:e,transcriptHistory:n=[],scenarioContext:s={}}){const r="[COACHING]";if(!t)return console.error(`${r} API key is missing`),La;if(!e||e.trim().length===0)return La;const o=X4({userRole:s.userRole||"Bewerber",agentRole:s.agentRole||"Interviewer",agentProperties:s.agentProperties||"",agentPainPoints:s.agentPainPoints||"",transcriptHistory:n,nextAgentInput:e});for(const a of Z4)try{const h=(await(await new m0(t).getGenerativeModel({model:a}).generateContent(o)).response).text();return Q4(h)}catch(l){if(console.error(`${r} Error with ${a}:`,l.message),eP(l))continue;break}return console.error(`${r} All models failed, returning default coaching`),La}function nP(t){if(t.role!=="agent"||t.text.length<20)return!1;const e=["mhm","ja","okay","verstehe","interessant","gut"],n=t.text.toLowerCase().trim();return!e.some(s=>n===s)}function iP(t){const e=t.interviewer_profile||{};return{userRole:t.user_role_label||"Bewerber",agentRole:e.role||"Interviewer",agentProperties:e.properties||"",agentPainPoints:Array.isArray(e.typical_objections)?e.typical_objections.join(`
`):e.typical_objections||""}}const sP=({scenario:t,variables:e={},microphoneId:n,connectionMode:s=Qn.DIRECT,onNavigateToSession:r,onEnd:o})=>{const{demoCode:a}=qe(),[l,c]=f.useState(null),[d,u]=f.useState([]),[h,p]=f.useState(null),[m,x]=f.useState(!1),[g,y]=f.useState(!1),[v,k]=f.useState(null),[S,w]=f.useState(null),[b,T]=f.useState(0),[C,j]=f.useState(null),[R,I]=f.useState(!1),A=f.useRef([]),L=f.useRef(0),B=f.useRef(null),P=f.useCallback(z=>{z&&(u(V=>{const H=[...V,z];return A.current=H,H}),z.role==="agent"&&setTimeout(()=>{re(z.text,A.current)},100))},[]),_=f.useCallback(()=>{const z=Date.now();w(z),B.current=z},[]),O=f.useCallback(()=>{},[]),W=f.useCallback(z=>{console.error("[useRoleplaySession] Error:",z),p(z.message||"Ein Fehler ist aufgetreten.")},[]),D=J4({onMessage:P,onConnect:_,onDisconnect:O,onError:W}),N=Y4({onMessage:P,onConnect:_,onDisconnect:O,onError:W}),F=s===Qn.PROXY?N:D,ne=f.useMemo(()=>t?.agent_id||ce.getElevenLabsAgentId(),[t?.agent_id]);f.useEffect(()=>{let z=null;return F.status==="connected"&&S&&(z=setInterval(()=>{const V=Math.floor((Date.now()-S)/1e3);T(V),L.current=V},1e3)),()=>{z&&clearInterval(z)}},[F.status,S]);const re=f.useCallback(async(z,V)=>{const H=ce.getGeminiApiKey();if(!H){console.warn("[COACHING] No Gemini API key available");return}if(nP({role:"agent",text:z}))try{I(!0),j(null);const pe=await tP({apiKey:H,nextAgentInput:z,transcriptHistory:V.slice(-4),scenarioContext:iP(t)});j(pe)}catch(pe){console.error("[COACHING] Failed to generate coaching:",pe)}finally{I(!1)}},[t]),Z=f.useCallback(async()=>{try{x(!0),p(null);const z=ce.getCurrentUser(),V={agent_id:ne,scenario_id:t?.id>0?t.id:null,variables:e,user_name:z?.firstName||"Gast",demo_code:a||null,connection_mode:s},H=await j2(V);c(H.id);const pe=await F.connect({agentId:ne,scenario:t,variables:e,microphoneId:n,demoCode:a});console.log(`[useRoleplaySession] Connected via ${s}, conversation ID:`,pe),s===Qn.DIRECT&&ce.logPrompt("ELEVENLABS_LIVE_SESSION",`Live-Training gestartet: ${t?.title}`,t?.content||"",{scenario_id:t?.id,scenario_title:t?.title,agent_id:ne,voice_id:t?.voice_id,conversation_id:pe,connection_mode:s})}catch(z){console.error("[useRoleplaySession] Failed to start:",z),p(z.message||"Verbindung fehlgeschlagen."),x(!1)}},[ne,t,e,n,a,s,F]),ee=f.useCallback(async()=>{const z=F.getConversationId();F.disconnect();const V=B.current?Math.floor((Date.now()-B.current)/1e3):L.current;if(!l){console.error("[useRoleplaySession] No session ID"),o?.();return}if(A.current.length===0){p("Das Gesprch war zu kurz. Bitte versuche es erneut.");return}const H=async(pe,Te=500)=>{const Le=Date.now();k(pe),await new Promise(we=>setTimeout(we,Math.max(0,Te-(Date.now()-Le))))};try{y(!0),await H("audio",800);const pe={title:t?.title||"Live-Simulation",description:t?.description||"",variables:e,role_type:t?.role_type||"interview",user_role_label:t?.user_role_label||"Bewerber",interviewer_profile:t?.interviewer_profile,feedback_prompt:t?.feedback_prompt};let Te=null;if(l&&z)try{if(await C2(l,z),s===Qn.DIRECT)Te=await w2(l,10,3e3);else{const Qe=(await ce.saveAudioFromElevenLabs(z,l))?.data?.url;if(Qe)try{const ye=await fetch(Qe);ye.ok&&(Te=await ye.blob())}catch(ye){console.warn("[useRoleplaySession] Failed to fetch audio blob:",ye.message)}}}catch(we){console.warn("[useRoleplaySession] Could not fetch audio:",we.message)}await H("transcript",500);const Le=await b2(A.current,pe,Te,k);if(await H("saving",500),l&&z&&await S2(l,A.current,Le.feedbackContent,Le.audioAnalysisContent,V,z),y(!1),k(null),r&&l){const we={id:l,scenario_id:t?.id,transcript:JSON.stringify(A.current),feedback_json:Le.feedbackContent,audio_analysis_json:Le.audioAnalysisContent,duration:V,conversation_id:z,created_at:new Date().toISOString()};r(we)}}catch(pe){console.error("[useRoleplaySession] Analysis failed:",pe),p(pe.message||"Fehler bei der Analyse."),y(!1),k(null)}},[F,l,t,e,s,r]),se=f.useCallback(z=>{s===Qn.PROXY&&N.setMuted(z)},[s,N]);return{sessionId:l,transcript:d,error:h,isStarted:m,isAnalyzing:g,analysisStep:v,startTime:S,duration:b,dynamicCoaching:C,isCoachingGenerating:R,connectionMode:s,status:F.status,isSpeaking:F.speaking||!1,startSession:Z,endSession:ee,setMuted:se,clearError:()=>p(null)}},rP=({profile:t,replaceVariables:e=n=>n})=>{const[n,s]=f.useState({properties:!0,objections:!1,questions:!1}),r=Ge(),o=m=>{s(x=>({...x,[m]:!x[m]}))};if(!t||!t.name)return null;const a=m=>m?e(m).split(/\n|,/).map(g=>g.trim()).filter(Boolean):[],l=a(t.properties),c=a(t.typical_objections),d=a(t.important_questions),u={width:"100%",padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:E.slate[50],border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:`background-color ${r.transition.normal}`},h={...u,backgroundColor:r.primaryAccentLight},p={padding:r.space[4],backgroundColor:"white"};return i.jsxs("div",{style:{padding:r.space[4],display:"flex",flexDirection:"column",gap:r.space[2]},children:[l.length>0&&i.jsxs("div",{style:{border:`1px solid ${E.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>o("properties"),style:n.properties?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=E.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.properties?r.primaryAccentLight:E.slate[50],children:[i.jsx("span",{style:{fontWeight:600,color:E.slate[700]},children:"Eigenschaften"}),n.properties?i.jsx(ni,{style:{width:"20px",height:"20px",color:E.slate[500]}}):i.jsx(bt,{style:{width:"20px",height:"20px",color:E.slate[500]}})]}),n.properties&&i.jsx("div",{style:p,children:i.jsx("p",{style:{fontSize:r.fontSize.sm,color:E.slate[600],lineHeight:1.6,margin:0},children:l.join(", ")})})]}),c.length>0&&i.jsxs("div",{style:{border:`1px solid ${E.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>o("objections"),style:n.objections?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=E.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.objections?r.primaryAccentLight:E.slate[50],children:[i.jsx("span",{style:{fontWeight:600,color:E.slate[700]},children:"Typische Einwnde"}),n.objections?i.jsx(ni,{style:{width:"20px",height:"20px",color:E.slate[500]}}):i.jsx(bt,{style:{width:"20px",height:"20px",color:E.slate[500]}})]}),n.objections&&i.jsx("div",{style:p,children:i.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:c.map((m,x)=>i.jsxs("li",{style:{fontSize:r.fontSize.sm,color:E.slate[600],display:"flex",alignItems:"flex-start"},children:[i.jsx("span",{style:{marginRight:r.space[2]},children:""}),i.jsx("span",{children:m})]},x))})})]}),d.length>0&&i.jsxs("div",{style:{border:`1px solid ${E.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>o("questions"),style:n.questions?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=E.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.questions?r.primaryAccentLight:E.slate[50],children:[i.jsx("span",{style:{fontWeight:600,color:E.slate[700]},children:"Wichtige Fragen"}),n.questions?i.jsx(ni,{style:{width:"20px",height:"20px",color:E.slate[500]}}):i.jsx(bt,{style:{width:"20px",height:"20px",color:E.slate[500]}})]}),n.questions&&i.jsx("div",{style:p,children:i.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:d.map((m,x)=>i.jsxs("li",{style:{fontSize:r.fontSize.sm,color:E.slate[600],display:"flex",alignItems:"flex-start"},children:[i.jsx("span",{style:{marginRight:r.space[2]},children:""}),i.jsx("span",{children:m})]},x))})})]}),i.jsx("div",{style:{marginTop:r.space[4],padding:r.space[3],backgroundColor:r.primaryAccentLight,borderRadius:r.radius.lg,border:`1px solid ${r.primaryAccent}33`},children:i.jsx("p",{style:{fontSize:r.fontSize.xs,color:r.primaryAccent,textAlign:"center",margin:0},children:" Fr ein optimales Erlebnis empfiehlt sich die Nutzung von Kopfhrern mit Mikrofon."})})]})},oP=({hints:t,dynamicCoaching:e=null,isGenerating:n=!1,isConnected:s=!1})=>{const{branding:r}=qe(),o=r?.["--header-gradient"]||_e["--header-gradient"],a=r?.["--header-text"]||_e["--header-text"],l=r?.["--icon-primary"]||_e["--icon-primary"],c=r?.["--primary-accent-light"]||_e["--primary-accent-light"],u=(m=>m?m.split(/\n/).map(x=>x.trim()).filter(Boolean):[])(t),h=e&&(e.content_impulses&&e.content_impulses.length>0||e.behavioral_cue||e.strategic_bridge),p=s&&(h||n);return i.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden h-full flex flex-col min-h-0",children:[i.jsxs("div",{style:{background:o},className:"px-4 py-3 flex items-center gap-2 flex-shrink-0",children:[i.jsx(Be,{className:"w-5 h-5",style:{color:a}}),i.jsx("h3",{className:"font-bold text-sm",style:{color:a},children:"Live Coaching"}),n&&i.jsx(me,{className:"w-4 h-4 animate-spin ml-auto",style:{color:a}})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0",children:i.jsx(Ve,{mode:"wait",children:p?i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"space-y-4",children:n&&!h?i.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"text-center text-slate-400",children:[i.jsx(me,{className:"w-8 h-8 mx-auto mb-2 animate-spin"}),i.jsx("p",{className:"text-xs",children:"Analysiere..."})]})}):i.jsxs(i.Fragment,{children:[e?.content_impulses?.length>0&&i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-500 uppercase tracking-wide",children:[i.jsx(Ze,{className:"w-3.5 h-3.5"}),"Inhalt"]}),i.jsx("div",{className:"space-y-2",children:e.content_impulses.map((m,x)=>i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1+x*.05},className:"flex gap-2 items-start",children:[i.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:i.jsx("span",{className:"text-xs font-bold",style:{color:l},children:x+1})}),i.jsx("p",{className:"text-sm text-slate-700 leading-snug font-medium",children:m})]},x))})]}),e?.behavioral_cue&&i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.25},className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-amber-600 uppercase tracking-wide",children:[i.jsx(Sl,{className:"w-3.5 h-3.5"}),"Tonfall"]}),i.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg px-3 py-2",children:i.jsx("p",{className:"text-sm text-amber-800",children:e.behavioral_cue})})]}),e?.strategic_bridge&&i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.35},className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-emerald-600 uppercase tracking-wide",children:[i.jsx(rt,{className:"w-3.5 h-3.5"}),"Strategie"]}),i.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2",children:i.jsx("p",{className:"text-sm text-emerald-800",children:e.strategic_bridge})})]}),!h&&!n&&i.jsx("div",{className:"h-full flex items-center justify-center py-8",children:i.jsxs("div",{className:"text-center text-slate-400",children:[i.jsx(Be,{className:"w-10 h-10 mx-auto mb-2 opacity-40"}),i.jsx("p",{className:"text-xs",children:"Warte auf Gesprchspartner..."})]})})]})},"dynamic-coaching"):i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:u.length===0?i.jsx("div",{className:"h-full flex items-center justify-center py-8",children:i.jsxs("div",{className:"text-center text-slate-400",children:[i.jsx(Be,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),i.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]})}):i.jsx("div",{className:"space-y-3",children:u.map((m,x)=>i.jsxs($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:x*.1},className:"flex gap-3 items-start",children:[i.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:i.jsx(Be,{className:"w-3.5 h-3.5",style:{color:l}})}),i.jsx("div",{className:"flex-1",children:i.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:m})})]},x))})},"static-hints")})}),i.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-200 flex-shrink-0",children:i.jsx("p",{className:"text-xs text-slate-500 text-center",children:p?" Echtzeit-Coaching basierend auf dem Gesprch":" Hilfreiche Tipps fr ein erfolgreiches Gesprch"})})]})},yh=({isOpen:t,onClose:e,mode:n="audio",selectedMicrophoneId:s,onMicrophoneChange:r,selectedCameraId:o,onCameraChange:a})=>{const[l,c]=f.useState([]),[d,u]=f.useState([]),[h,p]=f.useState(!0),[m,x]=f.useState(null),[g,y]=f.useState(s),[v,k]=f.useState(o),S=Ge();f.useEffect(()=>{t&&(w(),y(s),k(o))},[t,s,o]);const w=async()=>{p(!0),x(null);try{const C=n==="audio-video"?{audio:!0,video:!0}:{audio:!0};(await navigator.mediaDevices.getUserMedia(C)).getTracks().forEach(L=>L.stop());const R=await navigator.mediaDevices.enumerateDevices(),I=R.filter(L=>L.kind==="audioinput"),A=R.filter(L=>L.kind==="videoinput");c(I),n==="audio-video"&&u(A)}catch(C){console.error("Error loading devices:",C),C.name==="NotAllowedError"||C.name==="PermissionDeniedError"?x("Zugriff auf Gerte verweigert"):x("Fehler beim Laden der Gerte")}finally{p(!1)}},b=()=>{g!==s&&r?.(g),n==="audio-video"&&v!==o&&a?.(v),e()},T=(C,j,R)=>{if(C.label){let I=C.label;return I=I.replace(/^Default - /,""),I=I.replace(/^Kommunikation - /,""),I=I.replace(/^Standard - /,""),I.length>40&&(I=I.substring(0,37)+"..."),I}return R==="audio"?`Mikrofon ${j+1}`:`Kamera ${j+1}`};return t?i.jsxs(i.Fragment,{children:[i.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3}}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",borderRadius:S.radius.xl,width:"90%",maxWidth:"480px",maxHeight:"80vh",overflow:"hidden",boxShadow:S.shadow.xl,zIndex:1001},onClick:C=>C.stopPropagation(),children:[i.jsxs("div",{style:{background:S.headerGradient,padding:`${S.space[4]} ${S.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:S.space["2.5"],color:"white"},children:[i.jsx(di,{size:20}),i.jsx("h3",{style:{margin:0,fontSize:S.fontSize.base,fontWeight:600},children:"Gerte-Einstellungen"})]}),i.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:S.radius.md,padding:S.space["1.5"],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Bt,{size:18,color:"white"})})]}),i.jsx("div",{style:{padding:S.space[5],maxHeight:"calc(80vh - 140px)",overflowY:"auto"},children:h?i.jsxs("div",{style:{textAlign:"center",padding:S.space[8]},children:[i.jsx("div",{style:{width:"40px",height:"40px",border:`3px solid ${E.slate[200]}`,borderTopColor:S.primaryAccent,borderRadius:"50%",animation:"spin 1s linear infinite",margin:`0 auto ${S.space[3]}`}}),i.jsx("p",{style:{color:E.slate[500],fontSize:S.fontSize.sm},children:"Gerte werden geladen..."}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):m?i.jsxs("div",{style:{textAlign:"center",padding:S.space[6]},children:[i.jsx(Ie,{size:40,color:E.red[500],style:{marginBottom:S.space[3]}}),i.jsx("p",{style:{color:E.red[600],fontWeight:500},children:m}),i.jsxs("button",{onClick:w,style:{marginTop:S.space[4],display:"inline-flex",alignItems:"center",gap:S.space[2],padding:`${S.space["2.5"]} ${S.space[4]}`,borderRadius:S.radius.md,border:`1px solid ${E.slate[300]}`,background:"white",cursor:"pointer",fontSize:S.fontSize.sm,color:E.slate[700]},children:[i.jsx(Ot,{size:16}),"Erneut versuchen"]})]}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:S.space[5]},children:[i.jsxs("div",{children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:S.space[2],fontSize:S.fontSize.sm,fontWeight:600,color:E.slate[700],marginBottom:S.space["2.5"]},children:[i.jsx(Ue,{size:18,color:S.primaryAccent}),"Mikrofon"]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:S.space["1.5"]},children:l.map((C,j)=>i.jsxs("button",{onClick:()=>y(C.deviceId),style:{display:"flex",alignItems:"center",gap:S.space[3],padding:`${S.space[3]} ${S.space["3.5"]}`,borderRadius:S.radius.md,border:g===C.deviceId?`2px solid ${S.primaryAccent}`:`1px solid ${E.slate[200]}`,background:g===C.deviceId?`${S.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:S.transition.normal},children:[i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:S.radius.md,background:g===C.deviceId?S.primaryAccent:E.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(Ue,{size:16,color:g===C.deviceId?"white":E.slate[500]})}),i.jsx("span",{style:{flex:1,fontSize:S.fontSize.sm,color:g===C.deviceId?S.primaryAccent:E.slate[700],fontWeight:g===C.deviceId?500:400},children:T(C,j,"audio")}),g===C.deviceId&&i.jsx(Pn,{size:18,color:S.primaryAccent})]},C.deviceId||j))}),g&&i.jsx("div",{style:{marginTop:S.space[3]},children:i.jsx(aR,{deviceId:g,branding:S})})]}),n==="audio-video"&&d.length>0&&i.jsxs("div",{children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:S.space[2],fontSize:S.fontSize.sm,fontWeight:600,color:E.slate[700],marginBottom:S.space["2.5"]},children:[i.jsx(jt,{size:18,color:S.primaryAccent}),"Kamera"]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:S.space["1.5"]},children:d.map((C,j)=>i.jsxs("button",{onClick:()=>k(C.deviceId),style:{display:"flex",alignItems:"center",gap:S.space[3],padding:`${S.space[3]} ${S.space["3.5"]}`,borderRadius:S.radius.md,border:v===C.deviceId?`2px solid ${S.primaryAccent}`:`1px solid ${E.slate[200]}`,background:v===C.deviceId?`${S.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:S.transition.normal},children:[i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:S.radius.md,background:v===C.deviceId?S.primaryAccent:E.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(jt,{size:16,color:v===C.deviceId?"white":E.slate[500]})}),i.jsx("span",{style:{flex:1,fontSize:S.fontSize.sm,color:v===C.deviceId?S.primaryAccent:E.slate[700],fontWeight:v===C.deviceId?500:400},children:T(C,j,"video")}),v===C.deviceId&&i.jsx(Pn,{size:18,color:S.primaryAccent})]},C.deviceId||j))})]})]})}),!h&&!m&&i.jsxs("div",{style:{padding:`${S.space[4]} ${S.space[5]}`,borderTop:`1px solid ${E.slate[200]}`,display:"flex",gap:S.space[3],justifyContent:"flex-end"},children:[i.jsx("button",{onClick:e,style:{padding:`${S.space["2.5"]} ${S.space[5]}`,borderRadius:S.radius.md,border:`1px solid ${E.slate[300]}`,background:"white",color:E.slate[600],fontSize:S.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),i.jsx("button",{onClick:b,style:{padding:`${S.space["2.5"]} ${S.space[5]}`,borderRadius:S.radius.md,border:"none",background:S.primaryAccent,color:"white",fontSize:S.fontSize.sm,fontWeight:600,cursor:"pointer"},children:"Speichern"})]})]})]}):null},Vg=({scenario:t,variables:e={},selectedMicrophoneId:n,connectionMode:s=Qn.DIRECT,onEnd:r,onNavigateToSession:o})=>{const{branding:a}=qe(),{transcript:l,error:c,isStarted:d,isAnalyzing:u,analysisStep:h,duration:p,dynamicCoaching:m,isCoachingGenerating:x,status:g,startSession:y,endSession:v,setMuted:k,clearError:S}=sP({scenario:t,variables:e,microphoneId:n,connectionMode:s,onNavigateToSession:o,onEnd:r}),[w,b]=f.useState(!1),[T,C]=f.useState(!1),[j,R]=f.useState(n),[I,A]=f.useState(!1),[L,B]=f.useState(!1),[P,_]=f.useState(!1),[O,W]=f.useState(!0),D=xn(1024),[N,F]=f.useState(0),ne=f.useRef(null),re=f.useRef(null),Z=f.useRef(null),ee=f.useRef(null),se=f.useRef(null),z=f.useMemo(()=>{const ye=a?.["--header-gradient"]||_e["--header-gradient"],Ee=a?.["--header-text"]||_e["--header-text"],Ke=a?.["--primary-accent"]||_e["--primary-accent"],Me=a?.["--primary-accent-light"]||_e["--primary-accent-light"],et=a?.["--icon-primary"]||_e["--icon-primary"];return{headerGradient:ye,headerText:Ee,primaryAccent:Ke,primaryAccentLight:Me,iconPrimary:et}},[a]),V=ye=>{if(!ye)return ye;let Ee=ye;return Object.entries(e).forEach(([Ke,Me])=>{const et=new RegExp(`\\{\\{${Ke}\\}\\}`,"g");Ee=Ee.replace(et,Me||"")}),Ee};f.useEffect(()=>{se.current&&se.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[l]);const H=async()=>{try{const ye=j?{audio:{deviceId:{exact:j}}}:{audio:!0},Ee=await navigator.mediaDevices.getUserMedia(ye);ee.current=Ee;const Ke=new(window.AudioContext||window.webkitAudioContext);ne.current=Ke;const Me=Ke.createAnalyser();Me.fftSize=256,Me.smoothingTimeConstant=.8,re.current=Me,Ke.createMediaStreamSource(Ee).connect(Me);const X=new Uint8Array(Me.frequencyBinCount),he=()=>{if(!re.current)return;re.current.getByteFrequencyData(X);const ue=X.reduce((gt,lt)=>gt+lt,0)/X.length;F(ue/255),Z.current=requestAnimationFrame(he)};he()}catch(ye){console.error("[RoleplaySession] Audio analysis error:",ye)}},pe=()=>{Z.current&&(cancelAnimationFrame(Z.current),Z.current=null),ne.current&&(ne.current.close(),ne.current=null),ee.current&&(ee.current.getTracks().forEach(ye=>ye.stop()),ee.current=null),F(0)};f.useEffect(()=>(g==="connected"?H():pe(),()=>pe()),[g]);const Te=async()=>{D&&B(!0),await y()},Le=()=>{b(!1),v()},we=()=>{const ye=!I;A(ye),k(ye)};if(!t)return i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:i.jsxs($.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[i.jsx(Ie,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Kein Szenario ausgewhlt"}),i.jsx("p",{className:"text-slate-600 mb-6",children:"Bitte whle zuerst ein Szenario aus."}),i.jsx(de,{onClick:r,className:"w-full",children:"Zur Szenario-Auswahl"})]})});if(c&&g==="disconnected"&&!u)return i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:i.jsxs($.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[i.jsx(Ie,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),i.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Verbindungsfehler"}),i.jsx("p",{className:"text-slate-600 mb-6",children:c}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(de,{onClick:r,variant:"outline",className:"flex-1",children:"Zurck"}),i.jsx(de,{onClick:()=>{S(),y()},className:"flex-1",children:"Erneut versuchen"})]})]})});const Qe={audio:{label:"Audio wird abgerufen...",progress:20},transcript:{label:"Transkript wird ausgewertet...",progress:50},audio_analysis:{label:"Sprechweise wird analysiert...",progress:75},saving:{label:"Ergebnisse werden gespeichert...",progress:90}};if(u){const ye=h?Qe[h]:{label:"Wird vorbereitet...",progress:5},Ee=["audio","transcript","audio_analysis","saving"],Ke=Ee.indexOf(h);return i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:i.jsxs($.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[i.jsx(me,{className:"w-16 h-16 animate-spin mx-auto mb-4",style:{color:z.primaryAccent}}),i.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Feedback wird generiert..."}),i.jsx($.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-slate-600 min-h-[24px]",children:ye.label},h),i.jsx("div",{className:"mt-6",children:i.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:i.jsx($.div,{className:"h-full",style:{background:z.headerGradient},initial:{width:"0%"},animate:{width:`${ye.progress}%`},transition:{duration:.5,ease:"easeOut"}})})}),i.jsx("div",{className:"mt-6 flex justify-center gap-2",children:Ee.map((Me,et)=>i.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-300 ${et<Ke?"bg-green-500":et===Ke?"bg-blue-500":"bg-slate-200"}`},Me))})]})})}return i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{height:"calc(100vh - 120px)",minHeight:"600px"},className:"bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-2 lg:p-4 overflow-hidden",children:[i.jsxs("div",{className:"w-full h-full gap-3 lg:gap-4 overflow-hidden",style:{display:D?"flex":"grid",flexDirection:D?"column":void 0,gridTemplateColumns:D?void 0:"minmax(250px, 1fr) minmax(350px, 2fr) minmax(250px, 1fr)",padding:"0 8px"},children:[!D&&i.jsx($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"relative h-full min-h-0",children:i.jsx(oP,{hints:t.coaching_hints,dynamicCoaching:m,isGenerating:x,isConnected:g==="connected"})}),i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col min-h-[400px] order-1 lg:order-none",children:[i.jsxs("div",{style:{background:z.headerGradient},className:"rounded-t-2xl px-4 lg:px-6 py-3 lg:py-4 shadow-xl",children:[s===Qn.PROXY&&i.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:i.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-white/20 rounded-full",children:[i.jsx(vT,{className:"w-3.5 h-3.5 text-white"}),i.jsx("span",{className:"text-xs font-medium text-white",children:"Proxy Modus"})]})}),i.jsx("div",{className:"flex items-center justify-center gap-4 mb-3",children:t.interviewer_profile?.image_url?i.jsx("img",{src:t.interviewer_profile.image_url,alt:V(t.interviewer_profile.name),style:{width:D?"64px":"80px",height:D?"64px":"80px",borderRadius:"50%",border:D?"3px solid white":"4px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",objectFit:"cover"}}):i.jsx("div",{style:{width:D?"64px":"80px",height:D?"64px":"80px",borderRadius:"50%",border:D?"3px solid white":"4px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",background:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Qt,{className:D?"w-8 h-8":"w-10 h-10",style:{color:"#94a3b8"}})})}),i.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-white text-center mb-1",children:V(t.interviewer_profile?.name)||t.title}),t.interviewer_profile?.role&&i.jsx("p",{className:"text-blue-100 text-center text-sm font-medium mb-3",children:V(t.interviewer_profile.role)}),d&&i.jsxs("div",{className:"flex items-center justify-center gap-3 pt-3 border-t border-white/20",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[g==="connecting"&&i.jsxs(i.Fragment,{children:[i.jsx(me,{className:"w-4 h-4 text-white animate-spin"}),i.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbinde..."})]}),g==="connected"&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"}),i.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbunden"})]})]}),i.jsx("div",{className:"h-4 w-px bg-white/30"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ye,{className:"w-4 h-4 text-white"}),i.jsx("span",{className:"font-mono text-sm font-semibold text-white",children:yt(p)})]})]})]}),i.jsxs("div",{className:"bg-white px-4 py-3 shadow-xl flex justify-center gap-3",children:[i.jsx("button",{onClick:()=>C(!0),className:"p-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-colors",title:"Gerte-Einstellungen",children:i.jsx(di,{className:"w-5 h-5 text-slate-600"})}),d?g==="connected"?i.jsxs(i.Fragment,{children:[s===Qn.PROXY&&i.jsx(de,{onClick:we,size:"lg",variant:I?"destructive":"outline",className:"rounded-xl",children:I?i.jsx(l0,{className:"w-5 h-5"}):i.jsx(Ue,{className:"w-5 h-5"})}),i.jsxs(de,{onClick:()=>b(!0),size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[i.jsx(uT,{className:"w-5 h-5 mr-2"}),"Gesprch beenden"]})]}):g==="connecting"?i.jsxs(de,{disabled:!0,size:"lg",className:"bg-slate-400 text-white font-semibold text-base py-6 px-8 rounded-xl",children:[i.jsx(me,{className:"w-5 h-5 mr-2 animate-spin"}),"Verbinde..."]}):null:i.jsxs(de,{onClick:Te,size:"lg",disabled:!j,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg disabled:opacity-50",children:[i.jsx(uo,{className:"w-5 h-5 mr-2"}),t.interviewer_profile?.name?`${V(t.interviewer_profile.name)} anrufen`:"Anrufen"]})]}),g==="connected"&&i.jsx("div",{className:"bg-white px-4 py-3 border-t border-slate-100",children:i.jsx(_r,{audioLevel:N,isActive:N>.05,variant:"bars",size:"md",accentColor:z.primaryAccent})}),D&&i.jsx("div",{style:{backgroundColor:"white",padding:"8px 16px"},children:i.jsxs("button",{onClick:()=>W(!O),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"14px",fontWeight:500,color:z.primaryAccent,backgroundColor:`${z.primaryAccent}10`,border:`1px solid ${z.primaryAccent}30`,borderRadius:"10px",padding:"12px 16px",cursor:"pointer"},children:[i.jsx("span",{children:"Profil-Details"}),i.jsx(bt,{size:16,style:{transform:O?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})}),i.jsx(Ve,{children:(O||!D)&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"lg:flex-1 lg:overflow-y-auto bg-white lg:rounded-b-2xl shadow-xl overflow-hidden",children:i.jsx(rP,{profile:t.interviewer_profile,replaceVariables:V})})})]}),!D&&i.jsx($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full min-h-0 overflow-hidden",children:i.jsxs("div",{className:"h-full min-h-0 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col",children:[i.jsx("div",{style:{background:z.headerGradient},className:"px-4 py-3 flex items-center flex-shrink-0",children:i.jsxs("div",{className:"flex items-center gap-2",style:{color:z.headerText},children:[i.jsx(Ze,{className:"w-4 h-4"}),i.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]})}),i.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-3",children:l.length===0?i.jsx("div",{className:"h-full flex items-center justify-center",children:i.jsxs("div",{className:"text-center text-slate-500",children:[i.jsx(Ze,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),i.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):i.jsxs(Ve,{children:[l.map((ye,Ee)=>i.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-2 ${ye.role==="user"?"flex-row-reverse":"flex-row"}`,children:[i.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[ye.role==="agent"?t.interviewer_profile?.image_url?i.jsx("img",{src:t.interviewer_profile.image_url,alt:"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:z.headerGradient},children:i.jsx(yl,{className:"w-4 h-4",style:{color:z.headerText}})}):i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:i.jsx(Qt,{className:"w-4 h-4 text-white"})}),ye.timeLabel&&i.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:ye.timeLabel})]}),i.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${ye.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:i.jsx("p",{className:"text-xs leading-relaxed",children:ye.text})})]},Ee)),i.jsx("div",{ref:se})]})})]})})]}),D&&i.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-3 z-50",children:[i.jsx($.button,{onClick:()=>B(!L),style:{background:z.headerGradient,color:z.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:i.jsx(Be,{className:"w-6 h-6"})}),i.jsxs($.button,{onClick:()=>_(!P),style:{background:z.headerGradient,color:z.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[i.jsx(Ze,{className:"w-6 h-6"}),l.length>0&&i.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:l.length})]})]})]}),i.jsx(ii,{open:w,onOpenChange:b,children:i.jsxs(si,{children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Gesprch beenden?"}),i.jsx(Pi,{children:"Mchtest du das Gesprch beenden? Du erhltst anschlieend dein Feedback."})]}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>b(!1),children:"Abbrechen"}),i.jsxs(de,{onClick:Le,children:[i.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Beenden & Feedback erhalten"]})]})]})}),i.jsx(yh,{isOpen:T,onClose:()=>C(!1),mode:"audio",selectedMicrophoneId:j,onMicrophoneChange:R})]})},aP={auftreten:o0,selbstbewusstsein:li,koerpersprache:Qt,kommunikation:Ze,professionalitaet:li,inhalt:Be},lP=(t,e)=>{const n=t;return n>=90?"Ausgezeichnet!":n>=80?"Sehr gut!":n>=70?"Gut!":n>=60?"Solide Leistung":n>=50?"Ausbaufhig":"Weiter ben!"},cP=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",dP=t=>t==="video"?"Wirkungs-Analyse":t==="roleplay"?"Live-Simulation":"Szenario-Training",uP=({score:t,size:e=120,primaryAccent:n,isHeader:s=!1,branding:r})=>{const o=Math.min(100,Math.max(0,t||0)),a=(e-12)/2,l=a*2*Math.PI,c=l-o/100*l,d=rn(t,n);return i.jsxs("div",{style:{position:"relative",width:e,height:e},children:[i.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[i.jsx("circle",{cx:e/2,cy:e/2,r:a,fill:"none",stroke:s?"rgba(255,255,255,0.3)":r.borderColor,strokeWidth:10}),i.jsx($.circle,{cx:e/2,cy:e/2,r:a,fill:"none",stroke:d,strokeWidth:10,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:c},transition:{duration:1,ease:"easeOut"}})]}),i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[i.jsx("span",{style:{fontSize:e/3.5,fontWeight:700,color:d},children:Math.round(t)}),i.jsx("span",{style:{fontSize:e/10,color:s?"#ffffff":r.textMuted},children:"von 100"})]})]})},hP=({audioUrl:t,primaryAccent:e,durationHint:n,branding:s})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(0),[d,u]=f.useState(n||0),[h,p]=f.useState(!0),[m,x]=f.useState(null);f.useEffect(()=>{if(!t)return;p(!0),x(null),u(n||0);const S=new Audio;r.current=S;const w=()=>{const C=S.duration;C&&isFinite(C)&&C>0&&u(C),p(!1)},b=()=>{const C=S.duration;C&&isFinite(C)&&C>0&&u(C)},T=()=>{p(!1);const C=S.duration;C&&isFinite(C)&&C>0&&u(C)};return S.addEventListener("loadedmetadata",w),S.addEventListener("durationchange",b),S.addEventListener("canplaythrough",T),S.addEventListener("timeupdate",()=>c(S.currentTime)),S.addEventListener("play",()=>a(!0)),S.addEventListener("pause",()=>a(!1)),S.addEventListener("ended",()=>a(!1)),S.addEventListener("error",()=>{x("Audio nicht verfgbar"),p(!1)}),S.src=t,S.load(),()=>{S.pause(),S.removeEventListener("loadedmetadata",w),S.removeEventListener("durationchange",b),S.removeEventListener("canplaythrough",T),S.src=""}},[t,n]);const g=()=>{r.current&&(o?r.current.pause():r.current.play())},y=S=>{const w=S.currentTarget.getBoundingClientRect(),b=(S.clientX-w.left)/w.width;r.current&&(r.current.currentTime=b*d)},v=S=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+S,d)))};if(m)return i.jsxs("div",{style:{padding:"12px",background:s.cardBgHover,borderRadius:"10px",color:s.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ie,{size:16})," ",m]});if(!t)return null;const k=d>0?l/d*100:0;return i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${s.borderColor}`},children:[i.jsx("div",{onClick:y,style:{height:"8px",background:s.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:i.jsx("div",{style:{width:`${k}%`,height:"100%",background:e||"#0d9488",borderRadius:"4px",transition:"width 0.1s"}})}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[i.jsx("button",{onClick:()=>v(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:s.textMuted},children:i.jsx(vl,{size:20})}),i.jsx("button",{onClick:g,disabled:h,style:{width:"48px",height:"48px",borderRadius:"50%",background:e||"#0d9488",border:"none",cursor:h?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:h?.7:1},children:h?i.jsx(me,{size:22,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):o?i.jsx(bl,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):i.jsx(Lt,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),i.jsx("button",{onClick:()=>v(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:s.textMuted},children:i.jsx(qo,{size:20})})]}),i.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:s.textMuted},children:[yt(l)," / ",yt(d)]}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},pP=({sessionId:t,conversationId:e,primaryAccent:n,branding:s})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(!1),[d,u]=f.useState(0),[h,p]=f.useState(0),[m,x]=f.useState(null),[g,y]=f.useState(!0);f.useEffect(()=>{if(!e){y(!1),x("Keine Audio-Aufnahme verfgbar");return}const b=Ou(t);return y(!0),x(null),fetch(b,{headers:{"X-WP-Nonce":At()},credentials:"same-origin"}).then(T=>{if(!T.ok)throw new Error(`HTTP ${T.status}`);return T.blob()}).then(T=>{const C=URL.createObjectURL(T),j=new Audio(C);r.current=j,j._objectUrl=C,j.addEventListener("loadedmetadata",()=>{p(j.duration),y(!1)}),j.addEventListener("timeupdate",()=>u(j.currentTime)),j.addEventListener("play",()=>a(!0)),j.addEventListener("pause",()=>a(!1)),j.addEventListener("ended",()=>a(!1)),j.addEventListener("error",()=>{x("Audio konnte nicht abgespielt werden."),y(!1)})}).catch(()=>{x("Audio nicht verfgbar."),y(!1)}),()=>{r.current&&(r.current.pause(),r.current._objectUrl&&URL.revokeObjectURL(r.current._objectUrl),r.current=null)}},[t,e]);const v=()=>{r.current&&(o?r.current.pause():r.current.play())},k=()=>{r.current&&(r.current.muted=!l,c(!l))},S=b=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+b,h)))},w=b=>{const T=b.currentTarget.getBoundingClientRect(),C=(b.clientX-T.left)/T.width;r.current&&(r.current.currentTime=C*h)};return g?i.jsxs("div",{style:{background:s.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[i.jsx(me,{size:24,color:n,style:{animation:"spin 1s linear infinite",margin:"0 auto"}}),i.jsx("p",{style:{fontSize:"13px",color:s.textMuted,marginTop:"8px"},children:"Audio wird geladen..."})]}):m?i.jsxs("div",{style:{background:s.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[i.jsx(Ie,{size:24,color:s.textMuted,style:{margin:"0 auto"}}),i.jsx("p",{style:{fontSize:"13px",color:s.textMuted,marginTop:"8px"},children:m})]}):i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${s.borderColor}`},children:[i.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:s.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ue,{size:18,color:n})," Gesprchsaufnahme"]}),i.jsx("div",{onClick:w,style:{height:"8px",background:s.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:i.jsx("div",{style:{width:`${d/h*100||0}%`,height:"100%",background:n,borderRadius:"4px",transition:"width 0.1s"}})}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[i.jsx("button",{onClick:()=>S(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:s.textMuted},children:i.jsx(vl,{size:20})}),i.jsx("button",{onClick:v,style:{width:"48px",height:"48px",borderRadius:"50%",background:n,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:o?i.jsx(bl,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):i.jsx(Lt,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),i.jsx("button",{onClick:()=>S(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:s.textMuted},children:i.jsx(qo,{size:20})}),i.jsx("button",{onClick:k,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:s.textMuted,marginLeft:"auto"},children:l?i.jsx(cd,{size:20}):i.jsx(_i,{size:20})})]}),i.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:s.textMuted},children:[yt(d)," / ",yt(h)]})]})},fP=({entry:t,index:e,primaryAccent:n,branding:s})=>{const r=t.role==="user";return i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",flexShrink:0,background:r?n:s.disabledBg,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Qt,{size:16,color:r?"#fff":s.textSecondary})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:r?n:s.textMuted,marginBottom:"4px"},children:r?"Du":"Interviewer"}),i.jsx("p",{style:{fontSize:"14px",color:s.textMain,lineHeight:1.6,margin:0},children:t.text||t.message})]})]})},gP=({answer:t,index:e,primaryAccent:n,branding:s})=>{const[r,o]=f.useState(!1),a=t.feedback?typeof t.feedback=="string"?JSON.parse(t.feedback):t.feedback:null,l=t.audio_analysis?typeof t.audio_analysis=="string"?JSON.parse(t.audio_analysis):t.audio_analysis:null,c=t.transcript==="[Keine Sprache erkannt]"||l?.speech_rate==="keine_sprache";return i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:e*.05},style:{background:"#fff",borderRadius:"16px",border:`1px solid ${s.borderColor}`,overflow:"hidden",marginBottom:"16px"},children:[i.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:"16px 20px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",textAlign:"left",overflow:"hidden"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",color:n,fontWeight:700,fontSize:"14px",flexShrink:0},children:e+1}),i.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:s.textMain,margin:0,lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.question_text||`Frage ${e+1}`})}),t.overall_score!==null&&t.overall_score!==void 0&&i.jsx("span",{style:{fontSize:"16px",fontWeight:700,color:c?s.textMuted:rn(t.overall_score*10,n)},children:c?"":`${Math.round(t.overall_score*10)}%`}),i.jsx(bt,{size:18,color:s.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:r&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsxs("div",{style:{padding:"0 20px 20px",borderTop:`1px solid ${s.borderColor}`,paddingTop:"16px"},children:[t.question_text&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:s.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Ze,{size:14,color:n})," Frage / Situation"]}),i.jsx("p",{style:{fontSize:"14px",color:s.textMain,lineHeight:1.6,background:`${n}08`,padding:"12px 16px",borderRadius:"10px",margin:0,border:`1px solid ${n}20`},children:t.question_text})]}),t.audio_url&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:s.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Ue,{size:14,color:n})," Deine Aufnahme"]}),i.jsx(hP,{audioUrl:t.audio_url,primaryAccent:n,durationHint:t.audio_duration_seconds,branding:s})]}),t.transcript&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:s.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(zt,{size:14,color:n})," Transkript"]}),i.jsxs("p",{style:{fontSize:"13px",color:c?s.textMuted:s.textSecondary,lineHeight:1.6,background:s.cardBgHover,padding:"12px 16px",borderRadius:"10px",margin:0,fontStyle:"italic",wordBreak:"break-word",overflowWrap:"break-word"},children:['"',t.transcript,'"']})]}),a?.scores&&!c&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:s.textMain,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Vt,{size:14,color:n})," Bewertung"]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",marginBottom:"8px"},children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Prsentation"}].map(({key:d,label:u})=>{const h=a.scores[d],p=h!=null?h*10:null;return i.jsxs("div",{style:{padding:"10px 8px",background:s.cardBgHover,borderRadius:"8px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"16px",fontWeight:700,color:p!=null?rn(p,n):s.textMuted},children:p!=null?Math.round(p):"-"}),i.jsx("div",{style:{fontSize:"10px",color:s.textMuted,marginTop:"2px"},children:u})]},d)})}),(()=>{const d=a.scores.overall,u=d!=null?d*10:null;return i.jsxs("div",{style:{padding:"12px 16px",background:`${n}15`,borderRadius:"8px",textAlign:"center",border:`1px solid ${n}30`,display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[i.jsx("div",{style:{fontSize:"10px",color:s.textMuted},children:"Gesamt"}),i.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:u!=null?rn(u,n):s.textMuted},children:u!=null?Math.round(u):"-"})]})})()]}),a?.summary&&i.jsx("p",{style:{fontSize:"13px",color:s.textSecondary,lineHeight:1.5,marginBottom:"12px"},children:a.summary}),a?.strengths?.length>0&&!c&&i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:s.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Jt,{size:12})," Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:s.textSecondary,fontSize:"12px"},children:a.strengths.map((d,u)=>i.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.improvements?.length>0&&i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:s.warning,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ie,{size:12})," Verbesserungspotenzial"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:s.textSecondary,fontSize:"12px"},children:a.improvements.map((d,u)=>i.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.tips?.length>0&&!c&&i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Be,{size:12})," Tipps"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:s.textSecondary,fontSize:"12px"},children:a.tips.map((d,u)=>i.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),l&&!c&&i.jsxs("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${s.borderColor}`},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:s.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Ue,{size:14,color:n})," Sprechanalyse"]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:[l.speech_rate&&i.jsxs("div",{style:{padding:"12px",background:s.cardBgHover,borderRadius:"10px"},children:[i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px"},children:"Sprechtempo"}),i.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:s.textMain,textTransform:"capitalize"},children:l.speech_rate==="optimal"?" Optimal":l.speech_rate==="zu_schnell"?" Zu schnell":l.speech_rate==="zu_langsam"?" Zu langsam":l.speech_rate})]}),l.filler_words&&i.jsxs("div",{style:{padding:"12px",background:s.cardBgHover,borderRadius:"10px"},children:[i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px"},children:"Fllwrter"}),i.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:l.filler_words.count<=2?s.success:l.filler_words.count<=5?s.warning:s.error},children:[l.filler_words.count||0," erkannt"]}),l.filler_words.words?.length>0&&i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginTop:"4px"},children:l.filler_words.words.slice(0,5).join(", ")})]}),l.confidence_score!=null&&i.jsxs("div",{style:{padding:"12px",background:s.cardBgHover,borderRadius:"10px"},children:[i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px"},children:"Selbstsicherheit"}),i.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:rn(l.confidence_score,n)},children:[l.confidence_score,"%"]})]}),l.clarity_score!=null&&i.jsxs("div",{style:{padding:"12px",background:s.cardBgHover,borderRadius:"10px"},children:[i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px"},children:"Klarheit"}),i.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:rn(l.clarity_score,n)},children:[l.clarity_score,"%"]})]})]}),l.notes&&i.jsx("p",{style:{fontSize:"12px",color:s.textMuted,marginTop:"10px",fontStyle:"italic"},children:l.notes})]})]})})})]})},mP=({isOpen:t,onClose:e,onConfirm:n,isDeleting:s,primaryAccent:r,branding:o})=>t?i.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:e,children:i.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:o.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{size:24,color:o.error})}),i.jsx("div",{children:i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:o.textMain,margin:0},children:"Session lschen?"})})]}),i.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,lineHeight:1.6,marginBottom:"24px"},children:"Mchtest du diese Session wirklich lschen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:e,disabled:s,style:{padding:"10px 20px",borderRadius:"10px",border:`1px solid ${o.disabledBg}`,backgroundColor:"white",color:o.textMain,fontSize:"14px",fontWeight:500,cursor:s?"not-allowed":"pointer",opacity:s?.5:1,outline:"none",WebkitAppearance:"none"},children:"Abbrechen"}),i.jsx("button",{onClick:n,disabled:s,style:{padding:"10px 20px",borderRadius:"10px",border:"none",backgroundColor:o.error,color:"white",fontSize:"14px",fontWeight:500,cursor:s?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",opacity:s?.7:1,outline:"none",WebkitAppearance:"none"},children:s?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):i.jsxs(i.Fragment,{children:[i.jsx(We,{size:16}),"Lschen"]})})]})]})}):null,xP=({category:t,primaryAccent:e,branding:n})=>{const[s,r]=f.useState(!1),o=aP[t.category]||Vt,a=rn(t.score,e);return i.jsxs("div",{style:{background:"#fff",borderRadius:"12px",border:`1px solid ${n.borderColor}`,overflow:"hidden",marginBottom:"10px"},children:[i.jsxs("button",{onClick:()=>r(!s),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${a}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(o,{size:18,color:a})}),i.jsx("div",{style:{flex:1,textAlign:"left"},children:i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:n.textMain,margin:0},children:t.label})}),i.jsxs("span",{style:{fontSize:"16px",fontWeight:700,color:a},children:[Math.round(t.score),"%"]}),i.jsx(bt,{size:18,color:n.textMuted,style:{transform:s?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:s&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${n.borderColor}`,paddingTop:"12px"},children:[t.feedback&&i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,lineHeight:1.5,marginBottom:"10px"},children:t.feedback}),t.strengths?.length>0&&i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.success,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Jt,{size:12})," Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.strengths.map((l,c)=>i.jsx("li",{children:l},c))})]}),t.improvements?.length>0&&i.jsxs("div",{children:[i.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.warning,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Be,{size:12})," Tipps"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.improvements.map((l,c)=>i.jsx("li",{children:l},c))})]})]})})})]})},yP=({session:t,type:e,scenario:n,onBack:s,onContinueSession:r,onRepeatSession:o,onDeleteSession:a})=>{const l=Ge(),c=xn(),[d,u]=f.useState(!1);f.useEffect(()=>{const V=()=>{const H=window.innerWidth;u(H>=768&&H<1200)};return V(),window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]);const h=l.headerGradient,p=l.primaryAccent,[m,x]=f.useState([]),[g,y]=f.useState(!0),[v,k]=f.useState(null),[S,w]=f.useState(!1),[b,T]=f.useState(!1),[C,j]=f.useState(!1),[R,I]=f.useState(null),[A,L]=f.useState(n),B=e==="video",P=e==="simulator",_=e==="roleplay",O=(()=>{const V=t?.questions||t?.questions_json;if(!V)return!1;try{const H=typeof V=="string"?JSON.parse(V):V;return Array.isArray(H)&&H.length>0}catch{return!1}})(),W=(()=>{if(!P||!O)return!1;const V=t?.total_questions||0,H=t?.completed_questions||0;return V>0&&H<V})(),D=async()=>{if(a){T(!0);try{await a(t,e)}catch(V){console.error("Failed to delete session:",V),T(!1),w(!1)}}},N=async()=>{if(!(C||!t?.id)){j(!0);try{let V;if(P)V=`${vn()}/simulator/sessions/${t.id}/export-pdf`;else if(B)V=`${vn()}/video-training/sessions/${t.id}/export-pdf`;else if(_)V=`${vn()}/sessions/${t.id}/export-pdf`;else throw new Error("Unsupported session type for PDF export");const H=await fetch(V,{method:"POST",headers:{"X-WP-Nonce":At(),"Content-Type":"application/json"},credentials:"same-origin"}),pe=await H.json();if(!H.ok)throw console.error("[PDF] Server error response:",pe),new Error(pe.error||`HTTP ${H.status}`);if(!pe.success||!pe.pdf_base64)throw console.error("[PDF] Invalid response data:",pe),new Error(pe.error||"PDF generation failed");const Te=atob(pe.pdf_base64),Le=new Array(Te.length);for(let Ke=0;Ke<Te.length;Ke++)Le[Ke]=Te.charCodeAt(Ke);const we=new Uint8Array(Le),Qe=new Blob([we],{type:pe.content_type||"application/pdf"}),ye=window.URL.createObjectURL(Qe),Ee=document.createElement("a");Ee.href=ye,Ee.download=pe.filename||"Training.pdf",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),window.URL.revokeObjectURL(ye)}catch(V){console.error("Failed to download PDF:",V)}finally{j(!1)}}};f.useEffect(()=>{P&&t?.id?F():_&&t?.id?ne():y(!1)},[t?.id,e]);const F=async()=>{try{y(!0);const H=await(await fetch(`${vn()}/simulator/sessions/${t.id}/answers`,{headers:{"X-WP-Nonce":At()}})).json();H.success&&H.data?.answers?x(H.data.answers):Array.isArray(H.data)&&x(H.data)}catch(V){console.error("Failed to load answers:",V),k("Fehler beim Laden der Antworten")}finally{y(!1)}},ne=async()=>{try{y(!0);const V=await Lu(t.id);if(I({...t,...V,feedback:Nu(V.feedback_json||t.feedback_json),audioAnalysis:zu(V.audio_analysis_json||t.audio_analysis_json),transcript:C0(V.transcript||t.transcript)}),!n&&V.scenario_id)try{const H=await T0(V.scenario_id);L(H)}catch(H){console.warn("Could not load scenario:",H)}}catch(V){console.error("Failed to load roleplay data:",V),k("Fehler beim Laden der Gesprchsdaten")}finally{y(!1)}},re=t?.summary_feedback_json?typeof t.summary_feedback_json=="string"?JSON.parse(t.summary_feedback_json):t.summary_feedback_json:null,Z=t?.category_scores||[],ee=t?.analysis||{},z=(()=>{let V=0;return _&&R?.feedback?.rating?.overall?V=R.feedback.rating.overall:V=t?.overall_score||re?.overall_score||0,(P||_)&&V<=10?V*10:V})();return g?i.jsxs("div",{style:{width:"100%",minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx(me,{size:48,color:p,style:{animation:"spin 1s linear infinite",display:"block",margin:"0 auto"}}),i.jsx("p",{style:{color:l.textMuted,marginTop:"16px"},children:"Analyse wird geladen..."})]}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):v?i.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:"24px"},children:[i.jsx(Ie,{size:48,color:l.error,style:{margin:"0 auto 16px"}}),i.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:l.textMain,marginBottom:"8px"},children:"Fehler beim Laden"}),i.jsx("p",{style:{color:l.textSecondary,marginBottom:"24px"},children:v}),i.jsx("button",{onClick:s,style:{padding:"12px 24px",borderRadius:"10px",background:l.cardBgHover,border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Zurck"})]})}):i.jsxs("div",{style:{minHeight:"100vh",background:l.pageBg,overflow:"hidden",maxWidth:"100vw"},children:[i.jsx("div",{style:{background:h,padding:c?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:i.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[s&&i.jsxs("button",{onClick:s,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[i.jsx(ft,{size:16}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!c&&i.jsx(uP,{score:z,size:100,primaryAccent:p,isHeader:!0,branding:l}),i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:dP(e)}),i.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:rn(z,p)},children:lP(z)})]}),i.jsx("h1",{style:{fontSize:c?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:(_?A?.title:n?.title)||t?.scenario_title||t?.position||"Training"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(qn,{size:14}),cP(t?.created_at)]}),t?.duration&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(Ye,{size:14}),yt(t.duration)]})]})]}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("button",{onClick:N,disabled:C,title:"Als PDF herunterladen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 12px",cursor:C?"wait":"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none",opacity:C?.7:1},children:C?i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}):i.jsx(Ar,{size:16})}),!c&&o&&i.jsxs("button",{onClick:()=>o(t,n),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none"},children:[i.jsx(Ai,{size:16}),"Erneut ben"]}),a&&i.jsx("button",{onClick:()=>w(!0),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:c?"10px 12px":"10px 16px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none"},children:i.jsx(We,{size:16})})]})]})]})}),i.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:c?"16px":"24px 32px",overflow:"hidden"},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:c||d?"1fr":"1fr 400px",gap:"24px",overflow:"hidden"},children:[i.jsxs("div",{style:{minWidth:0,overflow:"hidden"},children:[B&&t?.video_url&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(jt,{size:18,color:p})," Deine Aufnahme"]}),i.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),P&&m.length>0&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ze,{size:18,color:p})," Deine Antworten (",m.length,")"]}),m.map((V,H)=>i.jsx(gP,{answer:V,index:H,primaryAccent:p,branding:l},V.id||H)),W&&(r||o)&&i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px",padding:"20px",background:l.cardBgHover,borderRadius:"12px",border:`1px dashed ${l.disabledBg}`},children:[i.jsx("p",{style:{width:"100%",textAlign:"center",color:l.textSecondary,fontSize:"14px",marginBottom:"12px"},children:"Diese Session ist noch nicht abgeschlossen."}),r&&i.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:p,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`},children:[i.jsx(Gp,{size:18}),"Fortsetzen"]}),o&&i.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[i.jsx(Ai,{size:18}),"Erneut starten"]})]})]}),P&&m.length===0&&i.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",background:l.cardBgHover,borderRadius:"16px"},children:[i.jsx(Ie,{size:48,color:l.textMuted,style:{margin:"0 auto 16px"}}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:l.textMain,marginBottom:"8px"},children:"Keine Antworten vorhanden"}),i.jsx("p",{style:{color:l.textMuted,marginBottom:O?"24px":"0"},children:O?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),W&&(r||o)&&i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px"},children:[r&&i.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:p,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`},children:[i.jsx(Gp,{size:18}),"Fortsetzen"]}),o&&i.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[i.jsx(Ai,{size:18}),"Erneut starten"]})]})]}),_&&R&&i.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{marginBottom:"20px"},children:i.jsx(pP,{sessionId:t.id,conversationId:R.conversation_id,primaryAccent:p,branding:l})}),_&&R?.transcript?.length>0&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`},children:[i.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(zt,{size:18,color:p})," Gesprchsverlauf"]}),i.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:R.transcript.map((V,H)=>i.jsx(fP,{entry:V,index:H,primaryAccent:p,branding:l},H))})]})]}),i.jsxs("div",{style:{minWidth:0,overflow:"hidden"},children:[B&&Z.length>0&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{marginBottom:"20px"},children:[i.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Vt,{size:16,color:p})," Detaillierte Bewertung"]}),Z.map((V,H)=>i.jsx(xP,{category:V,primaryAccent:p,branding:l},V.category||H))]}),B&&(ee.key_strengths?.length>0||ee.actionable_tips?.length>0)&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[ee.key_strengths?.length>0&&i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Jt,{size:16})," Deine Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:ee.key_strengths.map((V,H)=>i.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:V},H))})]}),ee.actionable_tips?.length>0&&i.jsxs("div",{children:[i.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:p,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Be,{size:16})," Tipps zur Verbesserung"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:ee.actionable_tips.map((V,H)=>i.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:V},H))})]})]}),B&&t?.summary_feedback&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),i.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:t.summary_feedback})]}),P&&re&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[re.summary&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),i.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:re.summary})]}),re.scores&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"12px"},children:"Bewertung"}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:Object.entries(re.scores).map(([V,H])=>{const pe=H!=null?H*10:null;return i.jsxs("div",{style:{padding:"12px",background:l.cardBgHover,borderRadius:"10px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:rn(pe,p)},children:pe!=null?Math.round(pe):"-"}),i.jsx("div",{style:{fontSize:"11px",color:l.textMuted,textTransform:"capitalize"},children:V})]},V)})})]}),re.key_takeaways?.length>0&&i.jsxs("div",{style:{background:l.successLight,borderRadius:"16px",padding:"20px"},children:[i.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Be,{size:16})," Wichtigste Erkenntnisse"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:l.textMain,lineHeight:1.5},children:re.key_takeaways.map((V,H)=>i.jsx("li",{style:{marginBottom:"6px"},children:V},H))})]})]}),_&&R?.feedback&&i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[R.feedback.rating&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsxs("h4",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Vt,{size:16,color:p})," Bewertungskriterien"]}),i.jsx("div",{style:{display:"grid",gap:"10px"},children:Object.entries(R.feedback.rating).filter(([V])=>V!=="overall").map(([V,H])=>{const pe=H*10;return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:l.cardBgHover,borderRadius:"10px"},children:[i.jsx("div",{style:{flex:1,fontSize:"13px",fontWeight:500,color:l.textMain,textTransform:"capitalize"},children:V.replace(/_/g," ")}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"80px",height:"6px",background:l.borderColor,borderRadius:"3px"},children:i.jsx("div",{style:{width:`${pe}%`,height:"100%",background:rn(pe,p),borderRadius:"3px"}})}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:rn(pe,p),minWidth:"45px"},children:Math.round(pe)})]})]},V)})})]}),R.feedback.strengths?.length>0&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Jt,{size:16})," Deine Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:R.feedback.strengths.map((V,H)=>i.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:V},H))})]}),R.feedback.improvements?.length>0&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[i.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.warning,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Be,{size:16})," Verbesserungspotenzial"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:R.feedback.improvements.map((V,H)=>i.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:V},H))})]}),R.feedback.summary&&i.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),i.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:R.feedback.summary})]})]}),_&&!R?.feedback&&i.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[i.jsx(Ie,{size:32,color:l.textMuted,style:{margin:"0 auto 12px"}}),i.jsx("p",{style:{fontSize:"14px",color:l.textMuted,margin:0},children:"Keine Analyse verfgbar fr dieses Gesprch."})]})]})]})}),i.jsx(mP,{isOpen:S,onClose:()=>w(!1),onConfirm:D,isDeleting:b,primaryAccent:p,branding:l})]})},Ki={COACHING:"coaching",ANALYSEN:"analysen"},bP=t=>t>=90?"Ausgezeichnet!":t>=80?"Sehr gut!":t>=70?"Gut!":t>=60?"Solide Leistung":t>=50?"Ausbaufhig":"Weiter ben!",vP=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",SP=t=>t>=80?{color:"#22c55e",bg:"#f0fdf4",label:"Sehr selbstsicher"}:t>=60?{color:"#3b82f6",bg:"#eff6ff",label:"Selbstsicher"}:t>=40?{color:"#f59e0b",bg:"#fffbeb",label:"Ausbaufhig"}:{color:"#ef4444",bg:"#fef2f2",label:"Unsicher"},kP=t=>{switch(t){case"zu_langsam":return 15;case"optimal":return 50;case"zu_schnell":return 85;default:return 50}},Gg=t=>{if(typeof t=="number")return t;if(!t||typeof t!="string")return 0;const e=t.split(":");if(e.length===2){const n=parseInt(e[0],10)||0,s=parseInt(e[1],10)||0;return n*60+s}if(e.length===3){const n=parseInt(e[0],10)||0,s=parseInt(e[1],10)||0,r=parseInt(e[2],10)||0;return n*3600+s*60+r}return parseFloat(t)||0},wP=({score:t,size:e=100,primaryAccent:n,isHeader:s=!1})=>{const r=Math.min(100,Math.max(0,t||0)),o=(e-10)/2,a=o*2*Math.PI,l=a-r/100*a,c=rn(t,n);return i.jsxs("div",{style:{position:"relative",width:e,height:e},children:[i.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[i.jsx("circle",{cx:e/2,cy:e/2,r:o,fill:"none",stroke:s?"rgba(255,255,255,0.25)":"#e2e8f0",strokeWidth:8}),i.jsx($.circle,{cx:e/2,cy:e/2,r:o,fill:"none",stroke:s?"#fff":c,strokeWidth:8,strokeLinecap:"round",strokeDasharray:a,initial:{strokeDashoffset:a},animate:{strokeDashoffset:l},transition:{duration:1.2,ease:"easeOut"}})]}),i.jsx("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:i.jsx($.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},style:{fontSize:e/3,fontWeight:700,color:s?"#fff":c,lineHeight:1},children:Math.round(t)})})]})},CP=({audioUrl:t,duration:e,primaryAccent:n,branding:s,onSeek:r})=>{const o=f.useRef(null),a=f.useRef(null),l=f.useRef(null),[c,d]=f.useState(!1),[u,h]=f.useState(!1),[p,m]=f.useState(0),[x,g]=f.useState(e||0),[y,v]=f.useState(!0),[k,S]=f.useState(null);f.useEffect(()=>{if(!t)return;let R=!0;const I=t.includes("/wp-json/")||t.includes("/api/");return(async()=>{try{v(!0),S(null);let L=t;if(I){const P=await fetch(t,{method:"GET",headers:{"X-WP-Nonce":At()},credentials:"same-origin"});if(!P.ok)throw new Error(`HTTP ${P.status}`);const _=await P.blob();if(!R)return;if(_.size===0)throw new Error("Audio nicht verfgbar");const O=URL.createObjectURL(_);l.current=O,L=O}const B=new Audio(L);o.current=B,B.addEventListener("loadedmetadata",()=>{R&&(g(B.duration),v(!1))}),B.addEventListener("timeupdate",()=>{R&&m(B.currentTime)}),B.addEventListener("ended",()=>{R&&(d(!1),m(0))}),B.addEventListener("error",()=>{R&&(S("Audio konnte nicht geladen werden"),v(!1))})}catch(L){console.error("[AudioPlayer] Failed to load audio:",L),R&&(S("Audio konnte nicht geladen werden"),v(!1))}})(),()=>{R=!1,o.current&&(o.current.pause(),o.current.src=""),l.current&&URL.revokeObjectURL(l.current)}},[t]);const w=()=>{o.current&&(c?o.current.pause():o.current.play(),d(!c))},b=()=>{o.current&&(o.current.muted=!u,h(!u))},T=R=>{o.current&&(o.current.currentTime=Math.max(0,Math.min(x,o.current.currentTime+R)))},C=R=>{o.current&&(o.current.currentTime=R,m(R),c||(o.current.play(),d(!0)))};f.useEffect(()=>{r&&(r.current=C)},[r]);const j=R=>{if(!a.current||!x)return;const I=a.current.getBoundingClientRect(),A=(R.clientX-I.left)/I.width;C(A*x)};return t?i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${s.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(_i,{size:18,color:n}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:s.textMain},children:"Gesprchsaufnahme"})]}),i.jsx("div",{ref:a,onClick:j,style:{position:"relative",height:"48px",background:s.cardBgHover,borderRadius:"12px",cursor:"pointer",overflow:"hidden",marginBottom:"16px"},children:y?i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i.jsx(me,{size:24,color:n,style:{animation:"spin 1s linear infinite"}})}):k?i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",gap:"8px"},children:[i.jsx(Ie,{size:18,color:s.warning}),i.jsx("span",{style:{fontSize:"13px",color:s.textMuted},children:k})]}):i.jsxs(i.Fragment,{children:[i.jsx($.div,{initial:{width:0},animate:{width:`${x>0?p/x*100:0}%`},style:{position:"absolute",inset:0,background:`linear-gradient(90deg, ${n}40, ${n}60)`,borderRadius:"12px"}}),i.jsx("div",{style:{position:"absolute",left:`${x>0?p/x*100:0}%`,top:0,bottom:0,width:"3px",background:n,transform:"translateX(-50%)"}})]})}),!k&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("button",{onClick:()=>T(-10),disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:s.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:i.jsx(vl,{size:20,color:s.textSecondary})}),i.jsx("button",{onClick:w,disabled:y,style:{width:"48px",height:"48px",borderRadius:"50%",border:"none",background:n,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:c?i.jsx(bl,{size:20,color:"#fff"}):i.jsx(Lt,{size:20,color:"#fff",style:{marginLeft:"2px"}})}),i.jsx("button",{onClick:()=>T(10),disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:s.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:i.jsx(qo,{size:20,color:s.textSecondary})})]}),i.jsxs("div",{style:{flex:1,textAlign:"center",fontSize:"14px",color:s.textSecondary,fontFamily:"monospace"},children:[yt(p)," / ",yt(x)]}),i.jsx("button",{onClick:b,disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:s.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u?i.jsx(cd,{size:20,color:s.textSecondary}):i.jsx(_i,{size:20,color:s.textSecondary})})]})]}):i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${s.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(_i,{size:18,color:s.textMuted}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:s.textMain},children:"Gesprchsaufnahme"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"80px",background:s.cardBgHover,borderRadius:"12px",color:s.textMuted,fontSize:"13px"},children:[i.jsx(cd,{size:20,style:{marginRight:"8px"}}),"Keine Audioaufnahme verfgbar"]})]})},jP=({transcript:t,scenario:e,primaryAccent:n,branding:s,onSeekToTime:r})=>!t||t.length===0?i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"40px 20px",border:`1px solid ${s.borderColor}`,textAlign:"center"},children:[i.jsx(Ze,{size:32,color:s.textMuted,style:{marginBottom:"12px"}}),i.jsx("p",{style:{color:s.textMuted,fontSize:"14px"},children:"Kein Transkript verfgbar"})]}):i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${s.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(Ze,{size:18,color:n}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:s.textMain},children:"Gesprchsverlauf"})]}),i.jsx("div",{style:{maxHeight:"500px",overflowY:"auto",paddingRight:"8px"},children:t.map((o,a)=>{const l=o.role==="agent",c=o.timeLabel||(o.elapsedTime!==void 0?yt(o.elapsedTime):null);return i.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.03},style:{display:"flex",gap:"10px",marginBottom:"12px",flexDirection:l?"row":"row-reverse"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},children:[l?e?.interviewer_profile?.image_url?i.jsx("img",{src:e.interviewer_profile.image_url,alt:e.interviewer_profile.name||"Interviewer",style:{width:"32px",height:"32px",borderRadius:"50%",objectFit:"cover",border:`2px solid ${n}30`}}):i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:`linear-gradient(135deg, ${n}, ${n}cc)`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(yl,{size:16,color:"#fff"})}):i.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"linear-gradient(135deg, #14b8a6, #0d9488)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Qt,{size:16,color:"#fff"})}),!l&&c&&i.jsx("button",{onClick:()=>r?.(o.elapsedTime),style:{fontSize:"10px",fontFamily:"monospace",color:n,background:"none",border:"none",cursor:"pointer",padding:0},children:c})]}),i.jsx("div",{style:{maxWidth:"85%",padding:"10px 14px",borderRadius:l?"4px 16px 16px 16px":"16px 4px 16px 16px",background:l?s.cardBgHover:"linear-gradient(135deg, #14b8a6, #0d9488)",color:l?s.textMain:"#fff",fontSize:"13px",lineHeight:1.5,border:l?`1px solid ${s.borderColor}`:"none"},children:o.text})]},a)})})]}),ua=({label:t,value:e,maxValue:n=10,primaryAccent:s,branding:r})=>{const o=e/n*100,a=n===10?e*10:e,l=rn(a,s);return i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"13px",color:r.textSecondary},children:t}),i.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:l},children:a})]}),i.jsx("div",{style:{height:"6px",background:r.cardBgHover,borderRadius:"3px",overflow:"hidden"},children:i.jsx($.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},style:{height:"100%",background:l,borderRadius:"3px"}})})]})},TP=({feedback:t,audioAnalysis:e,primaryAccent:n,branding:s})=>{const[r,o]=f.useState("summary"),a=l=>{o(r===l?null:l)};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t?.summary&&i.jsxs("div",{style:{background:`${n}08`,borderRadius:"12px",border:`1px solid ${n}20`,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>a("summary"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[i.jsx(li,{size:18,color:n}),i.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:s.textMain},children:"Gesamtbewertung"}),i.jsx(bt,{size:18,color:s.textMuted,style:{transform:r==="summary"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:r==="summary"&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:"0 16px 16px"},children:i.jsx("p",{style:{fontSize:"13px",lineHeight:1.7,color:s.textSecondary},children:t.summary})})})})]}),t?.strengths?.length>0&&i.jsxs("div",{style:{background:"#f0fdf4",borderRadius:"12px",border:"1px solid #bbf7d0",overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>a("strengths"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[i.jsx(Ds,{size:18,color:"#22c55e"}),i.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#166534"},children:"Deine Superkrfte"}),i.jsxs("span",{style:{fontSize:"12px",color:"#22c55e",fontWeight:500},children:[t.strengths.length," Strken"]}),i.jsx(bt,{size:18,color:"#22c55e",style:{transform:r==="strengths"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:r==="strengths"&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:"0 16px 16px"},children:t.strengths.map((l,c)=>i.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px"},children:i.jsx("span",{style:{fontSize:"11px",fontWeight:600,color:"#22c55e"},children:""})}),i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#166534",margin:0},children:l})]},c))})})})]}),t?.improvements?.length>0&&i.jsxs("div",{style:{background:"#fffbeb",borderRadius:"12px",border:"1px solid #fde68a",overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>a("improvements"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[i.jsx(gn,{size:18,color:"#f59e0b"}),i.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#92400e"},children:"Dein Trainingsfeld"}),i.jsxs("span",{style:{fontSize:"12px",color:"#f59e0b",fontWeight:500},children:[t.improvements.length," Punkte"]}),i.jsx(bt,{size:18,color:"#f59e0b",style:{transform:r==="improvements"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:r==="improvements"&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:"0 16px 16px"},children:t.improvements.map((l,c)=>i.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#fef3c7",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px"},children:i.jsx("span",{style:{fontSize:"11px",fontWeight:600,color:"#f59e0b"},children:c+1})}),i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#92400e",margin:0},children:l})]},c))})})})]}),t?.tips?.length>0&&i.jsxs("div",{style:{background:"#eff6ff",borderRadius:"12px",border:"1px solid #bfdbfe",overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>a("tips"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[i.jsx(Be,{size:18,color:"#3b82f6"}),i.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#1e40af"},children:"Praktische Tipps"}),i.jsxs("span",{style:{fontSize:"12px",color:"#3b82f6",fontWeight:500},children:[t.tips.length," Tipps"]}),i.jsx(bt,{size:18,color:"#3b82f6",style:{transform:r==="tips"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:r==="tips"&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:"0 16px 16px"},children:t.tips.map((l,c)=>i.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[i.jsx(rt,{size:16,color:"#3b82f6",style:{flexShrink:0,marginTop:"2px"}}),i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#1e40af",margin:0},children:l})]},c))})})})]}),t?.rating&&i.jsxs("div",{style:{background:"#fff",borderRadius:"12px",padding:"16px",border:`1px solid ${s.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(Vt,{size:18,color:n}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:s.textMain},children:"Bewertungskriterien"})]}),t.rating.communication!==void 0&&i.jsx(ua,{label:"Kommunikation",value:t.rating.communication,primaryAccent:n,branding:s}),t.rating.motivation!==void 0&&i.jsx(ua,{label:"Motivation",value:t.rating.motivation,primaryAccent:n,branding:s}),t.rating.professionalism!==void 0&&i.jsx(ua,{label:"Professionalitt",value:t.rating.professionalism,primaryAccent:n,branding:s}),t.rating.preparation!==void 0&&i.jsx(ua,{label:"Vorbereitung",value:t.rating.preparation,primaryAccent:n,branding:s})]})]})},EP=({audioAnalysis:t,primaryAccent:e,branding:n,onJumpToTimestamp:s})=>{const r=t?.audio_metrics||t,o=r&&(r.confidence_score!==void 0||r.speech_cleanliness||r.pacing||r.tonality);if(!t||!o)return i.jsxs("div",{style:{background:"#fff",borderRadius:"12px",padding:"40px 20px",border:`1px solid ${n.borderColor}`,textAlign:"center"},children:[i.jsx(Ql,{size:32,color:n.textMuted,style:{marginBottom:"12px"}}),i.jsx("p",{style:{color:n.textMuted,fontSize:"14px"},children:"Keine Audio-Analyse verfgbar"})]});const a=r.confidence_score,l=r.speech_cleanliness,c=r.pacing,d=r.tonality,u=l?.total_filler_count||0,h=l?.filler_word_analysis||[];h.map(g=>g.word);const p=l?.feedback,m=g=>g==="lebendig"?"Lebendig":g==="natrlich"?"Natrlich":"Monoton",x=g=>g==="lebendig"?{base:20,variance:30}:g==="natrlich"?{base:25,variance:20}:{base:35,variance:8};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[a!==void 0&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(Ql,{size:18,color:e}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Selbstsicherheit"})]}),i.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:(()=>{const g=a,y=SP(g),v=140,k=v/2-12,S=Math.PI*k,w=S-g/100*S;return i.jsxs("div",{style:{background:y.bg,borderRadius:"16px",padding:"20px 30px",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs("div",{style:{position:"relative",width:v,height:v/2+20},children:[i.jsxs("svg",{width:v,height:v/2+20,style:{overflow:"visible"},children:[i.jsx("path",{d:`M 12 ${v/2} A ${k} ${k} 0 0 1 ${v-12} ${v/2}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"10",strokeLinecap:"round"}),i.jsx($.path,{d:`M 12 ${v/2} A ${k} ${k} 0 0 1 ${v-12} ${v/2}`,fill:"none",stroke:y.color,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:S,initial:{strokeDashoffset:S},animate:{strokeDashoffset:w},transition:{duration:1.2,ease:"easeOut"}})]}),i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",paddingBottom:"4px"},children:[i.jsx($.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5},style:{fontSize:"32px",fontWeight:700,color:y.color},children:Math.round(g)}),i.jsx("span",{style:{fontSize:"11px",color:n.textMuted},children:"/ 100"})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"8px"},children:[i.jsx(Ql,{size:14,color:y.color}),i.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:y.color},children:y.label})]})]})})()}),r.summary_text&&i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,textAlign:"center"},children:r.summary_text})]}),l&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ze,{size:18,color:"#f97316"}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Fllwrter"})]}),i.jsxs("span",{style:{fontSize:"13px",fontWeight:600,padding:"4px 10px",borderRadius:"20px",background:u<=2?"#dcfce7":u<=5?"#fef3c7":"#fee2e2",color:u<=2?"#166534":u<=5?"#92400e":"#991b1b"},children:[u,"x gesamt"]})]}),h.length>0?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:h.map((g,y)=>i.jsxs("div",{style:{borderRadius:"8px",background:"#fef3c7",overflow:"hidden"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px"},children:[i.jsxs("span",{style:{fontSize:"13px",color:"#92400e",fontWeight:500},children:['"',g.word,'"']}),i.jsxs("span",{style:{fontSize:"12px",color:"#92400e",fontWeight:600},children:[g.count,"x"]})]}),g.examples?.length>0&&i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",padding:"8px 12px",background:"#fef9e7",borderTop:"1px solid #fde68a"},children:g.examples.map((v,k)=>i.jsxs("button",{onClick:()=>s?.(Gg(v.timestamp)),style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"6px",border:"none",background:"#fef3c7",cursor:"pointer",fontSize:"11px",color:"#92400e",transition:"all 0.15s"},onMouseOver:S=>S.currentTarget.style.background="#fde68a",onMouseOut:S=>S.currentTarget.style.background="#fef3c7",children:[i.jsx("span",{style:{fontFamily:"monospace",fontWeight:600},children:v.timestamp}),i.jsx(Lt,{size:10})]},k))})]},y))}):i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#22c55e"},children:[i.jsx(Ds,{size:16}),i.jsx("span",{style:{fontSize:"13px"},children:"Keine Fllwrter erkannt!"})]}),p&&i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,marginTop:"12px"},children:p})]}),c&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(yT,{size:18,color:"#3b82f6"}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Sprechtempo"})]}),c.estimated_wpm&&i.jsxs("span",{style:{fontSize:"12px",fontFamily:"monospace",padding:"4px 10px",borderRadius:"6px",background:n.cardBgHover,color:n.textSecondary},children:["~",c.estimated_wpm," WPM"]})]}),i.jsxs("div",{style:{position:"relative",height:"40px",marginBottom:"8px"},children:[i.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"8px",borderRadius:"4px",background:"linear-gradient(90deg, #93c5fd, #86efac, #fca5a5)",transform:"translateY(-50%)"}}),i.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"60px",height:"16px",background:"rgba(34, 197, 94, 0.2)",border:"1px solid #22c55e",borderRadius:"8px",transform:"translate(-50%, -50%)"}}),i.jsx($.div,{initial:{left:"50%"},animate:{left:`${kP(c.rating)}%`},transition:{duration:.8,ease:"easeOut"},style:{position:"absolute",top:"50%",width:"16px",height:"16px",borderRadius:"50%",background:c.rating==="optimal"?"#22c55e":"#f59e0b",border:"2px solid #fff",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",transform:"translate(-50%, -50%)"}}),i.jsxs("div",{style:{position:"absolute",bottom:"-4px",left:0,right:0,display:"flex",justifyContent:"space-between",fontSize:"10px",color:n.textMuted},children:[i.jsx("span",{children:"Langsam"}),i.jsx("span",{style:{color:"#22c55e",fontWeight:500},children:"Optimal"}),i.jsx("span",{children:"Schnell"})]})]}),c.feedback&&i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,marginTop:"16px"},children:c.feedback})]}),d&&i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(oT,{size:18,color:"#14b8a6"}),i.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Betonung & Melodie"})]}),i.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"6px",background:"#f0fdfa",color:"#0d9488"},children:m(d.rating)})]}),i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",height:"48px",marginBottom:"12px"},children:Array.from({length:30}).map((g,y)=>{const{base:v,variance:k}=x(d.rating),S=v+Math.sin(y*.5)*k+Math.sin(y*12.9898)%1*(k/2);return i.jsx($.div,{initial:{height:0},animate:{height:`${Math.max(10,Math.min(100,S))}%`},transition:{duration:.5,delay:y*.02},style:{width:"4px",borderRadius:"2px",background:"#14b8a6"}},y)})}),d.highlights?.length>0&&i.jsx("div",{style:{marginBottom:"12px"},children:d.highlights.map((g,y)=>i.jsxs("button",{onClick:()=>s?.(Gg(g.timestamp)),style:{width:"100%",display:"flex",alignItems:"flex-start",gap:"8px",padding:"10px 12px",marginBottom:"6px",borderRadius:"8px",border:"none",background:g.type==="positive"?"#f0fdf4":"#fef2f2",cursor:"pointer",textAlign:"left"},children:[i.jsx("span",{style:{fontSize:"11px",fontFamily:"monospace",padding:"2px 6px",borderRadius:"4px",background:g.type==="positive"?"#dcfce7":"#fee2e2",color:g.type==="positive"?"#166534":"#991b1b",flexShrink:0},children:g.timestamp}),i.jsx("span",{style:{flexShrink:0,marginTop:"1px"},children:g.type==="positive"?i.jsx(Ds,{size:14,color:"#22c55e"}):i.jsx(xs,{size:14,color:"#ef4444"})}),i.jsx("span",{style:{fontSize:"12px",color:n.textSecondary,flex:1,lineHeight:1.5,wordBreak:"break-word",whiteSpace:"normal"},children:g.note}),i.jsx(Lt,{size:12,color:n.textMuted,style:{flexShrink:0,marginTop:"2px"}})]},y))}),d.feedback&&i.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary},children:d.feedback})]})]})},Cv=({session:t,scenario:e,feedback:n,audioAnalysis:s,onBack:r,onRepeat:o,onDelete:a,isLoading:l=!1})=>{const c=Ge(),d=xn(768),u=f.useRef(null),[h,p]=f.useState(Ki.COACHING),[m,x]=f.useState(!1),[g,y]=f.useState(!1),[v,k]=f.useState(!1),[S,w]=f.useState(null),[b,T]=f.useState(!1),C=S||t;f.useEffect(()=>{t?.id&&!t?.audio_analysis_json&&!s&&!S&&(T(!0),Lu(t.id).then(N=>{w(N)}).catch(N=>{console.error("Failed to fetch full session:",N)}).finally(()=>{T(!1)}))},[t?.id,t?.audio_analysis_json,s,S]);const j=f.useMemo(()=>n&&typeof n=="object"?n:C?.feedback_json?Nu(C.feedback_json):null,[n,C?.feedback_json]),R=f.useMemo(()=>s&&typeof s=="object"?s:C?.audio_analysis_json?zu(C.audio_analysis_json):null,[s,C?.audio_analysis_json]),I=f.useMemo(()=>C?.transcript?C0(C.transcript):[],[C?.transcript]),A=f.useMemo(()=>C?.audio_url?C.audio_url:C?.id?Ou(C.id):null,[C?.id,C?.audio_url]),L=f.useMemo(()=>j?.rating?.overall!==void 0?j.rating.overall*10:0,[j]),B=c.primaryAccent,P=c.headerGradient,_=D=>{u.current&&u.current(D)},O=async()=>{if(!(!C?.id||v)){k(!0);try{const N=(window.wpApiSettings||{}).root||"/wp-json/",F=At(),ne=await fetch(`${N}bewerbungstrainer/v1/sessions/${C.id}/export-pdf`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":F}}),re=await ne.json();if(!ne.ok)throw console.error("[PDF] Server error:",re),new Error(re.error||"PDF-Export fehlgeschlagen");if(re.pdf_base64&&re.filename){const Z=atob(re.pdf_base64),ee=new Array(Z.length);for(let pe=0;pe<Z.length;pe++)ee[pe]=Z.charCodeAt(pe);const se=new Uint8Array(ee),z=new Blob([se],{type:"application/pdf"}),V=window.URL.createObjectURL(z),H=document.createElement("a");H.href=V,H.download=re.filename,document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(V)}}catch(D){console.error("[PDF] Download failed:",D)}finally{k(!1)}}};return l||b?i.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"16px"},children:[i.jsx(me,{size:40,color:B,style:{animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{color:c.textSecondary,fontSize:"14px"},children:"Lade Report..."})]}):i.jsxs("div",{style:{minHeight:"100vh",background:c.pageBg},children:[i.jsx("div",{style:{background:P,padding:d?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:i.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[r&&i.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[i.jsx(ft,{size:16}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!d&&i.jsx(wP,{score:L,size:100,primaryAccent:B,isHeader:!0}),i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Live-Simulation"}),i.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:rn(L,B)},children:bP(L)})]}),i.jsx("h1",{style:{fontSize:d?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:e?.title||C?.scenario_title||"bungssession"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(qn,{size:14}),vP(C?.created_at)]}),C?.duration&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(Ye,{size:14}),yt(C.duration)]})]})]}),!d&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[C?.id&&i.jsxs("button",{onClick:O,disabled:v,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:v?"wait":"pointer",color:"#fff",fontSize:"14px",fontWeight:500,opacity:v?.7:1},children:[v?i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}):i.jsx(Ar,{size:16}),"PDF Export"]}),o&&i.jsxs("button",{onClick:o,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[i.jsx(Lt,{size:16}),"Erneut ben"]}),a&&i.jsx("button",{onClick:()=>x(!0),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:"10px 16px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:i.jsx(We,{size:16})})]})]})]})}),i.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:d?"16px":"24px 32px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"30fr 70fr",gap:"24px",alignItems:"start"},children:[i.jsxs("div",{style:{order:d?2:1},children:[i.jsx(jP,{transcript:I,scenario:e,primaryAccent:B,branding:c,onSeekToTime:_}),i.jsx("div",{style:{marginTop:"16px"},children:i.jsx(CP,{audioUrl:A,duration:C?.duration,primaryAccent:B,branding:c,onSeek:u})})]}),i.jsxs("div",{style:{order:d?1:2},children:[i.jsxs("div",{style:{display:"flex",background:"#fff",borderRadius:"12px",padding:"4px",marginBottom:"16px",border:`1px solid ${c.borderColor}`},children:[i.jsx("button",{onClick:()=>p(Ki.COACHING),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:h===Ki.COACHING?B:"transparent",color:h===Ki.COACHING?"#fff":c.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Coaching"}),i.jsx("button",{onClick:()=>p(Ki.ANALYSEN),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:h===Ki.ANALYSEN?B:"transparent",color:h===Ki.ANALYSEN?"#fff":c.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Analysen"})]}),i.jsx(Ve,{mode:"wait",children:i.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:h===Ki.COACHING?i.jsx(TP,{feedback:j,audioAnalysis:R,primaryAccent:B,branding:c}):i.jsx(EP,{audioAnalysis:R,primaryAccent:B,branding:c,onJumpToTimestamp:_})},h)})]})]}),d&&i.jsxs("div",{style:{marginTop:"24px",display:"flex",flexDirection:"column",gap:"12px"},children:[C?.id&&i.jsxs("button",{onClick:O,disabled:v,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:B,border:"none",borderRadius:"12px",padding:"14px 24px",cursor:v?"wait":"pointer",color:"#fff",fontSize:"15px",fontWeight:600,opacity:v?.7:1},children:[v?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(Ar,{size:18}),"PDF Export"]}),o&&i.jsxs("button",{onClick:o,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:c.cardBg,border:`1px solid ${c.borderColor}`,borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:c.textMain,fontSize:"15px",fontWeight:600},children:[i.jsx(Lt,{size:18}),"Erneut ben"]}),a&&i.jsxs("button",{onClick:()=>x(!0),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:"transparent",border:"1px solid #ef4444",borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:"#ef4444",fontSize:"15px",fontWeight:600},children:[i.jsx(We,{size:18}),"Session lschen"]})]})]}),i.jsx(Ve,{children:m&&i.jsxs(i.Fragment,{children:[i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>x(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3}}),i.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",zIndex:1001,boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},children:i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:"rgba(239,68,68,0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:i.jsx(We,{size:24,color:"#ef4444"})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:c.textMain,marginBottom:"8px"},children:"Session lschen?"}),i.jsx("p",{style:{fontSize:"14px",color:c.textSecondary,marginBottom:"24px"},children:"Diese Aktion kann nicht rckgngig gemacht werden. Dein Transkript und Feedback werden dauerhaft gelscht."}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("button",{onClick:()=>x(!1),disabled:g,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:`1px solid ${c.borderColor}`,background:"#fff",color:c.textMain,fontSize:"14px",fontWeight:500,cursor:g?"not-allowed":"pointer",opacity:g?.5:1},children:"Abbrechen"}),i.jsx("button",{onClick:async()=>{if(!(!a||!C?.id)){y(!0);try{await a(C)}catch(D){console.error("Failed to delete session:",D)}finally{y(!1),x(!1)}}},disabled:g,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"none",background:"#ef4444",color:"#fff",fontSize:"14px",fontWeight:500,cursor:g?"not-allowed":"pointer",opacity:g?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:g?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):i.jsxs(i.Fragment,{children:[i.jsx(We,{size:16}),"Lschen"]})})]})]})})]})}),i.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},IP={"file-text":zt,briefcase:jn,banknote:ms,users:wn,user:Qt,"message-circle":Oi,target:rt,award:li,book:Uo,clipboard:Vo,star:Vt,lightbulb:Be,shield:Bi,compass:Vn,rocket:pi,calendar:qn,sparkles:st,video:jt,mic:Ue,play:Lt,"check-circle":Jt,"alert-circle":Ie,"help-circle":s0,settings:di,home:o1,"trending-up":gn,"bar-chart":Vj,"pie-chart":Gj,activity:Wj,zap:Sl,heart:Vs,"thumbs-up":Gn,"message-square":Ze,mail:nT,phone:uo,"map-pin":iT,clock:Ye,bell:$j,search:Ns,filter:va,edit:mT,trash:We,plus:Yt,minus:rT,check:Pn,x:Bt,info:mn,warning:xs,refresh:Ot,loader:me,globe:Wr,link:tT,bookmark:Uj,tag:xT,code:qj,database:Kj,server:Ru,pen:Ho,bot:yl},RP={"file-text":zt,briefcase:jn,banknote:ms,users:wn},jv=(t,e=zt)=>IP[t]||e,AP=t=>RP[t]||zt,_P={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprchsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprchsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fhigkeiten",strengths:"Strken",challenges:"Herausforderungen"},MP=t=>_P[t]||t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),Ud=(t,e)=>{if(!t)return null;const n=[];let s=t,r=0;for(;s.length>0;){const o=s.match(/\*\*(.+?)\*\*/),a=s.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),l=s.match(/`([^`]+)`/),c=[{match:o,type:"bold"},{match:a,type:"italic"},{match:l,type:"code"}].filter(u=>u.match);if(c.length===0){n.push(s);break}const d=c.reduce((u,h)=>(u.match?.index??1/0)<(h.match?.index??1/0)?u:h);switch(d.match.index>0&&n.push(s.substring(0,d.match.index)),d.type){case"bold":n.push(i.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:d.match[1]},r++));break;case"italic":n.push(i.jsx("em",{style:{fontStyle:"italic"},children:d.match[1]||d.match[2]},r++));break;case"code":n.push(i.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:d.match[1]},r++));break}s=s.substring(d.match.index+d.match[0].length)}return n},Tv=({content:t,primaryAccent:e})=>{if(!t)return null;const n=s=>{const r=s.split(`
`),o=[];let a=[],l=null;const c=()=>{a.length>0&&(o.push(i.jsx("ul",{style:{margin:"8px 0",paddingLeft:"20px",listStyle:"none"},children:a.map((d,u)=>i.jsxs("li",{style:{marginBottom:"6px",fontSize:"14px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"16px"},children:[i.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:l==="number"?`${u+1}.`:""}),Ud(d,e)]},u))},`list-${o.length}`)),a=[],l=null)};return r.forEach((d,u)=>{const h=d.trim();if(!h){c();return}if(h.startsWith("- ")||h.startsWith("* ")){l!=="bullet"&&(c(),l="bullet"),a.push(h.substring(2));return}const p=h.match(/^(\d+)\.\s/);if(p){l!=="number"&&(c(),l="number"),a.push(h.substring(p[0].length));return}c(),o.push(i.jsx("p",{style:{margin:"8px 0",fontSize:"14px",lineHeight:1.6,color:"#374151"},children:Ud(h,e)},`p-${u}`))}),c(),o};return i.jsx("div",{children:n(t)})},Hg=({item:t,sectionId:e,primaryAccent:n,onUpdateItem:s,branding:r})=>{const[o,a]=f.useState(t.user_note||""),[l,c]=f.useState(!1),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!!t.user_note);f.useEffect(()=>{p(o!==(t.user_note||""))},[o,t.user_note]);const g=async()=>{c(!0);try{await s(e,t.id,{user_note:o}),u(!0),p(!1),setTimeout(()=>u(!1),2e3)}catch(k){console.error("Error saving note:",k)}finally{c(!1)}},y=async()=>{try{await s(e,t.id,{deleted:!0})}catch(k){console.error("Error deleting item:",k)}},v=async()=>{try{await s(e,t.id,{deleted:!1})}catch(k){console.error("Error restoring item:",k)}};return t.deleted?i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderRadius:"10px",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:.6},children:[i.jsxs("span",{style:{fontSize:"14px",color:r.textMuted,fontStyle:"italic"},children:[i.jsx("s",{children:t.label})," - gelscht"]}),i.jsxs("button",{onClick:v,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",borderRadius:"6px",border:"none",backgroundColor:r.borderColor,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:[i.jsx(Ai,{size:12}),"Wiederherstellen"]})]}):i.jsxs("div",{style:{backgroundColor:r.cardBg,borderRadius:"12px",border:`1px solid ${r.borderColor}`,marginBottom:"10px",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"14px 16px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[i.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:n,flexShrink:0}}),i.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:r.textMain,margin:0},children:t.label})]}),t.content&&i.jsx("p",{style:{fontSize:"13px",color:r.textMuted,margin:"0 0 0 14px",lineHeight:1.5},children:Ud(t.content,n)})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",flexShrink:0},children:[t.user_note&&!m&&i.jsx("span",{style:{fontSize:"11px",color:n,backgroundColor:`${n}15`,padding:"2px 6px",borderRadius:"4px"},children:"Notiz"}),i.jsx("button",{onClick:()=>x(!m),title:"Notiz hinzufgen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:m?`${n}15`:"transparent",color:m?n:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Ho,{size:16})}),i.jsx("button",{onClick:y,title:"Lschen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{size:16})})]})]}),m&&i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderTop:`1px solid ${r.borderColor}`},children:[i.jsx("textarea",{value:o,onChange:k=>a(k.target.value),placeholder:"Deine Notiz zu diesem Punkt...",style:{width:"100%",minHeight:"60px",padding:"10px",borderRadius:"8px",border:`1px solid ${r.borderColor}`,fontSize:"13px",color:r.textSecondary,resize:"vertical",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:k=>{k.target.style.borderColor=n},onBlur:k=>{k.target.style.borderColor=r.borderColor}}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"8px",gap:"8px"},children:[i.jsx("button",{onClick:()=>{x(!1),a(t.user_note||"")},style:{padding:"6px 12px",borderRadius:"6px",border:`1px solid ${r.borderColor}`,backgroundColor:r.cardBg,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:"Abbrechen"}),i.jsxs("button",{onClick:g,disabled:l||!h,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:d?r.successLight:h?n:r.cardBgHover,color:d?r.success:h?"white":r.textMuted,fontSize:"12px",fontWeight:500,cursor:h&&!l?"pointer":"default"},children:[l?i.jsx(me,{size:12,style:{animation:"spin 1s linear infinite"}}):d?i.jsx(Pn,{size:12}):i.jsx(d0,{size:12}),d?"Gespeichert!":"Speichern"]})]})]}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},PP=({section:t,primaryAccent:e,onUpdateItem:n,onGenerateMore:s,isExpanded:r,onToggle:o,branding:a})=>{const[l,c]=f.useState(!1),d=async()=>{c(!0);try{await s(t.id)}catch(v){console.error("Error generating more items:",v)}finally{c(!1)}},u=f.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const v=JSON.parse(t.ai_content);if(v&&Array.isArray(v.items))return{type:"items",items:v.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:h,items:p,content:m}=u(),x=p.filter(v=>!v.deleted),g=p.filter(v=>v.deleted),y=p.some(v=>v.user_note&&!v.deleted);return i.jsxs("div",{style:{backgroundColor:a.cardBgColor,borderRadius:a.radius.xl,boxShadow:a.shadow.xs,overflow:"hidden",marginBottom:a.space[4]},children:[i.jsxs("button",{onClick:o,style:{width:"100%",padding:`${a.space[4]} ${a.space[5]}`,display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:a.space[2],border:"none",background:"none",cursor:"pointer",borderBottom:r?`1px solid ${a.borderColorLight}`:"none"},children:[i.jsx("h3",{style:{fontSize:a.fontSize.lg,fontWeight:a.fontWeight.semibold,color:a.textMain,margin:0,textAlign:"left",flex:1,minWidth:0,wordBreak:"break-word",lineHeight:1.3},children:t.section_title}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2],flexShrink:0,flexWrap:"wrap",justifyContent:"flex-end"},children:[h==="items"&&i.jsxs("span",{style:{fontSize:a.fontSize.xs,color:a.textMuted,backgroundColor:a.borderColorLight,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[x.length," Punkte"]}),y&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:a.space[1],fontSize:a.fontSize.xs,color:e,backgroundColor:`${e}15`,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[i.jsx(Ho,{size:a.iconSize.xs}),"Notizen"]}),r?i.jsx(ni,{size:a.iconSize.lg,style:{color:a.textMuted}}):i.jsx(bt,{size:a.iconSize.lg,style:{color:a.textMuted}})]})]}),r&&i.jsx("div",{style:{padding:`${a.space[4]} ${a.space[5]}`},children:h==="items"?i.jsxs(i.Fragment,{children:[x.map(v=>i.jsx(Hg,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id)),s&&i.jsx("button",{onClick:d,disabled:l,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px 16px",marginTop:"12px",marginBottom:"8px",borderRadius:"10px",border:`1px dashed ${e}40`,backgroundColor:`${e}08`,color:e,fontSize:"13px",fontWeight:500,cursor:l?"wait":"pointer",transition:"all 0.2s"},onMouseEnter:v=>{l||(v.currentTarget.style.backgroundColor=`${e}15`,v.currentTarget.style.borderColor=`${e}60`)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=`${e}08`,v.currentTarget.style.borderColor=`${e}40`},children:l?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}),"Generiere 5 weitere Punkte..."]}):i.jsxs(i.Fragment,{children:[i.jsx(st,{size:16}),"5 weitere Punkte generieren"]})}),g.length>0&&i.jsxs("div",{style:{marginTop:"16px"},children:[i.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(We,{size:12}),g.length," gelschte ",g.length===1?"Punkt":"Punkte"]}),g.map(v=>i.jsx(Hg,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id))]})]}):h==="markdown"?i.jsxs("div",{style:{backgroundColor:"#f8fafc",padding:"16px",borderRadius:"10px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[i.jsx(yl,{size:16,style:{color:e}}),i.jsx("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.5px"},children:"KI-Empfehlung"})]}),i.jsx(Tv,{content:m,primaryAccent:e})]}):i.jsx("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Kein Inhalt verfgbar"})})]})},Ev=({briefing:t,onBack:e,onDelete:n})=>{const{config:s}=qe(),r=Ge(),o=xn(),[a,l]=f.useState(t),[c,d]=f.useState(!t?.sections),[u,h]=f.useState(null),[p,m]=f.useState({}),[x,g]=f.useState(!1),[y,v]=f.useState(!1),[k,S]=f.useState(!1),[w,b]=f.useState(!1),T=r.primaryAccent,C=r.headerGradient,j=jv(a?.template_icon)||zt;f.useEffect(()=>{const B=async()=>{if(a?.sections){const P={};a.sections.forEach(_=>{P[_.id]=!0}),m(P),d(!1);return}try{d(!0);const P=await ce.request(`/smartbriefing/briefings/${a.id}`,{method:"GET"});if(P.success&&P.data?.briefing){l(P.data.briefing);const _={};P.data.briefing.sections?.forEach(O=>{_[O.id]=!0}),m(_)}else throw new Error("Fehler beim Laden des Briefings")}catch(P){console.error("[SmartBriefing] Error fetching briefing:",P),h(P.message)}finally{d(!1)}};a?.id&&B()},[a?.id]);const R=f.useCallback(B=>{m(P=>({...P,[B]:!P[B]}))},[]),I=f.useCallback(async(B,P,_)=>{const O=await ce.request(`/smartbriefing/sections/${B}/items/${P}`,{method:"PATCH",body:JSON.stringify(_)});if(!O.success)throw new Error("Fehler beim Speichern");l(W=>({...W,sections:W.sections.map(D=>D.id===B?O.data.section:D)}))},[]),A=f.useCallback(async B=>{const P=await ce.request(`/smartbriefing/sections/${B}/generate-more`,{method:"POST"});if(!P.success)throw new Error(P.message||"Fehler beim Generieren");return l(_=>({..._,sections:_.sections.map(O=>O.id===B?P.data.section:O)})),P.data.new_items_count},[]),L=f.useCallback(async()=>{if(!(w||!a?.id)){b(!0);try{const B=await ce.request(`/smartbriefing/briefings/${a.id}/pdf`,{method:"GET"});if(!B.success||!B.data?.pdf_base64)throw new Error(B.message||"PDF-Export fehlgeschlagen");const P=atob(B.data.pdf_base64),_=new Array(P.length);for(let F=0;F<P.length;F++)_[F]=P.charCodeAt(F);const O=new Uint8Array(_),W=new Blob([O],{type:"application/pdf"}),D=window.URL.createObjectURL(W),N=document.createElement("a");N.href=D,N.download=B.data.filename||"Smart-Briefing.pdf",document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(D)}catch(B){console.error("[SmartBriefing] PDF download error:",B)}finally{b(!1)}}},[a?.id,w]);return a?i.jsxs("div",{style:{minHeight:"100vh",background:r.pageBg},children:[i.jsx("div",{style:{background:C,padding:o?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:i.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[e&&i.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[i.jsx(ft,{size:16}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!o&&i.jsx("div",{style:{width:90,height:90,borderRadius:"50%",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(j,{size:40,color:"#fff"})}),i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Smart Briefing"}),i.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:T},children:a.template_title})]}),i.jsx("h1",{style:{fontSize:o?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:a.title||"Briefing"}),i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(qn,{size:14}),Di(a.created_at)]})})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexShrink:0},children:[i.jsx("button",{onClick:L,disabled:w,title:"Als PDF herunterladen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 12px",cursor:w?"not-allowed":"pointer",color:"#fff",opacity:w?.6:1,outline:"none",WebkitAppearance:"none"},children:w?i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}):i.jsx(Ar,{size:16})}),n&&i.jsx("button",{onClick:()=>v(!0),title:"Briefing loschen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:"10px 12px",cursor:"pointer",color:"#fff",outline:"none",WebkitAppearance:"none"},children:i.jsx(We,{size:16})})]})]})]})}),i.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto",padding:o?"16px":"24px 32px"},children:[a.variables&&Object.keys(a.variables).length>0&&i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"16px 20px",marginBottom:"20px",border:`1px solid ${r.borderColor}`},children:[i.jsxs("button",{onClick:()=>g(!x),style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"0",border:"none",background:"none",cursor:"pointer"},children:[i.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textMain},children:["Deine Angaben (",Object.keys(a.variables).length,")"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r.textMuted},children:[i.jsx("span",{style:{fontSize:"12px"},children:x?"Einklappen":"Ausklappen"}),x?i.jsx(ni,{size:16}):i.jsx(bt,{size:16})]})]}),x&&i.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.borderColor}`,display:"flex",flexWrap:"wrap",gap:"8px"},children:Object.entries(a.variables).map(([B,P])=>i.jsxs("span",{style:{backgroundColor:r.cardBgHover,padding:"6px 12px",borderRadius:"20px",fontSize:"12px",color:r.textSecondary},children:[i.jsxs("strong",{style:{color:r.textMain},children:[MP(B),":"]})," ",P]},B))})]}),c&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[i.jsx(me,{size:40,style:{color:T,animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefing wird geladen..."})]}),u&&!c&&i.jsx("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",textAlign:"center"},children:i.jsx("p",{style:{color:"#dc2626",margin:0},children:u})}),!c&&!u&&a.sections&&i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx(st,{size:18,style:{color:T}}),i.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:"Briefing-Inhalte"}),i.jsxs("span",{style:{fontSize:"13px",color:"#94a3b8"},children:["(",a.sections.length," Abschnitte)"]})]}),a.sections.map(B=>i.jsx(PP,{section:B,primaryAccent:T,onUpdateItem:I,onGenerateMore:A,isExpanded:p[B.id],onToggle:()=>R(B.id),branding:r},B.id))]}),!c&&!u&&(!a.sections||a.sections.length===0)&&a.content_markdown&&i.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:i.jsx(Tv,{content:a.content_markdown,primaryAccent:T})}),i.jsx("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${T}08`,borderRadius:"12px",border:`1px solid ${T}20`},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(Be,{size:18,style:{color:T,flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"Tipp: Personalisiere dein Briefing"}),i.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.5},children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufgen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),i.jsx(Ve,{children:y&&i.jsxs(i.Fragment,{children:[i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>v(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3}}),i.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",zIndex:1001,boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},children:i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:"rgba(239,68,68,0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:i.jsx(We,{size:24,color:"#ef4444"})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:r.textMain,marginBottom:"8px"},children:"Briefing lschen?"}),i.jsx("p",{style:{fontSize:"14px",color:r.textSecondary,marginBottom:"24px"},children:"Diese Aktion kann nicht rckgngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelscht."}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("button",{onClick:()=>v(!1),disabled:k,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:`1px solid ${r.borderColor}`,background:"#fff",color:r.textMain,fontSize:"14px",fontWeight:500,cursor:k?"not-allowed":"pointer",opacity:k?.5:1,outline:"none",WebkitAppearance:"none"},children:"Abbrechen"}),i.jsx("button",{onClick:async()=>{if(!(!n||!a?.id)){S(!0);try{await n(a)}catch(B){console.error("Failed to delete briefing:",B)}finally{S(!1),v(!1)}}},disabled:k,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"none",background:"#ef4444",color:"#fff",fontSize:"14px",fontWeight:500,cursor:k?"not-allowed":"pointer",opacity:k?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",outline:"none",WebkitAppearance:"none"},children:k?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):i.jsxs(i.Fragment,{children:[i.jsx(We,{size:16}),"Lschen"]})})]})]})})]})}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):null},qg=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Kg=fy,Iv=(t,e)=>n=>{var s;if(e?.variants==null)return Kg(t,n?.class,n?.className);const{variants:r,defaultVariants:o}=e,a=Object.keys(r).map(d=>{const u=n?.[d],h=o?.[d];if(u===null)return null;const p=qg(u)||qg(h);return r[d][p]}),l=n&&Object.entries(n).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((d,u)=>{let{class:h,className:p,...m}=u;return Object.entries(m).every(x=>{let[g,y]=x;return Array.isArray(y)?y.includes({...o,...l}[g]):{...o,...l}[g]===y})?[...d,h,p]:d},[]);return Kg(t,a,c,n?.class,n?.className)},DP=Iv("rounded-xl border bg-white",{variants:{variant:{default:"border-slate-200",elevated:"border-slate-200 shadow-xl",outline:"border-ocean-blue-200",ghost:"border-transparent bg-transparent",gradient:"border-ocean-blue-100 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50",ocean:"border-ocean-blue-200 bg-ocean-blue-50"},padding:{none:"p-0",sm:"p-3",default:"p-4",lg:"p-6"}},defaultVariants:{variant:"default",padding:"default"}}),it=f.forwardRef(({className:t,variant:e,padding:n,...s},r)=>i.jsx("div",{ref:r,className:dt(DP({variant:e,padding:n,className:t})),...s}));it.displayName="Card";const Nr=f.forwardRef(({className:t,...e},n)=>i.jsx("div",{ref:n,className:dt("flex items-center justify-between mb-3",t),...e}));Nr.displayName="CardHeader";const NP=Iv("flex items-center gap-2",{variants:{size:{sm:"text-sm",default:"text-base",lg:"text-lg"}},defaultVariants:{size:"sm"}}),zr=f.forwardRef(({className:t,size:e,icon:n,iconColor:s,children:r,...o},a)=>i.jsxs("div",{ref:a,className:dt(NP({size:e,className:t})),...o,children:[n&&i.jsx(n,{className:dt("w-4 h-4",s)}),i.jsx("span",{className:"font-semibold text-slate-800",children:r})]}));zr.displayName="CardTitle";const Rv=f.forwardRef(({className:t,...e},n)=>i.jsx("p",{ref:n,className:dt("text-sm text-slate-500",t),...e}));Rv.displayName="CardDescription";const pt=f.forwardRef(({className:t,...e},n)=>i.jsx("div",{ref:n,className:dt("",t),...e}));pt.displayName="CardContent";const zP=f.forwardRef(({className:t,...e},n)=>i.jsx("div",{ref:n,className:dt("mt-3 pt-3 border-t border-slate-100",t),...e}));zP.displayName="CardFooter";const kn=f.forwardRef(({className:t,type:e,...n},s)=>i.jsx("input",{type:e,className:dt("flex h-11 w-full rounded-xl border-2 bg-white px-4 py-2 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","file:border-0 file:bg-ocean-blue-50 file:text-ocean-blue-700 file:text-sm file:font-medium file:mr-4 file:px-4 file:py-2 file:rounded-lg","hover:border-slate-300","transition-all duration-200",t),ref:s,...n}));kn.displayName="Input";const Ri=f.forwardRef(({className:t,...e},n)=>i.jsx("textarea",{className:dt("flex min-h-[100px] w-full rounded-xl border-2 bg-white px-4 py-3 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","hover:border-slate-300","resize-none","transition-all duration-200",t),ref:n,...e}));Ri.displayName="Textarea";const LP=t=>{const e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n.toString().padStart(2,"0")}`},OP=[/^untertitel/i,/amara\.org/i,/vielen dank f[u]r'?s? zusch/i,/bis zum n[a]chsten mal/i,/thank you for watching/i,/subscribe/i,/^\.+$/,/^[\s]+$/,/^\s*$/,/^(hm?|uhm?|hmm?|ja|nein|ok|okay)\.?\s*$/i],BP=t=>{if(!t||typeof t!="string")return!0;const e=t.trim();if(e.length<10)return!0;for(const n of OP)if(n.test(e))return console.log("[AudioRecorder] Filtered hallucination:",e),!0;return!1},FP=({isRecording:t,analyserNode:e,b:n})=>{const s=f.useRef(null),r=f.useRef(null);return f.useEffect(()=>{if(!t||!e||!s.current){r.current&&cancelAnimationFrame(r.current);return}const o=s.current,a=o.getContext("2d"),l=e.frequencyBinCount,c=new Uint8Array(l),d=()=>{if(!t)return;e.getByteFrequencyData(c),a.clearRect(0,0,o.width,o.height);const u=50,h=2,p=(o.width-u*h)/(u-1),m=o.height/2;for(let x=0;x<u;x++){const g=Math.floor(x/u*l),y=c[g]||0,v=Math.max(2,y/255*(o.height*.8));a.fillStyle=n.textMain,a.fillRect(x*(h+p),m-v/2,h,v)}r.current=requestAnimationFrame(d)};return d(),()=>{r.current&&cancelAnimationFrame(r.current)}},[t,e,n]),i.jsx("canvas",{ref:s,width:200,height:32,style:{flex:1,maxWidth:"300px",minWidth:"100px"}})},WP=({onTranscriptReady:t,disabled:e=!1})=>{const n=Ge(),[s,r]=f.useState(!1),[o,a]=f.useState(!1),[l,c]=f.useState(0),[d,u]=f.useState(null),h=f.useRef(null),p=f.useRef([]),m=f.useRef(null),x=f.useRef(null),g=f.useRef(null),y=f.useRef(null),v=f.useRef(!1),k=f.useRef(0),S=f.useRef(null),w=f.useCallback(()=>{x.current&&(clearInterval(x.current),x.current=null),S.current&&(clearInterval(S.current),S.current=null),m.current&&(m.current.getTracks().forEach(j=>j.stop()),m.current=null),g.current&&(g.current.close(),g.current=null),p.current=[],v.current=!1,k.current=0},[]);f.useEffect(()=>w,[w]);const b=async()=>{try{u(null);const j=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});m.current=j,g.current=new(window.AudioContext||window.webkitAudioContext);const R=g.current.createMediaStreamSource(j);y.current=g.current.createAnalyser(),y.current.fftSize=256,R.connect(y.current);const I=c2()||"audio/webm",A=new MediaRecorder(j,{mimeType:I});h.current=A,p.current=[],A.ondataavailable=B=>{B.data.size>0&&p.current.push(B.data)},A.start(100),r(!0),c(0),v.current=!1,k.current=0,x.current=setInterval(()=>{c(B=>B+1)},1e3);const L=new Uint8Array(y.current.frequencyBinCount);S.current=setInterval(()=>{if(y.current){y.current.getByteFrequencyData(L);const B=L.reduce((P,_)=>P+_,0)/L.length;B>k.current&&(k.current=B),B>20&&(v.current=!0)}},100)}catch(j){console.error("[AudioRecorder] Error starting recording:",j),u("Mikrofon-Zugriff verweigert")}},T=f.useCallback(()=>{h.current&&s&&h.current.stop(),w(),r(!1),c(0),u(null)},[s,w]),C=f.useCallback(async()=>{if(!h.current||!s)return;const j=v.current,R=k.current,I=l;if(h.current.stop(),r(!1),x.current&&(clearInterval(x.current),x.current=null),S.current&&(clearInterval(S.current),S.current=null),m.current&&m.current.getTracks().forEach(A=>A.stop()),await new Promise(A=>setTimeout(A,100)),p.current.length===0){u("Keine Aufnahme");return}if(I<1){u("Aufnahme zu kurz"),w(),c(0);return}if(!j||R<15){console.log("[AudioRecorder] No speech detected. Peak level:",R),u("Keine Sprache erkannt"),w(),c(0);return}a(!0),u(null);try{const A=h.current?.mimeType||"audio/webm",L=new Blob(p.current,{type:A});if(L.size<1e3)throw new Error("Aufnahme zu kurz");const B=await v0(L),P=await ce.transcribeAudio(B,A);if(P.transcript){if(BP(P.transcript))throw new Error("Keine verstndliche Sprache erkannt");t(P.transcript),w(),c(0)}else throw new Error("Keine Transkription erhalten")}catch(A){console.error("[AudioRecorder] Transcription error:",A),u(A.message||"Transkription fehlgeschlagen")}finally{a(!1)}},[s,l,t,w]);return o?i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:n.space[2],padding:`${n.space[3]} ${n.space[4]}`,backgroundColor:n.cardBgHover,borderRadius:n.radius.full,border:`1px solid ${n.borderColor}`},children:[i.jsx(me,{size:n.iconSize["2xl"],color:n.textSecondary,style:{animation:"spin 1s linear infinite"}}),i.jsx("span",{style:{fontSize:n.fontSize.base,color:n.textSecondary},children:"Wird transkribiert..."}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):s?i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[2]} ${n.space[3]}`,backgroundColor:n.cardBgHover,borderRadius:n.radius.full,border:`1px solid ${n.borderColor}`},children:[i.jsx("button",{onClick:T,style:{width:"40px",height:"40px",borderRadius:n.radius.full,border:"none",backgroundColor:n.borderColorLight,color:n.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,flexShrink:0},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=n.borderColor},onMouseLeave:j=>{j.currentTarget.style.backgroundColor=n.borderColorLight},children:i.jsx(Bt,{size:n.iconSize.xl,strokeWidth:2.5})}),i.jsx(FP,{isRecording:s,analyserNode:y.current,b:n}),i.jsx("span",{style:{fontFamily:"system-ui, -apple-system, sans-serif",fontSize:n.fontSize.lg,fontWeight:n.fontWeight.medium,color:n.textMain,minWidth:"40px",textAlign:"right",flexShrink:0},children:LP(l)}),i.jsx("button",{onClick:C,style:{width:"40px",height:"40px",borderRadius:n.radius.full,border:"none",backgroundColor:n.primaryAccent,color:n.white,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,flexShrink:0},onMouseEnter:j=>{j.currentTarget.style.opacity="0.9"},onMouseLeave:j=>{j.currentTarget.style.opacity="1"},children:i.jsx(Pn,{size:n.iconSize.xl,strokeWidth:2.5})})]}):i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[d&&i.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.error},children:d}),i.jsx("button",{onClick:b,disabled:e,title:"Spracheingabe",style:{width:"44px",height:"44px",borderRadius:n.radius.full,border:"none",backgroundColor:n.textMain,color:n.white,cursor:e?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,opacity:e?.5:1},onMouseEnter:j=>{e||(j.currentTarget.style.opacity="0.9")},onMouseLeave:j=>{e||(j.currentTarget.style.opacity="1")},children:i.jsx(Ue,{size:n.iconSize["2xl"]})})]})},$P=()=>`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,UP=({value:t,onChange:e,type:n,b:s})=>{const r=n==="pro"?s.success:s.error;return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[2],minWidth:"100px"},children:[i.jsx("input",{type:"range",min:"1",max:"10",value:t,onChange:o=>e(parseInt(o.target.value)),style:{width:"70px",height:"6px",borderRadius:s.radius.sm,background:`linear-gradient(90deg, ${r} 0%, ${r} ${(t-1)*11.1}%, ${s.borderColor} ${(t-1)*11.1}%, ${s.borderColor} 100%)`,appearance:"none",cursor:"pointer"}}),i.jsx("span",{style:{minWidth:"24px",textAlign:"center",fontWeight:s.fontWeight.semibold,fontSize:s.fontSize.sm,color:r},children:t})]})},VP=({item:t,onToggle:e,onWeightChange:n,onTextChange:s,b:r})=>{const o=t.type==="pro",a=o?r.successLight:r.errorLight,l=o?"#bbf7d0":"#fecaca",c=o?r.successDark:r.errorDark,d=Cn.useRef(null);return Cn.useEffect(()=>{const u=d.current;u&&(u.style.height="auto",u.style.height=Math.max(36,u.scrollHeight)+"px")},[t.text]),i.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{display:"flex",alignItems:"flex-start",gap:r.space[3],padding:r.space[4],backgroundColor:t.selected?a:r.cardBgHover,borderRadius:r.radius.lg,border:`2px solid ${t.selected?l:r.borderColor}`,transition:r.transition.normal},children:[i.jsx("div",{onClick:()=>e(t.id),style:{width:"24px",height:"24px",borderRadius:r.radius.md,border:`2px solid ${t.selected?c:r.borderColor}`,backgroundColor:t.selected?c:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,cursor:"pointer",transition:r.transition.normal},children:t.selected&&i.jsx(Pn,{size:14,color:r.white,strokeWidth:3})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[2],marginBottom:r.space[1]},children:[o?i.jsx(Gn,{size:r.iconSize.md,color:c}):i.jsx(us,{size:r.iconSize.md,color:c}),i.jsx("span",{style:{fontSize:r.fontSize.xs,fontWeight:r.fontWeight.semibold,color:c,textTransform:"uppercase"},children:o?"Pro":"Contra"})]}),i.jsx("textarea",{ref:d,value:t.text,onChange:u=>s(t.id,u.target.value),style:{width:"100%",fontSize:r.fontSize.md,fontWeight:r.fontWeight.medium,color:r.textMain,marginBottom:r.space[2],padding:`${r.space[2]} ${r.space[2.5]}`,border:`1px solid ${l}`,borderRadius:r.radius.md,backgroundColor:r.white,resize:"none",overflow:"hidden",minHeight:"36px",lineHeight:1.4}}),t.source_quote&&i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:r.space[1.5],fontSize:r.fontSize.sm,color:r.textMuted,fontStyle:"italic"},children:[i.jsx(hT,{size:12,style:{flexShrink:0,marginTop:"2px"}}),i.jsxs("span",{children:['"',t.source_quote,'"']})]})]}),i.jsx("div",{onClick:u=>u.stopPropagation(),children:i.jsx(UP,{value:t.weight,onChange:u=>n(t.id,u),type:t.type,b:r})})]})},GP=({isOpen:t,onClose:e,topic:n,existingPros:s,existingCons:r,onAddItems:o})=>{const a=Ge(),[l,c]=f.useState("loading_question"),[d,u]=f.useState(""),[h,p]=f.useState(""),[m,x]=f.useState(""),[g,y]=f.useState([]),[v,k]=f.useState([]),[S,w]=f.useState(null),[b,T]=f.useState(0);f.useEffect(()=>{t&&l==="loading_question"&&C()},[l,t]),f.useEffect(()=>{t&&(c("loading_question"),u(""),x(""),y([]),k([]),w(null),T(0))},[t]);const C=async()=>{w(null);try{const _=window.bewerbungstrainerConfig?.geminiApiKey;if(!_)throw new Error("API-Key nicht konfiguriert");const O=await m2(n,s,r,v,_);u(O.question),p(O.question_type||""),c("input"),T(W=>W+1)}catch(_){console.error("[DeepDiveWizard] Question generation error:",_),w(_.message||"Fehler beim Generieren der Frage"),c("input")}},j=async()=>{if(m.trim()){c("analyzing"),w(null);try{const _=window.bewerbungstrainerConfig?.geminiApiKey;if(!_)throw new Error("API-Key nicht konfiguriert");const W=((await x2(n,d,m,_)).extracted_items||[]).map(D=>({...D,id:$P(),selected:!0}));y(W),k(D=>[...D,{question:d,answer:m}]),c("selection")}catch(_){console.error("[DeepDiveWizard] Extraction error:",_),w(_.message||"Fehler beim Analysieren der Antwort"),c("input")}}},R=f.useCallback(_=>{y(O=>O.map(W=>W.id===_?{...W,selected:!W.selected}:W))},[]),I=f.useCallback((_,O)=>{y(W=>W.map(D=>D.id===_?{...D,weight:O}:D))},[]),A=f.useCallback((_,O)=>{y(W=>W.map(D=>D.id===_?{...D,text:O}:D))},[]),L=()=>{const _=g.filter(O=>O.selected);_.length>0&&o(_),x(""),y([]),c("loading_question")},B=()=>{k(_=>[..._,{question:d,answer:m}]),x(""),y([]),c("loading_question")},P=()=>{const _=g.filter(O=>O.selected);_.length>0&&o(_),e()};return t?i.jsxs(Ve,{children:[i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:a.zIndex.modal,padding:a.space[4]},onClick:e,children:i.jsxs($.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:_=>_.stopPropagation(),className:"wizard-modal",style:{backgroundColor:a.cardBgColor,borderRadius:a.radius.xl,width:"100%",maxWidth:"640px",maxHeight:"90dvh",overflow:"hidden",boxShadow:a.shadow.xl,display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${a.space[4]} ${a.space[5]}`,borderBottom:`1px solid ${a.borderColor}`,background:a.headerGradient},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[3]},children:[i.jsx("div",{style:{width:a.space[10],height:a.space[10],borderRadius:a.radius.lg,backgroundColor:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(u0,{size:a.iconSize.xl,color:a.white})}),i.jsxs("div",{children:[i.jsx("h2",{style:{fontSize:a.fontSize.xl,fontWeight:a.fontWeight.bold,color:a.white,margin:0},children:"Deep Dive Interview"}),i.jsxs("p",{style:{fontSize:a.fontSize.sm,color:"rgba(255,255,255,0.8)",margin:0},children:["Frage ",b,"  Entdecke deine wahren Motive"]})]})]}),i.jsx("button",{onClick:e,style:{width:a.space[10],height:a.space[10],borderRadius:a.radius.md,border:"none",backgroundColor:"rgba(255,255,255,0.2)",color:a.white,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Bt,{size:a.iconSize.xl})})]}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:a.space[5]},children:[l==="loading_question"&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:a.space[8],gap:a.space[4]},children:[i.jsx(me,{size:48,color:a.primaryAccent,style:{animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{color:a.textSecondary,fontSize:a.fontSize.lg},children:"Generiere nchste Frage..."})]}),l==="input"&&i.jsxs("div",{children:[i.jsxs("div",{style:{backgroundColor:`${a.primaryAccent}10`,borderRadius:a.radius.lg,padding:a.space[5],marginBottom:a.space[5],borderLeft:`4px solid ${a.primaryAccent}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2],marginBottom:a.space[2]},children:[i.jsx(Oi,{size:a.iconSize.md,color:a.primaryAccent}),i.jsx("span",{style:{fontSize:a.fontSize.sm,fontWeight:a.fontWeight.semibold,color:a.primaryAccent,textTransform:"uppercase"},children:"Coach fragt"})]}),i.jsx("p",{style:{fontSize:a.fontSize.xl,fontWeight:a.fontWeight.medium,color:a.textMain,lineHeight:1.5,margin:0},children:d||"Lade Frage..."})]}),S&&i.jsx("div",{style:{backgroundColor:a.errorLight,color:a.errorDark,padding:a.space[3],borderRadius:a.radius.md,marginBottom:a.space[4],fontSize:a.fontSize.sm},children:S}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:a.fontSize.base,fontWeight:a.fontWeight.medium,color:a.textSecondary,marginBottom:a.space[2]},children:"Deine Antwort"}),i.jsx(Ri,{value:m,onChange:_=>x(_.target.value),placeholder:"Schreib einfach drauf los... Was fllt dir ein? Was fhlst du dabei?",rows:5,style:{fontSize:a.fontSize.md,padding:a.space[4],borderRadius:a.radius.lg,resize:"vertical",minHeight:"120px"}})]})]}),l==="analyzing"&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:a.space[8],gap:a.space[4]},children:[i.jsx($.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:i.jsx(st,{size:48,color:a.primaryAccent})}),i.jsx("p",{style:{color:a.textSecondary,fontSize:a.fontSize.lg},children:"KI extrahiert Argumente..."})]}),l==="selection"&&i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2],marginBottom:a.space[4]},children:[i.jsx(st,{size:a.iconSize.lg,color:a.primaryAccent}),i.jsx("h3",{style:{fontSize:a.fontSize.lg,fontWeight:a.fontWeight.semibold,color:a.textMain,margin:0},children:"Extrahierte Argumente"})]}),g.length===0?i.jsxs("div",{style:{textAlign:"center",padding:a.space[6],backgroundColor:a.cardBgHover,borderRadius:a.radius.lg},children:[i.jsx("p",{style:{color:a.textSecondary,marginBottom:a.space[3]},children:"Keine konkreten Argumente gefunden."}),i.jsx("p",{style:{color:a.textMuted,fontSize:a.fontSize.sm},children:"Das ist okay! Versuch es mit einer ausfhrlicheren Antwort oder einer anderen Frage."})]}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:a.space[3]},children:g.map(_=>i.jsx(VP,{item:_,onToggle:R,onWeightChange:I,onTextChange:A,b:a},_.id))}),i.jsx("p",{style:{fontSize:a.fontSize.sm,color:a.textMuted,marginTop:a.space[4],textAlign:"center"},children:"Klicke auf ein Argument um es ab-/anzuwhlen. Passe die Gewichtung nach Bedarf an."})]})]}),i.jsxs("div",{className:"wizard-footer",style:{padding:`${a.space[4]} ${a.space[5]}`,borderTop:`1px solid ${a.borderColor}`,display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:a.space[3],flexShrink:0,backgroundColor:a.cardBgColor},children:[l==="input"&&i.jsxs(i.Fragment,{children:[i.jsx(de,{variant:"ghost",onClick:e,children:"Abbrechen"}),i.jsxs("div",{style:{display:"flex",gap:a.space[2]},children:[i.jsxs(de,{variant:"outline",onClick:B,children:[i.jsx(qo,{size:a.iconSize.md,style:{marginRight:a.space[1.5]}}),"berspringen"]}),i.jsxs(de,{variant:"solid",onClick:j,disabled:!m.trim()||m.length<10,style:{background:m.trim().length>=10?a.headerGradient:void 0},children:[i.jsx(st,{size:a.iconSize.md,style:{marginRight:a.space[2]}}),"Auswerten"]})]})]}),l==="selection"&&i.jsxs(i.Fragment,{children:[i.jsx(de,{variant:"outline",onClick:P,style:{borderColor:a.borderColor,backgroundColor:a.cardBgHover},children:"Fertig"}),i.jsxs(de,{variant:"solid",onClick:()=>{g.filter(O=>O.selected).length>0?L():B()},style:{background:a.headerGradient},children:[g.some(_=>_.selected)?"bernehmen & Weiter":"Nchste Frage",i.jsx(Et,{size:a.iconSize.md,style:{marginLeft:a.space[1]}})]})]})]})]})}),i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }

          /* Mobile responsive: footer buttons stack on small screens */
          @media (max-width: 480px) {
            .wizard-modal {
              max-height: calc(100dvh - 16px) !important;
              border-radius: 16px !important;
            }
            .wizard-footer {
              padding: 12px 16px !important;
            }
            .wizard-footer > button,
            .wizard-footer > div {
              flex: 1 1 auto;
            }
            .wizard-footer > div {
              width: 100%;
              justify-content: stretch;
            }
            .wizard-footer > div > button {
              flex: 1;
            }
          }
        `})]}):null},nr=()=>`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Av=[{id:"strategist",name:"Der Stratege",icon:"",color:"#6366f1",bgColor:"#eef2ff",description:"Karriere, Geld, Macht"},{id:"security",name:"Der Sicherheits-Beauftragte",icon:"",color:"#0891b2",bgColor:"#ecfeff",description:"Risiko, Bestndigkeit"},{id:"feelgood",name:"Der Feel-Good Manager",icon:"",color:"#10b981",bgColor:"#ecfdf5",description:"Work-Life-Balance, Kultur"},{id:"growth",name:"Der Grnder",icon:"",color:"#f59e0b",bgColor:"#fffbeb",description:"Wachstum, Innovation"},{id:"future",name:"Dein Zukunfts-Ich",icon:"",color:"#8b5cf6",bgColor:"#f5f3ff",description:"Langzeit, Reue-Vermeidung"}],HP=({value:t,onChange:e,onChangeEnd:n,color:s,b:r})=>{const o=s==="green",a=o?r.success:r.error,l=o?r.successDark:r.errorDark;return o?r.successLight:r.errorLight,i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[2],minWidth:"90px",flexShrink:0},children:[i.jsx("input",{type:"range",min:"1",max:"10",value:t,onChange:c=>e(parseInt(c.target.value)),onMouseUp:n,onTouchEnd:n,style:{width:"60px",height:"6px",borderRadius:r.radius.sm,background:`linear-gradient(90deg, ${a} 0%, ${a} ${(t-1)*11.1}%, ${r.borderColor} ${(t-1)*11.1}%, ${r.borderColor} 100%)`,appearance:"none",cursor:"pointer",flexShrink:0}}),i.jsx("span",{style:{minWidth:"20px",textAlign:"center",fontWeight:r.fontWeight.semibold,fontSize:r.fontSize.sm,color:l,flexShrink:0},children:t})]})},Jg=({item:t,onUpdate:e,onDelete:n,onAddNew:s,onBlur:r,color:o,autoFocus:a,b:l})=>{const c=o==="green",d=c?l.successLight:l.errorLight,u=c?"#bbf7d0":"#fecaca",h=c?"#86efac":"#fca5a5",p=c?l.successDark:l.errorDark,m=Cn.useRef(null);return Cn.useEffect(()=>{const x=m.current;x&&(x.style.height="auto",x.style.height=Math.max(44,x.scrollHeight)+"px")},[t.text]),i.jsxs($.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:c?-20:20},transition:{duration:.2},className:"decision-item",style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",gap:l.space[2.5],padding:l.space[3],backgroundColor:d,borderRadius:l.radius.lg,border:`1px solid ${u}`},children:[i.jsxs("div",{className:"decision-item-input-row",style:{display:"flex",alignItems:"flex-start",gap:l.space[2.5],flex:"1 1 100%",minWidth:0},children:[i.jsx("div",{style:{flexShrink:0,paddingTop:l.space[2]},children:c?i.jsx(Gn,{size:l.iconSize.lg,color:p}):i.jsx(us,{size:l.iconSize.lg,color:p})}),i.jsx(Ri,{ref:m,value:t.text,onChange:x=>e(t.id,{text:x.target.value}),onBlur:r,autoFocus:a,placeholder:c?"Pro-Argument...":"Contra-Argument...",rows:1,style:{flex:1,minWidth:"0",backgroundColor:l.white,border:`1px solid ${h}`,borderRadius:l.radius.md,padding:`${l.space[2]} ${l.space[3]}`,fontSize:l.fontSize.base,resize:"none",minHeight:"44px",overflow:"hidden"}})]}),i.jsxs("div",{className:"decision-item-controls",style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:l.space[2],flex:"0 0 auto",marginLeft:"auto"},children:[i.jsx(HP,{value:t.weight,onChange:x=>e(t.id,{weight:x}),onChangeEnd:r,color:o,b:l}),i.jsx("button",{onClick:()=>n(t.id),style:{padding:l.space[2],backgroundColor:l.transparent,border:"none",borderRadius:l.radius.sm,cursor:"pointer",color:l.textMuted,transition:l.transition.normal,flexShrink:0},onMouseEnter:x=>{x.currentTarget.style.backgroundColor=l.errorLight,x.currentTarget.style.color=l.errorDark},onMouseLeave:x=>{x.currentTarget.style.backgroundColor=l.transparent,x.currentTarget.style.color=l.textMuted},children:i.jsx(We,{size:l.iconSize.md})})]})]})},qP=({proScore:t,contraScore:e,b:n})=>{const s=t+e,r=s>0?Math.round(t/s*100):50,o=100-r;return i.jsxs("div",{style:{marginTop:n.space[6]},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold},children:[i.jsxs("span",{style:{color:n.successDark},children:["Pro: ",t," Punkte (",r,"%)"]}),i.jsxs("span",{style:{color:n.errorDark},children:["Contra: ",e," Punkte (",o,"%)"]})]}),i.jsxs("div",{style:{height:n.space[6],borderRadius:n.radius.lg,overflow:"hidden",display:"flex",backgroundColor:n.borderColorLight,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:[i.jsx($.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.success} 0%, ${n.successDark} 100%)`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:n.white,fontWeight:n.fontWeight.semibold,fontSize:n.fontSize.xs,minWidth:r>10?"auto":"0"},children:r>15&&`${r}%`}),i.jsx($.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.5,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.error} 0%, ${n.errorDark} 100%)`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:n.white,fontWeight:n.fontWeight.semibold,fontSize:n.fontSize.xs,minWidth:o>10?"auto":"0"},children:o>15&&`${o}%`})]})]})},Yg=({suggestion:t,onAdd:e,isAdded:n,b:s})=>{const r=t.type==="pro",o=r?s.successLight:s.errorLight,a=r?"#bbf7d0":"#fecaca",l=r?"#dcfce7":"#fee2e2",c=r?s.successDark:s.errorDark,d=r?s.success:s.error;return i.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,backgroundColor:o,borderRadius:s.radius.md,border:`1px solid ${a}`},children:[i.jsx("div",{style:{width:s.space[6],height:s.space[6],borderRadius:s.radius.sm,backgroundColor:l,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:r?i.jsx(Gn,{size:s.iconSize.sm,color:c}):i.jsx(us,{size:s.iconSize.sm,color:c})}),i.jsx("span",{style:{flex:1,fontSize:s.fontSize.base,color:s.textSecondary,lineHeight:1.4},children:t.text}),i.jsx("button",{onClick:()=>e(t),disabled:n,style:{width:s.space[12],height:s.space[12],borderRadius:s.radius.lg,border:"none",backgroundColor:n?s.borderColor:d,color:n?s.textMuted:s.white,cursor:n?"default":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:s.transition.normal,flexShrink:0},children:n?"":i.jsx(Yt,{size:s.iconSize["3xl"],color:"white",strokeWidth:2.5})})]})},KP=({isOpen:t,onClose:e,activePersona:n,isLoading:s,suggestions:r,onAddSuggestion:o,onLoadMore:a,addedSuggestions:l,b:c})=>{if(!t)return null;const d=Av.find(u=>u.id===n);return i.jsxs($.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{position:"relative",marginTop:c.space[4],padding:c.space[5],backgroundColor:c.cardBgColor,borderRadius:c.radius.xl,border:`2px solid ${d?.color||"#6366f1"}`,boxShadow:c.shadow.lg},children:[i.jsx("button",{onClick:e,style:{position:"absolute",top:c.space[3],right:c.space[3],width:c.space[10],height:c.space[10],borderRadius:c.radius.md,border:"none",backgroundColor:c.borderColorLight,color:c.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Bt,{size:c.iconSize["2xl"],strokeWidth:2.5})}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[3],marginBottom:c.space[4],paddingRight:c.space[8]},children:[i.jsx("span",{style:{fontSize:c.fontSize["5xl"]},children:d?.icon}),i.jsxs("div",{children:[i.jsx("h4",{style:{fontSize:c.fontSize.lg,fontWeight:c.fontWeight.semibold,color:c.textMain,margin:0},children:d?.name}),i.jsx("p",{style:{fontSize:c.fontSize.sm,color:c.textSecondary,margin:0},children:d?.description})]})]}),s?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:c.space[3],padding:c.space[6]},children:[i.jsx(me,{size:c.iconSize["3xl"],color:d?.color,style:{animation:"spin 1s linear infinite"}}),i.jsxs("span",{style:{color:c.textSecondary,fontSize:c.fontSize.base},children:[d?.name," denkt nach..."]})]}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:c.space[2.5]},children:[i.jsx("div",{style:{marginBottom:c.space[2]},children:i.jsx("span",{style:{fontSize:c.fontSize.xs,fontWeight:c.fontWeight.semibold,color:c.successDark,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Pro-Argumente"})}),r.filter(u=>u.type==="pro").map((u,h)=>i.jsx(Yg,{suggestion:u,onAdd:o,isAdded:l.has(`${u.type}-${u.text}`),b:c},`pro-${h}`)),i.jsx("div",{style:{marginTop:c.space[3],marginBottom:c.space[2]},children:i.jsx("span",{style:{fontSize:c.fontSize.xs,fontWeight:c.fontWeight.semibold,color:c.errorDark,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Contra-Argumente"})}),r.filter(u=>u.type==="con").map((u,h)=>i.jsx(Yg,{suggestion:u,onAdd:o,isAdded:l.has(`${u.type}-${u.text}`),b:c},`con-${h}`)),r.length>0&&a&&i.jsx("button",{onClick:a,disabled:s,style:{marginTop:c.space[4],padding:`${c.space[3]} ${c.space[4]}`,backgroundColor:"transparent",border:`2px dashed ${d?.color||c.borderColor}`,borderRadius:c.radius.lg,color:d?.color||c.textSecondary,fontSize:c.fontSize.base,fontWeight:c.fontWeight.medium,cursor:s?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:c.space[2],width:"100%",transition:c.transition.normal,opacity:s?.6:1},children:s?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:c.iconSize.md,style:{animation:"spin 1s linear infinite"}}),"Generiere mehr..."]}):i.jsxs(i.Fragment,{children:[i.jsx(st,{size:c.iconSize.md}),"Mehr Inspirationen"]})})]})]})},JP=({topic:t,onSelectPersona:e,activePersona:n,isLoading:s,suggestions:r,onCloseBrainstorm:o,onAddSuggestion:a,onLoadMore:l,addedSuggestions:c,b:d})=>{const[u,h]=f.useState(!1),p=t.trim().length>0;return i.jsxs(it,{variant:"elevated",padding:"lg",style:{marginBottom:d.space[4]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",gap:d.space[2]},onClick:()=>h(!u),children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[3],minWidth:0},children:[i.jsx("div",{style:{width:d.space[10],height:d.space[10],borderRadius:d.radius.md,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(wn,{size:d.iconSize.lg,color:"white"})}),i.jsxs("div",{style:{minWidth:0},children:[i.jsx("h3",{style:{fontSize:d.fontSize.lg,fontWeight:d.fontWeight.semibold,color:d.textMain,margin:0},children:"Brainstorming"}),i.jsx("p",{style:{fontSize:d.fontSize.base,color:d.textSecondary,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Frag dein inneres Team"})]})]}),u?i.jsx(ni,{size:d.iconSize.xl,color:d.textSecondary,style:{flexShrink:0}}):i.jsx(bt,{size:d.iconSize.xl,color:d.textSecondary,style:{flexShrink:0}})]}),i.jsx(Ve,{children:u&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:i.jsxs("div",{style:{marginTop:d.space[4]},children:[i.jsx("div",{style:{display:"flex",gap:d.space[2],overflowX:"auto",paddingBottom:d.space[2],marginLeft:`-${d.space[1]}`,marginRight:`-${d.space[1]}`,paddingLeft:d.space[1],paddingRight:d.space[1],WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:Av.map(m=>i.jsxs("button",{onClick:x=>{x.stopPropagation(),p&&e(m.id)},disabled:!p||s&&n===m.id,style:{display:"flex",alignItems:"center",gap:d.space[1.5],padding:`${d.space[2]} ${d.space[3]}`,borderRadius:d.radius.md,border:n===m.id?`2px solid ${m.color}`:`2px solid ${d.borderColor}`,backgroundColor:n===m.id?m.bgColor:d.cardBgColor,cursor:p?"pointer":"not-allowed",opacity:p?1:.5,transition:d.transition.normal,whiteSpace:"nowrap",flexShrink:0},children:[s&&n===m.id?i.jsx(me,{size:d.iconSize.sm,color:m.color,style:{animation:"spin 1s linear infinite"}}):i.jsx("span",{style:{fontSize:d.fontSize.lg},children:m.icon}),i.jsx("span",{style:{fontSize:d.fontSize.sm,fontWeight:d.fontWeight.medium,color:n===m.id?m.color:d.textSecondary},children:m.name.replace("Der ","").replace("Dein ","")})]},m.id))}),!p&&i.jsx("p",{style:{marginTop:d.space[3],fontSize:d.fontSize.sm,color:d.textMuted,fontStyle:"italic"},children:"Gib zuerst deine Entscheidungsfrage ein, um Vorschlge zu erhalten."}),i.jsx(Ve,{children:n&&i.jsx(KP,{isOpen:!!n,onClose:o,activePersona:n,isLoading:s,suggestions:r,onAddSuggestion:a,onLoadMore:l,addedSuggestions:c,b:d})})]})})})]})},_v=({initialData:t,onAnalysisComplete:e,onCancel:n,isAuthenticated:s,requireAuth:r,savedDecisionId:o,onSaveDraft:a,onUpdateSession:l,onDecisionIdChange:c})=>{const d=Ge(),[u,h]=f.useState(!1),[p,m]=f.useState(t?.topic||""),[x,g]=f.useState(t?.context||""),[y,v]=f.useState(t?.pros||[{id:nr(),text:"",weight:5}]),[k,S]=f.useState(t?.cons||[{id:nr(),text:"",weight:5}]),[w,b]=f.useState(!1),[T,C]=f.useState(null),[j,R]=f.useState(null),[I,A]=f.useState(!1),[L,B]=f.useState(!1),P=Cn.useRef(null),[_,O]=f.useState({activePersona:null,isLoading:!1,suggestions:[]}),[W,D]=f.useState(new Set),N=f.useMemo(()=>y.reduce((X,he)=>X+(he.text.trim()?he.weight:0),0),[y]),F=f.useMemo(()=>k.reduce((X,he)=>X+(he.text.trim()?he.weight:0),0),[k]),ne=y.some(X=>X.text.trim()),re=k.some(X=>X.text.trim()),Z=p.trim()&&(ne||re),ee=f.useCallback(async()=>{if(P.current&&clearTimeout(P.current),!p.trim()||!a||!l)return;const X={topic:p,context:x,pros:y,cons:k,proScore:N,contraScore:F};B(!0);try{if(o)await l(o,{...X,status:"draft"}),console.log("[DecisionBoard] Auto-saved (update):",o);else{const he=await a(X);he&&c&&c(he),console.log("[DecisionBoard] Auto-saved (create):",he)}}catch(he){console.error("[DecisionBoard] Auto-save failed:",he)}finally{B(!1)}},[p,x,y,k,N,F,o,a,l,c]),se=f.useCallback(()=>{P.current&&clearTimeout(P.current),ee()},[ee]);Cn.useEffect(()=>()=>{P.current&&clearTimeout(P.current)},[]);const z=f.useCallback(()=>{const X=nr();v(he=>[...he,{id:X,text:"",weight:5}]),R(X)},[]),V=f.useCallback(()=>{const X=nr();S(he=>[...he,{id:X,text:"",weight:5}]),R(X)},[]),H=f.useCallback((X,he)=>{v(be=>be.map(ue=>ue.id===X?{...ue,...he}:ue))},[]),pe=f.useCallback((X,he)=>{S(be=>be.map(ue=>ue.id===X?{...ue,...he}:ue))},[]),Te=f.useCallback(X=>{v(he=>he.filter(be=>be.id!==X))},[]),Le=f.useCallback(X=>{S(he=>he.filter(be=>be.id!==X))},[]),we=f.useCallback(async X=>{O(he=>({...he,activePersona:X,isLoading:!0,suggestions:[]}));try{const he=window.bewerbungstrainerConfig?.geminiApiKey;if(!he)throw new Error("API-Key nicht konfiguriert");const be=x.trim()||null,ue=await ff(p,X,he,be,y,k);O(gt=>({...gt,isLoading:!1,suggestions:ue.suggestions||[]}))}catch(he){console.error("[DecisionBoard] Brainstorm error:",he),O(be=>({...be,isLoading:!1,suggestions:[]})),C(he.message||"Fehler beim Brainstorming")}},[p,x,y,k]),Qe=f.useCallback(()=>{O({activePersona:null,isLoading:!1,suggestions:[]})},[]),ye=f.useCallback(X=>{const he=`${X.type}-${X.text}`;D(ue=>new Set([...ue,he]));const be={id:nr(),text:X.text,weight:5};X.type==="pro"?v(ue=>ue.length===1&&!ue[0].text.trim()?[be]:[...ue,be]):S(ue=>ue.length===1&&!ue[0].text.trim()?[be]:[...ue,be])},[]),Ee=f.useCallback(async()=>{const{activePersona:X,suggestions:he}=_;if(X){O(be=>({...be,isLoading:!0}));try{const be=window.bewerbungstrainerConfig?.geminiApiKey;if(!be)throw new Error("API-Key nicht konfiguriert");const ue=he.filter(xe=>xe.type==="pro").map(xe=>({text:xe.text})),gt=he.filter(xe=>xe.type==="con").map(xe=>({text:xe.text})),lt=[...y,...ue],je=[...k,...gt],fe=x.trim()||null,oe=await ff(p,X,be,fe,lt,je);O(xe=>({...xe,isLoading:!1,suggestions:[...xe.suggestions,...oe.suggestions||[]]}))}catch(be){console.error("[DecisionBoard] Load more error:",be),O(ue=>({...ue,isLoading:!1})),C(be.message||"Fehler beim Laden weiterer Vorschlge")}}},[_,p,x,y,k]),Ke=f.useCallback(X=>{g(he=>he.trim()?he.trim()+`

`+X:X)},[]),Me=f.useCallback(X=>{X.forEach(he=>{const be={id:nr(),text:he.text,weight:he.weight||5};he.type==="pro"?v(ue=>ue.length===1&&!ue[0].text.trim()?[be]:[...ue,be]):S(ue=>ue.length===1&&!ue[0].text.trim()?[be]:[...ue,be])}),setTimeout(()=>ee(),100)},[ee]),et=f.useCallback(async()=>{if(Z){b(!0),C(null);try{const X=window.bewerbungstrainerConfig?.geminiApiKey;if(!X)throw new Error("API-Key nicht konfiguriert");const he=y.filter(lt=>lt.text.trim()),be=k.filter(lt=>lt.text.trim()),ue={topic:p,context:x.trim()||null,pros:he,cons:be,proScore:N,contraScore:F},gt=await g2(ue,X);e(ue,gt)}catch(X){console.error("[DecisionBoard] Analysis error:",X),C(X.message||"Fehler bei der Analyse")}finally{b(!1)}}},[p,x,y,k,N,F,Z,e]);return i.jsxs("div",{style:{padding:d.space[4],maxWidth:"1200px",margin:"0 auto"},children:[n&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:d.space[4]},children:i.jsxs("button",{onClick:()=>h(!0),style:{display:"flex",alignItems:"center",gap:d.space[2],padding:`${d.space[2]} ${d.space[4]}`,borderRadius:d.radius.md,border:`1px solid ${d.borderColor}`,backgroundColor:d.cardBgColor,color:d.textSecondary,cursor:"pointer",fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,transition:d.transition.normal},onMouseEnter:X=>{X.currentTarget.style.backgroundColor=d.errorLight,X.currentTarget.style.borderColor=d.error,X.currentTarget.style.color=d.errorDark},onMouseLeave:X=>{X.currentTarget.style.backgroundColor=d.cardBgColor,X.currentTarget.style.borderColor=d.borderColor,X.currentTarget.style.color=d.textSecondary},children:[i.jsx(Bt,{size:d.iconSize.md}),"Abbrechen"]})}),i.jsxs("div",{style:{marginBottom:d.space[6],textAlign:"center"},children:[i.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:d.space[15],height:d.space[15],borderRadius:d.radius.lg,background:d.headerGradient,marginBottom:d.space[3],boxShadow:d.coloredShadow(d.primaryAccent,"lg")},children:i.jsx(ci,{size:d.iconSize["2xl"],color:d.white})}),i.jsx("h1",{style:{fontSize:d.fontSize["4xl"],fontWeight:d.fontWeight.bold,color:d.textMain,marginBottom:d.space[1.5]},children:"Der Entscheidungs-Kompass"}),i.jsx("p",{style:{fontSize:d.fontSize.base,color:d.textSecondary,maxWidth:"600px",margin:"0 auto",padding:`0 ${d.space[2]}`},children:"Analysiere deine Entscheidung objektiv. Gewichte Pro und Contra, und erhalte KI-gesttzte Impulse fr blinde Flecken."})]}),i.jsxs(it,{variant:"elevated",padding:"lg",style:{marginBottom:d.space[4]},children:[i.jsx(Nr,{children:i.jsx(zr,{icon:Be,size:"md",children:"Deine Entscheidungsfrage"})}),i.jsxs(pt,{children:[i.jsx(kn,{value:p,onChange:X=>m(X.target.value),onBlur:se,placeholder:"z.B. Soll ich das Jobangebot annehmen?",style:{fontSize:d.fontSize.lg,padding:d.space[4],borderRadius:d.radius.lg,marginBottom:d.space[4]}}),i.jsxs("div",{style:{marginTop:d.space[2]},children:[i.jsx("label",{style:{display:"block",fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:d.textSecondary,marginBottom:d.space[2]},children:"Beschreibe die Situation (optional)"}),i.jsxs("div",{className:"context-input-wrapper",style:{display:"flex",flexWrap:"wrap",alignItems:"flex-end",gap:d.space[3]},children:[i.jsx(Ri,{value:x,onChange:X=>g(X.target.value),onBlur:se,placeholder:"Hintergrund, Rahmenbedingungen, Gefhle, was dich beschftigt...",rows:3,style:{flex:"1 1 300px",minWidth:0,fontSize:d.fontSize.md,padding:`${d.space[3]} ${d.space[4]}`,borderRadius:d.radius.lg,resize:"vertical",minHeight:"80px"}}),i.jsx("div",{style:{flexShrink:0,paddingBottom:d.space[1]},children:i.jsx(WP,{onTranscriptReady:Ke})})]})]})]})]}),i.jsx(JP,{topic:p,onSelectPersona:we,activePersona:_.activePersona,isLoading:_.isLoading,suggestions:_.suggestions,onCloseBrainstorm:Qe,onAddSuggestion:ye,onLoadMore:Ee,addedSuggestions:W,b:d}),i.jsx(it,{variant:"elevated",padding:"lg",style:{marginBottom:d.space[4],cursor:p.trim()?"pointer":"not-allowed",opacity:p.trim()?1:.6,transition:d.transition.normal},onClick:()=>p.trim()&&A(!0),children:i.jsxs("div",{className:"deep-dive-card-content",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:d.space[3],flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[3],flex:"1 1 auto",minWidth:"200px"},children:[i.jsx("div",{style:{width:d.space[10],height:d.space[10],borderRadius:d.radius.md,background:d.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(u0,{size:d.iconSize.lg,color:"white"})}),i.jsxs("div",{style:{minWidth:0},children:[i.jsx("h3",{style:{fontSize:d.fontSize.lg,fontWeight:d.fontWeight.semibold,color:d.textMain,margin:0},children:"Deep Dive Interview"}),i.jsx("p",{style:{fontSize:d.fontSize.sm,color:d.textSecondary,margin:0,lineHeight:1.4},children:"Entdecke verborgene Argumente durch gezielte Coaching-Fragen"})]})]}),i.jsxs(de,{variant:"solid",size:"sm",disabled:!p.trim(),onClick:X=>{X.stopPropagation(),p.trim()&&A(!0)},style:{background:p.trim()?d.headerGradient:void 0,flexShrink:0},children:[i.jsx(st,{size:d.iconSize.md,style:{marginRight:d.space[1.5]}}),"Starten"]})]})}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 380px), 1fr))",gap:d.space[4],marginBottom:d.space[6]},children:[i.jsxs("div",{className:"decision-card-pro",style:{backgroundColor:d.cardBgColor,borderRadius:d.radius.lg,padding:d.space[6],boxShadow:d.shadow.md},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[3],marginBottom:d.space[4]},children:[i.jsx("div",{style:{width:d.space[10],height:d.space[10],borderRadius:d.radius.md,backgroundColor:d.successLight,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Gn,{size:d.iconSize.lg,color:d.successDark})}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:d.fontSize.xl,fontWeight:d.fontWeight.semibold,color:d.successDark,margin:0},children:"PRO"}),i.jsx("p",{style:{fontSize:d.fontSize.base,color:d.textSecondary,margin:0},children:"Was spricht dafr?"})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[3]},children:[i.jsx(Ve,{mode:"popLayout",children:y.map(X=>i.jsx(Jg,{item:X,onUpdate:H,onDelete:Te,onAddNew:z,onBlur:se,color:"green",autoFocus:j===X.id,b:d},X.id))}),i.jsxs(de,{variant:"outline",onClick:z,style:{borderColor:d.success,color:d.successDark,borderStyle:"dashed"},children:[i.jsx(Yt,{size:d.iconSize.md,style:{marginRight:d.space[2]}}),"Argument hinzufgen"]})]})]}),i.jsxs("div",{className:"decision-card-contra",style:{backgroundColor:d.cardBgColor,borderRadius:d.radius.lg,padding:d.space[6],boxShadow:d.shadow.md},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[3],marginBottom:d.space[4]},children:[i.jsx("div",{style:{width:d.space[10],height:d.space[10],borderRadius:d.radius.md,backgroundColor:d.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(us,{size:d.iconSize.lg,color:d.errorDark})}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:d.fontSize.xl,fontWeight:d.fontWeight.semibold,color:d.errorDark,margin:0},children:"CONTRA"}),i.jsx("p",{style:{fontSize:d.fontSize.base,color:d.textSecondary,margin:0},children:"Was spricht dagegen?"})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[3]},children:[i.jsx(Ve,{mode:"popLayout",children:k.map(X=>i.jsx(Jg,{item:X,onUpdate:pe,onDelete:Le,onAddNew:V,onBlur:se,color:"red",autoFocus:j===X.id,b:d},X.id))}),i.jsxs(de,{variant:"outline",onClick:V,style:{borderColor:d.error,color:d.errorDark,borderStyle:"dashed"},children:[i.jsx(Yt,{size:d.iconSize.md,style:{marginRight:d.space[2]}}),"Argument hinzufgen"]})]})]})]}),(ne||re)&&i.jsxs(it,{variant:"elevated",padding:"lg",style:{marginBottom:d.space[6]},children:[i.jsx(Nr,{children:i.jsx(zr,{icon:ci,size:"md",children:"Rationaler Score"})}),i.jsx(pt,{children:i.jsx(qP,{proScore:N,contraScore:F,b:d})})]}),T&&i.jsxs($.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},style:{display:"flex",alignItems:"center",gap:d.space[3],padding:d.space[4],backgroundColor:d.errorLight,border:`1px solid ${d.error}33`,borderRadius:d.radius.lg,marginBottom:d.space[6],color:d.errorDark},children:[i.jsx(Ie,{size:d.iconSize.lg}),i.jsx("span",{children:T})]}),i.jsx("div",{style:{display:"flex",justifyContent:"center"},children:i.jsx(de,{onClick:et,disabled:!Z||w,variant:"solid",size:"lg",style:{padding:`${d.space[4]} ${d.space[8]}`,fontSize:d.fontSize.xl,background:Z?d.headerGradient:void 0,boxShadow:Z?d.coloredShadow(d.primaryAccent,"lg"):void 0},children:w?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:d.iconSize.xl,style:{marginRight:d.space[2.5],animation:"spin 1s linear infinite"}}),"Analyse luft..."]}):i.jsxs(i.Fragment,{children:[i.jsx(st,{size:d.iconSize.xl,style:{marginRight:d.space[2.5]}}),"Entscheidung analysieren"]})})}),i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }

          input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }

          input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }

          /* Mobile responsive: stack controls below textarea */
          @media (max-width: 480px) {
            .decision-item {
              flex-direction: column !important;
            }
            .decision-item-input-row {
              width: 100% !important;
              flex: 1 1 100% !important;
            }
            .decision-item-controls {
              width: 100% !important;
              justify-content: flex-start !important;
              padding-left: 32px;
            }
          }
        `}),i.jsx(Ve,{children:u&&i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:d.zIndex.modal,padding:d.space[4]},onClick:()=>h(!1),children:i.jsxs($.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:X=>X.stopPropagation(),style:{backgroundColor:d.cardBgColor,borderRadius:d.radius.xl,padding:d.space[6],maxWidth:"400px",width:"100%",boxShadow:d.shadow.xl},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[3],marginBottom:d.space[4]},children:[i.jsx("div",{style:{width:d.space[10],height:d.space[10],borderRadius:d.radius.md,backgroundColor:d.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Ie,{size:d.iconSize.xl,color:d.error})}),i.jsx("h3",{style:{fontSize:d.fontSize.xl,fontWeight:d.fontWeight.semibold,color:d.textMain,margin:0},children:"Session abbrechen?"})]}),i.jsx("p",{style:{fontSize:d.fontSize.base,color:d.textSecondary,marginBottom:d.space[6],lineHeight:1.5},children:"Alle eingegebenen Daten werden verworfen und nicht gespeichert."}),i.jsxs("div",{style:{display:"flex",gap:d.space[3],justifyContent:"flex-end"},children:[i.jsx(de,{variant:"outline",onClick:()=>h(!1),children:"Zurck"}),i.jsxs(de,{variant:"solid",onClick:()=>{h(!1),n()},style:{backgroundColor:d.error,color:d.white},children:[i.jsx(Bt,{size:d.iconSize.md,style:{marginRight:d.space[2]}}),"Abbrechen"]})]})]})})}),i.jsx(GP,{isOpen:I,onClose:()=>A(!1),topic:p,existingPros:y,existingCons:k,onAddItems:Me})]})},Ac=({b:t})=>i.jsxs("div",{style:{padding:t.space[6],borderRadius:t.radius.xl,backgroundColor:t.cardBgHover,border:`1px solid ${t.borderColor}`},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:t.radius.lg,backgroundColor:t.borderColor,marginBottom:t.space[4],animation:"pulse 1.5s ease-in-out infinite"}}),i.jsx("div",{style:{width:"60%",height:"24px",borderRadius:t.radius.md,backgroundColor:t.borderColor,marginBottom:t.space[3],animation:"pulse 1.5s ease-in-out infinite"}}),i.jsx("div",{style:{width:"100%",height:"16px",borderRadius:t.radius.sm,backgroundColor:t.borderColor,marginBottom:t.space[2],animation:"pulse 1.5s ease-in-out infinite"}}),i.jsx("div",{style:{width:"85%",height:"16px",borderRadius:t.radius.sm,backgroundColor:t.borderColor,animation:"pulse 1.5s ease-in-out infinite"}})]}),Xg=t=>t&&t.split(/(\*\*[^*]+\*\*)/g).map((n,s)=>n.startsWith("**")&&n.endsWith("**")?i.jsx("strong",{children:n.slice(2,-2)},s):n),YP=({card:t,index:e,b:n})=>{const s={blind_spot:{bgColor:n.warningLight,borderColor:n.warning,iconBg:"#fef08a",iconColor:n.warningDark,bulletColor:n.warningDark,icon:Be},challenger:{bgColor:n.errorLight,borderColor:"#fca5a5",iconBg:n.errorLight,iconColor:n.error,bulletColor:n.error,icon:Jj},intuition:{bgColor:"#f5f3ff",borderColor:"#c4b5fd",iconBg:"#ede9fe",iconColor:"#7c3aed",bulletColor:"#7c3aed",icon:Vs}},r=s[t.type]||s.blind_spot,o=r.icon,a=t.points||(t.content?[t.content]:[]);return i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:e*.15},style:{padding:n.space[6],borderRadius:n.radius.xl,backgroundColor:r.bgColor,border:`2px solid ${r.borderColor}`,height:"100%",display:"flex",flexDirection:"column"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:n.radius.lg,backgroundColor:r.iconBg,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:n.space[4]},children:i.jsx(o,{size:n.iconSize["2xl"],color:r.iconColor})}),i.jsx("h3",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.bold,color:n.textMain,marginBottom:n.space[3]},children:t.title}),t.type==="challenger"&&t.argument&&i.jsxs("div",{style:{padding:`${n.space[2.5]} ${n.space[3.5]}`,backgroundColor:"rgba(255,255,255,0.6)",borderRadius:n.radius.md,marginBottom:n.space[3],borderLeft:`3px solid ${r.bulletColor}`},children:[i.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.textSecondary,display:"block",marginBottom:"2px"},children:"Hinterfragtes Argument:"}),i.jsxs("span",{style:{fontSize:n.fontSize.md,fontWeight:n.fontWeight.semibold,color:n.textMain},children:['"',t.argument,'"']})]}),t.type==="intuition"&&t.question&&i.jsxs("div",{style:{padding:`${n.space[2.5]} ${n.space[3.5]}`,backgroundColor:"rgba(255,255,255,0.6)",borderRadius:n.radius.md,marginBottom:n.space[3],borderLeft:`3px solid ${r.bulletColor}`},children:[i.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.textSecondary,display:"block",marginBottom:"2px"},children:"Reflexionsfrage:"}),i.jsx("span",{style:{fontSize:n.fontSize.md,fontWeight:n.fontWeight.semibold,color:n.textMain,fontStyle:"italic"},children:Xg(t.question)})]}),i.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,flex:1},children:a.map((l,c)=>i.jsxs("li",{style:{display:"flex",alignItems:"flex-start",gap:n.space[2.5],marginBottom:n.space[2.5],fontSize:n.fontSize.md,lineHeight:1.5,color:n.textSecondary},children:[i.jsx("span",{style:{width:"6px",height:"6px",borderRadius:n.radius.full,backgroundColor:r.bulletColor,marginTop:"8px",flexShrink:0}}),i.jsx("span",{children:Xg(l)})]},c))})]})},XP=({proScore:t,contraScore:e,b:n})=>{const s=t+e,r=s>0?Math.round(t/s*100):50,o=100-r,a=t>e?"pro":t<e?"contra":"neutral";return i.jsxs(it,{variant:"elevated",padding:"lg",style:{marginBottom:n.space[6]},children:[i.jsx(Nr,{children:i.jsx(zr,{icon:ci,size:"lg",children:"Rationaler Score"})}),i.jsxs(pt,{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:n.space[3]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[i.jsx(Gn,{size:n.iconSize.lg,color:n.success}),i.jsxs("span",{style:{fontSize:n.fontSize["4xl"],fontWeight:n.fontWeight.bold,color:n.success},children:[r,"%"]}),i.jsxs("span",{style:{color:n.textSecondary,fontSize:n.fontSize.base},children:["(",t," Punkte)"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[i.jsxs("span",{style:{color:n.textSecondary,fontSize:n.fontSize.base},children:["(",e," Punkte)"]}),i.jsxs("span",{style:{fontSize:n.fontSize["4xl"],fontWeight:n.fontWeight.bold,color:n.error},children:[o,"%"]}),i.jsx(us,{size:n.iconSize.lg,color:n.error})]})]}),i.jsxs("div",{style:{height:"32px",borderRadius:n.radius.xl,overflow:"hidden",display:"flex",backgroundColor:n.cardBgHover,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:[i.jsx($.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.success} 0%, ${n.successDark} 100%)`,height:"100%"}}),i.jsx($.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.error} 0%, ${n.errorDark} 100%)`,height:"100%"}})]}),i.jsxs("p",{style:{marginTop:n.space[4],textAlign:"center",fontSize:n.fontSize.md,color:n.textSecondary},children:[a==="pro"&&i.jsxs(i.Fragment,{children:["Die Zahlen sprechen ",i.jsx("strong",{style:{color:n.success},children:"fr"})," deine Entscheidung."]}),a==="contra"&&i.jsxs(i.Fragment,{children:["Die Zahlen sprechen ",i.jsx("strong",{style:{color:n.error},children:"gegen"})," deine Entscheidung."]}),a==="neutral"&&i.jsxs(i.Fragment,{children:["Die Argumente sind ",i.jsx("strong",{children:"ausgeglichen"})," - hier lohnt sich ein genauerer Blick."]})]})]})]})},Mv=({decisionData:t,analysisResult:e,onStartNew:n,onEditDecision:s})=>{const r=Ge(),o=!e;return i.jsxs("div",{style:{padding:r.space[6],maxWidth:"1200px",margin:"0 auto"},children:[i.jsxs($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},style:{marginBottom:r.space[8]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:r.space[4]},children:[i.jsxs(de,{variant:"ghost",onClick:s,children:[i.jsx(ft,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Bearbeiten"]}),i.jsxs(de,{variant:"outline",onClick:n,children:[i.jsx(Ot,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Neue Analyse"]})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"64px",height:"64px",borderRadius:r.radius.xl,background:r.headerGradient,marginBottom:r.space[4],boxShadow:r.coloredShadow(r.primaryAccent,"lg")},children:i.jsx(st,{size:r.iconSize["3xl"],color:r.white})}),i.jsx("h1",{style:{fontSize:r.fontSize["4xl"],fontWeight:r.fontWeight.bold,color:r.textMain,marginBottom:r.space[2]},children:"Deine Entscheidungsanalyse"}),i.jsxs("p",{style:{fontSize:r.fontSize.xl,color:r.textSecondary,fontStyle:"italic"},children:['"',t?.topic,'"']})]})]}),t&&i.jsx(XP,{proScore:t.proScore,contraScore:t.contraScore,b:r}),e?.analysis_summary&&i.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},children:i.jsx(it,{variant:"gradient",padding:"lg",style:{marginBottom:r.space[6]},children:i.jsx(pt,{children:i.jsx("p",{style:{fontSize:r.fontSize.lg,lineHeight:1.7,color:r.textMain,textAlign:"center",fontStyle:"italic"},children:e.analysis_summary})})})}),i.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.3},style:{marginBottom:r.space[8]},children:[i.jsxs("h2",{style:{fontSize:r.fontSize["2xl"],fontWeight:r.fontWeight.bold,color:r.textMain,marginBottom:r.space[5],display:"flex",alignItems:"center",gap:r.space[2.5]},children:[i.jsx(st,{size:r.iconSize.xl,color:r.primaryAccent}),"KI-Coaching Impulse"]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:r.space[5]},children:o?i.jsxs(i.Fragment,{children:[i.jsx(Ac,{b:r}),i.jsx(Ac,{b:r}),i.jsx(Ac,{b:r})]}):e?.cards?.map((a,l)=>i.jsx(YP,{card:a,index:l,b:r},a.type||l))})]}),i.jsxs(it,{variant:"elevated",padding:"lg",children:[i.jsx(Nr,{children:i.jsx(zr,{icon:ci,size:"md",children:"Deine Argumente"})}),i.jsx(pt,{children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:r.space[6]},children:[i.jsxs("div",{children:[i.jsxs("h4",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:r.success,marginBottom:r.space[3],display:"flex",alignItems:"center",gap:r.space[2]},children:[i.jsx(Gn,{size:r.iconSize.md}),"Pro (",t?.proScore," Punkte)"]}),i.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:t?.pros?.map((a,l)=>i.jsxs("li",{style:{padding:`${r.space[2.5]} ${r.space[3.5]}`,backgroundColor:r.successLight,borderRadius:r.radius.md,marginBottom:r.space[2],display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{style:{color:r.successDark},children:a.text}),i.jsx("span",{style:{backgroundColor:"#dcfce7",color:r.success,padding:`2px ${r.space[2]}`,borderRadius:r.radius.sm,fontSize:r.fontSize.sm,fontWeight:r.fontWeight.semibold},children:a.weight})]},a.id||l))})]}),i.jsxs("div",{children:[i.jsxs("h4",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:r.error,marginBottom:r.space[3],display:"flex",alignItems:"center",gap:r.space[2]},children:[i.jsx(us,{size:r.iconSize.md}),"Contra (",t?.contraScore," Punkte)"]}),i.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:t?.cons?.map((a,l)=>i.jsxs("li",{style:{padding:`${r.space[2.5]} ${r.space[3.5]}`,backgroundColor:r.errorLight,borderRadius:r.radius.md,marginBottom:r.space[2],display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{style:{color:r.errorDark},children:a.text}),i.jsx("span",{style:{backgroundColor:"#fee2e2",color:r.error,padding:`2px ${r.space[2]}`,borderRadius:r.radius.sm,fontSize:r.fontSize.sm,fontWeight:r.fontWeight.semibold},children:a.weight})]},a.id||l))})]})]})})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:r.space[4],marginTop:r.space[8]},children:[i.jsxs(de,{variant:"outline",size:"lg",onClick:s,children:[i.jsx(Ho,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Argumente anpassen"]}),i.jsxs(de,{variant:"solid",size:"lg",onClick:n,style:{background:r.headerGradient},children:[i.jsx(Ot,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Neue Entscheidung"]})]}),i.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
        `})]})},fs=({isOpen:t,onClose:e,onConfirm:n,title:s="Lschen besttigen",description:r="Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:o=!1,confirmLabel:a="Lschen",cancelLabel:l="Abbrechen"})=>{const{branding:c}=qe(),d=c?.["--primary-accent"]||_e["--primary-accent"];return i.jsx(ii,{open:t,onOpenChange:e,children:i.jsxs(si,{style:{maxWidth:"400px"},children:[i.jsxs(ri,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{style:{width:"20px",height:"20px",color:"#fff"}})}),i.jsx(oi,{children:s})]}),i.jsx(Pi,{children:r})]}),i.jsxs(Mi,{style:{marginTop:"16px"},children:[i.jsx("button",{onClick:e,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:`2px solid ${d}`,backgroundColor:"white",color:d,fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s"},children:l}),i.jsx("button",{onClick:n,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:o?i.jsxs(i.Fragment,{children:[i.jsx(me,{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"}}),a,"..."]}):a})]})]})})},ZP=({briefing:t,onClick:e,onDelete:n,headerGradient:s,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=xn(900),h=AP(t.template_icon),p=x=>{x.stopPropagation(),d(!0)},m=async()=>{l(!0);try{await n(t.id),d(!1)}catch(x){console.error("Error deleting briefing:",x)}finally{l(!1)}};return u?i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[i.jsxs("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(h,{style:{width:"22px",height:"22px",color:o}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.title||"Briefing"}),i.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Di(t.created_at)})]}),i.jsx("button",{onClick:p,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[i.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"4px 10px",borderRadius:"10px",fontSize:"12px",fontWeight:500,maxWidth:"70%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.template_title}),i.jsx(Et,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[i.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:x=>{x.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",x.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:x=>{x.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",x.currentTarget.style.borderColor="#e2e8f0"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(h,{style:{width:"24px",height:"24px",color:o}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title||"Briefing"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[i.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"2px 8px",borderRadius:"10px",fontSize:"12px",fontWeight:500},children:t.template_title}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(qn,{size:14}),Di(t.created_at)]})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[i.jsx("button",{onClick:p,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})}),i.jsx(Et,{size:20,style:{color:"#94a3b8"}})]})]})}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},vi={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},QP=({session:t,type:e,scenario:n,onClick:s,onContinueSession:r,onDeleteSession:o,headerGradient:a,headerText:l,primaryAccent:c})=>{const[d,u]=f.useState(!1),[h,p]=f.useState(!1),m=xn(900),x=()=>{let P=null;if(e===vi.SIMULATOR)P=t.overall_score||t.average_score;else if(e===vi.VIDEO)P=t.overall_score;else if(t.feedback_json)try{let _=t.feedback_json;if(typeof _=="string"){let O=_.trim();O.startsWith("```json")?O=O.replace(/```json\s*/g,"").replace(/```\s*$/g,""):O.startsWith("```")&&(O=O.replace(/```\s*/g,"").replace(/```\s*$/g,"")),_=JSON.parse(O)}P=_.rating?.overall||null}catch{P=null}return P==null||isNaN(P)||P===0?null:P},g=()=>e===vi.SIMULATOR||e===vi.VIDEO?t.status:t.feedback_json?"completed":"pending",y=x(),k=g()==="completed",S=t.total_questions>0&&(t.completed_questions||0)<t.total_questions,w=e===vi.SIMULATOR&&S,b=()=>{if(!w)return null;const P=t.completed_questions||0,_=t.total_questions||0;return`${P}/${_} Fragen`},T=P=>{P.stopPropagation(),r&&r(t,n)},C=P=>{P.stopPropagation(),p(!0)},j=async()=>{u(!0);try{await o(t,e),p(!1)}catch(P){console.error("Error deleting session:",P)}finally{u(!1)}},I=(()=>{if(y==null||isNaN(y))return null;if(e===vi.SIMULATOR||e===vi.ROLEPLAY){const P=y<=10?y*10:y;return isNaN(P)?null:P}return isNaN(y)?null:y})(),A=P=>{if(!P&&P!==0)return{background:"#f1f5f9",color:"#64748b"};const _=parseFloat(P);return _>=80?{background:"#dcfce7",color:"#166534"}:_>=60?{background:"#fef9c3",color:"#854d0e"}:{background:"#fee2e2",color:"#991b1b"}},B=(()=>{switch(e){case vi.SIMULATOR:return rt;case vi.VIDEO:return jt;default:return Ze}})();return m?i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[i.jsxs("div",{onClick:s,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(B,{style:{width:"22px",height:"22px",color:l}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3"},children:n?.title||t.scenario_title||`Session #${t.id}`}),i.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Di(t.created_at)})]}),o&&i.jsx("button",{onClick:C,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:d?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[!k&&!w&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[i.jsx(Ye,{size:12}),"In Bearbeitung"]}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"5px 10px",borderRadius:"20px",fontSize:"13px",fontWeight:600,...A(I)},children:[i.jsx(Vt,{size:13}),I!==null?`${Math.round(I)}%`:"-- %"]}),(t.duration||t.video_duration_seconds)&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#64748b"},children:[i.jsx(Ye,{size:12}),yt(t.duration||t.video_duration_seconds)]}),w&&i.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()})]}),w&&r?i.jsxs("button",{onClick:T,style:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,flexShrink:0},children:[i.jsx(Lt,{size:14}),"Fortsetzen"]}):i.jsx(Et,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),i.jsx(fs,{isOpen:h,onClose:()=>p(!1),onConfirm:j,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]}):i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[i.jsx("div",{onClick:s,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:P=>{P.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",P.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:P=>{P.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",P.currentTarget.style.borderColor="#e2e8f0"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(B,{style:{width:"24px",height:"24px",color:l}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n?.title||t.scenario_title||`Session #${t.id}`}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(qn,{size:14}),Di(t.created_at)]}),t.duration||t.video_duration_seconds?i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ye,{size:14}),yt(t.duration||t.video_duration_seconds)]}):null]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},children:[w&&r&&i.jsxs("button",{onClick:T,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,transition:"all 0.2s"},onMouseEnter:P=>{P.currentTarget.style.transform="scale(1.02)",P.currentTarget.style.boxShadow=`0 4px 12px ${c||"#3B82F6"}50`},onMouseLeave:P=>{P.currentTarget.style.transform="scale(1)",P.currentTarget.style.boxShadow=`0 2px 8px ${c||"#3B82F6"}40`},children:[i.jsx(Lt,{size:14}),"Fortsetzen"]}),w&&i.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()}),!k&&!w&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[i.jsx(Ye,{size:12}),"In Bearbeitung"]}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"20px",fontSize:"14px",fontWeight:600,...A(I)},children:[i.jsx(Vt,{size:14}),I!==null?`${Math.round(I)}%`:"-- %"]}),o&&i.jsx("button",{onClick:C,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:P=>{P.currentTarget.style.color="#ef4444"},onMouseLeave:P=>{P.currentTarget.style.color="#94a3b8"},title:"Lschen",children:d?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})}),i.jsx(Et,{size:20,style:{color:"#94a3b8"}})]})]})}),i.jsx(fs,{isOpen:h,onClose:()=>p(!1),onConfirm:j,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]})},Zg=({proScore:t,contraScore:e})=>{const n=t+e,s=n>0?Math.round(t/n*100):50;return i.jsxs("div",{style:{height:"6px",borderRadius:"3px",overflow:"hidden",display:"flex",backgroundColor:"#f1f5f9",width:"100%",maxWidth:"120px"},children:[i.jsx("div",{style:{background:"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)",width:`${s}%`,height:"100%"}}),i.jsx("div",{style:{background:"linear-gradient(90deg, #ef4444 0%, #dc2626 100%)",width:`${100-s}%`,height:"100%"}})]})},eD=({decision:t,onClick:e,onDelete:n,headerGradient:s,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=xn(900),h=(t.pros||[]).reduce((v,k)=>v+(k.text?.trim()?k.weight||5:0),0),p=(t.cons||[]).reduce((v,k)=>v+(k.text?.trim()?k.weight||5:0),0),m=(t.pros||[]).filter(v=>v.text?.trim()).length,x=(t.cons||[]).filter(v=>v.text?.trim()).length,g=v=>{v.stopPropagation(),d(!0)},y=async()=>{l(!0);try{await n(t.id),d(!1)}catch(v){console.error("Error deleting decision:",v)}finally{l(!1)}};return u?i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[i.jsxs("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf615, #8b5cf630)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(ci,{style:{width:"22px",height:"22px",color:"#8b5cf6"}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.topic||"Entscheidung"}),i.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Di(t.created_at)})]}),i.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Gn,{size:14,color:"#16a34a"}),i.jsx("span",{style:{fontSize:"13px",fontWeight:500,color:"#16a34a"},children:m})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(us,{size:14,color:"#dc2626"}),i.jsx("span",{style:{fontSize:"13px",fontWeight:500,color:"#dc2626"},children:x})]}),i.jsx(Zg,{proScore:h,contraScore:p})]}),i.jsx(Et,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Entscheidung lschen",description:"Mchtest du diese Entscheidung wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[i.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",v.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",v.currentTarget.style.borderColor="#e2e8f0"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf615, #8b5cf630)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(ci,{style:{width:"24px",height:"24px",color:"#8b5cf6"}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"6px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.topic||"Entscheidung"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Gn,{size:14,color:"#16a34a"}),i.jsxs("span",{style:{fontWeight:500,color:"#16a34a"},children:[m," Pro"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(us,{size:14,color:"#dc2626"}),i.jsxs("span",{style:{fontWeight:500,color:"#dc2626"},children:[x," Contra"]})]})]}),i.jsx(Zg,{proScore:h,contraScore:p}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(qn,{size:14}),Di(t.created_at)]})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[i.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})}),i.jsx(Et,{size:20,style:{color:"#94a3b8"}})]})]})}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Entscheidung lschen",description:"Mchtest du diese Entscheidung wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},tD={love:{icon:Vs,color:"#E11D48",label:"Liebe"},talent:{icon:Vt,color:"#F59E0B",label:"Talent"},need:{icon:Wr,color:"#10B981",label:"Welt"},market:{icon:Eu,color:"#6366F1",label:"Markt"}},Qg=({dimensions:t})=>i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:Object.entries(tD).map(([e,n])=>{const s=t?.[e]||[],r=s.length>0,o=n.icon;return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:500,backgroundColor:r?`${n.color}15`:"#f1f5f9",color:r?n.color:"#94a3b8",border:r?`1px solid ${n.color}30`:"1px solid #e2e8f0"},children:[i.jsx(o,{size:12}),i.jsx("span",{children:s.length})]},e)})}),nD=({ikigai:t,onDelete:e,onNavigate:n,headerGradient:s,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=xn(900),h={love:t.love_tags||[],talent:t.talent_tags||[],need:t.need_tags||[],market:t.market_tags||[]},p=Object.values(h).filter(v=>v.length>0).length,m=t.status==="completed",x=t.paths?.[0]?.role_title||(m?"Ikigai-Analyse abgeschlossen":"Ikigai-Analyse"),g=v=>{v.stopPropagation(),d(!0)},y=async()=>{l(!0);try{await e(t.id),d(!1)}catch(v){console.error("Error deleting ikigai:",v)}finally{l(!1)}};return u?i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[i.jsxs("div",{onClick:n,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:m?"linear-gradient(135deg, #E11D48, #F59E0B, #10B981, #6366F1)":"linear-gradient(135deg, #6366F115, #6366F130)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(Vn,{style:{width:"22px",height:"22px",color:m?"white":"#6366F1"}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:x}),i.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Di(t.created_at)})]}),i.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[i.jsx(Qg,{dimensions:h}),i.jsx(Et,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Ikigai-Analyse lschen",description:"Mchtest du diese Ikigai-Analyse wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):i.jsxs($.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[i.jsx("div",{onClick:n,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",v.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",v.currentTarget.style.borderColor="#e2e8f0"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:m?"linear-gradient(135deg, #E11D48, #F59E0B, #10B981, #6366F1)":"linear-gradient(135deg, #6366F115, #6366F130)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(Vn,{style:{width:"24px",height:"24px",color:m?"white":"#6366F1"}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:x}),m&&i.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:600,background:"linear-gradient(135deg, #22c55e, #16a34a)",color:"white"},children:"Abgeschlossen"}),!m&&p>0&&i.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:600,background:"#f59e0b20",color:"#f59e0b"},children:[p,"/4 Dimensionen"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[i.jsx(Qg,{dimensions:h}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(qn,{size:14}),Di(t.created_at)]})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[i.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})}),i.jsx(Et,{size:20,style:{color:"#94a3b8"}})]})]})}),i.jsx(fs,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Ikigai-Analyse lschen",description:"Mchtest du diese Ikigai-Analyse wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},eo={love:Vs,talent:Vt,need:Wr,market:Eu},Pv=({dimensions:t,DIMENSIONS:e,onExtractKeywords:n,onUpdateDimension:s,onRemoveTag:r,allDimensionsFilled:o,onSynthesize:a,isSynthesizing:l})=>{const c=Ge(),d=xn(768),[u,h]=f.useState(null),[p,m]=f.useState(""),[x,g]=f.useState(!1),y=f.useRef(null);f.useEffect(()=>{u&&y.current&&y.current.focus()},[u]);const v=u?e[u]:null,k=I=>{h(I),m(t[I]?.input||"")},S=async()=>{if(!(!p.trim()||!u||x)){g(!0);try{const I=await n(u,p.trim());if(I&&I.length>0){const A=t[u]?.tags||[],L=[...new Set([...A,...I])];await s(u,p.trim(),L)}h(null),m("")}catch(I){console.error("[IkigaiCompass] Extraction failed:",I)}finally{g(!1)}}},w=I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),S())},b=I=>t[I]?.tags?.length>0,T=Object.keys(t).filter(I=>b(I)).length,C=(I,A)=>{const L=eo[I],B=b(I),P=t[I]?.tags||[];return i.jsxs($.div,{whileTap:{scale:.98},onClick:()=>k(I),style:{background:c.cardBgColor,borderRadius:c.radius.xl,padding:c.space[4],cursor:"pointer",border:`2px solid ${B?A.color:c.borderColor}`,boxShadow:B?c.coloredShadow(A.color,"sm"):c.shadow.xs},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[3],marginBottom:c.space[3]},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:c.radius.lg,background:`${A.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(L,{size:22,style:{color:A.color}})}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h3",{style:{fontSize:c.fontSize.base,fontWeight:c.fontWeight.semibold,color:c.textMain,marginBottom:"2px"},children:A.label}),i.jsx("p",{style:{fontSize:c.fontSize.xs,color:c.textMuted},children:A.description})]}),B&&i.jsx("div",{style:{width:"24px",height:"24px",borderRadius:c.radius.full,background:A.color,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("span",{style:{color:"white",fontSize:c.fontSize.xs,fontWeight:c.fontWeight.bold},children:""})})]}),P.length>0?i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:c.space[2]},children:[P.slice(0,4).map((_,O)=>i.jsx("span",{style:{padding:`${c.space[1]} ${c.space[2]}`,borderRadius:c.radius.full,fontSize:c.fontSize.xs,fontWeight:c.fontWeight.medium,background:A.color,color:"white"},children:_},O)),P.length>4&&i.jsxs("span",{style:{padding:`${c.space[1]} ${c.space[2]}`,borderRadius:c.radius.full,fontSize:c.fontSize.xs,fontWeight:c.fontWeight.medium,background:`${A.color}20`,color:A.color},children:["+",P.length-4]})]}):i.jsx("p",{style:{fontSize:c.fontSize.sm,color:c.textMuted,fontStyle:"italic"},children:"Tippe, um auszufllen..."})]},I)},j=(I,A,L)=>{const B=eo[I],P=b(I),_=t[I]?.tags||[],O="min(200px, 22vw)";return i.jsx($.div,{style:{gridArea:L,width:O,height:O,cursor:"pointer",justifySelf:L==="love"||L==="need"?"end":"start",alignSelf:L==="love"||L==="talent"?"end":"start"},whileHover:{scale:1.03,zIndex:10},whileTap:{scale:.98},onClick:()=>k(I),children:i.jsxs("div",{style:{width:"100%",height:"100%",borderRadius:c.radius.full,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:P?`${A.color}25`:`${A.color}10`,border:`3px solid ${P?A.color:`${A.color}40`}`,boxShadow:P?c.coloredShadow(A.color,"md"):"none",transition:"background 0.3s ease, border 0.3s ease, box-shadow 0.3s ease"},children:[i.jsx(B,{size:28,style:{color:A.color,marginBottom:c.space[1]}}),i.jsx("span",{style:{fontWeight:c.fontWeight.semibold,fontSize:c.fontSize.sm,color:A.color},children:A.label}),i.jsx("span",{style:{fontSize:"11px",color:`${A.color}99`,textAlign:"center",padding:`0 ${c.space[2]}`},children:A.description}),P&&i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"3px",marginTop:c.space[1],padding:`0 ${c.space[1]}`,maxHeight:"44px",overflow:"hidden"},children:[_.slice(0,2).map((W,D)=>i.jsx("span",{style:{padding:"2px 6px",borderRadius:c.radius.full,fontSize:"10px",fontWeight:c.fontWeight.medium,background:A.color,color:"white",maxWidth:"70px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:W},D)),_.length>2&&i.jsxs("span",{style:{padding:"2px 6px",borderRadius:c.radius.full,fontSize:"10px",fontWeight:c.fontWeight.medium,background:`${A.color}30`,color:A.color},children:["+",_.length-2]})]})]})},I)},R={love:"love",talent:"talent",need:"need",market:"market"};return i.jsxs("div",{style:{padding:d?c.space[4]:c.space[8],maxWidth:"900px",margin:"0 auto"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:c.space[6]},children:[i.jsx("h1",{style:{fontSize:d?c.fontSize["2xl"]:c.fontSize["3xl"],fontWeight:c.fontWeight.bold,color:c.textMain,marginBottom:c.space[2]},children:"Der Ikigai-Kompass"}),i.jsx("p",{style:{fontSize:c.fontSize.base,color:c.textSecondary},children:"Entdecke deinen idealen Karrierepfad"}),i.jsx("p",{style:{fontSize:c.fontSize.sm,color:c.textMuted,marginTop:c.space[2]},children:"Klicke auf einen Bereich und erzhle mir davon. Die KI extrahiert die Kernpunkte."})]}),i.jsx("div",{style:{display:"flex",justifyContent:"center",gap:c.space[2],marginBottom:c.space[6],flexWrap:"wrap"},children:Object.entries(e).map(([I,A])=>{const L=eo[I],B=b(I);return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[1],padding:`${c.space[1]} ${c.space[3]}`,borderRadius:c.radius.full,fontSize:c.fontSize.sm,fontWeight:c.fontWeight.medium,background:B?`${A.color}15`:c.cardBgHover,color:B?A.color:c.textMuted,border:`1px solid ${B?A.color:c.borderColor}`},children:[i.jsx(L,{size:14}),i.jsx("span",{children:A.label}),B&&i.jsx("span",{children:""})]},I)})}),d?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:c.space[3],marginBottom:c.space[4]},children:Object.entries(e).map(([I,A])=>C(I,A))}),o&&i.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{display:"flex",justifyContent:"center",marginBottom:c.space[6]},children:i.jsx(de,{onClick:a,disabled:l,size:"lg",style:{background:c.headerGradient,color:"white",padding:`${c.space[3]} ${c.space[6]}`,fontSize:c.fontSize.base,fontWeight:c.fontWeight.semibold,borderRadius:c.radius.xl,boxShadow:c.shadow.lg,display:"flex",alignItems:"center",gap:c.space[2],width:"100%",justifyContent:"center"},children:l?i.jsxs(i.Fragment,{children:[i.jsx(me,{className:"animate-spin",size:20}),i.jsx("span",{children:"Analysiere..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(st,{size:20}),i.jsx("span",{children:"Mein Ikigai finden"}),i.jsx(ds,{size:20})]})})})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"grid",gridTemplateAreas:`
                "love talent"
                "center center"
                "need market"
              `,gridTemplateColumns:"1fr 1fr",gridTemplateRows:"auto auto auto",gap:"-30px",width:"100%",maxWidth:"480px",margin:"0 auto",marginBottom:c.space[4]},children:[Object.entries(e).map(([I,A])=>j(I,A,R[I])),i.jsx($.div,{style:{gridArea:"center",justifySelf:"center",alignSelf:"center",zIndex:10,marginTop:"-50px",marginBottom:"-50px"},animate:{scale:o?[1,1.05,1]:1},transition:{duration:2,repeat:o?1/0:0,ease:"easeInOut"},children:i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:c.radius.full,display:"flex",alignItems:"center",justifyContent:"center",background:o?c.headerGradient:c.cardBgHover,boxShadow:o?c.shadow.lg:c.shadow.sm,border:`2px solid ${o?"transparent":c.borderColor}`},children:i.jsx("span",{style:{color:o?"white":c.textMuted,fontWeight:c.fontWeight.bold,fontSize:c.fontSize.base},children:o?"Ikigai":`${T}/4`})})})]}),o&&i.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{display:"flex",justifyContent:"center",marginBottom:c.space[6]},children:i.jsx(de,{onClick:a,disabled:l,size:"lg",style:{background:c.headerGradient,color:"white",padding:`${c.space[4]} ${c.space[8]}`,fontSize:c.fontSize.lg,fontWeight:c.fontWeight.semibold,borderRadius:c.radius.xl,boxShadow:c.shadow.lg,display:"flex",alignItems:"center",gap:c.space[3]},children:l?i.jsxs(i.Fragment,{children:[i.jsx(me,{className:"animate-spin",size:24}),i.jsx("span",{children:"Analysiere dein Ikigai..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(st,{size:24}),i.jsx("span",{children:"Mein Ikigai finden"}),i.jsx(ds,{size:24})]})})})]}),!d&&i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:c.space[4]},children:Object.entries(e).map(([I,A])=>{const L=t[I]?.tags||[];if(L.length===0)return null;const B=eo[I];return i.jsx(it,{style:{background:`${A.color}08`,border:`1px solid ${A.color}20`},children:i.jsxs(pt,{style:{padding:c.space[4]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[2],marginBottom:c.space[3]},children:[i.jsx(B,{size:18,style:{color:A.color}}),i.jsx("span",{style:{fontWeight:c.fontWeight.semibold,color:A.color},children:A.label})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:c.space[2]},children:[L.map((P,_)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[1],padding:`${c.space[1]} ${c.space[3]}`,borderRadius:c.radius.full,fontSize:c.fontSize.sm,fontWeight:c.fontWeight.medium,background:A.color,color:"white"},children:[i.jsx("span",{children:P}),i.jsx("button",{onClick:O=>{O.stopPropagation(),r(I,P)},style:{background:"none",border:"none",padding:0,cursor:"pointer",opacity:.8,display:"flex"},children:i.jsx(Bt,{size:14,color:"white"})})]},_)),i.jsx("button",{onClick:()=>k(I),style:{padding:`${c.space[1]} ${c.space[3]}`,borderRadius:c.radius.full,fontSize:c.fontSize.sm,fontWeight:c.fontWeight.medium,border:`2px dashed ${A.color}50`,background:"transparent",color:A.color,cursor:"pointer"},children:"+ Mehr"})]})]})},I)})}),i.jsx(Ve,{children:u&&v&&i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,zIndex:c.zIndex.modal,display:"flex",alignItems:"center",justifyContent:"center",background:c.overlayDark,backdropFilter:"blur(4px)",padding:c.space[4]},onClick:I=>{I.target===I.currentTarget&&!x&&h(null)},children:i.jsxs($.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},style:{background:c.cardBgColor,borderRadius:c.radius["2xl"],boxShadow:c.shadow.xl,width:"100%",maxWidth:"500px",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:`${c.space[4]} ${c.space[6]}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${v.color}10`,borderBottom:`1px solid ${v.color}20`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[3]},children:[Cn.createElement(eo[u],{size:28,style:{color:v.color}}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontWeight:c.fontWeight.bold,fontSize:c.fontSize.lg,color:v.color},children:v.label}),i.jsx("p",{style:{fontSize:c.fontSize.sm,color:c.textSecondary},children:v.description})]})]}),i.jsx("button",{onClick:()=>!x&&h(null),disabled:x,style:{padding:c.space[2],borderRadius:c.radius.lg,background:"transparent",border:"none",cursor:"pointer"},children:i.jsx(Bt,{size:20,style:{color:c.textMuted}})})]}),i.jsx("div",{style:{padding:`${c.space[4]} ${c.space[6]}`},children:i.jsx("p",{style:{color:c.textMain,fontSize:c.fontSize.base,fontWeight:c.fontWeight.medium,lineHeight:1.5},children:v.question})}),t[u]?.tags?.length>0&&i.jsxs("div",{style:{padding:`0 ${c.space[6]} ${c.space[4]}`},children:[i.jsx("p",{style:{fontSize:c.fontSize.sm,color:c.textMuted,marginBottom:c.space[2]},children:"Bereits erfasst:"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:c.space[2]},children:t[u].tags.map((I,A)=>i.jsx("span",{style:{padding:`${c.space[1]} ${c.space[3]}`,borderRadius:c.radius.full,fontSize:c.fontSize.sm,fontWeight:c.fontWeight.medium,background:v.color,color:"white"},children:I},A))})]}),i.jsxs("div",{style:{padding:`0 ${c.space[6]} ${c.space[6]}`},children:[i.jsxs("div",{style:{position:"relative"},children:[i.jsx("textarea",{ref:y,value:p,onChange:I=>m(I.target.value),onKeyDown:w,placeholder:v.placeholder,rows:4,disabled:x,style:{width:"100%",padding:c.space[4],paddingRight:c.space[12],borderRadius:c.radius.xl,border:`2px solid ${v.color}30`,resize:"none",fontSize:c.fontSize.base,fontFamily:"inherit",outline:"none",background:c.cardBgColor}}),i.jsx("button",{onClick:S,disabled:!p.trim()||x,style:{position:"absolute",bottom:c.space[4],right:c.space[4],padding:c.space[3],borderRadius:c.radius.full,background:v.color,color:"white",border:"none",cursor:p.trim()&&!x?"pointer":"not-allowed",opacity:p.trim()&&!x?1:.5,display:"flex",alignItems:"center",justifyContent:"center"},children:x?i.jsx(me,{className:"animate-spin",size:20}):i.jsx(pT,{size:20})})]}),i.jsx("p",{style:{fontSize:c.fontSize.xs,color:c.textMuted,marginTop:c.space[2],textAlign:"center"},children:"Drcke Enter zum Absenden oder Shift+Enter fr neue Zeile"})]})]})})})]})},iD={love:Vs,talent:Vt,need:Wr,market:Eu},Dv=({dimensions:t,synthesisResult:e,onStartNew:n,onEdit:s,DIMENSIONS:r})=>{const o=Ge(),a=xn(768),[l,c]=f.useState([]),[d,u]=f.useState(!0);f.useEffect(()=>{(async()=>{try{const[x,g]=await Promise.all([ce.getSimulatorScenarios(),ce.getScenarios()]),y=[...(x?.scenarios||[]).map(v=>({...v,type:"simulator"})),...(g?.scenarios||[]).map(v=>({...v,type:"roleplay"}))];c(y)}catch(x){console.error("[IkigaiResults] Failed to load scenarios:",x)}finally{u(!1)}})()},[]);const h=m=>{if(!m||m.length===0||l.length===0)return[];const x=m.map(y=>y.toLowerCase());return l.map(y=>{const v=[y.title||"",y.category||"",y.tags||"",y.description||""].join(" ").toLowerCase();let k=0;return x.forEach(S=>{v.includes(S)&&(k+=1)}),{...y,matchScore:k}}).filter(y=>y.matchScore>0).sort((y,v)=>v.matchScore-y.matchScore).slice(0,2)},p=[{bg:`${r.love.color}08`,border:r.love.color,accent:r.love.color},{bg:`${r.talent.color}08`,border:r.talent.color,accent:r.talent.color},{bg:`${r.need.color}08`,border:r.need.color,accent:r.need.color}];return i.jsxs("div",{style:{padding:a?o.space[4]:o.space[8],maxWidth:"900px",margin:"0 auto"},children:[i.jsxs($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},style:{textAlign:"center",marginBottom:o.space[8]},children:[i.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:o.space[4]},children:i.jsx("div",{style:{width:a?"64px":"80px",height:a?"64px":"80px",borderRadius:o.radius.full,display:"flex",alignItems:"center",justifyContent:"center",background:o.headerGradient,boxShadow:o.shadow.lg},children:i.jsx(st,{size:a?28:36,color:"white"})})}),i.jsx("h1",{style:{fontSize:a?o.fontSize["2xl"]:o.fontSize["3xl"],fontWeight:o.fontWeight.bold,color:o.textMain,marginBottom:o.space[2]},children:"Dein Ikigai-Kompass"}),i.jsx("p",{style:{fontSize:o.fontSize.base,color:o.textSecondary,maxWidth:"600px",margin:"0 auto",lineHeight:1.6},children:e?.summary||"Basierend auf deinen Eingaben haben wir diese Karrierepfade fr dich identifiziert."})]}),i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},style:{display:"grid",gridTemplateColumns:a?"repeat(2, 1fr)":"repeat(4, 1fr)",gap:o.space[3],marginBottom:o.space[8]},children:Object.entries(r).map(([m,x])=>{const g=iD[m],y=t[m]?.tags||[];return i.jsxs("div",{style:{padding:o.space[3],borderRadius:o.radius.xl,backgroundColor:`${x.color}10`,border:`1px solid ${x.color}30`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[2],marginBottom:o.space[2]},children:[i.jsx(g,{size:16,style:{color:x.color}}),i.jsx("span",{style:{fontWeight:o.fontWeight.semibold,fontSize:o.fontSize.sm,color:x.color},children:x.label})]}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:y.slice(0,3).map((v,k)=>i.jsx("span",{style:{padding:`2px ${o.space[2]}`,borderRadius:o.radius.full,fontSize:o.fontSize.xs,backgroundColor:`${x.color}20`,color:x.color},children:v},k))})]},m)})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:o.space[6],marginBottom:o.space[8]},children:[i.jsx("h2",{style:{fontSize:o.fontSize.xl,fontWeight:o.fontWeight.bold,color:o.textMain},children:"Deine Karrierepfade"}),e?.paths?.map((m,x)=>{const g=p[x%p.length],y=h(m.training_tags);return i.jsxs($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+x*.1},style:{borderRadius:o.radius["2xl"],overflow:"hidden",boxShadow:o.shadow.md,backgroundColor:o.cardBgColor,border:`2px solid ${g.border}30`},children:[i.jsx("div",{style:{padding:a?`${o.space[3]} ${o.space[4]}`:`${o.space[4]} ${o.space[6]}`,backgroundColor:g.border},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3]},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:o.radius.full,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(jn,{size:20,color:"white"})}),i.jsx("h3",{style:{fontSize:a?o.fontSize.lg:o.fontSize.xl,fontWeight:o.fontWeight.bold,color:"white"},children:m.role_title})]})}),i.jsxs("div",{style:{padding:a?o.space[4]:o.space[6]},children:[i.jsx("p",{style:{color:o.textSecondary,marginBottom:o.space[4],lineHeight:1.6,fontSize:o.fontSize.base},children:m.description}),i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:o.space[3],padding:o.space[4],borderRadius:o.radius.xl,marginBottom:o.space[4],backgroundColor:`${g.border}15`},children:[i.jsx(Jt,{size:20,style:{color:g.accent,flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("p",{style:{fontWeight:o.fontWeight.semibold,marginBottom:"4px",color:g.accent},children:"Warum passt das zu dir?"}),i.jsx("p",{style:{color:o.textSecondary,fontSize:o.fontSize.sm},children:m.why_fit})]})]}),m.training_tags&&m.training_tags.length>0&&i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:o.space[2],marginBottom:o.space[4]},children:m.training_tags.map((v,k)=>i.jsxs("span",{style:{padding:`${o.space[1]} ${o.space[3]}`,borderRadius:o.radius.full,fontSize:o.fontSize.xs,fontWeight:o.fontWeight.medium,backgroundColor:`${g.border}20`,color:g.accent},children:["#",v]},k))}),y.length>0&&i.jsxs("div",{style:{borderTop:`1px solid ${o.borderColor}`,paddingTop:o.space[4],marginTop:o.space[4]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[2],marginBottom:o.space[3]},children:[i.jsx(To,{size:18,style:{color:o.textMuted}}),i.jsx("span",{style:{fontWeight:o.fontWeight.semibold,color:o.textSecondary},children:"Passende Trainings:"})]}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:a?"1fr":"repeat(2, 1fr)",gap:o.space[3]},children:y.map((v,k)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3],padding:o.space[3],borderRadius:o.radius.xl,background:o.cardBgColor,border:`1px solid ${o.borderColor}`,cursor:"pointer"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:o.radius.lg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,backgroundColor:v.type==="simulator"?`${o.primaryAccent}15`:"#8B5CF615"},children:v.type==="simulator"?i.jsx(rt,{size:18,style:{color:o.primaryAccent}}):i.jsx(Lt,{size:18,style:{color:"#8B5CF6"}})}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("p",{style:{fontWeight:o.fontWeight.medium,color:o.textMain,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:v.title}),i.jsx("p",{style:{fontSize:o.fontSize.xs,color:o.textMuted},children:v.type==="simulator"?"Szenario-Training":"Live-Simulation"})]}),i.jsx(Et,{size:18,style:{color:o.textMuted}})]},k))})]}),!d&&y.length===0&&i.jsx("div",{style:{borderTop:`1px solid ${o.borderColor}`,paddingTop:o.space[4],marginTop:o.space[4]},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[2],color:o.textMuted},children:[i.jsx(To,{size:18}),i.jsx("span",{style:{fontSize:o.fontSize.sm},children:"Entdecke unsere Trainings im Men links"})]})})]})]},x)})]}),i.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},style:{display:"flex",flexDirection:a?"column":"row",justifyContent:"center",gap:o.space[4]},children:[i.jsxs(de,{onClick:s,variant:"outline",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:o.space[2],padding:`${o.space[3]} ${o.space[6]}`,borderRadius:o.radius.xl,fontWeight:o.fontWeight.medium,borderWidth:"2px",borderColor:o.primaryAccent,color:o.primaryAccent,background:"transparent"},children:[i.jsx(Ho,{size:20}),i.jsx("span",{children:"Anpassen"})]}),i.jsxs(de,{onClick:n,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:o.space[2],padding:`${o.space[3]} ${o.space[6]}`,borderRadius:o.radius.xl,fontWeight:o.fontWeight.medium,color:"white",background:o.headerGradient,boxShadow:o.shadow.md},children:[i.jsx(Ot,{size:20}),i.jsx("span",{children:"Neu starten"})]})]}),(!e?.paths||e.paths.length===0)&&i.jsxs("div",{style:{textAlign:"center",padding:`${o.space[12]} 0`},children:[i.jsx("p",{style:{color:o.textMuted},children:"Du bist einzigartig - wir brauchen mehr Details, um passende Pfade zu finden."}),i.jsx(de,{onClick:s,style:{marginTop:o.space[4],padding:`${o.space[3]} ${o.space[6]}`,borderRadius:o.radius.xl,fontWeight:o.fontWeight.medium,color:"white",background:o.headerGradient},children:"Zurck zur Eingabe"})]})]})},em={love:{key:"love",label:"Liebe",icon:"",color:"#E11D48",question:"Vergiss mal Geld und Karriere. Bei welchen Ttigkeiten vergisst du die Zeit?",placeholder:"Erzhle mir, was du wirklich liebst zu tun...",description:"Was du liebst"},talent:{key:"talent",label:"Talent",icon:"",color:"#F59E0B",question:"Worin bist du richtig gut? Was fllt dir leicht, whrend andere damit kmpfen?",placeholder:"Beschreibe deine Strken und Fhigkeiten...",description:"Worin du gut bist"},need:{key:"need",label:"Welt",icon:"",color:"#10B981",question:"Welche Probleme der Welt wrdest du gerne lsen? Wo siehst du Bedarf?",placeholder:"Welchen Beitrag mchtest du leisten...",description:"Was die Welt braucht"},market:{key:"market",label:"Markt",icon:"",color:"#6366F1",question:"Wofr werden Menschen in deinem Bereich bezahlt? Was ist gefragt?",placeholder:"Welche Berufe oder Mrkte interessieren dich...",description:"Wofr du bezahlt wirst"}},ge={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings",DECISIONS:"decisions",IKIGAI:"ikigai"},_c=[{id:ge.BRIEFINGS,label:"Smart Briefings",icon:st},{id:ge.DECISIONS,label:"Entscheidungs-Kompass",icon:ci},{id:ge.IKIGAI,label:"Ikigai-Kompass",icon:Vn},{id:ge.SIMULATOR,label:"Szenario-Training",icon:rt},{id:ge.VIDEO,label:"Wirkungs-Analyse",icon:jt},{id:ge.ROLEPLAY,label:"Live-Simulationen",icon:Ze}],ha=ge,sD=({onBack:t,onSelectSession:e,isAuthenticated:n,onLoginClick:s,onContinueSession:r,onRepeatSession:o,initialTab:a,onNavigateToModule:l})=>{const{branding:c,demoCode:d,isDemoUser:u}=qe(),h=Ge(),p=c?.["--header-gradient"]||_e["--header-gradient"],m=c?.["--header-text"]||_e["--header-text"],x=c?.["--primary-accent"]||_e["--primary-accent"],[g,y]=f.useState(a||ge.BRIEFINGS);f.useEffect(()=>{a&&y(a)},[a]);const[v,k]=f.useState(null),[S,w]=f.useState(null);f.useEffect(()=>{window.scrollTo(0,0)},[g,v]);const[b,T]=f.useState([]),[C,j]=f.useState([]),[R,I]=f.useState([]),[A,L]=f.useState([]),[B,P]=f.useState([]),[_,O]=f.useState([]),[W,D]=f.useState([]),[N,F]=f.useState([]),[ne,re]=f.useState([]),[Z,ee]=f.useState(null),[se,z]=f.useState(null),[V,H]=f.useState(null),[pe,Te]=f.useState(null),[Le,we]=f.useState({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),[Qe,ye]=f.useState(null),[Ee,Ke]=f.useState(!1),[Me,et]=f.useState(!0),[X,he]=f.useState(null);f.useEffect(()=>{n?be():et(!1)},[n]);const be=async()=>{et(!0),he(null);try{const G=vn(),ve=d?`&demo_code=${encodeURIComponent(d)}`:"",[Se,Oe,_t,yn,Nn,yi,Ss,Vv,Gv]=await Promise.all([k2({limit:50,...d&&{demo_code:d}}).catch(()=>({data:[]})),fetch(`${G}/simulator/sessions?limit=50${ve}`,{headers:{"X-WP-Nonce":At()}}).then(mt=>mt.json()).catch(()=>({data:[]})),fetch(`${G}/video-training/sessions?limit=50${ve}`,{headers:{"X-WP-Nonce":At()}}).then(mt=>mt.json()).catch(()=>({data:[]})),ce.request(`/smartbriefing/briefings?limit=50${d?`&demo_code=${encodeURIComponent(d)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),ce.getDecisions().catch(()=>({success:!1,data:{decisions:[]}})),ce.getIkigais().catch(()=>({success:!1,data:{ikigais:[]}})),j0().catch(()=>[]),fetch(`${G}/simulator/scenarios`,{headers:{"X-WP-Nonce":At()}}).then(mt=>mt.json()).catch(()=>({data:[]})),fetch(`${G}/video-training/scenarios`,{headers:{"X-WP-Nonce":At()}}).then(mt=>mt.json()).catch(()=>({data:[]}))]),Nl=(mt,Jo="sessions")=>Array.isArray(mt?.data)?mt.data:Array.isArray(mt?.data?.[Jo])?mt.data[Jo]:Array.isArray(mt?.[Jo])?mt[Jo]:Array.isArray(mt)?mt:[],zl=mt=>Array.isArray(mt?.data?.scenarios)?mt.data.scenarios:Array.isArray(mt?.data)?mt.data:Array.isArray(mt)?mt:[];T(Nl(Se)),j(Nl(Oe)),I(Nl(_t)),L(yn?.data?.briefings||[]),P(Nn?.data?.decisions||[]),O(yi?.data?.ikigais||[]),D(zl(Ss)),F(zl(Vv)),re(zl(Gv))}catch(G){console.error("Failed to load sessions:",G),he(G.message||"Fehler beim Laden der Daten")}finally{et(!1)}},ue=f.useMemo(()=>{const G={};return W.forEach(ve=>{G[ve.id]=ve}),G},[W]),gt=f.useMemo(()=>{const G={};return N.forEach(ve=>{G[ve.id]=ve}),G},[N]),lt=f.useMemo(()=>{const G={};return ne.forEach(ve=>{G[ve.id]=ve}),G},[ne]),je=()=>{switch(g){case ge.SIMULATOR:return C;case ge.VIDEO:return R;case ge.BRIEFINGS:return A;case ge.DECISIONS:return B;case ge.IKIGAI:return _;default:return b}},fe=()=>{switch(g){case ge.SIMULATOR:return gt;case ge.VIDEO:return lt;default:return ue}},oe=b.length+C.length+R.length+A.length+B.length,xe=async G=>{(await ce.request(`/smartbriefing/briefings/${G}`,{method:"DELETE"})).success&&L(Se=>Se.filter(Oe=>Oe.id!==G))},tt=G=>{ee(G)},cn=()=>{ee(null)},Ft=async G=>{(await ce.deleteDecision(G)).success&&P(Se=>Se.filter(Oe=>Oe.id!==G))},en=async G=>{await ce.deleteIkigai(G)&&O(Se=>Se.filter(Oe=>Oe.id!==G))},Wi=G=>{z(G)},mi=()=>{z(null),H(null)},$i=G=>{Te(G),we({love:{input:G.love_input||"",tags:G.love_tags||[]},talent:{input:G.talent_input||"",tags:G.talent_tags||[]},need:{input:G.need_input||"",tags:G.need_tags||[]},market:{input:G.market_input||"",tags:G.market_tags||[]}}),G.status==="completed"&&G.paths?ye({summary:G.summary,paths:G.paths}):ye(null)},vs=()=>{Te(null),we({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),ye(null)},Ur=async(G,ve,Se)=>{if(we(Oe=>({...Oe,[G]:{input:ve,tags:Se}})),pe?.id)try{await ce.updateIkigai(pe.id,{[`${G}_input`]:ve,[`${G}_tags`]:Se})}catch(Oe){console.error("[Ikigai] Failed to save dimension:",Oe)}},Vr=async(G,ve)=>{try{return(await ce.extractIkigaiKeywords(G,ve))?.keywords||[]}catch(Se){return console.error("[Ikigai] Failed to extract keywords:",Se),[]}},Q=(G,ve)=>{we(Se=>{const Oe=Se[G].tags.filter(_t=>_t!==ve);return{...Se,[G]:{...Se[G],tags:Oe}}})},Pe=async()=>{if(Object.values(Le).every(ve=>ve.tags&&ve.tags.length>0)){Ke(!0);try{const ve=await ce.synthesizeIkigaiPaths({love_tags:Le.love.tags,talent_tags:Le.talent.tags,need_tags:Le.need.tags,market_tags:Le.market.tags});ve&&(ye(ve),pe?.id&&(await ce.updateIkigai(pe.id,{summary:ve.summary,paths:ve.paths,status:"completed"}),O(Se=>Se.map(Oe=>Oe.id===pe.id?{...Oe,summary:ve.summary,paths:ve.paths,status:"completed"}:Oe))))}catch(ve){console.error("[Ikigai] Failed to synthesize paths:",ve)}finally{Ke(!1)}}},Je=Object.values(Le).every(G=>G.tags&&G.tags.length>0),vt=G=>{P(ve=>ve.map(Se=>Se.id===G.id?G:Se)),z(G)},xi=G=>{k(G),w(g)},Jn=()=>{k(null),w(null)},Dn=async(G,ve)=>{const Se=vn();try{let Oe,_t;switch(ve){case ge.SIMULATOR:Oe=`${Se}/simulator/sessions/${G.id}`,_t=()=>j(yi=>yi.filter(Ss=>Ss.id!==G.id));break;case ge.ROLEPLAY:Oe=`${Se}/sessions/${G.id}`,_t=()=>T(yi=>yi.filter(Ss=>Ss.id!==G.id));break;case ge.VIDEO:Oe=`${Se}/video-training/sessions/${G.id}`,_t=()=>I(yi=>yi.filter(Ss=>Ss.id!==G.id));break;default:throw new Error("Unknown session type")}const Nn=await(await fetch(Oe,{method:"DELETE",headers:{"X-WP-Nonce":At()}})).json();if(Nn.success)_t(),v&&Jn();else throw new Error(Nn.message||"Delete failed")}catch(Oe){throw console.error("Failed to delete session:",Oe),Oe}},Ui=(G,ve)=>(ve===ge.SIMULATOR?gt:ve===ge.VIDEO?lt:ue)[G?.scenario_id];if(Z)return i.jsx(Ev,{briefing:Z,onBack:cn,onDelete:xe});if(se){const G={topic:se.topic||"",context:se.context||"",pros:se.pros||[],cons:se.cons||[],proScore:se.pro_score||0,contraScore:se.contra_score||0},ve=async(_t,yn)=>{try{const Nn={topic:_t.topic,context:_t.context||null,pros:_t.pros,cons:_t.cons,pro_score:_t.proScore,contra_score:_t.contraScore,analysis:yn,status:"completed"};await ce.updateDecision(se.id,Nn);const yi={...se,...Nn};vt(yi),H({data:_t,result:yn})}catch(Nn){console.error("[SessionHistory] Failed to update decision:",Nn)}},Se=async _t=>se.id,Oe=async(_t,yn)=>{try{await ce.updateDecision(_t,{topic:yn.topic,context:yn.context||null,pros:yn.pros,cons:yn.cons,pro_score:yn.proScore,contra_score:yn.contraScore,status:yn.status||"draft"})}catch(Nn){console.error("[SessionHistory] Failed to update decision:",Nn)}};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:h.space[4],paddingBottom:h.space[4],borderBottom:`1px solid ${h.borderColor}`},children:[i.jsxs("button",{onClick:mi,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,backgroundColor:"transparent",border:`1px solid ${h.borderColor}`,borderRadius:h.radius.md,cursor:"pointer",color:h.textSecondary,fontSize:h.fontSize.base},children:[i.jsx(ft,{size:h.iconSize.md}),"Zurck"]}),i.jsxs("button",{onClick:()=>{window.confirm("Mchtest du diese Entscheidungs-Analyse wirklich lschen?")&&(Ft(se.id),mi())},style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,backgroundColor:"transparent",border:`1px solid ${h.error}`,borderRadius:h.radius.md,cursor:"pointer",color:h.error,fontSize:h.fontSize.base},children:[i.jsx(We,{size:h.iconSize.md}),"Lschen"]})]}),V?i.jsx(Mv,{decisionData:V.data,analysisResult:V.result,onStartNew:()=>{H(null),z(null)},onEditDecision:()=>{H(null)}}):i.jsx(_v,{initialData:G,onAnalysisComplete:ve,isAuthenticated:n,savedDecisionId:se.id,onSaveDraft:Se,onUpdateSession:Oe,onDecisionIdChange:()=>{}})]})}if(pe)return i.jsxs("div",{style:{padding:h.space[6],maxWidth:"900px",margin:"0 auto"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:h.space[6]},children:[i.jsxs("button",{onClick:vs,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[4]}`,backgroundColor:"transparent",border:`1px solid ${h.borderColor}`,borderRadius:h.radius.lg,color:h.textSecondary,cursor:"pointer",fontSize:h.fontSize.sm,fontWeight:h.fontWeight.medium},children:[i.jsx(ft,{size:16}),"Zurck"]}),i.jsxs("button",{onClick:()=>{window.confirm("Mchtest du diese Ikigai-Analyse wirklich lschen?")&&(en(pe.id),vs())},style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,backgroundColor:"transparent",border:`1px solid ${h.error}`,borderRadius:h.radius.lg,color:h.error,cursor:"pointer",fontSize:h.fontSize.sm,fontWeight:h.fontWeight.medium},children:[i.jsx(We,{size:16}),"Lschen"]})]}),Qe?i.jsx(Dv,{dimensions:Le,synthesisResult:Qe,onStartNew:vs,onEdit:()=>ye(null),DIMENSIONS:em}):i.jsx(Pv,{dimensions:Le,DIMENSIONS:em,onExtractKeywords:Vr,onUpdateDimension:Ur,onRemoveTag:Q,allDimensionsFilled:Je,onSynthesize:Pe,isSynthesizing:Ee})]});if(v){if(S===ge.ROLEPLAY){const Se=Ui(v,S);return i.jsx(Cv,{session:v,scenario:Se,onBack:Jn,onRepeat:()=>o?.(v,Se,"roleplay"),onDelete:Oe=>Dn(Oe,ge.ROLEPLAY)})}const ve={[ge.SIMULATOR]:"simulator",[ge.VIDEO]:"video"}[S]||"simulator";return i.jsx(yP,{session:v,type:S,scenario:Ui(v,S),onBack:Jn,onContinueSession:r,onRepeatSession:(Se,Oe)=>o?.(Se,Oe,ve),onDeleteSession:Dn})}if(!n)return i.jsxs("div",{style:{padding:h.space[6]},children:[i.jsxs("div",{style:{marginBottom:h.space[8],textAlign:"center"},children:[i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:h.space[3],marginBottom:h.space[3]},children:[i.jsx("div",{style:{width:h.space[12],height:h.space[12],borderRadius:h.radius.lg,background:p,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(ad,{style:{width:h.iconSize["2xl"],height:h.iconSize["2xl"],color:m}})}),i.jsx("h1",{style:{fontSize:h.fontSize["5xl"],fontWeight:h.fontWeight.bold,color:h.textMain,margin:0},children:"Meine Sessions"})]}),i.jsx("p",{style:{fontSize:h.fontSize.lg,color:h.textSecondary,maxWidth:"600px",margin:"0 auto"},children:"Hier findest du deine gespeicherten bungen und Fortschritte"})]}),i.jsxs("div",{style:{maxWidth:"500px",margin:`${h.space[15]} auto`,textAlign:"center",padding:h.space[10],backgroundColor:h.cardBg,borderRadius:h.radius["2xl"],boxShadow:h.shadow.md},children:[i.jsx("div",{style:{width:h.space[16],height:h.space[16],borderRadius:h.radius.xl,background:p,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${h.space[5]}`},children:i.jsx(Ga,{style:{width:h.iconSize["3xl"],height:h.iconSize["3xl"],color:m}})}),i.jsx("h2",{style:{fontSize:h.fontSize["3xl"],fontWeight:h.fontWeight.bold,color:h.textMain,marginBottom:h.space[3]},children:"Anmeldung erforderlich"}),i.jsx("p",{style:{fontSize:h.fontSize.md,color:h.textMuted,marginBottom:h.space[6],lineHeight:1.6},children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),i.jsxs("button",{onClick:s,style:{padding:`${h.space[3.5]} ${h.space[8]}`,borderRadius:h.radius.lg,border:"none",background:p,color:m,fontSize:h.fontSize.lg,fontWeight:h.fontWeight.semibold,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:h.space[2.5],boxShadow:h.coloredShadow(x,"md")},children:[i.jsx(Ga,{style:{width:h.iconSize.lg,height:h.iconSize.lg}}),"Jetzt anmelden"]})]})]});if(Me)return i.jsxs("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:h.space[10]},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx(me,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:x,animation:"spin 1s linear infinite",margin:"0 auto"}}),i.jsx("p",{style:{color:h.textMuted,marginTop:h.space[4]},children:"Sessions werden geladen..."})]}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]});if(X)return i.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:h.space[6]},children:[i.jsx(Ie,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.error,margin:`0 auto ${h.space[4]}`}}),i.jsx("h2",{style:{fontSize:h.fontSize["2xl"],fontWeight:h.fontWeight.bold,color:h.textMain,marginBottom:h.space[2]},children:"Fehler beim Laden"}),i.jsx("p",{style:{color:h.textMuted,marginBottom:h.space[6]},children:X}),i.jsx(de,{onClick:be,children:"Erneut versuchen"})]})});const vh=je(),Uv=fe();return i.jsxs("div",{style:{padding:h.space[6]},children:[i.jsxs("div",{style:{marginBottom:h.space[8],textAlign:"center",position:"relative"},children:[i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:h.space[3],marginBottom:h.space[3]},children:[i.jsx("div",{style:{width:h.space[12],height:h.space[12],borderRadius:h.radius.lg,background:p,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(ad,{style:{width:h.iconSize["2xl"],height:h.iconSize["2xl"],color:m}})}),i.jsx("h1",{style:{fontSize:h.fontSize["5xl"],fontWeight:h.fontWeight.bold,color:h.textMain,margin:0},children:"Meine Sessions"})]}),i.jsxs("p",{style:{fontSize:h.fontSize.lg,color:h.textSecondary,maxWidth:"600px",margin:"0 auto"},children:[oe," ",oe===1?"bung":"bungen"," gespeichert"]})]}),i.jsx("style",{children:`
        .session-tabs-desktop {
          margin: 0 24px 24px;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          background: #f1f5f9;
          padding: 6px;
          border-radius: 14px;
        }
        .session-tab-btn-desktop {
          flex: 1 1 auto;
          min-width: fit-content;
          padding: 12px 16px;
          border-radius: 10px;
          border: none;
          font-size: 14px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: all 0.2s;
        }
        .session-tabs-mobile {
          margin: 0 16px 16px;
        }
        .session-tabs-mobile-icons {
          display: flex;
          gap: 8px;
          justify-content: center;
          margin-bottom: 12px;
        }
        .session-tab-btn-mobile {
          flex: 1;
          max-width: 80px;
          padding: 12px 8px;
          border-radius: 12px;
          border: none;
          cursor: pointer;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 4px;
          transition: all 0.2s;
        }
        .session-tab-mobile-label {
          text-align: center;
          font-size: 15px;
          font-weight: 600;
          color: #0f172a;
          padding: 8px 16px;
          background: #fff;
          border-radius: 10px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .mobile-refresh-btn {
          display: none;
        }
        .desktop-actions {
          margin: 0 24px 24px;
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
          gap: 12px;
        }
        .sessions-list-container {
          margin: 0 24px;
        }
        @media (min-width: 1025px) {
          .session-tabs-mobile { display: none; }
        }
        @media (min-width: 641px) and (max-width: 1023px) {
          .desktop-actions {
            flex-direction: column;
          }
          .desktop-actions button {
            width: 100%;
            justify-content: center;
          }
        }
        @media (min-width: 1024px) {
          .desktop-actions {
            justify-content: flex-end;
          }
        }
        @media (max-width: 1024px) {
          .session-tabs-desktop { display: none; }
        }
        @media (max-width: 640px) {
          .desktop-actions { display: none; }
          .mobile-refresh-btn {
            display: flex !important;
            position: absolute;
            top: 0;
            right: 0;
          }
          .sessions-list-container {
            margin: 0 16px;
          }
        }
      `}),i.jsx("button",{onClick:be,disabled:Me,className:"mobile-refresh-btn",style:{padding:h.space[2.5],borderRadius:h.radius.md,border:`1px solid ${h.borderColor}`,background:h.cardBgColor,color:h.textSecondary,cursor:Me?"not-allowed":"pointer",opacity:Me?.5:1,boxShadow:h.shadow.sm,alignItems:"center",justifyContent:"center"},children:i.jsx(Ot,{style:{width:h.iconSize.md,height:h.iconSize.md},className:Me?"animate-spin":""})}),i.jsx("div",{className:"session-tabs-desktop",children:_c.map(G=>{const ve=G.icon,Se=g===G.id,Oe=G.id===ge.SIMULATOR?C.length:G.id===ge.VIDEO?R.length:G.id===ge.BRIEFINGS?A.length:G.id===ge.DECISIONS?B.length:G.id===ge.IKIGAI?_.length:b.length;return i.jsxs("button",{onClick:()=>y(G.id),className:"session-tab-btn-desktop",style:{background:Se?"#fff":"transparent",color:Se?"#0f172a":"#64748b",fontWeight:Se?600:500,boxShadow:Se?"0 2px 8px rgba(0, 0, 0, 0.08)":"none"},children:[i.jsx(ve,{size:18}),i.jsx("span",{children:G.label}),i.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",background:Se?x:"#e2e8f0",color:Se?"white":"#64748b",fontSize:"12px",fontWeight:600,minWidth:"24px",textAlign:"center"},children:Oe})]},G.id)})}),i.jsxs("div",{className:"session-tabs-mobile",children:[i.jsx("div",{className:"session-tabs-mobile-icons",children:_c.map(G=>{const ve=G.icon,Se=g===G.id,Oe=G.id===ge.SIMULATOR?C.length:G.id===ge.VIDEO?R.length:G.id===ge.BRIEFINGS?A.length:G.id===ge.DECISIONS?B.length:b.length;return i.jsxs("button",{onClick:()=>y(G.id),className:"session-tab-btn-mobile",style:{background:Se?"#fff":"#f1f5f9",boxShadow:Se?"0 2px 8px rgba(0, 0, 0, 0.1)":"none",border:Se?`2px solid ${x}`:"2px solid transparent"},children:[i.jsx(ve,{size:20,style:{color:Se?x:"#64748b"}}),i.jsx("span",{style:{padding:"2px 6px",borderRadius:"8px",background:Se?x:"#e2e8f0",color:Se?"white":"#64748b",fontSize:"11px",fontWeight:600,minWidth:"20px",textAlign:"center"},children:Oe})]},G.id)})}),i.jsx("div",{className:"session-tab-mobile-label",children:_c.find(G=>G.id===g)?.label})]}),i.jsxs("div",{className:"desktop-actions",children:[i.jsxs(de,{variant:"outline",onClick:be,disabled:Me,children:[i.jsx(Ot,{style:{width:"16px",height:"16px",marginRight:"8px"},className:Me?"animate-spin":""}),"Aktualisieren"]}),l&&i.jsxs(de,{onClick:()=>{const G={[ge.BRIEFINGS]:"smart_briefing",[ge.DECISIONS]:"decision_board",[ge.IKIGAI]:"ikigai",[ge.SIMULATOR]:"simulator",[ge.VIDEO]:"video_training",[ge.ROLEPLAY]:"dashboard"};l(G[g]||"overview")},style:{background:p,color:m},children:[i.jsx(Yt,{style:{width:"16px",height:"16px",marginRight:"8px"}}),g===ge.BRIEFINGS?"Neues Briefing":g===ge.DECISIONS?"Neue Entscheidungs-Analyse":g===ge.IKIGAI?"Neue Ikigai-Analyse":g===ge.SIMULATOR?"Neues Szenario-Training":g===ge.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),i.jsx("div",{className:"sessions-list-container",children:vh.length===0?i.jsxs("div",{style:{textAlign:"center",padding:`${h.space[15]} ${h.space[6]}`,background:h.cardBg,borderRadius:h.radius["2xl"],boxShadow:h.shadow.sm},children:[g===ge.SIMULATOR&&i.jsx(rt,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===ge.ROLEPLAY&&i.jsx(Ze,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===ge.VIDEO&&i.jsx(jt,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===ge.BRIEFINGS&&i.jsx(st,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===ge.DECISIONS&&i.jsx(ci,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===ge.IKIGAI&&i.jsx(Vn,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),i.jsxs("h3",{style:{fontSize:h.fontSize["2xl"],fontWeight:h.fontWeight.semibold,color:h.textSecondary,marginBottom:h.space[2]},children:["Noch keine ",g===ge.SIMULATOR?"Szenario-Trainings":g===ge.VIDEO?"Wirkungs-Analysen":g===ge.BRIEFINGS?"Smart Briefings":g===ge.DECISIONS?"Entscheidungs-Analysen":g===ge.IKIGAI?"Ikigai-Analysen":"Live-Simulationen"]}),i.jsx("p",{style:{color:h.textMuted,fontSize:h.fontSize.base,marginBottom:h.space[6]},children:g===ge.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":g===ge.DECISIONS?"Nutze den Entscheidungs-Kompass, um deine erste Entscheidung zu analysieren.":g===ge.IKIGAI?"Entdecke deinen idealen Karrierepfad mit dem Ikigai-Kompass.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),i.jsxs(de,{onClick:t,children:[i.jsx(Lt,{style:{width:h.iconSize.sm,height:h.iconSize.sm,marginRight:h.space[2]}}),g===ge.BRIEFINGS?"Briefing erstellen":g===ge.DECISIONS?"Entscheidung analysieren":g===ge.IKIGAI?"Ikigai entdecken":"Training starten"]})]}):i.jsx($.div,{style:{display:"flex",flexDirection:"column",gap:h.space[3]},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:g===ge.BRIEFINGS?A.map(G=>i.jsx(ZP,{briefing:G,onClick:()=>tt(G),onDelete:xe,headerGradient:p,headerText:m,primaryAccent:x},G.id)):g===ge.DECISIONS?B.map(G=>i.jsx(eD,{decision:G,onClick:()=>Wi(G),onDelete:Ft,headerGradient:p,headerText:m,primaryAccent:x},G.id)):g===ge.IKIGAI?_.map(G=>i.jsx(nD,{ikigai:G,onDelete:en,onNavigate:()=>$i(G),headerGradient:p,headerText:m,primaryAccent:x},G.id)):vh.map(G=>{const ve=Uv[G.scenario_id];return i.jsx(QP,{session:G,type:g,scenario:ve,onClick:()=>xi(G),onContinueSession:r,onDeleteSession:Dn,headerGradient:p,headerText:m,primaryAccent:x},G.id)})})}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})};function rD({session:t,onBack:e,onRepeatSession:n}){const[s,r]=f.useState(t),[o,a]=f.useState(null),[l,c]=f.useState(!0),[d,u]=f.useState(null),h=f.useMemo(()=>Nu(s?.feedback_json),[s?.feedback_json]),p=f.useMemo(()=>zu(s?.audio_analysis_json),[s?.audio_analysis_json]);f.useEffect(()=>{m()},[t?.id]);const m=async()=>{try{c(!0),u(null);const x=await Lu(t.id);if(r(g=>({...x,feedback_json:x.feedback_json||g?.feedback_json,audio_analysis_json:x.audio_analysis_json||g?.audio_analysis_json,transcript:x.transcript||g?.transcript,conversation_id:x.conversation_id||g?.conversation_id})),x.scenario_id)try{const g=await T0(x.scenario_id);a(g)}catch(g){console.warn("Could not load scenario:",g)}}catch(x){console.error("Failed to load session:",x),u(x.message||"Fehler beim Laden der Session")}finally{c(!1)}};return l?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx(me,{className:"w-12 h-12 text-ocean-blue-600 animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-slate-600",children:"Gesprchsanalyse wird geladen..."})]})}):d?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[i.jsx(Ie,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),i.jsx("p",{className:"text-slate-600 mb-4",children:d}),i.jsxs("div",{className:"flex gap-3 justify-center",children:[i.jsx(de,{variant:"outline",onClick:e,children:"Zurck"}),i.jsx(de,{onClick:m,children:"Erneut versuchen"})]})]})}):i.jsx(Cv,{session:s,scenario:o,feedback:h,audioAnalysis:p,onBack:e,onRepeat:o&&n?()=>n(s,o,"roleplay"):void 0})}const oD={briefcase:jn,banknote:ms,user:Qt,presentation:c0,target:rt,mic:Ue},aD=async()=>{const t=await fetch(`${vn()}/simulator/scenarios`,{headers:{"X-WP-Nonce":At()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Keine Szenarien gefunden")},lD=t=>oD[t.icon]||jn,cD=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:Ye,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],tm=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:s,onNavigateToHistory:r})=>i.jsx(jl,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:st,fetchScenarios:aD,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:cD,getIconForScenario:lD,cardActionLabel:"Starten",cardActionIcon:gn,categoryField:"category",emptyStateIcon:Ue,emptyStateTitle:"Keine Trainingsszenarien verfgbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:e,requireAuth:n,setPendingScenario:s,loadingMessage:"Szenarien werden geladen..."}),dD=({field:t,value:e,onChange:n,error:s,focusColor:r,branding:o})=>{const a=r||"#4a9ec9",l={width:"100%",padding:`${o.space[3]} ${o.space[4]}`,borderRadius:o.radius.lg,border:`2px solid ${s?E.red[500]:E.slate[200]}`,fontSize:o.fontSize.base,color:E.slate[900],backgroundColor:"white",outline:"none",transition:o.transition.normal},c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=p=>{Object.assign(p.target.style,c),setTimeout(()=>{const m=p.target;if(m){const x=m.closest("div");x&&x.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=p=>{p.target.style.borderColor=s?E.red[500]:E.slate[200],p.target.style.boxShadow="none"},h=()=>{switch(t.type){case"text":return i.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u});case"textarea":return i.jsx("textarea",{value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return i.jsxs("select",{value:e||t.default||"",onChange:p=>n(t.key,p.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[i.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(p=>i.jsx("option",{value:p.value,children:p.label},p.value))]});case"number":return i.jsx("input",{type:"number",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:l,onFocus:d,onBlur:u});default:return i.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u})}};return i.jsxs("div",{style:{marginBottom:o.space[5]},children:[i.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:E.slate[700]},children:[t.label,t.required&&i.jsx("span",{style:{color:E.red[500],marginLeft:o.space[1]},children:"*"})]}),h(),s&&i.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:E.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[i.jsx(Ie,{style:{width:"14px",height:"14px"}}),s]}),t.hint&&!s&&i.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:E.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[i.jsx(mn,{style:{width:"14px",height:"14px"}}),t.hint]})]})},uD=({scenario:t,onBack:e,onNext:n})=>{const[s,r]=f.useState({}),[o,a]=f.useState({}),[l,c]=f.useState([]),[d,u]=f.useState(!1),h=Ge(),p=Cn.useMemo(()=>{if(!t?.input_configuration)return[];try{const S=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(S)?S.filter(w=>w.user_input!==!1):[]}catch(S){return console.error("Error parsing input_configuration:",S),[]}},[t?.input_configuration]);f.useEffect(()=>{const S={};p.forEach(w=>{w.default&&(S[w.key]=w.default)}),r(S)},[p]);const m=(S,w)=>{r(b=>({...b,[S]:w})),o[S]&&a(b=>{const T={...b};return delete T[S],T})},x=()=>{c(S=>[...S,{key:"",value:""}])},g=(S,w,b)=>{c(T=>{const C=[...T];return C[S]={...C[S],[w]:b},C})},y=S=>{c(w=>w.filter((b,T)=>T!==S))},v=()=>{const S={};return p.forEach(w=>{const b=s[w.key];if(w.required&&(!b||b.trim()==="")){S[w.key]="Dieses Feld ist erforderlich";return}if(!(!b||b.trim()==="")&&w.validation){const{minLength:T,maxLength:C,min:j,max:R,pattern:I}=w.validation;T&&b.length<T&&(S[w.key]=`Mindestens ${T} Zeichen erforderlich`),C&&b.length>C&&(S[w.key]=`Maximal ${C} Zeichen erlaubt`),j!==void 0&&Number(b)<j&&(S[w.key]=`Mindestens ${j}`),R!==void 0&&Number(b)>R&&(S[w.key]=`Maximal ${R}`),I&&!new RegExp(I).test(b)&&(S[w.key]="Ungltiges Format")}}),a(S),Object.keys(S).length===0},k=S=>{if(S.preventDefault(),!v())return;const w={...s};l.forEach(b=>{b.key&&b.value&&(w[b.key]=b.value)}),n(w)};return f.useEffect(()=>{p.length===0&&n({})},[p,n]),p.length===0?null:i.jsxs("div",{style:{padding:h.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:h.space[8]},children:[i.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,marginBottom:h.space[4],border:"none",background:"transparent",color:E.slate[600],fontSize:h.fontSize.sm,cursor:"pointer",borderRadius:h.radius.md,transition:h.transition.normal},onMouseEnter:S=>S.target.style.background=E.slate[100],onMouseLeave:S=>S.target.style.background="transparent",children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:h.space[4]},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:h.radius.xl,background:h.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(st,{style:{width:"28px",height:"28px",color:"white"}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:h.fontSize["2xl"],fontWeight:700,color:E.slate[900],margin:0},children:t.title}),i.jsx("p",{style:{fontSize:h.fontSize.sm,color:E.slate[600],margin:`${h.space[1]} 0 0 0`},children:"Personalisiere dein Training"})]})]})]}),i.jsx("div",{style:{padding:`${h.space[4]} ${h.space[5]}`,borderRadius:h.radius.lg,backgroundColor:E.slate[100],marginBottom:h.space[6]},children:i.jsx("p",{style:{fontSize:h.fontSize.sm,color:E.slate[700],margin:0,lineHeight:1.6},children:t.description})}),i.jsxs("form",{onSubmit:k,children:[p.map(S=>i.jsx(dD,{field:S,value:s[S.key],onChange:m,error:o[S.key],focusColor:h.primaryAccent,branding:h},S.key)),t?.allow_custom_variables&&i.jsxs("div",{style:{marginTop:h.space[5],marginBottom:h.space[5],paddingTop:h.space[5],borderTop:`1px solid ${E.slate[200]}`},children:[i.jsxs("button",{type:"button",onClick:()=>u(!d),style:{display:"flex",alignItems:"flex-start",gap:h.space[2],padding:"0",border:"none",background:"none",color:E.slate[500],fontSize:h.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:d?h.space[4]:"0",textAlign:"left"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:h.space[2],flexShrink:0},children:[d?i.jsx(ni,{size:18}):i.jsx(bt,{size:18}),i.jsx(Yt,{size:16})]}),i.jsx("span",{style:{lineHeight:"1.4"},children:"Zustzliche Variablen hinzufgen (optional)"})]}),d&&i.jsxs("div",{style:{backgroundColor:E.slate[50],borderRadius:h.radius.lg,padding:h.space[4]},children:[i.jsx("p",{style:{fontSize:h.fontSize.sm,color:E.slate[500],margin:`0 0 ${h.space[3]} 0`},children:"Fge eigene Variablen hinzu, die in das Training einflieen sollen."}),l.length>0&&i.jsx("div",{style:{marginBottom:h.space[3]},children:l.map((S,w)=>i.jsxs("div",{style:{backgroundColor:"white",border:`1px solid ${E.slate[200]}`,borderRadius:h.radius.md,padding:h.space[3],marginBottom:h.space[3]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:h.space[2]},children:[i.jsx("input",{type:"text",value:S.key||"",onChange:b=>g(w,"key",b.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:`${h.space[2]} ${h.space[3]}`,borderRadius:h.radius.md,border:`1px solid ${E.slate[200]}`,fontSize:h.fontSize.sm,fontFamily:"monospace",backgroundColor:E.slate[50],flex:1,marginRight:h.space[2]}}),i.jsx("button",{type:"button",onClick:()=>y(w),style:{padding:h.space[2],border:"none",backgroundColor:"transparent",cursor:"pointer",color:E.red[500],display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{size:16})})]}),i.jsx("textarea",{value:S.value||"",onChange:b=>g(w,"value",b.target.value),placeholder:"Wert der Variable...",rows:2,style:{width:"100%",padding:`${h.space[2]} ${h.space[3]}`,borderRadius:h.radius.md,border:`1px solid ${E.slate[200]}`,fontSize:h.fontSize.sm,resize:"vertical"}})]},w))}),i.jsxs("button",{type:"button",onClick:x,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,border:`1px dashed ${E.slate[300]}`,borderRadius:h.radius.md,backgroundColor:"white",color:E.slate[600],fontSize:h.fontSize.sm,cursor:"pointer",width:"100%",justifyContent:"center"},children:[i.jsx(Yt,{size:16}),"Variable hinzufgen"]})]})]}),i.jsxs("div",{style:{padding:`${h.space[4]} ${h.space[5]}`,borderRadius:h.radius.lg,backgroundColor:h.primaryAccentLight,marginTop:h.space[6],marginBottom:h.space[6],display:"flex",gap:h.space[5],flexWrap:"wrap"},children:[i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:h.fontSize.xs,color:E.slate[500],display:"block"},children:"Fragen"}),i.jsxs("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:E.slate[900]},children:[t.question_count_min,"-",t.question_count_max]})]}),i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:h.fontSize.xs,color:E.slate[500],display:"block"},children:"Zeit pro Frage"}),i.jsxs("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:E.slate[900]},children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:h.fontSize.xs,color:E.slate[500],display:"block"},children:"Wiederholen"}),i.jsx("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:E.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),i.jsxs("button",{type:"submit",style:{width:"100%",padding:`${h.space[4]} ${h.space[6]}`,borderRadius:h.radius.xl,border:"none",background:h.buttonGradient,color:"white",fontSize:h.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:h.space[2.5],transition:h.transition.normal,boxShadow:`0 4px 12px ${h.primaryAccent}4d`},onMouseEnter:S=>{S.target.style.transform="translateY(-2px)",S.target.style.boxShadow=`0 6px 16px ${h.primaryAccent}66`},onMouseLeave:S=>{S.target.style.transform="none",S.target.style.boxShadow=`0 4px 12px ${h.primaryAccent}4d`},children:["Weiter",i.jsx(ds,{style:{width:"20px",height:"20px"}})]})]})]})},pa=({score:t,label:e,size:n="normal",primaryAccent:s,branding:r})=>{const o=t!=null?t*10:null,l=(d=>d>=80?r.success:d>=60?s:d>=40?r.warning:r.error)(o),c=n==="large";return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:r.space[1]},children:[i.jsx("div",{style:{width:c?"80px":"56px",height:c?"80px":"56px",borderRadius:r.radius.full,backgroundColor:`${l}15`,border:`3px solid ${l}`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("span",{style:{fontSize:c?r.fontSize["5xl"]:r.fontSize["2xl"],fontWeight:r.fontWeight.bold,color:l},children:o!=null?Math.round(o):"-"})}),i.jsx("span",{style:{fontSize:c?r.fontSize.base:r.fontSize.xs,color:r.textSecondary,fontWeight:r.fontWeight.medium},children:e})]})},ir=({title:t,icon:e,children:n,defaultOpen:s=!0,primaryAccent:r,branding:o})=>{const[a,l]=f.useState(s);return i.jsxs("div",{style:{borderRadius:o.radius.lg,border:`1px solid ${o.borderColor}`,backgroundColor:o.cardBg,overflow:"hidden",marginBottom:o.space[4]},children:[i.jsxs("button",{onClick:()=>l(!a),style:{width:"100%",padding:`${o.space[4]} ${o.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3]},children:[i.jsx(e,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:r}}),i.jsx("span",{style:{fontSize:o.fontSize.md,fontWeight:o.fontWeight.semibold,color:o.textMain},children:t})]}),a?i.jsx(ni,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}}):i.jsx(bt,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}})]}),a&&i.jsx("div",{style:{padding:`0 ${o.space[5]} ${o.space[5]} ${o.space[5]}`,borderTop:`1px solid ${o.cardBgHover}`,paddingTop:o.space[4]},children:n})]})},Mc=({text:t,type:e,primaryAccent:n,primaryAccentLight:s,branding:r})=>{const o={strength:{icon:Gn,color:r.success,bg:r.successLight},improvement:{icon:xs,color:r.warning,bg:r.warningLight},tip:{icon:Be,color:n,bg:s}},{icon:a,color:l,bg:c}=o[e]||o.tip;return i.jsxs("div",{style:{display:"flex",gap:r.space[3],padding:r.space[3],borderRadius:r.radius.md,backgroundColor:c,marginBottom:r.space[2]},children:[i.jsx(a,{style:{width:r.iconSize.md,height:r.iconSize.md,color:l,flexShrink:0,marginTop:"2px"}}),i.jsx("span",{style:{fontSize:r.fontSize.base,color:r.textSecondary,lineHeight:1.5},children:t})]})},hD=({metrics:t,branding:e})=>{if(!t)return null;const s=(o=>{switch(o){case"optimal":return{label:"Optimal",color:e.success};case"zu_schnell":return{label:"Zu schnell",color:e.warning};case"zu_langsam":return{label:"Zu langsam",color:e.warning};default:return{label:o||"N/A",color:e.textMuted}}})(t.speech_rate),r=o=>{switch(o){case"niedrig":return e.success;case"mittel":return e.warning;case"hoch":return e.error;default:return e.textMuted}};return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:e.space[4]},children:[i.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[i.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Sprechtempo"}),i.jsx("span",{style:{fontSize:e.fontSize.lg,fontWeight:e.fontWeight.semibold,color:s.color},children:s.label})]}),t.filler_words&&i.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[i.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Fllwrter"}),i.jsxs("span",{style:{fontSize:e.fontSize.lg,fontWeight:600,color:r(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&i.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&i.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[i.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:i.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?e.success:e.warning,borderRadius:"4px"}})}),i.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&i.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[i.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:i.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?e.success:e.warning,borderRadius:"4px"}})}),i.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&i.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:e.primaryAccentLight,fontSize:"14px",color:e.textSecondary,lineHeight:1.5},children:[" ",t.notes]})]})},pD=({audioUrl:t,primaryAccent:e,branding:n})=>{const s=f.useRef(null),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(0),[u,h]=f.useState(!0),[p,m]=f.useState(null);f.useEffect(()=>{if(!t)return;h(!0),m(null);const k=new Audio;s.current=k;const S=()=>{const b=k.duration;b&&isFinite(b)&&b>0&&d(b),h(!1)},w=()=>{h(!1);const b=k.duration;b&&isFinite(b)&&b>0&&d(b)};return k.addEventListener("loadedmetadata",S),k.addEventListener("canplaythrough",w),k.addEventListener("timeupdate",()=>l(k.currentTime)),k.addEventListener("play",()=>o(!0)),k.addEventListener("pause",()=>o(!1)),k.addEventListener("ended",()=>o(!1)),k.addEventListener("error",()=>{m("Audio nicht verfgbar"),h(!1)}),k.src=t,k.load(),()=>{k.pause(),k.src=""}},[t]);const x=()=>{s.current&&(r?s.current.pause():s.current.play())},g=k=>{const S=k.currentTarget.getBoundingClientRect(),w=(k.clientX-S.left)/S.width;s.current&&c>0&&(s.current.currentTime=w*c)},y=k=>{s.current&&(s.current.currentTime=Math.max(0,Math.min(s.current.currentTime+k,c)))};if(!t)return null;if(p)return i.jsxs("div",{style:{padding:"12px 16px",background:n.cardBgHover,borderRadius:"10px",color:n.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ie,{size:16})," ",p]});const v=c>0?a/c*100:0;return i.jsxs("div",{style:{background:n.cardBgHover,borderRadius:"12px",padding:"16px"},children:[i.jsx("div",{onClick:g,style:{height:"6px",background:n.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:i.jsx("div",{style:{width:`${v}%`,height:"100%",background:e,borderRadius:"3px",transition:"width 0.1s"}})}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[i.jsx("button",{onClick:()=>y(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:i.jsx(vl,{size:20})}),i.jsx("button",{onClick:x,disabled:u,style:{width:"44px",height:"44px",borderRadius:"50%",background:e,border:"none",cursor:u?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:u?.7:1},children:u?i.jsx(me,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):r?i.jsx(bl,{size:20,color:"#ffffff",fill:"#ffffff"}):i.jsx(Lt,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),i.jsx("button",{onClick:()=>y(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:i.jsx(qo,{size:20})})]}),i.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:n.textMuted},children:[yt(a)," / ",yt(c)]}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},fD=({transcript:t,feedback:e,audioMetrics:n,audioUrl:s,onRetry:r,onNext:o,onComplete:a,isLastQuestion:l,hideButtons:c=!1})=>{const{branding:d}=qe(),u=Ge(),h=d?.["--button-gradient"]||d?.["--header-gradient"]||_e["--header-gradient"],p=d?.["--primary-accent"]||_e["--primary-accent"],m=d?.["--primary-accent-light"]||_e["--primary-accent-light"],x=typeof e=="string"?JSON.parse(e):e;return i.jsxs("div",{style:{backgroundColor:u.cardBgHover,borderRadius:u.radius.xl,padding:u.space[6]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:u.space[5],backgroundColor:u.cardBg,borderRadius:u.radius.lg},children:[i.jsx(pa,{score:x?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:p,branding:u}),i.jsxs("div",{style:{flex:1},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:u.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),i.jsx("p",{style:{fontSize:"14px",color:u.textSecondary,margin:0,lineHeight:1.5},children:x?.summary||"Deine Antwort wurde analysiert."})]})]}),x?.scores&&i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:u.cardBg,borderRadius:"12px"},children:[i.jsx(pa,{score:x.scores.content,label:"Inhalt",primaryAccent:p,branding:u}),i.jsx(pa,{score:x.scores.structure,label:"Struktur",primaryAccent:p,branding:u}),i.jsx(pa,{score:x.scores.relevance,label:"Relevanz",primaryAccent:p,branding:u})]}),i.jsx(ir,{title:"Transkript",icon:Ze,defaultOpen:!0,primaryAccent:p,branding:u,children:i.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:u.cardBgHover,fontStyle:"italic",color:u.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verfgbar.",'"']})}),s&&i.jsx(ir,{title:"Deine Aufnahme",icon:_i,defaultOpen:!0,primaryAccent:p,branding:u,children:i.jsx(pD,{audioUrl:s,primaryAccent:p,branding:u})}),x?.strengths?.length>0&&i.jsx(ir,{title:"Strken",icon:Gn,defaultOpen:!0,primaryAccent:p,branding:u,children:x.strengths.map((g,y)=>i.jsx(Mc,{text:g,type:"strength",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),x?.improvements?.length>0&&i.jsx(ir,{title:"Verbesserungen",icon:xs,defaultOpen:!0,primaryAccent:p,branding:u,children:x.improvements.map((g,y)=>i.jsx(Mc,{text:g,type:"improvement",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),x?.tips?.length>0&&i.jsx(ir,{title:"Tipps",icon:Be,defaultOpen:!1,primaryAccent:p,branding:u,children:x.tips.map((g,y)=>i.jsx(Mc,{text:g,type:"tip",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),n&&i.jsx(ir,{title:"Sprechanalyse",icon:Ue,defaultOpen:!1,primaryAccent:p,branding:u,children:i.jsx(hD,{metrics:n,branding:u})}),!c&&i.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[r&&i.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${u.borderColor}`,backgroundColor:u.cardBg,color:u.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.borderColor=p,g.target.style.color=p},onMouseLeave:g=>{g.target.style.borderColor=u.borderColor,g.target.style.color=u.textSecondary},children:[i.jsx(Ai,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),i.jsx("button",{onClick:l?a:o,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:h,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`,transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.transform="translateY(-2px)",g.target.style.boxShadow=`0 6px 16px ${p}66`},onMouseLeave:g=>{g.target.style.transform="none",g.target.style.boxShadow=`0 4px 12px ${p}4d`},children:l?i.jsxs(i.Fragment,{children:[i.jsx(cl,{style:{width:"18px",height:"18px"}}),"Training abschlieen"]}):i.jsxs(i.Fragment,{children:["Nchste Frage",i.jsx(Et,{style:{width:"18px",height:"18px"}})]})})]})]})},Nv=({current:t,total:e,answeredQuestions:n=[],primaryAccent:s,b:r,labels:o,showCompleted:a=!0})=>{const l=(t+1)/e*100,c=o?.questionFallback||"Frage",d=p=>{const m=p===t,x=n.length>0?n.includes(p):p<t;return m?s:x?E.green[500]:E.slate[300]},u=p=>{const m=n.length>0?n.includes(p):p<t;return`${c} ${p+1}${m?" (beantwortet)":""}`},h=()=>o?.questionCounter?o.questionCounter(t+1,e):`${c} ${t+1} von ${e}`;return i.jsxs("div",{style:{marginBottom:r.space[6]},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:r.space[2]},children:[i.jsx("span",{style:{fontSize:r.fontSize.sm,fontWeight:600,color:E.slate[700]},children:h()}),i.jsxs("span",{style:{fontSize:r.fontSize.sm,fontWeight:a?400:600,color:a?E.slate[500]:s},children:[Math.round(l),"%",a?" abgeschlossen":""]})]}),i.jsx("div",{style:{height:"8px",backgroundColor:E.slate[200],borderRadius:r.radius.sm,overflow:"hidden",marginBottom:r.space[3]},children:i.jsx($.div,{initial:{width:0},animate:{width:`${l}%`},transition:{duration:parseFloat(r.transition.normal.replace("s",""))},style:{height:"100%",background:s,borderRadius:r.radius.sm}})}),i.jsx("div",{style:{display:"flex",gap:r.space[1.5],justifyContent:"center"},children:Array.from({length:e},(p,m)=>i.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:d(m),transition:`all ${r.transition.normal}`},title:u(m)},m))})]})},bh=({isLoading:t,message:e="Wird geladen...",subMessage:n=null})=>{const{branding:s}=qe(),r=s?.["--header-gradient"]||_e["--header-gradient"];return i.jsx(Ve,{children:t&&i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:i.jsxs($.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3,delay:.1},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"40px 60px",backgroundColor:"white",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.15)"},children:[i.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:r,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(me,{style:{width:"32px",height:"32px",color:"white",animation:"spin 1s linear infinite"}})}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("p",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:e}),n&&i.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginTop:"8px",margin:"8px 0 0 0"},children:n})]})]})})})},nm={target:rt,clock:Ye,mic:Ue,"message-square":Ze,lightbulb:Be,brain:Vp,info:mn,settings:di,check:Jt,Target:rt,Clock:Ye,Mic:Ue,MessageSquare:Ze,Lightbulb:Be,Brain:Vp},gD=({tips:t,primaryAccent:e,tipsLabel:n,branding:s})=>{const[r,o]=f.useState(!0);return!t||t.length===0?null:i.jsxs("div",{style:{background:s.cardBg,borderRadius:s.radius.xl,border:`1px solid ${s.borderColor}`,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:`${s.space[4]} ${s.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:s.space[2],fontSize:s.fontSize.base,fontWeight:s.fontWeight.semibold,color:s.textMain},children:[i.jsx(Be,{size:s.iconSize.md,color:e}),n||"Tipps fr diese Frage"]}),i.jsx(bt,{size:s.iconSize.md,color:s.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:s.transition.normal}})]}),i.jsx(Ve,{children:r&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:`0 ${s.space[6]} ${s.space[6]}`},children:t.map((a,l)=>i.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.md,backgroundColor:s.warningLight,marginBottom:l<t.length-1?s.space[2]:0},children:[i.jsx(Be,{style:{width:s.iconSize.sm,height:s.iconSize.sm,color:s.warning,flexShrink:0,marginTop:"2px"}}),i.jsx("p",{style:{fontSize:s.fontSize.base,color:s.textSecondary,margin:0,lineHeight:1.5},children:a.replace(/^Tipp \d+:\s*/i,"")})]},l))})})})]})},mD=({seconds:t,maxSeconds:e,isRecording:n,branding:s})=>{const r=e>0?t/e*100:0,o=r>75,a=r>90;return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.lg,backgroundColor:a?s.errorLight:o?s.warningLight:s.cardBgHover},children:[i.jsx(Ye,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:a?s.error:o?s.warning:s.textSecondary}}),i.jsx("span",{style:{fontSize:s.fontSize.xl,fontWeight:s.fontWeight.semibold,fontFamily:"monospace",color:a?s.error:o?s.warning:s.textSecondary},children:yt(t)}),i.jsxs("span",{style:{fontSize:s.fontSize.base,color:s.textMuted},children:["/ ",yt(e)]})]})},im=({onRecordingComplete:t,timeLimit:e,disabled:n,deviceId:s,themedGradient:r,primaryAccent:o,isSubmitting:a,labels:l,onOpenSettings:c,branding:d,isMobile:u})=>{const[h,p]=f.useState("idle"),[m,x]=f.useState(0),[g,y]=f.useState(0),[v,k]=f.useState(!1),S=f.useRef(null),w=f.useRef([]),b=f.useRef(null),T=f.useRef(null),C=f.useRef(null),j=f.useRef(null),R=f.useRef(null),I=f.useRef(0),A=f.useRef(!1);f.useEffect(()=>()=>{L()},[]),f.useEffect(()=>{h==="recording"&&m>=e&&O()},[m,e,h]);const L=()=>{b.current&&clearInterval(b.current),j.current&&cancelAnimationFrame(j.current),T.current&&(T.current.close(),T.current=null),R.current&&(R.current.getTracks().forEach(D=>D.stop()),R.current=null)},B=async()=>{try{k(!1),w.current=[],x(0);let D;const N={audio:s?{deviceId:{exact:s}}:!0};try{D=await navigator.mediaDevices.getUserMedia(N)}catch(Z){throw console.error("[SIMULATOR] Selected device unavailable:",Z),Z.name==="OverconstrainedError"||Z.name==="NotFoundError"?(k(!1),new Error("Das ausgewhlte Mikrofon ist nicht verfgbar. Bitte whle ein anderes Mikrofon in den Einstellungen.")):Z}R.current=D,T.current=new(window.AudioContext||window.webkitAudioContext),C.current=T.current.createAnalyser(),T.current.createMediaStreamSource(D).connect(C.current),C.current.fftSize=256;const ne=()=>{if(C.current&&A.current){const Z=new Uint8Array(C.current.frequencyBinCount);C.current.getByteFrequencyData(Z);const ee=Z.reduce((se,z)=>se+z)/Z.length;y(ee/255)}j.current=requestAnimationFrame(ne)};A.current=!0,ne();const re=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";S.current=new MediaRecorder(D,{mimeType:re}),S.current.ondataavailable=Z=>{Z.data.size>0&&w.current.push(Z.data)},S.current.onstop=()=>{const Z=new Blob(w.current,{type:re});t(Z,I.current)},S.current.start(1e3),p("recording"),b.current=setInterval(()=>{x(Z=>Z+1)},1e3)}catch(D){console.error("Error starting recording:",D),(D.name==="NotAllowedError"||D.name==="PermissionDeniedError")&&k(!0)}},P=()=>{S.current&&S.current.state==="recording"&&(S.current.pause(),p("paused"),A.current=!1,b.current&&(clearInterval(b.current),b.current=null),y(0))},_=()=>{S.current&&S.current.state==="paused"&&(S.current.resume(),p("recording"),A.current=!0,b.current=setInterval(()=>{x(D=>D+1)},1e3))},O=()=>{I.current=m,A.current=!1,b.current&&(clearInterval(b.current),b.current=null),j.current&&(cancelAnimationFrame(j.current),j.current=null),T.current&&(T.current.close(),T.current=null),S.current&&S.current.state!=="inactive"&&S.current.stop(),R.current&&(R.current.getTracks().forEach(D=>D.stop()),R.current=null),p("idle"),y(0),x(0)},W=()=>{h==="idle"?B():h==="recording"?P():h==="paused"&&_()};return v?i.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.errorLight,textAlign:"center"},children:[i.jsx(l0,{style:{width:"48px",height:"48px",color:d.error,marginBottom:"12px"}}),i.jsx("p",{style:{color:d.error,fontWeight:600,margin:0},children:"Mikrofonzugriff verweigert"}),i.jsx("p",{style:{color:d.textSecondary,fontSize:"14px",marginTop:"8px"},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]}):i.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.cardBg,border:`1px solid ${d.borderColor}`,position:"relative"},children:[u&&i.jsx("button",{onClick:c,style:{position:"absolute",top:"12px",right:"12px",padding:"10px",borderRadius:"10px",background:d.cardBgHover,border:`1px solid ${d.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(di,{size:18,color:d.textMuted})}),i.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:i.jsx(mD,{seconds:m,maxSeconds:e,isRecording:h==="recording",branding:d})}),h==="recording"&&i.jsx("div",{style:{marginBottom:"24px"},children:i.jsx(_r,{audioLevel:g,isActive:!0,variant:"bars",size:"sm",accentColor:o})}),h==="paused"&&i.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"60px",marginBottom:"24px",color:d.warning},children:[i.jsx(Ue,{size:24}),i.jsx("span",{style:{fontSize:"16px",fontWeight:600},children:"Aufnahme pausiert"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[!u&&i.jsx("button",{onClick:c,style:{padding:"14px",borderRadius:"12px",background:d.cardBgHover,border:`1px solid ${d.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(di,{size:20,color:d.textMuted})}),i.jsxs("button",{onClick:W,disabled:n||a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:u?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",flex:u?1:"none",background:h==="idle"?n||a?d.borderColor:d.error:h==="recording"?d.warning:d.success,color:"white",fontSize:u?"15px":"16px",fontWeight:600,cursor:n||a?"not-allowed":"pointer",boxShadow:n||a?"none":"0 4px 14px rgba(0, 0, 0, 0.2)"},children:[h==="idle"&&i.jsxs(i.Fragment,{children:[i.jsx(Ue,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]}),h==="recording"&&i.jsxs(i.Fragment,{children:[i.jsx(zs,{style:{width:"18px",height:"18px"}}),"Pausieren"]}),h==="paused"&&i.jsxs(i.Fragment,{children:[i.jsx(Lt,{style:{width:"18px",height:"18px"}}),"Fortsetzen"]})]}),(h==="recording"||h==="paused")&&i.jsxs("button",{onClick:O,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:u?"14px 16px":"14px 24px",borderRadius:"12px",border:"none",flex:u?1:"none",backgroundColor:d.cardBgHover,color:d.textMain,fontSize:u?"15px":"16px",fontWeight:600,cursor:"pointer"},children:[i.jsx(Jt,{style:{width:"18px",height:"18px",color:d.success}}),l?.submitButton||"Antwort abgeben"]})]}),h==="idle"&&!a&&i.jsx("p",{style:{textAlign:"center",marginTop:"16px",color:d.textMuted,fontSize:"14px"},children:l?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),a&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"24px"},children:[i.jsx(me,{style:{width:"32px",height:"32px",color:o,animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{marginTop:"12px",color:d.textSecondary,fontSize:"14px"},children:l?.analyzing||"Antwort wird analysiert..."})]}),i.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      `})]})},xD=({scenario:t,variables:e,questions:n,onStart:s,onBack:r,selectedMicrophoneId:o,onMicrophoneChange:a,onMicrophoneTest:l,themedGradient:c,primaryAccent:d,primaryAccentLight:u,isLoading:h,branding:p})=>{const m=t?.mode==="SIMULATION",x=m?"Situationen":"Fragen",g=m?"Zeit pro Situation":"Zeit pro Frage",y=[{icon:rt,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fr Beispiele aus deiner Erfahrung."},{icon:Ye,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${m?"Situation":"Frage"}. ${m?"Reagiere":"Antworte"} przise, aber ausfhrlich genug.`},{icon:Ue,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vllig in Ordnung."},{icon:Ze,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mglich."}],v=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((b,T)=>typeof b=="string"?{icon:Be,title:`Tipp ${T+1}`,description:b}:{icon:nm[b.icon]||nm[b.icon?.toLowerCase()]||Be,title:b.title||`Tipp ${T+1}`,description:b.text||b.description||""}):y,k=Cn.useMemo(()=>{if(!t?.input_configuration)return{};try{const b=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(b)?b.reduce((T,C)=>(C.key&&C.label&&(T[C.key]=C.label),T),{}):{}}catch{return{}}},[t?.input_configuration]),S=e?Object.entries(e).filter(([b,T])=>T&&T.trim&&T.trim()!=="").map(([b,T])=>({label:k[b]||b.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase()),value:T})):[],w=b=>{if(!b||!e)return b;let T=b;return Object.entries(e).forEach(([C,j])=>{j&&(T=T.replace(new RegExp(`\\$\\{${C}\\}`,"g"),j),T=T.replace(new RegExp(`\\{${C}\\}`,"g"),j))}),T};return i.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:"32px"},children:[i.jsxs("button",{onClick:r,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:p.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px"},children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Be,{style:{width:"32px",height:"32px",color:"white"}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:p.textMain,margin:0},children:"Vorbereitung"}),i.jsxs("p",{style:{fontSize:"16px",color:p.textSecondary,margin:"4px 0 0 0"},children:[t.title,n.length>0?`  ${n.length} ${x}`:""]})]})]})]}),t.long_description&&i.jsx("div",{style:{padding:"20px 24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:c,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(mn,{style:{width:"20px",height:"20px",color:"white"}})}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:p.textMain,margin:"0 0 8px 0"},children:"Deine Aufgabe"}),i.jsx("p",{style:{fontSize:"15px",lineHeight:"1.6",color:p.textSecondary,margin:0,whiteSpace:"pre-wrap"},children:w(t.long_description?.replace(/\/n/g,`
`))})]})]})}),S.length>0&&i.jsxs("div",{style:{padding:"20px",borderRadius:"16px",backgroundColor:u,marginBottom:"24px"},children:[i.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:d,margin:"0 0 12px 0",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dein Profil"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:S.map((b,T)=>i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:b.label}),i.jsx("span",{style:{fontSize:"15px",fontWeight:500,color:p.textMain},children:b.value})]},T))})]}),i.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[i.jsx(Ue,{style:{width:"22px",height:"22px",color:d}}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:p.textMain,margin:0},children:"Mikrofon testen"})]}),i.jsx(Uu,{selectedDeviceId:o,onDeviceChange:a,onTestClick:l})]}),i.jsxs("button",{onClick:s,disabled:h,style:{width:"100%",padding:"18px 28px",borderRadius:"14px",border:"none",background:h?p.borderColor:c,color:"white",fontSize:"18px",fontWeight:600,cursor:h?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:h?"none":`0 4px 12px ${d}4d`,marginBottom:"24px",opacity:h?.7:1},children:[i.jsx(Lt,{style:{width:"24px",height:"24px"}}),"Gesprch starten"]}),i.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[i.jsx(Be,{style:{width:"22px",height:"22px",color:p.warning}}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:p.textMain,margin:0},children:"Tipps fr dein Gesprch"})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:v.map((b,T)=>i.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"12px",backgroundColor:p.cardBgHover},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:u,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(b.icon,{style:{width:"22px",height:"22px",color:d}})}),i.jsxs("div",{children:[i.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:p.textMain,margin:"0 0 4px 0"},children:b.title}),i.jsx("p",{style:{fontSize:"14px",color:p.textSecondary,margin:0,lineHeight:1.5},children:b.description})]})]},T))})]}),i.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:p.cardBgHover,display:"flex",gap:"24px",flexWrap:"wrap"},children:[n.length>0&&i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:x}),i.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:n.length})]}),i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:g}),i.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),i.jsxs("div",{children:[i.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:"Wiederholen"}),i.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},yD=({session:t,questions:e,scenario:n,variables:s,preloadedQuestions:r,onSessionCreated:o,onComplete:a,onExit:l,startFromQuestion:c=0,initialMicrophoneId:d})=>{const u=xn(),[h,p]=f.useState(t),[m,x]=f.useState(e||[]),[g,y]=f.useState(!1),[v,k]=f.useState(null),{demoCode:S}=qe(),w=n?.mode==="SIMULATION",b={questionLabel:w?"Situation / Aussage des Gegenbers:":"Interviewfrage:",questionFallback:w?"Situation":"Frage",questionLoading:w?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:w?"Deine Reaktion...":"Deine Antwort...",submitButton:w?"Reaktion abgeben":"Antwort abgeben",submitHint:w?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:w?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(Q,Pe)=>w?`Situation ${Q} von ${Pe}`:`Frage ${Q} von ${Pe}`,questionsCount:Q=>w?`${Q} Situationen`:`${Q} Fragen`,answeredCount:(Q,Pe)=>w?`${Q} von ${Pe} Situationen`:`${Q} von ${Pe} Fragen`,tipsLabel:w?"Tipps fr diese Situation":"Tipps fr diese Frage",nextButton:w?"Nchste Situation":"Nchste Frage",timePerQuestion:w?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:w?"Situationen":"Fragen",recommendedTime:w?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},T=c>0;r&&r.length>0;const C=T?Array.from({length:c},(Q,Pe)=>Pe):[],[j,R]=f.useState(T?"interview":"preparation"),[I,A]=f.useState(c||h?.current_question_index||0),[L,B]=f.useState(null),[P,_]=f.useState(!1),[O,W]=f.useState(!1),[D,N]=f.useState(null),[F,ne]=f.useState([]),[re,Z]=f.useState(C),ee="karriereheld_selected_microphone",[se,z]=f.useState(()=>{if(d)return d;try{return localStorage.getItem(ee)||null}catch{return null}}),[V,H]=f.useState(!1),[pe,Te]=f.useState(!1);f.useEffect(()=>{if(se)try{localStorage.setItem(ee,se)}catch{}},[se]);const[Le,we]=f.useState(!1),[Qe,ye]=f.useState(!1),[Ee,Ke]=f.useState(!1),[Me,et]=f.useState(null),[X,he]=f.useState(!1),{branding:be}=qe(),ue=Ge(),gt=be?.["--header-gradient"]||_e["--header-gradient"],lt=be?.["--button-gradient"]||gt,je=be?.["--primary-accent"]||_e["--primary-accent"],fe=be?.["--primary-accent-light"]||_e["--primary-accent-light"],oe=m[I],xe=I===m.length-1,tt=I===0,cn=async(Q,Pe)=>{if(Pe<2){N("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(Q.size<5e3){console.warn("[SimulatorSession] Audio too small:",Q.size,"bytes"),N("Die Aufnahme enthlt keine verwertbaren Audiodaten. Bitte sprechen Sie whrend der Aufnahme und versuchen Sie es erneut.");return}W(!0),N(null);try{const Je=await ce.submitSimulatorAnswer(h.id,Q,I,oe.question,oe.category,Pe);if(!Je.success)throw new Error(Je.message||"Fehler beim Analysieren der Antwort");if(B(Je.data),_(!0),ne(vt=>[...vt.filter(xi=>xi.questionIndex!==I),{questionIndex:I,feedback:Je.data}]),Z(vt=>vt.includes(I)?vt:[...vt,I]),w&&!X){Ke(!0),et(null);const vt=re.includes(I);try{const xi=await ce.generateNextTurn(h.id);if(xi.success){const Jn=xi.data.next_question;xi.data.is_finished?(et(Jn),x(vt?Dn=>{const Ui=[...Dn];return Ui[I+1]=Jn,Ui.slice(0,I+2)}:Dn=>[...Dn,Jn]),he(!0)):(et(Jn),vt?(x(Dn=>{const Ui=[...Dn];return Ui[I+1]=Jn,Ui.slice(0,I+2)}),he(!1)):x(Dn=>[...Dn,Jn]))}}catch(xi){console.error("Error generating next turn:",xi)}finally{Ke(!1)}}}catch(Je){console.error("Error submitting answer:",Je),N(Je.message||"Ein Fehler ist aufgetreten")}finally{W(!1)}},Ft=()=>{B(null),_(!1),N(null)},en=()=>{if(B(null),_(!1),N(null),w){if(Me){A(Q=>Q+1),et(null);return}if(X){$i();return}}else xe||A(Q=>Q+1)},Wi=()=>{B(null),_(!1),N(null),tt||A(Q=>Q-1)},mi=()=>{we(!0)},$i=async()=>{we(!1);try{const Q=await ce.completeSimulatorSession(h.id);Q.success?a(Q.data):a({session:{...h,status:"completed"}})}catch(Q){console.error("Error completing session:",Q),a({session:{...h,status:"completed"}})}},vs=()=>{ye(!0)},Ur=()=>{ye(!1),l()},Vr=async()=>{if(h&&m.length>0){R("interview");return}y(!0),k(null);try{const Q=await ce.createSimulatorSession({scenario_id:n.id,variables:s,demo_code:S||null,questions:r||null});if(!Q.success)throw new Error(Q.message||"Fehler beim Erstellen der Session");const Pe=Q.data.session;let Je;if(r&&r.length>0)Je=r,await ce.updateSimulatorSessionQuestions(Pe.id,Je);else{const vt=await ce.generateSimulatorQuestions(Pe.id);if(!vt.success)throw new Error(vt.message||"Fehler beim Generieren der Fragen");Je=vt.data.questions}p({...Pe,questions_json:Je}),x(Je),o&&o({session:{...Pe,questions_json:Je},questions:Je,selectedMicrophoneId:se}),R("interview")}catch(Q){console.error("Error creating session:",Q),k(Q.message||"Ein Fehler ist aufgetreten")}finally{y(!1)}};return j==="preparation"?i.jsxs(i.Fragment,{children:[i.jsx(xD,{scenario:n,variables:s,questions:m,onStart:Vr,onBack:l,selectedMicrophoneId:se,onMicrophoneChange:z,onMicrophoneTest:()=>H(!0),themedGradient:lt,primaryAccent:je,primaryAccentLight:fe,isLoading:g,branding:ue}),i.jsx(Vu,{isOpen:V,onClose:()=>H(!1),deviceId:se}),v&&i.jsx("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",fontSize:"14px",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100},children:v}),i.jsx(bh,{isLoading:g,message:w?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]}):i.jsxs("div",{style:{padding:u?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:u?"column":"row",justifyContent:"space-between",alignItems:u?"stretch":"center",gap:u?"12px":"0",marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:u?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:u?"space-between":"flex-end"},children:[!(P&&(w&&X&&!Me||!w&&xe))&&i.jsxs("button",{onClick:mi,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#22c55e",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"white",fontSize:"14px",fontWeight:600,boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)",flex:u?1:"none",justifyContent:"center"},children:[i.jsx(Pn,{size:16}),u?"Beenden":"Training beenden"]}),i.jsxs("button",{onClick:vs,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",flex:u?1:"none",justifyContent:"center"},children:[i.jsx(Bt,{size:16}),"Abbrechen"]})]})]}),Le&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>we(!1),children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:Q=>Q.stopPropagation(),children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Pn,{size:24,color:"#22c55e"})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training beenden?"})]}),re.length>0?i.jsxs(i.Fragment,{children:[i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"8px"},children:["Du hast ",i.jsx("strong",{children:b.answeredCount(re.length,m.length)})," beantwortet."]}),i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Mchtest du das Training jetzt mit den bisherigen Antworten abschlieen oder weitere ",b.questionsLabel," beantworten?"]})]}):i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Du hast noch keine ",b.questionsLabel," beantwortet. Mchtest du das Training wirklich beenden?"]}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:()=>we(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Weiter trainieren"}),i.jsx("button",{onClick:$i,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#22c55e",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)"},children:"Training beenden"})]})]})}),Qe&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>ye(!1),children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:Q=>Q.stopPropagation(),children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Ie,{size:24,color:"#ef4444"})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training abbrechen?"})]}),i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:[i.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",re.length>0?` (${re.length} ${b.questionsLabel})`:""," ",i.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:()=>ye(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Zurck"}),i.jsx("button",{onClick:Ur,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:"Abbrechen"})]})]})}),!P&&!w&&i.jsxs("div",{style:{display:"flex",gap:u?"8px":"12px",justifyContent:"center",marginBottom:"16px"},children:[i.jsxs("button",{onClick:Wi,disabled:tt,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${ue.borderColor}`,backgroundColor:ue.cardBg,color:tt?ue.textMuted:ue.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:tt?"not-allowed":"pointer",opacity:tt?.5:1,flex:u?1:"none",justifyContent:"center"},children:[i.jsx(Oa,{size:16}),"Zurck"]}),i.jsxs("button",{onClick:en,disabled:xe,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${ue.borderColor}`,backgroundColor:ue.cardBg,color:xe?ue.textMuted:ue.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:xe?"not-allowed":"pointer",opacity:xe?.5:1,flex:u?1:"none",justifyContent:"center"},children:[u?"berspringen":"Frage berspringen",i.jsx(Et,{size:16})]})]}),i.jsx(Nv,{current:I,total:m.length,answeredQuestions:re,primaryAccent:je,b:ue,labels:b}),P?i.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px",justifyContent:"flex-end"},children:[n.allow_retry&&i.jsxs("button",{onClick:Ft,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:`2px solid ${ue.borderColor}`,backgroundColor:ue.cardBg,color:ue.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[i.jsx(Ai,{size:16}),"Nochmal versuchen"]}),i.jsxs("button",{onClick:w?X&&!Me?$i:en:xe?$i:en,disabled:w&&Ee&&!X,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:"none",background:w&&Ee&&!X?ue.textMuted:lt,color:"white",fontSize:"14px",fontWeight:600,cursor:w&&Ee&&!X?"wait":"pointer",boxShadow:w&&Ee&&!X?"none":`0 4px 12px ${je}4d`,opacity:w&&Ee&&!X?.7:1},children:[w&&Ee&&!X?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:16,className:"animate-spin",style:{animation:"spin 1s linear infinite"}}),"Gesprchspartner tippt..."]}):w?X&&!Me?"Training abschlieen":b.nextButton:xe?"Training abschlieen":b.nextButton,!Ee&&!(w?X&&!Me:xe)&&i.jsx(Et,{size:16})]})]}),i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:"1px solid #e2e8f0",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:lt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:I+1}),i.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:oe?.category||b.questionFallback})]}),i.jsx("p",{style:{fontSize:"16px",fontWeight:500,color:"#0f172a",margin:0,lineHeight:1.5},children:oe?.question||b.questionLoading})]}),i.jsx(fD,{transcript:L.transcript,feedback:L.feedback,audioMetrics:L.audio_analysis,audioUrl:L.audio_url,hideButtons:!0})]}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:u?"16px":"24px"},children:[u?i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:lt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:I+1}),i.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:oe?.category||b.questionFallback})]}),i.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:oe?.question||b.questionLoading}),oe?.estimated_answer_time&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[i.jsx(Ye,{size:14}),b.recommendedTime,": ca. ",Math.round(oe.estimated_answer_time/60)," Min"]})]}),i.jsx(im,{onRecordingComplete:cn,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:se,themedGradient:lt,primaryAccent:je,isSubmitting:O,labels:b,onOpenSettings:()=>Te(!0),branding:ue,isMobile:!0}),D&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"16px",borderRadius:"12px",backgroundColor:ue.errorLight},children:[i.jsx(Ie,{style:{width:"24px",height:"24px",color:ue.error}}),i.jsx("p",{style:{marginTop:"8px",color:ue.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:D}),i.jsx("button",{onClick:Ft,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:ue.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}):i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[i.jsxs("div",{children:[i.jsx(im,{onRecordingComplete:cn,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:se,themedGradient:lt,primaryAccent:je,isSubmitting:O,labels:b,onOpenSettings:()=>Te(!0),branding:ue,isMobile:!1}),D&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",marginTop:"16px",borderRadius:"12px",backgroundColor:ue.errorLight},children:[i.jsx(Ie,{style:{width:"24px",height:"24px",color:ue.error}}),i.jsx("p",{style:{marginTop:"8px",color:ue.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:D}),i.jsx("button",{onClick:Ft,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:ue.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}),i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:lt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:I+1}),i.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:oe?.category||b.questionFallback})]}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:oe?.question||b.questionLoading}),oe?.estimated_answer_time&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[i.jsx(Ye,{size:16}),b.recommendedTime,": ca. ",Math.round(oe.estimated_answer_time/60)," Min"]})]})]}),oe?.tips&&oe.tips.length>0&&i.jsx(gD,{tips:oe.tips,primaryAccent:je,tipsLabel:b.tipsLabel,branding:ue})]}),i.jsx(yh,{isOpen:pe,onClose:()=>Te(!1),mode:"audio",selectedMicrophoneId:se,onMicrophoneChange:z})]})},fa=({score:t,label:e,primaryAccent:n,b:s})=>{const r=t!=null?t*10:null,o=rn(r,n);return i.jsxs("div",{style:{textAlign:"center",padding:s.space[4],backgroundColor:E.slate[100],borderRadius:s.radius.lg},children:[i.jsx("div",{style:{fontSize:s.fontSize["4xl"],fontWeight:700,color:o,marginBottom:"4px"},children:r!=null?Math.round(r):"-"}),i.jsx("div",{style:{fontSize:s.fontSize.sm,color:E.slate[600]},children:e})]})},Pc=({icon:t,value:e,label:n,primaryAccent:s,b:r})=>i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[3],padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:E.slate[100],borderRadius:r.radius.md},children:[i.jsx(t,{style:{width:"20px",height:"20px",color:s}}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:r.fontSize.xl,fontWeight:600,color:E.slate[900]},children:e}),i.jsx("div",{style:{fontSize:r.fontSize.xs,color:E.slate[500]},children:n})]})]}),bD=({session:t,scenario:e,onBackToDashboard:n,onStartNew:s})=>{const r=Ge(),o=t.summary_feedback||t.summary_feedback_json,a=o?typeof o=="string"?JSON.parse(o):o:null,l=t.overall_score||a?.overall_score||0,c=l<=10?l*10:l,u=(h=>h>=90?{text:"Ausgezeichnet!",emoji:""}:h>=80?{text:"Sehr gut!",emoji:""}:h>=70?{text:"Gut!",emoji:""}:h>=60?{text:"Solide Leistung",emoji:""}:h>=50?{text:"Ausbaufhig",emoji:""}:{text:"Weiter ben!",emoji:""})(c);return i.jsxs("div",{style:{padding:r.space[6],maxWidth:"640px",margin:"0 auto"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:r.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:i.jsx(cl,{style:{width:"40px",height:"40px",color:"white"}})}),i.jsxs("h1",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:E.slate[900],margin:"0 0 8px 0"},children:["Training abgeschlossen! ",u.emoji]}),i.jsxs("p",{style:{fontSize:r.fontSize.lg,color:E.slate[600],margin:0},children:[e?.title||"Skill Training"," - ",u.text]})]}),i.jsxs("div",{style:{padding:r.space[6],borderRadius:r.radius.xl,backgroundColor:"white",border:`1px solid ${E.slate[200]}`,textAlign:"center",marginBottom:r.space[6]},children:[i.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",border:`6px solid ${r.primaryAccent}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",backgroundColor:r.primaryAccentLight},children:i.jsx("span",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:r.primaryAccent},children:c?Math.round(c):"-"})}),i.jsx("p",{style:{fontSize:r.fontSize.base,color:E.slate[500],margin:0},children:c?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[i.jsx(Pc,{icon:Jt,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),i.jsx(Pc,{icon:rt,value:a?.average_content_score?Math.round(a.average_content_score*10):"-",label:" Inhalt",primaryAccent:r.primaryAccent,b:r}),i.jsx(Pc,{icon:Vt,value:a?.average_delivery_score?Math.round(a.average_delivery_score*10):"-",label:" Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.scores&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[i.jsx(fa,{score:a.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),i.jsx(fa,{score:a.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),i.jsx(fa,{score:a.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),i.jsx(fa,{score:a.scores.delivery,label:"Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.summary&&i.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:E.slate[100],marginBottom:r.space[6]},children:[i.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:E.slate[700],margin:"0 0 8px 0"},children:"Zusammenfassung"}),i.jsx("p",{style:{fontSize:r.fontSize.base,color:E.slate[600],margin:0,lineHeight:1.6},children:a.summary})]}),a?.key_takeaways?.length>0&&i.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:E.green[100],marginBottom:r.space[6]},children:[i.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:E.green[500],margin:"0 0 12px 0"},children:" Die wichtigsten Erkenntnisse"}),i.jsx("ul",{style:{margin:0,paddingLeft:r.space[5],color:E.slate[700],fontSize:r.fontSize.base,lineHeight:1.6},children:a.key_takeaways.map((h,p)=>i.jsx("li",{style:{marginBottom:"8px"},children:h},p))})]}),i.jsxs("div",{style:{display:"flex",gap:r.space[3],marginTop:"32px"},children:[i.jsxs("button",{onClick:n,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:`2px solid ${E.slate[300]}`,backgroundColor:"white",color:E.slate[700],fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.borderColor=r.primaryAccent,h.target.style.color=r.primaryAccent},onMouseLeave:h=>{h.target.style.borderColor=E.slate[300],h.target.style.color=E.slate[700]},children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zur bersicht"]}),i.jsxs("button",{onClick:s,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:"none",background:r.buttonGradient,color:"white",fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${r.primaryAccent}4d`,transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.transform="translateY(-2px)",h.target.style.boxShadow=`0 6px 16px ${r.primaryAccent}66`},onMouseLeave:h=>{h.target.style.transform="none",h.target.style.boxShadow=`0 4px 12px ${r.primaryAccent}4d`},children:[i.jsx(Ai,{style:{width:"18px",height:"18px"}}),"Nochmal ben"]})]})]})},bn={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},vD=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingContinueSession:s,clearPendingContinueSession:r,pendingRepeatSession:o,clearPendingRepeatSession:a,onNavigateToHistory:l})=>{const[c,d]=f.useState(bn.DASHBOARD),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState([]),[y,v]=f.useState({}),[k,S]=f.useState(null),[w,b]=f.useState(null),[T,C]=f.useState(null),[j,R]=f.useState(0);f.useEffect(()=>{T&&t&&(h(T),d(bn.VARIABLES),C(null))},[T,t]),f.useEffect(()=>{if(s&&t){const{session:D,scenario:N}=s,F=D.questions||D.questions_json,ne=typeof F=="string"?JSON.parse(F):F||[],re=D.completed_questions||D.answered_count||0;h(N||{id:D.scenario_id,title:D.scenario_title}),m(D),g(ne),v({}),R(re),d(bn.SESSION),r&&r()}},[s,t,r]),f.useEffect(()=>{if(o&&t){const{session:D,scenario:N}=o,F=D.questions||D.questions_json,ne=typeof F=="string"?JSON.parse(F):F||[];h(N||{id:D.scenario_id,title:D.scenario_title}),g(ne),v({}),R(0),d(bn.SESSION),a&&a()}},[o,t,a]),f.useEffect(()=>{window.scrollTo(0,0)},[c]);const I=f.useCallback(D=>{h(D),d(bn.VARIABLES)},[]),A=f.useCallback(()=>{h(null),m(null),g([]),v({}),S(null),R(0),b(null),d(bn.DASHBOARD)},[]),L=f.useCallback(D=>{v(D),d(bn.SESSION)},[]),B=f.useCallback(D=>{m(D.session),g(D.questions),D.selectedMicrophoneId&&b(D.selectedMicrophoneId)},[]),P=f.useCallback(D=>{S(D.session),d(bn.COMPLETE)},[]),_=f.useCallback(()=>{A()},[A]),O=f.useCallback(()=>{m(null),g([]),S(null),R(0),b(null),d(bn.VARIABLES)},[]),W=()=>{switch(c){case bn.DASHBOARD:return i.jsx(tm,{onSelectScenario:I,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:l});case bn.VARIABLES:return i.jsx(uD,{scenario:u,onBack:A,onNext:L});case bn.SESSION:return i.jsx(yD,{session:p,questions:x,scenario:u,variables:y,preloadedQuestions:x.length>0?x:null,onSessionCreated:B,onComplete:P,onExit:_,startFromQuestion:j,initialMicrophoneId:w});case bn.COMPLETE:return i.jsx(bD,{session:k,scenario:u,onBackToDashboard:A,onStartNew:O});default:return i.jsx(tm,{onSelectScenario:I,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:l})}};return i.jsx("div",{style:{minHeight:"100%"},children:W()})},SD={video:jt,user:Qt,briefcase:jn,presentation:c0,mic:Ue,target:rt,banknote:ms},kD={self_presentation:{label:"Selbstprsentation",icon:Qt,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgesprch",icon:jn,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:pi,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:Zj,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:rt,color:"#64748b",bgColor:"#f1f5f9"}},wD=async()=>{const t=await fetch(`${vn()}/video-training/scenarios`,{headers:{"X-WP-Nonce":At()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Ungltige Antwort vom Server")},CD=t=>SD[t.icon]||jt,jD=t=>[{text:`${t.question_count} Fragen`},{icon:Ye,text:`~${Math.round(t.total_time_limit/60)} Min.`}],TD=t=>i.jsx("div",{style:{marginTop:"40px",padding:"20px",background:`linear-gradient(135deg, ${t}10 0%, ${t}05 100%)`,borderRadius:"12px",border:`1px solid ${t}20`},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(st,{size:20,color:t,style:{flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Wie funktioniert das Video Training?"}),i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,margin:0},children:["1. Whle ein Szenario und konfiguriere dein Training",i.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",i.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Krpersprache und Kommunikation"]})]})]})}),sm=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:s,onNavigateToHistory:r})=>{const{branding:o}=qe(),a=o?.primaryAccent||o?.["--primary-accent"]||"#3A7FA7";return i.jsx(jl,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:jt,fetchScenarios:wD,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:jD,getIconForScenario:CD,cardActionLabel:"Starten",cardActionIcon:gn,categoryField:"scenario_type",customCategoryConfig:kD,emptyStateIcon:jt,emptyStateTitle:"Keine Szenarien verfgbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:()=>TD(a),isAuthenticated:e,requireAuth:n,setPendingScenario:s,loadingMessage:"Szenarien werden geladen..."})},ED=({field:t,value:e,onChange:n,error:s,focusColor:r})=>{const o=r||"#4a9ec9",a={width:"100%",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${s?E.red[500]:E.slate[200]}`,fontSize:"16px",color:E.slate[900],backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},l={borderColor:o,boxShadow:`0 0 0 3px ${o}1a`},c=h=>{Object.assign(h.target.style,l),setTimeout(()=>{const p=h.target;if(p){const m=p.closest("div");m&&m.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=h=>{h.target.style.borderColor=s?E.red[500]:E.slate[200],h.target.style.boxShadow="none"},u=()=>{switch(t.type){case"text":return i.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d});case"textarea":return i.jsx("textarea",{value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",rows:4,style:{...a,resize:"vertical",minHeight:"100px"},onFocus:c,onBlur:d});case"select":return i.jsxs("select",{value:e||t.default||"",onChange:h=>n(t.key,h.target.value),style:{...a,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:c,onBlur:d,children:[!t.default&&i.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(h=>i.jsx("option",{value:h.value,children:h.label},h.value))]});case"number":return i.jsx("input",{type:"number",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:a,onFocus:c,onBlur:d});default:return i.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d})}};return i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:600,color:E.slate[700]},children:[t.label,t.required&&i.jsx("span",{style:{color:E.red[500],marginLeft:"4px"},children:"*"})]}),u(),s&&i.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:E.red[500],display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ie,{style:{width:"14px",height:"14px"}}),s]}),t.hint&&!s&&i.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:E.slate[500],display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(mn,{style:{width:"14px",height:"14px"}}),t.hint]})]})},ID=({scenario:t,onBack:e,onNext:n})=>{const[s,r]=f.useState({}),[o,a]=f.useState({}),{branding:l}=qe(),c=l?.["--header-gradient"]||_e["--header-gradient"],d=l?.["--button-gradient"]||c,u=l?.["--primary-accent"]||_e["--primary-accent"],h=l?.["--primary-accent-light"]||_e["--primary-accent-light"],p=f.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(v=>v.user_input!==!1)}catch(y){return console.error("Error parsing input_configuration:",y),[]}},[t?.input_configuration]);f.useEffect(()=>{const y={};p.forEach(v=>{v.default&&(y[v.key]=v.default)}),r(y)},[p]);const m=(y,v)=>{r(k=>({...k,[y]:v})),o[y]&&a(k=>{const S={...k};return delete S[y],S})},x=()=>{const y={};return p.forEach(v=>{const k=s[v.key];if(v.required&&(!k||typeof k=="string"&&k.trim()==="")){y[v.key]="Dieses Feld ist erforderlich";return}if(!(!k||typeof k=="string"&&k.trim()==="")&&v.validation){const{minLength:S,maxLength:w,min:b,max:T,pattern:C}=v.validation;S&&k.length<S&&(y[v.key]=`Mindestens ${S} Zeichen erforderlich`),w&&k.length>w&&(y[v.key]=`Maximal ${w} Zeichen erlaubt`),b!==void 0&&Number(k)<b&&(y[v.key]=`Mindestens ${b}`),T!==void 0&&Number(k)>T&&(y[v.key]=`Maximal ${T}`),C&&!new RegExp(C).test(k)&&(y[v.key]="Ungltiges Format")}}),a(y),Object.keys(y).length===0},g=y=>{y.preventDefault(),x()&&n(s)};return f.useEffect(()=>{p.length===0&&n({})},[p,n]),p.length===0?null:i.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[i.jsxs("div",{style:{marginBottom:"32px"},children:[i.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:E.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:y=>y.target.style.background=E.slate[100],onMouseLeave:y=>y.target.style.background="transparent",children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(jt,{style:{width:"28px",height:"28px",color:"white"}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:E.slate[900],margin:0},children:t.title}),i.jsx("p",{style:{fontSize:"14px",color:E.slate[600],margin:"4px 0 0 0"},children:"Personalisiere dein Training"})]})]})]}),t.description&&i.jsx("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:E.slate[100],marginBottom:"24px"},children:i.jsx("p",{style:{fontSize:"14px",color:E.slate[700],margin:0,lineHeight:1.6},children:t.description})}),i.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:h,marginBottom:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(mn,{style:{width:"20px",height:"20px",color:u,flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"14px",fontWeight:600,color:E.slate[900],margin:"0 0 4px 0"},children:"So funktioniert es"}),i.jsxs("p",{style:{fontSize:"13px",color:E.slate[600],margin:0,lineHeight:1.5},children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschlieend detailliertes Feedback."]})]})]}),i.jsxs("form",{onSubmit:g,children:[p.map(y=>i.jsx(ED,{field:y,value:s[y.key],onChange:m,error:o[y.key],focusColor:u},y.key)),i.jsxs("button",{type:"submit",style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:d,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:`0 4px 12px ${u}4d`,marginTop:"24px"},onMouseEnter:y=>{y.target.style.transform="translateY(-2px)",y.target.style.boxShadow=`0 6px 16px ${u}66`},onMouseLeave:y=>{y.target.style.transform="none",y.target.style.boxShadow=`0 4px 12px ${u}4d`},children:["Weiter",i.jsx(ds,{style:{width:"20px",height:"20px"}})]})]})]})},rm={error:{bg:E.red[50],border:E.red[200],text:E.red[600],icon:Ie},warning:{bg:E.amber[50],border:E.amber[200],text:E.amber[600],icon:xs},success:{bg:E.green[50],border:E.green[200],text:E.green[600],icon:Jt},info:{bg:E.blue[50],border:E.blue[200],text:E.blue[500],icon:mn},loading:{bg:E.blue[50],border:E.blue[200],text:E.blue[500],icon:me}},RD=({variant:t="info",message:e,children:n,isToast:s=!1,onDismiss:r,className:o="",style:a={}})=>{const l=rm[t]||rm.info,c=l.icon,d=t==="loading",u={display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:l.bg,border:`1px solid ${l.border}`,color:l.text,fontSize:"14px",fontWeight:500,...s&&{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,maxWidth:"90%"},...a};return i.jsxs("div",{style:u,className:o,children:[i.jsx(c,{size:20,style:{flexShrink:0,...d&&{animation:"spin 1s linear infinite"}},className:d?"animate-spin":""}),i.jsx("span",{style:{flex:1},children:n||e}),r&&i.jsx("button",{onClick:r,style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:l.text,opacity:.7,display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Schlieen",children:i.jsx(Bt,{size:16})})]})},AD=({message:t,onDismiss:e,...n})=>i.jsx(RD,{variant:"error",message:t,isToast:!0,onDismiss:e,...n}),_D=()=>{const[t,e]=f.useState(!1),[n,s]=f.useState(null),{demoCode:r}=qe(),o=f.useCallback(async(l,c,d)=>{s(null),e(!0);try{const u=await l();c(u)}catch(u){console.error("[useSessionStartup] Error:",u);const h=u.message||"Ein Fehler ist aufgetreten";s(h),e(!1),d?.(u)}},[]),a=f.useCallback(()=>{s(null)},[]);return{isSubmitting:t,submitError:n,demoCode:r,startSession:o,clearError:a}},MD=({scenario:t,variables:e,onBack:n,onStart:s})=>{const{isSubmitting:r,submitError:o,demoCode:a,startSession:l,clearError:c}=_D(),d=async({selectedMicrophoneId:u,selectedCameraId:h})=>{await l(async()=>{const p=vn(),m=await fetch(`${p}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":At()},body:JSON.stringify({scenario_id:t.id,variables:e,demo_code:a||null})});if(!m.ok){const S=await m.json().catch(()=>({}));throw new Error(S.message||"Fehler beim Erstellen der Session")}const x=await m.json(),g=x.data?.session||x.session;if(!g)throw new Error("Keine Session-ID erhalten");const y=await fetch(`${p}/video-training/sessions/${g.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":At()},body:JSON.stringify({variables:e})});if(!y.ok){const S=await y.json().catch(()=>({}));throw new Error(S.message||"Fehler beim Generieren der Fragen")}const v=await y.json(),k=v.data?.questions||v.questions||[];return{session:{...g,questions:k},questions:k,scenario:t,variables:e,selectedMicrophoneId:u,selectedCameraId:h}},s)};return i.jsxs(i.Fragment,{children:[i.jsx(Sy,{mode:"audio-video",scenario:t,onBack:n,onStart:d,title:t?.title,startButtonLabel:"Video-Training starten",icon:jt}),o&&i.jsx(AD,{message:o,onDismiss:c}),i.jsx(bh,{isLoading:r,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},om=({tips:t,primaryAccent:e})=>{const[n,s]=f.useState(!1);return!t||t.length===0?null:i.jsxs("div",{style:{marginTop:"16px",background:`linear-gradient(135deg, ${e}08 0%, ${e}04 100%)`,borderRadius:"12px",border:`1px solid ${e}15`,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>s(!n),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:600,color:"#0f172a"},children:[i.jsx(Be,{size:18,color:e}),"Tipps fr diese Frage"]}),i.jsx(Et,{size:18,color:"#64748b",style:{transform:n?"rotate(90deg)":"none",transition:"transform 0.2s"}})]}),i.jsx(Ve,{children:n&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsx("div",{style:{padding:"0 16px 16px"},children:i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.map((r,o)=>i.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:r},o))})})})})]})},PD=({session:t,questions:e,scenario:n,variables:s,onComplete:r,onExit:o,selectedMicrophoneId:a,selectedCameraId:l})=>{const[c,d]=f.useState(0),[u,h]=f.useState(!1),[p,m]=f.useState(!1),[x,g]=f.useState(0),[y,v]=f.useState([]),[k,S]=f.useState([]),[w,b]=f.useState(null),[T,C]=f.useState(null),[j,R]=f.useState(!1),[I,A]=f.useState(!1),[L,B]=f.useState(null),[P,_]=f.useState(a||null),[O,W]=f.useState(l||null),[D,N]=f.useState(!1),[F,ne]=f.useState(0),re=xn(),Z=f.useRef(null),ee=f.useRef(null),se=f.useRef(null),z=f.useRef(null),V=f.useRef(null),H=f.useRef(null),pe=Ge(),{primaryAccent:Te,headerGradient:Le}=pe,we=e[c];f.useEffect(()=>(Ee(),()=>{et(),se.current&&clearInterval(se.current),H.current&&cancelAnimationFrame(H.current),z.current&&z.current.close()}),[]);const Qe=je=>{try{z.current&&z.current.close();const fe=new(window.AudioContext||window.webkitAudioContext);z.current=fe;const oe=fe.createAnalyser();oe.fftSize=256,oe.smoothingTimeConstant=.8,V.current=oe,fe.createMediaStreamSource(je).connect(oe);const tt=new Uint8Array(oe.frequencyBinCount),cn=()=>{if(!V.current)return;V.current.getByteFrequencyData(tt);const en=tt.reduce((Wi,mi)=>Wi+mi,0)/tt.length;ne(en/255),H.current=requestAnimationFrame(cn)};cn()}catch(fe){console.error("[VIDEO TRAINING] Audio analysis error:",fe)}},ye=()=>{H.current&&(cancelAnimationFrame(H.current),H.current=null),ne(0)},Ee=async(je=P,fe=O)=>{try{C(null),w&&w.getTracks().forEach(cn=>cn.stop());const oe=fe?{deviceId:{exact:fe},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},xe=je?{deviceId:{exact:je}}:!0,tt=await navigator.mediaDevices.getUserMedia({video:oe,audio:xe});b(tt),Z.current&&(Z.current.srcObject=tt)}catch(oe){console.error("[VIDEO TRAINING] Camera error:",oe),C("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Ke=je=>{_(je),u||Ee(je,O)},Me=je=>{W(je),u||Ee(P,je)},et=()=>{w&&(w.getTracks().forEach(je=>je.stop()),b(null))},X=()=>{if(!w){Ee();return}try{const je=new MediaRecorder(w,{mimeType:"video/webm;codecs=vp9,opus"});ee.current=je;const fe=[];je.ondataavailable=oe=>{oe.data.size>0&&(fe.push(oe.data),v(xe=>[...xe,oe.data]))},je.onstop=()=>{},je.start(1e3),h(!0),m(!1),Qe(w),S(oe=>[...oe,{question_index:c,start_time:x}]),se.current=setInterval(()=>{g(oe=>oe+1)},1e3)}catch(je){console.error("[VIDEO TRAINING] Recording error:",je),B("Fehler beim Starten der Aufnahme")}},he=()=>{ee.current&&u&&(ee.current.stop(),h(!1),ye(),se.current&&(clearInterval(se.current),se.current=null))},be=()=>{c<e.length-1&&(u&&S(je=>[...je,{question_index:c+1,start_time:x}]),d(je=>je+1))},ue=()=>{c>0&&d(je=>je-1)},gt=async()=>{he(),R(!0),B(null);try{const je=new Blob(y,{type:"video/webm"}),fe=vn(),oe=new FormData;oe.append("video",je,`video_${t.id}.webm`),oe.append("video_duration",x.toString()),oe.append("timeline",JSON.stringify(k));const xe=await fetch(`${fe}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":At()},body:oe});if(!xe.ok){const en=await xe.text();throw console.error("[VIDEO TRAINING] Upload failed:",xe.status,en),xe.status===413?new Error("Das Video ist zu gro zum Hochladen. Bitte versuche eine krzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+xe.status)}const tt=await xe.json();R(!1),A(!0);const cn=await fetch(`${fe}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":At()}});if(!cn.ok)throw new Error("Fehler bei der Video-Analyse");const Ft=await cn.json();r({session:Ft.data?.session||t,analysis:Ft.data?.analysis,categoryScores:Ft.data?.category_scores,overallScore:Ft.data?.overall_score})}catch(je){console.error("[VIDEO TRAINING] Upload/Analysis error:",je),B(je.message),R(!1),A(!1)}},lt=()=>{he(),et(),o()};return j||I?i.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:[i.jsxs($.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{background:"#fff",borderRadius:"20px",padding:"48px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)",maxWidth:"500px",width:"100%",textAlign:"center"},children:[i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:`${Te}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:i.jsx(me,{size:40,color:Te,style:{animation:"spin 1s linear infinite"}})}),i.jsx("h2",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"12px"},children:j?"Video wird hochgeladen...":"KI analysiert dein Video..."}),i.jsx("p",{style:{color:"#64748b",fontSize:"15px",lineHeight:1.6},children:j?"Dein Video wird sicher bertragen. Dies kann je nach Dateigre einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Krpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]}),i.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):i.jsxs("div",{style:{padding:re?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:re?"column":"row",justifyContent:"space-between",alignItems:re?"stretch":"center",gap:re?"12px":"0",marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:re?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),i.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:i.jsxs("button",{onClick:lt,style:{padding:re?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[i.jsx(Bt,{size:16}),"Abbrechen"]})})]}),i.jsx(Nv,{current:c,total:e.length,primaryAccent:Te,b:pe,showCompleted:!1}),re?i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:Le,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:c+1}),i.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:we?.category||"Frage"})]}),i.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:we?.question||"Frage wird geladen..."}),we?.estimated_time&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[i.jsx(Ye,{size:14}),"Empfohlene Antwortzeit: ~",Math.round(we.estimated_time/60)," Min."]}),n?.enable_tips&&we?.tips&&i.jsx(om,{tips:we.tips,primaryAccent:Te})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[T?i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"16px",textAlign:"center"},children:[i.jsx(qp,{size:40,style:{marginBottom:"12px",opacity:.6}}),i.jsx("p",{style:{marginBottom:"12px",fontSize:"14px"},children:T}),i.jsxs("button",{onClick:Ee,style:{padding:"10px 16px",borderRadius:"8px",background:Te,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},children:[i.jsx(Ot,{size:16}),"Erneut versuchen"]})]}):i.jsx("video",{ref:Z,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&i.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[i.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),i.jsx("span",{style:{color:"#fff",fontSize:"13px",fontWeight:500},children:yt(x)})]}),!u&&x>0&&i.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[i.jsx(Ye,{size:14,color:"#fff"}),i.jsx("span",{style:{color:"#fff",fontSize:"13px"},children:yt(x)})]})]}),u&&i.jsx("div",{style:{marginTop:"16px"},children:i.jsx(_r,{audioLevel:F,isActive:!0,variant:"bars",size:"sm",accentColor:Te})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[i.jsx("button",{onClick:()=>N(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(di,{size:20,color:"#64748b"})}),u?i.jsxs("button",{onClick:he,style:{padding:"14px 24px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center"},children:[i.jsx(Hp,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):i.jsxs("button",{onClick:X,disabled:!w,style:{padding:"14px 24px",borderRadius:"12px",background:w?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:w?"pointer":"not-allowed",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center",boxShadow:w?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[i.jsx(jt,{size:20}),"Aufnahme starten"]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n?.enable_navigation&&c>0&&i.jsxs("button",{onClick:ue,style:{padding:"10px 14px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",flex:1},children:[i.jsx(Oa,{size:16}),"Zurck"]}),n?.enable_navigation&&c<e.length-1&&i.jsxs("button",{onClick:be,style:{padding:"10px 14px",borderRadius:"8px",background:Te,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:500,flex:1},children:["Nchste",i.jsx(Et,{size:16})]}),i.jsxs("button",{onClick:gt,disabled:y.length===0,style:{padding:"10px 14px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:600,flex:1,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[i.jsx(Pn,{size:16}),"Abschlieen"]})]})]})]})]}):i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[T?i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"20px",textAlign:"center"},children:[i.jsx(qp,{size:48,style:{marginBottom:"16px",opacity:.6}}),i.jsx("p",{style:{marginBottom:"16px"},children:T}),i.jsxs("button",{onClick:Ee,style:{padding:"10px 20px",borderRadius:"8px",background:Te,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ot,{size:16}),"Erneut versuchen"]})]}):i.jsx("video",{ref:Z,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&i.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[i.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),i.jsx("span",{style:{color:"#fff",fontSize:"14px",fontWeight:500},children:yt(x)})]}),!u&&x>0&&i.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[i.jsx(Ye,{size:16,color:"#fff"}),i.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:yt(x)})]})]}),u&&i.jsx("div",{style:{marginTop:"20px"},children:i.jsx(_r,{audioLevel:F,isActive:!0,variant:"bars",size:"sm",accentColor:Te})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginTop:"20px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[i.jsx("button",{onClick:()=>N(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(di,{size:20,color:"#64748b"})}),u?i.jsxs("button",{onClick:he,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx(Hp,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):i.jsxs("button",{onClick:X,disabled:!w,style:{padding:"14px 28px",borderRadius:"12px",background:w?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:w?"pointer":"not-allowed",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",boxShadow:w?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[i.jsx(jt,{size:20}),"Aufnahme starten"]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",flexWrap:"wrap"},children:[n?.enable_navigation&&c>0&&i.jsxs("button",{onClick:ue,style:{padding:"10px 16px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px"},children:[i.jsx(Oa,{size:18}),"Vorherige"]}),n?.enable_navigation&&c<e.length-1&&i.jsxs("button",{onClick:be,style:{padding:"10px 16px",borderRadius:"8px",background:Te,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:500},children:["Nchste",i.jsx(Et,{size:18})]}),i.jsxs("button",{onClick:gt,disabled:y.length===0,style:{padding:"10px 20px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:600,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[i.jsx(Pn,{size:18}),"Training abschlieen"]})]})]})]}),i.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:Le,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:c+1}),i.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:we?.category||"Frage"})]}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:we?.question||"Frage wird geladen..."}),we?.estimated_time&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",marginBottom:"16px"},children:[i.jsx(Ye,{size:16}),"Empfohlene Antwortzeit: ~",Math.round(we.estimated_time/60)," Min."]}),n?.enable_tips&&we?.tips&&i.jsx(om,{tips:we.tips,primaryAccent:Te})]})]}),L&&i.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{marginTop:"24px",padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx(Ie,{size:20,color:"#ef4444"}),i.jsx("p",{style:{color:"#dc2626",fontSize:"14px",flex:1},children:L}),i.jsx("button",{onClick:()=>B(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:i.jsx(Bt,{size:16,color:"#ef4444"})})]}),i.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          @keyframes spin { to { transform: rotate(360deg); } }
        `}),i.jsx(yh,{isOpen:D,onClose:()=>N(!1),mode:"audio-video",selectedMicrophoneId:P,onMicrophoneChange:Ke,selectedCameraId:O,onCameraChange:Me})]})},DD={auftreten:o0,selbstbewusstsein:li,koerpersprache:Qt,kommunikation:Ze,professionalitaet:li,inhalt:Be},ND=({score:t,size:e=120,strokeWidth:n=10,primaryAccent:s})=>{const r=(e-n)/2,o=r*2*Math.PI,a=o-t/100*o,l=()=>t>=80?"#22c55e":t>=60?s:t>=40?"#f59e0b":"#ef4444";return i.jsxs("div",{style:{position:"relative",width:e,height:e,margin:"0 auto"},children:[i.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[i.jsx("circle",{cx:e/2,cy:e/2,r,fill:"none",stroke:"#e2e8f0",strokeWidth:n}),i.jsx($.circle,{cx:e/2,cy:e/2,r,fill:"none",stroke:l(),strokeWidth:n,strokeLinecap:"round",strokeDasharray:o,initial:{strokeDashoffset:o},animate:{strokeDashoffset:a},transition:{duration:1.2,ease:"easeOut"}})]}),i.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[i.jsx("span",{style:{fontSize:e/3,fontWeight:700,color:l()},children:Math.round(t)}),i.jsx("span",{style:{fontSize:e/10,color:"#64748b"},children:"von 100"})]})]})},zD=({category:t,primaryAccent:e})=>{const[n,s]=f.useState(!1),r=DD[t.category]||Vt,o=a=>a>=80?"#22c55e":a>=60?e:a>=40?"#f59e0b":"#ef4444";return i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:"#fff",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden",marginBottom:"12px"},children:[i.jsxs("button",{onClick:()=>s(!n),style:{width:"100%",padding:"16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${o(t.score)}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(r,{size:20,color:o(t.score)})}),i.jsxs("div",{style:{flex:1,textAlign:"left",minWidth:0,overflow:"hidden"},children:[i.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"2px"},children:t.label}),i.jsxs("p",{style:{fontSize:"13px",color:"#64748b",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.feedback?.substring(0,60),"..."]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{fontSize:"20px",fontWeight:700,color:o(t.score)},children:Math.round(t.score)}),i.jsx(bt,{size:20,color:"#64748b",style:{transform:n?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),i.jsx(Ve,{children:n&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:i.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #e2e8f0",paddingTop:"16px"},children:[i.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"16px"},children:t.feedback}),t.strengths&&t.strengths.length>0&&i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#22c55e",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Jt,{size:14}),"Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.strengths.map((a,l)=>i.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]}),t.improvements&&t.improvements.length>0&&i.jsxs("div",{children:[i.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#f59e0b",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(Ie,{size:14}),"Verbesserungspotenzial"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.improvements.map((a,l)=>i.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]})]})})})]})},LD=({session:t,scenario:e,onBackToDashboard:n,onStartNew:s})=>{const{branding:r}=qe(),o=r?.primaryAccent||"#3A7FA7",a=r?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",l=t?.overall_score||0,c=t?.category_scores||[],d=t?.analysis||{},u=t?.summary_feedback||"",h=p=>p>=90?"Ausgezeichnet!":p>=80?"Sehr gut!":p>=70?"Gut!":p>=60?"Solide Leistung":p>=50?"Ausbaufhig":"Weiter ben!";return i.jsxs("div",{style:{padding:"32px",maxWidth:"900px",margin:"0 auto"},children:[i.jsxs($.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{textAlign:"center",marginBottom:"40px"},children:[i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:a,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.15)"},children:i.jsx(cl,{size:40,color:"#fff"})}),i.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Training abgeschlossen!"}),i.jsxs("p",{style:{fontSize:"16px",color:"#64748b"},children:[e?.title," - Deine Auswertung ist bereit"]})]}),i.jsxs($.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},style:{background:"#fff",borderRadius:"20px",padding:"32px",textAlign:"center",border:"1px solid #e2e8f0",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[i.jsx(ND,{score:l,size:160,primaryAccent:o}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginTop:"20px",marginBottom:"8px"},children:h(l)}),i.jsx("p",{style:{fontSize:"15px",color:"#64748b",maxWidth:"500px",margin:"0 auto",lineHeight:1.6},children:u||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),c.length>0&&i.jsxs($.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{marginBottom:"24px"},children:[i.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Vt,{size:20,color:o}),"Detaillierte Bewertung"]}),c.map((p,m)=>i.jsx(zD,{category:p,primaryAccent:o},p.category||m))]}),d&&(d.key_strengths?.length>0||d.actionable_tips?.length>0)&&i.jsxs($.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[d.key_strengths&&d.key_strengths.length>0&&i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#22c55e",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Jt,{size:18}),"Deine Strken"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.key_strengths.map((p,m)=>i.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]}),d.actionable_tips&&d.actionable_tips.length>0&&i.jsxs("div",{children:[i.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:o,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Be,{size:18}),"Tipps zur Verbesserung"]}),i.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.actionable_tips.map((p,m)=>i.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]})]}),t?.video_url&&i.jsxs($.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[i.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(jt,{size:18,color:o}),"Deine Aufnahme"]}),i.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),i.jsxs($.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},style:{display:"flex",gap:"16px",justifyContent:"center"},children:[i.jsxs("button",{onClick:n,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(ft,{size:18}),"Zur bersicht"]}),i.jsxs("button",{onClick:s,style:{padding:"14px 28px",borderRadius:"12px",background:a,color:"#fff",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)"},children:[i.jsx(Ot,{size:18}),"Nochmal ben"]})]})]})},tn={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},OD=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingScenario:s,clearPendingScenario:r,onNavigateToHistory:o})=>{const[a,l]=f.useState(tn.DASHBOARD),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState([]),[x,g]=f.useState({}),[y,v]=f.useState(null),[k,S]=f.useState(null),[w,b]=f.useState(null),[T,C]=f.useState(null);f.useEffect(()=>{s&&t&&(d(s),l(tn.VARIABLES),r&&r())},[s,t,r]),f.useEffect(()=>{T&&t&&(d(T),l(tn.VARIABLES),C(null))},[T,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const j=f.useCallback(W=>{d(W),l(tn.VARIABLES)},[]),R=f.useCallback(()=>{d(null),h(null),m([]),g({}),v(null),S(null),b(null),l(tn.DASHBOARD)},[]),I=f.useCallback(W=>{g(W),l(tn.DEVICE_SETUP)},[]),A=f.useCallback(()=>{l(tn.VARIABLES)},[]),L=f.useCallback(W=>{h(W.session),m(W.questions),g(W.variables),S(W.selectedMicrophoneId),b(W.selectedCameraId),l(tn.SESSION)},[]),B=f.useCallback(W=>{v(W.session),l(tn.COMPLETE)},[]),P=f.useCallback(()=>{R()},[R]),_=f.useCallback(()=>{h(null),m([]),v(null),S(null),b(null),l(tn.VARIABLES)},[]),O=()=>{switch(a){case tn.DASHBOARD:return i.jsx(sm,{onSelectScenario:j,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:o});case tn.VARIABLES:return i.jsx(ID,{scenario:c,onBack:R,onNext:I});case tn.DEVICE_SETUP:return i.jsx(MD,{scenario:c,variables:x,onBack:A,onStart:L});case tn.SESSION:return i.jsx(PD,{session:u,questions:p,scenario:c,variables:x,onComplete:B,onExit:P,selectedMicrophoneId:k,selectedCameraId:w});case tn.COMPLETE:return i.jsx(LD,{session:y,scenario:c,onBackToDashboard:R,onStartNew:_});default:return i.jsx(sm,{onSelectScenario:j,isAuthenticated:t,requireAuth:e,setPendingScenario:C,onNavigateToHistory:o})}};return i.jsx("div",{style:{minHeight:"100%"},children:O()})},zv={rocket:pi,shuffle:gT,zap:Sl},ga=({icon:t,label:e,value:n,primaryAccent:s,primaryAccentLight:r,isMobile:o,b:a})=>i.jsxs("div",{style:{backgroundColor:"white",borderRadius:o?a.radius.md:a.radius.lg,padding:o?a.space[3]:a.space[4],border:`1px solid ${E.slate[200]}`},children:[i.jsx("div",{style:{width:o?"32px":"40px",height:o?"32px":"40px",borderRadius:o?a.radius.sm:a.radius.md,backgroundColor:r,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:o?a.space[2]:a.space[3]},children:i.jsx(t,{style:{width:o?"16px":"20px",height:o?"16px":"20px",color:s}})}),i.jsx("div",{style:{fontSize:o?a.fontSize.xl:a.fontSize["2xl"],fontWeight:700,color:E.slate[900]},children:n}),i.jsx("div",{style:{fontSize:o?a.fontSize["2xs"]:a.fontSize.xs,color:E.slate[500]},children:e})]}),BD=({mode:t,onBack:e,onStart:n})=>{const[s,r]=f.useState(""),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),h=zv[t.icon]||pi;Sh[t.id]||Sh.klassiker;const p=Ge();f.useEffect(()=>{t.id==="klassiker"?r(t.topic):t.getTopic&&r(t.getTopic())},[t]);const m=()=>{if(!t.getTopic)return;a(!0);const g=1500,y=100;let v=0;const k=setInterval(()=>{r(t.getTopic()),v+=y,v>=g&&(clearInterval(k),a(!1))},y)},x=()=>{n({mode:t,topic:s,duration:t.duration,selectedMicrophoneId:l})};return i.jsxs("div",{style:{minHeight:"100%",display:"flex",flexDirection:"column",padding:p.space[6]},children:[i.jsxs($.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:e,style:{display:"flex",alignItems:"center",gap:p.space[2],padding:`${p.space[2.5]} ${p.space[4]}`,backgroundColor:"white",border:`1px solid ${E.slate[200]}`,borderRadius:p.radius.md,color:E.slate[600],fontSize:p.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:p.space[8],width:"fit-content"},children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck zur Auswahl"]}),i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"600px",margin:"0 auto",width:"100%"},children:[i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{textAlign:"center",marginBottom:p.space[8]},children:[i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:p.radius["2xl"],background:p.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${p.space[5]}`,boxShadow:p.coloredShadow(p.primaryAccent,"lg")},children:i.jsx(h,{style:{width:"40px",height:"40px",color:"white"}})}),i.jsx("h1",{style:{fontSize:p.fontSize["3xl"],fontWeight:700,color:E.slate[900],margin:`0 0 ${p.space[2]} 0`},children:t.title}),i.jsxs("p",{style:{fontSize:p.fontSize.md,color:E.slate[500],margin:0},children:[t.duration," Sekunden  ",t.subtitle]})]}),i.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{width:"100%",background:p.headerGradient,borderRadius:p.radius["2xl"],padding:p.space[8],marginBottom:p.space[6],boxShadow:p.coloredShadow(p.primaryAccent,"xl")},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:p.space[5]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2.5],color:"rgba(255,255,255,0.9)"},children:[i.jsx(Oi,{style:{width:"20px",height:"20px"}}),i.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.md},children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&i.jsxs($.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:m,disabled:o,style:{display:"flex",alignItems:"center",gap:p.space[2],padding:`${p.space[2.5]} ${p.space[4.5]}`,backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:p.radius.md,color:"white",fontSize:p.fontSize.sm,fontWeight:600,cursor:o?"not-allowed":"pointer"},children:[i.jsx(Ot,{style:{width:"16px",height:"16px",animation:o?"spin 0.5s linear infinite":"none"}}),o?"Dreht...":"Neu wrfeln"]})]}),i.jsx(Ve,{mode:"wait",children:i.jsxs($.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{fontSize:p.fontSize["2xl"],fontWeight:600,color:"white",margin:0,lineHeight:1.5,minHeight:"66px"},children:['"',s,'"']},s)})]}),i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{width:"100%",backgroundColor:"white",borderRadius:p.radius.xl,padding:p.space[6],marginBottom:p.space[6],border:`1px solid ${E.slate[200]}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2.5],marginBottom:p.space[4],color:E.slate[700]},children:[i.jsx(Ue,{style:{width:"20px",height:"20px",color:p.primaryAccent}}),i.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.md},children:"Mikrofon auswhlen"})]}),i.jsx(Uu,{selectedDeviceId:l,onDeviceChange:c,onTestClick:()=>u(!0)})]}),i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{width:"100%",backgroundColor:E.slate[50],borderRadius:p.radius.xl,padding:p.space[5],marginBottom:p.space[8]},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2],marginBottom:p.space[3],color:E.slate[700]},children:[i.jsx(st,{style:{width:"18px",height:"18px",color:E.amber[500]}}),i.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.sm},children:"Tipps fr deine Antwort"})]}),i.jsxs("ul",{style:{margin:0,paddingLeft:p.space[5],color:E.slate[600],fontSize:p.fontSize.sm,lineHeight:1.7},children:[i.jsx("li",{children:"Atme tief durch bevor du beginnst"}),i.jsx("li",{children:"Sprich in einem ruhigen, gleichmigen Tempo"}),i.jsx("li",{children:'Mache bewusst Pausen statt "hm" zu sagen'}),i.jsx("li",{children:"Strukturiere deine Antwort: Einleitung  Hauptteil  Schluss"})]})]}),i.jsxs($.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,style:{width:"100%",maxWidth:"400px",padding:`${p.space[4.5]} ${p.space[8]}`,borderRadius:p.radius.xl,border:"none",background:p.buttonGradient,color:"white",fontSize:p.fontSize.lg,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:p.space[3],boxShadow:p.coloredShadow(p.primaryAccent,"md")},children:[i.jsx(Lt,{style:{width:"22px",height:"22px"}}),"Aufnahme starten"]})]}),i.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),i.jsx(Vu,{isOpen:d,onClose:()=>u(!1),deviceId:l})]})},sr={MODES:"modes",TOPIC:"topic"},FD=({onStartGame:t,isAuthenticated:e,requireAuth:n,setPendingAction:s})=>{const[r,o]=f.useState(sr.MODES),[a,l]=f.useState(null),[c,d]=f.useState("grid"),[u,h]=f.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),p=xn(),[m,x]=f.useState(null),g=Ge();f.useEffect(()=>{const w=async()=>{try{const b=await ce.getGameStats();b.success&&b.data&&h({totalGames:b.data.total_games||0,bestScore:b.data.best_score||0,avgScore:b.data.avg_score||0,totalPracticeTime:b.data.total_practice_time||0})}catch(b){console.error("Failed to load stats:",b)}};r===sr.MODES&&w()},[r]),f.useEffect(()=>{m&&e&&(l(m),o(sr.TOPIC),x(null))},[m,e]),f.useEffect(()=>{window.scrollTo(0,0)},[r]);const y=w=>{if(!e){x(w),n&&n(()=>{},null);return}l(w),o(sr.TOPIC)},v=()=>{l(null),o(sr.MODES)},k=w=>{t(w)},S=Object.values(a2);return r===sr.TOPIC&&a?i.jsx(BD,{mode:a,onBack:v,onStart:k}):i.jsxs("div",{style:{padding:p?g.space[4]:g.space[6]},children:[i.jsxs("div",{style:{marginBottom:p?g.space[5]:g.space[8],textAlign:"center"},children:[i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:p?g.space[2.5]:g.space[3],marginBottom:p?g.space[2]:g.space[3]},children:[i.jsx("div",{style:{width:p?"40px":"48px",height:p?"40px":"48px",borderRadius:p?g.radius.lg:g.radius.xl,background:g.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(r0,{style:{width:p?"20px":"24px",height:p?"20px":"24px",color:g.headerText}})}),i.jsx("h1",{style:{fontSize:p?g.fontSize["2xl"]:g.fontSize["3xl"],fontWeight:700,color:E.slate[900],margin:0},children:"Der Fllwort-Killer"})]}),i.jsx("p",{style:{fontSize:p?g.fontSize.sm:g.fontSize.base,color:E.slate[600],maxWidth:"600px",margin:"0 auto"},children:"Trainiere deine Rhetorik - sprich flssig und berzeugend ohne hm und h!"})]}),i.jsxs("div",{style:{padding:p?`0 ${g.space[2]}`:`0 ${g.space[6]}`},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:p?"repeat(2, 1fr)":"repeat(auto-fit, minmax(150px, 1fr))",gap:p?g.space[2.5]:g.space[4],marginBottom:p?g.space[6]:g.space[8]},children:[i.jsx(ga,{icon:cl,label:"Highscore",value:u.bestScore||"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),i.jsx(ga,{icon:rt,label:"Spiele",value:u.totalGames||0,primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),i.jsx(ga,{icon:gn,label:"Durchschnitt",value:u.avgScore?Math.round(u.avgScore):"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),i.jsx(ga,{icon:Ye,label:"Trainingszeit",value:u.totalPracticeTime?`${Math.round(u.totalPracticeTime/60)}m`:"0m",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:g.space[4]},children:[i.jsx("h2",{style:{fontSize:g.fontSize.lg,fontWeight:600,color:E.slate[800],margin:0},children:"Whle deinen Modus"}),i.jsx(_2,{viewMode:c,onViewChange:d})]}),i.jsx(A0,{minCardWidth:"280px",viewMode:c,children:S.map(w=>{const b=zv[w.icon]||pi;return i.jsx(R0,{title:w.title,subtitle:w.subtitle,description:w.description,icon:b,meta:[{icon:Ye,text:`${w.duration} Sekunden`}],action:{label:"Starten",icon:gn},onClick:()=>y(w),viewMode:c},w.id)})})]})]})},Wt={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},WD=({count:t,branding:e})=>i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:i.jsxs($.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},style:{color:"white",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"120px",fontWeight:700,marginBottom:"16px"},children:t}),i.jsx("div",{style:{fontSize:"24px",color:e.textMuted},children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),$D=({seconds:t,total:e,isWarning:n,primaryAccent:s,branding:r})=>{const o=t/e*100,a=Math.floor(t/60),l=t%60;return i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"64px",fontWeight:700,fontFamily:"monospace",textAlign:"center",color:n?r.error:r.textMain},children:[a,":",l.toString().padStart(2,"0")]}),i.jsx("div",{style:{marginTop:"16px",height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:i.jsx($.div,{style:{height:"100%",backgroundColor:n?r.error:s,borderRadius:"4px"},initial:{width:"100%"},animate:{width:`${o}%`},transition:{duration:.5}})})]})},UD=({word:t,count:e,branding:n})=>i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:n.space[1],padding:`${n.space[1.5]} ${n.space[3]}`,backgroundColor:n.errorLight,color:n.error,borderRadius:n.radius["2xl"],fontSize:n.fontSize.base,fontWeight:n.fontWeight.medium},children:['"',t,'"',i.jsxs("span",{style:{backgroundColor:`${n.error}30`,padding:`${n.space[.5]||"2px"} ${n.space[1.5]}`,borderRadius:n.radius.md,fontSize:n.fontSize.xs},children:[e,"x"]})]}),VD=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(e=>e.length>0).length,GD=t=>!t||!Array.isArray(t)?0:t.reduce((e,n)=>e+(n.count||0),0),HD=(t,e,n,s)=>{const r=VD(t),o=GD(e),a=r>0?o/r*100:0,l=s>0?Math.round(r/s*60):0;let c=0;r>=60?c=25:r>=40?c=15:r>=20?c=10:r>=10&&(c=5);let d=25;a>25?d=0:a>15?d=10:a>10?d=15:a>5&&(d=20);let u=0,h="keine_sprache";r>0&&(l>=100&&l<=140?(u=10,h="optimal"):l>=80&&l<100||l>140&&l<=160?(u=5,h=l<100?"zu_langsam":"zu_schnell"):(u=0,h=l<80?"zu_langsam":"zu_schnell"));const p=Math.min(40,Math.max(0,n||0)),m=c+d+u+p;return{total_words:r,filler_count:o,filler_percentage:a,words_per_minute:l,pace_feedback:h,score:m,score_breakdown:{words_score:c,filler_score:d,tempo_score:u,content_score:p}}},qD=({result:t,onPlayAgain:e,onBack:n,buttonGradient:s,primaryAccent:r,primaryAccentLight:o,branding:a})=>{const l=s2(t.score),c=t.score>=70,d=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]";return i.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[i.jsxs("div",{style:{borderRadius:a.radius["2xl"],padding:a.space[8],marginBottom:a.space[6],background:d?`linear-gradient(135deg, ${a.textSecondary} 0%, ${a.textMuted} 100%)`:c?`linear-gradient(135deg, ${a.success} 0%, ${r} 100%)`:`linear-gradient(135deg, ${a.warning} 0%, ${a.warningDark||a.warning} 100%)`,color:"white",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:a.iconSize["4xl"],marginBottom:a.space[2]},children:d?"":l.emoji}),i.jsx("div",{style:{fontSize:"72px",fontWeight:a.fontWeight.bold,marginBottom:a.space[2]},children:t.score}),i.jsx("div",{style:{fontSize:a.fontSize.xl,opacity:.9,marginBottom:a.space[4]},children:"Punkte"}),i.jsx("p",{style:{fontSize:a.fontSize.lg,margin:0},children:d?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":l.message})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:a.space[3],marginBottom:a.space[6]},children:[i.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[1.5],color:r,marginBottom:a.space[1.5]},children:[i.jsx(Oi,{style:{width:a.iconSize.sm,height:a.iconSize.sm}}),i.jsx("span",{style:{fontWeight:a.fontWeight.medium,fontSize:a.fontSize.sm},children:"Wrter"})]}),i.jsx("div",{style:{fontSize:a.fontSize["4xl"],fontWeight:a.fontWeight.bold,color:a.textMain},children:t.total_words}),i.jsx("div",{style:{fontSize:a.fontSize["2xs"],color:a.textMuted},children:"gesprochen"})]}),i.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.error,marginBottom:"6px"},children:[i.jsx(xs,{style:{width:"16px",height:"16px"}}),i.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Fllwrter"})]}),i.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.filler_count}),i.jsxs("div",{style:{fontSize:"11px",color:a.textMuted},children:[t.filler_percentage?.toFixed(1)||"0","%"]})]}),i.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r,marginBottom:"6px"},children:[i.jsx(_i,{style:{width:"16px",height:"16px"}}),i.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Tempo"})]}),i.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.words_per_minute}),i.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"WPM"})]}),i.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.textSecondary,marginBottom:"6px"},children:[i.jsx(Ye,{style:{width:"16px",height:"16px"}}),i.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Sprechzeit"})]}),i.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.duration_seconds||0}),i.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"Sekunden"})]})]}),t.filler_words&&t.filler_words.length>0&&i.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"16px",border:`1px solid ${a.borderColor}`,marginBottom:"24px"},children:[i.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Erkannte Fllwrter"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:t.filler_words.map((u,h)=>i.jsx(UD,{word:u.word,count:u.count,branding:a},h))})]}),!d&&i.jsxs("div",{style:{backgroundColor:o,border:`1px solid ${r}26`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[i.jsx("h4",{style:{fontWeight:600,color:r,marginBottom:"12px",fontSize:"15px"},children:"Bewertung im Detail"}),t.score_breakdown&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:t.content_feedback?"12px":0},children:[i.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Wortanzahl: ",i.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),i.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Fllwrter: ",i.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),i.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Tempo: ",i.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),i.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Inhalt: ",i.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&i.jsx("div",{style:{paddingTop:"12px",borderTop:`1px solid ${r}26`},children:i.jsxs("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0,lineHeight:1.5},children:[i.jsx("strong",{children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&i.jsxs("div",{style:{backgroundColor:a.warningLight,border:`1px solid ${a.warning}40`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[i.jsx("h4",{style:{fontWeight:600,color:a.warning,marginBottom:"8px",fontSize:"15px"},children:"Tempo-Hinweis"}),i.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0},children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine Prsentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&i.jsxs("div",{style:{backgroundColor:a.cardBgHover,borderRadius:"12px",border:`1px solid ${a.borderColor}`,padding:"16px",marginBottom:"32px"},children:[i.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Transkript"}),i.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,lineHeight:1.6,margin:0},children:t.transcript})]}),i.jsxs("div",{style:{display:"flex",gap:"16px"},children:[i.jsxs("button",{onClick:e,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:"none",background:s,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[i.jsx(Ai,{style:{width:"18px",height:"18px"}}),"Nochmal spielen"]}),i.jsxs("button",{onClick:n,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:`1px solid ${a.borderColor}`,backgroundColor:a.cardBg,color:a.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck"]})]})]})},KD=({gameConfig:t,onBack:e,onComplete:n})=>{const[s,r]=f.useState(Wt.COUNTDOWN),[o,a]=f.useState(3),[l,c]=f.useState(t.duration),[d,u]=f.useState(null),[h,p]=f.useState(null),[m,x]=f.useState(0),[g,y]=f.useState(!1),{branding:v}=qe(),k=v?.["--header-gradient"]||_e["--header-gradient"],S=v?.["--button-gradient"]||k,w=v?.["--primary-accent"]||_e["--primary-accent"],b=v?.["--primary-accent-light"]||_e["--primary-accent-light"],T=Ge(),C=f.useRef(null),j=f.useRef([]),R=f.useRef(null),I=f.useRef(null),A=f.useRef(null),L=f.useRef(null),B=f.useRef(null),P=ce.getGeminiApiKey(),_=f.useCallback(()=>{R.current&&clearInterval(R.current),L.current&&cancelAnimationFrame(L.current),A.current&&(A.current.close(),A.current=null),C.current&&C.current.state!=="inactive"&&C.current.stop()},[]);f.useEffect(()=>_,[_]),f.useEffect(()=>{g||(y(!0),O())},[g]);const O=async()=>{r(Wt.COUNTDOWN),a(3);try{const Z=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,ee=await navigator.mediaDevices.getUserMedia({audio:Z});A.current=new(window.AudioContext||window.webkitAudioContext);const se=A.current.createMediaStreamSource(ee);I.current=A.current.createAnalyser(),I.current.fftSize=256,se.connect(I.current),C.current=new MediaRecorder(ee,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),j.current=[],C.current.ondataavailable=H=>{H.data.size>0&&j.current.push(H.data)};let z=3;const V=setInterval(()=>{z--,a(z),z===0&&(clearInterval(V),D())},1e3)}catch(Z){console.error("Microphone access denied:",Z),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(Wt.ERROR)}},W=f.useCallback(async()=>{r(Wt.COUNTDOWN),a(3);try{const Z=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,ee=await navigator.mediaDevices.getUserMedia({audio:Z});A.current=new(window.AudioContext||window.webkitAudioContext);const se=A.current.createMediaStreamSource(ee);I.current=A.current.createAnalyser(),I.current.fftSize=256,se.connect(I.current),C.current=new MediaRecorder(ee,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),j.current=[],C.current.ondataavailable=H=>{H.data.size>0&&j.current.push(H.data)};let z=3;const V=setInterval(()=>{z--,a(z),z===0&&(clearInterval(V),D())},1e3)}catch(Z){console.error("Microphone access denied:",Z),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(Wt.ERROR)}},[t.selectedMicrophoneId]),D=f.useCallback(()=>{r(Wt.RECORDING),c(t.duration),B.current=Date.now(),C.current.start();const Z=()=>{if(I.current){const ee=new Uint8Array(I.current.frequencyBinCount);I.current.getByteFrequencyData(ee);const se=ee.reduce((z,V)=>z+V)/ee.length;x(se/255)}L.current=requestAnimationFrame(Z)};Z(),R.current=setInterval(()=>{c(ee=>ee<=1?(N(),0):ee-1)},1e3)},[t.duration]),N=f.useCallback(()=>{const Z=B.current?Math.round((Date.now()-B.current)/1e3):t.duration;_(),r(Wt.PROCESSING),C.current.onstop=async()=>{const ee=new Blob(j.current,{type:C.current.mimeType});C.current.stream.getTracks().forEach(z=>z.stop());const se=Pu(ee,{minSize:Mu});if(!se.valid){console.warn("[GameSession] Audio validation failed:",se.error,"Size:",ee.size);const z={..._u("game"),score:0,word_count:0,filler_count:0,words_per_minute:0,duration_seconds:Z};u(z),r(Wt.RESULTS);return}try{const z=await f2(ee,P,t.topic,t.duration),H={...HD(z.transcript,z.filler_words,z.content_score,Z),transcript:z.transcript||"[Keine Sprache erkannt]",filler_words:z.filler_words||[],content_feedback:z.content_feedback||"",duration_seconds:Z};u(H),r(Wt.RESULTS);try{const pe={game_type:t.mode.id,topic:t.topic,duration_seconds:Z,score:H.score,filler_count:H.filler_count,words_per_minute:H.words_per_minute,transcript:H.transcript,analysis_json:JSON.stringify(H)};await ce.createGameSession(pe)}catch(pe){console.error("[GameSession] Failed to save game session:",pe)}}catch(z){console.error("Analysis failed:",z),p(`Analyse fehlgeschlagen: ${z.message}`),r(Wt.ERROR)}},C.current.stop()},[P,t,_]),F=()=>{N()},ne=()=>{u(null),p(null),c(t.duration),W()},re=()=>{switch(s){case Wt.READY:return i.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:i.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[i.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:""}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:T.textMain,marginBottom:"12px"},children:"Bereit?"}),i.jsx("p",{style:{fontSize:"16px",color:T.textSecondary,marginBottom:"24px",lineHeight:1.6},children:t.topic}),i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:T.cardBgHover,borderRadius:"20px",color:T.textSecondary,fontSize:"14px",marginBottom:"32px"},children:[i.jsx(Ye,{style:{width:"16px",height:"16px"}}),t.duration," Sekunden"]}),i.jsx("div",{children:i.jsxs("button",{onClick:W,style:{padding:"16px 40px",borderRadius:"14px",border:"none",background:S,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 14px ${w}66`},children:[i.jsx(Lt,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]})}),i.jsxs("button",{onClick:e,style:{marginTop:"24px",padding:"10px 20px",border:"none",backgroundColor:"transparent",color:T.textMuted,fontSize:"14px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},children:[i.jsx(ft,{style:{width:"16px",height:"16px"}}),"Zurck zur Auswahl"]})]})});case Wt.RECORDING:return i.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:i.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[i.jsx($D,{seconds:l,total:t.duration,isWarning:l<=10,primaryAccent:w,branding:T}),i.jsxs("div",{style:{marginTop:"32px",marginBottom:"32px",padding:"16px",backgroundColor:T.cardBgHover,borderRadius:"12px"},children:[i.jsx("p",{style:{fontSize:"13px",color:T.textMuted,marginBottom:"4px"},children:"Dein Thema:"}),i.jsx("p",{style:{fontSize:"15px",fontWeight:500,color:T.textMain,margin:0},children:t.topic})]}),i.jsx("div",{style:{marginBottom:"32px"},children:i.jsx($.div,{style:{height:"80px",background:S,borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},animate:{opacity:.6+m*.4},children:i.jsx($.div,{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},animate:{scale:1+m*.3},children:i.jsx(Ue,{style:{width:"28px",height:"28px",color:"white"}})})})}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"32px"},children:[i.jsx($.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:T.error}}),i.jsx("span",{style:{fontWeight:500,color:T.error,fontSize:"14px"},children:"Aufnahme luft..."})]}),i.jsxs("button",{onClick:F,style:{padding:"12px 24px",borderRadius:"12px",border:"none",backgroundColor:T.error,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[i.jsx(zs,{style:{width:"16px",height:"16px"}}),"Aufnahme beenden"]})]})});case Wt.PROCESSING:return i.jsxs("div",{style:{textAlign:"center",padding:"80px 20px"},children:[i.jsx($.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},style:{width:"56px",height:"56px",border:`4px solid ${w}`,borderTopColor:"transparent",borderRadius:"50%",margin:"0 auto 24px"}}),i.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:T.textMain,marginBottom:"8px"},children:"Analysiere deine Aufnahme..."}),i.jsx("p",{style:{color:T.textMuted},children:"Der Fllwort-Killer zhlt nach"})]});case Wt.RESULTS:return i.jsx(qD,{result:d,onPlayAgain:ne,onBack:e,buttonGradient:S,primaryAccent:w,primaryAccentLight:b,branding:T});case Wt.ERROR:return i.jsx("div",{style:{textAlign:"center",padding:"60px 20px"},children:i.jsxs("div",{style:{maxWidth:"400px",margin:"0 auto"},children:[i.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:T.errorLight,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:i.jsx(Hj,{style:{width:"32px",height:"32px",color:T.error}})}),i.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:T.textMain,marginBottom:"12px"},children:"Fehler"}),i.jsx("p",{style:{color:T.textSecondary,marginBottom:"24px"},children:h}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[i.jsxs("button",{onClick:ne,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:S,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ai,{style:{width:"16px",height:"16px"}}),"Erneut versuchen"]}),i.jsxs("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"12px",border:`1px solid ${T.borderColor}`,backgroundColor:T.cardBg,color:T.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[i.jsx(ft,{style:{width:"16px",height:"16px"}}),"Zurck"]})]})]})});default:return null}};return i.jsxs("div",{style:{minHeight:"100%",paddingBottom:"32px"},children:[i.jsx(Ve,{children:s===Wt.COUNTDOWN&&i.jsx(WD,{count:o,branding:T})}),s!==Wt.COUNTDOWN&&s!==Wt.RECORDING&&i.jsx("div",{style:{padding:"16px 24px",borderBottom:`1px solid ${T.borderColor}`,backgroundColor:T.cardBg,position:"sticky",top:0,zIndex:10},children:i.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",border:"none",backgroundColor:"transparent",color:T.textSecondary,fontSize:"14px",cursor:"pointer"},children:[i.jsx(ft,{style:{width:"18px",height:"18px"}}),"Zurck"]}),i.jsx("h1",{style:{fontWeight:600,color:T.textMain,fontSize:"16px",margin:0},children:t.mode.title}),i.jsx("div",{style:{width:"60px"}})]})}),i.jsx("div",{style:{padding:"24px"},children:i.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:re()})})]})},JD={"file-text":zt,briefcase:jn,banknote:ms,users:wn,user:Qt,"message-circle":Oi,target:rt,award:li,book:Uo,clipboard:Vo,star:Vt,lightbulb:Be,shield:Bi,compass:Vn,rocket:pi,heart:Vs,folder:Go,"trending-up":gn},YD=({onSelectTemplate:t,onShowList:e,onCreateTemplate:n,onEditTemplate:s,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l})=>{const{branding:c}=qe(),d=c?.["--primary-accent"]||_e["--primary-accent"],[u,h]=f.useState(null),[p,m]=f.useState(0),x=f.useCallback(async()=>{const R=new URLSearchParams;l&&R.append("demo_code",l);const I=await ce.request(`/smartbriefing/templates?${R.toString()}`,{method:"GET"});if(I.success&&I.data?.templates)return I.data.templates;throw new Error("Unerwartete API-Antwort")},[l,p]),g=()=>{if(!r&&!l){o&&(a(()=>n),o());return}n?.()},y=(R,I)=>{R.stopPropagation(),s?.(I)},v=(R,I)=>{R.stopPropagation(),h(I)},k=async()=>{if(u)try{const R=new URLSearchParams;l&&R.append("demo_code",l),(await ce.request(`/smartbriefing/templates/${u.id}?${R.toString()}`,{method:"DELETE"})).success&&m(A=>A+1)}catch(R){console.error("[SmartBriefing] Error deleting template:",R)}finally{h(null)}},S=R=>JD[R.icon]||zt,w=R=>{const I=R.variables_schema?.length||0;return[{text:`${I} Eingabefeld${I!==1?"er":""}`}]},b=R=>R.is_custom?i.jsxs("div",{style:{display:"flex",gap:"4px"},children:[i.jsx("button",{onClick:I=>y(I,R),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:I=>{I.currentTarget.style.backgroundColor="#f1f5f9",I.currentTarget.style.color=d},onMouseLeave:I=>{I.currentTarget.style.backgroundColor="transparent",I.currentTarget.style.color="#64748b"},title:"Template bearbeiten",children:i.jsx(Iu,{size:16})}),i.jsx("button",{onClick:I=>v(I,R),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:I=>{I.currentTarget.style.backgroundColor="#fef2f2",I.currentTarget.style.color="#ef4444"},onMouseLeave:I=>{I.currentTarget.style.backgroundColor="transparent",I.currentTarget.style.color="#64748b"},title:"Template lschen",children:i.jsx(We,{size:16})})]}):null,T=(r||l)&&n?i.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s",whiteSpace:"nowrap"},onMouseEnter:R=>{R.currentTarget.style.borderColor=d,R.currentTarget.style.color=d},onMouseLeave:R=>{R.currentTarget.style.borderColor="#cbd5e1",R.currentTarget.style.color="#64748b"},children:[i.jsx(Yt,{size:18}),i.jsx("span",{className:"hidden sm:inline",children:"persnliches Template"}),i.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,C=()=>i.jsx("div",{style:{marginTop:"48px",padding:"20px 24px",backgroundColor:`${d}08`,borderRadius:"12px",border:`1px solid ${d}20`},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(Be,{size:20,style:{color:d,flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"So funktioniert Smart Briefing"}),i.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.6},children:"Wahle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein massgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren Ruckfragen."})]})]})}),j=u&&i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},onClick:()=>h(null),children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"100%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:R=>R.stopPropagation(),children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fef2f2",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{size:24,style:{color:"#ef4444"}})}),i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Template lschen?"}),i.jsx("p",{style:{margin:0,fontSize:"14px",color:"#64748b"},children:"Diese Aktion kann nicht rckgngig gemacht werden."})]})]}),i.jsx("div",{style:{backgroundColor:"#f8fafc",borderRadius:"8px",padding:"12px",marginBottom:"20px"},children:i.jsx("p",{style:{margin:0,fontSize:"14px",color:"#475569"},children:i.jsx("strong",{children:u.title})})}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:()=>h(null),style:{padding:"10px 20px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),i.jsx("button",{onClick:k,style:{padding:"10px 20px",borderRadius:"8px",border:"none",backgroundColor:"#ef4444",color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Lschen"})]})]})});return i.jsx(jl,{title:"Smart Briefing",subtitle:"Dein KI-gesttzter Vorbereitungs-Assistent",headerIcon:zt,fetchScenarios:x,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:e,onSelectScenario:t,renderCardMeta:w,getIconForScenario:S,getCardCustomActions:b,cardActionLabel:"Briefing erstellen",cardActionIcon:Et,categoryField:"category",emptyStateIcon:zt,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:T,renderInfoBox:C,extraContent:j,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l,loadingMessage:"Templates werden geladen..."},p)},XD=({field:t,value:e,onChange:n,error:s,primaryAccent:r})=>{const o={width:"100%",padding:"14px 16px",borderRadius:"12px",border:`2px solid ${s?"#ef4444":"#e2e8f0"}`,fontSize:"16px",color:"#0f172a",backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s",boxSizing:"border-box"},a=d=>{d.target.style.borderColor=r,d.target.style.boxShadow=`0 0 0 3px ${r}1a`},l=d=>{d.target.style.borderColor=s?"#ef4444":"#e2e8f0",d.target.style.boxShadow="none"},c=()=>{switch(t.type){case"textarea":return i.jsx("textarea",{value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",rows:4,style:{...o,minHeight:"120px",resize:"vertical"},onFocus:a,onBlur:l});case"select":return i.jsxs("select",{value:e||t.default||"",onChange:d=>n(t.key,d.target.value),style:{...o,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"20px",paddingRight:"44px"},onFocus:a,onBlur:l,children:[i.jsx("option",{value:"",children:"Bitte wahlen..."}),t.options?.map(d=>i.jsx("option",{value:d.value,children:d.label},d.value))]});case"text":default:return i.jsx("input",{type:"text",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",style:o,onFocus:a,onBlur:l})}};return i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#374151",marginBottom:"8px"},children:[t.label,t.required&&i.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),c(),s&&i.jsx("p",{style:{color:"#ef4444",fontSize:"13px",marginTop:"6px",margin:"6px 0 0 0"},children:s})]})},ZD=({variable:t,index:e,onChange:n,onDelete:s,primaryAccent:r})=>i.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[i.jsx("input",{type:"text",value:t.key||"",onChange:o=>n(e,"key",o.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",flex:1,marginRight:"8px"}}),i.jsx("button",{type:"button",onClick:()=>s(e),style:{padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(We,{size:18})})]}),i.jsx("textarea",{value:t.value||"",onChange:o=>n(e,"value",o.target.value),placeholder:"Wert eingeben... (mehrzeilig mglich)",rows:3,style:{width:"100%",padding:"10px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical",minHeight:"80px",boxSizing:"border-box"}})]}),QD=({template:t,onBack:e,onBriefingGenerated:n,isAuthenticated:s})=>{const{branding:r}=qe(),[o,a]=f.useState({}),[l,c]=f.useState({}),[d,u]=f.useState(!1),[h,p]=f.useState(null),[m,x]=f.useState([]),[g,y]=f.useState(!1),v=r?.["--primary-accent"]||_e["--primary-accent"],k=r?.["--button-gradient"]||_e["--button-gradient"],S=jv(t?.icon);f.useEffect(()=>{if(t?.variables_schema){const I={};t.variables_schema.forEach(A=>{A.default&&(I[A.key]=A.default)}),a(I)}x([]),y(!1)},[t]);const w=()=>{x([...m,{key:"",value:""}])},b=(I,A,L)=>{const B=[...m];B[I][A]=L,x(B)},T=I=>{x(m.filter((A,L)=>L!==I))},C=(I,A)=>{a(L=>({...L,[I]:A})),l[I]&&c(L=>{const B={...L};return delete B[I],B})},j=()=>{const I={};return t?.variables_schema?.forEach(A=>{A.required&&!o[A.key]&&(I[A.key]="Dieses Feld ist erforderlich")}),I},R=async I=>{I.preventDefault();const A=j();if(Object.keys(A).length>0){c(A);return}u(!0),p(null);try{const L={};m.forEach(_=>{_.key&&_.value&&(L[_.key]=_.value)});const B={template_id:t.id,variables:o};Object.keys(L).length>0&&(B.custom_variables=L);const P=await ce.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(B)});if(P.success&&P.data?.briefing)n(P.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(L){console.error("[SmartBriefing] Error generating briefing:",L),p(L.message||"Fehler beim Generieren des Briefings")}finally{u(!1)}};return t?i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{padding:"24px",paddingTop:"32px",maxWidth:"700px",margin:"0 auto"},children:[i.jsxs("button",{onClick:e,disabled:d,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:d?"not-allowed":"pointer",marginBottom:"24px",opacity:d?.5:1},children:[i.jsx(ft,{size:18}),i.jsx("span",{style:{lineHeight:"1.4"},children:"Zurck zur bersicht"})]}),i.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",marginBottom:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`linear-gradient(135deg, ${v}15, ${v}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(S,{size:28,style:{color:v}})}),i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:t.title}),i.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:t.description})]})]})}),i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[i.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 20px 0",paddingBottom:"16px",borderBottom:"1px solid #f1f5f9"},children:"Deine Angaben"}),i.jsxs("form",{onSubmit:R,children:[t.variables_schema?.map(I=>i.jsx(XD,{field:I,value:o[I.key],onChange:C,error:l[I.key],primaryAccent:v},I.key)),t.allow_custom_variables&&i.jsxs("div",{style:{marginTop:"24px",marginBottom:"20px",paddingTop:"20px",borderTop:"1px solid #f1f5f9"},children:[i.jsxs("button",{type:"button",onClick:()=>y(!g),style:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:g?"16px":"0",textAlign:"left"},children:[i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[g?i.jsx(ni,{size:18}):i.jsx(bt,{size:18}),i.jsx(Yt,{size:16})]}),i.jsx("span",{style:{lineHeight:"1.4"},children:"Zustzliche Variablen hinzufgen (optional)"})]}),g&&i.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",padding:"16px"},children:[i.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:"Fge eigene Variablen hinzu, die in die Briefing-Generierung einflieen sollen."}),m.length>0&&i.jsx("div",{style:{marginBottom:"12px"},children:m.map((I,A)=>i.jsx(ZD,{variable:I,index:A,onChange:b,onDelete:T,primaryAccent:v},A))}),i.jsxs("button",{type:"button",onClick:w,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"8px",backgroundColor:"white",color:"#64748b",fontSize:"13px",cursor:"pointer"},children:[i.jsx(Yt,{size:14}),"Variable hinzufgen"]})]})]}),h&&i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"16px",marginBottom:"20px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(Ie,{size:20,style:{color:"#ef4444",flexShrink:0}}),i.jsx("div",{children:i.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:h})})]}),i.jsxs("button",{type:"submit",disabled:d,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",border:"none",background:k,color:"white",fontSize:"16px",fontWeight:600,cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s",boxShadow:`0 4px 14px ${v}40`,opacity:d?.7:1},children:[i.jsx(st,{size:20}),"Briefing generieren"]})]})]})]}),i.jsx(bh,{isLoading:d,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein mageschneidertes Briefing."})]}):null},eN={"file-text":zt,briefcase:jn,banknote:ms,users:wn,user:Qt,"message-circle":Oi,target:rt,award:li,book:Uo,clipboard:Vo,star:Vt,lightbulb:Be,shield:Bi,compass:Vn,rocket:pi},tN=({content:t,primaryAccent:e})=>{if(!t)return null;const n=r=>{const o=r.split(`
`),a=[];let l=[],c=null;const d=()=>{l.length>0&&(a.push(i.jsx("ul",{style:{margin:"12px 0",paddingLeft:"24px",listStyle:"none"},children:l.map((u,h)=>i.jsxs("li",{style:{marginBottom:"8px",fontSize:"15px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"20px"},children:[i.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:c==="number"?`${h+1}.`:""}),s(u)]},h))},`list-${a.length}`)),l=[],c=null)};return o.forEach((u,h)=>{const p=u.trim();if(!p){d();return}if(p.startsWith("### ")){d(),a.push(i.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"24px 0 12px 0",paddingTop:"16px",borderTop:h>0?"1px solid #f1f5f9":"none",display:"flex",alignItems:"center",gap:"8px"},children:s(p.substring(4))},`h3-${h}`));return}if(p.startsWith("## ")){d(),a.push(i.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"28px 0 14px 0"},children:s(p.substring(3))},`h2-${h}`));return}if(p.startsWith("# ")){d(),a.push(i.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"32px 0 16px 0"},children:s(p.substring(2))},`h1-${h}`));return}if(p.startsWith("- ")||p.startsWith("* ")){c!=="bullet"&&(d(),c="bullet"),l.push(p.substring(2));return}const m=p.match(/^(\d+)\.\s/);if(m){c!=="number"&&(d(),c="number"),l.push(p.substring(m[0].length));return}d(),a.push(i.jsx("p",{style:{margin:"12px 0",fontSize:"15px",lineHeight:1.7,color:"#374151"},children:s(p)},`p-${h}`))}),d(),a},s=r=>{const o=[];let a=r,l=0;for(;a.length>0;){const c=a.match(/\*\*(.+?)\*\*/),d=a.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),u=a.match(/`([^`]+)`/),h=[{match:c,type:"bold"},{match:d,type:"italic"},{match:u,type:"code"}].filter(m=>m.match);if(h.length===0){o.push(a);break}const p=h.reduce((m,x)=>(m.match?.index??1/0)<(x.match?.index??1/0)?m:x);switch(p.match.index>0&&o.push(a.substring(0,p.match.index)),p.type){case"bold":o.push(i.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:p.match[1]},l++));break;case"italic":o.push(i.jsx("em",{style:{fontStyle:"italic"},children:p.match[1]||p.match[2]},l++));break;case"code":o.push(i.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:p.match[1]},l++));break}a=a.substring(p.match.index+p.match[0].length)}return o};return i.jsx("div",{children:n(t)})},nN=({briefing:t,template:e,onBack:n,onCreateNew:s,onGenerateAnother:r})=>{const o=Ge(),a=xn(),[l,c]=f.useState(!1),d=f.useRef(null),u=o.primaryAccent,h=o.headerGradient,p=eN[e?.icon||t?.template_icon]||zt,m=y=>y?new Date(y).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",x=async()=>{try{await navigator.clipboard.writeText(t.content_markdown),c(!0),setTimeout(()=>c(!1),2e3)}catch(y){console.error("[SmartBriefing] Failed to copy:",y)}},g=()=>{const y=`${e?.title||t?.template_title}
${"=".repeat(50)}

Erstellt am: ${m(t.created_at)}

${t.content_markdown}`,v=new Blob([y],{type:"text/plain;charset=utf-8"}),k=URL.createObjectURL(v),S=document.createElement("a");S.href=k,S.download=`briefing-${t.id}.txt`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(k)};return t?i.jsxs("div",{style:{minHeight:"100vh",background:o.pageBg},children:[i.jsx("div",{style:{background:h,padding:a?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:i.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[n&&i.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[i.jsx(ft,{size:16}),"Zurck zur bersicht"]}),i.jsxs("div",{style:{display:"flex",alignItems:a?"flex-start":"center",gap:a?"16px":"24px",flexDirection:a?"column":"row"},children:[i.jsx("div",{style:{width:a?70:90,height:a?70:90,borderRadius:"50%",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(p,{size:a?32:40,color:"#fff"})}),i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Smart Briefing"}),i.jsxs("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:u,display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(st,{size:12}),"Fertig!"]})]}),i.jsx("h1",{style:{fontSize:a?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:e?.title||t?.template_title}),i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[i.jsx(qn,{size:14}),m(t.created_at)]})})]}),!a&&i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsxs("button",{onClick:x,style:{display:"flex",alignItems:"center",gap:"8px",background:l?"rgba(34,197,94,0.3)":"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[l?i.jsx(Pn,{size:16}):i.jsx(rd,{size:16}),l?"Kopiert!":"Kopieren"]}),i.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[i.jsx(Ar,{size:16}),"Speichern"]})]})]})]})}),i.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto",padding:a?"16px":"24px 32px"},children:[a&&i.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[i.jsxs("button",{onClick:x,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"12px",borderRadius:"10px",border:`1px solid ${o.borderColor}`,backgroundColor:l?"#dcfce7":"white",color:l?"#16a34a":o.textSecondary,fontSize:"13px",fontWeight:500,cursor:"pointer"},children:[l?i.jsx(Pn,{size:16}):i.jsx(rd,{size:16}),l?"Kopiert!":"Kopieren"]}),i.jsxs("button",{onClick:g,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"12px",borderRadius:"10px",border:`1px solid ${o.borderColor}`,backgroundColor:"white",color:o.textSecondary,fontSize:"13px",fontWeight:500,cursor:"pointer"},children:[i.jsx(Ar,{size:16}),"Speichern"]})]}),i.jsx("div",{ref:d,style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden",border:`1px solid ${o.borderColor}`},children:i.jsx("div",{style:{padding:a?"20px":"32px"},children:i.jsx(tN,{content:t.content_markdown,primaryAccent:u})})}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",flexWrap:"wrap"},children:[i.jsxs("button",{onClick:r,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${u}`,backgroundColor:"white",color:u,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[i.jsx(Ot,{size:18}),"Mit anderen Angaben neu generieren"]}),i.jsxs("button",{onClick:s,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${u}, ${u}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 14px ${u}40`},children:[i.jsx(Yt,{size:18}),"Neues Briefing erstellen"]})]})]})]}):null},iN={"file-text":zt,briefcase:jn,banknote:ms,users:wn,user:Qt,"message-circle":Oi,target:rt,award:li,book:Uo,clipboard:Vo,star:Vt,lightbulb:Be,shield:Bi,compass:Vn,rocket:pi},sN=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",rN=({briefing:t,onOpen:e,onDelete:n,primaryAccent:s,isDeleting:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),d=iN[t.template_icon]||zt,u=h=>{h.stopPropagation(),l?(n(t.id),c(!1)):(c(!0),setTimeout(()=>c(!1),3e3))};return i.jsxs("div",{onClick:()=>e(t),onMouseEnter:()=>a(!0),onMouseLeave:()=>{a(!1),c(!1)},style:{backgroundColor:"white",borderRadius:"16px",padding:"20px",border:`2px solid ${o?s:"#e2e8f0"}`,boxShadow:o?`0 10px 25px -5px rgba(0,0,0,0.1), 0 0 0 1px ${s}20`:"0 1px 3px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease",transform:o?"translateY(-2px)":"translateY(0)",position:"relative"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"10px",background:`linear-gradient(135deg, ${s}15, ${s}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(d,{size:22,style:{color:s}})}),i.jsx("button",{onClick:u,disabled:r,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l?"#fef2f2":o?"#f1f5f9":"transparent",color:l?"#ef4444":"#94a3b8",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",opacity:o||l?1:0},children:r?i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}):i.jsx(We,{size:18})})]}),i.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 4px 0",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||"Unbenanntes Briefing"}),i.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:t.template_title}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#94a3b8",fontSize:"12px"},children:[i.jsx(qn,{size:14}),sN(t.created_at)]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:s,fontSize:"13px",fontWeight:500},children:["Offnen",i.jsx(Et,{size:16})]})]}),l&&i.jsx("div",{style:{position:"absolute",top:"8px",right:"8px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"8px 12px",fontSize:"12px",color:"#dc2626",fontWeight:500,zIndex:10},onClick:h=>h.stopPropagation(),children:"Nochmal klicken zum Loschen"}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},oN=({onOpenBriefing:t,onCreateNew:e,isAuthenticated:n})=>{const{config:s}=qe(),[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(null),p=s?.buttonGradientStart||"#3A7FA7";f.useEffect(()=>{(async()=>{if(!n){l(!1);return}try{l(!0),d(null);const g=await ce.request("/smartbriefing/briefings",{method:"GET"});if(g.success&&g.data?.briefings){const y=g.data.briefings.filter(v=>v.status==="completed");o(y)}else throw new Error("Unerwartete API-Antwort")}catch(g){console.error("[SmartBriefing] Error fetching briefings:",g),d(g.message||"Fehler beim Laden der Briefings")}finally{l(!1)}})()},[n]);const m=async x=>{try{if(h(x),(await ce.request(`/smartbriefing/briefings/${x}`,{method:"DELETE"})).success)o(y=>y.filter(v=>v.id!==x));else throw new Error("Fehler beim Loschen")}catch(g){console.error("[SmartBriefing] Error deleting briefing:",g),d(g.message||"Fehler beim Loschen des Briefings")}finally{h(null)}};return n?i.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Meine Briefings"}),i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[r.length," gespeicherte Briefings"]})]}),i.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[i.jsx(Yt,{size:18}),"Neues Briefing"]})]}),a&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[i.jsx(me,{size:40,style:{color:p,animation:"spin 1s linear infinite"}}),i.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefings werden geladen..."})]}),c&&!a&&i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(Ie,{size:24,style:{color:"#ef4444",flexShrink:0}}),i.jsxs("div",{children:[i.jsx("h3",{style:{margin:"0 0 4px 0",color:"#dc2626",fontSize:"16px"},children:"Fehler beim Laden"}),i.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:c})]})]}),!a&&!c&&i.jsx(i.Fragment,{children:r.length===0?i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[i.jsx(od,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),i.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Noch keine Briefings"}),i.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Erstelle dein erstes Briefing, um loszulegen."}),i.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[i.jsx(Yt,{size:18}),"Briefing erstellen"]})]}):i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:r.map(x=>i.jsx(rN,{briefing:x,onOpen:t,onDelete:m,primaryAccent:p,isDeleting:u===x.id},x.id))})})]}):i.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[i.jsx(od,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),i.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Anmeldung erforderlich"}),i.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},aN=[{key:"file-text",icon:zt,label:"Dokument"},{key:"briefcase",icon:jn,label:"Koffer"},{key:"banknote",icon:ms,label:"Geld"},{key:"users",icon:wn,label:"Team"},{key:"user",icon:Qt,label:"Person"},{key:"target",icon:rt,label:"Ziel"},{key:"lightbulb",icon:Be,label:"Idee"},{key:"star",icon:Vt,label:"Stern"},{key:"shield",icon:Bi,label:"Schutz"},{key:"compass",icon:Vn,label:"Kompass"},{key:"rocket",icon:pi,label:"Rakete"},{key:"message-circle",icon:Oi,label:"Nachricht"},{key:"award",icon:li,label:"Auszeichnung"},{key:"book",icon:Uo,label:"Buch"},{key:"clipboard",icon:Vo,label:"Checkliste"}],am=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],al=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,lN=()=>({id:al(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),cN=()=>({id:al(),value:"",label:""}),dN=({variable:t,index:e,total:n,onChange:s,onDelete:r,onMoveUp:o,onMoveDown:a,primaryAccent:l})=>{const[c,d]=f.useState(!0),[u,h]=f.useState(t.label);f.useEffect(()=>{h(t.label)},[t.label]);const p=(k,S)=>{s({...t,[k]:S})},m=()=>{const k=[...t.options||[],cN()];s({...t,options:k})},x=(k,S,w)=>{const b=t.options.map(T=>T.id===k?{...T,[S]:w}:T);s({...t,options:b})},g=k=>{const S=t.options.filter(w=>w.id!==k);s({...t,options:S})},y=k=>k.toLowerCase().replace(/[]/g,S=>({:"ae",:"oe",:"ue",:"ss"})[S]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),v=()=>{if(u!==t.label){const k={label:u};(!t.key||t.key===y(t.label))&&(k.key=y(u)),s({...t,...k})}};return i.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0",marginBottom:"12px",overflow:"hidden"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 16px",backgroundColor:"white",borderBottom:c?"1px solid #e2e8f0":"none",cursor:"pointer"},onClick:()=>d(!c),children:[i.jsx(Xj,{size:16,style:{color:"#94a3b8",cursor:"grab"}}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px"},children:t.label||`Variable ${e+1}`}),t.key&&i.jsxs("span",{style:{marginLeft:"8px",color:"#64748b",fontSize:"12px"},children:["$","{","$",t.key,"}"]})]}),i.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:500,backgroundColor:`${l}15`,color:l},children:am.find(k=>k.value===t.type)?.label||t.type}),i.jsxs("div",{style:{display:"flex",gap:"2px"},children:[i.jsx("button",{onClick:k=>{k.stopPropagation(),o()},disabled:e===0,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===0?"not-allowed":"pointer",opacity:e===0?.3:1},children:i.jsx(ni,{size:16,style:{color:"#64748b"}})}),i.jsx("button",{onClick:k=>{k.stopPropagation(),a()},disabled:e===n-1,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===n-1?"not-allowed":"pointer",opacity:e===n-1?.3:1},children:i.jsx(bt,{size:16,style:{color:"#64748b"}})})]}),i.jsx("button",{onClick:k=>{k.stopPropagation(),r()},style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},title:"Variable lschen",children:i.jsx(We,{size:16})})]}),i.jsx(Ve,{children:c&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:i.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldbezeichnung *"}),i.jsx("input",{type:"text",value:u,onChange:k=>h(k.target.value),onBlur:v,placeholder:"z.B. Unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Variablenname *"}),i.jsx("input",{type:"text",value:t.key,onChange:k=>p("key",k.target.value),placeholder:"z.B. unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"12px",alignItems:"end"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldtyp"}),i.jsx("select",{value:t.type,onChange:k=>p("type",k.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",backgroundColor:"white"},children:am.map(k=>i.jsx("option",{value:k.value,children:k.label},k.value))})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 0",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:t.required,onChange:k=>p("required",k.target.checked),style:{width:"16px",height:"16px",accentColor:l}}),i.jsx("span",{style:{fontSize:"14px",color:"#475569"},children:"Pflichtfeld"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Platzhalter-Text (optional)"}),i.jsx("input",{type:"text",value:t.placeholder,onChange:k=>p("placeholder",k.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),t.type==="select"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"8px"},children:"Auswahloptionen"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(t.options||[]).map((k,S)=>i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsx("input",{type:"text",value:k.value,onChange:w=>x(k.id,"value",w.target.value),placeholder:"Wert",style:{flex:1,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px",fontFamily:"monospace"}}),i.jsx("input",{type:"text",value:k.label,onChange:w=>x(k.id,"label",w.target.value),placeholder:"Anzeigename",style:{flex:2,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px"}}),i.jsx("button",{onClick:()=>g(k.id),style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},children:i.jsx(We,{size:14})})]},k.id)),i.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"6px",backgroundColor:"transparent",color:"#64748b",fontSize:"13px",cursor:"pointer",marginTop:"4px"},children:[i.jsx(Yt,{size:14}),"Option hinzufgen"]})]})]})]})})})]})},uN=({selectedIcon:t,onSelect:e,primaryAccent:n})=>i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:aN.map(({key:s,icon:r,label:o})=>{const a=t===s;return i.jsx("button",{onClick:()=>e(s),title:o,style:{width:"60px",height:"60px",borderRadius:"12px",border:`2px solid ${a?n:"#e2e8f0"}`,backgroundColor:a?`${n}15`:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s"},children:i.jsx(r,{size:28,style:{color:a?n:"#64748b"}})},s)})}),hN=({isOpen:t,onClose:e,onSave:n,editTemplate:s=null,demoCode:r})=>{const{branding:o,config:a}=qe(),l=o?.["--primary-accent"]||a?.buttonGradientStart||"#3A7FA7",[c,d]=f.useState(""),[u,h]=f.useState(""),[p,m]=f.useState("file-text"),[x,g]=f.useState(""),[y,v]=f.useState([]),[k,S]=f.useState(!1),[w,b]=f.useState(null),[T,C]=f.useState("basics");f.useEffect(()=>{s?(d(s.title||""),h(s.description||""),m(s.icon||"file-text"),g(s.system_prompt||""),v((s.variables_schema||[]).map(_=>({..._,id:_.id||al(),options:(_.options||[]).map(O=>({...O,id:O.id||al()}))})))):(d(""),h(""),m("file-text"),g(""),v([])),C("basics"),b(null)},[s,t]);const j=()=>{v([...y,lN()])},R=(_,O)=>{const W=[...y];W[_]=O,v(W)},I=_=>{v(y.filter((O,W)=>W!==_))},A=_=>{if(_===0)return;const O=[...y];[O[_-1],O[_]]=[O[_],O[_-1]],v(O)},L=_=>{if(_===y.length-1)return;const O=[...y];[O[_],O[_+1]]=[O[_+1],O[_]],v(O)},B=()=>{if(!c.trim())return b("Bitte gib einen Titel ein."),C("basics"),!1;if(!x.trim())return b("Bitte gib einen System-Prompt ein."),C("prompt"),!1;for(const _ of y){if(!_.key.trim()||!_.label.trim())return b("Alle Variablen bentigen einen Namen und eine Bezeichnung."),C("variables"),!1;if(_.type==="select"&&(!_.options||_.options.length===0))return b(`Variable "${_.label}" bentigt mindestens eine Auswahloption.`),C("variables"),!1}return!0},P=async()=>{if(b(null),!!B()){S(!0);try{const _=y.map(D=>({key:D.key,label:D.label,type:D.type,required:D.required,placeholder:D.placeholder,...D.type==="select"?{options:D.options.map(N=>({value:N.value,label:N.label}))}:{}})),O={title:c.trim(),description:u.trim(),icon:p,system_prompt:x,variables_schema:_,...r?{demo_code:r}:{}};let W;if(s?W=await ce.request(`/smartbriefing/templates/${s.id}`,{method:"PUT",body:JSON.stringify(O)}):W=await ce.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(O)}),W.success)n?.(W.data.template),e();else throw new Error(W.message||"Fehler beim Speichern")}catch(_){console.error("[CreateTemplateDialog] Save error:",_),b(_.message||"Fehler beim Speichern des Templates")}finally{S(!1)}}};return t?i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},children:i.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"20px",width:"100%",maxWidth:"700px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden"},onClick:_=>_.stopPropagation(),children:[i.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:700,color:"#0f172a"},children:s?"Template bearbeiten":"Neues Template erstellen"}),i.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"#64748b"},children:"Erstelle ein persnliches Briefing-Template"})]}),i.jsx("button",{onClick:e,style:{padding:"8px",border:"none",backgroundColor:"#f1f5f9",borderRadius:"8px",cursor:"pointer"},children:i.jsx(Bt,{size:20,style:{color:"#64748b"}})})]}),i.jsx("div",{style:{display:"flex",borderBottom:"1px solid #e2e8f0",padding:"0 24px"},children:[{key:"basics",label:"Grundlagen"},{key:"variables",label:"Eingabefelder"},{key:"prompt",label:"KI-Anweisung"}].map(_=>i.jsx("button",{onClick:()=>C(_.key),style:{padding:"12px 20px",border:"none",backgroundColor:"transparent",fontSize:"14px",fontWeight:600,cursor:"pointer",color:T===_.key?l:"#64748b",borderBottom:`3px solid ${T===_.key?l:"transparent"}`,marginBottom:"-1px",transition:"all 0.2s"},children:_.label},_.key))}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px"},children:[w&&i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px 16px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Ie,{size:18,style:{color:"#ef4444",flexShrink:0}}),i.jsx("span",{style:{color:"#dc2626",fontSize:"14px"},children:w})]}),T==="basics"&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Titel *"}),i.jsx("input",{type:"text",value:c,onChange:_=>d(_.target.value),placeholder:"z.B. Projektprsentation Vorbereitung",style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"15px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Beschreibung"}),i.jsx("textarea",{value:u,onChange:_=>h(_.target.value),placeholder:"Kurze Beschreibung, wofr dieses Template verwendet wird...",rows:3,style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"8px"},children:"Symbol"}),i.jsx(uN,{selectedIcon:p,onSelect:m,primaryAccent:l})]})]}),T==="variables"&&i.jsxs("div",{children:[i.jsx("div",{style:{marginBottom:"16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[i.jsx(s0,{size:16,style:{color:"#64748b"}}),i.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:"Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausfllen soll."})]})}),y.map((_,O)=>i.jsx(dN,{variable:_,index:O,total:y.length,onChange:W=>R(O,W),onDelete:()=>I(O),onMoveUp:()=>A(O),onMoveDown:()=>L(O),primaryAccent:l},_.id)),i.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"14px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:_=>{_.currentTarget.style.borderColor=l,_.currentTarget.style.color=l},onMouseLeave:_=>{_.currentTarget.style.borderColor="#cbd5e1",_.currentTarget.style.color="#64748b"},children:[i.jsx(Yt,{size:18}),"Eingabefeld hinzufgen"]}),y.length===0&&i.jsx("div",{style:{textAlign:"center",padding:"32px",color:"#94a3b8",fontSize:"14px"},children:"Noch keine Eingabefelder definiert."})]}),T==="prompt"&&i.jsxs("div",{children:[i.jsx("div",{style:{backgroundColor:"#f0f9ff",borderRadius:"10px",padding:"16px",marginBottom:"16px",border:"1px solid #bae6fd"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[i.jsx(Be,{size:18,style:{color:"#0284c7",flexShrink:0,marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:"14px",fontWeight:600,color:"#0369a1"},children:"Tipps fr effektive Prompts"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"16px",fontSize:"13px",color:"#0369a1",lineHeight:1.6},children:[i.jsxs("li",{children:["Verwende ",i.jsxs("code",{style:{backgroundColor:"#e0f2fe",padding:"1px 4px",borderRadius:"3px"},children:["$","{variablenname}"]})," um auf Eingabefelder zu verweisen"]}),i.jsx("li",{children:'Beschreibe die Rolle der KI (z.B. "Du bist ein erfahrener Karriere-Coach...")'}),i.jsx("li",{children:"Definiere die Struktur des gewnschten Outputs"}),i.jsx("li",{children:"Gib Beispiele fr den Ton und Stil"})]})]})]})}),y.length>0&&i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("span",{style:{fontSize:"12px",color:"#64748b"},children:"Verfgbare Variablen: "}),y.map(_=>i.jsxs("code",{style:{display:"inline-block",padding:"2px 6px",marginRight:"6px",marginBottom:"4px",backgroundColor:"#f1f5f9",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",color:"#475569",cursor:"pointer"},onClick:()=>{const O=`\${${_.key}}`;g(W=>W+O)},title:"Klicken zum Einfgen",children:["$","{"+_.key+"}"]},_.id))]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"System-Prompt *"}),i.jsx("textarea",{value:x,onChange:_=>g(_.target.value),placeholder:`Du bist ein erfahrener Experte fr...

Erstelle ein strukturiertes Briefing fr den Nutzer basierend auf folgenden Informationen:
- Position: \${position}
- Unternehmen: \${unternehmen}

Das Briefing soll folgende Abschnitte enthalten:
1. ...
2. ...

Formatiere jeden Abschnitt mit einem Titel und 5-8 konkreten Bullet Points.`,rows:15,style:{width:"100%",padding:"14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",resize:"vertical",lineHeight:1.5}})]})]})]}),i.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},children:[i.jsx("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"10px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),i.jsx("button",{onClick:P,disabled:k,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"10px",border:"none",background:`linear-gradient(135deg, ${l} 0%, ${l}dd 100%)`,color:"white",fontSize:"14px",fontWeight:600,cursor:k?"not-allowed":"pointer",opacity:k?.7:1},children:k?i.jsxs(i.Fragment,{children:[i.jsx(me,{size:18,style:{animation:"spin 1s linear infinite"}}),"Speichern..."]}):i.jsxs(i.Fragment,{children:[i.jsx(d0,{size:18}),s?"Speichern":"Template erstellen"]})})]}),i.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}):null},Xt={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},pN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToSimulator:s,onNavigateToHistory:r,demoCode:o})=>{const[a,l]=f.useState(Xt.DASHBOARD),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState(null),[y,v]=f.useState(!1),[k,S]=f.useState(null),[w,b]=f.useState(0);f.useEffect(()=>{x&&t&&(d(x),l(Xt.FORM),g(null))},[x,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const T=f.useCallback(N=>{d(N),l(Xt.FORM)},[]),C=f.useCallback(()=>{d(null),h(null),m(null),l(Xt.DASHBOARD)},[]),j=f.useCallback(N=>{h(N),m(N),l(Xt.WORKBOOK)},[]),R=f.useCallback(()=>{h(null),m(null),d(null),l(Xt.DASHBOARD)},[]),I=f.useCallback(()=>{h(null),m(null),l(Xt.FORM)},[]);f.useCallback(()=>{l(Xt.LIST)},[]);const A=f.useCallback(N=>{m(N),l(Xt.WORKBOOK)},[]);f.useCallback(()=>{m(null),l(Xt.LIST)},[]);const L=f.useCallback(N=>{s&&s(N)},[s]),B=f.useCallback(async N=>{try{if((await ce.request(`/smartbriefing/briefings/${N.id}`,{method:"DELETE"})).success)m(null),l(Xt.DASHBOARD);else throw new Error("Fehler beim Lschen")}catch(F){throw console.error("[SmartBriefing] Error deleting briefing:",F),F}},[]),P=f.useCallback(()=>{S(null),v(!0)},[]),_=f.useCallback(N=>{S(N),v(!0)},[]),O=f.useCallback(()=>{v(!1),S(null)},[]),W=f.useCallback(N=>{b(F=>F+1)},[]),D=()=>{switch(a){case Xt.FORM:return i.jsx(QD,{template:c,onBack:C,onBriefingGenerated:j,isAuthenticated:t});case Xt.RESULT:return i.jsx(nN,{briefing:u,template:c,onBack:C,onCreateNew:R,onGenerateAnother:I});case Xt.LIST:return i.jsx(oN,{onOpenBriefing:A,onCreateNew:R,isAuthenticated:t});case Xt.WORKBOOK:return i.jsx(Ev,{briefing:p,onBack:C,onDelete:B,onStartSimulation:s?L:null});case Xt.DASHBOARD:default:return i.jsx(YD,{onSelectTemplate:T,onShowList:r,onCreateTemplate:P,onEditTemplate:_,isAuthenticated:t,requireAuth:e,setPendingAction:n,demoCode:o},w)}};return i.jsxs("div",{style:{minHeight:"100%"},children:[D(),i.jsx(hN,{isOpen:y,onClose:O,onSave:W,editTemplate:k,demoCode:o})]})},rr={INPUT:"input",RESULT:"result"},fN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToHistory:s})=>{const[r,o]=f.useState(rr.INPUT),[a,l]=f.useState(null),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(!1),x=f.useRef(!1);f.useEffect(()=>{window.scrollTo(0,0)},[r]);const g=f.useCallback(async C=>{if(x.current||!C.topic?.trim())return null;try{const j={topic:C.topic,context:C.context||null,pros:C.pros||[],cons:C.cons||[],pro_score:C.proScore||0,contra_score:C.contraScore||0,status:"draft"},R=await ce.createDecision(j);if(R?.id)return x.current=!0,h(R.id),console.log("[DecisionBoard] Draft session saved with ID:",R.id),R.id}catch(j){console.error("[DecisionBoard] Failed to save draft session:",j)}return null},[]),y=f.useCallback(async(C,j)=>{if(C)try{const R={topic:j.topic,context:j.context||null,pros:j.pros||[],cons:j.cons||[],pro_score:j.proScore||0,contra_score:j.contraScore||0,analysis:j.analysis||null,status:j.status||"completed"};await ce.updateDecision(C,R),console.log("[DecisionBoard] Session updated:",C)}catch(R){console.error("[DecisionBoard] Failed to update session:",R)}},[]),v=f.useCallback(async C=>{if(C)try{await ce.deleteDecision(C),console.log("[DecisionBoard] Session deleted:",C)}catch(j){console.error("[DecisionBoard] Failed to delete session:",j)}},[]),k=f.useCallback(async(C,j)=>{l(C),d(j),o(rr.RESULT);try{if(u)await y(u,{...C,analysis:j,status:"completed"});else{const R={topic:C.topic,context:C.context||null,pros:C.pros,cons:C.cons,pro_score:C.proScore,contra_score:C.contraScore,analysis:j,status:"completed"},I=await ce.createDecision(R);I?.id&&(h(I.id),x.current=!0,console.log("[DecisionBoard] Decision saved with ID:",I.id))}}catch(R){console.error("[DecisionBoard] Failed to save decision:",R)}},[u,y]),S=f.useCallback(()=>{l(null),d(null),h(null),x.current=!1,o(rr.INPUT)},[]),w=f.useCallback(()=>{d(null),o(rr.INPUT)},[]),b=f.useCallback(async()=>{u&&await v(u),l(null),d(null),h(null),x.current=!1,s&&s()},[u,v,s]),T=()=>{switch(r){case rr.RESULT:return i.jsx(Mv,{decisionData:a,analysisResult:c,onStartNew:S,onEditDecision:w});case rr.INPUT:default:return i.jsx(_v,{initialData:a,onAnalysisComplete:k,onCancel:s?b:null,isAuthenticated:t,requireAuth:e,savedDecisionId:u,onSaveDraft:g,onUpdateSession:y,onDecisionIdChange:h})}};return i.jsx("div",{style:{minHeight:"100%"},children:T()})},or={COMPASS:"compass",RESULTS:"results"},lm={love:{key:"love",label:"Liebe",icon:"",color:"#E11D48",question:"Vergiss mal Geld und Karriere. Bei welchen Ttigkeiten vergisst du die Zeit?",placeholder:"Erzhle mir, was du wirklich liebst zu tun...",description:"Was du liebst"},talent:{key:"talent",label:"Talent",icon:"",color:"#F59E0B",question:"Worin bist du richtig gut? Was fllt dir leicht, whrend andere damit kmpfen?",placeholder:"Beschreibe deine Strken und Fhigkeiten...",description:"Worin du gut bist"},need:{key:"need",label:"Welt",icon:"",color:"#10B981",question:"Welche Probleme der Welt wrdest du gerne lsen? Wo siehst du Bedarf?",placeholder:"Welchen Beitrag mchtest du leisten...",description:"Was die Welt braucht"},market:{key:"market",label:"Markt",icon:"",color:"#6366F1",question:"Wofr werden Menschen in deinem Bereich bezahlt? Was ist gefragt?",placeholder:"Welche Berufe oder Mrkte interessieren dich...",description:"Wofr du bezahlt wirst"}},gN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToHistory:s})=>{const[r,o]=f.useState(or.COMPASS),[a,l]=f.useState(null),[c,d]=f.useState(!1),[u,h]=f.useState({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),[p,m]=f.useState(null),x=f.useRef(!1);f.useEffect(()=>{window.scrollTo(0,0)},[r]);const g=Object.values(u).every(j=>j.tags&&j.tags.length>0),y=f.useCallback(async()=>{if(a)return a;try{const j=await ce.createIkigai();if(j?.id)return l(j.id),x.current=!0,console.log("[Ikigai] Session created with ID:",j.id),j.id}catch(j){console.error("[Ikigai] Failed to create session:",j)}return null},[a]),v=f.useCallback(async(j,R,I)=>{h(A=>({...A,[j]:{input:R,tags:I}}));try{const A=await y();A&&(await ce.updateIkigai(A,{[`${j}_input`]:R,[`${j}_tags`]:I}),console.log(`[Ikigai] Dimension ${j} saved`))}catch(A){console.error("[Ikigai] Failed to save dimension:",A)}},[y]),k=f.useCallback(async(j,R)=>{try{const I=await ce.extractIkigaiKeywords(j,R);return I?.keywords?I.keywords:[]}catch(I){return console.error("[Ikigai] Failed to extract keywords:",I),[]}},[]),S=f.useCallback(async()=>{if(g){d(!0);try{const j=await ce.synthesizeIkigaiPaths({love_tags:u.love.tags,talent_tags:u.talent.tags,need_tags:u.need.tags,market_tags:u.market.tags});if(j){m(j);const R=a||await y();R&&await ce.updateIkigai(R,{summary:j.summary,paths:j.paths,status:"completed"}),o(or.RESULTS)}}catch(j){console.error("[Ikigai] Failed to synthesize paths:",j)}finally{d(!1)}}},[g,u,a,y]),w=f.useCallback((j,R)=>{h(I=>{const A=I[j].tags.filter(L=>L!==R);return{...I,[j]:{...I[j],tags:A}}})},[]),b=f.useCallback(()=>{h({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),m(null),l(null),x.current=!1,o(or.COMPASS)},[]),T=f.useCallback(()=>{m(null),o(or.COMPASS)},[]),C=()=>{switch(r){case or.RESULTS:return i.jsx(Dv,{dimensions:u,synthesisResult:p,onStartNew:b,onEdit:T,DIMENSIONS:lm});case or.COMPASS:default:return i.jsx(Pv,{dimensions:u,DIMENSIONS:lm,onExtractKeywords:k,onUpdateDimension:v,onRemoveTag:w,allDimensionsFilled:g,onSynthesize:S,isSynthesizing:c})}};return i.jsx("div",{style:{minHeight:"100%"},children:C()})},mN=({onNavigateToRoleplay:t,compact:e=!1})=>{const{branding:n,demoCode:s}=qe(),[r,o]=f.useState(!0),[a,l]=f.useState(null),[c,d]=f.useState(null),u=f.useMemo(()=>{const k=n?.["--header-gradient"]||_e["--header-gradient"],S=n?.["--header-text"]||_e["--header-text"],w=n?.["--primary-accent"]||_e["--primary-accent"],b=n?.["--primary-accent-light"]||_e["--primary-accent-light"];return{headerGradient:k,headerText:S,primaryAccent:w,primaryAccentLight:b}},[n]),h=async()=>{try{o(!0),l(null);const k=await ce.getUsageLimits(s);d(k)}catch(k){console.error("[UsageLimits] Error fetching usage data:",k),l(k.message||"Fehler beim Laden der Nutzungsdaten")}finally{o(!1)}};f.useEffect(()=>{h()},[s]);const p=f.useMemo(()=>!c||c.monthly_limit===0?0:Math.min(100,c.used_minutes/c.monthly_limit*100),[c]),m=(k,S)=>{const w=k/S*100;return w<=0?"#ef4444":w<=20?"#f59e0b":w<=50?"#eab308":"#22c55e"},x=k=>k?new Date(k).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",g=k=>k==null?"0 Min.":`${Math.round(k*10)/10} Min.`;if(r)return i.jsx("div",{className:"flex items-center justify-center p-8",children:i.jsx(me,{className:"w-8 h-8 animate-spin text-slate-400"})});if(a)return i.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[i.jsx(Ie,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),i.jsx("div",{className:"flex-1",children:i.jsx("p",{className:"text-red-700 text-sm font-medium",children:a})}),i.jsxs(de,{variant:"outline",size:"sm",onClick:h,children:[i.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(e){const k=m(c?.remaining_minutes||0,c?.monthly_limit||10),S=c?.has_minutes!==!1;return i.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:t,title:S?"Live-Gesprch starten":"Keine Minuten mehr verfgbar",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:u.headerGradient},children:i.jsx(uo,{className:"w-5 h-5",style:{color:u.headerText}})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gesprche"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-bold text-lg",style:{color:k},children:g(c?.remaining_minutes||0)}),i.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",c?.monthly_limit||10," Min."]})]})]}),!S&&i.jsx(Ie,{className:"w-5 h-5 text-red-500"})]}),i.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:i.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${p}%`,background:k}})})]})}const y=m(c?.remaining_minutes||0,c?.monthly_limit||10),v=c?.has_minutes!==!1;return i.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[i.jsx("div",{className:"px-6 py-4",style:{background:u.headerGradient},children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:i.jsx(uo,{className:"w-6 h-6",style:{color:u.headerText}})}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-bold",style:{color:u.headerText},children:"Live-Gesprche"}),i.jsx("p",{className:"text-sm opacity-80",style:{color:u.headerText},children:"Monatliches Kontingent"})]})]}),i.jsx(de,{variant:"ghost",size:"icon",onClick:h,className:"text-white hover:bg-white/10",children:i.jsx(Ot,{className:"w-5 h-5"})})]})}),i.jsxs("div",{className:"p-6",children:[i.jsx("div",{className:"text-center mb-6",children:i.jsxs("div",{className:"relative inline-block",children:[i.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[i.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),i.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:y,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-p)*2.827} 282.7`,className:"transition-all duration-500"})]}),i.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[i.jsx("span",{className:"text-3xl font-bold",style:{color:y},children:g(c?.remaining_minutes||0)}),i.jsx("span",{className:"text-sm text-slate-500",children:"verfgbar"})]})]})}),i.jsx(Ve,{mode:"wait",children:v?p>80?i.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ie,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),i.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",g(c?.remaining_minutes)," weise."]})]})]})},"low-minutes"):i.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ds,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfgbar"}),i.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gesprch zum ben."})]})]})},"ok"):i.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ie,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),i.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",x(c?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),i.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[i.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[i.jsx(gn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),i.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[c?.monthly_limit||10," Min."]})]}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[i.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[i.jsx(Ye,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),i.jsx("span",{className:"text-lg font-bold text-slate-700",children:g(c?.used_minutes||0)})]}),i.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[i.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[i.jsx(qn,{className:"w-4 h-4"}),i.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),i.jsx("span",{className:"text-sm font-bold text-slate-700",children:x(c?.next_reset)})]})]}),i.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",x(c?.period_start)," - ",x(c?.period_end)]}),t&&i.jsxs(de,{onClick:t,disabled:!v,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:v?u.headerGradient:"#94a3b8",color:u.headerText},children:[i.jsx(uo,{className:"w-5 h-5 mr-2"}),v?"Live-Gesprch starten":"Keine Minuten verfgbar"]}),c?.is_demo_user&&c?.demo_code&&i.jsx("div",{className:"mt-4 text-center",children:i.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",i.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:c.demo_code})]})})]})]})},Lv=f.createContext(null),cm={success:{bgColor:"#10b981",icon:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},error:{bgColor:"#ef4444",icon:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},info:{bgColor:"#3b82f6",icon:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},warning:{bgColor:"#f59e0b",icon:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}};function xN({id:t,message:e,type:n="success",duration:s=3e3,onDismiss:r}){const o=cm[n]||cm.info;return f.useEffect(()=>{if(s>0){const a=setTimeout(()=>{r(t)},s);return()=>clearTimeout(a)}},[t,s,r]),i.jsxs($.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px",padding:"14px 20px",backgroundColor:o.bgColor,color:"#ffffff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",fontSize:"15px",fontWeight:500,minWidth:"280px",maxWidth:"400px"},children:[i.jsx("span",{style:{flexShrink:0},children:o.icon}),i.jsx("span",{style:{flex:1},children:e}),i.jsx("button",{onClick:()=>r(t),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"6px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",flexShrink:0},onMouseEnter:a=>a.target.style.background="rgba(255, 255, 255, 0.3)",onMouseLeave:a=>a.target.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function yN({toasts:t,onDismiss:e}){return i.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:i.jsx(Ve,{children:t.map(n=>i.jsx(xN,{...n,onDismiss:e},n.id))})})}function bN({children:t}){const[e,n]=f.useState([]),s=f.useCallback((u,h="success",p=3e3)=>{const m=Date.now()+Math.random();return n(x=>[...x,{id:m,message:u,type:h,duration:p}]),m},[]),r=f.useCallback(u=>{n(h=>h.filter(p=>p.id!==u))},[]),o=f.useCallback((u,h)=>s(u,"success",h),[s]),a=f.useCallback((u,h)=>s(u,"error",h),[s]),l=f.useCallback((u,h)=>s(u,"info",h),[s]),c=f.useCallback((u,h)=>s(u,"warning",h),[s]),d={addToast:s,dismissToast:r,showSuccess:o,showError:a,showInfo:l,showWarning:c};return i.jsxs(Lv.Provider,{value:d,children:[t,i.jsx(yN,{toasts:e,onDismiss:r})]})}function Ov(){const t=f.useContext(Lv);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}const Fe={blue:{50:"#E8F4F8",600:"#3A7FA7",700:"#2D6485"},teal:{500:"#3DA389"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",400:"#94a3b8",700:"#334155",900:"#0f172a"}},Bv=t=>t?{sidebarBg:t["--sidebar-bg-color"]||Fe.slate[50],sidebarText:t["--sidebar-text-color"]||Fe.slate[900],sidebarTextMuted:t["--sidebar-text-muted"]||Fe.slate[400],sidebarActiveBg:t["--sidebar-active-bg"]||Fe.blue[50],sidebarActiveText:t["--sidebar-active-text"]||Fe.blue[700],sidebarHoverBg:t["--sidebar-hover-bg"]||Fe.slate[50],primaryAccent:t["--primary-accent"]||Fe.blue[600],borderColor:t["--border-color"]||Fe.slate[200],borderColorLight:t["--border-color-light"]||Fe.slate[100]}:null,Fv=[{id:"overview",moduleId:"overview",label:"bersicht",shortLabel:"bersicht",icon:eT,description:"Alle Trainingsmglichkeiten",alwaysVisible:!0},{id:"ikigai",moduleId:"ikigai",label:"Ikigai-Kompass",shortLabel:"Ikigai",icon:Vn,description:"Finde deinen idealen Karrierepfad"},{id:"decision_board",moduleId:"decision_board",label:"Entscheidungs-Kompass",shortLabel:"Entscheidung",icon:ci,description:"KI-gesttzte Entscheidungshilfe"},{id:"smart_briefing",moduleId:"smart_briefing",label:"Smart Briefing",shortLabel:"Briefing",icon:st,description:"KI-Vorbereitungs-Assistent"},{id:"simulator",moduleId:"simulator",label:"Szenario-Training",shortLabel:"Szenario",icon:rt,description:"Frage-Antwort Training mit KI-Feedback"},{id:"video_training",moduleId:"video_training",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:jt,description:"Video-Aufnahme mit Wirkungs-Analyse"},{id:"dashboard",moduleId:"roleplay",label:"Live-Simulationen",shortLabel:"Live",icon:Ze,description:"Live Simulationen mit KI-Interviewer"},{id:"gym",moduleId:"gym",label:"Rhetorik-Gym",shortLabel:"Gym",icon:r0,description:"Spielerisch Rhetorik trainieren",subItems:[{id:"gym_klassiker",label:"Der Fllwort-Killer",shortLabel:"Klassiker",icon:pi,description:"60s Elevator Pitch"}]},{id:"history",moduleId:"history",label:"Meine Sessions",shortLabel:"Sessions",icon:ad,description:"Vergangene bungen ansehen"},{id:"usage_limits",moduleId:"roleplay",label:"Mein Kontingent",shortLabel:"Kontingent",icon:Ye,description:"Verfgbare Gesprchsminuten"}],Wv=[{id:"admin",label:"Administration",shortLabel:"Admin",icon:Bi,description:"Inhalte verwalten",adminOnly:!0,subItems:[{id:"admin_roleplays",label:"Live-Simulationen",shortLabel:"Live",icon:Ze,description:"Simulations-Szenarien verwalten"},{id:"admin_simulator",label:"Szenario-Training",shortLabel:"Simulator",icon:rt,description:"Simulator-Szenarien verwalten"},{id:"admin_video",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:jt,description:"Wirkungs-Analysen verwalten"},{id:"admin_partners",label:"Partner-Branding",shortLabel:"Partner",icon:wn,description:"White-Label Partner verwalten"}]}],vN=({isCollapsed:t,onToggleCollapse:e,activeView:n,onNavigate:s,headerOffset:r=0,onLoginClick:o})=>{const[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=qe(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=ll(),{showSuccess:v}=Ov(),k=Bv(c),S=f.useMemo(()=>{const j=Fv.filter(R=>{if(R.alwaysVisible)return!0;const I=R.moduleId||R.id;return p(I)});return g?[...j,...Wv]:j},[p,g]),w=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>k?{sidebarBg:k.sidebarBg,sidebarText:k.sidebarText,sidebarTextMuted:k.sidebarTextMuted,activeBg:k.sidebarActiveBg,activeText:k.sidebarActiveText,hoverBg:k.sidebarHoverBg,primaryAccent:k.primaryAccent,borderColor:k.borderColor,borderColorLight:k.borderColorLight}:{sidebarBg:"#ffffff",sidebarText:Fe.slate[900],sidebarTextMuted:Fe.slate[400],activeBg:Fe.blue[50],activeText:Fe.blue[700],hoverBg:Fe.slate[50],primaryAccent:Fe.blue[600],borderColor:Fe.slate[200],borderColorLight:Fe.slate[100]},[k]),T=j=>{l(R=>R.includes(j)?R.filter(I=>I!==j):[...R,j])},C=j=>{j.subItems&&!t?T(j.id):s(j.id)};return i.jsxs($.aside,{initial:!1,animate:{width:t?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{position:"fixed",left:0,top:r,bottom:0,zIndex:40,backgroundColor:b.sidebarBg,borderRight:`1px solid ${b.borderColor}`,display:"flex",flexDirection:"column",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:[i.jsx("div",{style:{height:"64px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${b.borderColorLight}`},children:i.jsx(Ve,{mode:"wait",children:t?i.jsx($.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Fe.blue[600]} 0%, ${Fe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",margin:"0 auto",overflow:"hidden"},children:h?i.jsx("img",{src:h,alt:u,style:{width:"100%",height:"100%",objectFit:"contain"}}):i.jsx(To,{style:{width:"20px",height:"20px",color:"white"}})},"logo-collapsed"):i.jsxs($.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px"},children:[h?i.jsx("img",{src:h,alt:u,style:{width:"40px",height:"40px",borderRadius:"12px",objectFit:"contain"}}):i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Fe.blue[600]} 0%, ${Fe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:i.jsx(To,{style:{width:"20px",height:"20px",color:"white"}})}),i.jsx("div",{style:{display:"flex",flexDirection:"column"},children:d?i.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.4"},children:u}):i.jsxs(i.Fragment,{children:[i.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.2"},children:"Karriere"}),i.jsx("span",{style:{fontWeight:700,color:b.primaryAccent,fontSize:"14px",lineHeight:"1.2"},children:"Navigation"})]})})]},"logo-full")})}),i.jsx("nav",{style:{flex:1,padding:"8px 12px",overflowY:"auto"},children:S.map((j,R)=>{const I=j.icon,A=n===j.id||j.id==="dashboard"&&n==="roleplay"||j.id==="gym"&&n.startsWith("gym")||j.id==="admin"&&n.startsWith("admin"),L=j.subItems&&j.subItems.length>0,B=a.includes(j.id),P=j.adminOnly;return i.jsxs("div",{children:[P&&i.jsx("div",{style:{margin:"12px 0",padding:t?"0":"0 4px",borderTop:`1px solid ${b.borderColor}`},children:!t&&i.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.sidebarTextMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"12px"},children:"Admin"})}),i.jsxs("button",{onClick:()=>C(j),style:{width:"100%",borderRadius:"12px",display:"flex",alignItems:"center",gap:"12px",position:"relative",padding:t?"12px":"12px 16px",justifyContent:t?"center":"flex-start",backgroundColor:A?b.activeBg:"transparent",color:A?b.activeText:b.sidebarText,fontWeight:A?600:400,fontSize:"14px",border:"none",cursor:"pointer",marginBottom:"4px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:_=>{A||(_.currentTarget.style.backgroundColor=b.hoverBg,_.currentTarget.style.color=b.sidebarText)},onMouseLeave:_=>{A||(_.currentTarget.style.backgroundColor="transparent",_.currentTarget.style.color=b.sidebarText)},children:[A&&i.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:"4px",height:"32px",backgroundColor:b.primaryAccent,borderTopRightRadius:"9999px",borderBottomRightRadius:"9999px"}}),i.jsx(I,{style:{width:"20px",height:"20px",flexShrink:0,color:A?b.primaryAccent:b.sidebarTextMuted}}),!t&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",flex:1,minWidth:0},children:[i.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:j.label}),i.jsx("span",{style:{fontSize:"12px",color:b.sidebarTextMuted,whiteSpace:"normal",lineHeight:1.3},children:j.description})]}),L&&i.jsx(bt,{style:{width:"16px",height:"16px",color:b.sidebarTextMuted,transition:"transform 0.2s",transform:B?"rotate(180deg)":"rotate(0deg)"}})]})]}),L&&!t&&i.jsx(Ve,{children:B&&i.jsx($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},style:{overflow:"hidden",marginLeft:"16px"},children:j.subItems.map(_=>{const O=_.icon,W=n===_.id;return i.jsxs("button",{onClick:()=>s(_.id),style:{width:"100%",borderRadius:"10px",display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",backgroundColor:W?b.activeBg:"transparent",color:W?b.activeText:b.sidebarText,fontWeight:W?600:400,fontSize:"13px",border:"none",cursor:"pointer",marginBottom:"2px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:D=>{W||(D.currentTarget.style.backgroundColor=b.hoverBg,D.currentTarget.style.color=b.sidebarText)},onMouseLeave:D=>{W||(D.currentTarget.style.backgroundColor="transparent",D.currentTarget.style.color=b.sidebarText)},children:[i.jsx(O,{style:{width:"16px",height:"16px",flexShrink:0,color:W?b.primaryAccent:b.sidebarTextMuted}}),i.jsx("span",{style:{whiteSpace:"nowrap"},children:_.label})]},_.id)})})})]},j.id)})}),i.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${b.borderColorLight}`},children:x&&m?i.jsxs("div",{style:{marginBottom:"8px"},children:[!t&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"14px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),i.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[i.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:b.sidebarText,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.displayName||m.firstName||"Benutzer"}),m.email&&i.jsx("div",{style:{fontSize:"12px",color:b.sidebarText,opacity:.7,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.email})]})]}),i.jsxs("button",{onClick:w,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="transparent"},title:"Abmelden",children:[i.jsx(a0,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&i.jsx("span",{children:"Abmelden"})]})]}):i.jsxs("button",{onClick:o,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,cursor:"pointer",fontSize:"13px",fontWeight:500,transition:"all 0.2s",marginBottom:"8px"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="transparent"},title:"Anmelden",children:[i.jsx(Ga,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&i.jsx("span",{children:"Anmelden"})]})}),i.jsx("div",{style:{padding:"0 12px 12px 12px"},children:i.jsx("button",{onClick:e,style:{width:"100%",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"12px",justifyContent:t?"center":"flex-start",color:b.sidebarTextMuted,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=b.hoverBg,j.currentTarget.style.color=b.sidebarText},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="transparent",j.currentTarget.style.color=b.sidebarTextMuted},children:t?i.jsx(Et,{style:{width:"20px",height:"20px"}}):i.jsxs(i.Fragment,{children:[i.jsx(Oa,{style:{width:"20px",height:"20px"}}),i.jsx("span",{children:"Einklappen"})]})})})]})},SN=({activeView:t,onNavigate:e,headerOffset:n=0,onLoginClick:s})=>{const[r,o]=f.useState(!1),[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=qe(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=ll(),{showSuccess:v}=Ov(),k=Bv(c),S=f.useMemo(()=>{const j=Fv.filter(R=>{const I=R.moduleId||R.id;return p(I)});return g?[...j,...Wv]:j},[p,g]),w=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>k?{headerBg:k.sidebarBg,headerText:k.sidebarText,headerTextMuted:k.sidebarTextMuted,menuBg:"#ffffff",activeBg:k.sidebarActiveBg,activeText:k.sidebarActiveText,hoverBg:k.sidebarHoverBg,primaryAccent:k.primaryAccent,borderColor:k.borderColor,textMain:Fe.slate[700],textMuted:Fe.slate[400]}:{headerBg:"#ffffff",headerText:Fe.slate[900],headerTextMuted:Fe.slate[400],menuBg:"#ffffff",activeBg:Fe.blue[50],activeText:Fe.blue[700],hoverBg:Fe.slate[50],primaryAccent:Fe.blue[600],borderColor:Fe.slate[200],textMain:Fe.slate[700],textMuted:Fe.slate[400]},[k]),T=j=>{e(j),o(!1)},C=j=>{l(R=>R.includes(j)?R.filter(I=>I!==j):[...R,j])};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{position:"fixed",top:n,left:0,right:0,height:"56px",backgroundColor:b.headerBg,borderBottom:`1px solid ${b.borderColor}`,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",zIndex:50,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",transition:"top 0.15s ease-out"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[h?i.jsx("img",{src:h,alt:u,style:{width:"36px",height:"36px",borderRadius:"10px",objectFit:"contain"}}):i.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Fe.blue[600]} 0%, ${Fe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(To,{style:{width:"18px",height:"18px",color:"white"}})}),i.jsx("span",{style:{fontWeight:700,color:b.headerText,fontSize:"15px"},children:d?u:"Karriere Navigation"})]}),i.jsx("button",{onClick:()=>o(!r),style:{width:"56px",height:"56px",borderRadius:"12px",border:"none",backgroundColor:r?b.hoverBg:"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:r?i.jsx(Bt,{style:{width:"40px",height:"40px",color:b.headerText}}):i.jsx(sT,{style:{width:"40px",height:"40px",color:b.headerText}})})]}),i.jsx(Ve,{children:r&&i.jsxs(i.Fragment,{children:[i.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(!1),style:{position:"fixed",top:n+56,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:40}}),i.jsxs($.nav,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},style:{position:"fixed",top:n+56,left:0,right:0,backgroundColor:b.menuBg,zIndex:45,padding:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderBottomLeftRadius:"16px",borderBottomRightRadius:"16px",maxHeight:"70vh",overflowY:"auto"},children:[S.map(j=>{const R=j.icon,I=t===j.id||j.id==="dashboard"&&t==="roleplay"||j.id==="gym"&&t.startsWith("gym")||j.id==="admin"&&t.startsWith("admin"),A=j.subItems&&j.subItems.length>0,L=a.includes(j.id),B=j.adminOnly;return i.jsxs("div",{children:[B&&i.jsx("div",{style:{margin:"12px 8px",borderTop:`1px solid ${b.borderColor}`},children:i.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.textMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"8px"},children:"Admin"})}),i.jsxs("button",{onClick:()=>A?C(j.id):T(j.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:"none",backgroundColor:I?b.activeBg:"transparent",color:I?b.activeText:b.textMain,fontSize:"15px",fontWeight:I?600:500,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[i.jsx(R,{style:{width:"22px",height:"22px",color:I?b.primaryAccent:b.textMuted}}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{children:j.label}),i.jsx("div",{style:{fontSize:"12px",color:b.textMuted,fontWeight:400},children:j.description})]}),A&&i.jsx(bt,{style:{width:"18px",height:"18px",color:b.textMuted,transition:"transform 0.2s",transform:L?"rotate(180deg)":"rotate(0deg)"}})]}),A&&L&&i.jsx("div",{style:{marginLeft:"20px",marginBottom:"8px"},children:j.subItems.map(P=>{const _=P.icon,O=t===P.id;return i.jsxs("button",{onClick:()=>T(P.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",borderRadius:"10px",border:"none",backgroundColor:O?b.activeBg:"transparent",color:O?b.activeText:b.textMain,fontSize:"14px",fontWeight:O?600:400,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[i.jsx(_,{style:{width:"18px",height:"18px",color:O?b.primaryAccent:b.textMuted}}),i.jsx("span",{children:P.label})]},P.id)})})]},j.id)}),i.jsx("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${b.borderColor}`},children:x&&m?i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"16px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),i.jsxs("div",{style:{flex:1,minWidth:0},children:[i.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:b.textMain},children:m.displayName||m.firstName||"Benutzer"}),m.email&&i.jsx("div",{style:{fontSize:"13px",color:b.textMain,opacity:.7},children:m.email})]})]}),i.jsxs("button",{onClick:()=>{w(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:"none",backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:500,cursor:"pointer",textAlign:"left"},children:[i.jsx(a0,{style:{width:"20px",height:"20px"}}),i.jsx("span",{children:"Abmelden"})]})]}):i.jsxs("button",{onClick:()=>{s&&s(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:`1px solid ${b.borderColor}`,backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:600,cursor:"pointer",textAlign:"left"},children:[i.jsx(Ga,{style:{width:"20px",height:"20px"}}),i.jsx("span",{children:"Anmelden"})]})})]})]})})]})},kN=({children:t,activeView:e,onNavigate:n,headerOffset:s=0,onLoginClick:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),{branding:d}=qe(),u=f.useMemo(()=>{if(d){const p=d["--app-bg-start"]||"#f8fafc",m=d["--app-bg-mid"]||"#eff6ff",x=d["--app-bg-end"]||"#f0fdfa";return`linear-gradient(135deg, ${p} 0%, ${m} 50%, ${x} 100%)`}return"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)"},[d]);f.useEffect(()=>{const p=()=>{c(window.innerWidth<768)};p(),window.addEventListener("resize",p);const m=localStorage.getItem("sidebar-collapsed");return m!==null&&a(JSON.parse(m)),()=>window.removeEventListener("resize",p)},[]);const h=()=>{const p=!o;a(p),localStorage.setItem("sidebar-collapsed",JSON.stringify(p))};return l?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),i.jsxs("div",{style:{minHeight:s>0?`calc(100vh - ${s}px)`:"100vh"},children:[i.jsx(SN,{activeView:e,onNavigate:n,headerOffset:s,onLoginClick:r}),i.jsx("main",{"data-main-content":!0,style:{paddingTop:"56px",minHeight:s>0?`calc(100vh - ${s}px)`:"100vh"},children:t})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),i.jsxs("div",{style:{minHeight:s>0?`calc(100vh - ${s}px)`:"100vh"},children:[i.jsx(vN,{isCollapsed:o,onToggleCollapse:h,activeView:e,onNavigate:n,headerOffset:s,onLoginClick:r}),i.jsx($.main,{"data-main-content":!0,initial:!1,animate:{marginLeft:o?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{minHeight:s>0?`calc(100vh - ${s}px)`:"100vh"},children:t})]})]})};function wN({isOpen:t,onClose:e,onSuccess:n}){const{branding:s,partnerName:r,logoUrl:o}=qe(),[a,l]=f.useState(1),[c,d]=f.useState(""),[u,h]=f.useState(""),[p,m]=f.useState(""),[x,g]=f.useState(""),[y,v]=f.useState(""),[k,S]=f.useState(""),[w,b]=f.useState(!1),[T,C]=f.useState(""),[j,R]=f.useState(!1),[I,A]=f.useState(!1),L=s?.["--primary-accent"]||"#3A7FA7",B=s?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",P=s?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",_=s?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",O=s?.["--header-text"]||"#ffffff",W=s?.["--sidebar-text-color"]||"#ffffff",D=async z=>{if(z.preventDefault(),C(""),!c.trim()){C("Bitte geben Sie Ihren Demo-Code ein.");return}if(c.trim().length!==5){C("Der Demo-Code muss 5 Zeichen lang sein.");return}R(!0);try{const V=vn(),H=At(),Te=await(await fetch(`${V}/demo/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim()})})).json();if(!Te.valid){C("Der Demo-Code ist ungltig. Bitte berprfen Sie Ihre Eingabe.");return}Te.is_activated?(A(!0),n&&n(c.toUpperCase().trim())):l(2)}catch(V){console.error("[DEMO] Validation error:",V),C("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{R(!1)}},N=async z=>{if(z.preventDefault(),C(""),!u.trim()){C("Bitte geben Sie den Firmennamen ein.");return}if(!p.trim()){C("Bitte geben Sie den Namen des Ansprechpartners ein.");return}if(!y.trim()){C("Bitte geben Sie eine Kontakt-E-Mail ein.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)){C("Bitte geben Sie eine gltige E-Mail-Adresse ein.");return}if(!w){C("Bitte stimmen Sie den Datenschutzbestimmungen zu.");return}R(!0);try{const H=vn(),pe=At(),Le=await(await fetch(`${H}/demo/activate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":pe},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim(),company_name:u.trim(),contact_name:p.trim(),homepage:x.trim(),contact_email:y.trim(),phone:k.trim(),privacy_accepted:w})})).json();Le.success?(A(!0),n&&n(c.toUpperCase().trim())):C(Le.error?.message||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}catch(H){console.error("[DEMO] Activation error:",H),C("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{R(!1)}},F=()=>{I||(l(1),d(""),h(""),m(""),g(""),v(""),S(""),b(!1),C(""),e&&e())},ne=()=>{l(1),C("")},re=z=>{z.target===z.currentTarget&&F()};if(Cn.useEffect(()=>{const z=V=>{V.key==="Escape"&&t&&F()};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[t,I]),!t)return null;const Z={width:"100%",padding:"10px 14px",fontSize:"14px",border:"1px solid #e2e8f0",borderRadius:"10px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},ee={borderColor:L,boxShadow:`0 0 0 3px ${_}`,backgroundColor:"#ffffff"},se={display:"block",fontSize:"13px",fontWeight:"500",color:"#374151",marginBottom:"6px"};return i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:re,role:"dialog","aria-modal":"true","aria-labelledby":"demo-modal-title",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"px-6 py-5",style:{background:P,color:O},children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[a===2&&i.jsx("button",{onClick:ne,className:"p-1.5 rounded-lg transition-colors",style:{color:O,backgroundColor:"transparent"},onMouseEnter:z=>z.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:z=>z.target.style.backgroundColor="transparent","aria-label":"Zurck",children:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),i.jsx("h2",{id:"demo-modal-title",className:"text-xl font-semibold",style:{color:O},children:a===1?"Demo-Code eingeben":"Kontaktdaten"})]}),i.jsx("button",{onClick:F,className:"p-2 rounded-xl transition-colors",style:{color:O,backgroundColor:"transparent"},onMouseEnter:z=>z.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:z=>z.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o&&a===1&&i.jsx("div",{className:"mt-3 mb-1 flex justify-center",children:i.jsx("img",{src:o,alt:`${r} Logo`,style:{height:"4rem",maxWidth:"100%",objectFit:"contain"}})}),i.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[i.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:O,opacity:a>=1?1:.3}}),i.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:O,opacity:a>=2?1:.3}})]})]}),a===1&&i.jsxs("form",{onSubmit:D,className:"p-6 space-y-4",children:[i.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-700 text-sm",children:i.jsx("p",{children:"Willkommen zur Demo! Bitte geben Sie den Demo-Code ein, den Sie von uns erhalten haben."})}),T&&i.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[i.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),i.jsx("span",{children:T})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"demo-code",style:se,children:["Demo-Code ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"demo-code",value:c,onChange:z=>d(z.target.value.toUpperCase()),style:{...Z,fontFamily:"monospace",fontSize:"24px",fontWeight:"600",letterSpacing:"4px",textAlign:"center",padding:"16px 14px"},onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"XXXXX",maxLength:5,disabled:j,autoComplete:"off",autoFocus:!0})]}),i.jsx("button",{type:"submit",disabled:j,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:W,background:j?"#94a3b8":B,border:"none",borderRadius:"12px",cursor:j?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:j?.7:1,boxShadow:j?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:z=>{j||(z.target.style.transform="translateY(-1px)",z.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:z=>{z.target.style.transform="translateY(0)",z.target.style.boxShadow=j?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:j?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:W,animation:"spin 1s linear infinite"},children:[i.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i.jsx("span",{style:{color:W},children:"Wird berprft..."})]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:W,style:{width:"20px",height:"20px"},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),i.jsx("span",{style:{color:W},children:"Weiter"})]})}),i.jsxs("p",{className:"text-xs text-center text-gray-500 pt-2",children:["Haben Sie keinen Demo-Code? Kontaktieren Sie uns unter"," ",i.jsx("a",{href:"mailto:info@karriereheld.de",className:"underline",style:{color:L},children:"info@karriereheld.de"})]})]}),a===2&&i.jsxs("form",{onSubmit:N,className:"p-6 space-y-4",children:[i.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm",children:i.jsxs("p",{children:[i.jsx("strong",{children:"Code gltig!"})," Bitte geben Sie noch Ihre Kontaktdaten ein, um die Demo zu starten."]})}),T&&i.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[i.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),i.jsx("span",{children:T})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"company-name",style:se,children:["Firma ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"company-name",value:u,onChange:z=>h(z.target.value),style:Z,onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"Ihre Firma",disabled:j,autoComplete:"organization",autoFocus:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"contact-name",style:se,children:["Ansprechpartner ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"contact-name",value:p,onChange:z=>m(z.target.value),style:Z,onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"Ihr Name",disabled:j,autoComplete:"name"})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"contact-email",style:se,children:["E-Mail ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"email",id:"contact-email",value:y,onChange:z=>v(z.target.value),style:Z,onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"email@firma.de",disabled:j,autoComplete:"email"})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"homepage",style:se,children:["Homepage ",i.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),i.jsx("input",{type:"url",id:"homepage",value:x,onChange:z=>g(z.target.value),style:Z,onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"https://www.ihre-firma.de",disabled:j,autoComplete:"url"})]}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:"phone",style:se,children:["Telefon ",i.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),i.jsx("input",{type:"tel",id:"phone",value:k,onChange:z=>S(z.target.value),style:Z,onFocus:z=>Object.assign(z.target.style,ee),onBlur:z=>{z.target.style.borderColor="#e2e8f0",z.target.style.boxShadow="none"},placeholder:"+49 123 456789",disabled:j,autoComplete:"tel"})]}),i.jsxs("div",{className:"flex items-start gap-3 pt-2",children:[i.jsx("input",{type:"checkbox",id:"privacy-accepted",checked:w,onChange:z=>b(z.target.checked),className:"mt-1 w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:j,style:{accentColor:L}}),i.jsxs("label",{htmlFor:"privacy-accepted",className:"text-sm text-gray-600",children:["Ich stimme den"," ",i.jsx("a",{href:"/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-gray-900",style:{color:L},children:"Datenschutzbestimmungen"})," ","zu. ",i.jsx("span",{className:"text-red-500",children:"*"})]})]}),i.jsx("button",{type:"submit",disabled:j,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:W,background:j?"#94a3b8":B,border:"none",borderRadius:"12px",cursor:j?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:j?.7:1,boxShadow:j?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:z=>{j||(z.target.style.transform="translateY(-1px)",z.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:z=>{z.target.style.transform="translateY(0)",z.target.style.boxShadow=j?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:j?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:W,animation:"spin 1s linear infinite"},children:[i.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i.jsx("span",{style:{color:W},children:"Wird aktiviert..."})]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:W,style:{width:"20px",height:"20px"},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),i.jsx("span",{style:{color:W},children:"Demo starten"})]})})]})]})})}const CN="demo";function jN({isOpen:t,onClose:e,onLoginSuccess:n}){const{login:s,logout:r,branding:o,partnerName:a,logoUrl:l,setDemoCode:c}=qe(),[d,u]=f.useState(""),[h,p]=f.useState(""),[m,x]=f.useState(""),[g,y]=f.useState(!1),[v,k]=f.useState(!1),[S,w]=f.useState(null),b=o?.["--primary-accent"]||"#3A7FA7",T=o?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",C=o?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",j=o?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",R=o?.["--header-text"]||"#ffffff",I=o?.["--sidebar-text-color"]||"#ffffff",A=async D=>{if(D.preventDefault(),x(""),!d.trim()||!h.trim()){x("Bitte geben Sie Benutzername und Passwort ein.");return}y(!0);try{const N=await s(d,h);N.success?d.toLowerCase()===CN?(localStorage.setItem("bewerbungstrainer_demo_pending","true"),w(N.user),k(!0),p("")):(u(""),p(""),n&&n(N.user),e&&e()):x(N.error||"Login fehlgeschlagen. Bitte versuchen Sie es erneut.")}catch(N){console.error("Login error:",N),x("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{y(!1)}},L=D=>{localStorage.removeItem("bewerbungstrainer_demo_pending"),c&&c(D),u(""),p(""),k(!1),n&&S&&n(S),e&&e()},B=async()=>{localStorage.removeItem("bewerbungstrainer_demo_pending");try{r&&await r()}catch(D){console.error("[LOGIN] Error logging out demo user:",D)}k(!1),w(null),u(""),p("")},P=()=>{x(""),u(""),p(""),e&&e()},_=D=>{D.target===D.currentTarget&&P()};if(Cn.useEffect(()=>{const D=N=>{N.key==="Escape"&&t&&P()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[t]),!t)return null;const O={width:"100%",padding:"12px 16px",fontSize:"15px",border:"1px solid #e2e8f0",borderRadius:"12px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},W={borderColor:b,boxShadow:`0 0 0 3px ${j}`,backgroundColor:"#ffffff"};return i.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:_,role:"dialog","aria-modal":"true","aria-labelledby":"login-modal-title",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[i.jsxs("div",{className:"px-6 py-5",style:{background:C,color:R},children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{id:"login-modal-title",className:"text-xl font-semibold",style:{color:R},children:"Anmelden"}),i.jsx("button",{onClick:P,className:"p-2 rounded-xl transition-colors",style:{color:R,backgroundColor:"transparent"},onMouseEnter:D=>D.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:D=>D.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:i.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l&&i.jsx("div",{className:"mt-4 mb-2 flex justify-center",children:i.jsx("img",{src:l,alt:`${a} Logo`,style:{height:"8.5rem",maxWidth:"100%",objectFit:"contain"}})}),i.jsxs("p",{className:"text-sm mt-1",style:{color:R,opacity:.8},children:["Bei ",a," anmelden"]})]}),i.jsxs("form",{onSubmit:A,className:"p-6 space-y-5",children:[m&&i.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[i.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),i.jsx("span",{children:m})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"login-username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Benutzername oder E-Mail"}),i.jsx("input",{type:"text",id:"login-username",value:d,onChange:D=>u(D.target.value),style:O,onFocus:D=>Object.assign(D.target.style,W),onBlur:D=>{D.target.style.borderColor="#e2e8f0",D.target.style.boxShadow="none",D.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Benutzername",disabled:g,autoComplete:"username",autoFocus:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"login-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort"}),i.jsx("input",{type:"password",id:"login-password",value:h,onChange:D=>p(D.target.value),style:O,onFocus:D=>Object.assign(D.target.style,W),onBlur:D=>{D.target.style.borderColor="#e2e8f0",D.target.style.boxShadow="none",D.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Passwort",disabled:g,autoComplete:"current-password"})]}),i.jsx("button",{type:"submit",disabled:g,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:I,background:g?"#94a3b8":T,border:"none",borderRadius:"12px",cursor:g?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:g?.7:1,boxShadow:g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:D=>{g||(D.target.style.transform="translateY(-1px)",D.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:D=>{D.target.style.transform="translateY(0)",D.target.style.boxShadow=g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:g?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:I,animation:"spin 1s linear infinite"},children:[i.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i.jsx("span",{style:{color:I,fontSize:"16px",fontWeight:600},children:"Wird angemeldet..."})]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:I,style:{width:"20px",height:"20px"},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),i.jsx("span",{style:{color:I,fontSize:"16px",fontWeight:600},children:"Anmelden"})]})}),i.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:"Verwenden Sie Ihre WordPress-Zugangsdaten zur Anmeldung."})]})]}),i.jsx(wN,{isOpen:v,onClose:B,onSuccess:L})]})}function TN({isOpen:t,onClose:e,onAcknowledge:n}){const{branding:s,partnerName:r}=qe(),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),[h,p]=f.useState(""),m=s?.["--primary-accent"]||"#3A7FA7",x=s?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",g=s?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",y=s?.["--header-text"]||"#ffffff",v=s?.["--sidebar-text-color"]||"#ffffff";f.useEffect(()=>{t&&k()},[t]);const k=async()=>{try{const T=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",j=await(await fetch(`${T}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();j.success&&j.disclaimer&&c(j.disclaimer)}catch(T){console.error("[DISCLAIMER] Error fetching status:",T),p("Fehler beim Laden des Hinweises")}},S=async()=>{if(l){u(!0),p("");try{const T=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",j=await(await fetch(`${T}/disclaimer/acknowledge`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin",body:JSON.stringify({disclaimer_id:l.id,dont_show_again:o})})).json();j.success?(n&&n(o),e&&e()):p(j.message||"Fehler bei der Besttigung")}catch(T){console.error("[DISCLAIMER] Error acknowledging:",T),p("Ein Fehler ist aufgetreten")}finally{u(!1)}}},w=T=>{T.stopPropagation()};if(f.useEffect(()=>{const T=C=>{C.key==="Escape"&&t&&C.preventDefault()};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[t]),!t||!l)return null;const b=T=>T?T.split(`
`).map((C,j)=>C.trim()?i.jsx("p",{className:"mb-3 last:mb-0",children:C},j):null):null;return i.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",style:{zIndex:99999},onClick:w,role:"dialog","aria-modal":"true","aria-labelledby":"disclaimer-modal-title",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full flex flex-col",style:{maxHeight:"min(85vh, 600px)",maxWidth:"520px",width:"100%"},children:[i.jsx("div",{className:"px-4 sm:px-6 py-4 flex-shrink-0 rounded-t-2xl",style:{background:g,color:y},children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-xl hidden sm:flex",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:i.jsx(Bi,{className:"w-5 h-5",style:{color:y}})}),i.jsxs("div",{children:[i.jsx("h2",{id:"disclaimer-modal-title",className:"text-lg sm:text-xl font-semibold",style:{color:y},children:l.title}),i.jsxs("p",{className:"text-xs sm:text-sm mt-0.5",style:{color:y,opacity:.8},children:["Version ",l.version]})]})]})}),i.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto flex-1",children:[h&&i.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[i.jsx(xs,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),i.jsx("span",{children:h})]}),i.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4 overflow-y-auto",style:{maxHeight:"180px"},children:i.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:b(l.content)})}),i.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 p-3 sm:p-4 bg-blue-50 rounded-xl border border-blue-100 mb-4",children:[i.jsx(mn,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 flex-shrink-0 mt-0.5"}),i.jsxs("p",{className:"text-xs sm:text-sm text-blue-700",children:["Mit der Besttigung akzeptieren Sie diese Nutzungshinweise fr ",r,"."]})]}),i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group mb-4 sm:mb-5",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",checked:o,onChange:T=>a(T.target.checked),className:"sr-only"}),i.jsx("div",{className:"w-5 h-5 rounded border-2 transition-all flex items-center justify-center",style:{borderColor:o?m:"#cbd5e1",backgroundColor:o?m:"transparent"},children:o&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),i.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900 transition-colors",children:"Diesen Hinweis nicht mehr anzeigen"})]}),i.jsx("button",{onClick:S,disabled:d,style:{width:"100%",padding:"12px 20px",fontSize:"15px",fontWeight:600,color:v,background:d?"#94a3b8":x,border:"none",borderRadius:"12px",cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:d?.7:1,boxShadow:d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:T=>{d||(T.target.style.transform="translateY(-1px)",T.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:T=>{T.target.style.transform="translateY(0)",T.target.style.boxShadow=d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:d?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"18px",height:"18px",color:v,animation:"spin 1s linear infinite"},children:[i.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Wird gespeichert..."})]}):i.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Verstanden"})}),i.jsx("p",{className:"text-xs text-center text-gray-500 mt-3",children:o?"Sie werden diesen Hinweis bei zuknftigen Anmeldungen nicht mehr sehen.":"Dieser Hinweis wird bei jeder Anmeldung angezeigt."})]})]}),i.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]})}function EN(){const[t,e]=f.useState(!1),[n,s]=f.useState(!1),[r,o]=f.useState(!1);return{isOpen:t,needsDisclaimer:n,isChecking:r,openDisclaimerModal:()=>e(!0),closeDisclaimerModal:()=>{e(!1),s(!1)},checkDisclaimerStatus:async()=>{o(!0);try{const d=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",h=await(await fetch(`${d}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();if(h.success){const p=h.needs_acknowledgment;return s(p),p&&e(!0),p}return!1}catch(d){return console.error("[DISCLAIMER] Error checking status:",d),!1}finally{o(!1)}}}}const te={HOME:"/",OVERVIEW:"/uebersicht",LIVE_TRAINING:"/live-training",LIVE_TRAINING_SETUP:"/live-training/vorbereitung",LIVE_TRAINING_DEVICES:"/live-training/geraete",LIVE_TRAINING_SESSION:"/live-training/session",LIVE_TRAINING_PROXY:"/live-training/session-proxy",SCENARIO_TRAINING:"/szenario-training",VIDEO_TRAINING:"/wirkungs-analyse",SMART_BRIEFING:"/smart-briefing",DECISION_BOARD:"/entscheidungs-kompass",IKIGAI:"/ikigai-kompass",RHETORIK_GYM:"/rhetorik-gym",RHETORIK_GYM_SESSION:"/rhetorik-gym/session",HISTORY:"/verlauf",SESSION_DETAIL:"/verlauf/:sessionType/:sessionId",USAGE_LIMITS:"/nutzung",ADMIN:"/admin",ADMIN_ROLEPLAYS:"/admin/szenarien",ADMIN_SIMULATOR:"/admin/simulator",ADMIN_VIDEO:"/admin/video",ADMIN_PARTNERS:"/admin/partner"},IN={overview:te.OVERVIEW,dashboard:te.LIVE_TRAINING,roleplay_variables:te.LIVE_TRAINING_SETUP,roleplay_device_setup:te.LIVE_TRAINING_DEVICES,roleplay:te.LIVE_TRAINING_SESSION,roleplay_proxy:te.LIVE_TRAINING_PROXY,simulator:te.SCENARIO_TRAINING,video_training:te.VIDEO_TRAINING,smart_briefing:te.SMART_BRIEFING,decision_board:te.DECISION_BOARD,ikigai:te.IKIGAI,history:te.HISTORY,session_detail:te.SESSION_DETAIL,usage_limits:te.USAGE_LIMITS,gym:te.RHETORIK_GYM,gym_klassiker:te.RHETORIK_GYM,gym_session:te.RHETORIK_GYM_SESSION,admin:te.ADMIN,admin_roleplays:te.ADMIN_ROLEPLAYS,admin_simulator:te.ADMIN_SIMULATOR,admin_video:te.ADMIN_VIDEO,admin_partners:te.ADMIN_PARTNERS},dm={[te.HOME]:"overview",[te.OVERVIEW]:"overview",[te.LIVE_TRAINING]:"dashboard",[te.LIVE_TRAINING_SETUP]:"dashboard",[te.LIVE_TRAINING_DEVICES]:"dashboard",[te.LIVE_TRAINING_SESSION]:"dashboard",[te.LIVE_TRAINING_PROXY]:"dashboard",[te.SCENARIO_TRAINING]:"simulator",[te.VIDEO_TRAINING]:"video_training",[te.SMART_BRIEFING]:"smart_briefing",[te.DECISION_BOARD]:"decision_board",[te.IKIGAI]:"ikigai",[te.RHETORIK_GYM]:"gym_klassiker",[te.RHETORIK_GYM_SESSION]:"gym_klassiker",[te.HISTORY]:"history",[te.USAGE_LIMITS]:"usage_limits",[te.ADMIN]:"admin",[te.ADMIN_ROLEPLAYS]:"admin_roleplays",[te.ADMIN_SIMULATOR]:"admin_simulator",[te.ADMIN_VIDEO]:"admin_video",[te.ADMIN_PARTNERS]:"admin_partners"};function RN(t){return dm[t]?dm[t]:t.startsWith("/verlauf/")?"history":"overview"}function AN({onNavigate:t}){const e=[{id:"admin_roleplays",title:"Live-Simulationen",description:"Verwalten Sie Szenarien fr Live-Voice-Interviews mit KI-Gesprchspartnern.",icon:Ze,color:"text-blue-600",bgColor:"bg-blue-50",stats:null},{id:"admin_simulator",title:"Szenario-Training",description:"Konfigurieren Sie strukturierte Trainingsszenarien mit Fragen und Feedback.",icon:rt,color:"text-green-600",bgColor:"bg-green-50",stats:null},{id:"admin_video",title:"Wirkungs-Analyse",description:"Verwalten Sie Video-basierte Wirkungs-Analysen und bungen.",icon:jt,color:"text-purple-600",bgColor:"bg-purple-50",stats:null},{id:"admin_partners",title:"Partner-Branding",description:"White-Label Partner verwalten: Farben, Logos und Modul-Zugriff.",icon:wn,color:"text-orange-600",bgColor:"bg-orange-50",stats:null}];return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[i.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 shadow-lg",children:i.jsx(Bi,{className:"w-8 h-8 text-white"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-[var(--text-main)]",children:"Administration"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:"Verwalten Sie Szenarien, Trainings und Partner-Konfigurationen"})]})]}),i.jsx(it,{className:"border-blue-200 bg-blue-50/50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:i.jsx(di,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-blue-900",children:"Admin-Bereich"}),i.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Dieser Bereich ist nur fr WordPress-Administratoren sichtbar. Hier knnen Sie alle Inhalte und Konfigurationen der Plattform verwalten."})]})]})})}),i.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.map(n=>i.jsx(it,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-[var(--primary-accent)] group",onClick:()=>t(n.id),children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:`p-3 rounded-xl ${n.bgColor} transition-transform group-hover:scale-110`,children:i.jsx(n.icon,{className:`w-6 h-6 ${n.color}`})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-[var(--text-main)] group-hover:text-[var(--primary-accent)] transition-colors",children:n.title}),i.jsx("p",{className:"text-sm text-[var(--text-secondary)] mt-1",children:n.description})]})]}),i.jsx(Et,{className:"w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--primary-accent)] group-hover:translate-x-1 transition-all"})]})})},n.id))}),i.jsxs(it,{children:[i.jsxs(Nr,{children:[i.jsx(zr,{className:"text-lg",children:"Schnellaktionen"}),i.jsx(Rv,{children:"Hufig verwendete Admin-Funktionen"})]}),i.jsx(pt,{children:i.jsxs("div",{className:"flex flex-wrap gap-3",children:[i.jsxs(de,{variant:"outline",onClick:()=>t("admin_roleplays"),className:"flex items-center gap-2",children:[i.jsx(Ze,{className:"w-4 h-4"}),"Neues Roleplay erstellen"]}),i.jsxs(de,{variant:"outline",onClick:()=>t("admin_partners"),className:"flex items-center gap-2",children:[i.jsx(wn,{className:"w-4 h-4"}),"Neuen Partner anlegen"]})]})})]})]})}function Is({title:t,subtitle:e,icon:n,accentColor:s="blue",children:r,defaultExpanded:o=!1,badge:a}){const[l,c]=f.useState(o),[d,u]=f.useState(!1),h={blue:{headerBg:"#e0f2fe",headerBgHover:"#bae6fd",iconBg:"#ffffff",iconText:"#0284c7",titleText:"#075985"},green:{headerBg:"#d1fae5",headerBgHover:"#a7f3d0",iconBg:"#ffffff",iconText:"#059669",titleText:"#065f46"},purple:{headerBg:"#ede9fe",headerBgHover:"#ddd6fe",iconBg:"#ffffff",iconText:"#7c3aed",titleText:"#5b21b6"},orange:{headerBg:"#fef3c7",headerBgHover:"#fde68a",iconBg:"#ffffff",iconText:"#d97706",titleText:"#92400e"},teal:{headerBg:"#ccfbf1",headerBgHover:"#99f6e4",iconBg:"#ffffff",iconText:"#0d9488",titleText:"#115e59"}},p=h[s]||h.blue,m={width:"100%",display:"block",backgroundColor:"#ffffff",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",marginBottom:"0"},x={width:"100%",display:"block",backgroundColor:d?p.headerBgHover:p.headerBg,transition:"background-color 0.2s ease",border:"none",margin:0,padding:0},g={width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",textAlign:"left",cursor:"pointer",border:"none",background:"none",backgroundColor:"transparent",margin:0,outline:"none",fontFamily:"inherit"},y={width:"36px",height:"36px",minWidth:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:p.iconBg,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},v={flex:1,minWidth:0,overflow:"hidden"},k={fontWeight:600,fontSize:"14px",lineHeight:"1.4",display:"block",color:p.titleText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",margin:0,padding:0},S={fontSize:"12px",lineHeight:"1.4",color:"#64748b",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginTop:"2px",padding:0},w={fontSize:"12px",fontWeight:500,color:"#64748b",backgroundColor:"rgba(255,255,255,0.9)",padding:"4px 10px",borderRadius:"9999px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},b={padding:"12px 16px 16px 16px",borderTop:"1px solid #f1f5f9",backgroundColor:"rgba(248, 250, 252, 0.5)"};return i.jsxs($.div,{style:m,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[i.jsx("div",{style:x,children:i.jsxs("button",{type:"button",onClick:()=>c(!l),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:g,children:[n&&i.jsx("div",{style:y,children:i.jsx(n,{style:{width:"20px",height:"20px",color:p.iconText}})}),i.jsxs("div",{style:v,children:[i.jsx("span",{style:k,children:t}),e&&i.jsx("span",{style:S,children:e})]}),a&&i.jsx("span",{style:w,children:a})]})}),i.jsx(Ve,{children:l&&i.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:i.jsx("div",{style:b,children:r})})})]})}function $v({children:t,className:e}){const n={display:"flex",flexDirection:"column",gap:"12px",width:"100%"};return i.jsx("div",{style:n,className:e,children:t})}function _N({onBack:t}){const[e,n]=f.useState([]),[s,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,k]=f.useState(!1),[S,w]=f.useState({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),[b,T]=f.useState(null);f.useEffect(()=>{C()},[]);const C=async()=>{try{r(!0),a(null);const F=await ce.adminGetRoleplayScenarios();if(F.success)n(F.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(F){a(F.message),j("error","Fehler beim Laden der Szenarien")}finally{r(!1)}},j=(F,ne)=>{T({type:F,message:ne}),setTimeout(()=>T(null),4e3)},R=()=>{w({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),u(!0)},I=F=>{y(F),w({title:F.title||"",description:F.description||"",agent_id:F.agent_id||"",initial_message:F.initial_message||"",difficulty:F.difficulty||"medium",status:F.status||"draft",coaching_hints:F.coaching_hints||"",interviewer_profile:{name:F.interviewer_profile?.name||"",role:F.interviewer_profile?.role||"",properties:F.interviewer_profile?.properties||""}}),p(!0)},A=F=>{y(F),x(!0)},L=async()=>{if(!S.title.trim()){j("error","Bitte geben Sie einen Titel ein");return}try{if(k(!0),(await ce.adminCreateRoleplayScenario(S)).success)j("success","Szenario erfolgreich erstellt"),u(!1),C();else throw new Error("Fehler beim Erstellen")}catch(F){j("error",F.message)}finally{k(!1)}},B=async()=>{if(!S.title.trim()){j("error","Bitte geben Sie einen Titel ein");return}try{if(k(!0),(await ce.adminUpdateRoleplayScenario(g.id,S)).success)j("success","Szenario erfolgreich aktualisiert"),p(!1),C();else throw new Error("Fehler beim Aktualisieren")}catch(F){j("error",F.message)}finally{k(!1)}},P=async()=>{try{if(k(!0),(await ce.adminDeleteRoleplayScenario(g.id)).success)j("success","Szenario erfolgreich gelscht"),x(!1),C();else throw new Error("Fehler beim Lschen")}catch(F){j("error",F.message)}finally{k(!1)}},_=e.filter(F=>F.title?.toLowerCase().includes(l.toLowerCase())||F.description?.toLowerCase().includes(l.toLowerCase())),O=F=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[F]||F,W=F=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[F]||"bg-gray-100 text-gray-700",D=F=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[F]||F,N=F=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[F]||"bg-gray-100 text-gray-700";return i.jsxs("div",{className:"space-y-6",children:[b&&i.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?i.jsx(Jt,{className:"w-5 h-5"}):i.jsx(Ie,{className:"w-5 h-5"}),b.message,i.jsx("button",{onClick:()=>T(null),className:"ml-2 hover:opacity-80",children:i.jsx(Bt,{className:"w-4 h-4"})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(de,{variant:"ghost",onClick:t,className:"p-2",children:i.jsx(ft,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:i.jsx(Ze,{className:"w-6 h-6 text-blue-600"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Live-Simulationen (Roleplays)"}),i.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]}),i.jsxs(de,{onClick:R,className:"flex items-center gap-2",children:[i.jsx(Yt,{className:"w-4 h-4"}),"Neues Szenario"]})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),i.jsx(kn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:F=>c(F.target.value),className:"pl-10"})]}),s&&i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(me,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!s&&i.jsx(it,{className:"border-red-200 bg-red-50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[i.jsx(Ie,{className:"w-5 h-5"}),i.jsx("p",{children:o}),i.jsx(de,{variant:"outline",size:"sm",onClick:C,children:"Erneut versuchen"})]})})}),!s&&!o&&i.jsx("div",{className:"space-y-3",children:_.length===0?i.jsx(it,{children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx(Ze,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&i.jsx(de,{onClick:R,className:"mt-4",children:"Erstes Szenario erstellen"})]})})}):_.map(F=>i.jsx(it,{className:"hover:shadow-md transition-shadow",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:F.title}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${N(F.status)}`,children:D(F.status)}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${W(F.difficulty)}`,children:O(F.difficulty)})]}),F.description&&i.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:F.description}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[F.agent_id&&i.jsxs("span",{children:["Agent: ",F.agent_id.substring(0,12),"..."]}),i.jsxs("span",{children:["ID: ",F.id]})]})]}),i.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>I(F),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:i.jsx(Iu,{className:"w-4 h-4"})}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>A(F),className:"text-[var(--text-secondary)] hover:text-red-600",children:i.jsx(We,{className:"w-4 h-4"})})]})]})})},F.id))}),i.jsx(ii,{open:d,onOpenChange:u,children:i.jsxs(si,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Neues Szenario erstellen"}),i.jsx(Pi,{children:"Erstellen Sie ein neues Roleplay-Szenario fr Live-Simulationen."})]}),i.jsx(um,{formData:S,setFormData:w}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),i.jsxs(de,{onClick:L,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),i.jsx(ii,{open:h,onOpenChange:p,children:i.jsxs(si,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Szenario bearbeiten"}),i.jsx(Pi,{children:"Bearbeiten Sie das ausgewhlte Roleplay-Szenario."})]}),i.jsx(um,{formData:S,setFormData:w}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),i.jsxs(de,{onClick:B,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),i.jsx(ii,{open:m,onOpenChange:x,children:i.jsxs(si,{children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Szenario lschen"}),i.jsxs(Pi,{children:['Sind Sie sicher, dass Sie das Szenario "',g?.title,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),i.jsxs(de,{variant:"destructive",onClick:P,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function um({formData:t,setFormData:e}){return i.jsxs($v,{children:[i.jsx(Is,{title:"Grundinformationen",subtitle:"Titel, Beschreibung und Basiseinstellungen",icon:zt,accentColor:"blue",defaultExpanded:!0,children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Titel ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx(kn,{value:t.title,onChange:n=>e({...t,title:n.target.value}),placeholder:"z.B. Vorstellungsgesprch IT-Consultant"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),i.jsx(Ri,{value:t.description,onChange:n=>e({...t,description:n.target.value}),placeholder:"Kurze Beschreibung des Szenarios...",rows:3})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),i.jsxs("select",{value:t.status,onChange:n=>e({...t,status:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[i.jsx("option",{value:"draft",children:"Entwurf"}),i.jsx("option",{value:"publish",children:"Verffentlicht"}),i.jsx("option",{value:"pending",children:"Ausstehend"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Schwierigkeit"}),i.jsxs("select",{value:t.difficulty,onChange:n=>e({...t,difficulty:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[i.jsx("option",{value:"easy",children:"Einfach"}),i.jsx("option",{value:"medium",children:"Mittel"}),i.jsx("option",{value:"hard",children:"Schwer"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"ElevenLabs Agent ID"}),i.jsx(kn,{value:t.agent_id,onChange:n=>e({...t,agent_id:n.target.value}),placeholder:"agent_xxx..."}),i.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Die Agent ID aus Ihrem ElevenLabs Dashboard"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Erste Nachricht"}),i.jsx(Ri,{value:t.initial_message,onChange:n=>e({...t,initial_message:n.target.value}),placeholder:"Die erste Nachricht des KI-Gesprchspartners...",rows:3}),i.jsxs("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:["Platzhalter: ","{{user_name}}",", ","{{company_name}}",", ","{{position}}"]})]})]})}),i.jsx(Is,{title:"Gesprchspartner-Profil",subtitle:"Name, Rolle und Eigenschaften des KI-Interviewers",icon:Qt,accentColor:"teal",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),i.jsx(kn,{value:t.interviewer_profile.name,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,name:n.target.value}}),placeholder:"z.B. Dr. Maria Schmidt"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rolle/Position"}),i.jsx(kn,{value:t.interviewer_profile.role,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,role:n.target.value}}),placeholder:"z.B. HR-Leiterin"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Eigenschaften"}),i.jsx(Ri,{value:t.interviewer_profile.properties,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,properties:n.target.value}}),placeholder:"Charaktereigenschaften (eine pro Zeile)...",rows:3})]})]})}),i.jsx(Is,{title:"Erweiterte Einstellungen",subtitle:"Coaching-Hinweise und zustzliche Konfiguration",icon:di,accentColor:"purple",children:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Coaching-Hinweise"}),i.jsx(Ri,{value:t.coaching_hints,onChange:n=>e({...t,coaching_hints:n.target.value}),placeholder:"Tipps fr den Benutzer whrend des Gesprchs (eine pro Zeile)...",rows:4}),i.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Diese Hinweise werden im Live-Coaching-Panel angezeigt"})]})})})]})}function MN({onBack:t}){const[e,n]=f.useState([]),[s,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await ce.adminGetSimulatorScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),h=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,p=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(de,{variant:"ghost",onClick:t,className:"p-2",children:i.jsx(ft,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:i.jsx(rt,{className:"w-6 h-6 text-green-600"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Szenario-Training"}),i.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),i.jsx(it,{className:"border-blue-200 bg-blue-50/50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:i.jsx(mn,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),i.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Szenario-Training-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=simulator_scenario","_blank"),className:"flex items-center gap-2",children:[i.jsx(xr,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),i.jsxs("div",{className:"relative",children:[i.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),i.jsx(kn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),s&&i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(me,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!s&&i.jsx(it,{className:"border-red-200 bg-red-50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[i.jsx(Ie,{className:"w-5 h-5"}),i.jsx("p",{children:o}),i.jsx(de,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!s&&!o&&i.jsx("div",{className:"space-y-3",children:u.length===0?i.jsx(it,{children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx(rt,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&i.jsxs(de,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=simulator_scenario","_blank"),children:[i.jsx(xr,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>i.jsx(it,{className:"hover:shadow-md transition-shadow",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(g.status)}`,children:h(g.status)}),g.difficulty&&i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&i.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&i.jsxs("span",{children:["Kategorie: ",g.category]}),g.questions_count&&i.jsxs("span",{children:[g.questions_count," Fragen"]}),i.jsxs("span",{children:["ID: ",g.id]})]})]}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:i.jsx(xr,{className:"w-4 h-4"})})]})})},g.id))})]})}function PN({onBack:t}){const[e,n]=f.useState([]),[s,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await ce.adminGetVideoTrainingScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),h=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,p=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(de,{variant:"ghost",onClick:t,className:"p-2",children:i.jsx(ft,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:i.jsx(jt,{className:"w-6 h-6 text-purple-600"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Wirkungs-Analyse"}),i.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),i.jsx(it,{className:"border-blue-200 bg-blue-50/50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:i.jsx(mn,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),i.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Wirkungs-Analyse-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=video_training_scenario","_blank"),className:"flex items-center gap-2",children:[i.jsx(xr,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),i.jsxs("div",{className:"relative",children:[i.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),i.jsx(kn,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),s&&i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(me,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!s&&i.jsx(it,{className:"border-red-200 bg-red-50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[i.jsx(Ie,{className:"w-5 h-5"}),i.jsx("p",{children:o}),i.jsx(de,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!s&&!o&&i.jsx("div",{className:"space-y-3",children:u.length===0?i.jsx(it,{children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx(jt,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Wirkungs-Analyse-Szenarien vorhanden"}),!l&&i.jsxs(de,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=video_training_scenario","_blank"),children:[i.jsx(xr,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>i.jsx(it,{className:"hover:shadow-md transition-shadow",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(g.status)}`,children:h(g.status)}),g.difficulty&&i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&i.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&i.jsxs("span",{children:["Kategorie: ",g.category]}),i.jsxs("span",{children:["ID: ",g.id]})]})]}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:i.jsx(xr,{className:"w-4 h-4"})})]})})},g.id))})]})}const DN=[{id:"overview",label:"bersicht"},{id:"dashboard",label:"Dashboard"},{id:"roleplay",label:"Live-Simulation (Roleplay)"},{id:"simulator",label:"Szenario-Training (Simulator)"},{id:"video_training",label:"Wirkungs-Analyse"},{id:"gym",label:"Rhetorik-Gym (Game)"},{id:"history",label:"Verlauf / History"}],Gt={"--app-bg-start":"#f8fafc","--app-bg-mid":"#eff6ff","--app-bg-end":"#f0fdfa","--card-bg-color":"#ffffff","--sidebar-bg-color":"#ffffff","--sidebar-text-color":"#0f172a","--sidebar-text-muted":"#64748b","--sidebar-active-bg":"#E8F4F8","--sidebar-active-text":"#2D6485","--primary-accent":"#3A7FA7","--primary-accent-hover":"#2D6485","--button-solid":"#3A7FA7","--button-text":"#ffffff","--header-gradient-start":"#3A7FA7","--header-gradient-end":"#3DA389","--header-text":"#ffffff","--icon-primary":"#3A7FA7","--icon-secondary":"#3DA389","--icon-muted":"#94a3b8","--text-main":"#0f172a","--text-secondary":"#475569","--text-muted":"#94a3b8","--border-color":"#e2e8f0","--border-color-light":"#f1f5f9","--focus-ring":"rgba(58, 127, 167, 0.3)"},NN=[{id:"app",title:"App / Allgemein",subtitle:"Hintergrundfarben der Anwendung",accentColor:"blue",iconName:"Layout",fields:[{key:"--app-bg-start",label:"App Hintergrund (Start)",type:"color"},{key:"--app-bg-mid",label:"App Hintergrund (Mitte)",type:"color"},{key:"--app-bg-end",label:"App Hintergrund (Ende)",type:"color"},{key:"--card-bg-color",label:"Karten Hintergrund",type:"color"}]},{id:"sidebar",title:"Sidebar",subtitle:"Farben der Seitennavigation",accentColor:"teal",iconName:"PanelLeft",fields:[{key:"--sidebar-bg-color",label:"Sidebar Hintergrund",type:"color"},{key:"--sidebar-text-color",label:"Sidebar Text",type:"color"},{key:"--sidebar-text-muted",label:"Sidebar Text (gedmpft)",type:"color"},{key:"--sidebar-active-bg",label:"Sidebar Aktiv Hintergrund",type:"color"},{key:"--sidebar-active-text",label:"Sidebar Aktiv Text",type:"color"}]},{id:"accent",title:"Akzentfarben",subtitle:"Primre Markenfarben",accentColor:"purple",iconName:"Sparkles",fields:[{key:"--primary-accent",label:"Primrfarbe",type:"color"},{key:"--primary-accent-hover",label:"Primrfarbe (Hover)",type:"color"}]},{id:"buttons",title:"Buttons",subtitle:"Schaltflchenfarben",accentColor:"green",iconName:"Square",fields:[{key:"--button-solid",label:"Button Farbe",type:"color"},{key:"--button-text",label:"Button Text",type:"color"}]},{id:"header",title:"Header",subtitle:"Kopfzeilenfarben",accentColor:"orange",iconName:"PanelTop",fields:[{key:"--header-gradient-start",label:"Header Gradient (Start)",type:"color"},{key:"--header-gradient-end",label:"Header Gradient (Ende)",type:"color"},{key:"--header-text",label:"Header Text",type:"color"}]},{id:"icons",title:"Icons",subtitle:"Symbolfarben",accentColor:"blue",iconName:"Shapes",fields:[{key:"--icon-primary",label:"Icon Primr",type:"color"},{key:"--icon-secondary",label:"Icon Sekundr",type:"color"},{key:"--icon-muted",label:"Icon (gedmpft)",type:"color"}]},{id:"text",title:"Text",subtitle:"Textfarben",accentColor:"teal",iconName:"Type",fields:[{key:"--text-main",label:"Text Hauptfarbe",type:"color"},{key:"--text-secondary",label:"Text Sekundr",type:"color"},{key:"--text-muted",label:"Text (gedmpft)",type:"color"}]},{id:"borders",title:"Rahmen & Focus",subtitle:"Rahmen- und Fokusfarben",accentColor:"purple",iconName:"Frame",fields:[{key:"--border-color",label:"Rahmenfarbe",type:"color"},{key:"--border-color-light",label:"Rahmenfarbe (hell)",type:"color"},{key:"--focus-ring",label:"Focus Ring",type:"color"}]}],zN={Layout:dT,PanelLeft:lT,Sparkles:st,Square:zs,PanelTop:cT,Shapes:fT,Type:bT,Frame:Yj};function LN({onBack:t}){const[e,n]=f.useState([]),[s,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,k]=f.useState(!1),[S,w]=f.useState({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Gt}}),[b,T]=f.useState(null);f.useEffect(()=>{C()},[]);const C=async()=>{try{r(!0),a(null);const N=await ce.adminGetPartners();if(N.success)n(N.data||[]);else throw new Error("Fehler beim Laden der Partner")}catch(N){a(N.message),j("error","Fehler beim Laden der Partner")}finally{r(!1)}},j=(N,F)=>{T({type:N,message:F}),setTimeout(()=>T(null),4e3)},R=()=>{w({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Gt}}),u(!0)},I=N=>{y(N),w({name:N.name||"",slug:N.slug||"",description:N.description||"",status:N.status||"draft",modules:N.modules||[],branding:{...Gt,...N.branding}}),p(!0)},A=N=>{y(N),x(!0)},L=async()=>{if(!S.name.trim()){j("error","Bitte geben Sie einen Namen ein");return}const N={...S,slug:S.slug||S.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")};try{if(k(!0),(await ce.adminCreatePartner(N)).success)j("success","Partner erfolgreich erstellt"),u(!1),C();else throw new Error("Fehler beim Erstellen")}catch(F){j("error",F.message)}finally{k(!1)}},B=async()=>{if(!S.name.trim()){j("error","Bitte geben Sie einen Namen ein");return}try{if(k(!0),(await ce.adminUpdatePartner(g.id,S)).success)j("success","Partner erfolgreich aktualisiert"),p(!1),C();else throw new Error("Fehler beim Aktualisieren")}catch(N){j("error",N.message)}finally{k(!1)}},P=async()=>{try{if(k(!0),(await ce.adminDeletePartner(g.id)).success)j("success","Partner erfolgreich gelscht"),x(!1),C();else throw new Error("Fehler beim Lschen")}catch(N){j("error",N.message)}finally{k(!1)}},_=N=>{const F=`${window.location.origin}${window.location.pathname}?partner=${N}`;navigator.clipboard.writeText(F),j("success","URL in Zwischenablage kopiert")},O=e.filter(N=>N.name?.toLowerCase().includes(l.toLowerCase())||N.slug?.toLowerCase().includes(l.toLowerCase())),W=N=>({publish:"Aktiv",draft:"Entwurf",pending:"Ausstehend"})[N]||N,D=N=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[N]||"bg-gray-100 text-gray-700";return i.jsxs("div",{className:"space-y-6",children:[b&&i.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?i.jsx(Jt,{className:"w-5 h-5"}):i.jsx(Ie,{className:"w-5 h-5"}),b.message,i.jsx("button",{onClick:()=>T(null),className:"ml-2 hover:opacity-80",children:i.jsx(Bt,{className:"w-4 h-4"})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(de,{variant:"ghost",onClick:t,className:"p-2",children:i.jsx(ft,{className:"w-5 h-5"})}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-orange-100",children:i.jsx(wn,{className:"w-6 h-6 text-orange-600"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Partner-Branding"}),i.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Partner"]})]})]})]}),i.jsxs(de,{onClick:R,className:"flex items-center gap-2",children:[i.jsx(Yt,{className:"w-4 h-4"}),"Neuer Partner"]})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),i.jsx(kn,{placeholder:"Partner durchsuchen...",value:l,onChange:N=>c(N.target.value),className:"pl-10"})]}),s&&i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(me,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!s&&i.jsx(it,{className:"border-red-200 bg-red-50",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[i.jsx(Ie,{className:"w-5 h-5"}),i.jsx("p",{children:o}),i.jsx(de,{variant:"outline",size:"sm",onClick:C,children:"Erneut versuchen"})]})})}),!s&&!o&&i.jsx("div",{className:"space-y-3",children:O.length===0?i.jsx(it,{children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx(wn,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Partner gefunden":"Noch keine Partner vorhanden"}),!l&&i.jsx(de,{onClick:R,className:"mt-4",children:"Ersten Partner erstellen"})]})})}):O.map(N=>i.jsx(it,{className:"hover:shadow-md transition-shadow",children:i.jsx(pt,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-8 h-8 rounded-lg border shadow-sm",style:{background:N.branding?.["--primary-accent"]||Gt["--primary-accent"]}}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:N.name}),i.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D(N.status)}`,children:W(N.status)})]}),i.jsxs("p",{className:"text-sm text-[var(--text-muted)]",children:["Slug: ",N.slug]})]})]}),N.description&&i.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-1",children:N.description}),i.jsx("div",{className:"flex items-center gap-2 text-xs text-[var(--text-muted)]",children:N.modules?.length>0?i.jsxs("span",{children:[N.modules.length," Module aktiv"]}):i.jsx("span",{children:"Alle Module aktiv"})})]}),i.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>_(N.slug),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"URL kopieren",children:i.jsx(rd,{className:"w-4 h-4"})}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>I(N),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:i.jsx(Iu,{className:"w-4 h-4"})}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>A(N),className:"text-[var(--text-secondary)] hover:text-red-600",children:i.jsx(We,{className:"w-4 h-4"})})]})]})})},N.id))}),i.jsx(ii,{open:d,onOpenChange:u,children:i.jsxs(si,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Neuen Partner erstellen"}),i.jsx(Pi,{children:"Erstellen Sie einen neuen White-Label Partner mit eigenem Branding."})]}),i.jsx(hm,{formData:S,setFormData:w}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),i.jsxs(de,{onClick:L,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),i.jsx(ii,{open:h,onOpenChange:p,children:i.jsxs(si,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Partner bearbeiten"}),i.jsx(Pi,{children:"Bearbeiten Sie die Konfiguration des ausgewhlten Partners."})]}),i.jsx(hm,{formData:S,setFormData:w}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),i.jsxs(de,{onClick:B,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),i.jsx(ii,{open:m,onOpenChange:x,children:i.jsxs(si,{children:[i.jsxs(ri,{children:[i.jsx(oi,{children:"Partner lschen"}),i.jsxs(Pi,{children:['Sind Sie sicher, dass Sie den Partner "',g?.name,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),i.jsxs(Mi,{children:[i.jsx(de,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),i.jsxs(de,{variant:"destructive",onClick:P,disabled:v,children:[v&&i.jsx(me,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function ON({label:t,value:e,defaultValue:n,onChange:s}){const o=e?.startsWith("rgba")||n?.startsWith("rgba")?"#3A7FA7":e||n||"#000000";return i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600",children:t}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"color",value:o,onChange:a=>s(a.target.value),className:"w-10 h-8 rounded border cursor-pointer"}),i.jsx(kn,{value:e||"",onChange:a=>s(a.target.value),placeholder:n,className:"flex-1 text-xs"})]})]})}function BN({branding:t}){const e=t?.["--app-bg-start"]||Gt["--app-bg-start"],n=t?.["--app-bg-mid"]||Gt["--app-bg-mid"],s=t?.["--app-bg-end"]||Gt["--app-bg-end"],r=t?.["--card-bg-color"]||Gt["--card-bg-color"],o=t?.["--header-gradient-start"]||Gt["--header-gradient-start"],a=t?.["--header-gradient-end"]||Gt["--header-gradient-end"],l=t?.["--header-text"]||Gt["--header-text"],c=t?.["--text-main"]||Gt["--text-main"],d=t?.["--text-secondary"]||Gt["--text-secondary"],u=t?.["--button-solid"]||Gt["--button-solid"],h=t?.["--button-text"]||Gt["--button-text"],p=t?.["--border-color"]||Gt["--border-color"];return i.jsxs("div",{className:"rounded-lg p-4 mb-4",style:{background:`linear-gradient(135deg, ${e} 0%, ${n} 50%, ${s} 100%)`},children:[i.jsx("div",{className:"rounded-t-lg px-3 py-2 mb-2",style:{background:`linear-gradient(135deg, ${o} 0%, ${a} 100%)`},children:i.jsx("span",{className:"text-xs font-medium",style:{color:l},children:"Header Vorschau"})}),i.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:r,border:`1px solid ${p}`},children:[i.jsx("p",{className:"text-sm font-medium mb-1",style:{color:c},children:"Karten-Titel"}),i.jsx("p",{className:"text-xs mb-3",style:{color:d},children:"Sekundrer Text"}),i.jsx("button",{type:"button",className:"px-3 py-1.5 rounded text-xs font-medium",style:{backgroundColor:u,color:h},children:"Button"})]})]})}function hm({formData:t,setFormData:e}){const n=r=>{const o=t.modules||[];o.includes(r)?e({...t,modules:o.filter(a=>a!==r)}):e({...t,modules:[...o,r]})},s=(r,o)=>{e({...t,branding:{...t.branding,[r]:o}})};return i.jsxs($v,{children:[i.jsx(Is,{title:"Grundinformationen",subtitle:"Name, Slug und Status des Partners",icon:zt,accentColor:"blue",defaultExpanded:!0,children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Name ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx(kn,{value:t.name,onChange:r=>e({...t,name:r.target.value}),placeholder:"z.B. Vertriebsakademie Mller"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Slug (URL-ID)"}),i.jsx(kn,{value:t.slug,onChange:r=>e({...t,slug:r.target.value.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}),placeholder:"z.B. vertriebsakademie-mueller"}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Wird in der URL verwendet: ?partner=",t.slug||"ihr-slug"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),i.jsx(Ri,{value:t.description,onChange:r=>e({...t,description:r.target.value}),placeholder:"Optionale Beschreibung des Partners...",rows:2})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),i.jsxs("select",{value:t.status,onChange:r=>e({...t,status:r.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[i.jsx("option",{value:"draft",children:"Entwurf"}),i.jsx("option",{value:"publish",children:"Aktiv"}),i.jsx("option",{value:"pending",children:"Ausstehend"})]})]})]})}),i.jsx(Is,{title:"Erlaubte Module",subtitle:"Welche Funktionen fr diesen Partner verfgbar sind",icon:Qj,accentColor:"green",badge:t.modules?.length>0?`${t.modules.length} ausgewhlt`:"Alle",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Keine Auswahl = Alle Module sind erlaubt"}),i.jsx("div",{className:"space-y-2",children:DN.map(r=>i.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 cursor-pointer transition-colors",children:[i.jsx("input",{type:"checkbox",checked:t.modules?.includes(r.id)||!1,onChange:()=>n(r.id),className:"rounded border-gray-300"}),i.jsx("span",{className:"text-sm",children:r.label})]},r.id))})]})}),i.jsxs(Is,{title:"Branding Vorschau",subtitle:"Live-Vorschau der konfigurierten Farben",icon:aT,accentColor:"orange",defaultExpanded:!0,children:[i.jsx(BN,{branding:t.branding}),i.jsx("p",{className:"text-xs text-slate-500 text-center",children:"ndern Sie die Farben in den Sektionen unten"})]}),NN.map(r=>{const o=zN[r.iconName];return i.jsx(Is,{title:r.title,subtitle:r.subtitle,icon:o,accentColor:r.accentColor,children:i.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.fields.map(a=>i.jsx(ON,{label:a.label,value:t.branding?.[a.key],defaultValue:Gt[a.key],onChange:l=>s(a.key,l)},a.key))})},r.id)})]})}const FN=()=>i.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)",zIndex:9999},children:[i.jsx("div",{style:{position:"absolute",top:"20%",left:"10%",width:"300px",height:"300px",borderRadius:"50%",background:"radial-gradient(circle, rgba(56, 189, 248, 0.1) 0%, transparent 70%)",animation:"float 6s ease-in-out infinite"}}),i.jsx("div",{style:{position:"absolute",bottom:"20%",right:"10%",width:"400px",height:"400px",borderRadius:"50%",background:"radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%)",animation:"float 8s ease-in-out infinite reverse"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"32px",zIndex:1},children:[i.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"24px",background:"linear-gradient(135deg, #38bdf8 0%, #818cf8 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 20px 40px rgba(56, 189, 248, 0.3)",animation:"pulse 2s ease-in-out infinite"},children:i.jsxs("svg",{width:"44",height:"44",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),i.jsx("path",{d:"M2 17l10 5 10-5"}),i.jsx("path",{d:"M2 12l10 5 10-5"})]})}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"white",margin:0,letterSpacing:"-0.02em"},children:"Karriereheld"}),i.jsx("p",{style:{fontSize:"15px",color:"rgba(255, 255, 255, 0.6)",margin:"8px 0 0 0",fontWeight:400},children:"wird geladen..."})]}),i.jsx("div",{style:{width:"200px",height:"4px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"2px",overflow:"hidden"},children:i.jsx("div",{style:{width:"40%",height:"100%",background:"linear-gradient(90deg, #38bdf8, #818cf8, #38bdf8)",backgroundSize:"200% 100%",borderRadius:"2px",animation:"loading 1.5s ease-in-out infinite"}})})]}),i.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
          }
          @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
          }
          @keyframes loading {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(150%); }
            100% { transform: translateX(400%); }
          }
        `})]}),pm=()=>{requestAnimationFrame(()=>{window.scrollTo(0,0);const t=document.getElementById("bewerbungstrainer-app");t&&(t.scrollTop=0);const e=document.querySelector("[data-main-content]");e&&(e.scrollTop=0),document.querySelectorAll('.overflow-y-auto, .overflow-auto, [style*="overflow"]').forEach(s=>{s.scrollTop>0&&(s.scrollTop=0)})})};function WN(){const t=document.body.classList.contains("admin-bar")||document.documentElement.classList.contains("admin-bar"),e=document.getElementById("wpadminbar");if(e){const n=e.getBoundingClientRect(),s=window.getComputedStyle(e);return!(s.display!=="none"&&s.visibility!=="hidden")||n.bottom<=0?0:n.top<0?Math.max(0,n.bottom):e.offsetHeight}return t?window.innerWidth<=782?46:32:0}function $N(){const t=document.getElementById("bewerbungstrainer-app"),e=WN(),n=document.elementFromPoint(window.innerWidth/2,e+10);if(n){let r=n;for(;r&&r!==document.body;){const o=r.tagName?.toLowerCase();if((o==="header"||o==="nav"||r.classList?.contains("site-header")||r.classList?.contains("elementor-location-header")||r.id==="masthead")&&(!t||!t.contains(r))){const c=r.getBoundingClientRect().bottom;return c<=e?e:Math.max(e,c)}r=r.parentElement}}const s=["header.site-header","#masthead",".site-header",".elementor-location-header",'[data-elementor-type="header"]',".ast-header-wrap","#starter-header",".header-wrapper","header"];for(const r of s){const o=document.querySelector(r);if(o&&(!t||!t.contains(o))){const l=o.getBoundingClientRect().bottom;return l<=e?e:Math.max(e,l)}}if(t){let r=t.previousElementSibling;for(;r;){const o=r.getBoundingClientRect();if(o.height>30&&o.top<100){const a=o.bottom;return a<=e?e:Math.max(e,a)}r=r.previousElementSibling}}return e}function UN(){const t=F1(),e=Hd(),{isAuthenticated:n,authLoading:s,isLoading:r,demoCode:o}=qe(),{isAdmin:a}=ll(),l=RN(e.pathname),[c,d]=f.useState(0),[u,h]=f.useState(null),[p,m]=f.useState({}),[x,g]=f.useState(null),[y,v]=f.useState("websocket"),[k,S]=f.useState(null),[w,b]=f.useState(null),[T,C]=f.useState(null),[j,R]=f.useState(!1),I=()=>R(!0),A=()=>R(!1),{isOpen:L,closeDisclaimerModal:B,checkDisclaimerStatus:P}=EN(),[_,O]=f.useState(null),[W,D]=f.useState(null),[N,F]=f.useState(null),[ne,re]=f.useState(null),[Z,ee]=f.useState(null),[se,z]=f.useState(null),[V,H]=f.useState(null),[pe,Te]=f.useState(0);f.useEffect(()=>{n&&!s&&P()},[n,s]);const Le=f.useCallback(Q=>{if(Q)switch(Q.type){case"SELECT_ROLEPLAY_SCENARIO":D(Q.scenario),t(te.LIVE_TRAINING);break;case"SELECT_SIMULATOR_SCENARIO":F(Q.scenario),t(te.SCENARIO_TRAINING);break;case"START_GYM_GAME":C(Q.config),t(te.RHETORIK_GYM_SESSION,{state:{gameConfig:Q.config}});break;case"SELECT_GYM_MODE":re(Q.mode),t(te.RHETORIK_GYM);break;case"SELECT_VIDEO_TRAINING_SCENARIO":ee(Q.scenario),t(te.VIDEO_TRAINING);break;default:console.warn("Unknown pending action type:",Q.type)}},[t]),we=f.useCallback((Q,Pe=null)=>n?(Q(),!0):(Pe&&O(Pe),I(),!1),[n]);f.useEffect(()=>{const Q=()=>{const vt=$N();d(vt)},Pe=(vt=0)=>{Q(),vt<5&&setTimeout(()=>Pe(vt+1),200)};requestAnimationFrame(()=>{setTimeout(()=>Pe(),50)});const Je=()=>setTimeout(Q,100);return window.addEventListener("load",Je),window.addEventListener("resize",Q),window.addEventListener("scroll",Q,{passive:!0}),()=>{window.removeEventListener("load",Je),window.removeEventListener("resize",Q),window.removeEventListener("scroll",Q)}},[]),f.useEffect(()=>{pm()},[e.pathname]);const Qe=f.useCallback(Q=>{pm(),Q==="video_training"&&Te(Je=>Je+1);const Pe=IN[Q];t(Pe||te.OVERVIEW)},[t]),ye=f.useCallback(Q=>{h(Q),m({}),g(null),t(te.LIVE_TRAINING_SETUP,{state:{scenario:Q}})},[t]),Ee=f.useCallback(Q=>{m(Q),t(te.LIVE_TRAINING_DEVICES,{state:{scenario:u,variables:Q}})},[t,u]),Ke=f.useCallback(()=>{h(null),m({}),t(te.LIVE_TRAINING)},[t]),Me=f.useCallback(({selectedMicrophoneId:Q,connectionMode:Pe="websocket"})=>{g(Q),v(Pe);const Je=Pe==="proxy"?te.LIVE_TRAINING_PROXY:te.LIVE_TRAINING_SESSION;t(Je,{state:{scenario:u,variables:p,microphoneId:Q}})},[t,u,p]),et=f.useCallback(()=>{g(null),t(te.LIVE_TRAINING_SETUP,{state:{scenario:u}})},[t,u]),X=f.useCallback(()=>{h(null),m({}),t(te.LIVE_TRAINING)},[t]),he=f.useCallback(Q=>{h(null),m({}),S(Q),t(`/verlauf/${Q.type||"roleplay"}/${Q.id}`,{state:{session:Q}})},[t]),be=f.useCallback((Q=null)=>{b(Q),t(te.HISTORY,{state:{initialTab:Q}})},[t]),ue=f.useCallback(()=>{b(null),t(te.LIVE_TRAINING)},[t]),gt=f.useCallback(Q=>{const Je={briefings:ha.BRIEFINGS,simulator:ha.SIMULATOR,video:ha.VIDEO,roleplay:ha.ROLEPLAY}[Q]||null;b(Je),t(te.HISTORY,{state:{initialTab:Je}})},[t]),lt=f.useCallback(Q=>{S(Q),t(`/verlauf/${Q.type||"roleplay"}/${Q.id}`,{state:{session:Q}})},[t]),je=f.useCallback(()=>{S(null),t(te.HISTORY)},[t]),fe=f.useCallback((Q,Pe)=>{z({session:Q,scenario:Pe}),t(te.SCENARIO_TRAINING)},[t]),oe=f.useCallback((Q,Pe,Je)=>{const vt=Je||Q?.type;vt==="roleplay"?(Pe&&D(Pe),t(te.LIVE_TRAINING)):vt==="video"?(Pe&&ee(Pe),t(te.VIDEO_TRAINING)):(H({session:Q,scenario:Pe}),t(te.SCENARIO_TRAINING))},[t]),xe=f.useCallback(Q=>{C(Q),t(te.RHETORIK_GYM_SESSION,{state:{gameConfig:Q}})},[t]),tt=f.useCallback(()=>{C(null),t(te.RHETORIK_GYM)},[t]),cn=f.useCallback(Q=>{},[]),Ft=f.useCallback(({children:Q})=>a?Q:i.jsx(ea,{onNavigate:Qe}),[a,Qe]);if(r)return i.jsx(FN,{});const en=()=>e.state?.scenario||u,Wi=()=>e.state?.variables||p,mi=()=>e.state?.microphoneId||x,$i=()=>e.state?.gameConfig||T,vs=()=>e.state?.session||k,Ur=()=>e.state?.initialTab||w,Vr=()=>i.jsxs(iS,{children:[i.jsx(ct,{path:"/",element:i.jsx(ea,{onNavigate:Qe})}),i.jsx(ct,{path:te.OVERVIEW,element:i.jsx(ea,{onNavigate:Qe})}),i.jsx(ct,{path:te.LIVE_TRAINING,element:i.jsx(eR,{onSelectScenario:ye,onOpenHistory:be,isAuthenticated:n,requireAuth:we,setPendingAction:O,pendingScenario:W,clearPendingScenario:()=>D(null),onNavigateToHistory:()=>gt("roleplay")})}),i.jsx(ct,{path:te.LIVE_TRAINING_SETUP,element:i.jsx(bR,{scenario:en(),onBack:Ke,onNext:Ee})}),i.jsx(ct,{path:te.LIVE_TRAINING_DEVICES,element:i.jsx(fR,{scenario:en(),onBack:et,onStart:Me})}),i.jsx(ct,{path:te.LIVE_TRAINING_SESSION,element:i.jsx(Vg,{scenario:en(),variables:Wi(),selectedMicrophoneId:mi(),connectionMode:Qn.DIRECT,onEnd:X,onNavigateToSession:he})}),i.jsx(ct,{path:te.LIVE_TRAINING_PROXY,element:i.jsx(Vg,{scenario:en(),variables:Wi(),selectedMicrophoneId:mi(),connectionMode:Qn.PROXY,onEnd:X,onNavigateToSession:he})}),i.jsx(ct,{path:te.SCENARIO_TRAINING,element:i.jsx(vD,{isAuthenticated:n,requireAuth:we,setPendingAction:O,pendingContinueSession:se,clearPendingContinueSession:()=>z(null),pendingRepeatSession:V,clearPendingRepeatSession:()=>H(null),onNavigateToHistory:()=>gt("simulator")})}),i.jsx(ct,{path:te.VIDEO_TRAINING,element:i.jsx(OD,{isAuthenticated:n,requireAuth:we,setPendingAction:O,pendingScenario:Z,clearPendingScenario:()=>ee(null),onNavigateToHistory:()=>gt("video")},pe)}),i.jsx(ct,{path:te.SMART_BRIEFING,element:i.jsx(pN,{isAuthenticated:n,requireAuth:we,setPendingAction:O,demoCode:o,onNavigateToSimulator:()=>t(te.SCENARIO_TRAINING),onNavigateToHistory:()=>gt("briefings")})}),i.jsx(ct,{path:te.DECISION_BOARD,element:i.jsx(fN,{isAuthenticated:n,requireAuth:we,setPendingAction:O})}),i.jsx(ct,{path:te.IKIGAI,element:i.jsx(gN,{isAuthenticated:n,requireAuth:we,setPendingAction:O,onNavigateToHistory:()=>t(te.HISTORY)})}),i.jsx(ct,{path:te.RHETORIK_GYM,element:i.jsx(FD,{onStartGame:xe,isAuthenticated:n,requireAuth:we,setPendingAction:O})}),i.jsx(ct,{path:te.RHETORIK_GYM_SESSION,element:i.jsx(KD,{gameConfig:$i(),onBack:tt,onComplete:cn})}),i.jsx(ct,{path:te.HISTORY,element:i.jsx(sD,{onBack:ue,onSelectSession:lt,isAuthenticated:n,onLoginClick:I,onContinueSession:fe,onRepeatSession:oe,initialTab:Ur(),onNavigateToModule:Qe})}),i.jsx(ct,{path:"/verlauf/:sessionType/:sessionId",element:i.jsx(rD,{session:vs(),onBack:je,onRepeatSession:oe})}),i.jsx(ct,{path:te.USAGE_LIMITS,element:i.jsx("div",{style:{padding:"24px",maxWidth:"600px",margin:"0 auto"},children:i.jsx(mN,{onNavigateToRoleplay:()=>t(te.LIVE_TRAINING)})})}),i.jsx(ct,{path:te.ADMIN,element:i.jsx(Ft,{children:i.jsx("div",{style:{padding:"24px"},children:i.jsx(AN,{onNavigate:Qe})})})}),i.jsx(ct,{path:te.ADMIN_ROLEPLAYS,element:i.jsx(Ft,{children:i.jsx("div",{style:{padding:"24px"},children:i.jsx(_N,{onBack:()=>t(te.ADMIN)})})})}),i.jsx(ct,{path:te.ADMIN_SIMULATOR,element:i.jsx(Ft,{children:i.jsx("div",{style:{padding:"24px"},children:i.jsx(MN,{onBack:()=>t(te.ADMIN)})})})}),i.jsx(ct,{path:te.ADMIN_VIDEO,element:i.jsx(Ft,{children:i.jsx("div",{style:{padding:"24px"},children:i.jsx(PN,{onBack:()=>t(te.ADMIN)})})})}),i.jsx(ct,{path:te.ADMIN_PARTNERS,element:i.jsx(Ft,{children:i.jsx("div",{style:{padding:"24px"},children:i.jsx(LN,{onBack:()=>t(te.ADMIN)})})})}),i.jsx(ct,{path:"*",element:i.jsx(ea,{onNavigate:Qe})})]});return i.jsxs(i.Fragment,{children:[i.jsx(kN,{activeView:l,onNavigate:Qe,headerOffset:c,onLoginClick:I,children:Vr()}),i.jsx(jN,{isOpen:j,onClose:()=>{A(),O(null)},onLoginSuccess:async Q=>{await P(),_&&(Le(_),O(null))}}),i.jsx(TN,{isOpen:L,onClose:B,onAcknowledge:Q=>{B()}})]})}function VN(){return i.jsx(oS,{children:i.jsx(a1,{children:i.jsx(bN,{children:i.jsx(UN,{})})})})}let Dc=!1,Nc=null;function GN(){if(Dc)return;const t=document.getElementById("bewerbungstrainer-app")||document.getElementById("root");if(!t){console.error(" Bewerbungstrainer: Root element not found! Looking for #bewerbungstrainer-app or #root");return}if(t._reactRootContainer||t.__reactRoot||Nc){console.warn(" Bewerbungstrainer: Root element already has a React root, skipping re-mount..."),Dc=!0;return}try{for(;t.firstChild;)t.removeChild(t.firstChild);Nc=l1.createRoot(t),Nc.render(i.jsx(f.StrictMode,{children:i.jsx(VN,{})})),Dc=!0}catch(e){console.error(" Bewerbungstrainer: Failed to mount React app:",e)}}function HN(){const t=()=>{requestAnimationFrame(()=>{try{GN()}catch(e){console.error(" Bewerbungstrainer: Error during mount:",e)}})};if(document.getElementById("bewerbungstrainer-app")||document.getElementById("root")){setTimeout(t,50);return}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>setTimeout(t,50));else{let e=0;const n=50,s=setInterval(()=>{e++,document.getElementById("bewerbungstrainer-app")||document.getElementById("root")?(clearInterval(s),setTimeout(t,50)):e>=n&&(clearInterval(s),console.error(" Bewerbungstrainer: Element not found after 5 seconds"))},100)}}HN();
