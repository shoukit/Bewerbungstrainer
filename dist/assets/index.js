import{r as Sv,g as kv,a as f,R as Ed,j as s,c as Z,u as Ue,b as As,L as he,S as St,C as wn,D as Ie,T as ko,d as dn,V as bt,w as ue,e as fn,f as wt,M as ts,U as mn,B as Tn,h as Cv,i as wv,I as jv,Z as Tv,k as Ev,l as Rv,F as Iv,m as Av,n as _v,o as Mv,p as Pv,q as R,s as Fe,t as Ut,v as pt,x as qt,y as Ne,z as ce,A as Zt,E as Si,G as nn,H as ni,J as Nv,K as Ji,N as Qr,O as Kt,P as ah,Q as Rd,W as Dv,X as zv}from"./button-JmETjNQh.js";var Id=Sv();const Ov=kv(Id);function eo(){return eo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},eo.apply(this,arguments)}var Ui;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ui||(Ui={}));const lh="popstate";function Lv(t){t===void 0&&(t={});function e(r,o){let{pathname:a="/",search:l="",hash:c=""}=_s(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),yc("",{pathname:a,search:l,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){let a=r.document.querySelector("base"),l="";if(a&&a.getAttribute("href")){let c=r.location.href,d=c.indexOf("#");l=d===-1?c:c.slice(0,d)}return l+"#"+(typeof o=="string"?o:Qg(o))}function i(r,o){Ha(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return Fv(e,n,i,t)}function It(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ha(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Bv(){return Math.random().toString(36).substr(2,8)}function ch(t,e){return{usr:t.state,key:t.key,idx:e}}function yc(t,e,n,i){return n===void 0&&(n=null),eo({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?_s(e):e,{state:n,key:e&&e.key||i||Bv()})}function Qg(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function _s(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function Fv(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:o=!1}=i,a=r.history,l=Ui.Pop,c=null,d=u();d==null&&(d=0,a.replaceState(eo({},a.state,{idx:d}),""));function u(){return(a.state||{idx:null}).idx}function h(){l=Ui.Pop;let y=u(),v=y==null?null:y-d;d=y,c&&c({action:l,location:g.location,delta:v})}function p(y,v){l=Ui.Push;let k=yc(g.location,y,v);n&&n(k,y),d=u()+1;let S=ch(k,d),C=g.createHref(k);try{a.pushState(S,"",C)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;r.location.assign(C)}o&&c&&c({action:l,location:g.location,delta:1})}function m(y,v){l=Ui.Replace;let k=yc(g.location,y,v);n&&n(k,y),d=u();let S=ch(k,d),C=g.createHref(k);a.replaceState(S,"",C),o&&c&&c({action:l,location:g.location,delta:0})}function x(y){let v=r.location.origin!=="null"?r.location.origin:r.location.href,k=typeof y=="string"?y:Qg(y);return k=k.replace(/ $/,"%20"),It(v,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,v)}let g={get action(){return l},get location(){return t(r,a)},listen(y){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(lh,h),c=y,()=>{r.removeEventListener(lh,h),c=null}},createHref(y){return e(r,y)},createURL:x,encodeLocation(y){let v=x(y);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:p,replace:m,go(y){return a.go(y)}};return g}var dh;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(dh||(dh={}));function Wv(t,e,n){return n===void 0&&(n="/"),Uv(t,e,n)}function Uv(t,e,n,i){let r=typeof e=="string"?_s(e):e,o=nm(r.pathname||"/",n);if(o==null)return null;let a=em(t);$v(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=t1(o);l=Zv(a[c],d)}return l}function em(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(o,a,l)=>{let c={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};c.relativePath.startsWith("/")&&(It(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let d=ms([i,c.relativePath]),u=n.concat(c);o.children&&o.children.length>0&&(It(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),em(o.children,e,u,d)),!(o.path==null&&!o.index)&&e.push({path:d,score:Yv(d,o.index),routesMeta:u})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))r(o,a);else for(let c of tm(o.path))r(o,a,c)}),e}function tm(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(i.length===0)return r?[o,""]:[o];let a=tm(i.join("/")),l=[];return l.push(...a.map(c=>c===""?o:[o,c].join("/"))),r&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function $v(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Xv(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const Vv=/^:[\w-]+$/,Gv=3,Hv=2,qv=1,Kv=10,Jv=-2,uh=t=>t==="*";function Yv(t,e){let n=t.split("/"),i=n.length;return n.some(uh)&&(i+=Jv),e&&(i+=Hv),n.filter(r=>!uh(r)).reduce((r,o)=>r+(Vv.test(o)?Gv:o===""?qv:Kv),i)}function Xv(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function Zv(t,e,n){let{routesMeta:i}=t,r={},o="/",a=[];for(let l=0;l<i.length;++l){let c=i[l],d=l===i.length-1,u=o==="/"?e:e.slice(o.length)||"/",h=Qv({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:ms([o,h.pathname]),pathnameBase:l1(ms([o,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(o=ms([o,h.pathnameBase]))}return a}function Qv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=e1(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let o=r[0],a=o.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:i.reduce((d,u,h)=>{let{paramName:p,isOptional:m}=u;if(p==="*"){let g=l[h]||"";a=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=l[h];return m&&!x?d[p]=void 0:d[p]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:a,pattern:t}}function e1(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Ha(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(i.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function t1(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ha(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function nm(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const n1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,i1=t=>n1.test(t);function s1(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?_s(t):t,o;if(n)if(i1(n))o=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),Ha(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+n))}n.startsWith("/")?o=hh(n.substring(1),"/"):o=hh(n,e)}else o=e;return{pathname:o,search:c1(i),hash:d1(r)}}function hh(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function bl(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function r1(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function o1(t,e){let n=r1(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function a1(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=_s(t):(r=eo({},t),It(!r.pathname||!r.pathname.includes("?"),bl("?","pathname","search",r)),It(!r.pathname||!r.pathname.includes("#"),bl("#","pathname","hash",r)),It(!r.search||!r.search.includes("#"),bl("#","search","hash",r)));let o=t===""||r.pathname==="",a=o?"/":r.pathname,l;if(a==null)l=n;else{let h=e.length-1;if(!i&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),h-=1;r.pathname=p.join("/")}l=h>=0?e[h]:"/"}let c=s1(r,l),d=a&&a!=="/"&&a.endsWith("/"),u=(o||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const ms=t=>t.join("/").replace(/\/\/+/g,"/"),l1=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),c1=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,d1=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function u1(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const im=["post","put","patch","delete"];new Set(im);const h1=["get",...im];new Set(h1);function to(){return to=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},to.apply(this,arguments)}const Ad=f.createContext(null),p1=f.createContext(null),qa=f.createContext(null),Ka=f.createContext(null),vr=f.createContext({outlet:null,matches:[],isDataRoute:!1}),sm=f.createContext(null);function Ja(){return f.useContext(Ka)!=null}function _d(){return Ja()||It(!1),f.useContext(Ka).location}function rm(t){f.useContext(qa).static||f.useLayoutEffect(t)}function f1(){let{isDataRoute:t}=f.useContext(vr);return t?E1():g1()}function g1(){Ja()||It(!1);let t=f.useContext(Ad),{basename:e,future:n,navigator:i}=f.useContext(qa),{matches:r}=f.useContext(vr),{pathname:o}=_d(),a=JSON.stringify(o1(r,n.v7_relativeSplatPath)),l=f.useRef(!1);return rm(()=>{l.current=!0}),f.useCallback(function(d,u){if(u===void 0&&(u={}),!l.current)return;if(typeof d=="number"){i.go(d);return}let h=a1(d,JSON.parse(a),o,u.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:ms([e,h.pathname])),(u.replace?i.replace:i.push)(h,u.state,u)},[e,i,a,o,t])}function m1(t,e){return x1(t,e)}function x1(t,e,n,i){Ja()||It(!1);let{navigator:r}=f.useContext(qa),{matches:o}=f.useContext(vr),a=o[o.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=_d(),u;if(e){var h;let y=typeof e=="string"?_s(e):e;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||It(!1),u=y}else u=d;let p=u.pathname||"/",m=p;if(c!=="/"){let y=c.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=Wv(t,{pathname:m}),g=k1(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:ms([c,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:ms([c,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,n,i);return e&&g?f.createElement(Ka.Provider,{value:{location:to({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ui.Pop}},g):g}function y1(){let t=T1(),e=u1(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},e),n?f.createElement("pre",{style:r},n):null,null)}const b1=f.createElement(y1,null);class v1 extends f.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?f.createElement(vr.Provider,{value:this.props.routeContext},f.createElement(sm.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function S1(t){let{routeContext:e,match:n,children:i}=t,r=f.useContext(Ad);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),f.createElement(vr.Provider,{value:e},i)}function k1(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=i)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,l=(r=n)==null?void 0:r.errors;if(l!=null){let u=a.findIndex(h=>h.route.id&&l?.[h.route.id]!==void 0);u>=0||It(!1),a=a.slice(0,Math.min(a.length,u+1))}let c=!1,d=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(d=u),h.route.id){let{loaderData:p,errors:m}=n,x=h.route.loader&&p[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||x){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((u,h,p)=>{let m,x=!1,g=null,y=null;n&&(m=l&&h.route.id?l[h.route.id]:void 0,g=h.route.errorElement||b1,c&&(d<0&&p===0?(R1("route-fallback"),x=!0,y=null):d===p&&(x=!0,y=h.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,p+1)),k=()=>{let S;return m?S=g:x?S=y:h.route.Component?S=f.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,f.createElement(S1,{match:h,routeContext:{outlet:u,matches:v,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?f.createElement(v1,{location:n.location,revalidation:n.revalidation,component:g,error:m,children:k(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):k()},null)}var om=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(om||{}),am=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(am||{});function C1(t){let e=f.useContext(Ad);return e||It(!1),e}function w1(t){let e=f.useContext(p1);return e||It(!1),e}function j1(t){let e=f.useContext(vr);return e||It(!1),e}function lm(t){let e=j1(),n=e.matches[e.matches.length-1];return n.route.id||It(!1),n.route.id}function T1(){var t;let e=f.useContext(sm),n=w1(),i=lm();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function E1(){let{router:t}=C1(om.UseNavigateStable),e=lm(am.UseNavigateStable),n=f.useRef(!1);return rm(()=>{n.current=!0}),f.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,to({fromRouteId:e},o)))},[t,e])}const ph={};function R1(t,e,n){ph[t]||(ph[t]=!0)}function I1(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function ut(t){It(!1)}function A1(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Ui.Pop,navigator:o,static:a=!1,future:l}=t;Ja()&&It(!1);let c=e.replace(/^\/*/,"/"),d=f.useMemo(()=>({basename:c,navigator:o,static:a,future:to({v7_relativeSplatPath:!1},l)}),[c,l,o,a]);typeof i=="string"&&(i=_s(i));let{pathname:u="/",search:h="",hash:p="",state:m=null,key:x="default"}=i,g=f.useMemo(()=>{let y=nm(u,c);return y==null?null:{location:{pathname:y,search:h,hash:p,state:m,key:x},navigationType:r}},[c,u,h,p,m,x,r]);return g==null?null:f.createElement(qa.Provider,{value:d},f.createElement(Ka.Provider,{children:n,value:g}))}function _1(t){let{children:e,location:n}=t;return m1(bc(e),n)}new Promise(()=>{});function bc(t,e){e===void 0&&(e=[]);let n=[];return f.Children.forEach(t,(i,r)=>{if(!f.isValidElement(i))return;let o=[...e,r];if(i.type===f.Fragment){n.push.apply(n,bc(i.props.children,o));return}i.type!==ut&&It(!1),!i.props.index||!i.props.children||It(!1);let a={id:i.props.id||o.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=bc(i.props.children,o)),n.push(a)}),n}const M1="6";try{window.__reactRouterVersion=M1}catch{}const P1="startTransition",fh=Ed[P1];function N1(t){let{basename:e,children:n,future:i,window:r}=t,o=f.useRef();o.current==null&&(o.current=Lv({window:r,v5Compat:!0}));let a=o.current,[l,c]=f.useState({action:a.action,location:a.location}),{v7_startTransition:d}=i||{},u=f.useCallback(h=>{d&&fh?fh(()=>c(h)):c(h)},[c,d]);return f.useLayoutEffect(()=>a.listen(u),[a,u]),f.useEffect(()=>I1(i),[i]),f.createElement(A1,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:a,future:i})}var gh;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(gh||(gh={}));var mh;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(mh||(mh={}));const Md=f.createContext({});function Pd(t){const e=f.useRef(null);return e.current===null&&(e.current=t()),e.current}const Nd=typeof window<"u",cm=Nd?f.useLayoutEffect:f.useEffect,Ya=f.createContext(null);function Dd(t,e){t.indexOf(e)===-1&&t.push(e)}function zd(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const ji=(t,e,n)=>n>e?e:n<t?t:n;let Od=()=>{};const Ti={},dm=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function um(t){return typeof t=="object"&&t!==null}const hm=t=>/^0[^.\s]+$/u.test(t);function Ld(t){let e;return()=>(e===void 0&&(e=t()),e)}const Cn=t=>t,D1=(t,e)=>n=>e(t(n)),Co=(...t)=>t.reduce(D1),no=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i};class Bd{constructor(){this.subscriptions=[]}add(e){return Dd(this.subscriptions,e),()=>zd(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Kn=t=>t*1e3,Sn=t=>t/1e3;function pm(t,e){return e?t*(1e3/e):0}const fm=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,z1=1e-7,O1=12;function L1(t,e,n,i,r){let o,a,l=0;do a=e+(n-e)/2,o=fm(a,i,r)-t,o>0?n=a:e=a;while(Math.abs(o)>z1&&++l<O1);return a}function wo(t,e,n,i){if(t===e&&n===i)return Cn;const r=o=>L1(o,0,1,t,n);return o=>o===0||o===1?o:fm(r(o),e,i)}const gm=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,mm=t=>e=>1-t(1-e),xm=wo(.33,1.53,.69,.99),Fd=mm(xm),ym=gm(Fd),bm=t=>(t*=2)<1?.5*Fd(t):.5*(2-Math.pow(2,-10*(t-1))),Wd=t=>1-Math.sin(Math.acos(t)),vm=mm(Wd),Sm=gm(Wd),B1=wo(.42,0,1,1),F1=wo(0,0,.58,1),km=wo(.42,0,.58,1),W1=t=>Array.isArray(t)&&typeof t[0]!="number",Cm=t=>Array.isArray(t)&&typeof t[0]=="number",U1={linear:Cn,easeIn:B1,easeInOut:km,easeOut:F1,circIn:Wd,circInOut:Sm,circOut:vm,backIn:Fd,backInOut:ym,backOut:xm,anticipate:bm},$1=t=>typeof t=="string",xh=t=>{if(Cm(t)){Od(t.length===4);const[e,n,i,r]=t;return wo(e,n,i,r)}else if($1(t))return U1[t];return t},Do=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function V1(t,e){let n=new Set,i=new Set,r=!1,o=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){a.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,h=!1,p=!1)=>{const x=p&&r?n:i;return h&&a.add(u),x.has(u)||x.add(u),u},cancel:u=>{i.delete(u),a.delete(u)},process:u=>{if(l=u,r){o=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,o&&(o=!1,d.process(u))}};return d}const G1=40;function wm(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Do.reduce((S,C)=>(S[C]=V1(o),S),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:x}=a,g=()=>{const S=Ti.useManualTiming?r.timestamp:performance.now();n=!1,Ti.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(S-r.timestamp,G1),1)),r.timestamp=S,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),h.process(r),p.process(r),m.process(r),x.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(g))},y=()=>{n=!0,i=!0,r.isProcessing||t(g)};return{schedule:Do.reduce((S,C)=>{const b=a[C];return S[C]=(j,w=!1,T=!1)=>(n||y(),b.schedule(j,w,T)),S},{}),cancel:S=>{for(let C=0;C<Do.length;C++)a[Do[C]].cancel(S)},state:r,steps:a}}const{schedule:lt,cancel:Yi,state:Bt,steps:vl}=wm(typeof requestAnimationFrame<"u"?requestAnimationFrame:Cn,!0);let ta;function H1(){ta=void 0}const an={now:()=>(ta===void 0&&an.set(Bt.isProcessing||Ti.useManualTiming?Bt.timestamp:performance.now()),ta),set:t=>{ta=t,queueMicrotask(H1)}},jm=t=>e=>typeof e=="string"&&e.startsWith(t),Ud=jm("--"),q1=jm("var(--"),$d=t=>q1(t)?K1.test(t.split("/*")[0].trim()):!1,K1=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Sr={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},io={...Sr,transform:t=>ji(0,1,t)},zo={...Sr,default:1},Ur=t=>Math.round(t*1e5)/1e5,Vd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function J1(t){return t==null}const Y1=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Gd=(t,e)=>n=>!!(typeof n=="string"&&Y1.test(n)&&n.startsWith(t)||e&&!J1(n)&&Object.prototype.hasOwnProperty.call(n,e)),Tm=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,o,a,l]=i.match(Vd);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},X1=t=>ji(0,255,t),Sl={...Sr,transform:t=>Math.round(X1(t))},ps={test:Gd("rgb","red"),parse:Tm("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+Sl.transform(t)+", "+Sl.transform(e)+", "+Sl.transform(n)+", "+Ur(io.transform(i))+")"};function Z1(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const vc={test:Gd("#"),parse:Z1,transform:ps.transform},jo=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),zi=jo("deg"),Jn=jo("%"),ye=jo("px"),Q1=jo("vh"),eS=jo("vw"),yh={...Jn,parse:t=>Jn.parse(t)/100,transform:t=>Jn.transform(t*100)},Hs={test:Gd("hsl","hue"),parse:Tm("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+Jn.transform(Ur(e))+", "+Jn.transform(Ur(n))+", "+Ur(io.transform(i))+")"},kt={test:t=>ps.test(t)||vc.test(t)||Hs.test(t),parse:t=>ps.test(t)?ps.parse(t):Hs.test(t)?Hs.parse(t):vc.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?ps.transform(t):Hs.transform(t),getAnimatableNone:t=>{const e=kt.parse(t);return e.alpha=0,kt.transform(e)}},tS=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function nS(t){return isNaN(t)&&typeof t=="string"&&(t.match(Vd)?.length||0)+(t.match(tS)?.length||0)>0}const Em="number",Rm="color",iS="var",sS="var(",bh="${}",rS=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function so(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const l=e.replace(rS,c=>(kt.test(c)?(i.color.push(o),r.push(Rm),n.push(kt.parse(c))):c.startsWith(sS)?(i.var.push(o),r.push(iS),n.push(c)):(i.number.push(o),r.push(Em),n.push(parseFloat(c))),++o,bh)).split(bh);return{values:n,split:l,indexes:i,types:r}}function Im(t){return so(t).values}function Am(t){const{split:e,types:n}=so(t),i=e.length;return r=>{let o="";for(let a=0;a<i;a++)if(o+=e[a],r[a]!==void 0){const l=n[a];l===Em?o+=Ur(r[a]):l===Rm?o+=kt.transform(r[a]):o+=r[a]}return o}}const oS=t=>typeof t=="number"?0:kt.test(t)?kt.getAnimatableNone(t):t;function aS(t){const e=Im(t);return Am(t)(e.map(oS))}const Xi={test:nS,parse:Im,createTransformer:Am,getAnimatableNone:aS};function kl(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function lS({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,o=0,a=0;if(!e)r=o=a=n;else{const l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=kl(c,l,t+1/3),o=kl(c,l,t),a=kl(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:i}}function Ca(t,e){return n=>n>0?e:t}const ht=(t,e,n)=>t+(e-t)*n,Cl=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},cS=[vc,ps,Hs],dS=t=>cS.find(e=>e.test(t));function vh(t){const e=dS(t);if(!e)return!1;let n=e.parse(t);return e===Hs&&(n=lS(n)),n}const Sh=(t,e)=>{const n=vh(t),i=vh(e);if(!n||!i)return Ca(t,e);const r={...n};return o=>(r.red=Cl(n.red,i.red,o),r.green=Cl(n.green,i.green,o),r.blue=Cl(n.blue,i.blue,o),r.alpha=ht(n.alpha,i.alpha,o),ps.transform(r))},Sc=new Set(["none","hidden"]);function uS(t,e){return Sc.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function hS(t,e){return n=>ht(t,e,n)}function Hd(t){return typeof t=="number"?hS:typeof t=="string"?$d(t)?Ca:kt.test(t)?Sh:gS:Array.isArray(t)?_m:typeof t=="object"?kt.test(t)?Sh:pS:Ca}function _m(t,e){const n=[...t],i=n.length,r=t.map((o,a)=>Hd(o)(o,e[a]));return o=>{for(let a=0;a<i;a++)n[a]=r[a](o);return n}}function pS(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=Hd(t[r])(t[r],e[r]));return r=>{for(const o in i)n[o]=i[o](r);return n}}function fS(t,e){const n=[],i={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const o=e.types[r],a=t.indexes[o][i[o]],l=t.values[a]??0;n[r]=l,i[o]++}return n}const gS=(t,e)=>{const n=Xi.createTransformer(e),i=so(t),r=so(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Sc.has(t)&&!r.values.length||Sc.has(e)&&!i.values.length?uS(t,e):Co(_m(fS(i,r),r.values),n):Ca(t,e)};function Mm(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ht(t,e,n):Hd(t)(t,e)}const mS=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>lt.update(e,n),stop:()=>Yi(e),now:()=>Bt.isProcessing?Bt.timestamp:an.now()}},Pm=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let o=0;o<r;o++)i+=Math.round(t(o/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},wa=2e4;function qd(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<wa;)e+=n,i=t.next(e);return e>=wa?1/0:e}function xS(t,e=100,n){const i=n({...t,keyframes:[0,e]}),r=Math.min(qd(i),wa);return{type:"keyframes",ease:o=>i.next(r*o).value/e,duration:Sn(r)}}const yS=5;function Nm(t,e,n){const i=Math.max(e-yS,0);return pm(n-t(i),e-i)}const ft={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},wl=.001;function bS({duration:t=ft.duration,bounce:e=ft.bounce,velocity:n=ft.velocity,mass:i=ft.mass}){let r,o,a=1-e;a=ji(ft.minDamping,ft.maxDamping,a),t=ji(ft.minDuration,ft.maxDuration,Sn(t)),a<1?(r=d=>{const u=d*a,h=u*t,p=u-n,m=kc(d,a),x=Math.exp(-h);return wl-p/m*x},o=d=>{const h=d*a*t,p=h*n+n,m=Math.pow(a,2)*Math.pow(d,2)*t,x=Math.exp(-h),g=kc(Math.pow(d,2),a);return(-r(d)+wl>0?-1:1)*((p-m)*x)/g}):(r=d=>{const u=Math.exp(-d*t),h=(d-n)*t+1;return-wl+u*h},o=d=>{const u=Math.exp(-d*t),h=(n-d)*(t*t);return u*h});const l=5/t,c=SS(r,o,l);if(t=Kn(t),isNaN(c))return{stiffness:ft.stiffness,damping:ft.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:a*2*Math.sqrt(i*d),duration:t}}}const vS=12;function SS(t,e,n){let i=n;for(let r=1;r<vS;r++)i=i-t(i)/e(i);return i}function kc(t,e){return t*Math.sqrt(1-e*e)}const kS=["duration","bounce"],CS=["stiffness","damping","mass"];function kh(t,e){return e.some(n=>t[n]!==void 0)}function wS(t){let e={velocity:ft.velocity,stiffness:ft.stiffness,damping:ft.damping,mass:ft.mass,isResolvedFromDuration:!1,...t};if(!kh(t,CS)&&kh(t,kS))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,o=2*ji(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:ft.mass,stiffness:r,damping:o}}else{const n=bS(t);e={...e,...n,mass:ft.mass},e.isResolvedFromDuration=!0}return e}function ja(t=ft.visualDuration,e=ft.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=wS({...n,velocity:-Sn(n.velocity||0)}),x=p||0,g=d/(2*Math.sqrt(c*u)),y=a-o,v=Sn(Math.sqrt(c/u)),k=Math.abs(y)<5;i||(i=k?ft.restSpeed.granular:ft.restSpeed.default),r||(r=k?ft.restDelta.granular:ft.restDelta.default);let S;if(g<1){const b=kc(v,g);S=j=>{const w=Math.exp(-g*v*j);return a-w*((x+g*v*y)/b*Math.sin(b*j)+y*Math.cos(b*j))}}else if(g===1)S=b=>a-Math.exp(-v*b)*(y+(x+v*y)*b);else{const b=v*Math.sqrt(g*g-1);S=j=>{const w=Math.exp(-g*v*j),T=Math.min(b*j,300);return a-w*((x+g*v*y)*Math.sinh(T)+b*y*Math.cosh(T))/b}}const C={calculatedDuration:m&&h||null,next:b=>{const j=S(b);if(m)l.done=b>=h;else{let w=b===0?x:0;g<1&&(w=b===0?Kn(x):Nm(S,b,j));const T=Math.abs(w)<=i,I=Math.abs(a-j)<=r;l.done=T&&I}return l.value=l.done?a:j,l},toString:()=>{const b=Math.min(qd(C),wa),j=Pm(w=>C.next(b*w).value,b,30);return b+"ms "+j},toTransition:()=>{}};return C}ja.applyToOptions=t=>{const e=xS(t,100,ja);return t.ease=e.ease,t.duration=Kn(e.duration),t.type="keyframes",t};function Cc({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=t[0],p={done:!1,value:h},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,x=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let g=n*e;const y=h+g,v=a===void 0?y:a(y);v!==y&&(g=v-h);const k=T=>-g*Math.exp(-T/i),S=T=>v+k(T),C=T=>{const I=k(T),E=S(T);p.done=Math.abs(I)<=d,p.value=p.done?v:E};let b,j;const w=T=>{m(p.value)&&(b=T,j=ja({keyframes:[p.value,x(p.value)],velocity:Nm(S,T,p.value),damping:r,stiffness:o,restDelta:d,restSpeed:u}))};return w(0),{calculatedDuration:null,next:T=>{let I=!1;return!j&&b===void 0&&(I=!0,C(T),w(T)),b!==void 0&&T>=b?j.next(T-b):(!I&&C(T),p)}}}function jS(t,e,n){const i=[],r=n||Ti.mix||Mm,o=t.length-1;for(let a=0;a<o;a++){let l=r(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||Cn:e;l=Co(c,l)}i.push(l)}return i}function TS(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const o=t.length;if(Od(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=jS(e,i,r),c=l.length,d=u=>{if(a&&u<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const p=no(t[h],t[h+1],u);return l[h](p)};return n?u=>d(ji(t[0],t[o-1],u)):d}function ES(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=no(0,e,i);t.push(ht(n,1,r))}}function RS(t){const e=[0];return ES(e,t.length-1),e}function IS(t,e){return t.map(n=>n*e)}function AS(t,e){return t.map(()=>e||km).splice(0,t.length-1)}function $r({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=W1(i)?i.map(xh):xh(i),o={done:!1,value:e[0]},a=IS(n&&n.length===e.length?n:RS(e),t),l=TS(a,e,{ease:Array.isArray(r)?r:AS(e,r)});return{calculatedDuration:t,next:c=>(o.value=l(c),o.done=c>=t,o)}}const _S=t=>t!==null;function Kd(t,{repeat:e,repeatType:n="loop"},i,r=1){const o=t.filter(_S),l=r<0||e&&n!=="loop"&&e%2===1?0:o.length-1;return!l||i===void 0?o[l]:i}const MS={decay:Cc,inertia:Cc,tween:$r,keyframes:$r,spring:ja};function Dm(t){typeof t.type=="string"&&(t.type=MS[t.type])}class Jd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const PS=t=>t/100;class Yd extends Jd{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==an.now()&&this.tick(an.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Dm(e);const{type:n=$r,repeat:i=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=e;let{keyframes:l}=e;const c=n||$r;c!==$r&&typeof l[0]!="number"&&(this.mixKeyframes=Co(PS,Mm(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=qd(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:i,totalDuration:r,mixKeyframes:o,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:x,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const v=this.currentTime-d*(this.playbackSpeed>=0?1:-1),k=this.playbackSpeed>=0?v<0:v>r;this.currentTime=Math.max(v,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let S=this.currentTime,C=i;if(h){const T=Math.min(this.currentTime,r)/l;let I=Math.floor(T),E=T%1;!E&&T>=1&&(E=1),E===1&&I--,I=Math.min(I,h+1),!!(I%2)&&(p==="reverse"?(E=1-E,m&&(E-=m/l)):p==="mirror"&&(C=a)),S=ji(0,1,E)*l}const b=k?{done:!1,value:u[0]}:C.next(S);o&&(b.value=o(b.value));let{done:j}=b;!k&&c!==null&&(j=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const w=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return w&&x!==Cc&&(b.value=Kd(u,this.options,y,this.speed)),g&&g(b.value),w&&this.finish(),b}then(e,n){return this.finished.then(e,n)}get duration(){return Sn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Sn(e)}get time(){return Sn(this.currentTime)}set time(e){e=Kn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(an.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Sn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=mS,startTime:n}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(an.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function NS(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const fs=t=>t*180/Math.PI,wc=t=>{const e=fs(Math.atan2(t[1],t[0]));return jc(e)},DS={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:wc,rotateZ:wc,skewX:t=>fs(Math.atan(t[1])),skewY:t=>fs(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},jc=t=>(t=t%360,t<0&&(t+=360),t),Ch=wc,wh=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),jh=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),zS={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:wh,scaleY:jh,scale:t=>(wh(t)+jh(t))/2,rotateX:t=>jc(fs(Math.atan2(t[6],t[5]))),rotateY:t=>jc(fs(Math.atan2(-t[2],t[0]))),rotateZ:Ch,rotate:Ch,skewX:t=>fs(Math.atan(t[4])),skewY:t=>fs(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Tc(t){return t.includes("scale")?1:0}function Ec(t,e){if(!t||t==="none")return Tc(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=zS,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=DS,r=l}if(!r)return Tc(e);const o=i[e],a=r[1].split(",").map(LS);return typeof o=="function"?o(a):a[o]}const OS=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return Ec(n,e)};function LS(t){return parseFloat(t.trim())}const kr=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Cr=new Set(kr),Th=t=>t===Sr||t===ye,BS=new Set(["x","y","z"]),FS=kr.filter(t=>!BS.has(t));function WS(t){const e=[];return FS.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const xs={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Ec(e,"x"),y:(t,{transform:e})=>Ec(e,"y")};xs.translateX=xs.x;xs.translateY=xs.y;const ys=new Set;let Rc=!1,Ic=!1,Ac=!1;function zm(){if(Ic){const t=Array.from(ys).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=WS(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([o,a])=>{i.getValue(o)?.set(a)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Ic=!1,Rc=!1,ys.forEach(t=>t.complete(Ac)),ys.clear()}function Om(){ys.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Ic=!0)})}function US(){Ac=!0,Om(),zm(),Ac=!1}class Xd{constructor(e,n,i,r,o,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(ys.add(this),Rc||(Rc=!0,lt.read(Om),lt.resolveKeyframes(zm))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;if(e[0]===null){const o=r?.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const l=i.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}NS(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),ys.delete(this)}cancel(){this.state==="scheduled"&&(ys.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const $S=t=>t.startsWith("--");function VS(t,e,n){$S(e)?t.style.setProperty(e,n):t.style[e]=n}const GS=Ld(()=>window.ScrollTimeline!==void 0),HS={};function qS(t,e){const n=Ld(t);return()=>HS[e]??n()}const Lm=qS(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Or=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,Eh={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Or([0,.65,.55,1]),circOut:Or([.55,0,1,.45]),backIn:Or([.31,.01,.66,-.59]),backOut:Or([.33,1.53,.69,.99])};function Bm(t,e){if(t)return typeof t=="function"?Lm()?Pm(t,e):"ease-out":Cm(t)?Or(t):Array.isArray(t)?t.map(n=>Bm(n,e)||Eh.easeOut):Eh[t]}function KS(t,e,n,{delay:i=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:n};c&&(u.offset=c);const h=Bm(l,r);Array.isArray(h)&&(u.easing=h);const p={delay:i,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),t.animate(u,p)}function Fm(t){return typeof t=="function"&&"applyToOptions"in t}function JS({type:t,...e}){return Fm(t)&&Lm()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class YS extends Jd{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:i,keyframes:r,pseudoElement:o,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!o,this.allowFlatten=a,this.options=e,Od(typeof e.type!="string");const d=JS(e);this.animation=KS(n,i,r,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=Kd(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):VS(n,i,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Sn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Sn(e)}get time(){return Sn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Kn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&GS()?(this.animation.timeline=e,Cn):n(this)}}const Wm={anticipate:bm,backInOut:ym,circInOut:Sm};function XS(t){return t in Wm}function ZS(t){typeof t.ease=="string"&&XS(t.ease)&&(t.ease=Wm[t.ease])}const Rh=10;class QS extends YS{constructor(e){ZS(e),Dm(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:i,onComplete:r,element:o,...a}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const l=new Yd({...a,autoplay:!1}),c=Kn(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-Rh).value,l.sample(c).value,Rh),l.stop()}}const Ih=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Xi.test(t)||t==="0")&&!t.startsWith("url("));function ek(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function tk(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=Ih(r,e),l=Ih(o,e);return!a||!l?!1:ek(t)||(n==="spring"||Fm(n))&&i}function _c(t){t.duration=0,t.type="keyframes"}const nk=new Set(["opacity","clipPath","filter","transform"]),ik=Ld(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function sk(t){const{motionValue:e,name:n,repeatDelay:i,repeatType:r,damping:o,type:a}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return ik()&&n&&nk.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&o!==0&&a!=="inertia"}const rk=40;class ok extends Jd{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=an.now();const p={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:o,repeatType:a,name:c,motionValue:d,element:u,...h},m=u?.KeyframeResolver||Xd;this.keyframeResolver=new m(l,(x,g,y)=>this.onKeyframesResolved(x,g,p,!y),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,n,i,r){this.keyframeResolver=void 0;const{name:o,type:a,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=an.now(),tk(e,o,a,l)||((Ti.instantAnimations||!c)&&u?.(Kd(e,i,n)),e[0]=e[e.length-1],_c(i),i.repeat=0);const p={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>rk?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:e},m=!d&&sk(p)?new QS({...p,element:p.motionValue.owner.current}):new Yd(p);m.finished.then(()=>this.notifyFinished()).catch(Cn),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),US()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const ak=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function lk(t){const e=ak.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function Um(t,e,n=1){const[i,r]=lk(t);if(!i)return;const o=window.getComputedStyle(e).getPropertyValue(i);if(o){const a=o.trim();return dm(a)?parseFloat(a):a}return $d(r)?Um(r,e,n+1):r}function Zd(t,e){return t?.[e]??t?.default??t}const $m=new Set(["width","height","top","left","right","bottom",...kr]),ck={test:t=>t==="auto",parse:t=>t},Vm=t=>e=>e.test(t),Gm=[Sr,ye,Jn,zi,eS,Q1,ck],Ah=t=>Gm.find(Vm(t));function dk(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||hm(t):!0}const uk=new Set(["brightness","contrast","saturate","opacity"]);function hk(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(Vd)||[];if(!i)return t;const r=n.replace(i,"");let o=uk.has(e)?1:0;return i!==n&&(o*=100),e+"("+o+r+")"}const pk=/\b([a-z-]*)\(.*?\)/gu,Mc={...Xi,getAnimatableNone:t=>{const e=t.match(pk);return e?e.map(hk).join(" "):t}},_h={...Sr,transform:Math.round},fk={rotate:zi,rotateX:zi,rotateY:zi,rotateZ:zi,scale:zo,scaleX:zo,scaleY:zo,scaleZ:zo,skew:zi,skewX:zi,skewY:zi,distance:ye,translateX:ye,translateY:ye,translateZ:ye,x:ye,y:ye,z:ye,perspective:ye,transformPerspective:ye,opacity:io,originX:yh,originY:yh,originZ:ye},Qd={borderWidth:ye,borderTopWidth:ye,borderRightWidth:ye,borderBottomWidth:ye,borderLeftWidth:ye,borderRadius:ye,radius:ye,borderTopLeftRadius:ye,borderTopRightRadius:ye,borderBottomRightRadius:ye,borderBottomLeftRadius:ye,width:ye,maxWidth:ye,height:ye,maxHeight:ye,top:ye,right:ye,bottom:ye,left:ye,padding:ye,paddingTop:ye,paddingRight:ye,paddingBottom:ye,paddingLeft:ye,margin:ye,marginTop:ye,marginRight:ye,marginBottom:ye,marginLeft:ye,backgroundPositionX:ye,backgroundPositionY:ye,...fk,zIndex:_h,fillOpacity:io,strokeOpacity:io,numOctaves:_h},gk={...Qd,color:kt,backgroundColor:kt,outlineColor:kt,fill:kt,stroke:kt,borderColor:kt,borderTopColor:kt,borderRightColor:kt,borderBottomColor:kt,borderLeftColor:kt,filter:Mc,WebkitFilter:Mc},Hm=t=>gk[t];function qm(t,e){let n=Hm(t);return n!==Mc&&(n=Xi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const mk=new Set(["auto","none","0"]);function xk(t,e,n){let i=0,r;for(;i<t.length&&!r;){const o=t[i];typeof o=="string"&&!mk.has(o)&&so(o).values.length&&(r=t[i]),i++}if(r&&n)for(const o of e)t[o]=qm(n,r)}class yk extends Xd{constructor(e,n,i,r,o){super(e,n,i,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),$d(d))){const u=Um(d,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!$m.has(i)||e.length!==2)return;const[r,o]=e,a=Ah(r),l=Ah(o);if(a!==l)if(Th(a)&&Th(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else xs[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)(e[r]===null||dk(e[r]))&&i.push(r);i.length&&xk(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=xs[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){const{element:e,name:n,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const r=e.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,a=i[o];i[o]=xs[n](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function bk(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const Km=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function Jm(t){return um(t)&&"offsetHeight"in t}const Mh=30,vk=t=>!isNaN(parseFloat(t));class Sk{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=an.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=an.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=vk(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Bd);const i=this.events[e].add(n);return e==="change"?()=>{i(),lt.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=an.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Mh)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Mh);return pm(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pr(t,e){return new Sk(t,e)}const{schedule:eu}=wm(queueMicrotask,!1),Mn={x:!1,y:!1};function Ym(){return Mn.x||Mn.y}function kk(t){return t==="x"||t==="y"?Mn[t]?null:(Mn[t]=!0,()=>{Mn[t]=!1}):Mn.x||Mn.y?null:(Mn.x=Mn.y=!0,()=>{Mn.x=Mn.y=!1})}function Xm(t,e){const n=bk(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function Ph(t){return!(t.pointerType==="touch"||Ym())}function Ck(t,e,n={}){const[i,r,o]=Xm(t,n),a=l=>{if(!Ph(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=h=>{Ph(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return i.forEach(l=>{l.addEventListener("pointerenter",a,r)}),o}const Zm=(t,e)=>e?t===e?!0:Zm(t,e.parentElement):!1,tu=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,wk=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function jk(t){return wk.has(t.tagName)||t.tabIndex!==-1}const na=new WeakSet;function Nh(t){return e=>{e.key==="Enter"&&t(e)}}function jl(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Tk=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=Nh(()=>{if(na.has(n))return;jl(n,"down");const r=Nh(()=>{jl(n,"up")}),o=()=>jl(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function Dh(t){return tu(t)&&!Ym()}function Ek(t,e,n={}){const[i,r,o]=Xm(t,n),a=l=>{const c=l.currentTarget;if(!Dh(l))return;na.add(c);const d=e(c,l),u=(m,x)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),na.has(c)&&na.delete(c),Dh(m)&&typeof d=="function"&&d(m,{success:x})},h=m=>{u(m,c===window||c===document||n.useGlobalTarget||Zm(c,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",p,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",a,r),Jm(l)&&(l.addEventListener("focus",d=>Tk(d,r)),!jk(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function Qm(t){return um(t)&&"ownerSVGElement"in t}function Rk(t){return Qm(t)&&t.tagName==="svg"}const Ht=t=>!!(t&&t.getVelocity),Ik=[...Gm,kt,Xi],Ak=t=>Ik.find(Vm(t)),nu=f.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function zh(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function _k(...t){return e=>{let n=!1;const i=t.map(r=>{const o=zh(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():zh(t[r],null)}}}}function Mk(...t){return f.useCallback(_k(...t),t)}class Pk extends f.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=Jm(i)&&i.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=r-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Nk({children:t,isPresent:e,anchorX:n,root:i}){const r=f.useId(),o=f.useRef(null),a=f.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=f.useContext(nu),c=Mk(o,t?.ref);return f.useInsertionEffect(()=>{const{width:d,height:u,top:h,left:p,right:m}=a.current;if(e||!o.current||!d||!u)return;const x=n==="left"?`left: ${p}`:`right: ${m}`;o.current.dataset.motionPopId=r;const g=document.createElement("style");l&&(g.nonce=l);const y=i??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${x}px !important;
            top: ${h}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[e]),s.jsx(Pk,{isPresent:e,childRef:o,sizeRef:a,children:f.cloneElement(t,{ref:c})})}const Dk=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:o,mode:a,anchorX:l,root:c})=>{const d=Pd(zk),u=f.useId();let h=!0,p=f.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:n,custom:r,onExitComplete:m=>{d.set(m,!0);for(const x of d.values())if(!x)return;i&&i()},register:m=>(d.set(m,!1),()=>d.delete(m))}),[n,d,i]);return o&&h&&(p={...p}),f.useMemo(()=>{d.forEach((m,x)=>d.set(x,!1))},[n]),f.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),a==="popLayout"&&(t=s.jsx(Nk,{isPresent:n,anchorX:l,root:c,children:t})),s.jsx(Ya.Provider,{value:p,children:t})};function zk(){return new Map}function ex(t=!0){const e=f.useContext(Ya);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,o=f.useId();f.useEffect(()=>{if(t)return r(o)},[t]);const a=f.useCallback(()=>t&&i&&i(o),[o,i,t]);return!n&&i?[!1,a]:[!0]}const Oo=t=>t.key||"";function Oh(t){const e=[];return f.Children.forEach(t,n=>{f.isValidElement(n)&&e.push(n)}),e}const De=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[d,u]=ex(a),h=f.useMemo(()=>Oh(t),[t]),p=a&&!d?[]:h.map(Oo),m=f.useRef(!0),x=f.useRef(h),g=Pd(()=>new Map),[y,v]=f.useState(h),[k,S]=f.useState(h);cm(()=>{m.current=!1,x.current=h;for(let j=0;j<k.length;j++){const w=Oo(k[j]);p.includes(w)?g.delete(w):g.get(w)!==!0&&g.set(w,!1)}},[k,p.length,p.join("-")]);const C=[];if(h!==y){let j=[...h];for(let w=0;w<k.length;w++){const T=k[w],I=Oo(T);p.includes(I)||(j.splice(w,0,T),C.push(T))}return o==="wait"&&C.length&&(j=C),S(Oh(j)),v(h),null}const{forceRender:b}=f.useContext(Md);return s.jsx(s.Fragment,{children:k.map(j=>{const w=Oo(j),T=a&&!d?!1:h===k||p.includes(w),I=()=>{if(g.has(w))g.set(w,!0);else return;let E=!0;g.forEach(P=>{P||(E=!1)}),E&&(b?.(),S(x.current),a&&u?.(),i&&i())};return s.jsx(Dk,{isPresent:T,initial:!m.current||n?void 0:!1,custom:e,presenceAffectsLayout:r,mode:o,root:c,onExitComplete:T?void 0:I,anchorX:l,children:j},w)})})},tx=f.createContext({strict:!1}),Lh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},fr={};for(const t in Lh)fr[t]={isEnabled:e=>Lh[t].some(n=>!!e[n])};function Ok(t){for(const e in t)fr[e]={...fr[e],...t[e]}}const Lk=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ta(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Lk.has(t)}let nx=t=>!Ta(t);function Bk(t){typeof t=="function"&&(nx=e=>e.startsWith("on")?!Ta(e):t(e))}try{Bk(require("@emotion/is-prop-valid").default)}catch{}function Fk(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(nx(r)||n===!0&&Ta(r)||!e&&!Ta(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const Xa=f.createContext({});function Za(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function ro(t){return typeof t=="string"||Array.isArray(t)}const iu=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],su=["initial",...iu];function Qa(t){return Za(t.animate)||su.some(e=>ro(t[e]))}function ix(t){return!!(Qa(t)||t.variants)}function Wk(t,e){if(Qa(t)){const{initial:n,animate:i}=t;return{initial:n===!1||ro(n)?n:void 0,animate:ro(i)?i:void 0}}return t.inherit!==!1?e:{}}function Uk(t){const{initial:e,animate:n}=Wk(t,f.useContext(Xa));return f.useMemo(()=>({initial:e,animate:n}),[Bh(e),Bh(n)])}function Bh(t){return Array.isArray(t)?t.join(" "):t}const oo={};function $k(t){for(const e in t)oo[e]=t[e],Ud(e)&&(oo[e].isCSSVariable=!0)}function sx(t,{layout:e,layoutId:n}){return Cr.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!oo[t]||t==="opacity")}const Vk={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Gk=kr.length;function Hk(t,e,n){let i="",r=!0;for(let o=0;o<Gk;o++){const a=kr[o],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=Km(l,Qd[a]);if(!c){r=!1;const u=Vk[a]||a;i+=`${u}(${d}) `}n&&(e[a]=d)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function ru(t,e,n){const{style:i,vars:r,transformOrigin:o}=t;let a=!1,l=!1;for(const c in e){const d=e[c];if(Cr.has(c)){a=!0;continue}else if(Ud(c)){r[c]=d;continue}else{const u=Km(d,Qd[c]);c.startsWith("origin")?(l=!0,o[c]=u):i[c]=u}}if(e.transform||(a||n?i.transform=Hk(e,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${c} ${d} ${u}`}}const ou=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function rx(t,e,n){for(const i in e)!Ht(e[i])&&!sx(i,n)&&(t[i]=e[i])}function qk({transformTemplate:t},e){return f.useMemo(()=>{const n=ou();return ru(n,e,t),Object.assign({},n.vars,n.style)},[e])}function Kk(t,e){const n=t.style||{},i={};return rx(i,n,t),Object.assign(i,qk(t,e)),i}function Jk(t,e){const n={},i=Kk(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const Yk={offset:"stroke-dashoffset",array:"stroke-dasharray"},Xk={offset:"strokeDashoffset",array:"strokeDasharray"};function Zk(t,e,n=1,i=0,r=!0){t.pathLength=1;const o=r?Yk:Xk;t[o.offset]=ye.transform(-i);const a=ye.transform(e),l=ye.transform(n);t[o.array]=`${a} ${l}`}function ox(t,{attrX:e,attrY:n,attrScale:i,pathLength:r,pathSpacing:o=1,pathOffset:a=0,...l},c,d,u){if(ru(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:p}=t;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),i!==void 0&&(h.scale=i),r!==void 0&&Zk(h,r,o,a,!1)}const ax=()=>({...ou(),attrs:{}}),lx=t=>typeof t=="string"&&t.toLowerCase()==="svg";function Qk(t,e,n,i){const r=f.useMemo(()=>{const o=ax();return ox(o,e,lx(i),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};rx(o,t.style,t),r.style={...o,...r.style}}return r}const eC=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function au(t){return typeof t!="string"||t.includes("-")?!1:!!(eC.indexOf(t)>-1||/[A-Z]/u.test(t))}function tC(t,e,n,{latestValues:i},r,o=!1){const l=(au(t)?Qk:Jk)(e,i,r,t),c=Fk(e,typeof t=="string",o),d=t!==f.Fragment?{...c,...l,ref:n}:{},{children:u}=e,h=f.useMemo(()=>Ht(u)?u.get():u,[u]);return f.createElement(t,{...d,children:h})}function Fh(t){const e=[{},{}];return t?.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function lu(t,e,n,i){if(typeof e=="function"){const[r,o]=Fh(i);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=Fh(i);e=e(n!==void 0?n:t.custom,r,o)}return e}function ia(t){return Ht(t)?t.get():t}function nC({scrapeMotionValuesFromProps:t,createRenderState:e},n,i,r){return{latestValues:iC(n,i,r,t),renderState:e()}}function iC(t,e,n,i){const r={},o=i(t,{});for(const p in o)r[p]=ia(o[p]);let{initial:a,animate:l}=t;const c=Qa(t),d=ix(t);e&&d&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let u=n?n.initial===!1:!1;u=u||a===!1;const h=u?l:a;if(h&&typeof h!="boolean"&&!Za(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const x=lu(t,p[m]);if(x){const{transitionEnd:g,transition:y,...v}=x;for(const k in v){let S=v[k];if(Array.isArray(S)){const C=u?S.length-1:0;S=S[C]}S!==null&&(r[k]=S)}for(const k in g)r[k]=g[k]}}}return r}const cx=t=>(e,n)=>{const i=f.useContext(Xa),r=f.useContext(Ya),o=()=>nC(t,e,i,r);return n?o():Pd(o)};function cu(t,e,n){const{style:i}=t,r={};for(const o in i)(Ht(i[o])||e.style&&Ht(e.style[o])||sx(o,t)||n?.getValue(o)?.liveStyle!==void 0)&&(r[o]=i[o]);return r}const sC=cx({scrapeMotionValuesFromProps:cu,createRenderState:ou});function dx(t,e,n){const i=cu(t,e,n);for(const r in t)if(Ht(t[r])||Ht(e[r])){const o=kr.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[o]=t[r]}return i}const rC=cx({scrapeMotionValuesFromProps:dx,createRenderState:ax}),oC=Symbol.for("motionComponentSymbol");function qs(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function aC(t,e,n){return f.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):qs(n)&&(n.current=i))},[e])}const du=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),lC="framerAppearId",ux="data-"+du(lC),hx=f.createContext({});function cC(t,e,n,i,r){const{visualElement:o}=f.useContext(Xa),a=f.useContext(tx),l=f.useContext(Ya),c=f.useContext(nu).reducedMotion,d=f.useRef(null);i=i||a.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:o,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,h=f.useContext(hx);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&dC(d.current,n,r,h);const p=f.useRef(!1);f.useInsertionEffect(()=>{u&&p.current&&u.update(n,l)});const m=n[ux],x=f.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return cm(()=>{u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),f.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),x.current=!1),u.enteringChildren=void 0)}),u}function dC(t,e,n,i){const{layoutId:r,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:px(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||l&&qs(l),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function px(t){if(t)return t.options.allowProjection!==!1?t.projection:px(t.parent)}function Tl(t,{forwardMotionProps:e=!1}={},n,i){n&&Ok(n);const r=au(t)?rC:sC;function o(l,c){let d;const u={...f.useContext(nu),...l,layoutId:uC(l)},{isStatic:h}=u,p=Uk(l),m=r(l,h);if(!h&&Nd){hC();const x=pC(u);d=x.MeasureLayout,p.visualElement=cC(t,m,u,i,x.ProjectionNode)}return s.jsxs(Xa.Provider,{value:p,children:[d&&p.visualElement?s.jsx(d,{visualElement:p.visualElement,...u}):null,tC(t,l,aC(m,p.visualElement,c),m,h,e)]})}o.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=f.forwardRef(o);return a[oC]=t,a}function uC({layoutId:t}){const e=f.useContext(Md).id;return e&&t!==void 0?e+"-"+t:t}function hC(t,e){f.useContext(tx).strict}function pC(t){const{drag:e,layout:n}=fr;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function fC(t,e){if(typeof Proxy>"u")return Tl;const n=new Map,i=(o,a)=>Tl(o,a,t,e),r=(o,a)=>i(o,a);return new Proxy(r,{get:(o,a)=>a==="create"?i:(n.has(a)||n.set(a,Tl(a,void 0,t,e)),n.get(a))})}function fx({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function gC({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function mC(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function El(t){return t===void 0||t===1}function Pc({scale:t,scaleX:e,scaleY:n}){return!El(t)||!El(e)||!El(n)}function ds(t){return Pc(t)||gx(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function gx(t){return Wh(t.x)||Wh(t.y)}function Wh(t){return t&&t!=="0%"}function Ea(t,e,n){const i=t-n,r=e*i;return n+r}function Uh(t,e,n,i,r){return r!==void 0&&(t=Ea(t,r,i)),Ea(t,n,i)+e}function Nc(t,e=0,n=1,i,r){t.min=Uh(t.min,e,n,i,r),t.max=Uh(t.max,e,n,i,r)}function mx(t,{x:e,y:n}){Nc(t.x,e.translate,e.scale,e.originPoint),Nc(t.y,n.translate,n.scale,n.originPoint)}const $h=.999999999999,Vh=1.0000000000001;function xC(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let o,a;for(let l=0;l<r;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Js(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,mx(t,a)),i&&ds(o.latestValues)&&Js(t,o.latestValues))}e.x<Vh&&e.x>$h&&(e.x=1),e.y<Vh&&e.y>$h&&(e.y=1)}function Ks(t,e){t.min=t.min+e,t.max=t.max+e}function Gh(t,e,n,i,r=.5){const o=ht(t.min,t.max,r);Nc(t,e,n,o,i)}function Js(t,e){Gh(t.x,e.x,e.scaleX,e.scale,e.originX),Gh(t.y,e.y,e.scaleY,e.scale,e.originY)}function xx(t,e){return fx(mC(t.getBoundingClientRect(),e))}function yC(t,e,n){const i=xx(t,n),{scroll:r}=e;return r&&(Ks(i.x,r.offset.x),Ks(i.y,r.offset.y)),i}const Hh=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ys=()=>({x:Hh(),y:Hh()}),qh=()=>({min:0,max:0}),Tt=()=>({x:qh(),y:qh()}),Dc={current:null},yx={current:!1};function bC(){if(yx.current=!0,!!Nd)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Dc.current=t.matches;t.addEventListener("change",e),e()}else Dc.current=!1}const vC=new WeakMap;function SC(t,e,n){for(const i in e){const r=e[i],o=n[i];if(Ht(r))t.addValue(i,r);else if(Ht(o))t.addValue(i,pr(r,{owner:t}));else if(o!==r)if(t.hasValue(i)){const a=t.getValue(i);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=t.getStaticValue(i);t.addValue(i,pr(a!==void 0?a:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const Kh=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class kC{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Xd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=an.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,lt.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=Qa(n),this.isVariantNode=ix(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const m=h[p];c[p]!==void 0&&Ht(m)&&m.set(c[p])}}mount(e){this.current=e,vC.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),yx.current||bC(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Dc.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Yi(this.notifyUpdate),Yi(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Cr.has(e);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&lt.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in fr){const n=fr[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Tt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Kh.length;i++){const r=Kh[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=e[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=SC(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=pr(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(dm(i)||hm(i))?i=parseFloat(i):!Ak(i)&&Xi.test(n)&&(i=qm(e,n)),this.setBaseTarget(e,Ht(i)?i.get():i)),Ht(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const o=lu(this.props,n,this.presenceContext?.custom);o&&(i=o[e])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Ht(r)?r:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Bd),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){eu.render(this.render)}}class bx extends kC{constructor(){super(...arguments),this.KeyframeResolver=yk}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ht(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function vx(t,{style:e,vars:n},i,r){const o=t.style;let a;for(a in e)o[a]=e[a];r?.applyProjectionStyles(o,i);for(a in n)o.setProperty(a,n[a])}function CC(t){return window.getComputedStyle(t)}class wC extends bx{constructor(){super(...arguments),this.type="html",this.renderInstance=vx}readValueFromInstance(e,n){if(Cr.has(n))return this.projection?.isProjecting?Tc(n):OS(e,n);{const i=CC(e),r=(Ud(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return xx(e,n)}build(e,n,i){ru(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return cu(e,n,i)}}const Sx=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jC(t,e,n,i){vx(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(Sx.has(r)?r:du(r),e.attrs[r])}class TC extends bx{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Tt}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Cr.has(n)){const i=Hm(n);return i&&i.default||0}return n=Sx.has(n)?n:du(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return dx(e,n,i)}build(e,n,i){ox(e,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,n,i,r){jC(e,n,i,r)}mount(e){this.isSVGTag=lx(e.tagName),super.mount(e)}}const EC=(t,e)=>au(t)?new TC(e):new wC(e,{allowProjection:t!==f.Fragment});function tr(t,e,n){const i=t.getProps();return lu(i,e,n!==void 0?n:i.custom,t)}const zc=t=>Array.isArray(t);function RC(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,pr(n))}function IC(t){return zc(t)?t[t.length-1]||0:t}function AC(t,e){const n=tr(t,e);let{transitionEnd:i={},transition:r={},...o}=n||{};o={...o,...i};for(const a in o){const l=IC(o[a]);RC(t,a,l)}}function _C(t){return!!(Ht(t)&&t.add)}function Oc(t,e){const n=t.getValue("willChange");if(_C(n))return n.add(e);if(!n&&Ti.WillChange){const i=new Ti.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function kx(t){return t.props[ux]}const MC=t=>t!==null;function PC(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(MC),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return r[o]}const NC={type:"spring",stiffness:500,damping:25,restSpeed:10},DC=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),zC={type:"keyframes",duration:.8},OC={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},LC=(t,{keyframes:e})=>e.length>2?zC:Cr.has(t)?t.startsWith("scale")?DC(e[1]):NC:OC;function BC({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const uu=(t,e,n,i={},r,o)=>a=>{const l=Zd(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Kn(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:p=>{e.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:o?void 0:r};BC(l)||Object.assign(u,LC(t,u)),u.duration&&(u.duration=Kn(u.duration)),u.repeatDelay&&(u.repeatDelay=Kn(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(_c(u),u.delay===0&&(h=!0)),(Ti.instantAnimations||Ti.skipAnimations)&&(h=!0,_c(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!o&&e.get()!==void 0){const p=PC(u.keyframes,l);if(p!==void 0){lt.update(()=>{u.onUpdate(p),u.onComplete()});return}}return l.isSync?new Yd(u):new ok(u)};function FC({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function Cx(t,e,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(o=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const h=t.getValue(u,t.latestValues[u]??null),p=l[u];if(p===void 0||d&&FC(d,u))continue;const m={delay:n,...Zd(o||{},u)},x=h.get();if(x!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===x&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const v=kx(t);if(v){const k=window.MotionHandoffAnimation(v,u,lt);k!==null&&(m.startTime=k,g=!0)}}Oc(t,u),h.start(uu(u,h,p,t.shouldReduceMotion&&$m.has(u)?{type:!1}:m,t,g));const y=h.animation;y&&c.push(y)}return a&&Promise.all(c).then(()=>{lt.update(()=>{a&&AC(t,a)})}),c}function wx(t,e,n,i=0,r=1){const o=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=t.size,l=(a-1)*i;return typeof n=="function"?n(o,a):r===1?o*i:l-o*i}function Lc(t,e,n={}){const i=tr(t,e,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const o=i?()=>Promise.all(Cx(t,i,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=r;return WC(t,e,c,d,u,h,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(n.delay)])}function WC(t,e,n=0,i=0,r=0,o=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Lc(c,e,{...a,delay:n+(typeof i=="function"?0:i)+wx(t.variantChildren,c,i,r,o)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function UC(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(o=>Lc(t,o,n));i=Promise.all(r)}else if(typeof e=="string")i=Lc(t,e,n);else{const r=typeof e=="function"?tr(t,e,n.custom):e;i=Promise.all(Cx(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}function jx(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}const $C=su.length;function Tx(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?Tx(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<$C;n++){const i=su[n],r=t.props[i];(ro(r)||r===!1)&&(e[i]=r)}return e}const VC=[...iu].reverse(),GC=iu.length;function HC(t){return e=>Promise.all(e.map(({animation:n,options:i})=>UC(t,n,i)))}function qC(t){let e=HC(t),n=Jh(),i=!0;const r=c=>(d,u)=>{const h=tr(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:m,...x}=h;d={...d,...x,...m}}return d};function o(c){e=c(t)}function a(c){const{props:d}=t,u=Tx(t.parent)||{},h=[],p=new Set;let m={},x=1/0;for(let y=0;y<GC;y++){const v=VC[y],k=n[v],S=d[v]!==void 0?d[v]:u[v],C=ro(S),b=v===c?k.isActive:null;b===!1&&(x=y);let j=S===u[v]&&S!==d[v]&&C;if(j&&i&&t.manuallyAnimateOnMount&&(j=!1),k.protectedKeys={...m},!k.isActive&&b===null||!S&&!k.prevProp||Za(S)||typeof S=="boolean")continue;const w=KC(k.prevProp,S);let T=w||v===c&&k.isActive&&!j&&C||y>x&&C,I=!1;const E=Array.isArray(S)?S:[S];let P=E.reduce(r(v),{});b===!1&&(P={});const{prevResolvedValues:O={}}=k,B={...O,...P},N=$=>{T=!0,p.has($)&&(I=!0,p.delete($)),k.needsAnimating[$]=!0;const D=t.getValue($);D&&(D.liveStyle=!1)};for(const $ in B){const D=P[$],z=O[$];if(m.hasOwnProperty($))continue;let L=!1;zc(D)&&zc(z)?L=!jx(D,z):L=D!==z,L?D!=null?N($):p.add($):D!==void 0&&p.has($)?N($):k.protectedKeys[$]=!0}k.prevProp=S,k.prevResolvedValues=P,k.isActive&&(m={...m,...P}),i&&t.blockInitialAnimation&&(T=!1);const M=j&&w;T&&(!M||I)&&h.push(...E.map($=>{const D={type:v};if(typeof $=="string"&&i&&!M&&t.manuallyAnimateOnMount&&t.parent){const{parent:z}=t,L=tr(z,$);if(z.enteringChildren&&L){const{delayChildren:ee}=L.transition||{};D.delay=wx(z.enteringChildren,t,ee)}}return{animation:$,options:D}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const v=tr(t,Array.isArray(d.initial)?d.initial[0]:d.initial);v&&v.transition&&(y.transition=v.transition)}p.forEach(v=>{const k=t.getBaseTarget(v),S=t.getValue(v);S&&(S.liveStyle=!0),y[v]=k??null}),h.push({animation:y})}let g=!!h.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(g=!1),i=!1,g?e(h):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,d)),n[c].isActive=d;const u=a(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=Jh()}}}function KC(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!jx(e,t):!1}function cs(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Jh(){return{animate:cs(!0),whileInView:cs(),whileHover:cs(),whileTap:cs(),whileDrag:cs(),whileFocus:cs(),exit:cs()}}class ns{constructor(e){this.isMounted=!1,this.node=e}update(){}}class JC extends ns{constructor(e){super(e),e.animationState||(e.animationState=qC(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Za(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let YC=0;class XC extends ns{constructor(){super(...arguments),this.id=YC++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const ZC={animation:{Feature:JC},exit:{Feature:XC}};function ao(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function To(t){return{point:{x:t.pageX,y:t.pageY}}}const QC=t=>e=>tu(e)&&t(e,To(e));function Vr(t,e,n,i){return ao(t,e,QC(n),i)}const Ex=1e-4,ew=1-Ex,tw=1+Ex,Rx=.01,nw=0-Rx,iw=0+Rx;function Qt(t){return t.max-t.min}function sw(t,e,n){return Math.abs(t-e)<=n}function Yh(t,e,n,i=.5){t.origin=i,t.originPoint=ht(e.min,e.max,t.origin),t.scale=Qt(n)/Qt(e),t.translate=ht(n.min,n.max,t.origin)-t.originPoint,(t.scale>=ew&&t.scale<=tw||isNaN(t.scale))&&(t.scale=1),(t.translate>=nw&&t.translate<=iw||isNaN(t.translate))&&(t.translate=0)}function Gr(t,e,n,i){Yh(t.x,e.x,n.x,i?i.originX:void 0),Yh(t.y,e.y,n.y,i?i.originY:void 0)}function Xh(t,e,n){t.min=n.min+e.min,t.max=t.min+Qt(e)}function rw(t,e,n){Xh(t.x,e.x,n.x),Xh(t.y,e.y,n.y)}function Zh(t,e,n){t.min=e.min-n.min,t.max=t.min+Qt(e)}function Ra(t,e,n){Zh(t.x,e.x,n.x),Zh(t.y,e.y,n.y)}function yn(t){return[t("x"),t("y")]}const Ix=({current:t})=>t?t.ownerDocument.defaultView:null,Qh=(t,e)=>Math.abs(t-e);function ow(t,e){const n=Qh(t.x,e.x),i=Qh(t.y,e.y);return Math.sqrt(n**2+i**2)}class Ax{constructor(e,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:o=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Il(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,x=ow(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!x)return;const{point:g}=p,{timestamp:y}=Bt;this.history.push({...g,timestamp:y});const{onStart:v,onMove:k}=this.handlers;m||(v&&v(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Rl(m,this.transformPagePoint),lt.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:x,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=Il(p.type==="pointercancel"?this.lastMoveEventInfo:Rl(m,this.transformPagePoint),this.history);this.startEvent&&x&&x(p,v),g&&g(p,v)},!tu(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=a,this.contextWindow=r||window;const l=To(e),c=Rl(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=Bt;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=n;h&&h(e,Il(c,this.history)),this.removeListeners=Co(Vr(this.contextWindow,"pointermove",this.handlePointerMove),Vr(this.contextWindow,"pointerup",this.handlePointerUp),Vr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Yi(this.updatePoint)}}function Rl(t,e){return e?{point:e(t.point)}:t}function ep(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Il({point:t},e){return{point:t,delta:ep(t,_x(e)),offset:ep(t,aw(e)),velocity:lw(e,.1)}}function aw(t){return t[0]}function _x(t){return t[t.length-1]}function lw(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=_x(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>Kn(e)));)n--;if(!i)return{x:0,y:0};const o=Sn(r.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function cw(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?ht(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?ht(n,t,i.max):Math.min(t,n)),t}function tp(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function dw(t,{top:e,left:n,bottom:i,right:r}){return{x:tp(t.x,n,r),y:tp(t.y,e,i)}}function np(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function uw(t,e){return{x:np(t.x,e.x),y:np(t.y,e.y)}}function hw(t,e){let n=.5;const i=Qt(t),r=Qt(e);return r>i?n=no(e.min,e.max-i,t.min):i>r&&(n=no(t.min,t.max-r,e.min)),ji(0,1,n)}function pw(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Bc=.35;function fw(t=Bc){return t===!1?t=0:t===!0&&(t=Bc),{x:ip(t,"left","right"),y:ip(t,"top","bottom")}}function ip(t,e,n){return{min:sp(t,e),max:sp(t,n)}}function sp(t,e){return typeof t=="number"?t:t[e]||0}const gw=new WeakMap;class mw{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Tt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const o=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(To(h).point)},a=(h,p)=>{const{drag:m,dragPropagation:x,onDragStart:g}=this.getProps();if(m&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=kk(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),yn(v=>{let k=this.getAxisMotionValue(v).get()||0;if(Jn.test(k)){const{projection:S}=this.visualElement;if(S&&S.layout){const C=S.layout.layoutBox[v];C&&(k=Qt(C)*(parseFloat(k)/100))}}this.originPoint[v]=k}),g&&lt.postRender(()=>g(h,p)),Oc(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:x,onDirectionLock:g,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:v}=p;if(x&&this.currentDirection===null){this.currentDirection=xw(v),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,v),this.updateAxis("y",p.point,v),this.visualElement.render(),y&&y(h,p)},c=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>yn(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Ax(e,{onSessionStart:o,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Ix(this.visualElement)})}stop(e,n){const i=e||this.latestPointerEvent,r=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!r||!i)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&lt.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!Lo(e,r,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(a=cw(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&qs(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=dw(i.layoutBox,e):this.constraints=!1,this.elastic=fw(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&yn(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=pw(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!qs(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=yC(i,r.root,this.visualElement.getTransformPagePoint());let a=uw(r.layout.layoutBox,o);if(n){const l=n(gC(a));this.hasMutatedConstraints=!!l,l&&(a=fx(l))}return a}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=yn(u=>{if(!Lo(u,n,this.currentDirection))return;let h=c&&c[u]||{};a&&(h={min:0,max:0});const p=r?200:1e6,m=r?40:1e7,x={type:"inertia",velocity:i?e[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return Oc(this.visualElement,e),i.start(uu(e,i,0,n,this.visualElement,!1))}stopAnimation(){yn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){yn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){yn(n=>{const{drag:i}=this.getProps();if(!Lo(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:l}=r.layout.layoutBox[n];o.set(e[n]-ht(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!qs(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};yn(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();r[a]=hw({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),yn(a=>{if(!Lo(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(ht(c,d,r[a]))})}addListeners(){if(!this.visualElement.current)return;gw.set(this.visualElement,this);const e=this.visualElement.current,n=Vr(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();qs(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),lt.read(i);const a=ao(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(yn(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())}));return()=>{a(),n(),o(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=Bc,dragMomentum:l=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function Lo(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function xw(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class yw extends ns{constructor(e){super(e),this.removeGroupControls=Cn,this.removeListeners=Cn,this.controls=new mw(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Cn}unmount(){this.removeGroupControls(),this.removeListeners()}}const rp=t=>(e,n)=>{t&&lt.postRender(()=>t(e,n))};class bw extends ns{constructor(){super(...arguments),this.removePointerDownListener=Cn}onPointerDown(e){this.session=new Ax(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ix(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:rp(e),onStart:rp(n),onMove:i,onEnd:(o,a)=>{delete this.session,r&&lt.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=Vr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const sa={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function op(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Er={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ye.test(t))t=parseFloat(t);else return t;const n=op(t,e.target.x),i=op(t,e.target.y);return`${n}% ${i}%`}},vw={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=Xi.parse(t);if(r.length>5)return i;const o=Xi.createTransformer(t),a=typeof r[0]!="number"?1:0,l=n.x.scale*e.x,c=n.y.scale*e.y;r[0+a]/=l,r[1+a]/=c;const d=ht(l,c,.5);return typeof r[2+a]=="number"&&(r[2+a]/=d),typeof r[3+a]=="number"&&(r[3+a]/=d),o(r)}};let Al=!1;class Sw extends f.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:o}=e;$k(kw),o&&(n.group&&n.group.add(o),i&&i.register&&r&&i.register(o),Al&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),sa.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:o}=this.props,{projection:a}=i;return a&&(a.isPresent=o,Al=!0,r||e.layoutDependency!==n||n===void 0||e.isPresent!==o?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||lt.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),eu.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;Al=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Mx(t){const[e,n]=ex(),i=f.useContext(Md);return s.jsx(Sw,{...t,layoutGroup:i,switchLayoutGroup:f.useContext(hx),isPresent:e,safeToRemove:n})}const kw={borderRadius:{...Er,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Er,borderTopRightRadius:Er,borderBottomLeftRadius:Er,borderBottomRightRadius:Er,boxShadow:vw};function Cw(t,e,n){const i=Ht(t)?t:pr(t);return i.start(uu("",i,e,n)),i.animation}const ww=(t,e)=>t.depth-e.depth;class jw{constructor(){this.children=[],this.isDirty=!1}add(e){Dd(this.children,e),this.isDirty=!0}remove(e){zd(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ww),this.isDirty=!1,this.children.forEach(e)}}function Tw(t,e){const n=an.now(),i=({timestamp:r})=>{const o=r-n;o>=e&&(Yi(i),t(o-e))};return lt.setup(i,!0),()=>Yi(i)}const Px=["TopLeft","TopRight","BottomLeft","BottomRight"],Ew=Px.length,ap=t=>typeof t=="string"?parseFloat(t):t,lp=t=>typeof t=="number"||ye.test(t);function Rw(t,e,n,i,r,o){r?(t.opacity=ht(0,n.opacity??1,Iw(i)),t.opacityExit=ht(e.opacity??1,0,Aw(i))):o&&(t.opacity=ht(e.opacity??1,n.opacity??1,i));for(let a=0;a<Ew;a++){const l=`border${Px[a]}Radius`;let c=cp(e,l),d=cp(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||lp(c)===lp(d)?(t[l]=Math.max(ht(ap(c),ap(d),i),0),(Jn.test(d)||Jn.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||n.rotate)&&(t.rotate=ht(e.rotate||0,n.rotate||0,i))}function cp(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const Iw=Nx(0,.5,vm),Aw=Nx(.5,.95,Cn);function Nx(t,e,n){return i=>i<t?0:i>e?1:n(no(t,e,i))}function dp(t,e){t.min=e.min,t.max=e.max}function An(t,e){dp(t.x,e.x),dp(t.y,e.y)}function up(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function hp(t,e,n,i,r){return t-=e,t=Ea(t,1/n,i),r!==void 0&&(t=Ea(t,1/r,i)),t}function _w(t,e=0,n=1,i=.5,r,o=t,a=t){if(Jn.test(e)&&(e=parseFloat(e),e=ht(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=ht(o.min,o.max,i);t===o&&(l-=e),t.min=hp(t.min,e,n,l,r),t.max=hp(t.max,e,n,l,r)}function pp(t,e,[n,i,r],o,a){_w(t,e[n],e[i],e[r],e.scale,o,a)}const Mw=["x","scaleX","originX"],Pw=["y","scaleY","originY"];function fp(t,e,n,i){pp(t.x,e,Mw,n?n.x:void 0,i?i.x:void 0),pp(t.y,e,Pw,n?n.y:void 0,i?i.y:void 0)}function gp(t){return t.translate===0&&t.scale===1}function Dx(t){return gp(t.x)&&gp(t.y)}function mp(t,e){return t.min===e.min&&t.max===e.max}function Nw(t,e){return mp(t.x,e.x)&&mp(t.y,e.y)}function xp(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function zx(t,e){return xp(t.x,e.x)&&xp(t.y,e.y)}function yp(t){return Qt(t.x)/Qt(t.y)}function bp(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class Dw{constructor(){this.members=[]}add(e){Dd(this.members,e),e.scheduleRender()}remove(e){if(zd(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function zw(t,e,n){let i="";const r=t.x.translate/e.x,o=t.y.translate/e.y,a=n?.z||0;if((r||o||a)&&(i=`translate3d(${r}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:x}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),h&&(i+=`rotateX(${h}deg) `),p&&(i+=`rotateY(${p}deg) `),m&&(i+=`skewX(${m}deg) `),x&&(i+=`skewY(${x}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const _l=["","X","Y","Z"],Ow=1e3;let Lw=0;function Ml(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function Ox(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=kx(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",lt,!(r||o))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&Ox(i)}function Lx({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(a={},l=e?.()){this.id=Lw++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Ww),this.nodes.forEach(Gw),this.nodes.forEach(Hw),this.nodes.forEach(Uw)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new jw)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Bd),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=Qm(a)&&!Rk(a),this.instance=a;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;lt.read(()=>{h=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=Tw(p,250),sa.hasAnimatedSinceResize&&(sa.hasAnimatedSinceResize=!1,this.nodes.forEach(kp)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||Xw,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),v=!this.targetLayout||!zx(this.targetLayout,m),k=!h&&p;if(this.options.layoutRoot||this.resumeFrom||k||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const S={...Zd(x,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S),this.setAnimationOrigin(u,k)}else h||kp(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Yi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(qw),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ox(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(vp);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Sp);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Vw),this.nodes.forEach(Bw),this.nodes.forEach(Fw)):this.nodes.forEach(Sp),this.clearAllSnapshots();const l=an.now();Bt.delta=ji(0,1e3/60,l-Bt.timestamp),Bt.timestamp=l,Bt.isProcessing=!0,vl.update.process(Bt),vl.preRender.process(Bt),vl.render.process(Bt),Bt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,eu.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach($w),this.sharedNodes.forEach(Kw)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,lt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){lt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Qt(this.snapshot.measuredBox.x)&&!Qt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Tt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Dx(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(l||ds(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),Zw(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return Tt();const l=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Qw))){const{scroll:d}=this.root;d&&(Ks(l.x,d.offset.x),Ks(l.y,d.offset.y))}return l}removeElementScroll(a){const l=Tt();if(An(l,a),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&An(l,a),Ks(l.x,u.offset.x),Ks(l.y,u.offset.y))}return l}applyTransform(a,l=!1){const c=Tt();An(c,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Js(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ds(u.latestValues)&&Js(c,u.latestValues)}return ds(this.latestValues)&&Js(c,this.latestValues),c}removeTransform(a){const l=Tt();An(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ds(d.latestValues))continue;Pc(d.latestValues)&&d.updateSnapshot();const u=Tt(),h=d.measurePageBox();An(u,h),fp(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ds(this.latestValues)&&fp(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Bt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Bt.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Tt(),this.targetWithTransforms=Tt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),rw(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):An(this.target,this.layout.layoutBox),mx(this.target,this.targetDelta)):An(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Pc(this.parent.latestValues)||gx(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Tt(),this.relativeTargetOrigin=Tt(),Ra(this.relativeTargetOrigin,l,c),An(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Bt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;An(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;xC(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Tt());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(up(this.prevProjectionDelta.x,this.projectionDelta.x),up(this.prevProjectionDelta.y,this.projectionDelta.y)),Gr(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!bp(this.projectionDelta.x,this.prevProjectionDelta.x)||!bp(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ys(),this.projectionDelta=Ys(),this.projectionDeltaWithTransform=Ys()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=Ys();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=Tt(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,y=this.getStack(),v=!y||y.members.length<=1,k=!!(g&&!v&&this.options.crossfade===!0&&!this.path.some(Yw));this.animationProgress=0;let S;this.mixTargetDelta=C=>{const b=C/1e3;Cp(h.x,a.x,b),Cp(h.y,a.y,b),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ra(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Jw(this.relativeTarget,this.relativeTargetOrigin,p,b),S&&Nw(this.relativeTarget,S)&&(this.isProjectionDirty=!1),S||(S=Tt()),An(S,this.relativeTarget)),g&&(this.animationValues=u,Rw(u,d,this.latestValues,b,k,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=b},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Yi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=lt.update(()=>{sa.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=pr(0)),this.currentAnimation=Cw(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Ow),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&Bx(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||Tt();const h=Qt(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const p=Qt(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}An(l,c),Js(l,u),Gr(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Dw),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Ml("z",a,d,this.animationValues);for(let u=0;u<_l.length;u++)Ml(`rotate${_l[u]}`,a,d,this.animationValues),Ml(`skew${_l[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=ia(l?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=ia(l?.pointerEvents)||""),this.hasProjected&&!ds(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=zw(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),a.transform=h;const{x:p,y:m}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in oo){if(u[x]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:v}=oo[x],k=h==="none"?u[x]:g(u[x],d);if(y){const S=y.length;for(let C=0;C<S;C++)a[y[C]]=k}else v?this.options.visualElement.renderState.vars[x]=k:a[x]=k}this.options.layoutId&&(a.pointerEvents=d===this?ia(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(vp),this.root.sharedNodes.clear()}}}function Bw(t){t.updateLayout()}function Fw(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,o=e.source!==t.layout.source;r==="size"?yn(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=Qt(h);h.min=n[u].min,h.max=h.min+p}):Bx(r,e.layoutBox,n)&&yn(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=Qt(n[u]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+p)});const a=Ys();Gr(a,n,e.layoutBox);const l=Ys();o?Gr(l,t.applyTransform(i,!0),e.measuredBox):Gr(l,n,e.layoutBox);const c=!Dx(a);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const m=Tt();Ra(m,e.layoutBox,h.layoutBox);const x=Tt();Ra(x,n,p.layoutBox),zx(m,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function Ww(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Uw(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function $w(t){t.clearSnapshot()}function vp(t){t.clearMeasurements()}function Sp(t){t.isLayoutDirty=!1}function Vw(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function kp(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function Gw(t){t.resolveTargetDelta()}function Hw(t){t.calcProjection()}function qw(t){t.resetSkewAndRotation()}function Kw(t){t.removeLeadSnapshot()}function Cp(t,e,n){t.translate=ht(e.translate,0,n),t.scale=ht(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function wp(t,e,n,i){t.min=ht(e.min,n.min,i),t.max=ht(e.max,n.max,i)}function Jw(t,e,n,i){wp(t.x,e.x,n.x,i),wp(t.y,e.y,n.y,i)}function Yw(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Xw={duration:.45,ease:[.4,0,.1,1]},jp=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Tp=jp("applewebkit/")&&!jp("chrome/")?Math.round:Cn;function Ep(t){t.min=Tp(t.min),t.max=Tp(t.max)}function Zw(t){Ep(t.x),Ep(t.y)}function Bx(t,e,n){return t==="position"||t==="preserve-aspect"&&!sw(yp(e),yp(n),.2)}function Qw(t){return t!==t.root&&t.scroll?.wasRoot}const ej=Lx({attachResizeListener:(t,e)=>ao(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Pl={current:void 0},Fx=Lx({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Pl.current){const t=new ej({});t.mount(window),t.setOptions({layoutScroll:!0}),Pl.current=t}return Pl.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),tj={pan:{Feature:bw},drag:{Feature:yw,ProjectionNode:Fx,MeasureLayout:Mx}};function Rp(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,o=i[r];o&&lt.postRender(()=>o(e,To(e)))}class nj extends ns{mount(){const{current:e}=this.node;e&&(this.unmount=Ck(e,(n,i)=>(Rp(this.node,i,"Start"),r=>Rp(this.node,r,"End"))))}unmount(){}}class ij extends ns{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Co(ao(this.node.current,"focus",()=>this.onFocus()),ao(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Ip(t,e,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),o=i[r];o&&lt.postRender(()=>o(e,To(e)))}class sj extends ns{mount(){const{current:e}=this.node;e&&(this.unmount=Ek(e,(n,i)=>(Ip(this.node,i,"Start"),(r,{success:o})=>Ip(this.node,r,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Fc=new WeakMap,Nl=new WeakMap,rj=t=>{const e=Fc.get(t.target);e&&e(t)},oj=t=>{t.forEach(rj)};function aj({root:t,...e}){const n=t||document;Nl.has(n)||Nl.set(n,{});const i=Nl.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(oj,{root:t,...e})),i[r]}function lj(t,e,n){const i=aj(e);return Fc.set(t,n),i.observe(t),()=>{Fc.delete(t),i.unobserve(t)}}const cj={some:0,all:1};class dj extends ns{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:cj[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(c)};return lj(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(uj(e,n))&&this.startObserver()}unmount(){}}function uj({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const hj={inView:{Feature:dj},tap:{Feature:sj},focus:{Feature:ij},hover:{Feature:nj}},pj={layout:{ProjectionNode:Fx,MeasureLayout:Mx}},fj={...ZC,...hj,...tj,...pj},V=fC(fj,EC);const gj=Z("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const yt=Z("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Eo=Z("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const is=Z("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);const mj=Z("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const Ro=Z("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const xj=Z("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);const el=Z("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const Ap=Z("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);const Fn=Z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const Wx=Z("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const yj=Z("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const bj=Z("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);const ct=Z("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Yn=Z("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const ke=Z("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Zi=Z("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Ux=Z("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const _p=Z("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const Mp=Z("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);const vj=Z("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const Io=Z("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const Je=Z("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const Sj=Z("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);const Ao=Z("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Wc=Z("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const kj=Z("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const gr=Z("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const hu=Z("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);const nr=Z("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const $x=Z("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Nt=Z("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const ra=Z("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const Cj=Z("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);const Uc=Z("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const _o=Z("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const wj=Z("Frame",[["line",{x1:"22",x2:"2",y1:"6",y2:"6",key:"15w7dq"}],["line",{x1:"22",x2:"2",y1:"18",y2:"18",key:"1ip48p"}],["line",{x1:"6",x2:"6",y1:"2",y2:"22",key:"a2lnyx"}],["line",{x1:"18",x2:"18",y1:"2",y2:"22",key:"8vb6jd"}]]);const Dl=Z("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);const pu=Z("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const $c=Z("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const jj=Z("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const Tj=Z("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);const tl=Z("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const Vc=Z("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const un=Z("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const Ej=Z("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Rj=Z("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const Lr=Z("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const Ij=Z("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Gc=Z("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const Ia=Z("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const Vx=Z("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const Aj=Z("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const _j=Z("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const Mj=Z("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const Ye=Z("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Gx=Z("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Pj=Z("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);const Nj=Z("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);const Dj=Z("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const zj=Z("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);const Oj=Z("PanelTop",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}]]);const Lj=Z("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);const nl=Z("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);const Mo=Z("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);const fu=Z("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Bj=Z("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const Hr=Z("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const Dt=Z("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const At=Z("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Hx=Z("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);const zt=Z("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const oi=Z("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);const gu=Z("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const Ln=Z("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);const Ss=Z("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const mu=Z("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);const ii=Z("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Fj=Z("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);const Ii=Z("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Wj=Z("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);const il=Z("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);const sl=Z("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);const Uj=Z("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const ks=Z("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const $j=Z("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const et=Z("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const Ei=Z("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);const jn=Z("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const Vj=Z("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);const We=Z("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const ss=Z("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Gj=Z("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const Pp=Z("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const ki=Z("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const Hc=Z("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const Hj=Z("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);const Ot=Z("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const rl=Z("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Np={"#e91e63":"#3b82f6","#ec407a":"#3b82f6","#f06292":"#3b82f6","#d81b60":"#3b82f6","#c2185b":"#3b82f6","#ad1457":"#3b82f6","#880e4f":"#3b82f6","#ff4081":"#3b82f6","#f50057":"#3b82f6","#f44336":"#3b82f6","#e53935":"#3b82f6","#d32f2f":"#3b82f6","#c62828":"#3b82f6","#b71c1c":"#3b82f6","#ff1744":"#3b82f6","#ff5252":"#3b82f6","#ef5350":"#3b82f6","#e57373":"#3b82f6","#ff5722":"#f59e0b","#e64a19":"#f59e0b","#bf360c":"#f59e0b"},qj=t=>{if(!t||typeof t!="string")return!1;const e=t.replace("#","");if(e.length!==6)return!1;const n=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,r=parseInt(e.substring(4,6),16)/255,o=Math.max(n,i,r),a=Math.min(n,i,r),l=(o+a)/2;if(o===a)return!1;const c=o-a,d=l>.5?c/(2-o-a):c/(o+a);let u;switch(o){case n:u=((i-r)/c+(i<r?6:0))/6;break;case i:u=((r-n)/c+2)/6;break;case r:u=((n-i)/c+4)/6;break;default:u=0}const h=u*360;return d>.4&&(h>=330&&h<=360||h>=0&&h<=20)},qx=(t,e="#3b82f6")=>{if(!t||typeof t!="string")return e;const n=t.toLowerCase().trim();return Np[n]?Np[n]:qj(n)?e:t},Kj=({setup:t,isSelected:e,onSelect:n})=>{const[i,r]=f.useState(!1),o=qx(t.color),a=()=>e?o:i?"#d1d5db":"#f3f4f6",l=()=>e?`${o}08`:i?"#f9fafb":"white";return s.jsxs("button",{onClick:n,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),className:"relative p-4 rounded-xl text-left transition-all",style:{border:`2px solid ${a()}`,backgroundColor:l(),boxShadow:i||e?"0 4px 6px -1px rgba(0, 0, 0, 0.1)":"none",outline:"none",WebkitAppearance:"none"},children:[e&&s.jsx("div",{className:"absolute top-3 right-3 w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:o},children:s.jsx(wn,{size:12,className:"text-white",strokeWidth:3})}),s.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center mb-3",style:{backgroundColor:`${o}15`},children:s.jsx("span",{className:"text-2xl",children:t.icon})}),s.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1 pr-6",children:t.name}),s.jsx("p",{className:"text-xs text-gray-500 leading-relaxed mb-3",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",wordBreak:"break-word"},children:t.description}),s.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[s.jsx("span",{className:"inline-flex text-[10px] px-2 py-0.5 rounded-full font-medium",style:{backgroundColor:`${o}15`,color:o},children:t.focus}),s.jsx("span",{className:"inline-flex text-[10px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 font-medium",children:t.targetGroup})]})]})},Jj=()=>{const{currentSetup:t,setSelectedSetup:e,clearSelectedSetup:n,availableSetups:i,branding:r,setupsLoading:o}=Ue(),[a,l]=f.useState(!1),[c,d]=f.useState(!1);As.useEffect(()=>{const x=()=>d(window.innerWidth<640);return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const u=r?.["--primary-accent"]||"#3A7FA7",h=x=>{e(x),l(!1)},p=()=>{n(),l(!1)},m=t?qx(t.color):null;return o?s.jsx("div",{className:"w-full flex items-center justify-center py-4",children:s.jsx(he,{className:"w-5 h-5 animate-spin text-gray-400"})}):!i||i.length===0?null:s.jsxs(s.Fragment,{children:[s.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"w-full",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2 px-1",children:"Filtere Trainingsszenarien nach deinem Fokus"}),s.jsxs("button",{onClick:()=>l(!0),className:"w-full flex items-center justify-between gap-3 transition-all cursor-pointer group",style:{padding:"12px 16px",borderRadius:"12px",border:"1px solid #e5e7eb",backgroundColor:"white",outline:"none",WebkitAppearance:"none"},children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:m?`${m}15`:"#f1f5f9"},children:t?s.jsx("span",{className:"text-xl",children:t.icon}):s.jsx(St,{size:20,className:"text-gray-400"})}),s.jsxs("div",{className:"text-left min-w-0",children:[s.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:t?t.name:"Alle Szenarien"}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:t?`${t.focus}  ${t.targetGroup}`:"Trainings-Setup whlen"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("span",{className:"text-xs font-medium text-gray-400 hidden sm:inline group-hover:text-gray-600",children:"ndern"}),s.jsx(ct,{size:18,className:"text-gray-400 group-hover:text-gray-600"})]})]})]}),Id.createPortal(s.jsx(De,{children:a&&s.jsxs(s.Fragment,{children:[s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>l(!1),className:"fixed inset-0 bg-black/40 backdrop-blur-sm",style:{zIndex:9999}}),s.jsx("div",{className:"fixed inset-0 flex items-end sm:items-center justify-center sm:p-4",style:{zIndex:1e4},children:s.jsxs(V.div,{initial:{opacity:0,y:c?100:20,scale:c?1:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:c?100:20,scale:c?1:.95},transition:{type:"spring",damping:25,stiffness:400},className:"w-full sm:max-w-2xl bg-white shadow-2xl flex flex-col",style:{maxHeight:c?"calc(100vh - 60px)":"calc(100vh - 2rem)",borderRadius:c?"20px 20px 0 0":"16px"},children:[s.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-gray-100 flex-shrink-0",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Trainings-Setup whlen"}),s.jsx("p",{className:"text-sm text-gray-500 mt-0.5 hidden sm:block",children:"Whle deinen Schwerpunkt fr passende Trainingsszenarien"})]}),s.jsx("button",{onClick:()=>l(!1),className:"flex items-center justify-center transition-colors flex-shrink-0",style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:"#f3f4f6",border:"none",outline:"none",cursor:"pointer",WebkitAppearance:"none"},children:s.jsx(Ot,{size:18,style:{color:"#6b7280"}})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-5 overscroll-contain",style:{WebkitOverflowScrolling:"touch"},children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map(x=>s.jsx(Kj,{setup:x,isSelected:t?.id===x.id,onSelect:()=>h(x.id)},x.id))})}),s.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-t border-gray-100 bg-gray-50/80 flex-shrink-0",style:{paddingBottom:c?"max(16px, env(safe-area-inset-bottom))":void 0},children:[s.jsx("button",{onClick:p,className:"transition-colors",style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid #e5e7eb",backgroundColor:"white",color:"#4b5563",fontSize:"14px",fontWeight:500,cursor:"pointer",outline:"none",WebkitAppearance:"none"},children:"Alle anzeigen"}),s.jsx("button",{onClick:()=>l(!1),className:"transition-all",style:{padding:"8px 20px",borderRadius:"8px",border:"none",background:u,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",outline:"none",WebkitAppearance:"none"},children:"Fertig"})]})]})})]})}),document.body)]})},Bo=({onNavigate:t})=>{const{branding:e,partnerName:n,isWhiteLabel:i,dashboardTitle:r,dashboardHook:o,currentSetup:a}=Ue(),l=e?.["--header-gradient"]||Ie["--header-gradient"];e?.["--header-text"]||Ie["--header-text"];const c=e?.["--primary-accent"]||Ie["--primary-accent"],d=[{id:"smart_briefing",icon:St,title:"Smart Briefing",subtitle:"KI-Vorbereitungs-Assistent",description:"Erhalte massgeschneiderte Briefings fr deine Gesprche. Die KI erstellt dir Insider-Wissen, fachliche Must-Haves und clevere Rckfragen - basierend auf deinen spezifischen Angaben.",highlights:["Personalisierte Gesprchsvorbereitung","Branchenspezifisches Wissen","Intelligente Rckfragen-Vorschlge"],gradient:"linear-gradient(135deg, #EC4899 0%, #DB2777 100%)",accentColor:"#EC4899"},{id:"simulator",icon:et,title:"Szenario-Training",subtitle:"Gezielte Vorbereitung",description:"Trainiere mit vorbereiteten Fragen und erhalte sofortiges KI-Feedback zu jeder Antwort. Perfekt fr die systematische Vorbereitung auf entscheidende Gesprche, Verhandlungen und Pitches.",highlights:["Vordefinierte Business-Szenarien","Sofortiges Feedback nach jeder Antwort","Strukturierte Auswertung"],gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",accentColor:"#10B981"},{id:"video_training",icon:bt,title:"Wirkungs-Analyse",subtitle:"Auftreten & Prsenz perfektionieren",description:"Nimm dich selbst auf Video auf und erhalte eine detaillierte KI-Analyse zu Krpersprache, Mimik und rhetorischer Wirkung. Ideal fr Prsentationen, Pitches und den professionellen Auftritt.",highlights:["Video-Selbstaufnahme","Analyse von Krpersprache & Charisma","Konkrete Verbesserungsvorschlge"],gradient:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",accentColor:"#8B5CF6"},{id:"dashboard",icon:Ye,title:"Live-Simulationen",subtitle:"Realistische Dialog-Szenarien",description:"Fhre echte Gesprche mit einem KI-Sparringspartner in Echtzeit. Die natrlichste Art, schwierige Gesprchssituationen zu ben  von der Verhandlung bis zum Feedbackgesprch.",highlights:["Echtzeit-Sprachkonversation","Verschiedene Gesprchspartner-Persnlichkeiten","Vollstndiges Gesprchs-Feedback"],gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",accentColor:"#3B82F6"},{id:"gym_klassiker",icon:hu,title:"Rhetorik-Gym",subtitle:"Ausdrucksweise schrfen",description:"Trainiere deine Ausdrucksweise effizient: Reduziere Fllwrter, verbessere dein Sprechtempo und wirke souverner und berzeugender in jedem Meeting.",highlights:["Fllwort-Erkennung","Sprechtempo-Analyse","Gamification & Highscores"],gradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",accentColor:"#F59E0B"}],u={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},h={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},p=m=>{t&&t(m)};return s.jsxs("div",{className:"min-h-screen py-6 lg:py-10 px-4 lg:px-6",children:[s.jsxs(V.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full text-center mb-10 lg:mb-14 px-4 lg:px-8",children:[s.jsxs("h1",{style:{fontSize:"clamp(28px, 5vw, 42px)",fontWeight:800,color:"#0f172a",marginBottom:"16px",lineHeight:1.2},children:["Willkommen im"," ",s.jsx("span",{style:{background:l,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Trainingscenter"})]}),(r||o)&&s.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15,duration:.4},style:{marginBottom:"24px",padding:"20px 24px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(147, 51, 234, 0.06) 100%)",borderRadius:"16px",border:"1px solid rgba(59, 130, 246, 0.15)",maxWidth:"700px",margin:"0 auto 24px"},children:[r&&s.jsx("h2",{style:{fontSize:"clamp(20px, 3vw, 26px)",fontWeight:700,color:"#0f172a",marginBottom:o?"8px":"0",lineHeight:1.3},children:r}),o&&s.jsx("p",{style:{fontSize:"clamp(15px, 2vw, 17px)",color:"#475569",margin:0,lineHeight:1.6},children:o})]}),s.jsx("p",{style:{fontSize:"clamp(16px, 2.5vw, 20px)",color:"#475569",maxWidth:"700px",margin:"0 auto 32px",lineHeight:1.6},children:"Bereite dich optimal auf Bewerbungsgesprche vor. Whle einen Trainingsbereich und starte dein persnliches Coaching."}),s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},style:{display:"flex",justifyContent:"center",gap:"32px",flexWrap:"wrap"},children:[{icon:rl,label:"KI-Feedback",value:"Sofort"},{icon:ko,label:"Trainingsmodi",value:"4"},{icon:dn,label:"Fortschritt",value:"Messbar"}].map((m,x)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"rgba(59, 130, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(m.icon,{style:{width:"20px",height:"20px",color:c}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a"},children:m.value}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:m.label})]})]},x))})]}),s.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},className:"w-full px-4 lg:px-8 mb-10",children:s.jsx(Jj,{})}),s.jsx(V.div,{variants:u,initial:"hidden",animate:"visible",className:"w-full px-4 lg:px-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 280px), 1fr))",gap:"20px"},children:d.map(m=>s.jsxs(V.div,{variants:h,whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},onClick:()=>p(m.id),style:{background:"white",borderRadius:"24px",padding:"28px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)",transition:"box-shadow 0.3s ease",display:"flex",flexDirection:"column",height:"100%"},onMouseEnter:x=>{x.currentTarget.style.boxShadow="0 20px 40px -12px rgba(0, 0, 0, 0.15)"},onMouseLeave:x=>{x.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:m.gradient,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 8px 16px -4px ${m.accentColor}40`},children:s.jsx(m.icon,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:s.jsx(Eo,{style:{width:"18px",height:"18px",color:"#64748b"}})})]}),s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsx("h3",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"4px"},children:m.title}),s.jsx("p",{style:{fontSize:"14px",fontWeight:500,color:m.accentColor},children:m.subtitle})]}),s.jsx("p",{style:{fontSize:"15px",color:"#475569",lineHeight:1.6,marginBottom:"20px",flex:1},children:m.description}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",paddingTop:"16px",borderTop:"1px solid #f1f5f9"},children:m.highlights.map((x,g)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(Zi,{style:{width:"16px",height:"16px",color:m.accentColor,flexShrink:0}}),s.jsx("span",{style:{fontSize:"14px",color:"#334155"},children:x})]},g))})]},m.id))}),s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.4},style:{maxWidth:"700px",margin:"48px auto 0",textAlign:"center",padding:"32px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%)",borderRadius:"20px",border:"1px solid rgba(59, 130, 246, 0.1)"},children:[s.jsx("h3",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Bereit fr dein Training?"}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",marginBottom:"0"},children:"Whle einen der Trainingsbereiche oben aus und starte sofort mit deinem persnlichen Coaching."})]})]})};var Dp;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(Dp||(Dp={}));var zp;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(zp||(zp={}));var Op;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Op||(Op={}));const Lp=["user","model","function","system"];var Bp;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Bp||(Bp={}));var Fp;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Fp||(Fp={}));var Wp;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Wp||(Wp={}));var Up;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(Up||(Up={}));var qr;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(qr||(qr={}));var $p;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})($p||($p={}));var Vp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Vp||(Vp={}));var Gp;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Gp||(Gp={}));class on extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Ds extends on{constructor(e,n){super(e),this.response=n}}class Kx extends on{constructor(e,n,i,r){super(e),this.status=n,this.statusText=i,this.errorDetails=r}}class Vi extends on{}const Yj="https://generativelanguage.googleapis.com",Xj="v1beta",Zj="0.21.0",Qj="genai-js";var Cs;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Cs||(Cs={}));class eT{constructor(e,n,i,r,o){this.model=e,this.task=n,this.apiKey=i,this.stream=r,this.requestOptions=o}toString(){var e,n;const i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Xj;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Yj}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function tT(t){const e=[];return t?.apiClient&&e.push(t.apiClient),e.push(`${Qj}/${Zj}`),e.join(" ")}async function nT(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",tT(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let i=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(r){throw new Vi(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${r.message}`)}for(const[r,o]of i.entries()){if(r==="x-goog-api-key")throw new Vi(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new Vi(`Header name ${r} can only be set using the apiClient field`);n.append(r,o)}}return n}async function iT(t,e,n,i,r,o){const a=new eT(t,e,n,i,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},aT(o)),{method:"POST",headers:await nT(a),body:r})}}async function Po(t,e,n,i,r,o={},a=fetch){const{url:l,fetchOptions:c}=await iT(t,e,n,i,r,o);return sT(l,c,a)}async function sT(t,e,n=fetch){let i;try{i=await n(t,e)}catch(r){rT(r,t)}return i.ok||await oT(i,t),i}function rT(t,e){let n=t;throw t instanceof Kx||t instanceof Vi||(n=new on(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function oT(t,e){let n="",i;try{const r=await t.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,i=r.error.details)}catch{}throw new Kx(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,i)}function aT(t){const e={};if(t?.signal!==void 0||t?.timeout>=0){const n=new AbortController;t?.timeout>=0&&setTimeout(()=>n.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function xu(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),oa(t.candidates[0]))throw new Ds(`${Bi(t)}`,t);return lT(t)}else if(t.promptFeedback)throw new Ds(`Text not available. ${Bi(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),oa(t.candidates[0]))throw new Ds(`${Bi(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Hp(t)[0]}else if(t.promptFeedback)throw new Ds(`Function call not available. ${Bi(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),oa(t.candidates[0]))throw new Ds(`${Bi(t)}`,t);return Hp(t)}else if(t.promptFeedback)throw new Ds(`Function call not available. ${Bi(t)}`,t)},t}function lT(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function Hp(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const cT=[qr.RECITATION,qr.SAFETY,qr.LANGUAGE];function oa(t){return!!t.finishReason&&cT.includes(t.finishReason)}function Bi(t){var e,n,i;let r="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)r+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((i=t.candidates)===null||i===void 0)&&i[0]){const o=t.candidates[0];oa(o)&&(r+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(r+=`: ${o.finishMessage}`))}return r}function lo(t){return this instanceof lo?(this.v=t,this):new lo(t)}function dT(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(p){i[p]&&(r[p]=function(m){return new Promise(function(x,g){o.push([p,m,x,g])>1||l(p,m)})})}function l(p,m){try{c(i[p](m))}catch(x){h(o[0][3],x)}}function c(p){p.value instanceof lo?Promise.resolve(p.value.v).then(d,u):h(o[0][2],p)}function d(p){l("next",p)}function u(p){l("throw",p)}function h(p,m){p(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}const qp=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function uT(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=fT(e),[i,r]=n.tee();return{stream:pT(i),response:hT(r)}}async function hT(t){const e=[],n=t.getReader();for(;;){const{done:i,value:r}=await n.read();if(i)return xu(gT(e));e.push(r)}}function pT(t){return dT(this,arguments,function*(){const n=t.getReader();for(;;){const{value:i,done:r}=yield lo(n.read());if(r)break;yield yield lo(xu(i))}})}function fT(t){const e=t.getReader();return new ReadableStream({start(i){let r="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(r.trim()){i.error(new on("Failed to parse stream"));return}i.close();return}r+=a;let c=r.match(qp),d;for(;c;){try{d=JSON.parse(c[1])}catch{i.error(new on(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(d),r=r.substring(c[0].length),c=r.match(qp)}return o()})}}})}function gT(t){const e=t[t.length-1],n={promptFeedback:e?.promptFeedback};for(const i of t){if(i.candidates)for(const r of i.candidates){const o=r.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:r.index}),n.candidates[o].citationMetadata=r.citationMetadata,n.candidates[o].groundingMetadata=r.groundingMetadata,n.candidates[o].finishReason=r.finishReason,n.candidates[o].finishMessage=r.finishMessage,n.candidates[o].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[o].content||(n.candidates[o].content={role:r.content.role||"user",parts:[]});const a={};for(const l of r.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),n.candidates[o].content.parts.push(a)}}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function Jx(t,e,n,i){const r=await Po(e,Cs.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),i);return uT(r)}async function Yx(t,e,n,i){const o=await(await Po(e,Cs.GENERATE_CONTENT,t,!1,JSON.stringify(n),i)).json();return{response:xu(o)}}function Xx(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function co(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return mT(e)}function mT(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,r=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),r=!0):(e.parts.push(o),i=!0);if(i&&r)throw new on("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new on("No content is provided for sending chat message.");return i?e:n}function xT(t,e){var n;let i={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(n=e?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=t.generateContentRequest!=null;if(t.contents){if(r)throw new Vi("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=t.contents}else if(r)i=Object.assign(Object.assign({},i),t.generateContentRequest);else{const o=co(t);i.contents=[o]}return{generateContentRequest:i}}function Kp(t){let e;return t.contents?e=t:e={contents:[co(t)]},t.systemInstruction&&(e.systemInstruction=Xx(t.systemInstruction)),e}function yT(t){return typeof t=="string"||Array.isArray(t)?{content:co(t)}:t}const Jp=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],bT={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function vT(t){let e=!1;for(const n of t){const{role:i,parts:r}=n;if(!e&&i!=="user")throw new on(`First content should be with role 'user', got ${i}`);if(!Lp.includes(i))throw new on(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Lp)}`);if(!Array.isArray(r))throw new on("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new on("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of r)for(const c of Jp)c in l&&(o[c]+=1);const a=bT[i];for(const l of Jp)if(!a.includes(l)&&o[l]>0)throw new on(`Content with role '${i}' can't contain '${l}' part`);e=!0}}const Yp="SILENT_ERROR";class ST{constructor(e,n,i,r={}){this.model=n,this.params=i,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i?.history&&(vT(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=co(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n);let p;return this._sendPromise=this._sendPromise.then(()=>Yx(this._apiKey,this.model,u,h)).then(m=>{var x;if(m.response.candidates&&m.response.candidates.length>0){this._history.push(d);const g=Object.assign({parts:[],role:"model"},(x=m.response.candidates)===null||x===void 0?void 0:x[0].content);this._history.push(g)}else{const g=Bi(m.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}p=m}),await this._sendPromise,p}async sendMessageStream(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=co(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n),p=Jx(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>p).catch(m=>{throw new Error(Yp)}).then(m=>m.response).then(m=>{if(m.candidates&&m.candidates.length>0){this._history.push(d);const x=Object.assign({},m.candidates[0].content);x.role||(x.role="model"),this._history.push(x)}else{const x=Bi(m);x&&console.warn(`sendMessageStream() was unsuccessful. ${x}. Inspect response object for details.`)}}).catch(m=>{m.message!==Yp&&console.error(m)}),p}}async function kT(t,e,n,i){return(await Po(e,Cs.COUNT_TOKENS,t,!1,JSON.stringify(n),i)).json()}async function CT(t,e,n,i){return(await Po(e,Cs.EMBED_CONTENT,t,!1,JSON.stringify(n),i)).json()}async function wT(t,e,n,i){const r=n.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Po(e,Cs.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:r}),i)).json()}class Xp{constructor(e,n,i={}){this.apiKey=e,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=Xx(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var i;const r=Kp(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Yx(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}async generateContentStream(e,n={}){var i;const r=Kp(e),o=Object.assign(Object.assign({},this._requestOptions),n);return Jx(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}startChat(e){var n;return new ST(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const i=xT(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return kT(this.apiKey,this.model,i,r)}async embedContent(e,n={}){const i=yT(e),r=Object.assign(Object.assign({},this._requestOptions),n);return CT(this.apiKey,this.model,i,r)}async batchEmbedContents(e,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return wT(this.apiKey,this.model,e,i)}}class Zx{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new on("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Xp(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,i){if(!e.name)throw new Vi("Cached content must contain a `name` field.");if(!e.model)throw new Vi("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const a of r)if(n?.[a]&&e[a]&&n?.[a]!==e[a]){if(a==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new Vi(`Different value for "${a}" specified in modelParams (${n[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Xp(this.apiKey,o,i)}}const Qx={FALLBACK_ORDER:["gemini-2.5-flash","gemini-2.0-flash","gemini-1.5-flash-latest"]},uo={API_KEY_MISSING:"Gemini API key is required",AUDIO_FILE_MISSING:"Audio file is required",TRANSCRIPT_EMPTY:"Transcript is empty",JSON_PARSE_FAILED:"Fehler beim Parsen der Antwort"};function jT(t,e={}){const{roleType:n="interview",userRoleLabel:i="Bewerber",agentRoleLabel:r="Gesprchspartner"}=e;return n==="simulation"?ET(t,i,r):TT(t,i,r)}function TT(t,e,n){return`Du bist ein professioneller Karriere-Coach. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des ${n} (z.B. "H. Mller", "${n}", oder hnliche Kennzeichnungen) dienen NUR als Kontext fr die Fragen.
- Dein gesamtes Feedback, alle Strken, Verbesserungen, Tipps und Bewertungen beziehen sich NUR auf die Antworten und das Verhalten des/der ${e}.
- Bewerte NICHT die Qualitt der Fragen oder das Verhalten des ${n}.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung des Gesamteindrucks des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung",
    "Strke 2: Was gut gemacht wurde",
    "Strke 3: Weitere Strken"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich",
    "Verbesserung 2: Was besser gemacht werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung",
    "Tipp 2: Praktischer Ratschlag",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Antworten des/der ${e}:
- Struktur & Klarheit der Antworten
- Inhalt & Beispiele, die genannt werden
- Motivation & Begeisterung
- Professionalitt & Selbstbewusstsein

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen.

Transkript:
${t}

JSON Feedback:`}function ET(t,e,n){return`Du bist ein professioneller Coach fr Kommunikation und Gesprchsfhrung. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

KONTEXT: Dies ist eine Simulation, bei der der/die ${e} das Gesprch fhrt und der/die ${n} darauf reagiert.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des/der ${n} dienen als Kontext fr die Reaktionen.
- Dein gesamtes Feedback bezieht sich NUR auf die Gesprchsfhrung, Reaktionen und das Verhalten des/der ${e}.
- Bewerte die Fhigkeit, das Gesprch professionell zu fhren und auf den/die ${n} einzugehen.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung der Gesprchsfhrung des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung zur Gesprchsfhrung",
    "Strke 2: Was in der Kommunikation gut gemacht wurde",
    "Strke 3: Weitere Strken im Umgang mit dem/der ${n}"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich in der Gesprchsfhrung",
    "Verbesserung 2: Wie besser auf den/die ${n} eingegangen werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung fr hnliche Situationen",
    "Tipp 2: Praktischer Ratschlag zur Gesprchsfhrung",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Gesprchsfhrung des/der ${e}:
- Gesprchsfhrung & Struktur (Wie gut wurde das Gesprch geleitet?)
- Kundenorientierung & Empathie (Wie gut wurde auf den/die ${n} eingegangen?)
- Problemlsungskompetenz (Wie effektiv wurden Anliegen bearbeitet?)
- Professionalitt & Souvernitt (Wie professionell war das Auftreten?)

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen fr die Gesprchsfhrung.

Transkript:
${t}

JSON Feedback:`}function RT(t,e){return t.replace("${transcript}",e)}const IT=["hm","h","h","Mh","Halt","Eigentlich","Sozusagen","Quasi","Irgendwie","Also","Genau","Ja also"];function e0(){return`${IT.slice(0,9).map(e=>`"${e}"`).join(", ")}, "Also" (am Satzanfang), "Genau" (als Fllwort), "Ja also"`}const bs="[Keine Sprache erkannt]";function t0(){return`ABSOLUTE REGEL - KEINE HALLUZINATION:
Du DARFST NUR transkribieren, was TATSCHLICH in der Audio-Datei gesprochen wird.
- Bei Stille, Rauschen, oder unverstndlichem Audio: transcript = "${bs}"
- Bei nur 1-2 Sekunden Audio ohne klare Sprache: transcript = "${bs}"
- ERFINDE NIEMALS Wrter, Stze oder Inhalte!
- Wenn du unsicher bist, ob etwas gesagt wurde: NICHT transkribieren!
- Wenn jemand nur "Wei ich nicht" oder "Keine Ahnung" sagt, transkribiere GENAU DAS
- Eine kurze Antwort wie "Ich wei es nicht" ist eine valide Transkription
- HALLUZINIERE KEINE ausfhrlichen Antworten wenn der Sprecher das nicht gesagt hat`}function yu(t="game"){const e="Es wurde keine Sprache erkannt. Bitte stellen Sie sicher, dass Ihr Mikrofon funktioniert und Sie whrend der Aufnahme sprechen.";switch(t){case"game":return{transcript:bs,filler_words:[],content_score:0,content_feedback:e};case"analysis":return{audio_metrics:{summary_text:e,confidence_score:0,speech_cleanliness:{score:0,total_filler_count:0,filler_word_analysis:[],feedback:"Keine Sprache zur Analyse erkannt."},pacing:{rating:"keine_sprache",estimated_wpm:0,issues_detected:[],feedback:"Keine Sprache zur Analyse erkannt."},tonality:{rating:"keine_sprache",emotional_tone:"neutral",highlights:[],feedback:"Keine Sprache zur Analyse erkannt."}}};case"simulator":return{transcript:bs,feedback:{summary:e,strengths:[],improvements:["Bitte versuchen Sie es erneut und sprechen Sie klar und deutlich ins Mikrofon."],tips:["Achten Sie darauf, dass Ihr Mikrofon funktioniert und nicht stummgeschaltet ist."],scores:{content:0,structure:0,relevance:0,delivery:0,overall:0}},audio_metrics:{speech_rate:"keine_sprache",filler_words:{count:0,words:[],severity:"keine"},confidence_score:0,clarity_score:0,notes:"Keine Sprache erkannt"}};default:return{transcript:bs,error:e}}}const bu=5e3;function AT(t={}){const{userRoleLabel:e="Bewerber",agentRoleLabel:n="Gesprchspartner",roleType:i="interview",hasTwoVoices:r=!0,transcript:o=null}=t,a=r?`
WICHTIG - STIMMEN-TRENNUNG:
Die Aufnahme enthlt ZWEI Stimmen:
1. ${n.toUpperCase()} (KI-Stimme, synthetisch, akzentfrei)
2. ${e.toUpperCase()} (menschliche Stimme, natrliche Varianz)

Der/Die ${n} erffnet typischerweise das Gesprch.
Analysiere AUSSCHLIESSLICH die Stimme des/der ${e.toUpperCase()}.
Ignoriere alle uerungen des/der ${n} komplett.
`:`
STIMM-ANALYSE:
Die Aufnahme enthlt nur EINE Stimme: ${e.toUpperCase()}.
Analysiere diese Stimme vollstndig.
`,l=o?`
TRANSKRIPT-REFERENZ:
Das folgende Transkript zeigt, wer was gesagt hat. Nutze es zur Orientierung:

${o}

Hinweis: Das Transkript hilft bei der Zuordnung. Die paraverbale Analyse (WIE etwas gesagt wird)
basiert aber auf dem AUDIO - nicht auf dem Text.
`:"";return`Du bist ein professioneller Voice-Coach und Kommunikationsexperte bei "KarriereHeld".
Deine Aufgabe: Analysiere die paraverbale Kommunikation im Audio.

Paraverbal = WIE etwas gesagt wird (nicht WAS gesagt wird).

${t0()}
${a}
${l}

ANALYSE-DIMENSIONEN (nur ${e.toUpperCase()})


1. FLLWRTER (Speech Cleanliness)
   
   Erkenne diese Fllwrter: ${e0()}

   Fr jedes Fllwort dokumentiere:
   - Exakter Zeitstempel (MM:SS)
   - Kontext (z.B. "Satzanfang", "beim Nachdenken", "Themenwechsel")

   Bewertungsmastab:
   - 0 Fllwrter: 100 Punkte (Exzellent)
   - 1-2 Fllwrter: 85-95 Punkte (Sehr gut)
   - 3-5 Fllwrter: 65-80 Punkte (Akzeptabel)
   - 6-10 Fllwrter: 40-60 Punkte (Verbesserungsbedarf)
   - 10+ Fllwrter: 0-35 Punkte (Deutlicher bungsbedarf)

2. SPRECHTEMPO (Pacing)
   
   Optimales Tempo: 120-150 Wrter pro Minute (WPM)

   Achte auf:
   - Durchschnittliches Tempo
   - Tempo-Variationen (monoton vs. dynamisch)
   - Auffllige Stellen (zu schnell/langsam) mit Zeitstempel

   Bewertung:
   - "optimal": 120-150 WPM, natrliche Variation
   - "zu_schnell": >160 WPM, gehetzt, atemlos
   - "zu_langsam": <100 WPM, schleppend, unsicher
   - "ungleichmaessig": Starke Schwankungen

3. TONALITT (Melodie & Betonung)
   
   Analysiere:
   - Stimmmelodie (monoton / natrlich / lebendig)
   - Betonungen (passend / fehlend / bertrieben)
   - Emotionale Frbung (neutral / engagiert / nervs)

   Dokumentiere Highlights und Lowlights:
   - Positive Momente: Souverne Passagen, gute Betonungen
   - Negative Momente: Unsichere Stellen, Stimmbrche, Monotonie

4. SELBSTSICHERHEIT (Confidence)
   
   Gesamteindruck: Wie sicher und kompetent wirkt die Stimme?

   Indikatoren fr hohe Confidence:
    Klare, feste Stimme
    Angemessenes Tempo
    Gute Pausen (bewusst, nicht nervs)
    Natrliche Betonungen

   Indikatoren fr niedrige Confidence:
    Zittrige oder leise Stimme
    Viele Fllwrter
    Hastiges Sprechen
    Aufsteigende Satzenden (Unsicherheit)


OUTPUT FORMAT (nur valides JSON, kein Markdown)


{
  "audio_metrics": {
    "summary_text": "2-3 Stze Gesamtfazit zur Stimmwirkung des/der ${e}. Was war gut? Was kann verbessert werden?",
    "confidence_score": <0-100>,

    "speech_cleanliness": {
      "score": <0-100>,
      "total_filler_count": <Anzahl>,
      "filler_word_analysis": [
        {
          "word": "hm",
          "count": <Anzahl>,
          "examples": [
            {"timestamp": "00:45", "context": "Satzanfang"},
            {"timestamp": "01:20", "context": "beim Nachdenken"}
          ]
        }
      ],
      "feedback": "Konkreter Tipp zur Vermeidung"
    },

    "pacing": {
      "rating": "optimal" | "zu_schnell" | "zu_langsam" | "ungleichmaessig",
      "estimated_wpm": <Zahl>,
      "issues_detected": [
        {"timestamp": "02:10", "issue": "Beschreibung des Problems"}
      ],
      "feedback": "Konkreter Tipp zum Tempo"
    },

    "tonality": {
      "rating": "monoton" | "natrlich" | "lebendig",
      "emotional_tone": "neutral" | "engagiert" | "nervs" | "enthusiastisch",
      "highlights": [
        {"timestamp": "00:30", "type": "positive", "note": "Souverner Einstieg"},
        {"timestamp": "03:15", "type": "negative", "note": "Stimme wird unsicher"}
      ],
      "feedback": "Konkreter Tipp zur Stimmmelodie"
    }
  }
}

Beginne jetzt mit der Analyse:`}const Zp=["Warum bin ich die beste Wahl fr diese Position?","Meine grte berufliche Errungenschaft","Was motiviert mich jeden Tag aufzustehen?","Wie ich mit schwierigen Kollegen umgehe","Mein Fhrungsstil in 60 Sekunden","Die wichtigste Lektion meiner Karriere","Wie ich unter Druck arbeite","Warum Teamarbeit mir wichtig ist","Wenn ich ein Tier wre, welches und warum?","Mein perfekter Tag sieht so aus...","Die beste Erfindung der Menschheit","Wenn ich die Welt verndern knnte...","Ein Buch, das mein Leben verndert hat","Mein Lieblingshobby und warum","Drei Dinge, die ich niemals machen wrde","Warum Scheitern wichtig ist","Meine kontroverseste Meinung","Wie ich mit Kritik umgehe"],Qp=["Warum sollten wir ausgerechnet Sie einstellen und nicht einen der 50 anderen Bewerber?","Ihr Lebenslauf zeigt eine Lcke. Was haben Sie in dieser Zeit wirklich gemacht?","Nennen Sie mir drei echte Schwchen - und bitte keine getarnten Strken.","Warum haben Sie Ihren letzten Job wirklich verlassen?","Wo sehen Sie sich in 5 Jahren? Und seien Sie ehrlich.","Was wrde Ihr schlimmster Feind ber Sie sagen?","Wenn ich Ihren letzten Chef anrufe - was wird er mir sagen?","Sie sind offensichtlich berqualifiziert. Werden Sie nicht schnell gelangweilt sein?","Warum haben Sie in Ihrer Karriere nicht mehr erreicht?","berzeugen Sie mich in 30 Sekunden, dass Sie kein Risiko sind.","Was war Ihr grter beruflicher Misserfolg?","Haben Sie andere Angebote? Warum sind wir nicht Ihre erste Wahl?"];function _T(t="Elevator Pitch",e=60){return`AUDIO-TRANSKRIPTION UND ANALYSE

THEMA: "${t}"

${t0()}

DEINE AUFGABE (NUR bei klar erkennbarer Sprache):
1. TRANSKRIBIEREN: Schreibe WRTLICH was gesprochen wird - nichts hinzufgen
2. FLLWRTER: Finde diese Wrter im Transkript: ${e0()}
3. INHALT: Bewerte wie gut die Antwort zum Thema passt (0-40 Punkte)

INHALTSBEWERTUNG (content_score):
- 0: Keine Sprache / am Thema vorbei / unverstndlich
- 10: Nur ansatzweise zum Thema
- 20: Teilweise zum Thema, aber oberflchlich
- 30: Gut zum Thema, mit Substanz
- 40: Exzellent, strukturiert und berzeugend

OUTPUT - NUR valides JSON:
{
  "transcript": "${bs}",
  "filler_words": [],
  "content_score": 0,
  "content_feedback": "Keine Sprache erkannt."
}

ODER bei erkannter Sprache:
{
  "transcript": "Das was tatschlich gesagt wurde...",
  "filler_words": [{"word": "hm", "count": 1}],
  "content_score": 30,
  "content_feedback": "Kurzes Feedback (1-2 Stze)"
}

ANALYSE DER AUDIO-DATEI:`}const MT={excellent:{range:[90,100],messages:["Perfekt! Du bist ein Rhetorik-Champion!","Wow! Makellose Prsentation!","Ausgezeichnet! So sieht ein Profi aus!"],emoji:""},good:{range:[70,89],messages:["Sehr gut! Nur kleine Verbesserungen ntig.","Stark! Fast perfekt!","Beeindruckend! Weiter so!"],emoji:""},medium:{range:[50,69],messages:["Solide Leistung! bung macht den Meister.","Guter Ansatz! Da geht noch mehr.","Auf dem richtigen Weg!"],emoji:""},needsWork:{range:[30,49],messages:["Nicht schlecht, aber hier ist Potenzial!","Die Fllwrter haben dich erwischt!","Bleib dran - Verbesserung ist mglich!"],emoji:""},poor:{range:[0,29],messages:["hm... da mssen wir ben!","Die Fllwrter haben gewonnen. Revanche?","Kopf hoch! Jeder Profi hat so angefangen."],emoji:""}};function PT(t){for(const[,e]of Object.entries(MT))if(t>=e.range[0]&&t<=e.range[1]){const n=Math.floor(Math.random()*e.messages.length);return{message:e.messages[n],emoji:e.emoji}}return{message:"Weiter ben!",emoji:""}}function NT(){return Zp[Math.floor(Math.random()*Zp.length)]}function DT(){return Qp[Math.floor(Math.random()*Qp.length)]}const zT={klassiker:{id:"klassiker",title:"Der Klassiker",subtitle:"Elevator Pitch",description:"60 Sekunden, um zu berzeugen. Prsentiere dich selbst ohne Fllwrter!",duration:60,icon:"rocket",color:"blue",topic:"Stelle dich selbst vor - wer bist du, was machst du, was ist dein Ziel?"},zufall:{id:"zufall",title:"Zufalls-Thema",subtitle:"Slot Machine",description:"Ein zuflliges Thema, spontan und flieend prsentiert.",duration:60,icon:"shuffle",color:"purple",getTopic:NT},stress:{id:"stress",title:"Stress-Test",subtitle:"berraschungsfrage",description:"Eine knallharte Interview-Frage. Behalte die Nerven!",duration:90,icon:"zap",color:"red",getTopic:DT}},Xs={WEBM:"audio/webm",WEBM_OPUS:"audio/webm;codecs=opus",MP3:"audio/mpeg",WAV:"audio/wav",OGG:"audio/ogg",M4A:"audio/mp4",AAC:"audio/aac"};async function n0(t){return new Promise((e,n)=>{const i=new FileReader;i.onloadend=()=>{const r=i.result.split(",")[1];e(r)},i.onerror=()=>{n(new Error("Failed to read file as base64"))},i.readAsDataURL(t)})}async function i0(t){return{inlineData:{data:await n0(t),mimeType:t.type||Xs.WEBM}}}function OT(t){return typeof MediaRecorder>"u"?!1:MediaRecorder.isTypeSupported(t)}function LT(t=[Xs.WEBM_OPUS,Xs.WEBM,Xs.OGG,Xs.MP3]){for(const e of t)if(OT(e))return e;return null}function vu(t,e={}){const{minSize:n=100,maxSize:i=100*1024*1024,allowedTypes:r=Object.values(Xs)}=e;return t?t.size<n?{valid:!1,error:"Audio-Datei ist zu klein oder leer"}:t.size>i?{valid:!1,error:"Audio-Datei ist zu gro"}:r.length>0&&t.type&&!r.some(a=>t.type.startsWith(a.split(";")[0]))?{valid:!1,error:`Audio-Format nicht untersttzt: ${t.type}`}:{valid:!0}:{valid:!1,error:"Keine Audio-Datei vorhanden"}}const ho=!1;function s0(t){return t.message?.includes("404")||t.message?.includes("not found")}function BT(t){return t.message?.includes("API key")}function FT(t,e){const n=Qx.FALLBACK_ORDER.join(", ");return s0(t)?`Kein Gemini-Modell verfgbar. Versuchte Modelle: ${n}

Mgliche Lsungen:
1. berprfe, ob dein API Key gltig ist
2. Stelle sicher, dass die Gemini API aktiviert ist
3. Besuche https://ai.google.dev/ um deinen API-Key zu berprfen

Fehler: ${t.message}`:BT(t)?`API Key Problem: ${t.message}

Stelle sicher, dass:
1. VITE_GEMINI_API_KEY korrekt in der .env Datei gesetzt ist
2. Der API Key gltig ist (berprfe auf https://ai.google.dev/)`:t.message||"Unbekannter Fehler"}async function No({apiKey:t,content:e,context:n}){const i=`[GEMINI ${n}]`;if(!t)throw console.error(` ${i} API key is missing`),new Error(uo.API_KEY_MISSING);let r=null;for(const a of Qx.FALLBACK_ORDER)try{return(await(await new Zx(t).getGenerativeModel({model:a}).generateContent(e)).response).text()}catch(l){if(console.error(` ${i} Error with ${a}:`,l.message),r=l,s0(l))continue;break}const o=FT(r);throw new Error(`Fehler bei der ${n}: ${o}`)}async function WT(t,e,n="gemini-1.5-flash",i=null,r={}){if(!t||t.trim().length===0)throw console.error(" [GEMINI FEEDBACK] Transcript is empty"),new Error(uo.TRANSCRIPT_EMPTY);const o=i?RT(i,t):jT(t,r),a=r.roleType==="simulation"?"Simulation":"Interview",l=r.userRoleLabel||"Bewerber";`${a}${l}`,`${t.length}`,t.substring(0,300);const c=await No({apiKey:e,content:o,context:"FEEDBACK"});return ue.logPrompt("GEMINI_LIVE_FEEDBACK",`Live-Training Feedback-Generierung (${a})`,o,{transcript_length:t.length,custom_prompt:i?"Ja":"Nein",role_type:r.roleType||"interview",user_role_label:l},c),c}async function UT(t,e,n="gemini-1.5-flash",i={}){if(!t)throw console.error(" [GEMINI AUDIO] Audio file is missing"),new Error(uo.AUDIO_FILE_MISSING);const r=vu(t,{minSize:bu});if(!r.valid)return console.warn(` [GEMINI AUDIO] Audio validation failed: ${r.error}, Size: ${t.size} bytes`),JSON.stringify(yu("analysis"));const o=i.userRoleLabel||"Bewerber",a=i.agentRoleLabel||"Gesprchspartner",l=i.roleType||"interview",c=i.hasTwoVoices!==!1,d=i.transcript||null,u=await i0(t),h=AT({userRoleLabel:o,agentRoleLabel:a,roleType:l,hasTwoVoices:c,transcript:d}),p=[h,u];`${o}`,`${Math.round(t.size/1024)}`,t.type;const m=await No({apiKey:e,content:p,context:"AUDIO"});return ue.logPrompt("GEMINI_LIVE_AUDIO_ANALYSIS",`Live-Training Audio-Analyse (${o})`,h,{audio_size_kb:Math.round(t.size/1024),audio_type:t.type,role_type:l,user_role_label:o},m),m}async function $T(t,e,n="Elevator Pitch",i=60){if(!t)throw console.error(" [GEMINI GAME] Audio file is missing"),new Error(uo.AUDIO_FILE_MISSING);const r=vu(t,{minSize:bu});if(!r.valid)return console.warn(` [GEMINI GAME] Audio validation failed: ${r.error}, Size: ${t.size} bytes`),yu("game");const o=await i0(t),l=[_T(n,i),o];`${Math.round(t.size/1024)}`;const c=await No({apiKey:e,content:l,context:"GAME"});try{let d=c.trim();d.startsWith("```json")?d=d.replace(/```json\n?/,"").replace(/\n?```$/,""):d.startsWith("```")&&(d=d.replace(/```\n?/,"").replace(/\n?```$/,""));const u=JSON.parse(d);return{transcript:u.transcript||bs,filler_words:u.filler_words||[],content_score:Math.max(0,Math.min(40,u.content_score||0)),content_feedback:u.content_feedback||""}}catch(d){throw console.error(" [GEMINI GAME] Failed to parse response:",d),console.error(" [GEMINI GAME] Raw response:",c),new Error(`${uo.JSON_PARSE_FAILED}: ${d.message}`)}}async function VT(t,e){const{topic:n,context:i,pros:r,cons:o,proScore:a,contraScore:l}=t;if(!n||n.trim().length===0)throw new Error("Entscheidungsfrage fehlt");const c=r.map(m=>`- "${m.text}" (Gewicht: ${m.weight}/10)`).join(`
`),d=o.map(m=>`- "${m.text}" (Gewicht: ${m.weight}/10)`).join(`
`),u=i?`
Situationsbeschreibung des Users:
"${i}"
`:"",h=`Du bist 'Decisio', ein analytischer Entscheidungs-Coach.
Deine Aufgabe: Analysiere die Entscheidungsmatrix des Users (Thema, Pro/Contra mit Gewichtung 1-10).
Ziel: Deck blinde Flecken auf und hinterfrage die Gewichtung kritisch. Nimm dem User die Entscheidung NICHT ab, sondern verbessere seine Datengrundlage.

INPUT:
Thema: ${n}
${u}
Pro-Liste (Gesamtpunkte: ${a}):
${c||"(keine Pro-Argumente)"}

Contra-Liste (Gesamtpunkte: ${l}):
${d||"(keine Contra-Argumente)"}

Rationaler Score: ${a>l?"Pro fhrt":l>a?"Contra fhrt":"Ausgeglichen"} (${a} vs ${l})

GENERATION RULES:
1. "Blind Spot": Welcher Lebensbereich (Gesundheit, Langzeit, Familie, Werte, Finanzen, Karriere, Work-Life-Balance) fehlt? Welche Perspektive wurde nicht bercksichtigt?
2. "Challenger": Greife das Argument mit der HCHSTEN Gewichtung an. Ist es wirklich eine ${Math.max(...r.map(m=>m.weight),...o.map(m=>m.weight))}/10? Warum knnte diese Bewertung bertrieben oder unterschtzt sein?
3. "Intuition": Stelle eine systemische Frage (z.B. 10-10-10 Methode: Wie wirst du in 10 Minuten/10 Monaten/10 Jahren darber denken? Oder: Was wrdest du einem Freund in dieser Situation raten?), um das Bauchgefhl zu prfen.

WICHTIG: Antworte AUSSCHLIESSLICH mit einem validen JSON-Objekt. Kein Markdown, kein Intro, keine Erklrung auerhalb des JSON.

FORMATIERUNG DER INHALTE:
- Jede Card soll STRUKTURIERT sein, NICHT als Flietext
- Verwende kurze, prgnante Aufzhlungspunkte
- Maximal 3-5 Punkte pro Card
- Jeder Punkt soll ein konkreter, handlungsorientierter Gedanke sein

JSON SCHEMA:
{
  "analysis_summary": "Ein bis zwei Stze zum rationalen Ergebnis.",
  "cards": [
    {
      "type": "blind_spot",
      "title": "Der blinde Fleck",
      "points": [
        "Erster fehlender Aspekt oder Lebensbereich",
        "Zweiter fehlender Aspekt",
        "Dritter fehlender Aspekt (optional)"
      ]
    },
    {
      "type": "challenger",
      "title": "Der Hrtetest",
      "argument": "Das hinterfragte Argument (z.B. 'Mehr Geld')",
      "points": [
        "Erste kritische Frage zum Argument",
        "Zweite kritische Frage",
        "Dritte kritische Frage (optional)"
      ]
    },
    {
      "type": "intuition",
      "title": "Der Bauch-Check",
      "question": "Die zentrale Reflexionsfrage (z.B. '10-10-10 Methode')",
      "points": [
        "Erster Reflexionsimpuls",
        "Zweiter Reflexionsimpuls",
        "Dritter Reflexionsimpuls (optional)"
      ]
    }
  ]
}`;r.length,o.length,Math.max(...r.map(m=>m.weight),...o.map(m=>m.weight));const p=await No({apiKey:e,content:h,context:"DECISION"});try{let m=p.trim();m.startsWith("```json")?m=m.replace(/```json\n?/,"").replace(/\n?```$/,""):m.startsWith("```")&&(m=m.replace(/```\n?/,"").replace(/\n?```$/,""));const x=JSON.parse(m);if(!x.cards||!Array.isArray(x.cards))throw new Error("Invalid response structure: missing cards array");return ue.logPrompt("GEMINI_DECISION_ANALYSIS","Entscheidungs-Kompass Analyse",h,{topic:n,context:i?"vorhanden":"nicht angegeben",pro_count:r.length,contra_count:o.length,pro_score:a,contra_score:l},p),x}catch(m){throw console.error(" [GEMINI DECISION] Failed to parse response:",m),console.error(" [GEMINI DECISION] Raw response:",p),new Error(`Fehler beim Verarbeiten der Analyse: ${m.message}`)}}async function GT(t,e,n,i=null){if(!t||t.trim().length===0)throw new Error("Entscheidungsfrage fehlt");if(!["strategist","security","feelgood","growth","future"].includes(e))throw new Error(`Ungltige Persona: ${e}`);const o=i?`
Situationsbeschreibung:
"${i}"
`:"",a=`Du bist ein kreativer Entscheidungs-Assistent fr die Karriere-Plattform 'KarriereHeld'.
Deine Aufgabe: Generiere fr eine spezifische Entscheidungsfrage Argumente aus der strikten Sicht einer gewhlten Persona.
${o?"Bercksichtige dabei den Kontext/Hintergrund der Situation.":""}

INPUT:
Thema: ${t}${o}
Persona: ${e}

PERSONA DEFINITIONEN:
- 'strategist' (Der Stratege): Fokus auf CV, Marktwert, Geld, Macht, Karriereleiter, Prestige.
- 'security' (Der Sicherheits-Beauftragte): Fokus auf Arbeitsplatzsicherheit, Gehaltsgarantie, Risikominimierung, Bestndigkeit.
- 'feelgood' (Der Feel-Good Manager): Fokus auf Mental Health, Stresslevel, Team-Kultur, Zeit fr Familie, Spa.
- 'growth' (Der Grnder): Fokus auf steile Lernkurve, Innovation, Netzwerk, "High Risk / High Reward".
- 'future' (Das Zukunfts-Ich): Fokus auf langfristigen Sinn, "Regret Minimization" (Was werde ich in 10 Jahren bereuen?), Lebensziele.

OUTPUT FORMAT (JSON):
Generiere genau 4 Vorschlge (2 Pro, 2 Contra), die extrem kurz und knackig sind (max. 10 Wrter pro Punkt).

WICHTIG: Antworte AUSSCHLIESSLICH mit einem validen JSON-Objekt. Kein Markdown, kein Intro.

{
  "suggestions": [
    { "type": "pro", "text": "Argument fr JA aus Sicht der Persona" },
    { "type": "pro", "text": "Weiteres Argument fr JA..." },
    { "type": "con", "text": "Argument fr NEIN aus Sicht der Persona" },
    { "type": "con", "text": "Weiteres Argument fr NEIN..." }
  ]
}`,l=await No({apiKey:n,content:a,context:"BRAINSTORM"});try{let c=l.trim();c.startsWith("```json")?c=c.replace(/```json\n?/,"").replace(/\n?```$/,""):c.startsWith("```")&&(c=c.replace(/```\n?/,"").replace(/\n?```$/,""));const d=JSON.parse(c);if(!d.suggestions||!Array.isArray(d.suggestions))throw new Error("Invalid response structure: missing suggestions array");return ue.logPrompt("GEMINI_DECISION_BRAINSTORM",`Entscheidungs-Kompass Brainstorming (${e})`,a,{topic:t,context:i?"vorhanden":"nicht angegeben",persona:e},l),d}catch(c){throw console.error(" [GEMINI BRAINSTORM] Failed to parse response:",c),console.error(" [GEMINI BRAINSTORM] Raw response:",l),new Error(`Fehler beim Verarbeiten der Vorschlge: ${c.message}`)}}function r0(t){return!t||typeof t!="string"?t:t.replace(/\\u([0-9a-fA-F]{4})/g,(e,n)=>String.fromCharCode(parseInt(n,16))).replace(new RegExp("(?<!\\\\)u([0-9a-fA-F]{4})","g"),(e,n)=>{const i=parseInt(n,16);return i>=160&&i<=65535?String.fromCharCode(i):e})}function HT(t){if(!t||typeof t!="string")return t;let e=t.trim();return e.startsWith("```json")?e=e.replace(/^```json\s*/i,"").replace(/\s*```\s*$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```\s*$/,"")),e.trim()}function Su(t,e={}){const{silent:n=!1,context:i="JSON"}=e;if(t==null)return null;if(typeof t=="object")return t;if(typeof t!="string")return n||console.warn(`[parseJSON] Expected string or object, got ${typeof t}`),null;try{let r=HT(t);return r=r0(r),JSON.parse(r)}catch(r){return n||(console.error(`[parseJSON] Failed to parse ${i}:`,r.message),console.error(`[parseJSON] Input preview: ${t.substring(0,100)}...`)),null}}function ku(t){return Su(t,{context:"feedback_json"})}function Cu(t){return Su(t,{context:"audio_analysis_json"})}function o0(t){if(!t)return[];const e=Su(t,{context:"transcript"});return Array.isArray(e)?e:[]}function Aa(t){if(t==null)return t;if(typeof t=="string")return r0(t);if(Array.isArray(t))return t.map(Aa);if(typeof t=="object"){const e={};for(const n of Object.keys(t))e[n]=Aa(t[n]);return e}return t}const Fo=t=>new Promise(e=>setTimeout(e,t));async function qT(t,e={},n=null,i=null){if(!t||t.length===0)throw new Error("Transkript ist leer. Das Gesprch muss mindestens einen Austausch enthalten.");const r=KT(t,e),o=ue.getGeminiApiKey();if(!o)throw new Error("Gemini API Key ist nicht konfiguriert. Bitte kontaktiere den Administrator.");const a={feedbackContent:null,audioAnalysisContent:null},l={roleType:e.role_type||"interview",userRoleLabel:e.user_role_label||"Bewerber",agentRoleLabel:e.interviewer_profile?.role||"Gesprchspartner"};try{const c=e.feedback_prompt||null;a.feedbackContent=await WT(r,o,"gemini-1.5-flash",c,l)}catch(c){throw console.error(" [Roleplay Feedback] Failed to generate feedback:",c),new Error(`Fehler bei der Feedback-Generierung: ${c.message}`)}if(n){i&&i("audio_analysis");try{a.audioAnalysisContent=await UT(n,o,"gemini-1.5-flash",{...l,hasTwoVoices:!0,transcript:r})}catch(c){console.error(" [Roleplay Feedback] Failed to generate audio analysis:",c),a.audioAnalysisContent=JSON.stringify({error:!0,summary:"Audio-Analyse konnte nicht durchgefhrt werden.",errorMessage:c.message,troubleshooting:["Stelle sicher, dass dein Mikrofon richtig funktioniert","Versuche das Gesprch erneut zu starten","berprfe, ob keine andere Anwendung das Mikrofon blockiert"]})}}return a}function KT(t,e={}){let n="";e.title&&(n+=`Rollenspiel-Szenario: ${e.title}
`),e.description&&(n+=`Beschreibung: ${e.description}
`),e.variables&&(n+=`
Kontext-Variablen:
`,Object.entries(e.variables).forEach(([o,a])=>{n+=`- ${o}: ${a}
`})),n+=`
--- Gesprchsverlauf ---

`;const i=e.user_role_label||"Bewerber",r=e.interviewer_profile?.role||"Gesprchspartner";return t.forEach(o=>{const a=o.role==="agent"?r:i;n+=`${a}: ${o.text}

`}),n}async function JT(t,e,n,i=null,r=0,o=null){try{let a=e;Array.isArray(e)&&(a=JSON.stringify(e));const l={transcript:a,feedback_json:n,duration:r};i&&(l.audio_analysis_json=i),o&&(l.conversation_id=o);const c=await ue.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify(l)});if(r>0)try{await ue.request(`/roleplays/sessions/${t}/duration`,{method:"POST",body:JSON.stringify({duration_seconds:r})})}catch(d){console.warn(" [Roleplay Feedback] Failed to update usage limits:",d.message)}return c.data}catch(a){throw console.error(" [Roleplay Feedback] ========= SAVE FAILED ========="),console.error(" [Roleplay Feedback] Error:",a),console.error(" [Roleplay Feedback] Error message:",a.message),new Error(`Fehler beim Speichern der Analyse: ${a.message}`)}}async function wu(t){try{return(await ue.request(`/roleplays/sessions/${t}`,{method:"GET"})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to load session analysis:",e),new Error(`Fehler beim Laden der Analyse: ${e.message}`)}}async function YT(t={}){try{const e=new URLSearchParams(t).toString(),n=e?`/roleplays/sessions?${e}`:"/roleplays/sessions";return await ue.request(n,{method:"GET"})}catch(e){throw console.error(" [Roleplay Feedback] Failed to load sessions:",e),new Error(`Fehler beim Laden der Sessions: ${e.message}`)}}function ju(t){return`${(window.bewerbungstrainerConfig||{apiUrl:"/wp-json/bewerbungstrainer/v1"}).apiUrl}/roleplays/sessions/${t}/audio`}async function XT(t,e=10,n=3e3){const i=ju(t);for(let r=1;r<=e;r++)try{const o=await fetch(i,{method:"GET",headers:{"X-WP-Nonce":wt()},credentials:"same-origin"});if(o.ok){const a=await o.blob();if(a.size===0){if(console.warn(" [Roleplay Feedback] Audio blob is empty, retrying..."),r<e){await Fo(n);continue}return null}return a}if(o.status===404&&r<e){await Fo(n);continue}if(console.error(` [Roleplay Feedback] Failed to fetch audio: HTTP ${o.status}`),r<e){await Fo(n);continue}}catch(o){if(console.error(` [Roleplay Feedback] Error fetching audio on attempt ${r}:`,o),r<e){await Fo(n);continue}}return console.warn(" [Roleplay Feedback] All retry attempts failed, audio not available"),null}async function ZT(t,e){try{return(await ue.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify({conversation_id:e})})).data}catch(n){throw console.error(" [Roleplay Feedback] Failed to update session conversation_id:",n),new Error(`Fehler beim Aktualisieren der Session: ${n.message}`)}}async function QT(t){try{return(await ue.request("/roleplays/sessions",{method:"POST",body:JSON.stringify(t)})).data}catch(e){throw console.error(" [Roleplay Feedback] Failed to create session:",e),new Error(`Fehler beim Erstellen der Session: ${e.message}`)}}async function a0(){try{const t=await fetch(`${fn()}/roleplays`,{headers:{"X-WP-Nonce":wt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();return Aa(e.data||[])}catch(t){throw console.error(" [Roleplay Feedback] Failed to load scenarios:",t),new Error(`Fehler beim Laden der Szenarien: ${t.message}`)}}async function l0(t){try{const e=await ue.request(`/roleplays/${t}`,{method:"GET"});return Aa(e.data)}catch(e){throw console.error(" [Roleplay Feedback] Failed to load scenario:",e),new Error(`Fehler beim Laden des Szenarios: ${e.message}`)}}const e2={briefcase:Tn,users:mn,"trending-up":dn,"message-circle":ts,shield:Ii,heart:tl,target:et,folder:_o},Fi=_o,xn=t=>!t||typeof t!="string"?Fi:e2[t.toLowerCase()]||Fi,zs=t=>!t||typeof t!="string"?"":t.toLowerCase().replace(//g,"ae").replace(//g,"oe").replace(//g,"ue").replace(//g,"ss").replace(/[^a-z0-9]/g,""),zl={career:"karriere",leadership:"fuehrung",sales:"vertrieb",communication:"kommunikation",service:"service",social:"social",karriere:"karriere",fuehrung:"fuehrung",vertrieb:"vertrieb",kommunikation:"kommunikation",meine:"meine",selfpresentation:"karriere",interview:"karriere",pitch:"vertrieb",negotiation:"vertrieb",vorstellungsgespraech:"karriere",gehaltsverhandlung:"vertrieb",fuehrungsgespraech:"fuehrung",praesentation:"kommunikation",selbstvorstellung:"karriere",training:"kommunikation"};let Os=null,Ol=null;const t2=300*1e3;function n2(){const[t,e]=f.useState(Os||[]),[n,i]=f.useState(!Os),[r,o]=f.useState(null),a=f.useCallback(async()=>{if(Os&&Ol&&Date.now()-Ol<t2)return e(Os),i(!1),Os;try{i(!0),o(null);const p=await ue.getCategories();return Os=p,Ol=Date.now(),e(p),p}catch(p){return console.error("[useCategories] Failed to fetch categories:",p),o(p.message||"Failed to fetch categories"),[]}finally{i(!1)}},[]);f.useEffect(()=>{a()},[a]);const l=f.useCallback(p=>{if(!p||!t.length)return null;const m=zs(p),x=zl[m]||m,g=t.find(y=>zs(y.slug)===x||zs(y.name)===x);return g?{...g,IconComponent:xn(g.icon),bgColor:`${g.color}15`}:null},[t]),c=f.useCallback(p=>{if(Array.isArray(p)){for(const g of p){if(typeof g!="string")continue;const y=l(g);if(y)return{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:xn(y.icon),IconComponent:xn(y.icon),color:y.color,bgColor:y.bgColor}}const x=p.find(g=>typeof g=="string")||"unknown";return{key:String(x),label:String(x),shortLabel:String(x),icon:Fi,IconComponent:Fi,color:"#64748b",bgColor:"#f1f5f9"}}if(typeof p!="string")return{key:"unknown",label:"Unbekannt",shortLabel:"Unbekannt",icon:Fi,IconComponent:Fi,color:"#64748b",bgColor:"#f1f5f9"};const m=l(p);return m?{key:m.slug,label:m.name,shortLabel:m.shortName||m.name,icon:xn(m.icon),IconComponent:xn(m.icon),color:m.color,bgColor:m.bgColor}:{key:p||"unknown",label:p||"Unbekannt",shortLabel:p||"Unbekannt",icon:Fi,IconComponent:Fi,color:"#64748b",bgColor:"#f1f5f9"}},[l]),d=f.useCallback((p=[])=>{if(!t.length)return[];if(!p.length)return t.map(x=>({key:x.slug,label:x.name,shortLabel:x.shortName||x.name,icon:xn(x.icon),IconComponent:xn(x.icon),color:x.color,bgColor:`${x.color}15`}));const m=new Map;return p.forEach(x=>{if(x){if(Array.isArray(x))x.forEach(g=>{if(!g||typeof g!="string"||!g.trim())return;const y=l(g);y&&!m.has(y.slug)&&m.set(y.slug,{key:y.slug,label:y.name,shortLabel:y.shortName||y.name,icon:xn(y.icon),IconComponent:xn(y.icon),color:y.color,bgColor:y.bgColor})});else if(typeof x=="string"&&x.trim()){const g=l(x);g&&!m.has(g.slug)&&m.set(g.slug,{key:g.slug,label:g.name,shortLabel:g.shortName||g.name,icon:xn(g.icon),IconComponent:xn(g.icon),color:g.color,bgColor:g.bgColor})}}}),Array.from(m.values())},[t,l]),u=f.useCallback((p,m)=>{if(!p||!m)return!1;const x=zs(m);if(Array.isArray(p))return p.some(v=>{const k=zs(v);return(zl[k]||k)===x});const g=zs(p);return(zl[g]||g)===x},[]),h=f.useMemo(()=>{const p=new Map;return t.forEach(m=>{p.set(m.slug,{...m,IconComponent:xn(m.icon),bgColor:`${m.color}15`})}),p},[t]);return{categories:t,categoriesMap:h,loading:n,error:r,refetch:a,getCategoryBySlug:l,getCategoryConfig:c,getCategoriesForFilter:d,matchesCategory:u}}const Ve=()=>{const{branding:t}=Ue();return f.useMemo(()=>{const e=n=>t?.[n]||Ie[n];return{headerGradient:e("--header-gradient"),headerText:e("--header-text"),buttonGradient:t?.["--button-gradient"]||e("--header-gradient"),buttonGradientHover:e("--button-gradient-hover"),buttonSolid:e("--button-solid"),buttonSolidHover:e("--button-solid-hover"),buttonText:e("--button-text")||"#ffffff",primaryAccent:e("--primary-accent"),primaryAccentLight:e("--primary-accent-light"),primaryAccentHover:e("--primary-accent-hover"),primaryAccentDark:e("--primary-accent-hover"),appBgColor:e("--app-bg-color"),cardBgColor:e("--card-bg-color")||"#ffffff",cardBgHover:e("--card-bg-hover")||"#f8fafc",sidebarBgColor:e("--sidebar-bg-color"),sidebarTextColor:e("--sidebar-text-color"),sidebarTextMuted:e("--sidebar-text-muted"),sidebarActiveBg:e("--sidebar-active-bg"),sidebarActiveText:e("--sidebar-active-text"),sidebarHoverBg:e("--sidebar-hover-bg"),textMain:e("--text-main")||"#0f172a",textSecondary:e("--text-secondary")||"#475569",textMuted:e("--text-muted")||"#94a3b8",textPrimary:e("--text-main")||"#0f172a",borderColor:e("--border-color")||"#e2e8f0",borderColorLight:e("--border-color-light")||"#f1f5f9",iconPrimary:e("--icon-primary"),iconSecondary:e("--icon-secondary"),iconMuted:e("--icon-muted")||"#94a3b8",iconColor:e("--icon-primary"),iconActiveColor:e("--icon-secondary"),focusRing:e("--focus-ring")||"rgba(58, 127, 167, 0.3)",success:"#10b981",successLight:"#d1fae5",successDark:"#059669",error:"#ef4444",errorLight:"#fee2e2",errorDark:"#dc2626",warning:"#f59e0b",warningLight:"#fef3c7",warningDark:"#d97706",info:"#3b82f6",infoLight:"#dbeafe",infoDark:"#2563eb",overlayLight:"rgba(255, 255, 255, 0.8)",overlayDark:"rgba(0, 0, 0, 0.5)",backdropBlur:"rgba(255, 255, 255, 0.9)",white:"#ffffff",transparent:"transparent",disabledBg:"#cbd5e1",shadow:Pv,radius:Mv,breakpoint:_v,fontSize:Av,fontWeight:Iv,space:Rv,transition:Ev,zIndex:Tv,iconSize:jv,component:wv,coloredShadow:Cv,raw:t}},[t])},ef={easy:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einfach"},beginner:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einsteiger"},medium:{classes:"bg-yellow-100 text-yellow-800 border-yellow-200",label:"Mittel"},intermediate:{classes:"bg-blue-100 text-blue-800 border-blue-200",label:"Fortgeschritten"},hard:{classes:"bg-red-100 text-red-800 border-red-200",label:"Schwer"},advanced:{classes:"bg-purple-100 text-purple-800 border-purple-200",label:"Experte"}},i2=t=>ef[t]||ef.medium,qc=({children:t,className:e="",style:n={}})=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${e}`,style:n,children:t}),c0=({icon:t,gradient:e,textColor:n,size:i="md"})=>{const r={sm:{container:"40px",icon:"20px",radius:"10px"},md:{container:"48px",icon:"24px",radius:"12px"},lg:{container:"56px",icon:"28px",radius:"14px"}},o=r[i]||r.md;return s.jsx("div",{style:{width:o.container,height:o.container,borderRadius:o.radius,background:e,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(t,{style:{width:o.icon,height:o.icon,color:n}})})},d0=({icon:t,text:e})=>s.jsxs("div",{className:"flex items-center gap-1",children:[t&&s.jsx(t,{className:"w-3 h-3"}),s.jsx("span",{children:e})]}),s2=({label:t,icon:e,color:n})=>s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold",style:{color:n},children:[s.jsx("span",{children:t}),e&&s.jsx(e,{className:"w-4 h-4"})]}),r2=({viewMode:t,onViewChange:e})=>{const n=Ve(),i=o=>({padding:n.space[2],borderRadius:n.radius.md,border:"none",cursor:"pointer",transition:n.transition.normal,backgroundColor:o?"#ffffff":"transparent",boxShadow:o?n.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"}),r=o=>({width:"16px",height:"16px",color:o?n.primaryAccent:R.slate[500]});return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[1],padding:n.space[1],backgroundColor:R.slate[100],borderRadius:n.radius.lg},children:[s.jsx("button",{onClick:()=>e("grid"),style:i(t==="grid"),title:"Kachelansicht",children:s.jsx(Lr,{style:r(t==="grid")})}),s.jsx("button",{onClick:()=>e("list"),style:i(t==="list"),title:"Listenansicht",children:s.jsx(Gc,{style:r(t==="list")})})]})},o2=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:dn},categoryBadge:c,customActions:d,onClick:u,className:h="",style:p={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>s.jsx(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.02},whileTap:{scale:.98},children:s.jsxs("div",{onClick:u,className:`bg-white rounded-3xl shadow-lg hover:shadow-xl transition-shadow duration-300 p-6 cursor-pointer border border-slate-100 h-full flex flex-col ${h}`,style:p,children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i?s.jsx(c0,{icon:i,gradient:m,textColor:x,size:"lg"}):n?s.jsx(qc,{className:y.classes,children:y.label}):null,s.jsxs("div",{className:"flex flex-col items-end gap-2",children:[d&&s.jsx("div",{onClick:v=>v.stopPropagation(),children:d}),i&&n&&s.jsx(qc,{className:y.classes,children:y.label}),c,a.length>0&&s.jsx("div",{className:"flex gap-1",children:a.slice(0,2).map((v,k)=>s.jsx("span",{className:"px-2 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs",children:v},k))})]})]}),s.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:t}),r&&s.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:g},children:r}),e&&s.jsx("p",{className:"text-slate-600 text-sm mb-4 flex-1 line-clamp-3",children:e}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[s.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:o.map((v,k)=>s.jsx(d0,{icon:v.icon,text:v.text},k))}),l&&s.jsx(s2,{label:l.label,icon:l.icon,color:g})]})]})}),a2=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:dn},categoryBadge:c,customActions:d,onClick:u,className:h="",style:p={},headerGradient:m,headerText:x,primaryAccent:g,difficultyConfig:y})=>{const v=Ve();return s.jsx(V.div,{variants:{hidden:{opacity:0,x:-20},visible:{opacity:1,x:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:s.jsxs("div",{onClick:u,style:{backgroundColor:"#ffffff",borderRadius:v.radius.xl,boxShadow:v.shadow.md,padding:v.space[4],cursor:"pointer",border:"1px solid #f1f5f9",transition:v.transition.normal,...p},className:h,children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:v.space[3],marginBottom:v.space[2]},children:[i&&s.jsx(c0,{icon:i,gradient:m,textColor:x,size:"sm"}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:v.fontSize.sm,fontWeight:700,color:"#0f172a",margin:0,lineHeight:1.3},children:t}),r&&s.jsx("span",{style:{fontSize:v.fontSize.xs,fontWeight:600,color:g},children:r})]}),d&&s.jsx("div",{onClick:k=>k.stopPropagation(),children:d}),n&&s.jsx(qc,{className:y.classes,children:y.label})]}),e&&s.jsx("p",{style:{color:"#475569",fontSize:v.fontSize.xs,margin:0,marginBottom:v.space[2],lineHeight:1.4,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:v.space[2]},children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:v.space[3],fontSize:v.fontSize.xs,color:"#64748b"},children:o.slice(0,2).map((k,S)=>s.jsx(d0,{icon:k.icon,text:k.text},S))}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[2]},children:[c,l&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:v.space[1],fontSize:v.fontSize.sm,fontWeight:600,color:g},children:[s.jsx("span",{children:l.label}),l.icon&&s.jsx(l.icon,{style:{width:"16px",height:"16px"}})]})]})]})]})})},u0=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:dn},categoryBadge:c,customActions:d,onClick:u,viewMode:h="grid",className:p="",style:m={}})=>{const x=Ve(),g=x.headerGradient,y=x.headerText,v=x.primaryAccent,k=i2(n),S={title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o,tags:a,action:l,categoryBadge:c,customActions:d,onClick:u,className:p,style:m,headerGradient:g,headerText:y,primaryAccent:v,difficultyConfig:k};return h==="list"?s.jsx(a2,{...S}):s.jsx(o2,{...S})},h0=({children:t,minCardWidth:e="320px",viewMode:n="grid",className:i=""})=>{const r=n==="list";return s.jsx(V.div,{className:`${r?"flex flex-col gap-3":"grid gap-6"} ${i}`,style:r?{}:{gridTemplateColumns:`repeat(auto-fit, minmax(min(100%, ${e}), 1fr))`},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:r?.05:.1}}},children:t})};function Gi(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t?.(r),n===!1||!r.defaultPrevented)return e?.(r)}}function tf(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function p0(...t){return e=>{let n=!1;const i=t.map(r=>{const o=tf(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():tf(t[r],null)}}}}function Ms(...t){return f.useCallback(p0(...t),t)}function l2(t,e){const n=f.createContext(e),i=o=>{const{children:a,...l}=o,c=f.useMemo(()=>l,Object.values(l));return s.jsx(n.Provider,{value:c,children:a})};i.displayName=t+"Provider";function r(o){const a=f.useContext(n);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return[i,r]}function c2(t,e=[]){let n=[];function i(o,a){const l=f.createContext(a),c=n.length;n=[...n,a];const d=h=>{const{scope:p,children:m,...x}=h,g=p?.[t]?.[c]||l,y=f.useMemo(()=>x,Object.values(x));return s.jsx(g.Provider,{value:y,children:m})};d.displayName=o+"Provider";function u(h,p){const m=p?.[t]?.[c]||l,x=f.useContext(m);if(x)return x;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${o}\``)}return[d,u]}const r=()=>{const o=n.map(a=>f.createContext(a));return function(l){const c=l?.[t]||o;return f.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return r.scopeName=t,[i,d2(r,...e)]}function d2(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const a=i.reduce((l,{useScope:c,scopeName:d})=>{const h=c(o)[`__scope${d}`];return{...l,...h}},{});return f.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}var po=globalThis?.document?f.useLayoutEffect:()=>{},u2=Ed[" useId ".trim().toString()]||(()=>{}),h2=0;function Ll(t){const[e,n]=f.useState(u2());return po(()=>{n(i=>i??String(h2++))},[t]),t||(e?`radix-${e}`:"")}var p2=Ed[" useInsertionEffect ".trim().toString()]||po;function f2({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,o,a]=g2({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:r;{const u=f.useRef(t!==void 0);f.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,i])}const d=f.useCallback(u=>{if(l){const h=m2(u)?u(t):u;h!==t&&a.current?.(h)}else o(u)},[l,t,o,a]);return[c,d]}function g2({defaultProp:t,onChange:e}){const[n,i]=f.useState(t),r=f.useRef(n),o=f.useRef(e);return p2(()=>{o.current=e},[e]),f.useEffect(()=>{r.current!==n&&(o.current?.(n),r.current=n)},[n,r]),[n,i,o]}function m2(t){return typeof t=="function"}function f0(t){const e=x2(t),n=f.forwardRef((i,r)=>{const{children:o,...a}=i,l=f.Children.toArray(o),c=l.find(b2);if(c){const d=c.props.children,u=l.map(h=>h===c?f.Children.count(d)>1?f.Children.only(null):f.isValidElement(d)?d.props.children:null:h);return s.jsx(e,{...a,ref:r,children:f.isValidElement(d)?f.cloneElement(d,void 0,u):null})}return s.jsx(e,{...a,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}function x2(t){const e=f.forwardRef((n,i)=>{const{children:r,...o}=n;if(f.isValidElement(r)){const a=S2(r),l=v2(o,r.props);return r.type!==f.Fragment&&(l.ref=i?p0(i,a):a),f.cloneElement(r,l)}return f.Children.count(r)>1?f.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var y2=Symbol("radix.slottable");function b2(t){return f.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===y2}function v2(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...l)=>{const c=o(...l);return r(...l),c}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function S2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var k2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ai=k2.reduce((t,e)=>{const n=f0(`Primitive.${e}`),i=f.forwardRef((r,o)=>{const{asChild:a,...l}=r,c=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(c,{...l,ref:o})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function C2(t,e){t&&Id.flushSync(()=>t.dispatchEvent(e))}function fo(t){const e=f.useRef(t);return f.useEffect(()=>{e.current=t}),f.useMemo(()=>(...n)=>e.current?.(...n),[])}function w2(t,e=globalThis?.document){const n=fo(t);f.useEffect(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var j2="DismissableLayer",Kc="dismissableLayer.update",T2="dismissableLayer.pointerDownOutside",E2="dismissableLayer.focusOutside",nf,g0=f.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),m0=f.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:a,onDismiss:l,...c}=t,d=f.useContext(g0),[u,h]=f.useState(null),p=u?.ownerDocument??globalThis?.document,[,m]=f.useState({}),x=Ms(e,w=>h(w)),g=Array.from(d.layers),[y]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=g.indexOf(y),k=u?g.indexOf(u):-1,S=d.layersWithOutsidePointerEventsDisabled.size>0,C=k>=v,b=A2(w=>{const T=w.target,I=[...d.branches].some(E=>E.contains(T));!C||I||(r?.(w),a?.(w),w.defaultPrevented||l?.())},p),j=_2(w=>{const T=w.target;[...d.branches].some(E=>E.contains(T))||(o?.(w),a?.(w),w.defaultPrevented||l?.())},p);return w2(w=>{k===d.layers.size-1&&(i?.(w),!w.defaultPrevented&&l&&(w.preventDefault(),l()))},p),f.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(nf=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),sf(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=nf)}},[u,p,n,d]),f.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),sf())},[u,d]),f.useEffect(()=>{const w=()=>m({});return document.addEventListener(Kc,w),()=>document.removeEventListener(Kc,w)},[]),s.jsx(Ai.div,{...c,ref:x,style:{pointerEvents:S?C?"auto":"none":void 0,...t.style},onFocusCapture:Gi(t.onFocusCapture,j.onFocusCapture),onBlurCapture:Gi(t.onBlurCapture,j.onBlurCapture),onPointerDownCapture:Gi(t.onPointerDownCapture,b.onPointerDownCapture)})});m0.displayName=j2;var R2="DismissableLayerBranch",I2=f.forwardRef((t,e)=>{const n=f.useContext(g0),i=f.useRef(null),r=Ms(e,i);return f.useEffect(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),s.jsx(Ai.div,{...t,ref:r})});I2.displayName=R2;function A2(t,e=globalThis?.document){const n=fo(t),i=f.useRef(!1),r=f.useRef(()=>{});return f.useEffect(()=>{const o=l=>{if(l.target&&!i.current){let c=function(){x0(T2,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function _2(t,e=globalThis?.document){const n=fo(t),i=f.useRef(!1);return f.useEffect(()=>{const r=o=>{o.target&&!i.current&&x0(E2,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function sf(){const t=new CustomEvent(Kc);document.dispatchEvent(t)}function x0(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?C2(r,o):r.dispatchEvent(o)}var Bl="focusScope.autoFocusOnMount",Fl="focusScope.autoFocusOnUnmount",rf={bubbles:!1,cancelable:!0},M2="FocusScope",y0=f.forwardRef((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...a}=t,[l,c]=f.useState(null),d=fo(r),u=fo(o),h=f.useRef(null),p=Ms(e,g=>c(g)),m=f.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;f.useEffect(()=>{if(i){let g=function(S){if(m.paused||!l)return;const C=S.target;l.contains(C)?h.current=C:Oi(h.current,{select:!0})},y=function(S){if(m.paused||!l)return;const C=S.relatedTarget;C!==null&&(l.contains(C)||Oi(h.current,{select:!0}))},v=function(S){if(document.activeElement===document.body)for(const b of S)b.removedNodes.length>0&&Oi(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",y);const k=new MutationObserver(v);return l&&k.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",y),k.disconnect()}}},[i,l,m.paused]),f.useEffect(()=>{if(l){af.add(m);const g=document.activeElement;if(!l.contains(g)){const v=new CustomEvent(Bl,rf);l.addEventListener(Bl,d),l.dispatchEvent(v),v.defaultPrevented||(P2(L2(b0(l)),{select:!0}),document.activeElement===g&&Oi(l))}return()=>{l.removeEventListener(Bl,d),setTimeout(()=>{const v=new CustomEvent(Fl,rf);l.addEventListener(Fl,u),l.dispatchEvent(v),v.defaultPrevented||Oi(g??document.body,{select:!0}),l.removeEventListener(Fl,u),af.remove(m)},0)}}},[l,d,u,m]);const x=f.useCallback(g=>{if(!n&&!i||m.paused)return;const y=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,v=document.activeElement;if(y&&v){const k=g.currentTarget,[S,C]=N2(k);S&&C?!g.shiftKey&&v===C?(g.preventDefault(),n&&Oi(S,{select:!0})):g.shiftKey&&v===S&&(g.preventDefault(),n&&Oi(C,{select:!0})):v===k&&g.preventDefault()}},[n,i,m.paused]);return s.jsx(Ai.div,{tabIndex:-1,...a,ref:p,onKeyDown:x})});y0.displayName=M2;function P2(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(Oi(i,{select:e}),document.activeElement!==n)return}function N2(t){const e=b0(t),n=of(e,t),i=of(e.reverse(),t);return[n,i]}function b0(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function of(t,e){for(const n of t)if(!D2(n,{upTo:e}))return n}function D2(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function z2(t){return t instanceof HTMLInputElement&&"select"in t}function Oi(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&z2(t)&&e&&t.select()}}var af=O2();function O2(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=lf(t,e),t.unshift(e)},remove(e){t=lf(t,e),t[0]?.resume()}}}function lf(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function L2(t){return t.filter(e=>e.tagName!=="A")}var B2="Portal",v0=f.forwardRef((t,e)=>{const{container:n,...i}=t,[r,o]=f.useState(!1);po(()=>o(!0),[]);const a=n||r&&globalThis?.document?.body;return a?Ov.createPortal(s.jsx(Ai.div,{...i,ref:e}),a):null});v0.displayName=B2;function F2(t,e){return f.useReducer((n,i)=>e[n][i]??n,t)}var ol=t=>{const{present:e,children:n}=t,i=W2(e),r=typeof n=="function"?n({present:i.isPresent}):f.Children.only(n),o=Ms(i.ref,U2(r));return typeof n=="function"||i.isPresent?f.cloneElement(r,{ref:o}):null};ol.displayName="Presence";function W2(t){const[e,n]=f.useState(),i=f.useRef(null),r=f.useRef(t),o=f.useRef("none"),a=t?"mounted":"unmounted",[l,c]=F2(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return f.useEffect(()=>{const d=Wo(i.current);o.current=l==="mounted"?d:"none"},[l]),po(()=>{const d=i.current,u=r.current;if(u!==t){const p=o.current,m=Wo(d);t?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,c]),po(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,h=m=>{const g=Wo(i.current).includes(CSS.escape(m.animationName));if(m.target===e&&g&&(c("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},p=m=>{m.target===e&&(o.current=Wo(i.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:f.useCallback(d=>{i.current=d?getComputedStyle(d):null,n(d)},[])}}function Wo(t){return t?.animationName||"none"}function U2(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Wl=0;function $2(){f.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??cf()),document.body.insertAdjacentElement("beforeend",t[1]??cf()),Wl++,()=>{Wl===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Wl--}},[])}function cf(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Gn=function(){return Gn=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Gn.apply(this,arguments)};function S0(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function V2(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}var aa="right-scroll-bar-position",la="width-before-scroll-bar",G2="with-scroll-bars-hidden",H2="--removed-body-scroll-bar-size";function Ul(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function q2(t,e){var n=f.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var K2=typeof window<"u"?f.useLayoutEffect:f.useEffect,df=new WeakMap;function J2(t,e){var n=q2(null,function(i){return t.forEach(function(r){return Ul(r,i)})});return K2(function(){var i=df.get(n);if(i){var r=new Set(i),o=new Set(t),a=n.current;r.forEach(function(l){o.has(l)||Ul(l,null)}),o.forEach(function(l){r.has(l)||Ul(l,a)})}df.set(n,t)},[t]),n}function Y2(t){return t}function X2(t,e){e===void 0&&(e=Y2);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var a=e(o,i);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(i=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){i=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var u=a;a=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){a.push(u),d()},filter:function(u){return a=a.filter(u),n}}}};return r}function Z2(t){t===void 0&&(t={});var e=X2(null);return e.options=Gn({async:!0,ssr:!1},t),e}var k0=function(t){var e=t.sideCar,n=S0(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return f.createElement(i,Gn({},n))};k0.isSideCarExport=!0;function Q2(t,e){return t.useMedium(e),k0}var C0=Z2(),$l=function(){},al=f.forwardRef(function(t,e){var n=f.useRef(null),i=f.useState({onScrollCapture:$l,onWheelCapture:$l,onTouchMoveCapture:$l}),r=i[0],o=i[1],a=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,h=t.shards,p=t.sideCar,m=t.noRelative,x=t.noIsolation,g=t.inert,y=t.allowPinchZoom,v=t.as,k=v===void 0?"div":v,S=t.gapMode,C=S0(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=p,j=J2([n,e]),w=Gn(Gn({},C),r);return f.createElement(f.Fragment,null,u&&f.createElement(b,{sideCar:C0,removeScrollBar:d,shards:h,noRelative:m,noIsolation:x,inert:g,setCallbacks:o,allowPinchZoom:!!y,lockRef:n,gapMode:S}),a?f.cloneElement(f.Children.only(l),Gn(Gn({},w),{ref:j})):f.createElement(k,Gn({},w,{className:c,ref:j}),l))});al.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};al.classNames={fullWidth:la,zeroRight:aa};var eE=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function tE(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=eE();return e&&t.setAttribute("nonce",e),t}function nE(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function iE(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var sE=function(){var t=0,e=null;return{add:function(n){t==0&&(e=tE())&&(nE(e,n),iE(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},rE=function(){var t=sE();return function(e,n){f.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},w0=function(){var t=rE(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},oE={left:0,top:0,right:0,gap:0},Vl=function(t){return parseInt(t||"",10)||0},aE=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[Vl(n),Vl(i),Vl(r)]},lE=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return oE;var e=aE(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},cE=w0(),ir="data-scroll-locked",dE=function(t,e,n,i){var r=t.left,o=t.top,a=t.right,l=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(G2,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(l,"px ").concat(i,`;
  }
  body[`).concat(ir,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(aa,` {
    right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(la,` {
    margin-right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(aa," .").concat(aa,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(la," .").concat(la,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(ir,`] {
    `).concat(H2,": ").concat(l,`px;
  }
`)},uf=function(){var t=parseInt(document.body.getAttribute(ir)||"0",10);return isFinite(t)?t:0},uE=function(){f.useEffect(function(){return document.body.setAttribute(ir,(uf()+1).toString()),function(){var t=uf()-1;t<=0?document.body.removeAttribute(ir):document.body.setAttribute(ir,t.toString())}},[])},hE=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;uE();var o=f.useMemo(function(){return lE(r)},[r]);return f.createElement(cE,{styles:dE(o,!e,r,n?"":"!important")})},Jc=!1;if(typeof window<"u")try{var Uo=Object.defineProperty({},"passive",{get:function(){return Jc=!0,!0}});window.addEventListener("test",Uo,Uo),window.removeEventListener("test",Uo,Uo)}catch{Jc=!1}var Ls=Jc?{passive:!1}:!1,pE=function(t){return t.tagName==="TEXTAREA"},j0=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!pE(t)&&n[e]==="visible")},fE=function(t){return j0(t,"overflowY")},gE=function(t){return j0(t,"overflowX")},hf=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=T0(t,i);if(r){var o=E0(t,i),a=o[1],l=o[2];if(a>l)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},mE=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},xE=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},T0=function(t,e){return t==="v"?fE(e):gE(e)},E0=function(t,e){return t==="v"?mE(e):xE(e)},yE=function(t,e){return t==="h"&&e==="rtl"?-1:1},bE=function(t,e,n,i,r){var o=yE(t,window.getComputedStyle(e).direction),a=o*i,l=n.target,c=e.contains(l),d=!1,u=a>0,h=0,p=0;do{if(!l)break;var m=E0(t,l),x=m[0],g=m[1],y=m[2],v=g-y-o*x;(x||v)&&T0(t,l)&&(h+=v,p+=x);var k=l.parentNode;l=k&&k.nodeType===Node.DOCUMENT_FRAGMENT_NODE?k.host:k}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(d=!0),d},$o=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},pf=function(t){return[t.deltaX,t.deltaY]},ff=function(t){return t&&"current"in t?t.current:t},vE=function(t,e){return t[0]===e[0]&&t[1]===e[1]},SE=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},kE=0,Bs=[];function CE(t){var e=f.useRef([]),n=f.useRef([0,0]),i=f.useRef(),r=f.useState(kE++)[0],o=f.useState(w0)[0],a=f.useRef(t);f.useEffect(function(){a.current=t},[t]),f.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var g=V2([t.lockRef.current],(t.shards||[]).map(ff),!0).filter(Boolean);return g.forEach(function(y){return y.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),g.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var l=f.useCallback(function(g,y){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!a.current.allowPinchZoom;var v=$o(g),k=n.current,S="deltaX"in g?g.deltaX:k[0]-v[0],C="deltaY"in g?g.deltaY:k[1]-v[1],b,j=g.target,w=Math.abs(S)>Math.abs(C)?"h":"v";if("touches"in g&&w==="h"&&j.type==="range")return!1;var T=hf(w,j);if(!T)return!0;if(T?b=w:(b=w==="v"?"h":"v",T=hf(w,j)),!T)return!1;if(!i.current&&"changedTouches"in g&&(S||C)&&(i.current=b),!b)return!0;var I=i.current||b;return bE(I,y,g,I==="h"?S:C)},[]),c=f.useCallback(function(g){var y=g;if(!(!Bs.length||Bs[Bs.length-1]!==o)){var v="deltaY"in y?pf(y):$o(y),k=e.current.filter(function(b){return b.name===y.type&&(b.target===y.target||y.target===b.shadowParent)&&vE(b.delta,v)})[0];if(k&&k.should){y.cancelable&&y.preventDefault();return}if(!k){var S=(a.current.shards||[]).map(ff).filter(Boolean).filter(function(b){return b.contains(y.target)}),C=S.length>0?l(y,S[0]):!a.current.noIsolation;C&&y.cancelable&&y.preventDefault()}}},[]),d=f.useCallback(function(g,y,v,k){var S={name:g,delta:y,target:v,should:k,shadowParent:wE(v)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(C){return C!==S})},1)},[]),u=f.useCallback(function(g){n.current=$o(g),i.current=void 0},[]),h=f.useCallback(function(g){d(g.type,pf(g),g.target,l(g,t.lockRef.current))},[]),p=f.useCallback(function(g){d(g.type,$o(g),g.target,l(g,t.lockRef.current))},[]);f.useEffect(function(){return Bs.push(o),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Ls),document.addEventListener("touchmove",c,Ls),document.addEventListener("touchstart",u,Ls),function(){Bs=Bs.filter(function(g){return g!==o}),document.removeEventListener("wheel",c,Ls),document.removeEventListener("touchmove",c,Ls),document.removeEventListener("touchstart",u,Ls)}},[]);var m=t.removeScrollBar,x=t.inert;return f.createElement(f.Fragment,null,x?f.createElement(o,{styles:SE(r)}):null,m?f.createElement(hE,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function wE(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const jE=Q2(C0,CE);var R0=f.forwardRef(function(t,e){return f.createElement(al,Gn({},t,{ref:e,sideCar:jE}))});R0.classNames=al.classNames;var TE=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Fs=new WeakMap,Vo=new WeakMap,Go={},Gl=0,I0=function(t){return t&&(t.host||I0(t.parentNode))},EE=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=I0(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},RE=function(t,e,n,i){var r=EE(e,Array.isArray(t)?t:[t]);Go[n]||(Go[n]=new WeakMap);var o=Go[n],a=[],l=new Set,c=new Set(r),d=function(h){!h||l.has(h)||(l.add(h),d(h.parentNode))};r.forEach(d);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(l.has(p))u(p);else try{var m=p.getAttribute(i),x=m!==null&&m!=="false",g=(Fs.get(p)||0)+1,y=(o.get(p)||0)+1;Fs.set(p,g),o.set(p,y),a.push(p),g===1&&x&&Vo.set(p,!0),y===1&&p.setAttribute(n,"true"),x||p.setAttribute(i,"true")}catch(v){console.error("aria-hidden: cannot operate on ",p,v)}})};return u(e),l.clear(),Gl++,function(){a.forEach(function(h){var p=Fs.get(h)-1,m=o.get(h)-1;Fs.set(h,p),o.set(h,m),p||(Vo.has(h)||h.removeAttribute(i),Vo.delete(h)),m||h.removeAttribute(n)}),Gl--,Gl||(Fs=new WeakMap,Fs=new WeakMap,Vo=new WeakMap,Go={})}},IE=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=TE(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),RE(i,r,n,"aria-hidden")):function(){return null}},ll="Dialog",[A0]=c2(ll),[AE,Wn]=A0(ll),_0=t=>{const{__scopeDialog:e,children:n,open:i,defaultOpen:r,onOpenChange:o,modal:a=!0}=t,l=f.useRef(null),c=f.useRef(null),[d,u]=f2({prop:i,defaultProp:r??!1,onChange:o,caller:ll});return s.jsx(AE,{scope:e,triggerRef:l,contentRef:c,contentId:Ll(),titleId:Ll(),descriptionId:Ll(),open:d,onOpenChange:u,onOpenToggle:f.useCallback(()=>u(h=>!h),[u]),modal:a,children:n})};_0.displayName=ll;var M0="DialogTrigger",_E=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Wn(M0,n),o=Ms(e,r.triggerRef);return s.jsx(Ai.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":Ru(r.open),...i,ref:o,onClick:Gi(t.onClick,r.onOpenToggle)})});_E.displayName=M0;var Tu="DialogPortal",[ME,P0]=A0(Tu,{forceMount:void 0}),N0=t=>{const{__scopeDialog:e,forceMount:n,children:i,container:r}=t,o=Wn(Tu,e);return s.jsx(ME,{scope:e,forceMount:n,children:f.Children.map(i,a=>s.jsx(ol,{present:n||o.open,children:s.jsx(v0,{asChild:!0,container:r,children:a})}))})};N0.displayName=Tu;var _a="DialogOverlay",D0=f.forwardRef((t,e)=>{const n=P0(_a,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=Wn(_a,t.__scopeDialog);return o.modal?s.jsx(ol,{present:i||o.open,children:s.jsx(NE,{...r,ref:e})}):null});D0.displayName=_a;var PE=f0("DialogOverlay.RemoveScroll"),NE=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Wn(_a,n);return s.jsx(R0,{as:PE,allowPinchZoom:!0,shards:[r.contentRef],children:s.jsx(Ai.div,{"data-state":Ru(r.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),ws="DialogContent",z0=f.forwardRef((t,e)=>{const n=P0(ws,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=Wn(ws,t.__scopeDialog);return s.jsx(ol,{present:i||o.open,children:o.modal?s.jsx(DE,{...r,ref:e}):s.jsx(zE,{...r,ref:e})})});z0.displayName=ws;var DE=f.forwardRef((t,e)=>{const n=Wn(ws,t.__scopeDialog),i=f.useRef(null),r=Ms(e,n.contentRef,i);return f.useEffect(()=>{const o=i.current;if(o)return IE(o)},[]),s.jsx(O0,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Gi(t.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Gi(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:Gi(t.onFocusOutside,o=>o.preventDefault())})}),zE=f.forwardRef((t,e)=>{const n=Wn(ws,t.__scopeDialog),i=f.useRef(!1),r=f.useRef(!1);return s.jsx(O0,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(i.current||n.triggerRef.current?.focus(),o.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const a=o.target;n.triggerRef.current?.contains(a)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),O0=f.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,...a}=t,l=Wn(ws,n),c=f.useRef(null),d=Ms(e,c);return $2(),s.jsxs(s.Fragment,{children:[s.jsx(y0,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:o,children:s.jsx(m0,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Ru(l.open),...a,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),s.jsxs(s.Fragment,{children:[s.jsx(OE,{titleId:l.titleId}),s.jsx(BE,{contentRef:c,descriptionId:l.descriptionId})]})]})}),Eu="DialogTitle",L0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Wn(Eu,n);return s.jsx(Ai.h2,{id:r.titleId,...i,ref:e})});L0.displayName=Eu;var B0="DialogDescription",F0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Wn(B0,n);return s.jsx(Ai.p,{id:r.descriptionId,...i,ref:e})});F0.displayName=B0;var W0="DialogClose",U0=f.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Wn(W0,n);return s.jsx(Ai.button,{type:"button",...i,ref:e,onClick:Gi(t.onClick,()=>r.onOpenChange(!1))})});U0.displayName=W0;function Ru(t){return t?"open":"closed"}var $0="DialogTitleWarning",[vD,V0]=l2($0,{contentName:ws,titleName:Eu,docsSlug:"dialog"}),OE=({titleId:t})=>{const e=V0($0),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return f.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},LE="DialogDescriptionWarning",BE=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${V0(LE).contentName}}.`;return f.useEffect(()=>{const r=t.current?.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},FE=_0,WE=N0,G0=D0,H0=z0,q0=L0,K0=F0,UE=U0;function J0(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=J0(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function Y0(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=J0(t))&&(i&&(i+=" "),i+=e);return i}const Iu="-",$E=t=>{const e=GE(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:a=>{const l=a.split(Iu);return l[0]===""&&l.length!==1&&l.shift(),X0(l,e)||VE(a)},getConflictingClassGroupIds:(a,l)=>{const c=n[a]||[];return l&&i[a]?[...c,...i[a]]:c}}},X0=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],i=e.nextPart.get(n),r=i?X0(t.slice(1),i):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join(Iu);return e.validators.find(({validator:a})=>a(o))?.classGroupId},gf=/^\[(.+)\]$/,VE=t=>{if(gf.test(t)){const e=gf.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},GE=t=>{const{theme:e,prefix:n}=t,i={nextPart:new Map,validators:[]};return qE(Object.entries(t.classGroups),n).forEach(([o,a])=>{Yc(a,i,o,e)}),i},Yc=(t,e,n,i)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:mf(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(HE(r)){Yc(r(i),e,n,i);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,a])=>{Yc(a,mf(e,o),n,i)})})},mf=(t,e)=>{let n=t;return e.split(Iu).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n},HE=t=>t.isThemeGetter,qE=(t,e)=>e?t.map(([n,i])=>{const r=i.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,l])=>[e+a,l])):o);return[n,r]}):t,KE=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,i=new Map;const r=(o,a)=>{n.set(o,a),e++,e>t&&(e=0,i=n,n=new Map)};return{get(o){let a=n.get(o);if(a!==void 0)return a;if((a=i.get(o))!==void 0)return r(o,a),a},set(o,a){n.has(o)?n.set(o,a):r(o,a)}}},Z0="!",JE=t=>{const{separator:e,experimentalParseClassName:n}=t,i=e.length===1,r=e[0],o=e.length,a=l=>{const c=[];let d=0,u=0,h;for(let y=0;y<l.length;y++){let v=l[y];if(d===0){if(v===r&&(i||l.slice(y,y+o)===e)){c.push(l.slice(u,y)),u=y+o;continue}if(v==="/"){h=y;continue}}v==="["?d++:v==="]"&&d--}const p=c.length===0?l:l.substring(u),m=p.startsWith(Z0),x=m?p.substring(1):p,g=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:x,maybePostfixModifierPosition:g}};return n?l=>n({className:l,parseClassName:a}):a},YE=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(i=>{i[0]==="["?(e.push(...n.sort(),i),n=[]):n.push(i)}),e.push(...n.sort()),e},XE=t=>({cache:KE(t.cacheSize),parseClassName:JE(t),...$E(t)}),ZE=/\s+/,QE=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r}=e,o=[],a=t.trim().split(ZE);let l="";for(let c=a.length-1;c>=0;c-=1){const d=a[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:m}=n(d);let x=!!m,g=i(x?p.substring(0,m):p);if(!g){if(!x){l=d+(l.length>0?" "+l:l);continue}if(g=i(p),!g){l=d+(l.length>0?" "+l:l);continue}x=!1}const y=YE(u).join(":"),v=h?y+Z0:y,k=v+g;if(o.includes(k))continue;o.push(k);const S=r(g,x);for(let C=0;C<S.length;++C){const b=S[C];o.push(v+b)}l=d+(l.length>0?" "+l:l)}return l};function eR(){let t=0,e,n,i="";for(;t<arguments.length;)(e=arguments[t++])&&(n=Q0(e))&&(i&&(i+=" "),i+=n);return i}const Q0=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=Q0(t[i]))&&(n&&(n+=" "),n+=e);return n};function tR(t,...e){let n,i,r,o=a;function a(c){const d=e.reduce((u,h)=>h(u),t());return n=XE(d),i=n.cache.get,r=n.cache.set,o=l,l(c)}function l(c){const d=i(c);if(d)return d;const u=QE(c,n);return r(c,u),u}return function(){return o(eR.apply(null,arguments))}}const it=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},ey=/^\[(?:([a-z-]+):)?(.+)\]$/i,nR=/^\d+\/\d+$/,iR=new Set(["px","full","screen"]),sR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,rR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,oR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,aR=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,lR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,di=t=>sr(t)||iR.has(t)||nR.test(t),_i=t=>wr(t,"length",mR),sr=t=>!!t&&!Number.isNaN(Number(t)),Hl=t=>wr(t,"number",sr),Rr=t=>!!t&&Number.isInteger(Number(t)),cR=t=>t.endsWith("%")&&sr(t.slice(0,-1)),Te=t=>ey.test(t),Mi=t=>sR.test(t),dR=new Set(["length","size","percentage"]),uR=t=>wr(t,dR,ty),hR=t=>wr(t,"position",ty),pR=new Set(["image","url"]),fR=t=>wr(t,pR,yR),gR=t=>wr(t,"",xR),Ir=()=>!0,wr=(t,e,n)=>{const i=ey.exec(t);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):n(i[2]):!1},mR=t=>rR.test(t)&&!oR.test(t),ty=()=>!1,xR=t=>aR.test(t),yR=t=>lR.test(t),bR=()=>{const t=it("colors"),e=it("spacing"),n=it("blur"),i=it("brightness"),r=it("borderColor"),o=it("borderRadius"),a=it("borderSpacing"),l=it("borderWidth"),c=it("contrast"),d=it("grayscale"),u=it("hueRotate"),h=it("invert"),p=it("gap"),m=it("gradientColorStops"),x=it("gradientColorStopPositions"),g=it("inset"),y=it("margin"),v=it("opacity"),k=it("padding"),S=it("saturate"),C=it("scale"),b=it("sepia"),j=it("skew"),w=it("space"),T=it("translate"),I=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],P=()=>["auto",Te,e],O=()=>[Te,e],B=()=>["",di,_i],N=()=>["auto",sr,Te],M=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],F=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],D=()=>["start","end","center","between","around","evenly","stretch"],z=()=>["","0",Te],L=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ee=()=>[sr,Te];return{cacheSize:500,separator:":",theme:{colors:[Ir],spacing:[di,_i],blur:["none","",Mi,Te],brightness:ee(),borderColor:[t],borderRadius:["none","","full",Mi,Te],borderSpacing:O(),borderWidth:B(),contrast:ee(),grayscale:z(),hueRotate:ee(),invert:z(),gap:O(),gradientColorStops:[t],gradientColorStopPositions:[cR,_i],inset:P(),margin:P(),opacity:ee(),padding:O(),saturate:ee(),scale:ee(),sepia:z(),skew:ee(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",Te]}],container:["container"],columns:[{columns:[Mi]}],"break-after":[{"break-after":L()}],"break-before":[{"break-before":L()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...M(),Te]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:I()}],"overscroll-x":[{"overscroll-x":I()}],"overscroll-y":[{"overscroll-y":I()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Rr,Te]}],basis:[{basis:P()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Te]}],grow:[{grow:z()}],shrink:[{shrink:z()}],order:[{order:["first","last","none",Rr,Te]}],"grid-cols":[{"grid-cols":[Ir]}],"col-start-end":[{col:["auto",{span:["full",Rr,Te]},Te]}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":[Ir]}],"row-start-end":[{row:["auto",{span:[Rr,Te]},Te]}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Te]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Te]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...D()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...D(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...D(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[k]}],px:[{px:[k]}],py:[{py:[k]}],ps:[{ps:[k]}],pe:[{pe:[k]}],pt:[{pt:[k]}],pr:[{pr:[k]}],pb:[{pb:[k]}],pl:[{pl:[k]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[w]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[w]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Te,e]}],"min-w":[{"min-w":[Te,e,"min","max","fit"]}],"max-w":[{"max-w":[Te,e,"none","full","min","max","fit","prose",{screen:[Mi]},Mi]}],h:[{h:[Te,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Te,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Te,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Te,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Mi,_i]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Hl]}],"font-family":[{font:[Ir]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Te]}],"line-clamp":[{"line-clamp":["none",sr,Hl]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",di,Te]}],"list-image":[{"list-image":["none",Te]}],"list-style-type":[{list:["none","disc","decimal",Te]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...F(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",di,_i]}],"underline-offset":[{"underline-offset":["auto",di,Te]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Te]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Te]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...M(),hR]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",uR]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},fR]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...F(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:F()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...F()]}],"outline-offset":[{"outline-offset":[di,Te]}],"outline-w":[{outline:[di,_i]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[di,_i]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Mi,gR]}],"shadow-color":[{shadow:[Ir]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Mi,Te]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[S]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Te]}],duration:[{duration:ee()}],ease:[{ease:["linear","in","out","in-out",Te]}],delay:[{delay:ee()}],animate:[{animate:["none","spin","ping","pulse","bounce",Te]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[C]}],"scale-x":[{"scale-x":[C]}],"scale-y":[{"scale-y":[C]}],rotate:[{rotate:[Rr,Te]}],"translate-x":[{"translate-x":[T]}],"translate-y":[{"translate-y":[T]}],"skew-x":[{"skew-x":[j]}],"skew-y":[{"skew-y":[j]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Te]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Te]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Te]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[di,_i,Hl]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},vR=tR(bR);function ot(...t){return vR(Y0(t))}const Xn=f.forwardRef(({onOpenChange:t,...e},n)=>{const i=f.useCallback(r=>{t&&t(r)},[t]);return s.jsx(FE,{onOpenChange:i,...e})});Xn.displayName="Dialog";const SR=WE,ny=f.forwardRef(({className:t,...e},n)=>s.jsx(G0,{ref:n,className:ot("fixed inset-0 z-[99] bg-slate-900/60 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));ny.displayName=G0.displayName;const Zn=f.forwardRef(({className:t,children:e,...n},i)=>s.jsxs(SR,{children:[s.jsx(ny,{}),s.jsxs(H0,{ref:i,className:ot("fixed left-[50%] top-[50%] z-[99] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4","border border-slate-200 bg-white p-6 shadow-2xl rounded-2xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...n,children:[e,s.jsxs(UE,{style:{position:"absolute",right:"16px",top:"16px",borderRadius:"8px",padding:"6px",color:"#94a3b8",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:r=>{r.currentTarget.style.color="#475569",r.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.color="#94a3b8",r.currentTarget.style.backgroundColor="transparent"},children:[s.jsx(Ot,{style:{width:"20px",height:"20px"}}),s.jsx("span",{className:"sr-only",children:"Schlieen"})]})]})]}));Zn.displayName=H0.displayName;const Qn=({className:t,...e})=>s.jsx("div",{className:ot("flex flex-col space-y-2 text-center sm:text-left",t),...e});Qn.displayName="DialogHeader";const Ci=({className:t,...e})=>s.jsx("div",{className:ot("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end pt-4",t),...e});Ci.displayName="DialogFooter";const ei=f.forwardRef(({className:t,...e},n)=>s.jsx(q0,{ref:n,className:ot("text-xl font-semibold text-slate-900 leading-none tracking-tight",t),...e}));ei.displayName=q0.displayName;const wi=f.forwardRef(({className:t,...e},n)=>s.jsx(K0,{ref:n,className:ot("text-sm text-slate-600 leading-relaxed",t),...e}));wi.displayName=K0.displayName;const xf=768,kR=()=>{const[t,e]=f.useState(typeof window<"u"?window.innerWidth<xf:!1);return As.useEffect(()=>{const n=()=>{e(window.innerWidth<xf)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t},Ho=({label:t,icon:e,isSelected:n,onClick:i,color:r,bgColor:o})=>{const a=Ve(),l=r||a.primaryAccent,c=o||`${a.primaryAccent}15`;return s.jsxs("button",{onClick:i,style:{display:"inline-flex",alignItems:"center",gap:a.space[2],padding:`${a.space[2]} ${a.space[3]}`,borderRadius:a.radius.full,fontSize:a.fontSize.sm,fontWeight:600,border:`2px solid ${n?l:R.slate[200]}`,backgroundColor:n?c:"white",color:n?l:R.slate[600],cursor:"pointer",transition:a.transition.normal,whiteSpace:"nowrap"},children:[e&&s.jsx(e,{style:{width:"14px",height:"14px"}}),t]})},CR=({count:t})=>{const e=Ve();return t===0?null:s.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"18px",height:"18px",padding:`0 ${e.space[1]}`,borderRadius:e.radius.md,backgroundColor:"#ef4444",color:"white",fontSize:e.fontSize.xs,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center"},children:t})},wR=({searchQuery:t,onSearchChange:e,searchPlaceholder:n="Durchsuchen...",showSearch:i=!0,categories:r=[],selectedCategory:o,onCategoryChange:a,showCategories:l=!0,difficultyOptions:c=[],selectedDifficulty:d,onDifficultyChange:u,showDifficulty:h=!1,viewMode:p,onViewModeChange:m,showViewToggle:x=!0,renderCustomFilters:g,customActions:y,children:v})=>{const[k,S]=f.useState(!1),C=kR(),b=Ve(),j=[o?1:0,d&&d!=="all"?1:0,t?.trim()?1:0].reduce((w,T)=>w+T,0);return C?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[3]},children:[s.jsxs("div",{style:{display:"flex",gap:b.space[2],alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1"},children:[s.jsx(Ss,{style:{position:"absolute",left:b.space[3],top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:w=>e(w.target.value),style:{width:"100%",padding:`${b.space[2]} ${b.space[3]} ${b.space[2]} 38px`,borderRadius:b.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",outline:"none"}})]}),s.jsxs("button",{onClick:()=>S(!0),style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"44px",borderRadius:b.radius.md,border:`1px solid ${j>0?b.primaryAccent:R.slate[200]}`,backgroundColor:j>0?`${b.primaryAccent}10`:"white",cursor:"pointer",flexShrink:0},children:[s.jsx(ra,{style:{width:"18px",height:"18px",color:j>0?b.primaryAccent:R.slate[500]}}),s.jsx(CR,{count:j})]}),x&&p&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",padding:"3px",backgroundColor:R.slate[100],borderRadius:b.radius.md,flexShrink:0},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Lr,{style:{width:"14px",height:"14px",color:p==="grid"?b.primaryAccent:R.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[1],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Gc,{style:{width:"14px",height:"14px",color:p==="list"?b.primaryAccent:R.slate[500]}})})]})]}),y&&s.jsx("div",{style:{marginTop:b.space[2]},children:y}),s.jsx(Xn,{open:k,onOpenChange:S,children:s.jsxs(Zn,{style:{position:"fixed",bottom:0,left:0,right:0,top:"auto",transform:"none",maxWidth:"100%",width:"100%",borderRadius:`${b.radius.xl} ${b.radius.xl} 0 0`,maxHeight:"80vh",overflow:"auto"},children:[s.jsx(Qn,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(ei,{style:{display:"flex",alignItems:"center",gap:b.space[2]},children:[s.jsx(ra,{style:{width:"20px",height:"20px",color:b.primaryAccent}}),"Filter"]}),j>0&&s.jsx("button",{onClick:()=>{a?.(null),u?.("all"),e?.("")},style:{padding:`${b.space[1]} ${b.space[3]}`,borderRadius:b.radius.sm,border:"none",backgroundColor:R.slate[100],color:R.slate[600],fontSize:b.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Zurcksetzen"})]})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[5],padding:`${b.space[2]} 0`},children:[h&&c.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:b.space[2]},children:"Schwierigkeit"}),s.jsx("select",{value:d,onChange:w=>u(w.target.value),style:{width:"100%",padding:`${b.space[3]} 14px`,borderRadius:b.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(w=>s.jsx("option",{value:w.value,children:w.label},w.value))})]}),l&&r.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:b.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:b.space[2]},children:"Kategorie"}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[s.jsx(Ho,{label:"Alle",icon:Lr,isSelected:!o,onClick:()=>a(null)}),r.map(w=>s.jsx(Ho,{label:w.label,icon:w.icon,isSelected:o===w.key,onClick:()=>a(w.key),color:w.color,bgColor:w.bgColor},w.key))]})]}),g&&s.jsx("div",{children:g()})]}),s.jsx("button",{onClick:()=>S(!1),style:{width:"100%",padding:b.space[3],marginTop:b.space[3],borderRadius:b.radius.lg,border:"none",background:`linear-gradient(135deg, ${b.primaryAccent} 0%, ${b.primaryAccent}dd 100%)`,color:"white",fontSize:b.fontSize.md,fontWeight:600,cursor:"pointer"},children:"Filter anwenden"})]})}),v]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:b.space[4]},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[3],alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[s.jsx(Ss,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:w=>e(w.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 44px`,borderRadius:b.radius.lg,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",outline:"none",transition:b.transition.normal},onFocus:w=>{w.target.style.borderColor=b.primaryAccent,w.target.style.boxShadow=`0 0 0 3px ${b.primaryAccent}20`},onBlur:w=>{w.target.style.borderColor=R.slate[200],w.target.style.boxShadow="none"}})]}),h&&c.length>0&&s.jsxs("div",{style:{position:"relative",minWidth:"180px"},children:[s.jsx(ra,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:R.slate[400],pointerEvents:"none"}}),s.jsx("select",{value:d,onChange:w=>u(w.target.value),style:{width:"100%",padding:`${b.space[3]} 14px ${b.space[3]} 40px`,borderRadius:b.radius.lg,border:`1px solid ${R.slate[200]}`,fontSize:b.fontSize.base,color:R.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:`right ${b.space[3]} center`,paddingRight:"40px"},children:c.map(w=>s.jsx("option",{value:w.value,children:w.label},w.value))})]}),g&&g(),y,x&&p&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:b.space[1],padding:b.space[1],backgroundColor:R.slate[100],borderRadius:b.radius.md},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",boxShadow:p==="grid"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Kachelansicht",children:s.jsx(Lr,{style:{width:"16px",height:"16px",color:p==="grid"?b.primaryAccent:R.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:b.space[2],borderRadius:b.radius.sm,border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",boxShadow:p==="list"?b.shadow.sm:"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Listenansicht",children:s.jsx(Gc,{style:{width:"16px",height:"16px",color:p==="list"?b.primaryAccent:R.slate[500]}})})]})]}),l&&r.length>0&&s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:b.space[2]},children:[s.jsx(Ho,{label:"Alle",icon:Lr,isSelected:!o,onClick:()=>a(null)}),r.map(w=>s.jsx(Ho,{label:w.label,icon:w.icon,isSelected:o===w.key,onClick:()=>a(w.key),color:w.color,bgColor:w.bgColor},w.key))]}),v]})},yf=({category:t,getCategoryConfig:e})=>{const n=e(t);if(!n)return null;const i=n.IconComponent||n.icon||_o;return s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:n.bgColor,color:n.color},children:[s.jsx(i,{style:{width:"12px",height:"12px"}}),n.shortLabel]})},jR=({category:t,getCategoryConfig:e})=>Array.isArray(t)?s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:t.map((n,i)=>s.jsx(yf,{category:n,getCategoryConfig:e},i))}):s.jsx(yf,{category:t,getCategoryConfig:e}),cl=({title:t,subtitle:e,headerIcon:n,fetchScenarios:i,moduleKey:r,historyButtonLabel:o="Meine Sessions",onNavigateToHistory:a,showHistoryButton:l=!0,onSelectScenario:c,renderCardMeta:d,renderCategoryBadge:u,getIconForScenario:h,cardActionLabel:p="Starten",cardActionIcon:m,getCardCustomActions:x,categoryField:g="category",customCategoryConfig:y,emptyStateIcon:v,emptyStateTitle:k="Keine Szenarien verfgbar",emptyStateMessage:S="Bitte kontaktieren Sie den Administrator.",searchPlaceholder:C="Durchsuchen...",headerActions:b,filterActions:j,renderInfoBox:w,extraContent:T,isAuthenticated:I,requireAuth:E,setPendingAction:P,setPendingScenario:O,demoCode:B,pendingScenario:N,clearPendingScenario:M,loadingMessage:F="Szenarien werden geladen...",errorRetryLabel:$="Erneut versuchen"})=>{const[D,z]=f.useState([]),[L,ee]=f.useState(!0),[se,G]=f.useState(null),[q,ie]=f.useState(null),[A,W]=f.useState("grid"),[H,oe]=f.useState(""),{branding:Se,filterScenariosBySetupAndPartner:$e}=Ue(),{getCategoryConfig:Ce,getCategoriesForFilter:rt,matchesCategory:me}=n2(),we=Se?.["--header-gradient"]||Ie["--header-gradient"],Xe=Se?.["--header-text"]||Ie["--header-text"],Ge=Se?.["--primary-accent"]||Ie["--primary-accent"],dt=f.useCallback(async()=>{try{ee(!0),G(null);const de=await i();z(de||[])}catch(de){console.error(`[${t}] Error loading scenarios:`,de),G(de.message||"Fehler beim Laden")}finally{ee(!1)}},[i,t]);f.useEffect(()=>{dt()},[dt]);const qe=f.useRef(!1);f.useEffect(()=>{N&&I&&!qe.current&&(qe.current=!0,M&&M(),c(N))},[N,I,M,c]);const tt=f.useMemo(()=>$e([...D],r),[D,$e,r]),$t=f.useMemo(()=>{if(y){const ae=new Set;return tt.forEach(ge=>{const Y=ge[g];Y&&y[Y]&&ae.add(Y)}),Array.from(ae)}const de=tt.flatMap(ae=>{const ge=ae[g];return Array.isArray(ge)?ge.filter(Y=>Y&&typeof Y=="string"&&Y.trim()):ge&&typeof ge=="string"&&ge.trim()?[ge]:[]});return[...new Set(de)]},[tt,g,y]),_e=f.useMemo(()=>y?$t.filter(ae=>tt.some(ge=>ge[g]===ae)).map(ae=>({key:ae,label:y[ae]?.label||ae,shortLabel:y[ae]?.label||ae,color:y[ae]?.color,bgColor:y[ae]?.bgColor,icon:y[ae]?.icon,IconComponent:y[ae]?.icon})):rt($t).filter(ae=>!ae||!ae.label||!ae.label.trim()?!1:tt.some(ge=>me(ge[g],ae.key))),[$t,y,rt,tt,g,me]),Vt=f.useMemo(()=>{let de=[...tt];if(q&&(y?de=de.filter(ae=>ae[g]===q):de=de.filter(ae=>me(ae[g],q))),H.trim()){const ae=H.toLowerCase();de=de.filter(ge=>ge.title?.toLowerCase().includes(ae)||ge.description?.toLowerCase().includes(ae))}return de},[tt,q,H,g,y,me]),jt=f.useCallback(de=>{if(!I&&!B){O?O(de):P&&P({type:"SELECT_SCENARIO",scenario:de}),E&&E(()=>{c(de)},{type:"SELECT_SCENARIO",scenario:de});return}c(de)},[I,B,O,P,E,c]),ve=f.useCallback(de=>{const ae=de[g];if(!ae)return null;if(u)return u(de,Ce);if(y&&y[ae]){const ge=y[ae];return s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:ge.bgColor,color:ge.color},children:[ge.icon&&s.jsx(ge.icon,{style:{width:"12px",height:"12px"}}),ge.label]})}return s.jsx(jR,{category:ae,getCategoryConfig:Ce})},[g,u,y,Ce]);return L?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(he,{style:{width:"48px",height:"48px",color:Ge,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{color:R.slate[600],fontSize:"16px"},children:F}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}):se?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(ke,{style:{width:"48px",height:"48px",color:R.red[500]}}),s.jsx("p",{style:{color:R.red[500],fontSize:"16px",textAlign:"center"},children:se}),s.jsx("button",{onClick:dt,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:Ge,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer"},children:$})]}):s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:we,display:"flex",alignItems:"center",justifyContent:"center"},children:n&&s.jsx(n,{style:{width:"24px",height:"24px",color:Xe}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:R.slate[900],margin:0},children:t}),s.jsx("p",{style:{fontSize:"14px",color:R.slate[600],margin:0},children:e})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[b,l&&I&&a&&s.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${Ge}`,backgroundColor:"white",color:Ge,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(Uc,{size:18}),o]})]})]}),s.jsx("div",{style:{marginTop:"24px"},children:s.jsx(wR,{searchQuery:H,onSearchChange:oe,searchPlaceholder:C,categories:_e.map(de=>({key:de.key,label:de.label,shortLabel:de.shortLabel||de.label,color:de.color,bgColor:de.bgColor,icon:de.IconComponent||de.icon})),selectedCategory:q,onCategoryChange:ie,showCategories:_e.length>0,showDifficulty:!1,viewMode:A,onViewModeChange:W,customActions:j})})]}),Vt.length>0?s.jsx(h0,{minCardWidth:"340px",viewMode:A,children:Vt.map(de=>{const ae=h?h(de):null,ge=d?d(de):[],Y=x?x(de):null;return s.jsx(u0,{title:de.title,description:de.description,icon:ae,categoryBadge:ve(de),meta:ge,action:m?{label:p,icon:m}:{label:p},onClick:()=>jt(de),viewMode:A,customActions:Y},de.id)})}):s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",backgroundColor:"white",borderRadius:"16px",border:`1px solid ${R.slate[200]}`},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:v?s.jsx(v,{style:{width:"48px",height:"48px",color:R.slate[300]}}):s.jsx(_o,{style:{width:"48px",height:"48px",color:R.slate[300]}})}),s.jsx("h3",{style:{color:R.slate[500],margin:"0 0 8px 0",fontWeight:500},children:k}),s.jsx("p",{style:{color:R.slate[400],margin:0,fontSize:"14px"},children:q?"In der ausgewhlten Kategorie sind keine Szenarien verfgbar.":S}),q&&tt.length>0&&s.jsx("button",{onClick:()=>ie(null),style:{marginTop:"16px",padding:"10px 20px",borderRadius:"20px",border:`2px solid ${Ge}`,backgroundColor:"white",color:Ge,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"Alle Szenarien anzeigen"})]}),w&&w(),T]})},TR=t=>{const e=[];return t.variables_schema&&t.variables_schema.length>0&&e.push({icon:et,text:`${t.variables_schema.length} Variablen`}),e.push({icon:Je,text:"~10 Min"}),e},ER=()=>Tn,RR=({onSelectScenario:t,onBack:e,onOpenHistory:n,isAuthenticated:i,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,onNavigateToHistory:c})=>s.jsx(cl,{title:"Live-Simulationen",subtitle:"Live Simulationen mit KI-Interviewer",headerIcon:Ye,fetchScenarios:a0,moduleKey:"roleplay",historyButtonLabel:"Meine Live-Simulationen",onNavigateToHistory:c,onSelectScenario:t,renderCardMeta:TR,getIconForScenario:ER,cardActionLabel:"Starten",cardActionIcon:dn,categoryField:"category",emptyStateIcon:St,emptyStateTitle:"Keine Szenarien gefunden.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:i,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,loadingMessage:"Szenarien werden geladen..."}),Au=({selectedDeviceId:t,onDeviceChange:e,onTestClick:n,disabled:i=!1})=>{const[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(!1),p=f.useRef(0),m=f.useRef(!1),x=Ve(),g=async(S=!1)=>{if(!m.current&&!(S&&Date.now()-p.current<2e3)){m.current=!0,p.current=Date.now(),l(!0),d(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(w=>w.stop());const b=await navigator.mediaDevices.enumerateDevices();console.log("[MicrophoneSelector] All detected devices:",b.map(w=>({kind:w.kind,label:w.label||"(no label)",deviceId:w.deviceId?.substring(0,8)+"..."})));const j=b.filter(w=>w.kind==="audioinput");if(console.log("[MicrophoneSelector] Audio input devices:",j.length,j.map(w=>w.label||w.deviceId?.substring(0,8))),j.length===0)console.warn("[MicrophoneSelector] No audioinput devices found. All device kinds:",[...new Set(b.map(w=>w.kind))]),d("Kein Mikrofon gefunden"),o([]);else if(o(j),!t&&j.length>0){const w=j.find(T=>T.deviceId==="default")||j[0];e?.(w.deviceId)}}catch(C){console.error("Error loading microphone devices:",C),C.name==="NotAllowedError"||C.name==="PermissionDeniedError"?d("Mikrofonzugriff verweigert"):C.name==="NotFoundError"?d("Kein Mikrofon gefunden"):d("Fehler beim Laden der Mikrofone"),o([])}finally{l(!1),m.current=!1,p.current=Date.now()}}};f.useEffect(()=>{g(!1);let S=null;const C=()=>{S&&clearTimeout(S),S=setTimeout(()=>{g(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",C),()=>{S&&clearTimeout(S),navigator.mediaDevices?.removeEventListener("devicechange",C)}},[]);const y=S=>{if(S.label){let C=S.label;return C=C.replace(/^Default - /,""),C=C.replace(/^Kommunikation - /,""),C=C.replace(/^Standard - /,""),C.length>35&&(C=C.substring(0,32)+"..."),C}return`Mikrofon ${r.indexOf(S)+1}`},v=S=>{e?.(S),h(!1)},k=r.find(S=>S.deviceId===t);return s.jsxs("div",{className:"microphone-selector",style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:x.space[3]},children:[s.jsxs("button",{type:"button",onClick:()=>!i&&!a&&h(!u),disabled:i||a,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:x.space[3],padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${c?R.red[500]:R.slate[200]}`,backgroundColor:c?R.red[50]:R.white,cursor:i||a?"not-allowed":"pointer",opacity:i||a?.6:1,transition:x.transition.normal},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:x.space[3]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:x.radius.md,display:"flex",alignItems:"center",justifyContent:"center",background:c?R.red[100]:x.headerGradient},children:c?s.jsx(ke,{style:{width:"22px",height:"22px",color:R.red[500]}}):s.jsx(Fe,{style:{width:"22px",height:"22px",color:x.headerText}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:x.fontSize.xs,color:R.slate[500],fontWeight:500,marginBottom:"2px"},children:"Mikrofon"}),s.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:600,color:c?R.red[600]:R.slate[800]},children:a?"Lade...":c||(k?y(k):"Bitte whlen")})]})]}),s.jsx(ct,{style:{width:"20px",height:"20px",color:R.slate[400],transform:u?"rotate(180deg)":"rotate(0)",transition:x.transition.normal}})]}),n&&!c&&s.jsxs("button",{type:"button",onClick:n,disabled:i||a||!t,style:{flex:"0 0 auto",display:"flex",alignItems:"center",gap:x.space[2],padding:`${x.space[3]} ${x.space[5]}`,borderRadius:x.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,cursor:i||a||!t?"not-allowed":"pointer",opacity:i||a||!t?.5:1,transition:x.transition.normal,whiteSpace:"nowrap"},children:[s.jsx(Fe,{style:{width:"18px",height:"18px",color:x.primaryAccent}}),s.jsx("span",{style:{fontSize:x.fontSize.base,fontWeight:600,color:R.slate[700]},children:"Testen"})]}),s.jsx("button",{type:"button",onClick:()=>g(!1),disabled:a,title:"Gerteliste aktualisieren",style:{display:"flex",alignItems:"center",justifyContent:"center",padding:`${x.space[3]} ${x.space[4]}`,borderRadius:x.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,cursor:a?"not-allowed":"pointer",opacity:a?.5:1,transition:x.transition.normal},children:s.jsx(zt,{style:{width:"20px",height:"20px",color:R.slate[600],animation:a?"spin 1s linear infinite":"none"}})})]}),u&&r.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>h(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:R.white,borderRadius:x.radius.lg,boxShadow:x.shadow.lg,border:`1px solid ${R.slate[200]}`,zIndex:x.zIndex.overlay,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:r.map((S,C)=>s.jsxs("button",{type:"button",onClick:()=>v(S.deviceId),style:{width:"100%",padding:`${x.space[3.5]} ${x.space[4]}`,textAlign:"left",display:"flex",alignItems:"center",gap:x.space[3],border:"none",backgroundColor:t===S.deviceId?x.primaryAccentLight:"transparent",cursor:"pointer",transition:x.transition.fast},onMouseEnter:b=>{t!==S.deviceId&&(b.currentTarget.style.backgroundColor=R.slate[50])},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=t===S.deviceId?x.primaryAccentLight:"transparent"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:x.radius.sm,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t===S.deviceId?x.primaryAccent:R.slate[100]},children:s.jsx(Fe,{style:{width:"18px",height:"18px",color:t===S.deviceId?R.white:R.slate[500]}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:x.fontSize.base,fontWeight:500,color:t===S.deviceId?x.primaryAccent:R.slate[800],overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:y(S)}),S.deviceId==="default"&&s.jsx("div",{style:{fontSize:x.fontSize.xs,color:R.slate[400]},children:"Systemstandard"})]}),t===S.deviceId&&s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:x.radius.full,backgroundColor:x.primaryAccent}})]},S.deviceId||C))})]}),!c&&r.length>0&&r.length<3&&s.jsx("div",{style:{marginTop:x.space[2.5],fontSize:x.fontSize.xs,color:R.slate[500],lineHeight:1.4},children:'Dein Headset wird nicht angezeigt? Klicke auf "Aktualisieren" nach dem Anschlieen oder prfe die Bluetooth-Verbindung (Headset-Modus statt Audio-Modus).'}),c==="Kein Mikrofon gefunden"&&s.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:R.amber[50],border:`1px solid ${R.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:R.amber[800],lineHeight:1.5},children:[s.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" Tipps zur Fehlerbehebung:"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[s.jsxs("li",{children:["Bei ",s.jsx("strong",{children:"Bluetooth-Headsets"}),': Stelle sicher, dass das Headset im "Headset"- oder "Hands-Free"-Modus verbunden ist (nicht nur "Audio")']}),s.jsxs("li",{children:["Bei ",s.jsx("strong",{children:"USB-Headsets"}),": Trenne das Gert kurz und schliee es erneut an"]}),s.jsxs("li",{children:["Prfe die ",s.jsx("strong",{children:"Systemeinstellungen"})," deines Computers, ob das Mikrofon dort erkannt wird"]}),s.jsxs("li",{children:["Versuche einen anderen ",s.jsx("strong",{children:"Browser"})," (Chrome/Edge empfohlen)"]})]})]}),c==="Mikrofonzugriff verweigert"&&s.jsxs("div",{style:{marginTop:x.space[3],padding:`${x.space[3]} ${x.space[3.5]}`,backgroundColor:R.amber[50],border:`1px solid ${R.amber[200]}`,borderRadius:x.radius.md,fontSize:x.fontSize.sm,color:R.amber[800],lineHeight:1.5},children:[s.jsx("div",{style:{fontWeight:600,marginBottom:x.space[1.5]},children:" So erlaubst du den Mikrofonzugriff:"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"18px"},children:[s.jsxs("li",{children:["Klicke auf das ",s.jsx("strong",{children:"Schloss-Symbol"})," in der Adressleiste deines Browsers"]}),s.jsxs("li",{children:['Setze "Mikrofon" auf ',s.jsx("strong",{children:'"Zulassen"'})]}),s.jsx("li",{children:"Lade die Seite neu und versuche es erneut"})]})]}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},mr=({audioLevel:t=0,isActive:e=!1,variant:n="spectrum",size:i="md",className:r,accentColor:o})=>{const a=t>1?t/100:t,l=f.useMemo(()=>({sm:{height:48,barCount:40,barWidth:3,gap:2},md:{height:64,barCount:50,barWidth:4,gap:2},lg:{height:80,barCount:60,barWidth:5,gap:3}}),[]),c=l[i]||l.md;switch(n){case"waveform":return s.jsx(AR,{level:a,isActive:e,config:c,className:r,accentColor:o});case"bars":return s.jsx(_R,{level:a,isActive:e,config:c,className:r,accentColor:o});case"pulse":return s.jsx(MR,{level:a,isActive:e,size:i,className:r,accentColor:o});case"minimal":return s.jsx(PR,{level:a,isActive:e,className:r,accentColor:o});case"spectrum":default:return s.jsx(IR,{level:a,isActive:e,config:c,className:r,accentColor:o})}},IR=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const[o,a]=f.useState([]),l=f.useRef(null),c=f.useRef(0),d=r||"#3b82f6",u=r?`${r}60`:"rgba(59, 130, 246, 0.4)";return f.useEffect(()=>{const h=n.barCount,p=()=>{const m=Date.now();if(m-c.current<50){l.current=requestAnimationFrame(p);return}c.current=m;const x=Array.from({length:h},(g,y)=>{if(!e)return 8+Math.random()*12;const v=Math.pow(t,.5),k=15+v*60,S=Math.sin(y/h*Math.PI*2+m*.003)*.3+.7,C=(Math.random()-.5)*v*40,b=Math.sin(y/h*Math.PI*3+m*.005)*v*15,j=k*S+C+b;return Math.min(95,Math.max(8,j))});a(x),l.current=requestAnimationFrame(p)};return p(),()=>{l.current&&cancelAnimationFrame(l.current)}},[e,t,n.barCount]),s.jsxs("div",{className:ot("relative w-full flex items-end justify-center",i),style:{height:n.height},children:[e&&t>.1&&s.jsx("div",{className:"absolute inset-0 rounded-lg opacity-30",style:{background:`radial-gradient(ellipse at center, ${u} 0%, transparent 70%)`}}),s.jsx("div",{className:"flex items-end justify-center h-full",style:{gap:n.gap},children:o.map((h,p)=>s.jsx("div",{className:"rounded-full transition-all",style:{width:n.barWidth,height:`${h}%`,background:e?`linear-gradient(to top, ${d}, ${vs(d,40)})`:`linear-gradient(to top, ${vs(d,-30)}, ${vs(d,10)})`,opacity:e?.85+t*.15:.4,boxShadow:e&&t>.2?`0 0 ${4+t*8}px ${u}`:"none",transition:"height 0.08s ease-out, opacity 0.15s ease-out"}},p))})]})},AR=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const o=f.useRef(null),a=f.useRef(null),l=f.useRef(0),c=r||"#3b82f6";return f.useEffect(()=>{const d=o.current;if(!d)return;const u=d.getContext("2d"),h=d.width,p=d.height,m=()=>{u.clearRect(0,0,h,p);const x=e?.3+t*.5:.15,g=e?2+t:1.5;l.current+=e?.08+t*.04:.02;const y=u.createLinearGradient(0,0,h,0);y.addColorStop(0,vs(c,-20)+"80"),y.addColorStop(.5,c),y.addColorStop(1,vs(c,-20)+"80"),u.beginPath(),u.moveTo(0,p/2);for(let v=0;v<=h;v++){const k=v/h,S=Math.sin(k*Math.PI*g+l.current)*x,C=Math.sin(k*Math.PI*g*1.5+l.current*1.3)*x*.5,b=Math.sin(k*Math.PI*g*2.5+l.current*.7)*x*.25,j=Math.sin(k*Math.PI),w=p/2+(S+C+b)*p*j;u.lineTo(v,w)}u.strokeStyle=y,u.lineWidth=3,u.lineCap="round",u.stroke(),u.globalAlpha=.3,u.beginPath(),u.moveTo(0,p/2);for(let v=0;v<=h;v++){const k=v/h,S=Math.sin(k*Math.PI*g+l.current+.5)*x*.6,C=Math.sin(k*Math.PI),b=p/2+S*p*C;u.lineTo(v,b)}u.strokeStyle=y,u.lineWidth=2,u.stroke(),u.globalAlpha=1,a.current=requestAnimationFrame(m)};return m(),()=>{a.current&&cancelAnimationFrame(a.current)}},[e,t,c]),s.jsx("div",{className:ot("relative w-full",i),style:{height:n.height},children:s.jsx("canvas",{ref:o,width:500,height:n.height,className:"w-full h-full",style:{filter:e&&t>.2?`drop-shadow(0 0 8px ${c}60)`:"none"}})})},_R=({level:t,isActive:e,config:n,className:i,accentColor:r})=>{const o=n.barCount,a=r||"#3b82f6",c=(()=>{if(!e)return Array.from({length:o},()=>8+Math.random()*10);const d=Math.pow(t,.6);return Array.from({length:o},(u,h)=>{const p=20+d*55,m=Math.random()*d*30,x=Math.sin(h/o*Math.PI*4+Date.now()*.005)*d*10;return Math.min(95,Math.max(10,p+m+x))})})();return s.jsx("div",{className:ot("flex items-end justify-center w-full",i),style:{height:n.height,gap:n.gap},children:c.map((d,u)=>s.jsx(V.div,{className:"rounded-sm",style:{width:n.barWidth,background:`linear-gradient(to top, ${a}, ${vs(a,50)})`,boxShadow:e&&t>.15?`0 0 ${4+t*10}px ${a}50`:"none"},animate:{height:`${d}%`,opacity:e?.8+t*.2:.35},transition:{duration:.08,ease:"easeOut"}},u))})},MR=({level:t,isActive:e,size:n,className:i,accentColor:r})=>{const o={sm:{container:"w-16 h-16",icon:"w-6 h-6",ring:"w-20 h-20"},md:{container:"w-20 h-20",icon:"w-8 h-8",ring:"w-28 h-28"},lg:{container:"w-24 h-24",icon:"w-10 h-10",ring:"w-36 h-36"}},a=o[n]||o.md,l=r||"#3b82f6";return s.jsxs("div",{className:ot("relative flex items-center justify-center",i),children:[e&&s.jsxs(s.Fragment,{children:[s.jsx(V.div,{className:ot("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.3+t*.4],opacity:[.4,0]},transition:{duration:1,repeat:1/0,ease:"easeOut"}}),s.jsx(V.div,{className:ot("absolute rounded-full",a.ring),style:{border:`2px solid ${l}`,opacity:.3},animate:{scale:[1,1.2+t*.3],opacity:[.3,0]},transition:{duration:1,repeat:1/0,ease:"easeOut",delay:.3}})]}),s.jsx(V.div,{className:ot("rounded-full flex items-center justify-center",a.container),style:{background:`linear-gradient(135deg, ${l}, ${vs(l,-20)})`,boxShadow:e?`0 0 ${20+t*30}px ${l}40`:`0 4px 12px ${l}20`},animate:{scale:e?1+t*.15:1},transition:{duration:.1},children:s.jsx(Fe,{className:ot(a.icon,"text-white")})})]})},PR=({level:t,isActive:e,className:n,accentColor:i})=>{const r=i||"#3b82f6",o=()=>e?t>.7?"rgb(34, 197, 94)":t>.3?r:"rgb(148, 163, 184)":"rgb(148, 163, 184)";return s.jsx("div",{className:ot("h-3 bg-slate-200 rounded-full overflow-hidden",n),children:s.jsx(V.div,{className:"h-full rounded-full",style:{backgroundColor:o()},animate:{width:`${Math.max(5,t*100)}%`},transition:{duration:.1,ease:"easeOut"}})})};function vs(t,e){const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n){const i=Math.min(255,Math.max(0,parseInt(n[1])+e)),r=Math.min(255,Math.max(0,parseInt(n[2])+e)),o=Math.min(255,Math.max(0,parseInt(n[3])+e));return`rgb(${i}, ${r}, ${o})`}if(t.startsWith("#")){const i=t.slice(1);let r;i.length===3?r=parseInt(i[0]+i[0]+i[1]+i[1]+i[2]+i[2],16):r=parseInt(i,16);const o=Math.min(255,Math.max(0,(r>>16&255)+e)),a=Math.min(255,Math.max(0,(r>>8&255)+e)),l=Math.min(255,Math.max(0,(r&255)+e));return`rgb(${o}, ${a}, ${l})`}return t}const _u=({isOpen:t,onClose:e,deviceId:n})=>{const[i,r]=f.useState("idle"),[o,a]=f.useState(0),[l,c]=f.useState(null),[d,u]=f.useState(0),[h,p]=f.useState(null),m=Ve(),x=f.useRef(null),g=f.useRef([]),y=f.useRef(null),v=f.useRef(null),k=f.useRef(null),S=f.useRef(null),C=f.useRef(null),b=f.useRef(null),j=10;f.useEffect(()=>()=>T(),[]),f.useEffect(()=>{t?w():T()},[t]);const w=()=>{r("idle"),a(0),u(0),p(null),l&&(URL.revokeObjectURL(l),c(null))},T=()=>{if(C.current&&(clearInterval(C.current),C.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),x.current&&x.current.state!=="inactive")try{x.current.stop()}catch{}if(v.current){try{v.current.close()}catch{}v.current=null}y.current&&(y.current.getTracks().forEach(N=>N.stop()),y.current=null),b.current&&(b.current.pause(),b.current.src="")},I=async()=>{try{p(null),g.current=[],u(0);const N={audio:n?{deviceId:{exact:n}}:!0},M=await navigator.mediaDevices.getUserMedia(N);y.current=M,v.current=new(window.AudioContext||window.webkitAudioContext),k.current=v.current.createAnalyser(),v.current.createMediaStreamSource(M).connect(k.current),k.current.fftSize=256;const $=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";x.current=new MediaRecorder(M,{mimeType:$}),x.current.ondataavailable=z=>{z.data.size>0&&g.current.push(z.data)},x.current.onstop=()=>{const z=new Blob(g.current,{type:$}),L=URL.createObjectURL(z);c(L),r("recorded"),a(0)},x.current.start(100),r("recording");const D=()=>{if(k.current){const z=new Uint8Array(k.current.frequencyBinCount);k.current.getByteFrequencyData(z);const L=z.reduce((ee,se)=>ee+se,0)/z.length;a(L/255)}S.current=requestAnimationFrame(D)};D(),C.current=setInterval(()=>{u(z=>z>=j-1?(E(),j):z+1)},1e3)}catch(N){console.error("Error starting recording:",N),N.name==="NotAllowedError"?p("Mikrofonzugriff verweigert"):N.name==="NotFoundError"?p("Kein Mikrofon gefunden"):p("Fehler beim Starten der Aufnahme")}},E=()=>{C.current&&(clearInterval(C.current),C.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),v.current&&(v.current.close(),v.current=null),x.current&&x.current.state!=="inactive"&&x.current.stop(),y.current&&(y.current.getTracks().forEach(N=>N.stop()),y.current=null)},P=()=>{l&&(b.current&&b.current.pause(),b.current=new Audio(l),b.current.onended=()=>r("recorded"),b.current.play(),r("playing"))},O=()=>{b.current&&(b.current.pause(),b.current.currentTime=0),r("recorded")},B=()=>{l&&URL.revokeObjectURL(l),c(null),u(0),r("idle")};return t?s.jsx(De,{children:s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:m.space[5]},children:s.jsxs(V.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:N=>N.stopPropagation(),style:{backgroundColor:R.white,borderRadius:m.radius["2xl"],width:"100%",maxWidth:"400px",boxShadow:m.shadow.xl,overflow:"hidden"},children:[s.jsxs("div",{style:{padding:`${m.space[5]} ${m.space[6]}`,borderBottom:`1px solid ${R.slate[200]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:m.space[3]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:m.radius.md,background:m.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Fe,{style:{width:"20px",height:"20px",color:R.white}})}),s.jsxs("div",{children:[s.jsx("h2",{style:{fontSize:m.fontSize.xl,fontWeight:600,color:R.slate[900],margin:0},children:"Mikrofon testen"}),s.jsx("p",{style:{fontSize:m.fontSize.sm,color:R.slate[500],margin:0},children:"Prfe deine Audioqualitt"})]})]}),s.jsx("button",{onClick:e,style:{width:"44px",height:"44px",borderRadius:m.radius.lg,border:"none",backgroundColor:R.slate[100],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:m.transition.normal},onMouseEnter:N=>N.currentTarget.style.backgroundColor=R.slate[200],onMouseLeave:N=>N.currentTarget.style.backgroundColor=R.slate[100],children:s.jsx(Ot,{style:{width:"24px",height:"24px",color:R.slate[600]}})})]}),s.jsxs("div",{style:{padding:`${m.space[8]} ${m.space[6]}`},children:[h&&s.jsxs("div",{style:{marginBottom:m.space[6],padding:m.space[4],backgroundColor:R.red[50],border:`1px solid ${R.red[100]}`,borderRadius:m.radius.lg,display:"flex",alignItems:"center",gap:m.space[3]},children:[s.jsx(ke,{style:{width:"20px",height:"20px",color:R.red[500]}}),s.jsx("p",{style:{fontSize:m.fontSize.base,color:R.red[600],margin:0},children:h})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:m.space[6]},children:s.jsxs("div",{style:{position:"relative"},children:[s.jsxs(V.div,{style:{width:"120px",height:"120px",borderRadius:"50%",backgroundColor:i==="recording"?R.red[50]:i==="playing"?R.green[50]:i==="recorded"?R.green[50]:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center"},children:[i==="recording"&&s.jsx(V.div,{style:{position:"absolute",inset:0,borderRadius:"50%",border:`3px solid ${R.red[500]}`},animate:{scale:[1,1+o*.3],opacity:[1,.3]},transition:{duration:.3,repeat:1/0}}),i==="idle"&&s.jsx(Fe,{style:{width:"48px",height:"48px",color:R.slate[400]}}),i==="recording"&&s.jsx(Fe,{style:{width:"48px",height:"48px",color:R.red[500]}}),i==="recorded"&&s.jsx(Ut,{style:{width:"48px",height:"48px",color:R.green[500]}}),i==="playing"&&s.jsx(ki,{style:{width:"48px",height:"48px",color:R.green[600]}})]}),i==="recording"&&s.jsxs("div",{style:{position:"absolute",bottom:"-8px",left:"50%",transform:"translateX(-50%)",padding:`${m.space[1]} ${m.space[3]}`,backgroundColor:R.red[500],color:R.white,borderRadius:m.radius["2xl"],fontSize:m.fontSize.sm,fontWeight:600,fontFamily:"monospace"},children:[d,"s / ",j,"s"]})]})}),i==="recording"&&s.jsx("div",{style:{marginBottom:m.space[6]},children:s.jsx(mr,{audioLevel:o,isActive:!0,variant:"bars",size:"sm"})}),s.jsxs("p",{style:{textAlign:"center",fontSize:m.fontSize.md,color:R.slate[600],marginBottom:m.space[6]},children:[i==="idle"&&'Klicke auf "Aufnahme starten" um dein Mikrofon zu testen.',i==="recording"&&"Sprich jetzt in dein Mikrofon...",i==="recorded"&&"Aufnahme fertig! Hre dir das Ergebnis an.",i==="playing"&&"Wiedergabe luft..."]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:m.space[3]},children:[i==="idle"&&s.jsxs("button",{onClick:I,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(Fe,{style:{width:"18px",height:"18px"}}),"Aufnahme starten"]}),i==="recording"&&s.jsxs("button",{onClick:E,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",backgroundColor:R.red[500],color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(ks,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),i==="recorded"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:P,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[7]}`,borderRadius:m.radius.lg,border:"none",background:m.buttonGradient,color:R.white,fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(Dt,{style:{width:"18px",height:"18px"}}),"Anhren"]}),s.jsxs("button",{onClick:B,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(zt,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]}),i==="playing"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:O,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(ks,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),s.jsxs("button",{onClick:B,style:{display:"flex",alignItems:"center",gap:m.space[2],padding:`${m.space["3.5"]} ${m.space[5]}`,borderRadius:m.radius.lg,border:`2px solid ${R.slate[200]}`,backgroundColor:R.white,color:R.slate[700],fontSize:m.fontSize.md,fontWeight:600,cursor:"pointer"},children:[s.jsx(zt,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]})]})]})]})})}):null},NR=({type:t,devices:e,selectedDeviceId:n,onDeviceChange:i,isLoading:r,error:o,onRefresh:a,branding:l})=>{const[c,d]=f.useState(!1),u=t==="video"?Wx:Fe,h=t==="video"?"Kamera":"Mikrofon",p=g=>{if(g.label){let y=g.label;return y=y.replace(/^Default - /,""),y=y.replace(/^Kommunikation - /,""),y=y.replace(/^Standard - /,""),y.length>40&&(y=y.substring(0,37)+"..."),y}return`${h} ${e.indexOf(g)+1}`},m=e.find(g=>g.deviceId===n),x=g=>{i?.(g),d(!1)};return s.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:s.jsxs("button",{type:"button",onClick:()=>!r&&d(!c),disabled:r,style:{flex:"1 1 100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"14px 18px",borderRadius:"14px",border:`2px solid ${o?l.error:l.borderColor}`,backgroundColor:o?l.errorLight:l.cardBgColor,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:o?l.errorLight:l.headerGradient},children:o?s.jsx(ke,{style:{width:"24px",height:"24px",color:l.error}}):s.jsx(u,{style:{width:"24px",height:"24px",color:l.white}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"13px",color:l.textMuted,fontWeight:500,marginBottom:"2px"},children:h}),s.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:o?l.errorDark:l.textMain},children:r?"Lade...":o||(m?p(m):"Bitte whlen")})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o&&a&&s.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),a()},style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l.cardBgHover,cursor:"pointer"},children:s.jsx(zt,{style:{width:"18px",height:"18px",color:l.textSecondary}})}),s.jsx(ct,{style:{width:"22px",height:"22px",color:l.textMuted,transform:c?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]})]})}),c&&e.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>d(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:l.cardBgColor,borderRadius:"14px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:`1px solid ${l.borderColor}`,zIndex:50,overflow:"hidden",maxHeight:"300px",overflowY:"auto"},children:e.map((g,y)=>s.jsxs("button",{type:"button",onClick:()=>x(g.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:n===g.deviceId?l.primaryAccentLight:l.transparent,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:v=>{n!==g.deviceId&&(v.currentTarget.style.backgroundColor=l.cardBgHover)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=n===g.deviceId?l.primaryAccentLight:l.transparent},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:n===g.deviceId?l.primaryAccent:l.cardBgHover},children:s.jsx(u,{style:{width:"20px",height:"20px",color:n===g.deviceId?l.white:l.textMuted}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:n===g.deviceId?l.primaryAccent:l.textMain,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p(g)}),g.deviceId==="default"&&s.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:"Systemstandard"})]}),n===g.deviceId&&s.jsx(Ut,{style:{width:"20px",height:"20px",color:l.primaryAccent}})]},g.deviceId||y))})]})]})},DR=({deviceId:t,branding:e})=>{const[n,i]=f.useState(!1),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(null),[u,h]=f.useState(0),p=f.useRef(null),m=f.useRef(null),x=f.useRef(null),g=f.useRef(null),y=f.useRef(null),v=f.useRef([]),k=f.useRef(null),S=f.useRef(null),C=async()=>{try{d(null),h(0),v.current=[];const I=await navigator.mediaDevices.getUserMedia({audio:t?{deviceId:{exact:t}}:!0});p.current=I;const E=new(window.AudioContext||window.webkitAudioContext);g.current=E;const P=E.createMediaStreamSource(I),O=E.createAnalyser();O.fftSize=256,P.connect(O),m.current=O;const B=new MediaRecorder(I,{mimeType:"audio/webm"});y.current=B,B.ondataavailable=$=>{$.data.size>0&&v.current.push($.data)},B.onstop=()=>{const $=new Blob(v.current,{type:"audio/webm"});d($)},B.start(),i(!0);const N=Date.now();S.current=setInterval(()=>{h(Math.floor((Date.now()-N)/1e3))},100);const M=new Uint8Array(O.frequencyBinCount),F=()=>{O.getByteFrequencyData(M);const $=M.reduce((D,z)=>D+z,0)/M.length;l(Math.min(100,$/128*100)),x.current=requestAnimationFrame(F)};F()}catch(I){console.error("Error starting recording:",I)}},b=()=>{S.current&&(clearInterval(S.current),S.current=null),x.current&&(cancelAnimationFrame(x.current),x.current=null),y.current&&y.current.state!=="inactive"&&y.current.stop(),p.current&&(p.current.getTracks().forEach(I=>I.stop()),p.current=null),g.current&&(g.current.close(),g.current=null),i(!1),l(0)},j=()=>{if(!c)return;const I=URL.createObjectURL(c),E=new Audio(I);k.current=E,E.onplay=()=>o(!0),E.onended=()=>{o(!1),URL.revokeObjectURL(I)},E.onerror=()=>{o(!1),URL.revokeObjectURL(I)},E.play()},w=()=>{k.current&&(k.current.pause(),k.current.currentTime=0,k.current=null),o(!1)},T=()=>{w(),d(null),h(0)};return f.useEffect(()=>()=>{b(),w()},[]),f.useEffect(()=>{n&&b(),T()},[t]),s.jsxs("div",{style:{padding:"16px",backgroundColor:e.cardBgHover,borderRadius:"12px",marginTop:"8px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsx("button",{type:"button",onClick:n?b:C,disabled:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"none",backgroundColor:n?e.error:e.primaryAccent,color:e.white,fontSize:"14px",fontWeight:600,cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:n?s.jsxs(s.Fragment,{children:[s.jsx(ks,{style:{width:"16px",height:"16px"}}),"Stoppen (",pt(u),")"]}):s.jsxs(s.Fragment,{children:[s.jsx(Fe,{style:{width:"16px",height:"16px"}}),"Aufnehmen"]})}),c&&!n&&s.jsx("button",{type:"button",onClick:r?w:j,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:`2px solid ${e.primaryAccent}`,backgroundColor:r?e.primaryAccentLight:e.cardBgColor,color:e.primaryAccent,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:r?s.jsxs(s.Fragment,{children:[s.jsx(ks,{style:{width:"16px",height:"16px"}}),"Stoppen"]}):s.jsxs(s.Fragment,{children:[s.jsx(Dt,{style:{width:"16px",height:"16px"}}),"Abspielen"]})}),n&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.error,fontSize:"13px"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:e.error,animation:"pulse 1s infinite"}}),"Aufnahme luft..."]}),r&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.successDark,fontSize:"13px"},children:[s.jsx(ki,{style:{width:"16px",height:"16px"}}),"Wiedergabe..."]}),c&&!n&&!r&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:e.textMuted,fontSize:"13px"},children:[s.jsx(Ut,{style:{width:"16px",height:"16px",color:e.success}}),"Aufnahme bereit (",pt(u),")"]})]}),n&&s.jsx(mr,{audioLevel:a/100,isActive:!0,variant:"bars",size:"sm"}),!n&&!c&&s.jsxs("p",{style:{margin:0,fontSize:"13px",color:e.textMuted,display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(ki,{style:{width:"14px",height:"14px"}}),"Nimm etwas auf und spiele es ab, um dein Mikrofon zu testen."]}),s.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})},zR=({deviceId:t,branding:e})=>{const n=f.useRef(null),i=f.useRef(null),[r,o]=f.useState(null);return f.useEffect(()=>(t&&(async()=>{try{i.current&&i.current.getTracks().forEach(c=>c.stop());const l=await navigator.mediaDevices.getUserMedia({video:t?{deviceId:{exact:t}}:!0});i.current=l,n.current&&(n.current.srcObject=l),o(null)}catch(l){console.error("Error starting camera preview:",l),o("Kamera-Vorschau nicht verfgbar")}})(),()=>{i.current&&i.current.getTracks().forEach(l=>l.stop())}),[t]),r?s.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.cardBgHover,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:e.textMuted,fontSize:"14px"},children:r}):s.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:e.textMain,borderRadius:"12px",overflow:"hidden"},children:s.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}})})},iy=({mode:t="audio",scenario:e,onBack:n,onStart:i,title:r,startButtonLabel:o="Training starten",icon:a,extraContent:l=null,disabled:c=!1})=>{const[d,u]=f.useState(window.innerWidth<768);f.useEffect(()=>{const L=()=>u(window.innerWidth<768);return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const[h,p]=f.useState([]),[m,x]=f.useState([]),[g,y]=f.useState(null),[v,k]=f.useState(null),[S,C]=f.useState(!0),[b,j]=f.useState(null),[w,T]=f.useState(null),[I,E]=f.useState(!1),P=f.useRef(0),O=f.useRef(!1),B=f.useRef(null),N=f.useRef(null),M=Ve(),F=t==="audio-video";B.current=g,N.current=v;const $=f.useCallback(async(L=!1)=>{if(!O.current&&!(L&&Date.now()-P.current<2e3)){O.current=!0,P.current=Date.now(),C(!0),j(null),F&&T(null);try{const ee={audio:!0};F&&(ee.video=!0),(await navigator.mediaDevices.getUserMedia(ee)).getTracks().forEach(A=>A.stop());const G=await navigator.mediaDevices.enumerateDevices();console.log("[DeviceSetupPage] All detected devices:",G.map(A=>({kind:A.kind,label:A.label||"(no label)",deviceId:A.deviceId?.substring(0,8)+"..."})));const q=G.filter(A=>A.kind==="audioinput"),ie=G.filter(A=>A.kind==="videoinput");if(console.log("[DeviceSetupPage] Audio inputs:",q.length,"Video inputs:",ie.length),q.length===0)console.warn("[DeviceSetupPage] No audioinput devices found"),j("Kein Mikrofon gefunden"),p([]);else if(p(q),!B.current){const A=q.find(W=>W.deviceId==="default")||q[0];y(A.deviceId)}if(F){if(ie.length===0)T("Keine Kamera gefunden"),x([]);else if(x(ie),!N.current){const A=ie.find(W=>W.deviceId==="default")||ie[0];k(A.deviceId)}}}catch(ee){console.error("Error loading devices:",ee),ee.name==="NotAllowedError"||ee.name==="PermissionDeniedError"?(j("Zugriff verweigert"),F&&T("Zugriff verweigert")):ee.name==="NotFoundError"?(j("Kein Mikrofon gefunden"),F&&T("Keine Kamera gefunden")):(j("Fehler beim Laden"),F&&T("Fehler beim Laden"))}finally{C(!1),O.current=!1,P.current=Date.now()}}},[F]);f.useEffect(()=>{$(!1);let L=null;const ee=()=>{L&&clearTimeout(L),L=setTimeout(()=>{$(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",ee),()=>{L&&clearTimeout(L),navigator.mediaDevices?.removeEventListener("devicechange",ee)}},[]);const D=()=>{i({selectedMicrophoneId:g,selectedCameraId:F?v:null})},z=g&&!b&&(!F||v&&!w)&&!c;return s.jsxs("div",{style:{padding:"24px",paddingBottom:d?"120px":"40px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:M.transparent,color:M.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:L=>L.target.style.background=M.cardBgHover,onMouseLeave:L=>L.target.style.background=M.transparent,children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:M.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:a?s.jsx(a,{style:{width:"28px",height:"28px",color:M.headerText}}):s.jsx(Fe,{style:{width:"28px",height:"28px",color:M.headerText}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:M.textMain,margin:0},children:r||e?.title||"Gerte einrichten"}),s.jsx("p",{style:{fontSize:"14px",color:M.textSecondary,margin:"4px 0 0 0"},children:F?"Kamera und Mikrofon auswhlen":"Mikrofon auswhlen und testen"})]})]})]}),S&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 24px",backgroundColor:M.cardBgHover,borderRadius:"16px"},children:[s.jsx(he,{style:{width:"32px",height:"32px",color:M.primaryAccent,marginBottom:"16px"},className:"animate-spin"}),s.jsx("p",{style:{color:M.textSecondary,margin:0},children:"Gerte werden geladen..."})]}),!S&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[F&&s.jsxs("div",{style:{padding:"24px",backgroundColor:M.cardBgColor,borderRadius:"16px",border:`1px solid ${M.borderColor}`,marginBottom:"20px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Wx,{style:{width:"22px",height:"22px",color:M.primaryAccent}}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:M.textMain,margin:0},children:"Kamera auswhlen"})]}),s.jsx(NR,{type:"video",devices:m,selectedDeviceId:v,onDeviceChange:k,isLoading:S,error:w,onRefresh:$,branding:M}),v&&!w&&s.jsx(zR,{deviceId:v,branding:M})]}),s.jsxs("div",{style:{padding:"24px",backgroundColor:M.cardBgColor,borderRadius:"16px",border:`1px solid ${M.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Fe,{style:{width:"22px",height:"22px",color:M.primaryAccent}}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:M.textMain,margin:0},children:"Mikrofon testen"})]}),s.jsx(Au,{selectedDeviceId:g,onDeviceChange:y,onTestClick:()=>E(!0)})]}),l&&s.jsx("div",{style:{marginBottom:"24px"},children:l}),s.jsx("div",{style:d?{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:`linear-gradient(to top, ${M.pageBg} 80%, transparent)`,zIndex:100}:{},children:s.jsxs("button",{onClick:D,disabled:!z,style:{width:"100%",maxWidth:d?"100%":void 0,padding:"16px 24px",borderRadius:"14px",border:"none",background:z?M.buttonGradient:M.disabledBg,color:M.white,fontSize:"16px",fontWeight:600,cursor:z?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:z?`0 4px 12px ${M.primaryAccent}4d`:"none"},onMouseEnter:L=>{z&&(L.target.style.transform="translateY(-2px)",L.target.style.boxShadow=`0 6px 16px ${M.primaryAccent}66`)},onMouseLeave:L=>{L.target.style.transform="none",L.target.style.boxShadow=z?`0 4px 12px ${M.primaryAccent}4d`:"none"},children:[o,s.jsx(Eo,{style:{width:"20px",height:"20px"}})]})})]}),s.jsx(_u,{isOpen:I,onClose:()=>E(!1),deviceId:g})]})},OR="wss://karriereheld-ws-proxy.onrender.com/ws";async function LR(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`wss://api.elevenlabs.io/v1/convai/conversation?agent_id=${t}`,i=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Connection timeout - WebSocket may be blocked by firewall"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-i;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"WebSocket connection failed - may be blocked by firewall"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-i}):c({success:!1,error:`Connection closed: ${u.code} ${u.reason||""}`.trim()}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to create WebSocket connection"})}})}async function sy(t,e=5e3){if(!t)return{success:!1,error:"No agent ID provided"};const n=`${OR}?agent_id=${t}`,i=Date.now();return new Promise(r=>{let o=null,a=!1;const l=()=>{if(o){try{o.close()}catch{}o=null}},c=u=>{a||(a=!0,l(),r(u))},d=setTimeout(()=>{c({success:!1,error:"Proxy connection timeout"})},e);try{o=new WebSocket(n),o.onopen=()=>{clearTimeout(d);const u=Date.now()-i;c({success:!0,latency:u})},o.onerror=u=>{clearTimeout(d),c({success:!1,error:"Proxy connection failed"})},o.onclose=u=>{clearTimeout(d),a||(u.code===1e3?c({success:!0,latency:Date.now()-i}):c({success:!1,error:`Proxy connection closed: ${u.code}`}))}}catch(u){clearTimeout(d),c({success:!1,error:u.message||"Failed to connect to proxy"})}})}function BR(){return typeof WebSocket<"u"}async function FR(t){if(!BR())return{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Browser untersttzt keine WebSocket-Verbindungen"};const e=await LR(t,5e3);if(e.success)return{mode:"websocket",directAvailable:!0,proxyAvailable:!1,directLatency:e.latency};const n=await sy(t,5e3);return n.success?{mode:"proxy",directAvailable:!1,proxyAvailable:!0,proxyLatency:n.latency,error:e.error}:{mode:"proxy",directAvailable:!1,proxyAvailable:!1,error:"Alle WebSocket-Verbindungen werden durch Firewall blockiert"}}const WR=({mode:t,isChecking:e,latency:n,proxyLatency:i,error:r,onSwitchMode:o,onRetry:a,directAvailable:l,proxyAvailable:c,b:d})=>e?s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.blue[50],border:`1px solid ${R.blue[200]}`,borderRadius:d.radius.lg},children:[s.jsx(he,{style:{width:"20px",height:"20px",color:R.blue[500]},className:"animate-spin"}),s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:R.blue[700]},children:"Prfe Verbindung..."})]}):r&&!l&&!c?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[3]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.red[50],border:`1px solid ${R.red[200]}`,borderRadius:d.radius.lg},children:[s.jsx(ss,{style:{width:"20px",height:"20px",color:R.red[600]}}),s.jsx("div",{style:{flex:1},children:s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:R.red[800]},children:"Keine Verbindung mglich"})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.slate[50],border:`1px solid ${R.slate[200]}`,borderRadius:d.radius.lg},children:[s.jsx(un,{style:{width:"16px",height:"16px",color:R.slate[500],flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{style:{fontSize:d.fontSize.xs,color:R.slate[600]},children:[s.jsx("p",{style:{margin:0,fontWeight:d.fontWeight.medium,marginBottom:d.space[1]},children:"WebSocket-Verbindungen blockiert"}),s.jsx("p",{style:{margin:0},children:r})]})]}),s.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:d.space[1.5],fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",padding:0},children:[s.jsx(zt,{style:{width:"12px",height:"12px"}}),"Verbindung erneut prfen"]})]}):t==="websocket"?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.green[50],border:`1px solid ${R.green[200]}`,borderRadius:d.radius.lg},children:[s.jsx(pu,{style:{width:"20px",height:"20px",color:R.green[500]}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:R.green[700]},children:"Direkte Echtzeit-Verbindung"}),n&&s.jsxs("span",{style:{fontSize:d.fontSize.xs,color:R.green[600],marginLeft:d.space[2]},children:["(",n,"ms)"]})]}),s.jsx(Zi,{style:{width:"20px",height:"20px",color:R.green[500]}})]}),s.jsx("button",{onClick:()=>o("proxy"),style:{fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Proxy-Modus testen"})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:d.space[2]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d.space[2.5],padding:`${d.space[3.5]} ${d.space[4]}`,backgroundColor:R.blue[50],border:`1px solid ${R.blue[200]}`,borderRadius:d.radius.lg},children:[s.jsx(mu,{style:{width:"20px",height:"20px",color:R.blue[500]}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("span",{style:{fontSize:d.fontSize.base,fontWeight:d.fontWeight.medium,color:R.blue[700]},children:"Proxy-Modus (Echtzeit via Server)"}),i&&s.jsxs("span",{style:{fontSize:d.fontSize.xs,color:R.blue[500],marginLeft:d.space[2]},children:["(",i,"ms)"]})]}),s.jsx(Zi,{style:{width:"20px",height:"20px",color:R.blue[500]}})]}),!l&&s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:d.space[2.5],padding:`${d.space[3]} ${d.space[4]}`,backgroundColor:R.slate[50],border:`1px solid ${R.slate[200]}`,borderRadius:d.radius.lg},children:[s.jsx(un,{style:{width:"14px",height:"14px",color:R.slate[500],flexShrink:0,marginTop:"2px"}}),s.jsx("div",{style:{fontSize:d.fontSize.xs,color:R.slate[600]},children:s.jsx("p",{style:{margin:0},children:"Direkte Verbindung blockiert. Der Proxy-Server ermglicht Echtzeit-Gesprche trotz Firewall."})})]}),l&&s.jsx("button",{onClick:()=>o("websocket"),style:{fontSize:d.fontSize.xs,color:R.slate[500],background:"none",border:"none",cursor:"pointer",textDecoration:"underline",textAlign:"left",padding:0},children:"Direkte Verbindung nutzen"})]}),UR=({scenario:t,onBack:e,onStart:n})=>{const i=Ve(),[r,o]=f.useState("websocket"),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState(!1),[y,v]=f.useState(!1);f.useEffect(()=>{k()},[t]);const k=async()=>{l(!0),d(null);try{const E=t?.agent_id||ue.getElevenLabsAgentId();if(!E){o("websocket"),d("Keine Agent-ID konfiguriert"),g(!1),v(!1),l(!1);return}const P=await FR(E);o(P.mode),g(P.directAvailable),v(P.proxyAvailable),h(P.directLatency||null),m(P.proxyLatency||null),d(P.error||null)}catch(E){console.error("[DeviceSetup] Connection check failed:",E),o("websocket"),d(E.message),g(!1),v(!1)}finally{l(!1)}},S=async E=>{const P=t?.agent_id||ue.getElevenLabsAgentId();if(E==="proxy"&&!y&&P){l(!0);const O=await sy(P,5e3);if(l(!1),O.success)v(!0),m(O.latency),o("proxy");else{d("Proxy-Verbindung nicht verfgbar: "+O.error);return}}else o(E)},C=()=>{k()},b=({selectedMicrophoneId:E})=>{n({selectedMicrophoneId:E,connectionMode:r})},j=t?.interviewer_profile?.name;let w;r==="proxy"?w=j?`${j} anrufen (Proxy)`:"Gesprch starten (Proxy)":j?w=`${j} anrufen`:w="Gesprch starten";const T=()=>r==="proxy"?s.jsx(mu,{style:{width:"20px",height:"20px",color:i.primaryAccent}}):s.jsx(pu,{style:{width:"20px",height:"20px",color:i.primaryAccent}}),I=s.jsxs("div",{style:{padding:i.space[5],backgroundColor:"white",borderRadius:i.radius.xl,border:`1px solid ${R.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2.5],marginBottom:i.space[4]},children:[T(),s.jsx("h3",{style:{fontSize:i.fontSize.lg,fontWeight:i.fontWeight.semibold,color:R.slate[900],margin:0},children:"Verbindungsmodus"})]}),s.jsx(WR,{mode:r,isChecking:a,latency:u,proxyLatency:p,error:c,onSwitchMode:S,onRetry:C,directAvailable:x,proxyAvailable:y,b:i})]});return s.jsx(iy,{mode:"audio",scenario:t,onBack:e,onStart:b,title:t?.title,startButtonLabel:w,icon:Ye,disabled:a,extraContent:I})},$R=(t,e=300)=>{setTimeout(()=>{const n=t.target;if(n){const i=n.closest("div");i&&i.scrollIntoView({behavior:"smooth",block:"center"})}},e)},VR=(t,e=!1)=>({width:"100%",padding:`${t.space[3]} ${t.space[4]}`,borderRadius:t.radius.lg,border:`2px solid ${e?R.red[500]:R.slate[200]}`,fontSize:t.fontSize.base,color:R.slate[900],backgroundColor:"white",outline:"none",transition:`border-color ${t.transition.normal}, box-shadow ${t.transition.normal}`}),GR=`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,HR=({field:t,value:e,onChange:n,error:i,focusColor:r})=>{const o=Ve(),a=r||o.primaryAccent||R.blue[500],l=VR(o,!!i),c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=m=>{Object.assign(m.target.style,c),$R(m)},u=m=>{m.target.style.borderColor=i?R.red[500]:R.slate[200],m.target.style.boxShadow="none"},h=()=>t.placeholder||t.default||`${t.label} eingeben...`,p=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),style:l,onFocus:d,onBlur:u});case"textarea":return s.jsx("textarea",{value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:m=>n(t.key,m.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:GR,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(m=>{const x=m.value??m,g=m.label??m;return s.jsx("option",{value:x,children:g},x)})]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),min:t.validation?.min,max:t.validation?.max,style:l,onFocus:d,onBlur:u});default:return s.jsx("input",{type:"text",value:e||"",onChange:m=>n(t.key,m.target.value),placeholder:h(),style:l,onFocus:d,onBlur:u})}};return s.jsxs("div",{style:{marginBottom:o.space[5]},children:[s.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:o.space[1]},children:"*"})]}),p(),i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:R.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(ke,{style:{width:"14px",height:"14px",flexShrink:0}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.sm,color:R.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(un,{style:{width:"14px",height:"14px",flexShrink:0}}),t.hint]})]})},qR=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),l=Ve(),c=m=>{if(!m)return m;let x=m;return Object.entries(i).forEach(([g,y])=>{const v=new RegExp(`\\{\\{${g}\\}\\}`,"g");x=x.replace(v,y||"")}),x},d=As.useMemo(()=>t?.variables_schema?t.variables_schema.filter(m=>m.user_input!==!1):[],[t?.variables_schema]);f.useEffect(()=>{if(t?.variables_schema){const m={};t.variables_schema.forEach(x=>{x.default&&(m[x.key]=x.default)}),r(m)}},[t?.variables_schema]);const u=(m,x)=>{r(g=>({...g,[m]:x})),o[m]&&a(g=>{const y={...g};return delete y[m],y})},h=()=>{const m={};return d.forEach(x=>{const g=i[x.key];x.required&&(!g||g.toString().trim()==="")&&(m[x.key]=`${x.label} ist ein Pflichtfeld`)}),a(m),Object.keys(m).length===0},p=m=>{m.preventDefault(),h()&&n(i)};return f.useEffect(()=>{if(d.length===0){const m={};t?.variables_schema?.forEach(x=>{x.default&&(m[x.key]=x.default)}),n(m)}},[d,t,n]),d.length===0?null:s.jsxs("div",{style:{padding:l.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:l.space[8]},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:l.space[2],padding:`${l.space[2]} ${l.space[3]}`,marginBottom:l.space[4],border:"none",background:"transparent",color:R.slate[600],fontSize:l.fontSize.sm,cursor:"pointer",borderRadius:l.radius.md,transition:`background ${l.transition.normal}`},onMouseEnter:m=>m.target.style.background=R.slate[100],onMouseLeave:m=>m.target.style.background="transparent",children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[4]},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:l.radius.xl,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(St,{style:{width:"28px",height:"28px",color:l.headerText}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:l.fontSize.xl,fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[600],margin:`${l.space[1]} 0 0 0`},children:"Personalisiere dein Rollenspiel"})]})]})]}),t.long_description&&s.jsx("div",{style:{padding:`${l.space[5]} ${l.space[6]}`,borderRadius:l.radius.xl,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,marginBottom:l.space[6]},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:l.space[3.5]},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:l.radius.lg,background:l.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(un,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900],margin:`0 0 ${l.space[2]} 0`},children:"Deine Aufgabe"}),s.jsx("p",{style:{fontSize:l.fontSize.sm,lineHeight:"1.6",color:R.slate[700],margin:0,whiteSpace:"pre-wrap"},children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),!t.long_description&&t.description&&s.jsx("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:R.slate[100],marginBottom:l.space[6]},children:s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),t.interviewer_profile&&s.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,border:`1px solid ${R.slate[200]}`,marginBottom:l.space[6],display:"flex",alignItems:"center",gap:l.space[4]},children:[t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:c(t.interviewer_profile.name),style:{width:"48px",height:"48px",borderRadius:l.radius.full,objectFit:"cover"}}):s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:l.radius.full,background:l.primaryAccentLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(qt,{style:{width:"24px",height:"24px",color:l.primaryAccent}})}),s.jsxs("div",{children:[s.jsxs("p",{style:{fontSize:l.fontSize.sm,fontWeight:600,color:R.slate[900],margin:0},children:["Dein Gesprchspartner: ",c(t.interviewer_profile.name)]}),t.interviewer_profile.role&&s.jsx("p",{style:{fontSize:l.fontSize.sm,color:R.slate[600],margin:`${l.space[.5]} 0 0 0`},children:c(t.interviewer_profile.role)})]})]}),s.jsxs("form",{onSubmit:p,children:[d.map(m=>s.jsx(HR,{field:m,value:i[m.key],onChange:u,error:o[m.key],focusColor:l.primaryAccent},m.key)),s.jsxs("div",{style:{padding:`${l.space[4]} ${l.space[5]}`,borderRadius:l.radius.lg,backgroundColor:l.primaryAccentLight,marginTop:l.space[6],marginBottom:l.space[6],display:"flex",gap:l.space[5],flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsxs("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:[s.jsx(Je,{style:{width:"12px",height:"12px",display:"inline",marginRight:l.space[1]}}),"Dauer"]}),s.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:"ca. 10 Min"})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:l.fontSize.xs,color:R.slate[500],display:"block"},children:"Typ"}),s.jsx("span",{style:{fontSize:l.fontSize.base,fontWeight:600,color:R.slate[900]},children:"Live-Gesprch"})]})]}),s.jsxs("button",{type:"submit",style:{width:"100%",padding:`${l.space[4]} ${l.space[6]}`,borderRadius:l.radius.xl,border:"none",background:l.buttonGradient,color:"white",fontSize:l.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:l.space[2.5],transition:`transform ${l.transition.normal}, box-shadow ${l.transition.normal}`,boxShadow:`0 4px 12px ${l.primaryAccent}4d`},onMouseEnter:m=>{m.target.style.transform="translateY(-2px)",m.target.style.boxShadow=`0 6px 16px ${l.primaryAccent}66`},onMouseLeave:m=>{m.target.style.transform="none",m.target.style.boxShadow=`0 4px 12px ${l.primaryAccent}4d`},children:["Weiter",s.jsx(Eo,{style:{width:"20px",height:"20px"}})]})]})]})},Un=(t=768)=>{const[e,n]=f.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return f.useEffect(()=>{const i=()=>{n(window.innerWidth<t)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[t]),e},Hn={DIRECT:"direct",PROXY:"proxy"},KR="wss://karriereheld-ws-proxy.onrender.com/ws",Br=t=>{if(!t)return t;let e=t.replace(/<\/p>\s*<p[^>]*>/gi,`

`).replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(p|div|h[1-6])[^>]*>/gi,`
`).replace(/<li[^>]*>/gi,`
- `).replace(/<\/li>/gi,"");const n=document.createElement("div");return n.innerHTML=e,e=n.textContent||n.innerText||"",e=e.replace(/[ \t]+/g," ").replace(/\n /g,`
`).replace(/ \n/g,`
`).replace(/\n{3,}/g,`

`).trim(),e},JR=t=>{let e=Br(t?.content||"");return t?.interviewer_profile&&(e+=`

## Dein Profil:
`,t.interviewer_profile.name&&(e+=`
Dein Name: ${t.interviewer_profile.name}`),t.interviewer_profile.role&&(e+=`
Deine Rolle: ${t.interviewer_profile.role}`),t.interviewer_profile.properties&&(e+=`

### Deine Eigenschaften:
${Br(t.interviewer_profile.properties)}`),t.interviewer_profile.typical_objections&&(e+=`

### Typische Einwnde, die du vorbringen solltest:
${Br(t.interviewer_profile.typical_objections)}`),t.interviewer_profile.important_questions&&(e+=`

### Wichtige Fragen, die du stellen solltest:
${Br(t.interviewer_profile.important_questions)}`)),e},ry=(t,e)=>{const n={...t};return e?.interviewer_profile&&(e.interviewer_profile.name&&(n.interviewer_name=e.interviewer_profile.name),e.interviewer_profile.role&&(n.interviewer_role=e.interviewer_profile.role),e.interviewer_profile.company&&(n.interviewer_company=e.interviewer_profile.company)),n};var bf={};function YR(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var XR=Object.defineProperty,ZR=(t,e,n)=>e in t?XR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vf=(t,e,n)=>ZR(t,typeof e!="symbol"?e+"":e,n);let tn=class{constructor(){vf(this,"_locking"),vf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function mt(t,e){if(!t)throw new Error(e)}const QR=34028234663852886e22,eI=-34028234663852886e22,tI=4294967295,nI=2147483647,iI=-2147483648;function ca(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>nI||t<iI)throw new Error("invalid int 32: "+t)}function Xc(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>tI||t<0)throw new Error("invalid uint 32: "+t)}function oy(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>QR||t<eI))throw new Error("invalid float 32: "+t)}const ay=Symbol("@bufbuild/protobuf/enum-type");function sI(t){const e=t[ay];return mt(e,"missing enum type on enum object"),e}function ly(t,e,n,i){t[ay]=cy(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function cy(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of e){const l=dy(a);o.push(l),i[a.name]=l,r[a.no]=l}return{typeName:t,values:o,findName(a){return i[a]},findNumber(a){return r[a]}}}function rI(t,e,n){const i={};for(const r of e){const o=dy(r);i[o.localName]=o.no,i[o.no]=o.localName}return ly(i,t,e),i}function dy(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Mu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function oI(t,e,n,i){var r;const o=(r=i?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[o]:function(l){t.util.initFields(this),t.util.initPartial(l,this)}}[o];return Object.setPrototypeOf(a.prototype,new Mu),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(l,c){return new a().fromBinary(l,c)},fromJson(l,c){return new a().fromJson(l,c)},fromJsonString(l,c){return new a().fromJsonString(l,c)},equals(l,c){return t.util.equals(a,l,c)}}),a}function aI(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function ql(t,e,n){for(let o=0;o<28;o=o+7){const a=t>>>o,l=!(!(a>>>7)&&e==0),c=(l?a|128:a)&255;if(n.push(c),!l)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const a=e>>>o,l=!!(a>>>7),c=(l?a|128:a)&255;if(n.push(c),!l)return}n.push(e>>>31&1)}}const da=4294967296;function Sf(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(a,l){const c=Number(t.slice(a,l));r*=n,i=i*n+c,i>=da&&(r=r+(i/da|0),i=i%da)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?hy(i,r):Pu(i,r)}function lI(t,e){let n=Pu(t,e);const i=n.hi&2147483648;i&&(n=hy(n.lo,n.hi));const r=uy(n.lo,n.hi);return i?"-"+r:r}function uy(t,e){if({lo:t,hi:e}=cI(t,e),e<=2097151)return String(da*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,a=i+r*8147497,l=r*2;const c=1e7;return o>=c&&(a+=Math.floor(o/c),o%=c),a>=c&&(l+=Math.floor(a/c),a%=c),l.toString()+kf(a)+kf(o)}function cI(t,e){return{lo:t>>>0,hi:e>>>0}}function Pu(t,e){return{lo:t|0,hi:e|0}}function hy(t,e){return e=~e,t?t=~t+1:e+=1,Pu(t,e)}const kf=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Cf(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function dI(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function uI(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof bf!="object"||bf.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>o||d<r)throw new Error("int64 invalid: ".concat(c));return d},uParse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>l||d<a)throw new Error("uint64 invalid: ".concat(c));return d},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigInt64(0,!0)},uDec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigUint64(0,!0)}}}const n=r=>mt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>mt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Sf(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Sf(r)},dec(r,o){return lI(r,o)},uDec(r,o){return uy(r,o)}}}const at=uI();var J;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(J||(J={}));var Qi;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Qi||(Qi={}));function Pi(t,e,n){if(e===n)return!0;if(t==J.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return e==n}return!1}function xr(t,e){switch(t){case J.BOOL:return!1;case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return e==0?at.zero:"0";case J.DOUBLE:case J.FLOAT:return 0;case J.BYTES:return new Uint8Array(0);case J.STRING:return"";default:return 0}}function py(t,e){switch(t){case J.BOOL:return e===!1;case J.STRING:return e==="";case J.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var vt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(vt||(vt={}));class hI{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Xc(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ca(e),Cf(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){oy(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Xc(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){ca(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return ca(e),e=(e<<1^e>>31)>>>0,Cf(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=at.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=at.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=at.enc(e);return ql(n.lo,n.hi,this.buf),this}sint64(e){let n=at.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return ql(r,o,this.buf),this}uint64(e){let n=at.uEnc(e);return ql(n.lo,n.hi,this.buf),this}}class pI{constructor(e,n){this.varint64=aI,this.uint32=dI,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case vt.Varint:for(;this.buf[this.pos++]&128;);break;case vt.Bit64:this.pos+=4;case vt.Bit32:this.pos+=4;break;case vt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case vt.StartGroup:for(;;){const[o,a]=this.tag();if(a===vt.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(a,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return at.dec(...this.varint64())}uint64(){return at.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,at.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return at.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return at.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function fI(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function fy(t){const e=t.field.localName,n=Object.create(null);return n[e]=gI(t),[n,()=>n[e]]}function gI(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return xr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function mI(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let gi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),dl=[];for(let t=0;t<gi.length;t++)dl[gi[t].charCodeAt(0)]=t;dl[45]=gi.indexOf("+");dl[95]=gi.indexOf("/");const gy={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,a=0;for(let l=0;l<t.length;l++){if(o=dl[t.charCodeAt(l)],o===void 0)switch(t[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=o,r=1;break;case 1:n[i++]=a<<2|(o&48)>>4,a=o,r=2;break;case 2:n[i++]=(a&15)<<4|(o&60)>>2,a=o,r=3;break;case 3:n[i++]=(a&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=gi[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=gi[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=gi[r|i>>6],e+=gi[i&63],n=0;break}return n&&(e+=gi[r],e+="=",n==1&&(e+="=")),e}};function xI(t,e,n){xy(e,t);const i=e.runtime.bin.makeReadOptions(n),r=mI(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,a]=fy(e);for(const l of r)e.runtime.bin.readField(o,i.readerFactory(l.data),e.field,l.wireType,i);return a()}function yI(t,e,n,i){xy(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(my(t,e)){const d=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of d)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const a=o.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[d,u]=c.tag(),h=c.skip(u,d);t.getType().runtime.bin.onUnknownField(t,d,u,h)}}function my(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function xy(t,e){mt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function yy(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!py(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function wf(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?xr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function mi(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Mu.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function by(t,e){return mi(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}J.DOUBLE,J.FLOAT,J.INT64,J.UINT64,J.INT32,J.UINT32,J.BOOL,J.STRING,J.BYTES;const jf={ignoreUnknownFields:!1},Tf={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function bI(t){return t?Object.assign(Object.assign({},jf),t):jf}function vI(t){return t?Object.assign(Object.assign({},Tf),t):Tf}const Ma=Symbol(),ua=Symbol();function SI(){return{makeReadOptions:bI,makeWriteOptions:vI,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Vn(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[a,l]of Object.entries(e)){const c=t.fields.findJsonName(a);if(c){if(c.oneof){if(l===null&&c.kind=="scalar")continue;const d=r.get(c.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(d,'", "').concat(a,'"'));r.set(c.oneof,a)}Ef(i,l,c,n,t)}else{let d=!1;if(o?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=o.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==t.typeName){d=!0;const[h,p]=fy(u);Ef(h,l,u.field,n,u),yI(i,u,p(),n)}}if(!d&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!yy(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!CI(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],l=Rf(r,a,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const l=o.findExtensionFor(n.typeName,a.no);if(l&&my(t,l)){const c=xI(t,l,e),d=Rf(l.field,c,e);d!==void 0&&(i[l.field.jsonName]=d)}}}catch(o){const a=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),l=o instanceof Error?o.message:String(o);throw new Error(a+(l.length>0?": ".concat(l):""))}return i},readScalar(t,e,n){return Kr(t,e,n??Qi.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||py(t,e)))return ha(t,e)},debug:Vn}}function Vn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Ef(t,e,n,i,r){let o=n.localName;if(n.repeated){if(mt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(e)));const a=t[o];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(l)));switch(n.kind){case"message":a.push(n.T.fromJson(l,i));break;case"enum":const c=Kl(n.T,l,i.ignoreUnknownFields,!0);c!==ua&&a.push(c);break;case"scalar":try{a.push(Kr(n.T,l,n.L,!0))}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(l));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(e)));const a=t[o];for(const[l,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let d;try{d=kI(n.K,l)}catch(u){let h="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}switch(n.V.kind){case"message":a[d]=n.V.T.fromJson(c,i);break;case"enum":const u=Kl(n.V.T,c,i.ignoreUnknownFields,!0);u!==ua&&(a[d]=u);break;case"scalar":try{a[d]=Kr(n.V.T,c,Qi.BIGINT,!0)}catch(h){let p="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(e));throw h instanceof Error&&h.message.length>0&&(p+=": ".concat(h.message)),new Error(p)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let l=t[o];mi(l)?l.fromJson(e,i):(t[o]=l=a.fromJson(e,i),a.fieldWrapper&&!n.oneof&&(t[o]=a.fieldWrapper.unwrapField(l)));break;case"enum":const c=Kl(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Ma:wf(n,t);break;case ua:break;default:t[o]=c;break}break;case"scalar":try{const d=Kr(n.T,e,n.L,!1);switch(d){case Ma:wf(n,t);break;default:t[o]=d;break}}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Vn(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}function kI(t,e){if(t===J.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Kr(t,e,Qi.BIGINT,!0).toString()}function Kr(t,e,n,i){if(e===null)return i?xr(t,n):Ma;switch(t){case J.DOUBLE:case J.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==J.FLOAT&&oy(r),r;case J.INT32:case J.FIXED32:case J.SFIXED32:case J.SINT32:case J.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==J.UINT32||t==J.FIXED32?Xc(o):ca(o),o;case J.INT64:case J.SFIXED64:case J.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=at.parse(e);return n?a.toString():a;case J.FIXED64:case J.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=at.uParse(e);return n?l.toString():l;case J.BOOL:if(typeof e!="boolean")break;return e;case J.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case J.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return gy.dec(e)}throw new Error}function Kl(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Ma;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return ua;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Vn(e)))}function CI(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Rf(t,e,n){if(t.kind=="map"){mt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,l]of r)i[a.toString()]=ha(t.V.T,l);break;case"message":for(const[a,l]of r)i[a.toString()]=l.toJson(n);break;case"enum":const o=t.V.T;for(const[a,l]of r)i[a.toString()]=Jl(o,l,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){mt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(ha(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Jl(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return ha(t.T,e);case"enum":return Jl(t.T,e,n.enumAsInteger);case"message":return by(t.T,e).toJson(n)}}function Jl(t,e,n){var i;if(mt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r?.name)!==null&&i!==void 0?i:e}function ha(t,e){switch(t){case J.INT32:case J.SFIXED32:case J.SINT32:case J.FIXED32:case J.UINT32:return mt(typeof e=="number"),e;case J.FLOAT:case J.DOUBLE:return mt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case J.STRING:return mt(typeof e=="string"),e;case J.BOOL:return mt(typeof e=="boolean"),e;case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return mt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case J.BYTES:return mt(e instanceof Uint8Array),gy.enc(e)}}const Ws=Symbol("@bufbuild/protobuf/unknown-fields"),If={readUnknownFields:!0,readerFactory:t=>new pI(t)},Af={writeUnknownFields:!0,writerFactory:()=>new hI};function wI(t){return t?Object.assign(Object.assign({},If),t):If}function jI(t){return t?Object.assign(Object.assign({},Af),t):Af}function TI(){return{makeReadOptions:wI,makeWriteOptions:jI,listUnknownFields(t){var e;return(e=t[Ws])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Ws]},writeUnknownFields(t,e){const i=t[Ws];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Ws])||(r[Ws]=[]),r[Ws].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),a=r?e.len:e.pos+n;let l,c;for(;e.pos<a&&([l,c]=e.tag(),!(r===!0&&c==vt.EndGroup));){const d=o.fields.find(l);if(!d){const u=e.skip(c,l);i.readUnknownFields&&this.onUnknownField(t,l,c,u);continue}_f(t,e,d,c,i)}if(r&&(c!=vt.EndGroup||l!==n))throw new Error("invalid end group tag")},readField:_f,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!yy(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];Mf(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Mf(t,e,n,i)}}}function _f(t,e,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const l=n.kind=="enum"?J.INT32:n.T;let c=Pa;if(n.kind=="scalar"&&n.L>0&&(c=RI),o){let p=t[a];if(i==vt.LengthDelimited&&l!=J.STRING&&l!=J.BYTES){let x=e.uint32()+e.pos;for(;e.pos<x;)p.push(c(e,l))}else p.push(c(e,l))}else t[a]=c(e,l);break;case"message":const d=n.T;o?t[a].push(pa(e,new d,r,n)):mi(t[a])?pa(e,t[a],r,n):(t[a]=pa(e,new d,r,n),d.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=d.fieldWrapper.unwrapField(t[a])));break;case"map":let[u,h]=EI(n,e,r);t[a][u]=h;break}}function pa(t,e,n,i){const r=e.getType().runtime.bin,o=i?.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function EI(t,e,n){const i=e.uint32(),r=e.pos+i;let o,a;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:o=Pa(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=Pa(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=pa(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=xr(t.K,Qi.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(t.V.kind){case"scalar":a=xr(t.V.T,Qi.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[o,a]}function RI(t,e){const n=Pa(t,e);return typeof n=="bigint"?n.toString():n}function Pa(t,e){switch(e){case J.STRING:return t.string();case J.BOOL:return t.bool();case J.DOUBLE:return t.double();case J.FLOAT:return t.float();case J.INT32:return t.int32();case J.INT64:return t.int64();case J.UINT64:return t.uint64();case J.FIXED64:return t.fixed64();case J.BYTES:return t.bytes();case J.FIXED32:return t.fixed32();case J.SFIXED32:return t.sfixed32();case J.SFIXED64:return t.sfixed64();case J.SINT64:return t.sint64();case J.UINT32:return t.uint32();case J.SINT32:return t.sint32()}}function Mf(t,e,n,i){mt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?J.INT32:t.T;if(r)if(mt(Array.isArray(e)),t.packed)AI(n,o,t.no,e);else for(const a of e)Jr(n,o,t.no,a);else Jr(n,o,t.no,e);break;case"message":if(r){mt(Array.isArray(e));for(const a of e)Pf(n,i,t,a)}else Pf(n,i,t,e);break;case"map":mt(typeof e=="object"&&e!=null);for(const[a,l]of Object.entries(e))II(n,i,t,a,l);break}}function II(t,e,n,i,r){t.tag(n.no,vt.LengthDelimited),t.fork();let o=i;switch(n.K){case J.INT32:case J.FIXED32:case J.UINT32:case J.SFIXED32:case J.SINT32:o=Number.parseInt(i);break;case J.BOOL:mt(i=="true"||i=="false"),o=i=="true";break}switch(Jr(t,n.K,1,o),n.V.kind){case"scalar":Jr(t,n.V.T,2,r);break;case"enum":Jr(t,J.INT32,2,r);break;case"message":mt(r!==void 0),t.tag(2,vt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Pf(t,e,n,i){const r=by(n.T,i);n.delimited?t.tag(n.no,vt.StartGroup).raw(r.toBinary(e)).tag(n.no,vt.EndGroup):t.tag(n.no,vt.LengthDelimited).bytes(r.toBinary(e))}function Jr(t,e,n,i){mt(i!==void 0);let[r,o]=vy(e);t.tag(n,r)[o](i)}function AI(t,e,n,i){if(!i.length)return;t.tag(n,vt.LengthDelimited).fork();let[,r]=vy(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function vy(t){let e=vt.Varint;switch(t){case J.BYTES:case J.STRING:e=vt.LengthDelimited;break;case J.DOUBLE:case J.FIXED64:case J.SFIXED64:e=vt.Bit64;break;case J.FIXED32:case J.SFIXED32:case J.FLOAT:e=vt.Bit32;break}const n=J[t].toLowerCase();return[e,n]}function _I(){return{setEnumType:ly,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,a=t;if(a[r]!=null)switch(i.kind){case"oneof":const l=a[r].case;if(l===void 0)continue;const c=i.findField(l);let d=a[r].value;c&&c.kind=="message"&&!mi(d,c.T)?d=new c.T(d):c&&c.kind==="scalar"&&c.T===J.BYTES&&(d=Ar(d)),o[r]={case:l,value:d};break;case"scalar":case"enum":let u=a[r];i.T===J.BYTES&&(u=i.repeated?u.map(Ar):Ar(u)),o[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===J.BYTES)for(const[m,x]of Object.entries(a[r]))o[r][m]=Ar(x);else Object.assign(o[r],a[r]);break;case"message":const p=i.V.T;for(const m of Object.keys(a[r])){let x=a[r][m];p.fieldWrapper||(x=new p(x)),o[r][m]=x}break}break;case"message":const h=i.T;if(i.repeated)o[r]=a[r].map(p=>mi(p,h)?p:new h(p));else{const p=a[r];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?o[r]=Ar(p):o[r]=p:o[r]=mi(p,h)?p:new h(p)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((a,l)=>i.T.equals(a,o[l]));case"scalar":return r.every((a,l)=>Pi(i.T,a,o[l]));case"enum":return r.every((a,l)=>Pi(J.INT32,a,o[l]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let a=r,l=o;return i.T.fieldWrapper&&(a!==void 0&&!mi(a)&&(a=i.T.fieldWrapper.wrapField(a)),l!==void 0&&!mi(l)&&(l=i.T.fieldWrapper.wrapField(l))),i.T.equals(a,l);case"enum":return Pi(J.INT32,r,o);case"scalar":return Pi(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return Pi(J.INT32,r.value,o.value);case"scalar":return Pi(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const d=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const u=i.V.T;return d.every(p=>u.equals(r[p],o[p]));case"enum":return d.every(p=>Pi(J.INT32,r[p],o[p]));case"scalar":const h=i.V.T;return d.every(p=>Pi(h,r[p],o[p]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let a;if(r.repeated)a=o.map(qo);else if(r.kind=="map"){a=i[r.localName];for(const[l,c]of Object.entries(o))a[l]=qo(c)}else r.kind=="oneof"?a=r.findField(o.case)?{case:o.case,value:qo(o.value)}:{case:void 0}:a=qo(o);i[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function qo(t){if(t===void 0)return t;if(mi(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Ar(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function MI(t,e,n){return{syntax:t,json:SI(),bin:TI(),util:Object.assign(Object.assign({},_I()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return oI(this,i,r,o)},makeEnum:rI,makeEnumType:cy,getEnumType:sI,makeExtension(i,r,o){return fI(this,i,r,o)}}}class PI{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Sy(t,e){const n=ky(t);return e?n:BI(LI(n))}function NI(t){return Sy(t,!1)}const DI=ky;function ky(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const zI=new Set(["constructor","toString","toJSON","valueOf"]),OI=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Cy=t=>"".concat(t,"$"),LI=t=>OI.has(t)?Cy(t):t,BI=t=>zI.has(t)?Cy(t):t;class FI{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=NI(e)}addField(e){mt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function WI(t,e){var n,i,r,o,a,l;const c=[];let d;for(const u of typeof t=="function"?t():t){const h=u;if(h.localName=Sy(u.name,u.oneof!==void 0),h.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:DI(u.name),h.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(h.L=(r=u.L)!==null&&r!==void 0?r:Qi.BIGINT),h.delimited=(o=u.delimited)!==null&&o!==void 0?o:!1,h.req=(a=u.req)!==null&&a!==void 0?a:!1,h.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(h.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=J.BYTES&&u.T!=J.STRING),u.oneof!==void 0){const p=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!d||d.name!=p)&&(d=new FI(p)),h.oneof=d,d.addField(h)}c.push(h)}return c}const U=MI("proto3",t=>new PI(t,e=>WI(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=xr(e.T,e.L);break}}});class rn extends Mu{constructor(e){super(),this.seconds=at.zero,this.nanos=0,U.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(U.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=at.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return rn.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new rn({seconds:at.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new rn().fromBinary(e,n)}static fromJson(e,n){return new rn().fromJson(e,n)}static fromJsonString(e,n){return new rn().fromJsonString(e,n)}static equals(e,n){return U.util.equals(rn,e,n)}}rn.runtime=U;rn.typeName="google.protobuf.Timestamp";rn.fields=U.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const UI=U.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:rn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:$I,repeated:!0},{no:5,name:"events",kind:"message",T:GI,repeated:!0}]),$I=U.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:VI,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),VI=U.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:rn},{no:3,name:"value",kind:"scalar",T:2}]),GI=U.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:rn},{no:7,name:"normalized_end_timestamp",kind:"message",T:rn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),wy=U.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Nn=U.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ct=U.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Nu=U.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Fr=U.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),go=U.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),On=U.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),us=U.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),HI=U.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Mt=U.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),ul=U.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Na,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Oy}]),Na=U.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),qI=U.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:U.getEnumType(Ct),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),js=U.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(rr)},{no:4,name:"tracks",kind:"message",T:Zs,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:qI},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:U.getEnumType(mo)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:U.getEnumType(On)},{no:18,name:"kind_details",kind:"enum",T:U.getEnumType(KI),repeated:!0}]),rr=U.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),mo=U.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),KI=U.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Rt=U.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),JI=U.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Hi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType(jy)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Zs=U.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:U.getEnumType(Nn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:U.getEnumType(Ct)},{no:10,name:"layers",kind:"message",T:Hi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:JI,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:U.getEnumType(Rt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Oy},{no:19,name:"audio_features",kind:"enum",T:U.getEnumType(Mt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:U.getEnumType(wy)}]),Hi=U.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(Nu)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),jy=U.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Xt=U.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:U.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Du,oneof:"value"},{no:3,name:"speaker",kind:"message",T:YI,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Iy,oneof:"value"},{no:7,name:"transcription",kind:"message",T:XI,oneof:"value"},{no:8,name:"metrics",kind:"message",T:UI,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Da,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:zu,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Ou,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Lu,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:za,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Oa,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:La,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Ty,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ae=U.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Ty=U.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:U.getEnumType(Rt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Ey=U.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Du,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Da,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:zu,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Ou,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Lu,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:za,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Oa,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:La,oneof:"value"}]),YI=U.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Ry,repeated:!0}]),Ry=U.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Du=U.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Iy=U.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),XI=U.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:ZI,repeated:!0}]),ZI=U.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Da=U.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),zu=U.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Ou=U.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Lu=U.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Ay,oneof:"value"}]),Ay=U.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),_y=U.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),My=U.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:U.getEnumType(Py)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Py=U.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ny=U.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:U.getEnumType(Dy)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Dy=U.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),zy=U.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Nf},{no:2,name:"screen",kind:"message",T:Nf},{no:3,name:"resume_connection",kind:"enum",T:U.getEnumType(go)},{no:4,name:"disabled_codecs",kind:"message",T:QI},{no:5,name:"force_relay",kind:"enum",T:U.getEnumType(go)}]),Nf=U.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:U.getEnumType(go)}]),QI=U.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Na,repeated:!0},{no:2,name:"publish",kind:"message",T:Na,repeated:!0}]),Oy=U.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Zc=U.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Ly=U.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:U.getEnumType(Zc)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),By=U.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),za=U.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:U.getEnumType(Rt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Ly,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:By,oneof:"content_header"}],{localName:"DataStream_Header"}),Oa=U.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),La=U.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),eA=U.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Dn=U.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Qc=U.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),tA=U.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),nA=U.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:es,oneof:"message"},{no:2,name:"answer",kind:"message",T:es,oneof:"message"},{no:3,name:"trickle",kind:"message",T:hl,oneof:"message"},{no:4,name:"add_track",kind:"message",T:xo,oneof:"message"},{no:5,name:"mute",kind:"message",T:pl,oneof:"message"},{no:6,name:"subscription",kind:"message",T:fl,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Fy,oneof:"message"},{no:8,name:"leave",kind:"message",T:gl,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Uy,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Gy,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:$u,oneof:"message"},{no:13,name:"simulate",kind:"message",T:$n,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Wu,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ky,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Fu,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Wy,oneof:"message"}]),Df=U.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:iA,oneof:"message"},{no:2,name:"answer",kind:"message",T:es,oneof:"message"},{no:3,name:"offer",kind:"message",T:es,oneof:"message"},{no:4,name:"trickle",kind:"message",T:hl,oneof:"message"},{no:5,name:"update",kind:"message",T:oA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Bu,oneof:"message"},{no:8,name:"leave",kind:"message",T:gl,oneof:"message"},{no:9,name:"mute",kind:"message",T:pl,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:aA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:lA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:dA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:hA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:fA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:mA,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:rA,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:sA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:yA,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SA,oneof:"message"},{no:22,name:"request_response",kind:"message",T:kA,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:CA,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:xA,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:EA,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:gA,oneof:"message"}]),ed=U.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Hi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:U.getEnumType(jy)}]),xo=U.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:U.getEnumType(Nn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:U.getEnumType(Ct)},{no:9,name:"layers",kind:"message",T:Hi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:ed,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:U.getEnumType(Rt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:U.getEnumType(wy)},{no:17,name:"audio_features",kind:"enum",T:U.getEnumType(Mt),repeated:!0}]),hl=U.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:U.getEnumType(Dn)},{no:3,name:"final",kind:"scalar",T:8}]),pl=U.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),iA=U.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:ul},{no:2,name:"participant",kind:"message",T:js},{no:3,name:"other_participants",kind:"message",T:js,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:$y,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:zy},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:My},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Na,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),sA=U.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:$y,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:zy},{no:3,name:"server_info",kind:"message",T:My},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Bu=U.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Zs}]),rA=U.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),es=U.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),oA=U.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:js,repeated:!0}]),fl=U.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:_y,repeated:!0}]),Fy=U.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:U.getEnumType(Nu)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Fu=U.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:U.getEnumType(Mt),repeated:!0}]),Wy=U.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),gl=U.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:U.getEnumType(On)},{no:3,name:"action",kind:"enum",T:U.getEnumType(or)},{no:4,name:"regions",kind:"message",T:bA}]),or=U.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Uy=U.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Hi,repeated:!0}]),Wu=U.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),$y=U.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),aA=U.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Ry,repeated:!0}]),lA=U.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:ul}]),cA=U.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:U.getEnumType(Fr)},{no:3,name:"score",kind:"scalar",T:2}]),dA=U.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:cA,repeated:!0}]),uA=U.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:U.getEnumType(Qc)}]),hA=U.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:uA,repeated:!0}]),Uu=U.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:U.getEnumType(Nu)},{no:2,name:"enabled",kind:"scalar",T:8}]),pA=U.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Uu,repeated:!0}]),fA=U.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Uu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:pA,repeated:!0}]),gA=U.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:eA,repeated:!0}]),Vy=U.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Gy=U.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Vy,repeated:!0}]),mA=U.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),xA=U.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:ul},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:js},{no:4,name:"other_participants",kind:"message",T:js,repeated:!0}]),$u=U.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:es},{no:2,name:"subscription",kind:"message",T:fl},{no:3,name:"publish_tracks",kind:"message",T:Bu,repeated:!0},{no:4,name:"data_channels",kind:"message",T:qy,repeated:!0},{no:5,name:"offer",kind:"message",T:es},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Hy,repeated:!0}]),Hy=U.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),qy=U.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:U.getEnumType(Dn)}]),$n=U.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:U.getEnumType(tA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ky=U.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),yA=U.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),bA=U.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:vA,repeated:!0}]),vA=U.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SA=U.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:U.getEnumType(HI)}]),kA=U.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:U.getEnumType(Vu)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:hl,oneof:"request"},{no:5,name:"add_track",kind:"message",T:xo,oneof:"request"},{no:6,name:"mute",kind:"message",T:pl,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Wu,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Fu,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Wy,oneof:"request"}]),Vu=U.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),CA=U.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Jy=U.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),wA=U.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Ny},{no:2,name:"connection_settings",kind:"message",T:Jy},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:xo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:es},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:U.getEnumType(us)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:$u}]),jA=U.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:U.getEnumType(TA)},{no:2,name:"join_request",kind:"scalar",T:12}]),TA=U.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),EA=U.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function RA(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fa={exports:{}},IA=fa.exports,zf;function AA(){return zf||(zf=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(IA,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},a=null;function l(g,y){var v=g[y];if(typeof v.bind=="function")return v.bind(g);try{return Function.prototype.bind.call(v,g)}catch{return function(){return Function.prototype.apply.apply(v,[g,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?c:console[g]!==void 0?l(console,g):console.log!==void 0?l(console,"log"):e}function u(){for(var g=this.getLevel(),y=0;y<r.length;y++){var v=r[y];this[v]=y<g?e:this.methodFactory(v,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function h(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,y,v){return d(g)||h.apply(this,arguments)}function m(g,y){var v=this,k,S,C,b="loglevel";typeof g=="string"?b+=":"+g:typeof g=="symbol"&&(b=void 0);function j(P){var O=(r[P]||"silent").toUpperCase();if(!(typeof window===n||!b)){try{window.localStorage[b]=O;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+O+";"}catch{}}}function w(){var P;if(!(typeof window===n||!b)){try{P=window.localStorage[b]}catch{}if(typeof P===n)try{var O=window.document.cookie,B=encodeURIComponent(b),N=O.indexOf(B+"=");N!==-1&&(P=/^([^;]+)/.exec(O.slice(N+B.length+1))[1])}catch{}return v.levels[P]===void 0&&(P=void 0),P}}function T(){if(!(typeof window===n||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(P){var O=P;if(typeof O=="string"&&v.levels[O.toUpperCase()]!==void 0&&(O=v.levels[O.toUpperCase()]),typeof O=="number"&&O>=0&&O<=v.levels.SILENT)return O;throw new TypeError("log.setLevel() called with invalid level: "+P)}v.name=g,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=y||p,v.getLevel=function(){return C??S??k},v.setLevel=function(P,O){return C=I(P),O!==!1&&j(C),u.call(v)},v.setDefaultLevel=function(P){S=I(P),w()||v.setLevel(P,!1)},v.resetLevel=function(){C=null,T(),u.call(v)},v.enableAll=function(P){v.setLevel(v.levels.TRACE,P)},v.disableAll=function(P){v.setLevel(v.levels.SILENT,P)},v.rebuild=function(){if(a!==v&&(k=I(a.getLevel())),u.call(v),a===v)for(var P in o)o[P].rebuild()},k=I(a?a.getLevel():"WARN");var E=w();E!=null&&(C=I(E)),u.call(v)}a=new m,a.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var v=o[y];return v||(v=o[y]=new m(y,a.methodFactory)),v};var x=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=x),a},a.getLoggers=function(){return o},a.default=a,a})})(fa)),fa.exports}var ml=AA(),td;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(td||(td={}));var Bn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Bn||(Bn={}));let Ee=ml.getLogger("livekit");Object.values(Bn).map(t=>ml.getLogger(t));Ee.setDefaultLevel(td.info);function Ri(t){const e=ml.getLogger(t);return e.setDefaultLevel(Ee.getLevel()),e}const _A=ml.getLogger("lk-e2ee"),_r=7e3,MA=[0,300,4*300,9*300,16*300,_r,_r,_r,_r,_r];class PA{constructor(e){this._retryDelays=e!==void 0?[...e]:MA}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function NA(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function _(t,e,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(u){try{d(i.next(u))}catch(h){a(h)}}function c(u){try{d(i.throw(u))}catch(h){a(h)}}function d(u){u.done?o(u.value):r(u.value).then(l,c)}d((i=i.apply(t,e||[])).next())})}function Of(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Of=="function"?Of(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(a){return new Promise(function(l,c){a=t[o](a),r(l,c,a.done,a.value)})}}function r(o,a,l,c){Promise.resolve(c).then(function(d){o({value:d,done:l})},a)}}var Ko={exports:{}},Lf;function DA(){if(Lf)return Ko.exports;Lf=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,j,w){return Function.prototype.apply.call(b,j,w)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(C){console&&console.warn&&console.warn(C)}var r=Number.isNaN||function(b){return b!==b};function o(){o.init.call(this)}Ko.exports=o,Ko.exports.once=v,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(C){if(typeof C!="number"||C<0||r(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");a=C}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function c(C){return C._maxListeners===void 0?o.defaultMaxListeners:C._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(b){for(var j=[],w=1;w<arguments.length;w++)j.push(arguments[w]);var T=b==="error",I=this._events;if(I!==void 0)T=T&&I.error===void 0;else if(!T)return!1;if(T){var E;if(j.length>0&&(E=j[0]),E instanceof Error)throw E;var P=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw P.context=E,P}var O=I[b];if(O===void 0)return!1;if(typeof O=="function")e(O,this,j);else for(var B=O.length,N=x(O,B),w=0;w<B;++w)e(N[w],this,j);return!0};function d(C,b,j,w){var T,I,E;if(l(j),I=C._events,I===void 0?(I=C._events=Object.create(null),C._eventsCount=0):(I.newListener!==void 0&&(C.emit("newListener",b,j.listener?j.listener:j),I=C._events),E=I[b]),E===void 0)E=I[b]=j,++C._eventsCount;else if(typeof E=="function"?E=I[b]=w?[j,E]:[E,j]:w?E.unshift(j):E.push(j),T=c(C),T>0&&E.length>T&&!E.warned){E.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.emitter=C,P.type=b,P.count=E.length,i(P)}return C}o.prototype.addListener=function(b,j){return d(this,b,j,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(b,j){return d(this,b,j,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(C,b,j){var w={fired:!1,wrapFn:void 0,target:C,type:b,listener:j},T=u.bind(w);return T.listener=j,w.wrapFn=T,T}o.prototype.once=function(b,j){return l(j),this.on(b,h(this,b,j)),this},o.prototype.prependOnceListener=function(b,j){return l(j),this.prependListener(b,h(this,b,j)),this},o.prototype.removeListener=function(b,j){var w,T,I,E,P;if(l(j),T=this._events,T===void 0)return this;if(w=T[b],w===void 0)return this;if(w===j||w.listener===j)--this._eventsCount===0?this._events=Object.create(null):(delete T[b],T.removeListener&&this.emit("removeListener",b,w.listener||j));else if(typeof w!="function"){for(I=-1,E=w.length-1;E>=0;E--)if(w[E]===j||w[E].listener===j){P=w[E].listener,I=E;break}if(I<0)return this;I===0?w.shift():g(w,I),w.length===1&&(T[b]=w[0]),T.removeListener!==void 0&&this.emit("removeListener",b,P||j)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(b){var j,w,T;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[b]),this;if(arguments.length===0){var I=Object.keys(w),E;for(T=0;T<I.length;++T)E=I[T],E!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(j=w[b],typeof j=="function")this.removeListener(b,j);else if(j!==void 0)for(T=j.length-1;T>=0;T--)this.removeListener(b,j[T]);return this};function p(C,b,j){var w=C._events;if(w===void 0)return[];var T=w[b];return T===void 0?[]:typeof T=="function"?j?[T.listener||T]:[T]:j?y(T):x(T,T.length)}o.prototype.listeners=function(b){return p(this,b,!0)},o.prototype.rawListeners=function(b){return p(this,b,!1)},o.listenerCount=function(C,b){return typeof C.listenerCount=="function"?C.listenerCount(b):m.call(C,b)},o.prototype.listenerCount=m;function m(C){var b=this._events;if(b!==void 0){var j=b[C];if(typeof j=="function")return 1;if(j!==void 0)return j.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function x(C,b){for(var j=new Array(b),w=0;w<b;++w)j[w]=C[w];return j}function g(C,b){for(;b+1<C.length;b++)C[b]=C[b+1];C.pop()}function y(C){for(var b=new Array(C.length),j=0;j<b.length;++j)b[j]=C[j].listener||C[j];return b}function v(C,b){return new Promise(function(j,w){function T(E){C.removeListener(b,I),w(E)}function I(){typeof C.removeListener=="function"&&C.removeListener("error",T),j([].slice.call(arguments))}S(C,b,I,{once:!0}),b!=="error"&&k(C,T,{once:!0})})}function k(C,b,j){typeof C.on=="function"&&S(C,"error",b,j)}function S(C,b,j,w){if(typeof C.on=="function")w.once?C.once(b,j):C.on(b,j);else if(typeof C.addEventListener=="function")C.addEventListener(b,function T(I){w.once&&C.removeEventListener(b,T),j(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return Ko.exports}var ai=DA();let Yy=!0,Xy=!0;function Wr(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Ps(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=i.removeEventListener;i.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function zA(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Yy=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function OA(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Xy=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Zy(){if(typeof window=="object"){if(Yy)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gu(t,e){Xy&&console.warn(t+" is deprecated, please use "+e+" instead.")}function LA(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Wr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Wr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Wr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Wr(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Bf(t){return Object.prototype.toString.call(t)==="[object Object]"}function Qy(t){return Bf(t)?Object.keys(t).reduce(function(e,n){const i=Bf(t[n]),r=i?Qy(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function nd(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?nd(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{nd(t,t.get(r),n)})}))}function Ff(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(l=>{l.type===i&&l.trackId===a.id&&nd(t,l,r)})}),r}const Wf=Zy;function eb(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let p={};typeof u.ideal=="number"?(p[h("min",d)]=u.ideal,c.optional.push(p),p={},p[h("max",d)]=u.ideal,c.optional.push(p)):(p[h("",d)]=u.ideal,c.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(p,d)]=u[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,p){h in u&&!(p in u)&&(u[p]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(p=>{p=p.filter(x=>x.kind==="videoinput");let m=p.find(x=>h.some(g=>x.label.toLowerCase().includes(g)));return!m&&p.length&&h.includes("back")&&(m=p[p.length-1]),m&&(l.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=i(l.video),Wf("chrome: "+JSON.stringify(l)),c(l)})}l.video=i(l.video)}return Wf("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,d){r(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(o(h))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function tb(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function nb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ps(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function ib(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=r.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function sb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>Ff(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ps(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Ff(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,a;return this.getSenders().forEach(l=>{l.track===i&&(r?a=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===i&&(o?a=!0:o=l),l.track===i)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function rb(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function ob(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return rb(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[h.id];if(x)x.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],x=d._streams[m.id];h=h.replace(new RegExp(x.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],x=d._streams[m.id];h=h.replace(new RegExp(m.id,"g"),x.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[x=>{const g=o(this,x);p[0].apply(null,[g])},x=>{p[1]&&p[1].apply(null,x)},arguments[2]]):u.apply(this,arguments).then(x=>o(this,x))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function id(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function ab(t,e){Ps(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Uf=Object.freeze({__proto__:null,fixNegotiationNeeded:ab,shimAddTrackRemoveTrack:ob,shimAddTrackRemoveTrackWithNative:rb,shimGetSendersWithDtmf:ib,shimGetUserMedia:eb,shimMediaStream:tb,shimOnTrack:nb,shimPeerConnection:id,shimSenderReceiverGetStats:sb});function lb(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,a){Gu("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function BA(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function cb(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sd(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return i.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,l)}}function db(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ub(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Ps(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hb(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Gu("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function pb(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function fb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function gb(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function mb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function xb(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var $f=Object.freeze({__proto__:null,shimAddTransceiver:fb,shimCreateAnswer:xb,shimCreateOffer:mb,shimGetDisplayMedia:BA,shimGetParameters:gb,shimGetUserMedia:lb,shimOnTrack:cb,shimPeerConnection:sd,shimRTCDataChannel:pb,shimReceiverGetStats:ub,shimRemoveStream:hb,shimSenderGetStats:db});function yb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function bb(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function vb(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=i.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p};let l=function(c,d,u){const h=r.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=a.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function Sb(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(kb(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function kb(t){return t&&t.video!==void 0?Object.assign({},t,{video:Qy(t.video)}):t}function Cb(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let a=0;a<i.iceServers.length;a++){let l=i.iceServers[a];l.urls===void 0&&l.url?(Gu("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(i.iceServers[a])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function wb(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function jb(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Tb(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Vf=Object.freeze({__proto__:null,shimAudioContext:Tb,shimCallbacksAPI:vb,shimConstraints:kb,shimCreateOfferLegacy:jb,shimGetUserMedia:Sb,shimLocalStreamsAPI:yb,shimRTCIceServerUrls:Cb,shimRemoteStreamsAPI:bb,shimTrackEventTransceiver:wb}),Yl={exports:{}},Gf;function FA(){return Gf||(Gf=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)r=o[a].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{a.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let o=0;return i.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(x=>parseInt(x,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&d&&(m.rtx={ssrc:d}),i.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(m))}}),i.length===0&&c&&i.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,i.forEach(p=>{p.maxBitrate=h})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const a=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(Yl)),Yl.exports}var Eb=FA(),ar=RA(Eb),WA=YR({__proto__:null,default:ar},[Eb]);function ga(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=ar.parseCandidate(i.candidate);for(const a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Ps(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function rd(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ps(t,"icecandidate",e=>{if(e.candidate){const n=ar.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ma(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=ar.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=ar.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=ar.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),d=r(c),u=o(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return a.apply(this,arguments)}}function xa(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Ps(t,"datachannel",i=>(e(i.channel,i.target),i))}function od(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ad(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function ya(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ba(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var UA=Object.freeze({__proto__:null,removeExtmapAllowMixed:ad,shimAddIceCandidateNullOrEmpty:ya,shimConnectionState:od,shimMaxMessageSize:ma,shimParameterlessSetLocalDescription:ba,shimRTCIceCandidate:ga,shimRTCIceCandidateRelayProtocol:rd,shimSendThrowTypeError:xa});function $A(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Zy,i=LA(t),r={browserDetails:i,commonShim:UA,extractVersion:Wr,disableLog:zA,disableWarnings:OA,sdp:WA};switch(i.browser){case"chrome":if(!Uf||!id||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Uf,ya(t,i),ba(t),eb(t,i),tb(t),id(t,i),nb(t),ob(t,i),ib(t),sb(t),ab(t,i),ga(t),rd(t),od(t),ma(t,i),xa(t),ad(t,i);break;case"firefox":if(!$f||!sd||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=$f,ya(t,i),ba(t),lb(t,i),sd(t,i),cb(t),hb(t),db(t),ub(t),pb(t),fb(t),gb(t),mb(t),xb(t),ga(t),od(t),ma(t,i),xa(t);break;case"safari":if(!Vf||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Vf,ya(t,i),ba(t),Cb(t),jb(t),vb(t),yb(t),bb(t),wb(t),Sb(t),Tb(t),ga(t),rd(t),ma(t,i),xa(t),ad(t,i);break;default:n("Unsupported browser!");break}return r}$A({window:typeof window>"u"?void 0:window});const VA=/version\/(\d+(\.?_?\d+)+)/i;let Xl;function cn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Xl===void 0||e){const i=GA.find(r=>{let{test:o}=r;return o.test(n)});Xl=i?.describe(n)}return Xl}const GA=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:va(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Zl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:va(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Zl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:va(VA,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Zl(t)}}}];function va(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Zl(t){return t.includes("mac os")?va(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var HA="2.16.1";const qA=HA,KA=16;class li extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var st;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(st||(st={}));class be extends li{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=st[n]}static notAllowed(e,n,i){return new be(e,st.NotAllowed,n,i)}static timeout(e){return new be(e,st.Timeout)}static leaveRequest(e,n){return new be(e,st.LeaveRequest,void 0,n)}static internal(e,n){return new be(e,st.InternalError,void 0,n)}static cancelled(e){return new be(e,st.Cancelled)}static serverUnreachable(e,n){return new be(e,st.ServerUnreachable,n)}static websocket(e,n,i){return new be(e,st.WebSocket,n,i)}}class Hu extends li{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class yi extends li{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class JA extends li{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Et extends li{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ld extends li{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Hf extends li{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class qf extends li{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Vu[n]}}var Yt;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Yt||(Yt={}));class vn extends li{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Yt[n]}}class Us extends li{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Ba;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Ba||(Ba={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Ba||(Ba={}));class Ft{}Ft.setTimeout=function(){return setTimeout(...arguments)};Ft.setInterval=function(){return setInterval(...arguments)};Ft.clearTimeout=function(){return clearTimeout(...arguments)};Ft.clearInterval=function(){return clearInterval(...arguments)};var X;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(X||(X={}));var le;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(le||(le={}));var re;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(re||(re={}));var ne;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(ne||(ne={}));function YA(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Ke{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const XA=["vp8","h264"],ZA=["vp8","h264","vp9","av1","h265"];function QA(t){return!!XA.find(e=>e===t)}const e_=QA;var Kf;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Kf||(Kf={}));var cd;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(cd||(cd={}));const yo={h90:new Ke(160,90,9e4,20),h180:new Ke(320,180,16e4,20),h216:new Ke(384,216,18e4,20),h360:new Ke(640,360,45e4,20),h540:new Ke(960,540,8e5,25),h720:new Ke(1280,720,17e5,30),h1080:new Ke(1920,1080,3e6,30),h1440:new Ke(2560,1440,5e6,30),h2160:new Ke(3840,2160,8e6,30)},dd={h120:new Ke(160,120,7e4,20),h180:new Ke(240,180,125e3,20),h240:new Ke(320,240,14e4,20),h360:new Ke(480,360,33e4,20),h480:new Ke(640,480,5e5,20),h540:new Ke(720,540,6e5,25),h720:new Ke(960,720,13e5,30),h1080:new Ke(1440,1080,23e5,30),h1440:new Ke(1920,1440,38e5,30)},qu={h360fps3:new Ke(640,360,2e5,3,"medium"),h360fps15:new Ke(640,360,4e5,15,"medium"),h720fps5:new Ke(1280,720,8e5,5,"medium"),h720fps15:new Ke(1280,720,15e5,15,"medium"),h720fps30:new Ke(1280,720,2e6,30,"medium"),h1080fps15:new Ke(1920,1080,25e5,15,"medium"),h1080fps30:new Ke(1920,1080,5e6,30,"medium"),original:new Ke(0,0,7e6,30,"medium")};function Rb(t,e,n){var i,r,o,a;const{optionsWithoutProcessor:l,audioProcessor:c,videoProcessor:d}=_b(t??{}),u=e?.processor,h=n?.processor,p=l??{};return p.audio===!0&&(p.audio={}),p.video===!0&&(p.video={}),p.audio&&(ud(p.audio,e),(i=(o=p.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||u)&&(p.audio.processor=c??u)),p.video&&(ud(p.video,n),(r=(a=p.video).deviceId)!==null&&r!==void 0||(a.deviceId={ideal:"default"}),(d||h)&&(p.video.processor=d??h)),p}function ud(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Ku(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const a={},l=a,c=t.video;Object.keys(c).forEach(d=>{switch(d){case"resolution":ud(l,c.resolution);break;default:l[d]=c[d]}}),o.video=a,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Ib(t){return _(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=Ab();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,a=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Wt(n),r.getByteTimeDomainData(a);const c=a.some(d=>d!==128&&d!==0);return i.close(),!c}return!1})()})}function Ab(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>_(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function t_(t){return t==="audioinput"?K.Source.Microphone:t==="videoinput"?K.Source.Camera:K.Source.Unknown}function hd(t){return t===K.Source.Microphone?"audioinput":t===K.Source.Camera?"videoinput":void 0}function n_(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Es()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Yr(t){return t.split("/")[1].toLowerCase()}function i_(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Bu({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Me(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Me(t.track):{})}}function s_(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function r_(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function _b(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:YA(e)}}function o_(t){switch(t){case Ct.CAMERA:return K.Source.Camera;case Ct.MICROPHONE:return K.Source.Microphone;case Ct.SCREEN_SHARE:return K.Source.ScreenShare;case Ct.SCREEN_SHARE_AUDIO:return K.Source.ScreenShareAudio;default:return K.Source.Unknown}}function Jf(t,e){return t.width*t.height<e.width*e.height}function a_(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const l_=5e3,Mr=[];var gn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(gn||(gn={}));class K extends ai.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=K.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ee,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),l_):this.handleAppVisibilityChanged()},this.log=Ri((r=i.loggerName)!==null&&r!==void 0?r:Bn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=K.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Me(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===K.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===K.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Mr.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Mr.splice(Mr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Qs(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?ne.AudioPlaybackStarted:ne.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?ne.AudioPlaybackFailed:ne.VideoPlaybackFailed,o):o.name==="AbortError"?Ee.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Ee.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ne.ElementAttached,e),e}detach(e){try{if(e){lr(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(ne.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{lr(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(ne.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Ri(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Mr.forEach(i=>{i.parentElement||(n=!1)}),n&&Mr.push(e)}}handleAppVisibilityChanged(){return _(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===K.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ln()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ln()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Qs(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Es()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Es()||Ts())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function lr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(d){switch(d){case e.Audio:return Nn.AUDIO;case e.Video:return Nn.VIDEO;default:return Nn.DATA}}t.kindToProto=r;function o(d){switch(d){case Nn.AUDIO:return e.Audio;case Nn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function a(d){switch(d){case n.Camera:return Ct.CAMERA;case n.Microphone:return Ct.MICROPHONE;case n.ScreenShare:return Ct.SCREEN_SHARE;case n.ScreenShareAudio:return Ct.SCREEN_SHARE_AUDIO;default:return Ct.UNKNOWN}}t.sourceToProto=a;function l(d){switch(d){case Ct.CAMERA:return n.Camera;case Ct.MICROPHONE:return n.Microphone;case Ct.SCREEN_SHARE:return n.ScreenShare;case Ct.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=l;function c(d){switch(d){case Qc.ACTIVE:return i.Active;case Qc.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(K||(K={}));const c_="|",Yf="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function d_(t){const e=t.split(c_);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Wt(t){return _(this,void 0,void 0,function*(){return new Promise(e=>Ft.setTimeout(e,t))})}function pd(){return"addTransceiver"in RTCPeerConnection.prototype}function fd(){return"addTrack"in RTCPeerConnection.prototype}function u_(){if(!("getCapabilities"in RTCRtpSender)||Es()||Ts())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function h_(){if(!("getCapabilities"in RTCRtpSender)||Ts())return!1;if(Es()){const n=cn();if(n?.version&&ri(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&ri(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function zn(t){return t==="av1"||t==="vp9"}function gd(t){return!document||bo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function p_(){return typeof RTCPeerConnection>"u"?!1:pd()||fd()}function Ts(){var t;return((t=cn())===null||t===void 0?void 0:t.name)==="Firefox"}function Xf(){const t=cn();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Es(){var t;return((t=cn())===null||t===void 0?void 0:t.name)==="Safari"}function bo(){const t=cn();return t?.name==="Safari"||t?.os==="iOS"}function f_(){const t=cn();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&ri(t.osVersion,"17")>=0}function g_(t){return t||(t=cn()),t?.name==="Safari"&&ri(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&ri(t.osVersion,"18.3")>0}function Mb(){var t,e;return ln()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function m_(){const t=cn(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ri(t.osVersion,e)>=0?!0:t.name==="Safari"&&ri(t.version,e)>=0}function ln(){return typeof document<"u"}function si(){return navigator.product=="ReactNative"}function yr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Ql(t){return yr(t)?t.hostname.split(".")[0]:null}function Pb(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Nb(){if(!si())return;let t=Pb();if(t)return t.platform}function Zf(){if(ln())return window.devicePixelRatio;if(si()){let t=Pb();if(t)return t.devicePixelRatio}return 1}function ri(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const a=parseInt(n[o],10),l=parseInt(i[o],10);if(a>l)return 1;if(a<l)return-1;if(o===r-1&&a===l)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function x_(t){for(const e of t)e.target.handleResize(e)}function y_(t){for(const e of t)e.target.handleVisibilityChanged(e)}let ec=null;const Qf=()=>(ec||(ec=new ResizeObserver(x_)),ec);let tc=null;const eg=()=>(tc||(tc=new IntersectionObserver(y_,{root:null,rootMargin:"0px"})),tc);function b_(){var t;const e=new Ny({sdk:Dy.JS,protocol:KA,version:qA});return si()&&(e.os=(t=Nb())!==null&&t!==void 0?t:""),e}function tg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[l]=a.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=n,l}let Pr;function nc(){if(!Pr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Pr]=i.stream.getAudioTracks(),!Pr)throw Error("Could not get empty media stream audio track");Pr.enabled=!1}return Pr.clone()}class kn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>_(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function v_(t){return ZA.includes(t)}function qi(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function S_(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function vo(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function k_(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:a,endTime:l,final:c}=n;var d;const u=(d=e.get(i))!==null&&d!==void 0?d:Date.now(),h=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(l.toString()),final:c,language:o,firstReceivedTime:u,lastReceivedTime:h}})}function C_(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function ng(t){switch(t.reason){case st.LeaveRequest:return t.context;case st.Cancelled:return On.CLIENT_INITIATED;case st.NotAllowed:return On.USER_REJECTED;case st.ServerUnreachable:return On.JOIN_FAILURE;default:return On.UNKNOWN_REASON}}function Sa(t){return t!==void 0?Number(t):void 0}function hs(t){return t!==void 0?BigInt(t):void 0}function cr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ti(t){return!!t&&t.kind==K.Kind.Audio}function rs(t){return!!t&&t.kind==K.Kind.Video}function Ni(t){return cr(t)&&rs(t)}function hi(t){return cr(t)&&ti(t)}function md(t){return!!t&&!t.isLocal}function w_(t){return!!t&&!t.isLocal}function ic(t){return md(t)&&rs(t)}function j_(t){return t.isLocal}function T_(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function E_(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function R_(t,e){const n=new URL(S_(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),zb(n,"rtc")}function I_(t){const e=new URL(vo(t));return zb(e,"validate")}function Db(t){return t.endsWith("/")?t:"".concat(t,"/")}function zb(t,e){return t.pathname="".concat(Db(t.pathname)).concat(e),t.toString()}function ig(t){if(typeof t=="string")return Df.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Df.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function A_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const __=10,Nr="lk_e2ee",M_="LKFrameEncryptionKey",P_={sharedKey:!1,ratchetSalt:M_,ratchetWindowSize:8,failureTolerance:__,keyringSize:16};var Ki;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Ki||(Ki={}));var sg;(function(t){t.KeyRatcheted="keyRatcheted"})(sg||(sg={}));var $i;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})($i||($i={}));var rg;(function(t){t.Error="cryptorError"})(rg||(rg={}));function N_(){return D_()||xd()}function xd(){return typeof window.RTCRtpScriptTransform<"u"}function D_(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function z_(t){var e,n,i,r,o;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=t.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new Ey({value:t.value})}class kD extends ai.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Ee.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},P_),e),this.on(Ki.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Ki.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Ki.RatchetRequest,e,n)}}var og;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(og||(og={}));class O_ extends ai.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,o;const{kind:a,data:l}=i.data;switch(a){case"error":if(Ee.error(l.error.message),l.uuid){const u=this.decryptDataRequests.get(l.uuid);if(u?.reject){u.reject(l.error);break}const h=this.encryptDataRequests.get(l.uuid);if(h?.reject){h.reject(l.error);break}}this.emit($i.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit($i.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const u=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(l.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit($i.ParticipantEncryptionStatusChanged,l.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Ki.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(l.uuid);c?.resolve&&c.resolve(l);break;case"encryptDataResponse":const d=this.encryptDataRequests.get(l.uuid);d?.resolve&&d.resolve(l);break}},this.onWorkerError=i=>{Ee.error("e2ee worker encountered an error:",{error:i.error}),this.emit($i.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!N_())throw new Hu("tried to setup end-to-end encryption on an unsupported browser");if(Ee.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:_A.getLevel()}};this.worker&&(Ee.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ee.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ee.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(re.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(X.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Rt.NONE,r.identity)),e.on(X.ConnectionStateChanged,i=>{i===Be.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==Rt.NONE,r.identity)})})}).on(X.TrackUnsubscribed,(i,r,o)=>{var a;const l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(l)}).on(X.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(X.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(le.LocalSenderCreated,(i,r)=>_(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(le.LocalTrackPublished,i=>{if(!rs(i.track)||!bo())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Yr(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Ki.SetKey,i=>this.postKey(i)).on(Ki.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return _(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new kn;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:n,participantIdentity:i,keyIndex:r}},l=new kn;return l.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,l),this.worker.postMessage(a),l.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Yr(i.mimeType):void 0)}}setupE2EESender(e,n){if(!cr(e)||!n){n||Ee.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return _(this,void 0,void 0,function*(){if(this.worker){if(xd()&&!Xf()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Nr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,a=c.readable}const l={kind:"decode",data:{readableStream:a,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:Nr in e}};this.worker.postMessage(l,[a,o])}e[Nr]=!0}})}handleSender(e,n,i){var r;if(!(Nr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(xd()&&!Xf()){Ee.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{Ee.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[o.readable,o.writable])}e[Nr]=!0}}}const L_=500,B_=15e3;class dr{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new dr),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Ql(i);if(!r)return;let o=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,Wt(Math.min(L_*Math.pow(2,o),B_)))}getBackOffPromise(e){const n=new URL(e),i=n&&Ql(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Ql(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}dr._instance=null;const sc="default";class Pt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Pt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=Pt.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){Ee.debug("awaiting getUserMedia promise");try{n?yield Pt.userMediaPromiseMap.get(n):yield Promise.all(Pt.userMediaPromiseMap.values())}catch{Ee.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Es()&&i.hasDeviceInUse(n))&&(a.filter(c=>c.kind===n).length===0||a.some(c=>{const d=c.label==="",u=n?c.kind===n:!0;return d&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},d=yield navigator.mediaDevices.getUserMedia(c);a=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=a,n&&(a=a.filter(l=>l.kind===n)),a})()})}normalizeDeviceId(e,n,i){return _(this,void 0,void 0,function*(){if(n!==sc)return n;const r=yield this.getDevices(e),o=r.find(l=>l.deviceId===sc);if(!o){Ee.warn("could not reliably determine default device");return}const a=r.find(l=>l.deviceId!==sc&&l.groupId===(i??o.groupId));if(!a){Ee.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(e){return e?Pt.userMediaPromiseMap.has(e):Pt.userMediaPromiseMap.size>0}}Pt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Pt.userMediaPromiseMap=new Map;var Xr;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Xr||(Xr={}));class F_{constructor(){this.pendingTasks=new Map,this.taskMutex=new tn,this.nextTaskIndex=0}run(e){return _(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Xr.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Xr.RUNNING,yield e()}finally{n.status=Xr.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return _(this,void 0,void 0,function*(){return this.run(()=>_(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class W_{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const a=function(){let{closeCode:l,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(l,c)};this.opened=new Promise((l,c)=>{o.onopen=()=>{l({readable:new ReadableStream({start(d){o.onmessage=u=>{let{data:h}=u;return d.enqueue(h)},o.onerror=u=>d.error(u)},cancel:a}),writable:new WritableStream({write(d){o.send(d)},abort(){o.close()},close:a}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",c)},o.addEventListener("error",c)}),this.closed=new Promise((l,c)=>{const d=()=>_(this,void 0,void 0,function*(){const u=new Promise(p=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",m=>{p(m)},{once:!0})}),h=yield Promise.race([Wt(250),u]);h?l(h):c(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=u=>{let{code:h,reason:p}=u;l({closeCode:h,reason:p}),o.removeEventListener("error",d)},o.addEventListener("error",d)}),n.signal&&(n.signal.onabort=()=>o.close()),this.close=a}}const U_=["syncState","trickle","offer","answer","simulate","leave"];function $_(t){const e=U_.indexOf(t.case)>=0;return Ee.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Ze;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Ze||(Ze={}));const V_=250;class Ju{get currentState(){return this.state}get isDisconnected(){return this.state===Ze.DISCONNECTING||this.state===Ze.DISCONNECTED}get isEstablishingConnection(){return this.state===Ze.CONNECTING||this.state===Ze.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Ze.DISCONNECTED,this.log=Ee,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Ri((i=n.loggerName)!==null&&i!==void 0?i:Bn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new F_,this.queuedRequests=[],this.closingLock=new tn,this.connectionLock=new tn,this.state=Ze.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return _(this,void 0,void 0,function*(){return this.state=Ze.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return _(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ze.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return _(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=i;const a=b_(),l=i.singlePeerConnection?H_(n,a,i):G_(n,a,i),c=R_(e,l),d=I_(c);return new Promise((u,h)=>_(this,void 0,void 0,function*(){var p,m;try{let x=!1;const g=C=>_(this,void 0,void 0,function*(){if(x)return;x=!0;const b=C instanceof Event?C.currentTarget:C,j=A_(b,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(j)).catch(w=>{this.log.error(w),this.close()}):this.close(),y(),h(be.cancelled(j))});r?.addEventListener("abort",g);const y=()=>{clearTimeout(v),r?.removeEventListener("abort",g)},v=setTimeout(()=>{g(be.timeout("room connection has timed out (signal)"))},i.websocketTimeout),k=(C,b)=>{this.handleSignalConnected(C,v,b)},S=new URL(c);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new W_(c);try{this.ws.closed.then(E=>{var P;this.isEstablishingConnection&&h(be.internal("Websocket got closed during a (re)connection attempt: ".concat(E.reason))),E.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:E.reason,code:E.closeCode,wasClean:E.closeCode===1e3,state:this.state})),this.state===Ze.CONNECTED&&this.handleOnClose((P=E.reason)!==null&&P!==void 0?P:"Unexpected WS error"))}).catch(E=>{this.isEstablishingConnection&&h(be.internal("Websocket error during a (re)connection attempt: ".concat(E)))});const C=yield this.ws.opened.catch(E=>_(this,void 0,void 0,function*(){if(this.state!==Ze.CONNECTED){this.state=Ze.DISCONNECTED,clearTimeout(v);const P=yield this.handleConnectionError(E,d);h(P);return}this.handleWSError(E),h(E)}));if(clearTimeout(v),!C)return;const b=C.readable.getReader();this.streamWriter=C.writable.getWriter();const j=yield b.read();if(b.releaseLock(),!j.value)throw be.internal("no message received as first message");const w=ig(j.value),T=this.validateFirstMessage(w,(p=i.reconnect)!==null&&p!==void 0?p:!1);if(!T.isValid){h(T.error);return}((m=w.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=w.message.value.pingTimeout,this.pingIntervalDuration=w.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const I=T.shouldProcessFirstMessage?w:void 0;k(C,I),u(T.response)}catch(C){h(C)}finally{y()}}finally{o()}}))})}startReadingLoop(e,n){return _(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Wt(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const o=ig(r);this.handleSignalResponse(o)}})}close(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Ze.DISCONNECTING||Ze.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Ze.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Wt(V_)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{n&&(e.state=Ze.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:er(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:er(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new hl({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new pl({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return _(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Wu({requestId:l,metadata:i,name:r,attributes:a})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Uy({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Gy({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:at.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ky({timestamp:at.parse(Date.now()),rtt:at.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Fu({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new gl({reason:On.CLIENT_INITIATED,action:or.DISCONNECT})})}sendRequest(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!$_(n)&&i.state===Ze.RECONNECTING){i.queuedRequests.push(()=>_(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Wt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const a=new nA({message:n});try{i.useJSON?yield i.streamWriter.write(a.toJsonString()):yield i.streamWriter.write(a.toBinary())}catch(l){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:l}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const a=ag(r.value);this.onAnswer&&this.onAnswer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const a=ag(r.value);this.onOffer&&this.onOffer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const a=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(a,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return _(this,void 0,void 0,function*(){if(this.state===Ze.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ft.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ft.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ft.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ft.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=Ze.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,o,a,l;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Ze.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=e.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:be.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:be.internal("Unexpected first message")}:{isValid:!1,error:be.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,n){return _(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return be.notAllowed(r,i.status)}else return e instanceof be?e:be.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof be?i:be.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function ag(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function er(t,e){return new es({sdp:t.sdp,type:t.type,id:e})}function G_(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",si()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function H_(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new wA({clientInfo:e,connectionSettings:new Jy({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const o=new jA({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class lg{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class q_{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var _n={},rc={},oc={exports:{}},cg;function Yu(){if(cg)return oc.exports;cg=1;var t=oc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),oc.exports}var dg;function K_(){return dg||(dg=1,(function(t){var e=function(l){return String(Number(l))===l?Number(l):l},n=function(l,c,d,u){if(u&&!d)c[u]=e(l[1]);else for(var h=0;h<d.length;h+=1)l[h+1]!=null&&(c[d[h]]=e(l[h+1]))},i=function(l,c,d){var u=l.name&&l.names;l.push&&!c[l.push]?c[l.push]=[]:u&&!c[l.name]&&(c[l.name]={});var h=l.push?{}:u?c[l.name]:c;n(d.match(l.reg),h,l.names,l.name),l.push&&c[l.push].push(h)},r=Yu(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(l){var c={},d=[],u=c;return l.split(/(\r\n|\r|\n)/).filter(o).forEach(function(h){var p=h[0],m=h.slice(2);p==="m"&&(d.push({rtp:[],fmtp:[]}),u=d[d.length-1]);for(var x=0;x<(r[p]||[]).length;x+=1){var g=r[p][x];if(g.reg.test(m))return i(g,u,m)}}),c.media=d,c};var a=function(l,c){var d=c.split(/=(.+)/,2);return d.length===2?l[d[0]]=e(d[1]):d.length===1&&c.length>1&&(l[d[0]]=void 0),l};t.parseParams=function(l){return l.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(l){return l.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(l){for(var c=[],d=l.split(" ").map(e),u=0;u<d.length;u+=3)c.push({component:d[u],ip:d[u+1],port:d[u+2]});return c},t.parseImageAttributes=function(l){return l.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(l){return l.split(";").map(function(c){return c.split(",").map(function(d){var u,h=!1;return d[0]!=="~"?u=e(d):(u=e(d.substring(1,d.length)),h=!0),{scid:u,paused:h}})})}})(rc)),rc}var ac,ug;function J_(){if(ug)return ac;ug=1;var t=Yu(),e=/%[sdv%]/g,n=function(a){var l=1,c=arguments,d=c.length;return a.replace(e,function(u){if(l>=d)return u;var h=c[l];switch(l+=1,u){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},i=function(a,l,c){var d=l.format instanceof Function?l.format(l.push?c:c[l.name]):l.format,u=[a+"="+d];if(l.names)for(var h=0;h<l.names.length;h+=1){var p=l.names[h];l.name?u.push(c[l.name][p]):u.push(c[l.names[h]])}else u.push(c[l.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ac=function(a,l){l=l||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=l.outerOrder||r,d=l.innerOrder||o,u=[];return c.forEach(function(h){t[h].forEach(function(p){p.name in a&&a[p.name]!=null?u.push(i(h,p,a)):p.push in a&&a[p.push]!=null&&a[p.push].forEach(function(m){u.push(i(h,p,m))})})}),a.media.forEach(function(h){u.push(i("m",t.m[0],h)),d.forEach(function(p){t[p].forEach(function(m){m.name in h&&h[m.name]!=null?u.push(i(p,m,h)):m.push in h&&h[m.push]!=null&&h[m.push].forEach(function(x){u.push(i(p,m,x))})})})}),u.join(`\r
`)+`\r
`},ac}var hg;function Y_(){if(hg)return _n;hg=1;var t=K_(),e=J_(),n=Yu();return _n.grammar=n,_n.write=e,_n.parse=t.parse,_n.parseParams=t.parseParams,_n.parseFmtpConfig=t.parseFmtpConfig,_n.parsePayloads=t.parsePayloads,_n.parseRemoteCandidates=t.parseRemoteCandidates,_n.parseImageAttributes=t.parseImageAttributes,_n.parseSimulcastStreamList=t.parseSimulcastStreamList,_n}var Li=Y_();function Xu(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var a=(i=n.isImmediate)!=null&&i,l=(r=n.callback)!=null&&r,c=n.maxWait,d=Date.now(),u=[];function h(){if(c!==void 0){var m=Date.now()-d;if(m+e>=c)return c-m}return e}var p=function(){var m=[].slice.call(arguments),x=this;return new Promise(function(g,y){var v=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,d=Date.now(),!a){var S=t.apply(x,m);l&&l(S),u.forEach(function(C){return(0,C.resolve)(S)}),u=[]}},h()),v){var k=t.apply(x,m);return l&&l(k),g(k)}u.push({resolve:g,reject:y})})};return p.cancel=function(m){o!==void 0&&clearTimeout(o),u.forEach(function(x){return(0,x.reject)(m)}),u=[]},p}const X_=.7,Z_=20,ur={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class pg extends ai.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ee,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Xu(r=>_(this,void 0,void 0,function*(){this.emit(ur.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),Z_),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ri((i=n.loggerName)!==null&&i!==void 0?i:Bn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new tn}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return _(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return _(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:a}=Q_(e);this.remoteStereoMids=o,this.remoteNackMids=a}else if(e.type==="answer"){const o=Li.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(a=>{const l=Zu(a.mid);a.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||l!=c.transceiver.mid)return!1;let d=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0)return!0;let u=!1;for(const h of a.fmtp)if(h.payload===d){h.config=h.config.split(";").filter(p=>!p.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&a.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Li.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(ur.NegotiationComplete),e.sdp&&Li.parse(e.sdp).media.forEach(a=>{a.type==="video"&&this.emit(ur.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(e){return _(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const a=Li.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(l=>{gg(l),l.type==="audio"?fg(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(c=>{if(!l.msid||!c.cid||!l.msid.includes(c.cid))return!1;let d=0;if(l.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0||(zn(c.codec)&&!Es()&&this.ensureVideoDDExtensionForSVC(l,a),!zn(c.codec)))return!0;const u=Math.round(c.maxbr*X_);for(const h of l.fmtp)if(h.payload===d){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,Li.write(a)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return _(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Li.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{gg(r),r.type==="audio"&&fg(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Li.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Et("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Et("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return _(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":n=l.selectedCandidatePairId;break;case"candidate-pair":n===""&&l.selected&&(n=l.id),i.set(l.id,l);break;case"remote-candidate":r.set(l.id,"".concat(l.address,":").concat(l.port));break}}),n==="")return;const a=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}setMungedSDP(e,n,i){return _(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const a={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new ld(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(a=>a.uri===Yf))){if(this.ddExtID===0){let a=0;n.media.forEach(l=>{var c;l.type==="video"&&((c=l.ext)===null||c===void 0||c.forEach(d=>{d.value>a&&(a=d.value)}))}),this.ddExtID=a+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Yf})}}}function fg(t,e,n){const i=Zu(t.mid);let r=0;t.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function Q_(t){var e;const n=[],i=[],r=Li.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(a=>{var l;const c=Zu(a.mid);a.type==="audio"&&(a.rtp.some(d=>d.codec==="opus"?(o=d.payload,!0):!1),!((l=a.rtcpFb)===null||l===void 0)&&l.some(d=>d.payload===o&&d.type==="nack")&&i.push(c),a.fmtp.some(d=>d.payload===o?(d.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function gg(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Zu(t){return typeof t=="number"?t.toFixed(0):t}const yd="vp8",eM={audioPreset:cd.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:qu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:yd,backupCodec:!0,preConnectBuffer:!1},Ob={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Lb={deviceId:{ideal:"default"},resolution:yo.h720.resolution},tM={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new PA,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Qu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var gt;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(gt||(gt={}));class nM{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Qu.peerConnectionTimeout,this.log=Ee,this.updateState=()=>{var o,a;const l=this.state,c=this.requiredTransports.map(d=>d.getConnectionState());c.every(d=>d==="connected")?this.state=gt.CONNECTED:c.some(d=>d==="failed")?this.state=gt.FAILED:c.some(d=>d==="connecting")?this.state=gt.CONNECTING:c.every(d=>d==="closed")?this.state=gt.CLOSED:c.some(d=>d==="closed")?this.state=gt.CLOSING:c.every(d=>d==="new")&&(this.state=gt.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(gt[l]," to ").concat(gt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=Ri((r=i.loggerName)!==null&&r!==void 0?r:Bn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new pg(e,i),n!=="publisher-only"&&(this.subscriber=new pg(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Dn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,o)},this.subscriber.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,Dn.PUBLISHER)},this.publisher.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)},this.publisher.onOffer=(o,a)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,o,a)},this.state=gt.NEW,this.connectionLock=new tn,this.remoteOfferLock=new tn}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return _(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return _(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return _(this,void 0,void 0,function*(){var i;n===Dn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return _(this,void 0,void 0,function*(){var i,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return _(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return _(this,void 0,void 0,function*(){return new Promise((n,i)=>_(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(ur.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(ur.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(a=>{clearTimeout(r),i(a)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Dn.PUBLISHER?this.publisher.getConnectedAddress():e===Dn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return _(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((c,d)=>_(o,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Ft.clearTimeout(h),d(be.cancelled("room connection has been cancelled"))};r?.signal.aborted&&u(),r?.signal.addEventListener("abort",u);const h=Ft.setTimeout(()=>{r?.signal.removeEventListener("abort",u),d(be.internal("could not establish pc connection"))},a);for(;this.state!==gt.CONNECTED;)if(yield Wt(50),r?.signal.aborted){d(be.cancelled("room connection has been cancelled"));return}Ft.clearTimeout(h),r?.signal.removeEventListener("abort",u),c()}))})()})}}const Bb=5e3,iM=3e4;class Le{static fetchRegionSettings(e,n,i){return _(this,void 0,void 0,function*(){const r=yield Le.fetchLock.lock();try{const o=yield fetch("".concat(sM(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(o.ok){const a=E_(o.headers),l=a?a*1e3:Bb;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw o.status===401?be.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):be.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof be?o:i?.aborted?be.cancelled("Region fetching was aborted"):be.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,n,i){return _(this,void 0,void 0,function*(){const r=Le.settingsTimeouts.get(e.hostname);clearTimeout(r),Le.settingsTimeouts.set(e.hostname,setTimeout(()=>_(this,void 0,void 0,function*(){try{const o=yield Le.fetchRegionSettings(e,n);Le.updateCachedRegionSettings(e,n,o)}catch(o){if(o instanceof be&&o.reason===st.NotAllowed){Ee.debug("token is not valid, cancelling auto region refresh");return}Ee.debug("auto refetching of region settings failed",{error:o}),Le.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Le.cache.set(e.hostname,i),Le.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Le.settingsTimeouts.get(e);n&&(clearTimeout(n),Le.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Le.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Le.connectionTrackers.get(e);i&&i.connectionCount===0&&(Ee.debug("stopping region refetch after disconnect delay",{hostname:e}),Le.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},iM))}static cancelCleanup(e){const n=Le.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Le.connectionTrackers.get(e);n||(n={connectionCount:0},Le.connectionTrackers.set(e,n)),n.connectionCount++,Le.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Le.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Le.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return yr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return _(this,void 0,void 0,function*(){return Le.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return _(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Le.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Le.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Ee.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Le.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Le.cache=new Map;Le.settingsTimeouts=new Map;Le.connectionTrackers=new Map;Le.fetchLock=new tn;function sM(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class xt extends Error{constructor(e,n,i){super(n),this.code=e,this.message=mg(n,xt.MAX_MESSAGE_BYTES),this.data=i?mg(i,xt.MAX_DATA_BYTES):void 0}static fromProto(e){return new xt(e.code,e.message,e.data)}toProto(){return new Ay({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new xt(xt.ErrorCode[e],xt.ErrorMessage[e],n)}}xt.MAX_MESSAGE_BYTES=256;xt.MAX_DATA_BYTES=15360;xt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};xt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Fb=15360;function eh(t){return new TextEncoder().encode(t).length}function mg(t,e){if(eh(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const th=2e3;function xl(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const nh=typeof MediaRecorder<"u";class rM{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const oM=nh?MediaRecorder:rM;class aM extends oM{constructor(e,n){if(!nh)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,a=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r?.close(),r=void 0},l=c=>{r?.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=d=>_(this,void 0,void 0,function*(){let u;if(d.data.arrayBuffer){const h=yield d.data.arrayBuffer();u=new Uint8Array(h)}else if(d.data.byteArray)u=d.data.byteArray;else throw new Error("no data available!");o()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",l)}}function lM(){return nh}const cM=1e3,dM=1e4;class Wb extends K{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Xu(()=>_(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>_(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ne.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new tn,this.pauseUpstreamLock=new tn,this.trackChangeLock=new tn,this.trackChangeLock.lock().then(a=>_(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{a()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==K.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return _(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{lr(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Qs(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Qs(r??e,o)}))})}waitForDimensions(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cM;return(function*(){var i;if(e.kind===K.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=cn())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Wt(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Wt(50)}throw new yi("unable to get track dimensions after timeout")})()})}setDeviceId(e){return _(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===qi(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),qi(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===K.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===K.Kind.Audio?"audioinput":"videoinput";return n?Pt.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return _(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return _(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return _(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new yi("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return _(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=NA(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===K.Kind.Video?a.video=i||r?{deviceId:i,facingMode:r}:!0:a.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(d=>{lr(this.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===K.Kind.Video&&(yield c.applyConstraints(o)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(ne.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ne.Muted:ne.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return _(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Mb()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return _(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ne.UpstreamPaused,this);const i=cn();if(i?.name==="Safari"&&ri(i.version,"12.0")<0)throw new Hu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return _(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ne.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return _(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const a=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const l=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:l,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Qs(i._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>{d instanceof DOMException&&d.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:d})),setTimeout(()=>{l.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:d}))}),i.processor=n,i.processorElement=l,i.processor.processedTrack){for(const d of i.attachedElements)d!==i.processorElement&&r&&(lr(i._mediaStreamTrack,d),Qs(i.processor.processedTrack,d));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(ne.TrackProcessorUpdate,i.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ne.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!lM()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new aM(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},dM)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Fa extends Wb{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,K.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>_(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}a&&this.prevStats&&(this._currentBitrate=xl(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ne.AudioTrackFeatureUpdate,this,Mt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ne.AudioTrackFeatureUpdate,this,Mt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return _(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===K.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return _(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==qi(this._constraints.deviceId);return this.source===K.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return _(this,void 0,void 0,function*(){let n;if(e){const i=Ku({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return _(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ln()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},th)))}setProcessor(e){return _(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!si()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ne.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return _(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return _(this,void 0,void 0,function*(){const e=yield Ib(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ne.AudioSilenceDetected)),e})}}function uM(t,e,n){switch(t.kind){case"audio":return new Fa(t,e,!1,void 0,n);case"video":return new Wa(t,e,!1,n);default:throw new yi("unsupported track type: ".concat(t.kind))}}const hM=Object.values(yo),pM=Object.values(dd),fM=Object.values(qu),gM=[yo.h180,yo.h360],mM=[dd.h180,dd.h360],xM=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Ke(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),bd=["q","h","f"];function vd(t,e,n,i){var r,o;let a=i?.videoEncoding;t&&(a=i?.screenShareEncoding);const l=i?.simulcast,c=i?.scalabilityMode,d=i?.videoCodec;if(!a&&!l&&!c||!e||!n)return[{}];a||(a=bM(t,e,n,d),Ee.debug("using video encoding",a));const u=a.maxFramerate,h=new Ke(e,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&zn(d)){const x=new Ub(c),g=[];if(x.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const y=cn();if(bo()||si()||y?.name==="Chrome"&&ri(y?.version,"113")<0){const v=x.suffix=="h"?2:3,k=g_(y);for(let S=0;S<x.spatial;S+=1)g.push({rid:bd[2-S],maxBitrate:a.maxBitrate/Math.pow(v,S),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:k?Math.pow(2,S):void 0});g[0].scalabilityMode=c}else g.push({maxBitrate:a.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(g[0].priority=h.encoding.priority,g[0].networkPriority=h.encoding.priority),Ee.debug("using svc encoding",{encodings:g}),g}if(!l)return[a];let p=[];t?p=(r=yg(i?.screenShareSimulcastLayers))!==null&&r!==void 0?r:xg(t,h):p=(o=yg(i?.videoSimulcastLayers))!==null&&o!==void 0?o:xg(t,h);let m;if(p.length>0){const x=p[0];p.length>1&&([,m]=p);const g=Math.max(e,n);if(g>=960&&m)return lc(e,n,[x,m,h],u);if(g>=480)return lc(e,n,[x,h],u)}return lc(e,n,[h])}function yM(t,e,n){var i,r,o,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ee.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const l=t.mediaStreamTrack.getSettings(),c=(i=l.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,d=(o=l.height)!==null&&o!==void 0?o:(a=t.dimensions)===null||a===void 0?void 0:a.height;return t.source===K.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),vd(t.source===K.Source.ScreenShare,c,d,n)}function bM(t,e,n,i){const r=vM(t,e,n);let{encoding:o}=r[0];const a=Math.max(e,n);for(let l=0;l<r.length;l+=1){const c=r[l];if(o=c.encoding,c.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function vM(t,e,n){if(t)return fM;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?hM:pM}function xg(t,e){if(t)return xM(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?gM:mM}function lc(t,e,n,i){const r=[];if(n.forEach((o,a)=>{if(a>=bd.length)return;const l=Math.min(t,e),d={rid:bd[a],scaleResolutionDownBy:Math.max(1,l/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},u=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;u&&(d.maxFramerate=u);const h=Ts()||a===0;o.encoding.priority&&h&&(d.priority=o.encoding.priority,d.networkPriority=o.encoding.priority),r.push(d)}),si()&&Nb()==="ios"){let o;r.forEach(l=>{o?l.maxFramerate&&l.maxFramerate>o&&(o=l.maxFramerate):o=l.maxFramerate});let a=!0;r.forEach(l=>{var c;l.maxFramerate!=o&&(a&&(a=!1,Ee.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ee.info('Setting framerate of encoding "'.concat((c=l.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),l.maxFramerate=o)})}return r}function yg(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Ub{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function SM(t){return t.source===K.Source.ScreenShare||t.constraints.height&&qi(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const kM=5e3;class Wa extends Wb{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,K.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>_(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const a=new Map(o.map(c=>[c.rid,c])),l=o.some(c=>c.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(ne.CpuConstrained)),this.prevStats){let c=0;a.forEach((d,u)=>{var h;const p=(h=this.prevStats)===null||h===void 0?void 0:h.get(u);c+=xl(d,p)}),this._currentBitrate=c}this.prevStats=a}),this.senderLock=new tn}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ln())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},th))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return _(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.pauseUpstream.call(this);try{for(var l=!0,c=xi(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0)o=d.value,l=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return _(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.resumeUpstream.call(this);try{for(var l=!0,c=xi(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0){o=d.value,l=!1;const u=o;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return _(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===K.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return _(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===K.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return _(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},l=i.get(r.remoteId);l&&(a.jitter=l.jitter,a.packetsLost=l.packetsLost,a.roundTripTime=l.roundTripTime),n.push(a)}}),n.sort((r,o)=>{var a,l;return((a=o.frameWidth)!==null&&a!==void 0?a:0)-((l=r.frameWidth)!==null&&l!==void 0?l:0)}),n})}setPublishingQuality(e){const n=[];for(let i=gn.LOW;i<=gn.HIGH;i+=1)n.push(new Uu({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(zn(this.codec),n)}restartTrack(e){return _(this,void 0,void 0,function*(){var n,i,r,o,a;let l;if(e){const h=Ku({video:e});typeof h.video!="boolean"&&(l=h.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var c=!0,d=xi(this.simulcastCodecs.values()),u;u=yield d.next(),n=u.done,!n;c=!0){o=u.value,c=!1;const h=o;h.sender&&((a=h.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){i={error:h}}finally{try{!c&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return _(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,l,c,d,u,h;if(yield n.setProcessor.call(r,i,o),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var p=!0,m=xi(r.simulcastCodecs.values()),x;x=yield m.next(),a=x.done,!a;p=!0)d=x.value,p=!1,yield(h=d.sender)===null||h===void 0?void 0:h.replaceTrack(r.processor.processedTrack)}catch(g){l={error:g}}finally{try{!p&&!a&&(c=m.return)&&(yield c.call(m))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return _(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},kM))}setPublishingCodecs(e){return _(this,void 0,void 0,function*(){var n,i,r,o,a,l,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(zn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const d=[];try{for(n=!0,i=xi(e);r=yield i.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(zn(u.codec),u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const p of u.qualities)if(p.enabled){d.push(u.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield bg(h.sender,h.encodings,u.qualities,this.senderLock,zn(u.codec),this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!n&&!o&&(l=i.return)&&(yield l.call(i))}finally{if(a)throw a.error}}return d})}setPublishingLayers(e,n){return _(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield bg(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return _(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&zn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return _(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Mb()&&this.isInBackground&&this.source===K.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function bg(t,e,n,i,r,o,a){return _(this,void 0,void 0,function*(){const l=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:d}=c;if(!d)return;if(d.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:d,senderEncodings:e}));return}let u=!1;!1&&d[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),d.forEach((p,m)=>{var x;let g=(x=p.rid)!==null&&x!==void 0?x:"";g===""&&(g="q");const y=$b(g),v=n.find(k=>k.quality===y);v&&p.active!==v.enabled&&(u=!0,p.active=v.enabled,o.debug("setting layer ".concat(v.quality," to ").concat(p.active?"enabled":"disabled"),a),Ts()&&(v.enabled?(p.scaleResolutionDownBy=e[m].scaleResolutionDownBy,p.maxBitrate=e[m].maxBitrate,p.maxFrameRate=e[m].maxFrameRate):(p.scaleResolutionDownBy=4,p.maxBitrate=10,p.maxFrameRate=2)))})),u&&(c.encodings=d,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:c.encodings})),yield t.setParameters(c))}finally{l()}})}function $b(t){switch(t){case"f":return gn.HIGH;case"h":return gn.MEDIUM;case"q":return gn.LOW;default:return gn.HIGH}}function vg(t,e,n,i){if(!n)return[new Hi({quality:gn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new Ub(r),a=[],l=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let d=0;d<o.spatial;d+=1)a.push(new Hi({quality:Math.min(gn.HIGH,o.spatial-1)-d,width:Math.ceil(t/Math.pow(l,d)),height:Math.ceil(e/Math.pow(l,d)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,d)):0,ssrc:0}));return a}return n.map(r=>{var o,a,l;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let d=$b((a=r.rid)!==null&&a!==void 0?a:"");return new Hi({quality:d,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(l=r.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const Sg="_lossy",kg="_reliable",CM=2*1e3,cc="leave-reconnect",wM=3e4,jM=8*1024,TM=256*1024;var bn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(bn||(bn={}));class EM extends ai.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Qu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=bn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ee,this.reliableDataSequence=1,this.reliableMessageBuffer=new lg,this.reliableReceivedState=new q_(wM),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>_(this,[i],void 0,function(r){var o=this;let{channel:a}=r;return(function*(){if(a){if(a.label===kg)o.reliableDCSub=a;else if(a.label===Sg)o.lossyDCSub=a;else return;o.log.debug("on data channel ".concat(a.id,", ").concat(a.label),o.logContext),a.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>_(this,void 0,void 0,function*(){var r,o,a,l,c;const d=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const h=Xt.fromBinary(new Uint8Array(u));if(h.sequence>0&&h.participantSid!==""){const p=this.reliableReceivedState.get(h.participantSid);if(p&&h.sequence<=p)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((r=h.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(re.ActiveSpeakersUpdate,h.value.value.speakers);else if(((o=h.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const p=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),m=Ey.fromBinary(p.payload),x=new Xt({value:m.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((l=x.value)===null||l===void 0?void 0:l.case)==="user"&&Cg(x,x.value.value),this.emit(re.DataPacketReceived,x,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&Cg(h,h.value.value),this.emit(re.DataPacketReceived,h,Rt.NONE)}finally{d()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(re.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(l===null){o(a);return}i===cc&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ft.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===bn.Connected&&i();const o=()=>{this.off(re.Disconnected,a),i()},a=()=>{this.off(re.Restarted,o),r()};this.once(re.Restarted,o),this.once(re.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Ae.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(re.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>_(this,void 0,void 0,function*(){!this.url||!(yield fetch(vo(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ze.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ze.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(us.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>_(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(vo(this.url),{method:"HEAD"}),Wt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Ri((n=e.loggerName)!==null&&n!==void 0?n:Bn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ju(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new tn,this.dataProcessLock=new tn,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(re.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(re.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(re.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(re.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(re.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(re.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(re.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(re.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,a;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(e,n,i,r){return _(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate().catch(a=>{Ee.error(a,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(re.SignalConnected,o),o}catch(o){if(o instanceof be&&o.reason===st.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return _(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(re.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return _(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new lg,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return _(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new yi("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(be.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return _(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return _(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==gt.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new nM(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(re.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>_(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===gt.CONNECTED){const u=this.pcState===bn.New;this.pcState=bn.Connected,u&&this.emit(re.Connected,e)}else o===gt.FAILED&&(this.pcState===bn.Connected||this.pcState===bn.Reconnecting)&&(this.pcState=bn.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?us.RR_SUBSCRIBER_FAILED:us.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===Ze.RECONNECTING,d=[gt.FAILED,gt.CLOSING,gt.CLOSED].includes(o);c&&d&&!this._isClosed&&this.emit(re.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(re.MediaTrackAdded,o.track,o.streams[0],o.receiver)},RM((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>_(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>_(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(re.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(re.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(re.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(re.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(re.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",us.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Bb,regionSettings:e.regions})),e.action){case or.DISCONNECT:this.emit(re.Disconnected,e?.reason),this.close();break;case or.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(cc);break;case or.RESUME:this.handleDisconnect(cc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),r.push(a)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===go.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Sg,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(kg,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Ae.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,jM),TM)}},1e3))}createSender(e,n,i){return _(this,void 0,void 0,function*(){if(pd())return yield this.createTransceiverRTCRtpSender(e,n,i);if(fd())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Et("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return _(this,void 0,void 0,function*(){if(pd())return this.createSimulcastTransceiverSender(e,n,i,r);if(fd())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Et("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return _(this,void 0,void 0,function*(){if(!this.pcManager)throw new Et("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),rs(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return _(this,void 0,void 0,function*(){if(!this.pcManager)throw new Et("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return _(this,void 0,void 0,function*(){if(!this.pcManager)throw new Et("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return _(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Ee.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===go.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:gt.NEW)===gt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof Et?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof Us||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",us.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(re.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return _(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Et("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(re.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Us;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof be&&a.reason===st.NotAllowed?new Et("could not reconnect, token might be expired"):new Us}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(re.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==Ze.CONNECTED)throw new Us("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(re.Restarted)}catch(o){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return _(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Et("could not reconnect, url or token not saved");if(!this.pcManager)throw new Et("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(re.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof be&&r.reason===st.NotAllowed?new Et("could not reconnect, token might be expired"):r instanceof be&&r.reason===st.LeaveRequest?r:new Us(o)}if(this.emit(re.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ze.CONNECTED)throw new Us("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(re.Resumed)})}waitForPCInitialConnection(e,n){return _(this,void 0,void 0,function*(){if(!this.pcManager)throw new Et("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return _(this,void 0,void 0,function*(){this.pcState=bn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Wt(CM),!this.pcManager)throw new Et("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=bn.Connected}catch(e){throw this.pcState=bn.Disconnected,be.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return _(this,void 0,void 0,function*(){const o=new Xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new Lu({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Ae.RELIABLE)})}publishRpcAck(e,n){return _(this,void 0,void 0,function*(){const i=new Xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new Ou({requestId:n})}});yield this.sendDataPacket(i,Ae.RELIABLE)})}sendDataPacket(e,n){return _(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=z_(e);if(o){const a=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Ty({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===Ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===Ae.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return _(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ae.RELIABLE);const n=this.dataChannelForKind(Ae.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(Ae.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>_(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(re.Closing,r);!this.dcBufferStatus.get(e);)yield Wt(10);this.off(re.Closing,r),n()}}))}ensureDataTransportConnected(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new Et("PC manager is closed");const a=r?i.pcManager.subscriber:i.pcManager.publisher,l=r?"Subscriber":"Publisher";if(!a)throw be.internal("".concat(l," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(h=>{Ee.error(h,i.logContext)});const d=i.dataChannelForKind(n,r);if(d?.readyState==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(a.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Wt(50)}throw be.internal("could not establish ".concat(l," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(e){return _(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==gt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return _(this,void 0,void 0,function*(){return new Promise((e,n)=>_(this,void 0,void 0,function*(){if(!this.pcManager){n(new ld("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(re.Closing,r),this.pcManager.publisher.once(ur.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(l=>{const c=l.codec.toLowerCase();v_(c)&&a.set(l.payload,c)}),this.emit(re.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof ld&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",us.RR_UNKNOWN),n(o)}finally{this.off(re.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,o,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),d=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),h=(a=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&a!==void 0?a:!0,p=new Array,m=new Array;e.forEach(x=>{x.isDesired!==h&&p.push(x.trackSid),x.isEnabled||m.push(x.trackSid)}),this.client.sendSyncState(new $u({answer:this.options.singlePeerConnection?c?er({sdp:c.sdp,type:c.type}):void 0:u?er({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?l?er({sdp:l.sdp,type:l.type}):void 0:d?er({sdp:d.sdp,type:d.type}):void 0,subscription:new fl({trackSids:p,subscribe:!h,participantTracks:[]}),publishTracks:i_(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((x,g)=>new Hy({publisherSid:g,lastSeq:x}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{i?.id!==void 0&&i.id!==null&&e.push(new qy({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(Ae.LOSSY),Dn.PUBLISHER),n(this.dataChannelForKind(Ae.RELIABLE),Dn.PUBLISHER),n(this.dataChannelForKind(Ae.LOSSY,!0),Dn.SUBSCRIBER),n(this.dataChannelForKind(Ae.RELIABLE,!0),Dn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ft.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ln()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ln()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(o=>{let[a]=o;return a===i});if(r)return r[1]}}}function RM(t){return t!==void 0&&t>13}function Cg(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Vb{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new vn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Yt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new vn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Yt.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class IM extends Vb{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new kn,i=null,r=null;if(this.signal){const a=this.signal;r=()=>{var l;(l=n.reject)===null||l===void 0||l.call(n,a.reason)},a.addEventListener("abort",r),i=a}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>_(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:d}=yield Promise.race([e.read(),n.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(d),{done:!1,value:d.content})}catch(c){throw o(),c}}),return(){return _(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=xi(c),h;h=yield u.next(),i=h.done,!i;d=!0){a=h.value,d=!1;const p=a;l.add(p)}}catch(p){r={error:p}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return Array.from(l)})()})}}class AM extends Vb{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Sa(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new kn,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,l.reason)},l.addEventListener("abort",o),r=l}const a=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>_(this,void 0,void 0,function*(){var l,c;try{const{done:d,value:u}=yield Promise.race([e.read(),i.promise,(c=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(d)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let h;try{h=n.decode(u.content)}catch(p){throw new vn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(p),Yt.DecodeFailed)}return{done:!1,value:h}}}catch(d){throw a(),d}}),return(){return _(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return _(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=xi(c),h;h=yield u.next(),i=h.done,!i;d=!0)a=h.value,d=!1,l+=a}catch(p){r={error:p}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return l})()})}}class _M{constructor(){this.log=Ee,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new vn('A text stream handler for topic "'.concat(e,'" has already been set.'),Yt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new vn('A byte stream handler for topic "'.concat(e,'" has already been set.'),Yt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,o;const a=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(a.length>0||l.length>0){const c=new vn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Yt.AbnormalEnd);for(const[d,u]of l)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(d);for(const[d,u]of a)(o=(r=u.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,c),this.textStreamControllers.delete(d)}}handleDataStreamPacket(e,n){return _(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return _(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const l=new kn;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Sa(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Yt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new IM(c,d,Sa(e.totalLength),l),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const l=new kn;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new vn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Yt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new AM(c,d,Sa(e.totalLength),l),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new vn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Yt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new vn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Yt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new vn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Yt.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new vn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Yt.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Gb{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return _(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class MM extends Gb{}class PM extends Gb{}const wg=15e3;class NM{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return _(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,l=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(l?l.length+1:1).fill(0),d=(h,p)=>{var m;c[p]=h;const x=c.reduce((g,y)=>g+y,0);(m=n?.onProgress)===null||m===void 0||m.call(n,x)},u=yield this.streamText({streamId:r,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:l,attributes:n?.attributes});return yield u.write(e),d(1,0),yield u.close(),n?.attachments&&l&&(yield Promise.all(n.attachments.map((h,p)=>_(this,void 0,void 0,function*(){return this._sendFile(l[p],h,{topic:n.topic,mimeType:h.type,onProgress:m=>{d(m,p+1)}})})))),u.info})}streamText(e){return _(this,void 0,void 0,function*(){var n,i,r;const o=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Rt.GCM:Rt.NONE},l=new za({streamId:o,mimeType:a.mimeType,topic:a.topic,timestamp:hs(a.timestamp),totalLength:hs(e?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new Ly({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Zc.UPDATE:Zc.CREATE})}}),c=e?.destinationIdentities,d=new Xt({destinationIdentities:c,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,Ae.RELIABLE);let u=0;const h=this.engine,p=new WritableStream({write(g){return _(this,void 0,void 0,function*(){for(const y of T_(g,wg)){const v=new Oa({content:y,streamId:o,chunkIndex:hs(u)}),k=new Xt({destinationIdentities:c,value:{case:"streamChunk",value:v}});yield h.sendDataPacket(k,Ae.RELIABLE),u+=1}})},close(){return _(this,void 0,void 0,function*(){const g=new La({streamId:o}),y=new Xt({destinationIdentities:c,value:{case:"streamTrailer",value:g}});yield h.sendDataPacket(y,Ae.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let m=()=>_(this,void 0,void 0,function*(){yield x.close()});h.once(re.Closing,m);const x=new MM(p,a,()=>this.engine.off(re.Closing,m));return x})}sendFile(e,n){return _(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return _(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i?.mimeType)!==null&&r!==void 0?r:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:l,value:c}=yield a.read();if(l)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return _(this,void 0,void 0,function*(){var n,i,r,o,a,l;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),d=e?.destinationIdentities,u={id:c,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?Rt.GCM:Rt.NONE},h=new za({totalLength:hs((l=u.size)!==null&&l!==void 0?l:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:hs(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new By({name:u.name})}}),p=new Xt({destinationIdentities:d,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(p,Ae.RELIABLE);let m=0;const x=new tn,g=this.engine,y=this.log,v=new WritableStream({write(S){return _(this,void 0,void 0,function*(){const C=yield x.lock();let b=0;try{for(;b<S.byteLength;){const j=S.slice(b,b+wg),w=new Xt({destinationIdentities:d,value:{case:"streamChunk",value:new Oa({content:j,streamId:c,chunkIndex:hs(m)})}});yield g.sendDataPacket(w,Ae.RELIABLE),m+=1,b+=j.byteLength}}finally{C()}})},close(){return _(this,void 0,void 0,function*(){const S=new La({streamId:c}),C=new Xt({destinationIdentities:d,value:{case:"streamTrailer",value:S}});yield g.sendDataPacket(C,Ae.RELIABLE)})},abort(S){y.error("Sink error:",S)}});return new PM(v,u)})}}class Hb extends K{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ne.Muted:ne.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ne.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return _(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),th)),s_()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(ne.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class DM extends Hb{constructor(e,n,i,r,o,a){super(e,n,K.Kind.Audio,i,a),this.monitorReceiver=()=>_(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=xl(l,this.prevStats)),this.prevStats=l}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;si()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(si())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return _(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(gd(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&gd(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ne.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(ne.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return _(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const dc=100;class zM extends Hb{constructor(e,n,i,r,o){super(e,n,K.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>_(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=xl(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=Xu(()=>{this.updateDimensions()},dc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===K.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?lr(this._mediaStreamTrack,n):Qs(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new OM(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return _(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return _(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,d)=>Math.max(c,d.visibilityChangedAt||0),0),o=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,a=this.elementInfos.some(c=>c.pictureInPicture),l=this.elementInfos.some(c=>c.visible)&&!o||a;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-r<dc){Ft.setTimeout(()=>{this.updateVisibility()},dc);return}this.lastVisible=l,this.emit(ne.VisibilityChanged,l,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const l=a.width()*o,c=a.height()*o;l+c>i+r&&(i=l,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(ne.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Zf():n||(Zf()>2?2:1)}}class OM{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:a}=i;o===this.element&&(this.isIntersecting=a,this.isPiP=Dr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Dr(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Dr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Sd(e),this.isPiP=ln()&&Dr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Sd(this.element),this.isPiP=Dr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,eg().observe(this.element),Qf().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=eg())===null||e===void 0||e.unobserve(this.element),(n=Qf())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Dr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Sd(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Sd(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,a=t.offsetHeight,{hidden:l}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!l&&c!=="none"}class pi extends ai.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=Rt.NONE,this.log=Ee,this.handleMuted=()=>{this.emit(ne.Muted)},this.handleUnmuted=()=>{this.emit(ne.Unmuted)},this.log=Ri((o=r?.loggerName)!==null&&o!==void 0?o:Bn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=K.Source.Unknown}setTrack(e){this.track&&(this.track.off(ne.Muted,this.handleMuted),this.track.off(ne.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ne.Muted,this.handleMuted),e.on(ne.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Me(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Rt.NONE}get audioTrack(){if(ti(this.track))return this.track}get videoTrack(){if(rs(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=K.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===K.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(pi||(pi={}));class kd extends pi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ne.Ended)},this.handleCpuConstrained=()=>{this.track&&rs(this.track)&&this.emit(ne.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(ne.Ended,this.handleTrackEnded),this.track.off(ne.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ne.Ended,this.handleTrackEnded),e.on(ne.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return _(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return _(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return _(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return _(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ti(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Mt.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Mt.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Mt.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Mt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Mt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Mt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function yl(t,e){return _(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=_b(t);let a=o.audio,l=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const h=o.audio.deviceId;o.audio.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:h}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const h=o.video.deviceId;o.video.deviceId={exact:h},n=!0,l=Object.assign(Object.assign({},o.video),{deviceId:{ideal:h}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=Rb(o,Ob,Lb),d=Ku(c),u=navigator.mediaDevices.getUserMedia(d);o.audio&&(Pt.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Pt.userMediaPromiseMap.delete("audioinput"))),o.video&&(Pt.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Pt.userMediaPromiseMap.delete("videoinput")));try{const h=yield u;return yield Promise.all(h.getTracks().map(p=>_(this,void 0,void 0,function*(){const m=p.kind==="audio";let x=m?c.audio:c.video;(typeof x=="boolean"||!x)&&(x={});let g;const y=m?d.audio:d.video;typeof y!="boolean"&&(g=y);const v=p.getSettings().deviceId;g?.deviceId&&qi(g.deviceId)!==v?g.deviceId=v:g||(g={deviceId:v});const k=uM(p,g,e);return k.kind===K.Kind.Video?k.source=K.Source.Camera:k.kind===K.Kind.Audio&&(k.source=K.Source.Microphone),k.mediaStream=h,ti(k)&&i?yield k.setProcessor(i):rs(k)&&r&&(yield k.setProcessor(r)),k})))}catch(h){if(!n)throw h;return yl(Object.assign(Object.assign({},t),{audio:a,video:l}),e)}})}function LM(t){return _(this,void 0,void 0,function*(){return(yield yl({audio:!1,video:!0}))[0]})}function qb(t){return _(this,void 0,void 0,function*(){return(yield yl({audio:t??!0,video:!1}))[0]})}var Wi;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Wi||(Wi={}));function BM(t){switch(t){case Fr.EXCELLENT:return Wi.Excellent;case Fr.GOOD:return Wi.Good;case Fr.POOR:return Wi.Poor;case Fr.LOST:return Wi.Lost;default:return Wi.Unknown}}class Kb extends ai.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===mo.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===rr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,a){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:mo.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Wi.Unknown,this.log=Ee,this.log=Ri((c=a?.loggerName)!==null&&c!==void 0?c:Bn.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new kn,this.once(le.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(K.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(K.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(K.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===rr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==rr.ACTIVE&&this.emit(le.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(le.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(le.ParticipantNameChanged,e)}_setAttributes(e){const n=r_(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(le.AttributesChanged,n)}setPermissions(e){var n,i,r,o,a,l;const c=this.permissions,d=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,h)=>{var p;return u!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[h])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,d&&this.emit(le.ParticipantPermissionsChanged,c),d}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(le.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=BM(e),n!==this._connectionQuality&&this.emit(le.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ti(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(ne.Muted,()=>{this.emit(le.TrackMuted,e)}),e.on(ne.Unmuted,()=>{this.emit(le.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case K.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case K.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function FM(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Vy({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class WM extends Kb{constructor(e,n,i,r,o,a){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Rt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new kn)},this.handleReconnected=()=>{var l,c;(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||c===void 0||c.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,c,d,u,h,p;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||c===void 0||c.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(d=this.signalConnectedFuture).reject)===null||u===void 0||u.call(d,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(p=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var c,d;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new kn),(d=(c=this.signalConnectedFuture).resolve)===null||d===void 0||d.call(c)},this.handleSignalRequestResponse=l=>{const{requestId:c,reason:d,message:u}=l,h=this.pendingSignalRequests.get(c);h&&(d!==Vu.OK&&h.reject(new qf(u,d)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let c=l.value.value,d=null,u=null;c.value.case==="payload"?d=c.value.value:c.value.case==="error"&&(u=xt.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,d,u);break;case"rpcAck":let h=l.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>FM(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,c)=>{if(c===void 0&&(c=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Me(l)));return}this.engine.updateMuteStatus(l.sid,c)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Me(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Me(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const c=this.audioTrackPublications.get(l.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(l,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Me(c))),this.emit(le.LocalTrackCpuConstrained,l,c)},this.handleSubscribedQualityUpdate=l=>_(this,void 0,void 0,function*(){var c,d,u,h,p;if(!(!((p=this.roomOptions)===null||p===void 0)&&p.dynacast))return;const m=this.videoTrackPublications.get(l.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!m.videoTrack)return;const x=yield m.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var g=!0,y=xi(x),v;v=yield y.next(),c=v.done,!c;g=!0){h=v.value,g=!1;const k=h;e_(k)&&(this.log.debug("publish ".concat(k," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Me(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,k,m.options))}}catch(k){d={error:k}}finally{try{!g&&!c&&(u=y.return)&&(yield u.call(y))}finally{if(d)throw d.error}}}),this.handleLocalTrackUnpublished=l=>{const c=this.trackPublications.get(l.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=l=>_(this,void 0,void 0,function*(){if(l.source===K.Source.ScreenShare||l.source===K.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Me(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(hi(l)||Ni(l))try{if(ln())try{const c=yield navigator?.permissions.query({name:l.source===K.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),Me(l))),c.onchange=()=>{c.state!=="denied"&&(l.isMuted||l.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Me(l))),hi(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Me(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Rt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(re.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(re.Connected,this.handleReconnected).on(re.SignalConnected,this.handleSignalConnected).on(re.SignalRestarted,this.handleReconnected).on(re.SignalResumed,this.handleReconnected).on(re.Restarting,this.handleReconnecting).on(re.Resuming,this.handleReconnecting).on(re.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(re.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(re.Closing,this.handleClosing).on(re.SignalRequestResponse,this.handleSignalRequestResponse).on(re.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return _(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return _(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return _(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return _(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:a}=n;return(function*(){return new Promise((l,c)=>_(i,void 0,void 0,function*(){var d,u;try{let h=!1;const p=yield this.engine.client.sendUpdateLocalMetadata((d=r??this.metadata)!==null&&d!==void 0?d:"",(u=o??this.name)!==null&&u!==void 0?u:"",a),m=performance.now();for(this.pendingSignalRequests.set(p,{resolve:l,reject:x=>{c(x),h=!0},values:{name:o,metadata:r,attributes:a}});performance.now()-m<5e3&&!h;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!a||Object.entries(a).every(x=>{let[g,y]=x;return this.attributes[g]===y||y===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(p),l();return}yield Wt(50)}c(new qf("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(K.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(K.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(K.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return _(this,void 0,void 0,function*(){this.encryptionType=e?Rt.GCM:Rt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return _(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(n)if(l)yield l.unmute();else{let c;if(this.pendingPublishing.has(e)){const d=yield this.waitForPendingPublicationOfSource(e);return d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield d?.unmute(),d}this.pendingPublishing.add(e);try{switch(e){case K.Source.Camera:c=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case K.Source.Microphone:c=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case K.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new yi(e)}}catch(d){throw c?.forEach(u=>{u.stop()}),d instanceof Error&&this.emit(le.MediaDevicesError,d,hd(e)),this.pendingPublishing.delete(e),d}for(const d of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===K.Source.Microphone&&ti(d)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),d.startPreConnectBuffer())}try{const d=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Me(h))),d.push(this.publishTrack(h,r));[l]=yield Promise.all(d)}catch(d){throw c?.forEach(u=>{u.stop()}),d}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===K.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const c=this.getTrackPublication(K.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return _(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(K.Source.Camera)||this.pendingPublishing.has(K.Source.Microphone))){this.pendingPublishing.add(K.Source.Camera),this.pendingPublishing.add(K.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(K.Source.Camera),this.pendingPublishing.delete(K.Source.Microphone)}}})}createTracks(e){return _(this,void 0,void 0,function*(){var n,i;e??(e={});const r=Rb(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield yl(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(ti(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=K.Source.Microphone,this.emit(le.AudioStreamAcquired)),rs(l)&&(this.cameraError=void 0,l.source=K.Source.Camera),l))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return _(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Hu("getDisplayMedia not supported");e.resolution===void 0&&!f_()&&(e.resolution=qu.h1080fps30.resolution);const n=n_(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new yi("no video track found");const o=new Wa(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=K.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(le.AudioStreamAcquired);const l=new Fa(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=K.Source.ScreenShareAudio,a.push(l)}return a})}publishTrack(e,n){return _(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return _(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,c,d,u;hi(i)&&i.setAudioContext(o.audioContext),yield(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise,o.republishPromise&&!a&&(yield o.republishPromise),cr(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let h;if(i instanceof MediaStreamTrack)h=i.getConstraints();else{h=i.constraints;let v;switch(i.source){case K.Source.Microphone:v="audioinput";break;case K.Source.Camera:v="videoinput"}v&&o.activeDeviceMap.has(v)&&(h=Object.assign(Object.assign({},h),{deviceId:o.activeDeviceMap.get(v)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Fa(i,h,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Wa(i,h,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new yi("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let p;if(o.trackPublications.forEach(v=>{v.track&&v.track===i&&(p=v)}),p)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Me(p))),p;const m=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),x="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(c=m.forceStereo)!==null&&c!==void 0?c:x;g&&(m.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Me(i))),m.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(d=m.dtx)!==null&&d!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!m_()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const y=new Promise((v,k)=>_(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ze.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Me(i)}));let S=!1;const C=setTimeout(()=>{S=!0,i.stop(),k(new Hf("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(C),S)return;const b=yield this.publish(i,m,g);v(b)}else try{const S=yield this.publish(i,m,g);v(S)}catch(S){k(S)}}catch(S){k(S)}}));o.pendingPublishPromises.set(i,y);try{return yield y}catch(v){throw v}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new kn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Me(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>o_(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Me(e))),!1)}publish(e,n,i){return _(this,void 0,void 0,function*(){var r,o,a,l,c,d,u,h,p,m;if(!this.hasPermissionsToPublish(e))throw new Hf("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(I=>cr(e)&&I.source===e.source)&&e.source!==K.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Me(e))),n.stopMicTrackOnMute&&ti(e)&&(e.stopOnMute=!0),e.source===K.Source.ScreenShare&&Ts()&&(n.simulcast=!1),n.videoCodec==="av1"&&!u_()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!h_()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=yd),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===Yr(I.mime))||(n.videoCodec=Yr(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(ne.Muted,this.onTrackMuted),e.on(ne.Unmuted,this.onTrackUnmuted),e.on(ne.Ended,this.handleTrackEnded),e.on(ne.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ne.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ne.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),k=e.getSourceTrackSettings();k.autoGainControl&&y.push(Mt.TF_AUTO_GAIN_CONTROL),k.echoCancellation&&y.push(Mt.TF_ECHO_CANCELLATION),k.noiseSuppression&&y.push(Mt.TF_NOISE_SUPPRESSION),k.channelCount&&k.channelCount>1&&y.push(Mt.TF_STEREO),v&&y.push(Mt.TF_NO_DTX),hi(e)&&e.hasPreConnectBuffer&&y.push(Mt.TF_PRECONNECT_BUFFER);const S=new xo({cid:e.mediaStreamTrack.id,name:n.name,type:K.kindToProto(e.kind),muted:e.isMuted,source:K.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:y});let C;if(e.kind===K.Kind.Video){let I={width:0,height:0};try{I=yield e.waitForDimensions()}catch{const P=(l=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&l!==void 0?l:yo.h720.resolution;I={width:P.width,height:P.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{dims:I}))}S.width=I.width,S.height=I.height,Ni(e)&&(zn(g)&&(e.source===K.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Me(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new ed({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:yd}),n.backupCodec&&g!==n.backupCodec.codec&&S.encryption===Rt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new ed({codec:n.backupCodec.codec,cid:""})))),C=vd(e.source===K.Source.ScreenShare,S.width,S.height,n),S.layers=vg(S.width,S.height,C,zn(n.videoCodec))}else e.kind===K.Kind.Audio&&(C=[{maxBitrate:(d=n.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(h=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&h!==void 0?h:"high",networkPriority:(m=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Et("cannot publish track when not connected");const b=()=>_(this,void 0,void 0,function*(){var I,E,P;if(!this.engine.pcManager)throw new Et("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,C),this.emit(le.LocalSenderCreated,e.sender,e),Ni(e)&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=SM(e)),e.setDegradationPreference(n.degradationPreference)),C)if(Ts()&&e.kind===K.Kind.Audio){let O;for(const B of this.engine.pcManager.publisher.getTransceivers())if(B.sender===e.sender){O=B;break}O&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:O,codec:"opus",maxbr:!((E=C[0])===null||E===void 0)&&E.maxBitrate?C[0].maxBitrate/1e3:0})}else e.codec&&zn(e.codec)&&(!((P=C[0])===null||P===void 0)&&P.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let j;const w=new Promise((I,E)=>_(this,void 0,void 0,function*(){var P;try{j=yield this.engine.addTrack(S),I(j)}catch(O){e.sender&&(!((P=this.engine.pcManager)===null||P===void 0)&&P.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(B=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{error:B}))})),E(O)}}));if(this.enabledPublishVideoCodecs.length>0)j=(yield Promise.all([w,b()]))[0];else{j=yield w;let I;if(j.codecs.forEach(E=>{I===void 0&&(I=E.mimeType)}),I&&e.kind===K.Kind.Video){const E=Yr(I);E!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{codec:E})),n.videoCodec=E,C=vd(e.source===K.Source.ScreenShare,S.width,S.height,n))}yield b()}const T=new kd(e.kind,j,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(T.on(ne.CpuConstrained,I=>this.onTrackCpuConstrained(I,T)),T.options=n,e.sid=j.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:j})),Ni(e)?e.startMonitor(this.engine.client):hi(e)&&e.startMonitor(),this.addTrackPublication(T),this.emit(le.LocalTrackPublished,T),hi(e)&&j.audioFeatures.includes(Mt.TF_PRECONNECT_BUFFER)){const I=e.getPreConnectBuffer(),E=e.getPreConnectBufferMimeType();this.on(le.LocalTrackSubscribed,P=>{if(P.trackSid===j.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(e))),e.stopPreConnectBuffer()}}),I&&new Promise((O,B)=>_(this,void 0,void 0,function*(){var N,M,F,$,D,z;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Me(e)));const G=setTimeout(()=>{B(new Error("agent not active within 10 seconds"))},1e4),q=yield this.waitUntilActiveAgentPresent();clearTimeout(G),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Me(e)));const ie=yield this.streamBytes({name:"preconnect-buffer",mimeType:E,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[q.identity],attributes:{trackId:T.trackSid,sampleRate:String((D=k.sampleRate)!==null&&D!==void 0?D:"48000"),channels:String((z=k.channelCount)!==null&&z!==void 0?z:"1")}});try{for(var L=!0,ee=xi(I),se;se=yield ee.next(),N=se.done,!N;L=!0){$=se.value,L=!1;const A=$;yield ie.write(A)}}catch(A){M={error:A}}finally{try{!L&&!N&&(F=ee.return)&&(yield F.call(ee))}finally{if(M)throw M.error}}yield ie.close(),O()}catch(G){B(G)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Me(e)))}).catch(O=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{error:O}))})}return T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return _(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Rt.NONE)return;let o;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(o=m)}),!o)throw new yi("track is not published");if(!Ni(e))throw new yi("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),l=yM(e,n,a);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Me(e)));return}const c=e.addSimulcastTrack(n,l);if(!c)return;const d=new xo({cid:c.mediaStreamTrack.id,type:K.kindToProto(e.kind),muted:e.isMuted,source:K.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:c.mediaStreamTrack.id}]});if(d.layers=vg(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new Et("cannot publish track when not connected");const u=()=>_(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,a,l),yield this.engine.negotiate()}),p=(yield Promise.all([this.engine.addTrack(d),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:p}))})}unpublishTrack(e,n){return _(this,void 0,void 0,function*(){var i,r;if(cr(e)){const d=this.pendingPublishPromises.get(e);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Me(e))),yield d)}const o=this.getPublicationForTrack(e),a=o?Me(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(ne.Muted,this.onTrackMuted),e.off(ne.Unmuted,this.onTrackUnmuted),e.off(ne.Ended,this.handleTrackEnded),e.off(ne.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ne.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ne.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let l=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<gt.FAILED&&c)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===c&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(c)&&(l=!0),Ni(e)){for(const[,d]of e.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);e.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:d}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case K.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case K.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(le.LocalTrackUnpublished,o),o.setTrack(void 0),l&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return _(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,a)=>_(i,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),l.push(c))}),yield Promise.all(l.map(c=>_(this,void 0,void 0,function*(){const d=c.track;yield this.unpublishTrack(d,!1),r&&!d.isMuted&&d.source!==K.Source.ScreenShare&&d.source!==K.Source.ScreenShareAudio&&(hi(d)||Ni(d))&&!d.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield d.restartTrack()),yield this.publishOrRepublishTrack(d,c.options,!0)}))),o()}catch(l){a(l)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return _(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?Ae.RELIABLE:Ae.LOSSY,a=r.destinationIdentities,l=r.topic;let c=new Du({participantIdentity:i.identity,payload:n,destinationIdentities:a,topic:l});const d=new Xt({kind:o,value:{case:"user",value:c}});yield i.engine.sendDataPacket(d,o)})()})}publishDtmf(e,n){return _(this,void 0,void 0,function*(){const i=new Xt({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new Iy({code:e,digit:n})}});yield this.engine.sendDataPacket(i,Ae.RELIABLE)})}sendChatMessage(e,n){return _(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},r=new Xt({value:{case:"chatMessage",value:new Da(Object.assign(Object.assign({},i),{timestamp:at.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(le.ChatMessage,i),i})}editChatMessage(e,n){return _(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Xt({value:{case:"chatMessage",value:new Da(Object.assign(Object.assign({},i),{timestamp:at.parse(i.timestamp),editTimestamp:at.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(le.ChatMessage,i),i})}sendText(e,n){return _(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return _(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return _(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return _(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return _(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:a,responseTimeout:l=15e3}=n;return(function*(){return new Promise((u,h)=>_(i,void 0,void 0,function*(){var p,m,x,g;if(eh(a)>Fb){h(xt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||m===void 0)&&m.version&&ri((g=(x=this.engine.latestJoinResponse)===null||x===void 0?void 0:x.serverInfo)===null||g===void 0?void 0:g.version,"1.8.0")<0){h(xt.builtIn("UNSUPPORTED_SERVER"));return}const y=Math.max(l,8e3),v=crypto.randomUUID();yield this.publishRpcRequest(r,v,o,a,y);const k=setTimeout(()=>{this.pendingAcks.delete(v),h(xt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(S)},7e3);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(k)},participantIdentity:r});const S=setTimeout(()=>{this.pendingResponses.delete(v),h(xt.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(v,{resolve:(C,b)=>{clearTimeout(S),this.pendingAcks.has(v)&&(this.log.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(k)),b?h(b):u(C??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return _(this,void 0,void 0,function*(){const a=new Xt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new zu({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(a,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,xt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const a=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Me(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new kn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(hi(r)||Ni(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return _(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[a]=o;return a.source===e});if(r)return r[1];yield Wt(20)}})}}class UM extends pi{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ne.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new fl({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new _y({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ne.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?pi.SubscriptionStatus.Unsubscribed:super.isSubscribed?pi.SubscriptionStatus.Subscribed:pi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?pi.PermissionStatus.Allowed:pi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(ic(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&ic(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:gn.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(ne.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(ne.VisibilityChanged,this.handleVisibilityChange),r.off(ne.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(ne.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ne.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ne.VisibilityChanged,this.handleVisibilityChange),e.on(ne.Ended,this.handleEnded),this.emit(ne.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(ne.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?ne.Muted:ne.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(ne.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ne.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return ic(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Fy({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===K.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Jf(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=a_(this.trackInfo,this.requestedMaxQuality);i&&Jf(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:gn.HIGH})),e.quality=gn.HIGH)}this.emit(ne.UpdateSettings,e)}}class Ua extends Kb{static fromParticipantInfo(e,n,i){return new Ua(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,a,l){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:mo.STANDARD;super(n,i||"",r,o,a,l,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ne.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Me(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(ne.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(ne.SubscriptionPermissionChanged,n=>{this.emit(le.TrackSubscriptionPermissionChanged,e,n)}),e.on(ne.SubscriptionStatusChanged,n=>{this.emit(le.TrackSubscriptionStatusChanged,e,n)}),e.on(ne.Subscribed,n=>{this.emit(le.TrackSubscribed,n,e)}),e.on(ne.Unsubscribed,n=>{this.emit(le.TrackUnsubscribed,n,e)}),e.on(ne.SubscriptionFailed,n=>{this.emit(le.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:K.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:K.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,a){let l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(u=>{!l&&e.kind===u.kind.toString()&&(l=u)}),!l){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(le.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Me(l))),this.emit(le.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let d;return c?d=new zM(e,n,r,o):d=new DM(e,n,r,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(i),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&md(d)&&ti(d)&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,a;let l=this.getTrackPublicationBySid(r.sid);if(l)l.updateInfo(r);else{const c=K.kindFromProto(r.type);if(!c)return;l=new UM(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),l.updateInfo(r),i.set(r.sid,l);const d=Array.from(this.trackPublications.values()).find(u=>u.source===l?.source);d&&l.source!==K.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Me(d),newTrack:Me(l)})),this.addTrackPublication(l)}n.set(r.sid,l)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Me(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(le.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case K.Kind.Audio:this.audioTrackPublications.delete(e);break;case K.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(le.TrackUnpublished,i)}setAudioOutput(e){return _(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;ti(i.track)&&md(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Be;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Be||(Be={}));const $M=4*1e3;class br extends ai.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,o;if(super(),n=this,this.state=Be.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ee,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>_(this,void 0,void 0,function*(){var d;if(!p_())throw si()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Be.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Be.Connecting),((d=this.regionUrlProvider)===null||d===void 0?void 0:d.getServerUrl().toString())!==Db(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),yr(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Le(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(m=>{var x;(x=this.regionUrlProvider)===null||x===void 0||x.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const h=(m,x,g)=>_(this,void 0,void 0,function*(){var y,v;this.abortController&&this.abortController.abort();const k=new AbortController;this.abortController=k,u?.();try{if(yield dr.getInstance().getBackOffPromise(a),k.signal.aborted)throw be.cancelled("Connection attempt aborted");yield this.attemptConnection(g??a,l,c,k),this.abortController=void 0,m()}catch(S){if(this.regionUrlProvider&&S instanceof be&&S.reason!==st.Cancelled&&S.reason!==st.NotAllowed){let C=null;try{this.log.debug("Fetching next region"),C=yield this.regionUrlProvider.getNextBestRegionUrl((y=this.abortController)===null||y===void 0?void 0:y.signal)}catch(b){if(b instanceof be&&(b.status===401||b.reason===st.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),x(b);return}}[st.InternalError,st.ServerUnreachable,st.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),dr.getInstance().addFailedConnectionAttempt(a)),C&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(C),this.logContext),this.recreateEngine(),yield h(m,x,C)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ng(S)),x(S))}else{let C=On.UNKNOWN_REASON;S instanceof be&&(C=ng(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,C),x(S)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new kn((m,x)=>{h(m,x,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,d,u,h)=>_(this,void 0,void 0,function*(){var p,m,x;const g=yield c.join(a,l,{autoSubscribe:d.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout,singlePeerConnection:u.singlePeerConnection},h.signal);let y=g.serverInfo;if(y||(y={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=y,this.log.debug("connected to Livekit Server ".concat(Object.entries(y).map(v=>{let[k,S]=v;return"".concat(k,": ").concat(S)}).join(", ")),{room:(p=g.room)===null||p===void 0?void 0:p.name,roomSid:(m=g.room)===null||m===void 0?void 0:m.sid,identity:(x=g.participant)===null||x===void 0?void 0:x.identity}),!y.version)throw new JA("unknown server version");return y.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),g}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,d)=>_(this,void 0,void 0,function*(){var u,h;this.state===Be.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Qu),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,d);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const m=d.signal.aborted?be.cancelled("Signal connection aborted"):be.serverUnreachable("could not establish signal connection");throw p instanceof Error&&(m.message="".concat(m.message,": ").concat(p.message)),p instanceof be&&(m.reason=p.reason,m.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),m}if(d.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),be.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}ln()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ln()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Be.Connected),this.emit(X.Connected),dr.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return _(n,[...l],void 0,function(){var d=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var h,p,m;const x=yield d.disconnectLock.lock();try{if(d.state===Be.Disconnected){d.log.debug("already disconnected",d.logContext);return}if(d.log.info("disconnect from room",Object.assign({},d.logContext)),d.state===Be.Connecting||d.state===Be.Reconnecting||d.isResuming){const g="Abort connection attempt due to user initiated disconnect";d.log.warn(g,d.logContext),(h=d.abortController)===null||h===void 0||h.abort(g),(m=(p=d.connectFuture)===null||p===void 0?void 0:p.reject)===null||m===void 0||m.call(p,be.cancelled("Client initiated disconnect")),d.connectFuture=void 0}d.engine&&(d.engine.client.isDisconnected||(yield d.engine.client.sendLeave()),yield d.engine.close()),d.handleDisconnect(u,On.CLIENT_INITIATED),d.engine=void 0}finally{x()}})()})},this.onPageLeave=()=>_(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>_(this,void 0,void 0,function*(){const a=[],l=cn();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let d=document.getElementById(c);if(!d){d=document.createElement("audio"),d.id=c,d.autoplay=!0,d.hidden=!0;const u=nc();u.enabled=!0;const h=new MediaStream([u]);d.srcObject=h,document.addEventListener("visibilitychange",()=>{d&&(d.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(d),this.once(X.Disconnected,()=>{d?.remove(),d=null})}a.push(d)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(d=>{d.track&&d.track.attachedElements.forEach(u=>{a.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>_(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var d;(d=c.track)===null||d===void 0||d.attachedElements.forEach(u=>{a.includes(u)||a.push(u)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(Be.Reconnecting)&&this.emit(X.Reconnecting)},this.handleSignalRestarted=a=>_(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(Be.Connected),this.emit(X.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let d=this.remoteParticipants.get(l.identity);l.state===rr.DISCONNECTED?this.handleParticipantDisconnected(l.identity,d):d=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(d=>{if(c[d.sid]=!0,d.sid===this.localParticipant.sid)this.localParticipant.audioLevel=d.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(d.sid);u&&(u.audioLevel=d.level,u.setIsSpeaking(!0),l.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(d=>{c[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(X.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(d=>{const u=this.remoteParticipants.get(d.identity);u&&u.sid!==d.sid||l.set(d.sid,d)}),a.forEach(d=>{let u=this.getRemoteParticipantBySid(d.sid);d.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=d.level,u.setIsSpeaking(d.active),d.active?l.set(d.sid,u):l.delete(d.sid))});const c=Array.from(l.values());c.sort((d,u)=>u.audioLevel-d.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(X.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const d=c.getTrackPublicationBySid(l.trackSid);if(!d||!d.track)return;const u=K.streamStateFromProto(l.state);d.track.setStreamState(u),u!==d.track.streamState&&(c.emit(le.TrackStreamStateChanged,d,d.track.streamState),this.emitWhenConnected(X.TrackStreamStateChanged,d,d.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(d=>d.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const d=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,d.id,d.method,d.payload,d.responseTimeoutMs,d.version)}},this.handleUserPacket=(a,l,c,d)=>{this.emit(X.DataReceived,l.payload,a,c,l.topic,d),a?.emit(le.DataReceived,l.payload,c,d)},this.handleSipDtmf=(a,l)=>{this.emit(X.SipDTMFReceived,l,a),a?.emit(le.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),d=c?.trackPublications.get(l.trackId),u=k_(l,this.transcriptionReceivedTimes);d?.emit(ne.TranscriptionReceived,u),c?.emit(le.TranscriptionReceived,u,d),this.emit(X.TranscriptionReceived,u,c,d)},this.handleChatMessage=(a,l)=>{const c=C_(l);this.emit(X.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(X.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(X.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(X.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(X.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(X.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>_(this,void 0,void 0,function*(){var a;((a=cn())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(X.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(X.RoomMetadataChanged,a.metadata),l?.activeRecording!==a.activeRecording&&this.emitWhenConnected(X.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(X.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(X.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(X.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(X.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(X.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a?.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>_(this,void 0,void 0,function*(){var l,c,d,u,h,p;(l=a.track)===null||l===void 0||l.on(ne.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(ne.Restarted,this.onLocalTrackRestarted),(h=(u=(d=a.track)===null||d===void 0?void 0:d.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||h===void 0||h.call(u,this),this.emit(X.LocalTrackPublished,a,this.localParticipant),hi(a.track)&&(yield a.track.checkForSilence())&&this.emit(X.LocalAudioSilenceDetected,a);const m=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(!1),x=hd(a.source);x&&m&&m!==this.localParticipant.activeDeviceMap.get(x)&&(this.localParticipant.activeDeviceMap.set(x,m),this.emit(X.ActiveDeviceChanged,x,m))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(ne.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(ne.Restarted,this.onLocalTrackRestarted),this.emit(X.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>_(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=hd(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(X.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(X.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(X.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(X.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(X.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},tM),e),this.log=Ri((i=this.options.loggerName)!==null&&i!==void 0?i:Bn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Ob),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Lb),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},eM),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new _M,this.outgoingDataStreamManager=new NM(this.engine,this.log),this.disconnectLock=new tn,this.localParticipant=new WM("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",qi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",qi(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",qi(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),ln()){const a=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),br.cleanupRegistry&&br.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return _(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new O_(i,n),this.e2eeManager.on($i.ParticipantEncryptionStatusChanged,(r,o)=>{j_(o)&&(this.isE2EEEnabled=r),this.emit(X.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on($i.EncryptionError,(r,o)=>{const a=o?this.getParticipantByIdentity(o):void 0;this.emit(X.EncryptionError,r,a)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return _(this,void 0,void 0,function*(){return this.state===Be.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(re.RoomUpdate,i),e(r.sid))};this.engine.on(re.RoomUpdate,i),this.once(X.Disconnected,()=>{this.engine.off(re.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new EM(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(re.ParticipantUpdate,this.handleParticipantUpdates).on(re.RoomUpdate,this.handleRoomUpdate).on(re.SpeakersChanged,this.handleSpeakersChanged).on(re.StreamStateChanged,this.handleStreamStateUpdate).on(re.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(re.SubscriptionError,this.handleSubscriptionError).on(re.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(re.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(re.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(re.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(re.DataPacketReceived,this.handleDataPacket).on(re.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Be.SignalReconnecting)&&this.emit(X.SignalReconnecting)}).on(re.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Be.Connected)&&this.emit(X.Reconnected)}).on(re.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Be.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(re.Restarting,this.handleRestarting).on(re.SignalRestarted,this.handleSignalRestarted).on(re.Offline,()=>{this.setAndEmitConnectionState(Be.Reconnecting)&&this.emit(X.Reconnecting)}).on(re.DCBufferStatusChanged,(e,n)=>{this.emit(X.DCBufferStatusChanged,e,n)}).on(re.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(le.LocalTrackSubscribed,n),this.emitWhenConnected(X.LocalTrackSubscribed,n,this.localParticipant)}).on(re.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(X.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Pt.getInstance().getDevices(e,n)}prepareConnection(e,n){return _(this,void 0,void 0,function*(){if(this.state===Be.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(yr(new URL(e))&&n){this.regionUrlProvider=new Le(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Be.Disconnected&&(this.regionUrl=i,yield fetch(vo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(vo(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return _(this,void 0,void 0,function*(){let i=()=>_(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new $n({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new $n({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new $n({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new $n({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>_(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new $n({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>_(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new $n({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new $n({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>_(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new gl({reason:On.CLIENT_INITIATED,action:or.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new $n({scenario:{case:"subscriberBandwidth",value:hs(n)}});break;case"leave-full-reconnect":r=new $n({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return _(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,c,d,u,h,p,m;let x=!0,g=!1;const y=a?{exact:r}:r;if(i==="audioinput"){g=o.localParticipant.audioTrackPublications.size===0;const v=(l=o.getActiveDevice(i))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=y;const k=Array.from(o.localParticipant.audioTrackPublications.values()).filter(C=>C.source===K.Source.Microphone);try{x=(yield Promise.all(k.map(C=>{var b;return(b=C.audioTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(C=>C===!0)}catch(C){throw o.options.audioCaptureDefaults.deviceId=v,C}const S=k.some(C=>{var b,j;return(j=(b=C.track)===null||b===void 0?void 0:b.isMuted)!==null&&j!==void 0?j:!1});x&&S&&(g=!0)}else if(i==="videoinput"){g=o.localParticipant.videoTrackPublications.size===0;const v=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=y;const k=Array.from(o.localParticipant.videoTrackPublications.values()).filter(C=>C.source===K.Source.Camera);try{x=(yield Promise.all(k.map(C=>{var b;return(b=C.videoTrack)===null||b===void 0?void 0:b.setDeviceId(y)}))).every(C=>C===!0)}catch(C){throw o.options.videoCaptureDefaults.deviceId=v,C}const S=k.some(C=>{var b,j;return(j=(b=C.track)===null||b===void 0?void 0:b.isMuted)!==null&&j!==void 0?j:!1});x&&S&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!gd()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(d=yield Pt.getInstance().normalizeDeviceId("audiooutput",r))!==null&&d!==void 0?d:""),(u=(m=o.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const v=(h=o.getActiveDevice(i))!==null&&h!==void 0?h:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((p=o.audioContext)===null||p===void 0||p.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:r})))}catch(k){throw o.options.audioOutput.deviceId=v,k}}return g&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(X.ActiveDeviceChanged,i,r)),x})()})}setupLocalParticipantEvents(){this.localParticipant.on(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(le.AttributesChanged,this.onLocalAttributesChanged).on(le.TrackMuted,this.onLocalTrackMuted).on(le.TrackUnmuted,this.onLocalTrackUnmuted).on(le.LocalTrackPublished,this.onLocalTrackPublished).on(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(le.MediaDevicesError,this.onMediaDevicesError).on(le.AudioStreamAcquired,this.startAudio).on(le.ChatMessage,this.onLocalChatMessageSent).on(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Be.Connecting||this.state===Be.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,i),p()},p=()=>{this.off(X.Reconnected,h),this.off(X.Connected,h),this.off(X.Disconnected,p)};this.once(X.Reconnected,h),this.once(X.Connected,h),this.once(X.Disconnected,p);return}if(this.state===Be.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=d_(n.id),o=r[0];let a=r[1],l=e.id;if(a&&a.startsWith("TR")&&(l=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!l.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(i);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}l=h}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(a,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:a,trackId:l}));let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={});const u=c.addSubscribedMediaTrack(e,l,n,i,d);u?.isEncrypted&&!this.e2eeManager&&this.emit(X.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Be.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,l;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(le.AttributesChanged,this.onLocalAttributesChanged).off(le.TrackMuted,this.onLocalTrackMuted).off(le.TrackUnmuted,this.onLocalTrackUnmuted).off(le.LocalTrackPublished,this.onLocalTrackPublished).off(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(le.MediaDevicesError,this.onMediaDevicesError).off(le.AudioStreamAcquired,this.startAudio).off(le.ChatMessage,this.onLocalChatMessageSent).off(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ln()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Be.Disconnected),this.emit(X.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(X.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,o,a){return _(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),a!==1){yield this.engine.publishRpcResponse(e,n,null,xt.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(i);if(!l){yield this.engine.publishRpcResponse(e,n,null,xt.builtIn("UNSUPPORTED_METHOD"));return}let c=null,d=null;try{const u=yield l({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});eh(u)>Fb?(c=xt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):d=u}catch(u){u instanceof xt?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=xt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,d,c)})}selectDefaultDevices(){return _(this,void 0,void 0,function*(){var e,n,i;const r=Pt.getInstance().previousDevices,o=yield Pt.getInstance().getDevices(void 0,!1),a=cn();if(a?.name==="Chrome"&&a.os!=="iOS")for(let c of o){const d=r.find(u=>u.deviceId===c.deviceId);d&&d.label!==""&&d.kind===c.kind&&d.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(X.ActiveDeviceChanged,c.kind,c.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let c of l){const d=t_(c),u=this.localParticipant.getTrackPublication(d);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const h=o.filter(m=>m.kind===c),p=this.getActiveDevice(c);if(p===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((i=h[0])===null||i===void 0?void 0:i.deviceId)!==p){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!bo()||c==="videoinput"||h.length>0&&!h.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!bo())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return _(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Ab())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Wt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(X.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Ua.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ua(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(X.ParticipantConnected,i),i.on(le.TrackPublished,r=>{this.emitWhenConnected(X.TrackPublished,r,i)}).on(le.TrackSubscribed,(r,o)=>{r.kind===K.Kind.Audio?(r.on(ne.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(ne.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===K.Kind.Video&&(r.on(ne.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(ne.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(X.TrackSubscribed,r,o,i)}).on(le.TrackUnpublished,r=>{this.emit(X.TrackUnpublished,r,i)}).on(le.TrackUnsubscribed,(r,o)=>{this.emit(X.TrackUnsubscribed,r,o,i)}).on(le.TrackMuted,r=>{this.emitWhenConnected(X.TrackMuted,r,i)}).on(le.TrackUnmuted,r=>{this.emitWhenConnected(X.TrackUnmuted,r,i)}).on(le.ParticipantMetadataChanged,r=>{this.emitWhenConnected(X.ParticipantMetadataChanged,r,i)}).on(le.ParticipantNameChanged,r=>{this.emitWhenConnected(X.ParticipantNameChanged,r,i)}).on(le.AttributesChanged,r=>{this.emitWhenConnected(X.ParticipantAttributesChanged,r,i)}).on(le.ConnectionQualityChanged,r=>{this.emitWhenConnected(X.ConnectionQualityChanged,r,i)}).on(le.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(X.ParticipantPermissionsChanged,r,i)}).on(le.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(X.TrackSubscriptionStatusChanged,r,o,i)}).on(le.TrackSubscriptionFailed,(r,o)=>{this.emit(X.TrackSubscriptionFailed,r,i,o)}).on(le.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(X.TrackSubscriptionPermissionChanged,r,o,i)}).on(le.Active,()=>{this.emitWhenConnected(X.ParticipantActive,i),i.kind===mo.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&w_(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ft.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,On.STATE_MISMATCH))):e=0},$M)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ft.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(X.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Be.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Be.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return _(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new ul({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:at.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new js({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(X.SignalConnected),this.emit(X.Connected),this.setAndEmitConnectionState(Be.Connected),r.video){const a=new kd(K.Kind.Video,new Zs({source:Ct.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Nn.AUDIO,name:"video-dummy"}),new Wa(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:tg(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(le.LocalTrackPublished,a)}if(r.audio){const a=new kd(K.Kind.Audio,new Zs({source:Ct.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Nn.AUDIO}),new Fa(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:nc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(le.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let l=new js({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:rr.ACTIVE,tracks:[],joinedAt:at.parse(Date.now())});const c=this.getOrCreateParticipant(l.identity,l);if(o.video){const d=tg(160*((i=o.aspectRatios[a%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Zs({source:Ct.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Nn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}if(o.audio){const d=nc(),u=new Zs({source:Ct.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Nn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}c.updateInfo(l)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==X.ActiveSpeakersChanged&&e!==X.TranscriptionReceived){const o=Jb(i).filter(a=>a!==void 0);(e===X.TrackSubscribed||e===X.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}br.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Jb(t){return t.map(e=>{if(e)return Array.isArray(e)?Jb(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Pn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Pn||(Pn={}));class os extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Pn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new br(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return _(this,void 0,void 0,function*(){if(this.status!==Pn.IDLE)throw Error("check is running already");this.setStatus(Pn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Pn.SKIPPED&&this.setStatus(this.isSuccess()?Pn.SUCCESS:Pn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return _(this,void 0,void 0,function*(){return this.room.state===Be.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return _(this,void 0,void 0,function*(){this.room&&this.room.state!==Be.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Pn.SKIPPED)}switchProtocol(e){return _(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(X.Reconnecting,()=>{n=!0}),this.room.once(X.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Wt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class VM extends os{get description(){return"Cloud regions"}perform(){return _(this,void 0,void 0,function*(){const e=new Le(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const l=yield this.checkCloudRegion(a);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),n.push(l)}n.sort((o,a)=>(o.duration-a.duration)*.5+(o.rtt-a.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return _(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,c=1e6/a,d="A".repeat(a),u=Date.now();for(let x=0;x<c;x++)yield o.write(d);yield o.close();const h=Date.now(),p=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),m={region:r,rtt:1e4,duration:h-u};return p?.forEach(x=>{x.type==="candidate-pair"&&x.nominated&&(m.rtt=x.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const uc=1e4;class GM extends os{get description(){return"Connection via UDP vs TCP"}perform(){return _(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(uc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(uc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return _(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const l=n.captureStream(30).getVideoTracks()[0],d=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>_(this,void 0,void 0,function*(){const p=yield d.getRTCStatsReport();p?.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(p=>setTimeout(p,uc)),clearInterval(h),l.stop(),n.remove(),yield this.disconnect(),u})}}class HM extends os{get description(){return"Can publish audio"}perform(){return _(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield qb();if(yield Ib(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(l=>setTimeout(l,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let a=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(a=l.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class qM extends os{get description(){return"Can publish video"}perform(){return _(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield LM();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(o+=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return _(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,a,l,c;const d=document.createElement("canvas"),u=e.getSettings(),h=(a=(o=u.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&a!==void 0?a:1280,p=(c=(l=u.height)!==null&&l!==void 0?l:i.videoHeight)!==null&&c!==void 0?c:720;d.width=h,d.height=p;const m=d.getContext("2d");m.drawImage(i,0,0);const g=m.getImageData(0,0,d.width,d.height).data;let y=!0;for(let v=0;v<g.length;v+=4)if(g[v]!==0||g[v+1]!==0||g[v+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class KM extends os{get description(){return"Resuming connection after interruption"}perform(){return _(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const a=new Promise(d=>{setTimeout(d,5e3),o=d}),l=()=>{i=!0};n.on(X.SignalReconnecting,l).on(X.Reconnecting,l).on(X.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,i){if(!r||n.state!==Be.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class JM extends os{get description(){return"Can connect via TURN"}perform(){return _(this,void 0,void 0,function*(){var e,n,i;yr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Le(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new Ju,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let a=!1,l=!1,c=!1;for(let d of o.iceServers)for(let u of d.urls)u.startsWith("turn:")?(l=!0,c=!0):u.startsWith("turns:")&&(l=!0,c=!0,a=!0),u.startsWith("stun:")&&(c=!0);c?l&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(d=>setTimeout(d,0)))})}}class YM extends os{get description(){return"Establishing WebRTC connection"}perform(){return _(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(X.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,a)=>{if(o.candidate){const l=new RTCIceCandidate(o);let c="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(XM(l.address)?c+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,c+=" (passive)"):l.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(o,a)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),Ee.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function XM(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class ZM extends os{get description(){return"Connecting to signal connection via WebSocket"}perform(){return _(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Ju,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(a){if(yr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const c=yield new Le(this.url,this.token).getNextBestRegionUrl();c&&(o=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Py.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class CD extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Pn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Pn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return _(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=a=>{this.updateCheck(n,a)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(ZM)})}checkWebRTC(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(YM)})}checkTURN(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(JM)})}checkReconnect(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(KM)})}checkPublishAudio(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(HM)})}checkPublishVideo(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(qM)})}checkConnectionProtocol(){return _(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(GM);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return _(this,void 0,void 0,function*(){return this.createAndRunCheck(VM)})}}function Pe(t,e,n){return(e=eP(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function QM(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eP(t){var e=QM(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class sn extends Error{constructor(e,n){var i;super(e,n),Pe(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Pe(sn,"code","ERR_JOSE_GENERIC");class tP extends sn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Pe(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Pe(this,"claim",void 0),Pe(this,"reason",void 0),Pe(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Pe(tP,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class nP extends sn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Pe(this,"code","ERR_JWT_EXPIRED"),Pe(this,"claim",void 0),Pe(this,"reason",void 0),Pe(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Pe(nP,"code","ERR_JWT_EXPIRED");class iP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Pe(iP,"code","ERR_JOSE_ALG_NOT_ALLOWED");class sP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Pe(sP,"code","ERR_JOSE_NOT_SUPPORTED");class rP extends sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Pe(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Pe(rP,"code","ERR_JWE_DECRYPTION_FAILED");class oP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JWE_INVALID")}}Pe(oP,"code","ERR_JWE_INVALID");class aP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JWS_INVALID")}}Pe(aP,"code","ERR_JWS_INVALID");class lP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JWT_INVALID")}}Pe(lP,"code","ERR_JWT_INVALID");class cP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JWK_INVALID")}}Pe(cP,"code","ERR_JWK_INVALID");class dP extends sn{constructor(){super(...arguments),Pe(this,"code","ERR_JWKS_INVALID")}}Pe(dP,"code","ERR_JWKS_INVALID");class uP extends sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Pe(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Pe(uP,"code","ERR_JWKS_NO_MATCHING_KEY");class hP extends sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Pe(this,Symbol.asyncIterator,void 0),Pe(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Pe(hP,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class pP extends sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Pe(this,"code","ERR_JWKS_TIMEOUT")}}Pe(pP,"code","ERR_JWKS_TIMEOUT");class fP extends sn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Pe(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Pe(fP,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function bi(){return bi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},bi.apply(null,arguments)}const jg=new Uint8Array(0);class So{static getFullOptions(e){return bi({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(o){i.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i?.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return jg}getOutputByteFrequencyData(){return jg}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let Yb=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function $a(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const Xb="0.12.0";function Cd(t){return!!t.type}const Zb="conversation_initiation_client_data";function Qb(t){var e;const n={type:Zb};var i,r,o,a,l;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(a=t.overrides.tts)==null?void 0:a.voiceId},conversation:{text_only:(l=t.overrides.conversation)==null?void 0:l.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let wd=class ev extends Yb{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const a=JSON.parse(o.data);if(!Cd(a))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(a)}catch(a){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:a instanceof Error?a.message:String(a),data:o.data})}})}static async create(e){let n=null;try{var i,r,o;const l=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||Xb,u=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const k=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${k}source=${u}&version=${d}`}else c=`${l}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${d}`;const h=["convai"];e.authorization&&h.push(`bearer.${e.authorization}`),n=new WebSocket(c,h);const p=await new Promise((k,S)=>{n.addEventListener("open",()=>{var C;const b=Qb(e);(C=n)==null||C.send(JSON.stringify(b))},{once:!0}),n.addEventListener("error",C=>{setTimeout(()=>S(C),0)}),n.addEventListener("close",S),n.addEventListener("message",C=>{const b=JSON.parse(C.data);Cd(b)&&(b.type==="conversation_initiation_metadata"?k(b.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:m,agent_output_audio_format:x,user_input_audio_format:g}=p,y=$a(g??"pcm_16000"),v=$a(x);return new ev(n,m,y,v)}catch(l){var a;throw(a=n)==null||a.close(),l}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function tv(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function gP(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Jo=new Map;function nv(t,e){return async(n,i)=>{const r=Jo.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Jo.set(t,i)}catch(l){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${l}`)}const o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o);try{return await n.addModule(a),void Jo.set(t,a)}catch{URL.revokeObjectURL(a)}try{const l=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(l),Jo.set(t,l)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const iv=nv("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class fi extends Yb{constructor(e,n,i,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,o;const d=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||Xb,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",h=`${a=(o=e.origin)!=null?o:"https://api.elevenlabs.io",a.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${d}`,p=await fetch(h);if(!p.ok)throw new Error(`ElevenLabs API returned ${p.status} ${p.statusText}`);if(n=(await p.json()).token,!n)throw new Error("No conversation token received from API")}catch(d){let u=d instanceof Error?d.message:String(d);throw d instanceof Error&&d.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var a;const l=new br;try{const d=`room_${Date.now()}`,u=$a("pcm_48000"),h=$a("pcm_48000"),p=new fi(l,d,u,h,e),m=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await l.connect(m,n),await new Promise(g=>{if(p.isConnected)g();else{const y=()=>{l.off(X.Connected,y),g()};l.on(X.Connected,y)}}),l.name&&(p.conversationId=((c=l.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||l.name),await l.localParticipant.setMicrophoneEnabled(!0);const x=Qb(e);return p.debug({type:Zb,message:x}),await p.sendMessage(x),p}catch(d){throw await l.disconnect(),d}}setupRoomEventListeners(){var e=this;this.room.on(X.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(X.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(X.ConnectionStateChanged,n=>{n===Be.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(X.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;Cd(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(X.TrackSubscribed,async function(n,i,r){if(n.kind===K.Kind.Audio&&r.identity.includes("agent")){const o=n,a=o.attach();if(a.autoplay=!0,a.controls=!1,e.outputDeviceId&&a.setSinkId)try{await a.setSinkId(e.outputDeviceId)}catch(l){console.warn("Failed to set output device for new audio element:",l)}a.style.display="none",document.body.appendChild(a),e.audioElements.push(a),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(X.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(X.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(K.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await iv(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=a=>{const[l,c]=a.data;if(c>.01){const d=tv(l.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:d,event_id:u}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(K.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await qb(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:K.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function sv(t){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(t);switch(e){case"websocket":return wd.create(t);case"webrtc":return fi.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function jd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function rv(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(jd()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class ih extends So{static async startSession(e){const n=So.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await rv(n.connectionDelay),i=await sv(e),new ih(n,i)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),o}}}const Tg={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class hr{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:o,libsampleratePath:a}){let l=null,c=null;try{const h=bi({sampleRate:{ideal:e}},Tg);if(jd()&&i){const v=(await window.navigator.mediaDevices.enumerateDevices()).find(k=>k.kind==="audioinput"&&["airpod","headphone","earphone"].find(S=>k.label.toLowerCase().includes(S)));v&&(h.deviceId={ideal:v.deviceId})}r&&(h.deviceId=hr.getDeviceIdConstraint(r));const p=navigator.mediaDevices.getSupportedConstraints().sampleRate;l=new window.AudioContext(p?{sampleRate:e}:{});const m=l.createAnalyser();if(!p){const v=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await l.audioWorklet.addModule(v)}await iv(l.audioWorklet,o?.rawAudioProcessor);const x=bi({voiceIsolation:!0},h);c=await navigator.mediaDevices.getUserMedia({audio:x});const g=l.createMediaStreamSource(c),y=new AudioWorkletNode(l,"rawAudioProcessor");return y.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(m),m.connect(y),await l.resume(),new hr(l,m,y,c,g)}catch(h){var d,u;throw(d=c)==null||d.getTracks().forEach(p=>{p.stop()}),(u=l)==null||u.close(),h}}static getDeviceIdConstraint(e){if(e)return jd()?{ideal:e}:{exact:e}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=bi({},Tg);e&&(n.deviceId=hr.getDeviceIdConstraint(e));const i=bi({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(o=>{o.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const mP=nv("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class Va{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let o=null,a=null;try{o=new AudioContext({sampleRate:e});const d=o.createAnalyser(),u=o.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const h=o.createMediaStreamDestination();a.srcObject=h.stream,u.connect(d),d.connect(h),await mP(o.audioWorklet,r?.audioConcatProcessor);const p=new AudioWorkletNode(o,"audioConcatProcessor");return p.port.postMessage({type:"setFormat",format:n}),p.connect(u),await o.resume(),i&&a.setSinkId&&await a.setSinkId(i),new Va(o,d,u,p,a)}catch(d){var l,c;throw(l=a)!=null&&l.parentNode&&a.parentNode.removeChild(a),(c=a)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),d}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class sh extends So{static async startSession(e){var n;const i=So.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,a=null,l=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var d;return l=await navigator.mediaDevices.getUserMedia({audio:!0}),await rv(i.connectionDelay),o=await sv(e),[r,a]=await Promise.all([hr.create(bi({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Va.create(bi({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(d=l)==null||d.getTracks().forEach(g=>{g.stop()}),l=null,new sh(i,o,r,a,c)}catch(g){var u,h,p,m;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=l)==null||u.getTracks().forEach(y=>{y.stop()}),(h=o)==null||h.close(),await((p=r)==null?void 0:p.close()),await((m=a)==null?void 0:m.close());try{var x;await((x=c)==null?void 0:x.release()),c=null}catch{}throw g}}constructor(e,n,i,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:tv(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:gP(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=a=>{if(a.length===0)return 0;let l=0;for(let c=0;c<a.length;c++)l+=a[c]/255;return l/=a.length,l<0?0:l>1?1:l},this.setVolume=({volume:a})=>{const l=Number.isFinite(a)?Math.min(1,Math.max(0,a)):1;this.volume=l,this.connection instanceof fi?this.connection.setAudioVolume(l):this.output.gain.gain.value=l},this.input=i,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof fi||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof fi?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof fi?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof wd)try{return await this.input.setInputDevice(r),this.input}catch(a){console.warn("Failed to change device on existing input, recreating:",a)}this.connection instanceof fi&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await hr.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof wd)try{return await this.output.setOutputDevice(i),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof fi&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await Va.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var Eg;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(Eg||(Eg={}));var Rg,Ig;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Rg||(Rg={})),(function(t){t.MANUAL="manual",t.VAD="vad"})(Ig||(Ig={}));class xP extends So{static startSession(e){return e.textOnly?ih.startSession(e):sh.startSession(e)}}function Zr(){return Zr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Zr.apply(null,arguments)}const yP=["micMuted","volume","serverLocation"];function bP(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function vP(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function SP(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function kP(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=(function(g,y){if(g==null)return{};var v={};for(var k in g)if({}.hasOwnProperty.call(g,k)){if(y.indexOf(k)!==-1)continue;v[k]=g[k]}return v})(t,yP),o=f.useRef(null),a=f.useRef(null),[l,c]=f.useState("disconnected"),[d,u]=f.useState(!1),[h,p]=f.useState("listening"),m=f.useRef(e),x=f.useRef(n);return m.current=e,x.current=n,f.useEffect(()=>{var g;e!==void 0&&(o==null||(g=o.current)==null||g.setMicMuted(e))},[e]),f.useEffect(()=>{var g;n!==void 0&&(o==null||(g=o.current)==null||g.setVolume({volume:n}))},[n]),f.useEffect(()=>()=>{var g;(g=o.current)==null||g.endSession()},[]),{startSession:async g=>{var y;if((y=o.current)!=null&&y.isOpen())return o.current.getId();if(a.current)return(await a.current).getId();try{var v,k,S,C,b,j,w,T,I,E;const P=bP(g?.serverLocation||i),O=vP(P),B=SP(P);return a.current=xP.startSession(Zr({},r??{},g??{},{origin:O,livekitUrl:g?.livekitUrl||r?.livekitUrl||B,overrides:Zr({},(v=r?.overrides)!=null?v:{},(k=g?.overrides)!=null?k:{},{client:Zr({},(S=r==null||(C=r.overrides)==null?void 0:C.client)!=null?S:{},(b=g==null||(j=g.overrides)==null?void 0:j.client)!=null?b:{},{source:(g==null||(w=g.overrides)==null||(w=w.client)==null?void 0:w.source)||(r==null||(T=r.overrides)==null||(T=T.client)==null?void 0:T.source)||"react_sdk",version:(g==null||(I=g.overrides)==null||(I=I.client)==null?void 0:I.version)||(r==null||(E=r.overrides)==null||(E=E.client)==null?void 0:E.version)||"0.12.1"})}),onConnect:g?.onConnect||r?.onConnect,onDisconnect:g?.onDisconnect||r?.onDisconnect,onError:g?.onError||r?.onError,onMessage:g?.onMessage||r?.onMessage,onAudio:g?.onAudio||r?.onAudio,onDebug:g?.onDebug||r?.onDebug,onUnhandledClientToolCall:g?.onUnhandledClientToolCall||r?.onUnhandledClientToolCall,onVadScore:g?.onVadScore||r?.onVadScore,onInterruption:g?.onInterruption||r?.onInterruption,onAgentToolRequest:g?.onAgentToolRequest||r?.onAgentToolRequest,onAgentToolResponse:g?.onAgentToolResponse||r?.onAgentToolResponse,onConversationMetadata:g?.onConversationMetadata||r?.onConversationMetadata,onMCPToolCall:g?.onMCPToolCall||r?.onMCPToolCall,onMCPConnectionStatus:g?.onMCPConnectionStatus||r?.onMCPConnectionStatus,onAsrInitiationMetadata:g?.onAsrInitiationMetadata||r?.onAsrInitiationMetadata,onAgentChatResponsePart:g?.onAgentChatResponsePart||r?.onAgentChatResponsePart,onModeChange:({mode:N})=>{var M;p(N),(M=g?.onModeChange||r?.onModeChange)==null||M({mode:N})},onStatusChange:({status:N})=>{var M;c(N),(M=g?.onStatusChange||r?.onStatusChange)==null||M({status:N})},onCanSendFeedbackChange:({canSendFeedback:N})=>{var M;u(N),(M=g?.onCanSendFeedbackChange||r?.onCanSendFeedbackChange)==null||M({canSendFeedback:N})}})),o.current=await a.current,m.current!==void 0&&o.current.setMicMuted(m.current),x.current!==void 0&&o.current.setVolume({volume:x.current}),o.current.getId()}finally{a.current=null}},endSession:async()=>{const g=o.current;o.current=null,await g?.endSession()},setVolume:({volume:g})=>{var y;(y=o.current)==null||y.setVolume({volume:g})},getInputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var g;return(g=o.current)==null?void 0:g.getOutputByteFrequencyData()},getInputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getInputVolume())!=null?g:0},getOutputVolume:()=>{var g,y;return(g=(y=o.current)==null?void 0:y.getOutputVolume())!=null?g:0},sendFeedback:g=>{var y;(y=o.current)==null||y.sendFeedback(g)},getId:()=>{var g;return(g=o.current)==null?void 0:g.getId()},sendContextualUpdate:g=>{var y;(y=o.current)==null||y.sendContextualUpdate(g)},sendUserMessage:g=>{var y;(y=o.current)==null||y.sendUserMessage(g)},sendUserActivity:()=>{var g;(g=o.current)==null||g.sendUserActivity()},sendMCPToolApprovalResult:(g,y)=>{var v;(v=o.current)==null||v.sendMCPToolApprovalResult(g,y)},changeInputDevice:async g=>{if(o.current&&"changeInputDevice"in o.current)return await o.current.changeInputDevice(g);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async g=>{if(o.current&&"changeOutputDevice"in o.current)return await o.current.changeOutputDevice(g);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:d,micMuted:e,isSpeaking:h==="speaking"}}const CP=({onMessage:t,onConnect:e,onDisconnect:n,onError:i})=>{const r=f.useRef(null),o=f.useRef(null),a=f.useRef(0),l=f.useRef(0),c=kP({onConnect:()=>{const g=Date.now();o.current=g,e?.()},onDisconnect:()=>{n?.()},onMessage:g=>{if(g.source==="ai"||g.source==="user"){const y=o.current,v=Date.now(),k=y?Math.floor((v-y)/1e3):0;let S;g.source==="ai"?(S=a.current,a.current=k,l.current=k):(S=l.current,a.current=k);const C=Math.floor(S/60),b=S%60,j=`${C.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`,w={role:g.source==="ai"?"agent":"user",text:g.message,timestamp:v,elapsedTime:S,timeLabel:j};t?.(w)}},onError:g=>{console.error(" [SDKAdapter] Error:",g),i?.(new Error(g.message||"Ein Fehler ist aufgetreten."))}}),d=f.useCallback(async g=>{const{agentId:y,scenario:v,variables:k,microphoneId:S}=g;o.current=null,a.current=0,l.current=0;const C=ry(k,v),b={agentId:y,connectionType:"websocket",dynamicVariables:C,...S&&{inputDeviceId:S},overrides:{agent:{prompt:{prompt:JR(v)},firstMessage:v?.initial_message||"Hallo! Ich freue mich auf unser Gesprch."},...v?.voice_id&&{tts:{voiceId:v.voice_id}}}};return v?.voice_id&&console.log("[SDKAdapter] Using voice override:",v.voice_id),r.current=await c.startSession(b),r.current},[c]),u=f.useCallback(()=>{c.status==="connected"&&c.endSession()},[c]),h=f.useCallback(()=>c.status,[c.status]),p=f.useCallback(()=>c.isSpeaking,[c.isSpeaking]),m=f.useCallback(()=>r.current,[]),x=f.useCallback(()=>o.current,[]);return{connect:d,disconnect:u,getStatus:h,isSpeaking:p,getConversationId:m,getStartTime:x,status:c.status,speaking:c.isSpeaking}},wP=({onMessage:t,onConnect:e,onDisconnect:n,onError:i})=>{const[r,o]=f.useState("disconnected"),[a,l]=f.useState(!1),c=f.useRef(null),d=f.useRef(null),u=f.useRef(null),h=f.useRef(null),p=f.useRef(null),m=f.useRef([]),x=f.useRef(!1),g=f.useRef(0),y=f.useRef(null),v=f.useRef(null),k=f.useRef(!1);f.useEffect(()=>()=>{E()},[]);const S=f.useCallback(async(F,$)=>{try{const D=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});u.current=D;const z=D.createMediaStreamSource(F),L=D.createScriptProcessor(4096,1,1);p.current=L,L.onaudioprocess=ee=>{if($.readyState!==WebSocket.OPEN||k.current)return;const se=ee.inputBuffer.getChannelData(0),G=new Int16Array(se.length);for(let W=0;W<se.length;W++){const H=Math.max(-1,Math.min(1,se[W]));G[W]=H<0?H*32768:H*32767}const q=new Uint8Array(G.buffer);let ie="";for(let W=0;W<q.length;W++)ie+=String.fromCharCode(q[W]);const A=btoa(ie);$.send(JSON.stringify({user_audio_chunk:A}))},z.connect(L),L.connect(D.destination)}catch(D){console.error("[ProxyAdapter] Failed to start audio capture:",D)}},[]),C=f.useCallback(F=>{m.current.push(F),x.current||b()},[]),b=f.useCallback(async()=>{if(m.current.length===0){x.current=!1;return}x.current=!0;const F=m.current.shift();try{(!h.current||h.current.state==="closed")&&(h.current=new(window.AudioContext||window.webkitAudioContext),g.current=0);const D=h.current;D.state==="suspended"&&await D.resume();const z=new Int16Array(F),L=new Float32Array(z.length);for(let ie=0;ie<z.length;ie++)L[ie]=z[ie]/32768;const ee=D.createBuffer(1,L.length,16e3);ee.getChannelData(0).set(L);const se=D.createBufferSource();se.buffer=ee,se.connect(D.destination);const G=D.currentTime,q=Math.max(G,g.current);se.start(q),g.current=q+ee.duration,se.onended=()=>{b()}}catch($){console.error("[ProxyAdapter] Audio playback error:",$),b()}},[]),j=f.useCallback((F,$,D)=>{if(F.data instanceof ArrayBuffer){C(F.data);return}try{const z=JSON.parse(F.data);switch(z.type){case"conversation_initiation_metadata":z.conversation_initiation_metadata_event?.conversation_id&&(y.current=z.conversation_initiation_metadata_event.conversation_id);const ee={type:"conversation_initiation_client_data",dynamic_variables:ry(D,$),conversation_config_override:{agent:{prompt:{prompt:Br($?.content||"")},first_message:$?.initial_message||"Hallo! Ich freue mich auf unser Gesprch."},...$?.voice_id&&{tts:{voice_id:$.voice_id}}}};if(console.log("[ProxyAdapter] Scenario:",$),console.log("[ProxyAdapter] voice_id:",$?.voice_id),console.log("[ProxyAdapter] initMessage:",JSON.stringify(ee,null,2)),$?.voice_id?console.log("[ProxyAdapter] Using voice override:",$.voice_id):console.log("[ProxyAdapter] No voice_id in scenario"),c.current?.readyState===WebSocket.OPEN){c.current.send(JSON.stringify(ee));const se=Date.now();v.current=se,o("connected"),e?.(),d.current&&S(d.current,c.current)}break;case"audio":if(z.audio_event?.audio_base_64){const se=atob(z.audio_event.audio_base_64),G=new Uint8Array(se.length);for(let q=0;q<se.length;q++)G[q]=se.charCodeAt(q);C(G.buffer)}break;case"agent_response":if(z.agent_response_event?.agent_response){const se=w("agent",z.agent_response_event.agent_response);t?.(se)}break;case"user_transcript":if(z.user_transcription_event?.user_transcript){const se=w("user",z.user_transcription_event.user_transcript);t?.(se)}break;case"interruption":m.current=[];break;case"ping":c.current?.readyState===WebSocket.OPEN&&c.current.send(JSON.stringify({type:"pong",event_id:z.ping_event?.event_id}));break;case"internal_vad_score":case"internal_turn_probability":case"internal_tentative_agent_response":break;case"error":console.error("[ProxyAdapter] Server error:",z),i?.(new Error(z.message||z.error_message||"Server-Fehler"));break;default:break}}catch(z){console.error("[ProxyAdapter] Message parse error:",z)}},[e,t,i,C,S]),w=f.useCallback((F,$)=>{if(!$||$.trim()==="")return null;const D=Date.now(),z=v.current?Math.floor((D-v.current)/1e3):0;return{role:F,text:$,timestamp:D,elapsedTime:z,timeLabel:pt(z)}},[]),T=f.useCallback(async F=>{const{agentId:$,scenario:D,variables:z,microphoneId:L}=F;o("connecting");try{const ee=await navigator.mediaDevices.getUserMedia({audio:{deviceId:L?{exact:L}:void 0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});d.current=ee;const se=`${KR}?agent_id=${$}`,G=new WebSocket(se);return c.current=G,G.binaryType="arraybuffer",G.onopen=()=>{},G.onmessage=q=>{j(q,D,z)},G.onclose=()=>{o("disconnected"),n?.()},G.onerror=q=>{console.error("[ProxyAdapter] WebSocket error:",q),i?.(new Error("Verbindung zum Proxy fehlgeschlagen")),o("disconnected")},new Promise((q,ie)=>{const A=setTimeout(()=>{ie(new Error("Connection timeout"))},3e4),W=setInterval(()=>{y.current&&(clearTimeout(A),clearInterval(W),q(y.current))},100)})}catch(ee){throw console.error("[ProxyAdapter] Start failed:",ee),o("disconnected"),ee}},[j,n,i]),I=f.useCallback(()=>{E()},[]),E=f.useCallback(()=>{c.current&&(c.current.close(),c.current=null),p.current&&(p.current.disconnect(),p.current=null),u.current&&u.current.state!=="closed"&&(u.current.close().catch(()=>{}),u.current=null),h.current&&h.current.state!=="closed"&&(h.current.close().catch(()=>{}),h.current=null),d.current&&(d.current.getTracks().forEach(F=>F.stop()),d.current=null),m.current=[],x.current=!1,g.current=0,y.current=null,o("disconnected")},[]),P=f.useCallback(()=>r,[r]),O=f.useCallback(F=>{l(F),k.current=F,d.current&&d.current.getAudioTracks().forEach($=>{$.enabled=!F})},[]),B=f.useCallback(()=>x.current||m.current.length>0,[]),N=f.useCallback(()=>y.current,[]),M=f.useCallback(()=>v.current,[]);return{connect:T,disconnect:I,getStatus:P,isSpeaking:B,setMuted:O,getConversationId:N,getStartTime:M,status:r,speaking:x.current,muted:a}};function jP({userRole:t="Bewerber",agentRole:e="Interviewer",agentProperties:n="",agentPainPoints:i="",transcriptHistory:r=[],nextAgentInput:o=""}){const a=r.slice(-4).map(l=>`${l.role==="agent"?e:t}: ${l.text}`).join(`
`);return`# SYSTEM ROLLE
Du bist die "Live-Coaching-Engine" der Karriereplattform "KarriereHeld".
Deine Aufgabe ist es, Echtzeit-Coaching whrend eines Gesprchs mit einem KI-Agenten zu liefern.

# INPUT DATEN

## Rolle des Users
${t}

## Rolle der KI (Gesprchspartner)
${e}

## Eigenschaften des KI-Agenten
${n||"Keine spezifischen Eigenschaften definiert"}

## Typische Einwnde/Pain Points des Agenten
${i||"Keine spezifischen Pain Points definiert"}

## Transkript-Historie (letzte Wechsel)
${a||"[Gesprch hat gerade begonnen]"}

## Nchste Aussage des Agenten (Vorschau)
"${o}"

# DEINE AUFGABE
Analysiere die nchste Aussage des Agenten und generiere sofort Coaching-Impulse fr den User.

# LOGIK & STRATEGIE
1. **Inhaltliche Brcke:** Was sollte der User inhaltlich antworten? Welche konkreten Punkte oder Beispiele sollte er/sie einbringen?

2. **Einwand-Vorwegnahme:** Prfe die Pain Points des Agenten. Wenn die Frage auch nur entfernt damit zu tun hat, gib dem User einen Tipp, wie er/sie diesen Einwand proaktiv entkrften kann.

3. **Verhalten (Soft Skills):** Gib einen Hinweis zum Tonfall und Auftreten, basierend auf den Eigenschaften des Agenten:
   - Bei "netter Typ"  offen, freundlich, persnlich
   - Bei "streng"  przise, faktenbasiert, strukturiert
   - Bei "kritisch"  selbstbewusst, konkrete Belege liefern

# OUTPUT REGELN
- Antworte AUSSCHLIESSLICH im JSON-Format
- Fasse dich extrem kurz (max. 3-4 Wrter pro Stichpunkt)
- KEINE ganzen Stze zum Vorlesen
- Sprache der Ausgabe: Deutsch
- Maximal 3 content_impulses

# JSON STRUKTUR (strikt einhalten!)
{
  "content_impulses": ["Stichpunkt 1", "Stichpunkt 2", "Stichpunkt 3"],
  "behavioral_cue": "Kurzer Tonfall-Hinweis",
  "strategic_bridge": "Strategischer Tipp zu Pain Points"
}

Antworte NUR mit dem JSON, keine Erklrungen davor oder danach.`}const TP=["gemini-2.0-flash-exp","gemini-2.0-flash","gemini-1.5-flash-latest"],ka={content_impulses:[],behavioral_cue:"",strategic_bridge:""};function EP(t){let e=t.trim();e.startsWith("```json")?e=e.replace(/```json\n?/,"").replace(/\n?```$/,""):e.startsWith("```")&&(e=e.replace(/```\n?/,"").replace(/\n?```$/,""));try{const n=JSON.parse(e);return{content_impulses:Array.isArray(n.content_impulses)?n.content_impulses.slice(0,3):[],behavioral_cue:typeof n.behavioral_cue=="string"?n.behavioral_cue:"",strategic_bridge:typeof n.strategic_bridge=="string"?n.strategic_bridge:""}}catch(n){return console.error("[COACHING] Failed to parse response:",n),console.error("[COACHING] Raw response:",t),ka}}function RP(t){return t.message?.includes("404")||t.message?.includes("not found")}async function IP({apiKey:t,nextAgentInput:e,transcriptHistory:n=[],scenarioContext:i={}}){const r="[COACHING]";if(!t)return console.error(`${r} API key is missing`),ka;if(!e||e.trim().length===0)return ka;const o=jP({userRole:i.userRole||"Bewerber",agentRole:i.agentRole||"Interviewer",agentProperties:i.agentProperties||"",agentPainPoints:i.agentPainPoints||"",transcriptHistory:n,nextAgentInput:e});for(const a of TP)try{const h=(await(await new Zx(t).getGenerativeModel({model:a}).generateContent(o)).response).text();return EP(h)}catch(l){if(console.error(`${r} Error with ${a}:`,l.message),RP(l))continue;break}return console.error(`${r} All models failed, returning default coaching`),ka}function AP(t){if(t.role!=="agent"||t.text.length<20)return!1;const e=["mhm","ja","okay","verstehe","interessant","gut"],n=t.text.toLowerCase().trim();return!e.some(i=>n===i)}function _P(t){const e=t.interviewer_profile||{};return{userRole:t.user_role_label||"Bewerber",agentRole:e.role||"Interviewer",agentProperties:e.properties||"",agentPainPoints:Array.isArray(e.typical_objections)?e.typical_objections.join(`
`):e.typical_objections||""}}const MP=({scenario:t,variables:e={},microphoneId:n,connectionMode:i=Hn.DIRECT,onNavigateToSession:r,onEnd:o})=>{const{demoCode:a}=Ue(),[l,c]=f.useState(null),[d,u]=f.useState([]),[h,p]=f.useState(null),[m,x]=f.useState(!1),[g,y]=f.useState(!1),[v,k]=f.useState(null),[S,C]=f.useState(null),[b,j]=f.useState(0),[w,T]=f.useState(null),[I,E]=f.useState(!1),P=f.useRef([]),O=f.useRef(0),B=f.useRef(null),N=f.useCallback(A=>{A&&(u(W=>{const H=[...W,A];return P.current=H,H}),A.role==="agent"&&setTimeout(()=>{se(A.text,P.current)},100))},[]),M=f.useCallback(()=>{const A=Date.now();C(A),B.current=A},[]),F=f.useCallback(()=>{},[]),$=f.useCallback(A=>{console.error("[useRoleplaySession] Error:",A),p(A.message||"Ein Fehler ist aufgetreten.")},[]),D=CP({onMessage:N,onConnect:M,onDisconnect:F,onError:$}),z=wP({onMessage:N,onConnect:M,onDisconnect:F,onError:$}),L=i===Hn.PROXY?z:D,ee=f.useMemo(()=>t?.agent_id||ue.getElevenLabsAgentId(),[t?.agent_id]);f.useEffect(()=>{let A=null;return L.status==="connected"&&S&&(A=setInterval(()=>{const W=Math.floor((Date.now()-S)/1e3);j(W),O.current=W},1e3)),()=>{A&&clearInterval(A)}},[L.status,S]);const se=f.useCallback(async(A,W)=>{const H=ue.getGeminiApiKey();if(!H){console.warn("[COACHING] No Gemini API key available");return}if(AP({role:"agent",text:A}))try{E(!0),T(null);const oe=await IP({apiKey:H,nextAgentInput:A,transcriptHistory:W.slice(-4),scenarioContext:_P(t)});T(oe)}catch(oe){console.error("[COACHING] Failed to generate coaching:",oe)}finally{E(!1)}},[t]),G=f.useCallback(async()=>{try{x(!0),p(null);const A=ue.getCurrentUser(),W={agent_id:ee,scenario_id:t?.id>0?t.id:null,variables:e,user_name:A?.firstName||"Gast",demo_code:a||null,connection_mode:i},H=await QT(W);c(H.id);const oe=await L.connect({agentId:ee,scenario:t,variables:e,microphoneId:n,demoCode:a});console.log(`[useRoleplaySession] Connected via ${i}, conversation ID:`,oe),i===Hn.DIRECT&&ue.logPrompt("ELEVENLABS_LIVE_SESSION",`Live-Training gestartet: ${t?.title}`,t?.content||"",{scenario_id:t?.id,scenario_title:t?.title,agent_id:ee,voice_id:t?.voice_id,conversation_id:oe,connection_mode:i})}catch(A){console.error("[useRoleplaySession] Failed to start:",A),p(A.message||"Verbindung fehlgeschlagen."),x(!1)}},[ee,t,e,n,a,i,L]),q=f.useCallback(async()=>{const A=L.getConversationId();L.disconnect();const W=B.current?Math.floor((Date.now()-B.current)/1e3):O.current;if(!l){console.error("[useRoleplaySession] No session ID"),o?.();return}if(P.current.length===0){p("Das Gesprch war zu kurz. Bitte versuche es erneut.");return}const H=async(oe,Se=500)=>{const $e=Date.now();k(oe),await new Promise(Ce=>setTimeout(Ce,Math.max(0,Se-(Date.now()-$e))))};try{y(!0),await H("audio",800);const oe={title:t?.title||"Live-Simulation",description:t?.description||"",variables:e,role_type:t?.role_type||"interview",user_role_label:t?.user_role_label||"Bewerber",interviewer_profile:t?.interviewer_profile,feedback_prompt:t?.feedback_prompt};let Se=null;if(l&&A)try{if(await ZT(l,A),i===Hn.DIRECT)Se=await XT(l,10,3e3);else{const rt=(await ue.saveAudioFromElevenLabs(A,l))?.data?.url;if(rt)try{const me=await fetch(rt);me.ok&&(Se=await me.blob())}catch(me){console.warn("[useRoleplaySession] Failed to fetch audio blob:",me.message)}}}catch(Ce){console.warn("[useRoleplaySession] Could not fetch audio:",Ce.message)}await H("transcript",500);const $e=await qT(P.current,oe,Se,k);if(await H("saving",500),l&&A&&await JT(l,P.current,$e.feedbackContent,$e.audioAnalysisContent,W,A),y(!1),k(null),r&&l){const Ce={id:l,scenario_id:t?.id,transcript:JSON.stringify(P.current),feedback_json:$e.feedbackContent,audio_analysis_json:$e.audioAnalysisContent,duration:W,conversation_id:A,created_at:new Date().toISOString()};r(Ce)}}catch(oe){console.error("[useRoleplaySession] Analysis failed:",oe),p(oe.message||"Fehler bei der Analyse."),y(!1),k(null)}},[L,l,t,e,i,r]),ie=f.useCallback(A=>{i===Hn.PROXY&&z.setMuted(A)},[i,z]);return{sessionId:l,transcript:d,error:h,isStarted:m,isAnalyzing:g,analysisStep:v,startTime:S,duration:b,dynamicCoaching:w,isCoachingGenerating:I,connectionMode:i,status:L.status,isSpeaking:L.speaking||!1,startSession:G,endSession:q,setMuted:ie,clearError:()=>p(null)}},PP=({profile:t,replaceVariables:e=n=>n})=>{const[n,i]=f.useState({properties:!0,objections:!1,questions:!1}),r=Ve(),o=m=>{i(x=>({...x,[m]:!x[m]}))};if(!t||!t.name)return null;const a=m=>m?e(m).split(/\n|,/).map(g=>g.trim()).filter(Boolean):[],l=a(t.properties),c=a(t.typical_objections),d=a(t.important_questions),u={width:"100%",padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:R.slate[50],border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:`background-color ${r.transition.normal}`},h={...u,backgroundColor:r.primaryAccentLight},p={padding:r.space[4],backgroundColor:"white"};return s.jsxs("div",{style:{padding:r.space[4],display:"flex",flexDirection:"column",gap:r.space[2]},children:[l.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("properties"),style:n.properties?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.properties?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Eigenschaften"}),n.properties?s.jsx(Yn,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(ct,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.properties&&s.jsx("div",{style:p,children:s.jsx("p",{style:{fontSize:r.fontSize.sm,color:R.slate[600],lineHeight:1.6,margin:0},children:l.join(", ")})})]}),c.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("objections"),style:n.objections?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.objections?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Typische Einwnde"}),n.objections?s.jsx(Yn,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(ct,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.objections&&s.jsx("div",{style:p,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:c.map((m,x)=>s.jsxs("li",{style:{fontSize:r.fontSize.sm,color:R.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:r.space[2]},children:""}),s.jsx("span",{children:m})]},x))})})]}),d.length>0&&s.jsxs("div",{style:{border:`1px solid ${R.slate[200]}`,borderRadius:r.radius.lg,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o("questions"),style:n.questions?h:u,onMouseEnter:m=>m.currentTarget.style.backgroundColor=R.slate[100],onMouseLeave:m=>m.currentTarget.style.backgroundColor=n.questions?r.primaryAccentLight:R.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:R.slate[700]},children:"Wichtige Fragen"}),n.questions?s.jsx(Yn,{style:{width:"20px",height:"20px",color:R.slate[500]}}):s.jsx(ct,{style:{width:"20px",height:"20px",color:R.slate[500]}})]}),n.questions&&s.jsx("div",{style:p,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:r.space[2]},children:d.map((m,x)=>s.jsxs("li",{style:{fontSize:r.fontSize.sm,color:R.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:r.space[2]},children:""}),s.jsx("span",{children:m})]},x))})})]}),s.jsx("div",{style:{marginTop:r.space[4],padding:r.space[3],backgroundColor:r.primaryAccentLight,borderRadius:r.radius.lg,border:`1px solid ${r.primaryAccent}33`},children:s.jsx("p",{style:{fontSize:r.fontSize.xs,color:r.primaryAccent,textAlign:"center",margin:0},children:" Fr ein optimales Erlebnis empfiehlt sich die Nutzung von Kopfhrern mit Mikrofon."})})]})},NP=({hints:t,dynamicCoaching:e=null,isGenerating:n=!1,isConnected:i=!1})=>{const{branding:r}=Ue(),o=r?.["--header-gradient"]||Ie["--header-gradient"],a=r?.["--header-text"]||Ie["--header-text"],l=r?.["--icon-primary"]||Ie["--icon-primary"],c=r?.["--primary-accent-light"]||Ie["--primary-accent-light"],u=(m=>m?m.split(/\n/).map(x=>x.trim()).filter(Boolean):[])(t),h=e&&(e.content_impulses&&e.content_impulses.length>0||e.behavioral_cue||e.strategic_bridge),p=i&&(h||n);return s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden h-full flex flex-col min-h-0",children:[s.jsxs("div",{style:{background:o},className:"px-4 py-3 flex items-center gap-2 flex-shrink-0",children:[s.jsx(Ne,{className:"w-5 h-5",style:{color:a}}),s.jsx("h3",{className:"font-bold text-sm",style:{color:a},children:"Live Coaching"}),n&&s.jsx(he,{className:"w-4 h-4 animate-spin ml-auto",style:{color:a}})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0",children:s.jsx(De,{mode:"wait",children:p?s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"space-y-4",children:n&&!h?s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(he,{className:"w-8 h-8 mx-auto mb-2 animate-spin"}),s.jsx("p",{className:"text-xs",children:"Analysiere..."})]})}):s.jsxs(s.Fragment,{children:[e?.content_impulses?.length>0&&s.jsxs(V.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-500 uppercase tracking-wide",children:[s.jsx(Ye,{className:"w-3.5 h-3.5"}),"Inhalt"]}),s.jsx("div",{className:"space-y-2",children:e.content_impulses.map((m,x)=>s.jsxs(V.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1+x*.05},className:"flex gap-2 items-start",children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:s.jsx("span",{className:"text-xs font-bold",style:{color:l},children:x+1})}),s.jsx("p",{className:"text-sm text-slate-700 leading-snug font-medium",children:m})]},x))})]}),e?.behavioral_cue&&s.jsxs(V.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.25},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-amber-600 uppercase tracking-wide",children:[s.jsx(rl,{className:"w-3.5 h-3.5"}),"Tonfall"]}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-amber-800",children:e.behavioral_cue})})]}),e?.strategic_bridge&&s.jsxs(V.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.35},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-emerald-600 uppercase tracking-wide",children:[s.jsx(et,{className:"w-3.5 h-3.5"}),"Strategie"]}),s.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2",children:s.jsx("p",{className:"text-sm text-emerald-800",children:e.strategic_bridge})})]}),!h&&!n&&s.jsx("div",{className:"h-full flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(Ne,{className:"w-10 h-10 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-xs",children:"Warte auf Gesprchspartner..."})]})})]})},"dynamic-coaching"):s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:u.length===0?s.jsx("div",{className:"h-full flex items-center justify-center py-8",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(Ne,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]})}):s.jsx("div",{className:"space-y-3",children:u.map((m,x)=>s.jsxs(V.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:x*.1},className:"flex gap-3 items-start",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:c},children:s.jsx(Ne,{className:"w-3.5 h-3.5",style:{color:l}})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:m})})]},x))})},"static-hints")})}),s.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-200 flex-shrink-0",children:s.jsx("p",{className:"text-xs text-slate-500 text-center",children:p?" Echtzeit-Coaching basierend auf dem Gesprch":" Hilfreiche Tipps fr ein erfolgreiches Gesprch"})})]})},rh=({isOpen:t,onClose:e,mode:n="audio",selectedMicrophoneId:i,onMicrophoneChange:r,selectedCameraId:o,onCameraChange:a})=>{const[l,c]=f.useState([]),[d,u]=f.useState([]),[h,p]=f.useState(!0),[m,x]=f.useState(null),[g,y]=f.useState(i),[v,k]=f.useState(o),S=Ve();f.useEffect(()=>{t&&(C(),y(i),k(o))},[t,i,o]);const C=async()=>{p(!0),x(null);try{const w=n==="audio-video"?{audio:!0,video:!0}:{audio:!0};(await navigator.mediaDevices.getUserMedia(w)).getTracks().forEach(O=>O.stop());const I=await navigator.mediaDevices.enumerateDevices(),E=I.filter(O=>O.kind==="audioinput"),P=I.filter(O=>O.kind==="videoinput");c(E),n==="audio-video"&&u(P)}catch(w){console.error("Error loading devices:",w),w.name==="NotAllowedError"||w.name==="PermissionDeniedError"?x("Zugriff auf Gerte verweigert"):x("Fehler beim Laden der Gerte")}finally{p(!1)}},b=()=>{g!==i&&r?.(g),n==="audio-video"&&v!==o&&a?.(v),e()},j=(w,T,I)=>{if(w.label){let E=w.label;return E=E.replace(/^Default - /,""),E=E.replace(/^Kommunikation - /,""),E=E.replace(/^Standard - /,""),E.length>40&&(E=E.substring(0,37)+"..."),E}return I==="audio"?`Mikrofon ${T+1}`:`Kamera ${T+1}`};return t?s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3}}),s.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",borderRadius:S.radius.xl,width:"90%",maxWidth:"480px",maxHeight:"80vh",overflow:"hidden",boxShadow:S.shadow.xl,zIndex:1001},onClick:w=>w.stopPropagation(),children:[s.jsxs("div",{style:{background:S.headerGradient,padding:`${S.space[4]} ${S.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:S.space["2.5"],color:"white"},children:[s.jsx(ii,{size:20}),s.jsx("h3",{style:{margin:0,fontSize:S.fontSize.base,fontWeight:600},children:"Gerte-Einstellungen"})]}),s.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:S.radius.md,padding:S.space["1.5"],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ot,{size:18,color:"white"})})]}),s.jsx("div",{style:{padding:S.space[5],maxHeight:"calc(80vh - 140px)",overflowY:"auto"},children:h?s.jsxs("div",{style:{textAlign:"center",padding:S.space[8]},children:[s.jsx("div",{style:{width:"40px",height:"40px",border:`3px solid ${R.slate[200]}`,borderTopColor:S.primaryAccent,borderRadius:"50%",animation:"spin 1s linear infinite",margin:`0 auto ${S.space[3]}`}}),s.jsx("p",{style:{color:R.slate[500],fontSize:S.fontSize.sm},children:"Gerte werden geladen..."}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):m?s.jsxs("div",{style:{textAlign:"center",padding:S.space[6]},children:[s.jsx(ke,{size:40,color:R.red[500],style:{marginBottom:S.space[3]}}),s.jsx("p",{style:{color:R.red[600],fontWeight:500},children:m}),s.jsxs("button",{onClick:C,style:{marginTop:S.space[4],display:"inline-flex",alignItems:"center",gap:S.space[2],padding:`${S.space["2.5"]} ${S.space[4]}`,borderRadius:S.radius.md,border:`1px solid ${R.slate[300]}`,background:"white",cursor:"pointer",fontSize:S.fontSize.sm,color:R.slate[700]},children:[s.jsx(zt,{size:16}),"Erneut versuchen"]})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:S.space[5]},children:[s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:S.space[2],fontSize:S.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:S.space["2.5"]},children:[s.jsx(Fe,{size:18,color:S.primaryAccent}),"Mikrofon"]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:S.space["1.5"]},children:l.map((w,T)=>s.jsxs("button",{onClick:()=>y(w.deviceId),style:{display:"flex",alignItems:"center",gap:S.space[3],padding:`${S.space[3]} ${S.space["3.5"]}`,borderRadius:S.radius.md,border:g===w.deviceId?`2px solid ${S.primaryAccent}`:`1px solid ${R.slate[200]}`,background:g===w.deviceId?`${S.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:S.transition.normal},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:S.radius.md,background:g===w.deviceId?S.primaryAccent:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Fe,{size:16,color:g===w.deviceId?"white":R.slate[500]})}),s.jsx("span",{style:{flex:1,fontSize:S.fontSize.sm,color:g===w.deviceId?S.primaryAccent:R.slate[700],fontWeight:g===w.deviceId?500:400},children:j(w,T,"audio")}),g===w.deviceId&&s.jsx(wn,{size:18,color:S.primaryAccent})]},w.deviceId||T))}),g&&s.jsx("div",{style:{marginTop:S.space[3]},children:s.jsx(DR,{deviceId:g,branding:S})})]}),n==="audio-video"&&d.length>0&&s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:S.space[2],fontSize:S.fontSize.sm,fontWeight:600,color:R.slate[700],marginBottom:S.space["2.5"]},children:[s.jsx(bt,{size:18,color:S.primaryAccent}),"Kamera"]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:S.space["1.5"]},children:d.map((w,T)=>s.jsxs("button",{onClick:()=>k(w.deviceId),style:{display:"flex",alignItems:"center",gap:S.space[3],padding:`${S.space[3]} ${S.space["3.5"]}`,borderRadius:S.radius.md,border:v===w.deviceId?`2px solid ${S.primaryAccent}`:`1px solid ${R.slate[200]}`,background:v===w.deviceId?`${S.primaryAccent}10`:"white",cursor:"pointer",textAlign:"left",width:"100%",transition:S.transition.normal},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:S.radius.md,background:v===w.deviceId?S.primaryAccent:R.slate[100],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(bt,{size:16,color:v===w.deviceId?"white":R.slate[500]})}),s.jsx("span",{style:{flex:1,fontSize:S.fontSize.sm,color:v===w.deviceId?S.primaryAccent:R.slate[700],fontWeight:v===w.deviceId?500:400},children:j(w,T,"video")}),v===w.deviceId&&s.jsx(wn,{size:18,color:S.primaryAccent})]},w.deviceId||T))})]})]})}),!h&&!m&&s.jsxs("div",{style:{padding:`${S.space[4]} ${S.space[5]}`,borderTop:`1px solid ${R.slate[200]}`,display:"flex",gap:S.space[3],justifyContent:"flex-end"},children:[s.jsx("button",{onClick:e,style:{padding:`${S.space["2.5"]} ${S.space[5]}`,borderRadius:S.radius.md,border:`1px solid ${R.slate[300]}`,background:"white",color:R.slate[600],fontSize:S.fontSize.sm,fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:b,style:{padding:`${S.space["2.5"]} ${S.space[5]}`,borderRadius:S.radius.md,border:"none",background:S.primaryAccent,color:"white",fontSize:S.fontSize.sm,fontWeight:600,cursor:"pointer"},children:"Speichern"})]})]})]}):null},Ag=({scenario:t,variables:e={},selectedMicrophoneId:n,connectionMode:i=Hn.DIRECT,onEnd:r,onNavigateToSession:o})=>{const{branding:a}=Ue(),{transcript:l,error:c,isStarted:d,isAnalyzing:u,analysisStep:h,duration:p,dynamicCoaching:m,isCoachingGenerating:x,status:g,startSession:y,endSession:v,setMuted:k,clearError:S}=MP({scenario:t,variables:e,microphoneId:n,connectionMode:i,onNavigateToSession:o,onEnd:r}),[C,b]=f.useState(!1),[j,w]=f.useState(!1),[T,I]=f.useState(n),[E,P]=f.useState(!1),[O,B]=f.useState(!1),[N,M]=f.useState(!1),[F,$]=f.useState(!0),D=Un(1024),[z,L]=f.useState(0),ee=f.useRef(null),se=f.useRef(null),G=f.useRef(null),q=f.useRef(null),ie=f.useRef(null),A=f.useMemo(()=>{const me=a?.["--header-gradient"]||Ie["--header-gradient"],we=a?.["--header-text"]||Ie["--header-text"],Xe=a?.["--primary-accent"]||Ie["--primary-accent"],Ge=a?.["--primary-accent-light"]||Ie["--primary-accent-light"],dt=a?.["--icon-primary"]||Ie["--icon-primary"];return{headerGradient:me,headerText:we,primaryAccent:Xe,primaryAccentLight:Ge,iconPrimary:dt}},[a]),W=me=>{if(!me)return me;let we=me;return Object.entries(e).forEach(([Xe,Ge])=>{const dt=new RegExp(`\\{\\{${Xe}\\}\\}`,"g");we=we.replace(dt,Ge||"")}),we};f.useEffect(()=>{ie.current&&ie.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[l]);const H=async()=>{try{const me=T?{audio:{deviceId:{exact:T}}}:{audio:!0},we=await navigator.mediaDevices.getUserMedia(me);q.current=we;const Xe=new(window.AudioContext||window.webkitAudioContext);ee.current=Xe;const Ge=Xe.createAnalyser();Ge.fftSize=256,Ge.smoothingTimeConstant=.8,se.current=Ge,Xe.createMediaStreamSource(we).connect(Ge);const qe=new Uint8Array(Ge.frequencyBinCount),tt=()=>{if(!se.current)return;se.current.getByteFrequencyData(qe);const _e=qe.reduce((Vt,jt)=>Vt+jt,0)/qe.length;L(_e/255),G.current=requestAnimationFrame(tt)};tt()}catch(me){console.error("[RoleplaySession] Audio analysis error:",me)}},oe=()=>{G.current&&(cancelAnimationFrame(G.current),G.current=null),ee.current&&(ee.current.close(),ee.current=null),q.current&&(q.current.getTracks().forEach(me=>me.stop()),q.current=null),L(0)};f.useEffect(()=>(g==="connected"?H():oe(),()=>oe()),[g]);const Se=async()=>{D&&B(!0),await y()},$e=()=>{b(!1),v()},Ce=()=>{const me=!E;P(me),k(me)};if(!t)return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(V.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ke,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Kein Szenario ausgewhlt"}),s.jsx("p",{className:"text-slate-600 mb-6",children:"Bitte whle zuerst ein Szenario aus."}),s.jsx(ce,{onClick:r,className:"w-full",children:"Zur Szenario-Auswahl"})]})});if(c&&g==="disconnected"&&!u)return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(V.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ke,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Verbindungsfehler"}),s.jsx("p",{className:"text-slate-600 mb-6",children:c}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(ce,{onClick:r,variant:"outline",className:"flex-1",children:"Zurck"}),s.jsx(ce,{onClick:()=>{S(),y()},className:"flex-1",children:"Erneut versuchen"})]})]})});const rt={audio:{label:"Audio wird abgerufen...",progress:20},transcript:{label:"Transkript wird ausgewertet...",progress:50},audio_analysis:{label:"Sprechweise wird analysiert...",progress:75},saving:{label:"Ergebnisse werden gespeichert...",progress:90}};if(u){const me=h?rt[h]:{label:"Wird vorbereitet...",progress:5},we=["audio","transcript","audio_analysis","saving"],Xe=we.indexOf(h);return s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:s.jsxs(V.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(he,{className:"w-16 h-16 animate-spin mx-auto mb-4",style:{color:A.primaryAccent}}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Feedback wird generiert..."}),s.jsx(V.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-slate-600 min-h-[24px]",children:me.label},h),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:s.jsx(V.div,{className:"h-full",style:{background:A.headerGradient},initial:{width:"0%"},animate:{width:`${me.progress}%`},transition:{duration:.5,ease:"easeOut"}})})}),s.jsx("div",{className:"mt-6 flex justify-center gap-2",children:we.map((Ge,dt)=>s.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-300 ${dt<Xe?"bg-green-500":dt===Xe?"bg-blue-500":"bg-slate-200"}`},Ge))})]})})}return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{height:"calc(100vh - 120px)",minHeight:"600px"},className:"bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-2 lg:p-4 overflow-hidden",children:[s.jsxs("div",{className:"w-full h-full gap-3 lg:gap-4 overflow-hidden",style:{display:D?"flex":"grid",flexDirection:D?"column":void 0,gridTemplateColumns:D?void 0:"minmax(250px, 1fr) minmax(350px, 2fr) minmax(250px, 1fr)",padding:"0 8px"},children:[!D&&s.jsx(V.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"relative h-full min-h-0",children:s.jsx(NP,{hints:t.coaching_hints,dynamicCoaching:m,isGenerating:x,isConnected:g==="connected"})}),s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col min-h-[400px] order-1 lg:order-none",children:[s.jsxs("div",{style:{background:A.headerGradient},className:"rounded-t-2xl px-4 lg:px-6 py-3 lg:py-4 shadow-xl",children:[i===Hn.PROXY&&s.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-white/20 rounded-full",children:[s.jsx(Hj,{className:"w-3.5 h-3.5 text-white"}),s.jsx("span",{className:"text-xs font-medium text-white",children:"Proxy Modus"})]})}),s.jsx("div",{className:"flex items-center justify-center gap-4 mb-3",children:t.interviewer_profile?.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:W(t.interviewer_profile.name),style:{width:D?"64px":"80px",height:D?"64px":"80px",borderRadius:"50%",border:D?"3px solid white":"4px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",objectFit:"cover"}}):s.jsx("div",{style:{width:D?"64px":"80px",height:D?"64px":"80px",borderRadius:"50%",border:D?"3px solid white":"4px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",background:"white",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(qt,{className:D?"w-8 h-8":"w-10 h-10",style:{color:"#94a3b8"}})})}),s.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-white text-center mb-1",children:W(t.interviewer_profile?.name)||t.title}),t.interviewer_profile?.role&&s.jsx("p",{className:"text-blue-100 text-center text-sm font-medium mb-3",children:W(t.interviewer_profile.role)}),d&&s.jsxs("div",{className:"flex items-center justify-center gap-3 pt-3 border-t border-white/20",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[g==="connecting"&&s.jsxs(s.Fragment,{children:[s.jsx(he,{className:"w-4 h-4 text-white animate-spin"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbinde..."})]}),g==="connected"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbunden"})]})]}),s.jsx("div",{className:"h-4 w-px bg-white/30"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Je,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"font-mono text-sm font-semibold text-white",children:pt(p)})]})]})]}),s.jsxs("div",{className:"bg-white px-4 py-3 shadow-xl flex justify-center gap-3",children:[s.jsx("button",{onClick:()=>w(!0),className:"p-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-colors",title:"Gerte-Einstellungen",children:s.jsx(ii,{className:"w-5 h-5 text-slate-600"})}),d?g==="connected"?s.jsxs(s.Fragment,{children:[i===Hn.PROXY&&s.jsx(ce,{onClick:Ce,size:"lg",variant:E?"destructive":"outline",className:"rounded-xl",children:E?s.jsx(Gx,{className:"w-5 h-5"}):s.jsx(Fe,{className:"w-5 h-5"})}),s.jsxs(ce,{onClick:()=>b(!0),size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[s.jsx(Bj,{className:"w-5 h-5 mr-2"}),"Gesprch beenden"]})]}):g==="connecting"?s.jsxs(ce,{disabled:!0,size:"lg",className:"bg-slate-400 text-white font-semibold text-base py-6 px-8 rounded-xl",children:[s.jsx(he,{className:"w-5 h-5 mr-2 animate-spin"}),"Verbinde..."]}):null:s.jsxs(ce,{onClick:Se,size:"lg",disabled:!T,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg disabled:opacity-50",children:[s.jsx(Hr,{className:"w-5 h-5 mr-2"}),t.interviewer_profile?.name?`${W(t.interviewer_profile.name)} anrufen`:"Anrufen"]})]}),g==="connected"&&s.jsx("div",{className:"bg-white px-4 py-3 border-t border-slate-100",children:s.jsx(mr,{audioLevel:z,isActive:z>.05,variant:"bars",size:"md",accentColor:A.primaryAccent})}),D&&s.jsx("div",{style:{backgroundColor:"white",padding:"8px 16px"},children:s.jsxs("button",{onClick:()=>$(!F),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"14px",fontWeight:500,color:A.primaryAccent,backgroundColor:`${A.primaryAccent}10`,border:`1px solid ${A.primaryAccent}30`,borderRadius:"10px",padding:"12px 16px",cursor:"pointer"},children:[s.jsx("span",{children:"Profil-Details"}),s.jsx(ct,{size:16,style:{transform:F?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})}),s.jsx(De,{children:(F||!D)&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"lg:flex-1 lg:overflow-y-auto bg-white lg:rounded-b-2xl shadow-xl overflow-hidden",children:s.jsx(PP,{profile:t.interviewer_profile,replaceVariables:W})})})]}),!D&&s.jsx(V.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full min-h-0 overflow-hidden",children:s.jsxs("div",{className:"h-full min-h-0 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col",children:[s.jsx("div",{style:{background:A.headerGradient},className:"px-4 py-3 flex items-center flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-2",style:{color:A.headerText},children:[s.jsx(Ye,{className:"w-4 h-4"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-3",children:l.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(Ye,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):s.jsxs(De,{children:[l.map((me,we)=>s.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-2 ${me.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsxs("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:[me.role==="agent"?t.interviewer_profile?.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:A.headerGradient},children:s.jsx(el,{className:"w-4 h-4",style:{color:A.headerText}})}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(qt,{className:"w-4 h-4 text-white"})}),me.timeLabel&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:me.timeLabel})]}),s.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${me.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:s.jsx("p",{className:"text-xs leading-relaxed",children:me.text})})]},we)),s.jsx("div",{ref:ie})]})})]})})]}),D&&s.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-3 z-50",children:[s.jsx(V.button,{onClick:()=>B(!O),style:{background:A.headerGradient,color:A.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:s.jsx(Ne,{className:"w-6 h-6"})}),s.jsxs(V.button,{onClick:()=>M(!N),style:{background:A.headerGradient,color:A.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[s.jsx(Ye,{className:"w-6 h-6"}),l.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:l.length})]})]})]}),s.jsx(Xn,{open:C,onOpenChange:b,children:s.jsxs(Zn,{children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Gesprch beenden?"}),s.jsx(wi,{children:"Mchtest du das Gesprch beenden? Du erhltst anschlieend dein Feedback."})]}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>b(!1),children:"Abbrechen"}),s.jsxs(ce,{onClick:$e,children:[s.jsx(Zi,{className:"w-4 h-4 mr-2"}),"Beenden & Feedback erhalten"]})]})]})}),s.jsx(rh,{isOpen:j,onClose:()=>w(!1),mode:"audio",selectedMicrophoneId:T,onMicrophoneChange:I})]})},DP={auftreten:$x,selbstbewusstsein:ni,koerpersprache:qt,kommunikation:Ye,professionalitaet:ni,inhalt:Ne},zP=(t,e)=>{const n=t;return n>=90?"Ausgezeichnet!":n>=80?"Sehr gut!":n>=70?"Gut!":n>=60?"Solide Leistung":n>=50?"Ausbaufhig":"Weiter ben!"},OP=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",LP=t=>t==="video"?"Wirkungs-Analyse":t==="roleplay"?"Live-Simulation":"Szenario-Training",BP=({score:t,size:e=120,primaryAccent:n,isHeader:i=!1,branding:r})=>{const o=Math.min(100,Math.max(0,t||0)),a=(e-12)/2,l=a*2*Math.PI,c=l-o/100*l,d=Zt(t,n);return s.jsxs("div",{style:{position:"relative",width:e,height:e},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r:a,fill:"none",stroke:i?"rgba(255,255,255,0.3)":r.borderColor,strokeWidth:10}),s.jsx(V.circle,{cx:e/2,cy:e/2,r:a,fill:"none",stroke:d,strokeWidth:10,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:c},transition:{duration:1,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3.5,fontWeight:700,color:d},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:i?"#ffffff":r.textMuted},children:"von 100"})]})]})},FP=({audioUrl:t,primaryAccent:e,durationHint:n,branding:i})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(0),[d,u]=f.useState(n||0),[h,p]=f.useState(!0),[m,x]=f.useState(null);f.useEffect(()=>{if(!t)return;p(!0),x(null),u(n||0);const S=new Audio;r.current=S;const C=()=>{const w=S.duration;w&&isFinite(w)&&w>0&&u(w),p(!1)},b=()=>{const w=S.duration;w&&isFinite(w)&&w>0&&u(w)},j=()=>{p(!1);const w=S.duration;w&&isFinite(w)&&w>0&&u(w)};return S.addEventListener("loadedmetadata",C),S.addEventListener("durationchange",b),S.addEventListener("canplaythrough",j),S.addEventListener("timeupdate",()=>c(S.currentTime)),S.addEventListener("play",()=>a(!0)),S.addEventListener("pause",()=>a(!1)),S.addEventListener("ended",()=>a(!1)),S.addEventListener("error",()=>{x("Audio nicht verfgbar"),p(!1)}),S.src=t,S.load(),()=>{S.pause(),S.removeEventListener("loadedmetadata",C),S.removeEventListener("durationchange",b),S.removeEventListener("canplaythrough",j),S.src=""}},[t,n]);const g=()=>{r.current&&(o?r.current.pause():r.current.play())},y=S=>{const C=S.currentTarget.getBoundingClientRect(),b=(S.clientX-C.left)/C.width;r.current&&(r.current.currentTime=b*d)},v=S=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+S,d)))};if(m)return s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px",color:i.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ke,{size:16})," ",m]});if(!t)return null;const k=d>0?l/d*100:0;return s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsx("div",{onClick:y,style:{height:"8px",background:i.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${k}%`,height:"100%",background:e||"#0d9488",borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>v(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(il,{size:20})}),s.jsx("button",{onClick:g,disabled:h,style:{width:"48px",height:"48px",borderRadius:"50%",background:e||"#0d9488",border:"none",cursor:h?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:h?.7:1},children:h?s.jsx(he,{size:22,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):o?s.jsx(nl,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx(Dt,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>v(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(sl,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:i.textMuted},children:[pt(l)," / ",pt(d)]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},WP=({sessionId:t,conversationId:e,primaryAccent:n,branding:i})=>{const r=f.useRef(null),[o,a]=f.useState(!1),[l,c]=f.useState(!1),[d,u]=f.useState(0),[h,p]=f.useState(0),[m,x]=f.useState(null),[g,y]=f.useState(!0);f.useEffect(()=>{if(!e){y(!1),x("Keine Audio-Aufnahme verfgbar");return}const b=ju(t);return y(!0),x(null),fetch(b,{headers:{"X-WP-Nonce":wt()},credentials:"same-origin"}).then(j=>{if(!j.ok)throw new Error(`HTTP ${j.status}`);return j.blob()}).then(j=>{const w=URL.createObjectURL(j),T=new Audio(w);r.current=T,T._objectUrl=w,T.addEventListener("loadedmetadata",()=>{p(T.duration),y(!1)}),T.addEventListener("timeupdate",()=>u(T.currentTime)),T.addEventListener("play",()=>a(!0)),T.addEventListener("pause",()=>a(!1)),T.addEventListener("ended",()=>a(!1)),T.addEventListener("error",()=>{x("Audio konnte nicht abgespielt werden."),y(!1)})}).catch(()=>{x("Audio nicht verfgbar."),y(!1)}),()=>{r.current&&(r.current.pause(),r.current._objectUrl&&URL.revokeObjectURL(r.current._objectUrl),r.current=null)}},[t,e]);const v=()=>{r.current&&(o?r.current.pause():r.current.play())},k=()=>{r.current&&(r.current.muted=!l,c(!l))},S=b=>{r.current&&(r.current.currentTime=Math.max(0,Math.min(r.current.currentTime+b,h)))},C=b=>{const j=b.currentTarget.getBoundingClientRect(),w=(b.clientX-j.left)/j.width;r.current&&(r.current.currentTime=w*h)};return g?s.jsxs("div",{style:{background:i.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(he,{size:24,color:n,style:{animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:i.textMuted,marginTop:"8px"},children:"Audio wird geladen..."})]}):m?s.jsxs("div",{style:{background:i.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ke,{size:24,color:i.textMuted,style:{margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:i.textMuted,marginTop:"8px"},children:m})]}):s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:i.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Fe,{size:18,color:n})," Gesprchsaufnahme"]}),s.jsx("div",{onClick:C,style:{height:"8px",background:i.borderColor,borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${d/h*100||0}%`,height:"100%",background:n,borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>S(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(il,{size:20})}),s.jsx("button",{onClick:v,style:{width:"48px",height:"48px",borderRadius:"50%",background:n,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:o?s.jsx(nl,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx(Dt,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>S(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted},children:s.jsx(sl,{size:20})}),s.jsx("button",{onClick:k,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:i.textMuted,marginLeft:"auto"},children:l?s.jsx(Hc,{size:20}):s.jsx(ki,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:i.textMuted},children:[pt(d)," / ",pt(h)]})]})},UP=({entry:t,index:e,primaryAccent:n,branding:i})=>{const r=t.role==="user";return s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",flexShrink:0,background:r?n:i.disabledBg,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(qt,{size:16,color:r?"#fff":i.textSecondary})}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:r?n:i.textMuted,marginBottom:"4px"},children:r?"Du":"Interviewer"}),s.jsx("p",{style:{fontSize:"14px",color:i.textMain,lineHeight:1.6,margin:0},children:t.text||t.message})]})]})},$P=({answer:t,index:e,primaryAccent:n,branding:i})=>{const[r,o]=f.useState(!1),a=t.feedback?typeof t.feedback=="string"?JSON.parse(t.feedback):t.feedback:null,l=t.audio_analysis?typeof t.audio_analysis=="string"?JSON.parse(t.audio_analysis):t.audio_analysis:null,c=t.transcript==="[Keine Sprache erkannt]"||l?.speech_rate==="keine_sprache";return s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:e*.05},style:{background:"#fff",borderRadius:"16px",border:`1px solid ${i.borderColor}`,overflow:"hidden",marginBottom:"16px"},children:[s.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:"16px 20px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",textAlign:"left",overflow:"hidden"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",color:n,fontWeight:700,fontSize:"14px",flexShrink:0},children:e+1}),s.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:i.textMain,margin:0,lineHeight:1.4,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.question_text||`Frage ${e+1}`})}),t.overall_score!==null&&t.overall_score!==void 0&&s.jsx("span",{style:{fontSize:"16px",fontWeight:700,color:c?i.textMuted:Zt(t.overall_score*10,n)},children:c?"":`${Math.round(t.overall_score*10)}%`}),s.jsx(ct,{size:18,color:i.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:r&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 20px 20px",borderTop:`1px solid ${i.borderColor}`,paddingTop:"16px"},children:[t.question_text&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ye,{size:14,color:n})," Frage / Situation"]}),s.jsx("p",{style:{fontSize:"14px",color:i.textMain,lineHeight:1.6,background:`${n}08`,padding:"12px 16px",borderRadius:"10px",margin:0,border:`1px solid ${n}20`},children:t.question_text})]}),t.audio_url&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Fe,{size:14,color:n})," Deine Aufnahme"]}),s.jsx(FP,{audioUrl:t.audio_url,primaryAccent:n,durationHint:t.audio_duration_seconds,branding:i})]}),t.transcript&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Nt,{size:14,color:n})," Transkript"]}),s.jsxs("p",{style:{fontSize:"13px",color:c?i.textMuted:i.textSecondary,lineHeight:1.6,background:i.cardBgHover,padding:"12px 16px",borderRadius:"10px",margin:0,fontStyle:"italic",wordBreak:"break-word",overflowWrap:"break-word"},children:['"',t.transcript,'"']})]}),a?.scores&&!c&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(nn,{size:14,color:n})," Bewertung"]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",marginBottom:"8px"},children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Prsentation"}].map(({key:d,label:u})=>{const h=a.scores[d],p=h!=null?h*10:null;return s.jsxs("div",{style:{padding:"10px 8px",background:i.cardBgHover,borderRadius:"8px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"16px",fontWeight:700,color:p!=null?Zt(p,n):i.textMuted},children:p!=null?Math.round(p):"-"}),s.jsx("div",{style:{fontSize:"10px",color:i.textMuted,marginTop:"2px"},children:u})]},d)})}),(()=>{const d=a.scores.overall,u=d!=null?d*10:null;return s.jsxs("div",{style:{padding:"12px 16px",background:`${n}15`,borderRadius:"8px",textAlign:"center",border:`1px solid ${n}30`,display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[s.jsx("div",{style:{fontSize:"10px",color:i.textMuted},children:"Gesamt"}),s.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:u!=null?Zt(u,n):i.textMuted},children:u!=null?Math.round(u):"-"})]})})()]}),a?.summary&&s.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,lineHeight:1.5,marginBottom:"12px"},children:a.summary}),a?.strengths?.length>0&&!c&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:i.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ut,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.strengths.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.improvements?.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:i.warning,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(ke,{size:12})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.improvements.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),a?.tips?.length>0&&!c&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ne,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:i.textSecondary,fontSize:"12px"},children:a.tips.map((d,u)=>s.jsx("li",{style:{marginBottom:"4px"},children:d},u))})]}),l&&!c&&s.jsxs("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${i.borderColor}`},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:i.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Fe,{size:14,color:n})," Sprechanalyse"]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:[l.speech_rate&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Sprechtempo"}),s.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:i.textMain,textTransform:"capitalize"},children:l.speech_rate==="optimal"?" Optimal":l.speech_rate==="zu_schnell"?" Zu schnell":l.speech_rate==="zu_langsam"?" Zu langsam":l.speech_rate})]}),l.filler_words&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Fllwrter"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:l.filler_words.count<=2?i.success:l.filler_words.count<=5?i.warning:i.error},children:[l.filler_words.count||0," erkannt"]}),l.filler_words.words?.length>0&&s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginTop:"4px"},children:l.filler_words.words.slice(0,5).join(", ")})]}),l.confidence_score!=null&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Selbstsicherheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Zt(l.confidence_score,n)},children:[l.confidence_score,"%"]})]}),l.clarity_score!=null&&s.jsxs("div",{style:{padding:"12px",background:i.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Zt(l.clarity_score,n)},children:[l.clarity_score,"%"]})]})]}),l.notes&&s.jsx("p",{style:{fontSize:"12px",color:i.textMuted,marginTop:"10px",fontStyle:"italic"},children:l.notes})]})]})})})]})},VP=({isOpen:t,onClose:e,onConfirm:n,isDeleting:i,primaryAccent:r,branding:o})=>t?s.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:e,children:s.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:a=>a.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:o.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{size:24,color:o.error})}),s.jsx("div",{children:s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:o.textMain,margin:0},children:"Session lschen?"})})]}),s.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,lineHeight:1.6,marginBottom:"24px"},children:"Mchtest du diese Session wirklich lschen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:e,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:`1px solid ${o.disabledBg}`,backgroundColor:"white",color:o.textMain,fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",opacity:i?.5:1,outline:"none",WebkitAppearance:"none"},children:"Abbrechen"}),s.jsx("button",{onClick:n,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:"none",backgroundColor:o.error,color:"white",fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",opacity:i?.7:1,outline:"none",WebkitAppearance:"none"},children:i?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):s.jsxs(s.Fragment,{children:[s.jsx(We,{size:16}),"Lschen"]})})]})]})}):null,GP=({category:t,primaryAccent:e,branding:n})=>{const[i,r]=f.useState(!1),o=DP[t.category]||nn,a=Zt(t.score,e);return s.jsxs("div",{style:{background:"#fff",borderRadius:"12px",border:`1px solid ${n.borderColor}`,overflow:"hidden",marginBottom:"10px"},children:[s.jsxs("button",{onClick:()=>r(!i),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${a}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(o,{size:18,color:a})}),s.jsx("div",{style:{flex:1,textAlign:"left"},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:n.textMain,margin:0},children:t.label})}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:700,color:a},children:[Math.round(t.score),"%"]}),s.jsx(ct,{size:18,color:n.textMuted,style:{transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:i&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${n.borderColor}`,paddingTop:"12px"},children:[t.feedback&&s.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,lineHeight:1.5,marginBottom:"10px"},children:t.feedback}),t.strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"10px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.success,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ut,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.strengths.map((l,c)=>s.jsx("li",{children:l},c))})]}),t.improvements?.length>0&&s.jsxs("div",{children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n.warning,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ne,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:n.textSecondary},children:t.improvements.map((l,c)=>s.jsx("li",{children:l},c))})]})]})})})]})},HP=({session:t,type:e,scenario:n,onBack:i,onContinueSession:r,onRepeatSession:o,onDeleteSession:a})=>{const l=Ve(),c=Un(),[d,u]=f.useState(!1);f.useEffect(()=>{const W=()=>{const H=window.innerWidth;u(H>=768&&H<1200)};return W(),window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]);const h=l.headerGradient,p=l.primaryAccent,[m,x]=f.useState([]),[g,y]=f.useState(!0),[v,k]=f.useState(null),[S,C]=f.useState(!1),[b,j]=f.useState(!1),[w,T]=f.useState(!1),[I,E]=f.useState(null),[P,O]=f.useState(n),B=e==="video",N=e==="simulator",M=e==="roleplay",F=(()=>{const W=t?.questions||t?.questions_json;if(!W)return!1;try{const H=typeof W=="string"?JSON.parse(W):W;return Array.isArray(H)&&H.length>0}catch{return!1}})(),$=(()=>{if(!N||!F)return!1;const W=t?.total_questions||0,H=t?.completed_questions||0;return W>0&&H<W})(),D=async()=>{if(a){j(!0);try{await a(t,e)}catch(W){console.error("Failed to delete session:",W),j(!1),C(!1)}}},z=async()=>{if(!(w||!t?.id)){T(!0);try{let W;if(N)W=`${fn()}/simulator/sessions/${t.id}/export-pdf`;else if(B)W=`${fn()}/video-training/sessions/${t.id}/export-pdf`;else if(M)W=`${fn()}/sessions/${t.id}/export-pdf`;else throw new Error("Unsupported session type for PDF export");const H=await fetch(W,{method:"POST",headers:{"X-WP-Nonce":wt(),"Content-Type":"application/json"},credentials:"same-origin"}),oe=await H.json();if(!H.ok)throw console.error("[PDF] Server error response:",oe),new Error(oe.error||`HTTP ${H.status}`);if(!oe.success||!oe.pdf_base64)throw console.error("[PDF] Invalid response data:",oe),new Error(oe.error||"PDF generation failed");const Se=atob(oe.pdf_base64),$e=new Array(Se.length);for(let Xe=0;Xe<Se.length;Xe++)$e[Xe]=Se.charCodeAt(Xe);const Ce=new Uint8Array($e),rt=new Blob([Ce],{type:oe.content_type||"application/pdf"}),me=window.URL.createObjectURL(rt),we=document.createElement("a");we.href=me,we.download=oe.filename||"Training.pdf",document.body.appendChild(we),we.click(),document.body.removeChild(we),window.URL.revokeObjectURL(me)}catch(W){console.error("Failed to download PDF:",W)}finally{T(!1)}}};f.useEffect(()=>{N&&t?.id?L():M&&t?.id?ee():y(!1)},[t?.id,e]);const L=async()=>{try{y(!0);const H=await(await fetch(`${fn()}/simulator/sessions/${t.id}/answers`,{headers:{"X-WP-Nonce":wt()}})).json();H.success&&H.data?.answers?x(H.data.answers):Array.isArray(H.data)&&x(H.data)}catch(W){console.error("Failed to load answers:",W),k("Fehler beim Laden der Antworten")}finally{y(!1)}},ee=async()=>{try{y(!0);const W=await wu(t.id);if(E({...t,...W,feedback:ku(W.feedback_json||t.feedback_json),audioAnalysis:Cu(W.audio_analysis_json||t.audio_analysis_json),transcript:o0(W.transcript||t.transcript)}),!n&&W.scenario_id)try{const H=await l0(W.scenario_id);O(H)}catch(H){console.warn("Could not load scenario:",H)}}catch(W){console.error("Failed to load roleplay data:",W),k("Fehler beim Laden der Gesprchsdaten")}finally{y(!1)}},se=t?.summary_feedback_json?typeof t.summary_feedback_json=="string"?JSON.parse(t.summary_feedback_json):t.summary_feedback_json:null,G=t?.category_scores||[],q=t?.analysis||{},A=(()=>{let W=0;return M&&I?.feedback?.rating?.overall?W=I.feedback.rating.overall:W=t?.overall_score||se?.overall_score||0,(N||M)&&W<=10?W*10:W})();return g?s.jsxs("div",{style:{width:"100%",minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(he,{size:48,color:p,style:{animation:"spin 1s linear infinite",display:"block",margin:"0 auto"}}),s.jsx("p",{style:{color:l.textMuted,marginTop:"16px"},children:"Analyse wird geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):v?s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:"24px"},children:[s.jsx(ke,{size:48,color:l.error,style:{margin:"0 auto 16px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:l.textMain,marginBottom:"8px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:l.textSecondary,marginBottom:"24px"},children:v}),s.jsx("button",{onClick:i,style:{padding:"12px 24px",borderRadius:"10px",background:l.cardBgHover,border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Zurck"})]})}):s.jsxs("div",{style:{minHeight:"100vh",background:l.pageBg,overflow:"hidden",maxWidth:"100vw"},children:[s.jsx("div",{style:{background:h,padding:c?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[i&&s.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[s.jsx(yt,{size:16}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!c&&s.jsx(BP,{score:A,size:100,primaryAccent:p,isHeader:!0,branding:l}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[s.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:LP(e)}),s.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:Zt(A,p)},children:zP(A)})]}),s.jsx("h1",{style:{fontSize:c?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:(M?P?.title:n?.title)||t?.scenario_title||t?.position||"Training"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Fn,{size:14}),OP(t?.created_at)]}),t?.duration&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Je,{size:14}),pt(t.duration)]})]})]}),s.jsxs("div",{style:{display:"flex",gap:"12px"},children:[s.jsx("button",{onClick:z,disabled:w,title:"Als PDF herunterladen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 12px",cursor:w?"wait":"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none",opacity:w?.7:1},children:w?s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}):s.jsx(gr,{size:16})}),!c&&o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none"},children:[s.jsx(Si,{size:16}),"Erneut ben"]}),a&&s.jsx("button",{onClick:()=>C(!0),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:c?"10px 12px":"10px 16px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500,outline:"none",WebkitAppearance:"none"},children:s.jsx(We,{size:16})})]})]})]})}),s.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:c?"16px":"24px 32px",overflow:"hidden"},children:s.jsxs("div",{style:{display:"grid",gridTemplateColumns:c||d?"1fr":"1fr 400px",gap:"24px",overflow:"hidden"},children:[s.jsxs("div",{style:{minWidth:0,overflow:"hidden"},children:[B&&t?.video_url&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(bt,{size:18,color:p})," Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),N&&m.length>0&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("h3",{style:{fontSize:"16px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Ye,{size:18,color:p})," Deine Antworten (",m.length,")"]}),m.map((W,H)=>s.jsx($P,{answer:W,index:H,primaryAccent:p,branding:l},W.id||H)),$&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px",padding:"20px",background:l.cardBgHover,borderRadius:"12px",border:`1px dashed ${l.disabledBg}`},children:[s.jsx("p",{style:{width:"100%",textAlign:"center",color:l.textSecondary,fontSize:"14px",marginBottom:"12px"},children:"Diese Session ist noch nicht abgeschlossen."}),r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:p,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`},children:[s.jsx(_p,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:18}),"Erneut starten"]})]})]}),N&&m.length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",background:l.cardBgHover,borderRadius:"16px"},children:[s.jsx(ke,{size:48,color:l.textMuted,style:{margin:"0 auto 16px"}}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:l.textMain,marginBottom:"8px"},children:"Keine Antworten vorhanden"}),s.jsx("p",{style:{color:l.textMuted,marginBottom:F?"24px":"0"},children:F?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),$&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px"},children:[r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:p,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`},children:[s.jsx(_p,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${l.disabledBg}`,background:"white",color:l.textMain,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:18}),"Erneut starten"]})]})]}),M&&I&&s.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{marginBottom:"20px"},children:s.jsx(WP,{sessionId:t.id,conversationId:I.conversation_id,primaryAccent:p,branding:l})}),M&&I?.transcript?.length>0&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Nt,{size:18,color:p})," Gesprchsverlauf"]}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:I.transcript.map((W,H)=>s.jsx(UP,{entry:W,index:H,primaryAccent:p,branding:l},H))})]})]}),s.jsxs("div",{style:{minWidth:0,overflow:"hidden"},children:[B&&G.length>0&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(nn,{size:16,color:p})," Detaillierte Bewertung"]}),G.map((W,H)=>s.jsx(GP,{category:W,primaryAccent:p,branding:l},W.category||H))]}),B&&(q.key_strengths?.length>0||q.actionable_tips?.length>0)&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[q.key_strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ut,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:q.key_strengths.map((W,H)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:W},H))})]}),q.actionable_tips?.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:p,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ne,{size:16})," Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:q.actionable_tips.map((W,H)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"6px",lineHeight:1.4},children:W},H))})]})]}),B&&t?.summary_feedback&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:t.summary_feedback})]}),N&&se&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[se.summary&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:se.summary})]}),se.scores&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"12px"},children:"Bewertung"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:Object.entries(se.scores).map(([W,H])=>{const oe=H!=null?H*10:null;return s.jsxs("div",{style:{padding:"12px",background:l.cardBgHover,borderRadius:"10px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:Zt(oe,p)},children:oe!=null?Math.round(oe):"-"}),s.jsx("div",{style:{fontSize:"11px",color:l.textMuted,textTransform:"capitalize"},children:W})]},W)})})]}),se.key_takeaways?.length>0&&s.jsxs("div",{style:{background:l.successLight,borderRadius:"16px",padding:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ne,{size:16})," Wichtigste Erkenntnisse"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:l.textMain,lineHeight:1.5},children:se.key_takeaways.map((W,H)=>s.jsx("li",{style:{marginBottom:"6px"},children:W},H))})]})]}),M&&I?.feedback&&s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[I.feedback.rating&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"15px",fontWeight:600,color:l.textMain,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(nn,{size:16,color:p})," Bewertungskriterien"]}),s.jsx("div",{style:{display:"grid",gap:"10px"},children:Object.entries(I.feedback.rating).filter(([W])=>W!=="overall").map(([W,H])=>{const oe=H*10;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:l.cardBgHover,borderRadius:"10px"},children:[s.jsx("div",{style:{flex:1,fontSize:"13px",fontWeight:500,color:l.textMain,textTransform:"capitalize"},children:W.replace(/_/g," ")}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{width:"80px",height:"6px",background:l.borderColor,borderRadius:"3px"},children:s.jsx("div",{style:{width:`${oe}%`,height:"100%",background:Zt(oe,p),borderRadius:"3px"}})}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:Zt(oe,p),minWidth:"45px"},children:Math.round(oe)})]})]},W)})})]}),I.feedback.strengths?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.success,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ut,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:I.feedback.strengths.map((W,H)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:W},H))})]}),I.feedback.improvements?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${l.borderColor}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:l.warning,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ne,{size:16})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:I.feedback.improvements.map((W,H)=>s.jsx("li",{style:{fontSize:"13px",color:l.textSecondary,marginBottom:"8px",lineHeight:1.5},children:W},H))})]}),I.feedback.summary&&s.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:l.textMain,marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:l.textSecondary,lineHeight:1.6,margin:0},children:I.feedback.summary})]})]}),M&&!I?.feedback&&s.jsxs("div",{style:{background:l.cardBgHover,borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ke,{size:32,color:l.textMuted,style:{margin:"0 auto 12px"}}),s.jsx("p",{style:{fontSize:"14px",color:l.textMuted,margin:0},children:"Keine Analyse verfgbar fr dieses Gesprch."})]})]})]})}),s.jsx(VP,{isOpen:S,onClose:()=>C(!1),onConfirm:D,isDeleting:b,primaryAccent:p,branding:l})]})},Di={COACHING:"coaching",ANALYSEN:"analysen"},qP=t=>t>=90?"Ausgezeichnet!":t>=80?"Sehr gut!":t>=70?"Gut!":t>=60?"Solide Leistung":t>=50?"Ausbaufhig":"Weiter ben!",KP=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",JP=t=>t>=80?{color:"#22c55e",bg:"#f0fdf4",label:"Sehr selbstsicher"}:t>=60?{color:"#3b82f6",bg:"#eff6ff",label:"Selbstsicher"}:t>=40?{color:"#f59e0b",bg:"#fffbeb",label:"Ausbaufhig"}:{color:"#ef4444",bg:"#fef2f2",label:"Unsicher"},YP=t=>{switch(t){case"zu_langsam":return 15;case"optimal":return 50;case"zu_schnell":return 85;default:return 50}},_g=t=>{if(typeof t=="number")return t;if(!t||typeof t!="string")return 0;const e=t.split(":");if(e.length===2){const n=parseInt(e[0],10)||0,i=parseInt(e[1],10)||0;return n*60+i}if(e.length===3){const n=parseInt(e[0],10)||0,i=parseInt(e[1],10)||0,r=parseInt(e[2],10)||0;return n*3600+i*60+r}return parseFloat(t)||0},XP=({score:t,size:e=100,primaryAccent:n,isHeader:i=!1})=>{const r=Math.min(100,Math.max(0,t||0)),o=(e-10)/2,a=o*2*Math.PI,l=a-r/100*a,c=Zt(t,n);return s.jsxs("div",{style:{position:"relative",width:e,height:e},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r:o,fill:"none",stroke:i?"rgba(255,255,255,0.25)":"#e2e8f0",strokeWidth:8}),s.jsx(V.circle,{cx:e/2,cy:e/2,r:o,fill:"none",stroke:i?"#fff":c,strokeWidth:8,strokeLinecap:"round",strokeDasharray:a,initial:{strokeDashoffset:a},animate:{strokeDashoffset:l},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsx("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:s.jsx(V.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},style:{fontSize:e/3,fontWeight:700,color:i?"#fff":c,lineHeight:1},children:Math.round(t)})})]})},ZP=({audioUrl:t,duration:e,primaryAccent:n,branding:i,onSeek:r})=>{const o=f.useRef(null),a=f.useRef(null),l=f.useRef(null),[c,d]=f.useState(!1),[u,h]=f.useState(!1),[p,m]=f.useState(0),[x,g]=f.useState(e||0),[y,v]=f.useState(!0),[k,S]=f.useState(null);f.useEffect(()=>{if(!t)return;let I=!0;const E=t.includes("/wp-json/")||t.includes("/api/");return(async()=>{try{v(!0),S(null);let O=t;if(E){const N=await fetch(t,{method:"GET",headers:{"X-WP-Nonce":wt()},credentials:"same-origin"});if(!N.ok)throw new Error(`HTTP ${N.status}`);const M=await N.blob();if(!I)return;if(M.size===0)throw new Error("Audio nicht verfgbar");const F=URL.createObjectURL(M);l.current=F,O=F}const B=new Audio(O);o.current=B,B.addEventListener("loadedmetadata",()=>{I&&(g(B.duration),v(!1))}),B.addEventListener("timeupdate",()=>{I&&m(B.currentTime)}),B.addEventListener("ended",()=>{I&&(d(!1),m(0))}),B.addEventListener("error",()=>{I&&(S("Audio konnte nicht geladen werden"),v(!1))})}catch(O){console.error("[AudioPlayer] Failed to load audio:",O),I&&(S("Audio konnte nicht geladen werden"),v(!1))}})(),()=>{I=!1,o.current&&(o.current.pause(),o.current.src=""),l.current&&URL.revokeObjectURL(l.current)}},[t]);const C=()=>{o.current&&(c?o.current.pause():o.current.play(),d(!c))},b=()=>{o.current&&(o.current.muted=!u,h(!u))},j=I=>{o.current&&(o.current.currentTime=Math.max(0,Math.min(x,o.current.currentTime+I)))},w=I=>{o.current&&(o.current.currentTime=I,m(I),c||(o.current.play(),d(!0)))};f.useEffect(()=>{r&&(r.current=w)},[r]);const T=I=>{if(!a.current||!x)return;const E=a.current.getBoundingClientRect(),P=(I.clientX-E.left)/E.width;w(P*x)};return t?s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(ki,{size:18,color:n}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:i.textMain},children:"Gesprchsaufnahme"})]}),s.jsx("div",{ref:a,onClick:T,style:{position:"relative",height:"48px",background:i.cardBgHover,borderRadius:"12px",cursor:"pointer",overflow:"hidden",marginBottom:"16px"},children:y?s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:s.jsx(he,{size:24,color:n,style:{animation:"spin 1s linear infinite"}})}):k?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",gap:"8px"},children:[s.jsx(ke,{size:18,color:i.warning}),s.jsx("span",{style:{fontSize:"13px",color:i.textMuted},children:k})]}):s.jsxs(s.Fragment,{children:[s.jsx(V.div,{initial:{width:0},animate:{width:`${x>0?p/x*100:0}%`},style:{position:"absolute",inset:0,background:`linear-gradient(90deg, ${n}40, ${n}60)`,borderRadius:"12px"}}),s.jsx("div",{style:{position:"absolute",left:`${x>0?p/x*100:0}%`,top:0,bottom:0,width:"3px",background:n,transform:"translateX(-50%)"}})]})}),!k&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("button",{onClick:()=>j(-10),disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:i.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:s.jsx(il,{size:20,color:i.textSecondary})}),s.jsx("button",{onClick:C,disabled:y,style:{width:"48px",height:"48px",borderRadius:"50%",border:"none",background:n,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:c?s.jsx(nl,{size:20,color:"#fff"}):s.jsx(Dt,{size:20,color:"#fff",style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>j(10),disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:i.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:y?.5:1},children:s.jsx(sl,{size:20,color:i.textSecondary})})]}),s.jsxs("div",{style:{flex:1,textAlign:"center",fontSize:"14px",color:i.textSecondary,fontFamily:"monospace"},children:[pt(p)," / ",pt(x)]}),s.jsx("button",{onClick:b,disabled:y,style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:i.cardBgHover,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:u?s.jsx(Hc,{size:20,color:i.textSecondary}):s.jsx(ki,{size:20,color:i.textSecondary})})]})]}):s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(ki,{size:18,color:i.textMuted}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:i.textMain},children:"Gesprchsaufnahme"})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"80px",background:i.cardBgHover,borderRadius:"12px",color:i.textMuted,fontSize:"13px"},children:[s.jsx(Hc,{size:20,style:{marginRight:"8px"}}),"Keine Audioaufnahme verfgbar"]})]})},QP=({transcript:t,scenario:e,primaryAccent:n,branding:i,onSeekToTime:r})=>!t||t.length===0?s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"40px 20px",border:`1px solid ${i.borderColor}`,textAlign:"center"},children:[s.jsx(Ye,{size:32,color:i.textMuted,style:{marginBottom:"12px"}}),s.jsx("p",{style:{color:i.textMuted,fontSize:"14px"},children:"Kein Transkript verfgbar"})]}):s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(Ye,{size:18,color:n}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:i.textMain},children:"Gesprchsverlauf"})]}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto",paddingRight:"8px"},children:t.map((o,a)=>{const l=o.role==="agent",c=o.timeLabel||(o.elapsedTime!==void 0?pt(o.elapsedTime):null);return s.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.03},style:{display:"flex",gap:"10px",marginBottom:"12px",flexDirection:l?"row":"row-reverse"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flexShrink:0},children:[l?e?.interviewer_profile?.image_url?s.jsx("img",{src:e.interviewer_profile.image_url,alt:e.interviewer_profile.name||"Interviewer",style:{width:"32px",height:"32px",borderRadius:"50%",objectFit:"cover",border:`2px solid ${n}30`}}):s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:`linear-gradient(135deg, ${n}, ${n}cc)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(el,{size:16,color:"#fff"})}):s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"linear-gradient(135deg, #14b8a6, #0d9488)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(qt,{size:16,color:"#fff"})}),!l&&c&&s.jsx("button",{onClick:()=>r?.(o.elapsedTime),style:{fontSize:"10px",fontFamily:"monospace",color:n,background:"none",border:"none",cursor:"pointer",padding:0},children:c})]}),s.jsx("div",{style:{maxWidth:"85%",padding:"10px 14px",borderRadius:l?"4px 16px 16px 16px":"16px 4px 16px 16px",background:l?i.cardBgHover:"linear-gradient(135deg, #14b8a6, #0d9488)",color:l?i.textMain:"#fff",fontSize:"13px",lineHeight:1.5,border:l?`1px solid ${i.borderColor}`:"none"},children:o.text})]},a)})})]}),Yo=({label:t,value:e,maxValue:n=10,primaryAccent:i,branding:r})=>{const o=e/n*100,a=n===10?e*10:e,l=Zt(a,i);return s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[s.jsx("span",{style:{fontSize:"13px",color:r.textSecondary},children:t}),s.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:l},children:a})]}),s.jsx("div",{style:{height:"6px",background:r.cardBgHover,borderRadius:"3px",overflow:"hidden"},children:s.jsx(V.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},style:{height:"100%",background:l,borderRadius:"3px"}})})]})},e4=({feedback:t,audioAnalysis:e,primaryAccent:n,branding:i})=>{const[r,o]=f.useState("summary"),a=l=>{o(r===l?null:l)};return s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t?.summary&&s.jsxs("div",{style:{background:`${n}08`,borderRadius:"12px",border:`1px solid ${n}20`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("summary"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[s.jsx(ni,{size:18,color:n}),s.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:i.textMain},children:"Gesamtbewertung"}),s.jsx(ct,{size:18,color:i.textMuted,style:{transform:r==="summary"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:r==="summary"&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:s.jsx("p",{style:{fontSize:"13px",lineHeight:1.7,color:i.textSecondary},children:t.summary})})})})]}),t?.strengths?.length>0&&s.jsxs("div",{style:{background:"#f0fdf4",borderRadius:"12px",border:"1px solid #bbf7d0",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("strengths"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[s.jsx(Zi,{size:18,color:"#22c55e"}),s.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#166534"},children:"Deine Superkrfte"}),s.jsxs("span",{style:{fontSize:"12px",color:"#22c55e",fontWeight:500},children:[t.strengths.length," Strken"]}),s.jsx(ct,{size:18,color:"#22c55e",style:{transform:r==="strengths"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:r==="strengths"&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:t.strengths.map((l,c)=>s.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px"},children:s.jsx("span",{style:{fontSize:"11px",fontWeight:600,color:"#22c55e"},children:""})}),s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#166534",margin:0},children:l})]},c))})})})]}),t?.improvements?.length>0&&s.jsxs("div",{style:{background:"#fffbeb",borderRadius:"12px",border:"1px solid #fde68a",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("improvements"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[s.jsx(dn,{size:18,color:"#f59e0b"}),s.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#92400e"},children:"Dein Trainingsfeld"}),s.jsxs("span",{style:{fontSize:"12px",color:"#f59e0b",fontWeight:500},children:[t.improvements.length," Punkte"]}),s.jsx(ct,{size:18,color:"#f59e0b",style:{transform:r==="improvements"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:r==="improvements"&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:t.improvements.map((l,c)=>s.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"#fef3c7",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"2px"},children:s.jsx("span",{style:{fontSize:"11px",fontWeight:600,color:"#f59e0b"},children:c+1})}),s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#92400e",margin:0},children:l})]},c))})})})]}),t?.tips?.length>0&&s.jsxs("div",{style:{background:"#eff6ff",borderRadius:"12px",border:"1px solid #bfdbfe",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("tips"),style:{width:"100%",padding:"14px 16px",display:"flex",alignItems:"center",gap:"10px",background:"none",border:"none",cursor:"pointer",textAlign:"left"},children:[s.jsx(Ne,{size:18,color:"#3b82f6"}),s.jsx("span",{style:{flex:1,fontSize:"14px",fontWeight:600,color:"#1e40af"},children:"Praktische Tipps"}),s.jsxs("span",{style:{fontSize:"12px",color:"#3b82f6",fontWeight:500},children:[t.tips.length," Tipps"]}),s.jsx(ct,{size:18,color:"#3b82f6",style:{transform:r==="tips"?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:r==="tips"&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:t.tips.map((l,c)=>s.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[s.jsx(et,{size:16,color:"#3b82f6",style:{flexShrink:0,marginTop:"2px"}}),s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:"#1e40af",margin:0},children:l})]},c))})})})]}),t?.rating&&s.jsxs("div",{style:{background:"#fff",borderRadius:"12px",padding:"16px",border:`1px solid ${i.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(nn,{size:18,color:n}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:i.textMain},children:"Bewertungskriterien"})]}),t.rating.communication!==void 0&&s.jsx(Yo,{label:"Kommunikation",value:t.rating.communication,primaryAccent:n,branding:i}),t.rating.motivation!==void 0&&s.jsx(Yo,{label:"Motivation",value:t.rating.motivation,primaryAccent:n,branding:i}),t.rating.professionalism!==void 0&&s.jsx(Yo,{label:"Professionalitt",value:t.rating.professionalism,primaryAccent:n,branding:i}),t.rating.preparation!==void 0&&s.jsx(Yo,{label:"Vorbereitung",value:t.rating.preparation,primaryAccent:n,branding:i})]})]})},t4=({audioAnalysis:t,primaryAccent:e,branding:n,onJumpToTimestamp:i})=>{const r=t?.audio_metrics||t,o=r&&(r.confidence_score!==void 0||r.speech_cleanliness||r.pacing||r.tonality);if(!t||!o)return s.jsxs("div",{style:{background:"#fff",borderRadius:"12px",padding:"40px 20px",border:`1px solid ${n.borderColor}`,textAlign:"center"},children:[s.jsx(Dl,{size:32,color:n.textMuted,style:{marginBottom:"12px"}}),s.jsx("p",{style:{color:n.textMuted,fontSize:"14px"},children:"Keine Audio-Analyse verfgbar"})]});const a=r.confidence_score,l=r.speech_cleanliness,c=r.pacing,d=r.tonality,u=l?.total_filler_count||0,h=l?.filler_word_analysis||[];h.map(g=>g.word);const p=l?.feedback,m=g=>g==="lebendig"?"Lebendig":g==="natrlich"?"Natrlich":"Monoton",x=g=>g==="lebendig"?{base:20,variance:30}:g==="natrlich"?{base:25,variance:20}:{base:35,variance:8};return s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[a!==void 0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(Dl,{size:18,color:e}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Selbstsicherheit"})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px"},children:(()=>{const g=a,y=JP(g),v=140,k=v/2-12,S=Math.PI*k,C=S-g/100*S;return s.jsxs("div",{style:{background:y.bg,borderRadius:"16px",padding:"20px 30px",display:"flex",flexDirection:"column",alignItems:"center"},children:[s.jsxs("div",{style:{position:"relative",width:v,height:v/2+20},children:[s.jsxs("svg",{width:v,height:v/2+20,style:{overflow:"visible"},children:[s.jsx("path",{d:`M 12 ${v/2} A ${k} ${k} 0 0 1 ${v-12} ${v/2}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"10",strokeLinecap:"round"}),s.jsx(V.path,{d:`M 12 ${v/2} A ${k} ${k} 0 0 1 ${v-12} ${v/2}`,fill:"none",stroke:y.color,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:S,initial:{strokeDashoffset:S},animate:{strokeDashoffset:C},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",paddingBottom:"4px"},children:[s.jsx(V.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5},style:{fontSize:"32px",fontWeight:700,color:y.color},children:Math.round(g)}),s.jsx("span",{style:{fontSize:"11px",color:n.textMuted},children:"/ 100"})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"8px"},children:[s.jsx(Dl,{size:14,color:y.color}),s.jsx("span",{style:{fontSize:"13px",fontWeight:600,color:y.color},children:y.label})]})]})})()}),r.summary_text&&s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,textAlign:"center"},children:r.summary_text})]}),l&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Ye,{size:18,color:"#f97316"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Fllwrter"})]}),s.jsxs("span",{style:{fontSize:"13px",fontWeight:600,padding:"4px 10px",borderRadius:"20px",background:u<=2?"#dcfce7":u<=5?"#fef3c7":"#fee2e2",color:u<=2?"#166534":u<=5?"#92400e":"#991b1b"},children:[u,"x gesamt"]})]}),h.length>0?s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:h.map((g,y)=>s.jsxs("div",{style:{borderRadius:"8px",background:"#fef3c7",overflow:"hidden"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px"},children:[s.jsxs("span",{style:{fontSize:"13px",color:"#92400e",fontWeight:500},children:['"',g.word,'"']}),s.jsxs("span",{style:{fontSize:"12px",color:"#92400e",fontWeight:600},children:[g.count,"x"]})]}),g.examples?.length>0&&s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",padding:"8px 12px",background:"#fef9e7",borderTop:"1px solid #fde68a"},children:g.examples.map((v,k)=>s.jsxs("button",{onClick:()=>i?.(_g(v.timestamp)),style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"6px",border:"none",background:"#fef3c7",cursor:"pointer",fontSize:"11px",color:"#92400e",transition:"all 0.15s"},onMouseOver:S=>S.currentTarget.style.background="#fde68a",onMouseOut:S=>S.currentTarget.style.background="#fef3c7",children:[s.jsx("span",{style:{fontFamily:"monospace",fontWeight:600},children:v.timestamp}),s.jsx(Dt,{size:10})]},k))})]},y))}):s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#22c55e"},children:[s.jsx(Zi,{size:16}),s.jsx("span",{style:{fontSize:"13px"},children:"Keine Fllwrter erkannt!"})]}),p&&s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,marginTop:"12px"},children:p})]}),c&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Vj,{size:18,color:"#3b82f6"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Sprechtempo"})]}),c.estimated_wpm&&s.jsxs("span",{style:{fontSize:"12px",fontFamily:"monospace",padding:"4px 10px",borderRadius:"6px",background:n.cardBgHover,color:n.textSecondary},children:["~",c.estimated_wpm," WPM"]})]}),s.jsxs("div",{style:{position:"relative",height:"40px",marginBottom:"8px"},children:[s.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"8px",borderRadius:"4px",background:"linear-gradient(90deg, #93c5fd, #86efac, #fca5a5)",transform:"translateY(-50%)"}}),s.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"60px",height:"16px",background:"rgba(34, 197, 94, 0.2)",border:"1px solid #22c55e",borderRadius:"8px",transform:"translate(-50%, -50%)"}}),s.jsx(V.div,{initial:{left:"50%"},animate:{left:`${YP(c.rating)}%`},transition:{duration:.8,ease:"easeOut"},style:{position:"absolute",top:"50%",width:"16px",height:"16px",borderRadius:"50%",background:c.rating==="optimal"?"#22c55e":"#f59e0b",border:"2px solid #fff",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",transform:"translate(-50%, -50%)"}}),s.jsxs("div",{style:{position:"absolute",bottom:"-4px",left:0,right:0,display:"flex",justifyContent:"space-between",fontSize:"10px",color:n.textMuted},children:[s.jsx("span",{children:"Langsam"}),s.jsx("span",{style:{color:"#22c55e",fontWeight:500},children:"Optimal"}),s.jsx("span",{children:"Schnell"})]})]}),c.feedback&&s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary,marginTop:"16px"},children:c.feedback})]}),d&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${n.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Nj,{size:18,color:"#14b8a6"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:n.textMain},children:"Betonung & Melodie"})]}),s.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"6px",background:"#f0fdfa",color:"#0d9488"},children:m(d.rating)})]}),s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",height:"48px",marginBottom:"12px"},children:Array.from({length:30}).map((g,y)=>{const{base:v,variance:k}=x(d.rating),S=v+Math.sin(y*.5)*k+Math.sin(y*12.9898)%1*(k/2);return s.jsx(V.div,{initial:{height:0},animate:{height:`${Math.max(10,Math.min(100,S))}%`},transition:{duration:.5,delay:y*.02},style:{width:"4px",borderRadius:"2px",background:"#14b8a6"}},y)})}),d.highlights?.length>0&&s.jsx("div",{style:{marginBottom:"12px"},children:d.highlights.map((g,y)=>s.jsxs("button",{onClick:()=>i?.(_g(g.timestamp)),style:{width:"100%",display:"flex",alignItems:"flex-start",gap:"8px",padding:"10px 12px",marginBottom:"6px",borderRadius:"8px",border:"none",background:g.type==="positive"?"#f0fdf4":"#fef2f2",cursor:"pointer",textAlign:"left"},children:[s.jsx("span",{style:{fontSize:"11px",fontFamily:"monospace",padding:"2px 6px",borderRadius:"4px",background:g.type==="positive"?"#dcfce7":"#fee2e2",color:g.type==="positive"?"#166534":"#991b1b",flexShrink:0},children:g.timestamp}),s.jsx("span",{style:{flexShrink:0,marginTop:"1px"},children:g.type==="positive"?s.jsx(Zi,{size:14,color:"#22c55e"}):s.jsx(ss,{size:14,color:"#ef4444"})}),s.jsx("span",{style:{fontSize:"12px",color:n.textSecondary,flex:1,lineHeight:1.5,wordBreak:"break-word",whiteSpace:"normal"},children:g.note}),s.jsx(Dt,{size:12,color:n.textMuted,style:{flexShrink:0,marginTop:"2px"}})]},y))}),d.feedback&&s.jsx("p",{style:{fontSize:"13px",lineHeight:1.6,color:n.textSecondary},children:d.feedback})]})]})},ov=({session:t,scenario:e,feedback:n,audioAnalysis:i,onBack:r,onRepeat:o,onDelete:a,isLoading:l=!1})=>{const c=Ve(),d=Un(768),u=f.useRef(null),[h,p]=f.useState(Di.COACHING),[m,x]=f.useState(!1),[g,y]=f.useState(!1),[v,k]=f.useState(!1),[S,C]=f.useState(null),[b,j]=f.useState(!1),w=S||t;f.useEffect(()=>{t?.id&&!t?.audio_analysis_json&&!i&&!S&&(j(!0),wu(t.id).then(z=>{C(z)}).catch(z=>{console.error("Failed to fetch full session:",z)}).finally(()=>{j(!1)}))},[t?.id,t?.audio_analysis_json,i,S]);const T=f.useMemo(()=>n&&typeof n=="object"?n:w?.feedback_json?ku(w.feedback_json):null,[n,w?.feedback_json]),I=f.useMemo(()=>i&&typeof i=="object"?i:w?.audio_analysis_json?Cu(w.audio_analysis_json):null,[i,w?.audio_analysis_json]),E=f.useMemo(()=>w?.transcript?o0(w.transcript):[],[w?.transcript]),P=f.useMemo(()=>w?.audio_url?w.audio_url:w?.id?ju(w.id):null,[w?.id,w?.audio_url]),O=f.useMemo(()=>T?.rating?.overall!==void 0?T.rating.overall*10:0,[T]),B=c.primaryAccent,N=c.headerGradient,M=D=>{u.current&&u.current(D)},F=async()=>{if(!(!w?.id||v)){k(!0);try{const z=(window.wpApiSettings||{}).root||"/wp-json/",L=wt(),ee=await fetch(`${z}bewerbungstrainer/v1/sessions/${w.id}/export-pdf`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":L}}),se=await ee.json();if(!ee.ok)throw console.error("[PDF] Server error:",se),new Error(se.error||"PDF-Export fehlgeschlagen");if(se.pdf_base64&&se.filename){const G=atob(se.pdf_base64),q=new Array(G.length);for(let oe=0;oe<G.length;oe++)q[oe]=G.charCodeAt(oe);const ie=new Uint8Array(q),A=new Blob([ie],{type:"application/pdf"}),W=window.URL.createObjectURL(A),H=document.createElement("a");H.href=W,H.download=se.filename,document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(W)}}catch(D){console.error("[PDF] Download failed:",D)}finally{k(!1)}}};return l||b?s.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"16px"},children:[s.jsx(he,{size:40,color:B,style:{animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{color:c.textSecondary,fontSize:"14px"},children:"Lade Report..."})]}):s.jsxs("div",{style:{minHeight:"100vh",background:c.pageBg},children:[s.jsx("div",{style:{background:N,padding:d?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[r&&s.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[s.jsx(yt,{size:16}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!d&&s.jsx(XP,{score:O,size:100,primaryAccent:B,isHeader:!0}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[s.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Live-Simulation"}),s.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:Zt(O,B)},children:qP(O)})]}),s.jsx("h1",{style:{fontSize:d?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:e?.title||w?.scenario_title||"bungssession"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Fn,{size:14}),KP(w?.created_at)]}),w?.duration&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Je,{size:14}),pt(w.duration)]})]})]}),!d&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[w?.id&&s.jsxs("button",{onClick:F,disabled:v,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:v?"wait":"pointer",color:"#fff",fontSize:"14px",fontWeight:500,opacity:v?.7:1},children:[v?s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}):s.jsx(gr,{size:16}),"PDF Export"]}),o&&s.jsxs("button",{onClick:o,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[s.jsx(Dt,{size:16}),"Erneut ben"]}),a&&s.jsx("button",{onClick:()=>x(!0),style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:"10px 16px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:s.jsx(We,{size:16})})]})]})]})}),s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:d?"16px":"24px 32px"},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:d?"1fr":"30fr 70fr",gap:"24px",alignItems:"start"},children:[s.jsxs("div",{style:{order:d?2:1},children:[s.jsx(QP,{transcript:E,scenario:e,primaryAccent:B,branding:c,onSeekToTime:M}),s.jsx("div",{style:{marginTop:"16px"},children:s.jsx(ZP,{audioUrl:P,duration:w?.duration,primaryAccent:B,branding:c,onSeek:u})})]}),s.jsxs("div",{style:{order:d?1:2},children:[s.jsxs("div",{style:{display:"flex",background:"#fff",borderRadius:"12px",padding:"4px",marginBottom:"16px",border:`1px solid ${c.borderColor}`},children:[s.jsx("button",{onClick:()=>p(Di.COACHING),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:h===Di.COACHING?B:"transparent",color:h===Di.COACHING?"#fff":c.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Coaching"}),s.jsx("button",{onClick:()=>p(Di.ANALYSEN),style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"none",background:h===Di.ANALYSEN?B:"transparent",color:h===Di.ANALYSEN?"#fff":c.textSecondary,fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Analysen"})]}),s.jsx(De,{mode:"wait",children:s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:h===Di.COACHING?s.jsx(e4,{feedback:T,audioAnalysis:I,primaryAccent:B,branding:c}):s.jsx(t4,{audioAnalysis:I,primaryAccent:B,branding:c,onJumpToTimestamp:M})},h)})]})]}),d&&s.jsxs("div",{style:{marginTop:"24px",display:"flex",flexDirection:"column",gap:"12px"},children:[w?.id&&s.jsxs("button",{onClick:F,disabled:v,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:B,border:"none",borderRadius:"12px",padding:"14px 24px",cursor:v?"wait":"pointer",color:"#fff",fontSize:"15px",fontWeight:600,opacity:v?.7:1},children:[v?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(gr,{size:18}),"PDF Export"]}),o&&s.jsxs("button",{onClick:o,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:c.cardBg,border:`1px solid ${c.borderColor}`,borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:c.textMain,fontSize:"15px",fontWeight:600},children:[s.jsx(Dt,{size:18}),"Erneut ben"]}),a&&s.jsxs("button",{onClick:()=>x(!0),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",background:"transparent",border:"1px solid #ef4444",borderRadius:"12px",padding:"14px 24px",cursor:"pointer",color:"#ef4444",fontSize:"15px",fontWeight:600},children:[s.jsx(We,{size:18}),"Session lschen"]})]})]}),s.jsx(De,{children:m&&s.jsxs(s.Fragment,{children:[s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>x(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3}}),s.jsx(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",zIndex:1001,boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:"rgba(239,68,68,0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:s.jsx(We,{size:24,color:"#ef4444"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:c.textMain,marginBottom:"8px"},children:"Session lschen?"}),s.jsx("p",{style:{fontSize:"14px",color:c.textSecondary,marginBottom:"24px"},children:"Diese Aktion kann nicht rckgngig gemacht werden. Dein Transkript und Feedback werden dauerhaft gelscht."}),s.jsxs("div",{style:{display:"flex",gap:"12px"},children:[s.jsx("button",{onClick:()=>x(!1),disabled:g,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:`1px solid ${c.borderColor}`,background:"#fff",color:c.textMain,fontSize:"14px",fontWeight:500,cursor:g?"not-allowed":"pointer",opacity:g?.5:1},children:"Abbrechen"}),s.jsx("button",{onClick:async()=>{if(!(!a||!w?.id)){y(!0);try{await a(w)}catch(D){console.error("Failed to delete session:",D)}finally{y(!1),x(!1)}}},disabled:g,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"none",background:"#ef4444",color:"#fff",fontSize:"14px",fontWeight:500,cursor:g?"not-allowed":"pointer",opacity:g?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:g?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):s.jsxs(s.Fragment,{children:[s.jsx(We,{size:16}),"Lschen"]})})]})]})})]})}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})},n4={"file-text":Nt,briefcase:Tn,banknote:is,users:mn,user:qt,"message-circle":ts,target:et,award:ni,book:Ro,clipboard:Io,star:nn,lightbulb:Ne,shield:Ii,compass:Ao,rocket:oi,calendar:Fn,sparkles:St,video:bt,mic:Fe,play:Dt,"check-circle":Ut,"alert-circle":ke,"help-circle":Ux,settings:ii,home:Nv,"trending-up":dn,"bar-chart":yj,"pie-chart":bj,activity:gj,zap:rl,heart:tl,"thumbs-up":jn,"message-square":Ye,mail:Aj,phone:Hr,"map-pin":_j,clock:Je,bell:mj,search:Ss,filter:ra,edit:Uj,trash:We,plus:At,minus:Pj,check:wn,x:Ot,info:un,warning:ss,refresh:zt,loader:he,globe:pu,link:Ij,bookmark:xj,tag:$j,code:Sj,database:kj,server:mu,pen:Mo,bot:el},i4={"file-text":Nt,briefcase:Tn,banknote:is,users:mn},av=(t,e=Nt)=>n4[t]||e,s4=t=>i4[t]||Nt,r4={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprchsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprchsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fhigkeiten",strengths:"Strken",challenges:"Herausforderungen"},o4=t=>r4[t]||t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),Td=(t,e)=>{if(!t)return null;const n=[];let i=t,r=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),a=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),l=i.match(/`([^`]+)`/),c=[{match:o,type:"bold"},{match:a,type:"italic"},{match:l,type:"code"}].filter(u=>u.match);if(c.length===0){n.push(i);break}const d=c.reduce((u,h)=>(u.match?.index??1/0)<(h.match?.index??1/0)?u:h);switch(d.match.index>0&&n.push(i.substring(0,d.match.index)),d.type){case"bold":n.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:d.match[1]},r++));break;case"italic":n.push(s.jsx("em",{style:{fontStyle:"italic"},children:d.match[1]||d.match[2]},r++));break;case"code":n.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:d.match[1]},r++));break}i=i.substring(d.match.index+d.match[0].length)}return n},lv=({content:t,primaryAccent:e})=>{if(!t)return null;const n=i=>{const r=i.split(`
`),o=[];let a=[],l=null;const c=()=>{a.length>0&&(o.push(s.jsx("ul",{style:{margin:"8px 0",paddingLeft:"20px",listStyle:"none"},children:a.map((d,u)=>s.jsxs("li",{style:{marginBottom:"6px",fontSize:"14px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"16px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:l==="number"?`${u+1}.`:""}),Td(d,e)]},u))},`list-${o.length}`)),a=[],l=null)};return r.forEach((d,u)=>{const h=d.trim();if(!h){c();return}if(h.startsWith("- ")||h.startsWith("* ")){l!=="bullet"&&(c(),l="bullet"),a.push(h.substring(2));return}const p=h.match(/^(\d+)\.\s/);if(p){l!=="number"&&(c(),l="number"),a.push(h.substring(p[0].length));return}c(),o.push(s.jsx("p",{style:{margin:"8px 0",fontSize:"14px",lineHeight:1.6,color:"#374151"},children:Td(h,e)},`p-${u}`))}),c(),o};return s.jsx("div",{children:n(t)})},Mg=({item:t,sectionId:e,primaryAccent:n,onUpdateItem:i,branding:r})=>{const[o,a]=f.useState(t.user_note||""),[l,c]=f.useState(!1),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!!t.user_note);f.useEffect(()=>{p(o!==(t.user_note||""))},[o,t.user_note]);const g=async()=>{c(!0);try{await i(e,t.id,{user_note:o}),u(!0),p(!1),setTimeout(()=>u(!1),2e3)}catch(k){console.error("Error saving note:",k)}finally{c(!1)}},y=async()=>{try{await i(e,t.id,{deleted:!0})}catch(k){console.error("Error deleting item:",k)}},v=async()=>{try{await i(e,t.id,{deleted:!1})}catch(k){console.error("Error restoring item:",k)}};return t.deleted?s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderRadius:"10px",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:.6},children:[s.jsxs("span",{style:{fontSize:"14px",color:r.textMuted,fontStyle:"italic"},children:[s.jsx("s",{children:t.label})," - gelscht"]}),s.jsxs("button",{onClick:v,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",borderRadius:"6px",border:"none",backgroundColor:r.borderColor,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:[s.jsx(Si,{size:12}),"Wiederherstellen"]})]}):s.jsxs("div",{style:{backgroundColor:r.cardBg,borderRadius:"12px",border:`1px solid ${r.borderColor}`,marginBottom:"10px",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"14px 16px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:n,flexShrink:0}}),s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:r.textMain,margin:0},children:t.label})]}),t.content&&s.jsx("p",{style:{fontSize:"13px",color:r.textMuted,margin:"0 0 0 14px",lineHeight:1.5},children:Td(t.content,n)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",flexShrink:0},children:[t.user_note&&!m&&s.jsx("span",{style:{fontSize:"11px",color:n,backgroundColor:`${n}15`,padding:"2px 6px",borderRadius:"4px"},children:"Notiz"}),s.jsx("button",{onClick:()=>x(!m),title:"Notiz hinzufgen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:m?`${n}15`:"transparent",color:m?n:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Mo,{size:16})}),s.jsx("button",{onClick:y,title:"Lschen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:r.textMuted,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{size:16})})]})]}),m&&s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.cardBgHover,borderTop:`1px solid ${r.borderColor}`},children:[s.jsx("textarea",{value:o,onChange:k=>a(k.target.value),placeholder:"Deine Notiz zu diesem Punkt...",style:{width:"100%",minHeight:"60px",padding:"10px",borderRadius:"8px",border:`1px solid ${r.borderColor}`,fontSize:"13px",color:r.textSecondary,resize:"vertical",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:k=>{k.target.style.borderColor=n},onBlur:k=>{k.target.style.borderColor=r.borderColor}}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"8px",gap:"8px"},children:[s.jsx("button",{onClick:()=>{x(!1),a(t.user_note||"")},style:{padding:"6px 12px",borderRadius:"6px",border:`1px solid ${r.borderColor}`,backgroundColor:r.cardBg,color:r.textMuted,fontSize:"12px",cursor:"pointer"},children:"Abbrechen"}),s.jsxs("button",{onClick:g,disabled:l||!h,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:d?r.successLight:h?n:r.cardBgHover,color:d?r.success:h?"white":r.textMuted,fontSize:"12px",fontWeight:500,cursor:h&&!l?"pointer":"default"},children:[l?s.jsx(he,{size:12,style:{animation:"spin 1s linear infinite"}}):d?s.jsx(wn,{size:12}):s.jsx(gu,{size:12}),d?"Gespeichert!":"Speichern"]})]})]}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},a4=({section:t,primaryAccent:e,onUpdateItem:n,onGenerateMore:i,isExpanded:r,onToggle:o,branding:a})=>{const[l,c]=f.useState(!1),d=async()=>{c(!0);try{await i(t.id)}catch(v){console.error("Error generating more items:",v)}finally{c(!1)}},u=f.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const v=JSON.parse(t.ai_content);if(v&&Array.isArray(v.items))return{type:"items",items:v.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:h,items:p,content:m}=u(),x=p.filter(v=>!v.deleted),g=p.filter(v=>v.deleted),y=p.some(v=>v.user_note&&!v.deleted);return s.jsxs("div",{style:{backgroundColor:a.cardBgColor,borderRadius:a.radius.xl,boxShadow:a.shadow.xs,overflow:"hidden",marginBottom:a.space[4]},children:[s.jsxs("button",{onClick:o,style:{width:"100%",padding:`${a.space[4]} ${a.space[5]}`,display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:a.space[2],border:"none",background:"none",cursor:"pointer",borderBottom:r?`1px solid ${a.borderColorLight}`:"none"},children:[s.jsx("h3",{style:{fontSize:a.fontSize.lg,fontWeight:a.fontWeight.semibold,color:a.textMain,margin:0,textAlign:"left",flex:1,minWidth:0,wordBreak:"break-word",lineHeight:1.3},children:t.section_title}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2],flexShrink:0,flexWrap:"wrap",justifyContent:"flex-end"},children:[h==="items"&&s.jsxs("span",{style:{fontSize:a.fontSize.xs,color:a.textMuted,backgroundColor:a.borderColorLight,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[x.length," Punkte"]}),y&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:a.space[1],fontSize:a.fontSize.xs,color:e,backgroundColor:`${e}15`,padding:`${a.space[1]} ${a.space[2]}`,borderRadius:a.radius.lg},children:[s.jsx(Mo,{size:a.iconSize.xs}),"Notizen"]}),r?s.jsx(Yn,{size:a.iconSize.lg,style:{color:a.textMuted}}):s.jsx(ct,{size:a.iconSize.lg,style:{color:a.textMuted}})]})]}),r&&s.jsx("div",{style:{padding:`${a.space[4]} ${a.space[5]}`},children:h==="items"?s.jsxs(s.Fragment,{children:[x.map(v=>s.jsx(Mg,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id)),i&&s.jsx("button",{onClick:d,disabled:l,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px 16px",marginTop:"12px",marginBottom:"8px",borderRadius:"10px",border:`1px dashed ${e}40`,backgroundColor:`${e}08`,color:e,fontSize:"13px",fontWeight:500,cursor:l?"wait":"pointer",transition:"all 0.2s"},onMouseEnter:v=>{l||(v.currentTarget.style.backgroundColor=`${e}15`,v.currentTarget.style.borderColor=`${e}60`)},onMouseLeave:v=>{v.currentTarget.style.backgroundColor=`${e}08`,v.currentTarget.style.borderColor=`${e}40`},children:l?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}),"Generiere 5 weitere Punkte..."]}):s.jsxs(s.Fragment,{children:[s.jsx(St,{size:16}),"5 weitere Punkte generieren"]})}),g.length>0&&s.jsxs("div",{style:{marginTop:"16px"},children:[s.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(We,{size:12}),g.length," gelschte ",g.length===1?"Punkt":"Punkte"]}),g.map(v=>s.jsx(Mg,{item:v,sectionId:t.id,primaryAccent:e,onUpdateItem:n,branding:a},v.id))]})]}):h==="markdown"?s.jsxs("div",{style:{backgroundColor:"#f8fafc",padding:"16px",borderRadius:"10px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx(el,{size:16,style:{color:e}}),s.jsx("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.5px"},children:"KI-Empfehlung"})]}),s.jsx(lv,{content:m,primaryAccent:e})]}):s.jsx("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Kein Inhalt verfgbar"})})]})},cv=({briefing:t,onBack:e,onDelete:n})=>{const{config:i}=Ue(),r=Ve(),o=Un(),[a,l]=f.useState(t),[c,d]=f.useState(!t?.sections),[u,h]=f.useState(null),[p,m]=f.useState({}),[x,g]=f.useState(!1),[y,v]=f.useState(!1),[k,S]=f.useState(!1),[C,b]=f.useState(!1),j=r.primaryAccent,w=r.headerGradient,T=av(a?.template_icon)||Nt;f.useEffect(()=>{const B=async()=>{if(a?.sections){const N={};a.sections.forEach(M=>{N[M.id]=!0}),m(N),d(!1);return}try{d(!0);const N=await ue.request(`/smartbriefing/briefings/${a.id}`,{method:"GET"});if(N.success&&N.data?.briefing){l(N.data.briefing);const M={};N.data.briefing.sections?.forEach(F=>{M[F.id]=!0}),m(M)}else throw new Error("Fehler beim Laden des Briefings")}catch(N){console.error("[SmartBriefing] Error fetching briefing:",N),h(N.message)}finally{d(!1)}};a?.id&&B()},[a?.id]);const I=f.useCallback(B=>{m(N=>({...N,[B]:!N[B]}))},[]),E=f.useCallback(async(B,N,M)=>{const F=await ue.request(`/smartbriefing/sections/${B}/items/${N}`,{method:"PATCH",body:JSON.stringify(M)});if(!F.success)throw new Error("Fehler beim Speichern");l($=>({...$,sections:$.sections.map(D=>D.id===B?F.data.section:D)}))},[]),P=f.useCallback(async B=>{const N=await ue.request(`/smartbriefing/sections/${B}/generate-more`,{method:"POST"});if(!N.success)throw new Error(N.message||"Fehler beim Generieren");return l(M=>({...M,sections:M.sections.map(F=>F.id===B?N.data.section:F)})),N.data.new_items_count},[]),O=f.useCallback(async()=>{if(!(C||!a?.id)){b(!0);try{const B=await ue.request(`/smartbriefing/briefings/${a.id}/pdf`,{method:"GET"});if(!B.success||!B.data?.pdf_base64)throw new Error(B.message||"PDF-Export fehlgeschlagen");const N=atob(B.data.pdf_base64),M=new Array(N.length);for(let L=0;L<N.length;L++)M[L]=N.charCodeAt(L);const F=new Uint8Array(M),$=new Blob([F],{type:"application/pdf"}),D=window.URL.createObjectURL($),z=document.createElement("a");z.href=D,z.download=B.data.filename||"Smart-Briefing.pdf",document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(D)}catch(B){console.error("[SmartBriefing] PDF download error:",B)}finally{b(!1)}}},[a?.id,C]);return a?s.jsxs("div",{style:{minHeight:"100vh",background:r.pageBg},children:[s.jsx("div",{style:{background:w,padding:o?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[e&&s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[s.jsx(yt,{size:16}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px"},children:[!o&&s.jsx("div",{style:{width:90,height:90,borderRadius:"50%",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(T,{size:40,color:"#fff"})}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[s.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Smart Briefing"}),s.jsx("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:j},children:a.template_title})]}),s.jsx("h1",{style:{fontSize:o?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:a.title||"Briefing"}),s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Fn,{size:14}),Ji(a.created_at)]})})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexShrink:0},children:[s.jsx("button",{onClick:O,disabled:C,title:"Als PDF herunterladen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 12px",cursor:C?"not-allowed":"pointer",color:"#fff",opacity:C?.6:1,outline:"none",WebkitAppearance:"none"},children:C?s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}):s.jsx(gr,{size:16})}),n&&s.jsx("button",{onClick:()=>v(!0),title:"Briefing loschen",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:"10px",padding:"10px 12px",cursor:"pointer",color:"#fff",outline:"none",WebkitAppearance:"none"},children:s.jsx(We,{size:16})})]})]})]})}),s.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto",padding:o?"16px":"24px 32px"},children:[a.variables&&Object.keys(a.variables).length>0&&s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"16px 20px",marginBottom:"20px",border:`1px solid ${r.borderColor}`},children:[s.jsxs("button",{onClick:()=>g(!x),style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"0",border:"none",background:"none",cursor:"pointer"},children:[s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textMain},children:["Deine Angaben (",Object.keys(a.variables).length,")"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r.textMuted},children:[s.jsx("span",{style:{fontSize:"12px"},children:x?"Einklappen":"Ausklappen"}),x?s.jsx(Yn,{size:16}):s.jsx(ct,{size:16})]})]}),x&&s.jsx("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.borderColor}`,display:"flex",flexWrap:"wrap",gap:"8px"},children:Object.entries(a.variables).map(([B,N])=>s.jsxs("span",{style:{backgroundColor:r.cardBgHover,padding:"6px 12px",borderRadius:"20px",fontSize:"12px",color:r.textSecondary},children:[s.jsxs("strong",{style:{color:r.textMain},children:[o4(B),":"]})," ",N]},B))})]}),c&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(he,{size:40,style:{color:j,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefing wird geladen..."})]}),u&&!c&&s.jsx("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",textAlign:"center"},children:s.jsx("p",{style:{color:"#dc2626",margin:0},children:u})}),!c&&!u&&a.sections&&s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(St,{size:18,style:{color:j}}),s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:"Briefing-Inhalte"}),s.jsxs("span",{style:{fontSize:"13px",color:"#94a3b8"},children:["(",a.sections.length," Abschnitte)"]})]}),a.sections.map(B=>s.jsx(a4,{section:B,primaryAccent:j,onUpdateItem:E,onGenerateMore:P,isExpanded:p[B.id],onToggle:()=>I(B.id),branding:r},B.id))]}),!c&&!u&&(!a.sections||a.sections.length===0)&&a.content_markdown&&s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsx(lv,{content:a.content_markdown,primaryAccent:j})}),s.jsx("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${j}08`,borderRadius:"12px",border:`1px solid ${j}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ne,{size:18,style:{color:j,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"Tipp: Personalisiere dein Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.5},children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufgen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),s.jsx(De,{children:y&&s.jsxs(s.Fragment,{children:[s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>v(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:1e3}}),s.jsx(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",zIndex:1001,boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",background:"rgba(239,68,68,0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:s.jsx(We,{size:24,color:"#ef4444"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:r.textMain,marginBottom:"8px"},children:"Briefing lschen?"}),s.jsx("p",{style:{fontSize:"14px",color:r.textSecondary,marginBottom:"24px"},children:"Diese Aktion kann nicht rckgngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelscht."}),s.jsxs("div",{style:{display:"flex",gap:"12px"},children:[s.jsx("button",{onClick:()=>v(!1),disabled:k,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:`1px solid ${r.borderColor}`,background:"#fff",color:r.textMain,fontSize:"14px",fontWeight:500,cursor:k?"not-allowed":"pointer",opacity:k?.5:1,outline:"none",WebkitAppearance:"none"},children:"Abbrechen"}),s.jsx("button",{onClick:async()=>{if(!(!n||!a?.id)){S(!0);try{await n(a)}catch(B){console.error("Failed to delete briefing:",B)}finally{S(!1),v(!1)}}},disabled:k,style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"none",background:"#ef4444",color:"#fff",fontSize:"14px",fontWeight:500,cursor:k?"not-allowed":"pointer",opacity:k?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",outline:"none",WebkitAppearance:"none"},children:k?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):s.jsxs(s.Fragment,{children:[s.jsx(We,{size:16}),"Lschen"]})})]})]})})]})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):null},Pg=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Ng=Y0,dv=(t,e)=>n=>{var i;if(e?.variants==null)return Ng(t,n?.class,n?.className);const{variants:r,defaultVariants:o}=e,a=Object.keys(r).map(d=>{const u=n?.[d],h=o?.[d];if(u===null)return null;const p=Pg(u)||Pg(h);return r[d][p]}),l=n&&Object.entries(n).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((d,u)=>{let{class:h,className:p,...m}=u;return Object.entries(m).every(x=>{let[g,y]=x;return Array.isArray(y)?y.includes({...o,...l}[g]):{...o,...l}[g]===y})?[...d,h,p]:d},[]);return Ng(t,a,c,n?.class,n?.className)},l4=dv("rounded-xl border bg-white",{variants:{variant:{default:"border-slate-200",elevated:"border-slate-200 shadow-xl",outline:"border-ocean-blue-200",ghost:"border-transparent bg-transparent",gradient:"border-ocean-blue-100 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50",ocean:"border-ocean-blue-200 bg-ocean-blue-50"},padding:{none:"p-0",sm:"p-3",default:"p-4",lg:"p-6"}},defaultVariants:{variant:"default",padding:"default"}}),He=f.forwardRef(({className:t,variant:e,padding:n,...i},r)=>s.jsx("div",{ref:r,className:ot(l4({variant:e,padding:n,className:t})),...i}));He.displayName="Card";const qn=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:ot("flex items-center justify-between mb-3",t),...e}));qn.displayName="CardHeader";const c4=dv("flex items-center gap-2",{variants:{size:{sm:"text-sm",default:"text-base",lg:"text-lg"}},defaultVariants:{size:"sm"}}),Rs=f.forwardRef(({className:t,size:e,icon:n,iconColor:i,children:r,...o},a)=>s.jsxs("div",{ref:a,className:ot(c4({size:e,className:t})),...o,children:[n&&s.jsx(n,{className:ot("w-4 h-4",i)}),s.jsx("span",{className:"font-semibold text-slate-800",children:r})]}));Rs.displayName="CardTitle";const uv=f.forwardRef(({className:t,...e},n)=>s.jsx("p",{ref:n,className:ot("text-sm text-slate-500",t),...e}));uv.displayName="CardDescription";const Qe=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:ot("",t),...e}));Qe.displayName="CardContent";const d4=f.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:ot("mt-3 pt-3 border-t border-slate-100",t),...e}));d4.displayName="CardFooter";const en=f.forwardRef(({className:t,type:e,...n},i)=>s.jsx("input",{type:e,className:ot("flex h-11 w-full rounded-xl border-2 bg-white px-4 py-2 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","file:border-0 file:bg-ocean-blue-50 file:text-ocean-blue-700 file:text-sm file:font-medium file:mr-4 file:px-4 file:py-2 file:rounded-lg","hover:border-slate-300","transition-all duration-200",t),ref:i,...n}));en.displayName="Input";const vi=f.forwardRef(({className:t,...e},n)=>s.jsx("textarea",{className:ot("flex min-h-[100px] w-full rounded-xl border-2 bg-white px-4 py-3 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","hover:border-slate-300","resize-none","transition-all duration-200",t),ref:n,...e}));vi.displayName="Textarea";const Is=({isOpen:t,onClose:e,onConfirm:n,title:i="Lschen besttigen",description:r="Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:o=!1,confirmLabel:a="Lschen",cancelLabel:l="Abbrechen"})=>{const{branding:c}=Ue(),d=c?.["--primary-accent"]||Ie["--primary-accent"];return s.jsx(Xn,{open:t,onOpenChange:e,children:s.jsxs(Zn,{style:{maxWidth:"400px"},children:[s.jsxs(Qn,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{style:{width:"20px",height:"20px",color:"#fff"}})}),s.jsx(ei,{children:i})]}),s.jsx(wi,{children:r})]}),s.jsxs(Ci,{style:{marginTop:"16px"},children:[s.jsx("button",{onClick:e,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:`2px solid ${d}`,backgroundColor:"white",color:d,fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s"},children:l}),s.jsx("button",{onClick:n,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:o?s.jsxs(s.Fragment,{children:[s.jsx(he,{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"}}),a,"..."]}):a})]})]})})},Dg=()=>`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,zg=({value:t,onChange:e,color:n,disabled:i})=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",width:"100px"},children:[s.jsx("input",{type:"range",min:"1",max:"10",value:t,onChange:r=>e(parseInt(r.target.value)),disabled:i,style:{flex:1,height:"6px",borderRadius:"3px",background:`linear-gradient(90deg, ${n==="green"?"#22c55e":"#ef4444"} 0%, ${n==="green"?"#22c55e":"#ef4444"} ${(t-1)*11.1}%, #e2e8f0 ${(t-1)*11.1}%, #e2e8f0 100%)`,appearance:"none",cursor:i?"not-allowed":"pointer",opacity:i?.6:1}}),s.jsx("span",{style:{minWidth:"28px",textAlign:"center",fontWeight:600,fontSize:"13px",color:n==="green"?"#16a34a":"#dc2626",backgroundColor:n==="green"?"#dcfce7":"#fee2e2",padding:"2px 6px",borderRadius:"6px"},children:t})]}),u4=({proScore:t,contraScore:e})=>{const n=t+e,i=n>0?Math.round(t/n*100):50,r=100-i;return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"14px",fontWeight:600},children:[s.jsxs("span",{style:{color:"#16a34a"},children:["Pro: ",t," Punkte (",i,"%)"]}),s.jsxs("span",{style:{color:"#dc2626"},children:["Contra: ",e," Punkte (",r,"%)"]})]}),s.jsxs("div",{style:{height:"24px",borderRadius:"12px",overflow:"hidden",display:"flex",backgroundColor:"#f1f5f9",boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:[s.jsx(V.div,{initial:{width:0},animate:{width:`${i}%`},transition:{duration:.5,ease:"easeOut"},style:{background:"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:600,fontSize:"12px",minWidth:i>10?"auto":"0"},children:i>15&&`${i}%`}),s.jsx(V.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"},style:{background:"linear-gradient(90deg, #ef4444 0%, #dc2626 100%)",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:600,fontSize:"12px",minWidth:r>10?"auto":"0"},children:r>15&&`${r}%`})]})]})},Og=({item:t,onUpdate:e,onDelete:n,color:i,isEditing:r,autoFocus:o,onAddNew:a})=>{const l=c=>{c.key==="Enter"&&!c.shiftKey&&r&&(c.preventDefault(),t.text.trim()&&a&&a())};return r?s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:i==="green"?-20:20},style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"10px",padding:"12px",backgroundColor:i==="green"?"#f0fdf4":"#fef2f2",borderRadius:"12px",border:`1px solid ${i==="green"?"#bbf7d0":"#fecaca"}`},children:[s.jsx(en,{value:t.text,onChange:c=>e(t.id,{text:c.target.value}),onKeyDown:l,autoFocus:o,placeholder:i==="green"?"Pro-Argument...":"Contra-Argument...",style:{flex:"1 1 200px",minWidth:"0",backgroundColor:"white",border:`1px solid ${i==="green"?"#86efac":"#fca5a5"}`}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[s.jsx(zg,{value:t.weight,onChange:c=>e(t.id,{weight:c}),color:i}),s.jsx("button",{onClick:()=>n(t.id),style:{padding:"8px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",color:"#94a3b8"},children:s.jsx(We,{size:18})})]})]}):s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:i==="green"?"#f0fdf4":"#fef2f2",borderRadius:"10px",border:`1px solid ${i==="green"?"#bbf7d0":"#fecaca"}`},children:[s.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"6px",backgroundColor:i==="green"?"#dcfce7":"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i==="green"?s.jsx(jn,{size:14,color:"#16a34a"}):s.jsx(Ei,{size:14,color:"#dc2626"})}),s.jsx("span",{style:{flex:1,fontSize:"14px",color:"#334155",lineHeight:1.4},children:t.text}),s.jsx(zg,{value:t.weight,onChange:()=>{},color:i,disabled:!0})]})},h4=({card:t})=>{const n=(i=>{switch(i){case"blind_spot":return{bg:"#fef3c7",border:"#fcd34d",icon:"",color:"#b45309"};case"reframe":return{bg:"#dbeafe",border:"#93c5fd",icon:"",color:"#1d4ed8"};case"question":return{bg:"#f3e8ff",border:"#c4b5fd",icon:"",color:"#7c3aed"};case"action":return{bg:"#dcfce7",border:"#86efac",icon:"",color:"#15803d"};default:return{bg:"#f1f5f9",border:"#cbd5e1",icon:"",color:"#475569"}}})(t.type);return s.jsx("div",{style:{padding:"16px",backgroundColor:n.bg,borderRadius:"12px",border:`1px solid ${n.border}`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx("span",{style:{fontSize:"20px"},children:n.icon}),s.jsxs("div",{style:{flex:1},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:n.color,marginBottom:"6px"},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:"#334155",lineHeight:1.5,margin:0},children:t.content})]})]})})},p4=({decision:t,onBack:e,onDelete:n,onUpdate:i})=>{const{branding:r}=Ue();Ve();const[o,a]=f.useState(!1),[l,c]=f.useState(!1),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(null),[g,y]=f.useState(!1),[v,k]=f.useState(null),[S,C]=f.useState(t.topic||""),[b,j]=f.useState(t.context||""),[w,T]=f.useState(t.pros||[]),[I,E]=f.useState(t.cons||[]);r?.["--primary-accent"];const P=r?.["--header-gradient"]||"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",O=f.useMemo(()=>w.reduce((G,q)=>G+(q.text?.trim()?q.weight||5:0),0),[w]),B=f.useMemo(()=>I.reduce((G,q)=>G+(q.text?.trim()?q.weight||5:0),0),[I]),N=f.useCallback(()=>{const G=Dg();T(q=>[...q,{id:G,text:"",weight:5}]),k(G)},[]),M=f.useCallback(()=>{const G=Dg();E(q=>[...q,{id:G,text:"",weight:5}]),k(G)},[]),F=f.useCallback((G,q)=>{T(ie=>ie.map(A=>A.id===G?{...A,...q}:A))},[]),$=f.useCallback((G,q)=>{E(ie=>ie.map(A=>A.id===G?{...A,...q}:A))},[]),D=f.useCallback(G=>{T(q=>q.filter(ie=>ie.id!==G))},[]),z=f.useCallback(G=>{E(q=>q.filter(ie=>ie.id!==G))},[]),L=()=>{C(t.topic||""),j(t.context||""),T(t.pros||[]),E(t.cons||[]),a(!1),x(null)},ee=async()=>{c(!0),x(null);try{const G=w.filter(W=>W.text?.trim()),q=I.filter(W=>W.text?.trim()),ie={topic:S.trim(),context:b.trim()||null,pros:G,cons:q,pro_score:O,contra_score:B},A=await ue.updateDecision(t.id,ie);if(A.success){const W={...t,...ie};i?.(W),a(!1),y(!0),setTimeout(()=>y(!1),2e3)}else throw new Error(A.message||"Fehler beim Speichern")}catch(G){console.error("Failed to save decision:",G),x(G.message||"Fehler beim Speichern")}finally{c(!1)}},se=async()=>{p(!0);try{await n(t.id),e()}catch(G){console.error("Failed to delete decision:",G),x(G.message||"Fehler beim Lschen")}finally{p(!1),u(!1)}};return s.jsxs("div",{style:{padding:"16px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"24px",flexWrap:"wrap",gap:"12px"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:"transparent",border:"1px solid #e2e8f0",borderRadius:"10px",cursor:"pointer",color:"#64748b",fontSize:"14px",fontWeight:500},children:[s.jsx(Qr,{size:18}),"Zurck"]}),s.jsx("div",{style:{display:"flex",gap:"8px"},children:o?s.jsxs(s.Fragment,{children:[s.jsxs(ce,{variant:"outline",onClick:L,disabled:l,children:[s.jsx(Ot,{size:16,style:{marginRight:"6px"}}),"Abbrechen"]}),s.jsxs(ce,{onClick:ee,disabled:l,style:{background:P},children:[l?s.jsx(he,{size:16,style:{marginRight:"6px",animation:"spin 1s linear infinite"}}):s.jsx(gu,{size:16,style:{marginRight:"6px"}}),"Speichern"]})]}):s.jsxs(s.Fragment,{children:[s.jsxs(ce,{variant:"outline",onClick:()=>a(!0),children:[s.jsx(Mo,{size:16,style:{marginRight:"6px"}}),"Bearbeiten"]}),s.jsxs(ce,{variant:"outline",onClick:()=>u(!0),style:{borderColor:"#fecaca",color:"#dc2626"},children:[s.jsx(We,{size:16,style:{marginRight:"6px"}}),"Lschen"]})]})})]}),s.jsx(De,{children:g&&s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"12px",marginBottom:"16px",color:"#16a34a"},children:[s.jsx(Ut,{size:20}),s.jsx("span",{children:"nderungen erfolgreich gespeichert!"})]})}),s.jsx(De,{children:m&&s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",marginBottom:"16px",color:"#dc2626"},children:[s.jsx(ke,{size:20}),s.jsx("span",{children:m})]})}),s.jsx(He,{variant:"elevated",padding:"lg",style:{marginBottom:"16px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:P,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Ln,{size:28,color:"white"})}),s.jsx("div",{style:{flex:1},children:o?s.jsxs(s.Fragment,{children:[s.jsx(en,{value:S,onChange:G=>C(G.target.value),placeholder:"Entscheidungsfrage...",style:{fontSize:"18px",fontWeight:600,marginBottom:"8px"}}),s.jsx(vi,{value:b,onChange:G=>j(G.target.value),placeholder:"Kontext / Situationsbeschreibung...",rows:2,style:{fontSize:"14px"}})]}):s.jsxs(s.Fragment,{children:[s.jsx("h1",{style:{fontSize:"20px",fontWeight:700,color:"#1e293b",marginBottom:"4px",lineHeight:1.3},children:t.topic}),t.context&&s.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:t.context}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"#94a3b8"},children:[s.jsx(Fn,{size:14}),Ji(t.created_at)]})]})})]})}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 380px), 1fr))",gap:"16px",marginBottom:"24px"},children:[s.jsxs(He,{variant:"elevated",padding:"lg",style:{borderTop:"4px solid #22c55e"},children:[s.jsx(qn,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(jn,{size:20,color:"#16a34a"})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#16a34a",margin:0},children:"PRO"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[w.filter(G=>G.text?.trim()).length," Argumente"]})]})]})}),s.jsx(Qe,{children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[s.jsx(De,{mode:"popLayout",children:w.map(G=>s.jsx(Og,{item:G,onUpdate:F,onDelete:D,onAddNew:N,color:"green",isEditing:o,autoFocus:v===G.id},G.id))}),o&&s.jsxs(ce,{variant:"outline",onClick:N,style:{borderColor:"#22c55e",color:"#16a34a",borderStyle:"dashed"},children:[s.jsx(At,{size:18,style:{marginRight:"8px"}}),"Argument hinzufgen"]})]})})]}),s.jsxs(He,{variant:"elevated",padding:"lg",style:{borderTop:"4px solid #ef4444"},children:[s.jsx(qn,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ei,{size:20,color:"#dc2626"})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#dc2626",margin:0},children:"CONTRA"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[I.filter(G=>G.text?.trim()).length," Argumente"]})]})]})}),s.jsx(Qe,{children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[s.jsx(De,{mode:"popLayout",children:I.map(G=>s.jsx(Og,{item:G,onUpdate:$,onDelete:z,onAddNew:M,color:"red",isEditing:o,autoFocus:v===G.id},G.id))}),o&&s.jsxs(ce,{variant:"outline",onClick:M,style:{borderColor:"#ef4444",color:"#dc2626",borderStyle:"dashed"},children:[s.jsx(At,{size:18,style:{marginRight:"8px"}}),"Argument hinzufgen"]})]})})]})]}),s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:"24px"},children:[s.jsx(qn,{children:s.jsx(Rs,{icon:Ln,size:"md",children:"Rationaler Score"})}),s.jsx(Qe,{children:s.jsx(u4,{proScore:O,contraScore:B})})]}),t.analysis&&s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:"24px"},children:[s.jsx(qn,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:P,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(St,{size:20,color:"white"})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#1e293b",margin:0},children:"KI-Analyse"}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Coaching-Impulse fr deine Entscheidung"})]})]})}),s.jsxs(Qe,{children:[t.analysis.recommendation&&s.jsx("div",{style:{padding:"16px",backgroundColor:"#f8fafc",borderRadius:"12px",marginBottom:"16px",border:"1px solid #e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ne,{size:20,color:"#8b5cf6",style:{flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:"#8b5cf6",marginBottom:"4px"},children:"Empfehlung"}),s.jsx("p",{style:{fontSize:"15px",color:"#334155",lineHeight:1.5,margin:0},children:t.analysis.recommendation})]})]})}),t.analysis.coaching_cards&&t.analysis.coaching_cards.length>0&&s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:t.analysis.coaching_cards.map((G,q)=>s.jsx(h4,{card:G},q))})]})]}),s.jsx(Is,{isOpen:d,onClose:()=>u(!1),onConfirm:se,title:"Entscheidung lschen",description:"Mchtest du diese Entscheidung wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:h}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }

          input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }
        `})]})},f4=({briefing:t,onClick:e,onDelete:n,headerGradient:i,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=Un(900),h=s4(t.template_icon),p=x=>{x.stopPropagation(),d(!0)},m=async()=>{l(!0);try{await n(t.id),d(!1)}catch(x){console.error("Error deleting briefing:",x)}finally{l(!1)}};return u?s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[s.jsxs("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(h,{style:{width:"22px",height:"22px",color:o}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.title||"Briefing"}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Ji(t.created_at)})]}),s.jsx("button",{onClick:p,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"4px 10px",borderRadius:"10px",fontSize:"12px",fontWeight:500,maxWidth:"70%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.template_title}),s.jsx(Kt,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),s.jsx(Is,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:x=>{x.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",x.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:x=>{x.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",x.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(h,{style:{width:"24px",height:"24px",color:o}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title||"Briefing"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"2px 8px",borderRadius:"10px",fontSize:"12px",fontWeight:500},children:t.template_title}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Fn,{size:14}),Ji(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[s.jsx("button",{onClick:p,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})}),s.jsx(Kt,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(Is,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},ui={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},g4=({session:t,type:e,scenario:n,onClick:i,onContinueSession:r,onDeleteSession:o,headerGradient:a,headerText:l,primaryAccent:c})=>{const[d,u]=f.useState(!1),[h,p]=f.useState(!1),m=Un(900),x=()=>{let N=null;if(e===ui.SIMULATOR)N=t.overall_score||t.average_score;else if(e===ui.VIDEO)N=t.overall_score;else if(t.feedback_json)try{let M=t.feedback_json;if(typeof M=="string"){let F=M.trim();F.startsWith("```json")?F=F.replace(/```json\s*/g,"").replace(/```\s*$/g,""):F.startsWith("```")&&(F=F.replace(/```\s*/g,"").replace(/```\s*$/g,"")),M=JSON.parse(F)}N=M.rating?.overall||null}catch{N=null}return N==null||isNaN(N)||N===0?null:N},g=()=>e===ui.SIMULATOR||e===ui.VIDEO?t.status:t.feedback_json?"completed":"pending",y=x(),k=g()==="completed",S=t.total_questions>0&&(t.completed_questions||0)<t.total_questions,C=e===ui.SIMULATOR&&S,b=()=>{if(!C)return null;const N=t.completed_questions||0,M=t.total_questions||0;return`${N}/${M} Fragen`},j=N=>{N.stopPropagation(),r&&r(t,n)},w=N=>{N.stopPropagation(),p(!0)},T=async()=>{u(!0);try{await o(t,e),p(!1)}catch(N){console.error("Error deleting session:",N)}finally{u(!1)}},E=(()=>{if(y==null||isNaN(y))return null;if(e===ui.SIMULATOR||e===ui.ROLEPLAY){const N=y<=10?y*10:y;return isNaN(N)?null:N}return isNaN(y)?null:y})(),P=N=>{if(!N&&N!==0)return{background:"#f1f5f9",color:"#64748b"};const M=parseFloat(N);return M>=80?{background:"#dcfce7",color:"#166534"}:M>=60?{background:"#fef9c3",color:"#854d0e"}:{background:"#fee2e2",color:"#991b1b"}},B=(()=>{switch(e){case ui.SIMULATOR:return et;case ui.VIDEO:return bt;default:return Ye}})();return m?s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[s.jsxs("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(B,{style:{width:"22px",height:"22px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Ji(t.created_at)})]}),o&&s.jsx("button",{onClick:w,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:d?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[!k&&!C&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(Je,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"5px 10px",borderRadius:"20px",fontSize:"13px",fontWeight:600,...P(E)},children:[s.jsx(nn,{size:13}),E!==null?`${Math.round(E)}%`:"-- %"]}),(t.duration||t.video_duration_seconds)&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#64748b"},children:[s.jsx(Je,{size:12}),pt(t.duration||t.video_duration_seconds)]}),C&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()})]}),C&&r?s.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,flexShrink:0},children:[s.jsx(Dt,{size:14}),"Fortsetzen"]}):s.jsx(Kt,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),s.jsx(Is,{isOpen:h,onClose:()=>p(!1),onConfirm:T,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]}):s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:N=>{N.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",N.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:N=>{N.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",N.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(B,{style:{width:"24px",height:"24px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Fn,{size:14}),Ji(t.created_at)]}),t.duration||t.video_duration_seconds?s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Je,{size:14}),pt(t.duration||t.video_duration_seconds)]}):null]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},children:[C&&r&&s.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,transition:"all 0.2s"},onMouseEnter:N=>{N.currentTarget.style.transform="scale(1.02)",N.currentTarget.style.boxShadow=`0 4px 12px ${c||"#3B82F6"}50`},onMouseLeave:N=>{N.currentTarget.style.transform="scale(1)",N.currentTarget.style.boxShadow=`0 2px 8px ${c||"#3B82F6"}40`},children:[s.jsx(Dt,{size:14}),"Fortsetzen"]}),C&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:b()}),!k&&!C&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(Je,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"20px",fontSize:"14px",fontWeight:600,...P(E)},children:[s.jsx(nn,{size:14}),E!==null?`${Math.round(E)}%`:"-- %"]}),o&&s.jsx("button",{onClick:w,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:N=>{N.currentTarget.style.color="#ef4444"},onMouseLeave:N=>{N.currentTarget.style.color="#94a3b8"},title:"Lschen",children:d?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})}),s.jsx(Kt,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(Is,{isOpen:h,onClose:()=>p(!1),onConfirm:T,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]})},Lg=({proScore:t,contraScore:e})=>{const n=t+e,i=n>0?Math.round(t/n*100):50;return s.jsxs("div",{style:{height:"6px",borderRadius:"3px",overflow:"hidden",display:"flex",backgroundColor:"#f1f5f9",width:"100%",maxWidth:"120px"},children:[s.jsx("div",{style:{background:"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)",width:`${i}%`,height:"100%"}}),s.jsx("div",{style:{background:"linear-gradient(90deg, #ef4444 0%, #dc2626 100%)",width:`${100-i}%`,height:"100%"}})]})},m4=({decision:t,onClick:e,onDelete:n,headerGradient:i,headerText:r,primaryAccent:o})=>{const[a,l]=f.useState(!1),[c,d]=f.useState(!1),u=Un(900),h=(t.pros||[]).reduce((v,k)=>v+(k.text?.trim()?k.weight||5:0),0),p=(t.cons||[]).reduce((v,k)=>v+(k.text?.trim()?k.weight||5:0),0),m=(t.pros||[]).filter(v=>v.text?.trim()).length,x=(t.cons||[]).filter(v=>v.text?.trim()).length,g=v=>{v.stopPropagation(),d(!0)},y=async()=>{l(!0);try{await n(t.id),d(!1)}catch(v){console.error("Error deleting decision:",v)}finally{l(!1)}};return u?s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[s.jsxs("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf615, #8b5cf630)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Ln,{style:{width:"22px",height:"22px",color:"#8b5cf6"}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.topic||"Entscheidung"}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:Ji(t.created_at)})]}),s.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:a?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(jn,{size:14,color:"#16a34a"}),s.jsx("span",{style:{fontSize:"13px",fontWeight:500,color:"#16a34a"},children:m})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ei,{size:14,color:"#dc2626"}),s.jsx("span",{style:{fontSize:"13px",fontWeight:500,color:"#dc2626"},children:x})]}),s.jsx(Lg,{proScore:h,contraScore:p})]}),s.jsx(Kt,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]}),s.jsx(Is,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Entscheidung lschen",description:"Mchtest du diese Entscheidung wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]}):s.jsxs(V.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",v.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",v.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #8b5cf615, #8b5cf630)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Ln,{style:{width:"24px",height:"24px",color:"#8b5cf6"}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"6px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.topic||"Entscheidung"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(jn,{size:14,color:"#16a34a"}),s.jsxs("span",{style:{fontWeight:500,color:"#16a34a"},children:[m," Pro"]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ei,{size:14,color:"#dc2626"}),s.jsxs("span",{style:{fontWeight:500,color:"#dc2626"},children:[x," Contra"]})]})]}),s.jsx(Lg,{proScore:h,contraScore:p}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Fn,{size:14}),Ji(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[s.jsx("button",{onClick:g,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})}),s.jsx(Kt,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(Is,{isOpen:c,onClose:()=>d(!1),onConfirm:y,title:"Entscheidung lschen",description:"Mchtest du diese Entscheidung wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},pe={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings",DECISIONS:"decisions"},hc=[{id:pe.BRIEFINGS,label:"Smart Briefings",icon:St},{id:pe.DECISIONS,label:"Entscheidungs-Kompass",icon:Ln},{id:pe.SIMULATOR,label:"Szenario-Training",icon:et},{id:pe.VIDEO,label:"Wirkungs-Analyse",icon:bt},{id:pe.ROLEPLAY,label:"Live-Simulationen",icon:Ye}],Xo=pe,x4=({onBack:t,onSelectSession:e,isAuthenticated:n,onLoginClick:i,onContinueSession:r,onRepeatSession:o,initialTab:a,onNavigateToModule:l})=>{const{branding:c,demoCode:d,isDemoUser:u}=Ue(),h=Ve(),p=c?.["--header-gradient"]||Ie["--header-gradient"],m=c?.["--header-text"]||Ie["--header-text"],x=c?.["--primary-accent"]||Ie["--primary-accent"],[g,y]=f.useState(a||pe.BRIEFINGS);f.useEffect(()=>{a&&y(a)},[a]);const[v,k]=f.useState(null),[S,C]=f.useState(null);f.useEffect(()=>{window.scrollTo(0,0)},[g,v]);const[b,j]=f.useState([]),[w,T]=f.useState([]),[I,E]=f.useState([]),[P,O]=f.useState([]),[B,N]=f.useState([]),[M,F]=f.useState([]),[$,D]=f.useState([]),[z,L]=f.useState([]),[ee,se]=f.useState(null),[G,q]=f.useState(null),[ie,A]=f.useState(!0),[W,H]=f.useState(null);f.useEffect(()=>{n?oe():A(!1)},[n]);const oe=async()=>{A(!0),H(null);try{const Y=fn(),je=d?`&demo_code=${encodeURIComponent(d)}`:"",[xe,ze,hn,ci,En,Rn,In,jr]=await Promise.all([YT({limit:50,...d&&{demo_code:d}}).catch(()=>({data:[]})),fetch(`${Y}/simulator/sessions?limit=50${je}`,{headers:{"X-WP-Nonce":wt()}}).then(fe=>fe.json()).catch(()=>({data:[]})),fetch(`${Y}/video-training/sessions?limit=50${je}`,{headers:{"X-WP-Nonce":wt()}}).then(fe=>fe.json()).catch(()=>({data:[]})),ue.request(`/smartbriefing/briefings?limit=50${d?`&demo_code=${encodeURIComponent(d)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),ue.getDecisions().catch(()=>({success:!1,data:{decisions:[]}})),a0().catch(()=>[]),fetch(`${Y}/simulator/scenarios`,{headers:{"X-WP-Nonce":wt()}}).then(fe=>fe.json()).catch(()=>({data:[]})),fetch(`${Y}/video-training/scenarios`,{headers:{"X-WP-Nonce":wt()}}).then(fe=>fe.json()).catch(()=>({data:[]}))]),Q=(fe,nt="sessions")=>Array.isArray(fe?.data)?fe.data:Array.isArray(fe?.data?.[nt])?fe.data[nt]:Array.isArray(fe?.[nt])?fe[nt]:Array.isArray(fe)?fe:[],Re=fe=>Array.isArray(fe?.data?.scenarios)?fe.data.scenarios:Array.isArray(fe?.data)?fe.data:Array.isArray(fe)?fe:[];j(Q(xe)),T(Q(ze)),E(Q(hn)),O(ci?.data?.briefings||[]),N(En?.data?.decisions||[]),F(Re(Rn)),D(Re(In)),L(Re(jr))}catch(Y){console.error("Failed to load sessions:",Y),H(Y.message||"Fehler beim Laden der Daten")}finally{A(!1)}},Se=f.useMemo(()=>{const Y={};return M.forEach(je=>{Y[je.id]=je}),Y},[M]),$e=f.useMemo(()=>{const Y={};return $.forEach(je=>{Y[je.id]=je}),Y},[$]),Ce=f.useMemo(()=>{const Y={};return z.forEach(je=>{Y[je.id]=je}),Y},[z]),rt=()=>{switch(g){case pe.SIMULATOR:return w;case pe.VIDEO:return I;case pe.BRIEFINGS:return P;case pe.DECISIONS:return B;default:return b}},me=()=>{switch(g){case pe.SIMULATOR:return $e;case pe.VIDEO:return Ce;default:return Se}},we=b.length+w.length+I.length+P.length+B.length,Xe=async Y=>{(await ue.request(`/smartbriefing/briefings/${Y}`,{method:"DELETE"})).success&&O(xe=>xe.filter(ze=>ze.id!==Y))},Ge=Y=>{se(Y)},dt=()=>{se(null)},qe=async Y=>{(await ue.deleteDecision(Y)).success&&N(xe=>xe.filter(ze=>ze.id!==Y))},tt=Y=>{q(Y)},$t=()=>{q(null)},_e=Y=>{N(je=>je.map(xe=>xe.id===Y.id?Y:xe)),q(Y)},Vt=Y=>{k(Y),C(g)},jt=()=>{k(null),C(null)},ve=async(Y,je)=>{const xe=fn();try{let ze,hn;switch(je){case pe.SIMULATOR:ze=`${xe}/simulator/sessions/${Y.id}`,hn=()=>T(Rn=>Rn.filter(In=>In.id!==Y.id));break;case pe.ROLEPLAY:ze=`${xe}/sessions/${Y.id}`,hn=()=>j(Rn=>Rn.filter(In=>In.id!==Y.id));break;case pe.VIDEO:ze=`${xe}/video-training/sessions/${Y.id}`,hn=()=>E(Rn=>Rn.filter(In=>In.id!==Y.id));break;default:throw new Error("Unknown session type")}const En=await(await fetch(ze,{method:"DELETE",headers:{"X-WP-Nonce":wt()}})).json();if(En.success)hn(),v&&jt();else throw new Error(En.message||"Delete failed")}catch(ze){throw console.error("Failed to delete session:",ze),ze}},de=(Y,je)=>(je===pe.SIMULATOR?$e:je===pe.VIDEO?Ce:Se)[Y?.scenario_id];if(ee)return s.jsx(cv,{briefing:ee,onBack:dt,onDelete:Xe});if(G)return s.jsx(p4,{decision:G,onBack:$t,onDelete:qe,onUpdate:_e});if(v){if(S===pe.ROLEPLAY){const xe=de(v,S);return s.jsx(ov,{session:v,scenario:xe,onBack:jt,onRepeat:()=>o?.(v,xe,"roleplay"),onDelete:ze=>ve(ze,pe.ROLEPLAY)})}const je={[pe.SIMULATOR]:"simulator",[pe.VIDEO]:"video"}[S]||"simulator";return s.jsx(HP,{session:v,type:S,scenario:de(v,S),onBack:jt,onContinueSession:r,onRepeatSession:(xe,ze)=>o?.(xe,ze,je),onDeleteSession:ve})}if(!n)return s.jsxs("div",{style:{padding:h.space[6]},children:[s.jsxs("div",{style:{marginBottom:h.space[8],textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:h.space[3],marginBottom:h.space[3]},children:[s.jsx("div",{style:{width:h.space[12],height:h.space[12],borderRadius:h.radius.lg,background:p,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Vc,{style:{width:h.iconSize["2xl"],height:h.iconSize["2xl"],color:m}})}),s.jsx("h1",{style:{fontSize:h.fontSize["5xl"],fontWeight:h.fontWeight.bold,color:h.textMain,margin:0},children:"Meine Sessions"})]}),s.jsx("p",{style:{fontSize:h.fontSize.lg,color:h.textSecondary,maxWidth:"600px",margin:"0 auto"},children:"Hier findest du deine gespeicherten bungen und Fortschritte"})]}),s.jsxs("div",{style:{maxWidth:"500px",margin:`${h.space[15]} auto`,textAlign:"center",padding:h.space[10],backgroundColor:h.cardBg,borderRadius:h.radius["2xl"],boxShadow:h.shadow.md},children:[s.jsx("div",{style:{width:h.space[16],height:h.space[16],borderRadius:h.radius.xl,background:p,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${h.space[5]}`},children:s.jsx(Ia,{style:{width:h.iconSize["3xl"],height:h.iconSize["3xl"],color:m}})}),s.jsx("h2",{style:{fontSize:h.fontSize["3xl"],fontWeight:h.fontWeight.bold,color:h.textMain,marginBottom:h.space[3]},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{fontSize:h.fontSize.md,color:h.textMuted,marginBottom:h.space[6],lineHeight:1.6},children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),s.jsxs("button",{onClick:i,style:{padding:`${h.space[3.5]} ${h.space[8]}`,borderRadius:h.radius.lg,border:"none",background:p,color:m,fontSize:h.fontSize.lg,fontWeight:h.fontWeight.semibold,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:h.space[2.5],boxShadow:h.coloredShadow(x,"md")},children:[s.jsx(Ia,{style:{width:h.iconSize.lg,height:h.iconSize.lg}}),"Jetzt anmelden"]})]})]});if(ie)return s.jsxs("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:h.space[10]},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(he,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:x,animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{color:h.textMuted,marginTop:h.space[4]},children:"Sessions werden geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]});if(W)return s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:h.space[6]},children:[s.jsx(ke,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.error,margin:`0 auto ${h.space[4]}`}}),s.jsx("h2",{style:{fontSize:h.fontSize["2xl"],fontWeight:h.fontWeight.bold,color:h.textMain,marginBottom:h.space[2]},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:h.textMuted,marginBottom:h.space[6]},children:W}),s.jsx(ce,{onClick:oe,children:"Erneut versuchen"})]})});const ae=rt(),ge=me();return s.jsxs("div",{style:{padding:h.space[6]},children:[s.jsxs("div",{style:{marginBottom:h.space[8],textAlign:"center",position:"relative"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:h.space[3],marginBottom:h.space[3]},children:[s.jsx("div",{style:{width:h.space[12],height:h.space[12],borderRadius:h.radius.lg,background:p,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Vc,{style:{width:h.iconSize["2xl"],height:h.iconSize["2xl"],color:m}})}),s.jsx("h1",{style:{fontSize:h.fontSize["5xl"],fontWeight:h.fontWeight.bold,color:h.textMain,margin:0},children:"Meine Sessions"})]}),s.jsxs("p",{style:{fontSize:h.fontSize.lg,color:h.textSecondary,maxWidth:"600px",margin:"0 auto"},children:[we," ",we===1?"bung":"bungen"," gespeichert"]})]}),s.jsx("style",{children:`
        .session-tabs-desktop {
          margin: 0 24px 24px;
          display: flex;
          gap: 8px;
          background: #f1f5f9;
          padding: 6px;
          border-radius: 14px;
        }
        .session-tab-btn-desktop {
          flex: 1;
          padding: 12px 16px;
          border-radius: 10px;
          border: none;
          font-size: 14px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: all 0.2s;
        }
        .session-tabs-mobile {
          margin: 0 16px 16px;
        }
        .session-tabs-mobile-icons {
          display: flex;
          gap: 8px;
          justify-content: center;
          margin-bottom: 12px;
        }
        .session-tab-btn-mobile {
          flex: 1;
          max-width: 80px;
          padding: 12px 8px;
          border-radius: 12px;
          border: none;
          cursor: pointer;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 4px;
          transition: all 0.2s;
        }
        .session-tab-mobile-label {
          text-align: center;
          font-size: 15px;
          font-weight: 600;
          color: #0f172a;
          padding: 8px 16px;
          background: #fff;
          border-radius: 10px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .mobile-refresh-btn {
          display: none;
        }
        .desktop-actions {
          margin: 0 24px 24px;
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
          gap: 12px;
        }
        .sessions-list-container {
          margin: 0 24px;
        }
        @media (min-width: 1025px) {
          .session-tabs-mobile { display: none; }
        }
        @media (min-width: 641px) and (max-width: 1023px) {
          .desktop-actions {
            flex-direction: column;
          }
          .desktop-actions button {
            width: 100%;
            justify-content: center;
          }
        }
        @media (min-width: 1024px) {
          .desktop-actions {
            justify-content: flex-end;
          }
        }
        @media (max-width: 1024px) {
          .session-tabs-desktop { display: none; }
        }
        @media (max-width: 640px) {
          .desktop-actions { display: none; }
          .mobile-refresh-btn {
            display: flex !important;
            position: absolute;
            top: 0;
            right: 0;
          }
          .sessions-list-container {
            margin: 0 16px;
          }
        }
      `}),s.jsx("button",{onClick:oe,disabled:ie,className:"mobile-refresh-btn",style:{padding:h.space[2.5],borderRadius:h.radius.md,border:`1px solid ${h.borderColor}`,background:h.cardBgColor,color:h.textSecondary,cursor:ie?"not-allowed":"pointer",opacity:ie?.5:1,boxShadow:h.shadow.sm,alignItems:"center",justifyContent:"center"},children:s.jsx(zt,{style:{width:h.iconSize.md,height:h.iconSize.md},className:ie?"animate-spin":""})}),s.jsx("div",{className:"session-tabs-desktop",children:hc.map(Y=>{const je=Y.icon,xe=g===Y.id,ze=Y.id===pe.SIMULATOR?w.length:Y.id===pe.VIDEO?I.length:Y.id===pe.BRIEFINGS?P.length:Y.id===pe.DECISIONS?B.length:b.length;return s.jsxs("button",{onClick:()=>y(Y.id),className:"session-tab-btn-desktop",style:{background:xe?"#fff":"transparent",color:xe?"#0f172a":"#64748b",fontWeight:xe?600:500,boxShadow:xe?"0 2px 8px rgba(0, 0, 0, 0.08)":"none"},children:[s.jsx(je,{size:18}),s.jsx("span",{children:Y.label}),s.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",background:xe?x:"#e2e8f0",color:xe?"white":"#64748b",fontSize:"12px",fontWeight:600,minWidth:"24px",textAlign:"center"},children:ze})]},Y.id)})}),s.jsxs("div",{className:"session-tabs-mobile",children:[s.jsx("div",{className:"session-tabs-mobile-icons",children:hc.map(Y=>{const je=Y.icon,xe=g===Y.id,ze=Y.id===pe.SIMULATOR?w.length:Y.id===pe.VIDEO?I.length:Y.id===pe.BRIEFINGS?P.length:Y.id===pe.DECISIONS?B.length:b.length;return s.jsxs("button",{onClick:()=>y(Y.id),className:"session-tab-btn-mobile",style:{background:xe?"#fff":"#f1f5f9",boxShadow:xe?"0 2px 8px rgba(0, 0, 0, 0.1)":"none",border:xe?`2px solid ${x}`:"2px solid transparent"},children:[s.jsx(je,{size:20,style:{color:xe?x:"#64748b"}}),s.jsx("span",{style:{padding:"2px 6px",borderRadius:"8px",background:xe?x:"#e2e8f0",color:xe?"white":"#64748b",fontSize:"11px",fontWeight:600,minWidth:"20px",textAlign:"center"},children:ze})]},Y.id)})}),s.jsx("div",{className:"session-tab-mobile-label",children:hc.find(Y=>Y.id===g)?.label})]}),s.jsxs("div",{className:"desktop-actions",children:[s.jsxs(ce,{variant:"outline",onClick:oe,disabled:ie,children:[s.jsx(zt,{style:{width:"16px",height:"16px",marginRight:"8px"},className:ie?"animate-spin":""}),"Aktualisieren"]}),l&&s.jsxs(ce,{onClick:()=>{const Y={[pe.BRIEFINGS]:"smart_briefing",[pe.DECISIONS]:"decision_board",[pe.SIMULATOR]:"simulator",[pe.VIDEO]:"video_training",[pe.ROLEPLAY]:"dashboard"};l(Y[g]||"overview")},style:{background:p,color:m},children:[s.jsx(At,{style:{width:"16px",height:"16px",marginRight:"8px"}}),g===pe.BRIEFINGS?"Neues Briefing":g===pe.DECISIONS?"Neue Entscheidungs-Analyse":g===pe.SIMULATOR?"Neues Szenario-Training":g===pe.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),s.jsx("div",{className:"sessions-list-container",children:ae.length===0?s.jsxs("div",{style:{textAlign:"center",padding:`${h.space[15]} ${h.space[6]}`,background:h.cardBg,borderRadius:h.radius["2xl"],boxShadow:h.shadow.sm},children:[g===pe.SIMULATOR&&s.jsx(et,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===pe.ROLEPLAY&&s.jsx(Ye,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===pe.VIDEO&&s.jsx(bt,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===pe.BRIEFINGS&&s.jsx(St,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),g===pe.DECISIONS&&s.jsx(Ln,{style:{width:h.iconSize["4xl"],height:h.iconSize["4xl"],color:h.textMuted,margin:`0 auto ${h.space[4]}`,display:"block"}}),s.jsxs("h3",{style:{fontSize:h.fontSize["2xl"],fontWeight:h.fontWeight.semibold,color:h.textSecondary,marginBottom:h.space[2]},children:["Noch keine ",g===pe.SIMULATOR?"Szenario-Trainings":g===pe.VIDEO?"Wirkungs-Analysen":g===pe.BRIEFINGS?"Smart Briefings":g===pe.DECISIONS?"Entscheidungs-Analysen":"Live-Simulationen"]}),s.jsx("p",{style:{color:h.textMuted,fontSize:h.fontSize.base,marginBottom:h.space[6]},children:g===pe.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":g===pe.DECISIONS?"Nutze den Entscheidungs-Kompass, um deine erste Entscheidung zu analysieren.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),s.jsxs(ce,{onClick:t,children:[s.jsx(Dt,{style:{width:h.iconSize.sm,height:h.iconSize.sm,marginRight:h.space[2]}}),g===pe.BRIEFINGS?"Briefing erstellen":g===pe.DECISIONS?"Entscheidung analysieren":"Training starten"]})]}):s.jsx(V.div,{style:{display:"flex",flexDirection:"column",gap:h.space[3]},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:g===pe.BRIEFINGS?P.map(Y=>s.jsx(f4,{briefing:Y,onClick:()=>Ge(Y),onDelete:Xe,headerGradient:p,headerText:m,primaryAccent:x},Y.id)):g===pe.DECISIONS?B.map(Y=>s.jsx(m4,{decision:Y,onClick:()=>tt(Y),onDelete:qe,headerGradient:p,headerText:m,primaryAccent:x},Y.id)):ae.map(Y=>{const je=ge[Y.scenario_id];return s.jsx(g4,{session:Y,type:g,scenario:je,onClick:()=>Vt(Y),onContinueSession:r,onDeleteSession:ve,headerGradient:p,headerText:m,primaryAccent:x},Y.id)})})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})};function y4({session:t,onBack:e,onRepeatSession:n}){const[i,r]=f.useState(t),[o,a]=f.useState(null),[l,c]=f.useState(!0),[d,u]=f.useState(null),h=f.useMemo(()=>ku(i?.feedback_json),[i?.feedback_json]),p=f.useMemo(()=>Cu(i?.audio_analysis_json),[i?.audio_analysis_json]);f.useEffect(()=>{m()},[t?.id]);const m=async()=>{try{c(!0),u(null);const x=await wu(t.id);if(r(g=>({...x,feedback_json:x.feedback_json||g?.feedback_json,audio_analysis_json:x.audio_analysis_json||g?.audio_analysis_json,transcript:x.transcript||g?.transcript,conversation_id:x.conversation_id||g?.conversation_id})),x.scenario_id)try{const g=await l0(x.scenario_id);a(g)}catch(g){console.warn("Could not load scenario:",g)}}catch(x){console.error("Failed to load session:",x),u(x.message||"Fehler beim Laden der Session")}finally{c(!1)}};return l?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(he,{className:"w-12 h-12 text-ocean-blue-600 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Gesprchsanalyse wird geladen..."})]})}):d?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[s.jsx(ke,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),s.jsx("p",{className:"text-slate-600 mb-4",children:d}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx(ce,{variant:"outline",onClick:e,children:"Zurck"}),s.jsx(ce,{onClick:m,children:"Erneut versuchen"})]})]})}):s.jsx(ov,{session:i,scenario:o,feedback:h,audioAnalysis:p,onBack:e,onRepeat:o&&n?()=>n(i,o,"roleplay"):void 0})}const b4={briefcase:Tn,banknote:is,user:qt,presentation:Hx,target:et,mic:Fe},v4=async()=>{const t=await fetch(`${fn()}/simulator/scenarios`,{headers:{"X-WP-Nonce":wt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Keine Szenarien gefunden")},S4=t=>b4[t.icon]||Tn,k4=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:Je,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],Bg=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>s.jsx(cl,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:St,fetchScenarios:v4,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:k4,getIconForScenario:S4,cardActionLabel:"Starten",cardActionIcon:dn,categoryField:"category",emptyStateIcon:Fe,emptyStateTitle:"Keine Trainingsszenarien verfgbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:e,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."}),C4=({field:t,value:e,onChange:n,error:i,focusColor:r,branding:o})=>{const a=r||"#4a9ec9",l={width:"100%",padding:`${o.space[3]} ${o.space[4]}`,borderRadius:o.radius.lg,border:`2px solid ${i?R.red[500]:R.slate[200]}`,fontSize:o.fontSize.base,color:R.slate[900],backgroundColor:"white",outline:"none",transition:o.transition.normal},c={borderColor:a,boxShadow:`0 0 0 3px ${a}1a`},d=p=>{Object.assign(p.target.style,c),setTimeout(()=>{const m=p.target;if(m){const x=m.closest("div");x&&x.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=p=>{p.target.style.borderColor=i?R.red[500]:R.slate[200],p.target.style.boxShadow="none"},h=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u});case"textarea":return s.jsx("textarea",{value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",rows:4,style:{...l,resize:"vertical",minHeight:"100px"},onFocus:d,onBlur:u});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:p=>n(t.key,p.target.value),style:{...l,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:d,onBlur:u,children:[s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(p=>s.jsx("option",{value:p.value,children:p.label},p.value))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:l,onFocus:d,onBlur:u});default:return s.jsx("input",{type:"text",value:e||"",onChange:p=>n(t.key,p.target.value),placeholder:t.placeholder||"",style:l,onFocus:d,onBlur:u})}};return s.jsxs("div",{style:{marginBottom:o.space[5]},children:[s.jsxs("label",{style:{display:"block",marginBottom:o.space[2],fontSize:o.fontSize.sm,fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:o.space[1]},children:"*"})]}),h(),i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:R.red[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(ke,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:o.space[1.5],fontSize:o.fontSize.xs,color:R.slate[500],display:"flex",alignItems:"center",gap:o.space[1]},children:[s.jsx(un,{style:{width:"14px",height:"14px"}}),t.hint]})]})},w4=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),[l,c]=f.useState([]),[d,u]=f.useState(!1),h=Ve(),p=As.useMemo(()=>{if(!t?.input_configuration)return[];try{const S=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(S)?S.filter(C=>C.user_input!==!1):[]}catch(S){return console.error("Error parsing input_configuration:",S),[]}},[t?.input_configuration]);f.useEffect(()=>{const S={};p.forEach(C=>{C.default&&(S[C.key]=C.default)}),r(S)},[p]);const m=(S,C)=>{r(b=>({...b,[S]:C})),o[S]&&a(b=>{const j={...b};return delete j[S],j})},x=()=>{c(S=>[...S,{key:"",value:""}])},g=(S,C,b)=>{c(j=>{const w=[...j];return w[S]={...w[S],[C]:b},w})},y=S=>{c(C=>C.filter((b,j)=>j!==S))},v=()=>{const S={};return p.forEach(C=>{const b=i[C.key];if(C.required&&(!b||b.trim()==="")){S[C.key]="Dieses Feld ist erforderlich";return}if(!(!b||b.trim()==="")&&C.validation){const{minLength:j,maxLength:w,min:T,max:I,pattern:E}=C.validation;j&&b.length<j&&(S[C.key]=`Mindestens ${j} Zeichen erforderlich`),w&&b.length>w&&(S[C.key]=`Maximal ${w} Zeichen erlaubt`),T!==void 0&&Number(b)<T&&(S[C.key]=`Mindestens ${T}`),I!==void 0&&Number(b)>I&&(S[C.key]=`Maximal ${I}`),E&&!new RegExp(E).test(b)&&(S[C.key]="Ungltiges Format")}}),a(S),Object.keys(S).length===0},k=S=>{if(S.preventDefault(),!v())return;const C={...i};l.forEach(b=>{b.key&&b.value&&(C[b.key]=b.value)}),n(C)};return f.useEffect(()=>{p.length===0&&n({})},[p,n]),p.length===0?null:s.jsxs("div",{style:{padding:h.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:h.space[8]},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,marginBottom:h.space[4],border:"none",background:"transparent",color:R.slate[600],fontSize:h.fontSize.sm,cursor:"pointer",borderRadius:h.radius.md,transition:h.transition.normal},onMouseEnter:S=>S.target.style.background=R.slate[100],onMouseLeave:S=>S.target.style.background="transparent",children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:h.space[4]},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:h.radius.xl,background:h.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(St,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:h.fontSize["2xl"],fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:h.fontSize.sm,color:R.slate[600],margin:`${h.space[1]} 0 0 0`},children:"Personalisiere dein Training"})]})]})]}),s.jsx("div",{style:{padding:`${h.space[4]} ${h.space[5]}`,borderRadius:h.radius.lg,backgroundColor:R.slate[100],marginBottom:h.space[6]},children:s.jsx("p",{style:{fontSize:h.fontSize.sm,color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),s.jsxs("form",{onSubmit:k,children:[p.map(S=>s.jsx(C4,{field:S,value:i[S.key],onChange:m,error:o[S.key],focusColor:h.primaryAccent,branding:h},S.key)),t?.allow_custom_variables&&s.jsxs("div",{style:{marginTop:h.space[5],marginBottom:h.space[5],paddingTop:h.space[5],borderTop:`1px solid ${R.slate[200]}`},children:[s.jsxs("button",{type:"button",onClick:()=>u(!d),style:{display:"flex",alignItems:"flex-start",gap:h.space[2],padding:"0",border:"none",background:"none",color:R.slate[500],fontSize:h.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:d?h.space[4]:"0",textAlign:"left"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:h.space[2],flexShrink:0},children:[d?s.jsx(Yn,{size:18}):s.jsx(ct,{size:18}),s.jsx(At,{size:16})]}),s.jsx("span",{style:{lineHeight:"1.4"},children:"Zustzliche Variablen hinzufgen (optional)"})]}),d&&s.jsxs("div",{style:{backgroundColor:R.slate[50],borderRadius:h.radius.lg,padding:h.space[4]},children:[s.jsx("p",{style:{fontSize:h.fontSize.sm,color:R.slate[500],margin:`0 0 ${h.space[3]} 0`},children:"Fge eigene Variablen hinzu, die in das Training einflieen sollen."}),l.length>0&&s.jsx("div",{style:{marginBottom:h.space[3]},children:l.map((S,C)=>s.jsxs("div",{style:{backgroundColor:"white",border:`1px solid ${R.slate[200]}`,borderRadius:h.radius.md,padding:h.space[3],marginBottom:h.space[3]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:h.space[2]},children:[s.jsx("input",{type:"text",value:S.key||"",onChange:b=>g(C,"key",b.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:`${h.space[2]} ${h.space[3]}`,borderRadius:h.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:h.fontSize.sm,fontFamily:"monospace",backgroundColor:R.slate[50],flex:1,marginRight:h.space[2]}}),s.jsx("button",{type:"button",onClick:()=>y(C),style:{padding:h.space[2],border:"none",backgroundColor:"transparent",cursor:"pointer",color:R.red[500],display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{size:16})})]}),s.jsx("textarea",{value:S.value||"",onChange:b=>g(C,"value",b.target.value),placeholder:"Wert der Variable...",rows:2,style:{width:"100%",padding:`${h.space[2]} ${h.space[3]}`,borderRadius:h.radius.md,border:`1px solid ${R.slate[200]}`,fontSize:h.fontSize.sm,resize:"vertical"}})]},C))}),s.jsxs("button",{type:"button",onClick:x,style:{display:"flex",alignItems:"center",gap:h.space[2],padding:`${h.space[2]} ${h.space[3]}`,border:`1px dashed ${R.slate[300]}`,borderRadius:h.radius.md,backgroundColor:"white",color:R.slate[600],fontSize:h.fontSize.sm,cursor:"pointer",width:"100%",justifyContent:"center"},children:[s.jsx(At,{size:16}),"Variable hinzufgen"]})]})]}),s.jsxs("div",{style:{padding:`${h.space[4]} ${h.space[5]}`,borderRadius:h.radius.lg,backgroundColor:h.primaryAccentLight,marginTop:h.space[6],marginBottom:h.space[6],display:"flex",gap:h.space[5],flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:h.fontSize.xs,color:R.slate[500],display:"block"},children:"Fragen"}),s.jsxs("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:R.slate[900]},children:[t.question_count_min,"-",t.question_count_max]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:h.fontSize.xs,color:R.slate[500],display:"block"},children:"Zeit pro Frage"}),s.jsxs("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:R.slate[900]},children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:h.fontSize.xs,color:R.slate[500],display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:h.fontSize.base,fontWeight:600,color:R.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),s.jsxs("button",{type:"submit",style:{width:"100%",padding:`${h.space[4]} ${h.space[6]}`,borderRadius:h.radius.xl,border:"none",background:h.buttonGradient,color:"white",fontSize:h.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:h.space[2.5],transition:h.transition.normal,boxShadow:`0 4px 12px ${h.primaryAccent}4d`},onMouseEnter:S=>{S.target.style.transform="translateY(-2px)",S.target.style.boxShadow=`0 6px 16px ${h.primaryAccent}66`},onMouseLeave:S=>{S.target.style.transform="none",S.target.style.boxShadow=`0 4px 12px ${h.primaryAccent}4d`},children:["Weiter",s.jsx(Eo,{style:{width:"20px",height:"20px"}})]})]})]})},Zo=({score:t,label:e,size:n="normal",primaryAccent:i,branding:r})=>{const o=t!=null?t*10:null,l=(d=>d>=80?r.success:d>=60?i:d>=40?r.warning:r.error)(o),c=n==="large";return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:r.space[1]},children:[s.jsx("div",{style:{width:c?"80px":"56px",height:c?"80px":"56px",borderRadius:r.radius.full,backgroundColor:`${l}15`,border:`3px solid ${l}`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("span",{style:{fontSize:c?r.fontSize["5xl"]:r.fontSize["2xl"],fontWeight:r.fontWeight.bold,color:l},children:o!=null?Math.round(o):"-"})}),s.jsx("span",{style:{fontSize:c?r.fontSize.base:r.fontSize.xs,color:r.textSecondary,fontWeight:r.fontWeight.medium},children:e})]})},$s=({title:t,icon:e,children:n,defaultOpen:i=!0,primaryAccent:r,branding:o})=>{const[a,l]=f.useState(i);return s.jsxs("div",{style:{borderRadius:o.radius.lg,border:`1px solid ${o.borderColor}`,backgroundColor:o.cardBg,overflow:"hidden",marginBottom:o.space[4]},children:[s.jsxs("button",{onClick:()=>l(!a),style:{width:"100%",padding:`${o.space[4]} ${o.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3]},children:[s.jsx(e,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:r}}),s.jsx("span",{style:{fontSize:o.fontSize.md,fontWeight:o.fontWeight.semibold,color:o.textMain},children:t})]}),a?s.jsx(Yn,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}}):s.jsx(ct,{style:{width:o.iconSize.lg,height:o.iconSize.lg,color:o.textMuted}})]}),a&&s.jsx("div",{style:{padding:`0 ${o.space[5]} ${o.space[5]} ${o.space[5]}`,borderTop:`1px solid ${o.cardBgHover}`,paddingTop:o.space[4]},children:n})]})},pc=({text:t,type:e,primaryAccent:n,primaryAccentLight:i,branding:r})=>{const o={strength:{icon:jn,color:r.success,bg:r.successLight},improvement:{icon:ss,color:r.warning,bg:r.warningLight},tip:{icon:Ne,color:n,bg:i}},{icon:a,color:l,bg:c}=o[e]||o.tip;return s.jsxs("div",{style:{display:"flex",gap:r.space[3],padding:r.space[3],borderRadius:r.radius.md,backgroundColor:c,marginBottom:r.space[2]},children:[s.jsx(a,{style:{width:r.iconSize.md,height:r.iconSize.md,color:l,flexShrink:0,marginTop:"2px"}}),s.jsx("span",{style:{fontSize:r.fontSize.base,color:r.textSecondary,lineHeight:1.5},children:t})]})},j4=({metrics:t,branding:e})=>{if(!t)return null;const i=(o=>{switch(o){case"optimal":return{label:"Optimal",color:e.success};case"zu_schnell":return{label:"Zu schnell",color:e.warning};case"zu_langsam":return{label:"Zu langsam",color:e.warning};default:return{label:o||"N/A",color:e.textMuted}}})(t.speech_rate),r=o=>{switch(o){case"niedrig":return e.success;case"mittel":return e.warning;case"hoch":return e.error;default:return e.textMuted}};return s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:e.space[4]},children:[s.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Sprechtempo"}),s.jsx("span",{style:{fontSize:e.fontSize.lg,fontWeight:e.fontWeight.semibold,color:i.color},children:i.label})]}),t.filler_words&&s.jsxs("div",{style:{padding:e.space[4],borderRadius:e.radius.md,backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:e.fontSize.xs,color:e.textMuted,display:"block",marginBottom:e.space[1]},children:"Fllwrter"}),s.jsxs("span",{style:{fontSize:e.fontSize.lg,fontWeight:600,color:r(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&s.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?e.success:e.warning,borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:e.cardBgHover},children:[s.jsx("span",{style:{fontSize:"12px",color:e.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:e.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?e.success:e.warning,borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:e.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&s.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:e.primaryAccentLight,fontSize:"14px",color:e.textSecondary,lineHeight:1.5},children:[" ",t.notes]})]})},T4=({audioUrl:t,primaryAccent:e,branding:n})=>{const i=f.useRef(null),[r,o]=f.useState(!1),[a,l]=f.useState(0),[c,d]=f.useState(0),[u,h]=f.useState(!0),[p,m]=f.useState(null);f.useEffect(()=>{if(!t)return;h(!0),m(null);const k=new Audio;i.current=k;const S=()=>{const b=k.duration;b&&isFinite(b)&&b>0&&d(b),h(!1)},C=()=>{h(!1);const b=k.duration;b&&isFinite(b)&&b>0&&d(b)};return k.addEventListener("loadedmetadata",S),k.addEventListener("canplaythrough",C),k.addEventListener("timeupdate",()=>l(k.currentTime)),k.addEventListener("play",()=>o(!0)),k.addEventListener("pause",()=>o(!1)),k.addEventListener("ended",()=>o(!1)),k.addEventListener("error",()=>{m("Audio nicht verfgbar"),h(!1)}),k.src=t,k.load(),()=>{k.pause(),k.src=""}},[t]);const x=()=>{i.current&&(r?i.current.pause():i.current.play())},g=k=>{const S=k.currentTarget.getBoundingClientRect(),C=(k.clientX-S.left)/S.width;i.current&&c>0&&(i.current.currentTime=C*c)},y=k=>{i.current&&(i.current.currentTime=Math.max(0,Math.min(i.current.currentTime+k,c)))};if(!t)return null;if(p)return s.jsxs("div",{style:{padding:"12px 16px",background:n.cardBgHover,borderRadius:"10px",color:n.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ke,{size:16})," ",p]});const v=c>0?a/c*100:0;return s.jsxs("div",{style:{background:n.cardBgHover,borderRadius:"12px",padding:"16px"},children:[s.jsx("div",{onClick:g,style:{height:"6px",background:n.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:s.jsx("div",{style:{width:`${v}%`,height:"100%",background:e,borderRadius:"3px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[s.jsx("button",{onClick:()=>y(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:s.jsx(il,{size:20})}),s.jsx("button",{onClick:x,disabled:u,style:{width:"44px",height:"44px",borderRadius:"50%",background:e,border:"none",cursor:u?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:u?.7:1},children:u?s.jsx(he,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):r?s.jsx(nl,{size:20,color:"#ffffff",fill:"#ffffff"}):s.jsx(Dt,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>y(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:n.textMuted,display:"flex",alignItems:"center"},children:s.jsx(sl,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:n.textMuted},children:[pt(a)," / ",pt(c)]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},E4=({transcript:t,feedback:e,audioMetrics:n,audioUrl:i,onRetry:r,onNext:o,onComplete:a,isLastQuestion:l,hideButtons:c=!1})=>{const{branding:d}=Ue(),u=Ve(),h=d?.["--button-gradient"]||d?.["--header-gradient"]||Ie["--header-gradient"],p=d?.["--primary-accent"]||Ie["--primary-accent"],m=d?.["--primary-accent-light"]||Ie["--primary-accent-light"],x=typeof e=="string"?JSON.parse(e):e;return s.jsxs("div",{style:{backgroundColor:u.cardBgHover,borderRadius:u.radius.xl,padding:u.space[6]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:u.space[5],backgroundColor:u.cardBg,borderRadius:u.radius.lg},children:[s.jsx(Zo,{score:x?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:p,branding:u}),s.jsxs("div",{style:{flex:1},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:u.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),s.jsx("p",{style:{fontSize:"14px",color:u.textSecondary,margin:0,lineHeight:1.5},children:x?.summary||"Deine Antwort wurde analysiert."})]})]}),x?.scores&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:u.cardBg,borderRadius:"12px"},children:[s.jsx(Zo,{score:x.scores.content,label:"Inhalt",primaryAccent:p,branding:u}),s.jsx(Zo,{score:x.scores.structure,label:"Struktur",primaryAccent:p,branding:u}),s.jsx(Zo,{score:x.scores.relevance,label:"Relevanz",primaryAccent:p,branding:u})]}),s.jsx($s,{title:"Transkript",icon:Ye,defaultOpen:!0,primaryAccent:p,branding:u,children:s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:u.cardBgHover,fontStyle:"italic",color:u.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verfgbar.",'"']})}),i&&s.jsx($s,{title:"Deine Aufnahme",icon:ki,defaultOpen:!0,primaryAccent:p,branding:u,children:s.jsx(T4,{audioUrl:i,primaryAccent:p,branding:u})}),x?.strengths?.length>0&&s.jsx($s,{title:"Strken",icon:jn,defaultOpen:!0,primaryAccent:p,branding:u,children:x.strengths.map((g,y)=>s.jsx(pc,{text:g,type:"strength",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),x?.improvements?.length>0&&s.jsx($s,{title:"Verbesserungen",icon:ss,defaultOpen:!0,primaryAccent:p,branding:u,children:x.improvements.map((g,y)=>s.jsx(pc,{text:g,type:"improvement",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),x?.tips?.length>0&&s.jsx($s,{title:"Tipps",icon:Ne,defaultOpen:!1,primaryAccent:p,branding:u,children:x.tips.map((g,y)=>s.jsx(pc,{text:g,type:"tip",primaryAccent:p,primaryAccentLight:m,branding:u},y))}),n&&s.jsx($s,{title:"Sprechanalyse",icon:Fe,defaultOpen:!1,primaryAccent:p,branding:u,children:s.jsx(j4,{metrics:n,branding:u})}),!c&&s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[r&&s.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${u.borderColor}`,backgroundColor:u.cardBg,color:u.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.borderColor=p,g.target.style.color=p},onMouseLeave:g=>{g.target.style.borderColor=u.borderColor,g.target.style.color=u.textSecondary},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),s.jsx("button",{onClick:l?a:o,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:h,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${p}4d`,transition:"all 0.2s"},onMouseEnter:g=>{g.target.style.transform="translateY(-2px)",g.target.style.boxShadow=`0 6px 16px ${p}66`},onMouseLeave:g=>{g.target.style.transform="none",g.target.style.boxShadow=`0 4px 12px ${p}4d`},children:l?s.jsxs(s.Fragment,{children:[s.jsx(ko,{style:{width:"18px",height:"18px"}}),"Training abschlieen"]}):s.jsxs(s.Fragment,{children:["Nchste Frage",s.jsx(Kt,{style:{width:"18px",height:"18px"}})]})})]})]})},hv=({current:t,total:e,answeredQuestions:n=[],primaryAccent:i,b:r,labels:o,showCompleted:a=!0})=>{const l=(t+1)/e*100,c=o?.questionFallback||"Frage",d=p=>{const m=p===t,x=n.length>0?n.includes(p):p<t;return m?i:x?R.green[500]:R.slate[300]},u=p=>{const m=n.length>0?n.includes(p):p<t;return`${c} ${p+1}${m?" (beantwortet)":""}`},h=()=>o?.questionCounter?o.questionCounter(t+1,e):`${c} ${t+1} von ${e}`;return s.jsxs("div",{style:{marginBottom:r.space[6]},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:r.space[2]},children:[s.jsx("span",{style:{fontSize:r.fontSize.sm,fontWeight:600,color:R.slate[700]},children:h()}),s.jsxs("span",{style:{fontSize:r.fontSize.sm,fontWeight:a?400:600,color:a?R.slate[500]:i},children:[Math.round(l),"%",a?" abgeschlossen":""]})]}),s.jsx("div",{style:{height:"8px",backgroundColor:R.slate[200],borderRadius:r.radius.sm,overflow:"hidden",marginBottom:r.space[3]},children:s.jsx(V.div,{initial:{width:0},animate:{width:`${l}%`},transition:{duration:parseFloat(r.transition.normal.replace("s",""))},style:{height:"100%",background:i,borderRadius:r.radius.sm}})}),s.jsx("div",{style:{display:"flex",gap:r.space[1.5],justifyContent:"center"},children:Array.from({length:e},(p,m)=>s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:d(m),transition:`all ${r.transition.normal}`},title:u(m)},m))})]})},oh=({isLoading:t,message:e="Wird geladen...",subMessage:n=null})=>{const{branding:i}=Ue(),r=i?.["--header-gradient"]||Ie["--header-gradient"];return s.jsx(De,{children:t&&s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:s.jsxs(V.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3,delay:.1},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"40px 60px",backgroundColor:"white",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.15)"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:r,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(he,{style:{width:"32px",height:"32px",color:"white",animation:"spin 1s linear infinite"}})}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("p",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:e}),n&&s.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginTop:"8px",margin:"8px 0 0 0"},children:n})]})]})})})},Fg={target:et,clock:Je,mic:Fe,"message-square":Ye,lightbulb:Ne,brain:Ap,info:un,settings:ii,check:Ut,Target:et,Clock:Je,Mic:Fe,MessageSquare:Ye,Lightbulb:Ne,Brain:Ap},R4=({tips:t,primaryAccent:e,tipsLabel:n,branding:i})=>{const[r,o]=f.useState(!0);return!t||t.length===0?null:s.jsxs("div",{style:{background:i.cardBg,borderRadius:i.radius.xl,border:`1px solid ${i.borderColor}`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:`${i.space[4]} ${i.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:i.space[2],fontSize:i.fontSize.base,fontWeight:i.fontWeight.semibold,color:i.textMain},children:[s.jsx(Ne,{size:i.iconSize.md,color:e}),n||"Tipps fr diese Frage"]}),s.jsx(ct,{size:i.iconSize.md,color:i.textMuted,style:{transform:r?"rotate(180deg)":"none",transition:i.transition.normal}})]}),s.jsx(De,{children:r&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:`0 ${i.space[6]} ${i.space[6]}`},children:t.map((a,l)=>s.jsxs("div",{style:{display:"flex",gap:i.space[3],padding:`${i.space[3]} ${i.space[4]}`,borderRadius:i.radius.md,backgroundColor:i.warningLight,marginBottom:l<t.length-1?i.space[2]:0},children:[s.jsx(Ne,{style:{width:i.iconSize.sm,height:i.iconSize.sm,color:i.warning,flexShrink:0,marginTop:"2px"}}),s.jsx("p",{style:{fontSize:i.fontSize.base,color:i.textSecondary,margin:0,lineHeight:1.5},children:a.replace(/^Tipp \d+:\s*/i,"")})]},l))})})})]})},I4=({seconds:t,maxSeconds:e,isRecording:n,branding:i})=>{const r=e>0?t/e*100:0,o=r>75,a=r>90;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[3],padding:`${i.space[3]} ${i.space[4]}`,borderRadius:i.radius.lg,backgroundColor:a?i.errorLight:o?i.warningLight:i.cardBgHover},children:[s.jsx(Je,{style:{width:i.iconSize.lg,height:i.iconSize.lg,color:a?i.error:o?i.warning:i.textSecondary}}),s.jsx("span",{style:{fontSize:i.fontSize.xl,fontWeight:i.fontWeight.semibold,fontFamily:"monospace",color:a?i.error:o?i.warning:i.textSecondary},children:pt(t)}),s.jsxs("span",{style:{fontSize:i.fontSize.base,color:i.textMuted},children:["/ ",pt(e)]})]})},Wg=({onRecordingComplete:t,timeLimit:e,disabled:n,deviceId:i,themedGradient:r,primaryAccent:o,isSubmitting:a,labels:l,onOpenSettings:c,branding:d,isMobile:u})=>{const[h,p]=f.useState("idle"),[m,x]=f.useState(0),[g,y]=f.useState(0),[v,k]=f.useState(!1),S=f.useRef(null),C=f.useRef([]),b=f.useRef(null),j=f.useRef(null),w=f.useRef(null),T=f.useRef(null),I=f.useRef(null),E=f.useRef(0),P=f.useRef(!1);f.useEffect(()=>()=>{O()},[]),f.useEffect(()=>{h==="recording"&&m>=e&&F()},[m,e,h]);const O=()=>{b.current&&clearInterval(b.current),T.current&&cancelAnimationFrame(T.current),j.current&&(j.current.close(),j.current=null),I.current&&(I.current.getTracks().forEach(D=>D.stop()),I.current=null)},B=async()=>{try{k(!1),C.current=[],x(0);let D;const z={audio:i?{deviceId:{exact:i}}:!0};try{D=await navigator.mediaDevices.getUserMedia(z)}catch(G){throw console.error("[SIMULATOR] Selected device unavailable:",G),G.name==="OverconstrainedError"||G.name==="NotFoundError"?(k(!1),new Error("Das ausgewhlte Mikrofon ist nicht verfgbar. Bitte whle ein anderes Mikrofon in den Einstellungen.")):G}I.current=D,j.current=new(window.AudioContext||window.webkitAudioContext),w.current=j.current.createAnalyser(),j.current.createMediaStreamSource(D).connect(w.current),w.current.fftSize=256;const ee=()=>{if(w.current&&P.current){const G=new Uint8Array(w.current.frequencyBinCount);w.current.getByteFrequencyData(G);const q=G.reduce((ie,A)=>ie+A)/G.length;y(q/255)}T.current=requestAnimationFrame(ee)};P.current=!0,ee();const se=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";S.current=new MediaRecorder(D,{mimeType:se}),S.current.ondataavailable=G=>{G.data.size>0&&C.current.push(G.data)},S.current.onstop=()=>{const G=new Blob(C.current,{type:se});t(G,E.current)},S.current.start(1e3),p("recording"),b.current=setInterval(()=>{x(G=>G+1)},1e3)}catch(D){console.error("Error starting recording:",D),(D.name==="NotAllowedError"||D.name==="PermissionDeniedError")&&k(!0)}},N=()=>{S.current&&S.current.state==="recording"&&(S.current.pause(),p("paused"),P.current=!1,b.current&&(clearInterval(b.current),b.current=null),y(0))},M=()=>{S.current&&S.current.state==="paused"&&(S.current.resume(),p("recording"),P.current=!0,b.current=setInterval(()=>{x(D=>D+1)},1e3))},F=()=>{E.current=m,P.current=!1,b.current&&(clearInterval(b.current),b.current=null),T.current&&(cancelAnimationFrame(T.current),T.current=null),j.current&&(j.current.close(),j.current=null),S.current&&S.current.state!=="inactive"&&S.current.stop(),I.current&&(I.current.getTracks().forEach(D=>D.stop()),I.current=null),p("idle"),y(0),x(0)},$=()=>{h==="idle"?B():h==="recording"?N():h==="paused"&&M()};return v?s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.errorLight,textAlign:"center"},children:[s.jsx(Gx,{style:{width:"48px",height:"48px",color:d.error,marginBottom:"12px"}}),s.jsx("p",{style:{color:d.error,fontWeight:600,margin:0},children:"Mikrofonzugriff verweigert"}),s.jsx("p",{style:{color:d.textSecondary,fontSize:"14px",marginTop:"8px"},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]}):s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:d.cardBg,border:`1px solid ${d.borderColor}`,position:"relative"},children:[u&&s.jsx("button",{onClick:c,style:{position:"absolute",top:"12px",right:"12px",padding:"10px",borderRadius:"10px",background:d.cardBgHover,border:`1px solid ${d.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:18,color:d.textMuted})}),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:s.jsx(I4,{seconds:m,maxSeconds:e,isRecording:h==="recording",branding:d})}),h==="recording"&&s.jsx("div",{style:{marginBottom:"24px"},children:s.jsx(mr,{audioLevel:g,isActive:!0,variant:"bars",size:"sm",accentColor:o})}),h==="paused"&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"60px",marginBottom:"24px",color:d.warning},children:[s.jsx(Fe,{size:24}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600},children:"Aufnahme pausiert"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[!u&&s.jsx("button",{onClick:c,style:{padding:"14px",borderRadius:"12px",background:d.cardBgHover,border:`1px solid ${d.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:d.textMuted})}),s.jsxs("button",{onClick:$,disabled:n||a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:u?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",flex:u?1:"none",background:h==="idle"?n||a?d.borderColor:d.error:h==="recording"?d.warning:d.success,color:"white",fontSize:u?"15px":"16px",fontWeight:600,cursor:n||a?"not-allowed":"pointer",boxShadow:n||a?"none":"0 4px 14px rgba(0, 0, 0, 0.2)"},children:[h==="idle"&&s.jsxs(s.Fragment,{children:[s.jsx(Fe,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]}),h==="recording"&&s.jsxs(s.Fragment,{children:[s.jsx(ks,{style:{width:"18px",height:"18px"}}),"Pausieren"]}),h==="paused"&&s.jsxs(s.Fragment,{children:[s.jsx(Dt,{style:{width:"18px",height:"18px"}}),"Fortsetzen"]})]}),(h==="recording"||h==="paused")&&s.jsxs("button",{onClick:F,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:u?"14px 16px":"14px 24px",borderRadius:"12px",border:"none",flex:u?1:"none",backgroundColor:d.cardBgHover,color:d.textMain,fontSize:u?"15px":"16px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Ut,{style:{width:"18px",height:"18px",color:d.success}}),l?.submitButton||"Antwort abgeben"]})]}),h==="idle"&&!a&&s.jsx("p",{style:{textAlign:"center",marginTop:"16px",color:d.textMuted,fontSize:"14px"},children:l?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"24px"},children:[s.jsx(he,{style:{width:"32px",height:"32px",color:o,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"12px",color:d.textSecondary,fontSize:"14px"},children:l?.analyzing||"Antwort wird analysiert..."})]}),s.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      `})]})},A4=({scenario:t,variables:e,questions:n,onStart:i,onBack:r,selectedMicrophoneId:o,onMicrophoneChange:a,onMicrophoneTest:l,themedGradient:c,primaryAccent:d,primaryAccentLight:u,isLoading:h,branding:p})=>{const m=t?.mode==="SIMULATION",x=m?"Situationen":"Fragen",g=m?"Zeit pro Situation":"Zeit pro Frage",y=[{icon:et,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fr Beispiele aus deiner Erfahrung."},{icon:Je,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${m?"Situation":"Frage"}. ${m?"Reagiere":"Antworte"} przise, aber ausfhrlich genug.`},{icon:Fe,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vllig in Ordnung."},{icon:Ye,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mglich."}],v=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((b,j)=>typeof b=="string"?{icon:Ne,title:`Tipp ${j+1}`,description:b}:{icon:Fg[b.icon]||Fg[b.icon?.toLowerCase()]||Ne,title:b.title||`Tipp ${j+1}`,description:b.text||b.description||""}):y,k=As.useMemo(()=>{if(!t?.input_configuration)return{};try{const b=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(b)?b.reduce((j,w)=>(w.key&&w.label&&(j[w.key]=w.label),j),{}):{}}catch{return{}}},[t?.input_configuration]),S=e?Object.entries(e).filter(([b,j])=>j&&j.trim&&j.trim()!=="").map(([b,j])=>({label:k[b]||b.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase()),value:j})):[],C=b=>{if(!b||!e)return b;let j=b;return Object.entries(e).forEach(([w,T])=>{T&&(j=j.replace(new RegExp(`\\$\\{${w}\\}`,"g"),T),j=j.replace(new RegExp(`\\{${w}\\}`,"g"),T))}),j};return s.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:r,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:p.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px"},children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ne,{style:{width:"32px",height:"32px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:p.textMain,margin:0},children:"Vorbereitung"}),s.jsxs("p",{style:{fontSize:"16px",color:p.textSecondary,margin:"4px 0 0 0"},children:[t.title,n.length>0?`  ${n.length} ${x}`:""]})]})]})]}),t.long_description&&s.jsx("div",{style:{padding:"20px 24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:c,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(un,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:p.textMain,margin:"0 0 8px 0"},children:"Deine Aufgabe"}),s.jsx("p",{style:{fontSize:"15px",lineHeight:"1.6",color:p.textSecondary,margin:0,whiteSpace:"pre-wrap"},children:C(t.long_description?.replace(/\/n/g,`
`))})]})]})}),S.length>0&&s.jsxs("div",{style:{padding:"20px",borderRadius:"16px",backgroundColor:u,marginBottom:"24px"},children:[s.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:d,margin:"0 0 12px 0",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dein Profil"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:S.map((b,j)=>s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:b.label}),s.jsx("span",{style:{fontSize:"15px",fontWeight:500,color:p.textMain},children:b.value})]},j))})]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Fe,{style:{width:"22px",height:"22px",color:d}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:p.textMain,margin:0},children:"Mikrofon testen"})]}),s.jsx(Au,{selectedDeviceId:o,onDeviceChange:a,onTestClick:l})]}),s.jsxs("button",{onClick:i,disabled:h,style:{width:"100%",padding:"18px 28px",borderRadius:"14px",border:"none",background:h?p.borderColor:c,color:"white",fontSize:"18px",fontWeight:600,cursor:h?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:h?"none":`0 4px 12px ${d}4d`,marginBottom:"24px",opacity:h?.7:1},children:[s.jsx(Dt,{style:{width:"24px",height:"24px"}}),"Gesprch starten"]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:p.cardBg,border:`1px solid ${p.borderColor}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[s.jsx(Ne,{style:{width:"22px",height:"22px",color:p.warning}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:p.textMain,margin:0},children:"Tipps fr dein Gesprch"})]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:v.map((b,j)=>s.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"12px",backgroundColor:p.cardBgHover},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:u,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(b.icon,{style:{width:"22px",height:"22px",color:d}})}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:p.textMain,margin:"0 0 4px 0"},children:b.title}),s.jsx("p",{style:{fontSize:"14px",color:p.textSecondary,margin:0,lineHeight:1.5},children:b.description})]})]},j))})]}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:p.cardBgHover,display:"flex",gap:"24px",flexWrap:"wrap"},children:[n.length>0&&s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:x}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:n.length})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:g}),s.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:p.textMuted,display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:p.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},_4=({session:t,questions:e,scenario:n,variables:i,preloadedQuestions:r,onSessionCreated:o,onComplete:a,onExit:l,startFromQuestion:c=0,initialMicrophoneId:d})=>{const u=Un(),[h,p]=f.useState(t),[m,x]=f.useState(e||[]),[g,y]=f.useState(!1),[v,k]=f.useState(null),{demoCode:S}=Ue(),C=n?.mode==="SIMULATION",b={questionLabel:C?"Situation / Aussage des Gegenbers:":"Interviewfrage:",questionFallback:C?"Situation":"Frage",questionLoading:C?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:C?"Deine Reaktion...":"Deine Antwort...",submitButton:C?"Reaktion abgeben":"Antwort abgeben",submitHint:C?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:C?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(Q,Re)=>C?`Situation ${Q} von ${Re}`:`Frage ${Q} von ${Re}`,questionsCount:Q=>C?`${Q} Situationen`:`${Q} Fragen`,answeredCount:(Q,Re)=>C?`${Q} von ${Re} Situationen`:`${Q} von ${Re} Fragen`,tipsLabel:C?"Tipps fr diese Situation":"Tipps fr diese Frage",nextButton:C?"Nchste Situation":"Nchste Frage",timePerQuestion:C?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:C?"Situationen":"Fragen",recommendedTime:C?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},j=c>0;r&&r.length>0;const w=j?Array.from({length:c},(Q,Re)=>Re):[],[T,I]=f.useState(j?"interview":"preparation"),[E,P]=f.useState(c||h?.current_question_index||0),[O,B]=f.useState(null),[N,M]=f.useState(!1),[F,$]=f.useState(!1),[D,z]=f.useState(null),[L,ee]=f.useState([]),[se,G]=f.useState(w),q="karriereheld_selected_microphone",[ie,A]=f.useState(()=>{if(d)return d;try{return localStorage.getItem(q)||null}catch{return null}}),[W,H]=f.useState(!1),[oe,Se]=f.useState(!1);f.useEffect(()=>{if(ie)try{localStorage.setItem(q,ie)}catch{}},[ie]);const[$e,Ce]=f.useState(!1),[rt,me]=f.useState(!1),[we,Xe]=f.useState(!1),[Ge,dt]=f.useState(null),[qe,tt]=f.useState(!1),{branding:$t}=Ue(),_e=Ve(),Vt=$t?.["--header-gradient"]||Ie["--header-gradient"],jt=$t?.["--button-gradient"]||Vt,ve=$t?.["--primary-accent"]||Ie["--primary-accent"],de=$t?.["--primary-accent-light"]||Ie["--primary-accent-light"],ae=m[E],ge=E===m.length-1,Y=E===0,je=async(Q,Re)=>{if(Re<2){z("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(Q.size<5e3){console.warn("[SimulatorSession] Audio too small:",Q.size,"bytes"),z("Die Aufnahme enthlt keine verwertbaren Audiodaten. Bitte sprechen Sie whrend der Aufnahme und versuchen Sie es erneut.");return}$(!0),z(null);try{const fe=await ue.submitSimulatorAnswer(h.id,Q,E,ae.question,ae.category,Re);if(!fe.success)throw new Error(fe.message||"Fehler beim Analysieren der Antwort");if(B(fe.data),M(!0),ee(nt=>[...nt.filter(as=>as.questionIndex!==E),{questionIndex:E,feedback:fe.data}]),G(nt=>nt.includes(E)?nt:[...nt,E]),C&&!qe){Xe(!0),dt(null);const nt=se.includes(E);try{const as=await ue.generateNextTurn(h.id);if(as.success){const Ns=as.data.next_question;as.data.is_finished?(dt(Ns),x(nt?ls=>{const Tr=[...ls];return Tr[E+1]=Ns,Tr.slice(0,E+2)}:ls=>[...ls,Ns]),tt(!0)):(dt(Ns),nt?(x(ls=>{const Tr=[...ls];return Tr[E+1]=Ns,Tr.slice(0,E+2)}),tt(!1)):x(ls=>[...ls,Ns]))}}catch(as){console.error("Error generating next turn:",as)}finally{Xe(!1)}}}catch(fe){console.error("Error submitting answer:",fe),z(fe.message||"Ein Fehler ist aufgetreten")}finally{$(!1)}},xe=()=>{B(null),M(!1),z(null)},ze=()=>{if(B(null),M(!1),z(null),C){if(Ge){P(Q=>Q+1),dt(null);return}if(qe){En();return}}else ge||P(Q=>Q+1)},hn=()=>{B(null),M(!1),z(null),Y||P(Q=>Q-1)},ci=()=>{Ce(!0)},En=async()=>{Ce(!1);try{const Q=await ue.completeSimulatorSession(h.id);Q.success?a(Q.data):a({session:{...h,status:"completed"}})}catch(Q){console.error("Error completing session:",Q),a({session:{...h,status:"completed"}})}},Rn=()=>{me(!0)},In=()=>{me(!1),l()},jr=async()=>{if(h&&m.length>0){I("interview");return}y(!0),k(null);try{const Q=await ue.createSimulatorSession({scenario_id:n.id,variables:i,demo_code:S||null,questions:r||null});if(!Q.success)throw new Error(Q.message||"Fehler beim Erstellen der Session");const Re=Q.data.session;let fe;if(r&&r.length>0)fe=r,await ue.updateSimulatorSessionQuestions(Re.id,fe);else{const nt=await ue.generateSimulatorQuestions(Re.id);if(!nt.success)throw new Error(nt.message||"Fehler beim Generieren der Fragen");fe=nt.data.questions}p({...Re,questions_json:fe}),x(fe),o&&o({session:{...Re,questions_json:fe},questions:fe,selectedMicrophoneId:ie}),I("interview")}catch(Q){console.error("Error creating session:",Q),k(Q.message||"Ein Fehler ist aufgetreten")}finally{y(!1)}};return T==="preparation"?s.jsxs(s.Fragment,{children:[s.jsx(A4,{scenario:n,variables:i,questions:m,onStart:jr,onBack:l,selectedMicrophoneId:ie,onMicrophoneChange:A,onMicrophoneTest:()=>H(!0),themedGradient:jt,primaryAccent:ve,primaryAccentLight:de,isLoading:g,branding:_e}),s.jsx(_u,{isOpen:W,onClose:()=>H(!1),deviceId:ie}),v&&s.jsx("div",{style:{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",color:"#dc2626",fontSize:"14px",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100},children:v}),s.jsx(oh,{isLoading:g,message:C?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]}):s.jsxs("div",{style:{padding:u?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:u?"column":"row",justifyContent:"space-between",alignItems:u?"stretch":"center",gap:u?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:u?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:u?"space-between":"flex-end"},children:[!(N&&(C&&qe&&!Ge||!C&&ge))&&s.jsxs("button",{onClick:ci,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#22c55e",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"white",fontSize:"14px",fontWeight:600,boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)",flex:u?1:"none",justifyContent:"center"},children:[s.jsx(wn,{size:16}),u?"Beenden":"Training beenden"]}),s.jsxs("button",{onClick:Rn,style:{padding:u?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",flex:u?1:"none",justifyContent:"center"},children:[s.jsx(Ot,{size:16}),"Abbrechen"]})]})]}),$e&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>Ce(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:Q=>Q.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(wn,{size:24,color:"#22c55e"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training beenden?"})]}),se.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"8px"},children:["Du hast ",s.jsx("strong",{children:b.answeredCount(se.length,m.length)})," beantwortet."]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Mchtest du das Training jetzt mit den bisherigen Antworten abschlieen oder weitere ",b.questionsLabel," beantworten?"]})]}):s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Du hast noch keine ",b.questionsLabel," beantwortet. Mchtest du das Training wirklich beenden?"]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>Ce(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Weiter trainieren"}),s.jsx("button",{onClick:En,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#22c55e",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)"},children:"Training beenden"})]})]})}),rt&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>me(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:Q=>Q.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ke,{size:24,color:"#ef4444"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training abbrechen?"})]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:[s.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",se.length>0?` (${se.length} ${b.questionsLabel})`:""," ",s.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>me(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Zurck"}),s.jsx("button",{onClick:In,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:"Abbrechen"})]})]})}),!N&&!C&&s.jsxs("div",{style:{display:"flex",gap:u?"8px":"12px",justifyContent:"center",marginBottom:"16px"},children:[s.jsxs("button",{onClick:hn,disabled:Y,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${_e.borderColor}`,backgroundColor:_e.cardBg,color:Y?_e.textMuted:_e.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:Y?"not-allowed":"pointer",opacity:Y?.5:1,flex:u?1:"none",justifyContent:"center"},children:[s.jsx(Qr,{size:16}),"Zurck"]}),s.jsxs("button",{onClick:ze,disabled:ge,style:{display:"flex",alignItems:"center",gap:"6px",padding:u?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${_e.borderColor}`,backgroundColor:_e.cardBg,color:ge?_e.textMuted:_e.textSecondary,fontSize:u?"13px":"14px",fontWeight:600,cursor:ge?"not-allowed":"pointer",opacity:ge?.5:1,flex:u?1:"none",justifyContent:"center"},children:[u?"berspringen":"Frage berspringen",s.jsx(Kt,{size:16})]})]}),s.jsx(hv,{current:E,total:m.length,answeredQuestions:se,primaryAccent:ve,b:_e,labels:b}),N?s.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px",justifyContent:"flex-end"},children:[n.allow_retry&&s.jsxs("button",{onClick:xe,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:`2px solid ${_e.borderColor}`,backgroundColor:_e.cardBg,color:_e.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:16}),"Nochmal versuchen"]}),s.jsxs("button",{onClick:C?qe&&!Ge?En:ze:ge?En:ze,disabled:C&&we&&!qe,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:"none",background:C&&we&&!qe?_e.textMuted:jt,color:"white",fontSize:"14px",fontWeight:600,cursor:C&&we&&!qe?"wait":"pointer",boxShadow:C&&we&&!qe?"none":`0 4px 12px ${ve}4d`,opacity:C&&we&&!qe?.7:1},children:[C&&we&&!qe?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:16,className:"animate-spin",style:{animation:"spin 1s linear infinite"}}),"Gesprchspartner tippt..."]}):C?qe&&!Ge?"Training abschlieen":b.nextButton:ge?"Training abschlieen":b.nextButton,!we&&!(C?qe&&!Ge:ge)&&s.jsx(Kt,{size:16})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:"1px solid #e2e8f0",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:jt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:E+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:ae?.category||b.questionFallback})]}),s.jsx("p",{style:{fontSize:"16px",fontWeight:500,color:"#0f172a",margin:0,lineHeight:1.5},children:ae?.question||b.questionLoading})]}),s.jsx(E4,{transcript:O.transcript,feedback:O.feedback,audioMetrics:O.audio_analysis,audioUrl:O.audio_url,hideButtons:!0})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:u?"16px":"24px"},children:[u?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:jt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:E+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:ae?.category||b.questionFallback})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:ae?.question||b.questionLoading}),ae?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(Je,{size:14}),b.recommendedTime,": ca. ",Math.round(ae.estimated_answer_time/60)," Min"]})]}),s.jsx(Wg,{onRecordingComplete:je,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:ie,themedGradient:jt,primaryAccent:ve,isSubmitting:F,labels:b,onOpenSettings:()=>Se(!0),branding:_e,isMobile:!0}),D&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"16px",borderRadius:"12px",backgroundColor:_e.errorLight},children:[s.jsx(ke,{style:{width:"24px",height:"24px",color:_e.error}}),s.jsx("p",{style:{marginTop:"8px",color:_e.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:D}),s.jsx("button",{onClick:xe,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:_e.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsx(Wg,{onRecordingComplete:je,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:ie,themedGradient:jt,primaryAccent:ve,isSubmitting:F,labels:b,onOpenSettings:()=>Se(!0),branding:_e,isMobile:!1}),D&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",marginTop:"16px",borderRadius:"12px",backgroundColor:_e.errorLight},children:[s.jsx(ke,{style:{width:"24px",height:"24px",color:_e.error}}),s.jsx("p",{style:{marginTop:"8px",color:_e.error,fontWeight:500,fontSize:"14px",textAlign:"center"},children:D}),s.jsx("button",{onClick:xe,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:_e.error,color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:jt,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:E+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:ae?.category||b.questionFallback})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:ae?.question||b.questionLoading}),ae?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(Je,{size:16}),b.recommendedTime,": ca. ",Math.round(ae.estimated_answer_time/60)," Min"]})]})]}),ae?.tips&&ae.tips.length>0&&s.jsx(R4,{tips:ae.tips,primaryAccent:ve,tipsLabel:b.tipsLabel,branding:_e})]}),s.jsx(rh,{isOpen:oe,onClose:()=>Se(!1),mode:"audio",selectedMicrophoneId:ie,onMicrophoneChange:A})]})},Qo=({score:t,label:e,primaryAccent:n,b:i})=>{const r=t!=null?t*10:null,o=Zt(r,n);return s.jsxs("div",{style:{textAlign:"center",padding:i.space[4],backgroundColor:R.slate[100],borderRadius:i.radius.lg},children:[s.jsx("div",{style:{fontSize:i.fontSize["4xl"],fontWeight:700,color:o,marginBottom:"4px"},children:r!=null?Math.round(r):"-"}),s.jsx("div",{style:{fontSize:i.fontSize.sm,color:R.slate[600]},children:e})]})},fc=({icon:t,value:e,label:n,primaryAccent:i,b:r})=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[3],padding:`${r.space[3]} ${r.space[4]}`,backgroundColor:R.slate[100],borderRadius:r.radius.md},children:[s.jsx(t,{style:{width:"20px",height:"20px",color:i}}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:r.fontSize.xl,fontWeight:600,color:R.slate[900]},children:e}),s.jsx("div",{style:{fontSize:r.fontSize.xs,color:R.slate[500]},children:n})]})]}),M4=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const r=Ve(),o=t.summary_feedback||t.summary_feedback_json,a=o?typeof o=="string"?JSON.parse(o):o:null,l=t.overall_score||a?.overall_score||0,c=l<=10?l*10:l,u=(h=>h>=90?{text:"Ausgezeichnet!",emoji:""}:h>=80?{text:"Sehr gut!",emoji:""}:h>=70?{text:"Gut!",emoji:""}:h>=60?{text:"Solide Leistung",emoji:""}:h>=50?{text:"Ausbaufhig",emoji:""}:{text:"Weiter ben!",emoji:""})(c);return s.jsxs("div",{style:{padding:r.space[6],maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:r.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:s.jsx(ko,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsxs("h1",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:R.slate[900],margin:"0 0 8px 0"},children:["Training abgeschlossen! ",u.emoji]}),s.jsxs("p",{style:{fontSize:r.fontSize.lg,color:R.slate[600],margin:0},children:[e?.title||"Skill Training"," - ",u.text]})]}),s.jsxs("div",{style:{padding:r.space[6],borderRadius:r.radius.xl,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,textAlign:"center",marginBottom:r.space[6]},children:[s.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",border:`6px solid ${r.primaryAccent}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",backgroundColor:r.primaryAccentLight},children:s.jsx("span",{style:{fontSize:r.fontSize["5xl"],fontWeight:700,color:r.primaryAccent},children:c?Math.round(c):"-"})}),s.jsx("p",{style:{fontSize:r.fontSize.base,color:R.slate[500],margin:0},children:c?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[s.jsx(fc,{icon:Ut,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),s.jsx(fc,{icon:et,value:a?.average_content_score?Math.round(a.average_content_score*10):"-",label:" Inhalt",primaryAccent:r.primaryAccent,b:r}),s.jsx(fc,{icon:nn,value:a?.average_delivery_score?Math.round(a.average_delivery_score*10):"-",label:" Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.scores&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:r.space[3],marginBottom:r.space[6]},children:[s.jsx(Qo,{score:a.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),s.jsx(Qo,{score:a.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),s.jsx(Qo,{score:a.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),s.jsx(Qo,{score:a.scores.delivery,label:"Prsentation",primaryAccent:r.primaryAccent,b:r})]}),a?.summary&&s.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:R.slate[100],marginBottom:r.space[6]},children:[s.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:R.slate[700],margin:"0 0 8px 0"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:r.fontSize.base,color:R.slate[600],margin:0,lineHeight:1.6},children:a.summary})]}),a?.key_takeaways?.length>0&&s.jsxs("div",{style:{padding:r.space[5],borderRadius:r.radius.lg,backgroundColor:R.green[100],marginBottom:r.space[6]},children:[s.jsx("h3",{style:{fontSize:r.fontSize.base,fontWeight:600,color:R.green[500],margin:"0 0 12px 0"},children:" Die wichtigsten Erkenntnisse"}),s.jsx("ul",{style:{margin:0,paddingLeft:r.space[5],color:R.slate[700],fontSize:r.fontSize.base,lineHeight:1.6},children:a.key_takeaways.map((h,p)=>s.jsx("li",{style:{marginBottom:"8px"},children:h},p))})]}),s.jsxs("div",{style:{display:"flex",gap:r.space[3],marginTop:"32px"},children:[s.jsxs("button",{onClick:n,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:`2px solid ${R.slate[300]}`,backgroundColor:"white",color:R.slate[700],fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.borderColor=r.primaryAccent,h.target.style.color=r.primaryAccent},onMouseLeave:h=>{h.target.style.borderColor=R.slate[300],h.target.style.color=R.slate[700]},children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2],padding:`${r.space[3.5]} ${r.space[6]}`,borderRadius:r.radius.lg,border:"none",background:r.buttonGradient,color:"white",fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${r.primaryAccent}4d`,transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.transform="translateY(-2px)",h.target.style.boxShadow=`0 6px 16px ${r.primaryAccent}66`},onMouseLeave:h=>{h.target.style.transform="none",h.target.style.boxShadow=`0 4px 12px ${r.primaryAccent}4d`},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal ben"]})]})]})},pn={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},P4=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingContinueSession:i,clearPendingContinueSession:r,pendingRepeatSession:o,clearPendingRepeatSession:a,onNavigateToHistory:l})=>{const[c,d]=f.useState(pn.DASHBOARD),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState([]),[y,v]=f.useState({}),[k,S]=f.useState(null),[C,b]=f.useState(null),[j,w]=f.useState(null),[T,I]=f.useState(0);f.useEffect(()=>{j&&t&&(h(j),d(pn.VARIABLES),w(null))},[j,t]),f.useEffect(()=>{if(i&&t){const{session:D,scenario:z}=i,L=D.questions||D.questions_json,ee=typeof L=="string"?JSON.parse(L):L||[],se=D.completed_questions||D.answered_count||0;h(z||{id:D.scenario_id,title:D.scenario_title}),m(D),g(ee),v({}),I(se),d(pn.SESSION),r&&r()}},[i,t,r]),f.useEffect(()=>{if(o&&t){const{session:D,scenario:z}=o,L=D.questions||D.questions_json,ee=typeof L=="string"?JSON.parse(L):L||[];h(z||{id:D.scenario_id,title:D.scenario_title}),g(ee),v({}),I(0),d(pn.SESSION),a&&a()}},[o,t,a]),f.useEffect(()=>{window.scrollTo(0,0)},[c]);const E=f.useCallback(D=>{h(D),d(pn.VARIABLES)},[]),P=f.useCallback(()=>{h(null),m(null),g([]),v({}),S(null),I(0),b(null),d(pn.DASHBOARD)},[]),O=f.useCallback(D=>{v(D),d(pn.SESSION)},[]),B=f.useCallback(D=>{m(D.session),g(D.questions),D.selectedMicrophoneId&&b(D.selectedMicrophoneId)},[]),N=f.useCallback(D=>{S(D.session),d(pn.COMPLETE)},[]),M=f.useCallback(()=>{P()},[P]),F=f.useCallback(()=>{m(null),g([]),S(null),I(0),b(null),d(pn.VARIABLES)},[]),$=()=>{switch(c){case pn.DASHBOARD:return s.jsx(Bg,{onSelectScenario:E,isAuthenticated:t,requireAuth:e,setPendingScenario:w,onNavigateToHistory:l});case pn.VARIABLES:return s.jsx(w4,{scenario:u,onBack:P,onNext:O});case pn.SESSION:return s.jsx(_4,{session:p,questions:x,scenario:u,variables:y,preloadedQuestions:x.length>0?x:null,onSessionCreated:B,onComplete:N,onExit:M,startFromQuestion:T,initialMicrophoneId:C});case pn.COMPLETE:return s.jsx(M4,{session:k,scenario:u,onBackToDashboard:P,onStartNew:F});default:return s.jsx(Bg,{onSelectScenario:E,isAuthenticated:t,requireAuth:e,setPendingScenario:w,onNavigateToHistory:l})}};return s.jsx("div",{style:{minHeight:"100%"},children:$()})},N4={video:bt,user:qt,briefcase:Tn,presentation:Hx,mic:Fe,target:et,banknote:is},D4={self_presentation:{label:"Selbstprsentation",icon:qt,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgesprch",icon:Tn,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:oi,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:Tj,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:et,color:"#64748b",bgColor:"#f1f5f9"}},z4=async()=>{const t=await fetch(`${fn()}/video-training/scenarios`,{headers:{"X-WP-Nonce":wt()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();if(e.success&&e.data?.scenarios)return e.data.scenarios;throw new Error("Ungltige Antwort vom Server")},O4=t=>N4[t.icon]||bt,L4=t=>[{text:`${t.question_count} Fragen`},{icon:Je,text:`~${Math.round(t.total_time_limit/60)} Min.`}],B4=t=>s.jsx("div",{style:{marginTop:"40px",padding:"20px",background:`linear-gradient(135deg, ${t}10 0%, ${t}05 100%)`,borderRadius:"12px",border:`1px solid ${t}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(St,{size:20,color:t,style:{flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Wie funktioniert das Video Training?"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,margin:0},children:["1. Whle ein Szenario und konfiguriere dein Training",s.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",s.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Krpersprache und Kommunikation"]})]})]})}),Ug=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>{const{branding:o}=Ue(),a=o?.primaryAccent||o?.["--primary-accent"]||"#3A7FA7";return s.jsx(cl,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:bt,fetchScenarios:z4,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:L4,getIconForScenario:O4,cardActionLabel:"Starten",cardActionIcon:dn,categoryField:"scenario_type",customCategoryConfig:D4,emptyStateIcon:bt,emptyStateTitle:"Keine Szenarien verfgbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:()=>B4(a),isAuthenticated:e,requireAuth:n,setPendingScenario:i,loadingMessage:"Szenarien werden geladen..."})},F4=({field:t,value:e,onChange:n,error:i,focusColor:r})=>{const o=r||"#4a9ec9",a={width:"100%",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${i?R.red[500]:R.slate[200]}`,fontSize:"16px",color:R.slate[900],backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},l={borderColor:o,boxShadow:`0 0 0 3px ${o}1a`},c=h=>{Object.assign(h.target.style,l),setTimeout(()=>{const p=h.target;if(p){const m=p.closest("div");m&&m.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=h=>{h.target.style.borderColor=i?R.red[500]:R.slate[200],h.target.style.boxShadow="none"},u=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d});case"textarea":return s.jsx("textarea",{value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",rows:4,style:{...a,resize:"vertical",minHeight:"100px"},onFocus:c,onBlur:d});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:h=>n(t.key,h.target.value),style:{...a,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:c,onBlur:d,children:[!t.default&&s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(h=>s.jsx("option",{value:h.value,children:h.label},h.value))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:a,onFocus:c,onBlur:d});default:return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:600,color:R.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:R.red[500],marginLeft:"4px"},children:"*"})]}),u(),i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:R.red[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(ke,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:R.slate[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(un,{style:{width:"14px",height:"14px"}}),t.hint]})]})},W4=({scenario:t,onBack:e,onNext:n})=>{const[i,r]=f.useState({}),[o,a]=f.useState({}),{branding:l}=Ue(),c=l?.["--header-gradient"]||Ie["--header-gradient"],d=l?.["--button-gradient"]||c,u=l?.["--primary-accent"]||Ie["--primary-accent"],h=l?.["--primary-accent-light"]||Ie["--primary-accent-light"],p=f.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(v=>v.user_input!==!1)}catch(y){return console.error("Error parsing input_configuration:",y),[]}},[t?.input_configuration]);f.useEffect(()=>{const y={};p.forEach(v=>{v.default&&(y[v.key]=v.default)}),r(y)},[p]);const m=(y,v)=>{r(k=>({...k,[y]:v})),o[y]&&a(k=>{const S={...k};return delete S[y],S})},x=()=>{const y={};return p.forEach(v=>{const k=i[v.key];if(v.required&&(!k||typeof k=="string"&&k.trim()==="")){y[v.key]="Dieses Feld ist erforderlich";return}if(!(!k||typeof k=="string"&&k.trim()==="")&&v.validation){const{minLength:S,maxLength:C,min:b,max:j,pattern:w}=v.validation;S&&k.length<S&&(y[v.key]=`Mindestens ${S} Zeichen erforderlich`),C&&k.length>C&&(y[v.key]=`Maximal ${C} Zeichen erlaubt`),b!==void 0&&Number(k)<b&&(y[v.key]=`Mindestens ${b}`),j!==void 0&&Number(k)>j&&(y[v.key]=`Maximal ${j}`),w&&!new RegExp(w).test(k)&&(y[v.key]="Ungltiges Format")}}),a(y),Object.keys(y).length===0},g=y=>{y.preventDefault(),x()&&n(i)};return f.useEffect(()=>{p.length===0&&n({})},[p,n]),p.length===0?null:s.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:R.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:y=>y.target.style.background=R.slate[100],onMouseLeave:y=>y.target.style.background="transparent",children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(bt,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:R.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:R.slate[600],margin:"4px 0 0 0"},children:"Personalisiere dein Training"})]})]})]}),t.description&&s.jsx("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:R.slate[100],marginBottom:"24px"},children:s.jsx("p",{style:{fontSize:"14px",color:R.slate[700],margin:0,lineHeight:1.6},children:t.description})}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:h,marginBottom:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(un,{style:{width:"20px",height:"20px",color:u,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("p",{style:{fontSize:"14px",fontWeight:600,color:R.slate[900],margin:"0 0 4px 0"},children:"So funktioniert es"}),s.jsxs("p",{style:{fontSize:"13px",color:R.slate[600],margin:0,lineHeight:1.5},children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschlieend detailliertes Feedback."]})]})]}),s.jsxs("form",{onSubmit:g,children:[p.map(y=>s.jsx(F4,{field:y,value:i[y.key],onChange:m,error:o[y.key],focusColor:u},y.key)),s.jsxs("button",{type:"submit",style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:d,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:`0 4px 12px ${u}4d`,marginTop:"24px"},onMouseEnter:y=>{y.target.style.transform="translateY(-2px)",y.target.style.boxShadow=`0 6px 16px ${u}66`},onMouseLeave:y=>{y.target.style.transform="none",y.target.style.boxShadow=`0 4px 12px ${u}4d`},children:["Weiter",s.jsx(Eo,{style:{width:"20px",height:"20px"}})]})]})]})},$g={error:{bg:R.red[50],border:R.red[200],text:R.red[600],icon:ke},warning:{bg:R.amber[50],border:R.amber[200],text:R.amber[600],icon:ss},success:{bg:R.green[50],border:R.green[200],text:R.green[600],icon:Ut},info:{bg:R.blue[50],border:R.blue[200],text:R.blue[500],icon:un},loading:{bg:R.blue[50],border:R.blue[200],text:R.blue[500],icon:he}},U4=({variant:t="info",message:e,children:n,isToast:i=!1,onDismiss:r,className:o="",style:a={}})=>{const l=$g[t]||$g.info,c=l.icon,d=t==="loading",u={display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:l.bg,border:`1px solid ${l.border}`,color:l.text,fontSize:"14px",fontWeight:500,...i&&{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,maxWidth:"90%"},...a};return s.jsxs("div",{style:u,className:o,children:[s.jsx(c,{size:20,style:{flexShrink:0,...d&&{animation:"spin 1s linear infinite"}},className:d?"animate-spin":""}),s.jsx("span",{style:{flex:1},children:n||e}),r&&s.jsx("button",{onClick:r,style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:l.text,opacity:.7,display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Schlieen",children:s.jsx(Ot,{size:16})})]})},$4=({message:t,onDismiss:e,...n})=>s.jsx(U4,{variant:"error",message:t,isToast:!0,onDismiss:e,...n}),V4=()=>{const[t,e]=f.useState(!1),[n,i]=f.useState(null),{demoCode:r}=Ue(),o=f.useCallback(async(l,c,d)=>{i(null),e(!0);try{const u=await l();c(u)}catch(u){console.error("[useSessionStartup] Error:",u);const h=u.message||"Ein Fehler ist aufgetreten";i(h),e(!1),d?.(u)}},[]),a=f.useCallback(()=>{i(null)},[]);return{isSubmitting:t,submitError:n,demoCode:r,startSession:o,clearError:a}},G4=({scenario:t,variables:e,onBack:n,onStart:i})=>{const{isSubmitting:r,submitError:o,demoCode:a,startSession:l,clearError:c}=V4(),d=async({selectedMicrophoneId:u,selectedCameraId:h})=>{await l(async()=>{const p=fn(),m=await fetch(`${p}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wt()},body:JSON.stringify({scenario_id:t.id,variables:e,demo_code:a||null})});if(!m.ok){const S=await m.json().catch(()=>({}));throw new Error(S.message||"Fehler beim Erstellen der Session")}const x=await m.json(),g=x.data?.session||x.session;if(!g)throw new Error("Keine Session-ID erhalten");const y=await fetch(`${p}/video-training/sessions/${g.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wt()},body:JSON.stringify({variables:e})});if(!y.ok){const S=await y.json().catch(()=>({}));throw new Error(S.message||"Fehler beim Generieren der Fragen")}const v=await y.json(),k=v.data?.questions||v.questions||[];return{session:{...g,questions:k},questions:k,scenario:t,variables:e,selectedMicrophoneId:u,selectedCameraId:h}},i)};return s.jsxs(s.Fragment,{children:[s.jsx(iy,{mode:"audio-video",scenario:t,onBack:n,onStart:d,title:t?.title,startButtonLabel:"Video-Training starten",icon:bt}),o&&s.jsx($4,{message:o,onDismiss:c}),s.jsx(oh,{isLoading:r,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},Vg=({tips:t,primaryAccent:e})=>{const[n,i]=f.useState(!1);return!t||t.length===0?null:s.jsxs("div",{style:{marginTop:"16px",background:`linear-gradient(135deg, ${e}08 0%, ${e}04 100%)`,borderRadius:"12px",border:`1px solid ${e}15`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:600,color:"#0f172a"},children:[s.jsx(Ne,{size:18,color:e}),"Tipps fr diese Frage"]}),s.jsx(Kt,{size:18,color:"#64748b",style:{transform:n?"rotate(90deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(De,{children:n&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.map((r,o)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:r},o))})})})})]})},H4=({session:t,questions:e,scenario:n,variables:i,onComplete:r,onExit:o,selectedMicrophoneId:a,selectedCameraId:l})=>{const[c,d]=f.useState(0),[u,h]=f.useState(!1),[p,m]=f.useState(!1),[x,g]=f.useState(0),[y,v]=f.useState([]),[k,S]=f.useState([]),[C,b]=f.useState(null),[j,w]=f.useState(null),[T,I]=f.useState(!1),[E,P]=f.useState(!1),[O,B]=f.useState(null),[N,M]=f.useState(a||null),[F,$]=f.useState(l||null),[D,z]=f.useState(!1),[L,ee]=f.useState(0),se=Un(),G=f.useRef(null),q=f.useRef(null),ie=f.useRef(null),A=f.useRef(null),W=f.useRef(null),H=f.useRef(null),oe=Ve(),{primaryAccent:Se,headerGradient:$e}=oe,Ce=e[c];f.useEffect(()=>(we(),()=>{dt(),ie.current&&clearInterval(ie.current),H.current&&cancelAnimationFrame(H.current),A.current&&A.current.close()}),[]);const rt=ve=>{try{A.current&&A.current.close();const de=new(window.AudioContext||window.webkitAudioContext);A.current=de;const ae=de.createAnalyser();ae.fftSize=256,ae.smoothingTimeConstant=.8,W.current=ae,de.createMediaStreamSource(ve).connect(ae);const Y=new Uint8Array(ae.frequencyBinCount),je=()=>{if(!W.current)return;W.current.getByteFrequencyData(Y);const ze=Y.reduce((hn,ci)=>hn+ci,0)/Y.length;ee(ze/255),H.current=requestAnimationFrame(je)};je()}catch(de){console.error("[VIDEO TRAINING] Audio analysis error:",de)}},me=()=>{H.current&&(cancelAnimationFrame(H.current),H.current=null),ee(0)},we=async(ve=N,de=F)=>{try{w(null),C&&C.getTracks().forEach(je=>je.stop());const ae=de?{deviceId:{exact:de},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},ge=ve?{deviceId:{exact:ve}}:!0,Y=await navigator.mediaDevices.getUserMedia({video:ae,audio:ge});b(Y),G.current&&(G.current.srcObject=Y)}catch(ae){console.error("[VIDEO TRAINING] Camera error:",ae),w("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Xe=ve=>{M(ve),u||we(ve,F)},Ge=ve=>{$(ve),u||we(N,ve)},dt=()=>{C&&(C.getTracks().forEach(ve=>ve.stop()),b(null))},qe=()=>{if(!C){we();return}try{const ve=new MediaRecorder(C,{mimeType:"video/webm;codecs=vp9,opus"});q.current=ve;const de=[];ve.ondataavailable=ae=>{ae.data.size>0&&(de.push(ae.data),v(ge=>[...ge,ae.data]))},ve.onstop=()=>{},ve.start(1e3),h(!0),m(!1),rt(C),S(ae=>[...ae,{question_index:c,start_time:x}]),ie.current=setInterval(()=>{g(ae=>ae+1)},1e3)}catch(ve){console.error("[VIDEO TRAINING] Recording error:",ve),B("Fehler beim Starten der Aufnahme")}},tt=()=>{q.current&&u&&(q.current.stop(),h(!1),me(),ie.current&&(clearInterval(ie.current),ie.current=null))},$t=()=>{c<e.length-1&&(u&&S(ve=>[...ve,{question_index:c+1,start_time:x}]),d(ve=>ve+1))},_e=()=>{c>0&&d(ve=>ve-1)},Vt=async()=>{tt(),I(!0),B(null);try{const ve=new Blob(y,{type:"video/webm"}),de=fn(),ae=new FormData;ae.append("video",ve,`video_${t.id}.webm`),ae.append("video_duration",x.toString()),ae.append("timeline",JSON.stringify(k));const ge=await fetch(`${de}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":wt()},body:ae});if(!ge.ok){const ze=await ge.text();throw console.error("[VIDEO TRAINING] Upload failed:",ge.status,ze),ge.status===413?new Error("Das Video ist zu gro zum Hochladen. Bitte versuche eine krzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+ge.status)}const Y=await ge.json();I(!1),P(!0);const je=await fetch(`${de}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wt()}});if(!je.ok)throw new Error("Fehler bei der Video-Analyse");const xe=await je.json();r({session:xe.data?.session||t,analysis:xe.data?.analysis,categoryScores:xe.data?.category_scores,overallScore:xe.data?.overall_score})}catch(ve){console.error("[VIDEO TRAINING] Upload/Analysis error:",ve),B(ve.message),I(!1),P(!1)}},jt=()=>{tt(),dt(),o()};return T||E?s.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:[s.jsxs(V.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{background:"#fff",borderRadius:"20px",padding:"48px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)",maxWidth:"500px",width:"100%",textAlign:"center"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:`${Se}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(he,{size:40,color:Se,style:{animation:"spin 1s linear infinite"}})}),s.jsx("h2",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"12px"},children:T?"Video wird hochgeladen...":"KI analysiert dein Video..."}),s.jsx("p",{style:{color:"#64748b",fontSize:"15px",lineHeight:1.6},children:T?"Dein Video wird sicher bertragen. Dies kann je nach Dateigre einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Krpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):s.jsxs("div",{style:{padding:se?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:se?"column":"row",justifyContent:"space-between",alignItems:se?"stretch":"center",gap:se?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:se?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:s.jsxs("button",{onClick:jt,style:{padding:se?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(Ot,{size:16}),"Abbrechen"]})})]}),s.jsx(hv,{current:c,total:e.length,primaryAccent:Se,b:oe,showCompleted:!1}),se?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:$e,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:c+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:Ce?.category||"Frage"})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:Ce?.question||"Frage wird geladen..."}),Ce?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(Je,{size:14}),"Empfohlene Antwortzeit: ~",Math.round(Ce.estimated_time/60)," Min."]}),n?.enable_tips&&Ce?.tips&&s.jsx(Vg,{tips:Ce.tips,primaryAccent:Se})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[j?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"16px",textAlign:"center"},children:[s.jsx(Pp,{size:40,style:{marginBottom:"12px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"12px",fontSize:"14px"},children:j}),s.jsxs("button",{onClick:we,style:{padding:"10px 16px",borderRadius:"8px",background:Se,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},children:[s.jsx(zt,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:G,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"13px",fontWeight:500},children:pt(x)})]}),!u&&x>0&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx(Je,{size:14,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"13px"},children:pt(x)})]})]}),u&&s.jsx("div",{style:{marginTop:"16px"},children:s.jsx(mr,{audioLevel:L,isActive:!0,variant:"bars",size:"sm",accentColor:Se})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[s.jsx("button",{onClick:()=>z(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:"#64748b"})}),u?s.jsxs("button",{onClick:tt,style:{padding:"14px 24px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center"},children:[s.jsx(Mp,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:qe,disabled:!C,style:{padding:"14px 24px",borderRadius:"12px",background:C?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:C?"pointer":"not-allowed",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",flex:1,justifyContent:"center",boxShadow:C?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(bt,{size:20}),"Aufnahme starten"]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n?.enable_navigation&&c>0&&s.jsxs("button",{onClick:_e,style:{padding:"10px 14px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",flex:1},children:[s.jsx(Qr,{size:16}),"Zurck"]}),n?.enable_navigation&&c<e.length-1&&s.jsxs("button",{onClick:$t,style:{padding:"10px 14px",borderRadius:"8px",background:Se,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:500,flex:1},children:["Nchste",s.jsx(Kt,{size:16})]}),s.jsxs("button",{onClick:Vt,disabled:y.length===0,style:{padding:"10px 14px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:600,flex:1,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(wn,{size:16}),"Abschlieen"]})]})]})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[j?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"20px",textAlign:"center"},children:[s.jsx(Pp,{size:48,style:{marginBottom:"16px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"16px"},children:j}),s.jsxs("button",{onClick:we,style:{padding:"10px 20px",borderRadius:"8px",background:Se,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(zt,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:G,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),u&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"14px",fontWeight:500},children:pt(x)})]}),!u&&x>0&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx(Je,{size:16,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:pt(x)})]})]}),u&&s.jsx("div",{style:{marginTop:"20px"},children:s.jsx(mr,{audioLevel:L,isActive:!0,variant:"bars",size:"sm",accentColor:Se})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginTop:"20px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[s.jsx("button",{onClick:()=>z(!0),style:{padding:"14px",borderRadius:"12px",background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ii,{size:20,color:"#64748b"})}),u?s.jsxs("button",{onClick:tt,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(Mp,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:qe,disabled:!C,style:{padding:"14px 28px",borderRadius:"12px",background:C?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:C?"pointer":"not-allowed",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",boxShadow:C?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(bt,{size:20}),"Aufnahme starten"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",flexWrap:"wrap"},children:[n?.enable_navigation&&c>0&&s.jsxs("button",{onClick:_e,style:{padding:"10px 16px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px"},children:[s.jsx(Qr,{size:18}),"Vorherige"]}),n?.enable_navigation&&c<e.length-1&&s.jsxs("button",{onClick:$t,style:{padding:"10px 16px",borderRadius:"8px",background:Se,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:500},children:["Nchste",s.jsx(Kt,{size:18})]}),s.jsxs("button",{onClick:Vt,disabled:y.length===0,style:{padding:"10px 20px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:600,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(wn,{size:18}),"Training abschlieen"]})]})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:$e,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:c+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:Ce?.category||"Frage"})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:Ce?.question||"Frage wird geladen..."}),Ce?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",marginBottom:"16px"},children:[s.jsx(Je,{size:16}),"Empfohlene Antwortzeit: ~",Math.round(Ce.estimated_time/60)," Min."]}),n?.enable_tips&&Ce?.tips&&s.jsx(Vg,{tips:Ce.tips,primaryAccent:Se})]})]}),O&&s.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{marginTop:"24px",padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(ke,{size:20,color:"#ef4444"}),s.jsx("p",{style:{color:"#dc2626",fontSize:"14px",flex:1},children:O}),s.jsx("button",{onClick:()=>B(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:s.jsx(Ot,{size:16,color:"#ef4444"})})]}),s.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          @keyframes spin { to { transform: rotate(360deg); } }
        `}),s.jsx(rh,{isOpen:D,onClose:()=>z(!1),mode:"audio-video",selectedMicrophoneId:N,onMicrophoneChange:Xe,selectedCameraId:F,onCameraChange:Ge})]})},q4={auftreten:$x,selbstbewusstsein:ni,koerpersprache:qt,kommunikation:Ye,professionalitaet:ni,inhalt:Ne},K4=({score:t,size:e=120,strokeWidth:n=10,primaryAccent:i})=>{const r=(e-n)/2,o=r*2*Math.PI,a=o-t/100*o,l=()=>t>=80?"#22c55e":t>=60?i:t>=40?"#f59e0b":"#ef4444";return s.jsxs("div",{style:{position:"relative",width:e,height:e,margin:"0 auto"},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r,fill:"none",stroke:"#e2e8f0",strokeWidth:n}),s.jsx(V.circle,{cx:e/2,cy:e/2,r,fill:"none",stroke:l(),strokeWidth:n,strokeLinecap:"round",strokeDasharray:o,initial:{strokeDashoffset:o},animate:{strokeDashoffset:a},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3,fontWeight:700,color:l()},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:"#64748b"},children:"von 100"})]})]})},J4=({category:t,primaryAccent:e})=>{const[n,i]=f.useState(!1),r=q4[t.category]||nn,o=a=>a>=80?"#22c55e":a>=60?e:a>=40?"#f59e0b":"#ef4444";return s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:"#fff",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden",marginBottom:"12px"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${o(t.score)}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(r,{size:20,color:o(t.score)})}),s.jsxs("div",{style:{flex:1,textAlign:"left",minWidth:0,overflow:"hidden"},children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"2px"},children:t.label}),s.jsxs("p",{style:{fontSize:"13px",color:"#64748b",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.feedback?.substring(0,60),"..."]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("span",{style:{fontSize:"20px",fontWeight:700,color:o(t.score)},children:Math.round(t.score)}),s.jsx(ct,{size:20,color:"#64748b",style:{transform:n?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),s.jsx(De,{children:n&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #e2e8f0",paddingTop:"16px"},children:[s.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"16px"},children:t.feedback}),t.strengths&&t.strengths.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#22c55e",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ut,{size:14}),"Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.strengths.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]}),t.improvements&&t.improvements.length>0&&s.jsxs("div",{children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#f59e0b",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(ke,{size:14}),"Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.improvements.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]})]})})})]})},Y4=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const{branding:r}=Ue(),o=r?.primaryAccent||"#3A7FA7",a=r?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",l=t?.overall_score||0,c=t?.category_scores||[],d=t?.analysis||{},u=t?.summary_feedback||"",h=p=>p>=90?"Ausgezeichnet!":p>=80?"Sehr gut!":p>=70?"Gut!":p>=60?"Solide Leistung":p>=50?"Ausbaufhig":"Weiter ben!";return s.jsxs("div",{style:{padding:"32px",maxWidth:"900px",margin:"0 auto"},children:[s.jsxs(V.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{textAlign:"center",marginBottom:"40px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:a,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.15)"},children:s.jsx(ko,{size:40,color:"#fff"})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Training abgeschlossen!"}),s.jsxs("p",{style:{fontSize:"16px",color:"#64748b"},children:[e?.title," - Deine Auswertung ist bereit"]})]}),s.jsxs(V.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},style:{background:"#fff",borderRadius:"20px",padding:"32px",textAlign:"center",border:"1px solid #e2e8f0",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[s.jsx(K4,{score:l,size:160,primaryAccent:o}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginTop:"20px",marginBottom:"8px"},children:h(l)}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",maxWidth:"500px",margin:"0 auto",lineHeight:1.6},children:u||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),c.length>0&&s.jsxs(V.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{marginBottom:"24px"},children:[s.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(nn,{size:20,color:o}),"Detaillierte Bewertung"]}),c.map((p,m)=>s.jsx(J4,{category:p,primaryAccent:o},p.category||m))]}),d&&(d.key_strengths?.length>0||d.actionable_tips?.length>0)&&s.jsxs(V.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[d.key_strengths&&d.key_strengths.length>0&&s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#22c55e",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Ut,{size:18}),"Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.key_strengths.map((p,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]}),d.actionable_tips&&d.actionable_tips.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:o,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Ne,{size:18}),"Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.actionable_tips.map((p,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]})]}),t?.video_url&&s.jsxs(V.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(bt,{size:18,color:o}),"Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),s.jsxs(V.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},style:{display:"flex",gap:"16px",justifyContent:"center"},children:[s.jsxs("button",{onClick:n,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(yt,{size:18}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{padding:"14px 28px",borderRadius:"12px",background:a,color:"#fff",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)"},children:[s.jsx(zt,{size:18}),"Nochmal ben"]})]})]})},Jt={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},X4=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingScenario:i,clearPendingScenario:r,onNavigateToHistory:o})=>{const[a,l]=f.useState(Jt.DASHBOARD),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState([]),[x,g]=f.useState({}),[y,v]=f.useState(null),[k,S]=f.useState(null),[C,b]=f.useState(null),[j,w]=f.useState(null);f.useEffect(()=>{i&&t&&(d(i),l(Jt.VARIABLES),r&&r())},[i,t,r]),f.useEffect(()=>{j&&t&&(d(j),l(Jt.VARIABLES),w(null))},[j,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const T=f.useCallback($=>{d($),l(Jt.VARIABLES)},[]),I=f.useCallback(()=>{d(null),h(null),m([]),g({}),v(null),S(null),b(null),l(Jt.DASHBOARD)},[]),E=f.useCallback($=>{g($),l(Jt.DEVICE_SETUP)},[]),P=f.useCallback(()=>{l(Jt.VARIABLES)},[]),O=f.useCallback($=>{h($.session),m($.questions),g($.variables),S($.selectedMicrophoneId),b($.selectedCameraId),l(Jt.SESSION)},[]),B=f.useCallback($=>{v($.session),l(Jt.COMPLETE)},[]),N=f.useCallback(()=>{I()},[I]),M=f.useCallback(()=>{h(null),m([]),v(null),S(null),b(null),l(Jt.VARIABLES)},[]),F=()=>{switch(a){case Jt.DASHBOARD:return s.jsx(Ug,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:w,onNavigateToHistory:o});case Jt.VARIABLES:return s.jsx(W4,{scenario:c,onBack:I,onNext:E});case Jt.DEVICE_SETUP:return s.jsx(G4,{scenario:c,variables:x,onBack:P,onStart:O});case Jt.SESSION:return s.jsx(H4,{session:u,questions:p,scenario:c,variables:x,onComplete:B,onExit:N,selectedMicrophoneId:k,selectedCameraId:C});case Jt.COMPLETE:return s.jsx(Y4,{session:y,scenario:c,onBackToDashboard:I,onStartNew:M});default:return s.jsx(Ug,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:w,onNavigateToHistory:o})}};return s.jsx("div",{style:{minHeight:"100%"},children:F()})},pv={rocket:oi,shuffle:Wj,zap:rl},ea=({icon:t,label:e,value:n,primaryAccent:i,primaryAccentLight:r,isMobile:o,b:a})=>s.jsxs("div",{style:{backgroundColor:"white",borderRadius:o?a.radius.md:a.radius.lg,padding:o?a.space[3]:a.space[4],border:`1px solid ${R.slate[200]}`},children:[s.jsx("div",{style:{width:o?"32px":"40px",height:o?"32px":"40px",borderRadius:o?a.radius.sm:a.radius.md,backgroundColor:r,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:o?a.space[2]:a.space[3]},children:s.jsx(t,{style:{width:o?"16px":"20px",height:o?"16px":"20px",color:i}})}),s.jsx("div",{style:{fontSize:o?a.fontSize.xl:a.fontSize["2xl"],fontWeight:700,color:R.slate[900]},children:n}),s.jsx("div",{style:{fontSize:o?a.fontSize["2xs"]:a.fontSize.xs,color:R.slate[500]},children:e})]}),Z4=({mode:t,onBack:e,onStart:n})=>{const[i,r]=f.useState(""),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),h=pv[t.icon]||oi;ah[t.id]||ah.klassiker;const p=Ve();f.useEffect(()=>{t.id==="klassiker"?r(t.topic):t.getTopic&&r(t.getTopic())},[t]);const m=()=>{if(!t.getTopic)return;a(!0);const g=1500,y=100;let v=0;const k=setInterval(()=>{r(t.getTopic()),v+=y,v>=g&&(clearInterval(k),a(!1))},y)},x=()=>{n({mode:t,topic:i,duration:t.duration,selectedMicrophoneId:l})};return s.jsxs("div",{style:{minHeight:"100%",display:"flex",flexDirection:"column",padding:p.space[6]},children:[s.jsxs(V.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:e,style:{display:"flex",alignItems:"center",gap:p.space[2],padding:`${p.space[2.5]} ${p.space[4]}`,backgroundColor:"white",border:`1px solid ${R.slate[200]}`,borderRadius:p.radius.md,color:R.slate[600],fontSize:p.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:p.space[8],width:"fit-content"},children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck zur Auswahl"]}),s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"600px",margin:"0 auto",width:"100%"},children:[s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{textAlign:"center",marginBottom:p.space[8]},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:p.radius["2xl"],background:p.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${p.space[5]}`,boxShadow:p.coloredShadow(p.primaryAccent,"lg")},children:s.jsx(h,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsx("h1",{style:{fontSize:p.fontSize["3xl"],fontWeight:700,color:R.slate[900],margin:`0 0 ${p.space[2]} 0`},children:t.title}),s.jsxs("p",{style:{fontSize:p.fontSize.md,color:R.slate[500],margin:0},children:[t.duration," Sekunden  ",t.subtitle]})]}),s.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{width:"100%",background:p.headerGradient,borderRadius:p.radius["2xl"],padding:p.space[8],marginBottom:p.space[6],boxShadow:p.coloredShadow(p.primaryAccent,"xl")},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:p.space[5]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2.5],color:"rgba(255,255,255,0.9)"},children:[s.jsx(ts,{style:{width:"20px",height:"20px"}}),s.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.md},children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&s.jsxs(V.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:m,disabled:o,style:{display:"flex",alignItems:"center",gap:p.space[2],padding:`${p.space[2.5]} ${p.space[4.5]}`,backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:p.radius.md,color:"white",fontSize:p.fontSize.sm,fontWeight:600,cursor:o?"not-allowed":"pointer"},children:[s.jsx(zt,{style:{width:"16px",height:"16px",animation:o?"spin 0.5s linear infinite":"none"}}),o?"Dreht...":"Neu wrfeln"]})]}),s.jsx(De,{mode:"wait",children:s.jsxs(V.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{fontSize:p.fontSize["2xl"],fontWeight:600,color:"white",margin:0,lineHeight:1.5,minHeight:"66px"},children:['"',i,'"']},i)})]}),s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{width:"100%",backgroundColor:"white",borderRadius:p.radius.xl,padding:p.space[6],marginBottom:p.space[6],border:`1px solid ${R.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2.5],marginBottom:p.space[4],color:R.slate[700]},children:[s.jsx(Fe,{style:{width:"20px",height:"20px",color:p.primaryAccent}}),s.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.md},children:"Mikrofon auswhlen"})]}),s.jsx(Au,{selectedDeviceId:l,onDeviceChange:c,onTestClick:()=>u(!0)})]}),s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{width:"100%",backgroundColor:R.slate[50],borderRadius:p.radius.xl,padding:p.space[5],marginBottom:p.space[8]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:p.space[2],marginBottom:p.space[3],color:R.slate[700]},children:[s.jsx(St,{style:{width:"18px",height:"18px",color:R.amber[500]}}),s.jsx("span",{style:{fontWeight:600,fontSize:p.fontSize.sm},children:"Tipps fr deine Antwort"})]}),s.jsxs("ul",{style:{margin:0,paddingLeft:p.space[5],color:R.slate[600],fontSize:p.fontSize.sm,lineHeight:1.7},children:[s.jsx("li",{children:"Atme tief durch bevor du beginnst"}),s.jsx("li",{children:"Sprich in einem ruhigen, gleichmigen Tempo"}),s.jsx("li",{children:'Mache bewusst Pausen statt "hm" zu sagen'}),s.jsx("li",{children:"Strukturiere deine Antwort: Einleitung  Hauptteil  Schluss"})]})]}),s.jsxs(V.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:x,style:{width:"100%",maxWidth:"400px",padding:`${p.space[4.5]} ${p.space[8]}`,borderRadius:p.radius.xl,border:"none",background:p.buttonGradient,color:"white",fontSize:p.fontSize.lg,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:p.space[3],boxShadow:p.coloredShadow(p.primaryAccent,"md")},children:[s.jsx(Dt,{style:{width:"22px",height:"22px"}}),"Aufnahme starten"]})]}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),s.jsx(_u,{isOpen:d,onClose:()=>u(!1),deviceId:l})]})},Vs={MODES:"modes",TOPIC:"topic"},Q4=({onStartGame:t,isAuthenticated:e,requireAuth:n,setPendingAction:i})=>{const[r,o]=f.useState(Vs.MODES),[a,l]=f.useState(null),[c,d]=f.useState("grid"),[u,h]=f.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),p=Un(),[m,x]=f.useState(null),g=Ve();f.useEffect(()=>{const C=async()=>{try{const b=await ue.getGameStats();b.success&&b.data&&h({totalGames:b.data.total_games||0,bestScore:b.data.best_score||0,avgScore:b.data.avg_score||0,totalPracticeTime:b.data.total_practice_time||0})}catch(b){console.error("Failed to load stats:",b)}};r===Vs.MODES&&C()},[r]),f.useEffect(()=>{m&&e&&(l(m),o(Vs.TOPIC),x(null))},[m,e]),f.useEffect(()=>{window.scrollTo(0,0)},[r]);const y=C=>{if(!e){x(C),n&&n(()=>{},null);return}l(C),o(Vs.TOPIC)},v=()=>{l(null),o(Vs.MODES)},k=C=>{t(C)},S=Object.values(zT);return r===Vs.TOPIC&&a?s.jsx(Z4,{mode:a,onBack:v,onStart:k}):s.jsxs("div",{style:{padding:p?g.space[4]:g.space[6]},children:[s.jsxs("div",{style:{marginBottom:p?g.space[5]:g.space[8],textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:p?g.space[2.5]:g.space[3],marginBottom:p?g.space[2]:g.space[3]},children:[s.jsx("div",{style:{width:p?"40px":"48px",height:p?"40px":"48px",borderRadius:p?g.radius.lg:g.radius.xl,background:g.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(hu,{style:{width:p?"20px":"24px",height:p?"20px":"24px",color:g.headerText}})}),s.jsx("h1",{style:{fontSize:p?g.fontSize["2xl"]:g.fontSize["3xl"],fontWeight:700,color:R.slate[900],margin:0},children:"Der Fllwort-Killer"})]}),s.jsx("p",{style:{fontSize:p?g.fontSize.sm:g.fontSize.base,color:R.slate[600],maxWidth:"600px",margin:"0 auto"},children:"Trainiere deine Rhetorik - sprich flssig und berzeugend ohne hm und h!"})]}),s.jsxs("div",{style:{padding:p?`0 ${g.space[2]}`:`0 ${g.space[6]}`},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:p?"repeat(2, 1fr)":"repeat(auto-fit, minmax(150px, 1fr))",gap:p?g.space[2.5]:g.space[4],marginBottom:p?g.space[6]:g.space[8]},children:[s.jsx(ea,{icon:ko,label:"Highscore",value:u.bestScore||"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),s.jsx(ea,{icon:et,label:"Spiele",value:u.totalGames||0,primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),s.jsx(ea,{icon:dn,label:"Durchschnitt",value:u.avgScore?Math.round(u.avgScore):"-",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g}),s.jsx(ea,{icon:Je,label:"Trainingszeit",value:u.totalPracticeTime?`${Math.round(u.totalPracticeTime/60)}m`:"0m",primaryAccent:g.primaryAccent,primaryAccentLight:g.primaryAccentLight,isMobile:p,b:g})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:g.space[4]},children:[s.jsx("h2",{style:{fontSize:g.fontSize.lg,fontWeight:600,color:R.slate[800],margin:0},children:"Whle deinen Modus"}),s.jsx(r2,{viewMode:c,onViewChange:d})]}),s.jsx(h0,{minCardWidth:"280px",viewMode:c,children:S.map(C=>{const b=pv[C.icon]||oi;return s.jsx(u0,{title:C.title,subtitle:C.subtitle,description:C.description,icon:b,meta:[{icon:Je,text:`${C.duration} Sekunden`}],action:{label:"Starten",icon:dn},onClick:()=>y(C),viewMode:c},C.id)})})]})]})},_t={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},eN=({count:t,branding:e})=>s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:s.jsxs(V.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},style:{color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"120px",fontWeight:700,marginBottom:"16px"},children:t}),s.jsx("div",{style:{fontSize:"24px",color:e.textMuted},children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),tN=({seconds:t,total:e,isWarning:n,primaryAccent:i,branding:r})=>{const o=t/e*100,a=Math.floor(t/60),l=t%60;return s.jsxs("div",{children:[s.jsxs("div",{style:{fontSize:"64px",fontWeight:700,fontFamily:"monospace",textAlign:"center",color:n?r.error:r.textMain},children:[a,":",l.toString().padStart(2,"0")]}),s.jsx("div",{style:{marginTop:"16px",height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:s.jsx(V.div,{style:{height:"100%",backgroundColor:n?r.error:i,borderRadius:"4px"},initial:{width:"100%"},animate:{width:`${o}%`},transition:{duration:.5}})})]})},nN=({word:t,count:e,branding:n})=>s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:n.space[1],padding:`${n.space[1.5]} ${n.space[3]}`,backgroundColor:n.errorLight,color:n.error,borderRadius:n.radius["2xl"],fontSize:n.fontSize.base,fontWeight:n.fontWeight.medium},children:['"',t,'"',s.jsxs("span",{style:{backgroundColor:`${n.error}30`,padding:`${n.space[.5]||"2px"} ${n.space[1.5]}`,borderRadius:n.radius.md,fontSize:n.fontSize.xs},children:[e,"x"]})]}),iN=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(e=>e.length>0).length,sN=t=>!t||!Array.isArray(t)?0:t.reduce((e,n)=>e+(n.count||0),0),rN=(t,e,n,i)=>{const r=iN(t),o=sN(e),a=r>0?o/r*100:0,l=i>0?Math.round(r/i*60):0;let c=0;r>=60?c=25:r>=40?c=15:r>=20?c=10:r>=10&&(c=5);let d=25;a>25?d=0:a>15?d=10:a>10?d=15:a>5&&(d=20);let u=0,h="keine_sprache";r>0&&(l>=100&&l<=140?(u=10,h="optimal"):l>=80&&l<100||l>140&&l<=160?(u=5,h=l<100?"zu_langsam":"zu_schnell"):(u=0,h=l<80?"zu_langsam":"zu_schnell"));const p=Math.min(40,Math.max(0,n||0)),m=c+d+u+p;return{total_words:r,filler_count:o,filler_percentage:a,words_per_minute:l,pace_feedback:h,score:m,score_breakdown:{words_score:c,filler_score:d,tempo_score:u,content_score:p}}},oN=({result:t,onPlayAgain:e,onBack:n,buttonGradient:i,primaryAccent:r,primaryAccentLight:o,branding:a})=>{const l=PT(t.score),c=t.score>=70,d=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]";return s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[s.jsxs("div",{style:{borderRadius:a.radius["2xl"],padding:a.space[8],marginBottom:a.space[6],background:d?`linear-gradient(135deg, ${a.textSecondary} 0%, ${a.textMuted} 100%)`:c?`linear-gradient(135deg, ${a.success} 0%, ${r} 100%)`:`linear-gradient(135deg, ${a.warning} 0%, ${a.warningDark||a.warning} 100%)`,color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:a.iconSize["4xl"],marginBottom:a.space[2]},children:d?"":l.emoji}),s.jsx("div",{style:{fontSize:"72px",fontWeight:a.fontWeight.bold,marginBottom:a.space[2]},children:t.score}),s.jsx("div",{style:{fontSize:a.fontSize.xl,opacity:.9,marginBottom:a.space[4]},children:"Punkte"}),s.jsx("p",{style:{fontSize:a.fontSize.lg,margin:0},children:d?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":l.message})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:a.space[3],marginBottom:a.space[6]},children:[s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[1.5],color:r,marginBottom:a.space[1.5]},children:[s.jsx(ts,{style:{width:a.iconSize.sm,height:a.iconSize.sm}}),s.jsx("span",{style:{fontWeight:a.fontWeight.medium,fontSize:a.fontSize.sm},children:"Wrter"})]}),s.jsx("div",{style:{fontSize:a.fontSize["4xl"],fontWeight:a.fontWeight.bold,color:a.textMain},children:t.total_words}),s.jsx("div",{style:{fontSize:a.fontSize["2xs"],color:a.textMuted},children:"gesprochen"})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:a.radius.lg,padding:a.space[3.5],border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.error,marginBottom:"6px"},children:[s.jsx(ss,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Fllwrter"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.filler_count}),s.jsxs("div",{style:{fontSize:"11px",color:a.textMuted},children:[t.filler_percentage?.toFixed(1)||"0","%"]})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r,marginBottom:"6px"},children:[s.jsx(ki,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Tempo"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.words_per_minute}),s.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"WPM"})]}),s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${a.borderColor}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:a.textSecondary,marginBottom:"6px"},children:[s.jsx(Je,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Sprechzeit"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:a.textMain},children:t.duration_seconds||0}),s.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"Sekunden"})]})]}),t.filler_words&&t.filler_words.length>0&&s.jsxs("div",{style:{backgroundColor:a.cardBg,borderRadius:"12px",padding:"16px",border:`1px solid ${a.borderColor}`,marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Erkannte Fllwrter"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:t.filler_words.map((u,h)=>s.jsx(nN,{word:u.word,count:u.count,branding:a},h))})]}),!d&&s.jsxs("div",{style:{backgroundColor:o,border:`1px solid ${r}26`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:r,marginBottom:"12px",fontSize:"15px"},children:"Bewertung im Detail"}),t.score_breakdown&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:t.content_feedback?"12px":0},children:[s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Wortanzahl: ",s.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Fllwrter: ",s.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Tempo: ",s.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[" Inhalt: ",s.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&s.jsx("div",{style:{paddingTop:"12px",borderTop:`1px solid ${r}26`},children:s.jsxs("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0,lineHeight:1.5},children:[s.jsx("strong",{children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&s.jsxs("div",{style:{backgroundColor:a.warningLight,border:`1px solid ${a.warning}40`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.warning,marginBottom:"8px",fontSize:"15px"},children:"Tempo-Hinweis"}),s.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,margin:0},children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine Prsentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&s.jsxs("div",{style:{backgroundColor:a.cardBgHover,borderRadius:"12px",border:`1px solid ${a.borderColor}`,padding:"16px",marginBottom:"32px"},children:[s.jsx("h4",{style:{fontWeight:600,color:a.textMain,marginBottom:"12px",fontSize:"15px"},children:"Transkript"}),s.jsx("p",{style:{fontSize:"14px",color:a.textSecondary,lineHeight:1.6,margin:0},children:t.transcript})]}),s.jsxs("div",{style:{display:"flex",gap:"16px"},children:[s.jsxs("button",{onClick:e,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:"none",background:i,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal spielen"]}),s.jsxs("button",{onClick:n,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:`1px solid ${a.borderColor}`,backgroundColor:a.cardBg,color:a.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck"]})]})]})},aN=({gameConfig:t,onBack:e,onComplete:n})=>{const[i,r]=f.useState(_t.COUNTDOWN),[o,a]=f.useState(3),[l,c]=f.useState(t.duration),[d,u]=f.useState(null),[h,p]=f.useState(null),[m,x]=f.useState(0),[g,y]=f.useState(!1),{branding:v}=Ue(),k=v?.["--header-gradient"]||Ie["--header-gradient"],S=v?.["--button-gradient"]||k,C=v?.["--primary-accent"]||Ie["--primary-accent"],b=v?.["--primary-accent-light"]||Ie["--primary-accent-light"],j=Ve(),w=f.useRef(null),T=f.useRef([]),I=f.useRef(null),E=f.useRef(null),P=f.useRef(null),O=f.useRef(null),B=f.useRef(null),N=ue.getGeminiApiKey(),M=f.useCallback(()=>{I.current&&clearInterval(I.current),O.current&&cancelAnimationFrame(O.current),P.current&&(P.current.close(),P.current=null),w.current&&w.current.state!=="inactive"&&w.current.stop()},[]);f.useEffect(()=>M,[M]),f.useEffect(()=>{g||(y(!0),F())},[g]);const F=async()=>{r(_t.COUNTDOWN),a(3);try{const G=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,q=await navigator.mediaDevices.getUserMedia({audio:G});P.current=new(window.AudioContext||window.webkitAudioContext);const ie=P.current.createMediaStreamSource(q);E.current=P.current.createAnalyser(),E.current.fftSize=256,ie.connect(E.current),w.current=new MediaRecorder(q,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),T.current=[],w.current.ondataavailable=H=>{H.data.size>0&&T.current.push(H.data)};let A=3;const W=setInterval(()=>{A--,a(A),A===0&&(clearInterval(W),D())},1e3)}catch(G){console.error("Microphone access denied:",G),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(_t.ERROR)}},$=f.useCallback(async()=>{r(_t.COUNTDOWN),a(3);try{const G=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,q=await navigator.mediaDevices.getUserMedia({audio:G});P.current=new(window.AudioContext||window.webkitAudioContext);const ie=P.current.createMediaStreamSource(q);E.current=P.current.createAnalyser(),E.current.fftSize=256,ie.connect(E.current),w.current=new MediaRecorder(q,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),T.current=[],w.current.ondataavailable=H=>{H.data.size>0&&T.current.push(H.data)};let A=3;const W=setInterval(()=>{A--,a(A),A===0&&(clearInterval(W),D())},1e3)}catch(G){console.error("Microphone access denied:",G),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(_t.ERROR)}},[t.selectedMicrophoneId]),D=f.useCallback(()=>{r(_t.RECORDING),c(t.duration),B.current=Date.now(),w.current.start();const G=()=>{if(E.current){const q=new Uint8Array(E.current.frequencyBinCount);E.current.getByteFrequencyData(q);const ie=q.reduce((A,W)=>A+W)/q.length;x(ie/255)}O.current=requestAnimationFrame(G)};G(),I.current=setInterval(()=>{c(q=>q<=1?(z(),0):q-1)},1e3)},[t.duration]),z=f.useCallback(()=>{const G=B.current?Math.round((Date.now()-B.current)/1e3):t.duration;M(),r(_t.PROCESSING),w.current.onstop=async()=>{const q=new Blob(T.current,{type:w.current.mimeType});w.current.stream.getTracks().forEach(A=>A.stop());const ie=vu(q,{minSize:bu});if(!ie.valid){console.warn("[GameSession] Audio validation failed:",ie.error,"Size:",q.size);const A={...yu("game"),score:0,word_count:0,filler_count:0,words_per_minute:0,duration_seconds:G};u(A),r(_t.RESULTS);return}try{const A=await $T(q,N,t.topic,t.duration),H={...rN(A.transcript,A.filler_words,A.content_score,G),transcript:A.transcript||"[Keine Sprache erkannt]",filler_words:A.filler_words||[],content_feedback:A.content_feedback||"",duration_seconds:G};u(H),r(_t.RESULTS);try{const oe={game_type:t.mode.id,topic:t.topic,duration_seconds:G,score:H.score,filler_count:H.filler_count,words_per_minute:H.words_per_minute,transcript:H.transcript,analysis_json:JSON.stringify(H)};await ue.createGameSession(oe)}catch(oe){console.error("[GameSession] Failed to save game session:",oe)}}catch(A){console.error("Analysis failed:",A),p(`Analyse fehlgeschlagen: ${A.message}`),r(_t.ERROR)}},w.current.stop()},[N,t,M]),L=()=>{z()},ee=()=>{u(null),p(null),c(t.duration),$()},se=()=>{switch(i){case _t.READY:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:""}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:j.textMain,marginBottom:"12px"},children:"Bereit?"}),s.jsx("p",{style:{fontSize:"16px",color:j.textSecondary,marginBottom:"24px",lineHeight:1.6},children:t.topic}),s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:j.cardBgHover,borderRadius:"20px",color:j.textSecondary,fontSize:"14px",marginBottom:"32px"},children:[s.jsx(Je,{style:{width:"16px",height:"16px"}}),t.duration," Sekunden"]}),s.jsx("div",{children:s.jsxs("button",{onClick:$,style:{padding:"16px 40px",borderRadius:"14px",border:"none",background:S,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 14px ${C}66`},children:[s.jsx(Dt,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]})}),s.jsxs("button",{onClick:e,style:{marginTop:"24px",padding:"10px 20px",border:"none",backgroundColor:"transparent",color:j.textMuted,fontSize:"14px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},children:[s.jsx(yt,{style:{width:"16px",height:"16px"}}),"Zurck zur Auswahl"]})]})});case _t.RECORDING:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx(tN,{seconds:l,total:t.duration,isWarning:l<=10,primaryAccent:C,branding:j}),s.jsxs("div",{style:{marginTop:"32px",marginBottom:"32px",padding:"16px",backgroundColor:j.cardBgHover,borderRadius:"12px"},children:[s.jsx("p",{style:{fontSize:"13px",color:j.textMuted,marginBottom:"4px"},children:"Dein Thema:"}),s.jsx("p",{style:{fontSize:"15px",fontWeight:500,color:j.textMain,margin:0},children:t.topic})]}),s.jsx("div",{style:{marginBottom:"32px"},children:s.jsx(V.div,{style:{height:"80px",background:S,borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},animate:{opacity:.6+m*.4},children:s.jsx(V.div,{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},animate:{scale:1+m*.3},children:s.jsx(Fe,{style:{width:"28px",height:"28px",color:"white"}})})})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"32px"},children:[s.jsx(V.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:j.error}}),s.jsx("span",{style:{fontWeight:500,color:j.error,fontSize:"14px"},children:"Aufnahme luft..."})]}),s.jsxs("button",{onClick:L,style:{padding:"12px 24px",borderRadius:"12px",border:"none",backgroundColor:j.error,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(ks,{style:{width:"16px",height:"16px"}}),"Aufnahme beenden"]})]})});case _t.PROCESSING:return s.jsxs("div",{style:{textAlign:"center",padding:"80px 20px"},children:[s.jsx(V.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},style:{width:"56px",height:"56px",border:`4px solid ${C}`,borderTopColor:"transparent",borderRadius:"50%",margin:"0 auto 24px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:j.textMain,marginBottom:"8px"},children:"Analysiere deine Aufnahme..."}),s.jsx("p",{style:{color:j.textMuted},children:"Der Fllwort-Killer zhlt nach"})]});case _t.RESULTS:return s.jsx(oN,{result:d,onPlayAgain:ee,onBack:e,buttonGradient:S,primaryAccent:C,primaryAccentLight:b,branding:j});case _t.ERROR:return s.jsx("div",{style:{textAlign:"center",padding:"60px 20px"},children:s.jsxs("div",{style:{maxWidth:"400px",margin:"0 auto"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:j.errorLight,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(vj,{style:{width:"32px",height:"32px",color:j.error}})}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:j.textMain,marginBottom:"12px"},children:"Fehler"}),s.jsx("p",{style:{color:j.textSecondary,marginBottom:"24px"},children:h}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[s.jsxs("button",{onClick:ee,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:S,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(Si,{style:{width:"16px",height:"16px"}}),"Erneut versuchen"]}),s.jsxs("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"12px",border:`1px solid ${j.borderColor}`,backgroundColor:j.cardBg,color:j.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(yt,{style:{width:"16px",height:"16px"}}),"Zurck"]})]})]})});default:return null}};return s.jsxs("div",{style:{minHeight:"100%",paddingBottom:"32px"},children:[s.jsx(De,{children:i===_t.COUNTDOWN&&s.jsx(eN,{count:o,branding:j})}),i!==_t.COUNTDOWN&&i!==_t.RECORDING&&s.jsx("div",{style:{padding:"16px 24px",borderBottom:`1px solid ${j.borderColor}`,backgroundColor:j.cardBg,position:"sticky",top:0,zIndex:10},children:s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",border:"none",backgroundColor:"transparent",color:j.textSecondary,fontSize:"14px",cursor:"pointer"},children:[s.jsx(yt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsx("h1",{style:{fontWeight:600,color:j.textMain,fontSize:"16px",margin:0},children:t.mode.title}),s.jsx("div",{style:{width:"60px"}})]})}),s.jsx("div",{style:{padding:"24px"},children:s.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:se()})})]})},lN={"file-text":Nt,briefcase:Tn,banknote:is,users:mn,user:qt,"message-circle":ts,target:et,award:ni,book:Ro,clipboard:Io,star:nn,lightbulb:Ne,shield:Ii,compass:Ao,rocket:oi,heart:tl,folder:_o,"trending-up":dn},cN=({onSelectTemplate:t,onShowList:e,onCreateTemplate:n,onEditTemplate:i,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l})=>{const{branding:c}=Ue(),d=c?.["--primary-accent"]||Ie["--primary-accent"],[u,h]=f.useState(null),[p,m]=f.useState(0),x=f.useCallback(async()=>{const I=new URLSearchParams;l&&I.append("demo_code",l);const E=await ue.request(`/smartbriefing/templates?${I.toString()}`,{method:"GET"});if(E.success&&E.data?.templates)return E.data.templates;throw new Error("Unerwartete API-Antwort")},[l,p]),g=()=>{if(!r&&!l){o&&(a(()=>n),o());return}n?.()},y=(I,E)=>{I.stopPropagation(),i?.(E)},v=(I,E)=>{I.stopPropagation(),h(E)},k=async()=>{if(u)try{const I=new URLSearchParams;l&&I.append("demo_code",l),(await ue.request(`/smartbriefing/templates/${u.id}?${I.toString()}`,{method:"DELETE"})).success&&m(P=>P+1)}catch(I){console.error("[SmartBriefing] Error deleting template:",I)}finally{h(null)}},S=I=>lN[I.icon]||Nt,C=I=>{const E=I.variables_schema?.length||0;return[{text:`${E} Eingabefeld${E!==1?"er":""}`}]},b=I=>I.is_custom?s.jsxs("div",{style:{display:"flex",gap:"4px"},children:[s.jsx("button",{onClick:E=>y(E,I),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:E=>{E.currentTarget.style.backgroundColor="#f1f5f9",E.currentTarget.style.color=d},onMouseLeave:E=>{E.currentTarget.style.backgroundColor="transparent",E.currentTarget.style.color="#64748b"},title:"Template bearbeiten",children:s.jsx(fu,{size:16})}),s.jsx("button",{onClick:E=>v(E,I),style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#64748b",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:E=>{E.currentTarget.style.backgroundColor="#fef2f2",E.currentTarget.style.color="#ef4444"},onMouseLeave:E=>{E.currentTarget.style.backgroundColor="transparent",E.currentTarget.style.color="#64748b"},title:"Template lschen",children:s.jsx(We,{size:16})})]}):null,j=(r||l)&&n?s.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s",whiteSpace:"nowrap"},onMouseEnter:I=>{I.currentTarget.style.borderColor=d,I.currentTarget.style.color=d},onMouseLeave:I=>{I.currentTarget.style.borderColor="#cbd5e1",I.currentTarget.style.color="#64748b"},children:[s.jsx(At,{size:18}),s.jsx("span",{className:"hidden sm:inline",children:"persnliches Template"}),s.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,w=()=>s.jsx("div",{style:{marginTop:"48px",padding:"20px 24px",backgroundColor:`${d}08`,borderRadius:"12px",border:`1px solid ${d}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ne,{size:20,style:{color:d,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"So funktioniert Smart Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.6},children:"Wahle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein massgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren Ruckfragen."})]})]})}),T=u&&s.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},onClick:()=>h(null),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"100%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:I=>I.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fef2f2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{size:24,style:{color:"#ef4444"}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Template lschen?"}),s.jsx("p",{style:{margin:0,fontSize:"14px",color:"#64748b"},children:"Diese Aktion kann nicht rckgngig gemacht werden."})]})]}),s.jsx("div",{style:{backgroundColor:"#f8fafc",borderRadius:"8px",padding:"12px",marginBottom:"20px"},children:s.jsx("p",{style:{margin:0,fontSize:"14px",color:"#475569"},children:s.jsx("strong",{children:u.title})})}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>h(null),style:{padding:"10px 20px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:k,style:{padding:"10px 20px",borderRadius:"8px",border:"none",backgroundColor:"#ef4444",color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Lschen"})]})]})});return s.jsx(cl,{title:"Smart Briefing",subtitle:"Dein KI-gesttzter Vorbereitungs-Assistent",headerIcon:Nt,fetchScenarios:x,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:e,onSelectScenario:t,renderCardMeta:C,getIconForScenario:S,getCardCustomActions:b,cardActionLabel:"Briefing erstellen",cardActionIcon:Kt,categoryField:"category",emptyStateIcon:Nt,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:j,renderInfoBox:w,extraContent:T,isAuthenticated:r,requireAuth:o,setPendingAction:a,demoCode:l,loadingMessage:"Templates werden geladen..."},p)},dN=({field:t,value:e,onChange:n,error:i,primaryAccent:r})=>{const o={width:"100%",padding:"14px 16px",borderRadius:"12px",border:`2px solid ${i?"#ef4444":"#e2e8f0"}`,fontSize:"16px",color:"#0f172a",backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s",boxSizing:"border-box"},a=d=>{d.target.style.borderColor=r,d.target.style.boxShadow=`0 0 0 3px ${r}1a`},l=d=>{d.target.style.borderColor=i?"#ef4444":"#e2e8f0",d.target.style.boxShadow="none"},c=()=>{switch(t.type){case"textarea":return s.jsx("textarea",{value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",rows:4,style:{...o,minHeight:"120px",resize:"vertical"},onFocus:a,onBlur:l});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:d=>n(t.key,d.target.value),style:{...o,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"20px",paddingRight:"44px"},onFocus:a,onBlur:l,children:[s.jsx("option",{value:"",children:"Bitte wahlen..."}),t.options?.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))]});case"text":default:return s.jsx("input",{type:"text",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",style:o,onFocus:a,onBlur:l})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#374151",marginBottom:"8px"},children:[t.label,t.required&&s.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),c(),i&&s.jsx("p",{style:{color:"#ef4444",fontSize:"13px",marginTop:"6px",margin:"6px 0 0 0"},children:i})]})},uN=({variable:t,index:e,onChange:n,onDelete:i,primaryAccent:r})=>s.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsx("input",{type:"text",value:t.key||"",onChange:o=>n(e,"key",o.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",flex:1,marginRight:"8px"}}),s.jsx("button",{type:"button",onClick:()=>i(e),style:{padding:"8px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(We,{size:18})})]}),s.jsx("textarea",{value:t.value||"",onChange:o=>n(e,"value",o.target.value),placeholder:"Wert eingeben... (mehrzeilig mglich)",rows:3,style:{width:"100%",padding:"10px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical",minHeight:"80px",boxSizing:"border-box"}})]}),hN=({template:t,onBack:e,onBriefingGenerated:n,isAuthenticated:i})=>{const{branding:r}=Ue(),[o,a]=f.useState({}),[l,c]=f.useState({}),[d,u]=f.useState(!1),[h,p]=f.useState(null),[m,x]=f.useState([]),[g,y]=f.useState(!1),v=r?.["--primary-accent"]||Ie["--primary-accent"],k=r?.["--button-gradient"]||Ie["--button-gradient"],S=av(t?.icon);f.useEffect(()=>{if(t?.variables_schema){const E={};t.variables_schema.forEach(P=>{P.default&&(E[P.key]=P.default)}),a(E)}x([]),y(!1)},[t]);const C=()=>{x([...m,{key:"",value:""}])},b=(E,P,O)=>{const B=[...m];B[E][P]=O,x(B)},j=E=>{x(m.filter((P,O)=>O!==E))},w=(E,P)=>{a(O=>({...O,[E]:P})),l[E]&&c(O=>{const B={...O};return delete B[E],B})},T=()=>{const E={};return t?.variables_schema?.forEach(P=>{P.required&&!o[P.key]&&(E[P.key]="Dieses Feld ist erforderlich")}),E},I=async E=>{E.preventDefault();const P=T();if(Object.keys(P).length>0){c(P);return}u(!0),p(null);try{const O={};m.forEach(M=>{M.key&&M.value&&(O[M.key]=M.value)});const B={template_id:t.id,variables:o};Object.keys(O).length>0&&(B.custom_variables=O);const N=await ue.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(B)});if(N.success&&N.data?.briefing)n(N.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(O){console.error("[SmartBriefing] Error generating briefing:",O),p(O.message||"Fehler beim Generieren des Briefings")}finally{u(!1)}};return t?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{padding:"24px",paddingTop:"32px",maxWidth:"700px",margin:"0 auto"},children:[s.jsxs("button",{onClick:e,disabled:d,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:d?"not-allowed":"pointer",marginBottom:"24px",opacity:d?.5:1},children:[s.jsx(yt,{size:18}),s.jsx("span",{style:{lineHeight:"1.4"},children:"Zurck zur bersicht"})]}),s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",marginBottom:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`linear-gradient(135deg, ${v}15, ${v}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(S,{size:28,style:{color:v}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:t.description})]})]})}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 20px 0",paddingBottom:"16px",borderBottom:"1px solid #f1f5f9"},children:"Deine Angaben"}),s.jsxs("form",{onSubmit:I,children:[t.variables_schema?.map(E=>s.jsx(dN,{field:E,value:o[E.key],onChange:w,error:l[E.key],primaryAccent:v},E.key)),t.allow_custom_variables&&s.jsxs("div",{style:{marginTop:"24px",marginBottom:"20px",paddingTop:"20px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("button",{type:"button",onClick:()=>y(!g),style:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:g?"16px":"0",textAlign:"left"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[g?s.jsx(Yn,{size:18}):s.jsx(ct,{size:18}),s.jsx(At,{size:16})]}),s.jsx("span",{style:{lineHeight:"1.4"},children:"Zustzliche Variablen hinzufgen (optional)"})]}),g&&s.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",padding:"16px"},children:[s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:"Fge eigene Variablen hinzu, die in die Briefing-Generierung einflieen sollen."}),m.length>0&&s.jsx("div",{style:{marginBottom:"12px"},children:m.map((E,P)=>s.jsx(uN,{variable:E,index:P,onChange:b,onDelete:j,primaryAccent:v},P))}),s.jsxs("button",{type:"button",onClick:C,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"8px",backgroundColor:"white",color:"#64748b",fontSize:"13px",cursor:"pointer"},children:[s.jsx(At,{size:14}),"Variable hinzufgen"]})]})]}),h&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"16px",marginBottom:"20px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(ke,{size:20,style:{color:"#ef4444",flexShrink:0}}),s.jsx("div",{children:s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:h})})]}),s.jsxs("button",{type:"submit",disabled:d,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",border:"none",background:k,color:"white",fontSize:"16px",fontWeight:600,cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s",boxShadow:`0 4px 14px ${v}40`,opacity:d?.7:1},children:[s.jsx(St,{size:20}),"Briefing generieren"]})]})]})]}),s.jsx(oh,{isLoading:d,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein mageschneidertes Briefing."})]}):null},pN={"file-text":Nt,briefcase:Tn,banknote:is,users:mn,user:qt,"message-circle":ts,target:et,award:ni,book:Ro,clipboard:Io,star:nn,lightbulb:Ne,shield:Ii,compass:Ao,rocket:oi},fN=({content:t,primaryAccent:e})=>{if(!t)return null;const n=r=>{const o=r.split(`
`),a=[];let l=[],c=null;const d=()=>{l.length>0&&(a.push(s.jsx("ul",{style:{margin:"12px 0",paddingLeft:"24px",listStyle:"none"},children:l.map((u,h)=>s.jsxs("li",{style:{marginBottom:"8px",fontSize:"15px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"20px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:c==="number"?`${h+1}.`:""}),i(u)]},h))},`list-${a.length}`)),l=[],c=null)};return o.forEach((u,h)=>{const p=u.trim();if(!p){d();return}if(p.startsWith("### ")){d(),a.push(s.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"24px 0 12px 0",paddingTop:"16px",borderTop:h>0?"1px solid #f1f5f9":"none",display:"flex",alignItems:"center",gap:"8px"},children:i(p.substring(4))},`h3-${h}`));return}if(p.startsWith("## ")){d(),a.push(s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"28px 0 14px 0"},children:i(p.substring(3))},`h2-${h}`));return}if(p.startsWith("# ")){d(),a.push(s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"32px 0 16px 0"},children:i(p.substring(2))},`h1-${h}`));return}if(p.startsWith("- ")||p.startsWith("* ")){c!=="bullet"&&(d(),c="bullet"),l.push(p.substring(2));return}const m=p.match(/^(\d+)\.\s/);if(m){c!=="number"&&(d(),c="number"),l.push(p.substring(m[0].length));return}d(),a.push(s.jsx("p",{style:{margin:"12px 0",fontSize:"15px",lineHeight:1.7,color:"#374151"},children:i(p)},`p-${h}`))}),d(),a},i=r=>{const o=[];let a=r,l=0;for(;a.length>0;){const c=a.match(/\*\*(.+?)\*\*/),d=a.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),u=a.match(/`([^`]+)`/),h=[{match:c,type:"bold"},{match:d,type:"italic"},{match:u,type:"code"}].filter(m=>m.match);if(h.length===0){o.push(a);break}const p=h.reduce((m,x)=>(m.match?.index??1/0)<(x.match?.index??1/0)?m:x);switch(p.match.index>0&&o.push(a.substring(0,p.match.index)),p.type){case"bold":o.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:p.match[1]},l++));break;case"italic":o.push(s.jsx("em",{style:{fontStyle:"italic"},children:p.match[1]||p.match[2]},l++));break;case"code":o.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:p.match[1]},l++));break}a=a.substring(p.match.index+p.match[0].length)}return o};return s.jsx("div",{children:n(t)})},gN=({briefing:t,template:e,onBack:n,onCreateNew:i,onGenerateAnother:r})=>{const o=Ve(),a=Un(),[l,c]=f.useState(!1),d=f.useRef(null),u=o.primaryAccent,h=o.headerGradient,p=pN[e?.icon||t?.template_icon]||Nt,m=y=>y?new Date(y).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",x=async()=>{try{await navigator.clipboard.writeText(t.content_markdown),c(!0),setTimeout(()=>c(!1),2e3)}catch(y){console.error("[SmartBriefing] Failed to copy:",y)}},g=()=>{const y=`${e?.title||t?.template_title}
${"=".repeat(50)}

Erstellt am: ${m(t.created_at)}

${t.content_markdown}`,v=new Blob([y],{type:"text/plain;charset=utf-8"}),k=URL.createObjectURL(v),S=document.createElement("a");S.href=k,S.download=`briefing-${t.id}.txt`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(k)};return t?s.jsxs("div",{style:{minHeight:"100vh",background:o.pageBg},children:[s.jsx("div",{style:{background:h,padding:a?"20px 16px":"24px 32px",position:"sticky",top:0,zIndex:40},children:s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[n&&s.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:"6px",background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",color:"#fff",fontSize:"13px",marginBottom:"16px"},children:[s.jsx(yt,{size:16}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:a?"flex-start":"center",gap:a?"16px":"24px",flexDirection:a?"column":"row"},children:[s.jsx("div",{style:{width:a?70:90,height:a?70:90,borderRadius:"50%",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(p,{size:a?32:40,color:"#fff"})}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",marginBottom:"8px"},children:[s.jsx("span",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.2)",color:"#fff"},children:"Smart Briefing"}),s.jsxs("span",{style:{fontSize:"12px",fontWeight:500,padding:"4px 10px",borderRadius:"20px",background:"rgba(255,255,255,0.9)",color:u,display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(St,{size:12}),"Fertig!"]})]}),s.jsx("h1",{style:{fontSize:a?"20px":"24px",fontWeight:700,color:"#fff",margin:0,marginBottom:"8px"},children:e?.title||t?.template_title}),s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px",flexWrap:"wrap"},children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",color:"rgba(255,255,255,0.8)"},children:[s.jsx(Fn,{size:14}),m(t.created_at)]})})]}),!a&&s.jsxs("div",{style:{display:"flex",gap:"12px"},children:[s.jsxs("button",{onClick:x,style:{display:"flex",alignItems:"center",gap:"8px",background:l?"rgba(34,197,94,0.3)":"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[l?s.jsx(wn,{size:16}):s.jsx(Wc,{size:16}),l?"Kopiert!":"Kopieren"]}),s.jsxs("button",{onClick:g,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",padding:"10px 20px",cursor:"pointer",color:"#fff",fontSize:"14px",fontWeight:500},children:[s.jsx(gr,{size:16}),"Speichern"]})]})]})]})}),s.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto",padding:a?"16px":"24px 32px"},children:[a&&s.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[s.jsxs("button",{onClick:x,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"12px",borderRadius:"10px",border:`1px solid ${o.borderColor}`,backgroundColor:l?"#dcfce7":"white",color:l?"#16a34a":o.textSecondary,fontSize:"13px",fontWeight:500,cursor:"pointer"},children:[l?s.jsx(wn,{size:16}):s.jsx(Wc,{size:16}),l?"Kopiert!":"Kopieren"]}),s.jsxs("button",{onClick:g,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"12px",borderRadius:"10px",border:`1px solid ${o.borderColor}`,backgroundColor:"white",color:o.textSecondary,fontSize:"13px",fontWeight:500,cursor:"pointer"},children:[s.jsx(gr,{size:16}),"Speichern"]})]}),s.jsx("div",{ref:d,style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden",border:`1px solid ${o.borderColor}`},children:s.jsx("div",{style:{padding:a?"20px":"32px"},children:s.jsx(fN,{content:t.content_markdown,primaryAccent:u})})}),s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",flexWrap:"wrap"},children:[s.jsxs("button",{onClick:r,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${u}`,backgroundColor:"white",color:u,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(zt,{size:18}),"Mit anderen Angaben neu generieren"]}),s.jsxs("button",{onClick:i,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${u}, ${u}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 14px ${u}40`},children:[s.jsx(At,{size:18}),"Neues Briefing erstellen"]})]})]})]}):null},mN={"file-text":Nt,briefcase:Tn,banknote:is,users:mn,user:qt,"message-circle":ts,target:et,award:ni,book:Ro,clipboard:Io,star:nn,lightbulb:Ne,shield:Ii,compass:Ao,rocket:oi},xN=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",yN=({briefing:t,onOpen:e,onDelete:n,primaryAccent:i,isDeleting:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),d=mN[t.template_icon]||Nt,u=h=>{h.stopPropagation(),l?(n(t.id),c(!1)):(c(!0),setTimeout(()=>c(!1),3e3))};return s.jsxs("div",{onClick:()=>e(t),onMouseEnter:()=>a(!0),onMouseLeave:()=>{a(!1),c(!1)},style:{backgroundColor:"white",borderRadius:"16px",padding:"20px",border:`2px solid ${o?i:"#e2e8f0"}`,boxShadow:o?`0 10px 25px -5px rgba(0,0,0,0.1), 0 0 0 1px ${i}20`:"0 1px 3px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease",transform:o?"translateY(-2px)":"translateY(0)",position:"relative"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"10px",background:`linear-gradient(135deg, ${i}15, ${i}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(d,{size:22,style:{color:i}})}),s.jsx("button",{onClick:u,disabled:r,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l?"#fef2f2":o?"#f1f5f9":"transparent",color:l?"#ef4444":"#94a3b8",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",opacity:o||l?1:0},children:r?s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(We,{size:18})})]}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 4px 0",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||"Unbenanntes Briefing"}),s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:t.template_title}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#94a3b8",fontSize:"12px"},children:[s.jsx(Fn,{size:14}),xN(t.created_at)]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:i,fontSize:"13px",fontWeight:500},children:["Offnen",s.jsx(Kt,{size:16})]})]}),l&&s.jsx("div",{style:{position:"absolute",top:"8px",right:"8px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"8px 12px",fontSize:"12px",color:"#dc2626",fontWeight:500,zIndex:10},onClick:h=>h.stopPropagation(),children:"Nochmal klicken zum Loschen"}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},bN=({onOpenBriefing:t,onCreateNew:e,isAuthenticated:n})=>{const{config:i}=Ue(),[r,o]=f.useState([]),[a,l]=f.useState(!0),[c,d]=f.useState(null),[u,h]=f.useState(null),p=i?.buttonGradientStart||"#3A7FA7";f.useEffect(()=>{(async()=>{if(!n){l(!1);return}try{l(!0),d(null);const g=await ue.request("/smartbriefing/briefings",{method:"GET"});if(g.success&&g.data?.briefings){const y=g.data.briefings.filter(v=>v.status==="completed");o(y)}else throw new Error("Unerwartete API-Antwort")}catch(g){console.error("[SmartBriefing] Error fetching briefings:",g),d(g.message||"Fehler beim Laden der Briefings")}finally{l(!1)}})()},[n]);const m=async x=>{try{if(h(x),(await ue.request(`/smartbriefing/briefings/${x}`,{method:"DELETE"})).success)o(y=>y.filter(v=>v.id!==x));else throw new Error("Fehler beim Loschen")}catch(g){console.error("[SmartBriefing] Error deleting briefing:",g),d(g.message||"Fehler beim Loschen des Briefings")}finally{h(null)}};return n?s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Meine Briefings"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[r.length," gespeicherte Briefings"]})]}),s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[s.jsx(At,{size:18}),"Neues Briefing"]})]}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(he,{size:40,style:{color:p,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefings werden geladen..."})]}),c&&!a&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(ke,{size:24,style:{color:"#ef4444",flexShrink:0}}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:"0 0 4px 0",color:"#dc2626",fontSize:"16px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:c})]})]}),!a&&!c&&s.jsx(s.Fragment,{children:r.length===0?s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(Uc,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Noch keine Briefings"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Erstelle dein erstes Briefing, um loszulegen."}),s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[s.jsx(At,{size:18}),"Briefing erstellen"]})]}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:r.map(x=>s.jsx(yN,{briefing:x,onOpen:t,onDelete:m,primaryAccent:p,isDeleting:u===x.id},x.id))})})]}):s.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(Uc,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},vN=[{key:"file-text",icon:Nt,label:"Dokument"},{key:"briefcase",icon:Tn,label:"Koffer"},{key:"banknote",icon:is,label:"Geld"},{key:"users",icon:mn,label:"Team"},{key:"user",icon:qt,label:"Person"},{key:"target",icon:et,label:"Ziel"},{key:"lightbulb",icon:Ne,label:"Idee"},{key:"star",icon:nn,label:"Stern"},{key:"shield",icon:Ii,label:"Schutz"},{key:"compass",icon:Ao,label:"Kompass"},{key:"rocket",icon:oi,label:"Rakete"},{key:"message-circle",icon:ts,label:"Nachricht"},{key:"award",icon:ni,label:"Auszeichnung"},{key:"book",icon:Ro,label:"Buch"},{key:"clipboard",icon:Io,label:"Checkliste"}],Gg=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],Ga=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,SN=()=>({id:Ga(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),kN=()=>({id:Ga(),value:"",label:""}),CN=({variable:t,index:e,total:n,onChange:i,onDelete:r,onMoveUp:o,onMoveDown:a,primaryAccent:l})=>{const[c,d]=f.useState(!0),[u,h]=f.useState(t.label);f.useEffect(()=>{h(t.label)},[t.label]);const p=(k,S)=>{i({...t,[k]:S})},m=()=>{const k=[...t.options||[],kN()];i({...t,options:k})},x=(k,S,C)=>{const b=t.options.map(j=>j.id===k?{...j,[S]:C}:j);i({...t,options:b})},g=k=>{const S=t.options.filter(C=>C.id!==k);i({...t,options:S})},y=k=>k.toLowerCase().replace(/[]/g,S=>({:"ae",:"oe",:"ue",:"ss"})[S]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),v=()=>{if(u!==t.label){const k={label:u};(!t.key||t.key===y(t.label))&&(k.key=y(u)),i({...t,...k})}};return s.jsxs("div",{style:{backgroundColor:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0",marginBottom:"12px",overflow:"hidden"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 16px",backgroundColor:"white",borderBottom:c?"1px solid #e2e8f0":"none",cursor:"pointer"},onClick:()=>d(!c),children:[s.jsx(jj,{size:16,style:{color:"#94a3b8",cursor:"grab"}}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px"},children:t.label||`Variable ${e+1}`}),t.key&&s.jsxs("span",{style:{marginLeft:"8px",color:"#64748b",fontSize:"12px"},children:["$","{","$",t.key,"}"]})]}),s.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:500,backgroundColor:`${l}15`,color:l},children:Gg.find(k=>k.value===t.type)?.label||t.type}),s.jsxs("div",{style:{display:"flex",gap:"2px"},children:[s.jsx("button",{onClick:k=>{k.stopPropagation(),o()},disabled:e===0,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===0?"not-allowed":"pointer",opacity:e===0?.3:1},children:s.jsx(Yn,{size:16,style:{color:"#64748b"}})}),s.jsx("button",{onClick:k=>{k.stopPropagation(),a()},disabled:e===n-1,style:{padding:"4px",border:"none",backgroundColor:"transparent",cursor:e===n-1?"not-allowed":"pointer",opacity:e===n-1?.3:1},children:s.jsx(ct,{size:16,style:{color:"#64748b"}})})]}),s.jsx("button",{onClick:k=>{k.stopPropagation(),r()},style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},title:"Variable lschen",children:s.jsx(We,{size:16})})]}),s.jsx(De,{children:c&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:s.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldbezeichnung *"}),s.jsx("input",{type:"text",value:u,onChange:k=>h(k.target.value),onBlur:v,placeholder:"z.B. Unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Variablenname *"}),s.jsx("input",{type:"text",value:t.key,onChange:k=>p("key",k.target.value),placeholder:"z.B. unternehmen",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"12px",alignItems:"end"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Feldtyp"}),s.jsx("select",{value:t.type,onChange:k=>p("type",k.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px",backgroundColor:"white"},children:Gg.map(k=>s.jsx("option",{value:k.value,children:k.label},k.value))})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 0",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:t.required,onChange:k=>p("required",k.target.checked),style:{width:"16px",height:"16px",accentColor:l}}),s.jsx("span",{style:{fontSize:"14px",color:"#475569"},children:"Pflichtfeld"})]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"4px"},children:"Platzhalter-Text (optional)"}),s.jsx("input",{type:"text",value:t.placeholder,onChange:k=>p("placeholder",k.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"14px"}})]}),t.type==="select"&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"8px"},children:"Auswahloptionen"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(t.options||[]).map((k,S)=>s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx("input",{type:"text",value:k.value,onChange:C=>x(k.id,"value",C.target.value),placeholder:"Wert",style:{flex:1,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px",fontFamily:"monospace"}}),s.jsx("input",{type:"text",value:k.label,onChange:C=>x(k.id,"label",C.target.value),placeholder:"Anzeigename",style:{flex:2,padding:"8px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"13px"}}),s.jsx("button",{onClick:()=>g(k.id),style:{padding:"6px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#ef4444"},children:s.jsx(We,{size:14})})]},k.id)),s.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px dashed #cbd5e1",borderRadius:"6px",backgroundColor:"transparent",color:"#64748b",fontSize:"13px",cursor:"pointer",marginTop:"4px"},children:[s.jsx(At,{size:14}),"Option hinzufgen"]})]})]})]})})})]})},wN=({selectedIcon:t,onSelect:e,primaryAccent:n})=>s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:vN.map(({key:i,icon:r,label:o})=>{const a=t===i;return s.jsx("button",{onClick:()=>e(i),title:o,style:{width:"60px",height:"60px",borderRadius:"12px",border:`2px solid ${a?n:"#e2e8f0"}`,backgroundColor:a?`${n}15`:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s"},children:s.jsx(r,{size:28,style:{color:a?n:"#64748b"}})},i)})}),jN=({isOpen:t,onClose:e,onSave:n,editTemplate:i=null,demoCode:r})=>{const{branding:o,config:a}=Ue(),l=o?.["--primary-accent"]||a?.buttonGradientStart||"#3A7FA7",[c,d]=f.useState(""),[u,h]=f.useState(""),[p,m]=f.useState("file-text"),[x,g]=f.useState(""),[y,v]=f.useState([]),[k,S]=f.useState(!1),[C,b]=f.useState(null),[j,w]=f.useState("basics");f.useEffect(()=>{i?(d(i.title||""),h(i.description||""),m(i.icon||"file-text"),g(i.system_prompt||""),v((i.variables_schema||[]).map(M=>({...M,id:M.id||Ga(),options:(M.options||[]).map(F=>({...F,id:F.id||Ga()}))})))):(d(""),h(""),m("file-text"),g(""),v([])),w("basics"),b(null)},[i,t]);const T=()=>{v([...y,SN()])},I=(M,F)=>{const $=[...y];$[M]=F,v($)},E=M=>{v(y.filter((F,$)=>$!==M))},P=M=>{if(M===0)return;const F=[...y];[F[M-1],F[M]]=[F[M],F[M-1]],v(F)},O=M=>{if(M===y.length-1)return;const F=[...y];[F[M],F[M+1]]=[F[M+1],F[M]],v(F)},B=()=>{if(!c.trim())return b("Bitte gib einen Titel ein."),w("basics"),!1;if(!x.trim())return b("Bitte gib einen System-Prompt ein."),w("prompt"),!1;for(const M of y){if(!M.key.trim()||!M.label.trim())return b("Alle Variablen bentigen einen Namen und eine Bezeichnung."),w("variables"),!1;if(M.type==="select"&&(!M.options||M.options.length===0))return b(`Variable "${M.label}" bentigt mindestens eine Auswahloption.`),w("variables"),!1}return!0},N=async()=>{if(b(null),!!B()){S(!0);try{const M=y.map(D=>({key:D.key,label:D.label,type:D.type,required:D.required,placeholder:D.placeholder,...D.type==="select"?{options:D.options.map(z=>({value:z.value,label:z.label}))}:{}})),F={title:c.trim(),description:u.trim(),icon:p,system_prompt:x,variables_schema:M,...r?{demo_code:r}:{}};let $;if(i?$=await ue.request(`/smartbriefing/templates/${i.id}`,{method:"PUT",body:JSON.stringify(F)}):$=await ue.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(F)}),$.success)n?.($.data.template),e();else throw new Error($.message||"Fehler beim Speichern")}catch(M){console.error("[CreateTemplateDialog] Save error:",M),b(M.message||"Fehler beim Speichern des Templates")}finally{S(!1)}}};return t?s.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"16px"},children:s.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"20px",width:"100%",maxWidth:"700px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden"},onClick:M=>M.stopPropagation(),children:[s.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{children:[s.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:700,color:"#0f172a"},children:i?"Template bearbeiten":"Neues Template erstellen"}),s.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"#64748b"},children:"Erstelle ein persnliches Briefing-Template"})]}),s.jsx("button",{onClick:e,style:{padding:"8px",border:"none",backgroundColor:"#f1f5f9",borderRadius:"8px",cursor:"pointer"},children:s.jsx(Ot,{size:20,style:{color:"#64748b"}})})]}),s.jsx("div",{style:{display:"flex",borderBottom:"1px solid #e2e8f0",padding:"0 24px"},children:[{key:"basics",label:"Grundlagen"},{key:"variables",label:"Eingabefelder"},{key:"prompt",label:"KI-Anweisung"}].map(M=>s.jsx("button",{onClick:()=>w(M.key),style:{padding:"12px 20px",border:"none",backgroundColor:"transparent",fontSize:"14px",fontWeight:600,cursor:"pointer",color:j===M.key?l:"#64748b",borderBottom:`3px solid ${j===M.key?l:"transparent"}`,marginBottom:"-1px",transition:"all 0.2s"},children:M.label},M.key))}),s.jsxs("div",{style:{flex:1,overflow:"auto",padding:"24px"},children:[C&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px 16px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ke,{size:18,style:{color:"#ef4444",flexShrink:0}}),s.jsx("span",{style:{color:"#dc2626",fontSize:"14px"},children:C})]}),j==="basics"&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Titel *"}),s.jsx("input",{type:"text",value:c,onChange:M=>d(M.target.value),placeholder:"z.B. Projektprsentation Vorbereitung",style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"15px"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"Beschreibung"}),s.jsx("textarea",{value:u,onChange:M=>h(M.target.value),placeholder:"Kurze Beschreibung, wofr dieses Template verwendet wird...",rows:3,style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",resize:"vertical"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"8px"},children:"Symbol"}),s.jsx(wN,{selectedIcon:p,onSelect:m,primaryAccent:l})]})]}),j==="variables"&&s.jsxs("div",{children:[s.jsx("div",{style:{marginBottom:"16px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[s.jsx(Ux,{size:16,style:{color:"#64748b"}}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:"Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausfllen soll."})]})}),y.map((M,F)=>s.jsx(CN,{variable:M,index:F,total:y.length,onChange:$=>I(F,$),onDelete:()=>E(F),onMoveUp:()=>P(F),onMoveDown:()=>O(F),primaryAccent:l},M.id)),s.jsxs("button",{onClick:T,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"14px",borderRadius:"10px",border:"2px dashed #cbd5e1",backgroundColor:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:M=>{M.currentTarget.style.borderColor=l,M.currentTarget.style.color=l},onMouseLeave:M=>{M.currentTarget.style.borderColor="#cbd5e1",M.currentTarget.style.color="#64748b"},children:[s.jsx(At,{size:18}),"Eingabefeld hinzufgen"]}),y.length===0&&s.jsx("div",{style:{textAlign:"center",padding:"32px",color:"#94a3b8",fontSize:"14px"},children:"Noch keine Eingabefelder definiert."})]}),j==="prompt"&&s.jsxs("div",{children:[s.jsx("div",{style:{backgroundColor:"#f0f9ff",borderRadius:"10px",padding:"16px",marginBottom:"16px",border:"1px solid #bae6fd"},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[s.jsx(Ne,{size:18,style:{color:"#0284c7",flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 6px 0",fontSize:"14px",fontWeight:600,color:"#0369a1"},children:"Tipps fr effektive Prompts"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"16px",fontSize:"13px",color:"#0369a1",lineHeight:1.6},children:[s.jsxs("li",{children:["Verwende ",s.jsxs("code",{style:{backgroundColor:"#e0f2fe",padding:"1px 4px",borderRadius:"3px"},children:["$","{variablenname}"]})," um auf Eingabefelder zu verweisen"]}),s.jsx("li",{children:'Beschreibe die Rolle der KI (z.B. "Du bist ein erfahrener Karriere-Coach...")'}),s.jsx("li",{children:"Definiere die Struktur des gewnschten Outputs"}),s.jsx("li",{children:"Gib Beispiele fr den Ton und Stil"})]})]})]})}),y.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsx("span",{style:{fontSize:"12px",color:"#64748b"},children:"Verfgbare Variablen: "}),y.map(M=>s.jsxs("code",{style:{display:"inline-block",padding:"2px 6px",marginRight:"6px",marginBottom:"4px",backgroundColor:"#f1f5f9",borderRadius:"4px",fontSize:"12px",fontFamily:"monospace",color:"#475569",cursor:"pointer"},onClick:()=>{const F=`\${${M.key}}`;g($=>$+F)},title:"Klicken zum Einfgen",children:["$","{"+M.key+"}"]},M.id))]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"6px"},children:"System-Prompt *"}),s.jsx("textarea",{value:x,onChange:M=>g(M.target.value),placeholder:`Du bist ein erfahrener Experte fr...

Erstelle ein strukturiertes Briefing fr den Nutzer basierend auf folgenden Informationen:
- Position: \${position}
- Unternehmen: \${unternehmen}

Das Briefing soll folgende Abschnitte enthalten:
1. ...
2. ...

Formatiere jeden Abschnitt mit einem Titel und 5-8 konkreten Bullet Points.`,rows:15,style:{width:"100%",padding:"14px",borderRadius:"10px",border:"1px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",resize:"vertical",lineHeight:1.5}})]})]})]}),s.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},children:[s.jsx("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"10px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#475569",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Abbrechen"}),s.jsx("button",{onClick:N,disabled:k,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"10px",border:"none",background:`linear-gradient(135deg, ${l} 0%, ${l}dd 100%)`,color:"white",fontSize:"14px",fontWeight:600,cursor:k?"not-allowed":"pointer",opacity:k?.7:1},children:k?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:18,style:{animation:"spin 1s linear infinite"}}),"Speichern..."]}):s.jsxs(s.Fragment,{children:[s.jsx(gu,{size:18}),i?"Speichern":"Template erstellen"]})})]}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}):null},Gt={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},TN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToSimulator:i,onNavigateToHistory:r,demoCode:o})=>{const[a,l]=f.useState(Gt.DASHBOARD),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(null),[x,g]=f.useState(null),[y,v]=f.useState(!1),[k,S]=f.useState(null),[C,b]=f.useState(0);f.useEffect(()=>{x&&t&&(d(x),l(Gt.FORM),g(null))},[x,t]),f.useEffect(()=>{window.scrollTo(0,0)},[a]);const j=f.useCallback(z=>{d(z),l(Gt.FORM)},[]),w=f.useCallback(()=>{d(null),h(null),m(null),l(Gt.DASHBOARD)},[]),T=f.useCallback(z=>{h(z),m(z),l(Gt.WORKBOOK)},[]),I=f.useCallback(()=>{h(null),m(null),d(null),l(Gt.DASHBOARD)},[]),E=f.useCallback(()=>{h(null),m(null),l(Gt.FORM)},[]);f.useCallback(()=>{l(Gt.LIST)},[]);const P=f.useCallback(z=>{m(z),l(Gt.WORKBOOK)},[]);f.useCallback(()=>{m(null),l(Gt.LIST)},[]);const O=f.useCallback(z=>{i&&i(z)},[i]),B=f.useCallback(async z=>{try{if((await ue.request(`/smartbriefing/briefings/${z.id}`,{method:"DELETE"})).success)m(null),l(Gt.DASHBOARD);else throw new Error("Fehler beim Lschen")}catch(L){throw console.error("[SmartBriefing] Error deleting briefing:",L),L}},[]),N=f.useCallback(()=>{S(null),v(!0)},[]),M=f.useCallback(z=>{S(z),v(!0)},[]),F=f.useCallback(()=>{v(!1),S(null)},[]),$=f.useCallback(z=>{b(L=>L+1)},[]),D=()=>{switch(a){case Gt.FORM:return s.jsx(hN,{template:c,onBack:w,onBriefingGenerated:T,isAuthenticated:t});case Gt.RESULT:return s.jsx(gN,{briefing:u,template:c,onBack:w,onCreateNew:I,onGenerateAnother:E});case Gt.LIST:return s.jsx(bN,{onOpenBriefing:P,onCreateNew:I,isAuthenticated:t});case Gt.WORKBOOK:return s.jsx(cv,{briefing:p,onBack:w,onDelete:B,onStartSimulation:i?O:null});case Gt.DASHBOARD:default:return s.jsx(cN,{onSelectTemplate:j,onShowList:r,onCreateTemplate:N,onEditTemplate:M,isAuthenticated:t,requireAuth:e,setPendingAction:n,demoCode:o},C)}};return s.jsxs("div",{style:{minHeight:"100%"},children:[D(),s.jsx(jN,{isOpen:y,onClose:F,onSave:$,editTemplate:k,demoCode:o})]})},EN=t=>{const e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n.toString().padStart(2,"0")}`},RN=[/^untertitel/i,/amara\.org/i,/vielen dank f[u]r'?s? zusch/i,/bis zum n[a]chsten mal/i,/thank you for watching/i,/subscribe/i,/^\.+$/,/^[\s]+$/,/^\s*$/,/^(hm?|uhm?|hmm?|ja|nein|ok|okay)\.?\s*$/i],IN=t=>{if(!t||typeof t!="string")return!0;const e=t.trim();if(e.length<10)return!0;for(const n of RN)if(n.test(e))return console.log("[AudioRecorder] Filtered hallucination:",e),!0;return!1},AN=({isRecording:t,analyserNode:e,b:n})=>{const i=f.useRef(null),r=f.useRef(null);return f.useEffect(()=>{if(!t||!e||!i.current){r.current&&cancelAnimationFrame(r.current);return}const o=i.current,a=o.getContext("2d"),l=e.frequencyBinCount,c=new Uint8Array(l),d=()=>{if(!t)return;e.getByteFrequencyData(c),a.clearRect(0,0,o.width,o.height);const u=50,h=2,p=(o.width-u*h)/(u-1),m=o.height/2;for(let x=0;x<u;x++){const g=Math.floor(x/u*l),y=c[g]||0,v=Math.max(2,y/255*(o.height*.8));a.fillStyle=n.textMain,a.fillRect(x*(h+p),m-v/2,h,v)}r.current=requestAnimationFrame(d)};return d(),()=>{r.current&&cancelAnimationFrame(r.current)}},[t,e,n]),s.jsx("canvas",{ref:i,width:200,height:32,style:{flex:1,maxWidth:"300px",minWidth:"100px"}})},_N=({onTranscriptReady:t,disabled:e=!1})=>{const n=Ve(),[i,r]=f.useState(!1),[o,a]=f.useState(!1),[l,c]=f.useState(0),[d,u]=f.useState(null),h=f.useRef(null),p=f.useRef([]),m=f.useRef(null),x=f.useRef(null),g=f.useRef(null),y=f.useRef(null),v=f.useRef(!1),k=f.useRef(0),S=f.useRef(null),C=f.useCallback(()=>{x.current&&(clearInterval(x.current),x.current=null),S.current&&(clearInterval(S.current),S.current=null),m.current&&(m.current.getTracks().forEach(T=>T.stop()),m.current=null),g.current&&(g.current.close(),g.current=null),p.current=[],v.current=!1,k.current=0},[]);f.useEffect(()=>C,[C]);const b=async()=>{try{u(null);const T=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});m.current=T,g.current=new(window.AudioContext||window.webkitAudioContext);const I=g.current.createMediaStreamSource(T);y.current=g.current.createAnalyser(),y.current.fftSize=256,I.connect(y.current);const E=LT()||"audio/webm",P=new MediaRecorder(T,{mimeType:E});h.current=P,p.current=[],P.ondataavailable=B=>{B.data.size>0&&p.current.push(B.data)},P.start(100),r(!0),c(0),v.current=!1,k.current=0,x.current=setInterval(()=>{c(B=>B+1)},1e3);const O=new Uint8Array(y.current.frequencyBinCount);S.current=setInterval(()=>{if(y.current){y.current.getByteFrequencyData(O);const B=O.reduce((N,M)=>N+M,0)/O.length;B>k.current&&(k.current=B),B>20&&(v.current=!0)}},100)}catch(T){console.error("[AudioRecorder] Error starting recording:",T),u("Mikrofon-Zugriff verweigert")}},j=f.useCallback(()=>{h.current&&i&&h.current.stop(),C(),r(!1),c(0),u(null)},[i,C]),w=f.useCallback(async()=>{if(!h.current||!i)return;const T=v.current,I=k.current,E=l;if(h.current.stop(),r(!1),x.current&&(clearInterval(x.current),x.current=null),S.current&&(clearInterval(S.current),S.current=null),m.current&&m.current.getTracks().forEach(P=>P.stop()),await new Promise(P=>setTimeout(P,100)),p.current.length===0){u("Keine Aufnahme");return}if(E<1){u("Aufnahme zu kurz"),C(),c(0);return}if(!T||I<15){console.log("[AudioRecorder] No speech detected. Peak level:",I),u("Keine Sprache erkannt"),C(),c(0);return}a(!0),u(null);try{const P=h.current?.mimeType||"audio/webm",O=new Blob(p.current,{type:P});if(O.size<1e3)throw new Error("Aufnahme zu kurz");const B=await n0(O),N=await ue.transcribeAudio(B,P);if(N.transcript){if(IN(N.transcript))throw new Error("Keine verstndliche Sprache erkannt");t(N.transcript),C(),c(0)}else throw new Error("Keine Transkription erhalten")}catch(P){console.error("[AudioRecorder] Transcription error:",P),u(P.message||"Transkription fehlgeschlagen")}finally{a(!1)}},[i,l,t,C]);return o?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:n.space[2],padding:`${n.space[3]} ${n.space[4]}`,backgroundColor:n.cardBgHover,borderRadius:n.radius.full,border:`1px solid ${n.borderColor}`},children:[s.jsx(he,{size:n.iconSize["2xl"],color:n.textSecondary,style:{animation:"spin 1s linear infinite"}}),s.jsx("span",{style:{fontSize:n.fontSize.base,color:n.textSecondary},children:"Wird transkribiert..."}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):i?s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[2]} ${n.space[3]}`,backgroundColor:n.cardBgHover,borderRadius:n.radius.full,border:`1px solid ${n.borderColor}`},children:[s.jsx("button",{onClick:j,style:{width:"40px",height:"40px",borderRadius:n.radius.full,border:"none",backgroundColor:n.borderColorLight,color:n.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,flexShrink:0},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=n.borderColor},onMouseLeave:T=>{T.currentTarget.style.backgroundColor=n.borderColorLight},children:s.jsx(Ot,{size:n.iconSize.xl,strokeWidth:2.5})}),s.jsx(AN,{isRecording:i,analyserNode:y.current,b:n}),s.jsx("span",{style:{fontFamily:"system-ui, -apple-system, sans-serif",fontSize:n.fontSize.lg,fontWeight:n.fontWeight.medium,color:n.textMain,minWidth:"40px",textAlign:"right",flexShrink:0},children:EN(l)}),s.jsx("button",{onClick:w,style:{width:"40px",height:"40px",borderRadius:n.radius.full,border:"none",backgroundColor:n.primaryAccent,color:n.white,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,flexShrink:0},onMouseEnter:T=>{T.currentTarget.style.opacity="0.9"},onMouseLeave:T=>{T.currentTarget.style.opacity="1"},children:s.jsx(wn,{size:n.iconSize.xl,strokeWidth:2.5})})]}):s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[d&&s.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.error},children:d}),s.jsx("button",{onClick:b,disabled:e,title:"Spracheingabe",style:{width:"44px",height:"44px",borderRadius:n.radius.full,border:"none",backgroundColor:n.textMain,color:n.white,cursor:e?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:`all ${n.transition.fast}`,opacity:e?.5:1},onMouseEnter:T=>{e||(T.currentTarget.style.opacity="0.9")},onMouseLeave:T=>{e||(T.currentTarget.style.opacity="1")},children:s.jsx(Fe,{size:n.iconSize["2xl"]})})]})},zr=()=>`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,fv=[{id:"strategist",name:"Der Stratege",icon:"",color:"#6366f1",bgColor:"#eef2ff",description:"Karriere, Geld, Macht"},{id:"security",name:"Der Sicherheits-Beauftragte",icon:"",color:"#0891b2",bgColor:"#ecfeff",description:"Risiko, Bestndigkeit"},{id:"feelgood",name:"Der Feel-Good Manager",icon:"",color:"#10b981",bgColor:"#ecfdf5",description:"Work-Life-Balance, Kultur"},{id:"growth",name:"Der Grnder",icon:"",color:"#f59e0b",bgColor:"#fffbeb",description:"Wachstum, Innovation"},{id:"future",name:"Dein Zukunfts-Ich",icon:"",color:"#8b5cf6",bgColor:"#f5f3ff",description:"Langzeit, Reue-Vermeidung"}],MN=({value:t,onChange:e,color:n,b:i})=>{const r=n==="green",o=r?i.success:i.error,a=r?i.successDark:i.errorDark;return r?i.successLight:i.errorLight,s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2],minWidth:"90px",flexShrink:0},children:[s.jsx("input",{type:"range",min:"1",max:"10",value:t,onChange:l=>e(parseInt(l.target.value)),style:{width:"60px",height:"6px",borderRadius:i.radius.sm,background:`linear-gradient(90deg, ${o} 0%, ${o} ${(t-1)*11.1}%, ${i.borderColor} ${(t-1)*11.1}%, ${i.borderColor} 100%)`,appearance:"none",cursor:"pointer",flexShrink:0}}),s.jsx("span",{style:{minWidth:"20px",textAlign:"center",fontWeight:i.fontWeight.semibold,fontSize:i.fontSize.sm,color:a,flexShrink:0},children:t})]})},Hg=({item:t,onUpdate:e,onDelete:n,onAddNew:i,color:r,autoFocus:o,b:a})=>{const l=r==="green",c=l?a.successLight:a.errorLight,d=l?"#bbf7d0":"#fecaca",u=l?"#86efac":"#fca5a5",h=l?a.successDark:a.errorDark;return s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:l?-20:20},transition:{duration:.2},className:"decision-item",style:{display:"flex",alignItems:"flex-start",gap:a.space[2.5],padding:a.space[3],backgroundColor:c,borderRadius:a.radius.lg,border:`1px solid ${d}`},children:[s.jsx("div",{style:{flexShrink:0,paddingTop:a.space[2]},children:l?s.jsx(jn,{size:a.iconSize.lg,color:h}):s.jsx(Ei,{size:a.iconSize.lg,color:h})}),s.jsx(vi,{value:t.text,onChange:p=>e(t.id,{text:p.target.value}),autoFocus:o,placeholder:l?"Pro-Argument...":"Contra-Argument...",rows:2,style:{flex:1,minWidth:"0",backgroundColor:a.white,border:`1px solid ${u}`,borderRadius:a.radius.md,padding:`${a.space[2]} ${a.space[3]}`,fontSize:a.fontSize.base,resize:"vertical",minHeight:"44px"}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a.space[2],flexShrink:0,paddingTop:a.space[1.5]},children:[s.jsx(MN,{value:t.weight,onChange:p=>e(t.id,{weight:p}),color:r,b:a}),s.jsx("button",{onClick:()=>n(t.id),style:{padding:a.space[2],backgroundColor:a.transparent,border:"none",borderRadius:a.radius.sm,cursor:"pointer",color:a.textMuted,transition:a.transition.normal,flexShrink:0},onMouseEnter:p=>{p.currentTarget.style.backgroundColor=a.errorLight,p.currentTarget.style.color=a.errorDark},onMouseLeave:p=>{p.currentTarget.style.backgroundColor=a.transparent,p.currentTarget.style.color=a.textMuted},children:s.jsx(We,{size:a.iconSize.md})})]})]})},PN=({proScore:t,contraScore:e,b:n})=>{const i=t+e,r=i>0?Math.round(t/i*100):50,o=100-r;return s.jsxs("div",{style:{marginTop:n.space[6]},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold},children:[s.jsxs("span",{style:{color:n.successDark},children:["Pro: ",t," Punkte (",r,"%)"]}),s.jsxs("span",{style:{color:n.errorDark},children:["Contra: ",e," Punkte (",o,"%)"]})]}),s.jsxs("div",{style:{height:n.space[6],borderRadius:n.radius.lg,overflow:"hidden",display:"flex",backgroundColor:n.borderColorLight,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:[s.jsx(V.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.success} 0%, ${n.successDark} 100%)`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:n.white,fontWeight:n.fontWeight.semibold,fontSize:n.fontSize.xs,minWidth:r>10?"auto":"0"},children:r>15&&`${r}%`}),s.jsx(V.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.5,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.error} 0%, ${n.errorDark} 100%)`,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:n.white,fontWeight:n.fontWeight.semibold,fontSize:n.fontSize.xs,minWidth:o>10?"auto":"0"},children:o>15&&`${o}%`})]})]})},qg=({suggestion:t,onAdd:e,isAdded:n,b:i})=>{const r=t.type==="pro",o=r?i.successLight:i.errorLight,a=r?"#bbf7d0":"#fecaca",l=r?"#dcfce7":"#fee2e2",c=r?i.successDark:i.errorDark,d=r?i.success:i.error;return s.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},style:{display:"flex",alignItems:"center",gap:i.space[3],padding:`${i.space[3]} ${i.space[4]}`,backgroundColor:o,borderRadius:i.radius.md,border:`1px solid ${a}`},children:[s.jsx("div",{style:{width:i.space[6],height:i.space[6],borderRadius:i.radius.sm,backgroundColor:l,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:r?s.jsx(jn,{size:i.iconSize.sm,color:c}):s.jsx(Ei,{size:i.iconSize.sm,color:c})}),s.jsx("span",{style:{flex:1,fontSize:i.fontSize.base,color:i.textSecondary,lineHeight:1.4},children:t.text}),s.jsx("button",{onClick:()=>e(t),disabled:n,style:{width:i.space[12],height:i.space[12],borderRadius:i.radius.lg,border:"none",backgroundColor:n?i.borderColor:d,color:n?i.textMuted:i.white,cursor:n?"default":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:i.transition.normal,flexShrink:0},children:n?"":s.jsx(At,{size:i.iconSize["3xl"],color:"white",strokeWidth:2.5})})]})},NN=({isOpen:t,onClose:e,activePersona:n,isLoading:i,suggestions:r,onAddSuggestion:o,addedSuggestions:a,b:l})=>{if(!t)return null;const c=fv.find(d=>d.id===n);return s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{position:"relative",marginTop:l.space[4],padding:l.space[5],backgroundColor:l.cardBgColor,borderRadius:l.radius.xl,border:`2px solid ${c?.color||"#6366f1"}`,boxShadow:l.shadow.lg},children:[s.jsx("button",{onClick:e,style:{position:"absolute",top:l.space[3],right:l.space[3],width:l.space[10],height:l.space[10],borderRadius:l.radius.md,border:"none",backgroundColor:l.borderColorLight,color:l.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ot,{size:l.iconSize["2xl"],strokeWidth:2.5})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[3],marginBottom:l.space[4],paddingRight:l.space[8]},children:[s.jsx("span",{style:{fontSize:l.fontSize["5xl"]},children:c?.icon}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontSize:l.fontSize.lg,fontWeight:l.fontWeight.semibold,color:l.textMain,margin:0},children:c?.name}),s.jsx("p",{style:{fontSize:l.fontSize.sm,color:l.textSecondary,margin:0},children:c?.description})]})]}),i?s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:l.space[3],padding:l.space[6]},children:[s.jsx(he,{size:l.iconSize["3xl"],color:c?.color,style:{animation:"spin 1s linear infinite"}}),s.jsxs("span",{style:{color:l.textSecondary,fontSize:l.fontSize.base},children:[c?.name," denkt nach..."]})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:l.space[2.5]},children:[s.jsx("div",{style:{marginBottom:l.space[2]},children:s.jsx("span",{style:{fontSize:l.fontSize.xs,fontWeight:l.fontWeight.semibold,color:l.successDark,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Pro-Argumente"})}),r.filter(d=>d.type==="pro").map((d,u)=>s.jsx(qg,{suggestion:d,onAdd:o,isAdded:a.has(`${d.type}-${d.text}`),b:l},`pro-${u}`)),s.jsx("div",{style:{marginTop:l.space[3],marginBottom:l.space[2]},children:s.jsx("span",{style:{fontSize:l.fontSize.xs,fontWeight:l.fontWeight.semibold,color:l.errorDark,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Contra-Argumente"})}),r.filter(d=>d.type==="con").map((d,u)=>s.jsx(qg,{suggestion:d,onAdd:o,isAdded:a.has(`${d.type}-${d.text}`),b:l},`con-${u}`))]})]})},DN=({topic:t,onSelectPersona:e,activePersona:n,isLoading:i,suggestions:r,onCloseBrainstorm:o,onAddSuggestion:a,addedSuggestions:l,b:c})=>{const[d,u]=f.useState(!1),h=t.trim().length>0;return s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:c.space[4]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",gap:c.space[2]},onClick:()=>u(!d),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c.space[3],minWidth:0},children:[s.jsx("div",{style:{width:c.space[10],height:c.space[10],borderRadius:c.radius.md,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(mn,{size:c.iconSize.lg,color:"white"})}),s.jsxs("div",{style:{minWidth:0},children:[s.jsx("h3",{style:{fontSize:c.fontSize.lg,fontWeight:c.fontWeight.semibold,color:c.textMain,margin:0},children:"Brainstorming"}),s.jsx("p",{style:{fontSize:c.fontSize.base,color:c.textSecondary,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Frag dein inneres Team"})]})]}),d?s.jsx(Yn,{size:c.iconSize.xl,color:c.textSecondary,style:{flexShrink:0}}):s.jsx(ct,{size:c.iconSize.xl,color:c.textSecondary,style:{flexShrink:0}})]}),s.jsx(De,{children:d&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsxs("div",{style:{marginTop:c.space[4]},children:[s.jsx("div",{style:{display:"flex",gap:c.space[2],overflowX:"auto",paddingBottom:c.space[2],marginLeft:`-${c.space[1]}`,marginRight:`-${c.space[1]}`,paddingLeft:c.space[1],paddingRight:c.space[1],WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:fv.map(p=>s.jsxs("button",{onClick:m=>{m.stopPropagation(),h&&e(p.id)},disabled:!h||i&&n===p.id,style:{display:"flex",alignItems:"center",gap:c.space[1.5],padding:`${c.space[2]} ${c.space[3]}`,borderRadius:c.radius.md,border:n===p.id?`2px solid ${p.color}`:`2px solid ${c.borderColor}`,backgroundColor:n===p.id?p.bgColor:c.cardBgColor,cursor:h?"pointer":"not-allowed",opacity:h?1:.5,transition:c.transition.normal,whiteSpace:"nowrap",flexShrink:0},children:[i&&n===p.id?s.jsx(he,{size:c.iconSize.sm,color:p.color,style:{animation:"spin 1s linear infinite"}}):s.jsx("span",{style:{fontSize:c.fontSize.lg},children:p.icon}),s.jsx("span",{style:{fontSize:c.fontSize.sm,fontWeight:c.fontWeight.medium,color:n===p.id?p.color:c.textSecondary},children:p.name.replace("Der ","").replace("Dein ","")})]},p.id))}),!h&&s.jsx("p",{style:{marginTop:c.space[3],fontSize:c.fontSize.sm,color:c.textMuted,fontStyle:"italic"},children:"Gib zuerst deine Entscheidungsfrage ein, um Vorschlge zu erhalten."}),s.jsx(De,{children:n&&s.jsx(NN,{isOpen:!!n,onClose:o,activePersona:n,isLoading:i,suggestions:r,onAddSuggestion:a,addedSuggestions:l,b:c})})]})})})]})},zN=({initialData:t,onAnalysisComplete:e,onCancel:n,isAuthenticated:i,requireAuth:r})=>{const o=Ve(),[a,l]=f.useState(!1),[c,d]=f.useState(t?.topic||""),[u,h]=f.useState(t?.context||""),[p,m]=f.useState(t?.pros||[{id:zr(),text:"",weight:5}]),[x,g]=f.useState(t?.cons||[{id:zr(),text:"",weight:5}]),[y,v]=f.useState(!1),[k,S]=f.useState(null),[C,b]=f.useState(null),[j,w]=f.useState({activePersona:null,isLoading:!1,suggestions:[]}),[T,I]=f.useState(new Set),E=f.useMemo(()=>p.reduce((A,W)=>A+(W.text.trim()?W.weight:0),0),[p]),P=f.useMemo(()=>x.reduce((A,W)=>A+(W.text.trim()?W.weight:0),0),[x]),O=p.some(A=>A.text.trim()),B=x.some(A=>A.text.trim()),N=c.trim()&&(O||B),M=f.useCallback(()=>{const A=zr();m(W=>[...W,{id:A,text:"",weight:5}]),b(A)},[]),F=f.useCallback(()=>{const A=zr();g(W=>[...W,{id:A,text:"",weight:5}]),b(A)},[]),$=f.useCallback((A,W)=>{m(H=>H.map(oe=>oe.id===A?{...oe,...W}:oe))},[]),D=f.useCallback((A,W)=>{g(H=>H.map(oe=>oe.id===A?{...oe,...W}:oe))},[]),z=f.useCallback(A=>{m(W=>W.filter(H=>H.id!==A))},[]),L=f.useCallback(A=>{g(W=>W.filter(H=>H.id!==A))},[]),ee=f.useCallback(async A=>{w(W=>({...W,activePersona:A,isLoading:!0,suggestions:[]}));try{const W=window.bewerbungstrainerConfig?.geminiApiKey;if(!W)throw new Error("API-Key nicht konfiguriert");const H=u.trim()||null,oe=await GT(c,A,W,H);w(Se=>({...Se,isLoading:!1,suggestions:oe.suggestions||[]}))}catch(W){console.error("[DecisionBoard] Brainstorm error:",W),w(H=>({...H,isLoading:!1,suggestions:[]})),S(W.message||"Fehler beim Brainstorming")}},[c,u]),se=f.useCallback(()=>{w({activePersona:null,isLoading:!1,suggestions:[]})},[]),G=f.useCallback(A=>{const W=`${A.type}-${A.text}`;I(oe=>new Set([...oe,W]));const H={id:zr(),text:A.text,weight:5};A.type==="pro"?m(oe=>[...oe,H]):g(oe=>[...oe,H])},[]),q=f.useCallback(A=>{h(W=>W.trim()?W.trim()+`

`+A:A)},[]),ie=f.useCallback(async()=>{if(N){v(!0),S(null);try{const A=window.bewerbungstrainerConfig?.geminiApiKey;if(!A)throw new Error("API-Key nicht konfiguriert");const W=p.filter($e=>$e.text.trim()),H=x.filter($e=>$e.text.trim()),oe={topic:c,context:u.trim()||null,pros:W,cons:H,proScore:E,contraScore:P},Se=await VT(oe,A);e(oe,Se)}catch(A){console.error("[DecisionBoard] Analysis error:",A),S(A.message||"Fehler bei der Analyse")}finally{v(!1)}}},[c,u,p,x,E,P,N,e]);return s.jsxs("div",{style:{padding:o.space[4],maxWidth:"1200px",margin:"0 auto"},children:[n&&s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:o.space[4]},children:s.jsxs("button",{onClick:()=>l(!0),style:{display:"flex",alignItems:"center",gap:o.space[2],padding:`${o.space[2]} ${o.space[4]}`,borderRadius:o.radius.md,border:`1px solid ${o.borderColor}`,backgroundColor:o.cardBgColor,color:o.textSecondary,cursor:"pointer",fontSize:o.fontSize.base,fontWeight:o.fontWeight.medium,transition:o.transition.normal},onMouseEnter:A=>{A.currentTarget.style.backgroundColor=o.errorLight,A.currentTarget.style.borderColor=o.error,A.currentTarget.style.color=o.errorDark},onMouseLeave:A=>{A.currentTarget.style.backgroundColor=o.cardBgColor,A.currentTarget.style.borderColor=o.borderColor,A.currentTarget.style.color=o.textSecondary},children:[s.jsx(Ot,{size:o.iconSize.md}),"Abbrechen"]})}),s.jsxs("div",{style:{marginBottom:o.space[6],textAlign:"center"},children:[s.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:o.space[15],height:o.space[15],borderRadius:o.radius.lg,background:o.headerGradient,marginBottom:o.space[3],boxShadow:o.coloredShadow(o.primaryAccent,"lg")},children:s.jsx(Ln,{size:o.iconSize["2xl"],color:o.white})}),s.jsx("h1",{style:{fontSize:o.fontSize["4xl"],fontWeight:o.fontWeight.bold,color:o.textMain,marginBottom:o.space[1.5]},children:"Der Entscheidungs-Kompass"}),s.jsx("p",{style:{fontSize:o.fontSize.base,color:o.textSecondary,maxWidth:"600px",margin:"0 auto",padding:`0 ${o.space[2]}`},children:"Analysiere deine Entscheidung objektiv. Gewichte Pro und Contra, und erhalte KI-gesttzte Impulse fr blinde Flecken."})]}),s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:o.space[4]},children:[s.jsx(qn,{children:s.jsx(Rs,{icon:Ne,size:"md",children:"Deine Entscheidungsfrage"})}),s.jsxs(Qe,{children:[s.jsx(en,{value:c,onChange:A=>d(A.target.value),placeholder:"z.B. Soll ich das Jobangebot annehmen?",style:{fontSize:o.fontSize.lg,padding:o.space[4],borderRadius:o.radius.lg,marginBottom:o.space[4]}}),s.jsxs("div",{style:{marginTop:o.space[2]},children:[s.jsx("label",{style:{display:"block",fontSize:o.fontSize.base,fontWeight:o.fontWeight.medium,color:o.textSecondary,marginBottom:o.space[2]},children:"Beschreibe die Situation (optional)"}),s.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:o.space[3]},children:[s.jsx(vi,{value:u,onChange:A=>h(A.target.value),placeholder:"Hintergrund, Rahmenbedingungen, Gefhle, was dich beschftigt...",rows:3,style:{flex:1,fontSize:o.fontSize.md,padding:`${o.space[3]} ${o.space[4]}`,borderRadius:o.radius.lg,resize:"vertical",minHeight:"80px"}}),s.jsx("div",{style:{flexShrink:0,paddingBottom:o.space[1]},children:s.jsx(_N,{onTranscriptReady:q})})]})]})]})]}),s.jsx(DN,{topic:c,onSelectPersona:ee,activePersona:j.activePersona,isLoading:j.isLoading,suggestions:j.suggestions,onCloseBrainstorm:se,onAddSuggestion:G,addedSuggestions:T,b:o}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 380px), 1fr))",gap:o.space[4],marginBottom:o.space[6]},children:[s.jsxs("div",{className:"decision-card-pro",style:{backgroundColor:o.cardBgColor,borderRadius:o.radius.lg,padding:o.space[6],boxShadow:o.shadow.md},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3],marginBottom:o.space[4]},children:[s.jsx("div",{style:{width:o.space[10],height:o.space[10],borderRadius:o.radius.md,backgroundColor:o.successLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(jn,{size:o.iconSize.lg,color:o.successDark})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:o.fontSize.xl,fontWeight:o.fontWeight.semibold,color:o.successDark,margin:0},children:"PRO"}),s.jsx("p",{style:{fontSize:o.fontSize.base,color:o.textSecondary,margin:0},children:"Was spricht dafr?"})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:o.space[3]},children:[s.jsx(De,{mode:"popLayout",children:p.map(A=>s.jsx(Hg,{item:A,onUpdate:$,onDelete:z,onAddNew:M,color:"green",autoFocus:C===A.id,b:o},A.id))}),s.jsxs(ce,{variant:"outline",onClick:M,style:{borderColor:o.success,color:o.successDark,borderStyle:"dashed"},children:[s.jsx(At,{size:o.iconSize.md,style:{marginRight:o.space[2]}}),"Argument hinzufgen"]})]})]}),s.jsxs("div",{className:"decision-card-contra",style:{backgroundColor:o.cardBgColor,borderRadius:o.radius.lg,padding:o.space[6],boxShadow:o.shadow.md},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3],marginBottom:o.space[4]},children:[s.jsx("div",{style:{width:o.space[10],height:o.space[10],borderRadius:o.radius.md,backgroundColor:o.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ei,{size:o.iconSize.lg,color:o.errorDark})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:o.fontSize.xl,fontWeight:o.fontWeight.semibold,color:o.errorDark,margin:0},children:"CONTRA"}),s.jsx("p",{style:{fontSize:o.fontSize.base,color:o.textSecondary,margin:0},children:"Was spricht dagegen?"})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:o.space[3]},children:[s.jsx(De,{mode:"popLayout",children:x.map(A=>s.jsx(Hg,{item:A,onUpdate:D,onDelete:L,onAddNew:F,color:"red",autoFocus:C===A.id,b:o},A.id))}),s.jsxs(ce,{variant:"outline",onClick:F,style:{borderColor:o.error,color:o.errorDark,borderStyle:"dashed"},children:[s.jsx(At,{size:o.iconSize.md,style:{marginRight:o.space[2]}}),"Argument hinzufgen"]})]})]})]}),(O||B)&&s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:o.space[6]},children:[s.jsx(qn,{children:s.jsx(Rs,{icon:Ln,size:"md",children:"Rationaler Score"})}),s.jsx(Qe,{children:s.jsx(PN,{proScore:E,contraScore:P,b:o})})]}),k&&s.jsxs(V.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},style:{display:"flex",alignItems:"center",gap:o.space[3],padding:o.space[4],backgroundColor:o.errorLight,border:`1px solid ${o.error}33`,borderRadius:o.radius.lg,marginBottom:o.space[6],color:o.errorDark},children:[s.jsx(ke,{size:o.iconSize.lg}),s.jsx("span",{children:k})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center"},children:s.jsx(ce,{onClick:ie,disabled:!N||y,variant:"solid",size:"lg",style:{padding:`${o.space[4]} ${o.space[8]}`,fontSize:o.fontSize.xl,background:N?o.headerGradient:void 0,boxShadow:N?o.coloredShadow(o.primaryAccent,"lg"):void 0},children:y?s.jsxs(s.Fragment,{children:[s.jsx(he,{size:o.iconSize.xl,style:{marginRight:o.space[2.5],animation:"spin 1s linear infinite"}}),"Analyse luft..."]}):s.jsxs(s.Fragment,{children:[s.jsx(St,{size:o.iconSize.xl,style:{marginRight:o.space[2.5]}}),"Entscheidung analysieren"]})})}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }

          input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }

          input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }
        `}),s.jsx(De,{children:a&&s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:o.zIndex.modal,padding:o.space[4]},onClick:()=>l(!1),children:s.jsxs(V.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:A=>A.stopPropagation(),style:{backgroundColor:o.cardBgColor,borderRadius:o.radius.xl,padding:o.space[6],maxWidth:"400px",width:"100%",boxShadow:o.shadow.xl},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.space[3],marginBottom:o.space[4]},children:[s.jsx("div",{style:{width:o.space[10],height:o.space[10],borderRadius:o.radius.md,backgroundColor:o.errorLight,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ke,{size:o.iconSize.xl,color:o.error})}),s.jsx("h3",{style:{fontSize:o.fontSize.xl,fontWeight:o.fontWeight.semibold,color:o.textMain,margin:0},children:"Session abbrechen?"})]}),s.jsx("p",{style:{fontSize:o.fontSize.base,color:o.textSecondary,marginBottom:o.space[6],lineHeight:1.5},children:"Alle eingegebenen Daten werden verworfen und nicht gespeichert."}),s.jsxs("div",{style:{display:"flex",gap:o.space[3],justifyContent:"flex-end"},children:[s.jsx(ce,{variant:"outline",onClick:()=>l(!1),children:"Zurck"}),s.jsxs(ce,{variant:"solid",onClick:()=>{l(!1),n()},style:{backgroundColor:o.error,color:o.white},children:[s.jsx(Ot,{size:o.iconSize.md,style:{marginRight:o.space[2]}}),"Abbrechen"]})]})]})})})]})},gc=({b:t})=>s.jsxs("div",{style:{padding:t.space[6],borderRadius:t.radius.xl,backgroundColor:t.cardBgHover,border:`1px solid ${t.borderColor}`},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:t.radius.lg,backgroundColor:t.borderColor,marginBottom:t.space[4],animation:"pulse 1.5s ease-in-out infinite"}}),s.jsx("div",{style:{width:"60%",height:"24px",borderRadius:t.radius.md,backgroundColor:t.borderColor,marginBottom:t.space[3],animation:"pulse 1.5s ease-in-out infinite"}}),s.jsx("div",{style:{width:"100%",height:"16px",borderRadius:t.radius.sm,backgroundColor:t.borderColor,marginBottom:t.space[2],animation:"pulse 1.5s ease-in-out infinite"}}),s.jsx("div",{style:{width:"85%",height:"16px",borderRadius:t.radius.sm,backgroundColor:t.borderColor,animation:"pulse 1.5s ease-in-out infinite"}})]}),ON=({card:t,index:e,b:n})=>{const i={blind_spot:{bgColor:n.warningLight,borderColor:n.warning,iconBg:"#fef08a",iconColor:n.warningDark,bulletColor:n.warningDark,icon:Ne},challenger:{bgColor:n.errorLight,borderColor:"#fca5a5",iconBg:n.errorLight,iconColor:n.error,bulletColor:n.error,icon:Cj},intuition:{bgColor:"#f5f3ff",borderColor:"#c4b5fd",iconBg:"#ede9fe",iconColor:"#7c3aed",bulletColor:"#7c3aed",icon:tl}},r=i[t.type]||i.blind_spot,o=r.icon,a=t.points||(t.content?[t.content]:[]);return s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:e*.15},style:{padding:n.space[6],borderRadius:n.radius.xl,backgroundColor:r.bgColor,border:`2px solid ${r.borderColor}`,height:"100%",display:"flex",flexDirection:"column"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:n.radius.lg,backgroundColor:r.iconBg,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:n.space[4]},children:s.jsx(o,{size:n.iconSize["2xl"],color:r.iconColor})}),s.jsx("h3",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.bold,color:n.textMain,marginBottom:n.space[3]},children:t.title}),t.type==="challenger"&&t.argument&&s.jsxs("div",{style:{padding:`${n.space[2.5]} ${n.space[3.5]}`,backgroundColor:"rgba(255,255,255,0.6)",borderRadius:n.radius.md,marginBottom:n.space[3],borderLeft:`3px solid ${r.bulletColor}`},children:[s.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.textSecondary,display:"block",marginBottom:"2px"},children:"Hinterfragtes Argument:"}),s.jsxs("span",{style:{fontSize:n.fontSize.md,fontWeight:n.fontWeight.semibold,color:n.textMain},children:['"',t.argument,'"']})]}),t.type==="intuition"&&t.question&&s.jsxs("div",{style:{padding:`${n.space[2.5]} ${n.space[3.5]}`,backgroundColor:"rgba(255,255,255,0.6)",borderRadius:n.radius.md,marginBottom:n.space[3],borderLeft:`3px solid ${r.bulletColor}`},children:[s.jsx("span",{style:{fontSize:n.fontSize.sm,color:n.textSecondary,display:"block",marginBottom:"2px"},children:"Reflexionsfrage:"}),s.jsx("span",{style:{fontSize:n.fontSize.md,fontWeight:n.fontWeight.semibold,color:n.textMain,fontStyle:"italic"},children:t.question})]}),s.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,flex:1},children:a.map((l,c)=>s.jsxs("li",{style:{display:"flex",alignItems:"flex-start",gap:n.space[2.5],marginBottom:n.space[2.5],fontSize:n.fontSize.md,lineHeight:1.5,color:n.textSecondary},children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:n.radius.full,backgroundColor:r.bulletColor,marginTop:"8px",flexShrink:0}}),s.jsx("span",{children:l})]},c))})]})},LN=({proScore:t,contraScore:e,b:n})=>{const i=t+e,r=i>0?Math.round(t/i*100):50,o=100-r,a=t>e?"pro":t<e?"contra":"neutral";return s.jsxs(He,{variant:"elevated",padding:"lg",style:{marginBottom:n.space[6]},children:[s.jsx(qn,{children:s.jsx(Rs,{icon:Ln,size:"lg",children:"Rationaler Score"})}),s.jsxs(Qe,{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:n.space[3]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[s.jsx(jn,{size:n.iconSize.lg,color:n.success}),s.jsxs("span",{style:{fontSize:n.fontSize["4xl"],fontWeight:n.fontWeight.bold,color:n.success},children:[r,"%"]}),s.jsxs("span",{style:{color:n.textSecondary,fontSize:n.fontSize.base},children:["(",t," Punkte)"]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[2]},children:[s.jsxs("span",{style:{color:n.textSecondary,fontSize:n.fontSize.base},children:["(",e," Punkte)"]}),s.jsxs("span",{style:{fontSize:n.fontSize["4xl"],fontWeight:n.fontWeight.bold,color:n.error},children:[o,"%"]}),s.jsx(Ei,{size:n.iconSize.lg,color:n.error})]})]}),s.jsxs("div",{style:{height:"32px",borderRadius:n.radius.xl,overflow:"hidden",display:"flex",backgroundColor:n.cardBgHover,boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},children:[s.jsx(V.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.8,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.success} 0%, ${n.successDark} 100%)`,height:"100%"}}),s.jsx(V.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.8,ease:"easeOut"},style:{background:`linear-gradient(90deg, ${n.error} 0%, ${n.errorDark} 100%)`,height:"100%"}})]}),s.jsxs("p",{style:{marginTop:n.space[4],textAlign:"center",fontSize:n.fontSize.md,color:n.textSecondary},children:[a==="pro"&&s.jsxs(s.Fragment,{children:["Die Zahlen sprechen ",s.jsx("strong",{style:{color:n.success},children:"fr"})," deine Entscheidung."]}),a==="contra"&&s.jsxs(s.Fragment,{children:["Die Zahlen sprechen ",s.jsx("strong",{style:{color:n.error},children:"gegen"})," deine Entscheidung."]}),a==="neutral"&&s.jsxs(s.Fragment,{children:["Die Argumente sind ",s.jsx("strong",{children:"ausgeglichen"})," - hier lohnt sich ein genauerer Blick."]})]})]})]})},BN=({decisionData:t,analysisResult:e,onStartNew:n,onEditDecision:i})=>{const r=Ve(),o=!e;return s.jsxs("div",{style:{padding:r.space[6],maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs(V.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},style:{marginBottom:r.space[8]},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:r.space[4]},children:[s.jsxs(ce,{variant:"ghost",onClick:i,children:[s.jsx(yt,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Bearbeiten"]}),s.jsxs(ce,{variant:"outline",onClick:n,children:[s.jsx(zt,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Neue Analyse"]})]}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"64px",height:"64px",borderRadius:r.radius.xl,background:r.headerGradient,marginBottom:r.space[4],boxShadow:r.coloredShadow(r.primaryAccent,"lg")},children:s.jsx(St,{size:r.iconSize["3xl"],color:r.white})}),s.jsx("h1",{style:{fontSize:r.fontSize["4xl"],fontWeight:r.fontWeight.bold,color:r.textMain,marginBottom:r.space[2]},children:"Deine Entscheidungsanalyse"}),s.jsxs("p",{style:{fontSize:r.fontSize.xl,color:r.textSecondary,fontStyle:"italic"},children:['"',t?.topic,'"']})]})]}),t&&s.jsx(LN,{proScore:t.proScore,contraScore:t.contraScore,b:r}),e?.analysis_summary&&s.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},children:s.jsx(He,{variant:"gradient",padding:"lg",style:{marginBottom:r.space[6]},children:s.jsx(Qe,{children:s.jsx("p",{style:{fontSize:r.fontSize.lg,lineHeight:1.7,color:r.textMain,textAlign:"center",fontStyle:"italic"},children:e.analysis_summary})})})}),s.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.3},style:{marginBottom:r.space[8]},children:[s.jsxs("h2",{style:{fontSize:r.fontSize["2xl"],fontWeight:r.fontWeight.bold,color:r.textMain,marginBottom:r.space[5],display:"flex",alignItems:"center",gap:r.space[2.5]},children:[s.jsx(St,{size:r.iconSize.xl,color:r.primaryAccent}),"KI-Coaching Impulse"]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:r.space[5]},children:o?s.jsxs(s.Fragment,{children:[s.jsx(gc,{b:r}),s.jsx(gc,{b:r}),s.jsx(gc,{b:r})]}):e?.cards?.map((a,l)=>s.jsx(ON,{card:a,index:l,b:r},a.type||l))})]}),s.jsxs(He,{variant:"elevated",padding:"lg",children:[s.jsx(qn,{children:s.jsx(Rs,{icon:Ln,size:"md",children:"Deine Argumente"})}),s.jsx(Qe,{children:s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:r.space[6]},children:[s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:r.success,marginBottom:r.space[3],display:"flex",alignItems:"center",gap:r.space[2]},children:[s.jsx(jn,{size:r.iconSize.md}),"Pro (",t?.proScore," Punkte)"]}),s.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:t?.pros?.map((a,l)=>s.jsxs("li",{style:{padding:`${r.space[2.5]} ${r.space[3.5]}`,backgroundColor:r.successLight,borderRadius:r.radius.md,marginBottom:r.space[2],display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{color:r.successDark},children:a.text}),s.jsx("span",{style:{backgroundColor:"#dcfce7",color:r.success,padding:`2px ${r.space[2]}`,borderRadius:r.radius.sm,fontSize:r.fontSize.sm,fontWeight:r.fontWeight.semibold},children:a.weight})]},a.id||l))})]}),s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:r.error,marginBottom:r.space[3],display:"flex",alignItems:"center",gap:r.space[2]},children:[s.jsx(Ei,{size:r.iconSize.md}),"Contra (",t?.contraScore," Punkte)"]}),s.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:t?.cons?.map((a,l)=>s.jsxs("li",{style:{padding:`${r.space[2.5]} ${r.space[3.5]}`,backgroundColor:r.errorLight,borderRadius:r.radius.md,marginBottom:r.space[2],display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{color:r.errorDark},children:a.text}),s.jsx("span",{style:{backgroundColor:"#fee2e2",color:r.error,padding:`2px ${r.space[2]}`,borderRadius:r.radius.sm,fontSize:r.fontSize.sm,fontWeight:r.fontWeight.semibold},children:a.weight})]},a.id||l))})]})]})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:r.space[4],marginTop:r.space[8]},children:[s.jsxs(ce,{variant:"outline",size:"lg",onClick:i,children:[s.jsx(Mo,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Argumente anpassen"]}),s.jsxs(ce,{variant:"solid",size:"lg",onClick:n,style:{background:r.headerGradient},children:[s.jsx(zt,{size:r.iconSize.md,style:{marginRight:r.space[2]}}),"Neue Entscheidung"]})]}),s.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
        `})]})},Gs={INPUT:"input",RESULT:"result"},FN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToHistory:i})=>{const[r,o]=f.useState(Gs.INPUT),[a,l]=f.useState(null),[c,d]=f.useState(null),[u,h]=f.useState(null),[p,m]=f.useState(!1),x=f.useRef(!1);f.useEffect(()=>{window.scrollTo(0,0)},[r]),f.useCallback(async j=>{if(x.current||!j.topic?.trim())return null;try{const w={topic:j.topic,context:j.context||null,pros:j.pros||[],cons:j.cons||[],pro_score:j.proScore||0,contra_score:j.contraScore||0,status:"draft"},T=await ue.createDecision(w);if(T?.id)return x.current=!0,h(T.id),console.log("[DecisionBoard] Draft session saved with ID:",T.id),T.id}catch(w){console.error("[DecisionBoard] Failed to save draft session:",w)}return null},[]);const g=f.useCallback(async(j,w)=>{if(j)try{const T={topic:w.topic,context:w.context||null,pros:w.pros||[],cons:w.cons||[],pro_score:w.proScore||0,contra_score:w.contraScore||0,analysis:w.analysis||null,status:w.status||"completed"};await ue.updateDecision(j,T),console.log("[DecisionBoard] Session updated:",j)}catch(T){console.error("[DecisionBoard] Failed to update session:",T)}},[]),y=f.useCallback(async j=>{if(j)try{await ue.deleteDecision(j),console.log("[DecisionBoard] Session deleted:",j)}catch(w){console.error("[DecisionBoard] Failed to delete session:",w)}},[]),v=f.useCallback(async(j,w)=>{l(j),d(w),o(Gs.RESULT);try{if(u)await g(u,{...j,analysis:w,status:"completed"});else{const T={topic:j.topic,context:j.context||null,pros:j.pros,cons:j.cons,pro_score:j.proScore,contra_score:j.contraScore,analysis:w,status:"completed"},I=await ue.createDecision(T);I?.id&&(h(I.id),x.current=!0,console.log("[DecisionBoard] Decision saved with ID:",I.id))}}catch(T){console.error("[DecisionBoard] Failed to save decision:",T)}},[u,g]),k=f.useCallback(()=>{l(null),d(null),h(null),x.current=!1,o(Gs.INPUT)},[]),S=f.useCallback(()=>{d(null),o(Gs.INPUT)},[]),C=f.useCallback(async()=>{u&&await y(u),l(null),d(null),h(null),x.current=!1,i&&i()},[u,y,i]),b=()=>{switch(r){case Gs.RESULT:return s.jsx(BN,{decisionData:a,analysisResult:c,onStartNew:k,onEditDecision:S});case Gs.INPUT:default:return s.jsx(zN,{initialData:a,onAnalysisComplete:v,onCancel:i?C:null,isAuthenticated:t,requireAuth:e})}};return s.jsx("div",{style:{minHeight:"100%"},children:b()})},WN=({onNavigateToRoleplay:t,compact:e=!1})=>{const{branding:n,demoCode:i}=Ue(),[r,o]=f.useState(!0),[a,l]=f.useState(null),[c,d]=f.useState(null),u=f.useMemo(()=>{const k=n?.["--header-gradient"]||Ie["--header-gradient"],S=n?.["--header-text"]||Ie["--header-text"],C=n?.["--primary-accent"]||Ie["--primary-accent"],b=n?.["--primary-accent-light"]||Ie["--primary-accent-light"];return{headerGradient:k,headerText:S,primaryAccent:C,primaryAccentLight:b}},[n]),h=async()=>{try{o(!0),l(null);const k=await ue.getUsageLimits(i);d(k)}catch(k){console.error("[UsageLimits] Error fetching usage data:",k),l(k.message||"Fehler beim Laden der Nutzungsdaten")}finally{o(!1)}};f.useEffect(()=>{h()},[i]);const p=f.useMemo(()=>!c||c.monthly_limit===0?0:Math.min(100,c.used_minutes/c.monthly_limit*100),[c]),m=(k,S)=>{const C=k/S*100;return C<=0?"#ef4444":C<=20?"#f59e0b":C<=50?"#eab308":"#22c55e"},x=k=>k?new Date(k).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",g=k=>k==null?"0 Min.":`${Math.round(k*10)/10} Min.`;if(r)return s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(he,{className:"w-8 h-8 animate-spin text-slate-400"})});if(a)return s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[s.jsx(ke,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-red-700 text-sm font-medium",children:a})}),s.jsxs(ce,{variant:"outline",size:"sm",onClick:h,children:[s.jsx(zt,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(e){const k=m(c?.remaining_minutes||0,c?.monthly_limit||10),S=c?.has_minutes!==!1;return s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:t,title:S?"Live-Gesprch starten":"Keine Minuten mehr verfgbar",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:u.headerGradient},children:s.jsx(Hr,{className:"w-5 h-5",style:{color:u.headerText}})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gesprche"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold text-lg",style:{color:k},children:g(c?.remaining_minutes||0)}),s.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",c?.monthly_limit||10," Min."]})]})]}),!S&&s.jsx(ke,{className:"w-5 h-5 text-red-500"})]}),s.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${p}%`,background:k}})})]})}const y=m(c?.remaining_minutes||0,c?.monthly_limit||10),v=c?.has_minutes!==!1;return s.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4",style:{background:u.headerGradient},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:s.jsx(Hr,{className:"w-6 h-6",style:{color:u.headerText}})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",style:{color:u.headerText},children:"Live-Gesprche"}),s.jsx("p",{className:"text-sm opacity-80",style:{color:u.headerText},children:"Monatliches Kontingent"})]})]}),s.jsx(ce,{variant:"ghost",size:"icon",onClick:h,className:"text-white hover:bg-white/10",children:s.jsx(zt,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"text-center mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:y,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-p)*2.827} 282.7`,className:"transition-all duration-500"})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[s.jsx("span",{className:"text-3xl font-bold",style:{color:y},children:g(c?.remaining_minutes||0)}),s.jsx("span",{className:"text-sm text-slate-500",children:"verfgbar"})]})]})}),s.jsx(De,{mode:"wait",children:v?p>80?s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ke,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),s.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",g(c?.remaining_minutes)," weise."]})]})]})},"low-minutes"):s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Zi,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfgbar"}),s.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gesprch zum ben."})]})]})},"ok"):s.jsx(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ke,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),s.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",x(c?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(dn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),s.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[c?.monthly_limit||10," Min."]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(Je,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),s.jsx("span",{className:"text-lg font-bold text-slate-700",children:g(c?.used_minutes||0)})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(Fn,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),s.jsx("span",{className:"text-sm font-bold text-slate-700",children:x(c?.next_reset)})]})]}),s.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",x(c?.period_start)," - ",x(c?.period_end)]}),t&&s.jsxs(ce,{onClick:t,disabled:!v,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:v?u.headerGradient:"#94a3b8",color:u.headerText},children:[s.jsx(Hr,{className:"w-5 h-5 mr-2"}),v?"Live-Gesprch starten":"Keine Minuten verfgbar"]}),c?.is_demo_user&&c?.demo_code&&s.jsx("div",{className:"mt-4 text-center",children:s.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",s.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:c.demo_code})]})})]})]})},gv=f.createContext(null),Kg={success:{bgColor:"#10b981",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},error:{bgColor:"#ef4444",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},info:{bgColor:"#3b82f6",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},warning:{bgColor:"#f59e0b",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}};function UN({id:t,message:e,type:n="success",duration:i=3e3,onDismiss:r}){const o=Kg[n]||Kg.info;return f.useEffect(()=>{if(i>0){const a=setTimeout(()=>{r(t)},i);return()=>clearTimeout(a)}},[t,i,r]),s.jsxs(V.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px",padding:"14px 20px",backgroundColor:o.bgColor,color:"#ffffff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",fontSize:"15px",fontWeight:500,minWidth:"280px",maxWidth:"400px"},children:[s.jsx("span",{style:{flexShrink:0},children:o.icon}),s.jsx("span",{style:{flex:1},children:e}),s.jsx("button",{onClick:()=>r(t),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"6px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",flexShrink:0},onMouseEnter:a=>a.target.style.background="rgba(255, 255, 255, 0.3)",onMouseLeave:a=>a.target.style.background="rgba(255, 255, 255, 0.2)",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function $N({toasts:t,onDismiss:e}){return s.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:s.jsx(De,{children:t.map(n=>s.jsx(UN,{...n,onDismiss:e},n.id))})})}function VN({children:t}){const[e,n]=f.useState([]),i=f.useCallback((u,h="success",p=3e3)=>{const m=Date.now()+Math.random();return n(x=>[...x,{id:m,message:u,type:h,duration:p}]),m},[]),r=f.useCallback(u=>{n(h=>h.filter(p=>p.id!==u))},[]),o=f.useCallback((u,h)=>i(u,"success",h),[i]),a=f.useCallback((u,h)=>i(u,"error",h),[i]),l=f.useCallback((u,h)=>i(u,"info",h),[i]),c=f.useCallback((u,h)=>i(u,"warning",h),[i]),d={addToast:i,dismissToast:r,showSuccess:o,showError:a,showInfo:l,showWarning:c};return s.jsxs(gv.Provider,{value:d,children:[t,s.jsx($N,{toasts:e,onDismiss:r})]})}function mv(){const t=f.useContext(gv);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}const Oe={blue:{50:"#E8F4F8",600:"#3A7FA7",700:"#2D6485"},teal:{500:"#3DA389"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",400:"#94a3b8",700:"#334155",900:"#0f172a"}},xv=t=>t?{sidebarBg:t["--sidebar-bg-color"]||Oe.slate[50],sidebarText:t["--sidebar-text-color"]||Oe.slate[900],sidebarTextMuted:t["--sidebar-text-muted"]||Oe.slate[400],sidebarActiveBg:t["--sidebar-active-bg"]||Oe.blue[50],sidebarActiveText:t["--sidebar-active-text"]||Oe.blue[700],sidebarHoverBg:t["--sidebar-hover-bg"]||Oe.slate[50],primaryAccent:t["--primary-accent"]||Oe.blue[600],borderColor:t["--border-color"]||Oe.slate[200],borderColorLight:t["--border-color-light"]||Oe.slate[100]}:null,yv=[{id:"overview",moduleId:"overview",label:"bersicht",shortLabel:"bersicht",icon:Rj,description:"Alle Trainingsmglichkeiten",alwaysVisible:!0},{id:"smart_briefing",moduleId:"smart_briefing",label:"Smart Briefing",shortLabel:"Briefing",icon:St,description:"KI-Vorbereitungs-Assistent"},{id:"decision_board",moduleId:"decision_board",label:"Entscheidungs-Kompass",shortLabel:"Entscheidung",icon:Ln,description:"KI-gesttzte Entscheidungshilfe"},{id:"simulator",moduleId:"simulator",label:"Szenario-Training",shortLabel:"Szenario",icon:et,description:"Frage-Antwort Training mit KI-Feedback"},{id:"video_training",moduleId:"video_training",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:bt,description:"Video-Aufnahme mit Wirkungs-Analyse"},{id:"dashboard",moduleId:"roleplay",label:"Live-Simulationen",shortLabel:"Live",icon:Ye,description:"Live Simulationen mit KI-Interviewer"},{id:"gym",moduleId:"gym",label:"Rhetorik-Gym",shortLabel:"Gym",icon:hu,description:"Spielerisch Rhetorik trainieren",subItems:[{id:"gym_klassiker",label:"Der Fllwort-Killer",shortLabel:"Klassiker",icon:oi,description:"60s Elevator Pitch"}]},{id:"history",moduleId:"history",label:"Meine Sessions",shortLabel:"Sessions",icon:Vc,description:"Vergangene bungen ansehen"},{id:"usage_limits",moduleId:"roleplay",label:"Mein Kontingent",shortLabel:"Kontingent",icon:Je,description:"Verfgbare Gesprchsminuten"}],bv=[{id:"admin",label:"Administration",shortLabel:"Admin",icon:Ii,description:"Inhalte verwalten",adminOnly:!0,subItems:[{id:"admin_roleplays",label:"Live-Simulationen",shortLabel:"Live",icon:Ye,description:"Simulations-Szenarien verwalten"},{id:"admin_simulator",label:"Szenario-Training",shortLabel:"Simulator",icon:et,description:"Simulator-Szenarien verwalten"},{id:"admin_video",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:bt,description:"Wirkungs-Analysen verwalten"},{id:"admin_partners",label:"Partner-Branding",shortLabel:"Partner",icon:mn,description:"White-Label Partner verwalten"}]}],GN=({isCollapsed:t,onToggleCollapse:e,activeView:n,onNavigate:i,headerOffset:r=0,onLoginClick:o})=>{const[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=Ue(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=Rd(),{showSuccess:v}=mv(),k=xv(c),S=f.useMemo(()=>{const T=yv.filter(I=>{if(I.alwaysVisible)return!0;const E=I.moduleId||I.id;return p(E)});return g?[...T,...bv]:T},[p,g]),C=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>k?{sidebarBg:k.sidebarBg,sidebarText:k.sidebarText,sidebarTextMuted:k.sidebarTextMuted,activeBg:k.sidebarActiveBg,activeText:k.sidebarActiveText,hoverBg:k.sidebarHoverBg,primaryAccent:k.primaryAccent,borderColor:k.borderColor,borderColorLight:k.borderColorLight}:{sidebarBg:"#ffffff",sidebarText:Oe.slate[900],sidebarTextMuted:Oe.slate[400],activeBg:Oe.blue[50],activeText:Oe.blue[700],hoverBg:Oe.slate[50],primaryAccent:Oe.blue[600],borderColor:Oe.slate[200],borderColorLight:Oe.slate[100]},[k]),j=T=>{l(I=>I.includes(T)?I.filter(E=>E!==T):[...I,T])},w=T=>{T.subItems&&!t?j(T.id):i(T.id)};return s.jsxs(V.aside,{initial:!1,animate:{width:t?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{position:"fixed",left:0,top:r,bottom:0,zIndex:40,backgroundColor:b.sidebarBg,borderRight:`1px solid ${b.borderColor}`,display:"flex",flexDirection:"column",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:[s.jsx("div",{style:{height:"64px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${b.borderColorLight}`},children:s.jsx(De,{mode:"wait",children:t?s.jsx(V.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",margin:"0 auto",overflow:"hidden"},children:h?s.jsx("img",{src:h,alt:u,style:{width:"100%",height:"100%",objectFit:"contain"}}):s.jsx($c,{style:{width:"20px",height:"20px",color:"white"}})},"logo-collapsed"):s.jsxs(V.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px"},children:[h?s.jsx("img",{src:h,alt:u,style:{width:"40px",height:"40px",borderRadius:"12px",objectFit:"contain"}}):s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:s.jsx($c,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsx("div",{style:{display:"flex",flexDirection:"column"},children:d?s.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.4"},children:u}):s.jsxs(s.Fragment,{children:[s.jsx("span",{style:{fontWeight:700,color:b.sidebarText,fontSize:"14px",lineHeight:"1.2"},children:"Karriere"}),s.jsx("span",{style:{fontWeight:700,color:b.primaryAccent,fontSize:"14px",lineHeight:"1.2"},children:"Navigation"})]})})]},"logo-full")})}),s.jsx("nav",{style:{flex:1,padding:"8px 12px",overflowY:"auto"},children:S.map((T,I)=>{const E=T.icon,P=n===T.id||T.id==="dashboard"&&n==="roleplay"||T.id==="gym"&&n.startsWith("gym")||T.id==="admin"&&n.startsWith("admin"),O=T.subItems&&T.subItems.length>0,B=a.includes(T.id),N=T.adminOnly;return s.jsxs("div",{children:[N&&s.jsx("div",{style:{margin:"12px 0",padding:t?"0":"0 4px",borderTop:`1px solid ${b.borderColor}`},children:!t&&s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.sidebarTextMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"12px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>w(T),style:{width:"100%",borderRadius:"12px",display:"flex",alignItems:"center",gap:"12px",position:"relative",padding:t?"12px":"12px 16px",justifyContent:t?"center":"flex-start",backgroundColor:P?b.activeBg:"transparent",color:P?b.activeText:b.sidebarText,fontWeight:P?600:400,fontSize:"14px",border:"none",cursor:"pointer",marginBottom:"4px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:M=>{P||(M.currentTarget.style.backgroundColor=b.hoverBg,M.currentTarget.style.color=b.sidebarText)},onMouseLeave:M=>{P||(M.currentTarget.style.backgroundColor="transparent",M.currentTarget.style.color=b.sidebarText)},children:[P&&s.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:"4px",height:"32px",backgroundColor:b.primaryAccent,borderTopRightRadius:"9999px",borderBottomRightRadius:"9999px"}}),s.jsx(E,{style:{width:"20px",height:"20px",flexShrink:0,color:P?b.primaryAccent:b.sidebarTextMuted}}),!t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",flex:1,minWidth:0},children:[s.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:T.label}),s.jsx("span",{style:{fontSize:"12px",color:b.sidebarTextMuted,whiteSpace:"normal",lineHeight:1.3},children:T.description})]}),O&&s.jsx(ct,{style:{width:"16px",height:"16px",color:b.sidebarTextMuted,transition:"transform 0.2s",transform:B?"rotate(180deg)":"rotate(0deg)"}})]})]}),O&&!t&&s.jsx(De,{children:B&&s.jsx(V.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},style:{overflow:"hidden",marginLeft:"16px"},children:T.subItems.map(M=>{const F=M.icon,$=n===M.id;return s.jsxs("button",{onClick:()=>i(M.id),style:{width:"100%",borderRadius:"10px",display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",backgroundColor:$?b.activeBg:"transparent",color:$?b.activeText:b.sidebarText,fontWeight:$?600:400,fontSize:"13px",border:"none",cursor:"pointer",marginBottom:"2px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:D=>{$||(D.currentTarget.style.backgroundColor=b.hoverBg,D.currentTarget.style.color=b.sidebarText)},onMouseLeave:D=>{$||(D.currentTarget.style.backgroundColor="transparent",D.currentTarget.style.color=b.sidebarText)},children:[s.jsx(F,{style:{width:"16px",height:"16px",flexShrink:0,color:$?b.primaryAccent:b.sidebarTextMuted}}),s.jsx("span",{style:{whiteSpace:"nowrap"},children:M.label})]},M.id)})})})]},T.id)})}),s.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${b.borderColorLight}`},children:x&&m?s.jsxs("div",{style:{marginBottom:"8px"},children:[!t&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"14px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:b.sidebarText,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"12px",color:b.sidebarText,opacity:.7,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.email})]})]}),s.jsxs("button",{onClick:C,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Abmelden",children:[s.jsx(Vx,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:o,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:b.sidebarText,backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,cursor:"pointer",fontSize:"13px",fontWeight:500,transition:"all 0.2s",marginBottom:"8px"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Anmelden",children:[s.jsx(Ia,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Anmelden"})]})}),s.jsx("div",{style:{padding:"0 12px 12px 12px"},children:s.jsx("button",{onClick:e,style:{width:"100%",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"12px",justifyContent:t?"center":"flex-start",color:b.sidebarTextMuted,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=b.hoverBg,T.currentTarget.style.color=b.sidebarText},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent",T.currentTarget.style.color=b.sidebarTextMuted},children:t?s.jsx(Kt,{style:{width:"20px",height:"20px"}}):s.jsxs(s.Fragment,{children:[s.jsx(Qr,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Einklappen"})]})})})]})},HN=({activeView:t,onNavigate:e,headerOffset:n=0,onLoginClick:i})=>{const[r,o]=f.useState(!1),[a,l]=f.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=Ue(),{user:m,isAuthenticated:x,isAdmin:g,logout:y}=Rd(),{showSuccess:v}=mv(),k=xv(c),S=f.useMemo(()=>{const T=yv.filter(I=>{const E=I.moduleId||I.id;return p(E)});return g?[...T,...bv]:T},[p,g]),C=async()=>{await y(),v("Sie wurden erfolgreich abgemeldet",3e3)},b=f.useMemo(()=>k?{headerBg:k.sidebarBg,headerText:k.sidebarText,headerTextMuted:k.sidebarTextMuted,menuBg:"#ffffff",activeBg:k.sidebarActiveBg,activeText:k.sidebarActiveText,hoverBg:k.sidebarHoverBg,primaryAccent:k.primaryAccent,borderColor:k.borderColor,textMain:Oe.slate[700],textMuted:Oe.slate[400]}:{headerBg:"#ffffff",headerText:Oe.slate[900],headerTextMuted:Oe.slate[400],menuBg:"#ffffff",activeBg:Oe.blue[50],activeText:Oe.blue[700],hoverBg:Oe.slate[50],primaryAccent:Oe.blue[600],borderColor:Oe.slate[200],textMain:Oe.slate[700],textMuted:Oe.slate[400]},[k]),j=T=>{e(T),o(!1)},w=T=>{l(I=>I.includes(T)?I.filter(E=>E!==T):[...I,T])};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{position:"fixed",top:n,left:0,right:0,height:"56px",backgroundColor:b.headerBg,borderBottom:`1px solid ${b.borderColor}`,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",zIndex:50,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",transition:"top 0.15s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[h?s.jsx("img",{src:h,alt:u,style:{width:"36px",height:"36px",borderRadius:"10px",objectFit:"contain"}}):s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:d?b.primaryAccent:`linear-gradient(135deg, ${Oe.blue[600]} 0%, ${Oe.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx($c,{style:{width:"18px",height:"18px",color:"white"}})}),s.jsx("span",{style:{fontWeight:700,color:b.headerText,fontSize:"15px"},children:d?u:"Karriere Navigation"})]}),s.jsx("button",{onClick:()=>o(!r),style:{width:"56px",height:"56px",borderRadius:"12px",border:"none",backgroundColor:r?b.hoverBg:"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:r?s.jsx(Ot,{style:{width:"40px",height:"40px",color:b.headerText}}):s.jsx(Mj,{style:{width:"40px",height:"40px",color:b.headerText}})})]}),s.jsx(De,{children:r&&s.jsxs(s.Fragment,{children:[s.jsx(V.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(!1),style:{position:"fixed",top:n+56,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:40}}),s.jsxs(V.nav,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},style:{position:"fixed",top:n+56,left:0,right:0,backgroundColor:b.menuBg,zIndex:45,padding:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderBottomLeftRadius:"16px",borderBottomRightRadius:"16px",maxHeight:"70vh",overflowY:"auto"},children:[S.map(T=>{const I=T.icon,E=t===T.id||T.id==="dashboard"&&t==="roleplay"||T.id==="gym"&&t.startsWith("gym")||T.id==="admin"&&t.startsWith("admin"),P=T.subItems&&T.subItems.length>0,O=a.includes(T.id),B=T.adminOnly;return s.jsxs("div",{children:[B&&s.jsx("div",{style:{margin:"12px 8px",borderTop:`1px solid ${b.borderColor}`},children:s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:b.textMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"8px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>P?w(T.id):j(T.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:"none",backgroundColor:E?b.activeBg:"transparent",color:E?b.activeText:b.textMain,fontSize:"15px",fontWeight:E?600:500,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx(I,{style:{width:"22px",height:"22px",color:E?b.primaryAccent:b.textMuted}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{children:T.label}),s.jsx("div",{style:{fontSize:"12px",color:b.textMuted,fontWeight:400},children:T.description})]}),P&&s.jsx(ct,{style:{width:"18px",height:"18px",color:b.textMuted,transition:"transform 0.2s",transform:O?"rotate(180deg)":"rotate(0deg)"}})]}),P&&O&&s.jsx("div",{style:{marginLeft:"20px",marginBottom:"8px"},children:T.subItems.map(N=>{const M=N.icon,F=t===N.id;return s.jsxs("button",{onClick:()=>j(N.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",borderRadius:"10px",border:"none",backgroundColor:F?b.activeBg:"transparent",color:F?b.activeText:b.textMain,fontSize:"14px",fontWeight:F?600:400,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx(M,{style:{width:"18px",height:"18px",color:F?b.primaryAccent:b.textMuted}}),s.jsx("span",{children:N.label})]},N.id)})})]},T.id)}),s.jsx("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${b.borderColor}`},children:x&&m?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${b.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:b.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"16px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:b.textMain},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"13px",color:b.textMain,opacity:.7},children:m.email})]})]}),s.jsxs("button",{onClick:()=>{C(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:"none",backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:500,cursor:"pointer",textAlign:"left"},children:[s.jsx(Vx,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:()=>{i&&i(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:`1px solid ${b.borderColor}`,backgroundColor:"transparent",color:b.textMain,fontSize:"15px",fontWeight:600,cursor:"pointer",textAlign:"left"},children:[s.jsx(Ia,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Anmelden"})]})})]})]})})]})},qN=({children:t,activeView:e,onNavigate:n,headerOffset:i=0,onLoginClick:r})=>{const[o,a]=f.useState(!1),[l,c]=f.useState(!1),{branding:d}=Ue(),u=f.useMemo(()=>{if(d){const p=d["--app-bg-start"]||"#f8fafc",m=d["--app-bg-mid"]||"#eff6ff",x=d["--app-bg-end"]||"#f0fdfa";return`linear-gradient(135deg, ${p} 0%, ${m} 50%, ${x} 100%)`}return"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)"},[d]);f.useEffect(()=>{const p=()=>{c(window.innerWidth<768)};p(),window.addEventListener("resize",p);const m=localStorage.getItem("sidebar-collapsed");return m!==null&&a(JSON.parse(m)),()=>window.removeEventListener("resize",p)},[]);const h=()=>{const p=!o;a(p),localStorage.setItem("sidebar-collapsed",JSON.stringify(p))};return l?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(HN,{activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx("main",{"data-main-content":!0,style:{paddingTop:"56px",minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(GN,{isCollapsed:o,onToggleCollapse:h,activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx(V.main,{"data-main-content":!0,initial:!1,animate:{marginLeft:o?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]})};function KN({isOpen:t,onClose:e,onSuccess:n}){const{branding:i,partnerName:r,logoUrl:o}=Ue(),[a,l]=f.useState(1),[c,d]=f.useState(""),[u,h]=f.useState(""),[p,m]=f.useState(""),[x,g]=f.useState(""),[y,v]=f.useState(""),[k,S]=f.useState(""),[C,b]=f.useState(!1),[j,w]=f.useState(""),[T,I]=f.useState(!1),[E,P]=f.useState(!1),O=i?.["--primary-accent"]||"#3A7FA7",B=i?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",N=i?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",M=i?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",F=i?.["--header-text"]||"#ffffff",$=i?.["--sidebar-text-color"]||"#ffffff",D=async A=>{if(A.preventDefault(),w(""),!c.trim()){w("Bitte geben Sie Ihren Demo-Code ein.");return}if(c.trim().length!==5){w("Der Demo-Code muss 5 Zeichen lang sein.");return}I(!0);try{const W=fn(),H=wt(),Se=await(await fetch(`${W}/demo/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim()})})).json();if(!Se.valid){w("Der Demo-Code ist ungltig. Bitte berprfen Sie Ihre Eingabe.");return}Se.is_activated?(P(!0),n&&n(c.toUpperCase().trim())):l(2)}catch(W){console.error("[DEMO] Validation error:",W),w("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{I(!1)}},z=async A=>{if(A.preventDefault(),w(""),!u.trim()){w("Bitte geben Sie den Firmennamen ein.");return}if(!p.trim()){w("Bitte geben Sie den Namen des Ansprechpartners ein.");return}if(!y.trim()){w("Bitte geben Sie eine Kontakt-E-Mail ein.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)){w("Bitte geben Sie eine gltige E-Mail-Adresse ein.");return}if(!C){w("Bitte stimmen Sie den Datenschutzbestimmungen zu.");return}I(!0);try{const H=fn(),oe=wt(),$e=await(await fetch(`${H}/demo/activate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":oe},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim(),company_name:u.trim(),contact_name:p.trim(),homepage:x.trim(),contact_email:y.trim(),phone:k.trim(),privacy_accepted:C})})).json();$e.success?(P(!0),n&&n(c.toUpperCase().trim())):w($e.error?.message||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}catch(H){console.error("[DEMO] Activation error:",H),w("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{I(!1)}},L=()=>{E||(l(1),d(""),h(""),m(""),g(""),v(""),S(""),b(!1),w(""),e&&e())},ee=()=>{l(1),w("")},se=A=>{A.target===A.currentTarget&&L()};if(As.useEffect(()=>{const A=W=>{W.key==="Escape"&&t&&L()};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[t,E]),!t)return null;const G={width:"100%",padding:"10px 14px",fontSize:"14px",border:"1px solid #e2e8f0",borderRadius:"10px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},q={borderColor:O,boxShadow:`0 0 0 3px ${M}`,backgroundColor:"#ffffff"},ie={display:"block",fontSize:"13px",fontWeight:"500",color:"#374151",marginBottom:"6px"};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:se,role:"dialog","aria-modal":"true","aria-labelledby":"demo-modal-title",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:N,color:F},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[a===2&&s.jsx("button",{onClick:ee,className:"p-1.5 rounded-lg transition-colors",style:{color:F,backgroundColor:"transparent"},onMouseEnter:A=>A.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:A=>A.target.style.backgroundColor="transparent","aria-label":"Zurck",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h2",{id:"demo-modal-title",className:"text-xl font-semibold",style:{color:F},children:a===1?"Demo-Code eingeben":"Kontaktdaten"})]}),s.jsx("button",{onClick:L,className:"p-2 rounded-xl transition-colors",style:{color:F,backgroundColor:"transparent"},onMouseEnter:A=>A.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:A=>A.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o&&a===1&&s.jsx("div",{className:"mt-3 mb-1 flex justify-center",children:s.jsx("img",{src:o,alt:`${r} Logo`,style:{height:"4rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:F,opacity:a>=1?1:.3}}),s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:F,opacity:a>=2?1:.3}})]})]}),a===1&&s.jsxs("form",{onSubmit:D,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-700 text-sm",children:s.jsx("p",{children:"Willkommen zur Demo! Bitte geben Sie den Demo-Code ein, den Sie von uns erhalten haben."})}),j&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:j})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"demo-code",style:ie,children:["Demo-Code ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"demo-code",value:c,onChange:A=>d(A.target.value.toUpperCase()),style:{...G,fontFamily:"monospace",fontSize:"24px",fontWeight:"600",letterSpacing:"4px",textAlign:"center",padding:"16px 14px"},onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"XXXXX",maxLength:5,disabled:T,autoComplete:"off",autoFocus:!0})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:$,background:T?"#94a3b8":B,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:A=>{T||(A.target.style.transform="translateY(-1px)",A.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:A=>{A.target.style.transform="translateY(0)",A.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:$,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:$},children:"Wird berprft..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:$,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),s.jsx("span",{style:{color:$},children:"Weiter"})]})}),s.jsxs("p",{className:"text-xs text-center text-gray-500 pt-2",children:["Haben Sie keinen Demo-Code? Kontaktieren Sie uns unter"," ",s.jsx("a",{href:"mailto:info@karriereheld.de",className:"underline",style:{color:O},children:"info@karriereheld.de"})]})]}),a===2&&s.jsxs("form",{onSubmit:z,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Code gltig!"})," Bitte geben Sie noch Ihre Kontaktdaten ein, um die Demo zu starten."]})}),j&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:j})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"company-name",style:ie,children:["Firma ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"company-name",value:u,onChange:A=>h(A.target.value),style:G,onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"Ihre Firma",disabled:T,autoComplete:"organization",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-name",style:ie,children:["Ansprechpartner ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"contact-name",value:p,onChange:A=>m(A.target.value),style:G,onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"Ihr Name",disabled:T,autoComplete:"name"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-email",style:ie,children:["E-Mail ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"email",id:"contact-email",value:y,onChange:A=>v(A.target.value),style:G,onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"email@firma.de",disabled:T,autoComplete:"email"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"homepage",style:ie,children:["Homepage ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"url",id:"homepage",value:x,onChange:A=>g(A.target.value),style:G,onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"https://www.ihre-firma.de",disabled:T,autoComplete:"url"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"phone",style:ie,children:["Telefon ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"tel",id:"phone",value:k,onChange:A=>S(A.target.value),style:G,onFocus:A=>Object.assign(A.target.style,q),onBlur:A=>{A.target.style.borderColor="#e2e8f0",A.target.style.boxShadow="none"},placeholder:"+49 123 456789",disabled:T,autoComplete:"tel"})]}),s.jsxs("div",{className:"flex items-start gap-3 pt-2",children:[s.jsx("input",{type:"checkbox",id:"privacy-accepted",checked:C,onChange:A=>b(A.target.checked),className:"mt-1 w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:T,style:{accentColor:O}}),s.jsxs("label",{htmlFor:"privacy-accepted",className:"text-sm text-gray-600",children:["Ich stimme den"," ",s.jsx("a",{href:"/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-gray-900",style:{color:O},children:"Datenschutzbestimmungen"})," ","zu. ",s.jsx("span",{className:"text-red-500",children:"*"})]})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:$,background:T?"#94a3b8":B,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:A=>{T||(A.target.style.transform="translateY(-1px)",A.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:A=>{A.target.style.transform="translateY(0)",A.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:$,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:$},children:"Wird aktiviert..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:$,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),s.jsx("span",{style:{color:$},children:"Demo starten"})]})})]})]})})}const JN="demo";function YN({isOpen:t,onClose:e,onLoginSuccess:n}){const{login:i,logout:r,branding:o,partnerName:a,logoUrl:l,setDemoCode:c}=Ue(),[d,u]=f.useState(""),[h,p]=f.useState(""),[m,x]=f.useState(""),[g,y]=f.useState(!1),[v,k]=f.useState(!1),[S,C]=f.useState(null),b=o?.["--primary-accent"]||"#3A7FA7",j=o?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",w=o?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",T=o?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",I=o?.["--header-text"]||"#ffffff",E=o?.["--sidebar-text-color"]||"#ffffff",P=async D=>{if(D.preventDefault(),x(""),!d.trim()||!h.trim()){x("Bitte geben Sie Benutzername und Passwort ein.");return}y(!0);try{const z=await i(d,h);z.success?d.toLowerCase()===JN?(localStorage.setItem("bewerbungstrainer_demo_pending","true"),C(z.user),k(!0),p("")):(u(""),p(""),n&&n(z.user),e&&e()):x(z.error||"Login fehlgeschlagen. Bitte versuchen Sie es erneut.")}catch(z){console.error("Login error:",z),x("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{y(!1)}},O=D=>{localStorage.removeItem("bewerbungstrainer_demo_pending"),c&&c(D),u(""),p(""),k(!1),n&&S&&n(S),e&&e()},B=async()=>{localStorage.removeItem("bewerbungstrainer_demo_pending");try{r&&await r()}catch(D){console.error("[LOGIN] Error logging out demo user:",D)}k(!1),C(null),u(""),p("")},N=()=>{x(""),u(""),p(""),e&&e()},M=D=>{D.target===D.currentTarget&&N()};if(As.useEffect(()=>{const D=z=>{z.key==="Escape"&&t&&N()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[t]),!t)return null;const F={width:"100%",padding:"12px 16px",fontSize:"15px",border:"1px solid #e2e8f0",borderRadius:"12px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},$={borderColor:b,boxShadow:`0 0 0 3px ${T}`,backgroundColor:"#ffffff"};return s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:M,role:"dialog","aria-modal":"true","aria-labelledby":"login-modal-title",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:w,color:I},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{id:"login-modal-title",className:"text-xl font-semibold",style:{color:I},children:"Anmelden"}),s.jsx("button",{onClick:N,className:"p-2 rounded-xl transition-colors",style:{color:I,backgroundColor:"transparent"},onMouseEnter:D=>D.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:D=>D.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l&&s.jsx("div",{className:"mt-4 mb-2 flex justify-center",children:s.jsx("img",{src:l,alt:`${a} Logo`,style:{height:"8.5rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("p",{className:"text-sm mt-1",style:{color:I,opacity:.8},children:["Bei ",a," anmelden"]})]}),s.jsxs("form",{onSubmit:P,className:"p-6 space-y-5",children:[m&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:m})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Benutzername oder E-Mail"}),s.jsx("input",{type:"text",id:"login-username",value:d,onChange:D=>u(D.target.value),style:F,onFocus:D=>Object.assign(D.target.style,$),onBlur:D=>{D.target.style.borderColor="#e2e8f0",D.target.style.boxShadow="none",D.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Benutzername",disabled:g,autoComplete:"username",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort"}),s.jsx("input",{type:"password",id:"login-password",value:h,onChange:D=>p(D.target.value),style:F,onFocus:D=>Object.assign(D.target.style,$),onBlur:D=>{D.target.style.borderColor="#e2e8f0",D.target.style.boxShadow="none",D.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Passwort",disabled:g,autoComplete:"current-password"})]}),s.jsx("button",{type:"submit",disabled:g,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:E,background:g?"#94a3b8":j,border:"none",borderRadius:"12px",cursor:g?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:g?.7:1,boxShadow:g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:D=>{g||(D.target.style.transform="translateY(-1px)",D.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:D=>{D.target.style.transform="translateY(0)",D.target.style.boxShadow=g?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:g?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:E,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:E,fontSize:"16px",fontWeight:600},children:"Wird angemeldet..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:E,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),s.jsx("span",{style:{color:E,fontSize:"16px",fontWeight:600},children:"Anmelden"})]})}),s.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:"Verwenden Sie Ihre WordPress-Zugangsdaten zur Anmeldung."})]})]}),s.jsx(KN,{isOpen:v,onClose:B,onSuccess:O})]})}function XN({isOpen:t,onClose:e,onAcknowledge:n}){const{branding:i,partnerName:r}=Ue(),[o,a]=f.useState(!1),[l,c]=f.useState(null),[d,u]=f.useState(!1),[h,p]=f.useState(""),m=i?.["--primary-accent"]||"#3A7FA7",x=i?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",g=i?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",y=i?.["--header-text"]||"#ffffff",v=i?.["--sidebar-text-color"]||"#ffffff";f.useEffect(()=>{t&&k()},[t]);const k=async()=>{try{const j=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",T=await(await fetch(`${j}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();T.success&&T.disclaimer&&c(T.disclaimer)}catch(j){console.error("[DISCLAIMER] Error fetching status:",j),p("Fehler beim Laden des Hinweises")}},S=async()=>{if(l){u(!0),p("");try{const j=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",T=await(await fetch(`${j}/disclaimer/acknowledge`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin",body:JSON.stringify({disclaimer_id:l.id,dont_show_again:o})})).json();T.success?(n&&n(o),e&&e()):p(T.message||"Fehler bei der Besttigung")}catch(j){console.error("[DISCLAIMER] Error acknowledging:",j),p("Ein Fehler ist aufgetreten")}finally{u(!1)}}},C=j=>{j.stopPropagation()};if(f.useEffect(()=>{const j=w=>{w.key==="Escape"&&t&&w.preventDefault()};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[t]),!t||!l)return null;const b=j=>j?j.split(`
`).map((w,T)=>w.trim()?s.jsx("p",{className:"mb-3 last:mb-0",children:w},T):null):null;return s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",style:{zIndex:99999},onClick:C,role:"dialog","aria-modal":"true","aria-labelledby":"disclaimer-modal-title",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full flex flex-col",style:{maxHeight:"min(85vh, 600px)",maxWidth:"520px",width:"100%"},children:[s.jsx("div",{className:"px-4 sm:px-6 py-4 flex-shrink-0 rounded-t-2xl",style:{background:g,color:y},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-xl hidden sm:flex",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:s.jsx(Ii,{className:"w-5 h-5",style:{color:y}})}),s.jsxs("div",{children:[s.jsx("h2",{id:"disclaimer-modal-title",className:"text-lg sm:text-xl font-semibold",style:{color:y},children:l.title}),s.jsxs("p",{className:"text-xs sm:text-sm mt-0.5",style:{color:y,opacity:.8},children:["Version ",l.version]})]})]})}),s.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto flex-1",children:[h&&s.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx(ss,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:h})]}),s.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4 overflow-y-auto",style:{maxHeight:"180px"},children:s.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:b(l.content)})}),s.jsxs("div",{className:"flex items-start gap-2 sm:gap-3 p-3 sm:p-4 bg-blue-50 rounded-xl border border-blue-100 mb-4",children:[s.jsx(un,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 flex-shrink-0 mt-0.5"}),s.jsxs("p",{className:"text-xs sm:text-sm text-blue-700",children:["Mit der Besttigung akzeptieren Sie diese Nutzungshinweise fr ",r,"."]})]}),s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group mb-4 sm:mb-5",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",checked:o,onChange:j=>a(j.target.checked),className:"sr-only"}),s.jsx("div",{className:"w-5 h-5 rounded border-2 transition-all flex items-center justify-center",style:{borderColor:o?m:"#cbd5e1",backgroundColor:o?m:"transparent"},children:o&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),s.jsx("span",{className:"text-sm text-gray-700 group-hover:text-gray-900 transition-colors",children:"Diesen Hinweis nicht mehr anzeigen"})]}),s.jsx("button",{onClick:S,disabled:d,style:{width:"100%",padding:"12px 20px",fontSize:"15px",fontWeight:600,color:v,background:d?"#94a3b8":x,border:"none",borderRadius:"12px",cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:d?.7:1,boxShadow:d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:j=>{d||(j.target.style.transform="translateY(-1px)",j.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:j=>{j.target.style.transform="translateY(0)",j.target.style.boxShadow=d?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:d?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"18px",height:"18px",color:v,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Wird gespeichert..."})]}):s.jsx("span",{style:{color:v,fontSize:"15px",fontWeight:600},children:"Verstanden"})}),s.jsx("p",{className:"text-xs text-center text-gray-500 mt-3",children:o?"Sie werden diesen Hinweis bei zuknftigen Anmeldungen nicht mehr sehen.":"Dieser Hinweis wird bei jeder Anmeldung angezeigt."})]})]}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]})}function ZN(){const[t,e]=f.useState(!1),[n,i]=f.useState(!1),[r,o]=f.useState(!1);return{isOpen:t,needsDisclaimer:n,isChecking:r,openDisclaimerModal:()=>e(!0),closeDisclaimerModal:()=>{e(!1),i(!1)},checkDisclaimerStatus:async()=>{o(!0);try{const d=window.bewerbungstrainerConfig?.apiUrl||"/wp-json/bewerbungstrainer/v1",h=await(await fetch(`${d}/disclaimer/status`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":window.bewerbungstrainerConfig?.nonce||""},credentials:"same-origin"})).json();if(h.success){const p=h.needs_acknowledgment;return i(p),p&&e(!0),p}return!1}catch(d){return console.error("[DISCLAIMER] Error checking status:",d),!1}finally{o(!1)}}}}const te={HOME:"/",OVERVIEW:"/uebersicht",LIVE_TRAINING:"/live-training",LIVE_TRAINING_SETUP:"/live-training/vorbereitung",LIVE_TRAINING_DEVICES:"/live-training/geraete",LIVE_TRAINING_SESSION:"/live-training/session",LIVE_TRAINING_PROXY:"/live-training/session-proxy",SCENARIO_TRAINING:"/szenario-training",VIDEO_TRAINING:"/wirkungs-analyse",SMART_BRIEFING:"/smart-briefing",DECISION_BOARD:"/entscheidungs-kompass",RHETORIK_GYM:"/rhetorik-gym",RHETORIK_GYM_SESSION:"/rhetorik-gym/session",HISTORY:"/verlauf",SESSION_DETAIL:"/verlauf/:sessionType/:sessionId",USAGE_LIMITS:"/nutzung",ADMIN:"/admin",ADMIN_ROLEPLAYS:"/admin/szenarien",ADMIN_SIMULATOR:"/admin/simulator",ADMIN_VIDEO:"/admin/video",ADMIN_PARTNERS:"/admin/partner"},QN={overview:te.OVERVIEW,dashboard:te.LIVE_TRAINING,roleplay_variables:te.LIVE_TRAINING_SETUP,roleplay_device_setup:te.LIVE_TRAINING_DEVICES,roleplay:te.LIVE_TRAINING_SESSION,roleplay_proxy:te.LIVE_TRAINING_PROXY,simulator:te.SCENARIO_TRAINING,video_training:te.VIDEO_TRAINING,smart_briefing:te.SMART_BRIEFING,decision_board:te.DECISION_BOARD,history:te.HISTORY,session_detail:te.SESSION_DETAIL,usage_limits:te.USAGE_LIMITS,gym:te.RHETORIK_GYM,gym_klassiker:te.RHETORIK_GYM,gym_session:te.RHETORIK_GYM_SESSION,admin:te.ADMIN,admin_roleplays:te.ADMIN_ROLEPLAYS,admin_simulator:te.ADMIN_SIMULATOR,admin_video:te.ADMIN_VIDEO,admin_partners:te.ADMIN_PARTNERS},Jg={[te.HOME]:"overview",[te.OVERVIEW]:"overview",[te.LIVE_TRAINING]:"dashboard",[te.LIVE_TRAINING_SETUP]:"dashboard",[te.LIVE_TRAINING_DEVICES]:"dashboard",[te.LIVE_TRAINING_SESSION]:"dashboard",[te.LIVE_TRAINING_PROXY]:"dashboard",[te.SCENARIO_TRAINING]:"simulator",[te.VIDEO_TRAINING]:"video_training",[te.SMART_BRIEFING]:"smart_briefing",[te.DECISION_BOARD]:"decision_board",[te.RHETORIK_GYM]:"gym_klassiker",[te.RHETORIK_GYM_SESSION]:"gym_klassiker",[te.HISTORY]:"history",[te.USAGE_LIMITS]:"usage_limits",[te.ADMIN]:"admin",[te.ADMIN_ROLEPLAYS]:"admin_roleplays",[te.ADMIN_SIMULATOR]:"admin_simulator",[te.ADMIN_VIDEO]:"admin_video",[te.ADMIN_PARTNERS]:"admin_partners"};function eD(t){return Jg[t]?Jg[t]:t.startsWith("/verlauf/")?"history":"overview"}function tD({onNavigate:t}){const e=[{id:"admin_roleplays",title:"Live-Simulationen",description:"Verwalten Sie Szenarien fr Live-Voice-Interviews mit KI-Gesprchspartnern.",icon:Ye,color:"text-blue-600",bgColor:"bg-blue-50",stats:null},{id:"admin_simulator",title:"Szenario-Training",description:"Konfigurieren Sie strukturierte Trainingsszenarien mit Fragen und Feedback.",icon:et,color:"text-green-600",bgColor:"bg-green-50",stats:null},{id:"admin_video",title:"Wirkungs-Analyse",description:"Verwalten Sie Video-basierte Wirkungs-Analysen und bungen.",icon:bt,color:"text-purple-600",bgColor:"bg-purple-50",stats:null},{id:"admin_partners",title:"Partner-Branding",description:"White-Label Partner verwalten: Farben, Logos und Modul-Zugriff.",icon:mn,color:"text-orange-600",bgColor:"bg-orange-50",stats:null}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[s.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 shadow-lg",children:s.jsx(Ii,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[var(--text-main)]",children:"Administration"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:"Verwalten Sie Szenarien, Trainings und Partner-Konfigurationen"})]})]}),s.jsx(He,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(ii,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Admin-Bereich"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Dieser Bereich ist nur fr WordPress-Administratoren sichtbar. Hier knnen Sie alle Inhalte und Konfigurationen der Plattform verwalten."})]})]})})}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.map(n=>s.jsx(He,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-[var(--primary-accent)] group",onClick:()=>t(n.id),children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:`p-3 rounded-xl ${n.bgColor} transition-transform group-hover:scale-110`,children:s.jsx(n.icon,{className:`w-6 h-6 ${n.color}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)] group-hover:text-[var(--primary-accent)] transition-colors",children:n.title}),s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mt-1",children:n.description})]})]}),s.jsx(Kt,{className:"w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--primary-accent)] group-hover:translate-x-1 transition-all"})]})})},n.id))}),s.jsxs(He,{children:[s.jsxs(qn,{children:[s.jsx(Rs,{className:"text-lg",children:"Schnellaktionen"}),s.jsx(uv,{children:"Hufig verwendete Admin-Funktionen"})]}),s.jsx(Qe,{children:s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs(ce,{variant:"outline",onClick:()=>t("admin_roleplays"),className:"flex items-center gap-2",children:[s.jsx(Ye,{className:"w-4 h-4"}),"Neues Roleplay erstellen"]}),s.jsxs(ce,{variant:"outline",onClick:()=>t("admin_partners"),className:"flex items-center gap-2",children:[s.jsx(mn,{className:"w-4 h-4"}),"Neuen Partner anlegen"]})]})})]})]})}function gs({title:t,subtitle:e,icon:n,accentColor:i="blue",children:r,defaultExpanded:o=!1,badge:a}){const[l,c]=f.useState(o),[d,u]=f.useState(!1),h={blue:{headerBg:"#e0f2fe",headerBgHover:"#bae6fd",iconBg:"#ffffff",iconText:"#0284c7",titleText:"#075985"},green:{headerBg:"#d1fae5",headerBgHover:"#a7f3d0",iconBg:"#ffffff",iconText:"#059669",titleText:"#065f46"},purple:{headerBg:"#ede9fe",headerBgHover:"#ddd6fe",iconBg:"#ffffff",iconText:"#7c3aed",titleText:"#5b21b6"},orange:{headerBg:"#fef3c7",headerBgHover:"#fde68a",iconBg:"#ffffff",iconText:"#d97706",titleText:"#92400e"},teal:{headerBg:"#ccfbf1",headerBgHover:"#99f6e4",iconBg:"#ffffff",iconText:"#0d9488",titleText:"#115e59"}},p=h[i]||h.blue,m={width:"100%",display:"block",backgroundColor:"#ffffff",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",marginBottom:"0"},x={width:"100%",display:"block",backgroundColor:d?p.headerBgHover:p.headerBg,transition:"background-color 0.2s ease",border:"none",margin:0,padding:0},g={width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",textAlign:"left",cursor:"pointer",border:"none",background:"none",backgroundColor:"transparent",margin:0,outline:"none",fontFamily:"inherit"},y={width:"36px",height:"36px",minWidth:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:p.iconBg,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},v={flex:1,minWidth:0,overflow:"hidden"},k={fontWeight:600,fontSize:"14px",lineHeight:"1.4",display:"block",color:p.titleText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",margin:0,padding:0},S={fontSize:"12px",lineHeight:"1.4",color:"#64748b",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginTop:"2px",padding:0},C={fontSize:"12px",fontWeight:500,color:"#64748b",backgroundColor:"rgba(255,255,255,0.9)",padding:"4px 10px",borderRadius:"9999px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},b={padding:"12px 16px 16px 16px",borderTop:"1px solid #f1f5f9",backgroundColor:"rgba(248, 250, 252, 0.5)"};return s.jsxs(V.div,{style:m,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[s.jsx("div",{style:x,children:s.jsxs("button",{type:"button",onClick:()=>c(!l),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:g,children:[n&&s.jsx("div",{style:y,children:s.jsx(n,{style:{width:"20px",height:"20px",color:p.iconText}})}),s.jsxs("div",{style:v,children:[s.jsx("span",{style:k,children:t}),e&&s.jsx("span",{style:S,children:e})]}),a&&s.jsx("span",{style:C,children:a})]})}),s.jsx(De,{children:l&&s.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsx("div",{style:b,children:r})})})]})}function vv({children:t,className:e}){const n={display:"flex",flexDirection:"column",gap:"12px",width:"100%"};return s.jsx("div",{style:n,className:e,children:t})}function nD({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,k]=f.useState(!1),[S,C]=f.useState({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),[b,j]=f.useState(null);f.useEffect(()=>{w()},[]);const w=async()=>{try{r(!0),a(null);const L=await ue.adminGetRoleplayScenarios();if(L.success)n(L.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(L){a(L.message),T("error","Fehler beim Laden der Szenarien")}finally{r(!1)}},T=(L,ee)=>{j({type:L,message:ee}),setTimeout(()=>j(null),4e3)},I=()=>{C({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),u(!0)},E=L=>{y(L),C({title:L.title||"",description:L.description||"",agent_id:L.agent_id||"",initial_message:L.initial_message||"",difficulty:L.difficulty||"medium",status:L.status||"draft",coaching_hints:L.coaching_hints||"",interviewer_profile:{name:L.interviewer_profile?.name||"",role:L.interviewer_profile?.role||"",properties:L.interviewer_profile?.properties||""}}),p(!0)},P=L=>{y(L),x(!0)},O=async()=>{if(!S.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(k(!0),(await ue.adminCreateRoleplayScenario(S)).success)T("success","Szenario erfolgreich erstellt"),u(!1),w();else throw new Error("Fehler beim Erstellen")}catch(L){T("error",L.message)}finally{k(!1)}},B=async()=>{if(!S.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(k(!0),(await ue.adminUpdateRoleplayScenario(g.id,S)).success)T("success","Szenario erfolgreich aktualisiert"),p(!1),w();else throw new Error("Fehler beim Aktualisieren")}catch(L){T("error",L.message)}finally{k(!1)}},N=async()=>{try{if(k(!0),(await ue.adminDeleteRoleplayScenario(g.id)).success)T("success","Szenario erfolgreich gelscht"),x(!1),w();else throw new Error("Fehler beim Lschen")}catch(L){T("error",L.message)}finally{k(!1)}},M=e.filter(L=>L.title?.toLowerCase().includes(l.toLowerCase())||L.description?.toLowerCase().includes(l.toLowerCase())),F=L=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[L]||L,$=L=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[L]||"bg-gray-100 text-gray-700",D=L=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[L]||L,z=L=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[L]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[b&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?s.jsx(Ut,{className:"w-5 h-5"}):s.jsx(ke,{className:"w-5 h-5"}),b.message,s.jsx("button",{onClick:()=>j(null),className:"ml-2 hover:opacity-80",children:s.jsx(Ot,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(ce,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(yt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(Ye,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Live-Simulationen (Roleplays)"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]}),s.jsxs(ce,{onClick:I,className:"flex items-center gap-2",children:[s.jsx(At,{className:"w-4 h-4"}),"Neues Szenario"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(en,{placeholder:"Szenarien durchsuchen...",value:l,onChange:L=>c(L.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(he,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(He,{className:"border-red-200 bg-red-50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ke,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(ce,{variant:"outline",size:"sm",onClick:w,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:M.length===0?s.jsx(He,{children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Ye,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsx(ce,{onClick:I,className:"mt-4",children:"Erstes Szenario erstellen"})]})})}):M.map(L=>s.jsx(He,{className:"hover:shadow-md transition-shadow",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:L.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${z(L.status)}`,children:D(L.status)}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${$(L.difficulty)}`,children:F(L.difficulty)})]}),L.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:L.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[L.agent_id&&s.jsxs("span",{children:["Agent: ",L.agent_id.substring(0,12),"..."]}),s.jsxs("span",{children:["ID: ",L.id]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>E(L),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(fu,{className:"w-4 h-4"})}),s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>P(L),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(We,{className:"w-4 h-4"})})]})]})})},L.id))}),s.jsx(Xn,{open:d,onOpenChange:u,children:s.jsxs(Zn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Neues Szenario erstellen"}),s.jsx(wi,{children:"Erstellen Sie ein neues Roleplay-Szenario fr Live-Simulationen."})]}),s.jsx(Yg,{formData:S,setFormData:C}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(ce,{onClick:O,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(Xn,{open:h,onOpenChange:p,children:s.jsxs(Zn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Szenario bearbeiten"}),s.jsx(wi,{children:"Bearbeiten Sie das ausgewhlte Roleplay-Szenario."})]}),s.jsx(Yg,{formData:S,setFormData:C}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),s.jsxs(ce,{onClick:B,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(Xn,{open:m,onOpenChange:x,children:s.jsxs(Zn,{children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Szenario lschen"}),s.jsxs(wi,{children:['Sind Sie sicher, dass Sie das Szenario "',g?.title,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),s.jsxs(ce,{variant:"destructive",onClick:N,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function Yg({formData:t,setFormData:e}){return s.jsxs(vv,{children:[s.jsx(gs,{title:"Grundinformationen",subtitle:"Titel, Beschreibung und Basiseinstellungen",icon:Nt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Titel ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(en,{value:t.title,onChange:n=>e({...t,title:n.target.value}),placeholder:"z.B. Vorstellungsgesprch IT-Consultant"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(vi,{value:t.description,onChange:n=>e({...t,description:n.target.value}),placeholder:"Kurze Beschreibung des Szenarios...",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:n=>e({...t,status:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Verffentlicht"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Schwierigkeit"}),s.jsxs("select",{value:t.difficulty,onChange:n=>e({...t,difficulty:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"easy",children:"Einfach"}),s.jsx("option",{value:"medium",children:"Mittel"}),s.jsx("option",{value:"hard",children:"Schwer"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"ElevenLabs Agent ID"}),s.jsx(en,{value:t.agent_id,onChange:n=>e({...t,agent_id:n.target.value}),placeholder:"agent_xxx..."}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Die Agent ID aus Ihrem ElevenLabs Dashboard"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Erste Nachricht"}),s.jsx(vi,{value:t.initial_message,onChange:n=>e({...t,initial_message:n.target.value}),placeholder:"Die erste Nachricht des KI-Gesprchspartners...",rows:3}),s.jsxs("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:["Platzhalter: ","{{user_name}}",", ","{{company_name}}",", ","{{position}}"]})]})]})}),s.jsx(gs,{title:"Gesprchspartner-Profil",subtitle:"Name, Rolle und Eigenschaften des KI-Interviewers",icon:qt,accentColor:"teal",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),s.jsx(en,{value:t.interviewer_profile.name,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,name:n.target.value}}),placeholder:"z.B. Dr. Maria Schmidt"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rolle/Position"}),s.jsx(en,{value:t.interviewer_profile.role,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,role:n.target.value}}),placeholder:"z.B. HR-Leiterin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Eigenschaften"}),s.jsx(vi,{value:t.interviewer_profile.properties,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,properties:n.target.value}}),placeholder:"Charaktereigenschaften (eine pro Zeile)...",rows:3})]})]})}),s.jsx(gs,{title:"Erweiterte Einstellungen",subtitle:"Coaching-Hinweise und zustzliche Konfiguration",icon:ii,accentColor:"purple",children:s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Coaching-Hinweise"}),s.jsx(vi,{value:t.coaching_hints,onChange:n=>e({...t,coaching_hints:n.target.value}),placeholder:"Tipps fr den Benutzer whrend des Gesprchs (eine pro Zeile)...",rows:4}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Diese Hinweise werden im Live-Coaching-Panel angezeigt"})]})})})]})}function iD({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await ue.adminGetSimulatorScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),h=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,p=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(ce,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(yt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:s.jsx(et,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Szenario-Training"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(He,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(un,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Szenario-Training-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=simulator_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(nr,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(en,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(he,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(He,{className:"border-red-200 bg-red-50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ke,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(ce,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(He,{children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(et,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsxs(ce,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=simulator_scenario","_blank"),children:[s.jsx(nr,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>s.jsx(He,{className:"hover:shadow-md transition-shadow",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(g.status)}`,children:h(g.status)}),g.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&s.jsxs("span",{children:["Kategorie: ",g.category]}),g.questions_count&&s.jsxs("span",{children:[g.questions_count," Fragen"]}),s.jsxs("span",{children:["ID: ",g.id]})]})]}),s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(nr,{className:"w-4 h-4"})})]})})},g.id))})]})}function sD({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState("");f.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const g=await ue.adminGetVideoTrainingScenarios();if(g.success)n(g.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(g){a(g.message)}finally{r(!1)}},u=e.filter(g=>g.title?.toLowerCase().includes(l.toLowerCase())||g.description?.toLowerCase().includes(l.toLowerCase())),h=g=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[g]||g,p=g=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[g]||"bg-gray-100 text-gray-700",m=g=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[g]||g,x=g=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[g]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(ce,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(yt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:s.jsx(bt,{className:"w-6 h-6 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Wirkungs-Analyse"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(He,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(un,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Wirkungs-Analyse-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=video_training_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(nr,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(en,{placeholder:"Szenarien durchsuchen...",value:l,onChange:g=>c(g.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(he,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(He,{className:"border-red-200 bg-red-50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ke,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(ce,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(He,{children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(bt,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Wirkungs-Analyse-Szenarien vorhanden"}),!l&&s.jsxs(ce,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=video_training_scenario","_blank"),children:[s.jsx(nr,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(g=>s.jsx(He,{className:"hover:shadow-md transition-shadow",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:g.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(g.status)}`,children:h(g.status)}),g.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x(g.difficulty)}`,children:m(g.difficulty)})]}),g.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:g.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[g.category&&s.jsxs("span",{children:["Kategorie: ",g.category]}),s.jsxs("span",{children:["ID: ",g.id]})]})]}),s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${g.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(nr,{className:"w-4 h-4"})})]})})},g.id))})]})}const rD=[{id:"overview",label:"bersicht"},{id:"dashboard",label:"Dashboard"},{id:"roleplay",label:"Live-Simulation (Roleplay)"},{id:"simulator",label:"Szenario-Training (Simulator)"},{id:"video_training",label:"Wirkungs-Analyse"},{id:"gym",label:"Rhetorik-Gym (Game)"},{id:"history",label:"Verlauf / History"}],Lt={"--app-bg-start":"#f8fafc","--app-bg-mid":"#eff6ff","--app-bg-end":"#f0fdfa","--card-bg-color":"#ffffff","--sidebar-bg-color":"#ffffff","--sidebar-text-color":"#0f172a","--sidebar-text-muted":"#64748b","--sidebar-active-bg":"#E8F4F8","--sidebar-active-text":"#2D6485","--primary-accent":"#3A7FA7","--primary-accent-hover":"#2D6485","--button-solid":"#3A7FA7","--button-text":"#ffffff","--header-gradient-start":"#3A7FA7","--header-gradient-end":"#3DA389","--header-text":"#ffffff","--icon-primary":"#3A7FA7","--icon-secondary":"#3DA389","--icon-muted":"#94a3b8","--text-main":"#0f172a","--text-secondary":"#475569","--text-muted":"#94a3b8","--border-color":"#e2e8f0","--border-color-light":"#f1f5f9","--focus-ring":"rgba(58, 127, 167, 0.3)"},oD=[{id:"app",title:"App / Allgemein",subtitle:"Hintergrundfarben der Anwendung",accentColor:"blue",iconName:"Layout",fields:[{key:"--app-bg-start",label:"App Hintergrund (Start)",type:"color"},{key:"--app-bg-mid",label:"App Hintergrund (Mitte)",type:"color"},{key:"--app-bg-end",label:"App Hintergrund (Ende)",type:"color"},{key:"--card-bg-color",label:"Karten Hintergrund",type:"color"}]},{id:"sidebar",title:"Sidebar",subtitle:"Farben der Seitennavigation",accentColor:"teal",iconName:"PanelLeft",fields:[{key:"--sidebar-bg-color",label:"Sidebar Hintergrund",type:"color"},{key:"--sidebar-text-color",label:"Sidebar Text",type:"color"},{key:"--sidebar-text-muted",label:"Sidebar Text (gedmpft)",type:"color"},{key:"--sidebar-active-bg",label:"Sidebar Aktiv Hintergrund",type:"color"},{key:"--sidebar-active-text",label:"Sidebar Aktiv Text",type:"color"}]},{id:"accent",title:"Akzentfarben",subtitle:"Primre Markenfarben",accentColor:"purple",iconName:"Sparkles",fields:[{key:"--primary-accent",label:"Primrfarbe",type:"color"},{key:"--primary-accent-hover",label:"Primrfarbe (Hover)",type:"color"}]},{id:"buttons",title:"Buttons",subtitle:"Schaltflchenfarben",accentColor:"green",iconName:"Square",fields:[{key:"--button-solid",label:"Button Farbe",type:"color"},{key:"--button-text",label:"Button Text",type:"color"}]},{id:"header",title:"Header",subtitle:"Kopfzeilenfarben",accentColor:"orange",iconName:"PanelTop",fields:[{key:"--header-gradient-start",label:"Header Gradient (Start)",type:"color"},{key:"--header-gradient-end",label:"Header Gradient (Ende)",type:"color"},{key:"--header-text",label:"Header Text",type:"color"}]},{id:"icons",title:"Icons",subtitle:"Symbolfarben",accentColor:"blue",iconName:"Shapes",fields:[{key:"--icon-primary",label:"Icon Primr",type:"color"},{key:"--icon-secondary",label:"Icon Sekundr",type:"color"},{key:"--icon-muted",label:"Icon (gedmpft)",type:"color"}]},{id:"text",title:"Text",subtitle:"Textfarben",accentColor:"teal",iconName:"Type",fields:[{key:"--text-main",label:"Text Hauptfarbe",type:"color"},{key:"--text-secondary",label:"Text Sekundr",type:"color"},{key:"--text-muted",label:"Text (gedmpft)",type:"color"}]},{id:"borders",title:"Rahmen & Focus",subtitle:"Rahmen- und Fokusfarben",accentColor:"purple",iconName:"Frame",fields:[{key:"--border-color",label:"Rahmenfarbe",type:"color"},{key:"--border-color-light",label:"Rahmenfarbe (hell)",type:"color"},{key:"--focus-ring",label:"Focus Ring",type:"color"}]}],aD={Layout:Lj,PanelLeft:zj,Sparkles:St,Square:ks,PanelTop:Oj,Shapes:Fj,Type:Gj,Frame:wj};function lD({onBack:t}){const[e,n]=f.useState([]),[i,r]=f.useState(!0),[o,a]=f.useState(null),[l,c]=f.useState(""),[d,u]=f.useState(!1),[h,p]=f.useState(!1),[m,x]=f.useState(!1),[g,y]=f.useState(null),[v,k]=f.useState(!1),[S,C]=f.useState({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Lt}}),[b,j]=f.useState(null);f.useEffect(()=>{w()},[]);const w=async()=>{try{r(!0),a(null);const z=await ue.adminGetPartners();if(z.success)n(z.data||[]);else throw new Error("Fehler beim Laden der Partner")}catch(z){a(z.message),T("error","Fehler beim Laden der Partner")}finally{r(!1)}},T=(z,L)=>{j({type:z,message:L}),setTimeout(()=>j(null),4e3)},I=()=>{C({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...Lt}}),u(!0)},E=z=>{y(z),C({name:z.name||"",slug:z.slug||"",description:z.description||"",status:z.status||"draft",modules:z.modules||[],branding:{...Lt,...z.branding}}),p(!0)},P=z=>{y(z),x(!0)},O=async()=>{if(!S.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}const z={...S,slug:S.slug||S.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")};try{if(k(!0),(await ue.adminCreatePartner(z)).success)T("success","Partner erfolgreich erstellt"),u(!1),w();else throw new Error("Fehler beim Erstellen")}catch(L){T("error",L.message)}finally{k(!1)}},B=async()=>{if(!S.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}try{if(k(!0),(await ue.adminUpdatePartner(g.id,S)).success)T("success","Partner erfolgreich aktualisiert"),p(!1),w();else throw new Error("Fehler beim Aktualisieren")}catch(z){T("error",z.message)}finally{k(!1)}},N=async()=>{try{if(k(!0),(await ue.adminDeletePartner(g.id)).success)T("success","Partner erfolgreich gelscht"),x(!1),w();else throw new Error("Fehler beim Lschen")}catch(z){T("error",z.message)}finally{k(!1)}},M=z=>{const L=`${window.location.origin}${window.location.pathname}?partner=${z}`;navigator.clipboard.writeText(L),T("success","URL in Zwischenablage kopiert")},F=e.filter(z=>z.name?.toLowerCase().includes(l.toLowerCase())||z.slug?.toLowerCase().includes(l.toLowerCase())),$=z=>({publish:"Aktiv",draft:"Entwurf",pending:"Ausstehend"})[z]||z,D=z=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[z]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[b&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[b.type==="success"?s.jsx(Ut,{className:"w-5 h-5"}):s.jsx(ke,{className:"w-5 h-5"}),b.message,s.jsx("button",{onClick:()=>j(null),className:"ml-2 hover:opacity-80",children:s.jsx(Ot,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(ce,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(yt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-orange-100",children:s.jsx(mn,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Partner-Branding"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Partner"]})]})]})]}),s.jsxs(ce,{onClick:I,className:"flex items-center gap-2",children:[s.jsx(At,{className:"w-4 h-4"}),"Neuer Partner"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(Ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(en,{placeholder:"Partner durchsuchen...",value:l,onChange:z=>c(z.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(he,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(He,{className:"border-red-200 bg-red-50",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ke,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(ce,{variant:"outline",size:"sm",onClick:w,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:F.length===0?s.jsx(He,{children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(mn,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Partner gefunden":"Noch keine Partner vorhanden"}),!l&&s.jsx(ce,{onClick:I,className:"mt-4",children:"Ersten Partner erstellen"})]})})}):F.map(z=>s.jsx(He,{className:"hover:shadow-md transition-shadow",children:s.jsx(Qe,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg border shadow-sm",style:{background:z.branding?.["--primary-accent"]||Lt["--primary-accent"]}}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:z.name}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D(z.status)}`,children:$(z.status)})]}),s.jsxs("p",{className:"text-sm text-[var(--text-muted)]",children:["Slug: ",z.slug]})]})]}),z.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-1",children:z.description}),s.jsx("div",{className:"flex items-center gap-2 text-xs text-[var(--text-muted)]",children:z.modules?.length>0?s.jsxs("span",{children:[z.modules.length," Module aktiv"]}):s.jsx("span",{children:"Alle Module aktiv"})})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>M(z.slug),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"URL kopieren",children:s.jsx(Wc,{className:"w-4 h-4"})}),s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>E(z),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(fu,{className:"w-4 h-4"})}),s.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>P(z),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(We,{className:"w-4 h-4"})})]})]})})},z.id))}),s.jsx(Xn,{open:d,onOpenChange:u,children:s.jsxs(Zn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Neuen Partner erstellen"}),s.jsx(wi,{children:"Erstellen Sie einen neuen White-Label Partner mit eigenem Branding."})]}),s.jsx(Xg,{formData:S,setFormData:C}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(ce,{onClick:O,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(Xn,{open:h,onOpenChange:p,children:s.jsxs(Zn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Partner bearbeiten"}),s.jsx(wi,{children:"Bearbeiten Sie die Konfiguration des ausgewhlten Partners."})]}),s.jsx(Xg,{formData:S,setFormData:C}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),s.jsxs(ce,{onClick:B,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(Xn,{open:m,onOpenChange:x,children:s.jsxs(Zn,{children:[s.jsxs(Qn,{children:[s.jsx(ei,{children:"Partner lschen"}),s.jsxs(wi,{children:['Sind Sie sicher, dass Sie den Partner "',g?.name,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(Ci,{children:[s.jsx(ce,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),s.jsxs(ce,{variant:"destructive",onClick:N,disabled:v,children:[v&&s.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function cD({label:t,value:e,defaultValue:n,onChange:i}){const o=e?.startsWith("rgba")||n?.startsWith("rgba")?"#3A7FA7":e||n||"#000000";return s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"color",value:o,onChange:a=>i(a.target.value),className:"w-10 h-8 rounded border cursor-pointer"}),s.jsx(en,{value:e||"",onChange:a=>i(a.target.value),placeholder:n,className:"flex-1 text-xs"})]})]})}function dD({branding:t}){const e=t?.["--app-bg-start"]||Lt["--app-bg-start"],n=t?.["--app-bg-mid"]||Lt["--app-bg-mid"],i=t?.["--app-bg-end"]||Lt["--app-bg-end"],r=t?.["--card-bg-color"]||Lt["--card-bg-color"],o=t?.["--header-gradient-start"]||Lt["--header-gradient-start"],a=t?.["--header-gradient-end"]||Lt["--header-gradient-end"],l=t?.["--header-text"]||Lt["--header-text"],c=t?.["--text-main"]||Lt["--text-main"],d=t?.["--text-secondary"]||Lt["--text-secondary"],u=t?.["--button-solid"]||Lt["--button-solid"],h=t?.["--button-text"]||Lt["--button-text"],p=t?.["--border-color"]||Lt["--border-color"];return s.jsxs("div",{className:"rounded-lg p-4 mb-4",style:{background:`linear-gradient(135deg, ${e} 0%, ${n} 50%, ${i} 100%)`},children:[s.jsx("div",{className:"rounded-t-lg px-3 py-2 mb-2",style:{background:`linear-gradient(135deg, ${o} 0%, ${a} 100%)`},children:s.jsx("span",{className:"text-xs font-medium",style:{color:l},children:"Header Vorschau"})}),s.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:r,border:`1px solid ${p}`},children:[s.jsx("p",{className:"text-sm font-medium mb-1",style:{color:c},children:"Karten-Titel"}),s.jsx("p",{className:"text-xs mb-3",style:{color:d},children:"Sekundrer Text"}),s.jsx("button",{type:"button",className:"px-3 py-1.5 rounded text-xs font-medium",style:{backgroundColor:u,color:h},children:"Button"})]})]})}function Xg({formData:t,setFormData:e}){const n=r=>{const o=t.modules||[];o.includes(r)?e({...t,modules:o.filter(a=>a!==r)}):e({...t,modules:[...o,r]})},i=(r,o)=>{e({...t,branding:{...t.branding,[r]:o}})};return s.jsxs(vv,{children:[s.jsx(gs,{title:"Grundinformationen",subtitle:"Name, Slug und Status des Partners",icon:Nt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(en,{value:t.name,onChange:r=>e({...t,name:r.target.value}),placeholder:"z.B. Vertriebsakademie Mller"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Slug (URL-ID)"}),s.jsx(en,{value:t.slug,onChange:r=>e({...t,slug:r.target.value.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}),placeholder:"z.B. vertriebsakademie-mueller"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Wird in der URL verwendet: ?partner=",t.slug||"ihr-slug"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(vi,{value:t.description,onChange:r=>e({...t,description:r.target.value}),placeholder:"Optionale Beschreibung des Partners...",rows:2})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:r=>e({...t,status:r.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Aktiv"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]})]})}),s.jsx(gs,{title:"Erlaubte Module",subtitle:"Welche Funktionen fr diesen Partner verfgbar sind",icon:Ej,accentColor:"green",badge:t.modules?.length>0?`${t.modules.length} ausgewhlt`:"Alle",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Keine Auswahl = Alle Module sind erlaubt"}),s.jsx("div",{className:"space-y-2",children:rD.map(r=>s.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 cursor-pointer transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t.modules?.includes(r.id)||!1,onChange:()=>n(r.id),className:"rounded border-gray-300"}),s.jsx("span",{className:"text-sm",children:r.label})]},r.id))})]})}),s.jsxs(gs,{title:"Branding Vorschau",subtitle:"Live-Vorschau der konfigurierten Farben",icon:Dj,accentColor:"orange",defaultExpanded:!0,children:[s.jsx(dD,{branding:t.branding}),s.jsx("p",{className:"text-xs text-slate-500 text-center",children:"ndern Sie die Farben in den Sektionen unten"})]}),oD.map(r=>{const o=aD[r.iconName];return s.jsx(gs,{title:r.title,subtitle:r.subtitle,icon:o,accentColor:r.accentColor,children:s.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.fields.map(a=>s.jsx(cD,{label:a.label,value:t.branding?.[a.key],defaultValue:Lt[a.key],onChange:l=>i(a.key,l)},a.key))})},r.id)})]})}const uD=()=>s.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)",zIndex:9999},children:[s.jsx("div",{style:{position:"absolute",top:"20%",left:"10%",width:"300px",height:"300px",borderRadius:"50%",background:"radial-gradient(circle, rgba(56, 189, 248, 0.1) 0%, transparent 70%)",animation:"float 6s ease-in-out infinite"}}),s.jsx("div",{style:{position:"absolute",bottom:"20%",right:"10%",width:"400px",height:"400px",borderRadius:"50%",background:"radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%)",animation:"float 8s ease-in-out infinite reverse"}}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"32px",zIndex:1},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"24px",background:"linear-gradient(135deg, #38bdf8 0%, #818cf8 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 20px 40px rgba(56, 189, 248, 0.3)",animation:"pulse 2s ease-in-out infinite"},children:s.jsxs("svg",{width:"44",height:"44",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),s.jsx("path",{d:"M2 17l10 5 10-5"}),s.jsx("path",{d:"M2 12l10 5 10-5"})]})}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"white",margin:0,letterSpacing:"-0.02em"},children:"Karriereheld"}),s.jsx("p",{style:{fontSize:"15px",color:"rgba(255, 255, 255, 0.6)",margin:"8px 0 0 0",fontWeight:400},children:"wird geladen..."})]}),s.jsx("div",{style:{width:"200px",height:"4px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"2px",overflow:"hidden"},children:s.jsx("div",{style:{width:"40%",height:"100%",background:"linear-gradient(90deg, #38bdf8, #818cf8, #38bdf8)",backgroundSize:"200% 100%",borderRadius:"2px",animation:"loading 1.5s ease-in-out infinite"}})})]}),s.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
          }
          @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
          }
          @keyframes loading {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(150%); }
            100% { transform: translateX(400%); }
          }
        `})]}),Zg=()=>{requestAnimationFrame(()=>{window.scrollTo(0,0);const t=document.getElementById("bewerbungstrainer-app");t&&(t.scrollTop=0);const e=document.querySelector("[data-main-content]");e&&(e.scrollTop=0),document.querySelectorAll('.overflow-y-auto, .overflow-auto, [style*="overflow"]').forEach(i=>{i.scrollTop>0&&(i.scrollTop=0)})})};function hD(){const t=document.body.classList.contains("admin-bar")||document.documentElement.classList.contains("admin-bar"),e=document.getElementById("wpadminbar");if(e){const n=e.getBoundingClientRect(),i=window.getComputedStyle(e);return!(i.display!=="none"&&i.visibility!=="hidden")||n.bottom<=0?0:n.top<0?Math.max(0,n.bottom):e.offsetHeight}return t?window.innerWidth<=782?46:32:0}function pD(){const t=document.getElementById("bewerbungstrainer-app"),e=hD(),n=document.elementFromPoint(window.innerWidth/2,e+10);if(n){let r=n;for(;r&&r!==document.body;){const o=r.tagName?.toLowerCase();if((o==="header"||o==="nav"||r.classList?.contains("site-header")||r.classList?.contains("elementor-location-header")||r.id==="masthead")&&(!t||!t.contains(r))){const c=r.getBoundingClientRect().bottom;return c<=e?e:Math.max(e,c)}r=r.parentElement}}const i=["header.site-header","#masthead",".site-header",".elementor-location-header",'[data-elementor-type="header"]',".ast-header-wrap","#starter-header",".header-wrapper","header"];for(const r of i){const o=document.querySelector(r);if(o&&(!t||!t.contains(o))){const l=o.getBoundingClientRect().bottom;return l<=e?e:Math.max(e,l)}}if(t){let r=t.previousElementSibling;for(;r;){const o=r.getBoundingClientRect();if(o.height>30&&o.top<100){const a=o.bottom;return a<=e?e:Math.max(e,a)}r=r.previousElementSibling}}return e}function fD(){const t=f1(),e=_d(),{isAuthenticated:n,authLoading:i,isLoading:r,demoCode:o}=Ue(),{isAdmin:a}=Rd(),l=eD(e.pathname),[c,d]=f.useState(0),[u,h]=f.useState(null),[p,m]=f.useState({}),[x,g]=f.useState(null),[y,v]=f.useState("websocket"),[k,S]=f.useState(null),[C,b]=f.useState(null),[j,w]=f.useState(null),[T,I]=f.useState(!1),E=()=>I(!0),P=()=>I(!1),{isOpen:O,closeDisclaimerModal:B,checkDisclaimerStatus:N}=ZN(),[M,F]=f.useState(null),[$,D]=f.useState(null),[z,L]=f.useState(null),[ee,se]=f.useState(null),[G,q]=f.useState(null),[ie,A]=f.useState(null),[W,H]=f.useState(null),[oe,Se]=f.useState(0);f.useEffect(()=>{n&&!i&&N()},[n,i]);const $e=f.useCallback(Q=>{if(Q)switch(Q.type){case"SELECT_ROLEPLAY_SCENARIO":D(Q.scenario),t(te.LIVE_TRAINING);break;case"SELECT_SIMULATOR_SCENARIO":L(Q.scenario),t(te.SCENARIO_TRAINING);break;case"START_GYM_GAME":w(Q.config),t(te.RHETORIK_GYM_SESSION,{state:{gameConfig:Q.config}});break;case"SELECT_GYM_MODE":se(Q.mode),t(te.RHETORIK_GYM);break;case"SELECT_VIDEO_TRAINING_SCENARIO":q(Q.scenario),t(te.VIDEO_TRAINING);break;default:console.warn("Unknown pending action type:",Q.type)}},[t]),Ce=f.useCallback((Q,Re=null)=>n?(Q(),!0):(Re&&F(Re),E(),!1),[n]);f.useEffect(()=>{const Q=()=>{const nt=pD();d(nt)},Re=(nt=0)=>{Q(),nt<5&&setTimeout(()=>Re(nt+1),200)};requestAnimationFrame(()=>{setTimeout(()=>Re(),50)});const fe=()=>setTimeout(Q,100);return window.addEventListener("load",fe),window.addEventListener("resize",Q),window.addEventListener("scroll",Q,{passive:!0}),()=>{window.removeEventListener("load",fe),window.removeEventListener("resize",Q),window.removeEventListener("scroll",Q)}},[]),f.useEffect(()=>{Zg()},[e.pathname]);const rt=f.useCallback(Q=>{Zg(),Q==="video_training"&&Se(fe=>fe+1);const Re=QN[Q];t(Re||te.OVERVIEW)},[t]),me=f.useCallback(Q=>{h(Q),m({}),g(null),t(te.LIVE_TRAINING_SETUP,{state:{scenario:Q}})},[t]),we=f.useCallback(Q=>{m(Q),t(te.LIVE_TRAINING_DEVICES,{state:{scenario:u,variables:Q}})},[t,u]),Xe=f.useCallback(()=>{h(null),m({}),t(te.LIVE_TRAINING)},[t]),Ge=f.useCallback(({selectedMicrophoneId:Q,connectionMode:Re="websocket"})=>{g(Q),v(Re);const fe=Re==="proxy"?te.LIVE_TRAINING_PROXY:te.LIVE_TRAINING_SESSION;t(fe,{state:{scenario:u,variables:p,microphoneId:Q}})},[t,u,p]),dt=f.useCallback(()=>{g(null),t(te.LIVE_TRAINING_SETUP,{state:{scenario:u}})},[t,u]),qe=f.useCallback(()=>{h(null),m({}),t(te.LIVE_TRAINING)},[t]),tt=f.useCallback(Q=>{h(null),m({}),S(Q),t(`/verlauf/${Q.type||"roleplay"}/${Q.id}`,{state:{session:Q}})},[t]),$t=f.useCallback((Q=null)=>{b(Q),t(te.HISTORY,{state:{initialTab:Q}})},[t]),_e=f.useCallback(()=>{b(null),t(te.LIVE_TRAINING)},[t]),Vt=f.useCallback(Q=>{const fe={briefings:Xo.BRIEFINGS,simulator:Xo.SIMULATOR,video:Xo.VIDEO,roleplay:Xo.ROLEPLAY}[Q]||null;b(fe),t(te.HISTORY,{state:{initialTab:fe}})},[t]),jt=f.useCallback(Q=>{S(Q),t(`/verlauf/${Q.type||"roleplay"}/${Q.id}`,{state:{session:Q}})},[t]),ve=f.useCallback(()=>{S(null),t(te.HISTORY)},[t]),de=f.useCallback((Q,Re)=>{A({session:Q,scenario:Re}),t(te.SCENARIO_TRAINING)},[t]),ae=f.useCallback((Q,Re,fe)=>{const nt=fe||Q?.type;nt==="roleplay"?(Re&&D(Re),t(te.LIVE_TRAINING)):nt==="video"?(Re&&q(Re),t(te.VIDEO_TRAINING)):(H({session:Q,scenario:Re}),t(te.SCENARIO_TRAINING))},[t]),ge=f.useCallback(Q=>{w(Q),t(te.RHETORIK_GYM_SESSION,{state:{gameConfig:Q}})},[t]),Y=f.useCallback(()=>{w(null),t(te.RHETORIK_GYM)},[t]),je=f.useCallback(Q=>{},[]),xe=f.useCallback(({children:Q})=>a?Q:s.jsx(Bo,{onNavigate:rt}),[a,rt]);if(r)return s.jsx(uD,{});const ze=()=>e.state?.scenario||u,hn=()=>e.state?.variables||p,ci=()=>e.state?.microphoneId||x,En=()=>e.state?.gameConfig||j,Rn=()=>e.state?.session||k,In=()=>e.state?.initialTab||C,jr=()=>s.jsxs(_1,{children:[s.jsx(ut,{path:"/",element:s.jsx(Bo,{onNavigate:rt})}),s.jsx(ut,{path:te.OVERVIEW,element:s.jsx(Bo,{onNavigate:rt})}),s.jsx(ut,{path:te.LIVE_TRAINING,element:s.jsx(RR,{onSelectScenario:me,onOpenHistory:$t,isAuthenticated:n,requireAuth:Ce,setPendingAction:F,pendingScenario:$,clearPendingScenario:()=>D(null),onNavigateToHistory:()=>Vt("roleplay")})}),s.jsx(ut,{path:te.LIVE_TRAINING_SETUP,element:s.jsx(qR,{scenario:ze(),onBack:Xe,onNext:we})}),s.jsx(ut,{path:te.LIVE_TRAINING_DEVICES,element:s.jsx(UR,{scenario:ze(),onBack:dt,onStart:Ge})}),s.jsx(ut,{path:te.LIVE_TRAINING_SESSION,element:s.jsx(Ag,{scenario:ze(),variables:hn(),selectedMicrophoneId:ci(),connectionMode:Hn.DIRECT,onEnd:qe,onNavigateToSession:tt})}),s.jsx(ut,{path:te.LIVE_TRAINING_PROXY,element:s.jsx(Ag,{scenario:ze(),variables:hn(),selectedMicrophoneId:ci(),connectionMode:Hn.PROXY,onEnd:qe,onNavigateToSession:tt})}),s.jsx(ut,{path:te.SCENARIO_TRAINING,element:s.jsx(P4,{isAuthenticated:n,requireAuth:Ce,setPendingAction:F,pendingContinueSession:ie,clearPendingContinueSession:()=>A(null),pendingRepeatSession:W,clearPendingRepeatSession:()=>H(null),onNavigateToHistory:()=>Vt("simulator")})}),s.jsx(ut,{path:te.VIDEO_TRAINING,element:s.jsx(X4,{isAuthenticated:n,requireAuth:Ce,setPendingAction:F,pendingScenario:G,clearPendingScenario:()=>q(null),onNavigateToHistory:()=>Vt("video")},oe)}),s.jsx(ut,{path:te.SMART_BRIEFING,element:s.jsx(TN,{isAuthenticated:n,requireAuth:Ce,setPendingAction:F,demoCode:o,onNavigateToSimulator:()=>t(te.SCENARIO_TRAINING),onNavigateToHistory:()=>Vt("briefings")})}),s.jsx(ut,{path:te.DECISION_BOARD,element:s.jsx(FN,{isAuthenticated:n,requireAuth:Ce,setPendingAction:F})}),s.jsx(ut,{path:te.RHETORIK_GYM,element:s.jsx(Q4,{onStartGame:ge,isAuthenticated:n,requireAuth:Ce,setPendingAction:F})}),s.jsx(ut,{path:te.RHETORIK_GYM_SESSION,element:s.jsx(aN,{gameConfig:En(),onBack:Y,onComplete:je})}),s.jsx(ut,{path:te.HISTORY,element:s.jsx(x4,{onBack:_e,onSelectSession:jt,isAuthenticated:n,onLoginClick:E,onContinueSession:de,onRepeatSession:ae,initialTab:In(),onNavigateToModule:rt})}),s.jsx(ut,{path:"/verlauf/:sessionType/:sessionId",element:s.jsx(y4,{session:Rn(),onBack:ve,onRepeatSession:ae})}),s.jsx(ut,{path:te.USAGE_LIMITS,element:s.jsx("div",{style:{padding:"24px",maxWidth:"600px",margin:"0 auto"},children:s.jsx(WN,{onNavigateToRoleplay:()=>t(te.LIVE_TRAINING)})})}),s.jsx(ut,{path:te.ADMIN,element:s.jsx(xe,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(tD,{onNavigate:rt})})})}),s.jsx(ut,{path:te.ADMIN_ROLEPLAYS,element:s.jsx(xe,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(nD,{onBack:()=>t(te.ADMIN)})})})}),s.jsx(ut,{path:te.ADMIN_SIMULATOR,element:s.jsx(xe,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(iD,{onBack:()=>t(te.ADMIN)})})})}),s.jsx(ut,{path:te.ADMIN_VIDEO,element:s.jsx(xe,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(sD,{onBack:()=>t(te.ADMIN)})})})}),s.jsx(ut,{path:te.ADMIN_PARTNERS,element:s.jsx(xe,{children:s.jsx("div",{style:{padding:"24px"},children:s.jsx(lD,{onBack:()=>t(te.ADMIN)})})})}),s.jsx(ut,{path:"*",element:s.jsx(Bo,{onNavigate:rt})})]});return s.jsxs(s.Fragment,{children:[s.jsx(qN,{activeView:l,onNavigate:rt,headerOffset:c,onLoginClick:E,children:jr()}),s.jsx(YN,{isOpen:T,onClose:()=>{P(),F(null)},onLoginSuccess:async Q=>{await N(),M&&($e(M),F(null))}}),s.jsx(XN,{isOpen:O,onClose:B,onAcknowledge:Q=>{B()}})]})}function gD(){return s.jsx(N1,{children:s.jsx(Dv,{children:s.jsx(VN,{children:s.jsx(fD,{})})})})}let mc=!1,xc=null;function mD(){if(mc)return;const t=document.getElementById("bewerbungstrainer-app")||document.getElementById("root");if(!t){console.error(" Bewerbungstrainer: Root element not found! Looking for #bewerbungstrainer-app or #root");return}if(t._reactRootContainer||t.__reactRoot||xc){console.warn(" Bewerbungstrainer: Root element already has a React root, skipping re-mount..."),mc=!0;return}try{for(;t.firstChild;)t.removeChild(t.firstChild);xc=zv.createRoot(t),xc.render(s.jsx(f.StrictMode,{children:s.jsx(gD,{})})),mc=!0}catch(e){console.error(" Bewerbungstrainer: Failed to mount React app:",e)}}function xD(){const t=()=>{requestAnimationFrame(()=>{try{mD()}catch(e){console.error(" Bewerbungstrainer: Error during mount:",e)}})};if(document.getElementById("bewerbungstrainer-app")||document.getElementById("root")){setTimeout(t,50);return}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>setTimeout(t,50));else{let e=0;const n=50,i=setInterval(()=>{e++,document.getElementById("bewerbungstrainer-app")||document.getElementById("root")?(clearInterval(i),setTimeout(t,50)):e>=n&&(clearInterval(i),console.error(" Bewerbungstrainer: Element not found after 5 seconds"))},100)}}xD();
