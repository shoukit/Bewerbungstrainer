import{r as g,j as s,c as ee,u as ge,D as Q,T as Os,a as Vt,S as st,V as ht,C as x,R as Rf,g as Hy,b as Ky,w as fe,d as Pn,e as mt,U as xt,f as un,B as Qt,L as ye,h as se,A as Dt,i as Ce,k as Rt,M as Xe,l as Zt,m as Si,n as Ei,o as Es,p as It,q as ta,s as Io,G as Zd,t as Ec,P as Yy,v as Jy}from"./wordpress-api-4gBPuadg.js";const Rc=g.createContext({});function Ic(t){const e=g.useRef(null);return e.current===null&&(e.current=t()),e.current}const _c=typeof window<"u",If=_c?g.useLayoutEffect:g.useEffect,na=g.createContext(null);function Nc(t,e){t.indexOf(e)===-1&&t.push(e)}function Ac(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Xn=(t,e,n)=>n>e?e:n<t?t:n;let Pc=()=>{};const Zn={},_f=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function Nf(t){return typeof t=="object"&&t!==null}const Af=t=>/^0[^.\s]+$/u.test(t);function Mc(t){let e;return()=>(e===void 0&&(e=t()),e)}const ln=t=>t,Xy=(t,e)=>n=>e(t(n)),Mr=(...t)=>t.reduce(Xy),gr=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i};class Dc{constructor(){this.subscriptions=[]}add(e){return Nc(this.subscriptions,e),()=>Ac(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const _n=t=>t*1e3,rn=t=>t/1e3;function Pf(t,e){return e?t*(1e3/e):0}const Mf=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,Zy=1e-7,Qy=12;function eb(t,e,n,i,r){let o,a,l=0;do a=e+(n-e)/2,o=Mf(a,i,r)-t,o>0?n=a:e=a;while(Math.abs(o)>Zy&&++l<Qy);return a}function Dr(t,e,n,i){if(t===e&&n===i)return ln;const r=o=>eb(o,0,1,t,n);return o=>o===0||o===1?o:Mf(r(o),e,i)}const Df=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Of=t=>e=>1-t(1-e),Lf=Dr(.33,1.53,.69,.99),Oc=Of(Lf),Ff=Df(Oc),Bf=t=>(t*=2)<1?.5*Oc(t):.5*(2-Math.pow(2,-10*(t-1))),Lc=t=>1-Math.sin(Math.acos(t)),zf=Of(Lc),Uf=Df(Lc),tb=Dr(.42,0,1,1),nb=Dr(0,0,.58,1),Wf=Dr(.42,0,.58,1),ib=t=>Array.isArray(t)&&typeof t[0]!="number",Vf=t=>Array.isArray(t)&&typeof t[0]=="number",sb={linear:ln,easeIn:tb,easeInOut:Wf,easeOut:nb,circIn:Lc,circInOut:Uf,circOut:zf,backIn:Oc,backInOut:Ff,backOut:Lf,anticipate:Bf},rb=t=>typeof t=="string",Qd=t=>{if(Vf(t)){Pc(t.length===4);const[e,n,i,r]=t;return Dr(e,n,i,r)}else if(rb(t))return sb[t];return t},Gr=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function ob(t,e){let n=new Set,i=new Set,r=!1,o=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){a.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,h=!1,p=!1)=>{const y=p&&r?n:i;return h&&a.add(u),y.has(u)||y.add(u),u},cancel:u=>{i.delete(u),a.delete(u)},process:u=>{if(l=u,r){o=!0;return}r=!0,[n,i]=[i,n],n.forEach(c),n.clear(),r=!1,o&&(o=!1,d.process(u))}};return d}const ab=40;function $f(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Gr.reduce((j,w)=>(j[w]=ob(o),j),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:y}=a,f=()=>{const j=Zn.useManualTiming?r.timestamp:performance.now();n=!1,Zn.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(j-r.timestamp,ab),1)),r.timestamp=j,r.isProcessing=!0,l.process(r),c.process(r),d.process(r),u.process(r),h.process(r),p.process(r),m.process(r),y.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(f))},b=()=>{n=!0,i=!0,r.isProcessing||t(f)};return{schedule:Gr.reduce((j,w)=>{const v=a[w];return j[w]=(E,k=!1,T=!1)=>(n||b(),v.schedule(E,k,T)),j},{}),cancel:j=>{for(let w=0;w<Gr.length;w++)a[Gr[w]].cancel(j)},state:r,steps:a}}const{schedule:qe,cancel:ki,state:kt,steps:Ca}=$f(typeof requestAnimationFrame<"u"?requestAnimationFrame:ln,!0);let ao;function lb(){ao=void 0}const zt={now:()=>(ao===void 0&&zt.set(kt.isProcessing||Zn.useManualTiming?kt.timestamp:performance.now()),ao),set:t=>{ao=t,queueMicrotask(lb)}},Gf=t=>e=>typeof e=="string"&&e.startsWith(t),Fc=Gf("--"),cb=Gf("var(--"),Bc=t=>cb(t)?db.test(t.split("/*")[0].trim()):!1,db=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Ls={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},mr={...Ls,transform:t=>Xn(0,1,t)},qr={...Ls,default:1},nr=t=>Math.round(t*1e5)/1e5,zc=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ub(t){return t==null}const hb=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Uc=(t,e)=>n=>!!(typeof n=="string"&&hb.test(n)&&n.startsWith(t)||e&&!ub(n)&&Object.prototype.hasOwnProperty.call(n,e)),qf=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,o,a,l]=i.match(zc);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},pb=t=>Xn(0,255,t),ja={...Ls,transform:t=>Math.round(pb(t))},Oi={test:Uc("rgb","red"),parse:qf("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+ja.transform(t)+", "+ja.transform(e)+", "+ja.transform(n)+", "+nr(mr.transform(i))+")"};function fb(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const kl={test:Uc("#"),parse:fb,transform:Oi.transform},Or=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),di=Or("deg"),Nn=Or("%"),ue=Or("px"),gb=Or("vh"),mb=Or("vw"),eu={...Nn,parse:t=>Nn.parse(t)/100,transform:t=>Nn.transform(t*100)},rs={test:Uc("hsl","hue"),parse:qf("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+Nn.transform(nr(e))+", "+Nn.transform(nr(n))+", "+nr(mr.transform(i))+")"},at={test:t=>Oi.test(t)||kl.test(t)||rs.test(t),parse:t=>Oi.test(t)?Oi.parse(t):rs.test(t)?rs.parse(t):kl.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Oi.transform(t):rs.transform(t),getAnimatableNone:t=>{const e=at.parse(t);return e.alpha=0,at.transform(e)}},xb=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function yb(t){return isNaN(t)&&typeof t=="string"&&(t.match(zc)?.length||0)+(t.match(xb)?.length||0)>0}const Hf="number",Kf="color",bb="var",vb="var(",tu="${}",Sb=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function xr(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const l=e.replace(Sb,c=>(at.test(c)?(i.color.push(o),r.push(Kf),n.push(at.parse(c))):c.startsWith(vb)?(i.var.push(o),r.push(bb),n.push(c)):(i.number.push(o),r.push(Hf),n.push(parseFloat(c))),++o,tu)).split(tu);return{values:n,split:l,indexes:i,types:r}}function Yf(t){return xr(t).values}function Jf(t){const{split:e,types:n}=xr(t),i=e.length;return r=>{let o="";for(let a=0;a<i;a++)if(o+=e[a],r[a]!==void 0){const l=n[a];l===Hf?o+=nr(r[a]):l===Kf?o+=at.transform(r[a]):o+=r[a]}return o}}const kb=t=>typeof t=="number"?0:at.test(t)?at.getAnimatableNone(t):t;function wb(t){const e=Yf(t);return Jf(t)(e.map(kb))}const wi={test:yb,parse:Yf,createTransformer:Jf,getAnimatableNone:wb};function Ta(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function Cb({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,o=0,a=0;if(!e)r=o=a=n;else{const l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=Ta(c,l,t+1/3),o=Ta(c,l,t),a=Ta(c,l,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:i}}function _o(t,e){return n=>n>0?e:t}const Je=(t,e,n)=>t+(e-t)*n,Ea=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},jb=[kl,Oi,rs],Tb=t=>jb.find(e=>e.test(t));function nu(t){const e=Tb(t);if(!e)return!1;let n=e.parse(t);return e===rs&&(n=Cb(n)),n}const iu=(t,e)=>{const n=nu(t),i=nu(e);if(!n||!i)return _o(t,e);const r={...n};return o=>(r.red=Ea(n.red,i.red,o),r.green=Ea(n.green,i.green,o),r.blue=Ea(n.blue,i.blue,o),r.alpha=Je(n.alpha,i.alpha,o),Oi.transform(r))},wl=new Set(["none","hidden"]);function Eb(t,e){return wl.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function Rb(t,e){return n=>Je(t,e,n)}function Wc(t){return typeof t=="number"?Rb:typeof t=="string"?Bc(t)?_o:at.test(t)?iu:Nb:Array.isArray(t)?Xf:typeof t=="object"?at.test(t)?iu:Ib:_o}function Xf(t,e){const n=[...t],i=n.length,r=t.map((o,a)=>Wc(o)(o,e[a]));return o=>{for(let a=0;a<i;a++)n[a]=r[a](o);return n}}function Ib(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=Wc(t[r])(t[r],e[r]));return r=>{for(const o in i)n[o]=i[o](r);return n}}function _b(t,e){const n=[],i={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const o=e.types[r],a=t.indexes[o][i[o]],l=t.values[a]??0;n[r]=l,i[o]++}return n}const Nb=(t,e)=>{const n=wi.createTransformer(e),i=xr(t),r=xr(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?wl.has(t)&&!r.values.length||wl.has(e)&&!i.values.length?Eb(t,e):Mr(Xf(_b(i,r),r.values),n):_o(t,e)};function Zf(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?Je(t,e,n):Wc(t)(t,e)}const Ab=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>qe.update(e,n),stop:()=>ki(e),now:()=>kt.isProcessing?kt.timestamp:zt.now()}},Qf=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let o=0;o<r;o++)i+=Math.round(t(o/(r-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},No=2e4;function Vc(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<No;)e+=n,i=t.next(e);return e>=No?1/0:e}function Pb(t,e=100,n){const i=n({...t,keyframes:[0,e]}),r=Math.min(Vc(i),No);return{type:"keyframes",ease:o=>i.next(r*o).value/e,duration:rn(r)}}const Mb=5;function eg(t,e,n){const i=Math.max(e-Mb,0);return Pf(n-t(i),e-i)}const et={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Ra=.001;function Db({duration:t=et.duration,bounce:e=et.bounce,velocity:n=et.velocity,mass:i=et.mass}){let r,o,a=1-e;a=Xn(et.minDamping,et.maxDamping,a),t=Xn(et.minDuration,et.maxDuration,rn(t)),a<1?(r=d=>{const u=d*a,h=u*t,p=u-n,m=Cl(d,a),y=Math.exp(-h);return Ra-p/m*y},o=d=>{const h=d*a*t,p=h*n+n,m=Math.pow(a,2)*Math.pow(d,2)*t,y=Math.exp(-h),f=Cl(Math.pow(d,2),a);return(-r(d)+Ra>0?-1:1)*((p-m)*y)/f}):(r=d=>{const u=Math.exp(-d*t),h=(d-n)*t+1;return-Ra+u*h},o=d=>{const u=Math.exp(-d*t),h=(n-d)*(t*t);return u*h});const l=5/t,c=Lb(r,o,l);if(t=_n(t),isNaN(c))return{stiffness:et.stiffness,damping:et.damping,duration:t};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:a*2*Math.sqrt(i*d),duration:t}}}const Ob=12;function Lb(t,e,n){let i=n;for(let r=1;r<Ob;r++)i=i-t(i)/e(i);return i}function Cl(t,e){return t*Math.sqrt(1-e*e)}const Fb=["duration","bounce"],Bb=["stiffness","damping","mass"];function su(t,e){return e.some(n=>t[n]!==void 0)}function zb(t){let e={velocity:et.velocity,stiffness:et.stiffness,damping:et.damping,mass:et.mass,isResolvedFromDuration:!1,...t};if(!su(t,Bb)&&su(t,Fb))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,o=2*Xn(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:et.mass,stiffness:r,damping:o}}else{const n=Db(t);e={...e,...n,mass:et.mass},e.isResolvedFromDuration=!0}return e}function Ao(t=et.visualDuration,e=et.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=zb({...n,velocity:-rn(n.velocity||0)}),y=p||0,f=d/(2*Math.sqrt(c*u)),b=a-o,S=rn(Math.sqrt(c/u)),C=Math.abs(b)<5;i||(i=C?et.restSpeed.granular:et.restSpeed.default),r||(r=C?et.restDelta.granular:et.restDelta.default);let j;if(f<1){const v=Cl(S,f);j=E=>{const k=Math.exp(-f*S*E);return a-k*((y+f*S*b)/v*Math.sin(v*E)+b*Math.cos(v*E))}}else if(f===1)j=v=>a-Math.exp(-S*v)*(b+(y+S*b)*v);else{const v=S*Math.sqrt(f*f-1);j=E=>{const k=Math.exp(-f*S*E),T=Math.min(v*E,300);return a-k*((y+f*S*b)*Math.sinh(T)+v*b*Math.cosh(T))/v}}const w={calculatedDuration:m&&h||null,next:v=>{const E=j(v);if(m)l.done=v>=h;else{let k=v===0?y:0;f<1&&(k=v===0?_n(y):eg(j,v,E));const T=Math.abs(k)<=i,N=Math.abs(a-E)<=r;l.done=T&&N}return l.value=l.done?a:E,l},toString:()=>{const v=Math.min(Vc(w),No),E=Qf(k=>w.next(v*k).value,v,30);return v+"ms "+E},toTransition:()=>{}};return w}Ao.applyToOptions=t=>{const e=Pb(t,100,Ao);return t.ease=e.ease,t.duration=_n(e.duration),t.type="keyframes",t};function jl({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=t[0],p={done:!1,value:h},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,y=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let f=n*e;const b=h+f,S=a===void 0?b:a(b);S!==b&&(f=S-h);const C=T=>-f*Math.exp(-T/i),j=T=>S+C(T),w=T=>{const N=C(T),R=j(T);p.done=Math.abs(N)<=d,p.value=p.done?S:R};let v,E;const k=T=>{m(p.value)&&(v=T,E=Ao({keyframes:[p.value,y(p.value)],velocity:eg(j,T,p.value),damping:r,stiffness:o,restDelta:d,restSpeed:u}))};return k(0),{calculatedDuration:null,next:T=>{let N=!1;return!E&&v===void 0&&(N=!0,w(T),k(T)),v!==void 0&&T>=v?E.next(T-v):(!N&&w(T),p)}}}function Ub(t,e,n){const i=[],r=n||Zn.mix||Zf,o=t.length-1;for(let a=0;a<o;a++){let l=r(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||ln:e;l=Mr(c,l)}i.push(l)}return i}function Wb(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const o=t.length;if(Pc(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=Ub(e,i,r),c=l.length,d=u=>{if(a&&u<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const p=gr(t[h],t[h+1],u);return l[h](p)};return n?u=>d(Xn(t[0],t[o-1],u)):d}function Vb(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=gr(0,e,i);t.push(Je(n,1,r))}}function $b(t){const e=[0];return Vb(e,t.length-1),e}function Gb(t,e){return t.map(n=>n*e)}function qb(t,e){return t.map(()=>e||Wf).splice(0,t.length-1)}function ir({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=ib(i)?i.map(Qd):Qd(i),o={done:!1,value:e[0]},a=Gb(n&&n.length===e.length?n:$b(e),t),l=Wb(a,e,{ease:Array.isArray(r)?r:qb(e,r)});return{calculatedDuration:t,next:c=>(o.value=l(c),o.done=c>=t,o)}}const Hb=t=>t!==null;function $c(t,{repeat:e,repeatType:n="loop"},i,r=1){const o=t.filter(Hb),l=r<0||e&&n!=="loop"&&e%2===1?0:o.length-1;return!l||i===void 0?o[l]:i}const Kb={decay:jl,inertia:jl,tween:ir,keyframes:ir,spring:Ao};function tg(t){typeof t.type=="string"&&(t.type=Kb[t.type])}class Gc{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const Yb=t=>t/100;class qc extends Gc{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==zt.now()&&this.tick(zt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;tg(e);const{type:n=ir,repeat:i=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=e;let{keyframes:l}=e;const c=n||ir;c!==ir&&typeof l[0]!="number"&&(this.mixKeyframes=Mr(Yb,Zf(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=Vc(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(i+1)-r,this.generator=d}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:i,totalDuration:r,mixKeyframes:o,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:y,onUpdate:f,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const S=this.currentTime-d*(this.playbackSpeed>=0?1:-1),C=this.playbackSpeed>=0?S<0:S>r;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let j=this.currentTime,w=i;if(h){const T=Math.min(this.currentTime,r)/l;let N=Math.floor(T),R=T%1;!R&&T>=1&&(R=1),R===1&&N--,N=Math.min(N,h+1),!!(N%2)&&(p==="reverse"?(R=1-R,m&&(R-=m/l)):p==="mirror"&&(w=a)),j=Xn(0,1,R)*l}const v=C?{done:!1,value:u[0]}:w.next(j);o&&(v.value=o(v.value));let{done:E}=v;!C&&c!==null&&(E=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const k=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&E);return k&&y!==jl&&(v.value=$c(u,this.options,b,this.speed)),f&&f(v.value),k&&this.finish(),v}then(e,n){return this.finished.then(e,n)}get duration(){return rn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+rn(e)}get time(){return rn(this.currentTime)}set time(e){e=_n(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(zt.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=rn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=Ab,startTime:n}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(zt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function Jb(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Li=t=>t*180/Math.PI,Tl=t=>{const e=Li(Math.atan2(t[1],t[0]));return El(e)},Xb={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Tl,rotateZ:Tl,skewX:t=>Li(Math.atan(t[1])),skewY:t=>Li(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},El=t=>(t=t%360,t<0&&(t+=360),t),ru=Tl,ou=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),au=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),Zb={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ou,scaleY:au,scale:t=>(ou(t)+au(t))/2,rotateX:t=>El(Li(Math.atan2(t[6],t[5]))),rotateY:t=>El(Li(Math.atan2(-t[2],t[0]))),rotateZ:ru,rotate:ru,skewX:t=>Li(Math.atan(t[4])),skewY:t=>Li(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Rl(t){return t.includes("scale")?1:0}function Il(t,e){if(!t||t==="none")return Rl(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=Zb,r=n;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=Xb,r=l}if(!r)return Rl(e);const o=i[e],a=r[1].split(",").map(ev);return typeof o=="function"?o(a):a[o]}const Qb=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return Il(n,e)};function ev(t){return parseFloat(t.trim())}const Fs=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Bs=new Set(Fs),lu=t=>t===Ls||t===ue,tv=new Set(["x","y","z"]),nv=Fs.filter(t=>!tv.has(t));function iv(t){const e=[];return nv.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const Bi={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Il(e,"x"),y:(t,{transform:e})=>Il(e,"y")};Bi.translateX=Bi.x;Bi.translateY=Bi.y;const zi=new Set;let _l=!1,Nl=!1,Al=!1;function ng(){if(Nl){const t=Array.from(zi).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=iv(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([o,a])=>{i.getValue(o)?.set(a)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Nl=!1,_l=!1,zi.forEach(t=>t.complete(Al)),zi.clear()}function ig(){zi.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Nl=!0)})}function sv(){Al=!0,ig(),ng(),Al=!1}class Hc{constructor(e,n,i,r,o,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(zi.add(this),_l||(_l=!0,qe.read(ig),qe.resolveKeyframes(ng))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;if(e[0]===null){const o=r?.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const l=i.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}Jb(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),zi.delete(this)}cancel(){this.state==="scheduled"&&(zi.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const rv=t=>t.startsWith("--");function ov(t,e,n){rv(e)?t.style.setProperty(e,n):t.style[e]=n}const av=Mc(()=>window.ScrollTimeline!==void 0),lv={};function cv(t,e){const n=Mc(t);return()=>lv[e]??n()}const sg=cv(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Zs=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,cu={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Zs([0,.65,.55,1]),circOut:Zs([.55,0,1,.45]),backIn:Zs([.31,.01,.66,-.59]),backOut:Zs([.33,1.53,.69,.99])};function rg(t,e){if(t)return typeof t=="function"?sg()?Qf(t,e):"ease-out":Vf(t)?Zs(t):Array.isArray(t)?t.map(n=>rg(n,e)||cu.easeOut):cu[t]}function dv(t,e,n,{delay:i=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:n};c&&(u.offset=c);const h=rg(l,r);Array.isArray(h)&&(u.easing=h);const p={delay:i,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),t.animate(u,p)}function og(t){return typeof t=="function"&&"applyToOptions"in t}function uv({type:t,...e}){return og(t)&&sg()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class hv extends Gc{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:i,keyframes:r,pseudoElement:o,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!o,this.allowFlatten=a,this.options=e,Pc(typeof e.type!="string");const d=uv(e);this.animation=dv(n,i,r,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=$c(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):ov(n,i,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return rn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+rn(e)}get time(){return rn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=_n(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&av()?(this.animation.timeline=e,ln):n(this)}}const ag={anticipate:Bf,backInOut:Ff,circInOut:Uf};function pv(t){return t in ag}function fv(t){typeof t.ease=="string"&&pv(t.ease)&&(t.ease=ag[t.ease])}const du=10;class gv extends hv{constructor(e){fv(e),tg(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:i,onComplete:r,element:o,...a}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const l=new qc({...a,autoplay:!1}),c=_n(this.finishedTime??this.time);n.setWithVelocity(l.sample(c-du).value,l.sample(c).value,du),l.stop()}}const uu=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(wi.test(t)||t==="0")&&!t.startsWith("url("));function mv(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function xv(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=uu(r,e),l=uu(o,e);return!a||!l?!1:mv(t)||(n==="spring"||og(n))&&i}function Pl(t){t.duration=0,t.type="keyframes"}const yv=new Set(["opacity","clipPath","filter","transform"]),bv=Mc(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function vv(t){const{motionValue:e,name:n,repeatDelay:i,repeatType:r,damping:o,type:a}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return bv()&&n&&yv.has(n)&&(n!=="transform"||!d)&&!c&&!i&&r!=="mirror"&&o!==0&&a!=="inertia"}const Sv=40;class kv extends Gc{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=zt.now();const p={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:o,repeatType:a,name:c,motionValue:d,element:u,...h},m=u?.KeyframeResolver||Hc;this.keyframeResolver=new m(l,(y,f,b)=>this.onKeyframesResolved(y,f,p,!b),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,n,i,r){this.keyframeResolver=void 0;const{name:o,type:a,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=zt.now(),xv(e,o,a,l)||((Zn.instantAnimations||!c)&&u?.($c(e,i,n)),e[0]=e[e.length-1],Pl(i),i.repeat=0);const p={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>Sv?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:e},m=!d&&vv(p)?new gv({...p,element:p.motionValue.owner.current}):new qc(p);m.finished.then(()=>this.notifyFinished()).catch(ln),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),sv()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const wv=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Cv(t){const e=wv.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function lg(t,e,n=1){const[i,r]=Cv(t);if(!i)return;const o=window.getComputedStyle(e).getPropertyValue(i);if(o){const a=o.trim();return _f(a)?parseFloat(a):a}return Bc(r)?lg(r,e,n+1):r}function Kc(t,e){return t?.[e]??t?.default??t}const cg=new Set(["width","height","top","left","right","bottom",...Fs]),jv={test:t=>t==="auto",parse:t=>t},dg=t=>e=>e.test(t),ug=[Ls,ue,Nn,di,mb,gb,jv],hu=t=>ug.find(dg(t));function Tv(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||Af(t):!0}const Ev=new Set(["brightness","contrast","saturate","opacity"]);function Rv(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(zc)||[];if(!i)return t;const r=n.replace(i,"");let o=Ev.has(e)?1:0;return i!==n&&(o*=100),e+"("+o+r+")"}const Iv=/\b([a-z-]*)\(.*?\)/gu,Ml={...wi,getAnimatableNone:t=>{const e=t.match(Iv);return e?e.map(Rv).join(" "):t}},pu={...Ls,transform:Math.round},_v={rotate:di,rotateX:di,rotateY:di,rotateZ:di,scale:qr,scaleX:qr,scaleY:qr,scaleZ:qr,skew:di,skewX:di,skewY:di,distance:ue,translateX:ue,translateY:ue,translateZ:ue,x:ue,y:ue,z:ue,perspective:ue,transformPerspective:ue,opacity:mr,originX:eu,originY:eu,originZ:ue},Yc={borderWidth:ue,borderTopWidth:ue,borderRightWidth:ue,borderBottomWidth:ue,borderLeftWidth:ue,borderRadius:ue,radius:ue,borderTopLeftRadius:ue,borderTopRightRadius:ue,borderBottomRightRadius:ue,borderBottomLeftRadius:ue,width:ue,maxWidth:ue,height:ue,maxHeight:ue,top:ue,right:ue,bottom:ue,left:ue,padding:ue,paddingTop:ue,paddingRight:ue,paddingBottom:ue,paddingLeft:ue,margin:ue,marginTop:ue,marginRight:ue,marginBottom:ue,marginLeft:ue,backgroundPositionX:ue,backgroundPositionY:ue,..._v,zIndex:pu,fillOpacity:mr,strokeOpacity:mr,numOctaves:pu},Nv={...Yc,color:at,backgroundColor:at,outlineColor:at,fill:at,stroke:at,borderColor:at,borderTopColor:at,borderRightColor:at,borderBottomColor:at,borderLeftColor:at,filter:Ml,WebkitFilter:Ml},hg=t=>Nv[t];function pg(t,e){let n=hg(t);return n!==Ml&&(n=wi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Av=new Set(["auto","none","0"]);function Pv(t,e,n){let i=0,r;for(;i<t.length&&!r;){const o=t[i];typeof o=="string"&&!Av.has(o)&&xr(o).values.length&&(r=t[i]),i++}if(r&&n)for(const o of e)t[o]=pg(n,r)}class Mv extends Hc{constructor(e,n,i,r,o){super(e,n,i,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),Bc(d))){const u=lg(d,n.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!cg.has(i)||e.length!==2)return;const[r,o]=e,a=hu(r),l=hu(o);if(a!==l)if(lu(a)&&lu(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else Bi[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)(e[r]===null||Tv(e[r]))&&i.push(r);i.length&&Pv(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Bi[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){const{element:e,name:n,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const r=e.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,a=i[o];i[o]=Bi[n](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function Dv(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const r=n?.[t]??i.querySelectorAll(t);return r?Array.from(r):[]}return Array.from(t)}const fg=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function gg(t){return Nf(t)&&"offsetHeight"in t}const fu=30,Ov=t=>!isNaN(parseFloat(t));class Lv{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const r=zt.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=zt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Ov(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Dc);const i=this.events[e].add(n);return e==="change"?()=>{i(),qe.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=zt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>fu)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,fu);return Pf(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Rs(t,e){return new Lv(t,e)}const{schedule:Jc}=$f(queueMicrotask,!1),mn={x:!1,y:!1};function mg(){return mn.x||mn.y}function Fv(t){return t==="x"||t==="y"?mn[t]?null:(mn[t]=!0,()=>{mn[t]=!1}):mn.x||mn.y?null:(mn.x=mn.y=!0,()=>{mn.x=mn.y=!1})}function xg(t,e){const n=Dv(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function gu(t){return!(t.pointerType==="touch"||mg())}function Bv(t,e,n={}){const[i,r,o]=xg(t,n),a=l=>{if(!gu(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=h=>{gu(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,r)};return i.forEach(l=>{l.addEventListener("pointerenter",a,r)}),o}const yg=(t,e)=>e?t===e?!0:yg(t,e.parentElement):!1,Xc=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,zv=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Uv(t){return zv.has(t.tagName)||t.tabIndex!==-1}const lo=new WeakSet;function mu(t){return e=>{e.key==="Enter"&&t(e)}}function Ia(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Wv=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=mu(()=>{if(lo.has(n))return;Ia(n,"down");const r=mu(()=>{Ia(n,"up")}),o=()=>Ia(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function xu(t){return Xc(t)&&!mg()}function Vv(t,e,n={}){const[i,r,o]=xg(t,n),a=l=>{const c=l.currentTarget;if(!xu(l))return;lo.add(c);const d=e(c,l),u=(m,y)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),lo.has(c)&&lo.delete(c),xu(m)&&typeof d=="function"&&d(m,{success:y})},h=m=>{u(m,c===window||c===document||n.useGlobalTarget||yg(c,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",p,r)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",a,r),gg(l)&&(l.addEventListener("focus",d=>Wv(d,r)),!Uv(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function bg(t){return Nf(t)&&"ownerSVGElement"in t}function $v(t){return bg(t)&&t.tagName==="svg"}const Et=t=>!!(t&&t.getVelocity),Gv=[...ug,at,wi],qv=t=>Gv.find(dg(t)),Zc=g.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function yu(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Hv(...t){return e=>{let n=!1;const i=t.map(r=>{const o=yu(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():yu(t[r],null)}}}}function Kv(...t){return g.useCallback(Hv(...t),t)}class Yv extends g.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=n.offsetParent,r=gg(i)&&i.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=r-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Jv({children:t,isPresent:e,anchorX:n,root:i}){const r=g.useId(),o=g.useRef(null),a=g.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=g.useContext(Zc),c=Kv(o,t?.ref);return g.useInsertionEffect(()=>{const{width:d,height:u,top:h,left:p,right:m}=a.current;if(e||!o.current||!d||!u)return;const y=n==="left"?`left: ${p}`:`right: ${m}`;o.current.dataset.motionPopId=r;const f=document.createElement("style");l&&(f.nonce=l);const b=i??document.head;return b.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${y}px !important;
            top: ${h}px !important;
          }
        `),()=>{b.contains(f)&&b.removeChild(f)}},[e]),s.jsx(Yv,{isPresent:e,childRef:o,sizeRef:a,children:g.cloneElement(t,{ref:c})})}const Xv=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:o,mode:a,anchorX:l,root:c})=>{const d=Ic(Zv),u=g.useId();let h=!0,p=g.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:n,custom:r,onExitComplete:m=>{d.set(m,!0);for(const y of d.values())if(!y)return;i&&i()},register:m=>(d.set(m,!1),()=>d.delete(m))}),[n,d,i]);return o&&h&&(p={...p}),g.useMemo(()=>{d.forEach((m,y)=>d.set(y,!1))},[n]),g.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),a==="popLayout"&&(t=s.jsx(Jv,{isPresent:n,anchorX:l,root:c,children:t})),s.jsx(na.Provider,{value:p,children:t})};function Zv(){return new Map}function vg(t=!0){const e=g.useContext(na);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,o=g.useId();g.useEffect(()=>{if(t)return r(o)},[t]);const a=g.useCallback(()=>t&&i&&i(o),[o,i,t]);return!n&&i?[!1,a]:[!0]}const Hr=t=>t.key||"";function bu(t){const e=[];return g.Children.forEach(t,n=>{g.isValidElement(n)&&e.push(n)}),e}const Ve=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[d,u]=vg(a),h=g.useMemo(()=>bu(t),[t]),p=a&&!d?[]:h.map(Hr),m=g.useRef(!0),y=g.useRef(h),f=Ic(()=>new Map),[b,S]=g.useState(h),[C,j]=g.useState(h);If(()=>{m.current=!1,y.current=h;for(let E=0;E<C.length;E++){const k=Hr(C[E]);p.includes(k)?f.delete(k):f.get(k)!==!0&&f.set(k,!1)}},[C,p.length,p.join("-")]);const w=[];if(h!==b){let E=[...h];for(let k=0;k<C.length;k++){const T=C[k],N=Hr(T);p.includes(N)||(E.splice(k,0,T),w.push(T))}return o==="wait"&&w.length&&(E=w),j(bu(E)),S(h),null}const{forceRender:v}=g.useContext(Rc);return s.jsx(s.Fragment,{children:C.map(E=>{const k=Hr(E),T=a&&!d?!1:h===C||p.includes(k),N=()=>{if(f.has(k))f.set(k,!0);else return;let R=!0;f.forEach(_=>{_||(R=!1)}),R&&(v?.(),j(y.current),a&&u?.(),i&&i())};return s.jsx(Xv,{isPresent:T,initial:!m.current||n?void 0:!1,custom:e,presenceAffectsLayout:r,mode:o,root:c,onExitComplete:T?void 0:N,anchorX:l,children:E},k)})})},Sg=g.createContext({strict:!1}),vu={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Is={};for(const t in vu)Is[t]={isEnabled:e=>vu[t].some(n=>!!e[n])};function Qv(t){for(const e in t)Is[e]={...Is[e],...t[e]}}const e1=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Po(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||e1.has(t)}let kg=t=>!Po(t);function t1(t){typeof t=="function"&&(kg=e=>e.startsWith("on")?!Po(e):t(e))}try{t1(require("@emotion/is-prop-valid").default)}catch{}function n1(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(kg(r)||n===!0&&Po(r)||!e&&!Po(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}const ia=g.createContext({});function sa(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function yr(t){return typeof t=="string"||Array.isArray(t)}const Qc=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ed=["initial",...Qc];function ra(t){return sa(t.animate)||ed.some(e=>yr(t[e]))}function wg(t){return!!(ra(t)||t.variants)}function i1(t,e){if(ra(t)){const{initial:n,animate:i}=t;return{initial:n===!1||yr(n)?n:void 0,animate:yr(i)?i:void 0}}return t.inherit!==!1?e:{}}function s1(t){const{initial:e,animate:n}=i1(t,g.useContext(ia));return g.useMemo(()=>({initial:e,animate:n}),[Su(e),Su(n)])}function Su(t){return Array.isArray(t)?t.join(" "):t}const br={};function r1(t){for(const e in t)br[e]=t[e],Fc(e)&&(br[e].isCSSVariable=!0)}function Cg(t,{layout:e,layoutId:n}){return Bs.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!br[t]||t==="opacity")}const o1={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},a1=Fs.length;function l1(t,e,n){let i="",r=!0;for(let o=0;o<a1;o++){const a=Fs[o],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=fg(l,Yc[a]);if(!c){r=!1;const u=o1[a]||a;i+=`${u}(${d}) `}n&&(e[a]=d)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function td(t,e,n){const{style:i,vars:r,transformOrigin:o}=t;let a=!1,l=!1;for(const c in e){const d=e[c];if(Bs.has(c)){a=!0;continue}else if(Fc(c)){r[c]=d;continue}else{const u=fg(d,Yc[c]);c.startsWith("origin")?(l=!0,o[c]=u):i[c]=u}}if(e.transform||(a||n?i.transform=l1(e,t.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${c} ${d} ${u}`}}const nd=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function jg(t,e,n){for(const i in e)!Et(e[i])&&!Cg(i,n)&&(t[i]=e[i])}function c1({transformTemplate:t},e){return g.useMemo(()=>{const n=nd();return td(n,e,t),Object.assign({},n.vars,n.style)},[e])}function d1(t,e){const n=t.style||{},i={};return jg(i,n,t),Object.assign(i,c1(t,e)),i}function u1(t,e){const n={},i=d1(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const h1={offset:"stroke-dashoffset",array:"stroke-dasharray"},p1={offset:"strokeDashoffset",array:"strokeDasharray"};function f1(t,e,n=1,i=0,r=!0){t.pathLength=1;const o=r?h1:p1;t[o.offset]=ue.transform(-i);const a=ue.transform(e),l=ue.transform(n);t[o.array]=`${a} ${l}`}function Tg(t,{attrX:e,attrY:n,attrScale:i,pathLength:r,pathSpacing:o=1,pathOffset:a=0,...l},c,d,u){if(td(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:p}=t;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),i!==void 0&&(h.scale=i),r!==void 0&&f1(h,r,o,a,!1)}const Eg=()=>({...nd(),attrs:{}}),Rg=t=>typeof t=="string"&&t.toLowerCase()==="svg";function g1(t,e,n,i){const r=g.useMemo(()=>{const o=Eg();return Tg(o,e,Rg(i),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};jg(o,t.style,t),r.style={...o,...r.style}}return r}const m1=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function id(t){return typeof t!="string"||t.includes("-")?!1:!!(m1.indexOf(t)>-1||/[A-Z]/u.test(t))}function x1(t,e,n,{latestValues:i},r,o=!1){const l=(id(t)?g1:u1)(e,i,r,t),c=n1(e,typeof t=="string",o),d=t!==g.Fragment?{...c,...l,ref:n}:{},{children:u}=e,h=g.useMemo(()=>Et(u)?u.get():u,[u]);return g.createElement(t,{...d,children:h})}function ku(t){const e=[{},{}];return t?.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function sd(t,e,n,i){if(typeof e=="function"){const[r,o]=ku(i);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=ku(i);e=e(n!==void 0?n:t.custom,r,o)}return e}function co(t){return Et(t)?t.get():t}function y1({scrapeMotionValuesFromProps:t,createRenderState:e},n,i,r){return{latestValues:b1(n,i,r,t),renderState:e()}}function b1(t,e,n,i){const r={},o=i(t,{});for(const p in o)r[p]=co(o[p]);let{initial:a,animate:l}=t;const c=ra(t),d=wg(t);e&&d&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let u=n?n.initial===!1:!1;u=u||a===!1;const h=u?l:a;if(h&&typeof h!="boolean"&&!sa(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const y=sd(t,p[m]);if(y){const{transitionEnd:f,transition:b,...S}=y;for(const C in S){let j=S[C];if(Array.isArray(j)){const w=u?j.length-1:0;j=j[w]}j!==null&&(r[C]=j)}for(const C in f)r[C]=f[C]}}}return r}const Ig=t=>(e,n)=>{const i=g.useContext(ia),r=g.useContext(na),o=()=>y1(t,e,i,r);return n?o():Ic(o)};function rd(t,e,n){const{style:i}=t,r={};for(const o in i)(Et(i[o])||e.style&&Et(e.style[o])||Cg(o,t)||n?.getValue(o)?.liveStyle!==void 0)&&(r[o]=i[o]);return r}const v1=Ig({scrapeMotionValuesFromProps:rd,createRenderState:nd});function _g(t,e,n){const i=rd(t,e,n);for(const r in t)if(Et(t[r])||Et(e[r])){const o=Fs.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[o]=t[r]}return i}const S1=Ig({scrapeMotionValuesFromProps:_g,createRenderState:Eg}),k1=Symbol.for("motionComponentSymbol");function os(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function w1(t,e,n){return g.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):os(n)&&(n.current=i))},[e])}const od=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),C1="framerAppearId",Ng="data-"+od(C1),Ag=g.createContext({});function j1(t,e,n,i,r){const{visualElement:o}=g.useContext(ia),a=g.useContext(Sg),l=g.useContext(na),c=g.useContext(Zc).reducedMotion,d=g.useRef(null);i=i||a.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:o,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,h=g.useContext(Ag);u&&!u.projection&&r&&(u.type==="html"||u.type==="svg")&&T1(d.current,n,r,h);const p=g.useRef(!1);g.useInsertionEffect(()=>{u&&p.current&&u.update(n,l)});const m=n[Ng],y=g.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return If(()=>{u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),y.current&&u.animationState&&u.animationState.animateChanges())}),g.useEffect(()=>{u&&(!y.current&&u.animationState&&u.animationState.animateChanges(),y.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),y.current=!1),u.enteringChildren=void 0)}),u}function T1(t,e,n,i){const{layoutId:r,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:Pg(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||l&&os(l),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function Pg(t){if(t)return t.options.allowProjection!==!1?t.projection:Pg(t.parent)}function _a(t,{forwardMotionProps:e=!1}={},n,i){n&&Qv(n);const r=id(t)?S1:v1;function o(l,c){let d;const u={...g.useContext(Zc),...l,layoutId:E1(l)},{isStatic:h}=u,p=s1(l),m=r(l,h);if(!h&&_c){R1();const y=I1(u);d=y.MeasureLayout,p.visualElement=j1(t,m,u,i,y.ProjectionNode)}return s.jsxs(ia.Provider,{value:p,children:[d&&p.visualElement?s.jsx(d,{visualElement:p.visualElement,...u}):null,x1(t,l,w1(m,p.visualElement,c),m,h,e)]})}o.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=g.forwardRef(o);return a[k1]=t,a}function E1({layoutId:t}){const e=g.useContext(Rc).id;return e&&t!==void 0?e+"-"+t:t}function R1(t,e){g.useContext(Sg).strict}function I1(t){const{drag:e,layout:n}=Is;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function _1(t,e){if(typeof Proxy>"u")return _a;const n=new Map,i=(o,a)=>_a(o,a,t,e),r=(o,a)=>i(o,a);return new Proxy(r,{get:(o,a)=>a==="create"?i:(n.has(a)||n.set(a,_a(a,void 0,t,e)),n.get(a))})}function Mg({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function N1({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function A1(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Na(t){return t===void 0||t===1}function Dl({scale:t,scaleX:e,scaleY:n}){return!Na(t)||!Na(e)||!Na(n)}function Pi(t){return Dl(t)||Dg(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function Dg(t){return wu(t.x)||wu(t.y)}function wu(t){return t&&t!=="0%"}function Mo(t,e,n){const i=t-n,r=e*i;return n+r}function Cu(t,e,n,i,r){return r!==void 0&&(t=Mo(t,r,i)),Mo(t,n,i)+e}function Ol(t,e=0,n=1,i,r){t.min=Cu(t.min,e,n,i,r),t.max=Cu(t.max,e,n,i,r)}function Og(t,{x:e,y:n}){Ol(t.x,e.translate,e.scale,e.originPoint),Ol(t.y,n.translate,n.scale,n.originPoint)}const ju=.999999999999,Tu=1.0000000000001;function P1(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let o,a;for(let l=0;l<r;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&ls(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,Og(t,a)),i&&Pi(o.latestValues)&&ls(t,o.latestValues))}e.x<Tu&&e.x>ju&&(e.x=1),e.y<Tu&&e.y>ju&&(e.y=1)}function as(t,e){t.min=t.min+e,t.max=t.max+e}function Eu(t,e,n,i,r=.5){const o=Je(t.min,t.max,r);Ol(t,e,n,o,i)}function ls(t,e){Eu(t.x,e.x,e.scaleX,e.scale,e.originX),Eu(t.y,e.y,e.scaleY,e.scale,e.originY)}function Lg(t,e){return Mg(A1(t.getBoundingClientRect(),e))}function M1(t,e,n){const i=Lg(t,n),{scroll:r}=e;return r&&(as(i.x,r.offset.x),as(i.y,r.offset.y)),i}const Ru=()=>({translate:0,scale:1,origin:0,originPoint:0}),cs=()=>({x:Ru(),y:Ru()}),Iu=()=>({min:0,max:0}),ct=()=>({x:Iu(),y:Iu()}),Ll={current:null},Fg={current:!1};function D1(){if(Fg.current=!0,!!_c)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Ll.current=t.matches;t.addEventListener("change",e),e()}else Ll.current=!1}const O1=new WeakMap;function L1(t,e,n){for(const i in e){const r=e[i],o=n[i];if(Et(r))t.addValue(i,r);else if(Et(o))t.addValue(i,Rs(r,{owner:t}));else if(o!==r)if(t.hasValue(i)){const a=t.getValue(i);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=t.getStaticValue(i);t.addValue(i,Rs(a!==void 0?a:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const _u=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class F1{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Hc,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=zt.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,qe.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=ra(n),this.isVariantNode=wg(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const m=h[p];c[p]!==void 0&&Et(m)&&m.set(c[p])}}mount(e){this.current=e,O1.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),Fg.current||D1(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Ll.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ki(this.notifyUpdate),ki(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Bs.has(e);i&&this.onBindTransform&&this.onBindTransform();const r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&qe.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Is){const n=Is[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ct()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<_u.length;i++){const r=_u[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=e[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=L1(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=Rs(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(_f(i)||Af(i))?i=parseFloat(i):!qv(i)&&wi.test(n)&&(i=pg(e,n)),this.setBaseTarget(e,Et(i)?i.get():i)),Et(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const o=sd(this.props,n,this.presenceContext?.custom);o&&(i=o[e])}if(n&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Et(r)?r:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Dc),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Jc.render(this.render)}}class Bg extends F1{constructor(){super(...arguments),this.KeyframeResolver=Mv}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Et(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function zg(t,{style:e,vars:n},i,r){const o=t.style;let a;for(a in e)o[a]=e[a];r?.applyProjectionStyles(o,i);for(a in n)o.setProperty(a,n[a])}function B1(t){return window.getComputedStyle(t)}class z1 extends Bg{constructor(){super(...arguments),this.type="html",this.renderInstance=zg}readValueFromInstance(e,n){if(Bs.has(n))return this.projection?.isProjecting?Rl(n):Qb(e,n);{const i=B1(e),r=(Fc(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return Lg(e,n)}build(e,n,i){td(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return rd(e,n,i)}}const Ug=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function U1(t,e,n,i){zg(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(Ug.has(r)?r:od(r),e.attrs[r])}class W1 extends Bg{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ct}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Bs.has(n)){const i=hg(n);return i&&i.default||0}return n=Ug.has(n)?n:od(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return _g(e,n,i)}build(e,n,i){Tg(e,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,n,i,r){U1(e,n,i,r)}mount(e){this.isSVGTag=Rg(e.tagName),super.mount(e)}}const V1=(t,e)=>id(t)?new W1(e):new z1(e,{allowProjection:t!==g.Fragment});function fs(t,e,n){const i=t.getProps();return sd(i,e,n!==void 0?n:i.custom,t)}const Fl=t=>Array.isArray(t);function $1(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Rs(n))}function G1(t){return Fl(t)?t[t.length-1]||0:t}function q1(t,e){const n=fs(t,e);let{transitionEnd:i={},transition:r={},...o}=n||{};o={...o,...i};for(const a in o){const l=G1(o[a]);$1(t,a,l)}}function H1(t){return!!(Et(t)&&t.add)}function Bl(t,e){const n=t.getValue("willChange");if(H1(n))return n.add(e);if(!n&&Zn.WillChange){const i=new Zn.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function Wg(t){return t.props[Ng]}const K1=t=>t!==null;function Y1(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(K1),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return r[o]}const J1={type:"spring",stiffness:500,damping:25,restSpeed:10},X1=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Z1={type:"keyframes",duration:.8},Q1={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},eS=(t,{keyframes:e})=>e.length>2?Z1:Bs.has(t)?t.startsWith("scale")?X1(e[1]):J1:Q1;function tS({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const ad=(t,e,n,i={},r,o)=>a=>{const l=Kc(i,t)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-_n(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:p=>{e.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:o?void 0:r};tS(l)||Object.assign(u,eS(t,u)),u.duration&&(u.duration=_n(u.duration)),u.repeatDelay&&(u.repeatDelay=_n(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Pl(u),u.delay===0&&(h=!0)),(Zn.instantAnimations||Zn.skipAnimations)&&(h=!0,Pl(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!o&&e.get()!==void 0){const p=Y1(u.keyframes,l);if(p!==void 0){qe.update(()=>{u.onUpdate(p),u.onComplete()});return}}return l.isSync?new qc(u):new kv(u)};function nS({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function Vg(t,e,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(o=i);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const u in l){const h=t.getValue(u,t.latestValues[u]??null),p=l[u];if(p===void 0||d&&nS(d,u))continue;const m={delay:n,...Kc(o||{},u)},y=h.get();if(y!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===y&&!m.velocity)continue;let f=!1;if(window.MotionHandoffAnimation){const S=Wg(t);if(S){const C=window.MotionHandoffAnimation(S,u,qe);C!==null&&(m.startTime=C,f=!0)}}Bl(t,u),h.start(ad(u,h,p,t.shouldReduceMotion&&cg.has(u)?{type:!1}:m,t,f));const b=h.animation;b&&c.push(b)}return a&&Promise.all(c).then(()=>{qe.update(()=>{a&&q1(t,a)})}),c}function $g(t,e,n,i=0,r=1){const o=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=t.size,l=(a-1)*i;return typeof n=="function"?n(o,a):r===1?o*i:l-o*i}function zl(t,e,n={}){const i=fs(t,e,n.type==="exit"?t.presenceContext?.custom:void 0);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const o=i?()=>Promise.all(Vg(t,i,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=r;return iS(t,e,c,d,u,h,n)}:()=>Promise.resolve(),{when:l}=r;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(n.delay)])}function iS(t,e,n=0,i=0,r=0,o=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(zl(c,e,{...a,delay:n+(typeof i=="function"?0:i)+$g(t.variantChildren,c,i,r,o)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function sS(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(o=>zl(t,o,n));i=Promise.all(r)}else if(typeof e=="string")i=zl(t,e,n);else{const r=typeof e=="function"?fs(t,e,n.custom):e;i=Promise.all(Vg(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}function Gg(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}const rS=ed.length;function qg(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?qg(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<rS;n++){const i=ed[n],r=t.props[i];(yr(r)||r===!1)&&(e[i]=r)}return e}const oS=[...Qc].reverse(),aS=Qc.length;function lS(t){return e=>Promise.all(e.map(({animation:n,options:i})=>sS(t,n,i)))}function cS(t){let e=lS(t),n=Nu(),i=!0;const r=c=>(d,u)=>{const h=fs(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:m,...y}=h;d={...d,...y,...m}}return d};function o(c){e=c(t)}function a(c){const{props:d}=t,u=qg(t.parent)||{},h=[],p=new Set;let m={},y=1/0;for(let b=0;b<aS;b++){const S=oS[b],C=n[S],j=d[S]!==void 0?d[S]:u[S],w=yr(j),v=S===c?C.isActive:null;v===!1&&(y=b);let E=j===u[S]&&j!==d[S]&&w;if(E&&i&&t.manuallyAnimateOnMount&&(E=!1),C.protectedKeys={...m},!C.isActive&&v===null||!j&&!C.prevProp||sa(j)||typeof j=="boolean")continue;const k=dS(C.prevProp,j);let T=k||S===c&&C.isActive&&!E&&w||b>y&&w,N=!1;const R=Array.isArray(j)?j:[j];let _=R.reduce(r(S),{});v===!1&&(_={});const{prevResolvedValues:A={}}=C,Y={...A,..._},H=O=>{T=!0,p.has(O)&&(N=!0,p.delete(O)),C.needsAnimating[O]=!0;const P=t.getValue(O);P&&(P.liveStyle=!1)};for(const O in Y){const P=_[O],F=A[O];if(m.hasOwnProperty(O))continue;let D=!1;Fl(P)&&Fl(F)?D=!Gg(P,F):D=P!==F,D?P!=null?H(O):p.add(O):P!==void 0&&p.has(O)?H(O):C.protectedKeys[O]=!0}C.prevProp=j,C.prevResolvedValues=_,C.isActive&&(m={...m,..._}),i&&t.blockInitialAnimation&&(T=!1);const $=E&&k;T&&(!$||N)&&h.push(...R.map(O=>{const P={type:S};if(typeof O=="string"&&i&&!$&&t.manuallyAnimateOnMount&&t.parent){const{parent:F}=t,D=fs(F,O);if(F.enteringChildren&&D){const{delayChildren:B}=D.transition||{};P.delay=$g(F.enteringChildren,t,B)}}return{animation:O,options:P}}))}if(p.size){const b={};if(typeof d.initial!="boolean"){const S=fs(t,Array.isArray(d.initial)?d.initial[0]:d.initial);S&&S.transition&&(b.transition=S.transition)}p.forEach(S=>{const C=t.getBaseTarget(S),j=t.getValue(S);j&&(j.liveStyle=!0),b[S]=C??null}),h.push({animation:b})}let f=!!h.length;return i&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(f=!1),i=!1,f?e(h):Promise.resolve()}function l(c,d){if(n[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,d)),n[c].isActive=d;const u=a(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=Nu()}}}function dS(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!Gg(e,t):!1}function Ni(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Nu(){return{animate:Ni(!0),whileInView:Ni(),whileHover:Ni(),whileTap:Ni(),whileDrag:Ni(),whileFocus:Ni(),exit:Ni()}}class Ri{constructor(e){this.isMounted=!1,this.node=e}update(){}}class uS extends Ri{constructor(e){super(e),e.animationState||(e.animationState=cS(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();sa(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let hS=0;class pS extends Ri{constructor(){super(...arguments),this.id=hS++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const fS={animation:{Feature:uS},exit:{Feature:pS}};function vr(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function Lr(t){return{point:{x:t.pageX,y:t.pageY}}}const gS=t=>e=>Xc(e)&&t(e,Lr(e));function sr(t,e,n,i){return vr(t,e,gS(n),i)}const Hg=1e-4,mS=1-Hg,xS=1+Hg,Kg=.01,yS=0-Kg,bS=0+Kg;function Mt(t){return t.max-t.min}function vS(t,e,n){return Math.abs(t-e)<=n}function Au(t,e,n,i=.5){t.origin=i,t.originPoint=Je(e.min,e.max,t.origin),t.scale=Mt(n)/Mt(e),t.translate=Je(n.min,n.max,t.origin)-t.originPoint,(t.scale>=mS&&t.scale<=xS||isNaN(t.scale))&&(t.scale=1),(t.translate>=yS&&t.translate<=bS||isNaN(t.translate))&&(t.translate=0)}function rr(t,e,n,i){Au(t.x,e.x,n.x,i?i.originX:void 0),Au(t.y,e.y,n.y,i?i.originY:void 0)}function Pu(t,e,n){t.min=n.min+e.min,t.max=t.min+Mt(e)}function SS(t,e,n){Pu(t.x,e.x,n.x),Pu(t.y,e.y,n.y)}function Mu(t,e,n){t.min=e.min-n.min,t.max=t.min+Mt(e)}function Do(t,e,n){Mu(t.x,e.x,n.x),Mu(t.y,e.y,n.y)}function tn(t){return[t("x"),t("y")]}const Yg=({current:t})=>t?t.ownerDocument.defaultView:null,Du=(t,e)=>Math.abs(t-e);function kS(t,e){const n=Du(t.x,e.x),i=Du(t.y,e.y);return Math.sqrt(n**2+i**2)}class Jg{constructor(e,n,{transformPagePoint:i,contextWindow:r=window,dragSnapToOrigin:o=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Pa(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=kS(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!y)return;const{point:f}=p,{timestamp:b}=kt;this.history.push({...f,timestamp:b});const{onStart:S,onMove:C}=this.handlers;m||(S&&S(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Aa(m,this.transformPagePoint),qe.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:y,onSessionEnd:f,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=Pa(p.type==="pointercancel"?this.lastMoveEventInfo:Aa(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(p,S),f&&f(p,S)},!Xc(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=a,this.contextWindow=r||window;const l=Lr(e),c=Aa(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=kt;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=n;h&&h(e,Pa(c,this.history)),this.removeListeners=Mr(sr(this.contextWindow,"pointermove",this.handlePointerMove),sr(this.contextWindow,"pointerup",this.handlePointerUp),sr(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ki(this.updatePoint)}}function Aa(t,e){return e?{point:e(t.point)}:t}function Ou(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Pa({point:t},e){return{point:t,delta:Ou(t,Xg(e)),offset:Ou(t,wS(e)),velocity:CS(e,.1)}}function wS(t){return t[0]}function Xg(t){return t[t.length-1]}function CS(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Xg(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>_n(e)));)n--;if(!i)return{x:0,y:0};const o=rn(r.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function jS(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?Je(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?Je(n,t,i.max):Math.min(t,n)),t}function Lu(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function TS(t,{top:e,left:n,bottom:i,right:r}){return{x:Lu(t.x,n,r),y:Lu(t.y,e,i)}}function Fu(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function ES(t,e){return{x:Fu(t.x,e.x),y:Fu(t.y,e.y)}}function RS(t,e){let n=.5;const i=Mt(t),r=Mt(e);return r>i?n=gr(e.min,e.max-i,t.min):i>r&&(n=gr(t.min,t.max-r,e.min)),Xn(0,1,n)}function IS(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Ul=.35;function _S(t=Ul){return t===!1?t=0:t===!0&&(t=Ul),{x:Bu(t,"left","right"),y:Bu(t,"top","bottom")}}function Bu(t,e,n){return{min:zu(t,e),max:zu(t,n)}}function zu(t,e){return typeof t=="number"?t:t[e]||0}const NS=new WeakMap;class AS{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ct(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const o=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Lr(h).point)},a=(h,p)=>{const{drag:m,dragPropagation:y,onDragStart:f}=this.getProps();if(m&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Fv(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),tn(S=>{let C=this.getAxisMotionValue(S).get()||0;if(Nn.test(C)){const{projection:j}=this.visualElement;if(j&&j.layout){const w=j.layout.layoutBox[S];w&&(C=Mt(w)*(parseFloat(C)/100))}}this.originPoint[S]=C}),f&&qe.postRender(()=>f(h,p)),Bl(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:y,onDirectionLock:f,onDrag:b}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:S}=p;if(y&&this.currentDirection===null){this.currentDirection=PS(S),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",p.point,S),this.updateAxis("y",p.point,S),this.visualElement.render(),b&&b(h,p)},c=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>tn(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Jg(e,{onSessionStart:o,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Yg(this.visualElement)})}stop(e,n){const i=e||this.latestPointerEvent,r=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!r||!i)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&qe.postRender(()=>l(i,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!Kr(e,r,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(a=jS(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&os(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=TS(i.layoutBox,e):this.constraints=!1,this.elastic=_S(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&tn(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=IS(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!os(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=M1(i,r.root,this.visualElement.getTransformPagePoint());let a=ES(r.layout.layoutBox,o);if(n){const l=n(N1(a));this.hasMutatedConstraints=!!l,l&&(a=Mg(l))}return a}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=tn(u=>{if(!Kr(u,n,this.currentDirection))return;let h=c&&c[u]||{};a&&(h={min:0,max:0});const p=r?200:1e6,m=r?40:1e7,y={type:"inertia",velocity:i?e[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(u,y)});return Promise.all(d).then(l)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return Bl(this.visualElement,e),i.start(ad(e,i,0,n,this.visualElement,!1))}stopAnimation(){tn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){tn(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){tn(n=>{const{drag:i}=this.getProps();if(!Kr(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:l}=r.layout.layoutBox[n];o.set(e[n]-Je(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!os(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};tn(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();r[a]=RS({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),tn(a=>{if(!Kr(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(Je(c,d,r[a]))})}addListeners(){if(!this.visualElement.current)return;NS.set(this.visualElement,this);const e=this.visualElement.current,n=sr(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),i=()=>{const{dragConstraints:c}=this.getProps();os(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),qe.read(i);const a=vr(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(tn(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())}));return()=>{a(),n(),o(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=Ul,dragMomentum:l=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function Kr(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function PS(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class MS extends Ri{constructor(e){super(e),this.removeGroupControls=ln,this.removeListeners=ln,this.controls=new AS(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ln}unmount(){this.removeGroupControls(),this.removeListeners()}}const Uu=t=>(e,n)=>{t&&qe.postRender(()=>t(e,n))};class DS extends Ri{constructor(){super(...arguments),this.removePointerDownListener=ln}onPointerDown(e){this.session=new Jg(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Yg(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Uu(e),onStart:Uu(n),onMove:i,onEnd:(o,a)=>{delete this.session,r&&qe.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=sr(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const uo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Wu(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ws={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ue.test(t))t=parseFloat(t);else return t;const n=Wu(t,e.target.x),i=Wu(t,e.target.y);return`${n}% ${i}%`}},OS={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=wi.parse(t);if(r.length>5)return i;const o=wi.createTransformer(t),a=typeof r[0]!="number"?1:0,l=n.x.scale*e.x,c=n.y.scale*e.y;r[0+a]/=l,r[1+a]/=c;const d=Je(l,c,.5);return typeof r[2+a]=="number"&&(r[2+a]/=d),typeof r[3+a]=="number"&&(r[3+a]/=d),o(r)}};let Ma=!1;class LS extends g.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:o}=e;r1(FS),o&&(n.group&&n.group.add(o),i&&i.register&&r&&i.register(o),Ma&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),uo.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:o}=this.props,{projection:a}=i;return a&&(a.isPresent=o,Ma=!0,r||e.layoutDependency!==n||n===void 0||e.isPresent!==o?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||qe.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Jc.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;Ma=!0,r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Zg(t){const[e,n]=vg(),i=g.useContext(Rc);return s.jsx(LS,{...t,layoutGroup:i,switchLayoutGroup:g.useContext(Ag),isPresent:e,safeToRemove:n})}const FS={borderRadius:{...Ws,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ws,borderTopRightRadius:Ws,borderBottomLeftRadius:Ws,borderBottomRightRadius:Ws,boxShadow:OS};function BS(t,e,n){const i=Et(t)?t:Rs(t);return i.start(ad("",i,e,n)),i.animation}const zS=(t,e)=>t.depth-e.depth;class US{constructor(){this.children=[],this.isDirty=!1}add(e){Nc(this.children,e),this.isDirty=!0}remove(e){Ac(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(zS),this.isDirty=!1,this.children.forEach(e)}}function WS(t,e){const n=zt.now(),i=({timestamp:r})=>{const o=r-n;o>=e&&(ki(i),t(o-e))};return qe.setup(i,!0),()=>ki(i)}const Qg=["TopLeft","TopRight","BottomLeft","BottomRight"],VS=Qg.length,Vu=t=>typeof t=="string"?parseFloat(t):t,$u=t=>typeof t=="number"||ue.test(t);function $S(t,e,n,i,r,o){r?(t.opacity=Je(0,n.opacity??1,GS(i)),t.opacityExit=Je(e.opacity??1,0,qS(i))):o&&(t.opacity=Je(e.opacity??1,n.opacity??1,i));for(let a=0;a<VS;a++){const l=`border${Qg[a]}Radius`;let c=Gu(e,l),d=Gu(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||$u(c)===$u(d)?(t[l]=Math.max(Je(Vu(c),Vu(d),i),0),(Nn.test(d)||Nn.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||n.rotate)&&(t.rotate=Je(e.rotate||0,n.rotate||0,i))}function Gu(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const GS=em(0,.5,zf),qS=em(.5,.95,ln);function em(t,e,n){return i=>i<t?0:i>e?1:n(gr(t,e,i))}function qu(t,e){t.min=e.min,t.max=e.max}function fn(t,e){qu(t.x,e.x),qu(t.y,e.y)}function Hu(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function Ku(t,e,n,i,r){return t-=e,t=Mo(t,1/n,i),r!==void 0&&(t=Mo(t,1/r,i)),t}function HS(t,e=0,n=1,i=.5,r,o=t,a=t){if(Nn.test(e)&&(e=parseFloat(e),e=Je(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=Je(o.min,o.max,i);t===o&&(l-=e),t.min=Ku(t.min,e,n,l,r),t.max=Ku(t.max,e,n,l,r)}function Yu(t,e,[n,i,r],o,a){HS(t,e[n],e[i],e[r],e.scale,o,a)}const KS=["x","scaleX","originX"],YS=["y","scaleY","originY"];function Ju(t,e,n,i){Yu(t.x,e,KS,n?n.x:void 0,i?i.x:void 0),Yu(t.y,e,YS,n?n.y:void 0,i?i.y:void 0)}function Xu(t){return t.translate===0&&t.scale===1}function tm(t){return Xu(t.x)&&Xu(t.y)}function Zu(t,e){return t.min===e.min&&t.max===e.max}function JS(t,e){return Zu(t.x,e.x)&&Zu(t.y,e.y)}function Qu(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function nm(t,e){return Qu(t.x,e.x)&&Qu(t.y,e.y)}function eh(t){return Mt(t.x)/Mt(t.y)}function th(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class XS{constructor(){this.members=[]}add(e){Nc(this.members,e),e.scheduleRender()}remove(e){if(Ac(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function ZS(t,e,n){let i="";const r=t.x.translate/e.x,o=t.y.translate/e.y,a=n?.z||0;if((r||o||a)&&(i=`translate3d(${r}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:y}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),h&&(i+=`rotateX(${h}deg) `),p&&(i+=`rotateY(${p}deg) `),m&&(i+=`skewX(${m}deg) `),y&&(i+=`skewY(${y}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const Da=["","X","Y","Z"],QS=1e3;let ek=0;function Oa(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function im(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=Wg(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",qe,!(r||o))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&im(i)}function sm({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(a={},l=e?.()){this.id=ek++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(ik),this.nodes.forEach(ak),this.nodes.forEach(lk),this.nodes.forEach(sk)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new US)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Dc),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=bg(a)&&!$v(a),this.instance=a;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;qe.read(()=>{h=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=WS(p,250),uo.hasAnimatedSinceResize&&(uo.hasAnimatedSinceResize=!1,this.nodes.forEach(sh)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||d.getDefaultTransition()||pk,{onLayoutAnimationStart:f,onLayoutAnimationComplete:b}=d.getProps(),S=!this.targetLayout||!nm(this.targetLayout,m),C=!h&&p;if(this.options.layoutRoot||this.resumeFrom||C||h&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const j={...Kc(y,"layout"),onPlay:f,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(j.delay=0,j.type=!1),this.startAnimation(j),this.setAnimationOrigin(u,C)}else h||sh(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ki(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ck),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&im(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nh);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(ih);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(ok),this.nodes.forEach(tk),this.nodes.forEach(nk)):this.nodes.forEach(ih),this.clearAllSnapshots();const l=zt.now();kt.delta=Xn(0,1e3/60,l-kt.timestamp),kt.timestamp=l,kt.isProcessing=!0,Ca.update.process(kt),Ca.preRender.process(kt),Ca.render.process(kt),kt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Jc.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(rk),this.sharedNodes.forEach(dk)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Mt(this.snapshot.measuredBox.x)&&!Mt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ct(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!tm(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(l||Pi(this.latestValues)||u)&&(r(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),fk(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return ct();const l=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(gk))){const{scroll:d}=this.root;d&&(as(l.x,d.offset.x),as(l.y,d.offset.y))}return l}removeElementScroll(a){const l=ct();if(fn(l,a),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&fn(l,a),as(l.x,u.offset.x),as(l.y,u.offset.y))}return l}applyTransform(a,l=!1){const c=ct();fn(c,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ls(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Pi(u.latestValues)&&ls(c,u.latestValues)}return Pi(this.latestValues)&&ls(c,this.latestValues),c}removeTransform(a){const l=ct();fn(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Pi(d.latestValues))continue;Dl(d.latestValues)&&d.updateSnapshot();const u=ct(),h=d.measurePageBox();fn(u,h),Ju(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Pi(this.latestValues)&&Ju(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==kt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=kt.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ct(),this.targetWithTransforms=ct()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),SS(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fn(this.target,this.layout.layoutBox),Og(this.target,this.targetDelta)):fn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Dl(this.parent.latestValues)||Dg(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ct(),this.relativeTargetOrigin=ct(),Do(this.relativeTargetOrigin,l,c),fn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===kt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;fn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;P1(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ct());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Hu(this.prevProjectionDelta.x,this.projectionDelta.x),Hu(this.prevProjectionDelta.y,this.projectionDelta.y)),rr(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!th(this.projectionDelta.x,this.prevProjectionDelta.x)||!th(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=cs(),this.projectionDelta=cs(),this.projectionDeltaWithTransform=cs()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=cs();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=ct(),m=c?c.source:void 0,y=this.layout?this.layout.source:void 0,f=m!==y,b=this.getStack(),S=!b||b.members.length<=1,C=!!(f&&!S&&this.options.crossfade===!0&&!this.path.some(hk));this.animationProgress=0;let j;this.mixTargetDelta=w=>{const v=w/1e3;rh(h.x,a.x,v),rh(h.y,a.y,v),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Do(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),uk(this.relativeTarget,this.relativeTargetOrigin,p,v),j&&JS(this.relativeTarget,j)&&(this.isProjectionDirty=!1),j||(j=ct()),fn(j,this.relativeTarget)),f&&(this.animationValues=u,$S(u,d,this.latestValues,v,C,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=v},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ki(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qe.update(()=>{uo.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Rs(0)),this.currentAnimation=BS(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(QS),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&rm(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ct();const h=Mt(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const p=Mt(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}fn(l,c),ls(l,u),rr(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new XS),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Oa("z",a,d,this.animationValues);for(let u=0;u<Da.length;u++)Oa(`rotate${Da[u]}`,a,d,this.animationValues),Oa(`skew${Da[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=co(l?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=co(l?.pointerEvents)||""),this.hasProjected&&!Pi(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=ZS(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),a.transform=h;const{x:p,y:m}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const y in br){if(u[y]===void 0)continue;const{correct:f,applyTo:b,isCSSVariable:S}=br[y],C=h==="none"?u[y]:f(u[y],d);if(b){const j=b.length;for(let w=0;w<j;w++)a[b[w]]=C}else S?this.options.visualElement.renderState.vars[y]=C:a[y]=C}this.options.layoutId&&(a.pointerEvents=d===this?co(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(nh),this.root.sharedNodes.clear()}}}function tk(t){t.updateLayout()}function nk(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,o=e.source!==t.layout.source;r==="size"?tn(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=Mt(h);h.min=n[u].min,h.max=h.min+p}):rm(r,e.layoutBox,n)&&tn(u=>{const h=o?e.measuredBox[u]:e.layoutBox[u],p=Mt(n[u]);h.max=h.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+p)});const a=cs();rr(a,n,e.layoutBox);const l=cs();o?rr(l,t.applyTransform(i,!0),e.measuredBox):rr(l,n,e.layoutBox);const c=!tm(a);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const m=ct();Do(m,e.layoutBox,h.layoutBox);const y=ct();Do(y,n,p.layoutBox),nm(m,y)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=y,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function ik(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function sk(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function rk(t){t.clearSnapshot()}function nh(t){t.clearMeasurements()}function ih(t){t.isLayoutDirty=!1}function ok(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function sh(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function ak(t){t.resolveTargetDelta()}function lk(t){t.calcProjection()}function ck(t){t.resetSkewAndRotation()}function dk(t){t.removeLeadSnapshot()}function rh(t,e,n){t.translate=Je(e.translate,0,n),t.scale=Je(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function oh(t,e,n,i){t.min=Je(e.min,n.min,i),t.max=Je(e.max,n.max,i)}function uk(t,e,n,i){oh(t.x,e.x,n.x,i),oh(t.y,e.y,n.y,i)}function hk(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const pk={duration:.45,ease:[.4,0,.1,1]},ah=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),lh=ah("applewebkit/")&&!ah("chrome/")?Math.round:ln;function ch(t){t.min=lh(t.min),t.max=lh(t.max)}function fk(t){ch(t.x),ch(t.y)}function rm(t,e,n){return t==="position"||t==="preserve-aspect"&&!vS(eh(e),eh(n),.2)}function gk(t){return t!==t.root&&t.scroll?.wasRoot}const mk=sm({attachResizeListener:(t,e)=>vr(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),La={current:void 0},om=sm({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!La.current){const t=new mk({});t.mount(window),t.setOptions({layoutScroll:!0}),La.current=t}return La.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),xk={pan:{Feature:DS},drag:{Feature:MS,ProjectionNode:om,MeasureLayout:Zg}};function dh(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,o=i[r];o&&qe.postRender(()=>o(e,Lr(e)))}class yk extends Ri{mount(){const{current:e}=this.node;e&&(this.unmount=Bv(e,(n,i)=>(dh(this.node,i,"Start"),r=>dh(this.node,r,"End"))))}unmount(){}}class bk extends Ri{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Mr(vr(this.node.current,"focus",()=>this.onFocus()),vr(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function uh(t,e,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),o=i[r];o&&qe.postRender(()=>o(e,Lr(e)))}class vk extends Ri{mount(){const{current:e}=this.node;e&&(this.unmount=Vv(e,(n,i)=>(uh(this.node,i,"Start"),(r,{success:o})=>uh(this.node,r,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Wl=new WeakMap,Fa=new WeakMap,Sk=t=>{const e=Wl.get(t.target);e&&e(t)},kk=t=>{t.forEach(Sk)};function wk({root:t,...e}){const n=t||document;Fa.has(n)||Fa.set(n,{});const i=Fa.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(kk,{root:t,...e})),i[r]}function Ck(t,e,n){const i=wk(e);return Wl.set(t,n),i.observe(t),()=>{Wl.delete(t),i.unobserve(t)}}const jk={some:0,all:1};class Tk extends Ri{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:jk[r]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(c)};return Ck(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(Ek(e,n))&&this.startObserver()}unmount(){}}function Ek({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const Rk={inView:{Feature:Tk},tap:{Feature:vk},focus:{Feature:bk},hover:{Feature:yk}},Ik={layout:{ProjectionNode:om,MeasureLayout:Zg}},_k={...fS,...Rk,...xk,...Ik},L=_1(_k,V1);const ho=ee("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const pt=ee("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const am=ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const ni=ee("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);const Fr=ee("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const or=ee("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const qi=ee("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const lm=ee("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const oa=ee("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const jt=ee("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const ar=ee("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const ve=ee("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Qn=ee("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const hh=ee("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);const ph=ee("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);const Nk=ee("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const Br=ee("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const He=ee("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const zr=ee("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const cm=ee("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const Ak=ee("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const ld=ee("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);const gs=ee("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const dm=ee("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Tt=ee("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const lr=ee("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const _s=ee("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);const Pk=ee("Frame",[["line",{x1:"22",x2:"2",y1:"6",y2:"6",key:"15w7dq"}],["line",{x1:"22",x2:"2",y1:"18",y2:"18",key:"1ip48p"}],["line",{x1:"6",x2:"6",y1:"2",y2:"22",key:"a2lnyx"}],["line",{x1:"18",x2:"18",y1:"2",y2:"22",key:"8vb6jd"}]]);const um=ee("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);const Vl=ee("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const Mk=ee("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);const $l=ee("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const Ns=ee("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const Dk=ee("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Ok=ee("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const Kn=ee("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const Gl=ee("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const Oo=ee("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const hm=ee("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const Lk=ee("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const ze=ee("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Fk=ee("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Lo=ee("MicVocal",[["path",{d:"m11 7.601-5.994 8.19a1 1 0 0 0 .1 1.298l.817.818a1 1 0 0 0 1.314.087L15.09 12",key:"80a601"}],["path",{d:"M16.5 21.174C15.5 20.5 14.372 20 13 20c-2.058 0-3.928 2.356-6 2-2.072-.356-2.775-3.369-1.5-4.5",key:"j0ngtp"}],["circle",{cx:"16",cy:"7",r:"5",key:"d08jfb"}]]);const pm=ee("Music2",[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]]);const Bk=ee("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const zk=ee("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);const Uk=ee("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);const Wk=ee("PanelTop",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}]]);const Vk=ee("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);const cd=ee("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);const fm=ee("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);const gm=ee("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Ba=ee("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const $t=ee("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const As=ee("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const dd=ee("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);const hn=ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const Ln=ee("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);const $k=ee("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ei=ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const ud=ee("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Gk=ee("Shapes",[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]]);const Hi=ee("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const qk=ee("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);const hd=ee("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);const pd=ee("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);const Sr=ee("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const De=ee("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const Fo=ee("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const mm=ee("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);const pn=ee("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Mn=ee("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Hk=ee("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);const fh=ee("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const Ci=ee("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const xm=ee("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const kn=ee("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const fd=ee("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Ai=({onNavigate:t})=>{const{branding:e,partnerName:n,isWhiteLabel:i}=ge(),r=e?.["--header-gradient"]||Q["--header-gradient"];e?.["--header-text"]||Q["--header-text"];const o=e?.["--primary-accent"]||Q["--primary-accent"],a=[{id:"simulator",icon:De,title:"Szenario-Training",subtitle:"Gezielte Vorbereitung",description:"Trainiere mit vorbereiteten Fragen und erhalte sofortiges KI-Feedback zu jeder Antwort. Perfekt fr die systematische Vorbereitung auf entscheidende Gesprche, Verhandlungen und Pitches.",highlights:["Vordefinierte Business-Szenarien","Sofortiges Feedback nach jeder Antwort","Strukturierte Auswertung"],gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",accentColor:"#10B981"},{id:"smart_briefing",icon:st,title:"Smart Briefing",subtitle:"KI-Vorbereitungs-Assistent",description:"Erhalte massgeschneiderte Briefings fr deine Gesprche. Die KI erstellt dir Insider-Wissen, fachliche Must-Haves und clevere Rckfragen - basierend auf deinen spezifischen Angaben.",highlights:["Personalisierte Gesprchsvorbereitung","Branchenspezifisches Wissen","Intelligente Rckfragen-Vorschlge"],gradient:"linear-gradient(135deg, #EC4899 0%, #DB2777 100%)",accentColor:"#EC4899"},{id:"video_training",icon:ht,title:"Wirkungs-Analyse",subtitle:"Auftreten & Prsenz perfektionieren",description:"Nimm dich selbst auf Video auf und erhalte eine detaillierte KI-Analyse zu Krpersprache, Mimik und rhetorischer Wirkung. Ideal fr Prsentationen, Pitches und den professionellen Auftritt.",highlights:["Video-Selbstaufnahme","Analyse von Krpersprache & Charisma","Konkrete Verbesserungsvorschlge"],gradient:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",accentColor:"#8B5CF6"},{id:"dashboard",icon:ze,title:"Live-Simulationen",subtitle:"Realistische Dialog-Szenarien",description:"Fhre echte Gesprche mit einem KI-Sparringspartner in Echtzeit. Die natrlichste Art, schwierige Gesprchssituationen zu ben  von der Verhandlung bis zum Feedbackgesprch.",highlights:["Echtzeit-Sprachkonversation","Verschiedene Gesprchspartner-Persnlichkeiten","Vollstndiges Gesprchs-Feedback"],gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",accentColor:"#3B82F6"},{id:"gym_klassiker",icon:ld,title:"Rhetorik-Gym",subtitle:"Ausdrucksweise schrfen",description:"Trainiere deine Ausdrucksweise effizient: Reduziere Fllwrter, verbessere dein Sprechtempo und wirke souverner und berzeugender in jedem Meeting.",highlights:["Fllwort-Erkennung","Sprechtempo-Analyse","Gamification & Highscores"],gradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",accentColor:"#F59E0B"}],l={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},c={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},d=u=>{t&&t(u)};return s.jsxs("div",{className:"min-h-screen py-6 lg:py-10 px-4 lg:px-6",children:[s.jsxs(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full text-center mb-10 lg:mb-14 px-4 lg:px-8",children:[s.jsxs("h1",{style:{fontSize:"clamp(28px, 5vw, 42px)",fontWeight:800,color:"#0f172a",marginBottom:"16px",lineHeight:1.2},children:["Willkommen im"," ",s.jsx("span",{style:{background:r,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Trainingscenter"})]}),s.jsx("p",{style:{fontSize:"clamp(16px, 2.5vw, 20px)",color:"#475569",maxWidth:"700px",margin:"0 auto 32px",lineHeight:1.6},children:"Bereite dich optimal auf Bewerbungsgesprche vor. Whle einen Trainingsbereich und starte dein persnliches Coaching."}),s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},style:{display:"flex",justifyContent:"center",gap:"32px",flexWrap:"wrap"},children:[{icon:fd,label:"KI-Feedback",value:"Sofort"},{icon:Os,label:"Trainingsmodi",value:"4"},{icon:Vt,label:"Fortschritt",value:"Messbar"}].map((u,h)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"rgba(59, 130, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(u.icon,{style:{width:"20px",height:"20px",color:o}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a"},children:u.value}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:u.label})]})]},h))})]}),s.jsx(L.div,{variants:l,initial:"hidden",animate:"visible",className:"w-full px-4 lg:px-8",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 280px), 1fr))",gap:"20px"},children:a.map(u=>s.jsxs(L.div,{variants:c,whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},onClick:()=>d(u.id),style:{background:"white",borderRadius:"24px",padding:"28px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)",transition:"box-shadow 0.3s ease",display:"flex",flexDirection:"column",height:"100%"},onMouseEnter:h=>{h.currentTarget.style.boxShadow="0 20px 40px -12px rgba(0, 0, 0, 0.15)"},onMouseLeave:h=>{h.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:u.gradient,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 8px 16px -4px ${u.accentColor}40`},children:s.jsx(u.icon,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:s.jsx(am,{style:{width:"18px",height:"18px",color:"#64748b"}})})]}),s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsx("h3",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"4px"},children:u.title}),s.jsx("p",{style:{fontSize:"14px",fontWeight:500,color:u.accentColor},children:u.subtitle})]}),s.jsx("p",{style:{fontSize:"15px",color:"#475569",lineHeight:1.6,marginBottom:"20px",flex:1},children:u.description}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",paddingTop:"16px",borderTop:"1px solid #f1f5f9"},children:u.highlights.map((h,p)=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(Qn,{style:{width:"16px",height:"16px",color:u.accentColor,flexShrink:0}}),s.jsx("span",{style:{fontSize:"14px",color:"#334155"},children:h})]},p))})]},u.id))}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.4},style:{maxWidth:"700px",margin:"48px auto 0",textAlign:"center",padding:"32px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%)",borderRadius:"20px",border:"1px solid rgba(59, 130, 246, 0.1)"},children:[s.jsx("h3",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Bereit fr dein Training?"}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",marginBottom:"0"},children:"Whle einen der Trainingsbereiche oben aus und starte sofort mit deinem persnlichen Coaching."})]})]})},gh={easy:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einfach"},beginner:{classes:"bg-green-100 text-green-800 border-green-200",label:"Einsteiger"},medium:{classes:"bg-yellow-100 text-yellow-800 border-yellow-200",label:"Mittel"},intermediate:{classes:"bg-blue-100 text-blue-800 border-blue-200",label:"Fortgeschritten"},hard:{classes:"bg-red-100 text-red-800 border-red-200",label:"Schwer"},advanced:{classes:"bg-purple-100 text-purple-800 border-purple-200",label:"Experte"}},Kk=t=>gh[t]||gh.medium,ql=({children:t,className:e="",style:n={}})=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${e}`,style:n,children:t}),ym=({icon:t,gradient:e,textColor:n,size:i="md"})=>{const r={sm:{container:"40px",icon:"20px",radius:"10px"},md:{container:"48px",icon:"24px",radius:"12px"},lg:{container:"56px",icon:"28px",radius:"14px"}},o=r[i]||r.md;return s.jsx("div",{style:{width:o.container,height:o.container,borderRadius:o.radius,background:e,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(t,{style:{width:o.icon,height:o.icon,color:n}})})},bm=({icon:t,text:e})=>s.jsxs("div",{className:"flex items-center gap-1",children:[t&&s.jsx(t,{className:"w-3 h-3"}),s.jsx("span",{children:e})]}),Yk=({label:t,icon:e,color:n})=>s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold",style:{color:n},children:[s.jsx("span",{children:t}),e&&s.jsx(e,{className:"w-4 h-4"})]}),aa=({viewMode:t,onViewChange:e})=>{const{branding:n}=ge(),i=n?.["--primary-accent"]||Q["--primary-accent"],r=a=>({padding:"8px",borderRadius:"6px",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:a?"#ffffff":"transparent",boxShadow:a?"0 1px 2px rgba(0, 0, 0, 0.05)":"none",display:"flex",alignItems:"center",justifyContent:"center"}),o=a=>({width:"16px",height:"16px",color:a?i:x.slate[500]});return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px",backgroundColor:x.slate[100],borderRadius:"8px"},children:[s.jsx("button",{onClick:()=>e("grid"),style:r(t==="grid"),title:"Kachelansicht",children:s.jsx(Kn,{style:o(t==="grid")})}),s.jsx("button",{onClick:()=>e("list"),style:r(t==="list"),title:"Listenansicht",children:s.jsx(Gl,{style:o(t==="list")})})]})},Jk=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Vt},categoryBadge:c,onClick:d,className:u="",style:h={},headerGradient:p,headerText:m,primaryAccent:y,difficultyConfig:f})=>s.jsx(L.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.02},whileTap:{scale:.98},children:s.jsxs("div",{onClick:d,className:`bg-white rounded-3xl shadow-lg hover:shadow-xl transition-shadow duration-300 p-6 cursor-pointer border border-slate-100 h-full flex flex-col ${u}`,style:h,children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i?s.jsx(ym,{icon:i,gradient:p,textColor:m,size:"lg"}):n?s.jsx(ql,{className:f.classes,children:f.label}):null,s.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i&&n&&s.jsx(ql,{className:f.classes,children:f.label}),c,a.length>0&&s.jsx("div",{className:"flex gap-1",children:a.slice(0,2).map((b,S)=>s.jsx("span",{className:"px-2 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs",children:b},S))})]})]}),s.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:t}),r&&s.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:y},children:r}),e&&s.jsx("p",{className:"text-slate-600 text-sm mb-4 flex-1 line-clamp-3",children:e}),s.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[s.jsx("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:o.map((b,S)=>s.jsx(bm,{icon:b.icon,text:b.text},S))}),l&&s.jsx(Yk,{label:l.label,icon:l.icon,color:y})]})]})}),Xk=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Vt},categoryBadge:c,onClick:d,className:u="",style:h={},headerGradient:p,headerText:m,primaryAccent:y,difficultyConfig:f})=>s.jsx(L.div,{variants:{hidden:{opacity:0,x:-20},visible:{opacity:1,x:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:s.jsxs("div",{onClick:d,className:`bg-white rounded-2xl shadow-md hover:shadow-lg transition-all duration-300 p-4 cursor-pointer border border-slate-100 flex items-center gap-4 ${u}`,style:h,children:[i&&s.jsx(ym,{icon:i,gradient:p,textColor:m,size:"md"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"text-base font-bold text-slate-900 truncate",children:t}),r&&s.jsx("span",{className:"text-xs font-semibold hidden sm:inline",style:{color:y},children:r})]}),e&&s.jsx("p",{className:"text-slate-600 text-sm line-clamp-1 mb-1 hidden sm:block",children:e}),s.jsx("div",{className:"flex items-center gap-3 text-xs text-slate-500",children:o.slice(0,3).map((b,S)=>s.jsx(bm,{icon:b.icon,text:b.text},S))})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.length>0&&s.jsx("span",{className:"px-2 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs hidden md:inline",children:a[0]}),s.jsx("div",{className:"hidden sm:block",children:c}),n&&s.jsx(ql,{className:f.classes,children:f.label}),l&&s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold ml-2",style:{color:y},children:[s.jsx("span",{className:"hidden sm:inline",children:l.label}),l.icon&&s.jsx(l.icon,{className:"w-4 h-4"})]})]})]})}),Ur=({title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o=[],tags:a=[],action:l={label:"Starten",icon:Vt},categoryBadge:c,onClick:d,viewMode:u="grid",className:h="",style:p={}})=>{const{branding:m}=ge(),y=m?.["--header-gradient"]||Q["--header-gradient"],f=m?.["--header-text"]||Q["--header-text"],b=m?.["--primary-accent"]||Q["--primary-accent"],S=Kk(n),C={title:t,description:e,difficulty:n,icon:i,subtitle:r,meta:o,tags:a,action:l,categoryBadge:c,onClick:d,className:h,style:p,headerGradient:y,headerText:f,primaryAccent:b,difficultyConfig:S};return u==="list"?s.jsx(Xk,{...C}):s.jsx(Jk,{...C})},Wr=({children:t,minCardWidth:e="320px",viewMode:n="grid",className:i=""})=>{const r=n==="list";return s.jsx(L.div,{className:`${r?"flex flex-col gap-3":"grid gap-6"} ${i}`,style:r?{}:{gridTemplateColumns:`repeat(auto-fit, minmax(min(100%, ${e}), 1fr))`},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:r?.05:.1}}},children:t})};function mi(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t?.(r),n===!1||!r.defaultPrevented)return e?.(r)}}function mh(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function vm(...t){return e=>{let n=!1;const i=t.map(r=>{const o=mh(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():mh(t[r],null)}}}}function Ki(...t){return g.useCallback(vm(...t),t)}function Zk(t,e){const n=g.createContext(e),i=o=>{const{children:a,...l}=o,c=g.useMemo(()=>l,Object.values(l));return s.jsx(n.Provider,{value:c,children:a})};i.displayName=t+"Provider";function r(o){const a=g.useContext(n);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return[i,r]}function Qk(t,e=[]){let n=[];function i(o,a){const l=g.createContext(a),c=n.length;n=[...n,a];const d=h=>{const{scope:p,children:m,...y}=h,f=p?.[t]?.[c]||l,b=g.useMemo(()=>y,Object.values(y));return s.jsx(f.Provider,{value:b,children:m})};d.displayName=o+"Provider";function u(h,p){const m=p?.[t]?.[c]||l,y=g.useContext(m);if(y)return y;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${o}\``)}return[d,u]}const r=()=>{const o=n.map(a=>g.createContext(a));return function(l){const c=l?.[t]||o;return g.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return r.scopeName=t,[i,ew(r,...e)]}function ew(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const a=i.reduce((l,{useScope:c,scopeName:d})=>{const h=c(o)[`__scope${d}`];return{...l,...h}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}var kr=globalThis?.document?g.useLayoutEffect:()=>{},tw=Rf[" useId ".trim().toString()]||(()=>{}),nw=0;function za(t){const[e,n]=g.useState(tw());return kr(()=>{n(i=>i??String(nw++))},[t]),t||(e?`radix-${e}`:"")}var iw=Rf[" useInsertionEffect ".trim().toString()]||kr;function sw({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,o,a]=rw({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:r;{const u=g.useRef(t!==void 0);g.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,i])}const d=g.useCallback(u=>{if(l){const h=ow(u)?u(t):u;h!==t&&a.current?.(h)}else o(u)},[l,t,o,a]);return[c,d]}function rw({defaultProp:t,onChange:e}){const[n,i]=g.useState(t),r=g.useRef(n),o=g.useRef(e);return iw(()=>{o.current=e},[e]),g.useEffect(()=>{r.current!==n&&(o.current?.(n),r.current=n)},[n,r]),[n,i,o]}function ow(t){return typeof t=="function"}var Sm=Ky();const aw=Hy(Sm);function km(t){const e=lw(t),n=g.forwardRef((i,r)=>{const{children:o,...a}=i,l=g.Children.toArray(o),c=l.find(dw);if(c){const d=c.props.children,u=l.map(h=>h===c?g.Children.count(d)>1?g.Children.only(null):g.isValidElement(d)?d.props.children:null:h);return s.jsx(e,{...a,ref:r,children:g.isValidElement(d)?g.cloneElement(d,void 0,u):null})}return s.jsx(e,{...a,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}function lw(t){const e=g.forwardRef((n,i)=>{const{children:r,...o}=n;if(g.isValidElement(r)){const a=hw(r),l=uw(o,r.props);return r.type!==g.Fragment&&(l.ref=i?vm(i,a):a),g.cloneElement(r,l)}return g.Children.count(r)>1?g.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var cw=Symbol("radix.slottable");function dw(t){return g.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===cw}function uw(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...l)=>{const c=o(...l);return r(...l),c}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function hw(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var pw=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ii=pw.reduce((t,e)=>{const n=km(`Primitive.${e}`),i=g.forwardRef((r,o)=>{const{asChild:a,...l}=r,c=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(c,{...l,ref:o})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function fw(t,e){t&&Sm.flushSync(()=>t.dispatchEvent(e))}function wr(t){const e=g.useRef(t);return g.useEffect(()=>{e.current=t}),g.useMemo(()=>(...n)=>e.current?.(...n),[])}function gw(t,e=globalThis?.document){const n=wr(t);g.useEffect(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var mw="DismissableLayer",Hl="dismissableLayer.update",xw="dismissableLayer.pointerDownOutside",yw="dismissableLayer.focusOutside",xh,wm=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Cm=g.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:a,onDismiss:l,...c}=t,d=g.useContext(wm),[u,h]=g.useState(null),p=u?.ownerDocument??globalThis?.document,[,m]=g.useState({}),y=Ki(e,k=>h(k)),f=Array.from(d.layers),[b]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),S=f.indexOf(b),C=u?f.indexOf(u):-1,j=d.layersWithOutsidePointerEventsDisabled.size>0,w=C>=S,v=Sw(k=>{const T=k.target,N=[...d.branches].some(R=>R.contains(T));!w||N||(r?.(k),a?.(k),k.defaultPrevented||l?.())},p),E=kw(k=>{const T=k.target;[...d.branches].some(R=>R.contains(T))||(o?.(k),a?.(k),k.defaultPrevented||l?.())},p);return gw(k=>{C===d.layers.size-1&&(i?.(k),!k.defaultPrevented&&l&&(k.preventDefault(),l()))},p),g.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(xh=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),yh(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=xh)}},[u,p,n,d]),g.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),yh())},[u,d]),g.useEffect(()=>{const k=()=>m({});return document.addEventListener(Hl,k),()=>document.removeEventListener(Hl,k)},[]),s.jsx(ii.div,{...c,ref:y,style:{pointerEvents:j?w?"auto":"none":void 0,...t.style},onFocusCapture:mi(t.onFocusCapture,E.onFocusCapture),onBlurCapture:mi(t.onBlurCapture,E.onBlurCapture),onPointerDownCapture:mi(t.onPointerDownCapture,v.onPointerDownCapture)})});Cm.displayName=mw;var bw="DismissableLayerBranch",vw=g.forwardRef((t,e)=>{const n=g.useContext(wm),i=g.useRef(null),r=Ki(e,i);return g.useEffect(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),s.jsx(ii.div,{...t,ref:r})});vw.displayName=bw;function Sw(t,e=globalThis?.document){const n=wr(t),i=g.useRef(!1),r=g.useRef(()=>{});return g.useEffect(()=>{const o=l=>{if(l.target&&!i.current){let c=function(){jm(xw,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function kw(t,e=globalThis?.document){const n=wr(t),i=g.useRef(!1);return g.useEffect(()=>{const r=o=>{o.target&&!i.current&&jm(yw,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function yh(){const t=new CustomEvent(Hl);document.dispatchEvent(t)}function jm(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?fw(r,o):r.dispatchEvent(o)}var Ua="focusScope.autoFocusOnMount",Wa="focusScope.autoFocusOnUnmount",bh={bubbles:!1,cancelable:!0},ww="FocusScope",Tm=g.forwardRef((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...a}=t,[l,c]=g.useState(null),d=wr(r),u=wr(o),h=g.useRef(null),p=Ki(e,f=>c(f)),m=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(i){let f=function(j){if(m.paused||!l)return;const w=j.target;l.contains(w)?h.current=w:ui(h.current,{select:!0})},b=function(j){if(m.paused||!l)return;const w=j.relatedTarget;w!==null&&(l.contains(w)||ui(h.current,{select:!0}))},S=function(j){if(document.activeElement===document.body)for(const v of j)v.removedNodes.length>0&&ui(l)};document.addEventListener("focusin",f),document.addEventListener("focusout",b);const C=new MutationObserver(S);return l&&C.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",b),C.disconnect()}}},[i,l,m.paused]),g.useEffect(()=>{if(l){Sh.add(m);const f=document.activeElement;if(!l.contains(f)){const S=new CustomEvent(Ua,bh);l.addEventListener(Ua,d),l.dispatchEvent(S),S.defaultPrevented||(Cw(Iw(Em(l)),{select:!0}),document.activeElement===f&&ui(l))}return()=>{l.removeEventListener(Ua,d),setTimeout(()=>{const S=new CustomEvent(Wa,bh);l.addEventListener(Wa,u),l.dispatchEvent(S),S.defaultPrevented||ui(f??document.body,{select:!0}),l.removeEventListener(Wa,u),Sh.remove(m)},0)}}},[l,d,u,m]);const y=g.useCallback(f=>{if(!n&&!i||m.paused)return;const b=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,S=document.activeElement;if(b&&S){const C=f.currentTarget,[j,w]=jw(C);j&&w?!f.shiftKey&&S===w?(f.preventDefault(),n&&ui(j,{select:!0})):f.shiftKey&&S===j&&(f.preventDefault(),n&&ui(w,{select:!0})):S===C&&f.preventDefault()}},[n,i,m.paused]);return s.jsx(ii.div,{tabIndex:-1,...a,ref:p,onKeyDown:y})});Tm.displayName=ww;function Cw(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(ui(i,{select:e}),document.activeElement!==n)return}function jw(t){const e=Em(t),n=vh(e,t),i=vh(e.reverse(),t);return[n,i]}function Em(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function vh(t,e){for(const n of t)if(!Tw(n,{upTo:e}))return n}function Tw(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Ew(t){return t instanceof HTMLInputElement&&"select"in t}function ui(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&Ew(t)&&e&&t.select()}}var Sh=Rw();function Rw(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=kh(t,e),t.unshift(e)},remove(e){t=kh(t,e),t[0]?.resume()}}}function kh(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function Iw(t){return t.filter(e=>e.tagName!=="A")}var _w="Portal",Rm=g.forwardRef((t,e)=>{const{container:n,...i}=t,[r,o]=g.useState(!1);kr(()=>o(!0),[]);const a=n||r&&globalThis?.document?.body;return a?aw.createPortal(s.jsx(ii.div,{...i,ref:e}),a):null});Rm.displayName=_w;function Nw(t,e){return g.useReducer((n,i)=>e[n][i]??n,t)}var la=t=>{const{present:e,children:n}=t,i=Aw(e),r=typeof n=="function"?n({present:i.isPresent}):g.Children.only(n),o=Ki(i.ref,Pw(r));return typeof n=="function"||i.isPresent?g.cloneElement(r,{ref:o}):null};la.displayName="Presence";function Aw(t){const[e,n]=g.useState(),i=g.useRef(null),r=g.useRef(t),o=g.useRef("none"),a=t?"mounted":"unmounted",[l,c]=Nw(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const d=Yr(i.current);o.current=l==="mounted"?d:"none"},[l]),kr(()=>{const d=i.current,u=r.current;if(u!==t){const p=o.current,m=Yr(d);t?c("MOUNT"):m==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,c]),kr(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,h=m=>{const f=Yr(i.current).includes(CSS.escape(m.animationName));if(m.target===e&&f&&(c("ANIMATION_END"),!r.current)){const b=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=b)})}},p=m=>{m.target===e&&(o.current=Yr(i.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:g.useCallback(d=>{i.current=d?getComputedStyle(d):null,n(d)},[])}}function Yr(t){return t?.animationName||"none"}function Pw(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Va=0;function Mw(){g.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??wh()),document.body.insertAdjacentElement("beforeend",t[1]??wh()),Va++,()=>{Va===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Va--}},[])}function wh(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var In=function(){return In=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},In.apply(this,arguments)};function Im(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function Dw(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}var po="right-scroll-bar-position",fo="width-before-scroll-bar",Ow="with-scroll-bars-hidden",Lw="--removed-body-scroll-bar-size";function $a(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Fw(t,e){var n=g.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var Bw=typeof window<"u"?g.useLayoutEffect:g.useEffect,Ch=new WeakMap;function zw(t,e){var n=Fw(null,function(i){return t.forEach(function(r){return $a(r,i)})});return Bw(function(){var i=Ch.get(n);if(i){var r=new Set(i),o=new Set(t),a=n.current;r.forEach(function(l){o.has(l)||$a(l,null)}),o.forEach(function(l){r.has(l)||$a(l,a)})}Ch.set(n,t)},[t]),n}function Uw(t){return t}function Ww(t,e){e===void 0&&(e=Uw);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var a=e(o,i);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(i=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){i=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var u=a;a=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){a.push(u),d()},filter:function(u){return a=a.filter(u),n}}}};return r}function Vw(t){t===void 0&&(t={});var e=Ww(null);return e.options=In({async:!0,ssr:!1},t),e}var _m=function(t){var e=t.sideCar,n=Im(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return g.createElement(i,In({},n))};_m.isSideCarExport=!0;function $w(t,e){return t.useMedium(e),_m}var Nm=Vw(),Ga=function(){},ca=g.forwardRef(function(t,e){var n=g.useRef(null),i=g.useState({onScrollCapture:Ga,onWheelCapture:Ga,onTouchMoveCapture:Ga}),r=i[0],o=i[1],a=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,h=t.shards,p=t.sideCar,m=t.noRelative,y=t.noIsolation,f=t.inert,b=t.allowPinchZoom,S=t.as,C=S===void 0?"div":S,j=t.gapMode,w=Im(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),v=p,E=zw([n,e]),k=In(In({},w),r);return g.createElement(g.Fragment,null,u&&g.createElement(v,{sideCar:Nm,removeScrollBar:d,shards:h,noRelative:m,noIsolation:y,inert:f,setCallbacks:o,allowPinchZoom:!!b,lockRef:n,gapMode:j}),a?g.cloneElement(g.Children.only(l),In(In({},k),{ref:E})):g.createElement(C,In({},k,{className:c,ref:E}),l))});ca.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ca.classNames={fullWidth:fo,zeroRight:po};var Gw=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function qw(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Gw();return e&&t.setAttribute("nonce",e),t}function Hw(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Kw(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Yw=function(){var t=0,e=null;return{add:function(n){t==0&&(e=qw())&&(Hw(e,n),Kw(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Jw=function(){var t=Yw();return function(e,n){g.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Am=function(){var t=Jw(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},Xw={left:0,top:0,right:0,gap:0},qa=function(t){return parseInt(t||"",10)||0},Zw=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[qa(n),qa(i),qa(r)]},Qw=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Xw;var e=Zw(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},eC=Am(),ms="data-scroll-locked",tC=function(t,e,n,i){var r=t.left,o=t.top,a=t.right,l=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ow,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(l,"px ").concat(i,`;
  }
  body[`).concat(ms,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(po,` {
    right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(fo,` {
    margin-right: `).concat(l,"px ").concat(i,`;
  }
  
  .`).concat(po," .").concat(po,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(fo," .").concat(fo,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(ms,`] {
    `).concat(Lw,": ").concat(l,`px;
  }
`)},jh=function(){var t=parseInt(document.body.getAttribute(ms)||"0",10);return isFinite(t)?t:0},nC=function(){g.useEffect(function(){return document.body.setAttribute(ms,(jh()+1).toString()),function(){var t=jh()-1;t<=0?document.body.removeAttribute(ms):document.body.setAttribute(ms,t.toString())}},[])},iC=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;nC();var o=g.useMemo(function(){return Qw(r)},[r]);return g.createElement(eC,{styles:tC(o,!e,r,n?"":"!important")})},Kl=!1;if(typeof window<"u")try{var Jr=Object.defineProperty({},"passive",{get:function(){return Kl=!0,!0}});window.addEventListener("test",Jr,Jr),window.removeEventListener("test",Jr,Jr)}catch{Kl=!1}var Zi=Kl?{passive:!1}:!1,sC=function(t){return t.tagName==="TEXTAREA"},Pm=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!sC(t)&&n[e]==="visible")},rC=function(t){return Pm(t,"overflowY")},oC=function(t){return Pm(t,"overflowX")},Th=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=Mm(t,i);if(r){var o=Dm(t,i),a=o[1],l=o[2];if(a>l)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},aC=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},lC=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},Mm=function(t,e){return t==="v"?rC(e):oC(e)},Dm=function(t,e){return t==="v"?aC(e):lC(e)},cC=function(t,e){return t==="h"&&e==="rtl"?-1:1},dC=function(t,e,n,i,r){var o=cC(t,window.getComputedStyle(e).direction),a=o*i,l=n.target,c=e.contains(l),d=!1,u=a>0,h=0,p=0;do{if(!l)break;var m=Dm(t,l),y=m[0],f=m[1],b=m[2],S=f-b-o*y;(y||S)&&Mm(t,l)&&(h+=S,p+=y);var C=l.parentNode;l=C&&C.nodeType===Node.DOCUMENT_FRAGMENT_NODE?C.host:C}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(d=!0),d},Xr=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Eh=function(t){return[t.deltaX,t.deltaY]},Rh=function(t){return t&&"current"in t?t.current:t},uC=function(t,e){return t[0]===e[0]&&t[1]===e[1]},hC=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},pC=0,Qi=[];function fC(t){var e=g.useRef([]),n=g.useRef([0,0]),i=g.useRef(),r=g.useState(pC++)[0],o=g.useState(Am)[0],a=g.useRef(t);g.useEffect(function(){a.current=t},[t]),g.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var f=Dw([t.lockRef.current],(t.shards||[]).map(Rh),!0).filter(Boolean);return f.forEach(function(b){return b.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),f.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var l=g.useCallback(function(f,b){if("touches"in f&&f.touches.length===2||f.type==="wheel"&&f.ctrlKey)return!a.current.allowPinchZoom;var S=Xr(f),C=n.current,j="deltaX"in f?f.deltaX:C[0]-S[0],w="deltaY"in f?f.deltaY:C[1]-S[1],v,E=f.target,k=Math.abs(j)>Math.abs(w)?"h":"v";if("touches"in f&&k==="h"&&E.type==="range")return!1;var T=Th(k,E);if(!T)return!0;if(T?v=k:(v=k==="v"?"h":"v",T=Th(k,E)),!T)return!1;if(!i.current&&"changedTouches"in f&&(j||w)&&(i.current=v),!v)return!0;var N=i.current||v;return dC(N,b,f,N==="h"?j:w)},[]),c=g.useCallback(function(f){var b=f;if(!(!Qi.length||Qi[Qi.length-1]!==o)){var S="deltaY"in b?Eh(b):Xr(b),C=e.current.filter(function(v){return v.name===b.type&&(v.target===b.target||b.target===v.shadowParent)&&uC(v.delta,S)})[0];if(C&&C.should){b.cancelable&&b.preventDefault();return}if(!C){var j=(a.current.shards||[]).map(Rh).filter(Boolean).filter(function(v){return v.contains(b.target)}),w=j.length>0?l(b,j[0]):!a.current.noIsolation;w&&b.cancelable&&b.preventDefault()}}},[]),d=g.useCallback(function(f,b,S,C){var j={name:f,delta:b,target:S,should:C,shadowParent:gC(S)};e.current.push(j),setTimeout(function(){e.current=e.current.filter(function(w){return w!==j})},1)},[]),u=g.useCallback(function(f){n.current=Xr(f),i.current=void 0},[]),h=g.useCallback(function(f){d(f.type,Eh(f),f.target,l(f,t.lockRef.current))},[]),p=g.useCallback(function(f){d(f.type,Xr(f),f.target,l(f,t.lockRef.current))},[]);g.useEffect(function(){return Qi.push(o),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Zi),document.addEventListener("touchmove",c,Zi),document.addEventListener("touchstart",u,Zi),function(){Qi=Qi.filter(function(f){return f!==o}),document.removeEventListener("wheel",c,Zi),document.removeEventListener("touchmove",c,Zi),document.removeEventListener("touchstart",u,Zi)}},[]);var m=t.removeScrollBar,y=t.inert;return g.createElement(g.Fragment,null,y?g.createElement(o,{styles:hC(r)}):null,m?g.createElement(iC,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function gC(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const mC=$w(Nm,fC);var Om=g.forwardRef(function(t,e){return g.createElement(ca,In({},t,{ref:e,sideCar:mC}))});Om.classNames=ca.classNames;var xC=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},es=new WeakMap,Zr=new WeakMap,Qr={},Ha=0,Lm=function(t){return t&&(t.host||Lm(t.parentNode))},yC=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=Lm(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},bC=function(t,e,n,i){var r=yC(e,Array.isArray(t)?t:[t]);Qr[n]||(Qr[n]=new WeakMap);var o=Qr[n],a=[],l=new Set,c=new Set(r),d=function(h){!h||l.has(h)||(l.add(h),d(h.parentNode))};r.forEach(d);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(l.has(p))u(p);else try{var m=p.getAttribute(i),y=m!==null&&m!=="false",f=(es.get(p)||0)+1,b=(o.get(p)||0)+1;es.set(p,f),o.set(p,b),a.push(p),f===1&&y&&Zr.set(p,!0),b===1&&p.setAttribute(n,"true"),y||p.setAttribute(i,"true")}catch(S){console.error("aria-hidden: cannot operate on ",p,S)}})};return u(e),l.clear(),Ha++,function(){a.forEach(function(h){var p=es.get(h)-1,m=o.get(h)-1;es.set(h,p),o.set(h,m),p||(Zr.has(h)||h.removeAttribute(i),Zr.delete(h)),m||h.removeAttribute(n)}),Ha--,Ha||(es=new WeakMap,es=new WeakMap,Zr=new WeakMap,Qr={})}},vC=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=xC(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),bC(i,r,n,"aria-hidden")):function(){return null}},da="Dialog",[Fm]=Qk(da),[SC,Cn]=Fm(da),Bm=t=>{const{__scopeDialog:e,children:n,open:i,defaultOpen:r,onOpenChange:o,modal:a=!0}=t,l=g.useRef(null),c=g.useRef(null),[d,u]=sw({prop:i,defaultProp:r??!1,onChange:o,caller:da});return s.jsx(SC,{scope:e,triggerRef:l,contentRef:c,contentId:za(),titleId:za(),descriptionId:za(),open:d,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(h=>!h),[u]),modal:a,children:n})};Bm.displayName=da;var zm="DialogTrigger",kC=g.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Cn(zm,n),o=Ki(e,r.triggerRef);return s.jsx(ii.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":xd(r.open),...i,ref:o,onClick:mi(t.onClick,r.onOpenToggle)})});kC.displayName=zm;var gd="DialogPortal",[wC,Um]=Fm(gd,{forceMount:void 0}),Wm=t=>{const{__scopeDialog:e,forceMount:n,children:i,container:r}=t,o=Cn(gd,e);return s.jsx(wC,{scope:e,forceMount:n,children:g.Children.map(i,a=>s.jsx(la,{present:n||o.open,children:s.jsx(Rm,{asChild:!0,container:r,children:a})}))})};Wm.displayName=gd;var Bo="DialogOverlay",Vm=g.forwardRef((t,e)=>{const n=Um(Bo,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=Cn(Bo,t.__scopeDialog);return o.modal?s.jsx(la,{present:i||o.open,children:s.jsx(jC,{...r,ref:e})}):null});Vm.displayName=Bo;var CC=km("DialogOverlay.RemoveScroll"),jC=g.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Cn(Bo,n);return s.jsx(Om,{as:CC,allowPinchZoom:!0,shards:[r.contentRef],children:s.jsx(ii.div,{"data-state":xd(r.open),...i,ref:e,style:{pointerEvents:"auto",...i.style}})})}),Ui="DialogContent",$m=g.forwardRef((t,e)=>{const n=Um(Ui,t.__scopeDialog),{forceMount:i=n.forceMount,...r}=t,o=Cn(Ui,t.__scopeDialog);return s.jsx(la,{present:i||o.open,children:o.modal?s.jsx(TC,{...r,ref:e}):s.jsx(EC,{...r,ref:e})})});$m.displayName=Ui;var TC=g.forwardRef((t,e)=>{const n=Cn(Ui,t.__scopeDialog),i=g.useRef(null),r=Ki(e,n.contentRef,i);return g.useEffect(()=>{const o=i.current;if(o)return vC(o)},[]),s.jsx(Gm,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:mi(t.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:mi(t.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:mi(t.onFocusOutside,o=>o.preventDefault())})}),EC=g.forwardRef((t,e)=>{const n=Cn(Ui,t.__scopeDialog),i=g.useRef(!1),r=g.useRef(!1);return s.jsx(Gm,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(i.current||n.triggerRef.current?.focus(),o.preventDefault()),i.current=!1,r.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(i.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const a=o.target;n.triggerRef.current?.contains(a)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),Gm=g.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,...a}=t,l=Cn(Ui,n),c=g.useRef(null),d=Ki(e,c);return Mw(),s.jsxs(s.Fragment,{children:[s.jsx(Tm,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:o,children:s.jsx(Cm,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":xd(l.open),...a,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),s.jsxs(s.Fragment,{children:[s.jsx(RC,{titleId:l.titleId}),s.jsx(_C,{contentRef:c,descriptionId:l.descriptionId})]})]})}),md="DialogTitle",qm=g.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Cn(md,n);return s.jsx(ii.h2,{id:r.titleId,...i,ref:e})});qm.displayName=md;var Hm="DialogDescription",Km=g.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Cn(Hm,n);return s.jsx(ii.p,{id:r.descriptionId,...i,ref:e})});Km.displayName=Hm;var Ym="DialogClose",Jm=g.forwardRef((t,e)=>{const{__scopeDialog:n,...i}=t,r=Cn(Ym,n);return s.jsx(ii.button,{type:"button",...i,ref:e,onClick:mi(t.onClick,()=>r.onOpenChange(!1))})});Jm.displayName=Ym;function xd(t){return t?"open":"closed"}var Xm="DialogTitleWarning",[_A,Zm]=Zk(Xm,{contentName:Ui,titleName:md,docsSlug:"dialog"}),RC=({titleId:t})=>{const e=Zm(Xm),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return g.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},IC="DialogDescriptionWarning",_C=({contentRef:t,descriptionId:e})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Zm(IC).contentName}}.`;return g.useEffect(()=>{const r=t.current?.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(i))},[i,t,e]),null},NC=Bm,AC=Wm,Qm=Vm,ex=$m,tx=qm,nx=Km,PC=Jm;function ix(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=ix(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function sx(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=ix(t))&&(i&&(i+=" "),i+=e);return i}const yd="-",MC=t=>{const e=OC(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:a=>{const l=a.split(yd);return l[0]===""&&l.length!==1&&l.shift(),rx(l,e)||DC(a)},getConflictingClassGroupIds:(a,l)=>{const c=n[a]||[];return l&&i[a]?[...c,...i[a]]:c}}},rx=(t,e)=>{if(t.length===0)return e.classGroupId;const n=t[0],i=e.nextPart.get(n),r=i?rx(t.slice(1),i):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join(yd);return e.validators.find(({validator:a})=>a(o))?.classGroupId},Ih=/^\[(.+)\]$/,DC=t=>{if(Ih.test(t)){const e=Ih.exec(t)[1],n=e?.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},OC=t=>{const{theme:e,prefix:n}=t,i={nextPart:new Map,validators:[]};return FC(Object.entries(t.classGroups),n).forEach(([o,a])=>{Yl(a,i,o,e)}),i},Yl=(t,e,n,i)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:_h(e,r);o.classGroupId=n;return}if(typeof r=="function"){if(LC(r)){Yl(r(i),e,n,i);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,a])=>{Yl(a,_h(e,o),n,i)})})},_h=(t,e)=>{let n=t;return e.split(yd).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n},LC=t=>t.isThemeGetter,FC=(t,e)=>e?t.map(([n,i])=>{const r=i.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,l])=>[e+a,l])):o);return[n,r]}):t,BC=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,i=new Map;const r=(o,a)=>{n.set(o,a),e++,e>t&&(e=0,i=n,n=new Map)};return{get(o){let a=n.get(o);if(a!==void 0)return a;if((a=i.get(o))!==void 0)return r(o,a),a},set(o,a){n.has(o)?n.set(o,a):r(o,a)}}},ox="!",zC=t=>{const{separator:e,experimentalParseClassName:n}=t,i=e.length===1,r=e[0],o=e.length,a=l=>{const c=[];let d=0,u=0,h;for(let b=0;b<l.length;b++){let S=l[b];if(d===0){if(S===r&&(i||l.slice(b,b+o)===e)){c.push(l.slice(u,b)),u=b+o;continue}if(S==="/"){h=b;continue}}S==="["?d++:S==="]"&&d--}const p=c.length===0?l:l.substring(u),m=p.startsWith(ox),y=m?p.substring(1):p,f=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:y,maybePostfixModifierPosition:f}};return n?l=>n({className:l,parseClassName:a}):a},UC=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(i=>{i[0]==="["?(e.push(...n.sort(),i),n=[]):n.push(i)}),e.push(...n.sort()),e},WC=t=>({cache:BC(t.cacheSize),parseClassName:zC(t),...MC(t)}),VC=/\s+/,$C=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r}=e,o=[],a=t.trim().split(VC);let l="";for(let c=a.length-1;c>=0;c-=1){const d=a[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:m}=n(d);let y=!!m,f=i(y?p.substring(0,m):p);if(!f){if(!y){l=d+(l.length>0?" "+l:l);continue}if(f=i(p),!f){l=d+(l.length>0?" "+l:l);continue}y=!1}const b=UC(u).join(":"),S=h?b+ox:b,C=S+f;if(o.includes(C))continue;o.push(C);const j=r(f,y);for(let w=0;w<j.length;++w){const v=j[w];o.push(S+v)}l=d+(l.length>0?" "+l:l)}return l};function GC(){let t=0,e,n,i="";for(;t<arguments.length;)(e=arguments[t++])&&(n=ax(e))&&(i&&(i+=" "),i+=n);return i}const ax=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=ax(t[i]))&&(n&&(n+=" "),n+=e);return n};function qC(t,...e){let n,i,r,o=a;function a(c){const d=e.reduce((u,h)=>h(u),t());return n=WC(d),i=n.cache.get,r=n.cache.set,o=l,l(c)}function l(c){const d=i(c);if(d)return d;const u=$C(c,n);return r(c,u),u}return function(){return o(GC.apply(null,arguments))}}const Ue=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},lx=/^\[(?:([a-z-]+):)?(.+)\]$/i,HC=/^\d+\/\d+$/,KC=new Set(["px","full","screen"]),YC=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,JC=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,XC=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,ZC=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,QC=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,zn=t=>xs(t)||KC.has(t)||HC.test(t),oi=t=>zs(t,"length",aj),xs=t=>!!t&&!Number.isNaN(Number(t)),Ka=t=>zs(t,"number",xs),Vs=t=>!!t&&Number.isInteger(Number(t)),ej=t=>t.endsWith("%")&&xs(t.slice(0,-1)),me=t=>lx.test(t),ai=t=>YC.test(t),tj=new Set(["length","size","percentage"]),nj=t=>zs(t,tj,cx),ij=t=>zs(t,"position",cx),sj=new Set(["image","url"]),rj=t=>zs(t,sj,cj),oj=t=>zs(t,"",lj),$s=()=>!0,zs=(t,e,n)=>{const i=lx.exec(t);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):n(i[2]):!1},aj=t=>JC.test(t)&&!XC.test(t),cx=()=>!1,lj=t=>ZC.test(t),cj=t=>QC.test(t),dj=()=>{const t=Ue("colors"),e=Ue("spacing"),n=Ue("blur"),i=Ue("brightness"),r=Ue("borderColor"),o=Ue("borderRadius"),a=Ue("borderSpacing"),l=Ue("borderWidth"),c=Ue("contrast"),d=Ue("grayscale"),u=Ue("hueRotate"),h=Ue("invert"),p=Ue("gap"),m=Ue("gradientColorStops"),y=Ue("gradientColorStopPositions"),f=Ue("inset"),b=Ue("margin"),S=Ue("opacity"),C=Ue("padding"),j=Ue("saturate"),w=Ue("scale"),v=Ue("sepia"),E=Ue("skew"),k=Ue("space"),T=Ue("translate"),N=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],_=()=>["auto",me,e],A=()=>[me,e],Y=()=>["",zn,oi],H=()=>["auto",xs,me],$=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],K=()=>["solid","dashed","dotted","double","none"],O=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],F=()=>["","0",me],D=()=>["auto","avoid","all","avoid-page","page","left","right","column"],B=()=>[xs,me];return{cacheSize:500,separator:":",theme:{colors:[$s],spacing:[zn,oi],blur:["none","",ai,me],brightness:B(),borderColor:[t],borderRadius:["none","","full",ai,me],borderSpacing:A(),borderWidth:Y(),contrast:B(),grayscale:F(),hueRotate:B(),invert:F(),gap:A(),gradientColorStops:[t],gradientColorStopPositions:[ej,oi],inset:_(),margin:_(),opacity:B(),padding:A(),saturate:B(),scale:B(),sepia:F(),skew:B(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",me]}],container:["container"],columns:[{columns:[ai]}],"break-after":[{"break-after":D()}],"break-before":[{"break-before":D()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...$(),me]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:N()}],"overscroll-x":[{"overscroll-x":N()}],"overscroll-y":[{"overscroll-y":N()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Vs,me]}],basis:[{basis:_()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",me]}],grow:[{grow:F()}],shrink:[{shrink:F()}],order:[{order:["first","last","none",Vs,me]}],"grid-cols":[{"grid-cols":[$s]}],"col-start-end":[{col:["auto",{span:["full",Vs,me]},me]}],"col-start":[{"col-start":H()}],"col-end":[{"col-end":H()}],"grid-rows":[{"grid-rows":[$s]}],"row-start-end":[{row:["auto",{span:[Vs,me]},me]}],"row-start":[{"row-start":H()}],"row-end":[{"row-end":H()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",me]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",me]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[C]}],px:[{px:[C]}],py:[{py:[C]}],ps:[{ps:[C]}],pe:[{pe:[C]}],pt:[{pt:[C]}],pr:[{pr:[C]}],pb:[{pb:[C]}],pl:[{pl:[C]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",me,e]}],"min-w":[{"min-w":[me,e,"min","max","fit"]}],"max-w":[{"max-w":[me,e,"none","full","min","max","fit","prose",{screen:[ai]},ai]}],h:[{h:[me,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[me,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[me,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[me,e,"auto","min","max","fit"]}],"font-size":[{text:["base",ai,oi]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ka]}],"font-family":[{font:[$s]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",me]}],"line-clamp":[{"line-clamp":["none",xs,Ka]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",zn,me]}],"list-image":[{"list-image":["none",me]}],"list-style-type":[{list:["none","disc","decimal",me]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[S]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[S]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...K(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",zn,oi]}],"underline-offset":[{"underline-offset":["auto",zn,me]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",me]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",me]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[S]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...$(),ij]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",nj]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},rj]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[S]}],"border-style":[{border:[...K(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[S]}],"divide-style":[{divide:K()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...K()]}],"outline-offset":[{"outline-offset":[zn,me]}],"outline-w":[{outline:[zn,oi]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:Y()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[S]}],"ring-offset-w":[{"ring-offset":[zn,oi]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",ai,oj]}],"shadow-color":[{shadow:[$s]}],opacity:[{opacity:[S]}],"mix-blend":[{"mix-blend":[...O(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":O()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",ai,me]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[j]}],sepia:[{sepia:[v]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[S]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[v]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",me]}],duration:[{duration:B()}],ease:[{ease:["linear","in","out","in-out",me]}],delay:[{delay:B()}],animate:[{animate:["none","spin","ping","pulse","bounce",me]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Vs,me]}],"translate-x":[{"translate-x":[T]}],"translate-y":[{"translate-y":[T]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",me]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",me]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",me]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[zn,oi,Ka]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},uj=qC(dj);function oe(...t){return uj(sx(t))}const Kt=g.forwardRef(({onOpenChange:t,...e},n)=>{const i=g.useCallback(r=>{t&&t(r)},[t]);return s.jsx(NC,{onOpenChange:i,...e})});Kt.displayName="Dialog";const hj=AC,dx=g.forwardRef(({className:t,...e},n)=>s.jsx(Qm,{ref:n,className:oe("fixed inset-0 z-[99] bg-slate-900/60 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));dx.displayName=Qm.displayName;const Yt=g.forwardRef(({className:t,children:e,...n},i)=>s.jsxs(hj,{children:[s.jsx(dx,{}),s.jsxs(ex,{ref:i,className:oe("fixed left-[50%] top-[50%] z-[99] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4","border border-slate-200 bg-white p-6 shadow-2xl rounded-2xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...n,children:[e,s.jsxs(PC,{style:{position:"absolute",right:"16px",top:"16px",borderRadius:"8px",padding:"6px",color:"#94a3b8",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:r=>{r.currentTarget.style.color="#475569",r.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.color="#94a3b8",r.currentTarget.style.backgroundColor="transparent"},children:[s.jsx(kn,{style:{width:"20px",height:"20px"}}),s.jsx("span",{className:"sr-only",children:"Schlieen"})]})]})]}));Yt.displayName=ex.displayName;const Jt=({className:t,...e})=>s.jsx("div",{className:oe("flex flex-col space-y-2 text-center sm:text-left",t),...e});Jt.displayName="DialogHeader";const cn=({className:t,...e})=>s.jsx("div",{className:oe("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end pt-4",t),...e});cn.displayName="DialogFooter";const Xt=g.forwardRef(({className:t,...e},n)=>s.jsx(tx,{ref:n,className:oe("text-xl font-semibold text-slate-900 leading-none tracking-tight",t),...e}));Xt.displayName=tx.displayName;const dn=g.forwardRef(({className:t,...e},n)=>s.jsx(nx,{ref:n,className:oe("text-sm text-slate-600 leading-relaxed",t),...e}));dn.displayName=nx.displayName;var Nh;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(Nh||(Nh={}));var Ah;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(Ah||(Ah={}));var Ph;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Ph||(Ph={}));const Mh=["user","model","function","system"];var Dh;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Dh||(Dh={}));var Oh;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Oh||(Oh={}));var Lh;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Lh||(Lh={}));var Fh;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(Fh||(Fh={}));var cr;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER"})(cr||(cr={}));var Bh;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(Bh||(Bh={}));var zh;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(zh||(zh={}));var Uh;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Uh||(Uh={}));class Bt extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class ts extends Bt{constructor(e,n){super(e),this.response=n}}class ux extends Bt{constructor(e,n,i,r){super(e),this.status=n,this.statusText=i,this.errorDetails=r}}class xi extends Bt{}const pj="https://generativelanguage.googleapis.com",fj="v1beta",gj="0.21.0",mj="genai-js";var Wi;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Wi||(Wi={}));class xj{constructor(e,n,i,r,o){this.model=e,this.task=n,this.apiKey=i,this.stream=r,this.requestOptions=o}toString(){var e,n;const i=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||fj;let o=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||pj}/${i}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function yj(t){const e=[];return t?.apiClient&&e.push(t.apiClient),e.push(`${mj}/${gj}`),e.join(" ")}async function bj(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",yj(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let i=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(r){throw new xi(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${r.message}`)}for(const[r,o]of i.entries()){if(r==="x-goog-api-key")throw new xi(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new xi(`Header name ${r} can only be set using the apiClient field`);n.append(r,o)}}return n}async function vj(t,e,n,i,r,o){const a=new xj(t,e,n,i,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},Cj(o)),{method:"POST",headers:await bj(a),body:r})}}async function Vr(t,e,n,i,r,o={},a=fetch){const{url:l,fetchOptions:c}=await vj(t,e,n,i,r,o);return Sj(l,c,a)}async function Sj(t,e,n=fetch){let i;try{i=await n(t,e)}catch(r){kj(r,t)}return i.ok||await wj(i,t),i}function kj(t,e){let n=t;throw t instanceof ux||t instanceof xi||(n=new Bt(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function wj(t,e){let n="",i;try{const r=await t.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,i=r.error.details)}catch{}throw new ux(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,i)}function Cj(t){const e={};if(t?.signal!==void 0||t?.timeout>=0){const n=new AbortController;t?.timeout>=0&&setTimeout(()=>n.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}function bd(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),go(t.candidates[0]))throw new ts(`${pi(t)}`,t);return jj(t)}else if(t.promptFeedback)throw new ts(`Text not available. ${pi(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),go(t.candidates[0]))throw new ts(`${pi(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Wh(t)[0]}else if(t.promptFeedback)throw new ts(`Function call not available. ${pi(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),go(t.candidates[0]))throw new ts(`${pi(t)}`,t);return Wh(t)}else if(t.promptFeedback)throw new ts(`Function call not available. ${pi(t)}`,t)},t}function jj(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function Wh(t){var e,n,i,r;const o=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const a of(r=(i=t.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}const Tj=[cr.RECITATION,cr.SAFETY,cr.LANGUAGE];function go(t){return!!t.finishReason&&Tj.includes(t.finishReason)}function pi(t){var e,n,i;let r="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)r+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((i=t.candidates)===null||i===void 0)&&i[0]){const o=t.candidates[0];go(o)&&(r+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(r+=`: ${o.finishMessage}`))}return r}function Cr(t){return this instanceof Cr?(this.v=t,this):new Cr(t)}function Ej(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(p){i[p]&&(r[p]=function(m){return new Promise(function(y,f){o.push([p,m,y,f])>1||l(p,m)})})}function l(p,m){try{c(i[p](m))}catch(y){h(o[0][3],y)}}function c(p){p.value instanceof Cr?Promise.resolve(p.value.v).then(d,u):h(o[0][2],p)}function d(p){l("next",p)}function u(p){l("throw",p)}function h(p,m){p(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}const Vh=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Rj(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Nj(e),[i,r]=n.tee();return{stream:_j(i),response:Ij(r)}}async function Ij(t){const e=[],n=t.getReader();for(;;){const{done:i,value:r}=await n.read();if(i)return bd(Aj(e));e.push(r)}}function _j(t){return Ej(this,arguments,function*(){const n=t.getReader();for(;;){const{value:i,done:r}=yield Cr(n.read());if(r)break;yield yield Cr(bd(i))}})}function Nj(t){const e=t.getReader();return new ReadableStream({start(i){let r="";return o();function o(){return e.read().then(({value:a,done:l})=>{if(l){if(r.trim()){i.error(new Bt("Failed to parse stream"));return}i.close();return}r+=a;let c=r.match(Vh),d;for(;c;){try{d=JSON.parse(c[1])}catch{i.error(new Bt(`Error parsing JSON response: "${c[1]}"`));return}i.enqueue(d),r=r.substring(c[0].length),c=r.match(Vh)}return o()})}}})}function Aj(t){const e=t[t.length-1],n={promptFeedback:e?.promptFeedback};for(const i of t){if(i.candidates)for(const r of i.candidates){const o=r.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:r.index}),n.candidates[o].citationMetadata=r.citationMetadata,n.candidates[o].groundingMetadata=r.groundingMetadata,n.candidates[o].finishReason=r.finishReason,n.candidates[o].finishMessage=r.finishMessage,n.candidates[o].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[o].content||(n.candidates[o].content={role:r.content.role||"user",parts:[]});const a={};for(const l of r.content.parts)l.text&&(a.text=l.text),l.functionCall&&(a.functionCall=l.functionCall),l.executableCode&&(a.executableCode=l.executableCode),l.codeExecutionResult&&(a.codeExecutionResult=l.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),n.candidates[o].content.parts.push(a)}}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function hx(t,e,n,i){const r=await Vr(e,Wi.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),i);return Rj(r)}async function px(t,e,n,i){const o=await(await Vr(e,Wi.GENERATE_CONTENT,t,!1,JSON.stringify(n),i)).json();return{response:bd(o)}}function fx(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function jr(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return Pj(e)}function Pj(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,r=!1;for(const o of t)"functionResponse"in o?(n.parts.push(o),r=!0):(e.parts.push(o),i=!0);if(i&&r)throw new Bt("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new Bt("No content is provided for sending chat message.");return i?e:n}function Mj(t,e){var n;let i={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(n=e?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=t.generateContentRequest!=null;if(t.contents){if(r)throw new xi("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=t.contents}else if(r)i=Object.assign(Object.assign({},i),t.generateContentRequest);else{const o=jr(t);i.contents=[o]}return{generateContentRequest:i}}function $h(t){let e;return t.contents?e=t:e={contents:[jr(t)]},t.systemInstruction&&(e.systemInstruction=fx(t.systemInstruction)),e}function Dj(t){return typeof t=="string"||Array.isArray(t)?{content:jr(t)}:t}const Gh=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Oj={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Lj(t){let e=!1;for(const n of t){const{role:i,parts:r}=n;if(!e&&i!=="user")throw new Bt(`First content should be with role 'user', got ${i}`);if(!Mh.includes(i))throw new Bt(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(Mh)}`);if(!Array.isArray(r))throw new Bt("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new Bt("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of r)for(const c of Gh)c in l&&(o[c]+=1);const a=Oj[i];for(const l of Gh)if(!a.includes(l)&&o[l]>0)throw new Bt(`Content with role '${i}' can't contain '${l}' part`);e=!0}}const qh="SILENT_ERROR";class Fj{constructor(e,n,i,r={}){this.model=n,this.params=i,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,i?.history&&(Lj(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=jr(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n);let p;return this._sendPromise=this._sendPromise.then(()=>px(this._apiKey,this.model,u,h)).then(m=>{var y;if(m.response.candidates&&m.response.candidates.length>0){this._history.push(d);const f=Object.assign({parts:[],role:"model"},(y=m.response.candidates)===null||y===void 0?void 0:y[0].content);this._history.push(f)}else{const f=pi(m.response);f&&console.warn(`sendMessage() was unsuccessful. ${f}. Inspect response object for details.`)}p=m}),await this._sendPromise,p}async sendMessageStream(e,n={}){var i,r,o,a,l,c;await this._sendPromise;const d=jr(e),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},h=Object.assign(Object.assign({},this._requestOptions),n),p=hx(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>p).catch(m=>{throw new Error(qh)}).then(m=>m.response).then(m=>{if(m.candidates&&m.candidates.length>0){this._history.push(d);const y=Object.assign({},m.candidates[0].content);y.role||(y.role="model"),this._history.push(y)}else{const y=pi(m);y&&console.warn(`sendMessageStream() was unsuccessful. ${y}. Inspect response object for details.`)}}).catch(m=>{m.message!==qh&&console.error(m)}),p}}async function Bj(t,e,n,i){return(await Vr(e,Wi.COUNT_TOKENS,t,!1,JSON.stringify(n),i)).json()}async function zj(t,e,n,i){return(await Vr(e,Wi.EMBED_CONTENT,t,!1,JSON.stringify(n),i)).json()}async function Uj(t,e,n,i){const r=n.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Vr(e,Wi.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:r}),i)).json()}class Hh{constructor(e,n,i={}){this.apiKey=e,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=fx(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var i;const r=$h(e),o=Object.assign(Object.assign({},this._requestOptions),n);return px(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}async generateContentStream(e,n={}){var i;const r=$h(e),o=Object.assign(Object.assign({},this._requestOptions),n);return hx(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),o)}startChat(e){var n;return new Fj(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const i=Mj(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return Bj(this.apiKey,this.model,i,r)}async embedContent(e,n={}){const i=Dj(e),r=Object.assign(Object.assign({},this._requestOptions),n);return zj(this.apiKey,this.model,i,r)}async batchEmbedContents(e,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return Uj(this.apiKey,this.model,e,i)}}class Wj{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new Bt("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Hh(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,i){if(!e.name)throw new xi("Cached content must contain a `name` field.");if(!e.model)throw new xi("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const a of r)if(n?.[a]&&e[a]&&n?.[a]!==e[a]){if(a==="model"){const l=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(l===c)continue}throw new xi(`Different value for "${a}" specified in modelParams (${n[a]}) and cachedContent (${e[a]})`)}const o=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Hh(this.apiKey,o,i)}}const Pe={CAREER:"CAREER",LEADERSHIP:"LEADERSHIP",SALES:"SALES",COMMUNICATION:"COMMUNICATION"},Tn={[Pe.CAREER]:{key:Pe.CAREER,label:"Bewerbung & Karriere",shortLabel:"Karriere",icon:"Briefcase",color:"#3b82f6",bgColor:"rgba(59, 130, 246, 0.15)"},[Pe.LEADERSHIP]:{key:Pe.LEADERSHIP,label:"Leadership & Fhrung",shortLabel:"Fhrung",icon:"Target",color:"#8b5cf6",bgColor:"rgba(139, 92, 246, 0.15)"},[Pe.SALES]:{key:Pe.SALES,label:"Vertrieb & Verhandlung",shortLabel:"Vertrieb",icon:"TrendingUp",color:"#22c55e",bgColor:"rgba(34, 197, 94, 0.15)"},[Pe.COMMUNICATION]:{key:Pe.COMMUNICATION,label:"Kommunikation & Konflikt",shortLabel:"Kommunikation",icon:"MessageCircle",color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.15)"}};function Vj(t){if(!t)return null;const e=t.toUpperCase();return Tn[e]||null}const $j={interview:Pe.CAREER,negotiation:Pe.SALES,presentation:Pe.COMMUNICATION,leadership:Pe.LEADERSHIP,communication:Pe.COMMUNICATION,sales:Pe.SALES,career:Pe.CAREER};function gx(t){if(!t)return null;const e=t.toUpperCase();if(Pe[e])return e;const n=t.toLowerCase();return $j[n]||Pe.CAREER}const mx={FALLBACK_ORDER:["gemini-2.0-flash-exp","gemini-2.0-flash","gemini-1.5-flash-latest","gemini-1.5-pro-latest"]},ys={EXCELLENT:80,GOOD:60,FAIR:40},Kh={zu_langsam:{position:15,label:"Zu langsam",isOptimal:!1},optimal:{position:50,label:"Optimal",isOptimal:!0},zu_schnell:{position:85,label:"Zu schnell",isOptimal:!1}},Yh={monoton:{icon:"",color:"text-amber-600",bg:"bg-amber-50",label:"Monoton",waveformVariance:5},natrlich:{icon:"",color:"text-blue-600",bg:"bg-blue-50",label:"Natrlich",waveformVariance:15},lebendig:{icon:"",color:"text-green-600",bg:"bg-green-50",label:"Lebendig",waveformVariance:25}},Jh={GOOD:2,MODERATE:5},Gj={SKIP_SECONDS:10},zo={positive:{all:"bg-green-50 border border-green-200 hover:bg-green-100"},negative:{all:"bg-red-50 border border-red-200 hover:bg-red-100"},warning:{all:"bg-amber-50 border border-amber-200 hover:bg-amber-100"},neutral:{all:"bg-white border border-slate-200 hover:bg-blue-50 hover:border-blue-300"}},Ya={agent:{bg:"bg-slate-50",border:"border-l-slate-400",label:"Interviewer",labelColor:"text-slate-600"},user:{bg:"bg-blue-50",border:"border-l-blue-400",label:"Bewerber",labelColor:"text-blue-600"}},Tr={API_KEY_MISSING:"Gemini API key is required",AUDIO_FILE_MISSING:"Audio file is required",TRANSCRIPT_EMPTY:"Transcript is empty",JSON_PARSE_FAILED:"Fehler beim Parsen der Antwort"};function qj(t,e={}){const{roleType:n="interview",userRoleLabel:i="Bewerber",agentRoleLabel:r="Gesprchspartner"}=e;return n==="simulation"?Kj(t,i,r):Hj(t,i,r)}function Hj(t,e,n){return`Du bist ein professioneller Karriere-Coach. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des ${n} (z.B. "H. Mller", "${n}", oder hnliche Kennzeichnungen) dienen NUR als Kontext fr die Fragen.
- Dein gesamtes Feedback, alle Strken, Verbesserungen, Tipps und Bewertungen beziehen sich NUR auf die Antworten und das Verhalten des/der ${e}.
- Bewerte NICHT die Qualitt der Fragen oder das Verhalten des ${n}.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung des Gesamteindrucks des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung",
    "Strke 2: Was gut gemacht wurde",
    "Strke 3: Weitere Strken"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich",
    "Verbesserung 2: Was besser gemacht werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung",
    "Tipp 2: Praktischer Ratschlag",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Antworten des/der ${e}:
- Struktur & Klarheit der Antworten
- Inhalt & Beispiele, die genannt werden
- Motivation & Begeisterung
- Professionalitt & Selbstbewusstsein

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen.

Transkript:
${t}

JSON Feedback:`}function Kj(t,e,n){return`Du bist ein professioneller Coach fr Kommunikation und Gesprchsfhrung. Analysiere das folgende Gesprch-Transkript und gib konstruktives Feedback in "Du"-Form.

KONTEXT: Dies ist eine Simulation, bei der der/die ${e} das Gesprch fhrt und der/die ${n} darauf reagiert.

SEHR WICHTIG: Bewerte AUSSCHLIESSLICH den/die ${e.toUpperCase()}!
- Die Aussagen des/der ${n} dienen als Kontext fr die Reaktionen.
- Dein gesamtes Feedback bezieht sich NUR auf die Gesprchsfhrung, Reaktionen und das Verhalten des/der ${e}.
- Bewerte die Fhigkeit, das Gesprch professionell zu fhren und auf den/die ${n} einzugehen.

WICHTIG: Antworte NUR mit einem JSON-Objekt in folgendem Format (keine zustzlichen Erklrungen):

{
  "summary": "Eine kurze Zusammenfassung der Gesprchsfhrung des/der ${e} (2-3 Stze)",
  "strengths": [
    "Strke 1: Konkrete positive Beobachtung zur Gesprchsfhrung",
    "Strke 2: Was in der Kommunikation gut gemacht wurde",
    "Strke 3: Weitere Strken im Umgang mit dem/der ${n}"
  ],
  "improvements": [
    "Verbesserung 1: Konkreter Verbesserungsbereich in der Gesprchsfhrung",
    "Verbesserung 2: Wie besser auf den/die ${n} eingegangen werden knnte",
    "Verbesserung 3: Weitere Verbesserungspotenziale"
  ],
  "tips": [
    "Tipp 1: Konkrete, umsetzbare Empfehlung fr hnliche Situationen",
    "Tipp 2: Praktischer Ratschlag zur Gesprchsfhrung",
    "Tipp 3: Weitere hilfreiche Tipps"
  ],
  "rating": {
    "overall": 7,
    "communication": 6,
    "motivation": 7,
    "professionalism": 8
  }
}

Bewertungsskala: 1-10 (1=sehr schwach, 10=exzellent)

Analysiere diese Aspekte der Gesprchsfhrung des/der ${e}:
- Gesprchsfhrung & Struktur (Wie gut wurde das Gesprch geleitet?)
- Kundenorientierung & Empathie (Wie gut wurde auf den/die ${n} eingegangen?)
- Problemlsungskompetenz (Wie effektiv wurden Anliegen bearbeitet?)
- Professionalitt & Souvernitt (Wie professionell war das Auftreten?)

Sei konstruktiv, ehrlich und motivierend. Fokussiere auf umsetzbare Verbesserungen fr die Gesprchsfhrung.

Transkript:
${t}

JSON Feedback:`}function Yj(t,e){return t.replace("${transcript}",e)}function Jj(t={}){const{userRoleLabel:e="Bewerber",agentRoleLabel:n="Gesprchspartner",roleType:i="interview"}=t,r=i==="simulation"?`Der/Die ${n} ERFFNET das Gesprch (KI-Stimme).`:`Der/Die ${n} ERFFNET das Gesprch (KI-Stimme, stellt Fragen).`;return`Du bist der Voice-Coach von "KarriereHeld".
Analysiere die Audio-Datei dieses Rollenspiels.

WICHTIG - QUELLEN-TRENNUNG:
Die Aufnahme enthlt ZWEI Stimmen:
1. ${n.toUpperCase()} (KI-Stimme, akzentfrei). ${r}
2. ${e.toUpperCase()} (Mensch, der trainiert wird).

DEINE AUFGABE:
Hre dir das gesamte Audio an, aber bewerte AUSSCHLIESSLICH die Stimme des/der ${e.toUpperCase()} (2).
Ignoriere alles, was der/die ${n} sagt (Pausen, Tempo, Inhalt).

ANALYSE-DIMENSIONEN (NUR ${e.toUpperCase()}):

1. SPEECH CLEANLINESS (Fllwrter)
- Zhle "hm", "h", "Halt", "Eigentlich", "Sozusagen" beim/bei der ${e}.
- Gib GENAUE Zeitstempel an (Format MM:SS).

2. PACING (Tempo)
- Wie wirkt das Sprechtempo in den Sprech-Phasen? (Gehetzt vs. Souvern).
- Notiere auffllige Stellen mit Zeitstempel.

3. TONALITY (Betonung & Melodie)
- Ist die Stimme monoton, natrlich oder lebendig?
- Suche nach Highlights (souvern) oder Lowlights (unsicher/brchig).

4. CONFIDENCE (Wirkung)
- Confidence Score (0-100): Wie sicher klingt der/die ${e} insgesamt?

OUTPUT FORMAT:
Antworte NUR mit einem validen JSON-Objekt. Keine Markdown-Formatierung, kein Einleitungstext.

{
  "audio_metrics": {
    "summary_text": "Kurzes Fazit zur Stimme des/der ${e} (max 2 Stze).",
    "confidence_score": (0-100),

    "speech_cleanliness": {
      "score": (0-100, 100=Perfekt sauber),
      "filler_word_analysis": [
        {
          "word": "hm",
          "count": (Anzahl),
          "examples": [
            {"timestamp": "00:45", "context": "Satzanfang"},
            {"timestamp": "01:20", "context": "Nachdenken"}
          ]
        },
        {
          "word": "Halt/Eigentlich",
          "count": (Anzahl),
          "examples": [
            {"timestamp": "00:32"}
          ]
        }
      ],
      "feedback": "Tipp zur Vermeidung von Fllwrtern."
    },

    "pacing": {
      "rating": "zu_schnell" | "optimal" | "zu_langsam",
      "perceived_wpm": "string (z.B. '~140 WPM')",
      "issues_detected": [
        {"timestamp": "02:10", "issue": "Sehr schnell, wirkt gehetzt"}
      ],
      "feedback": "Feedback zur Geschwindigkeit."
    },

    "tonality": {
      "rating": "monoton" | "natrlich" | "lebendig",
      "highlights": [
        {"timestamp": "00:05", "type": "positive", "note": "Souverner Einstieg"},
        {"timestamp": "03:20", "type": "negative", "note": "Stimme wird unsicher"}
      ],
      "feedback": "Feedback zur Melodie und Betonung."
    }
  }
}

JSON Analyse:`}const Xh=["Warum bin ich die beste Wahl fr diese Position?","Meine grte berufliche Errungenschaft","Was motiviert mich jeden Tag aufzustehen?","Wie ich mit schwierigen Kollegen umgehe","Mein Fhrungsstil in 60 Sekunden","Die wichtigste Lektion meiner Karriere","Wie ich unter Druck arbeite","Warum Teamarbeit mir wichtig ist","Wenn ich ein Tier wre, welches und warum?","Mein perfekter Tag sieht so aus...","Die beste Erfindung der Menschheit","Wenn ich die Welt verndern knnte...","Ein Buch, das mein Leben verndert hat","Mein Lieblingshobby und warum","Drei Dinge, die ich niemals machen wrde","Warum Scheitern wichtig ist","Meine kontroverseste Meinung","Wie ich mit Kritik umgehe"],Zh=["Warum sollten wir ausgerechnet Sie einstellen und nicht einen der 50 anderen Bewerber?","Ihr Lebenslauf zeigt eine Lcke. Was haben Sie in dieser Zeit wirklich gemacht?","Nennen Sie mir drei echte Schwchen - und bitte keine getarnten Strken.","Warum haben Sie Ihren letzten Job wirklich verlassen?","Wo sehen Sie sich in 5 Jahren? Und seien Sie ehrlich.","Was wrde Ihr schlimmster Feind ber Sie sagen?","Wenn ich Ihren letzten Chef anrufe - was wird er mir sagen?","Sie sind offensichtlich berqualifiziert. Werden Sie nicht schnell gelangweilt sein?","Warum haben Sie in Ihrer Karriere nicht mehr erreicht?","berzeugen Sie mich in 30 Sekunden, dass Sie kein Risiko sind.","Was war Ihr grter beruflicher Misserfolg?","Haben Sie andere Angebote? Warum sind wir nicht Ihre erste Wahl?"];function Xj(t="Elevator Pitch",e=60){return`AUDIO-TRANSKRIPTION UND ANALYSE

THEMA: "${t}"

ABSOLUTE REGEL - KEINE HALLUZINATION:
Du DARFST NUR transkribieren, was TATSCHLICH in der Audio-Datei gesprochen wird.
- Bei Stille, Rauschen, oder unverstndlichem Audio: transcript = "[Keine Sprache erkannt]"
- Bei nur 1-2 Sekunden Audio ohne klare Sprache: transcript = "[Keine Sprache erkannt]"
- ERFINDE NIEMALS Wrter, Stze oder Inhalte!
- Wenn du unsicher bist, ob etwas gesagt wurde: NICHT transkribieren!

DEINE AUFGABE (NUR bei klar erkennbarer Sprache):
1. TRANSKRIBIEREN: Schreibe WRTLICH was gesprochen wird - nichts hinzufgen
2. FLLWRTER: Finde diese Wrter im Transkript: "hm", "h", "h", "Mh", "Halt", "Eigentlich", "Sozusagen", "Quasi", "Irgendwie", "Also" (am Satzanfang), "Genau", "Ja also"
3. INHALT: Bewerte wie gut die Antwort zum Thema passt (0-40 Punkte)

INHALTSBEWERTUNG (content_score):
- 0: Keine Sprache / am Thema vorbei / unverstndlich
- 10: Nur ansatzweise zum Thema
- 20: Teilweise zum Thema, aber oberflchlich
- 30: Gut zum Thema, mit Substanz
- 40: Exzellent, strukturiert und berzeugend

OUTPUT - NUR valides JSON:
{
  "transcript": "[Keine Sprache erkannt]",
  "filler_words": [],
  "content_score": 0,
  "content_feedback": "Keine Sprache erkannt."
}

ODER bei erkannter Sprache:
{
  "transcript": "Das was tatschlich gesagt wurde...",
  "filler_words": [{"word": "hm", "count": 1}],
  "content_score": 30,
  "content_feedback": "Kurzes Feedback (1-2 Stze)"
}

ANALYSE DER AUDIO-DATEI:`}const Zj={excellent:{range:[90,100],messages:["Perfekt! Du bist ein Rhetorik-Champion!","Wow! Makellose Prsentation!","Ausgezeichnet! So sieht ein Profi aus!"],emoji:""},good:{range:[70,89],messages:["Sehr gut! Nur kleine Verbesserungen ntig.","Stark! Fast perfekt!","Beeindruckend! Weiter so!"],emoji:""},medium:{range:[50,69],messages:["Solide Leistung! bung macht den Meister.","Guter Ansatz! Da geht noch mehr.","Auf dem richtigen Weg!"],emoji:""},needsWork:{range:[30,49],messages:["Nicht schlecht, aber hier ist Potenzial!","Die Fllwrter haben dich erwischt!","Bleib dran - Verbesserung ist mglich!"],emoji:""},poor:{range:[0,29],messages:["hm... da mssen wir ben!","Die Fllwrter haben gewonnen. Revanche?","Kopf hoch! Jeder Profi hat so angefangen."],emoji:""}};function Qj(t){for(const[,e]of Object.entries(Zj))if(t>=e.range[0]&&t<=e.range[1]){const n=Math.floor(Math.random()*e.messages.length);return{message:e.messages[n],emoji:e.emoji}}return{message:"Weiter ben!",emoji:""}}function eT(){return Xh[Math.floor(Math.random()*Xh.length)]}function tT(){return Zh[Math.floor(Math.random()*Zh.length)]}const nT={klassiker:{id:"klassiker",title:"Der Klassiker",subtitle:"Elevator Pitch",description:"60 Sekunden, um zu berzeugen. Prsentiere dich selbst ohne Fllwrter!",duration:60,icon:"rocket",color:"blue",topic:"Stelle dich selbst vor - wer bist du, was machst du, was ist dein Ziel?"},zufall:{id:"zufall",title:"Zufalls-Thema",subtitle:"Slot Machine",description:"Ein zuflliges Thema, spontan und flieend prsentiert.",duration:60,icon:"shuffle",color:"purple",getTopic:eT},stress:{id:"stress",title:"Stress-Test",subtitle:"berraschungsfrage",description:"Eine knallharte Interview-Frage. Behalte die Nerven!",duration:90,icon:"zap",color:"red",getTopic:tT}};function vd(t,e,n,i={}){const r="=".repeat(80),o=new Date().toISOString();console.log(`
${r}`),console.log(` GEMINI PROMPT DEBUG - ${t}`),console.log(` ${o}`),console.log(r),console.log(` SZENARIO: ${e}`),console.log(r),Object.keys(i).length>0&&(console.log(" METADATA:"),Object.entries(i).forEach(([a,l])=>{typeof l=="string"&&l.length>200?console.log(`   ${a}: ${l.substring(0,200)}... (${l.length} chars)`):console.log(`   ${a}:`,l)}),console.log(r)),console.log(" PROMPT:"),Array.isArray(n)?n.forEach((a,l)=>{typeof a=="string"?(console.log(`--- Teil ${l+1} (Text) ---`),console.log(a)):a.inlineData?(console.log(`--- Teil ${l+1} (Audio/Media) ---`),console.log(`   Type: ${a.inlineData.mimeType}`),console.log(`   Size: ${Math.round(a.inlineData.data.length*.75/1024)} KB (base64)`)):(console.log(`--- Teil ${l+1} (Other) ---`),console.log(JSON.stringify(a,null,2)))}):console.log(n),console.log(r),console.log(`
`)}function iT(t){return!t||t.length<12?"***":`${t.substring(0,8)}...${t.substring(t.length-4)}`}function xx(t){return t.message?.includes("404")||t.message?.includes("not found")}function sT(t){return t.message?.includes("API key")}async function yx(t){return new Promise((e,n)=>{const i=new FileReader;i.onloadend=()=>{const r=i.result.split(",")[1];e({inlineData:{data:r,mimeType:t.type||"audio/webm"}})},i.onerror=()=>n(new Error("Failed to read audio file")),i.readAsDataURL(t)})}function rT(t,e){const n=mx.FALLBACK_ORDER.join(", ");return xx(t)?`Kein Gemini-Modell verfgbar. Versuchte Modelle: ${n}

Mgliche Lsungen:
1. berprfe, ob dein API Key gltig ist
2. Stelle sicher, dass die Gemini API aktiviert ist
3. Besuche https://ai.google.dev/ um deinen API-Key zu berprfen

Fehler: ${t.message}`:sT(t)?`API Key Problem: ${t.message}

Stelle sicher, dass:
1. VITE_GEMINI_API_KEY korrekt in der .env Datei gesetzt ist
2. Der API Key gltig ist (berprfe auf https://ai.google.dev/)`:t.message||"Unbekannter Fehler"}async function Sd({apiKey:t,content:e,context:n}){const i=`[GEMINI ${n}]`;if(!t)throw console.error(` ${i} API key is missing`),new Error(Tr.API_KEY_MISSING);console.log(` ${i} Starting request...`),console.log(` ${i} API Key: ${iT(t)}`);let r=null;for(const a of mx.FALLBACK_ORDER)try{console.log(` ${i} Trying model: ${a}`);const h=(await(await new Wj(t).getGenerativeModel({model:a}).generateContent(e)).response).text();return console.log(` ${i} Success with ${a} (${h.length} chars)`),h}catch(l){if(console.error(` ${i} Error with ${a}:`,l.message),r=l,xx(l)){console.log(` ${i} Model not found, trying next...`);continue}break}const o=rT(r);throw new Error(`Fehler bei der ${n}: ${o}`)}async function oT(t,e,n="gemini-1.5-flash",i=null,r={}){if(!t||t.trim().length===0)throw console.error(" [GEMINI FEEDBACK] Transcript is empty"),new Error(Tr.TRANSCRIPT_EMPTY);console.log(` [GEMINI FEEDBACK] Transcript length: ${t.length} chars`),console.log(` [GEMINI FEEDBACK] Custom prompt: ${i?"Yes":"No"}`),console.log(` [GEMINI FEEDBACK] Role type: ${r.roleType||"interview (default)"}`),console.log(` [GEMINI FEEDBACK] User role label: ${r.userRoleLabel||"Bewerber (default)"}`);const o=i?Yj(i,t):qj(t,r),a=r.roleType==="simulation"?"Simulation":"Interview",l=r.userRoleLabel||"Bewerber";vd("FEEDBACK",`Live-Training (${a}): Analyse des Gesprchs-Transkripts. Bewertet Kommunikation, Professionalitt des/der ${l}.`,o,{"Transkript-Lnge":`${t.length} Zeichen`,"Custom Prompt":i?"Ja":"Nein (Standard-Prompt)",Rollentyp:a,"User-Rolle":l,"Transkript-Vorschau":t.substring(0,300)});const c=await Sd({apiKey:e,content:o,context:"FEEDBACK"});return fe.logPrompt("GEMINI_LIVE_FEEDBACK",`Live-Training Feedback-Generierung (${a})`,o,{transcript_length:t.length,custom_prompt:i?"Ja":"Nein",role_type:r.roleType||"interview",user_role_label:l},c),c}async function aT(t,e,n="gemini-1.5-flash",i={}){if(!t)throw console.error(" [GEMINI AUDIO] Audio file is missing"),new Error(Tr.AUDIO_FILE_MISSING);const r=i.userRoleLabel||"Bewerber",o=i.agentRoleLabel||"Gesprchspartner",a=i.roleType||"interview";console.log(` [GEMINI AUDIO] File size: ${t.size} bytes`),console.log(` [GEMINI AUDIO] File type: ${t.type}`),console.log(` [GEMINI AUDIO] Role type: ${a}`),console.log(` [GEMINI AUDIO] User role: ${r}`),console.log(" [GEMINI AUDIO] Converting audio to base64...");const l=await yx(t);console.log(" [GEMINI AUDIO] Audio converted");const c=Jj({userRoleLabel:r,agentRoleLabel:o,roleType:a}),d=[c,l];vd("AUDIO",`Audio-Analyse: Paraverbale Kommunikation. Analysiert Fllwrter, Sprechtempo, Tonalitt und Selbstsicherheit des/der ${r}.`,d,{"Audio-Dateigre":`${Math.round(t.size/1024)} KB`,"Audio-Typ":t.type,"Analyse-Fokus":`Nur ${r}-Stimme (nicht ${o})`,Rollentyp:a,Metriken:"Fllwrter, Pacing (WPM), Tonalitt, Confidence Score"});const u=await Sd({apiKey:e,content:d,context:"AUDIO"});return fe.logPrompt("GEMINI_LIVE_AUDIO_ANALYSIS",`Live-Training Audio-Analyse (${r})`,c,{audio_size_kb:Math.round(t.size/1024),audio_type:t.type,role_type:a,user_role_label:r},u),u}async function lT(t,e,n="Elevator Pitch",i=60){if(!t)throw console.error(" [GEMINI GAME] Audio file is missing"),new Error(Tr.AUDIO_FILE_MISSING);console.log(" [GEMINI GAME] Starting rhetoric game analysis"),console.log(` [GEMINI GAME] Topic: ${n}`),console.log(` [GEMINI GAME] File size: ${t.size} bytes`);const r=await yx(t),a=[Xj(n,i),r];vd("GAME","Rhetorik-Gym / Fllwort-Killer: Gamification-Analyse. Zhlt Fllwrter, transkribiert Audio, bewertet Inhalt.",a,{Thema:n,"Erwartete Dauer":`${i} Sekunden`,"Audio-Dateigre":`${Math.round(t.size/1024)} KB`,Spielmodus:i===60?"Klassiker/Zufall (60s)":"Stress-Test (90s)",Scoring:"Lokal berechnet: 100 - (Fllwrter  10) + Content-Score"});const l=await Sd({apiKey:e,content:a,context:"GAME"});try{let c=l.trim();c.startsWith("```json")?c=c.replace(/```json\n?/,"").replace(/\n?```$/,""):c.startsWith("```")&&(c=c.replace(/```\n?/,"").replace(/\n?```$/,""));const d=JSON.parse(c);return console.log(" [GEMINI GAME] Analysis complete"),console.log(` [GEMINI GAME] Transcript: ${d.transcript?.substring(0,50)}...`),{transcript:d.transcript||"[Keine Sprache erkannt]",filler_words:d.filler_words||[],content_score:Math.max(0,Math.min(40,d.content_score||0)),content_feedback:d.content_feedback||""}}catch(c){throw console.error(" [GEMINI GAME] Failed to parse response:",c),console.error(" [GEMINI GAME] Raw response:",l),new Error(`${Tr.JSON_PARSE_FAILED}: ${c.message}`)}}function bx(t){return!t||typeof t!="string"?t:t.replace(/\\u([0-9a-fA-F]{4})/g,(e,n)=>String.fromCharCode(parseInt(n,16))).replace(new RegExp("(?<!\\\\)u([0-9a-fA-F]{4})","g"),(e,n)=>{const i=parseInt(n,16);return i>=160&&i<=65535?String.fromCharCode(i):e})}function cT(t){if(!t||typeof t!="string")return t;let e=t.trim();return e.startsWith("```json")?e=e.replace(/^```json\s*/i,"").replace(/\s*```\s*$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```\s*$/,"")),e.trim()}function ua(t,e={}){const{silent:n=!1,context:i="JSON"}=e;if(t==null)return null;if(typeof t=="object")return t;if(typeof t!="string")return n||console.warn(`[parseJSON] Expected string or object, got ${typeof t}`),null;try{let r=cT(t);return r=bx(r),JSON.parse(r)}catch(r){return n||(console.error(`[parseJSON] Failed to parse ${i}:`,r.message),console.error(`[parseJSON] Input preview: ${t.substring(0,100)}...`)),null}}function vx(t){return ua(t,{context:"feedback_json"})}function Sx(t){return ua(t,{context:"audio_analysis_json"})}function kx(t){if(!t)return[];const e=ua(t,{context:"transcript"});return Array.isArray(e)?e:[]}function dT(t){if(!t)return!1;const e=t.audio_metrics;return e?e.confidence_score!==void 0||e.speech_cleanliness!==void 0:!1}function Uo(t){if(t==null)return t;if(typeof t=="string")return bx(t);if(Array.isArray(t))return t.map(Uo);if(typeof t=="object"){const e={};for(const n of Object.keys(t))e[n]=Uo(t[n]);return e}return t}async function uT(t,e={},n=null){if(console.log(" [Roleplay Feedback] Starting analysis..."),console.log(" [Roleplay Feedback] Transcript entries:",t.length),console.log(" [Roleplay Feedback] Scenario context:",e),!t||t.length===0)throw new Error("Transkript ist leer. Das Gesprch muss mindestens einen Austausch enthalten.");const i=hT(t,e);console.log(" [Roleplay Feedback] Formatted transcript:",i.substring(0,200)+"...");const r=fe.getGeminiApiKey();if(!r)throw new Error("Gemini API Key ist nicht konfiguriert. Bitte kontaktiere den Administrator.");const o={feedbackContent:null,audioAnalysisContent:null},a={roleType:e.role_type||"interview",userRoleLabel:e.user_role_label||"Bewerber",agentRoleLabel:e.interviewer_profile?.role||"Gesprchspartner"};console.log(" [Roleplay Feedback] Role options:",a);try{console.log(" [Roleplay Feedback] Generating feedback...");const l=e.feedback_prompt||null;l&&console.log(" [Roleplay Feedback] Using custom feedback prompt from scenario"),o.feedbackContent=await oT(i,r,"gemini-1.5-flash",l,a),console.log(" [Roleplay Feedback] Feedback generated successfully")}catch(l){throw console.error(" [Roleplay Feedback] Failed to generate feedback:",l),new Error(`Fehler bei der Feedback-Generierung: ${l.message}`)}if(n)try{console.log(" [Roleplay Feedback] Generating audio analysis..."),o.audioAnalysisContent=await aT(n,r,"gemini-1.5-flash",a),console.log(" [Roleplay Feedback] Audio analysis generated successfully")}catch(l){console.error(" [Roleplay Feedback] Failed to generate audio analysis:",l),o.audioAnalysisContent=JSON.stringify({error:!0,summary:"Audio-Analyse konnte nicht durchgefhrt werden.",errorMessage:l.message,troubleshooting:["Stelle sicher, dass dein Mikrofon richtig funktioniert","Versuche das Gesprch erneut zu starten","berprfe, ob keine andere Anwendung das Mikrofon blockiert"]})}return console.log(" [Roleplay Feedback] Analysis complete"),o}function hT(t,e={}){let n="";e.title&&(n+=`Rollenspiel-Szenario: ${e.title}
`),e.description&&(n+=`Beschreibung: ${e.description}
`),e.variables&&(n+=`
Kontext-Variablen:
`,Object.entries(e.variables).forEach(([o,a])=>{n+=`- ${o}: ${a}
`})),n+=`
--- Gesprchsverlauf ---

`;const i=e.user_role_label||"Bewerber",r=e.interviewer_profile?.role||"Gesprchspartner";return t.forEach(o=>{const a=o.role==="agent"?r:i;n+=`${a}: ${o.text}

`}),n}async function pT(t,e,n,i=null,r=0,o=null){console.log(" [Roleplay Feedback] ========= SAVING SESSION ANALYSIS ========="),console.log(" [Roleplay Feedback] Session ID:",t),console.log(" [Roleplay Feedback] Conversation ID:",o),console.log(" [Roleplay Feedback] Duration:",r),console.log(" [Roleplay Feedback] feedbackJson type:",typeof n),console.log(" [Roleplay Feedback] feedbackJson length:",n?.length||0),console.log(" [Roleplay Feedback] feedbackJson preview:",n?.substring?.(0,200)||"null/undefined"),console.log(" [Roleplay Feedback] audioAnalysisJson type:",typeof i),console.log(" [Roleplay Feedback] audioAnalysisJson length:",i?.length||0);try{let a=e;Array.isArray(e)&&(a=JSON.stringify(e)),console.log(" [Roleplay Feedback] transcript entries:",Array.isArray(e)?e.length:"already string");const l={transcript:a,feedback_json:n,duration:r};i&&(l.audio_analysis_json=i),o&&(l.conversation_id=o),console.log(" [Roleplay Feedback] Sending update data with keys:",Object.keys(l)),console.log(" [Roleplay Feedback] Full request body length:",JSON.stringify(l).length);const c=await fe.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify(l)});if(console.log(" [Roleplay Feedback] API Response:",c),console.log(" [Roleplay Feedback] Response.data:",c?.data),console.log(" [Roleplay Feedback] Response feedback_json:",c?.data?.feedback_json?"present":"null"),r>0)try{console.log(" [Roleplay Feedback] Updating usage limits with duration:",r),await fe.request(`/roleplays/sessions/${t}/duration`,{method:"POST",body:JSON.stringify({duration_seconds:r})}),console.log(" [Roleplay Feedback] Usage limits updated successfully")}catch(d){console.warn(" [Roleplay Feedback] Failed to update usage limits:",d.message)}return console.log(" [Roleplay Feedback] ========= SAVE COMPLETE ========="),c.data}catch(a){throw console.error(" [Roleplay Feedback] ========= SAVE FAILED ========="),console.error(" [Roleplay Feedback] Error:",a),console.error(" [Roleplay Feedback] Error message:",a.message),new Error(`Fehler beim Speichern der Analyse: ${a.message}`)}}async function wx(t){console.log(" [Roleplay Feedback] Loading session analysis..."),console.log(" [Roleplay Feedback] Session ID:",t);try{const e=await fe.request(`/roleplays/sessions/${t}`,{method:"GET"});return console.log(" [Roleplay Feedback] Session analysis loaded successfully"),console.log(" [Roleplay Feedback] Raw API response:",e),console.log(" [Roleplay Feedback] Response.data:",e.data),console.log(" [Roleplay Feedback] feedback_json in response:",e.data?.feedback_json),e.data}catch(e){throw console.error(" [Roleplay Feedback] Failed to load session analysis:",e),new Error(`Fehler beim Laden der Analyse: ${e.message}`)}}async function fT(t={}){console.log(" [Roleplay Feedback] Loading user sessions..."),console.log(" [Roleplay Feedback] Params:",t);try{const e=new URLSearchParams(t).toString(),n=e?`/roleplays/sessions?${e}`:"/roleplays/sessions",i=await fe.request(n,{method:"GET"});return console.log(" [Roleplay Feedback] Sessions loaded successfully"),console.log(" [Roleplay Feedback] Sessions count:",i.data?.length||0),i}catch(e){throw console.error(" [Roleplay Feedback] Failed to load sessions:",e),new Error(`Fehler beim Laden der Sessions: ${e.message}`)}}function kd(t){return`${(window.bewerbungstrainerConfig||{apiUrl:"/wp-json/bewerbungstrainer/v1"}).apiUrl}/roleplays/sessions/${t}/audio`}async function gT(t,e=10,n=3e3){console.log(" [Roleplay Feedback] Fetching audio via WordPress proxy..."),console.log(` [Roleplay Feedback] Session ID: ${t}`),console.log(` [Roleplay Feedback] Max retries: ${e}, delay: ${n}ms`);const i=kd(t),r=o=>new Promise(a=>setTimeout(a,o));for(let o=1;o<=e;o++)try{console.log(` [Roleplay Feedback] Attempt ${o}/${e} - Fetching audio...`);const a=await fetch(i,{method:"GET",headers:{"X-WP-Nonce":mt()},credentials:"same-origin"});if(console.log(` [Roleplay Feedback] Response status: ${a.status}`),a.ok){const l=await a.blob();if(console.log(` [Roleplay Feedback] Audio fetched successfully on attempt ${o}`),console.log(` [Roleplay Feedback] Audio size: ${l.size} bytes`),console.log(` [Roleplay Feedback] Audio type: ${l.type}`),l.size===0){if(console.warn(" [Roleplay Feedback] Audio blob is empty, retrying..."),o<e){await r(n);continue}return null}return l}if(a.status===404&&o<e){console.log(` [Roleplay Feedback] Audio not ready yet (404), waiting ${n}ms before retry...`),await r(n);continue}if(console.error(` [Roleplay Feedback] Failed to fetch audio: HTTP ${a.status}`),o<e){await r(n);continue}}catch(a){if(console.error(` [Roleplay Feedback] Error fetching audio on attempt ${o}:`,a),o<e){await r(n);continue}}return console.warn(" [Roleplay Feedback] All retry attempts failed, audio not available"),null}async function mT(t,e){console.log(" [Roleplay Feedback] Updating session with conversation_id..."),console.log(" [Roleplay Feedback] Session ID:",t),console.log(" [Roleplay Feedback] Conversation ID:",e);try{const n=await fe.request(`/roleplays/sessions/${t}`,{method:"PUT",body:JSON.stringify({conversation_id:e})});return console.log(" [Roleplay Feedback] Session conversation_id updated successfully"),n.data}catch(n){throw console.error(" [Roleplay Feedback] Failed to update session conversation_id:",n),new Error(`Fehler beim Aktualisieren der Session: ${n.message}`)}}async function xT(t){console.log(" [Roleplay Feedback] Creating new session..."),console.log(" [Roleplay Feedback] Session data:",t);try{const e=await fe.request("/roleplays/sessions",{method:"POST",body:JSON.stringify(t)});return console.log(" [Roleplay Feedback] Session created successfully"),console.log(" [Roleplay Feedback] Session ID:",e.data.id),e.data}catch(e){throw console.error(" [Roleplay Feedback] Failed to create session:",e),new Error(`Fehler beim Erstellen der Session: ${e.message}`)}}async function Cx(){console.log(" [Roleplay Feedback] Loading scenarios...");try{const t=await fetch(`${Pn()}/roleplays`,{headers:{"X-WP-Nonce":mt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const e=await t.json();return console.log(" [Roleplay Feedback] Scenarios loaded successfully"),console.log(" [Roleplay Feedback] Scenarios count:",e.data?.length||0),Uo(e.data||[])}catch(t){throw console.error(" [Roleplay Feedback] Failed to load scenarios:",t),new Error(`Fehler beim Laden der Szenarien: ${t.message}`)}}async function jx(t){console.log(" [Roleplay Feedback] Loading scenario..."),console.log(" [Roleplay Feedback] Scenario ID:",t);try{const e=await fe.request(`/roleplays/${t}`,{method:"GET"});return console.log(" [Roleplay Feedback] Scenario loaded successfully"),Uo(e.data)}catch(e){throw console.error(" [Roleplay Feedback] Failed to load scenario:",e),new Error(`Fehler beim Laden des Szenarios: ${e.message}`)}}async function yT(t){console.log(" [Roleplay Feedback] Creating custom scenario..."),console.log(" [Roleplay Feedback] Scenario data:",t);try{const e=await fe.request("/roleplays/custom",{method:"POST",body:JSON.stringify(t)});return console.log(" [Roleplay Feedback] Custom scenario created successfully"),e.data}catch(e){throw console.error(" [Roleplay Feedback] Failed to create custom scenario:",e),new Error(`Fehler beim Erstellen des eigenen Szenarios: ${e.message}`)}}const Tx=t=>{setTimeout(()=>{const e=t.target;if(e){const n=e.closest("div");n&&n.scrollIntoView({behavior:"smooth",block:"center"})}},300)},bT=({id:t,type:e,value:n,onChange:i,placeholder:r,hasError:o,focusColor:a})=>{const[l,c]=g.useState(!1),d=a||x.blue[500],u=h=>{c(!0),Tx(h)};return s.jsx("input",{id:t,type:e,value:n,onChange:i,placeholder:r,style:{width:"100%",height:"44px",padding:"8px 16px",borderRadius:"12px",border:`2px solid ${o?x.red[500]:l?d:x.slate[200]}`,backgroundColor:"white",color:x.slate[900],fontSize:"16px",boxShadow:l?`0 0 0 3px ${d}26`:"0 1px 2px rgba(0, 0, 0, 0.05)",outline:"none",transition:"all 0.2s"},onFocus:u,onBlur:()=>c(!1)})},vT=({id:t,value:e,onChange:n,placeholder:i,hasError:r,rows:o=3,focusColor:a})=>{const[l,c]=g.useState(!1),d=a||x.blue[500],u=h=>{c(!0),Tx(h)};return s.jsx("textarea",{id:t,value:e,onChange:n,placeholder:i,rows:o,style:{width:"100%",minHeight:"100px",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${r?x.red[500]:l?d:x.slate[200]}`,backgroundColor:"white",color:x.slate[900],fontSize:"16px",boxShadow:l?`0 0 0 3px ${d}26`:"0 1px 2px rgba(0, 0, 0, 0.05)",outline:"none",transition:"all 0.2s",resize:"none"},onFocus:u,onBlur:()=>c(!1)})},Qh=({onClick:t,variant:e="primary",children:n,className:i,themedGradient:r,themedGradientHover:o})=>{const[a,l]=g.useState(!1),c={flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s",border:"none"},d={primary:{background:a&&o||r,color:"white",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},outline:{backgroundColor:a?"#f8fafc":"white",color:x.slate[700],border:`2px solid ${x.slate[200]}`,boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}};return s.jsx("button",{onClick:t,style:{...c,...d[e]},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:i,children:n})},ST=({open:t,scenario:e,onSubmit:n,onCancel:i})=>{const[r,o]=g.useState({}),[a,l]=g.useState({}),{branding:c}=ge(),d=c?.["--header-gradient"]||Q["--header-gradient"],u=c?.["--button-gradient-hover"]||c?.["--header-gradient"]||Q["--header-gradient"],h=c?.["--header-text"]||Q["--header-text"],p=c?.["--primary-accent"]||Q["--primary-accent"];g.useEffect(()=>{if(e?.variables_schema){const b={};e.variables_schema.forEach(S=>{b[S.key]=S.default||""}),o(b),l({})}},[e]);const m=(b,S)=>{o(C=>({...C,[b]:S})),a[b]&&l(C=>{const j={...C};return delete j[b],j})},y=()=>{const b=e.variables_schema.filter(C=>C.user_input!==!1),S={};if(b.forEach(C=>{C.required&&!r[C.key]?.trim()&&(S[C.key]=`${C.label} ist ein Pflichtfeld`)}),Object.keys(S).length>0){l(S);return}n(r)},f=e?.variables_schema?.filter(b=>b.user_input!==!1)||[];return!e?.variables_schema||e.variables_schema.length===0?(t&&n({}),null):f.length===0?(t&&n(r),null):s.jsx(Kt,{open:t,onOpenChange:b=>!b&&i(),children:s.jsxs(Yt,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Jt,{children:[s.jsxs(Xt,{style:{fontSize:"24px",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:d,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(st,{style:{width:"20px",height:"20px",color:h}})}),s.jsx("span",{style:{color:x.slate[900]},children:e.title})]}),s.jsx(dn,{style:{fontSize:"16px",paddingTop:"8px",color:x.slate[600]},children:"Bitte flle die folgenden Informationen aus, um das Rollenspiel zu starten."})]}),s.jsx("div",{style:{padding:"24px 0",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"16px"},children:f.map(b=>s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",gridColumn:b.type==="textarea"?"1 / -1":"auto"},children:[s.jsxs("label",{htmlFor:b.key,style:{fontSize:"14px",fontWeight:600,color:x.slate[700]},children:[b.label,b.required&&s.jsx("span",{style:{color:x.red[500],marginLeft:"4px"},children:"*"})]}),b.type==="textarea"?s.jsx(vT,{id:b.key,value:r[b.key]||"",onChange:S=>m(b.key,S.target.value),placeholder:b.default||`${b.label} eingeben...`,hasError:!!a[b.key],rows:3,focusColor:p}):s.jsx(bT,{id:b.key,type:b.type==="number"?"number":"text",value:r[b.key]||"",onChange:S=>m(b.key,S.target.value),placeholder:b.default||`${b.label} eingeben...`,hasError:!!a[b.key],focusColor:p}),a[b.key]&&s.jsx("p",{style:{fontSize:"14px",color:x.red[500],margin:0},children:a[b.key]})]},b.key))}),s.jsxs(cn,{style:{display:"flex",flexDirection:"row",gap:"12px",paddingTop:"16px"},children:[s.jsx(Qh,{onClick:i,variant:"outline",children:"Abbrechen"}),s.jsxs(Qh,{onClick:y,variant:"primary",themedGradient:d,themedGradientHover:u,children:[s.jsx(st,{style:{width:"16px",height:"16px"}}),"Rollenspiel starten"]})]})]})})},Ex={vorstellungsgespraech:{label:"Vorstellungsgesprch",icon:Qt,color:"#3A7FA7",bgColor:"#E8F4F8"},gehaltsverhandlung:{label:"Gehaltsverhandlung",icon:ni,color:"#059669",bgColor:"#d1fae5"},fuehrungsgespraech:{label:"Fhrungsgesprch",icon:un,color:"#7c3aed",bgColor:"#ede9fe"},praesentation:{label:"Prsentation",icon:dd,color:"#d97706",bgColor:"#fef3c7"},selbstvorstellung:{label:"Selbstvorstellung",icon:xt,color:"#ec4899",bgColor:"#fce7f3"},training:{label:"Training",icon:De,color:"#64748b",bgColor:"#f1f5f9"}},ep=t=>t?t.toLowerCase().replace(//g,"ae").replace(//g,"oe").replace(//g,"ue").replace(//g,"ss").replace(/[^a-z0-9]/g,""):null,kT=({selectedCategory:t,onSelectCategory:e,primaryAccent:n,availableCategories:i})=>{const r=[{key:null,label:"Alle",icon:Kn},...i.map(o=>({key:o,...Ex[o]}))];return s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginBottom:"24px"},children:r.map(o=>{const a=t===o.key,l=o.icon||Kn,c=o.key===null?n:o.color;return s.jsxs("button",{onClick:()=>e(o.key),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"10px 18px",borderRadius:"24px",fontSize:"14px",fontWeight:600,border:`2px solid ${a?c:x.slate[200]}`,backgroundColor:a?o.key===null?`${n}15`:o.bgColor:"white",color:a?c:x.slate[600],cursor:"pointer",transition:"all 0.2s ease"},children:[s.jsx(l,{style:{width:"16px",height:"16px"}}),o.label]},o.key||"all")})})},wT=(t,e)=>({base:{height:"44px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,color:x.slate[800],fontSize:"14px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",outline:"none",transition:"all 0.2s"},focus:{borderColor:t,boxShadow:`0 0 0 3px ${e}`},blur:{borderColor:x.slate[200],boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}}),CT=({onSelectScenario:t,onBack:e,onOpenHistory:n,isAuthenticated:i,requireAuth:r,setPendingAction:o,pendingScenario:a,clearPendingScenario:l,onNavigateToHistory:c})=>{const[d,u]=g.useState([]),[h,p]=g.useState([]),[m,y]=g.useState(!0),[f,b]=g.useState(null),{filterScenarios:S,isWhiteLabel:C,partnerName:j,branding:w}=ge(),v=w?.["--header-gradient"]||Q["--header-gradient"],E=w?.["--header-text"]||Q["--header-text"],k=w?.["--icon-primary"]||Q["--icon-primary"],T=w?.["--primary-accent"]||Q["--primary-accent"],N=w?.["--focus-ring"]||Q["--focus-ring"],R=g.useMemo(()=>wT(T,N),[T,N]),[_,A]=g.useState(""),[Y,H]=g.useState("all"),[$,K]=g.useState(null),[O,P]=g.useState("grid"),F=g.useMemo(()=>{const te=new Set;return d.forEach($e=>{const Ne=ep($e.category);Ne&&Ex[Ne]&&te.add(Ne)}),Array.from(te)},[d]),[D,B]=g.useState(!1),[G,ie]=g.useState({title:"",description:"",difficulty:"medium"}),[le,re]=g.useState(null),[U,be]=g.useState(!1);g.useEffect(()=>{console.log(" [RoleplayDashboard] Loading scenarios..."),Oe()},[]),g.useEffect(()=>{Le()},[d,_,Y,$,S]),g.useEffect(()=>{a&&i&&(console.log(" [RoleplayDashboard] Processing pending scenario after login:",a.title),re(a),be(!0),l&&l())},[a,i,l]);const Oe=async()=>{try{y(!0),b(null);const te=await Cx();u(te)}catch(te){console.error("Failed to load scenarios:",te),b(te.message||"Fehler beim Laden der Szenarien")}finally{y(!1)}},bt=te=>{if(!i){console.log(" [RoleplayDashboard] Auth required - storing pending action for scenario:",te.title),o({type:"SELECT_ROLEPLAY_SCENARIO",scenario:te,variables:{}}),r(()=>{},null);return}re(te),be(!0)},ce=te=>{console.log(" [RoleplayDashboard] Variables collected:",te),be(!1),t(le,te)},_e=()=>{be(!1),re(null)},Le=()=>{let te=S([...d]);if(C&&console.log(" [RoleplayDashboard] Partner filtering applied:",{total:d.length,afterPartnerFilter:te.length}),$&&(te=te.filter($e=>ep($e.category)===$)),_.trim()){const $e=_.toLowerCase();te=te.filter(Ne=>Ne.title.toLowerCase().includes($e)||Ne.description&&Ne.description.toLowerCase().includes($e))}Y!=="all"&&(te=te.filter($e=>$e.difficulty===Y)),p(te)},ot=async()=>{try{if(!G.title||!G.description){alert("Bitte flle Titel und Beschreibung aus.");return}const te=await yT(G);B(!1),t(te)}catch(te){console.error("Failed to create custom scenario:",te),alert(te.message||"Fehler beim Erstellen des eigenen Szenarios")}},Gt=te=>{switch(te){case"easy":return"Einfach";case"medium":return"Mittel";case"hard":return"Schwer";default:return te}};return m?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ye,{className:"w-12 h-12 text-ocean-blue-600 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Szenarien werden geladen..."})]})}):f?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[s.jsx(ve,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),s.jsx("p",{className:"text-slate-600 mb-4",children:f}),s.jsx(se,{onClick:Oe,children:"Erneut versuchen"})]})}):s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsx("div",{style:{marginBottom:"32px"},children:s.jsxs(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e&&s.jsxs(se,{variant:"ghost",onClick:e,className:"mb-4",children:[s.jsx(pt,{className:"w-4 h-4 mr-2"}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:v,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ze,{style:{width:"24px",height:"24px",color:E}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:x.slate[900],margin:0},children:"Live-Simulationen"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0},children:"Live Simulationen mit KI-Interviewer"})]})]}),i&&c&&s.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${T}`,backgroundColor:"white",color:T,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(_s,{size:18}),"Meine Live-Simulationen"]})]}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-6",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(ei,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 pointer-events-none",style:{color:x.slate[400]}}),s.jsx("input",{type:"text",placeholder:"Szenarien durchsuchen...",value:_,onChange:te=>A(te.target.value),style:{...R.base,width:"100%",paddingLeft:"48px",paddingRight:"16px"},onFocus:te=>Object.assign(te.target.style,R.focus),onBlur:te=>Object.assign(te.target.style,R.blur)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(lr,{className:"w-5 h-5",style:{color:k}}),s.jsxs("select",{value:Y,onChange:te=>H(te.target.value),style:{...R.base,padding:"8px 16px",cursor:"pointer"},onFocus:te=>Object.assign(te.target.style,R.focus),onBlur:te=>Object.assign(te.target.style,R.blur),children:[s.jsx("option",{value:"all",children:"Alle Schwierigkeiten"}),s.jsx("option",{value:"easy",children:"Einfach"}),s.jsx("option",{value:"medium",children:"Mittel"}),s.jsx("option",{value:"hard",children:"Schwer"})]})]}),s.jsx(aa,{viewMode:O,onViewChange:P})]})]})}),F.length>0&&s.jsx(kT,{selectedCategory:$,onSelectCategory:K,primaryAccent:T,availableCategories:F}),s.jsx("div",{children:h.length===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(st,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Keine Szenarien gefunden."})]}):s.jsx(Wr,{viewMode:O,children:h.map(te=>s.jsx(Ur,{title:te.title,description:te.description,difficulty:te.difficulty,tags:te.tags||[],meta:[...te.variables_schema&&te.variables_schema.length>0?[{icon:De,text:`${te.variables_schema.length} Variablen`}]:[],{icon:He,text:"~10 Min"}],action:{label:"Starten",icon:Vt},onClick:()=>bt(te),viewMode:O},te.id))})}),s.jsx(Kt,{open:D,onOpenChange:B,children:s.jsxs(Yt,{className:"max-w-2xl",children:[s.jsxs(Jt,{children:[s.jsxs(Xt,{className:"flex items-center gap-2",children:[s.jsx(st,{className:"w-5 h-5 text-blue-600"}),"Eigenes Rollenspiel-Szenario erstellen"]}),s.jsx(dn,{children:"Erstelle dein eigenes Szenario mit individuellen Anforderungen"})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Titel des Szenarios *"}),s.jsx("input",{type:"text",value:G.title,onChange:te=>ie({...G,title:te.target.value}),placeholder:"z.B. Gehaltsverhandlung bei Accenture",className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Beschreibung & Kontext *"}),s.jsx("textarea",{value:G.description,onChange:te=>ie({...G,description:te.target.value}),placeholder:"Beschreibe das Szenario und worauf du dich fokussieren mchtest...",rows:4,className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Schwierigkeitsgrad"}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:["easy","medium","hard"].map(te=>s.jsx("button",{onClick:()=>ie({...G,difficulty:te}),className:`px-4 py-3 rounded-xl border-2 font-semibold transition-all ${G.difficulty===te?"border-blue-600 bg-blue-50 text-blue-700":"border-slate-200 hover:border-slate-300"}`,children:Gt(te)},te))})]})]}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>B(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:ot,children:[s.jsx(Dt,{className:"w-4 h-4 mr-2"}),"Szenario starten"]})]})]})}),s.jsx(ST,{open:U,scenario:le,onSubmit:ce,onCancel:_e})]})};var tp={};function jT(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var TT=Object.defineProperty,ET=(t,e,n)=>e in t?TT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,np=(t,e,n)=>ET(t,typeof e!="symbol"?e+"":e,n);let Ot=class{constructor(){np(this,"_locking"),np(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function nt(t,e){if(!t)throw new Error(e)}const RT=34028234663852886e22,IT=-34028234663852886e22,_T=4294967295,NT=2147483647,AT=-2147483648;function mo(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>NT||t<AT)throw new Error("invalid int 32: "+t)}function Jl(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>_T||t<0)throw new Error("invalid uint 32: "+t)}function Rx(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>RT||t<IT))throw new Error("invalid float 32: "+t)}const Ix=Symbol("@bufbuild/protobuf/enum-type");function PT(t){const e=t[Ix];return nt(e,"missing enum type on enum object"),e}function _x(t,e,n,i){t[Ix]=Nx(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Nx(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of e){const l=Ax(a);o.push(l),i[a.name]=l,r[a.no]=l}return{typeName:t,values:o,findName(a){return i[a]},findNumber(a){return r[a]}}}function MT(t,e,n){const i={};for(const r of e){const o=Ax(r);i[o.localName]=o.no,i[o.no]=o.localName}return _x(i,t,e),i}function Ax(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class wd{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function DT(t,e,n,i){var r;const o=(r=i?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[o]:function(l){t.util.initFields(this),t.util.initPartial(l,this)}}[o];return Object.setPrototypeOf(a.prototype,new wd),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(l,c){return new a().fromBinary(l,c)},fromJson(l,c){return new a().fromJson(l,c)},fromJsonString(l,c){return new a().fromJsonString(l,c)},equals(l,c){return t.util.equals(a,l,c)}}),a}function OT(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Ja(t,e,n){for(let o=0;o<28;o=o+7){const a=t>>>o,l=!(!(a>>>7)&&e==0),c=(l?a|128:a)&255;if(n.push(c),!l)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const a=e>>>o,l=!!(a>>>7),c=(l?a|128:a)&255;if(n.push(c),!l)return}n.push(e>>>31&1)}}const xo=4294967296;function ip(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(a,l){const c=Number(t.slice(a,l));r*=n,i=i*n+c,i>=xo&&(r=r+(i/xo|0),i=i%xo)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?Mx(i,r):Cd(i,r)}function LT(t,e){let n=Cd(t,e);const i=n.hi&2147483648;i&&(n=Mx(n.lo,n.hi));const r=Px(n.lo,n.hi);return i?"-"+r:r}function Px(t,e){if({lo:t,hi:e}=FT(t,e),e<=2097151)return String(xo*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,a=i+r*8147497,l=r*2;const c=1e7;return o>=c&&(a+=Math.floor(o/c),o%=c),a>=c&&(l+=Math.floor(a/c),a%=c),l.toString()+sp(a)+sp(o)}function FT(t,e){return{lo:t>>>0,hi:e>>>0}}function Cd(t,e){return{lo:t|0,hi:e|0}}function Mx(t,e){return e=~e,t?t=~t+1:e+=1,Cd(t,e)}const sp=t=>{const e=String(t);return"0000000".slice(e.length)+e};function rp(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function BT(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function zT(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof tp!="object"||tp.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>o||d<r)throw new Error("int64 invalid: ".concat(c));return d},uParse(c){const d=typeof c=="bigint"?c:BigInt(c);if(d>l||d<a)throw new Error("uint64 invalid: ".concat(c));return d},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigInt64(0,!0)},uDec(c,d){return t.setInt32(0,c,!0),t.setInt32(4,d,!0),t.getBigUint64(0,!0)}}}const n=r=>nt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>nt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),ip(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),ip(r)},dec(r,o){return LT(r,o)},uDec(r,o){return Px(r,o)}}}const Ge=zT();var V;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(V||(V={}));var ji;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(ji||(ji={}));function li(t,e,n){if(e===n)return!0;if(t==V.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case V.UINT64:case V.FIXED64:case V.INT64:case V.SFIXED64:case V.SINT64:return e==n}return!1}function Ps(t,e){switch(t){case V.BOOL:return!1;case V.UINT64:case V.FIXED64:case V.INT64:case V.SFIXED64:case V.SINT64:return e==0?Ge.zero:"0";case V.DOUBLE:case V.FLOAT:return 0;case V.BYTES:return new Uint8Array(0);case V.STRING:return"";default:return 0}}function Dx(t,e){switch(t){case V.BOOL:return e===!1;case V.STRING:return e==="";case V.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var rt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(rt||(rt={}));class UT{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Jl(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return mo(e),rp(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Rx(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Jl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){mo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return mo(e),e=(e<<1^e>>31)>>>0,rp(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Ge.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=Ge.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=Ge.enc(e);return Ja(n.lo,n.hi,this.buf),this}sint64(e){let n=Ge.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return Ja(r,o,this.buf),this}uint64(e){let n=Ge.uEnc(e);return Ja(n.lo,n.hi,this.buf),this}}class WT{constructor(e,n){this.varint64=OT,this.uint32=BT,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case rt.Varint:for(;this.buf[this.pos++]&128;);break;case rt.Bit64:this.pos+=4;case rt.Bit32:this.pos+=4;break;case rt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case rt.StartGroup:for(;;){const[o,a]=this.tag();if(a===rt.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(a,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Ge.dec(...this.varint64())}uint64(){return Ge.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,Ge.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Ge.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Ge.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function VT(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function Ox(t){const e=t.field.localName,n=Object.create(null);return n[e]=$T(t),[n,()=>n[e]]}function $T(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Ps(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function GT(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let $n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ha=[];for(let t=0;t<$n.length;t++)ha[$n[t].charCodeAt(0)]=t;ha[45]=$n.indexOf("+");ha[95]=$n.indexOf("/");const Lx={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,a=0;for(let l=0;l<t.length;l++){if(o=ha[t.charCodeAt(l)],o===void 0)switch(t[l]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=o,r=1;break;case 1:n[i++]=a<<2|(o&48)>>4,a=o,r=2;break;case 2:n[i++]=(a&15)<<4|(o&60)>>2,a=o,r=3;break;case 3:n[i++]=(a&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=$n[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=$n[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=$n[r|i>>6],e+=$n[i&63],n=0;break}return n&&(e+=$n[r],e+="=",n==1&&(e+="=")),e}};function qT(t,e,n){Bx(e,t);const i=e.runtime.bin.makeReadOptions(n),r=GT(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,a]=Ox(e);for(const l of r)e.runtime.bin.readField(o,i.readerFactory(l.data),e.field,l.wireType,i);return a()}function HT(t,e,n,i){Bx(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(Fx(t,e)){const d=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of d)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const a=o.writerFactory();let l=e.field;!l.opt&&!l.repeated&&(l.kind=="enum"||l.kind=="scalar")&&(l=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(l,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[d,u]=c.tag(),h=c.skip(u,d);t.getType().runtime.bin.onUnknownField(t,d,u,h)}}function Fx(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Bx(t,e){nt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function zx(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Dx(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function op(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Ps(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Gn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(wd.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Ux(t,e){return Gn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}V.DOUBLE,V.FLOAT,V.INT64,V.UINT64,V.INT32,V.UINT32,V.BOOL,V.STRING,V.BYTES;const ap={ignoreUnknownFields:!1},lp={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function KT(t){return t?Object.assign(Object.assign({},ap),t):ap}function YT(t){return t?Object.assign(Object.assign({},lp),t):lp}const Wo=Symbol(),yo=Symbol();function JT(){return{makeReadOptions:KT,makeWriteOptions:YT,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Rn(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[a,l]of Object.entries(e)){const c=t.fields.findJsonName(a);if(c){if(c.oneof){if(l===null&&c.kind=="scalar")continue;const d=r.get(c.oneof);if(d!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(d,'", "').concat(a,'"'));r.set(c.oneof,a)}cp(i,l,c,n,t)}else{let d=!1;if(o?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const u=o.findExtension(a.substring(1,a.length-1));if(u&&u.extendee.typeName==t.typeName){d=!0;const[h,p]=Ox(u);cp(h,l,u.field,n,u),HT(i,u,p(),n)}}if(!d&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!zx(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!ZT(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],l=dp(r,a,e);l!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=l)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const l=o.findExtensionFor(n.typeName,a.no);if(l&&Fx(t,l)){const c=qT(t,l,e),d=dp(l.field,c,e);d!==void 0&&(i[l.field.jsonName]=d)}}}catch(o){const a=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),l=o instanceof Error?o.message:String(o);throw new Error(a+(l.length>0?": ".concat(l):""))}return i},readScalar(t,e,n){return dr(t,e,n??ji.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Dx(t,e)))return bo(t,e)},debug:Rn}}function Rn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function cp(t,e,n,i,r){let o=n.localName;if(n.repeated){if(nt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(e)));const a=t[o];for(const l of e){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(l)));switch(n.kind){case"message":a.push(n.T.fromJson(l,i));break;case"enum":const c=Xa(n.T,l,i.ignoreUnknownFields,!0);c!==yo&&a.push(c);break;case"scalar":try{a.push(dr(n.T,l,n.L,!0))}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(l));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(e)));const a=t[o];for(const[l,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let d;try{d=XT(n.K,l)}catch(u){let h="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}switch(n.V.kind){case"message":a[d]=n.V.T.fromJson(c,i);break;case"enum":const u=Xa(n.V.T,c,i.ignoreUnknownFields,!0);u!==yo&&(a[d]=u);break;case"scalar":try{a[d]=dr(n.V.T,c,ji.BIGINT,!0)}catch(h){let p="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(e));throw h instanceof Error&&h.message.length>0&&(p+=": ".concat(h.message)),new Error(p)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let l=t[o];Gn(l)?l.fromJson(e,i):(t[o]=l=a.fromJson(e,i),a.fieldWrapper&&!n.oneof&&(t[o]=a.fieldWrapper.unwrapField(l)));break;case"enum":const c=Xa(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Wo:op(n,t);break;case yo:break;default:t[o]=c;break}break;case"scalar":try{const d=dr(n.T,e,n.L,!1);switch(d){case Wo:op(n,t);break;default:t[o]=d;break}}catch(d){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Rn(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}break}}function XT(t,e){if(t===V.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return dr(t,e,ji.BIGINT,!0).toString()}function dr(t,e,n,i){if(e===null)return i?Ps(t,n):Wo;switch(t){case V.DOUBLE:case V.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==V.FLOAT&&Rx(r),r;case V.INT32:case V.FIXED32:case V.SFIXED32:case V.SINT32:case V.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==V.UINT32||t==V.FIXED32?Jl(o):mo(o),o;case V.INT64:case V.SFIXED64:case V.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Ge.parse(e);return n?a.toString():a;case V.FIXED64:case V.UINT64:if(typeof e!="number"&&typeof e!="string")break;const l=Ge.uParse(e);return n?l.toString():l;case V.BOOL:if(typeof e!="boolean")break;return e;case V.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case V.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Lx.dec(e)}throw new Error}function Xa(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Wo;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return yo;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Rn(e)))}function ZT(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function dp(t,e,n){if(t.kind=="map"){nt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,l]of r)i[a.toString()]=bo(t.V.T,l);break;case"message":for(const[a,l]of r)i[a.toString()]=l.toJson(n);break;case"enum":const o=t.V.T;for(const[a,l]of r)i[a.toString()]=Za(o,l,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){nt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(bo(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Za(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return bo(t.T,e);case"enum":return Za(t.T,e,n.enumAsInteger);case"message":return Ux(t.T,e).toJson(n)}}function Za(t,e,n){var i;if(nt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r?.name)!==null&&i!==void 0?i:e}function bo(t,e){switch(t){case V.INT32:case V.SFIXED32:case V.SINT32:case V.FIXED32:case V.UINT32:return nt(typeof e=="number"),e;case V.FLOAT:case V.DOUBLE:return nt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case V.STRING:return nt(typeof e=="string"),e;case V.BOOL:return nt(typeof e=="boolean"),e;case V.UINT64:case V.FIXED64:case V.INT64:case V.SFIXED64:case V.SINT64:return nt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case V.BYTES:return nt(e instanceof Uint8Array),Lx.enc(e)}}const ns=Symbol("@bufbuild/protobuf/unknown-fields"),up={readUnknownFields:!0,readerFactory:t=>new WT(t)},hp={writeUnknownFields:!0,writerFactory:()=>new UT};function QT(t){return t?Object.assign(Object.assign({},up),t):up}function e2(t){return t?Object.assign(Object.assign({},hp),t):hp}function t2(){return{makeReadOptions:QT,makeWriteOptions:e2,listUnknownFields(t){var e;return(e=t[ns])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[ns]},writeUnknownFields(t,e){const i=t[ns];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[ns])||(r[ns]=[]),r[ns].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),a=r?e.len:e.pos+n;let l,c;for(;e.pos<a&&([l,c]=e.tag(),!(r===!0&&c==rt.EndGroup));){const d=o.fields.find(l);if(!d){const u=e.skip(c,l);i.readUnknownFields&&this.onUnknownField(t,l,c,u);continue}pp(t,e,d,c,i)}if(r&&(c!=rt.EndGroup||l!==n))throw new Error("invalid end group tag")},readField:pp,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!zx(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];fp(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&fp(t,e,n,i)}}}function pp(t,e,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const l=n.kind=="enum"?V.INT32:n.T;let c=Vo;if(n.kind=="scalar"&&n.L>0&&(c=i2),o){let p=t[a];if(i==rt.LengthDelimited&&l!=V.STRING&&l!=V.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)p.push(c(e,l))}else p.push(c(e,l))}else t[a]=c(e,l);break;case"message":const d=n.T;o?t[a].push(vo(e,new d,r,n)):Gn(t[a])?vo(e,t[a],r,n):(t[a]=vo(e,new d,r,n),d.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=d.fieldWrapper.unwrapField(t[a])));break;case"map":let[u,h]=n2(n,e,r);t[a][u]=h;break}}function vo(t,e,n,i){const r=e.getType().runtime.bin,o=i?.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function n2(t,e,n){const i=e.uint32(),r=e.pos+i;let o,a;for(;e.pos<r;){const[l]=e.tag();switch(l){case 1:o=Vo(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=Vo(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=vo(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=Ps(t.K,ji.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(t.V.kind){case"scalar":a=Ps(t.V.T,ji.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[o,a]}function i2(t,e){const n=Vo(t,e);return typeof n=="bigint"?n.toString():n}function Vo(t,e){switch(e){case V.STRING:return t.string();case V.BOOL:return t.bool();case V.DOUBLE:return t.double();case V.FLOAT:return t.float();case V.INT32:return t.int32();case V.INT64:return t.int64();case V.UINT64:return t.uint64();case V.FIXED64:return t.fixed64();case V.BYTES:return t.bytes();case V.FIXED32:return t.fixed32();case V.SFIXED32:return t.sfixed32();case V.SFIXED64:return t.sfixed64();case V.SINT64:return t.sint64();case V.UINT32:return t.uint32();case V.SINT32:return t.sint32()}}function fp(t,e,n,i){nt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?V.INT32:t.T;if(r)if(nt(Array.isArray(e)),t.packed)r2(n,o,t.no,e);else for(const a of e)ur(n,o,t.no,a);else ur(n,o,t.no,e);break;case"message":if(r){nt(Array.isArray(e));for(const a of e)gp(n,i,t,a)}else gp(n,i,t,e);break;case"map":nt(typeof e=="object"&&e!=null);for(const[a,l]of Object.entries(e))s2(n,i,t,a,l);break}}function s2(t,e,n,i,r){t.tag(n.no,rt.LengthDelimited),t.fork();let o=i;switch(n.K){case V.INT32:case V.FIXED32:case V.UINT32:case V.SFIXED32:case V.SINT32:o=Number.parseInt(i);break;case V.BOOL:nt(i=="true"||i=="false"),o=i=="true";break}switch(ur(t,n.K,1,o),n.V.kind){case"scalar":ur(t,n.V.T,2,r);break;case"enum":ur(t,V.INT32,2,r);break;case"message":nt(r!==void 0),t.tag(2,rt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function gp(t,e,n,i){const r=Ux(n.T,i);n.delimited?t.tag(n.no,rt.StartGroup).raw(r.toBinary(e)).tag(n.no,rt.EndGroup):t.tag(n.no,rt.LengthDelimited).bytes(r.toBinary(e))}function ur(t,e,n,i){nt(i!==void 0);let[r,o]=Wx(e);t.tag(n,r)[o](i)}function r2(t,e,n,i){if(!i.length)return;t.tag(n,rt.LengthDelimited).fork();let[,r]=Wx(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function Wx(t){let e=rt.Varint;switch(t){case V.BYTES:case V.STRING:e=rt.LengthDelimited;break;case V.DOUBLE:case V.FIXED64:case V.SFIXED64:e=rt.Bit64;break;case V.FIXED32:case V.SFIXED32:case V.FLOAT:e=rt.Bit32;break}const n=V[t].toLowerCase();return[e,n]}function o2(){return{setEnumType:_x,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,a=t;if(a[r]!=null)switch(i.kind){case"oneof":const l=a[r].case;if(l===void 0)continue;const c=i.findField(l);let d=a[r].value;c&&c.kind=="message"&&!Gn(d,c.T)?d=new c.T(d):c&&c.kind==="scalar"&&c.T===V.BYTES&&(d=Gs(d)),o[r]={case:l,value:d};break;case"scalar":case"enum":let u=a[r];i.T===V.BYTES&&(u=i.repeated?u.map(Gs):Gs(u)),o[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===V.BYTES)for(const[m,y]of Object.entries(a[r]))o[r][m]=Gs(y);else Object.assign(o[r],a[r]);break;case"message":const p=i.V.T;for(const m of Object.keys(a[r])){let y=a[r][m];p.fieldWrapper||(y=new p(y)),o[r][m]=y}break}break;case"message":const h=i.T;if(i.repeated)o[r]=a[r].map(p=>Gn(p,h)?p:new h(p));else{const p=a[r];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?o[r]=Gs(p):o[r]=p:o[r]=Gn(p,h)?p:new h(p)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((a,l)=>i.T.equals(a,o[l]));case"scalar":return r.every((a,l)=>li(i.T,a,o[l]));case"enum":return r.every((a,l)=>li(V.INT32,a,o[l]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let a=r,l=o;return i.T.fieldWrapper&&(a!==void 0&&!Gn(a)&&(a=i.T.fieldWrapper.wrapField(a)),l!==void 0&&!Gn(l)&&(l=i.T.fieldWrapper.wrapField(l))),i.T.equals(a,l);case"enum":return li(V.INT32,r,o);case"scalar":return li(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return li(V.INT32,r.value,o.value);case"scalar":return li(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const d=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const u=i.V.T;return d.every(p=>u.equals(r[p],o[p]));case"enum":return d.every(p=>li(V.INT32,r[p],o[p]));case"scalar":const h=i.V.T;return d.every(p=>li(h,r[p],o[p]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let a;if(r.repeated)a=o.map(eo);else if(r.kind=="map"){a=i[r.localName];for(const[l,c]of Object.entries(o))a[l]=eo(c)}else r.kind=="oneof"?a=r.findField(o.case)?{case:o.case,value:eo(o.value)}:{case:void 0}:a=eo(o);i[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function eo(t){if(t===void 0)return t;if(Gn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Gs(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function a2(t,e,n){return{syntax:t,json:JT(),bin:t2(),util:Object.assign(Object.assign({},o2()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return DT(this,i,r,o)},makeEnum:MT,makeEnumType:Nx,getEnumType:PT,makeExtension(i,r,o){return VT(this,i,r,o)}}}class l2{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Vx(t,e){const n=$x(t);return e?n:f2(p2(n))}function c2(t){return Vx(t,!1)}const d2=$x;function $x(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const u2=new Set(["constructor","toString","toJSON","valueOf"]),h2=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Gx=t=>"".concat(t,"$"),p2=t=>h2.has(t)?Gx(t):t,f2=t=>u2.has(t)?Gx(t):t;class g2{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=c2(e)}addField(e){nt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function m2(t,e){var n,i,r,o,a,l;const c=[];let d;for(const u of typeof t=="function"?t():t){const h=u;if(h.localName=Vx(u.name,u.oneof!==void 0),h.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:d2(u.name),h.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(h.L=(r=u.L)!==null&&r!==void 0?r:ji.BIGINT),h.delimited=(o=u.delimited)!==null&&o!==void 0?o:!1,h.req=(a=u.req)!==null&&a!==void 0?a:!1,h.opt=(l=u.opt)!==null&&l!==void 0?l:!1,u.packed===void 0&&(h.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=V.BYTES&&u.T!=V.STRING),u.oneof!==void 0){const p=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!d||d.name!=p)&&(d=new g2(p)),h.oneof=d,d.addField(h)}c.push(h)}return c}const M=a2("proto3",t=>new l2(t,e=>m2(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Ps(e.T,e.L);break}}});class Ft extends wd{constructor(e){super(),this.seconds=Ge.zero,this.nanos=0,M.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(M.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Ge.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Ft.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Ft({seconds:Ge.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Ft().fromBinary(e,n)}static fromJson(e,n){return new Ft().fromJson(e,n)}static fromJsonString(e,n){return new Ft().fromJsonString(e,n)}static equals(e,n){return M.util.equals(Ft,e,n)}}Ft.runtime=M;Ft.typeName="google.protobuf.Timestamp";Ft.fields=M.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const x2=M.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ft},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:y2,repeated:!0},{no:5,name:"events",kind:"message",T:v2,repeated:!0}]),y2=M.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:b2,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),b2=M.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ft},{no:3,name:"value",kind:"scalar",T:2}]),v2=M.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Ft},{no:7,name:"normalized_end_timestamp",kind:"message",T:Ft,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),qx=M.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),yn=M.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),lt=M.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),jd=M.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Qs=M.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Er=M.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Sn=M.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Mi=M.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),S2=M.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),ft=M.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),pa=M.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:$o,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:r0}]),$o=M.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),k2=M.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:M.getEnumType(lt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Vi=M.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:M.getEnumType(bs)},{no:4,name:"tracks",kind:"message",T:ds,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:k2},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:M.getEnumType(Rr)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:M.getEnumType(Sn)},{no:18,name:"kind_details",kind:"enum",T:M.getEnumType(w2),repeated:!0}]),bs=M.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Rr=M.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),w2=M.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ut=M.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),C2=M.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:yi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:M.getEnumType(Hx)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),ds=M.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:M.getEnumType(yn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:M.getEnumType(lt)},{no:10,name:"layers",kind:"message",T:yi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:C2,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:M.getEnumType(ut)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:r0},{no:19,name:"audio_features",kind:"enum",T:M.getEnumType(ft),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:M.getEnumType(qx)}]),yi=M.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:M.getEnumType(jd)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Hx=M.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Pt=M.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:M.getEnumType(Se)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Td,oneof:"value"},{no:3,name:"speaker",kind:"message",T:j2,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Xx,oneof:"value"},{no:7,name:"transcription",kind:"message",T:T2,oneof:"value"},{no:8,name:"metrics",kind:"message",T:x2,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Go,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Ed,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Rd,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Id,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:qo,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ho,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ko,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:Kx,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Se=M.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Kx=M.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:M.getEnumType(ut)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Yx=M.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Td,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Go,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Ed,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Rd,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Id,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:qo,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Ho,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Ko,oneof:"value"}]),j2=M.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Jx,repeated:!0}]),Jx=M.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Td=M.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Xx=M.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),T2=M.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:E2,repeated:!0}]),E2=M.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Go=M.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Ed=M.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Rd=M.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Id=M.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Zx,oneof:"value"}]),Zx=M.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),Qx=M.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),e0=M.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:M.getEnumType(t0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),t0=M.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),n0=M.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:M.getEnumType(i0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),i0=M.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),s0=M.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:mp},{no:2,name:"screen",kind:"message",T:mp},{no:3,name:"resume_connection",kind:"enum",T:M.getEnumType(Er)},{no:4,name:"disabled_codecs",kind:"message",T:R2},{no:5,name:"force_relay",kind:"enum",T:M.getEnumType(Er)}]),mp=M.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:M.getEnumType(Er)}]),R2=M.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:$o,repeated:!0},{no:2,name:"publish",kind:"message",T:$o,repeated:!0}]),r0=M.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Xl=M.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),o0=M.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:M.getEnumType(Xl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),a0=M.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),qo=M.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:M.getEnumType(ut)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:o0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:a0,oneof:"content_header"}],{localName:"DataStream_Header"}),Ho=M.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ko=M.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),I2=M.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),bn=M.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Zl=M.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),_2=M.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),N2=M.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ti,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ti,oneof:"message"},{no:3,name:"trickle",kind:"message",T:fa,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ir,oneof:"message"},{no:5,name:"mute",kind:"message",T:ga,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ma,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:l0,oneof:"message"},{no:8,name:"leave",kind:"message",T:xa,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:d0,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:p0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Md,oneof:"message"},{no:13,name:"simulate",kind:"message",T:En,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Ad,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:m0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Nd,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:c0,oneof:"message"}]),xp=M.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:A2,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ti,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ti,oneof:"message"},{no:4,name:"trickle",kind:"message",T:fa,oneof:"message"},{no:5,name:"update",kind:"message",T:D2,oneof:"message"},{no:6,name:"track_published",kind:"message",T:_d,oneof:"message"},{no:8,name:"leave",kind:"message",T:xa,oneof:"message"},{no:9,name:"mute",kind:"message",T:ga,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:O2,oneof:"message"},{no:11,name:"room_update",kind:"message",T:L2,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:B2,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:U2,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:V2,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:G2,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:M2,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:P2,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:H2,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:J2,oneof:"message"},{no:22,name:"request_response",kind:"message",T:X2,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Z2,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:q2,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:nE,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:$2,oneof:"message"}]),Ql=M.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:yi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:M.getEnumType(Hx)}]),Ir=M.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:M.getEnumType(yn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:M.getEnumType(lt)},{no:9,name:"layers",kind:"message",T:yi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ql,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:M.getEnumType(ut)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:M.getEnumType(qx)},{no:17,name:"audio_features",kind:"enum",T:M.getEnumType(ft),repeated:!0}]),fa=M.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:M.getEnumType(bn)},{no:3,name:"final",kind:"scalar",T:8}]),ga=M.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),A2=M.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:pa},{no:2,name:"participant",kind:"message",T:Vi},{no:3,name:"other_participants",kind:"message",T:Vi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:u0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:s0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:e0},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:$o,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),P2=M.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:u0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:s0},{no:3,name:"server_info",kind:"message",T:e0},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),_d=M.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ds}]),M2=M.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ti=M.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),D2=M.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Vi,repeated:!0}]),ma=M.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Qx,repeated:!0}]),l0=M.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:M.getEnumType(jd)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Nd=M.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:M.getEnumType(ft),repeated:!0}]),c0=M.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),xa=M.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:M.getEnumType(Sn)},{no:3,name:"action",kind:"enum",T:M.getEnumType(vs)},{no:4,name:"regions",kind:"message",T:K2}]),vs=M.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),d0=M.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:yi,repeated:!0}]),Ad=M.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),u0=M.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),O2=M.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Jx,repeated:!0}]),L2=M.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:pa}]),F2=M.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:M.getEnumType(Qs)},{no:3,name:"score",kind:"scalar",T:2}]),B2=M.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:F2,repeated:!0}]),z2=M.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:M.getEnumType(Zl)}]),U2=M.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:z2,repeated:!0}]),Pd=M.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:M.getEnumType(jd)},{no:2,name:"enabled",kind:"scalar",T:8}]),W2=M.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Pd,repeated:!0}]),V2=M.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Pd,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:W2,repeated:!0}]),$2=M.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:I2,repeated:!0}]),h0=M.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),p0=M.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:h0,repeated:!0}]),G2=M.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),q2=M.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:pa},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Vi},{no:4,name:"other_participants",kind:"message",T:Vi,repeated:!0}]),Md=M.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ti},{no:2,name:"subscription",kind:"message",T:ma},{no:3,name:"publish_tracks",kind:"message",T:_d,repeated:!0},{no:4,name:"data_channels",kind:"message",T:g0,repeated:!0},{no:5,name:"offer",kind:"message",T:Ti},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:f0,repeated:!0}]),f0=M.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),g0=M.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:M.getEnumType(bn)}]),En=M.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:M.getEnumType(_2),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),m0=M.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),H2=M.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),K2=M.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Y2,repeated:!0}]),Y2=M.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),J2=M.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:M.getEnumType(S2)}]),X2=M.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:M.getEnumType(Dd)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:fa,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Ir,oneof:"request"},{no:6,name:"mute",kind:"message",T:ga,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Ad,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Nd,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:c0,oneof:"request"}]),Dd=M.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),Z2=M.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),x0=M.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),Q2=M.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:n0},{no:2,name:"connection_settings",kind:"message",T:x0},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Ir,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Ti},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:M.getEnumType(Mi)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Md}]),eE=M.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:M.getEnumType(tE)},{no:2,name:"join_request",kind:"scalar",T:12}]),tE=M.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),nE=M.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function iE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var So={exports:{}},sE=So.exports,yp;function rE(){return yp||(yp=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(sE,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},a=null;function l(f,b){var S=f[b];if(typeof S.bind=="function")return S.bind(f);try{return Function.prototype.bind.call(S,f)}catch{return function(){return Function.prototype.apply.apply(S,[f,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(f){return f==="debug"&&(f="log"),typeof console===n?!1:f==="trace"&&i?c:console[f]!==void 0?l(console,f):console.log!==void 0?l(console,"log"):e}function u(){for(var f=this.getLevel(),b=0;b<r.length;b++){var S=r[b];this[S]=b<f?e:this.methodFactory(S,f,this.name)}if(this.log=this.debug,typeof console===n&&f<this.levels.SILENT)return"No console available for logging"}function h(f){return function(){typeof console!==n&&(u.call(this),this[f].apply(this,arguments))}}function p(f,b,S){return d(f)||h.apply(this,arguments)}function m(f,b){var S=this,C,j,w,v="loglevel";typeof f=="string"?v+=":"+f:typeof f=="symbol"&&(v=void 0);function E(_){var A=(r[_]||"silent").toUpperCase();if(!(typeof window===n||!v)){try{window.localStorage[v]=A;return}catch{}try{window.document.cookie=encodeURIComponent(v)+"="+A+";"}catch{}}}function k(){var _;if(!(typeof window===n||!v)){try{_=window.localStorage[v]}catch{}if(typeof _===n)try{var A=window.document.cookie,Y=encodeURIComponent(v),H=A.indexOf(Y+"=");H!==-1&&(_=/^([^;]+)/.exec(A.slice(H+Y.length+1))[1])}catch{}return S.levels[_]===void 0&&(_=void 0),_}}function T(){if(!(typeof window===n||!v)){try{window.localStorage.removeItem(v)}catch{}try{window.document.cookie=encodeURIComponent(v)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(_){var A=_;if(typeof A=="string"&&S.levels[A.toUpperCase()]!==void 0&&(A=S.levels[A.toUpperCase()]),typeof A=="number"&&A>=0&&A<=S.levels.SILENT)return A;throw new TypeError("log.setLevel() called with invalid level: "+_)}S.name=f,S.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},S.methodFactory=b||p,S.getLevel=function(){return w??j??C},S.setLevel=function(_,A){return w=N(_),A!==!1&&E(w),u.call(S)},S.setDefaultLevel=function(_){j=N(_),k()||S.setLevel(_,!1)},S.resetLevel=function(){w=null,T(),u.call(S)},S.enableAll=function(_){S.setLevel(S.levels.TRACE,_)},S.disableAll=function(_){S.setLevel(S.levels.SILENT,_)},S.rebuild=function(){if(a!==S&&(C=N(a.getLevel())),u.call(S),a===S)for(var _ in o)o[_].rebuild()},C=N(a?a.getLevel():"WARN");var R=k();R!=null&&(w=N(R)),u.call(S)}a=new m,a.getLogger=function(b){if(typeof b!="symbol"&&typeof b!="string"||b==="")throw new TypeError("You must supply a name when creating a logger.");var S=o[b];return S||(S=o[b]=new m(b,a.methodFactory)),S};var y=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=y),a},a.getLoggers=function(){return o},a.default=a,a})})(So)),So.exports}var ya=rE(),ec;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(ec||(ec={}));var wn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(wn||(wn={}));let xe=ya.getLogger("livekit");Object.values(wn).map(t=>ya.getLogger(t));xe.setDefaultLevel(ec.info);function ti(t){const e=ya.getLogger(t);return e.setDefaultLevel(xe.getLevel()),e}const oE=ya.getLogger("lk-e2ee"),qs=7e3,aE=[0,300,4*300,9*300,16*300,qs,qs,qs,qs,qs];class lE{constructor(e){this._retryDelays=e!==void 0?[...e]:aE}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function cE(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function I(t,e,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(u){try{d(i.next(u))}catch(h){a(h)}}function c(u){try{d(i.throw(u))}catch(h){a(h)}}function d(u){u.done?o(u.value):r(u.value).then(l,c)}d((i=i.apply(t,e||[])).next())})}function bp(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof bp=="function"?bp(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(a){return new Promise(function(l,c){a=t[o](a),r(l,c,a.done,a.value)})}}function r(o,a,l,c){Promise.resolve(c).then(function(d){o({value:d,done:l})},a)}}var to={exports:{}},vp;function dE(){if(vp)return to.exports;vp=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(v,E,k){return Function.prototype.apply.call(v,E,k)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:n=function(v){return Object.getOwnPropertyNames(v)};function i(w){console&&console.warn&&console.warn(w)}var r=Number.isNaN||function(v){return v!==v};function o(){o.init.call(this)}to.exports=o,to.exports.once=S,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(w){if(typeof w!="number"||w<0||r(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");a=w}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function c(w){return w._maxListeners===void 0?o.defaultMaxListeners:w._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(v){for(var E=[],k=1;k<arguments.length;k++)E.push(arguments[k]);var T=v==="error",N=this._events;if(N!==void 0)T=T&&N.error===void 0;else if(!T)return!1;if(T){var R;if(E.length>0&&(R=E[0]),R instanceof Error)throw R;var _=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw _.context=R,_}var A=N[v];if(A===void 0)return!1;if(typeof A=="function")e(A,this,E);else for(var Y=A.length,H=y(A,Y),k=0;k<Y;++k)e(H[k],this,E);return!0};function d(w,v,E,k){var T,N,R;if(l(E),N=w._events,N===void 0?(N=w._events=Object.create(null),w._eventsCount=0):(N.newListener!==void 0&&(w.emit("newListener",v,E.listener?E.listener:E),N=w._events),R=N[v]),R===void 0)R=N[v]=E,++w._eventsCount;else if(typeof R=="function"?R=N[v]=k?[E,R]:[R,E]:k?R.unshift(E):R.push(E),T=c(w),T>0&&R.length>T&&!R.warned){R.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");_.name="MaxListenersExceededWarning",_.emitter=w,_.type=v,_.count=R.length,i(_)}return w}o.prototype.addListener=function(v,E){return d(this,v,E,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(v,E){return d(this,v,E,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(w,v,E){var k={fired:!1,wrapFn:void 0,target:w,type:v,listener:E},T=u.bind(k);return T.listener=E,k.wrapFn=T,T}o.prototype.once=function(v,E){return l(E),this.on(v,h(this,v,E)),this},o.prototype.prependOnceListener=function(v,E){return l(E),this.prependListener(v,h(this,v,E)),this},o.prototype.removeListener=function(v,E){var k,T,N,R,_;if(l(E),T=this._events,T===void 0)return this;if(k=T[v],k===void 0)return this;if(k===E||k.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete T[v],T.removeListener&&this.emit("removeListener",v,k.listener||E));else if(typeof k!="function"){for(N=-1,R=k.length-1;R>=0;R--)if(k[R]===E||k[R].listener===E){_=k[R].listener,N=R;break}if(N<0)return this;N===0?k.shift():f(k,N),k.length===1&&(T[v]=k[0]),T.removeListener!==void 0&&this.emit("removeListener",v,_||E)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(v){var E,k,T;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[v]),this;if(arguments.length===0){var N=Object.keys(k),R;for(T=0;T<N.length;++T)R=N[T],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=k[v],typeof E=="function")this.removeListener(v,E);else if(E!==void 0)for(T=E.length-1;T>=0;T--)this.removeListener(v,E[T]);return this};function p(w,v,E){var k=w._events;if(k===void 0)return[];var T=k[v];return T===void 0?[]:typeof T=="function"?E?[T.listener||T]:[T]:E?b(T):y(T,T.length)}o.prototype.listeners=function(v){return p(this,v,!0)},o.prototype.rawListeners=function(v){return p(this,v,!1)},o.listenerCount=function(w,v){return typeof w.listenerCount=="function"?w.listenerCount(v):m.call(w,v)},o.prototype.listenerCount=m;function m(w){var v=this._events;if(v!==void 0){var E=v[w];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(w,v){for(var E=new Array(v),k=0;k<v;++k)E[k]=w[k];return E}function f(w,v){for(;v+1<w.length;v++)w[v]=w[v+1];w.pop()}function b(w){for(var v=new Array(w.length),E=0;E<v.length;++E)v[E]=w[E].listener||w[E];return v}function S(w,v){return new Promise(function(E,k){function T(R){w.removeListener(v,N),k(R)}function N(){typeof w.removeListener=="function"&&w.removeListener("error",T),E([].slice.call(arguments))}j(w,v,N,{once:!0}),v!=="error"&&C(w,T,{once:!0})})}function C(w,v,E){typeof w.on=="function"&&j(w,"error",v,E)}function j(w,v,E,k){if(typeof w.on=="function")k.once?w.once(v,E):w.on(v,E);else if(typeof w.addEventListener=="function")w.addEventListener(v,function T(N){k.once&&w.removeEventListener(v,T),E(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return to.exports}var Fn=dE();let y0=!0,b0=!0;function er(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Yi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=i.removeEventListener;i.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function uE(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(y0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function hE(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(b0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function v0(){if(typeof window=="object"){if(y0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Od(t,e){b0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function pE(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(er(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(er(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(er(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=er(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Sp(t){return Object.prototype.toString.call(t)==="[object Object]"}function S0(t){return Sp(t)?Object.keys(t).reduce(function(e,n){const i=Sp(t[n]),r=i?S0(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function tc(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?tc(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{tc(t,t.get(r),n)})}))}function kp(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(l=>{l.type===i&&l.trackId===a.id&&tc(t,l,r)})}),r}const wp=v0;function k0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let p={};typeof u.ideal=="number"?(p[h("min",d)]=u.ideal,c.optional.push(p),p={},p[h("max",d)]=u.ideal,c.optional.push(p)):(p[h("",d)]=u.ideal,c.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(p,d)]=u[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,p){h in u&&!(p in u)&&(u[p]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=i(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(p=>{p=p.filter(y=>y.kind==="videoinput");let m=p.find(y=>h.some(f=>y.label.toLowerCase().includes(f)));return!m&&p.length&&h.includes("back")&&(m=p[p.length-1]),m&&(l.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=i(l.video),wp("chrome: "+JSON.stringify(l)),c(l)})}l.video=i(l.video)}return wp("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,d){r(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(o(h))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function w0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function C0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Yi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function j0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=r.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>kp(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Yi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>kp(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,a;return this.getSenders().forEach(l=>{l.track===i&&(r?a=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===i&&(o?a=!0:o=l),l.track===i)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function E0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),r.apply(this,arguments)}}function R0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return E0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(f=>f===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[h.id];if(y)y.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const f=new t.MediaStream([u]);this._streams[h.id]=f,this._reverseStreams[f.id]=h,this.addStream(f)}return this.getSenders().find(f=>f.track===u)};function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],y=d._streams[m.id];h=h.replace(new RegExp(y.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],y=d._streams[m.id];h=h.replace(new RegExp(m.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[y=>{const f=o(this,y);p[0].apply(null,[f])},y=>{p[1]&&p[1].apply(null,y)},arguments[2]]):u.apply(this,arguments).then(y=>o(this,y))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(f=>u.track===f)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nc(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function I0(t,e){Yi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Cp=Object.freeze({__proto__:null,fixNegotiationNeeded:I0,shimAddTrackRemoveTrack:R0,shimAddTrackRemoveTrackWithNative:E0,shimGetSendersWithDtmf:j0,shimGetUserMedia:k0,shimMediaStream:w0,shimOnTrack:C0,shimPeerConnection:nc,shimSenderReceiverGetStats:T0});function _0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,a){Od("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function fE(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function N0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ic(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return i.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,l)}}function A0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function P0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Yi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function M0(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Od("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function D0(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function O0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function L0(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function F0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function B0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var jp=Object.freeze({__proto__:null,shimAddTransceiver:O0,shimCreateAnswer:B0,shimCreateOffer:F0,shimGetDisplayMedia:fE,shimGetParameters:L0,shimGetUserMedia:_0,shimOnTrack:N0,shimPeerConnection:ic,shimRTCDataChannel:D0,shimReceiverGetStats:P0,shimRemoveStream:M0,shimSenderGetStats:A0});function z0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function U0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function W0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=i.apply(this,[h]);return u?(p.then(d,u),Promise.resolve()):p};let l=function(c,d,u){const h=r.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=a.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function V0(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i($0(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function $0(t){return t&&t.video!==void 0?Object.assign({},t,{video:S0(t.video)}):t}function G0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let a=0;a<i.iceServers.length;a++){let l=i.iceServers[a];l.urls===void 0&&l.url?(Od("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(i.iceServers[a])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function q0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H0(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function K0(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Tp=Object.freeze({__proto__:null,shimAudioContext:K0,shimCallbacksAPI:W0,shimConstraints:$0,shimCreateOfferLegacy:H0,shimGetUserMedia:V0,shimLocalStreamsAPI:z0,shimRTCIceServerUrls:G0,shimRemoteStreamsAPI:U0,shimTrackEventTransceiver:q0}),Qa={exports:{}},Ep;function gE(){return Ep||(Ep=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)r=o[a].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{i.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(l=>{a.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let o=0;return i.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(y=>parseInt(y,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&d&&(m.rtx={ssrc:d}),i.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(m))}}),i.length===0&&c&&i.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,i.forEach(p=>{p.maxBitrate=h})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const a=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(Qa)),Qa.exports}var Y0=gE(),Ss=iE(Y0),mE=jT({__proto__:null,default:Ss},[Y0]);function ko(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=Ss.parseCandidate(i.candidate);for(const a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Yi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function sc(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Yi(t,"icecandidate",e=>{if(e.candidate){const n=Ss.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function wo(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Ss.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Ss.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Ss.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),d=r(c),u=o(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return a.apply(this,arguments)}}function Co(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Yi(t,"datachannel",i=>(e(i.channel,i.target),i))}function rc(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function oc(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function jo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function To(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var xE=Object.freeze({__proto__:null,removeExtmapAllowMixed:oc,shimAddIceCandidateNullOrEmpty:jo,shimConnectionState:rc,shimMaxMessageSize:wo,shimParameterlessSetLocalDescription:To,shimRTCIceCandidate:ko,shimRTCIceCandidateRelayProtocol:sc,shimSendThrowTypeError:Co});function yE(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=v0,i=pE(t),r={browserDetails:i,commonShim:xE,extractVersion:er,disableLog:uE,disableWarnings:hE,sdp:mE};switch(i.browser){case"chrome":if(!Cp||!nc||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Cp,jo(t,i),To(t),k0(t,i),w0(t),nc(t,i),C0(t),R0(t,i),j0(t),T0(t),I0(t,i),ko(t),sc(t),rc(t),wo(t,i),Co(t),oc(t,i);break;case"firefox":if(!jp||!ic||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=jp,jo(t,i),To(t),_0(t,i),ic(t,i),N0(t),M0(t),A0(t),P0(t),D0(t),O0(t),L0(t),F0(t),B0(t),ko(t),rc(t),wo(t,i),Co(t);break;case"safari":if(!Tp||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Tp,jo(t,i),To(t),G0(t),H0(t),W0(t),z0(t),U0(t),q0(t),V0(t),K0(t),ko(t),sc(t),wo(t,i),Co(t),oc(t,i);break;default:n("Unsupported browser!");break}return r}yE({window:typeof window>"u"?void 0:window});const bE=/version\/(\d+(\.?_?\d+)+)/i;let el;function Wt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(el===void 0||e){const i=vE.find(r=>{let{test:o}=r;return o.test(n)});el=i?.describe(n)}return el}const vE=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Eo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:tl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Eo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:tl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Eo(bE,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:tl(t)}}}];function Eo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function tl(t){return t.includes("mac os")?Eo(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var SE="2.16.1";const kE=SE,wE=16;class Bn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var We;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(We||(We={}));class pe extends Bn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=We[n]}static notAllowed(e,n,i){return new pe(e,We.NotAllowed,n,i)}static timeout(e){return new pe(e,We.Timeout)}static leaveRequest(e,n){return new pe(e,We.LeaveRequest,void 0,n)}static internal(e,n){return new pe(e,We.InternalError,void 0,n)}static cancelled(e){return new pe(e,We.Cancelled)}static serverUnreachable(e,n){return new pe(e,We.ServerUnreachable,n)}static websocket(e,n,i){return new pe(e,We.WebSocket,n,i)}}class Ld extends Bn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Hn extends Bn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class CE extends Bn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class dt extends Bn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ac extends Bn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Rp extends Bn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Ip extends Bn{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Dd[n]}}var At;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(At||(At={}));class sn extends Bn{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=At[n]}}class is extends Bn{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Yo;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Yo||(Yo={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Yo||(Yo={}));class wt{}wt.setTimeout=function(){return setTimeout(...arguments)};wt.setInterval=function(){return setInterval(...arguments)};wt.clearTimeout=function(){return clearTimeout(...arguments)};wt.clearInterval=function(){return clearInterval(...arguments)};var q;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(q||(q={}));var Z;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(Z||(Z={}));var X;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(X||(X={}));var J;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(J||(J={}));function jE(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Me{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const TE=["vp8","h264"],EE=["vp8","h264","vp9","av1","h265"];function RE(t){return!!TE.find(e=>e===t)}const IE=RE;var _p;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(_p||(_p={}));var lc;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(lc||(lc={}));const _r={h90:new Me(160,90,9e4,20),h180:new Me(320,180,16e4,20),h216:new Me(384,216,18e4,20),h360:new Me(640,360,45e4,20),h540:new Me(960,540,8e5,25),h720:new Me(1280,720,17e5,30),h1080:new Me(1920,1080,3e6,30),h1440:new Me(2560,1440,5e6,30),h2160:new Me(3840,2160,8e6,30)},cc={h120:new Me(160,120,7e4,20),h180:new Me(240,180,125e3,20),h240:new Me(320,240,14e4,20),h360:new Me(480,360,33e4,20),h480:new Me(640,480,5e5,20),h540:new Me(720,540,6e5,25),h720:new Me(960,720,13e5,30),h1080:new Me(1440,1080,23e5,30),h1440:new Me(1920,1440,38e5,30)},Fd={h360fps3:new Me(640,360,2e5,3,"medium"),h360fps15:new Me(640,360,4e5,15,"medium"),h720fps5:new Me(1280,720,8e5,5,"medium"),h720fps15:new Me(1280,720,15e5,15,"medium"),h720fps30:new Me(1280,720,2e6,30,"medium"),h1080fps15:new Me(1920,1080,25e5,15,"medium"),h1080fps30:new Me(1920,1080,5e6,30,"medium"),original:new Me(0,0,7e6,30,"medium")};function J0(t,e,n){var i,r,o,a;const{optionsWithoutProcessor:l,audioProcessor:c,videoProcessor:d}=Q0(t??{}),u=e?.processor,h=n?.processor,p=l??{};return p.audio===!0&&(p.audio={}),p.video===!0&&(p.video={}),p.audio&&(dc(p.audio,e),(i=(o=p.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||u)&&(p.audio.processor=c??u)),p.video&&(dc(p.video,n),(r=(a=p.video).deviceId)!==null&&r!==void 0||(a.deviceId={ideal:"default"}),(d||h)&&(p.video.processor=d??h)),p}function dc(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Bd(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const a={},l=a,c=t.video;Object.keys(c).forEach(d=>{switch(d){case"resolution":dc(l,c.resolution);break;default:l[d]=c[d]}}),o.video=a,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function X0(t){return I(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=Z0();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,a=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ct(n),r.getByteTimeDomainData(a);const c=a.some(d=>d!==128&&d!==0);return i.close(),!c}return!1})()})}function Z0(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>I(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function _E(t){return t==="audioinput"?W.Source.Microphone:t==="videoinput"?W.Source.Camera:W.Source.Unknown}function uc(t){return t===W.Source.Microphone?"audioinput":t===W.Source.Camera?"videoinput":void 0}function NE(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Gi()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function hr(t){return t.split("/")[1].toLowerCase()}function AE(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new _d({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function ke(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?ke(t.track):{})}}function PE(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function ME(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function Q0(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:jE(e)}}function DE(t){switch(t){case lt.CAMERA:return W.Source.Camera;case lt.MICROPHONE:return W.Source.Microphone;case lt.SCREEN_SHARE:return W.Source.ScreenShare;case lt.SCREEN_SHARE_AUDIO:return W.Source.ScreenShareAudio;default:return W.Source.Unknown}}function Np(t,e){return t.width*t.height<e.width*e.height}function OE(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const LE=5e3,Hs=[];var Ht;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Ht||(Ht={}));class W extends Fn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=W.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=xe,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),LE):this.handleAppVisibilityChanged()},this.log=ti((r=i.loggerName)!==null&&r!==void 0?r:wn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=W.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ke(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===W.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===W.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Hs.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Hs.splice(Hs.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),us(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?J.AudioPlaybackStarted:J.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?J.AudioPlaybackFailed:J.VideoPlaybackFailed,o):o.name==="AbortError"?xe.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):xe.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(J.ElementAttached,e),e}detach(e){try{if(e){ks(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(J.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{ks(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(J.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ti(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Hs.forEach(i=>{i.parentElement||(n=!1)}),n&&Hs.push(e)}}handleAppVisibilityChanged(){return I(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===W.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ut()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ut()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function us(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Gi()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Gi()||$i())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function ks(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(d){d.Audio="audio",d.Video="video",d.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(d){d.Camera="camera",d.Microphone="microphone",d.ScreenShare="screen_share",d.ScreenShareAudio="screen_share_audio",d.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(d){d.Active="active",d.Paused="paused",d.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(d){switch(d){case e.Audio:return yn.AUDIO;case e.Video:return yn.VIDEO;default:return yn.DATA}}t.kindToProto=r;function o(d){switch(d){case yn.AUDIO:return e.Audio;case yn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function a(d){switch(d){case n.Camera:return lt.CAMERA;case n.Microphone:return lt.MICROPHONE;case n.ScreenShare:return lt.SCREEN_SHARE;case n.ScreenShareAudio:return lt.SCREEN_SHARE_AUDIO;default:return lt.UNKNOWN}}t.sourceToProto=a;function l(d){switch(d){case lt.CAMERA:return n.Camera;case lt.MICROPHONE:return n.Microphone;case lt.SCREEN_SHARE:return n.ScreenShare;case lt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=l;function c(d){switch(d){case Zl.ACTIVE:return i.Active;case Zl.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(W||(W={}));const FE="|",Ap="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function BE(t){const e=t.split(FE);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ct(t){return I(this,void 0,void 0,function*(){return new Promise(e=>wt.setTimeout(e,t))})}function hc(){return"addTransceiver"in RTCPeerConnection.prototype}function pc(){return"addTrack"in RTCPeerConnection.prototype}function zE(){if(!("getCapabilities"in RTCRtpSender)||Gi()||$i())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function UE(){if(!("getCapabilities"in RTCRtpSender)||$i())return!1;if(Gi()){const n=Wt();if(n?.version&&On(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&On(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function vn(t){return t==="av1"||t==="vp9"}function fc(t){return!document||Nr()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function WE(){return typeof RTCPeerConnection>"u"?!1:hc()||pc()}function $i(){var t;return((t=Wt())===null||t===void 0?void 0:t.name)==="Firefox"}function Pp(){const t=Wt();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Gi(){var t;return((t=Wt())===null||t===void 0?void 0:t.name)==="Safari"}function Nr(){const t=Wt();return t?.name==="Safari"||t?.os==="iOS"}function VE(){const t=Wt();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&On(t.osVersion,"17")>=0}function $E(t){return t||(t=Wt()),t?.name==="Safari"&&On(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&On(t.osVersion,"18.3")>0}function ey(){var t,e;return Ut()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function GE(){const t=Wt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&On(t.osVersion,e)>=0?!0:t.name==="Safari"&&On(t.version,e)>=0}function Ut(){return typeof document<"u"}function Dn(){return navigator.product=="ReactNative"}function Ms(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function nl(t){return Ms(t)?t.hostname.split(".")[0]:null}function ty(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function ny(){if(!Dn())return;let t=ty();if(t)return t.platform}function Mp(){if(Ut())return window.devicePixelRatio;if(Dn()){let t=ty();if(t)return t.devicePixelRatio}return 1}function On(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const a=parseInt(n[o],10),l=parseInt(i[o],10);if(a>l)return 1;if(a<l)return-1;if(o===r-1&&a===l)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function qE(t){for(const e of t)e.target.handleResize(e)}function HE(t){for(const e of t)e.target.handleVisibilityChanged(e)}let il=null;const Dp=()=>(il||(il=new ResizeObserver(qE)),il);let sl=null;const Op=()=>(sl||(sl=new IntersectionObserver(HE,{root:null,rootMargin:"0px"})),sl);function KE(){var t;const e=new n0({sdk:i0.JS,protocol:wE,version:kE});return Dn()&&(e.os=(t=ny())!==null&&t!==void 0?t:""),e}function Lp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[l]=a.getTracks();if(!l)throw Error("Could not get empty media stream video track");return l.enabled=n,l}let Ks;function rl(){if(!Ks){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Ks]=i.stream.getAudioTracks(),!Ks)throw Error("Could not get empty media stream audio track");Ks.enabled=!1}return Ks.clone()}class on{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>I(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function YE(t){return EE.includes(t)}function bi(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function JE(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Ar(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function XE(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:a,endTime:l,final:c}=n;var d;const u=(d=e.get(i))!==null&&d!==void 0?d:Date.now(),h=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(l.toString()),final:c,language:o,firstReceivedTime:u,lastReceivedTime:h}})}function ZE(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Fp(t){switch(t.reason){case We.LeaveRequest:return t.context;case We.Cancelled:return Sn.CLIENT_INITIATED;case We.NotAllowed:return Sn.USER_REJECTED;case We.ServerUnreachable:return Sn.JOIN_FAILURE;default:return Sn.UNKNOWN_REASON}}function Ro(t){return t!==void 0?Number(t):void 0}function Di(t){return t!==void 0?BigInt(t):void 0}function ws(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function An(t){return!!t&&t.kind==W.Kind.Audio}function Ii(t){return!!t&&t.kind==W.Kind.Video}function ci(t){return ws(t)&&Ii(t)}function Un(t){return ws(t)&&An(t)}function gc(t){return!!t&&!t.isLocal}function QE(t){return!!t&&!t.isLocal}function ol(t){return gc(t)&&Ii(t)}function eR(t){return t.isLocal}function tR(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function nR(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function iR(t,e){const n=new URL(JE(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),sy(n,"rtc")}function sR(t){const e=new URL(Ar(t));return sy(e,"validate")}function iy(t){return t.endsWith("/")?t:"".concat(t,"/")}function sy(t,e){return t.pathname="".concat(iy(t.pathname)).concat(e),t.toString()}function Bp(t){if(typeof t=="string")return xp.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return xp.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function rR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const oR=10,Ys="lk_e2ee",aR="LKFrameEncryptionKey",lR={sharedKey:!1,ratchetSalt:aR,ratchetWindowSize:8,failureTolerance:oR,keyringSize:16};var vi;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(vi||(vi={}));var zp;(function(t){t.KeyRatcheted="keyRatcheted"})(zp||(zp={}));var gi;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(gi||(gi={}));var Up;(function(t){t.Error="cryptorError"})(Up||(Up={}));function cR(){return dR()||mc()}function mc(){return typeof window.RTCRtpScriptTransform<"u"}function dR(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function uR(t){var e,n,i,r,o;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=t.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new Yx({value:t.value})}class AA extends Fn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{xe.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},lR),e),this.on(vi.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(vi.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(vi.RatchetRequest,e,n)}}var Wp;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Wp||(Wp={}));class hR extends Fn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,o;const{kind:a,data:l}=i.data;switch(a){case"error":if(xe.error(l.error.message),l.uuid){const u=this.decryptDataRequests.get(l.uuid);if(u?.reject){u.reject(l.error);break}const h=this.encryptDataRequests.get(l.uuid);if(h?.reject){h.reject(l.error);break}}this.emit(gi.EncryptionError,l.error,l.participantIdentity);break;case"initAck":l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(l.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==l.enabled&&l.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(gi.ParticipantEncryptionStatusChanged,l.enabled,this.room.localParticipant),this.encryptionEnabled=l.enabled;else if(l.participantIdentity){const u=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(l.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(l.participantIdentity));this.emit(gi.ParticipantEncryptionStatusChanged,l.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(vi.KeyRatcheted,l.ratchetResult,l.participantIdentity,l.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(l.uuid);c?.resolve&&c.resolve(l);break;case"encryptDataResponse":const d=this.encryptDataRequests.get(l.uuid);d?.resolve&&d.resolve(l);break}},this.onWorkerError=i=>{xe.error("e2ee worker encountered an error:",{error:i.error}),this.emit(gi.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!cR())throw new Ld("tried to setup end-to-end encryption on an unsupported browser");if(xe.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:oE.getLevel()}};this.worker&&(xe.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){xe.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?xe.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(X.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(q.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ut.NONE,r.identity)),e.on(q.ConnectionStateChanged,i=>{i===Ie.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==ut.NONE,r.identity)})})}).on(q.TrackUnsubscribed,(i,r,o)=>{var a;const l={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(l)}).on(q.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(q.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Z.LocalSenderCreated,(i,r)=>I(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(Z.LocalTrackPublished,i=>{if(!Ii(i.track)||!Nr())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:hr(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(vi.SetKey,i=>this.postKey(i)).on(vi.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return I(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new on;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:n,participantIdentity:i,keyIndex:r}},l=new on;return l.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,l),this.worker.postMessage(a),l.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?hr(i.mimeType):void 0)}}setupE2EESender(e,n){if(!ws(e)||!n){n||xe.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return I(this,void 0,void 0,function*(){if(this.worker){if(mc()&&!Pp()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Ys in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,a=c.readable}const l={kind:"decode",data:{readableStream:a,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:Ys in e}};this.worker.postMessage(l,[a,o])}e[Ys]=!0}})}handleSender(e,n,i){var r;if(!(Ys in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(mc()&&!Pp()){xe.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{xe.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[o.readable,o.writable])}e[Ys]=!0}}}const pR=500,fR=15e3;class Cs{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Cs),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=nl(i);if(!r)return;let o=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,Ct(Math.min(pR*Math.pow(2,o),fR)))}getBackOffPromise(e){const n=new URL(e),i=n&&nl(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&nl(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Cs._instance=null;const al="default";class gt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new gt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=gt.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){xe.debug("awaiting getUserMedia promise");try{n?yield gt.userMediaPromiseMap.get(n):yield Promise.all(gt.userMediaPromiseMap.values())}catch{xe.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Gi()&&i.hasDeviceInUse(n))&&(a.filter(c=>c.kind===n).length===0||a.some(c=>{const d=c.label==="",u=n?c.kind===n:!0;return d&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},d=yield navigator.mediaDevices.getUserMedia(c);a=yield navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=a,n&&(a=a.filter(l=>l.kind===n)),a})()})}normalizeDeviceId(e,n,i){return I(this,void 0,void 0,function*(){if(n!==al)return n;const r=yield this.getDevices(e),o=r.find(l=>l.deviceId===al);if(!o){xe.warn("could not reliably determine default device");return}const a=r.find(l=>l.deviceId!==al&&l.groupId===(i??o.groupId));if(!a){xe.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(e){return e?gt.userMediaPromiseMap.has(e):gt.userMediaPromiseMap.size>0}}gt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];gt.userMediaPromiseMap=new Map;var pr;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(pr||(pr={}));class gR{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ot,this.nextTaskIndex=0}run(e){return I(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:pr.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=pr.RUNNING,yield e()}finally{n.status=pr.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return I(this,void 0,void 0,function*(){return this.run(()=>I(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class mR{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const a=function(){let{closeCode:l,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(l,c)};this.opened=new Promise((l,c)=>{o.onopen=()=>{l({readable:new ReadableStream({start(d){o.onmessage=u=>{let{data:h}=u;return d.enqueue(h)},o.onerror=u=>d.error(u)},cancel:a}),writable:new WritableStream({write(d){o.send(d)},abort(){o.close()},close:a}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",c)},o.addEventListener("error",c)}),this.closed=new Promise((l,c)=>{const d=()=>I(this,void 0,void 0,function*(){const u=new Promise(p=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",m=>{p(m)},{once:!0})}),h=yield Promise.race([Ct(250),u]);h?l(h):c(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=u=>{let{code:h,reason:p}=u;l({closeCode:h,reason:p}),o.removeEventListener("error",d)},o.addEventListener("error",d)}),n.signal&&(n.signal.onabort=()=>o.close()),this.close=a}}const xR=["syncState","trickle","offer","answer","simulate","leave"];function yR(t){const e=xR.indexOf(t.case)>=0;return xe.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Be;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Be||(Be={}));const bR=250;class zd{get currentState(){return this.state}get isDisconnected(){return this.state===Be.DISCONNECTING||this.state===Be.DISCONNECTED}get isEstablishingConnection(){return this.state===Be.CONNECTING||this.state===Be.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Be.DISCONNECTED,this.log=xe,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ti((i=n.loggerName)!==null&&i!==void 0?i:wn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new gR,this.queuedRequests=[],this.closingLock=new Ot,this.connectionLock=new Ot,this.state=Be.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return I(this,void 0,void 0,function*(){return this.state=Be.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Be.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return I(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=i;const a=KE(),l=i.singlePeerConnection?SR(n,a,i):vR(n,a,i),c=iR(e,l),d=sR(c);return new Promise((u,h)=>I(this,void 0,void 0,function*(){var p,m;try{let y=!1;const f=w=>I(this,void 0,void 0,function*(){if(y)return;y=!0;const v=w instanceof Event?w.currentTarget:w,E=rR(v,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(E)).catch(k=>{this.log.error(k),this.close()}):this.close(),b(),h(pe.cancelled(E))});r?.addEventListener("abort",f);const b=()=>{clearTimeout(S),r?.removeEventListener("abort",f)},S=setTimeout(()=>{f(pe.timeout("room connection has timed out (signal)"))},i.websocketTimeout),C=(w,v)=>{this.handleSignalConnected(w,S,v)},j=new URL(c);j.searchParams.has("access_token")&&j.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(j),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new mR(c);try{this.ws.closed.then(R=>{var _;this.isEstablishingConnection&&h(pe.internal("Websocket got closed during a (re)connection attempt: ".concat(R.reason))),R.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:R.reason,code:R.closeCode,wasClean:R.closeCode===1e3,state:this.state})),this.state===Be.CONNECTED&&this.handleOnClose((_=R.reason)!==null&&_!==void 0?_:"Unexpected WS error"))}).catch(R=>{this.isEstablishingConnection&&h(pe.internal("Websocket error during a (re)connection attempt: ".concat(R)))});const w=yield this.ws.opened.catch(R=>I(this,void 0,void 0,function*(){if(this.state!==Be.CONNECTED){this.state=Be.DISCONNECTED,clearTimeout(S);const _=yield this.handleConnectionError(R,d);h(_);return}this.handleWSError(R),h(R)}));if(clearTimeout(S),!w)return;const v=w.readable.getReader();this.streamWriter=w.writable.getWriter();const E=yield v.read();if(v.releaseLock(),!E.value)throw pe.internal("no message received as first message");const k=Bp(E.value),T=this.validateFirstMessage(k,(p=i.reconnect)!==null&&p!==void 0?p:!1);if(!T.isValid){h(T.error);return}((m=k.message)===null||m===void 0?void 0:m.case)==="join"&&(this.pingTimeoutDuration=k.message.value.pingTimeout,this.pingIntervalDuration=k.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const N=T.shouldProcessFirstMessage?k:void 0;C(w,N),u(T.response)}catch(w){h(w)}finally{b()}}finally{o()}}))})}startReadingLoop(e,n){return I(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Ct(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const o=Bp(r);this.handleSignalResponse(o)}})}close(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Be.DISCONNECTING||Be.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Be.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Ct(bR)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{n&&(e.state=Be.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:hs(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:hs(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new fa({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ga({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const l=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new Ad({requestId:l,metadata:i,name:r,attributes:a})}),l})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new d0({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new p0({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Ge.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new m0({timestamp:Ge.parse(Date.now()),rtt:Ge.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Nd({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new xa({reason:Sn.CLIENT_INITIATED,action:vs.DISCONNECT})})}sendRequest(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!yR(n)&&i.state===Be.RECONNECTING){i.queuedRequests.push(()=>I(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ct(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const a=new N2({message:n});try{i.useJSON?yield i.streamWriter.write(a.toJsonString()):yield i.streamWriter.write(a.toBinary())}catch(l){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:l}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const a=Vp(r.value);this.onAnswer&&this.onAnswer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const a=Vp(r.value);this.onOffer&&this.onOffer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const a=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(a,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return I(this,void 0,void 0,function*(){if(this.state===Be.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=wt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&wt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=wt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&wt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=Be.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,o,a,l;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Be.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=e.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:pe.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:pe.internal("Unexpected first message")}:{isValid:!1,error:pe.internal("did not receive join response, got ".concat((l=e.message)===null||l===void 0?void 0:l.case," instead"))}}handleConnectionError(e,n){return I(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return pe.notAllowed(r,i.status)}else return e instanceof pe?e:pe.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof pe?i:pe.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Vp(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function hs(t,e){return new Ti({sdp:t.sdp,type:t.type,id:e})}function vR(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Dn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function SR(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new Q2({clientInfo:e,connectionSettings:new x0({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const o=new eE({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class $p{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class kR{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var gn={},ll={},cl={exports:{}},Gp;function Ud(){if(Gp)return cl.exports;Gp=1;var t=cl.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),cl.exports}var qp;function wR(){return qp||(qp=1,(function(t){var e=function(l){return String(Number(l))===l?Number(l):l},n=function(l,c,d,u){if(u&&!d)c[u]=e(l[1]);else for(var h=0;h<d.length;h+=1)l[h+1]!=null&&(c[d[h]]=e(l[h+1]))},i=function(l,c,d){var u=l.name&&l.names;l.push&&!c[l.push]?c[l.push]=[]:u&&!c[l.name]&&(c[l.name]={});var h=l.push?{}:u?c[l.name]:c;n(d.match(l.reg),h,l.names,l.name),l.push&&c[l.push].push(h)},r=Ud(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(l){var c={},d=[],u=c;return l.split(/(\r\n|\r|\n)/).filter(o).forEach(function(h){var p=h[0],m=h.slice(2);p==="m"&&(d.push({rtp:[],fmtp:[]}),u=d[d.length-1]);for(var y=0;y<(r[p]||[]).length;y+=1){var f=r[p][y];if(f.reg.test(m))return i(f,u,m)}}),c.media=d,c};var a=function(l,c){var d=c.split(/=(.+)/,2);return d.length===2?l[d[0]]=e(d[1]):d.length===1&&c.length>1&&(l[d[0]]=void 0),l};t.parseParams=function(l){return l.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(l){return l.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(l){for(var c=[],d=l.split(" ").map(e),u=0;u<d.length;u+=3)c.push({component:d[u],ip:d[u+1],port:d[u+2]});return c},t.parseImageAttributes=function(l){return l.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(l){return l.split(";").map(function(c){return c.split(",").map(function(d){var u,h=!1;return d[0]!=="~"?u=e(d):(u=e(d.substring(1,d.length)),h=!0),{scid:u,paused:h}})})}})(ll)),ll}var dl,Hp;function CR(){if(Hp)return dl;Hp=1;var t=Ud(),e=/%[sdv%]/g,n=function(a){var l=1,c=arguments,d=c.length;return a.replace(e,function(u){if(l>=d)return u;var h=c[l];switch(l+=1,u){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},i=function(a,l,c){var d=l.format instanceof Function?l.format(l.push?c:c[l.name]):l.format,u=[a+"="+d];if(l.names)for(var h=0;h<l.names.length;h+=1){var p=l.names[h];l.name?u.push(c[l.name][p]):u.push(c[l.names[h]])}else u.push(c[l.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return dl=function(a,l){l=l||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=l.outerOrder||r,d=l.innerOrder||o,u=[];return c.forEach(function(h){t[h].forEach(function(p){p.name in a&&a[p.name]!=null?u.push(i(h,p,a)):p.push in a&&a[p.push]!=null&&a[p.push].forEach(function(m){u.push(i(h,p,m))})})}),a.media.forEach(function(h){u.push(i("m",t.m[0],h)),d.forEach(function(p){t[p].forEach(function(m){m.name in h&&h[m.name]!=null?u.push(i(p,m,h)):m.push in h&&h[m.push]!=null&&h[m.push].forEach(function(y){u.push(i(p,m,y))})})})}),u.join(`\r
`)+`\r
`},dl}var Kp;function jR(){if(Kp)return gn;Kp=1;var t=wR(),e=CR(),n=Ud();return gn.grammar=n,gn.write=e,gn.parse=t.parse,gn.parseParams=t.parseParams,gn.parseFmtpConfig=t.parseFmtpConfig,gn.parsePayloads=t.parsePayloads,gn.parseRemoteCandidates=t.parseRemoteCandidates,gn.parseImageAttributes=t.parseImageAttributes,gn.parseSimulcastStreamList=t.parseSimulcastStreamList,gn}var hi=jR();function Wd(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var a=(i=n.isImmediate)!=null&&i,l=(r=n.callback)!=null&&r,c=n.maxWait,d=Date.now(),u=[];function h(){if(c!==void 0){var m=Date.now()-d;if(m+e>=c)return c-m}return e}var p=function(){var m=[].slice.call(arguments),y=this;return new Promise(function(f,b){var S=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,d=Date.now(),!a){var j=t.apply(y,m);l&&l(j),u.forEach(function(w){return(0,w.resolve)(j)}),u=[]}},h()),S){var C=t.apply(y,m);return l&&l(C),f(C)}u.push({resolve:f,reject:b})})};return p.cancel=function(m){o!==void 0&&clearTimeout(o),u.forEach(function(y){return(0,y.reject)(m)}),u=[]},p}const TR=.7,ER=20,js={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Yp extends Fn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=xe,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Wd(r=>I(this,void 0,void 0,function*(){this.emit(js.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),ER),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ti((i=n.loggerName)!==null&&i!==void 0?i:wn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ot}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return I(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return I(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:a}=RR(e);this.remoteStereoMids=o,this.remoteNackMids=a}else if(e.type==="answer"){const o=hi.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(a=>{const l=Vd(a.mid);a.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||l!=c.transceiver.mid)return!1;let d=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0)return!0;let u=!1;for(const h of a.fmtp)if(h.payload===d){h.config=h.config.split(";").filter(p=>!p.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),u=!0;break}return u||c.maxbr>0&&a.fmtp.push({payload:d,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=hi.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(js.NegotiationComplete),e.sdp&&hi.parse(e.sdp).media.forEach(a=>{a.type==="video"&&this.emit(js.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const l=this._pc.remoteDescription;if(e?.iceRestart&&l)yield this._pc.setRemoteDescription(l);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const a=hi.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(l=>{Xp(l),l.type==="audio"?Jp(l,["all"],[]):l.type==="video"&&this.trackBitrates.some(c=>{if(!l.msid||!c.cid||!l.msid.includes(c.cid))return!1;let d=0;if(l.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(d=h.payload,!0):!1),d===0||(vn(c.codec)&&!Gi()&&this.ensureVideoDDExtensionForSVC(l,a),!vn(c.codec)))return!0;const u=Math.round(c.maxbr*TR);for(const h of l.fmtp)if(h.payload===d){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,hi.write(a)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=hi.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Xp(r),r.type==="audio"&&Jp(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,hi.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new dt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new dt("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return I(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(l=>{switch(l.type){case"transport":n=l.selectedCandidatePairId;break;case"candidate-pair":n===""&&l.selected&&(n=l.id),i.set(l.id,l);break;case"remote-candidate":r.set(l.id,"".concat(l.address,":").concat(l.port));break}}),n==="")return;const a=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}setMungedSDP(e,n,i){return I(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const a={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new ac(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(a=>a.uri===Ap))){if(this.ddExtID===0){let a=0;n.media.forEach(l=>{var c;l.type==="video"&&((c=l.ext)===null||c===void 0||c.forEach(d=>{d.value>a&&(a=d.value)}))}),this.ddExtID=a+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Ap})}}}function Jp(t,e,n){const i=Vd(t.mid);let r=0;t.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function RR(t){var e;const n=[],i=[],r=hi.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(a=>{var l;const c=Vd(a.mid);a.type==="audio"&&(a.rtp.some(d=>d.codec==="opus"?(o=d.payload,!0):!1),!((l=a.rtcpFb)===null||l===void 0)&&l.some(d=>d.payload===o&&d.type==="nack")&&i.push(c),a.fmtp.some(d=>d.payload===o?(d.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function Xp(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Vd(t){return typeof t=="number"?t.toFixed(0):t}const xc="vp8",IR={audioPreset:lc.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Fd.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:xc,backupCodec:!0,preConnectBuffer:!1},ry={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},oy={deviceId:{ideal:"default"},resolution:_r.h720.resolution},_R={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new lE,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},$d={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var tt;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(tt||(tt={}));class NR{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=$d.peerConnectionTimeout,this.log=xe,this.updateState=()=>{var o,a;const l=this.state,c=this.requiredTransports.map(d=>d.getConnectionState());c.every(d=>d==="connected")?this.state=tt.CONNECTED:c.some(d=>d==="failed")?this.state=tt.FAILED:c.some(d=>d==="connecting")?this.state=tt.CONNECTING:c.every(d=>d==="closed")?this.state=tt.CLOSED:c.some(d=>d==="closed")?this.state=tt.CLOSING:c.every(d=>d==="new")&&(this.state=tt.NEW),l!==this.state&&(this.log.debug("pc state change: from ".concat(tt[l]," to ").concat(tt[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=ti((r=i.loggerName)!==null&&r!==void 0?r:wn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Yp(e,i),n!=="publisher-only"&&(this.subscriber=new Yp(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,bn.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,o)},this.subscriber.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,bn.PUBLISHER)},this.publisher.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)},this.publisher.onOffer=(o,a)=>{var l;(l=this.onPublisherOffer)===null||l===void 0||l.call(this,o,a)},this.state=tt.NEW,this.connectionLock=new Ot,this.remoteOfferLock=new Ot}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return I(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return I(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return I(this,void 0,void 0,function*(){var i;n===bn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return I(this,void 0,void 0,function*(){var i,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return I(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return I(this,void 0,void 0,function*(){return new Promise((n,i)=>I(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(js.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(js.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(a=>{clearTimeout(r),i(a)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===bn.PUBLISHER?this.publisher.getConnectedAddress():e===bn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((c,d)=>I(o,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),wt.clearTimeout(h),d(pe.cancelled("room connection has been cancelled"))};r?.signal.aborted&&u(),r?.signal.addEventListener("abort",u);const h=wt.setTimeout(()=>{r?.signal.removeEventListener("abort",u),d(pe.internal("could not establish pc connection"))},a);for(;this.state!==tt.CONNECTED;)if(yield Ct(50),r?.signal.aborted){d(pe.cancelled("room connection has been cancelled"));return}wt.clearTimeout(h),r?.signal.removeEventListener("abort",u),c()}))})()})}}const ay=5e3,AR=3e4;class Re{static fetchRegionSettings(e,n,i){return I(this,void 0,void 0,function*(){const r=yield Re.fetchLock.lock();try{const o=yield fetch("".concat(PR(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(o.ok){const a=nR(o.headers),l=a?a*1e3:ay;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:l}}else throw o.status===401?pe.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):pe.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof pe?o:i?.aborted?pe.cancelled("Region fetching was aborted"):pe.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,n,i){return I(this,void 0,void 0,function*(){const r=Re.settingsTimeouts.get(e.hostname);clearTimeout(r),Re.settingsTimeouts.set(e.hostname,setTimeout(()=>I(this,void 0,void 0,function*(){try{const o=yield Re.fetchRegionSettings(e,n);Re.updateCachedRegionSettings(e,n,o)}catch(o){if(o instanceof pe&&o.reason===We.NotAllowed){xe.debug("token is not valid, cancelling auto region refresh");return}xe.debug("auto refetching of region settings failed",{error:o}),Re.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Re.cache.set(e.hostname,i),Re.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Re.settingsTimeouts.get(e);n&&(clearTimeout(n),Re.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Re.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Re.connectionTrackers.get(e);i&&i.connectionCount===0&&(xe.debug("stopping region refetch after disconnect delay",{hostname:e}),Re.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},AR))}static cancelCleanup(e){const n=Re.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Re.connectionTrackers.get(e);n||(n={connectionCount:0},Re.connectionTrackers.set(e,n)),n.connectionCount++,Re.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Re.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Re.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Ms(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return I(this,void 0,void 0,function*(){return Re.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return I(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Re.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Re.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),xe.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Re.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Re.cache=new Map;Re.settingsTimeouts=new Map;Re.connectionTrackers=new Map;Re.fetchLock=new Ot;function PR(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class it extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Zp(n,it.MAX_MESSAGE_BYTES),this.data=i?Zp(i,it.MAX_DATA_BYTES):void 0}static fromProto(e){return new it(e.code,e.message,e.data)}toProto(){return new Zx({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new it(it.ErrorCode[e],it.ErrorMessage[e],n)}}it.MAX_MESSAGE_BYTES=256;it.MAX_DATA_BYTES=15360;it.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};it.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const ly=15360;function Gd(t){return new TextEncoder().encode(t).length}function Zp(t,e){if(Gd(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const qd=2e3;function ba(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Hd=typeof MediaRecorder<"u";class MR{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const DR=Hd?MediaRecorder:MR;class OR extends DR{constructor(e,n){if(!Hd)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,a=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r?.close(),r=void 0},l=c=>{r?.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",l),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=d=>I(this,void 0,void 0,function*(){let u;if(d.data.arrayBuffer){const h=yield d.data.arrayBuffer();u=new Uint8Array(h)}else if(d.data.byteArray)u=d.data.byteArray;else throw new Error("no data available!");o()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",l)}}function LR(){return Hd}const FR=1e3,BR=1e4;class cy extends W{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Wd(()=>I(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>I(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(J.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ot,this.pauseUpstreamLock=new Ot,this.trackChangeLock=new Ot,this.trackChangeLock.lock().then(a=>I(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{a()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==W.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return I(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{ks(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(us(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{us(r??e,o)}))})}waitForDimensions(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:FR;return(function*(){var i;if(e.kind===W.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Wt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ct(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Ct(50)}throw new Hn("unable to get track dimensions after timeout")})()})}setDeviceId(e){return I(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===bi(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),bi(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===W.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===W.Kind.Audio?"audioinput":"videoinput";return n?gt.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return I(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return I(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Hn("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return I(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=cE(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===W.Kind.Video?a.video=i||r?{deviceId:i,facingMode:r}:!0:a.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(d=>{ks(this.mediaStreamTrack,d)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===W.Kind.Video&&(yield c.applyConstraints(o)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(J.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?J.Muted:J.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ey()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(J.UpstreamPaused,this);const i=Wt();if(i?.name==="Safari"&&On(i.version,"12.0")<0)throw new Ld("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(J.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const a=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const l=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:l,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(us(i._mediaStreamTrack,l),l.muted=!0,l.play().catch(d=>{d instanceof DOMException&&d.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:d})),setTimeout(()=>{l.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:d}))}),i.processor=n,i.processorElement=l,i.processor.processedTrack){for(const d of i.attachedElements)d!==i.processorElement&&r&&(ks(i._mediaStreamTrack,d),us(i.processor.processedTrack,d));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(J.TrackProcessorUpdate,i.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(J.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!LR()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new OR(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},BR)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Jo extends cy{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,W.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(l){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}a&&this.prevStats&&(this._currentBitrate=ba(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(J.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(J.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===W.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==bi(this._constraints.deviceId);return this.source===W.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return I(this,void 0,void 0,function*(){let n;if(e){const i=Bd({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return I(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Ut()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},qd)))}setProcessor(e){return I(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Dn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(J.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return I(this,void 0,void 0,function*(){const e=yield X0(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(J.AudioSilenceDetected)),e})}}function zR(t,e,n){switch(t.kind){case"audio":return new Jo(t,e,!1,void 0,n);case"video":return new Xo(t,e,!1,n);default:throw new Hn("unsupported track type: ".concat(t.kind))}}const UR=Object.values(_r),WR=Object.values(cc),VR=Object.values(Fd),$R=[_r.h180,_r.h360],GR=[cc.h180,cc.h360],qR=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new Me(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),yc=["q","h","f"];function bc(t,e,n,i){var r,o;let a=i?.videoEncoding;t&&(a=i?.screenShareEncoding);const l=i?.simulcast,c=i?.scalabilityMode,d=i?.videoCodec;if(!a&&!l&&!c||!e||!n)return[{}];a||(a=KR(t,e,n,d),xe.debug("using video encoding",a));const u=a.maxFramerate,h=new Me(e,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&vn(d)){const y=new dy(c),f=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const b=Wt();if(Nr()||Dn()||b?.name==="Chrome"&&On(b?.version,"113")<0){const S=y.suffix=="h"?2:3,C=$E(b);for(let j=0;j<y.spatial;j+=1)f.push({rid:yc[2-j],maxBitrate:a.maxBitrate/Math.pow(S,j),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:C?Math.pow(2,j):void 0});f[0].scalabilityMode=c}else f.push({maxBitrate:a.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(f[0].priority=h.encoding.priority,f[0].networkPriority=h.encoding.priority),xe.debug("using svc encoding",{encodings:f}),f}if(!l)return[a];let p=[];t?p=(r=ef(i?.screenShareSimulcastLayers))!==null&&r!==void 0?r:Qp(t,h):p=(o=ef(i?.videoSimulcastLayers))!==null&&o!==void 0?o:Qp(t,h);let m;if(p.length>0){const y=p[0];p.length>1&&([,m]=p);const f=Math.max(e,n);if(f>=960&&m)return ul(e,n,[y,m,h],u);if(f>=480)return ul(e,n,[y,h],u)}return ul(e,n,[h])}function HR(t,e,n){var i,r,o,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&xe.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const l=t.mediaStreamTrack.getSettings(),c=(i=l.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,d=(o=l.height)!==null&&o!==void 0?o:(a=t.dimensions)===null||a===void 0?void 0:a.height;return t.source===W.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),bc(t.source===W.Source.ScreenShare,c,d,n)}function KR(t,e,n,i){const r=YR(t,e,n);let{encoding:o}=r[0];const a=Math.max(e,n);for(let l=0;l<r.length;l+=1){const c=r[l];if(o=c.encoding,c.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function YR(t,e,n){if(t)return VR;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?UR:WR}function Qp(t,e){if(t)return qR(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?$R:GR}function ul(t,e,n,i){const r=[];if(n.forEach((o,a)=>{if(a>=yc.length)return;const l=Math.min(t,e),d={rid:yc[a],scaleResolutionDownBy:Math.max(1,l/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},u=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;u&&(d.maxFramerate=u);const h=$i()||a===0;o.encoding.priority&&h&&(d.priority=o.encoding.priority,d.networkPriority=o.encoding.priority),r.push(d)}),Dn()&&ny()==="ios"){let o;r.forEach(l=>{o?l.maxFramerate&&l.maxFramerate>o&&(o=l.maxFramerate):o=l.maxFramerate});let a=!0;r.forEach(l=>{var c;l.maxFramerate!=o&&(a&&(a=!1,xe.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),xe.info('Setting framerate of encoding "'.concat((c=l.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),l.maxFramerate=o)})}return r}function ef(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class dy{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function JR(t){return t.source===W.Source.ScreenShare||t.constraints.height&&bi(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const XR=5e3;class Xo extends cy{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,W.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>I(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const a=new Map(o.map(c=>[c.rid,c])),l=o.some(c=>c.qualityLimitationReason==="cpu");if(l!==this.isCpuConstrained&&(this.isCpuConstrained=l,this.isCpuConstrained&&this.emit(J.CpuConstrained)),this.prevStats){let c=0;a.forEach((d,u)=>{var h;const p=(h=this.prevStats)===null||h===void 0?void 0:h.get(u);c+=ba(d,p)}),this._currentBitrate=c}this.prevStats=a}),this.senderLock=new Ot}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Ut())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},qd))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.pauseUpstream.call(this);try{for(var l=!0,c=qn(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0)o=d.value,l=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return I(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.resumeUpstream.call(this);try{for(var l=!0,c=qn(this.simulcastCodecs.values()),d;d=yield c.next(),n=d.done,!n;l=!0){o=d.value,l=!1;const u=o;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return I(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return I(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},l=i.get(r.remoteId);l&&(a.jitter=l.jitter,a.packetsLost=l.packetsLost,a.roundTripTime=l.roundTripTime),n.push(a)}}),n.sort((r,o)=>{var a,l;return((a=o.frameWidth)!==null&&a!==void 0?a:0)-((l=r.frameWidth)!==null&&l!==void 0?l:0)}),n})}setPublishingQuality(e){const n=[];for(let i=Ht.LOW;i<=Ht.HIGH;i+=1)n.push(new Pd({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(vn(this.codec),n)}restartTrack(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a;let l;if(e){const h=Bd({video:e});typeof h.video!="boolean"&&(l=h.video)}yield this.restart(l),this.isCpuConstrained=!1;try{for(var c=!0,d=qn(this.simulcastCodecs.values()),u;u=yield d.next(),n=u.done,!n;c=!0){o=u.value,c=!1;const h=o;h.sender&&((a=h.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){i={error:h}}finally{try{!c&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return I(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,l,c,d,u,h;if(yield n.setProcessor.call(r,i,o),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var p=!0,m=qn(r.simulcastCodecs.values()),y;y=yield m.next(),a=y.done,!a;p=!0)d=y.value,p=!1,yield(h=d.sender)===null||h===void 0?void 0:h.replaceTrack(r.processor.processedTrack)}catch(f){l={error:f}}finally{try{!p&&!a&&(c=m.return)&&(yield c.call(m))}finally{if(l)throw l.error}}})()})}setDegradationPreference(e){return I(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},XR))}setPublishingCodecs(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a,l,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(vn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const d=[];try{for(n=!0,i=qn(e);r=yield i.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(vn(u.codec),u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const p of u.qualities)if(p.enabled){d.push(u.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield tf(h.sender,h.encodings,u.qualities,this.senderLock,vn(u.codec),this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!n&&!o&&(l=i.return)&&(yield l.call(i))}finally{if(a)throw a.error}}return d})}setPublishingLayers(e,n){return I(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield tf(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return I(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&vn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),ey()&&this.isInBackground&&this.source===W.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function tf(t,e,n,i,r,o,a){return I(this,void 0,void 0,function*(){const l=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:d}=c;if(!d)return;if(d.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:d,senderEncodings:e}));return}let u=!1;!1&&d[0].scalabilityMode||(r&&n.some(m=>m.enabled)&&n.forEach(m=>m.enabled=!0),d.forEach((p,m)=>{var y;let f=(y=p.rid)!==null&&y!==void 0?y:"";f===""&&(f="q");const b=uy(f),S=n.find(C=>C.quality===b);S&&p.active!==S.enabled&&(u=!0,p.active=S.enabled,o.debug("setting layer ".concat(S.quality," to ").concat(p.active?"enabled":"disabled"),a),$i()&&(S.enabled?(p.scaleResolutionDownBy=e[m].scaleResolutionDownBy,p.maxBitrate=e[m].maxBitrate,p.maxFrameRate=e[m].maxFrameRate):(p.scaleResolutionDownBy=4,p.maxBitrate=10,p.maxFrameRate=2)))})),u&&(c.encodings=d,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:c.encodings})),yield t.setParameters(c))}finally{l()}})}function uy(t){switch(t){case"f":return Ht.HIGH;case"h":return Ht.MEDIUM;case"q":return Ht.LOW;default:return Ht.HIGH}}function nf(t,e,n,i){if(!n)return[new yi({quality:Ht.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new dy(r),a=[],l=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let d=0;d<o.spatial;d+=1)a.push(new yi({quality:Math.min(Ht.HIGH,o.spatial-1)-d,width:Math.ceil(t/Math.pow(l,d)),height:Math.ceil(e/Math.pow(l,d)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,d)):0,ssrc:0}));return a}return n.map(r=>{var o,a,l;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let d=uy((a=r.rid)!==null&&a!==void 0?a:"");return new yi({quality:d,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(l=r.maxBitrate)!==null&&l!==void 0?l:0,ssrc:0})})}const sf="_lossy",rf="_reliable",ZR=2*1e3,hl="leave-reconnect",QR=3e4,eI=8*1024,tI=256*1024;var nn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(nn||(nn={}));class nI extends Fn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=$d.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=nn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=xe,this.reliableDataSequence=1,this.reliableMessageBuffer=new $p,this.reliableReceivedState=new kR(QR),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>I(this,[i],void 0,function(r){var o=this;let{channel:a}=r;return(function*(){if(a){if(a.label===rf)o.reliableDCSub=a;else if(a.label===sf)o.lossyDCSub=a;else return;o.log.debug("on data channel ".concat(a.id,", ").concat(a.label),o.logContext),a.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>I(this,void 0,void 0,function*(){var r,o,a,l,c;const d=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const h=Pt.fromBinary(new Uint8Array(u));if(h.sequence>0&&h.participantSid!==""){const p=this.reliableReceivedState.get(h.participantSid);if(p&&h.sequence<=p)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((r=h.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(X.ActiveSpeakersUpdate,h.value.value.speakers);else if(((o=h.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const p=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),m=Yx.fromBinary(p.payload),y=new Pt({value:m.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((l=y.value)===null||l===void 0?void 0:l.case)==="user"&&of(y,y.value.value),this.emit(X.DataPacketReceived,y,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&of(h,h.value.value),this.emit(X.DataPacketReceived,h,ut.NONE)}finally{d()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Se.LOSSY:Se.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(X.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let l=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(l===null){o(a);return}i===hl&&(l=0),this.log.debug("reconnecting in ".concat(l,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=wt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),l)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===nn.Connected&&i();const o=()=>{this.off(X.Disconnected,a),i()},a=()=>{this.off(X.Restarted,o),r()};this.once(X.Restarted,o),this.once(X.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Se.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(X.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>I(this,void 0,void 0,function*(){!this.url||!(yield fetch(Ar(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Be.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Be.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Mi.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>I(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Ar(this.url),{method:"HEAD"}),Ct(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ti((n=e.loggerName)!==null&&n!==void 0?n:wn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new zd(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Ot,this.dataProcessLock=new Ot,this.dcBufferStatus=new Map([[Se.LOSSY,!0],[Se.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(X.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(X.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(X.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(X.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(X.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(X.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(X.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(X.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,a;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(e,n,i,r){return I(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate().catch(a=>{xe.error(a,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(X.SignalConnected,o),o}catch(o){if(o instanceof pe&&o.reason===We.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return I(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(X.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return I(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new $p,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return I(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Hn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(pe.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return I(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return I(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==tt.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new NR(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(X.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>I(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===tt.CONNECTED){const u=this.pcState===nn.New;this.pcState=nn.Connected,u&&this.emit(X.Connected,e)}else o===tt.FAILED&&(this.pcState===nn.Connected||this.pcState===nn.Reconnecting)&&(this.pcState=nn.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?Mi.RR_SUBSCRIBER_FAILED:Mi.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===Be.RECONNECTING,d=[tt.FAILED,tt.CLOSING,tt.CLOSED].includes(o);c&&d&&!this._isClosed&&this.emit(X.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(X.MediaTrackAdded,o.track,o.streams[0],o.receiver)},iI((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>I(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>I(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(X.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(X.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(X.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(X.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(X.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Mi.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:ay,regionSettings:e.regions})),e.action){case vs.DISCONNECT:this.emit(X.Disconnected,e?.reason),this.close();break;case vs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(hl);break;case vs.RESUME:this.handleDisconnect(hl)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),r.push(a)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Er.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(sf,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(rf,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Se.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,eI),tI)}},1e3))}createSender(e,n,i){return I(this,void 0,void 0,function*(){if(hc())return yield this.createTransceiverRTCRtpSender(e,n,i);if(pc())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(hc())return this.createSimulcastTransceiverSender(e,n,i,r);if(pc())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new dt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Ii(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return I(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){xe.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Er.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:tt.NEW)===tt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof dt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof is||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",Mi.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(X.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return I(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(X.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new is;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof pe&&a.reason===We.NotAllowed?new dt("could not reconnect, token might be expired"):new is}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(X.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==Be.CONNECTED)throw new is("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(X.Restarted)}catch(o){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return I(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new dt("could not reconnect, url or token not saved");if(!this.pcManager)throw new dt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(X.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof pe&&r.reason===We.NotAllowed?new dt("could not reconnect, token might be expired"):r instanceof pe&&r.reason===We.LeaveRequest?r:new is(o)}if(this.emit(X.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Be.CONNECTED)throw new is("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(X.Resumed)})}waitForPCInitialConnection(e,n){return I(this,void 0,void 0,function*(){if(!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return I(this,void 0,void 0,function*(){this.pcState=nn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ct(ZR),!this.pcManager)throw new dt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=nn.Connected}catch(e){throw this.pcState=nn.Disconnected,pe.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return I(this,void 0,void 0,function*(){const o=new Pt({destinationIdentities:[e],kind:Se.RELIABLE,value:{case:"rpcResponse",value:new Id({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Se.RELIABLE)})}publishRpcAck(e,n){return I(this,void 0,void 0,function*(){const i=new Pt({destinationIdentities:[e],kind:Se.RELIABLE,value:{case:"rpcAck",value:new Rd({requestId:n})}});yield this.sendDataPacket(i,Se.RELIABLE)})}sendDataPacket(e,n){return I(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=uR(e);if(o){const a=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new Kx({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===Se.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===Se.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return I(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Se.RELIABLE);const n=this.dataChannelForKind(Se.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(Se.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>I(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(X.Closing,r);!this.dcBufferStatus.get(e);)yield Ct(10);this.off(X.Closing,r),n()}}))}ensureDataTransportConnected(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new dt("PC manager is closed");const a=r?i.pcManager.subscriber:i.pcManager.publisher,l=r?"Subscriber":"Publisher";if(!a)throw pe.internal("".concat(l," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(h=>{xe.error(h,i.logContext)});const d=i.dataChannelForKind(n,r);if(d?.readyState==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(a.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Ct(50)}throw pe.internal("could not establish ".concat(l," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(e){return I(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==tt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return I(this,void 0,void 0,function*(){return new Promise((e,n)=>I(this,void 0,void 0,function*(){if(!this.pcManager){n(new ac("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(X.Closing,r),this.pcManager.publisher.once(js.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(l=>{const c=l.codec.toLowerCase();YE(c)&&a.set(l.payload,c)}),this.emit(X.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof ac&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Mi.RR_UNKNOWN),n(o)}finally{this.off(X.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===Se.LOSSY)return this.lossyDCSub;if(e===Se.RELIABLE)return this.reliableDCSub}else{if(e===Se.LOSSY)return this.lossyDC;if(e===Se.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,o,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const l=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),d=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),h=(a=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&a!==void 0?a:!0,p=new Array,m=new Array;e.forEach(y=>{y.isDesired!==h&&p.push(y.trackSid),y.isEnabled||m.push(y.trackSid)}),this.client.sendSyncState(new Md({answer:this.options.singlePeerConnection?c?hs({sdp:c.sdp,type:c.type}):void 0:u?hs({sdp:u.sdp,type:u.type}):void 0,offer:this.options.singlePeerConnection?l?hs({sdp:l.sdp,type:l.type}):void 0:d?hs({sdp:d.sdp,type:d.type}):void 0,subscription:new ma({trackSids:p,subscribe:!h,participantTracks:[]}),publishTracks:AE(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:m,datachannelReceiveStates:this.reliableReceivedState.map((y,f)=>new f0({publisherSid:f,lastSeq:y}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{i?.id!==void 0&&i.id!==null&&e.push(new g0({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(Se.LOSSY),bn.PUBLISHER),n(this.dataChannelForKind(Se.RELIABLE),bn.PUBLISHER),n(this.dataChannelForKind(Se.LOSSY,!0),bn.SUBSCRIBER),n(this.dataChannelForKind(Se.RELIABLE,!0),bn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&wt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ut()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Ut()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(o=>{let[a]=o;return a===i});if(r)return r[1]}}}function iI(t){return t!==void 0&&t>13}function of(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class hy{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new sn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),At.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new sn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),At.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class sI extends hy{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new on,i=null,r=null;if(this.signal){const a=this.signal;r=()=>{var l;(l=n.reject)===null||l===void 0||l.call(n,a.reason)},a.addEventListener("abort",r),i=a}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:d}=yield Promise.race([e.read(),n.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(d),{done:!1,value:d.content})}catch(c){throw o(),c}}),return(){return I(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=qn(c),h;h=yield u.next(),i=h.done,!i;d=!0){a=h.value,d=!1;const p=a;l.add(p)}}catch(p){r={error:p}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return Array.from(l)})()})}}class rI extends hy{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Ro(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new on,r=null,o=null;if(this.signal){const l=this.signal;o=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,l.reason)},l.addEventListener("abort",o),r=l}const a=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>I(this,void 0,void 0,function*(){var l,c;try{const{done:d,value:u}=yield Promise.race([e.read(),i.promise,(c=(l=this.outOfBandFailureRejectingFuture)===null||l===void 0?void 0:l.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(d)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let h;try{h=n.decode(u.content)}catch(p){throw new sn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(p),At.DecodeFailed)}return{done:!1,value:h}}}catch(d){throw a(),d}}),return(){return I(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return I(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let l="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var d=!0,u=qn(c),h;h=yield u.next(),i=h.done,!i;d=!0)a=h.value,d=!1,l+=a}catch(p){r={error:p}}finally{try{!d&&!i&&(o=u.return)&&(yield o.call(u))}finally{if(r)throw r.error}}return l})()})}}class oI{constructor(){this.log=xe,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new sn('A text stream handler for topic "'.concat(e,'" has already been set.'),At.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new sn('A byte stream handler for topic "'.concat(e,'" has already been set.'),At.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,o;const a=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),l=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(a.length>0||l.length>0){const c=new sn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),At.AbnormalEnd);for(const[d,u]of l)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(d);for(const[d,u]of a)(o=(r=u.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,c),this.textStreamControllers.delete(d)}}handleDataStreamPacket(e,n){return I(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return I(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const l=new on;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ro(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new sn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),At.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new sI(c,d,Ro(e.totalLength),l),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const l=new on;l.promise.catch(u=>{this.log.error(u)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},d=new ReadableStream({start:u=>{if(a=u,this.textStreamControllers.has(e.streamId))throw new sn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),At.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:l})}});o(new rI(c,d,Ro(e.totalLength),l),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new sn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),At.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new sn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),At.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new sn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),At.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new sn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),At.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class py{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return I(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class aI extends py{}class lI extends py{}const af=15e3;class cI{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return I(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,l=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(l?l.length+1:1).fill(0),d=(h,p)=>{var m;c[p]=h;const y=c.reduce((f,b)=>f+b,0);(m=n?.onProgress)===null||m===void 0||m.call(n,y)},u=yield this.streamText({streamId:r,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:l,attributes:n?.attributes});return yield u.write(e),d(1,0),yield u.close(),n?.attachments&&l&&(yield Promise.all(n.attachments.map((h,p)=>I(this,void 0,void 0,function*(){return this._sendFile(l[p],h,{topic:n.topic,mimeType:h.type,onProgress:m=>{d(m,p+1)}})})))),u.info})}streamText(e){return I(this,void 0,void 0,function*(){var n,i,r;const o=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?ut.GCM:ut.NONE},l=new qo({streamId:o,mimeType:a.mimeType,topic:a.topic,timestamp:Di(a.timestamp),totalLength:Di(e?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new o0({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?Xl.UPDATE:Xl.CREATE})}}),c=e?.destinationIdentities,d=new Pt({destinationIdentities:c,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,Se.RELIABLE);let u=0;const h=this.engine,p=new WritableStream({write(f){return I(this,void 0,void 0,function*(){for(const b of tR(f,af)){const S=new Ho({content:b,streamId:o,chunkIndex:Di(u)}),C=new Pt({destinationIdentities:c,value:{case:"streamChunk",value:S}});yield h.sendDataPacket(C,Se.RELIABLE),u+=1}})},close(){return I(this,void 0,void 0,function*(){const f=new Ko({streamId:o}),b=new Pt({destinationIdentities:c,value:{case:"streamTrailer",value:f}});yield h.sendDataPacket(b,Se.RELIABLE)})},abort(f){console.log("Sink error:",f)}});let m=()=>I(this,void 0,void 0,function*(){yield y.close()});h.once(X.Closing,m);const y=new aI(p,a,()=>this.engine.off(X.Closing,m));return y})}sendFile(e,n){return I(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return I(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i?.mimeType)!==null&&r!==void 0?r:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:l,value:c}=yield a.read();if(l)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return I(this,void 0,void 0,function*(){var n,i,r,o,a,l;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),d=e?.destinationIdentities,u={id:c,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?ut.GCM:ut.NONE},h=new qo({totalLength:Di((l=u.size)!==null&&l!==void 0?l:0),mimeType:u.mimeType,streamId:c,topic:u.topic,timestamp:Di(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new a0({name:u.name})}}),p=new Pt({destinationIdentities:d,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(p,Se.RELIABLE);let m=0;const y=new Ot,f=this.engine,b=this.log,S=new WritableStream({write(j){return I(this,void 0,void 0,function*(){const w=yield y.lock();let v=0;try{for(;v<j.byteLength;){const E=j.slice(v,v+af),k=new Pt({destinationIdentities:d,value:{case:"streamChunk",value:new Ho({content:E,streamId:c,chunkIndex:Di(m)})}});yield f.sendDataPacket(k,Se.RELIABLE),m+=1,v+=E.byteLength}}finally{w()}})},close(){return I(this,void 0,void 0,function*(){const j=new Ko({streamId:c}),w=new Pt({destinationIdentities:d,value:{case:"streamTrailer",value:j}});yield f.sendDataPacket(w,Se.RELIABLE)})},abort(j){b.error("Sink error:",j)}});return new lI(S,u)})}}class fy extends W{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?J.Muted:J.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(J.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return I(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),qd)),PE()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(J.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class dI extends fy{constructor(e,n,i,r,o,a){super(e,n,W.Kind.Audio,i,a),this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const l=yield this.getReceiverStats();l&&this.prevStats&&this.receiver&&(this._currentBitrate=ba(l,this.prevStats)),this.prevStats=l}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Dn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Dn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return I(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(fc(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&fc(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(J.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(J.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const pl=100;class uI extends fy{constructor(e,n,i,r,o){super(e,n,W.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>I(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=ba(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=Wd(()=>{this.updateDimensions()},pl),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===W.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?ks(this._mediaStreamTrack,n):us(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new hI(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return I(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return I(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,d)=>Math.max(c,d.visibilityChangedAt||0),0),o=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,a=this.elementInfos.some(c=>c.pictureInPicture),l=this.elementInfos.some(c=>c.visible)&&!o||a;if(!(this.lastVisible===l&&!e)){if(!l&&Date.now()-r<pl){wt.setTimeout(()=>{this.updateVisibility()},pl);return}this.lastVisible=l,this.emit(J.VisibilityChanged,l,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const l=a.width()*o,c=a.height()*o;l+c>i+r&&(i=l,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(J.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Mp():n||(Mp()>2?2:1)}}class hI{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:a}=i;o===this.element&&(this.isIntersecting=a,this.isPiP=Js(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Js(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Js(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??vc(e),this.isPiP=Ut()&&Js(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=vc(this.element),this.isPiP=Js(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Op().observe(this.element),Dp().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=Op())===null||e===void 0||e.unobserve(this.element),(n=Dp())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Js(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?vc(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function vc(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,a=t.offsetHeight,{hidden:l}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!l&&c!=="none"}class Wn extends Fn.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=ut.NONE,this.log=xe,this.handleMuted=()=>{this.emit(J.Muted)},this.handleUnmuted=()=>{this.emit(J.Unmuted)},this.log=ti((o=r?.loggerName)!==null&&o!==void 0?o:wn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=W.Source.Unknown}setTrack(e){this.track&&(this.track.off(J.Muted,this.handleMuted),this.track.off(J.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(J.Muted,this.handleMuted),e.on(J.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),ke(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ut.NONE}get audioTrack(){if(An(this.track))return this.track}get videoTrack(){if(Ii(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=W.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===W.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(Wn||(Wn={}));class Sc extends Wn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(J.Ended)},this.handleCpuConstrained=()=>{this.track&&Ii(this.track)&&this.emit(J.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(J.Ended,this.handleTrackEnded),this.track.off(J.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(J.Ended,this.handleTrackEnded),e.on(J.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return I(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return I(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(An(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(ft.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(ft.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(ft.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(ft.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(ft.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(ft.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function va(t,e){return I(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=Q0(t);let a=o.audio,l=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const h=o.audio.deviceId;o.audio.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:h}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const h=o.video.deviceId;o.video.deviceId={exact:h},n=!0,l=Object.assign(Object.assign({},o.video),{deviceId:{ideal:h}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=J0(o,ry,oy),d=Bd(c),u=navigator.mediaDevices.getUserMedia(d);o.audio&&(gt.userMediaPromiseMap.set("audioinput",u),u.catch(()=>gt.userMediaPromiseMap.delete("audioinput"))),o.video&&(gt.userMediaPromiseMap.set("videoinput",u),u.catch(()=>gt.userMediaPromiseMap.delete("videoinput")));try{const h=yield u;return yield Promise.all(h.getTracks().map(p=>I(this,void 0,void 0,function*(){const m=p.kind==="audio";let y=m?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let f;const b=m?d.audio:d.video;typeof b!="boolean"&&(f=b);const S=p.getSettings().deviceId;f?.deviceId&&bi(f.deviceId)!==S?f.deviceId=S:f||(f={deviceId:S});const C=zR(p,f,e);return C.kind===W.Kind.Video?C.source=W.Source.Camera:C.kind===W.Kind.Audio&&(C.source=W.Source.Microphone),C.mediaStream=h,An(C)&&i?yield C.setProcessor(i):Ii(C)&&r&&(yield C.setProcessor(r)),C})))}catch(h){if(!n)throw h;return va(Object.assign(Object.assign({},t),{audio:a,video:l}),e)}})}function pI(t){return I(this,void 0,void 0,function*(){return(yield va({audio:!1,video:!0}))[0]})}function gy(t){return I(this,void 0,void 0,function*(){return(yield va({audio:t??!0,video:!1}))[0]})}var fi;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(fi||(fi={}));function fI(t){switch(t){case Qs.EXCELLENT:return fi.Excellent;case Qs.GOOD:return fi.Good;case Qs.POOR:return fi.Poor;case Qs.LOST:return fi.Lost;default:return fi.Unknown}}class my extends Fn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Rr.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===bs.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,a){let l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Rr.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=fi.Unknown,this.log=xe,this.log=ti((c=a?.loggerName)!==null&&c!==void 0?c:wn.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=l,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new on,this.once(Z.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(W.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(W.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(W.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===bs.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==bs.ACTIVE&&this.emit(Z.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(Z.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Z.ParticipantNameChanged,e)}_setAttributes(e){const n=ME(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(Z.AttributesChanged,n)}setPermissions(e){var n,i,r,o,a,l;const c=this.permissions,d=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,h)=>{var p;return u!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[h])})||e.canSubscribeMetrics!==((l=this.permissions)===null||l===void 0?void 0:l.canSubscribeMetrics);return this.permissions=e,d&&this.emit(Z.ParticipantPermissionsChanged,c),d}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Z.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=fI(e),n!==this._connectionQuality&&this.emit(Z.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>An(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(J.Muted,()=>{this.emit(Z.TrackMuted,e)}),e.on(J.Unmuted,()=>{this.emit(Z.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case W.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case W.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function gI(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new h0({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class mI extends my{constructor(e,n,i,r,o,a){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ut.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new on)},this.handleReconnected=()=>{var l,c;(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.resolve)===null||c===void 0||c.call(l),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var l,c,d,u,h,p;this.reconnectFuture&&(this.reconnectFuture.promise.catch(m=>this.log.warn(m.message,this.logContext)),(c=(l=this.reconnectFuture)===null||l===void 0?void 0:l.reject)===null||c===void 0||c.call(l,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(d=this.signalConnectedFuture).reject)===null||u===void 0||u.call(d,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(p=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||p===void 0||p.call(h,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=l=>{var c,d;l.participant&&this.updateInfo(l.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new on),(d=(c=this.signalConnectedFuture).resolve)===null||d===void 0||d.call(c)},this.handleSignalRequestResponse=l=>{const{requestId:c,reason:d,message:u}=l,h=this.pendingSignalRequests.get(c);h&&(d!==Dd.OK&&h.reject(new Ip(u,d)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=l=>{switch(l.value.case){case"rpcResponse":let c=l.value.value,d=null,u=null;c.value.case==="payload"?d=c.value.value:c.value.case==="error"&&(u=it.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,d,u);break;case"rpcAck":let h=l.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(l=>gI(l)))},this.onTrackUnmuted=l=>{this.onTrackMuted(l,l.isUpstreamPaused)},this.onTrackMuted=(l,c)=>{if(c===void 0&&(c=!0),!l.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),ke(l)));return}this.engine.updateMuteStatus(l.sid,c)},this.onTrackUpstreamPaused=l=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),ke(l))),this.onTrackMuted(l,!0)},this.onTrackUpstreamResumed=l=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),ke(l))),this.onTrackMuted(l,l.isMuted)},this.onTrackFeatureUpdate=l=>{const c=this.audioTrackPublications.get(l.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(l.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(l,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),ke(c))),this.emit(Z.LocalTrackCpuConstrained,l,c)},this.handleSubscribedQualityUpdate=l=>I(this,void 0,void 0,function*(){var c,d,u,h,p;if(!(!((p=this.roomOptions)===null||p===void 0)&&p.dynacast))return;const m=this.videoTrackPublications.get(l.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}if(!m.videoTrack)return;const y=yield m.videoTrack.setPublishingCodecs(l.subscribedCodecs);try{for(var f=!0,b=qn(y),S;S=yield b.next(),c=S.done,!c;f=!0){h=S.value,f=!1;const C=h;IE(C)&&(this.log.debug("publish ".concat(C," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),ke(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,C,m.options))}}catch(C){d={error:C}}finally{try{!f&&!c&&(u=b.return)&&(yield u.call(b))}finally{if(d)throw d.error}}}),this.handleLocalTrackUnpublished=l=>{const c=this.trackPublications.get(l.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:l.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=l=>I(this,void 0,void 0,function*(){if(l.source===W.Source.ScreenShare||l.source===W.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),ke(l))),this.unpublishTrack(l);else if(l.isUserProvided)yield l.mute();else if(Un(l)||ci(l))try{if(Ut())try{const c=yield navigator?.permissions.query({name:l.source===W.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(l.source),Object.assign(Object.assign({},this.logContext),ke(l))),c.onchange=()=>{c.state!=="denied"&&(l.isMuted||l.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}l.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),ke(l))),Un(l)?yield l.restartTrack({deviceId:"default"}):yield l.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),ke(l))),yield l.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ut.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(X.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(X.Connected,this.handleReconnected).on(X.SignalConnected,this.handleSignalConnected).on(X.SignalRestarted,this.handleReconnected).on(X.SignalResumed,this.handleReconnected).on(X.Restarting,this.handleReconnecting).on(X.Resuming,this.handleReconnecting).on(X.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(X.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(X.Closing,this.handleClosing).on(X.SignalRequestResponse,this.handleSignalRequestResponse).on(X.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return I(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return I(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:a}=n;return(function*(){return new Promise((l,c)=>I(i,void 0,void 0,function*(){var d,u;try{let h=!1;const p=yield this.engine.client.sendUpdateLocalMetadata((d=r??this.metadata)!==null&&d!==void 0?d:"",(u=o??this.name)!==null&&u!==void 0?u:"",a),m=performance.now();for(this.pendingSignalRequests.set(p,{resolve:l,reject:y=>{c(y),h=!0},values:{name:o,metadata:r,attributes:a}});performance.now()-m<5e3&&!h;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!a||Object.entries(a).every(y=>{let[f,b]=y;return this.attributes[f]===b||b===""&&!this.attributes[f]}))){this.pendingSignalRequests.delete(p),l();return}yield Ct(50)}c(new Ip("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(W.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(W.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(W.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){this.encryptionType=e?ut.GCM:ut.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return I(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let l=this.getTrackPublication(e);if(n)if(l)yield l.unmute();else{let c;if(this.pendingPublishing.has(e)){const d=yield this.waitForPendingPublicationOfSource(e);return d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield d?.unmute(),d}this.pendingPublishing.add(e);try{switch(e){case W.Source.Camera:c=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case W.Source.Microphone:c=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case W.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Hn(e)}}catch(d){throw c?.forEach(u=>{u.stop()}),d instanceof Error&&this.emit(Z.MediaDevicesError,d,uc(e)),this.pendingPublishing.delete(e),d}for(const d of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===W.Source.Microphone&&An(d)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),d.startPreConnectBuffer())}try{const d=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),ke(h))),d.push(this.publishTrack(h,r));[l]=yield Promise.all(d)}catch(d){throw c?.forEach(u=>{u.stop()}),d}finally{this.pendingPublishing.delete(e)}}else if(!l?.track&&this.pendingPublishing.has(e)&&(l=yield this.waitForPendingPublicationOfSource(e),l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),l&&l.track)if(e===W.Source.ScreenShare){l=yield this.unpublishTrack(l.track);const c=this.getTrackPublication(W.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield l.mute();return l})}enableCameraAndMicrophone(){return I(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(W.Source.Camera)||this.pendingPublishing.has(W.Source.Microphone))){this.pendingPublishing.add(W.Source.Camera),this.pendingPublishing.add(W.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(W.Source.Camera),this.pendingPublishing.delete(W.Source.Microphone)}}})}createTracks(e){return I(this,void 0,void 0,function*(){var n,i;e??(e={});const r=J0(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield va(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(l=>(An(l)&&(this.microphoneError=void 0,l.setAudioContext(this.audioContext),l.source=W.Source.Microphone,this.emit(Z.AudioStreamAcquired)),Ii(l)&&(this.cameraError=void 0,l.source=W.Source.Camera),l))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return I(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Ld("getDisplayMedia not supported");e.resolution===void 0&&!VE()&&(e.resolution=Fd.h1080fps30.resolution);const n=NE(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Hn("no video track found");const o=new Xo(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=W.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(Z.AudioStreamAcquired);const l=new Jo(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=W.Source.ScreenShareAudio,a.push(l)}return a})}publishTrack(e,n){return I(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var l,c,d,u;Un(i)&&i.setAudioContext(o.audioContext),yield(l=o.reconnectFuture)===null||l===void 0?void 0:l.promise,o.republishPromise&&!a&&(yield o.republishPromise),ws(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let h;if(i instanceof MediaStreamTrack)h=i.getConstraints();else{h=i.constraints;let S;switch(i.source){case W.Source.Microphone:S="audioinput";break;case W.Source.Camera:S="videoinput"}S&&o.activeDeviceMap.has(S)&&(h=Object.assign(Object.assign({},h),{deviceId:o.activeDeviceMap.get(S)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Jo(i,h,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Xo(i,h,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Hn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let p;if(o.trackPublications.forEach(S=>{S.track&&S.track===i&&(p=S)}),p)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),ke(p))),p;const m=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),y="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,f=(c=m.forceStereo)!==null&&c!==void 0?c:y;f&&(m.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),ke(i))),m.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(d=m.dtx)!==null&&d!==void 0||(m.dtx=!1),(u=m.red)!==null&&u!==void 0||(m.red=!1)),!GE()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const b=new Promise((S,C)=>I(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Be.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:ke(i)}));let j=!1;const w=setTimeout(()=>{j=!0,i.stop(),C(new Rp("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(w),j)return;const v=yield this.publish(i,m,f);S(v)}else try{const j=yield this.publish(i,m,f);S(j)}catch(j){C(j)}}catch(j){C(j)}}));o.pendingPublishPromises.set(i,b);try{return yield b}catch(S){throw S}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new on),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),ke(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>DE(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),ke(e))),!1)}publish(e,n,i){return I(this,void 0,void 0,function*(){var r,o,a,l,c,d,u,h,p,m;if(!this.hasPermissionsToPublish(e))throw new Rp("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(N=>ws(e)&&N.source===e.source)&&e.source!==W.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),ke(e))),n.stopMicTrackOnMute&&An(e)&&(e.stopOnMute=!0),e.source===W.Source.ScreenShare&&$i()&&(n.simulcast=!1),n.videoCodec==="av1"&&!zE()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!UE()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=xc),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(N=>n.videoCodec===hr(N.mime))||(n.videoCodec=hr(this.enabledPublishVideoCodecs[0].mime)));const f=n.videoCodec;e.on(J.Muted,this.onTrackMuted),e.on(J.Unmuted,this.onTrackUnmuted),e.on(J.Ended,this.handleTrackEnded),e.on(J.UpstreamPaused,this.onTrackUpstreamPaused),e.on(J.UpstreamResumed,this.onTrackUpstreamResumed),e.on(J.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const b=[],S=!(!((r=n.dtx)!==null&&r!==void 0)||r),C=e.getSourceTrackSettings();C.autoGainControl&&b.push(ft.TF_AUTO_GAIN_CONTROL),C.echoCancellation&&b.push(ft.TF_ECHO_CANCELLATION),C.noiseSuppression&&b.push(ft.TF_NOISE_SUPPRESSION),C.channelCount&&C.channelCount>1&&b.push(ft.TF_STEREO),S&&b.push(ft.TF_NO_DTX),Un(e)&&e.hasPreConnectBuffer&&b.push(ft.TF_PRECONNECT_BUFFER);const j=new Ir({cid:e.mediaStreamTrack.id,name:n.name,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),disableDtx:S,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:b});let w;if(e.kind===W.Kind.Video){let N={width:0,height:0};try{N=yield e.waitForDimensions()}catch{const _=(l=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&l!==void 0?l:_r.h720.resolution;N={width:_.width,height:_.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),ke(e)),{dims:N}))}j.width=N.width,j.height=N.height,ci(e)&&(vn(f)&&(e.source===W.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),ke(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),j.simulcastCodecs=[new Ql({codec:f,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:xc}),n.backupCodec&&f!==n.backupCodec.codec&&j.encryption===ut.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),j.simulcastCodecs.push(new Ql({codec:n.backupCodec.codec,cid:""})))),w=bc(e.source===W.Source.ScreenShare,j.width,j.height,n),j.layers=nf(j.width,j.height,w,vn(n.videoCodec))}else e.kind===W.Kind.Audio&&(w=[{maxBitrate:(d=n.audioPreset)===null||d===void 0?void 0:d.maxBitrate,priority:(h=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&h!==void 0?h:"high",networkPriority:(m=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const v=()=>I(this,void 0,void 0,function*(){var N,R,_;if(!this.engine.pcManager)throw new dt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,w),this.emit(Z.LocalSenderCreated,e.sender,e),ci(e)&&((N=n.degradationPreference)!==null&&N!==void 0||(n.degradationPreference=JR(e)),e.setDegradationPreference(n.degradationPreference)),w)if($i()&&e.kind===W.Kind.Audio){let A;for(const Y of this.engine.pcManager.publisher.getTransceivers())if(Y.sender===e.sender){A=Y;break}A&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:A,codec:"opus",maxbr:!((R=w[0])===null||R===void 0)&&R.maxBitrate?w[0].maxBitrate/1e3:0})}else e.codec&&vn(e.codec)&&(!((_=w[0])===null||_===void 0)&&_.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:j.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});yield this.engine.negotiate()});let E;const k=new Promise((N,R)=>I(this,void 0,void 0,function*(){var _;try{E=yield this.engine.addTrack(j),N(E)}catch(A){e.sender&&(!((_=this.engine.pcManager)===null||_===void 0)&&_.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Y=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),ke(e)),{error:Y}))})),R(A)}}));if(this.enabledPublishVideoCodecs.length>0)E=(yield Promise.all([k,v()]))[0];else{E=yield k;let N;if(E.codecs.forEach(R=>{N===void 0&&(N=R.mimeType)}),N&&e.kind===W.Kind.Video){const R=hr(N);R!==f&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),ke(e)),{codec:R})),n.videoCodec=R,w=bc(e.source===W.Source.ScreenShare,j.width,j.height,n))}yield v()}const T=new Sc(e.kind,E,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(T.on(J.CpuConstrained,N=>this.onTrackCpuConstrained(N,T)),T.options=n,e.sid=E.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:E})),ci(e)?e.startMonitor(this.engine.client):Un(e)&&e.startMonitor(),this.addTrackPublication(T),this.emit(Z.LocalTrackPublished,T),Un(e)&&E.audioFeatures.includes(ft.TF_PRECONNECT_BUFFER)){const N=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(Z.LocalTrackSubscribed,_=>{if(_.trackSid===E.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),ke(e))),e.stopPreConnectBuffer()}}),N&&new Promise((A,Y)=>I(this,void 0,void 0,function*(){var H,$,K,O,P,F;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),ke(e)));const ie=setTimeout(()=>{Y(new Error("agent not active within 10 seconds"))},1e4),le=yield this.waitUntilActiveAgentPresent();clearTimeout(ie),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),ke(e)));const re=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[le.identity],attributes:{trackId:T.trackSid,sampleRate:String((P=C.sampleRate)!==null&&P!==void 0?P:"48000"),channels:String((F=C.channelCount)!==null&&F!==void 0?F:"1")}});try{for(var D=!0,B=qn(N),G;G=yield B.next(),H=G.done,!H;D=!0){O=G.value,D=!1;const U=O;yield re.write(U)}}catch(U){$={error:U}}finally{try{!D&&!H&&(K=B.return)&&(yield K.call(B))}finally{if($)throw $.error}}yield re.close(),A()}catch(ie){Y(ie)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),ke(e)))}).catch(A=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),ke(e)),{error:A}))})}return T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return I(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ut.NONE)return;let o;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(o=m)}),!o)throw new Hn("track is not published");if(!ci(e))throw new Hn("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),l=HR(e,n,a);if(!l){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),ke(e)));return}const c=e.addSimulcastTrack(n,l);if(!c)return;const d=new Ir({cid:c.mediaStreamTrack.id,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:c.mediaStreamTrack.id}]});if(d.layers=nf(d.width,d.height,l),!this.engine||this.engine.isClosed)throw new dt("cannot publish track when not connected");const u=()=>I(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,a,l),yield this.engine.negotiate()}),p=(yield Promise.all([this.engine.addTrack(d),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:l,trackInfo:p}))})}unpublishTrack(e,n){return I(this,void 0,void 0,function*(){var i,r;if(ws(e)){const d=this.pendingPublishPromises.get(e);d&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),ke(e))),yield d)}const o=this.getPublicationForTrack(e),a=o?ke(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(J.Muted,this.onTrackMuted),e.off(J.Unmuted,this.onTrackUnmuted),e.off(J.Ended,this.handleTrackEnded),e.off(J.UpstreamPaused,this.onTrackUpstreamPaused),e.off(J.UpstreamResumed,this.onTrackUpstreamResumed),e.off(J.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let l=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<tt.FAILED&&c)try{for(const d of this.engine.pcManager.publisher.getTransceivers())d.sender===c&&(d.direction="inactive",l=!0);if(this.engine.removeTrack(c)&&(l=!0),ci(e)){for(const[,d]of e.simulcastCodecs)d.sender&&(this.engine.removeTrack(d.sender)&&(l=!0),d.sender=void 0);e.simulcastCodecs.clear()}}catch(d){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:d}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case W.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case W.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(Z.LocalTrackUnpublished,o),o.setTrack(void 0),l&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return I(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,a)=>I(i,void 0,void 0,function*(){try{const l=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),l.push(c))}),yield Promise.all(l.map(c=>I(this,void 0,void 0,function*(){const d=c.track;yield this.unpublishTrack(d,!1),r&&!d.isMuted&&d.source!==W.Source.ScreenShare&&d.source!==W.Source.ScreenShareAudio&&(Un(d)||ci(d))&&!d.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield d.restartTrack()),yield this.publishOrRepublishTrack(d,c.options,!0)}))),o()}catch(l){a(l)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return I(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?Se.RELIABLE:Se.LOSSY,a=r.destinationIdentities,l=r.topic;let c=new Td({participantIdentity:i.identity,payload:n,destinationIdentities:a,topic:l});const d=new Pt({kind:o,value:{case:"user",value:c}});yield i.engine.sendDataPacket(d,o)})()})}publishDtmf(e,n){return I(this,void 0,void 0,function*(){const i=new Pt({kind:Se.RELIABLE,value:{case:"sipDtmf",value:new Xx({code:e,digit:n})}});yield this.engine.sendDataPacket(i,Se.RELIABLE)})}sendChatMessage(e,n){return I(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},r=new Pt({value:{case:"chatMessage",value:new Go(Object.assign(Object.assign({},i),{timestamp:Ge.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Se.RELIABLE),this.emit(Z.ChatMessage,i),i})}editChatMessage(e,n){return I(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Pt({value:{case:"chatMessage",value:new Go(Object.assign(Object.assign({},i),{timestamp:Ge.parse(i.timestamp),editTimestamp:Ge.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Se.RELIABLE),this.emit(Z.ChatMessage,i),i})}sendText(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return I(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return I(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:a,responseTimeout:l=15e3}=n;return(function*(){return new Promise((u,h)=>I(i,void 0,void 0,function*(){var p,m,y,f;if(Gd(a)>ly){h(it.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((m=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||m===void 0)&&m.version&&On((f=(y=this.engine.latestJoinResponse)===null||y===void 0?void 0:y.serverInfo)===null||f===void 0?void 0:f.version,"1.8.0")<0){h(it.builtIn("UNSUPPORTED_SERVER"));return}const b=Math.max(l,8e3),S=crypto.randomUUID();yield this.publishRpcRequest(r,S,o,a,b);const C=setTimeout(()=>{this.pendingAcks.delete(S),h(it.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(S),clearTimeout(j)},7e3);this.pendingAcks.set(S,{resolve:()=>{clearTimeout(C)},participantIdentity:r});const j=setTimeout(()=>{this.pendingResponses.delete(S),h(it.builtIn("RESPONSE_TIMEOUT"))},l);this.pendingResponses.set(S,{resolve:(w,v)=>{clearTimeout(j),this.pendingAcks.has(S)&&(this.log.warn("RPC response received before ack",S),this.pendingAcks.delete(S),clearTimeout(C)),v?h(v):u(w??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return I(this,void 0,void 0,function*(){const a=new Pt({destinationIdentities:[e],kind:Se.RELIABLE,value:{case:"rpcRequest",value:new Ed({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(a,Se.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,it.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const a=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),ke(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new on),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Un(r)||ci(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return I(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[a]=o;return a.source===e});if(r)return r[1];yield Ct(20)}})}}class xI extends Wn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(J.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new ma({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Qx({participantSid:"",trackSids:[this.trackSid]})]});this.emit(J.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Wn.SubscriptionStatus.Unsubscribed:super.isSubscribed?Wn.SubscriptionStatus.Subscribed:Wn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Wn.PermissionStatus.Allowed:Wn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(ol(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&ol(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Ht.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(J.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(J.VisibilityChanged,this.handleVisibilityChange),r.off(J.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(J.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(J.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(J.VisibilityChanged,this.handleVisibilityChange),e.on(J.Ended,this.handleEnded),this.emit(J.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(J.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?J.Muted:J.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(J.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(J.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return ol(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new l0({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===W.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Np(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=OE(this.trackInfo,this.requestedMaxQuality);i&&Np(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Ht.HIGH})),e.quality=Ht.HIGH)}this.emit(J.UpdateSettings,e)}}class Zo extends my{static fromParticipantInfo(e,n,i){return new Zo(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,a,l){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Rr.STANDARD;super(n,i||"",r,o,a,l,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(J.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),ke(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(J.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(J.SubscriptionPermissionChanged,n=>{this.emit(Z.TrackSubscriptionPermissionChanged,e,n)}),e.on(J.SubscriptionStatusChanged,n=>{this.emit(Z.TrackSubscriptionStatusChanged,e,n)}),e.on(J.Subscribed,n=>{this.emit(Z.TrackSubscribed,n,e)}),e.on(J.Unsubscribed,n=>{this.emit(Z.TrackUnsubscribed,n,e)}),e.on(J.SubscriptionFailed,n=>{this.emit(Z.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,a){let l=this.getTrackPublicationBySid(n);if(l||n.startsWith("TR")||this.trackPublications.forEach(u=>{!l&&e.kind===u.kind.toString()&&(l=u)}),!l){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Z.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),ke(l))),this.emit(Z.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let d;return c?d=new uI(e,n,r,o):d=new dI(e,n,r,this.audioContext,this.audioOutput),d.source=l.source,d.isMuted=l.isMuted,d.setMediaStream(i),d.start(),l.setTrack(d),this.volumeMap.has(l.source)&&gc(d)&&An(d)&&d.setVolume(this.volumeMap.get(l.source)),l}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,a;let l=this.getTrackPublicationBySid(r.sid);if(l)l.updateInfo(r);else{const c=W.kindFromProto(r.type);if(!c)return;l=new xI(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),l.updateInfo(r),i.set(r.sid,l);const d=Array.from(this.trackPublications.values()).find(u=>u.source===l?.source);d&&l.source!==W.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(l.source),Object.assign(Object.assign({},this.logContext),{oldTrack:ke(d),newTrack:ke(l)})),this.addTrackPublication(l)}n.set(r.sid,l)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),ke(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(Z.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case W.Kind.Audio:this.audioTrackPublications.delete(e);break;case W.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(Z.TrackUnpublished,i)}setAudioOutput(e){return I(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;An(i.track)&&gc(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ie;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Ie||(Ie={}));const yI=4*1e3;class Ds extends Fn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,o;if(super(),n=this,this.state=Ie.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=xe,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>I(this,void 0,void 0,function*(){var d;if(!WE())throw Dn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Ie.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Ie.Connecting),((d=this.regionUrlProvider)===null||d===void 0?void 0:d.getServerUrl().toString())!==iy(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ms(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Re(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(m=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const h=(m,y,f)=>I(this,void 0,void 0,function*(){var b,S;this.abortController&&this.abortController.abort();const C=new AbortController;this.abortController=C,u?.();try{if(yield Cs.getInstance().getBackOffPromise(a),C.signal.aborted)throw pe.cancelled("Connection attempt aborted");yield this.attemptConnection(f??a,l,c,C),this.abortController=void 0,m()}catch(j){if(this.regionUrlProvider&&j instanceof pe&&j.reason!==We.Cancelled&&j.reason!==We.NotAllowed){let w=null;try{this.log.debug("Fetching next region"),w=yield this.regionUrlProvider.getNextBestRegionUrl((b=this.abortController)===null||b===void 0?void 0:b.signal)}catch(v){if(v instanceof pe&&(v.status===401||v.reason===We.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(v);return}}[We.InternalError,We.ServerUnreachable,We.Timeout].includes(j.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Cs.getInstance().addFailedConnectionAttempt(a)),w&&!(!((S=this.abortController)===null||S===void 0)&&S.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(j.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield h(m,y,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Fp(j)),y(j))}else{let w=Sn.UNKNOWN_REASON;j instanceof pe&&(w=Fp(j)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),y(j)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new on((m,y)=>{h(m,y,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,d,u,h)=>I(this,void 0,void 0,function*(){var p,m,y;const f=yield c.join(a,l,{autoSubscribe:d.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout,singlePeerConnection:u.singlePeerConnection},h.signal);let b=f.serverInfo;if(b||(b={version:f.serverVersion,region:f.serverRegion}),this.serverInfo=b,this.log.debug("connected to Livekit Server ".concat(Object.entries(b).map(S=>{let[C,j]=S;return"".concat(C,": ").concat(j)}).join(", ")),{room:(p=f.room)===null||p===void 0?void 0:p.name,roomSid:(m=f.room)===null||m===void 0?void 0:m.sid,identity:(y=f.participant)===null||y===void 0?void 0:y.identity}),!b.version)throw new CE("unknown server version");return b.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),f}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,d)=>I(this,void 0,void 0,function*(){var u,h;this.state===Ie.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},$d),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,d);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(q.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const m=d.signal.aborted?pe.cancelled("Signal connection aborted"):pe.serverUnreachable("could not establish signal connection");throw p instanceof Error&&(m.message="".concat(m.message,": ").concat(p.message)),p instanceof pe&&(m.reason=p.reason,m.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),m}if(d.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),pe.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}Ut()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ut()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ie.Connected),this.emit(q.Connected),Cs.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return I(n,[...l],void 0,function(){var d=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var h,p,m;const y=yield d.disconnectLock.lock();try{if(d.state===Ie.Disconnected){d.log.debug("already disconnected",d.logContext);return}if(d.log.info("disconnect from room",Object.assign({},d.logContext)),d.state===Ie.Connecting||d.state===Ie.Reconnecting||d.isResuming){const f="Abort connection attempt due to user initiated disconnect";d.log.warn(f,d.logContext),(h=d.abortController)===null||h===void 0||h.abort(f),(m=(p=d.connectFuture)===null||p===void 0?void 0:p.reject)===null||m===void 0||m.call(p,pe.cancelled("Client initiated disconnect")),d.connectFuture=void 0}d.engine&&(d.engine.client.isDisconnected||(yield d.engine.client.sendLeave()),yield d.engine.close()),d.handleDisconnect(u,Sn.CLIENT_INITIATED),d.engine=void 0}finally{y()}})()})},this.onPageLeave=()=>I(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>I(this,void 0,void 0,function*(){const a=[],l=Wt();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let d=document.getElementById(c);if(!d){d=document.createElement("audio"),d.id=c,d.autoplay=!0,d.hidden=!0;const u=rl();u.enabled=!0;const h=new MediaStream([u]);d.srcObject=h,document.addEventListener("visibilitychange",()=>{d&&(d.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(d),this.once(q.Disconnected,()=>{d?.remove(),d=null})}a.push(d)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(d=>{d.track&&d.track.attachedElements.forEach(u=>{a.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>I(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var d;(d=c.track)===null||d===void 0||d.attachedElements.forEach(u=>{a.includes(u)||a.push(u)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(Ie.Reconnecting)&&this.emit(q.Reconnecting)},this.handleSignalRestarted=a=>I(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ie.Connected),this.emit(q.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let d=this.remoteParticipants.get(l.identity);l.state===bs.DISCONNECTED?this.handleParticipantDisconnected(l.identity,d):d=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(d=>{if(c[d.sid]=!0,d.sid===this.localParticipant.sid)this.localParticipant.audioLevel=d.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(d.sid);u&&(u.audioLevel=d.level,u.setIsSpeaking(!0),l.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(d=>{c[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(q.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(d=>{const u=this.remoteParticipants.get(d.identity);u&&u.sid!==d.sid||l.set(d.sid,d)}),a.forEach(d=>{let u=this.getRemoteParticipantBySid(d.sid);d.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=d.level,u.setIsSpeaking(d.active),d.active?l.set(d.sid,u):l.delete(d.sid))});const c=Array.from(l.values());c.sort((d,u)=>u.audioLevel-d.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(q.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const d=c.getTrackPublicationBySid(l.trackSid);if(!d||!d.track)return;const u=W.streamStateFromProto(l.state);d.track.setStreamState(u),u!==d.track.streamState&&(c.emit(Z.TrackStreamStateChanged,d,d.track.streamState),this.emitWhenConnected(q.TrackStreamStateChanged,d,d.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(d=>d.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const d=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,d.id,d.method,d.payload,d.responseTimeoutMs,d.version)}},this.handleUserPacket=(a,l,c,d)=>{this.emit(q.DataReceived,l.payload,a,c,l.topic,d),a?.emit(Z.DataReceived,l.payload,c,d)},this.handleSipDtmf=(a,l)=>{this.emit(q.SipDTMFReceived,l,a),a?.emit(Z.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),d=c?.trackPublications.get(l.trackId),u=XE(l,this.transcriptionReceivedTimes);d?.emit(J.TranscriptionReceived,u),c?.emit(Z.TranscriptionReceived,u,d),this.emit(q.TranscriptionReceived,u,c,d)},this.handleChatMessage=(a,l)=>{const c=ZE(l);this.emit(q.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(q.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(q.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(q.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(q.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(q.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>I(this,void 0,void 0,function*(){var a;((a=Wt())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(q.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(q.RoomMetadataChanged,a.metadata),l?.activeRecording!==a.activeRecording&&this.emitWhenConnected(q.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(q.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(q.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(q.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(q.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(q.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a?.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>I(this,void 0,void 0,function*(){var l,c,d,u,h,p;(l=a.track)===null||l===void 0||l.on(J.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(J.Restarted,this.onLocalTrackRestarted),(h=(u=(d=a.track)===null||d===void 0?void 0:d.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||h===void 0||h.call(u,this),this.emit(q.LocalTrackPublished,a,this.localParticipant),Un(a.track)&&(yield a.track.checkForSilence())&&this.emit(q.LocalAudioSilenceDetected,a);const m=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(!1),y=uc(a.source);y&&m&&m!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,m),this.emit(q.ActiveDeviceChanged,y,m))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(J.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(J.Restarted,this.onLocalTrackRestarted),this.emit(q.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>I(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=uc(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(q.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(q.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(q.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(q.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(q.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},_R),e),this.log=ti((i=this.options.loggerName)!==null&&i!==void 0?i:wn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},ry),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},oy),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},IR),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new oI,this.outgoingDataStreamManager=new cI(this.engine,this.log),this.disconnectLock=new Ot,this.localParticipant=new mI("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",bi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",bi(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",bi(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),Ut()){const a=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),Ds.cleanupRegistry&&Ds.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return I(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new hR(i,n),this.e2eeManager.on(gi.ParticipantEncryptionStatusChanged,(r,o)=>{eR(o)&&(this.isE2EEEnabled=r),this.emit(q.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on(gi.EncryptionError,(r,o)=>{const a=o?this.getParticipantByIdentity(o):void 0;this.emit(q.EncryptionError,r,a)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return I(this,void 0,void 0,function*(){return this.state===Ie.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(X.RoomUpdate,i),e(r.sid))};this.engine.on(X.RoomUpdate,i),this.once(q.Disconnected,()=>{this.engine.off(X.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new nI(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(X.ParticipantUpdate,this.handleParticipantUpdates).on(X.RoomUpdate,this.handleRoomUpdate).on(X.SpeakersChanged,this.handleSpeakersChanged).on(X.StreamStateChanged,this.handleStreamStateUpdate).on(X.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(X.SubscriptionError,this.handleSubscriptionError).on(X.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(X.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(X.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(X.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(X.DataPacketReceived,this.handleDataPacket).on(X.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ie.SignalReconnecting)&&this.emit(q.SignalReconnecting)}).on(X.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ie.Connected)&&this.emit(q.Reconnected)}).on(X.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ie.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(X.Restarting,this.handleRestarting).on(X.SignalRestarted,this.handleSignalRestarted).on(X.Offline,()=>{this.setAndEmitConnectionState(Ie.Reconnecting)&&this.emit(q.Reconnecting)}).on(X.DCBufferStatusChanged,(e,n)=>{this.emit(q.DCBufferStatusChanged,e,n)}).on(X.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Z.LocalTrackSubscribed,n),this.emitWhenConnected(q.LocalTrackSubscribed,n,this.localParticipant)}).on(X.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(q.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return gt.getInstance().getDevices(e,n)}prepareConnection(e,n){return I(this,void 0,void 0,function*(){if(this.state===Ie.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ms(new URL(e))&&n){this.regionUrlProvider=new Re(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ie.Disconnected&&(this.regionUrl=i,yield fetch(Ar(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Ar(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return I(this,void 0,void 0,function*(){let i=()=>I(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new En({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new En({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new En({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new En({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new En({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>I(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new En({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new En({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>I(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new xa({reason:Sn.CLIENT_INITIATED,action:vs.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new En({scenario:{case:"subscriberBandwidth",value:Di(n)}});break;case"leave-full-reconnect":r=new En({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return I(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var l,c,d,u,h,p,m;let y=!0,f=!1;const b=a?{exact:r}:r;if(i==="audioinput"){f=o.localParticipant.audioTrackPublications.size===0;const S=(l=o.getActiveDevice(i))!==null&&l!==void 0?l:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=b;const C=Array.from(o.localParticipant.audioTrackPublications.values()).filter(w=>w.source===W.Source.Microphone);try{y=(yield Promise.all(C.map(w=>{var v;return(v=w.audioTrack)===null||v===void 0?void 0:v.setDeviceId(b)}))).every(w=>w===!0)}catch(w){throw o.options.audioCaptureDefaults.deviceId=S,w}const j=C.some(w=>{var v,E;return(E=(v=w.track)===null||v===void 0?void 0:v.isMuted)!==null&&E!==void 0?E:!1});y&&j&&(f=!0)}else if(i==="videoinput"){f=o.localParticipant.videoTrackPublications.size===0;const S=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=b;const C=Array.from(o.localParticipant.videoTrackPublications.values()).filter(w=>w.source===W.Source.Camera);try{y=(yield Promise.all(C.map(w=>{var v;return(v=w.videoTrack)===null||v===void 0?void 0:v.setDeviceId(b)}))).every(w=>w===!0)}catch(w){throw o.options.videoCaptureDefaults.deviceId=S,w}const j=C.some(w=>{var v,E;return(E=(v=w.track)===null||v===void 0?void 0:v.isMuted)!==null&&E!==void 0?E:!1});y&&j&&(f=!0)}else if(i==="audiooutput"){if(f=!0,!fc()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(d=yield gt.getInstance().normalizeDeviceId("audiooutput",r))!==null&&d!==void 0?d:""),(u=(m=o.options).audioOutput)!==null&&u!==void 0||(m.audioOutput={});const S=(h=o.getActiveDevice(i))!==null&&h!==void 0?h:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((p=o.audioContext)===null||p===void 0||p.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(C=>C.setAudioOutput({deviceId:r})))}catch(C){throw o.options.audioOutput.deviceId=S,C}}return f&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(q.ActiveDeviceChanged,i,r)),y})()})}setupLocalParticipantEvents(){this.localParticipant.on(Z.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Z.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Z.AttributesChanged,this.onLocalAttributesChanged).on(Z.TrackMuted,this.onLocalTrackMuted).on(Z.TrackUnmuted,this.onLocalTrackUnmuted).on(Z.LocalTrackPublished,this.onLocalTrackPublished).on(Z.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Z.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Z.MediaDevicesError,this.onMediaDevicesError).on(Z.AudioStreamAcquired,this.startAudio).on(Z.ChatMessage,this.onLocalChatMessageSent).on(Z.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Ie.Connecting||this.state===Ie.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(m=>m.id)}),this.onTrackAdded(e,n,i),p()},p=()=>{this.off(q.Reconnected,h),this.off(q.Connected,h),this.off(q.Disconnected,p)};this.once(q.Reconnected,h),this.once(q.Connected,h),this.once(q.Disconnected,p);return}if(this.state===Ie.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=BE(n.id),o=r[0];let a=r[1],l=e.id;if(a&&a.startsWith("TR")&&(l=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!l.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(i);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}l=h}l.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(a,", trackId: ").concat(l),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:a,trackId:l}));let d;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?d=this.options.adaptiveStream:d={});const u=c.addSubscribedMediaTrack(e,l,n,i,d);u?.isEncrypted&&!this.e2eeManager&&this.emit(q.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ie.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,l;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(Z.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Z.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Z.AttributesChanged,this.onLocalAttributesChanged).off(Z.TrackMuted,this.onLocalTrackMuted).off(Z.TrackUnmuted,this.onLocalTrackUnmuted).off(Z.LocalTrackPublished,this.onLocalTrackPublished).off(Z.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Z.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Z.MediaDevicesError,this.onMediaDevicesError).off(Z.AudioStreamAcquired,this.startAudio).off(Z.ChatMessage,this.onLocalChatMessageSent).off(Z.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ut()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ie.Disconnected),this.emit(q.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(q.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,o,a){return I(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),a!==1){yield this.engine.publishRpcResponse(e,n,null,it.builtIn("UNSUPPORTED_VERSION"));return}const l=this.rpcHandlers.get(i);if(!l){yield this.engine.publishRpcResponse(e,n,null,it.builtIn("UNSUPPORTED_METHOD"));return}let c=null,d=null;try{const u=yield l({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});Gd(u)>ly?(c=it.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):d=u}catch(u){u instanceof it?c=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=it.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,d,c)})}selectDefaultDevices(){return I(this,void 0,void 0,function*(){var e,n,i;const r=gt.getInstance().previousDevices,o=yield gt.getInstance().getDevices(void 0,!1),a=Wt();if(a?.name==="Chrome"&&a.os!=="iOS")for(let c of o){const d=r.find(u=>u.deviceId===c.deviceId);d&&d.label!==""&&d.kind===c.kind&&d.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(q.ActiveDeviceChanged,c.kind,c.deviceId)}const l=["audiooutput","audioinput","videoinput"];for(let c of l){const d=_E(c),u=this.localParticipant.getTrackPublication(d);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const h=o.filter(m=>m.kind===c),p=this.getActiveDevice(c);if(p===((n=r.filter(m=>m.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((i=h[0])===null||i===void 0?void 0:i.deviceId)!==p){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!Nr()||c==="videoinput"||h.length>0&&!h.find(m=>m.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Nr())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return I(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Z0())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ct(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(q.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Zo.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Zo(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(q.ParticipantConnected,i),i.on(Z.TrackPublished,r=>{this.emitWhenConnected(q.TrackPublished,r,i)}).on(Z.TrackSubscribed,(r,o)=>{r.kind===W.Kind.Audio?(r.on(J.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(J.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===W.Kind.Video&&(r.on(J.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(J.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(q.TrackSubscribed,r,o,i)}).on(Z.TrackUnpublished,r=>{this.emit(q.TrackUnpublished,r,i)}).on(Z.TrackUnsubscribed,(r,o)=>{this.emit(q.TrackUnsubscribed,r,o,i)}).on(Z.TrackMuted,r=>{this.emitWhenConnected(q.TrackMuted,r,i)}).on(Z.TrackUnmuted,r=>{this.emitWhenConnected(q.TrackUnmuted,r,i)}).on(Z.ParticipantMetadataChanged,r=>{this.emitWhenConnected(q.ParticipantMetadataChanged,r,i)}).on(Z.ParticipantNameChanged,r=>{this.emitWhenConnected(q.ParticipantNameChanged,r,i)}).on(Z.AttributesChanged,r=>{this.emitWhenConnected(q.ParticipantAttributesChanged,r,i)}).on(Z.ConnectionQualityChanged,r=>{this.emitWhenConnected(q.ConnectionQualityChanged,r,i)}).on(Z.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(q.ParticipantPermissionsChanged,r,i)}).on(Z.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(q.TrackSubscriptionStatusChanged,r,o,i)}).on(Z.TrackSubscriptionFailed,(r,o)=>{this.emit(q.TrackSubscriptionFailed,r,i,o)}).on(Z.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(q.TrackSubscriptionPermissionChanged,r,o,i)}).on(Z.Active,()=>{this.emitWhenConnected(q.ParticipantActive,i),i.kind===Rr.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&QE(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=wt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Sn.STATE_MISMATCH))):e=0},yI)}clearConnectionReconcile(){this.connectionReconcileInterval&&wt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(q.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Ie.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ie.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return I(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new pa({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Ge.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Vi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(q.SignalConnected),this.emit(q.Connected),this.setAndEmitConnectionState(Ie.Connected),r.video){const a=new Sc(W.Kind.Video,new ds({source:lt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:yn.AUDIO,name:"video-dummy"}),new Xo(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Lp(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(Z.LocalTrackPublished,a)}if(r.audio){const a=new Sc(W.Kind.Audio,new ds({source:lt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:yn.AUDIO}),new Jo(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:rl(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(Z.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let l=new Vi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:bs.ACTIVE,tracks:[],joinedAt:Ge.parse(Date.now())});const c=this.getOrCreateParticipant(l.identity,l);if(o.video){const d=Lp(160*((i=o.aspectRatios[a%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new ds({source:lt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:yn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}if(o.audio){const d=rl(),u=new ds({source:lt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:yn.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d]),new RTCRtpReceiver),l.tracks=[...l.tracks,u]}c.updateInfo(l)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==q.ActiveSpeakersChanged&&e!==q.TranscriptionReceived){const o=xy(i).filter(a=>a!==void 0);(e===q.TrackSubscribed||e===q.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}Ds.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function xy(t){return t.map(e=>{if(e)return Array.isArray(e)?xy(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var xn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(xn||(xn={}));class _i extends Fn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=xn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Ds(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return I(this,void 0,void 0,function*(){if(this.status!==xn.IDLE)throw Error("check is running already");this.setStatus(xn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==xn.SKIPPED&&this.setStatus(this.isSuccess()?xn.SUCCESS:xn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return I(this,void 0,void 0,function*(){return this.room.state===Ie.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return I(this,void 0,void 0,function*(){this.room&&this.room.state!==Ie.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(xn.SKIPPED)}switchProtocol(e){return I(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(q.Reconnecting,()=>{n=!0}),this.room.once(q.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ct(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class bI extends _i{get description(){return"Cloud regions"}perform(){return I(this,void 0,void 0,function*(){const e=new Re(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const l=yield this.checkCloudRegion(a);this.appendMessage("".concat(l.region," RTT: ").concat(l.rtt,"ms, duration: ").concat(l.duration,"ms")),n.push(l)}n.sort((o,a)=>(o.duration-a.duration)*.5+(o.rtt-a.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return I(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,c=1e6/a,d="A".repeat(a),u=Date.now();for(let y=0;y<c;y++)yield o.write(d);yield o.close();const h=Date.now(),p=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),m={region:r,rtt:1e4,duration:h-u};return p?.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(m.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const fl=1e4;class vI extends _i{get description(){return"Connection via UDP vs TCP"}perform(){return I(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(fl/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(fl/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return I(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const l=n.captureStream(30).getVideoTracks()[0],d=(yield this.room.localParticipant.publishTrack(l,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>I(this,void 0,void 0,function*(){const p=yield d.getRTCStatsReport();p?.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(p=>setTimeout(p,fl)),clearInterval(h),l.stop(),n.remove(),yield this.disconnect(),u})}}class SI extends _i{get description(){return"Can publish audio"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield gy();if(yield X0(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(l=>setTimeout(l,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let a=0;if(o.forEach(l=>{l.type==="outbound-rtp"&&(l.kind==="audio"||!l.kind&&l.mediaType==="audio")&&(a=l.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class kI extends _i{get description(){return"Can publish video"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield pI();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(o+=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return I(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,a,l,c;const d=document.createElement("canvas"),u=e.getSettings(),h=(a=(o=u.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&a!==void 0?a:1280,p=(c=(l=u.height)!==null&&l!==void 0?l:i.videoHeight)!==null&&c!==void 0?c:720;d.width=h,d.height=p;const m=d.getContext("2d");m.drawImage(i,0,0);const f=m.getImageData(0,0,d.width,d.height).data;let b=!0;for(let S=0;S<f.length;S+=4)if(f[S]!==0||f[S+1]!==0||f[S+2]!==0){b=!1;break}b?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class wI extends _i{get description(){return"Resuming connection after interruption"}perform(){return I(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const a=new Promise(d=>{setTimeout(d,5e3),o=d}),l=()=>{i=!0};n.on(q.SignalReconnecting,l).on(q.Reconnecting,l).on(q.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield a,i){if(!r||n.state!==Ie.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class CI extends _i{get description(){return"Can connect via TURN"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;Ms(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Re(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new zd,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let a=!1,l=!1,c=!1;for(let d of o.iceServers)for(let u of d.urls)u.startsWith("turn:")?(l=!0,c=!0):u.startsWith("turns:")&&(l=!0,c=!0,a=!0),u.startsWith("stun:")&&(c=!0);c?l&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||l?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(d=>setTimeout(d,0)))})}}class jI extends _i{get description(){return"Establishing WebRTC connection"}perform(){return I(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(q.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,a)=>{if(o.candidate){const l=new RTCIceCandidate(o);let c="".concat(l.protocol," ").concat(l.address,":").concat(l.port," ").concat(l.type);l.address&&(TI(l.address)?c+=" (private)":l.protocol==="tcp"&&l.tcpType==="passive"?(e=!0,c+=" (passive)"):l.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(o,a)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),xe.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function TI(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class EI extends _i{get description(){return"Connecting to signal connection via WebSocket"}perform(){return I(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new zd,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(a){if(Ms(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const c=yield new Re(this.url,this.token).getNextBestRegionUrl();c&&(o=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===t0.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class PA extends Fn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:xn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==xn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return I(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=a=>{this.updateCheck(n,a)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(EI)})}checkWebRTC(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(jI)})}checkTURN(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(CI)})}checkReconnect(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(wI)})}checkPublishAudio(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(SI)})}checkPublishVideo(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(kI)})}checkConnectionProtocol(){return I(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(vI);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return I(this,void 0,void 0,function*(){return this.createAndRunCheck(bI)})}}function we(t,e,n){return(e=II(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function RI(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function II(t){var e=RI(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Lt extends Error{constructor(e,n){var i;super(e,n),we(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}we(Lt,"code","ERR_JOSE_GENERIC");class _I extends Lt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),we(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}we(_I,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class NI extends Lt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),we(this,"code","ERR_JWT_EXPIRED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}we(NI,"code","ERR_JWT_EXPIRED");class AI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}we(AI,"code","ERR_JOSE_ALG_NOT_ALLOWED");class PI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JOSE_NOT_SUPPORTED")}}we(PI,"code","ERR_JOSE_NOT_SUPPORTED");class MI extends Lt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),we(this,"code","ERR_JWE_DECRYPTION_FAILED")}}we(MI,"code","ERR_JWE_DECRYPTION_FAILED");class DI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JWE_INVALID")}}we(DI,"code","ERR_JWE_INVALID");class OI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JWS_INVALID")}}we(OI,"code","ERR_JWS_INVALID");class LI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JWT_INVALID")}}we(LI,"code","ERR_JWT_INVALID");class FI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JWK_INVALID")}}we(FI,"code","ERR_JWK_INVALID");class BI extends Lt{constructor(){super(...arguments),we(this,"code","ERR_JWKS_INVALID")}}we(BI,"code","ERR_JWKS_INVALID");class zI extends Lt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),we(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}we(zI,"code","ERR_JWKS_NO_MATCHING_KEY");class UI extends Lt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),we(this,Symbol.asyncIterator,void 0),we(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}we(UI,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class WI extends Lt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),we(this,"code","ERR_JWKS_TIMEOUT")}}we(WI,"code","ERR_JWKS_TIMEOUT");class VI extends Lt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),we(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}we(VI,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Yn(){return Yn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Yn.apply(null,arguments)}const lf=new Uint8Array(0);class Pr{static getFullOptions(e){return Yn({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(o){i.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i?.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return lf}getOutputByteFrequencyData(){return lf}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let yy=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function Qo(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const by="0.12.0";function kc(t){return!!t.type}const vy="conversation_initiation_client_data";function Sy(t){var e;const n={type:vy};var i,r,o,a,l;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(a=t.overrides.tts)==null?void 0:a.voiceId},conversation:{text_only:(l=t.overrides.conversation)==null?void 0:l.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let wc=class ky extends yy{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o})}),this.socket.addEventListener("message",o=>{try{const a=JSON.parse(o.data);if(!kc(a))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(a)}catch(a){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:a instanceof Error?a.message:String(a),data:o.data})}})}static async create(e){let n=null;try{var i,r,o;const l=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||by,u=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const C=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${C}source=${u}&version=${d}`}else c=`${l}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${d}`;const h=["convai"];e.authorization&&h.push(`bearer.${e.authorization}`),n=new WebSocket(c,h);const p=await new Promise((C,j)=>{n.addEventListener("open",()=>{var w;const v=Sy(e);(w=n)==null||w.send(JSON.stringify(v))},{once:!0}),n.addEventListener("error",w=>{setTimeout(()=>j(w),0)}),n.addEventListener("close",j),n.addEventListener("message",w=>{const v=JSON.parse(w.data);kc(v)&&(v.type==="conversation_initiation_metadata"?C(v.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:m,agent_output_audio_format:y,user_input_audio_format:f}=p,b=Qo(f??"pcm_16000"),S=Qo(y);return new ky(n,m,b,S)}catch(l){var a;throw(a=n)==null||a.close(),l}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function wy(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function $I(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const no=new Map;function Cy(t,e){return async(n,i)=>{const r=no.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void no.set(t,i)}catch(l){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${l}`)}const o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o);try{return await n.addModule(a),void no.set(t,a)}catch{URL.revokeObjectURL(a)}try{const l=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(l),no.set(t,l)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const jy=Cy("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class Vn extends yy{constructor(e,n,i,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,o;const d=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||by,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",h=`${a=(o=e.origin)!=null?o:"https://api.elevenlabs.io",a.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${d}`,p=await fetch(h);if(!p.ok)throw new Error(`ElevenLabs API returned ${p.status} ${p.statusText}`);if(n=(await p.json()).token,!n)throw new Error("No conversation token received from API")}catch(d){let u=d instanceof Error?d.message:String(d);throw d instanceof Error&&d.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var a;const l=new Ds;try{const d=`room_${Date.now()}`,u=Qo("pcm_48000"),h=Qo("pcm_48000"),p=new Vn(l,d,u,h,e),m=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await l.connect(m,n),await new Promise(f=>{if(p.isConnected)f();else{const b=()=>{l.off(q.Connected,b),f()};l.on(q.Connected,b)}}),l.name&&(p.conversationId=((c=l.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||l.name),await l.localParticipant.setMicrophoneEnabled(!0);const y=Sy(e);return p.debug({type:vy,message:y}),await p.sendMessage(y),p}catch(d){throw await l.disconnect(),d}}setupRoomEventListeners(){var e=this;this.room.on(q.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(q.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(q.ConnectionStateChanged,n=>{n===Ie.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(q.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;kc(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(q.TrackSubscribed,async function(n,i,r){if(n.kind===W.Kind.Audio&&r.identity.includes("agent")){const o=n,a=o.attach();if(a.autoplay=!0,a.controls=!1,e.outputDeviceId&&a.setSinkId)try{await a.setSinkId(e.outputDeviceId)}catch(l){console.warn("Failed to set output device for new audio element:",l)}a.style.display="none",document.body.appendChild(a),e.audioElements.push(a),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(q.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(q.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(W.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await jy(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=a=>{const[l,c]=a.data;if(c>.01){const d=wy(l.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:d,event_id:u}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(W.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await gy(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:W.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function Ty(t){const e=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(t);switch(e){case"websocket":return wc.create(t);case"webrtc":return Vn.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function Cc(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Ey(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(Cc()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Kd extends Pr{static async startSession(e){const n=Pr.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Ey(n.connectionDelay),i=await Ty(e),new Kd(n,i)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),o}}}const cf={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class Ts{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:o,libsampleratePath:a}){let l=null,c=null;try{const h=Yn({sampleRate:{ideal:e}},cf);if(Cc()&&i){const S=(await window.navigator.mediaDevices.enumerateDevices()).find(C=>C.kind==="audioinput"&&["airpod","headphone","earphone"].find(j=>C.label.toLowerCase().includes(j)));S&&(h.deviceId={ideal:S.deviceId})}r&&(h.deviceId=Ts.getDeviceIdConstraint(r));const p=navigator.mediaDevices.getSupportedConstraints().sampleRate;l=new window.AudioContext(p?{sampleRate:e}:{});const m=l.createAnalyser();if(!p){const S=a||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await l.audioWorklet.addModule(S)}await jy(l.audioWorklet,o?.rawAudioProcessor);const y=Yn({voiceIsolation:!0},h);c=await navigator.mediaDevices.getUserMedia({audio:y});const f=l.createMediaStreamSource(c),b=new AudioWorkletNode(l,"rawAudioProcessor");return b.port.postMessage({type:"setFormat",format:n,sampleRate:e}),f.connect(m),m.connect(b),await l.resume(),new Ts(l,m,b,c,f)}catch(h){var d,u;throw(d=c)==null||d.getTracks().forEach(p=>{p.stop()}),(u=l)==null||u.close(),h}}static getDeviceIdConstraint(e){if(e)return Cc()?{ideal:e}:{exact:e}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=o}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=Yn({},cf);e&&(n.deviceId=Ts.getDeviceIdConstraint(e));const i=Yn({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(o=>{o.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const GI=Cy("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class ea{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let o=null,a=null;try{o=new AudioContext({sampleRate:e});const d=o.createAnalyser(),u=o.createGain();a=new Audio,a.src="",a.load(),a.autoplay=!0,a.style.display="none",document.body.appendChild(a);const h=o.createMediaStreamDestination();a.srcObject=h.stream,u.connect(d),d.connect(h),await GI(o.audioWorklet,r?.audioConcatProcessor);const p=new AudioWorkletNode(o,"audioConcatProcessor");return p.port.postMessage({type:"setFormat",format:n}),p.connect(u),await o.resume(),i&&a.setSinkId&&await a.setSinkId(i),new ea(o,d,u,p,a)}catch(d){var l,c;throw(l=a)!=null&&l.parentNode&&a.parentNode.removeChild(a),(c=a)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),d}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Yd extends Pr{static async startSession(e){var n;const i=Pr.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,a=null,l=null,c=null;if((n=e.useWakeLock)==null||n)try{c=await navigator.wakeLock.request("screen")}catch{}try{var d;return l=await navigator.mediaDevices.getUserMedia({audio:!0}),await Ey(i.connectionDelay),o=await Ty(e),[r,a]=await Promise.all([Ts.create(Yn({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),ea.create(Yn({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(d=l)==null||d.getTracks().forEach(f=>{f.stop()}),l=null,new Yd(i,o,r,a,c)}catch(f){var u,h,p,m;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=l)==null||u.getTracks().forEach(b=>{b.stop()}),(h=o)==null||h.close(),await((p=r)==null?void 0:p.close()),await((m=a)==null?void 0:m.close());try{var y;await((y=c)==null?void 0:y.release()),c=null}catch{}throw f}}constructor(e,n,i,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=a=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:wy(a.data[0].buffer)})},this.onOutputWorkletMessage=({data:a})=>{a.type==="process"&&this.updateMode(a.finished?"listening":"speaking")},this.addAudioBase64Chunk=a=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:$I(a)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=a=>{if(a.length===0)return 0;let l=0;for(let c=0;c<a.length;c++)l+=a[c]/255;return l/=a.length,l<0?0:l>1?1:l},this.setVolume=({volume:a})=>{const l=Number.isFinite(a)?Math.min(1,Math.max(0,a)):1;this.volume=l,this.connection instanceof Vn?this.connection.setAudioVolume(l):this.output.gain.gain.value=l},this.input=i,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof Vn||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof Vn?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof Vn?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof wc)try{return await this.input.setInputDevice(r),this.input}catch(a){console.warn("Failed to change device on existing input, recreating:",a)}this.connection instanceof Vn&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await Ts.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof wc)try{return await this.output.setOutputDevice(i),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof Vn&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await ea.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var df;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(df||(df={}));var uf,hf;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(uf||(uf={})),(function(t){t.MANUAL="manual",t.VAD="vad"})(hf||(hf={}));class qI extends Pr{static startSession(e){return e.textOnly?Kd.startSession(e):Yd.startSession(e)}}function fr(){return fr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},fr.apply(null,arguments)}const HI=["micMuted","volume","serverLocation"];function KI(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function YI(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function JI(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function XI(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=(function(f,b){if(f==null)return{};var S={};for(var C in f)if({}.hasOwnProperty.call(f,C)){if(b.indexOf(C)!==-1)continue;S[C]=f[C]}return S})(t,HI),o=g.useRef(null),a=g.useRef(null),[l,c]=g.useState("disconnected"),[d,u]=g.useState(!1),[h,p]=g.useState("listening"),m=g.useRef(e),y=g.useRef(n);return m.current=e,y.current=n,g.useEffect(()=>{var f;e!==void 0&&(o==null||(f=o.current)==null||f.setMicMuted(e))},[e]),g.useEffect(()=>{var f;n!==void 0&&(o==null||(f=o.current)==null||f.setVolume({volume:n}))},[n]),g.useEffect(()=>()=>{var f;(f=o.current)==null||f.endSession()},[]),{startSession:async f=>{var b;if((b=o.current)!=null&&b.isOpen())return o.current.getId();if(a.current)return(await a.current).getId();try{var S,C,j,w,v,E,k,T,N,R;const _=KI(f?.serverLocation||i),A=YI(_),Y=JI(_);return a.current=qI.startSession(fr({},r??{},f??{},{origin:A,livekitUrl:f?.livekitUrl||r?.livekitUrl||Y,overrides:fr({},(S=r?.overrides)!=null?S:{},(C=f?.overrides)!=null?C:{},{client:fr({},(j=r==null||(w=r.overrides)==null?void 0:w.client)!=null?j:{},(v=f==null||(E=f.overrides)==null?void 0:E.client)!=null?v:{},{source:(f==null||(k=f.overrides)==null||(k=k.client)==null?void 0:k.source)||(r==null||(T=r.overrides)==null||(T=T.client)==null?void 0:T.source)||"react_sdk",version:(f==null||(N=f.overrides)==null||(N=N.client)==null?void 0:N.version)||(r==null||(R=r.overrides)==null||(R=R.client)==null?void 0:R.version)||"0.12.1"})}),onConnect:f?.onConnect||r?.onConnect,onDisconnect:f?.onDisconnect||r?.onDisconnect,onError:f?.onError||r?.onError,onMessage:f?.onMessage||r?.onMessage,onAudio:f?.onAudio||r?.onAudio,onDebug:f?.onDebug||r?.onDebug,onUnhandledClientToolCall:f?.onUnhandledClientToolCall||r?.onUnhandledClientToolCall,onVadScore:f?.onVadScore||r?.onVadScore,onInterruption:f?.onInterruption||r?.onInterruption,onAgentToolRequest:f?.onAgentToolRequest||r?.onAgentToolRequest,onAgentToolResponse:f?.onAgentToolResponse||r?.onAgentToolResponse,onConversationMetadata:f?.onConversationMetadata||r?.onConversationMetadata,onMCPToolCall:f?.onMCPToolCall||r?.onMCPToolCall,onMCPConnectionStatus:f?.onMCPConnectionStatus||r?.onMCPConnectionStatus,onAsrInitiationMetadata:f?.onAsrInitiationMetadata||r?.onAsrInitiationMetadata,onAgentChatResponsePart:f?.onAgentChatResponsePart||r?.onAgentChatResponsePart,onModeChange:({mode:H})=>{var $;p(H),($=f?.onModeChange||r?.onModeChange)==null||$({mode:H})},onStatusChange:({status:H})=>{var $;c(H),($=f?.onStatusChange||r?.onStatusChange)==null||$({status:H})},onCanSendFeedbackChange:({canSendFeedback:H})=>{var $;u(H),($=f?.onCanSendFeedbackChange||r?.onCanSendFeedbackChange)==null||$({canSendFeedback:H})}})),o.current=await a.current,m.current!==void 0&&o.current.setMicMuted(m.current),y.current!==void 0&&o.current.setVolume({volume:y.current}),o.current.getId()}finally{a.current=null}},endSession:async()=>{const f=o.current;o.current=null,await f?.endSession()},setVolume:({volume:f})=>{var b;(b=o.current)==null||b.setVolume({volume:f})},getInputByteFrequencyData:()=>{var f;return(f=o.current)==null?void 0:f.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var f;return(f=o.current)==null?void 0:f.getOutputByteFrequencyData()},getInputVolume:()=>{var f,b;return(f=(b=o.current)==null?void 0:b.getInputVolume())!=null?f:0},getOutputVolume:()=>{var f,b;return(f=(b=o.current)==null?void 0:b.getOutputVolume())!=null?f:0},sendFeedback:f=>{var b;(b=o.current)==null||b.sendFeedback(f)},getId:()=>{var f;return(f=o.current)==null?void 0:f.getId()},sendContextualUpdate:f=>{var b;(b=o.current)==null||b.sendContextualUpdate(f)},sendUserMessage:f=>{var b;(b=o.current)==null||b.sendUserMessage(f)},sendUserActivity:()=>{var f;(f=o.current)==null||f.sendUserActivity()},sendMCPToolApprovalResult:(f,b)=>{var S;(S=o.current)==null||S.sendMCPToolApprovalResult(f,b)},changeInputDevice:async f=>{if(o.current&&"changeInputDevice"in o.current)return await o.current.changeInputDevice(f);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async f=>{if(o.current&&"changeOutputDevice"in o.current)return await o.current.changeOutputDevice(f);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:d,micMuted:e,isSpeaking:h==="speaking"}}const ZI=({profile:t})=>{const[e,n]=g.useState({properties:!0,objections:!1,questions:!1}),{branding:i}=ge(),r=i?.["--primary-accent"]||Q["--primary-accent"],o=i?.["--primary-accent-light"]||Q["--primary-accent-light"],a=y=>{n(f=>({...f,[y]:!f[y]}))};if(!t||!t.name)return null;const l=y=>y?y.split(/\n|,/).map(f=>f.trim()).filter(Boolean):[],c=l(t.properties),d=l(t.typical_objections),u=l(t.important_questions),h={width:"100%",padding:"12px 16px",backgroundColor:x.slate[50],border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background-color 0.2s"},p={...h,backgroundColor:o},m={padding:"16px",backgroundColor:"white"};return s.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"8px"},children:[c.length>0&&s.jsxs("div",{style:{border:`1px solid ${x.slate[200]}`,borderRadius:"8px",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("properties"),style:e.properties?p:h,onMouseEnter:y=>y.currentTarget.style.backgroundColor=x.slate[100],onMouseLeave:y=>y.currentTarget.style.backgroundColor=e.properties?o:x.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:x.slate[700]},children:"Eigenschaften"}),e.properties?s.jsx(ar,{style:{width:"20px",height:"20px",color:x.slate[500]}}):s.jsx(jt,{style:{width:"20px",height:"20px",color:x.slate[500]}})]}),e.properties&&s.jsx("div",{style:m,children:s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],lineHeight:1.6,margin:0},children:c.join(", ")})})]}),d.length>0&&s.jsxs("div",{style:{border:`1px solid ${x.slate[200]}`,borderRadius:"8px",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("objections"),style:e.objections?p:h,onMouseEnter:y=>y.currentTarget.style.backgroundColor=x.slate[100],onMouseLeave:y=>y.currentTarget.style.backgroundColor=e.objections?o:x.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:x.slate[700]},children:"Typische Einwnde"}),e.objections?s.jsx(ar,{style:{width:"20px",height:"20px",color:x.slate[500]}}):s.jsx(jt,{style:{width:"20px",height:"20px",color:x.slate[500]}})]}),e.objections&&s.jsx("div",{style:m,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:"8px"},children:d.map((y,f)=>s.jsxs("li",{style:{fontSize:"14px",color:x.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:"8px"},children:""}),s.jsx("span",{children:y})]},f))})})]}),u.length>0&&s.jsxs("div",{style:{border:`1px solid ${x.slate[200]}`,borderRadius:"8px",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>a("questions"),style:e.questions?p:h,onMouseEnter:y=>y.currentTarget.style.backgroundColor=x.slate[100],onMouseLeave:y=>y.currentTarget.style.backgroundColor=e.questions?o:x.slate[50],children:[s.jsx("span",{style:{fontWeight:600,color:x.slate[700]},children:"Wichtige Fragen"}),e.questions?s.jsx(ar,{style:{width:"20px",height:"20px",color:x.slate[500]}}):s.jsx(jt,{style:{width:"20px",height:"20px",color:x.slate[500]}})]}),e.questions&&s.jsx("div",{style:m,children:s.jsx("ul",{style:{margin:0,padding:0,listStyle:"none",display:"flex",flexDirection:"column",gap:"8px"},children:u.map((y,f)=>s.jsxs("li",{style:{fontSize:"14px",color:x.slate[600],display:"flex",alignItems:"flex-start"},children:[s.jsx("span",{style:{marginRight:"8px"},children:""}),s.jsx("span",{children:y})]},f))})})]}),s.jsx("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:o,borderRadius:"8px",border:`1px solid ${r}33`},children:s.jsx("p",{style:{fontSize:"12px",color:r,textAlign:"center",margin:0},children:" Fr ein optimales Erlebnis empfiehlt sich die Nutzung von Kopfhrern mit Mikrofon."})})]})},QI=({hints:t})=>{const{branding:e}=ge(),n=e?.["--header-gradient"]||Q["--header-gradient"],i=e?.["--header-text"]||Q["--header-text"],r=e?.["--icon-primary"]||Q["--icon-primary"];e?.["--icon-secondary"]||Q["--icon-secondary"];const a=(l=>l?l.split(/\n/).map(c=>c.trim()).filter(Boolean):[])(t);return s.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden h-full flex flex-col",children:[s.jsxs("div",{style:{background:n},className:"px-4 py-3 flex items-center gap-2 flex-shrink-0",children:[s.jsx(Ce,{className:"w-5 h-5",style:{color:i}}),s.jsx("h3",{className:"font-bold text-sm",style:{color:i},children:"Live Coaching"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0",children:a.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-400",children:[s.jsx(Ce,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]})}):a.map((l,c)=>s.jsxs(L.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.1},className:"flex gap-3 items-start",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{background:`linear-gradient(to bottom right, ${e?.["--primary-accent-light"]||Q["--primary-accent-light"]}, ${e?.["--primary-accent-light"]||Q["--primary-accent-light"]})`},children:s.jsx(Ce,{className:"w-3.5 h-3.5",style:{color:r}})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:l})})]},c))}),s.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-200 flex-shrink-0",children:s.jsx("p",{className:"text-xs text-slate-500 text-center",children:" Hilfreiche Tipps fr ein erfolgreiches Gesprch"})})]})},e_=({isOpen:t,onClose:e,feedbackContent:n,audioAnalysisContent:i,isLoading:r})=>{const o=g.useCallback(p=>{p||e()},[e]),a=g.useMemo(()=>{if(!n)return null;try{let p=n.trim();return p.startsWith("```json")?p=p.replace(/```json\s*/g,"").replace(/```\s*$/g,""):p.startsWith("```")&&(p=p.replace(/```\s*/g,"").replace(/```\s*$/g,"")),JSON.parse(p)}catch(p){return console.error("Error parsing feedback JSON:",p),null}},[n]),l=g.useMemo(()=>{if(!i)return null;try{let p=i.trim();return p.startsWith("```json")?p=p.replace(/```json\s*/g,"").replace(/```\s*$/g,""):p.startsWith("```")&&(p=p.replace(/```\s*/g,"").replace(/```\s*$/g,"")),JSON.parse(p)}catch(p){return console.error("Error parsing audio analysis JSON:",p),null}},[i]),c=p=>{const m=Math.floor(p),y=p%1>=.5;return s.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(10)].map((f,b)=>s.jsx(Rt,{className:`w-4 h-4 ${b<m?"fill-amber-400 text-amber-400":b===m&&y?"fill-amber-200 text-amber-400":"text-slate-200"}`},b)),s.jsxs("span",{className:"ml-2 text-sm font-semibold text-slate-700",children:[p,"/10"]})]})},d=()=>a?s.jsxs("div",{className:"space-y-5",children:[a.summary&&s.jsx("div",{className:"p-4 bg-ocean-blue-50 border-l-4 border-ocean-blue-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ze,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-2",children:"Gesamteindruck"}),s.jsx("p",{className:"text-sm text-ocean-blue-800 leading-relaxed",children:a.summary})]})]})}),a.rating&&s.jsx("div",{className:"p-4 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50 border border-ocean-blue-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Dt,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-3",children:"Bewertung"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.rating.overall!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Gesamt"}),c(a.rating.overall)]}),a.rating.communication!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Kommunikation"}),c(a.rating.communication)]}),a.rating.motivation!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Motivation"}),c(a.rating.motivation)]}),a.rating.professionalism!==void 0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-ocean-blue-700 mb-1",children:"Professionalitt"}),c(a.rating.professionalism)]})]})]})]})}),a.strengths&&a.strengths.length>0&&s.jsx("div",{className:"p-4 bg-green-50 border-l-4 border-green-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Qn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-3",children:"Das hast du gut gemacht"}),s.jsx("ul",{className:"space-y-2",children:a.strengths.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-green-800 leading-relaxed",children:p})]},m))})]})]})}),a.improvements&&a.improvements.length>0&&s.jsx("div",{className:"p-4 bg-amber-50 border-l-4 border-amber-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Vt,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-amber-900 mb-3",children:"Das kann noch besser werden"}),s.jsx("ul",{className:"space-y-2",children:a.improvements.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-amber-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-amber-800 leading-relaxed",children:p})]},m))})]})]})}),a.tips&&a.tips.length>0&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border-l-4 border-ocean-teal-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Ce,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-teal-900 mb-3",children:"Praktische Tipps fr dich"}),s.jsx("ul",{className:"space-y-2",children:a.tips.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(De,{className:"w-4 h-4 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsx("span",{className:"text-sm text-ocean-teal-800 leading-relaxed",children:p})]},m))})]})]})})]}):s.jsx("div",{className:"space-y-4",children:s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ve,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-amber-800 font-medium mb-2",children:"Feedback konnte nicht strukturiert werden"}),s.jsx("div",{className:"text-sm text-amber-700 whitespace-pre-wrap",children:n})]})]})})}),u=()=>l?l.error?s.jsxs("div",{className:"space-y-4 mt-8",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b-2 border-amber-300",children:[s.jsx(Lo,{className:"w-6 h-6 text-amber-600"}),s.jsx("h2",{className:"text-xl font-bold text-amber-900",children:"Audio-Analyse"})]}),s.jsx("div",{className:"p-4 bg-amber-50 border-l-4 border-amber-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Mn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-amber-900 mb-2",children:"Audio-Analyse nicht verfgbar"}),s.jsx("p",{className:"text-sm text-amber-800 leading-relaxed",children:l.summary}),l.errorMessage&&s.jsxs("div",{className:"text-xs text-amber-700 mt-3 p-3 bg-amber-100 rounded-lg",children:[s.jsx("span",{className:"font-semibold",children:"Details:"}),s.jsx("pre",{className:"mt-1 whitespace-pre-wrap text-xs",children:l.errorMessage})]}),l.troubleshooting&&l.troubleshooting.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-xs font-semibold text-amber-900 mb-2",children:"Lsungsvorschlge:"}),s.jsx("ul",{className:"space-y-1",children:l.troubleshooting.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2 text-xs text-amber-800",children:[s.jsx("span",{className:"text-amber-600 mt-0.5",children:""}),s.jsx("span",{children:p})]},m))})]}),!l.troubleshooting&&s.jsxs("p",{className:"text-xs text-amber-600 mt-3",children:[s.jsx("span",{className:"font-semibold",children:"Tipp:"})," Dies kann passieren, wenn das Mikrofon bereits von ElevenLabs verwendet wird. Versuche das Gesprch erneut zu starten."]})]})]})})]}):s.jsxs("div",{className:"space-y-5 mt-8",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b-2 border-ocean-blue-300",children:[s.jsx(Lo,{className:"w-6 h-6 text-ocean-blue-600"}),s.jsx("h2",{className:"text-xl font-bold text-ocean-blue-900",children:"Audio-Analyse deiner Sprechweise"})]}),l.summary&&s.jsx("div",{className:"p-4 bg-ocean-blue-50 border-l-4 border-ocean-blue-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(pm,{className:"w-5 h-5 text-ocean-blue-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-blue-900 mb-2",children:"Gesamteindruck"}),s.jsx("p",{className:"text-sm text-ocean-blue-800 leading-relaxed",children:l.summary})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.clarity&&s.jsx("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Ci,{className:"w-5 h-5 text-slate-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Deutlichkeit"}),c(l.clarity.rating),s.jsx("p",{className:"text-xs text-slate-700 mt-2",children:l.clarity.feedback})]})]})}),l.pace&&s.jsx("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(mm,{className:"w-5 h-5 text-slate-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Sprechgeschwindigkeit"}),c(l.pace.rating),l.pace.wordsPerMinute&&s.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:["~",l.pace.wordsPerMinute," Wrter/Min"]}),s.jsx("p",{className:"text-xs text-slate-700 mt-2",children:l.pace.feedback})]})]})}),l.fillerWords&&s.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Mn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-2",children:"Fllwrter"}),c(l.fillerWords.rating),l.fillerWords.count!==void 0&&s.jsxs("p",{className:"text-xs text-amber-700 mt-1",children:["Anzahl: ",l.fillerWords.count]}),l.fillerWords.examples&&l.fillerWords.examples.length>0&&s.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Beispiele: ",l.fillerWords.examples.join(", ")]}),s.jsx("p",{className:"text-xs text-amber-800 mt-2",children:l.fillerWords.feedback})]})]})}),l.nervousness&&s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ho,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-red-900 mb-2",children:"Nervositt"}),c(l.nervousness.rating),l.nervousness.indicators&&l.nervousness.indicators.length>0&&s.jsx("ul",{className:"text-xs text-red-700 mt-2 space-y-1",children:l.nervousness.indicators.map((p,m)=>s.jsxs("li",{children:[" ",p]},m))}),s.jsx("p",{className:"text-xs text-red-800 mt-2",children:l.nervousness.feedback})]})]})}),l.confidence&&s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Dt,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-2",children:"Selbstsicherheit"}),c(l.confidence.rating),s.jsx("p",{className:"text-xs text-green-700 mt-2",children:l.confidence.feedback})]})]})}),l.tonalModulation&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border border-ocean-teal-200 rounded-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(oa,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-ocean-teal-900 mb-2",children:"Tonmodulation"}),c(l.tonalModulation.rating),s.jsx("p",{className:"text-xs text-ocean-teal-700 mt-2",children:l.tonalModulation.feedback})]})]})})]}),l.strengths&&l.strengths.length>0&&s.jsx("div",{className:"p-4 bg-green-50 border-l-4 border-green-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Qn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-green-900 mb-3",children:"Strken deiner Sprechweise"}),s.jsx("ul",{className:"space-y-2",children:l.strengths.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-600 mt-0.5",children:""}),s.jsx("span",{className:"text-sm text-green-800 leading-relaxed",children:p})]},m))})]})]})}),l.overallImprovement&&l.overallImprovement.length>0&&s.jsx("div",{className:"p-4 bg-ocean-teal-50 border-l-4 border-ocean-teal-500 rounded-r-xl",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Ce,{className:"w-5 h-5 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-ocean-teal-900 mb-3",children:"Verbesserungsvorschlge"}),s.jsx("ul",{className:"space-y-2",children:l.overallImprovement.map((p,m)=>s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(De,{className:"w-4 h-4 text-ocean-teal-600 flex-shrink-0 mt-1"}),s.jsx("span",{className:"text-sm text-ocean-teal-800 leading-relaxed",children:p})]},m))})]})]})})]}):null,h=()=>r?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ocean-blue-600"}),s.jsx("p",{className:"mt-4 text-slate-600",children:"Feedback wird generiert..."}),s.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Das kann einen Moment dauern"})]}):n?s.jsxs("div",{className:"space-y-6 max-h-[65vh] overflow-y-auto pr-2",children:[d(),u()]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(ve,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-600",children:"Kein Feedback verfgbar."})]});return s.jsx(Kt,{open:t,onOpenChange:o,children:s.jsxs(Yt,{className:"max-w-3xl max-h-[90vh] flex flex-col",children:[s.jsxs(Jt,{className:"flex-shrink-0",children:[s.jsxs(Xt,{className:"text-2xl flex items-center gap-2",children:[s.jsx(Dt,{className:"w-6 h-6 text-ocean-blue-600"}),"Dein Bewerbungsgesprch-Feedback"]}),s.jsx(dn,{children:"Hier ist deine persnliche Auswertung basierend auf dem gefhrten Gesprch"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto py-2",children:h()}),s.jsx(cn,{className:"flex-shrink-0 pt-4 border-t border-slate-100",children:s.jsx(se,{onClick:e,className:"w-full sm:w-auto",children:"Schlieen"})})]})})},Sa=({selectedDeviceId:t,onDeviceChange:e,onTestClick:n,disabled:i=!1})=>{const[r,o]=g.useState([]),[a,l]=g.useState(!0),[c,d]=g.useState(null),[u,h]=g.useState(!1),{branding:p}=ge(),m=p?.["--header-gradient"]||Q["--header-gradient"],y=p?.["--header-text"]||Q["--header-text"],f=p?.["--primary-accent"]||Q["--primary-accent"],b=p?.["--primary-accent-light"]||Q["--primary-accent-light"],S=async()=>{l(!0),d(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(T=>T.stop());const k=(await navigator.mediaDevices.enumerateDevices()).filter(T=>T.kind==="audioinput");if(k.length===0)d("Kein Mikrofon gefunden"),o([]);else if(o(k),!t&&k.length>0){const T=k.find(N=>N.deviceId==="default")||k[0];e?.(T.deviceId)}}catch(v){console.error("Error loading microphone devices:",v),v.name==="NotAllowedError"||v.name==="PermissionDeniedError"?d("Mikrofonzugriff verweigert"):v.name==="NotFoundError"?d("Kein Mikrofon gefunden"):d("Fehler beim Laden der Mikrofone"),o([])}finally{l(!1)}};g.useEffect(()=>{S();const v=()=>S();return navigator.mediaDevices?.addEventListener("devicechange",v),()=>{navigator.mediaDevices?.removeEventListener("devicechange",v)}},[]);const C=v=>{if(v.label){let E=v.label;return E=E.replace(/^Default - /,""),E=E.replace(/^Kommunikation - /,""),E=E.replace(/^Standard - /,""),E.length>35&&(E=E.substring(0,32)+"..."),E}return`Mikrofon ${r.indexOf(v)+1}`},j=v=>{e?.(v),h(!1)},w=r.find(v=>v.deviceId===t);return s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:[s.jsxs("button",{onClick:()=>!i&&!a&&h(!u),disabled:i||a,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${c?x.red[500]:x.slate[200]}`,backgroundColor:c?x.red[50]:x.white,cursor:i||a?"not-allowed":"pointer",opacity:i||a?.6:1,transition:"all 0.2s"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:c?x.red[100]:m},children:c?s.jsx(ve,{style:{width:"22px",height:"22px",color:x.red[500]}}):s.jsx(Xe,{style:{width:"22px",height:"22px",color:y}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"12px",color:x.slate[500],fontWeight:500,marginBottom:"2px"},children:"Mikrofon"}),s.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:c?x.red[600]:x.slate[800]},children:a?"Lade...":c||(w?C(w):"Bitte whlen")})]})]}),s.jsx(jt,{style:{width:"20px",height:"20px",color:x.slate[400],transform:u?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]}),n&&!c&&s.jsxs("button",{onClick:n,disabled:i||a||!t,style:{flex:"0 0 auto",display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,cursor:i||a||!t?"not-allowed":"pointer",opacity:i||a||!t?.5:1,transition:"all 0.2s",whiteSpace:"nowrap"},children:[s.jsx(Xe,{style:{width:"18px",height:"18px",color:f}}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700]},children:"Testen"})]}),c&&s.jsx("button",{onClick:S,style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,cursor:"pointer",transition:"all 0.2s"},children:s.jsx(hn,{style:{width:"20px",height:"20px",color:x.slate[600]}})})]}),u&&r.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>h(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:x.white,borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:`1px solid ${x.slate[200]}`,zIndex:50,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:r.map((v,E)=>s.jsxs("button",{onClick:()=>j(v.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:t===v.deviceId?b:"transparent",cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:k=>{t!==v.deviceId&&(k.currentTarget.style.backgroundColor=x.slate[50])},onMouseLeave:k=>{k.currentTarget.style.backgroundColor=t===v.deviceId?b:"transparent"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t===v.deviceId?f:x.slate[100]},children:s.jsx(Xe,{style:{width:"18px",height:"18px",color:t===v.deviceId?x.white:x.slate[500]}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:t===v.deviceId?f:x.slate[800],overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:C(v)}),v.deviceId==="default"&&s.jsx("div",{style:{fontSize:"12px",color:x.slate[400]},children:"Systemstandard"})]}),t===v.deviceId&&s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:f}})]},v.deviceId||E))})]})]})},ka=({isOpen:t,onClose:e,deviceId:n})=>{const[i,r]=g.useState("idle"),[o,a]=g.useState(0),[l,c]=g.useState(null),[d,u]=g.useState(0),[h,p]=g.useState(null),{branding:m}=ge(),y=m?.["--header-gradient"]||Q["--header-gradient"],f=m?.["--button-gradient"]||y,b=g.useRef(null),S=g.useRef([]),C=g.useRef(null),j=g.useRef(null),w=g.useRef(null),v=g.useRef(null),E=g.useRef(null),k=g.useRef(null),T=10;g.useEffect(()=>()=>R(),[]),g.useEffect(()=>{t?N():R()},[t]);const N=()=>{r("idle"),a(0),u(0),p(null),l&&(URL.revokeObjectURL(l),c(null))},R=()=>{if(E.current&&(clearInterval(E.current),E.current=null),v.current&&(cancelAnimationFrame(v.current),v.current=null),b.current&&b.current.state!=="inactive")try{b.current.stop()}catch{}if(j.current){try{j.current.close()}catch{}j.current=null}C.current&&(C.current.getTracks().forEach(K=>K.stop()),C.current=null),k.current&&(k.current.pause(),k.current.src="")},_=async()=>{try{p(null),S.current=[],u(0);const K={audio:n?{deviceId:{exact:n}}:!0},O=await navigator.mediaDevices.getUserMedia(K);C.current=O,j.current=new(window.AudioContext||window.webkitAudioContext),w.current=j.current.createAnalyser(),j.current.createMediaStreamSource(O).connect(w.current),w.current.fftSize=256;const F=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";b.current=new MediaRecorder(O,{mimeType:F}),b.current.ondataavailable=B=>{B.data.size>0&&S.current.push(B.data)},b.current.onstop=()=>{const B=new Blob(S.current,{type:F}),G=URL.createObjectURL(B);c(G),r("recorded"),a(0)},b.current.start(100),r("recording");const D=()=>{if(w.current){const B=new Uint8Array(w.current.frequencyBinCount);w.current.getByteFrequencyData(B);const G=B.reduce((ie,le)=>ie+le,0)/B.length;a(G/255)}v.current=requestAnimationFrame(D)};D(),E.current=setInterval(()=>{u(B=>B>=T-1?(A(),T):B+1)},1e3)}catch(K){console.error("Error starting recording:",K),K.name==="NotAllowedError"?p("Mikrofonzugriff verweigert"):K.name==="NotFoundError"?p("Kein Mikrofon gefunden"):p("Fehler beim Starten der Aufnahme")}},A=()=>{E.current&&(clearInterval(E.current),E.current=null),v.current&&(cancelAnimationFrame(v.current),v.current=null),j.current&&(j.current.close(),j.current=null),b.current&&b.current.state!=="inactive"&&b.current.stop(),C.current&&(C.current.getTracks().forEach(K=>K.stop()),C.current=null)},Y=()=>{l&&(k.current&&k.current.pause(),k.current=new Audio(l),k.current.onended=()=>r("recorded"),k.current.play(),r("playing"))},H=()=>{k.current&&(k.current.pause(),k.current.currentTime=0),r("recorded")},$=()=>{l&&URL.revokeObjectURL(l),c(null),u(0),r("idle")};return t?s.jsx(Ve,{children:s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:s.jsxs(L.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:K=>K.stopPropagation(),style:{backgroundColor:x.white,borderRadius:"20px",width:"100%",maxWidth:"400px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"20px 24px",borderBottom:`1px solid ${x.slate[200]}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:y,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Xe,{style:{width:"20px",height:"20px",color:x.white}})}),s.jsxs("div",{children:[s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900],margin:0},children:"Mikrofon testen"}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[500],margin:0},children:"Prfe deine Audioqualitt"})]})]}),s.jsx("button",{onClick:e,style:{width:"44px",height:"44px",borderRadius:"12px",border:"none",backgroundColor:x.slate[100],cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseEnter:K=>K.currentTarget.style.backgroundColor=x.slate[200],onMouseLeave:K=>K.currentTarget.style.backgroundColor=x.slate[100],children:s.jsx(kn,{style:{width:"24px",height:"24px",color:x.slate[600]}})})]}),s.jsxs("div",{style:{padding:"32px 24px"},children:[h&&s.jsxs("div",{style:{marginBottom:"24px",padding:"16px",backgroundColor:x.red[50],border:`1px solid ${x.red[100]}`,borderRadius:"12px",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(ve,{style:{width:"20px",height:"20px",color:x.red[500]}}),s.jsx("p",{style:{fontSize:"14px",color:x.red[600],margin:0},children:h})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:s.jsxs("div",{style:{position:"relative"},children:[s.jsxs(L.div,{style:{width:"120px",height:"120px",borderRadius:"50%",backgroundColor:i==="recording"?x.red[50]:i==="playing"?x.green[50]:i==="recorded"?x.green[50]:x.slate[100],display:"flex",alignItems:"center",justifyContent:"center"},children:[i==="recording"&&s.jsx(L.div,{style:{position:"absolute",inset:0,borderRadius:"50%",border:`3px solid ${x.red[500]}`},animate:{scale:[1,1+o*.3],opacity:[1,.3]},transition:{duration:.3,repeat:1/0}}),i==="idle"&&s.jsx(Xe,{style:{width:"48px",height:"48px",color:x.slate[400]}}),i==="recording"&&s.jsx(Xe,{style:{width:"48px",height:"48px",color:x.red[500]}}),i==="recorded"&&s.jsx(Zt,{style:{width:"48px",height:"48px",color:x.green[500]}}),i==="playing"&&s.jsx(Ci,{style:{width:"48px",height:"48px",color:x.green[600]}})]}),i==="recording"&&s.jsxs("div",{style:{position:"absolute",bottom:"-8px",left:"50%",transform:"translateX(-50%)",padding:"4px 12px",backgroundColor:x.red[500],color:x.white,borderRadius:"20px",fontSize:"13px",fontWeight:600,fontFamily:"monospace"},children:[d,"s / ",T,"s"]})]})}),i==="recording"&&s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"3px",height:"40px",marginBottom:"24px"},children:[...Array(16)].map((K,O)=>{const P=Math.max(8,Math.min(40,o*80+Math.random()*10));return s.jsx(L.div,{style:{width:"4px",background:f,borderRadius:"2px"},animate:{height:P},transition:{duration:.1}},O)})}),s.jsxs("p",{style:{textAlign:"center",fontSize:"15px",color:x.slate[600],marginBottom:"24px"},children:[i==="idle"&&'Klicke auf "Aufnahme starten" um dein Mikrofon zu testen.',i==="recording"&&"Sprich jetzt in dein Mikrofon...",i==="recorded"&&"Aufnahme fertig! Hre dir das Ergebnis an.",i==="playing"&&"Wiedergabe luft..."]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[i==="idle"&&s.jsxs("button",{onClick:_,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 28px",borderRadius:"12px",border:"none",background:f,color:x.white,fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Xe,{style:{width:"18px",height:"18px"}}),"Aufnahme starten"]}),i==="recording"&&s.jsxs("button",{onClick:A,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 28px",borderRadius:"12px",border:"none",backgroundColor:x.red[500],color:x.white,fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Sr,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),i==="recorded"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:Y,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 28px",borderRadius:"12px",border:"none",background:f,color:x.white,fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx($t,{style:{width:"18px",height:"18px"}}),"Anhren"]}),s.jsxs("button",{onClick:$,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 20px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx(hn,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]}),i==="playing"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:H,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 20px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Sr,{style:{width:"18px",height:"18px"}}),"Stoppen"]}),s.jsxs("button",{onClick:$,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 20px",borderRadius:"12px",border:`2px solid ${x.slate[200]}`,backgroundColor:x.white,color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer"},children:[s.jsx(hn,{style:{width:"18px",height:"18px"}}),"Nochmal"]})]})]})]})]})})}):null},t_=({scenario:t,variables:e={},onEnd:n,onNavigateToSession:i})=>{const{branding:r,demoCode:o}=ge(),a=g.useMemo(()=>{const ne=r?.["--header-gradient"]||Q["--header-gradient"],Ee=r?.["--header-text"]||Q["--header-text"],Ae=r?.["--icon-primary"]||Q["--icon-primary"],Qe=r?.["--icon-secondary"]||Q["--icon-secondary"],jn=r?.["--app-bg-color"]||Q["--app-bg-color"],Fe=r?.["--primary-accent"]||Q["--primary-accent"],ri=r?.["--primary-accent-light"]||Q["--primary-accent-light"];return{headerGradient:ne,headerText:Ee,iconPrimary:Ae,iconSecondary:Qe,appBgColor:jn,primaryAccent:Fe,primaryAccentLight:ri,userBubbleGradient:"linear-gradient(to bottom right, #14b8a6, #0d9488)",agentAvatarGradient:ne}},[r]),[l,c]=g.useState(null),[d,u]=g.useState(null),[h,p]=g.useState(0),[m,y]=g.useState(null),[f,b]=g.useState(!1),[S,C]=g.useState(null),[j,w]=g.useState(!1),[v,E]=g.useState([]),[k,T]=g.useState(!0),[N,R]=g.useState(!1),[_,A]=g.useState(!1),[Y,H]=g.useState(null),[$,K]=g.useState(null),[O,P]=g.useState(!1),[F,D]=g.useState(!1),[B,G]=g.useState(!1),[ie,le]=g.useState(!0),[re,U]=g.useState(window.innerWidth<1024),[be,Oe]=g.useState(80),bt=g.useRef(null),ce=g.useRef(null),_e=g.useRef(null);g.useRef(!1);const Le=g.useRef(null),ot=g.useRef(null),Gt=g.useRef(0);fe.getElevenLabsApiKey();const te=t.agent_id||fe.getElevenLabsAgentId(),$e=()=>{let ne=t.content||"";return t.interviewer_profile&&(ne+=`

## Dein Profil:
`,t.interviewer_profile.name&&(ne+=`
Dein Name: ${t.interviewer_profile.name}`),t.interviewer_profile.role&&(ne+=`
Deine Rolle: ${t.interviewer_profile.role}`),t.interviewer_profile.properties&&(ne+=`

### Deine Eigenschaften:
${t.interviewer_profile.properties}`),t.interviewer_profile.typical_objections&&(ne+=`

### Typische Einwnde, die du vorbringen solltest:
${t.interviewer_profile.typical_objections}`),t.interviewer_profile.important_questions&&(ne+=`

### Wichtige Fragen, die du stellen solltest:
${t.interviewer_profile.important_questions}`)),ne},Ne=XI({overrides:{agent:{prompt:{prompt:$e()},firstMessage:t.initial_message||"Hallo! Ich freue mich auf unser Gesprch."}},onConnect:()=>{console.log(" [RoleplaySession] Connected to ElevenLabs"),console.log(" [RoleplaySession] System prompt:",t.content?.substring(0,100)+"..."),console.log(" [RoleplaySession] First message:",t.initial_message);const ne=Date.now();u(ne),ot.current=ne},onDisconnect:()=>{console.log(" [RoleplaySession] Disconnected from ElevenLabs")},onMessage:ne=>{if(ne.source==="ai"||ne.source==="user"){const Ee=ot.current,Ae=Date.now(),Qe=Gt.current,jn=Ee?Math.floor((Ae-Ee)/1e3):0;Gt.current=jn;const Fe=Math.floor(Qe/60),ri=Qe%60,Xd=`${Fe.toString().padStart(2,"0")}:${ri.toString().padStart(2,"0")}`;console.log(" [RoleplaySession] Message started at",Xd,"- elapsedTime:",Qe,"(ended at",jn+"s)"),E(qy=>[...qy,{role:ne.source==="ai"?"agent":"user",text:ne.message,timestamp:Ae,elapsedTime:Qe,timeLabel:Xd}])}},onError:ne=>{console.error(" [RoleplaySession] Error:",ne),y(ne.message||"Ein Fehler ist aufgetreten.")}});g.useEffect(()=>{Le.current&&Le.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},[v]),g.useEffect(()=>{Ne.status==="disconnected"&&v.length>0&&!O&&!_&&(console.log(" [RoleplaySession] Agent ended the call - starting analysis",{status:Ne.status,transcriptLength:v.length,isAnalyzing:O,showFeedback:_}),z())},[Ne.status,v.length,O,_]),g.useEffect(()=>(Ne.status==="connected"&&d?ce.current=setInterval(()=>{const ne=Math.floor((Date.now()-d)/1e3);p(ne)},1e3):ce.current&&clearInterval(ce.current),()=>{ce.current&&clearInterval(ce.current)}),[Ne.status,d]),g.useEffect(()=>()=>{Ne.status==="connected"&&Ne.endSession()},[]),g.useEffect(()=>{const ne=()=>{const Ae=document.querySelector('header, .site-header, [role="banner"]');if(Ae){const Qe=Ae.offsetHeight;Oe(Qe)}};ne();const Ee=document.querySelector('header, .site-header, [role="banner"]');if(Ee){const Ae=new ResizeObserver(ne);Ae.observe(Ee),bt.current=Ae}return window.addEventListener("resize",ne),()=>{bt.current&&bt.current.disconnect(),window.removeEventListener("resize",ne)}},[]),g.useEffect(()=>{window.scrollTo(0,0)},[]),g.useEffect(()=>{const ne=()=>{U(window.innerWidth<1024)};return window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne)},[]);const je=async()=>{b(!0);const ne=Date.now();u(ne),ot.current=ne,await _t()},_t=async()=>{try{y(null);const ne=fe.getCurrentUser(),Ee={agent_id:te,scenario_id:t.id>0?t.id:null,variables:e,user_name:ne.firstName||"Gast",demo_code:o||null},Ae=await xT(Ee);c(Ae.id),console.log(" [RoleplaySession] Starting:",te),console.log(" [RoleplaySession] Variables:",e);const Qe={...e};t.interviewer_profile&&(t.interviewer_profile.name&&(Qe.interviewer_name=t.interviewer_profile.name),t.interviewer_profile.role&&(Qe.interviewer_role=t.interviewer_profile.role),console.log(" [RoleplaySession] Enhanced with interviewer variables:",Qe)),console.log(" [RoleplaySession] Starting session with microphone:",S||"default"),_e.current=await Ne.startSession({agentId:te,dynamicVariables:Qe,...S&&{inputDeviceId:S}}),console.log(" [RoleplaySession] Session started:",_e.current);const jn=$e();fe.logPrompt("ELEVENLABS_LIVE_SESSION",`Live-Training gestartet: ${t.title}`,jn,{scenario_id:t.id,scenario_title:t.title,agent_id:te,conversation_id:_e.current,first_message:t.initial_message,variables:JSON.stringify(Qe)})}catch(ne){console.error(" [RoleplaySession] Failed to start:",ne),y(ne.message||"Verbindung fehlgeschlagen.")}},z=async()=>{if(R(!1),Ne.status==="connected"&&Ne.endSession(),console.log(" [RoleplaySession] Ending conversation"),v.length===0){y("Das Gesprch war zu kurz. Bitte versuche es erneut.");return}try{P(!0);const ne={title:t.title,description:t.description,variables:e,role_type:t.role_type||"interview",user_role_label:t.user_role_label||"Bewerber",interviewer_profile:t.interviewer_profile,feedback_prompt:t.feedback_prompt};let Ee=null;if(l&&_e.current)try{console.log(" [RoleplaySession] Saving conversation_id to database first..."),await mT(l,_e.current),console.log(" [RoleplaySession] conversation_id saved"),console.log(" [RoleplaySession] Fetching audio via WordPress proxy..."),Ee=await gT(l,10,3e3),Ee?console.log(" [RoleplaySession] Audio fetched successfully:",Ee.size,"bytes"):console.warn(" [RoleplaySession] Audio not available, continuing without audio analysis")}catch(Qe){console.warn(" [RoleplaySession] Could not fetch audio for analysis:",Qe.message),console.warn(' [RoleplaySession] Make sure "Audio Saving" is enabled in ElevenLabs Agent settings')}const Ae=await uT(v,ne,Ee);if(l&&_e.current&&await pT(l,v,Ae.feedbackContent,Ae.audioAnalysisContent,h,_e.current),P(!1),i&&l){const Qe={id:l,scenario_id:t.id,transcript:JSON.stringify(v),feedback_json:Ae.feedbackContent,audio_analysis_json:Ae.audioAnalysisContent,duration:h,conversation_id:_e.current,created_at:new Date().toISOString()};console.log(" [RoleplaySession] Navigating to session analysis:",l),i(Qe)}else H(Ae.feedbackContent),K(Ae.audioAnalysisContent),A(!0)}catch(ne){console.error(" [RoleplaySession] Analysis failed:",ne),y(ne.message||"Fehler bei der Analyse."),P(!1)}},de=()=>{A(!1),n&&n()},Ke=ne=>{const Ee=Math.floor(ne/60),Ae=ne%60;return`${Ee}:${Ae.toString().padStart(2,"0")}`},Ye=ne=>{switch(ne){case"easy":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"hard":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},si=ne=>{switch(ne){case"easy":return"Einfach";case"medium":return"Mittel";case"hard":return"Schwer";default:return ne}},Us=ne=>ne?ne.split(/\n/).map(Ee=>Ee.trim()).filter(Boolean):[];return m?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(L.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ve,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Verbindungsfehler"}),s.jsx("p",{className:"text-slate-600 mb-6",children:m}),s.jsx(se,{onClick:n,className:"w-full",children:"Zurck zur bersicht"})]})}):O?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:s.jsxs(L.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center",children:[s.jsx(ye,{className:"w-16 h-16 animate-spin mx-auto mb-4",style:{color:a.iconPrimary}}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Feedback wird generiert..."}),s.jsx("p",{className:"text-slate-600",children:"Das kann einen Moment dauern"}),s.jsx("div",{className:"mt-6",children:s.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:s.jsx(L.div,{className:"h-full",style:{background:a.headerGradient},initial:{width:"0%"},animate:{width:"100%"},transition:{duration:3,repeat:1/0}})})})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{height:"calc(100vh - 120px)",minHeight:"600px"},className:"bewerbungstrainer-session-layout bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-2 lg:p-4 overflow-hidden",children:[s.jsxs("div",{className:"w-full h-full gap-3 lg:gap-4 overflow-hidden",style:{display:re?"flex":"grid",flexDirection:re?"column":void 0,gridTemplateColumns:re?void 0:"minmax(250px, 1fr) minmax(350px, 2fr) minmax(250px, 1fr)",gridTemplateRows:re?void 0:"1fr",alignItems:re?void 0:"stretch",padding:"0 8px"},children:[!re&&s.jsx(L.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"relative h-full",children:s.jsx(QI,{hints:t.coaching_hints})}),s.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex-1 flex flex-col min-h-[400px] order-1 lg:order-none",children:s.jsx("div",{className:"flex-1 overflow-y-auto",children:t.interviewer_profile&&t.interviewer_profile.name?s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{style:{background:a.headerGradient},className:"rounded-t-2xl px-4 lg:px-6 py-3 lg:py-4 shadow-xl",children:[re&&s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:t.interviewer_profile.name,className:"w-12 h-12 rounded-full border-2 border-white shadow-lg object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-white shadow-lg bg-white flex items-center justify-center",children:s.jsx(xt,{className:"w-6 h-6 text-slate-400"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-lg font-bold text-white",children:t.interviewer_profile.name}),t.interviewer_profile.role&&s.jsx("p",{className:"text-blue-100 text-xs font-medium",children:t.interviewer_profile.role})]})]}),!re&&s.jsxs("div",{children:[s.jsx("div",{className:"flex items-center justify-center gap-4 mb-4",children:t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:t.interviewer_profile.name,className:"w-20 h-20 rounded-full border-4 border-white shadow-lg object-cover"}):s.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white shadow-lg bg-white flex items-center justify-center",children:s.jsx(xt,{className:"w-10 h-10 text-slate-400"})})}),s.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-1",children:t.interviewer_profile.name}),t.interviewer_profile.role&&s.jsx("p",{className:"text-blue-100 text-center text-sm font-medium mb-3",children:t.interviewer_profile.role})]}),f&&s.jsxs("div",{className:"flex items-center justify-center gap-3 pt-3 border-t border-white/20",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[Ne.status==="connecting"&&s.jsxs(s.Fragment,{children:[s.jsx(ye,{className:"w-4 h-4 text-white animate-spin"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbinde..."})]}),Ne.status==="connected"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"}),s.jsx("span",{className:"text-sm font-semibold text-white",children:"Verbunden"})]})]}),s.jsx("div",{className:"h-4 w-px bg-white/30"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(He,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"font-mono text-sm font-semibold text-white",children:Ke(h)})]})]})]}),!f&&s.jsx("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-100",children:s.jsx(Sa,{selectedDeviceId:S,onDeviceChange:C,onTestClick:()=>w(!0)})}),s.jsx("div",{className:"bg-white px-4 py-3 shadow-xl flex justify-center",children:f?Ne.status==="connected"?s.jsxs(se,{onClick:()=>R(!0),size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg",children:[s.jsx(kn,{className:"w-5 h-5 mr-2"}),"Gesprch beenden"]}):Ne.status==="disconnected"?s.jsxs(se,{disabled:!0,size:"lg",className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg opacity-70 cursor-not-allowed",children:[s.jsx(ye,{className:"w-5 h-5 mr-2 animate-spin"}),"Gesprch wurde beendet..."]}):s.jsxs(se,{disabled:!0,size:"lg",className:"bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg opacity-50 cursor-not-allowed",children:[s.jsx(ye,{className:"w-5 h-5 mr-2 animate-spin"}),"Verbindung wird hergestellt..."]}):s.jsxs(se,{onClick:je,size:"lg",disabled:!S,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold text-base py-6 px-8 rounded-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(Xe,{className:"w-5 h-5 mr-2"}),t.interviewer_profile?.name?`${t.interviewer_profile.name} anrufen`:"Anrufen"]})}),re&&s.jsx("div",{className:"bg-white px-4 py-2",children:s.jsxs("button",{onClick:()=>le(!ie),className:"w-full flex items-center justify-between text-sm font-medium text-slate-700 hover:text-blue-600 transition-colors",children:[s.jsx("span",{children:"Profil-Details"}),s.jsx(jt,{className:`w-4 h-4 transition-transform ${ie?"rotate-180":""}`})]})}),s.jsx(Ve,{children:(ie||!re)&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"lg:flex-1 lg:overflow-y-auto bg-white lg:rounded-b-2xl shadow-xl overflow-hidden",children:s.jsx(ZI,{profile:t.interviewer_profile})})})]}):s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8 text-center",children:[s.jsx("div",{className:"w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center",style:{background:a.headerGradient},children:s.jsx(or,{className:"w-12 h-12",style:{color:a.headerText}})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:t.title}),s.jsx("p",{className:"text-slate-600 text-sm mb-6",children:t.description}),s.jsx("span",{className:`inline-block px-3 py-1 rounded-lg text-xs font-semibold ${Ye(t.difficulty)}`,children:si(t.difficulty)})]})})})}),!re&&s.jsx(L.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"h-full min-h-0 overflow-hidden",children:s.jsxs("div",{className:"h-full min-h-0 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col",children:[s.jsx("div",{style:{background:a.headerGradient},className:"px-4 py-3 flex items-center flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-2",style:{color:a.headerText},children:[s.jsx(ze,{className:"w-4 h-4"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]})}),s.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4 space-y-3",children:v.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(ze,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):s.jsxs(Ve,{children:[v.map((ne,Ee)=>s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:`flex gap-2 ${ne.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:ne.role==="agent"?t.interviewer_profile&&t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:t.interviewer_profile.name||"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:a.headerGradient},children:s.jsx(or,{className:"w-4 h-4",style:{color:a.headerText}})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(xt,{className:"w-4 h-4 text-white"})}),ne.timeLabel&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:ne.timeLabel})]})}),s.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${ne.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:s.jsx("p",{className:"text-xs leading-relaxed",children:ne.text})})]},Ee)),s.jsx("div",{ref:Le})]})})]})})]}),re&&s.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-3 z-50",children:[s.jsxs(L.button,{onClick:()=>D(!F),style:{background:a.headerGradient,color:a.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[s.jsx(Ce,{className:"w-6 h-6"}),t.coaching_hints&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-orange-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:t.coaching_hints.split(`
`).filter(Boolean).length})]}),s.jsxs(L.button,{onClick:()=>G(!B),style:{background:a.headerGradient,color:a.headerText},className:"w-14 h-14 rounded-full shadow-xl flex items-center justify-center relative",whileTap:{scale:.95},children:[s.jsx(ze,{className:"w-6 h-6"}),v.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center text-white",children:v.length})]})]}),s.jsx(Ve,{children:F&&re&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>D(!1),className:"fixed inset-0 bg-black/50 z-40"}),s.jsx(L.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 max-h-[70vh] rounded-t-3xl overflow-hidden",children:s.jsxs("div",{className:"bg-white h-full overflow-y-auto",children:[s.jsxs("div",{style:{background:a.headerGradient},className:"sticky top-0 px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:a.headerText},children:[s.jsx(Ce,{className:"w-5 h-5"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Coaching"})]}),s.jsx("button",{onClick:()=>D(!1),style:{color:a.headerText},children:s.jsx(kn,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-4 space-y-3",children:Us(t.coaching_hints).length===0?s.jsxs("div",{className:"text-center text-slate-400 py-8",children:[s.jsx(Ce,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),s.jsx("p",{className:"text-xs",children:"Tipps erscheinen hier whrend des Gesprchs"})]}):Us(t.coaching_hints).map((ne,Ee)=>s.jsxs(L.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Ee*.1},className:"flex gap-3 items-start p-3 rounded-lg",style:{backgroundColor:a.primaryAccentLight},children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",style:{backgroundColor:a.primaryAccentLight},children:s.jsx(Ce,{className:"w-3.5 h-3.5",style:{color:a.iconPrimary}})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:ne})})]},Ee))})]})})]})}),s.jsx(Ve,{children:B&&re&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>G(!1),className:"fixed inset-0 bg-black/50 z-40"}),s.jsx(L.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 max-h-[70vh] rounded-t-3xl overflow-hidden",children:s.jsxs("div",{className:"bg-white h-full flex flex-col",children:[s.jsxs("div",{style:{background:a.headerGradient},className:"px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:a.headerText},children:[s.jsx(ze,{className:"w-5 h-5"}),s.jsx("h3",{className:"font-bold text-sm",children:"Live Transkript"})]}),s.jsx("button",{onClick:()=>G(!1),style:{color:a.headerText},children:s.jsx(kn,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:v.length===0?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsxs("div",{className:"text-center text-slate-500",children:[s.jsx(ze,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),s.jsx("p",{className:"text-xs",children:"Nachrichten werden whrend des Gesprchs angezeigt"})]})}):s.jsxs(Ve,{children:[v.map((ne,Ee)=>s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:`flex gap-2 ${ne.role==="user"?"flex-row-reverse":"flex-row"}`,children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:ne.role==="agent"?t.interviewer_profile&&t.interviewer_profile.image_url?s.jsx("img",{src:t.interviewer_profile.image_url,alt:t.interviewer_profile.name||"Interviewer",className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm",style:{background:a.headerGradient},children:s.jsx(or,{className:"w-4 h-4",style:{color:a.headerText}})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(xt,{className:"w-4 h-4 text-white"})}),ne.timeLabel&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:ne.timeLabel})]})}),s.jsx("div",{className:`flex-1 px-3 py-2 rounded-xl shadow-sm ${ne.role==="agent"?"bg-slate-50 border border-slate-200":"bg-gradient-to-br from-teal-500 to-teal-600 text-white"}`,children:s.jsx("p",{className:"text-xs leading-relaxed",children:ne.text})})]},Ee)),s.jsx("div",{ref:Le})]})})]})})]})})]}),s.jsx(Kt,{open:N,onOpenChange:R,children:s.jsxs(Yt,{children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Gesprch beenden?"}),s.jsx(dn,{children:"Mchtest du das Rollenspiel wirklich beenden? Du erhltst anschlieend dein Feedback."})]}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>R(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:z,children:[s.jsx(Qn,{className:"w-4 h-4 mr-2"}),"Beenden & Feedback erhalten"]})]})]})}),_&&s.jsx(e_,{isOpen:_,onClose:de,feedbackContent:Y,audioAnalysisContent:$,isLoading:!1}),s.jsx(ka,{isOpen:j,onClose:()=>w(!1),deviceId:S})]})},n_={auftreten:dm,selbstbewusstsein:Dt,koerpersprache:xt,kommunikation:ze,professionalitaet:Dt,inhalt:Ce},Jn=(t,e=100,n)=>{const i=e===10?t*10:t;return i>=80?x.green[500]:i>=60?n:i>=40?x.amber[500]:x.red[500]},i_=(t,e)=>{const n=t;return n>=90?"Ausgezeichnet!":n>=80?"Sehr gut!":n>=70?"Gut!":n>=60?"Solide Leistung":n>=50?"Ausbaufhig":"Weiter ben!"},s_=({score:t,size:e=120,primaryAccent:n,isHeader:i=!1})=>{const r=Math.min(100,Math.max(0,t||0)),o=(e-12)/2,a=o*2*Math.PI,l=a-r/100*a,c=Jn(t,100,n);return s.jsxs("div",{style:{position:"relative",width:e,height:e},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r:o,fill:"none",stroke:i?"rgba(255,255,255,0.3)":x.slate[200],strokeWidth:10}),s.jsx(L.circle,{cx:e/2,cy:e/2,r:o,fill:"none",stroke:c,strokeWidth:10,strokeLinecap:"round",strokeDasharray:a,initial:{strokeDashoffset:a},animate:{strokeDashoffset:l},transition:{duration:1,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3.5,fontWeight:700,color:c},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:i?"#ffffff":x.slate[500]},children:"von 100"})]})]})},r_=({audioUrl:t,primaryAccent:e,durationHint:n})=>{const i=g.useRef(null),[r,o]=g.useState(!1),[a,l]=g.useState(0),[c,d]=g.useState(n||0),[u,h]=g.useState(!0),[p,m]=g.useState(null);g.useEffect(()=>{if(!t)return;h(!0),m(null),d(n||0);const j=new Audio;i.current=j;const w=()=>{const k=j.duration;k&&isFinite(k)&&k>0&&d(k),h(!1)},v=()=>{const k=j.duration;k&&isFinite(k)&&k>0&&d(k)},E=()=>{h(!1);const k=j.duration;k&&isFinite(k)&&k>0&&d(k)};return j.addEventListener("loadedmetadata",w),j.addEventListener("durationchange",v),j.addEventListener("canplaythrough",E),j.addEventListener("timeupdate",()=>l(j.currentTime)),j.addEventListener("play",()=>o(!0)),j.addEventListener("pause",()=>o(!1)),j.addEventListener("ended",()=>o(!1)),j.addEventListener("error",()=>{m("Audio nicht verfgbar"),h(!1)}),j.src=t,j.load(),()=>{j.pause(),j.removeEventListener("loadedmetadata",w),j.removeEventListener("durationchange",v),j.removeEventListener("canplaythrough",E),j.src=""}},[t,n]);const y=j=>{if(!j||!isFinite(j)||isNaN(j))return"0:00";const w=Math.floor(j/60),v=Math.floor(j%60);return`${w}:${v.toString().padStart(2,"0")}`},f=()=>{i.current&&(r?i.current.pause():i.current.play())},b=j=>{const w=j.currentTarget.getBoundingClientRect(),v=(j.clientX-w.left)/w.width;i.current&&(i.current.currentTime=v*c)},S=j=>{i.current&&(i.current.currentTime=Math.max(0,Math.min(i.current.currentTime+j,c)))};if(p)return s.jsxs("div",{style:{padding:"12px",background:x.slate[100],borderRadius:"10px",color:x.slate[500],fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ve,{size:16})," ",p]});if(!t)return null;const C=c>0?a/c*100:0;return s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`},children:[s.jsx("div",{onClick:b,style:{height:"8px",background:x.slate[200],borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${C}%`,height:"100%",background:e||"#0d9488",borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>S(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:x.slate[500]},children:s.jsx(hd,{size:20})}),s.jsx("button",{onClick:f,disabled:u,style:{width:"48px",height:"48px",borderRadius:"50%",background:e||"#0d9488",border:"none",cursor:u?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:u?.7:1},children:u?s.jsx(ye,{size:22,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):r?s.jsx(cd,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx($t,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>S(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:x.slate[500]},children:s.jsx(pd,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:x.slate[500]},children:[y(a)," / ",y(c)]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},o_=({sessionId:t,conversationId:e,primaryAccent:n})=>{const i=g.useRef(null),[r,o]=g.useState(!1),[a,l]=g.useState(!1),[c,d]=g.useState(0),[u,h]=g.useState(0),[p,m]=g.useState(null),[y,f]=g.useState(!0);g.useEffect(()=>{if(!e){f(!1),m("Keine Audio-Aufnahme verfgbar");return}const v=kd(t);return f(!0),m(null),fetch(v,{headers:{"X-WP-Nonce":mt()},credentials:"same-origin"}).then(E=>{if(!E.ok)throw new Error(`HTTP ${E.status}`);return E.blob()}).then(E=>{const k=URL.createObjectURL(E),T=new Audio(k);i.current=T,T._objectUrl=k,T.addEventListener("loadedmetadata",()=>{h(T.duration),f(!1)}),T.addEventListener("timeupdate",()=>d(T.currentTime)),T.addEventListener("play",()=>o(!0)),T.addEventListener("pause",()=>o(!1)),T.addEventListener("ended",()=>o(!1)),T.addEventListener("error",()=>{m("Audio konnte nicht abgespielt werden."),f(!1)})}).catch(()=>{m("Audio nicht verfgbar."),f(!1)}),()=>{i.current&&(i.current.pause(),i.current._objectUrl&&URL.revokeObjectURL(i.current._objectUrl),i.current=null)}},[t,e]);const b=v=>{const E=Math.floor(v/60),k=Math.floor(v%60);return`${E}:${k.toString().padStart(2,"0")}`},S=()=>{i.current&&(r?i.current.pause():i.current.play())},C=()=>{i.current&&(i.current.muted=!a,l(!a))},j=v=>{i.current&&(i.current.currentTime=Math.max(0,Math.min(i.current.currentTime+v,u)))},w=v=>{const E=v.currentTarget.getBoundingClientRect(),k=(v.clientX-E.left)/E.width;i.current&&(i.current.currentTime=k*u)};return y?s.jsxs("div",{style:{background:x.slate[100],borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ye,{size:24,color:n,style:{animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[500],marginTop:"8px"},children:"Audio wird geladen..."})]}):p?s.jsxs("div",{style:{background:x.slate[100],borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ve,{size:24,color:x.slate[400],style:{margin:"0 auto"}}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[500],marginTop:"8px"},children:p})]}):s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:x.slate[900],marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Xe,{size:18,color:n})," Gesprchsaufnahme"]}),s.jsx("div",{onClick:w,style:{height:"8px",background:x.slate[200],borderRadius:"4px",cursor:"pointer",marginBottom:"16px"},children:s.jsx("div",{style:{width:`${c/u*100||0}%`,height:"100%",background:n,borderRadius:"4px",transition:"width 0.1s"}})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"16px"},children:[s.jsx("button",{onClick:()=>j(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:x.slate[500]},children:s.jsx(hd,{size:20})}),s.jsx("button",{onClick:S,style:{width:"48px",height:"48px",borderRadius:"50%",background:n,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},children:r?s.jsx(cd,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2}):s.jsx($t,{size:22,color:"#ffffff",fill:"#ffffff",strokeWidth:2,style:{marginLeft:"2px"}})}),s.jsx("button",{onClick:()=>j(10),style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:x.slate[500]},children:s.jsx(pd,{size:20})}),s.jsx("button",{onClick:C,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",color:x.slate[500],marginLeft:"auto"},children:a?s.jsx(xm,{size:20}):s.jsx(Ci,{size:20})})]}),s.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"13px",color:x.slate[500]},children:[b(c)," / ",b(u)]})]})},a_=({entry:t,index:e,primaryAccent:n})=>{const i=t.role==="user";return s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",flexShrink:0,background:i?n:x.slate[300],display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(xt,{size:16,color:i?"#fff":x.slate[600]})}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:i?n:x.slate[500],marginBottom:"4px"},children:i?"Du":"Interviewer"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[700],lineHeight:1.6,margin:0},children:t.text||t.message})]})]})},l_=({answer:t,index:e,primaryAccent:n})=>{const[i,r]=g.useState(!1),o=t.feedback?typeof t.feedback=="string"?JSON.parse(t.feedback):t.feedback:null,a=t.audio_analysis?typeof t.audio_analysis=="string"?JSON.parse(t.audio_analysis):t.audio_analysis:null,l=t.transcript==="[Keine Sprache erkannt]"||a?.speech_rate==="keine_sprache";return s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:e*.05},style:{background:"#fff",borderRadius:"16px",border:`1px solid ${x.slate[200]}`,overflow:"hidden",marginBottom:"16px"},children:[s.jsxs("button",{onClick:()=>r(!i),style:{width:"100%",padding:"16px 20px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",textAlign:"left"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",color:n,fontWeight:700,fontSize:"14px",flexShrink:0},children:e+1}),s.jsx("div",{style:{flex:1,minWidth:0},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.question_text||`Frage ${e+1}`})}),t.overall_score!==null&&t.overall_score!==void 0&&s.jsx("span",{style:{fontSize:"16px",fontWeight:700,color:l?x.slate[400]:Jn(t.overall_score*10,100,n)},children:l?"":Math.round(t.overall_score*10)}),s.jsx(jt,{size:18,color:x.slate[400],style:{transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(Ve,{children:i&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 20px 20px",borderTop:`1px solid ${x.slate[200]}`,paddingTop:"16px"},children:[t.audio_url&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Xe,{size:14,color:n})," Deine Aufnahme"]}),s.jsx(r_,{audioUrl:t.audio_url,primaryAccent:n,durationHint:t.audio_duration_seconds})]}),t.transcript&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Tt,{size:14,color:n})," Transkript"]}),s.jsxs("p",{style:{fontSize:"13px",color:l?x.slate[400]:x.slate[600],lineHeight:1.6,background:x.slate[50],padding:"12px 16px",borderRadius:"10px",margin:0,fontStyle:"italic"},children:['"',t.transcript,'"']})]}),o?.scores&&!l&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Rt,{size:14,color:n})," Bewertung"]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"8px"},children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Prsentation"},{key:"overall",label:"Gesamt"}].map(({key:c,label:d})=>{const u=o.scores[c],h=u!=null?u*10:null;return s.jsxs("div",{style:{padding:"10px 8px",background:c==="overall"?`${n}15`:x.slate[50],borderRadius:"8px",textAlign:"center",border:c==="overall"?`1px solid ${n}30`:"none"},children:[s.jsx("div",{style:{fontSize:"16px",fontWeight:700,color:h!=null?Jn(h,100,n):x.slate[400]},children:h!=null?Math.round(h):"-"}),s.jsx("div",{style:{fontSize:"10px",color:x.slate[500],marginTop:"2px"},children:d})]},c)})})]}),o?.summary&&s.jsx("p",{style:{fontSize:"13px",color:x.slate[600],lineHeight:1.5,marginBottom:"12px"},children:o.summary}),o?.strengths?.length>0&&!l&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:x.green[500],marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Zt,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:x.slate[600],fontSize:"12px"},children:o.strengths.map((c,d)=>s.jsx("li",{style:{marginBottom:"4px"},children:c},d))})]}),o?.improvements?.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:x.amber[500],marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(ve,{size:12})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:x.slate[600],fontSize:"12px"},children:o.improvements.map((c,d)=>s.jsx("li",{style:{marginBottom:"4px"},children:c},d))})]}),o?.tips?.length>0&&!l&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:n,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ce,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",color:x.slate[600],fontSize:"12px"},children:o.tips.map((c,d)=>s.jsx("li",{style:{marginBottom:"4px"},children:c},d))})]}),a&&!l&&s.jsxs("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${x.slate[200]}`},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Xe,{size:14,color:n})," Sprechanalyse"]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:[a.speech_rate&&s.jsxs("div",{style:{padding:"12px",background:x.slate[50],borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],marginBottom:"4px"},children:"Sprechtempo"}),s.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700],textTransform:"capitalize"},children:a.speech_rate==="optimal"?" Optimal":a.speech_rate==="zu_schnell"?" Zu schnell":a.speech_rate==="zu_langsam"?" Zu langsam":a.speech_rate})]}),a.filler_words&&s.jsxs("div",{style:{padding:"12px",background:x.slate[50],borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],marginBottom:"4px"},children:"Fllwrter"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:a.filler_words.count<=2?x.green[500]:a.filler_words.count<=5?x.amber[500]:x.red[500]},children:[a.filler_words.count||0," erkannt"]}),a.filler_words.words?.length>0&&s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],marginTop:"4px"},children:a.filler_words.words.slice(0,5).join(", ")})]}),a.confidence_score!=null&&s.jsxs("div",{style:{padding:"12px",background:x.slate[50],borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],marginBottom:"4px"},children:"Selbstsicherheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Jn(a.confidence_score,100,n)},children:[a.confidence_score,"%"]})]}),a.clarity_score!=null&&s.jsxs("div",{style:{padding:"12px",background:x.slate[50],borderRadius:"10px"},children:[s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Jn(a.clarity_score,100,n)},children:[a.clarity_score,"%"]})]})]}),a.notes&&s.jsx("p",{style:{fontSize:"12px",color:x.slate[500],marginTop:"10px",fontStyle:"italic"},children:a.notes})]})]})})})]})},c_=({isOpen:t,onClose:e,onConfirm:n,isDeleting:i,primaryAccent:r})=>t?s.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:e,children:s.jsxs(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:o=>o.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:x.red[100],display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(pn,{size:24,color:x.red[500]})}),s.jsx("div",{children:s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900],margin:0},children:"Session lschen?"})})]}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],lineHeight:1.6,marginBottom:"24px"},children:"Mchtest du diese Session wirklich lschen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:e,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:`1px solid ${x.slate[300]}`,backgroundColor:"white",color:x.slate[700],fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",opacity:i?.5:1},children:"Abbrechen"}),s.jsx("button",{onClick:n,disabled:i,style:{padding:"10px 20px",borderRadius:"10px",border:"none",backgroundColor:x.red[500],color:"white",fontSize:"14px",fontWeight:500,cursor:i?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",opacity:i?.7:1},children:i?s.jsxs(s.Fragment,{children:[s.jsx(ye,{size:16,style:{animation:"spin 1s linear infinite"}}),"Lschen..."]}):s.jsxs(s.Fragment,{children:[s.jsx(pn,{size:16}),"Lschen"]})})]})]})}):null,d_=({category:t,primaryAccent:e})=>{const[n,i]=g.useState(!1),r=n_[t.category]||Rt,o=Jn(t.score,100,e);return s.jsxs("div",{style:{background:"#fff",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,overflow:"hidden",marginBottom:"10px"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",background:`${o}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(r,{size:18,color:o})}),s.jsx("div",{style:{flex:1,textAlign:"left"},children:s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],margin:0},children:t.label})}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:700,color:o},children:[Math.round(t.score),"%"]}),s.jsx(jt,{size:18,color:x.slate[400],style:{transform:n?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(Ve,{children:n&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:`1px solid ${x.slate[200]}`,paddingTop:"12px"},children:[t.feedback&&s.jsx("p",{style:{fontSize:"13px",color:x.slate[600],lineHeight:1.5,marginBottom:"10px"},children:t.feedback}),t.strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"10px"},children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:x.green[500],marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Zt,{size:12})," Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:x.slate[600]},children:t.strengths.map((a,l)=>s.jsx("li",{children:a},l))})]}),t.improvements?.length>0&&s.jsxs("div",{children:[s.jsxs("h6",{style:{fontSize:"12px",fontWeight:600,color:x.amber[500],marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ce,{size:12})," Tipps"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"18px",fontSize:"12px",color:x.slate[600]},children:t.improvements.map((a,l)=>s.jsx("li",{children:a},l))})]})]})})})]})},u_=({session:t,type:e,scenario:n,onBack:i,onContinueSession:r,onRepeatSession:o,onDeleteSession:a})=>{const{branding:l}=ge(),c=l?.["--header-gradient"]||Q["--header-gradient"],d=l?.["--primary-accent"]||Q["--primary-accent"],[u,h]=g.useState([]),[p,m]=g.useState(!0),[y,f]=g.useState(null),[b,S]=g.useState(!1),[C,j]=g.useState(!1),[w,v]=g.useState(null),[E,k]=g.useState(n),T=e==="video",N=e==="simulator",R=e==="roleplay",_=(()=>{const B=t?.questions||t?.questions_json;if(!B)return!1;try{const G=typeof B=="string"?JSON.parse(B):B;return Array.isArray(G)&&G.length>0}catch{return!1}})(),A=(()=>{if(!N||!_)return!1;const B=t?.total_questions||0,G=t?.completed_questions||0;return B>0&&G<B})(),Y=async()=>{if(a){j(!0);try{await a(t,e)}catch(B){console.error("Failed to delete session:",B),j(!1),S(!1)}}};g.useEffect(()=>{N&&t?.id?H():R&&t?.id?$():m(!1)},[t?.id,e]);const H=async()=>{try{m(!0);const G=await(await fetch(`${Pn()}/simulator/sessions/${t.id}/answers`,{headers:{"X-WP-Nonce":mt()}})).json();G.success&&G.data?.answers?h(G.data.answers):Array.isArray(G.data)&&h(G.data)}catch(B){console.error("Failed to load answers:",B),f("Fehler beim Laden der Antworten")}finally{m(!1)}},$=async()=>{try{m(!0);const B=await wx(t.id);if(v({...t,...B,feedback:vx(B.feedback_json||t.feedback_json),audioAnalysis:Sx(B.audio_analysis_json||t.audio_analysis_json),transcript:kx(B.transcript||t.transcript)}),!n&&B.scenario_id)try{const G=await jx(B.scenario_id);k(G)}catch(G){console.warn("Could not load scenario:",G)}}catch(B){console.error("Failed to load roleplay data:",B),f("Fehler beim Laden der Gesprchsdaten")}finally{m(!1)}},K=t?.summary_feedback_json?typeof t.summary_feedback_json=="string"?JSON.parse(t.summary_feedback_json):t.summary_feedback_json:null,O=t?.category_scores||[],P=t?.analysis||{},D=(()=>{let B=0;return R&&w?.feedback?.rating?.overall?B=w.feedback.rating.overall:B=t?.overall_score||K?.overall_score||0,(N||R)&&B<=10?B*10:B})();return p?s.jsxs("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(ye,{size:48,color:d,style:{animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{color:x.slate[500],marginTop:"16px"},children:"Analyse wird geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):y?s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:"24px"},children:[s.jsx(ve,{size:48,color:x.red[500],style:{margin:"0 auto 16px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:x.slate[900],marginBottom:"8px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:x.slate[600],marginBottom:"24px"},children:y}),s.jsx("button",{onClick:i,style:{padding:"12px 24px",borderRadius:"10px",background:x.slate[100],border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Zurck"})]})}):s.jsxs("div",{style:{padding:"24px"},children:[s.jsx("style",{children:`
        .detail-grid { display: grid; grid-template-columns: 1fr 400px; gap: 24px; padding: 0 24px; }
        @media (max-width: 900px) { .detail-grid { grid-template-columns: 1fr; } }
      `}),s.jsxs("div",{style:{margin:"0 0 24px",padding:"0 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",background:x.slate[100],border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500,color:x.slate[700],transition:"all 0.2s"},onMouseEnter:B=>{B.currentTarget.style.background=x.slate[200]},onMouseLeave:B=>{B.currentTarget.style.background=x.slate[100]},children:[s.jsx(pt,{size:18}),"Zurck zur bersicht"]}),N&&a&&s.jsxs("button",{onClick:()=>S(!0),style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",background:x.red[100],border:"none",cursor:"pointer",fontSize:"14px",fontWeight:500,color:x.red[500],transition:"all 0.2s"},onMouseEnter:B=>{B.currentTarget.style.background=x.red[500],B.currentTarget.style.color="white"},onMouseLeave:B=>{B.currentTarget.style.background=x.red[100],B.currentTarget.style.color=x.red[500]},children:[s.jsx(pn,{size:18}),"Session lschen"]})]}),s.jsxs("div",{className:"detail-grid",children:[s.jsxs("div",{children:[s.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:c,borderRadius:"20px",padding:"24px",marginBottom:"20px",color:"#fff"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[s.jsx(s_,{score:D,size:100,primaryAccent:"#fff",isHeader:!0}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",opacity:.9},children:[T?s.jsx(ht,{size:16}):R?s.jsx(ze,{size:16}):s.jsx(De,{size:16}),s.jsx("span",{style:{fontSize:"13px",fontWeight:500},children:T?"Wirkungs-Analyse":R?"Live-Simulation":"Szenario-Training"})]}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:700,margin:"0 0 6px 0"},children:(R?E?.title:n?.title)||t?.scenario_title||t?.position||"Training"}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,margin:"0 0 8px 0",opacity:.9},children:i_(D)}),s.jsx("div",{style:{display:"flex",gap:"12px",fontSize:"12px",opacity:.8},children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(He,{size:12}),new Date(t.created_at).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})})]})]})}),T&&t?.video_url&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:x.slate[900],marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ht,{size:18,color:d})," Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),N&&u.length>0&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[s.jsxs("h3",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900],marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ze,{size:18,color:d})," Deine Antworten (",u.length,")"]}),u.map((B,G)=>s.jsx(l_,{answer:B,index:G,primaryAccent:d},B.id||G)),A&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px",padding:"20px",background:x.slate[50],borderRadius:"12px",border:`1px dashed ${x.slate[300]}`},children:[s.jsx("p",{style:{width:"100%",textAlign:"center",color:x.slate[600],fontSize:"14px",marginBottom:"12px"},children:"Diese Session ist noch nicht abgeschlossen."}),r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:d,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${d}4d`},children:[s.jsx(hh,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${x.slate[300]}`,background:"white",color:x.slate[700],fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:18}),"Erneut starten"]})]})]}),N&&u.length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",background:x.slate[100],borderRadius:"16px"},children:[s.jsx(ve,{size:48,color:x.slate[400],style:{margin:"0 auto 16px"}}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:x.slate[700],marginBottom:"8px"},children:"Keine Antworten vorhanden"}),s.jsx("p",{style:{color:x.slate[500],marginBottom:_?"24px":"0"},children:_?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),A&&(r||o)&&s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap",marginTop:"24px"},children:[r&&s.jsxs("button",{onClick:()=>r(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:"none",background:d,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${d}4d`},children:[s.jsx(hh,{size:18}),"Fortsetzen"]}),o&&s.jsxs("button",{onClick:()=>o(t,n),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"12px 24px",borderRadius:"12px",border:`2px solid ${x.slate[300]}`,background:"white",color:x.slate[700],fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:18}),"Erneut starten"]})]})]}),R&&w&&s.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{marginBottom:"20px"},children:s.jsx(o_,{sessionId:t.id,conversationId:w.conversation_id,primaryAccent:d})}),R&&w?.transcript?.length>0&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:x.slate[900],marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Tt,{size:18,color:d})," Gesprchsverlauf"]}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:w.transcript.map((B,G)=>s.jsx(a_,{entry:B,index:G,primaryAccent:d},G))})]})]}),s.jsxs("div",{children:[T&&O.length>0&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{marginBottom:"20px"},children:[s.jsxs("h3",{style:{fontSize:"15px",fontWeight:600,color:x.slate[900],marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Rt,{size:16,color:d})," Detaillierte Bewertung"]}),O.map((B,G)=>s.jsx(d_,{category:B,primaryAccent:d},B.category||G))]}),T&&(P.key_strengths?.length>0||P.actionable_tips?.length>0)&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[P.key_strengths?.length>0&&s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:x.green[500],marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Zt,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:P.key_strengths.map((B,G)=>s.jsx("li",{style:{fontSize:"13px",color:x.slate[600],marginBottom:"6px",lineHeight:1.4},children:B},G))})]}),P.actionable_tips?.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:d,marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ce,{size:16})," Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:P.actionable_tips.map((B,G)=>s.jsx("li",{style:{fontSize:"13px",color:x.slate[600],marginBottom:"6px",lineHeight:1.4},children:B},G))})]})]}),T&&t?.summary_feedback&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{background:x.slate[100],borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[600],lineHeight:1.6,margin:0},children:t.summary_feedback})]}),N&&K&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[K.summary&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[600],lineHeight:1.6,margin:0},children:K.summary})]}),K.scores&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],marginBottom:"12px"},children:"Bewertung"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px"},children:Object.entries(K.scores).map(([B,G])=>{const ie=G!=null?G*10:null;return s.jsxs("div",{style:{padding:"12px",background:x.slate[50],borderRadius:"10px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:Jn(ie,100,d)},children:ie!=null?Math.round(ie):"-"}),s.jsx("div",{style:{fontSize:"11px",color:x.slate[500],textTransform:"capitalize"},children:B})]},B)})})]}),K.key_takeaways?.length>0&&s.jsxs("div",{style:{background:x.green[100],borderRadius:"16px",padding:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:x.green[500],marginBottom:"10px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ce,{size:16})," Wichtigste Erkenntnisse"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"13px",color:x.slate[700],lineHeight:1.5},children:K.key_takeaways.map((B,G)=>s.jsx("li",{style:{marginBottom:"6px"},children:B},G))})]})]}),R&&w?.feedback&&s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[w.feedback.rating&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"15px",fontWeight:600,color:x.slate[900],marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Rt,{size:16,color:d})," Bewertungskriterien"]}),s.jsx("div",{style:{display:"grid",gap:"10px"},children:Object.entries(w.feedback.rating).filter(([B])=>B!=="overall").map(([B,G])=>{const ie=G*10;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:x.slate[50],borderRadius:"10px"},children:[s.jsx("div",{style:{flex:1,fontSize:"13px",fontWeight:500,color:x.slate[700],textTransform:"capitalize"},children:B.replace(/_/g," ")}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{width:"80px",height:"6px",background:x.slate[200],borderRadius:"3px"},children:s.jsx("div",{style:{width:`${ie}%`,height:"100%",background:Jn(ie,100,d),borderRadius:"3px"}})}),s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:Jn(ie,100,d),minWidth:"45px"},children:Math.round(ie)})]})]},B)})})]}),w.feedback.strengths?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:x.green[500],marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Zt,{size:16})," Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:w.feedback.strengths.map((B,G)=>s.jsx("li",{style:{fontSize:"13px",color:x.slate[600],marginBottom:"8px",lineHeight:1.5},children:B},G))})]}),w.feedback.improvements?.length>0&&s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:`1px solid ${x.slate[200]}`,marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,color:x.amber[500],marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Ce,{size:16})," Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:w.feedback.improvements.map((B,G)=>s.jsx("li",{style:{fontSize:"13px",color:x.slate[600],marginBottom:"8px",lineHeight:1.5},children:B},G))})]}),w.feedback.summary&&s.jsxs("div",{style:{background:x.slate[100],borderRadius:"16px",padding:"20px"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:x.slate[900],marginBottom:"10px"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"13px",color:x.slate[600],lineHeight:1.6,margin:0},children:w.feedback.summary})]})]}),R&&!w?.feedback&&s.jsxs("div",{style:{background:x.slate[100],borderRadius:"16px",padding:"24px",textAlign:"center"},children:[s.jsx(ve,{size:32,color:x.slate[400],style:{margin:"0 auto 12px"}}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[500],margin:0},children:"Keine Analyse verfgbar fr dieses Gesprch."})]})]})]}),s.jsx(c_,{isOpen:b,onClose:()=>S(!1),onConfirm:Y,isDeleting:C,primaryAccent:d})]})},h_={"file-text":Tt,briefcase:Qt,banknote:ni,users:un,user:xt,"message-circle":Ei,target:De,award:Dt,book:Fr,clipboard:Br,star:Rt,lightbulb:Ce,shield:Hi,compass:zr,rocket:Ln},p_={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprchsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprchsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fhigkeiten",strengths:"Strken",challenges:"Herausforderungen"},f_=t=>p_[t]||t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),g_=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",jc=(t,e)=>{if(!t)return null;const n=[];let i=t,r=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),a=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),l=i.match(/`([^`]+)`/),c=[{match:o,type:"bold"},{match:a,type:"italic"},{match:l,type:"code"}].filter(u=>u.match);if(c.length===0){n.push(i);break}const d=c.reduce((u,h)=>(u.match?.index??1/0)<(h.match?.index??1/0)?u:h);switch(d.match.index>0&&n.push(i.substring(0,d.match.index)),d.type){case"bold":n.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:d.match[1]},r++));break;case"italic":n.push(s.jsx("em",{style:{fontStyle:"italic"},children:d.match[1]||d.match[2]},r++));break;case"code":n.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:d.match[1]},r++));break}i=i.substring(d.match.index+d.match[0].length)}return n},Ry=({content:t,primaryAccent:e})=>{if(!t)return null;const n=i=>{const r=i.split(`
`),o=[];let a=[],l=null;const c=()=>{a.length>0&&(o.push(s.jsx("ul",{style:{margin:"8px 0",paddingLeft:"20px",listStyle:"none"},children:a.map((d,u)=>s.jsxs("li",{style:{marginBottom:"6px",fontSize:"14px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"16px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:l==="number"?`${u+1}.`:""}),jc(d,e)]},u))},`list-${o.length}`)),a=[],l=null)};return r.forEach((d,u)=>{const h=d.trim();if(!h){c();return}if(h.startsWith("- ")||h.startsWith("* ")){l!=="bullet"&&(c(),l="bullet"),a.push(h.substring(2));return}const p=h.match(/^(\d+)\.\s/);if(p){l!=="number"&&(c(),l="number"),a.push(h.substring(p[0].length));return}c(),o.push(s.jsx("p",{style:{margin:"8px 0",fontSize:"14px",lineHeight:1.6,color:"#374151"},children:jc(h,e)},`p-${u}`))}),c(),o};return s.jsx("div",{children:n(t)})},pf=({item:t,sectionId:e,primaryAccent:n,onUpdateItem:i})=>{const[r,o]=g.useState(t.user_note||""),[a,l]=g.useState(!1),[c,d]=g.useState(!1),[u,h]=g.useState(!1),[p,m]=g.useState(!!t.user_note);g.useEffect(()=>{h(r!==(t.user_note||""))},[r,t.user_note]);const y=async()=>{l(!0);try{await i(e,t.id,{user_note:r}),d(!0),h(!1),setTimeout(()=>d(!1),2e3)}catch(S){console.error("Error saving note:",S)}finally{l(!1)}},f=async()=>{try{await i(e,t.id,{deleted:!0})}catch(S){console.error("Error deleting item:",S)}},b=async()=>{try{await i(e,t.id,{deleted:!1})}catch(S){console.error("Error restoring item:",S)}};return t.deleted?s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#f8fafc",borderRadius:"10px",marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:.6},children:[s.jsxs("span",{style:{fontSize:"14px",color:"#94a3b8",fontStyle:"italic"},children:[s.jsx("s",{children:t.label})," - gelscht"]}),s.jsxs("button",{onClick:b,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",borderRadius:"6px",border:"none",backgroundColor:"#e2e8f0",color:"#64748b",fontSize:"12px",cursor:"pointer"},children:[s.jsx(Si,{size:12}),"Wiederherstellen"]})]}):s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",border:"1px solid #e2e8f0",marginBottom:"10px",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"14px 16px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:n,flexShrink:0}}),s.jsx("h4",{style:{fontSize:"14px",fontWeight:600,color:"#0f172a",margin:0},children:t.label})]}),t.content&&s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 0 14px",lineHeight:1.5},children:jc(t.content,n)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",flexShrink:0},children:[t.user_note&&!p&&s.jsx("span",{style:{fontSize:"11px",color:n,backgroundColor:`${n}15`,padding:"2px 6px",borderRadius:"4px"},children:"Notiz"}),s.jsx("button",{onClick:()=>m(!p),title:"Notiz hinzufgen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:p?`${n}15`:"transparent",color:p?n:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(fm,{size:16})}),s.jsx("button",{onClick:f,title:"Lschen",style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(pn,{size:16})})]})]}),p&&s.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fafbfc",borderTop:"1px solid #f1f5f9"},children:[s.jsx("textarea",{value:r,onChange:S=>o(S.target.value),placeholder:"Deine Notiz zu diesem Punkt...",style:{width:"100%",minHeight:"60px",padding:"10px",borderRadius:"8px",border:"1px solid #e2e8f0",fontSize:"13px",color:"#374151",resize:"vertical",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:S=>{S.target.style.borderColor=n},onBlur:S=>{S.target.style.borderColor="#e2e8f0"}}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"8px",gap:"8px"},children:[s.jsx("button",{onClick:()=>{m(!1),o(t.user_note||"")},style:{padding:"6px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#64748b",fontSize:"12px",cursor:"pointer"},children:"Abbrechen"}),s.jsxs("button",{onClick:y,disabled:a||!u,style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:c?"#dcfce7":u?n:"#f1f5f9",color:c?"#16a34a":u?"white":"#94a3b8",fontSize:"12px",fontWeight:500,cursor:u&&!a?"pointer":"default"},children:[a?s.jsx(ye,{size:12,style:{animation:"spin 1s linear infinite"}}):c?s.jsx(Es,{size:12}):s.jsx($k,{size:12}),c?"Gespeichert!":"Speichern"]})]})]}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},m_=({section:t,primaryAccent:e,onUpdateItem:n,onGenerateMore:i,isExpanded:r,onToggle:o})=>{const[a,l]=g.useState(!1),c=async()=>{l(!0);try{await i(t.id)}catch(b){console.error("Error generating more items:",b)}finally{l(!1)}},d=g.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const b=JSON.parse(t.ai_content);if(b&&Array.isArray(b.items))return{type:"items",items:b.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:u,items:h,content:p}=d(),m=h.filter(b=>!b.deleted),y=h.filter(b=>b.deleted),f=h.some(b=>b.user_note&&!b.deleted);return s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden",marginBottom:"16px"},children:[s.jsxs("button",{onClick:o,style:{width:"100%",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",background:"none",cursor:"pointer",borderBottom:r?"1px solid #f1f5f9":"none"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0,textAlign:"left"},children:t.section_title}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u==="items"&&s.jsxs("span",{style:{fontSize:"12px",color:"#94a3b8",backgroundColor:"#f1f5f9",padding:"4px 8px",borderRadius:"12px"},children:[m.length," Punkte"]}),f&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:e,backgroundColor:`${e}15`,padding:"4px 8px",borderRadius:"12px"},children:[s.jsx(fm,{size:12}),"Notizen"]}),r?s.jsx(ar,{size:20,style:{color:"#94a3b8"}}):s.jsx(jt,{size:20,style:{color:"#94a3b8"}})]})]}),r&&s.jsx("div",{style:{padding:"16px 20px"},children:u==="items"?s.jsxs(s.Fragment,{children:[m.map(b=>s.jsx(pf,{item:b,sectionId:t.id,primaryAccent:e,onUpdateItem:n},b.id)),i&&s.jsx("button",{onClick:c,disabled:a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px 16px",marginTop:"12px",marginBottom:"8px",borderRadius:"10px",border:`1px dashed ${e}40`,backgroundColor:`${e}08`,color:e,fontSize:"13px",fontWeight:500,cursor:a?"wait":"pointer",transition:"all 0.2s"},onMouseEnter:b=>{a||(b.currentTarget.style.backgroundColor=`${e}15`,b.currentTarget.style.borderColor=`${e}60`)},onMouseLeave:b=>{b.currentTarget.style.backgroundColor=`${e}08`,b.currentTarget.style.borderColor=`${e}40`},children:a?s.jsxs(s.Fragment,{children:[s.jsx(ye,{size:16,style:{animation:"spin 1s linear infinite"}}),"Generiere 5 weitere Punkte..."]}):s.jsxs(s.Fragment,{children:[s.jsx(st,{size:16}),"5 weitere Punkte generieren"]})}),y.length>0&&s.jsxs("div",{style:{marginTop:"16px"},children:[s.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(pn,{size:12}),y.length," gelschte ",y.length===1?"Punkt":"Punkte"]}),y.map(b=>s.jsx(pf,{item:b,sectionId:t.id,primaryAccent:e,onUpdateItem:n},b.id))]})]}):u==="markdown"?s.jsxs("div",{style:{backgroundColor:"#f8fafc",padding:"16px",borderRadius:"10px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx(or,{size:16,style:{color:e}}),s.jsx("span",{style:{fontSize:"12px",fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.5px"},children:"KI-Empfehlung"})]}),s.jsx(Ry,{content:p,primaryAccent:e})]}):s.jsx("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"Kein Inhalt verfgbar"})})]})},Iy=({briefing:t,onBack:e})=>{const{config:n}=ge(),[i,r]=g.useState(t),[o,a]=g.useState(!t?.sections),[l,c]=g.useState(null),[d,u]=g.useState({}),h=n?.buttonGradientStart||"#3A7FA7",p=h_[i?.template_icon]||Tt;g.useEffect(()=>{const b=async()=>{if(i?.sections){const S={};i.sections.forEach(C=>{S[C.id]=!0}),u(S),a(!1);return}try{a(!0);const S=await fe.request(`/smartbriefing/briefings/${i.id}`,{method:"GET"});if(S.success&&S.data?.briefing){r(S.data.briefing);const C={};S.data.briefing.sections?.forEach(j=>{C[j.id]=!0}),u(C)}else throw new Error("Fehler beim Laden des Briefings")}catch(S){console.error("[SmartBriefing] Error fetching briefing:",S),c(S.message)}finally{a(!1)}};i?.id&&b()},[i?.id]);const m=g.useCallback(b=>{u(S=>({...S,[b]:!S[b]}))},[]),y=g.useCallback(async(b,S,C)=>{const j=await fe.request(`/smartbriefing/sections/${b}/items/${S}`,{method:"PATCH",body:JSON.stringify(C)});if(!j.success)throw new Error("Fehler beim Speichern");r(w=>({...w,sections:w.sections.map(v=>v.id===b?j.data.section:v)}))},[]),f=g.useCallback(async b=>{const S=await fe.request(`/smartbriefing/sections/${b}/generate-more`,{method:"POST"});if(!S.success)throw new Error(S.message||"Fehler beim Generieren");return r(C=>({...C,sections:C.sections.map(j=>j.id===b?S.data.section:j)})),S.data.new_items_count},[]);return i?s.jsxs("div",{style:{padding:"24px",maxWidth:"900px",margin:"0 auto"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:"24px"},children:[s.jsx(pt,{size:18}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",marginBottom:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",flex:1},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`linear-gradient(135deg, ${h}15, ${h}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(p,{size:28,style:{color:h}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h1",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0",overflow:"hidden",textOverflow:"ellipsis"},children:i.title||"Briefing"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:i.template_title}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#94a3b8"},children:[s.jsx(qi,{size:12}),g_(i.created_at)]})]})]})]})}),i.variables&&Object.keys(i.variables).length>0&&s.jsx("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f1f5f9",display:"flex",flexWrap:"wrap",gap:"8px"},children:Object.entries(i.variables).map(([b,S])=>s.jsxs("span",{style:{backgroundColor:"#f1f5f9",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",color:"#64748b"},children:[s.jsxs("strong",{style:{color:"#374151"},children:[f_(b),":"]})," ",S]},b))})]}),o&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(ye,{size:40,style:{color:h,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefing wird geladen..."})]}),l&&!o&&s.jsx("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",textAlign:"center"},children:s.jsx("p",{style:{color:"#dc2626",margin:0},children:l})}),!o&&!l&&i.sections&&s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx(st,{size:18,style:{color:h}}),s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:"Briefing-Inhalte"}),s.jsxs("span",{style:{fontSize:"13px",color:"#94a3b8"},children:["(",i.sections.length," Abschnitte)"]})]}),i.sections.map(b=>s.jsx(m_,{section:b,primaryAccent:h,onUpdateItem:y,onGenerateMore:f,isExpanded:d[b.id],onToggle:()=>m(b.id)},b.id))]}),!o&&!l&&(!i.sections||i.sections.length===0)&&i.content_markdown&&s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsx(Ry,{content:i.content_markdown,primaryAccent:h})}),s.jsx("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${h}08`,borderRadius:"12px",border:`1px solid ${h}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ce,{size:18,style:{color:h,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"Tipp: Personalisiere dein Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.5},children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufgen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):null};console.log(" [SESSION_HISTORY] SessionHistory module loaded");const he={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings"},x_=[{id:he.BRIEFINGS,label:"Smart Briefings",icon:st},{id:he.SIMULATOR,label:"Szenario-Training",icon:De},{id:he.VIDEO,label:"Wirkungs-Analyse",icon:ht},{id:he.ROLEPLAY,label:"Live-Simulationen",icon:ze}],_y=({isOpen:t,onClose:e,onConfirm:n,title:i,description:r,isDeleting:o})=>{const{branding:a}=ge(),l=a?.["--primary-accent"]||Q["--primary-accent"];return s.jsx(Kt,{open:t,onOpenChange:e,children:s.jsxs(Yt,{style:{maxWidth:"400px"},children:[s.jsxs(Jt,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(pn,{style:{width:"20px",height:"20px",color:"#fff"}})}),s.jsx(Xt,{children:i||"Lschen besttigen"})]}),s.jsx(dn,{children:r||"Diese Aktion kann nicht rckgngig gemacht werden."})]}),s.jsxs(cn,{style:{marginTop:"16px"},children:[s.jsx("button",{onClick:e,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:`2px solid ${l}`,backgroundColor:"white",color:l,fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s"},children:"Abbrechen"}),s.jsx("button",{onClick:n,disabled:o,style:{minWidth:"100px",height:"40px",padding:"8px 20px",borderRadius:"8px",border:"none",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",fontSize:"14px",fontWeight:500,cursor:o?"not-allowed":"pointer",opacity:o?.5:1,transition:"all 0.2s",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:o?s.jsxs(s.Fragment,{children:[s.jsx(ye,{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"}}),"Lschen..."]}):"Lschen"})]})]})})},y_={"file-text":Tt,briefcase:Qt,banknote:ni,users:un},b_=({briefing:t,onClick:e,onDelete:n,headerGradient:i,headerText:r,primaryAccent:o})=>{const[a,l]=g.useState(!1),[c,d]=g.useState(!1),u=y=>y?new Date(y).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",h=y_[t.template_icon]||Tt,p=y=>{y.stopPropagation(),d(!0)},m=async()=>{l(!0);try{await n(t.id),d(!1)}catch(y){console.error("Error deleting briefing:",y)}finally{l(!1)}};return s.jsxs(L.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:e,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:y=>{y.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",y.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:y=>{y.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",y.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:`linear-gradient(135deg, ${o}15, ${o}30)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(h,{style:{width:"24px",height:"24px",color:o}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.title||"Briefing"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsx("span",{style:{backgroundColor:`${o}15`,color:o,padding:"2px 8px",borderRadius:"10px",fontSize:"12px",fontWeight:500},children:t.template_title}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(qi,{size:14}),u(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[s.jsx("button",{onClick:p,disabled:a,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Lschen",children:a?s.jsx(ye,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(pn,{size:18})}),s.jsx(It,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(_y,{isOpen:c,onClose:()=>d(!1),onConfirm:m,title:"Briefing lschen",description:"Mchtest du dieses Briefing wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:a})]})},v_=({session:t,type:e,scenario:n,onClick:i,onContinueSession:r,onDeleteSession:o,headerGradient:a,headerText:l,primaryAccent:c})=>{const[d,u]=g.useState(!1),[h,p]=g.useState(!1),[m,y]=g.useState(window.innerWidth<768);g.useEffect(()=>{const O=()=>y(window.innerWidth<768);return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]);const f=O=>O?new Date(O).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",b=O=>{if(!O)return"-";const P=Math.floor(O/60),F=O%60;return`${P}:${F.toString().padStart(2,"0")}`},S=()=>{let O=null;if(e===he.SIMULATOR)O=t.overall_score||t.average_score;else if(e===he.VIDEO)O=t.overall_score;else if(t.feedback_json)try{let P=t.feedback_json;if(typeof P=="string"){let F=P.trim();F.startsWith("```json")?F=F.replace(/```json\s*/g,"").replace(/```\s*$/g,""):F.startsWith("```")&&(F=F.replace(/```\s*/g,"").replace(/```\s*$/g,"")),P=JSON.parse(F)}O=P.rating?.overall||null}catch{O=null}return O==null||isNaN(O)||O===0?null:O},C=()=>e===he.SIMULATOR||e===he.VIDEO?t.status:t.feedback_json?"completed":"pending",j=S(),v=C()==="completed",E=t.total_questions>0&&(t.completed_questions||0)<t.total_questions,k=e===he.SIMULATOR&&E,T=()=>{if(!k)return null;const O=t.completed_questions||0,P=t.total_questions||0;return`${O}/${P} Fragen`},N=O=>{O.stopPropagation(),r&&r(t,n)},R=O=>{O.stopPropagation(),p(!0)},_=async()=>{u(!0);try{await o(t,e),p(!1)}catch(O){console.error("Error deleting session:",O)}finally{u(!1)}},Y=(()=>{if(j==null||isNaN(j))return null;if(e===he.SIMULATOR||e===he.ROLEPLAY){const O=j<=10?j*10:j;return isNaN(O)?null:O}return isNaN(j)?null:j})(),H=O=>{if(!O&&O!==0)return{background:"#f1f5f9",color:"#64748b"};const P=parseFloat(O);return P>=80?{background:"#dcfce7",color:"#166534"}:P>=60?{background:"#fef9c3",color:"#854d0e"}:{background:"#fee2e2",color:"#991b1b"}},K=(()=>{switch(e){case he.SIMULATOR:return De;case he.VIDEO:return ht;default:return ze}})();return m?s.jsx(L.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:s.jsxs("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"16px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(K,{style:{width:"22px",height:"22px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"4px",lineHeight:"1.3"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:f(t.created_at)})]}),o&&s.jsx("button",{onClick:R,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"Lschen",children:d?s.jsx(ye,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(pn,{size:18})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"8px",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[!v&&!k&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(He,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"5px 10px",borderRadius:"20px",fontSize:"13px",fontWeight:600,...H(Y)},children:[s.jsx(Rt,{size:13}),Y!==null?`${Math.round(Y)}%`:"-- %"]}),(t.duration||t.video_duration_seconds)&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#64748b"},children:[s.jsx(He,{size:12}),b(t.duration||t.video_duration_seconds)]}),k&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:T()})]}),k&&r?s.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,flexShrink:0},children:[s.jsx($t,{size:14}),"Fortsetzen"]}):s.jsx(It,{size:22,style:{color:"#94a3b8",flexShrink:0}})]})]})}):s.jsxs(L.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[s.jsx("div",{onClick:i,style:{background:"#fff",borderRadius:"16px",padding:"20px",cursor:"pointer",border:"1px solid #e2e8f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",transition:"all 0.2s"},onMouseEnter:O=>{O.currentTarget.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.08)",O.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:O=>{O.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",O.currentTarget.style.borderColor="#e2e8f0"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(K,{style:{width:"24px",height:"24px",color:l}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n?.title||t.scenario_title||`Session #${t.id}`}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",fontSize:"13px",color:"#64748b"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(qi,{size:14}),f(t.created_at)]}),t.duration||t.video_duration_seconds?s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(He,{size:14}),b(t.duration||t.video_duration_seconds)]}):null]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flexShrink:0},children:[k&&r&&s.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"10px",border:"none",background:c||"#3B82F6",color:"#fff",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:`0 2px 8px ${c||"#3B82F6"}40`,transition:"all 0.2s"},onMouseEnter:O=>{O.currentTarget.style.transform="scale(1.02)",O.currentTarget.style.boxShadow=`0 4px 12px ${c||"#3B82F6"}50`},onMouseLeave:O=>{O.currentTarget.style.transform="scale(1)",O.currentTarget.style.boxShadow=`0 2px 8px ${c||"#3B82F6"}40`},children:[s.jsx($t,{size:14}),"Fortsetzen"]}),k&&s.jsx("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#dbeafe",color:"#1e40af",fontSize:"12px",fontWeight:500},children:T()}),!v&&!k&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"20px",background:"#fef3c7",color:"#92400e",fontSize:"12px",fontWeight:500},children:[s.jsx(He,{size:12}),"In Bearbeitung"]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 12px",borderRadius:"20px",fontSize:"14px",fontWeight:600,...H(Y)},children:[s.jsx(Rt,{size:14}),Y!==null?`${Math.round(Y)}%`:"-- %"]}),o&&s.jsx("button",{onClick:R,disabled:d,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:"transparent",color:"#94a3b8",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"color 0.2s"},onMouseEnter:O=>{O.currentTarget.style.color="#ef4444"},onMouseLeave:O=>{O.currentTarget.style.color="#94a3b8"},title:"Lschen",children:d?s.jsx(ye,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(pn,{size:18})}),s.jsx(It,{size:20,style:{color:"#94a3b8"}})]})]})}),s.jsx(_y,{isOpen:h,onClose:()=>p(!1),onConfirm:_,title:"Session lschen",description:"Mchtest du diese Session wirklich lschen? Diese Aktion kann nicht rckgngig gemacht werden.",isDeleting:d})]})},S_=({onBack:t,onSelectSession:e,isAuthenticated:n,onLoginClick:i,onContinueSession:r,onRepeatSession:o,initialTab:a,onNavigateToModule:l})=>{console.log(" [SESSION_HISTORY] SessionHistory component initialized");const{branding:c,demoCode:d,isDemoUser:u}=ge(),h=c?.["--header-gradient"]||Q["--header-gradient"],p=c?.["--header-text"]||Q["--header-text"],m=c?.["--primary-accent"]||Q["--primary-accent"],[y,f]=g.useState(a||he.BRIEFINGS);g.useEffect(()=>{a&&f(a)},[a]);const[b,S]=g.useState(null),[C,j]=g.useState(null);g.useEffect(()=>{window.scrollTo(0,0)},[y,b]);const[w,v]=g.useState([]),[E,k]=g.useState([]),[T,N]=g.useState([]),[R,_]=g.useState([]),[A,Y]=g.useState([]),[H,$]=g.useState([]),[K,O]=g.useState([]),[P,F]=g.useState(null),[D,B]=g.useState(!0),[G,ie]=g.useState(null);g.useEffect(()=>{n?le():B(!1)},[n]);const le=async()=>{B(!0),ie(null);try{const z=Pn(),de=d?`&demo_code=${encodeURIComponent(d)}`:"",[Ke,Ye,si,Us,ne,Ee,Ae]=await Promise.all([fT({limit:50,...d&&{demo_code:d}}).catch(()=>({data:[]})),fetch(`${z}/simulator/sessions?limit=50${de}`,{headers:{"X-WP-Nonce":mt()}}).then(Fe=>Fe.json()).catch(()=>({data:[]})),fetch(`${z}/video-training/sessions?limit=50${de}`,{headers:{"X-WP-Nonce":mt()}}).then(Fe=>Fe.json()).catch(()=>({data:[]})),fe.request(`/smartbriefing/briefings?limit=50${d?`&demo_code=${encodeURIComponent(d)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),Cx().catch(()=>[]),fetch(`${z}/simulator/scenarios`,{headers:{"X-WP-Nonce":mt()}}).then(Fe=>Fe.json()).catch(()=>({data:[]})),fetch(`${z}/video-training/scenarios`,{headers:{"X-WP-Nonce":mt()}}).then(Fe=>Fe.json()).catch(()=>({data:[]}))]),Qe=(Fe,ri="sessions")=>Array.isArray(Fe?.data)?Fe.data:Array.isArray(Fe?.data?.[ri])?Fe.data[ri]:Array.isArray(Fe?.[ri])?Fe[ri]:Array.isArray(Fe)?Fe:[],jn=Fe=>Array.isArray(Fe?.data?.scenarios)?Fe.data.scenarios:Array.isArray(Fe?.data)?Fe.data:Array.isArray(Fe)?Fe:[];v(Qe(Ke)),k(Qe(Ye)),N(Qe(si)),_(Us?.data?.briefings||[]),Y(jn(ne)),$(jn(Ee)),O(jn(Ae))}catch(z){console.error("Failed to load sessions:",z),ie(z.message||"Fehler beim Laden der Daten")}finally{B(!1)}},re=g.useMemo(()=>{const z={};return A.forEach(de=>{z[de.id]=de}),z},[A]),U=g.useMemo(()=>{const z={};return H.forEach(de=>{z[de.id]=de}),z},[H]),be=g.useMemo(()=>{const z={};return K.forEach(de=>{z[de.id]=de}),z},[K]),Oe=()=>{switch(y){case he.SIMULATOR:return E;case he.VIDEO:return T;case he.BRIEFINGS:return R;default:return w}},bt=()=>{switch(y){case he.SIMULATOR:return U;case he.VIDEO:return be;default:return re}},ce=w.length+E.length+T.length+R.length,_e=async z=>{(await fe.request(`/smartbriefing/briefings/${z}`,{method:"DELETE"})).success&&_(Ke=>Ke.filter(Ye=>Ye.id!==z))},Le=z=>{F(z)},ot=()=>{F(null)},Gt=z=>{console.log("Session clicked:",y,z),S(z),j(y)},te=()=>{S(null),j(null)},$e=async(z,de)=>{const Ke=Pn();try{let Ye,si;switch(de){case he.SIMULATOR:Ye=`${Ke}/simulator/sessions/${z.id}`,si=()=>k(Ee=>Ee.filter(Ae=>Ae.id!==z.id));break;case he.ROLEPLAY:Ye=`${Ke}/sessions/${z.id}`,si=()=>v(Ee=>Ee.filter(Ae=>Ae.id!==z.id));break;case he.VIDEO:Ye=`${Ke}/video-training/sessions/${z.id}`,si=()=>N(Ee=>Ee.filter(Ae=>Ae.id!==z.id));break;default:throw new Error("Unknown session type")}const ne=await(await fetch(Ye,{method:"DELETE",headers:{"X-WP-Nonce":mt()}})).json();if(ne.success)si(),b&&te();else throw new Error(ne.message||"Delete failed")}catch(Ye){throw console.error("Failed to delete session:",Ye),Ye}},Ne=(z,de)=>(de===he.SIMULATOR?U:de===he.VIDEO?be:re)[z?.scenario_id];if(P)return s.jsx(Iy,{briefing:P,onBack:ot});if(b)return s.jsx(u_,{session:b,type:C,scenario:Ne(b,C),onBack:te,onContinueSession:r,onRepeatSession:o,onDeleteSession:$e});if(!n)return s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"14px",background:h,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx($l,{style:{width:"24px",height:"24px",color:p}})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",margin:0},children:"Meine Sessions"})]}),s.jsx("p",{style:{fontSize:"16px",color:"#475569",maxWidth:"600px",margin:"0 auto"},children:"Hier findest du deine gespeicherten bungen und Fortschritte"})]}),s.jsxs("div",{style:{maxWidth:"500px",margin:"60px auto",textAlign:"center",padding:"40px",backgroundColor:"white",borderRadius:"20px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:h,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:s.jsx(Oo,{style:{width:"32px",height:"32px",color:p}})}),s.jsx("h2",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"12px"},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",marginBottom:"24px",lineHeight:1.6},children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),s.jsxs("button",{onClick:i,style:{padding:"14px 32px",borderRadius:"12px",border:"none",background:h,color:p,fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 12px ${m}44`},children:[s.jsx(Oo,{style:{width:"20px",height:"20px"}}),"Jetzt anmelden"]})]})]});if(D)return s.jsxs("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:[s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(ye,{style:{width:"48px",height:"48px",color:m,animation:"spin 1s linear infinite",margin:"0 auto"}}),s.jsx("p",{style:{color:"#64748b",marginTop:"16px"},children:"Sessions werden geladen..."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]});if(G)return s.jsx("div",{style:{minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs("div",{style:{textAlign:"center",maxWidth:"400px",padding:"24px"},children:[s.jsx(ve,{style:{width:"48px",height:"48px",color:"#ef4444",margin:"0 auto 16px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:"#64748b",marginBottom:"24px"},children:G}),s.jsx(se,{onClick:le,children:"Erneut versuchen"})]})});const je=Oe(),_t=bt();return s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"14px",background:h,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx($l,{style:{width:"24px",height:"24px",color:p}})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",margin:0},children:"Meine Sessions"})]}),s.jsxs("p",{style:{fontSize:"16px",color:"#475569",maxWidth:"600px",margin:"0 auto"},children:[ce," ",ce===1?"bung":"bungen"," gespeichert"]})]}),s.jsx("style",{children:`
        .session-tabs {
          margin: 0 24px 32px;
          display: flex;
          gap: 8px;
          background: #f1f5f9;
          padding: 6px;
          border-radius: 14px;
        }
        .session-tab-btn {
          flex: 1;
          padding: 12px 16px;
          border-radius: 10px;
          border: none;
          font-size: 14px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: all 0.2s;
        }
        @media (max-width: 640px) {
          .session-tabs {
            flex-direction: column;
          }
          .session-tab-btn {
            padding: 14px 16px;
          }
        }
      `}),s.jsx("div",{className:"session-tabs",children:x_.map(z=>{const de=z.icon,Ke=y===z.id,Ye=z.id===he.SIMULATOR?E.length:z.id===he.VIDEO?T.length:z.id===he.BRIEFINGS?R.length:w.length;return s.jsxs("button",{onClick:()=>f(z.id),className:"session-tab-btn",style:{background:Ke?"#fff":"transparent",color:Ke?"#0f172a":"#64748b",fontWeight:Ke?600:500,boxShadow:Ke?"0 2px 8px rgba(0, 0, 0, 0.08)":"none"},children:[s.jsx(de,{size:18}),s.jsx("span",{children:z.label}),s.jsx("span",{style:{padding:"2px 8px",borderRadius:"10px",background:Ke?m:"#e2e8f0",color:Ke?"#fff":"#64748b",fontSize:"12px",fontWeight:600},children:Ye})]},z.id)})}),s.jsxs("div",{style:{margin:"0 24px 24px",display:"flex",justifyContent:"flex-end",gap:"12px"},children:[s.jsxs(se,{variant:"outline",onClick:le,disabled:D,children:[s.jsx(hn,{style:{width:"16px",height:"16px",marginRight:"8px"},className:D?"animate-spin":""}),"Aktualisieren"]}),l&&s.jsxs(se,{onClick:()=>{const z={[he.BRIEFINGS]:"smart_briefing",[he.SIMULATOR]:"simulator",[he.VIDEO]:"video_training",[he.ROLEPLAY]:"dashboard"};l(z[y]||"overview")},style:{background:h,color:p},children:[s.jsx(As,{style:{width:"16px",height:"16px",marginRight:"8px"}}),y===he.BRIEFINGS?"Neues Briefing":y===he.SIMULATOR?"Neues Szenario-Training":y===he.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),s.jsx("div",{style:{margin:"0 24px"},children:je.length===0?s.jsxs("div",{style:{textAlign:"center",padding:"60px 24px",background:"#fff",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},children:[y===he.SIMULATOR&&s.jsx(De,{style:{width:"48px",height:"48px",color:"#94a3b8",margin:"0 auto 16px"}}),y===he.ROLEPLAY&&s.jsx(ze,{style:{width:"48px",height:"48px",color:"#94a3b8",margin:"0 auto 16px"}}),y===he.VIDEO&&s.jsx(ht,{style:{width:"48px",height:"48px",color:"#94a3b8",margin:"0 auto 16px"}}),y===he.BRIEFINGS&&s.jsx(st,{style:{width:"48px",height:"48px",color:"#94a3b8",margin:"0 auto 16px"}}),s.jsxs("h3",{style:{fontSize:"20px",fontWeight:600,color:"#334155",marginBottom:"8px"},children:["Noch keine ",y===he.SIMULATOR?"Szenario-Trainings":y===he.VIDEO?"Wirkungs-Analysen":y===he.BRIEFINGS?"Smart Briefings":"Live-Simulationen"]}),s.jsx("p",{style:{color:"#64748b",marginBottom:"24px"},children:y===he.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),s.jsxs(se,{onClick:t,children:[s.jsx($t,{style:{width:"16px",height:"16px",marginRight:"8px"}}),y===he.BRIEFINGS?"Briefing erstellen":"Training starten"]})]}):s.jsx(L.div,{style:{display:"flex",flexDirection:"column",gap:"12px"},initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:y===he.BRIEFINGS?R.map(z=>s.jsx(b_,{briefing:z,onClick:()=>Le(z),onDelete:_e,headerGradient:h,headerText:p,primaryAccent:m},z.id)):je.map(z=>{const de=_t[z.scenario_id];return s.jsx(v_,{session:z,type:y,scenario:de,onClick:()=>Gt(z),onContinueSession:r,onDeleteSession:$e,headerGradient:h,headerText:p,primaryAccent:m},z.id)})})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},ff=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,gf=sx,$r=(t,e)=>n=>{var i;if(e?.variants==null)return gf(t,n?.class,n?.className);const{variants:r,defaultVariants:o}=e,a=Object.keys(r).map(d=>{const u=n?.[d],h=o?.[d];if(u===null)return null;const p=ff(u)||ff(h);return r[d][p]}),l=n&&Object.entries(n).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((d,u)=>{let{class:h,className:p,...m}=u;return Object.entries(m).every(y=>{let[f,b]=y;return Array.isArray(b)?b.includes({...o,...l}[f]):{...o,...l}[f]===b})?[...d,h,p]:d},[]);return gf(t,a,c,n?.class,n?.className)},k_=$r("rounded-xl border bg-white",{variants:{variant:{default:"border-slate-200",elevated:"border-slate-200 shadow-xl",outline:"border-ocean-blue-200",ghost:"border-transparent bg-transparent",gradient:"border-ocean-blue-100 bg-gradient-to-br from-ocean-blue-50 to-ocean-teal-50",ocean:"border-ocean-blue-200 bg-ocean-blue-50"},padding:{none:"p-0",sm:"p-3",default:"p-4",lg:"p-6"}},defaultVariants:{variant:"default",padding:"default"}}),Ze=g.forwardRef(({className:t,variant:e,padding:n,...i},r)=>s.jsx("div",{ref:r,className:oe(k_({variant:e,padding:n,className:t})),...i}));Ze.displayName="Card";const Ji=g.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:oe("flex items-center justify-between mb-3",t),...e}));Ji.displayName="CardHeader";const w_=$r("flex items-center gap-2",{variants:{size:{sm:"text-sm",default:"text-base",lg:"text-lg"}},defaultVariants:{size:"sm"}}),Xi=g.forwardRef(({className:t,size:e,icon:n,iconColor:i,children:r,...o},a)=>s.jsxs("div",{ref:a,className:oe(w_({size:e,className:t})),...o,children:[n&&s.jsx(n,{className:oe("w-4 h-4",i)}),s.jsx("span",{className:"font-semibold text-slate-800",children:r})]}));Xi.displayName="CardTitle";const Ny=g.forwardRef(({className:t,...e},n)=>s.jsx("p",{ref:n,className:oe("text-sm text-slate-500",t),...e}));Ny.displayName="CardDescription";const yt=g.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:oe("",t),...e}));yt.displayName="CardContent";const C_=g.forwardRef(({className:t,...e},n)=>s.jsx("div",{ref:n,className:oe("mt-3 pt-3 border-t border-slate-100",t),...e}));C_.displayName="CardFooter";const mf={positive:"bg-green-500 hover:bg-green-600",negative:"bg-red-500 hover:bg-red-600",tip:"bg-blue-500 hover:bg-blue-600",default:"bg-slate-500 hover:bg-slate-600"};function xf(t){return mf[t]||mf.default}function gl(t){if(!t||!isFinite(t))return"0:00";const e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n.toString().padStart(2,"0")}`}function j_({isLoading:t,audioError:e,isPlaying:n,isMuted:i,currentTime:r,duration:o,timelineMarkers:a=[],onTogglePlay:l,onToggleMute:c,onSkip:d,onSeek:u,progressRef:h}){const p=m=>{if(!h?.current||!o)return;const y=h.current.getBoundingClientRect(),S=(m.clientX-y.left)/y.width*o;u?.(S)};return s.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsxs(Ze,{variant:"elevated",padding:"lg",children:[s.jsx(Ji,{className:"mb-4",children:s.jsx(Xi,{icon:Ci,iconColor:"text-slate-800",size:"default",children:"Gesprchsaufnahme"})}),s.jsxs("div",{className:"relative mb-4",children:[t&&s.jsx("div",{className:"flex items-center justify-center bg-slate-100 rounded-lg py-8",children:s.jsx(ye,{className:"icon-lg text-blue-600 animate-spin"})}),e&&s.jsx("div",{className:"flex items-center justify-center bg-slate-100 rounded-lg py-6",children:s.jsxs("div",{className:"text-center px-4",children:[s.jsx(ve,{className:"icon-lg text-orange-500 mx-auto mb-2"}),s.jsx("p",{className:"text-body",children:e})]})}),!e&&!t&&s.jsxs("div",{ref:h,onClick:p,className:"relative w-full h-12 bg-slate-100 rounded-lg cursor-pointer overflow-hidden group",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-100",style:{width:o>0?`${r/o*100}%`:"0%"}}),s.jsx("div",{className:"absolute inset-0 bg-blue-400 opacity-0 group-hover:opacity-10 transition-opacity"}),a.length>0&&a.map((m,y)=>s.jsx("button",{onClick:f=>{f.stopPropagation(),u?.(m.timestamp)},className:oe("absolute top-1 w-3 h-3 rounded-full cursor-pointer transform -translate-x-1/2","transition-transform hover:scale-150 z-10",xf(m.type)),style:{left:`${m.position}%`},title:m.text},y)),s.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-blue-800 transform -translate-x-1/2",style:{left:o>0?`${r/o*100}%`:"0%"}})]})]}),!e&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(se,{variant:"ghost",size:"icon",onClick:()=>d?.(-10),disabled:t,children:s.jsx(hd,{className:"icon-sm"})}),s.jsx(se,{onClick:l,disabled:t,className:"w-12 h-12 rounded-full",children:n?s.jsx(cd,{className:"icon-md"}):s.jsx($t,{className:"icon-md ml-0.5"})}),s.jsx(se,{variant:"ghost",size:"icon",onClick:()=>d?.(Gj.SKIP_SECONDS),disabled:t,children:s.jsx(pd,{className:"icon-sm"})})]}),s.jsxs("div",{className:"flex-1 text-center text-sm text-slate-600",children:[gl(r)," / ",gl(o)]}),s.jsx(se,{variant:"ghost",size:"icon",onClick:c,disabled:t,children:i?s.jsx(xm,{className:"icon-sm"}):s.jsx(Ci,{className:"icon-sm"})})]}),a.length>0&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[s.jsx("p",{className:"text-label mb-2",children:"Feedback-Marker (klicken zum Springen):"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((m,y)=>s.jsxs("button",{onClick:()=>u?.(m.timestamp),className:oe("px-3 py-1.5 rounded-lg text-xs text-white transition-opacity hover:opacity-80",xf(m.type)),children:[gl(m.timestamp)," - ",m.text?.substring(0,30),m.text?.length>30?"...":""]},y))})]})]})})}function T_(t){if(t===void 0)return null;const e=Math.floor(t/60),n=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function E_({transcript:t=[],activeIndex:e=-1,isPlaying:n=!1,scenario:i,onSeekToEntry:r}){const o=g.useRef(null),{branding:a}=ge(),l=a?.["--primary-accent"]||Q["--primary-accent"];return g.useEffect(()=>{if(!n||e<0||!o.current)return;const c=o.current,d=c.children[e];if(d){const u=c.getBoundingClientRect(),h=d.getBoundingClientRect();if(h.top<u.top||h.bottom>u.bottom){const p=d.offsetTop-c.offsetTop-c.clientHeight/2+d.clientHeight/2;c.scrollTo({top:Math.max(0,p),behavior:"smooth"})}}},[e,n]),s.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.jsxs(Ze,{variant:"elevated",padding:"lg",children:[s.jsx(Ji,{className:"mb-4",children:s.jsx(Xi,{icon:ze,iconColor:"text-slate-800",size:"default",children:"Gesprchsverlauf"})}),t.length===0?s.jsx("p",{className:"text-slate-500 text-center py-8",children:"Kein Transkript verfgbar."}):s.jsx("div",{ref:o,className:"space-y-3 overflow-y-auto pr-2 scroll-smooth pt-1",style:{maxHeight:"calc(100vh - 400px)",minHeight:"200px"},children:t.map((c,d)=>{const u=d===e,h=c.role==="agent",p=c.timeLabel||T_(c.elapsedTime);return Ya[c.role]||Ya.user,s.jsxs(L.div,{initial:{opacity:.8},animate:{opacity:u?1:.8},onClick:()=>r?.(d),className:oe("flex gap-2 cursor-pointer transition-all",c.role==="user"?"flex-row-reverse":"flex-row",u?"scale-[1.01]":"hover:scale-[1.005]"),children:[s.jsx("div",{className:"flex flex-col items-center gap-1 flex-shrink-0",children:h?i?.interviewer_profile?.image_url?s.jsx("img",{src:i.interviewer_profile.image_url,alt:i.interviewer_profile.name||Ya.agent.label,className:"w-8 h-8 rounded-full object-cover shadow-sm border-2 border-blue-200"}):s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-blue-500 to-blue-600",children:s.jsx(or,{className:"icon-sm text-white"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shadow-sm bg-gradient-to-br from-teal-500 to-teal-600",children:s.jsx(xt,{className:"icon-sm text-white"})}),p&&s.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:p})]})}),s.jsx("div",{className:oe("flex-1 px-3 py-2 rounded-xl shadow-sm transition-all",h?"bg-slate-50 border":"bg-gradient-to-br from-teal-500 to-teal-600 text-white",u&&"ring-2 ring-offset-1"),style:{...h&&{borderColor:`${l}40`},...u&&{"--tw-ring-color":l}},children:s.jsx("p",{className:oe("text-xs leading-relaxed",h?"text-slate-700":"text-white"),children:c.text})})]},d)})})]})})}function R_(t){if(!t||!isFinite(t))return"0:00";const e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n.toString().padStart(2,"0")}`}function I_(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function __({session:t,scenario:e,feedback:n}){const{branding:i}=ge(),r=i?.["--primary-accent-light"]||Q["--primary-accent-light"],o=n?.rating?.overall;return s.jsx("div",{style:{backgroundColor:r,borderBottom:`1px solid ${x.slate[200]}`,position:"sticky",top:0,zIndex:10},children:s.jsxs("div",{style:{width:"100%",padding:"12px 32px",display:"flex",alignItems:"center",gap:"24px",flexWrap:"wrap"},children:[s.jsx("h1",{style:{fontSize:"18px",fontWeight:700,color:x.slate[900],margin:0,whiteSpace:"nowrap"},children:e?.title||`Session #${t?.id}`}),s.jsx("div",{style:{width:"1px",height:"20px",backgroundColor:x.slate[200]}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",fontSize:"14px",color:x.slate[600]},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(qi,{style:{width:"16px",height:"16px",color:x.slate[400]}}),I_(t?.created_at)]}),s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(He,{style:{width:"16px",height:"16px",color:x.slate[400]}}),R_(t?.duration)]}),o&&s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"4px",backgroundColor:"#fef3c7",color:"#92400e",padding:"4px 10px",borderRadius:"9999px",fontSize:"13px",fontWeight:600},children:[s.jsx(Rt,{style:{width:"14px",height:"14px",fill:x.yellow[400],color:x.yellow[500]}}),o,"/10"]})]})]})})}const yf=({score:t,size:e="large",maxScore:n=100})=>{const i=e==="large",r=i?54:28,o=i?8:4,a=i?128:72,l=a/2,c=2*Math.PI*r,d=t/n*100,u=d/100*c,p=(m=>m>=80?{stroke:"#10b981",text:"text-green-600"}:m>=60?{stroke:"#3b82f6",text:"text-blue-600"}:m>=40?{stroke:"#f59e0b",text:"text-amber-500"}:{stroke:"#ef4444",text:"text-red-500"})(d);return s.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[s.jsxs("svg",{className:i?"w-28 h-28":"w-16 h-16",viewBox:`0 0 ${a} ${a}`,children:[s.jsx("circle",{cx:l,cy:l,r,fill:"none",stroke:"#e2e8f0",strokeWidth:o}),s.jsx(L.circle,{cx:l,cy:l,r,fill:"none",stroke:p.stroke,strokeWidth:o,strokeDasharray:c,strokeLinecap:"round",transform:`rotate(-90 ${l} ${l})`,initial:{strokeDashoffset:c},animate:{strokeDashoffset:c-u},transition:{duration:1,ease:"easeOut"}})]}),s.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:s.jsxs(L.span,{className:oe("font-bold",p.text,i?"text-2xl":"text-sm"),initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[Math.round(t),"%"]})})]})},Ay=({rating:t,maxRating:e=10,showLabel:n=!0})=>{const i=t/e*100,r=a=>a>=80?"#22c55e":a>=60?"#3b82f6":a>=40?"#f59e0b":"#ef4444",o=a=>a>=80?"#16a34a":a>=60?"#2563eb":a>=40?"#d97706":"#dc2626";return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:"#e2e8f0",borderRadius:"9999px",overflow:"hidden"},children:s.jsx(L.div,{style:{height:"100%",borderRadius:"9999px",backgroundColor:r(i)},initial:{width:0},animate:{width:`${i}%`},transition:{duration:.5,ease:"easeOut"}})}),n&&s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,minWidth:"2.5rem",textAlign:"right",color:o(i)},children:[t,"/",e]})]})},N_=({score:t,fillerWords:e=[]})=>{const n=o=>o>=80?"bg-green-500":o>=50?"bg-amber-500":"bg-red-500",r=(o=>o>=80?{text:"Sehr gut",color:"text-green-600"}:o>=50?{text:"Okay",color:"text-amber-600"}:{text:"Verbesserbar",color:"text-red-600"})(t);return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center",children:s.jsx(Lo,{className:"w-4 h-4 text-blue-600"})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Redefluss"})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:s.jsx(L.div,{className:oe("h-full rounded-full",n(t)),initial:{width:0},animate:{width:`${t}%`},transition:{duration:.5,ease:"easeOut"}})}),s.jsxs("div",{className:"flex justify-between items-center mt-1",children:[s.jsx("span",{className:oe("text-xs font-medium",r.color),children:r.text}),s.jsxs("span",{className:"text-xs text-slate-500",children:[t,"%"]})]})]}),e&&e.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1",children:e.map((o,a)=>s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-slate-100 text-slate-600",children:[o.word," (",o.count,"x)"]},a))})]})},A_=({rating:t,feedback:e})=>{const n={zu_langsam:15,optimal:50,zu_schnell:85},i={zu_langsam:{text:"Langsam",color:"text-amber-600"},optimal:{text:"Optimal",color:"text-green-600"},zu_schnell:{text:"Schnell",color:"text-amber-600"}},r=n[t]||50,o=i[t]||i.optimal;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"w-7 h-7 rounded-lg bg-ocean-blue-100 flex items-center justify-center",children:s.jsx(um,{className:"w-4 h-4 text-ocean-blue-600"})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Sprechtempo"})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx("div",{className:"h-2 bg-gradient-to-r from-amber-200 via-green-300 to-amber-200 rounded-full"}),s.jsx(L.div,{className:"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white border-2 border-slate-800 rounded-full shadow-md",initial:{left:"50%"},animate:{left:`${r}%`},transition:{duration:.5,ease:"easeOut"},style:{marginLeft:"-8px"}})]}),s.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400 mb-1",children:[s.jsx("span",{children:"Langsam"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Optimal"}),s.jsx("span",{children:"Schnell"})]}),s.jsx("p",{className:oe("text-xs font-medium text-center",o.color),children:o.text}),e&&s.jsx("p",{className:"text-[10px] text-slate-500 text-center mt-1 line-clamp-2",children:e})]})},P_=({rating:t,feedback:e})=>{const n={monoton:{icon:ho,label:"Monoton",color:"text-amber-600",bgColor:"bg-amber-100",bars:[20,20,20,20,20]},natrlich:{icon:ho,label:"Natrlich",color:"text-blue-600",bgColor:"bg-blue-100",bars:[30,50,40,60,45]},lebendig:{icon:ho,label:"Lebendig",color:"text-green-600",bgColor:"bg-green-100",bars:[20,80,40,90,60]}},i=n[t]||n.natrlich,r=i.icon;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-xl p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:oe("w-7 h-7 rounded-lg flex items-center justify-center",i.bgColor),children:s.jsx(r,{className:oe("w-4 h-4",i.color)})}),s.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Betonung"})]}),s.jsx("div",{className:"flex items-end justify-center gap-1 h-8 mb-2",children:i.bars.map((o,a)=>s.jsx(L.div,{className:oe("w-2 rounded-full",i.bgColor),initial:{height:4},animate:{height:`${o}%`},transition:{duration:.3,delay:a*.1}},a))}),s.jsx("p",{className:oe("text-xs font-medium text-center",i.color),children:i.label}),e&&s.jsx("p",{className:"text-[10px] text-slate-500 text-center mt-1 line-clamp-2",children:e})]})},ml=({label:t,rating:e,maxRating:n=10,description:i,index:r})=>{const[o,a]=g.useState(!1),[l,c]=g.useState(!1),d=e/n*100,h=(m=>m>=80?{icon:Qn,color:"#22c55e"}:m>=40?{icon:Vt,color:"#f59e0b"}:{icon:Mn,color:"#ef4444"})(d),p=h.icon;return s.jsxs(L.div,{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.05},children:[s.jsxs("button",{onClick:()=>i&&a(!o),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),disabled:!i,style:{width:"100%",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",transition:"background-color 0.2s",backgroundColor:l&&i?"#f8fafc":"transparent",cursor:i?"pointer":"default",border:"none",textAlign:"left"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1,minWidth:0},children:[s.jsx(p,{style:{width:"20px",height:"20px",flexShrink:0,color:h.color}}),s.jsx("span",{style:{fontWeight:500,color:"#1e293b",fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"80px"},children:s.jsx(Ay,{rating:e,maxRating:n})}),i&&s.jsx(L.div,{animate:{rotate:o?180:0},transition:{duration:.2},children:s.jsx(jt,{style:{width:"16px",height:"16px",color:"#94a3b8"}})})]})]}),s.jsx(Ve,{children:o&&i&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"4px 16px 16px 16px",borderTop:"1px solid #f1f5f9"},children:s.jsx("p",{style:{fontSize:"14px",color:"#475569",lineHeight:1.6,margin:0},children:i})})})})]})},M_=({item:t,index:e})=>{const[n,i]=g.useState(!1),r=t.rating||3,o=5,a=r/o*100,c=(h=>h>=80?{icon:Qn,color:"text-green-500"}:h>=40?{icon:Vt,color:"text-amber-500"}:{icon:Mn,color:"text-red-500"})(a),d=c.icon,u=t.observation||t.quote_evidence||t.improvement_suggestion;return s.jsxs(L.div,{className:"bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:e*.05},children:[s.jsxs("button",{onClick:()=>u&&i(!n),disabled:!u,className:oe("w-full px-4 py-3 flex items-center justify-between gap-3 transition-colors",u?"hover:bg-slate-50 cursor-pointer":"cursor-default"),children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(d,{className:oe("w-5 h-5 flex-shrink-0",c.color)}),s.jsx("span",{className:"font-medium text-slate-800 text-sm truncate",children:t.criterion})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-20",children:s.jsx(Ay,{rating:r,maxRating:o})}),u&&s.jsx(L.div,{animate:{rotate:n?180:0},transition:{duration:.2},children:s.jsx(jt,{className:"w-4 h-4 text-slate-400"})})]})]}),s.jsx(Ve,{children:n&&u&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsxs("div",{className:"px-4 pb-4 pt-1 border-t border-slate-100 space-y-2",children:[t.observation&&s.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:t.observation}),t.quote_evidence&&s.jsxs("blockquote",{className:"text-xs text-slate-500 italic border-l-2 border-slate-200 pl-2",children:['"',t.quote_evidence,'"']}),t.improvement_suggestion&&s.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-700 bg-blue-50 rounded-lg p-2",children:[s.jsx(Ce,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:t.improvement_suggestion})]})]})})})]})},xl=({title:t,icon:e,items:n,bgColor:i,borderColor:r,headerBgColor:o,iconColor:a,titleColor:l,textColor:c,bulletColor:d,bulletIcon:u,defaultOpen:h=!1})=>{const[p,m]=g.useState(h);return!n||n.length===0?null:s.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},className:oe("border rounded-xl overflow-hidden",i,r),children:[s.jsxs("button",{onClick:()=>m(!p),className:oe("w-full px-4 py-3 flex items-center justify-between gap-3 transition-colors hover:opacity-90",i),children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:oe("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",o),children:s.jsx(e,{className:oe("w-4 h-4",a)})}),s.jsx("h4",{className:oe("text-sm font-bold",l),children:t})]}),s.jsx(L.div,{animate:{rotate:p?180:0},transition:{duration:.2},children:s.jsx(jt,{className:oe("w-5 h-5",a)})})]}),s.jsx(Ve,{initial:!1,children:p&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsx("div",{className:"px-4 pb-4",children:s.jsx("ul",{className:"space-y-2",children:n.map((y,f)=>s.jsxs("li",{className:oe("flex items-start gap-2 text-sm",c),children:[u?s.jsx(u,{className:oe("w-4 h-4 mt-0.5 flex-shrink-0",d)}):s.jsx("span",{className:oe("mt-0.5 flex-shrink-0",d),children:""}),s.jsx("span",{className:"leading-relaxed",children:y})]},f))})})})})]})};function D_({feedback:t,isLoading:e=!1}){const n=g.useMemo(()=>{if(console.log(" [FEEDBACK_DISPLAY] Received feedback prop:",t?"exists":"null",typeof t),!t)return null;if(typeof t=="string")try{let o=t.trim();o.startsWith("```json")?o=o.replace(/```json\s*/g,"").replace(/```\s*$/g,""):o.startsWith("```")&&(o=o.replace(/```\s*/g,"").replace(/```\s*$/g,""));const a=JSON.parse(o);return console.log(" [FEEDBACK_DISPLAY] Parsed from string:",a),a}catch(o){return console.error(" [FEEDBACK_DISPLAY] Failed to parse feedback:",o),null}return console.log(" [FEEDBACK_DISPLAY] Using object directly:",t),t},[t]),i=n?.overall_analysis!==void 0;if(console.log(" [FEEDBACK_DISPLAY] Data:",n,"isNewFormat:",i),e)return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(L.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:s.jsx(ye,{className:"w-10 h-10 text-blue-600"})}),s.jsx("p",{className:"mt-3 text-slate-600 text-sm",children:"Feedback wird geladen..."})]});if(!n)return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(oa,{className:"w-12 h-12 text-slate-200 mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Kein Feedback verfgbar."}),s.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Das Feedback erscheint hier nach dem Gesprch."})]});if(i){const{overall_analysis:o,audio_metrics:a,categories:l}=n,c=o?.total_score||0;return s.jsxs("div",{className:"space-y-5",children:[s.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-4",children:[s.jsx("div",{className:"bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(yf,{score:c,size:"large"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-1 flex items-center gap-2",children:[s.jsx(Dt,{className:"w-4 h-4 text-blue-600"}),"Gesamtbewertung"]}),o?.summary_text&&s.jsx("p",{className:"text-xs text-slate-600 leading-relaxed line-clamp-3",children:o.summary_text})]})]})}),a&&s.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2",children:[s.jsx(Ci,{className:"w-4 h-4 text-blue-600"}),"Audio & Stimme"]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[s.jsx(N_,{score:a.speech_cleanliness_score||0,fillerWords:a.filler_words_detected}),s.jsx(A_,{rating:a.pacing?.rating||"optimal",feedback:a.pacing?.feedback}),s.jsx(P_,{rating:a.tonality?.rating||"natrlich",feedback:a.tonality?.feedback})]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o?.top_strength&&s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 border border-green-200 rounded-xl",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0",children:s.jsx(Fo,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide",children:"Deine Superkraft"}),s.jsx("p",{className:"text-sm text-green-900 mt-0.5 leading-relaxed",children:typeof o.top_strength=="string"?o.top_strength:o.top_strength?.text||o.top_strength?.description||JSON.stringify(o.top_strength)})]})]}),o?.primary_weakness&&s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0",children:s.jsx(De,{className:"w-4 h-4 text-amber-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide",children:"Dein Trainingsfeld"}),s.jsx("p",{className:"text-sm text-amber-900 mt-0.5 leading-relaxed",children:typeof o.primary_weakness=="string"?o.primary_weakness:o.primary_weakness?.text||o.primary_weakness?.description||JSON.stringify(o.primary_weakness)})]})]})]})]}),l&&l.length>0&&s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"space-y-4",children:l.map((d,u)=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[s.jsx(st,{className:"w-4 h-4 text-blue-600"}),d.title]}),d.score!==void 0&&s.jsxs("span",{className:"text-xs font-semibold text-slate-500",children:[d.score,"%"]})]}),s.jsx("div",{className:"space-y-2",children:d.items?.map((h,p)=>s.jsx(M_,{item:h,index:p},p))})]},d.id||u))})]})}const r=n.rating?.overall?Math.round(n.rating.overall/10*100):null;return s.jsxs("div",{className:"space-y-5",children:[s.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-4",children:[s.jsx("div",{className:"bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[r!==null&&s.jsx(yf,{score:r,size:"large"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-1 flex items-center gap-2",children:[s.jsx(Dt,{className:"w-4 h-4 text-blue-600"}),"Gesamtbewertung"]}),n.summary&&s.jsx("p",{className:"text-xs text-slate-600 leading-relaxed line-clamp-3",children:n.summary})]})]})}),n.strengths?.length>0&&s.jsx(xl,{title:"Deine Superkrfte",icon:Fo,items:n.strengths,bgColor:"bg-green-50",borderColor:"border-green-200",headerBgColor:"bg-green-100",iconColor:"text-green-600",titleColor:"text-green-800",textColor:"text-green-700",bulletColor:"text-green-500",defaultOpen:!0}),n.improvements?.length>0&&s.jsx(xl,{title:"Dein Trainingsfeld",icon:De,items:n.improvements,bgColor:"bg-amber-50",borderColor:"border-amber-200",headerBgColor:"bg-amber-100",iconColor:"text-amber-600",titleColor:"text-amber-800",textColor:"text-amber-700",bulletColor:"text-amber-500",defaultOpen:!0}),n.tips?.length>0&&s.jsx(xl,{title:"Praktische Tipps",icon:Ce,items:n.tips,bgColor:"bg-blue-50",borderColor:"border-blue-200",headerBgColor:"bg-blue-100",iconColor:"text-blue-600",titleColor:"text-blue-800",textColor:"text-blue-700",bulletColor:"text-blue-500",bulletIcon:fd,defaultOpen:!0})]}),n.rating&&s.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-3 flex items-center gap-2",children:[s.jsx(st,{className:"w-4 h-4 text-blue-600"}),"Bewertungskriterien"]}),s.jsxs("div",{className:"space-y-2",children:[n.rating.communication!==void 0&&s.jsx(ml,{label:"Kommunikation",rating:n.rating.communication,maxRating:10,description:"Wie klar und verstndlich du dich whrend des Gesprchs ausgedrckt hast.",index:0}),n.rating.motivation!==void 0&&s.jsx(ml,{label:"Motivation",rating:n.rating.motivation,maxRating:10,description:"Wie motiviert und engagiert du whrend des Gesprchs gewirkt hast.",index:1}),n.rating.professionalism!==void 0&&s.jsx(ml,{label:"Professionalitt",rating:n.rating.professionalism,maxRating:10,description:"Dein professionelles Auftreten und Verhalten im Gesprch.",index:2})]})]})]})}function O_(t){return t>=ys.EXCELLENT?{stroke:"#22c55e",bg:"from-green-50 to-green-100",text:"text-green-600",label:"Sehr selbstsicher"}:t>=ys.GOOD?{stroke:"#3b82f6",bg:"from-blue-50 to-blue-100",text:"text-blue-600",label:"Selbstsicher"}:t>=ys.FAIR?{stroke:"#f59e0b",bg:"from-amber-50 to-amber-100",text:"text-amber-600",label:"Ausbaufhig"}:{stroke:"#ef4444",bg:"from-red-50 to-red-100",text:"text-red-600",label:"Unsicher"}}function Py({score:t,size:e=160}){const n=e/2-15,i=Math.PI*n,r=Math.max(0,Math.min(100,t)),o=i-r/100*i,a=O_(t);return s.jsxs("div",{className:oe("relative flex flex-col items-center p-4 rounded-2xl bg-gradient-to-br",a.bg),children:[s.jsxs("div",{className:"relative",style:{width:e,height:e/2+20},children:[s.jsxs("svg",{width:e,height:e/2+20,viewBox:`0 0 ${e} ${e/2+20}`,className:"overflow-visible",children:[s.jsx("path",{d:`M 15 ${e/2} A ${n} ${n} 0 0 1 ${e-15} ${e/2}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"12",strokeLinecap:"round"}),s.jsx(L.path,{d:`M 15 ${e/2} A ${n} ${n} 0 0 1 ${e-15} ${e/2}`,fill:"none",stroke:a.stroke,strokeWidth:"12",strokeLinecap:"round",strokeDasharray:i,initial:{strokeDashoffset:i},animate:{strokeDashoffset:o},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-end pb-2",children:[s.jsx(L.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.3},className:oe("text-4xl font-bold",a.text),children:t}),s.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"/ 100"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.jsx(um,{className:oe("w-4 h-4",a.text)}),s.jsx("span",{className:oe("text-sm font-semibold",a.text),children:a.label})]})]})}const L_=$r("inline-flex items-center justify-center rounded text-xs font-medium transition-colors",{variants:{variant:{default:"bg-slate-100 text-slate-700",secondary:"bg-slate-200 text-slate-800",outline:"border border-slate-300 text-slate-700",success:"bg-green-100 text-green-800",warning:"bg-amber-100 text-amber-800",error:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800","success-soft":"bg-green-50 text-green-700 border border-green-200","warning-soft":"bg-amber-50 text-amber-700 border border-amber-200","error-soft":"bg-red-50 text-red-700 border border-red-200","info-soft":"bg-blue-50 text-blue-700 border border-blue-200"},size:{sm:"px-1.5 py-0.5 text-[10px]",default:"px-2 py-1",lg:"px-2.5 py-1.5 text-sm"}},defaultVariants:{variant:"default",size:"default"}}),wa=g.forwardRef(({className:t,variant:e,size:n,...i},r)=>s.jsx("span",{ref:r,className:oe(L_({variant:e,size:n,className:t})),...i}));wa.displayName="Badge";const F_=$r("inline-flex items-center gap-1 font-mono text-xs rounded",{variants:{variant:{default:"bg-slate-100 text-slate-600",positive:"bg-green-200 text-green-800",negative:"bg-red-200 text-red-800",warning:"bg-amber-200 text-amber-800",info:"bg-blue-200 text-blue-800"},size:{sm:"px-1 py-0.5 text-[10px]",default:"px-1.5 py-0.5"}},defaultVariants:{variant:"default",size:"default"}}),Jd=g.forwardRef(({className:t,variant:e,size:n,...i},r)=>s.jsx("span",{ref:r,className:oe(F_({variant:e,size:n,className:t})),...i}));Jd.displayName="TimestampBadge";function My({rating:t,wpm:e,feedback:n}){const i=Kh[t]||Kh.optimal,{position:r,isOptimal:o}=i;return s.jsxs(Ze,{children:[s.jsxs(Ji,{children:[s.jsx(Xi,{icon:mm,iconColor:"text-blue-500",children:"Sprechtempo"}),e&&s.jsx(wa,{variant:"default",className:"font-mono",children:e})]}),s.jsxs("div",{className:"relative h-8 mb-3",children:[s.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-2 rounded-full bg-gradient-to-r from-blue-200 via-green-300 to-red-200"}),s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-4 bg-green-400/30 rounded-full border border-green-400"}),s.jsxs("div",{className:"absolute inset-x-0 -bottom-1 flex justify-between px-2",children:[s.jsx("span",{className:"text-[10px] text-slate-400",children:"Langsam"}),s.jsx("span",{className:"text-[10px] text-green-600 font-medium",children:"Optimal"}),s.jsx("span",{className:"text-[10px] text-slate-400",children:"Schnell"})]}),s.jsx(L.div,{initial:{left:"50%"},animate:{left:`${r}%`},transition:{duration:.8,ease:"easeOut"},className:oe("absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-5 h-5 rounded-full shadow-lg border-2 border-white",o?"bg-green-500":"bg-amber-500")})]}),n&&s.jsx("p",{className:"text-body-muted mt-4",children:n})]})}function Dy({rating:t,highlights:e,feedback:n,onJumpToTimestamp:i}){const r=Yh[t]||Yh.natrlich,o=g.useMemo(()=>{const a=[],l=t==="monoton"?30:t==="lebendig"?20:25,c=r.waveformVariance;for(let d=0;d<30;d++){const u=Math.sin(d*12.9898)*43758.5453%1,h=l+Math.sin(d*.5)*c+u*(c/2);a.push(Math.max(10,Math.min(100,h)))}return a},[t,r.waveformVariance]);return s.jsxs(Ze,{children:[s.jsxs(Ji,{children:[s.jsx(Xi,{icon:pm,iconColor:"text-ocean-teal-600",children:"Betonung & Melodie"}),s.jsxs(wa,{variant:"default",className:oe(r.bg,r.color),children:[r.icon," ",r.label]})]}),s.jsx("div",{className:"flex items-center justify-center gap-0.5 h-12 mb-3",children:o.map((a,l)=>s.jsx(L.div,{initial:{height:0},animate:{height:`${a}%`},transition:{duration:.5,delay:l*.02},className:oe("w-1 rounded-full",r.bg.replace("50","400"))},l))}),e&&e.length>0&&s.jsx("div",{className:"space-y-1.5 mb-3",children:e.map((a,l)=>{const c=a.type==="positive"?zo.positive:zo.negative;return s.jsxs("button",{onClick:()=>i?.(a.timestamp),className:oe("w-full flex items-center gap-2 px-2 py-1.5 rounded-lg text-left","interactive-scale",c.all),children:[s.jsx(Jd,{variant:a.type==="positive"?"positive":"negative",children:a.timestamp}),a.type==="positive"?s.jsx(Qn,{className:"icon-sm text-green-500 flex-shrink-0"}):s.jsx(Mn,{className:"icon-sm text-red-500 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-slate-700 flex-1 truncate",children:a.note}),s.jsx($t,{className:"icon-xs text-slate-400"})]},l)})}),n&&s.jsx("p",{className:"text-body-muted",children:n})]})}const B_=$r("mt-3 p-3 rounded-lg border",{variants:{variant:{default:"bg-blue-50 border-blue-200",success:"bg-green-50 border-green-200",warning:"bg-amber-50 border-amber-200",info:"bg-slate-50 border-slate-200"}},defaultVariants:{variant:"default"}}),z_={default:"text-blue-800",success:"text-green-800",warning:"text-amber-800",info:"text-slate-700"},U_={default:"text-blue-500",success:"text-green-500",warning:"text-amber-500",info:"text-slate-500"},W_={default:Ce,success:Zt,warning:Mn,info:Ns},Oy=g.forwardRef(({className:t,variant:e="default",icon:n,children:i,...r},o)=>{const a=n||W_[e],l=z_[e],c=U_[e];return s.jsx("div",{ref:o,className:oe(B_({variant:e,className:t})),...r,children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(a,{className:oe("w-4 h-4 flex-shrink-0 mt-0.5",c)}),s.jsx("p",{className:oe("text-xs leading-relaxed",l),children:i})]})})});Oy.displayName="FeedbackTip";function V_(t){return t<=Jh.GOOD?"text-green-500":t<=Jh.MODERATE?"text-amber-500":"text-red-500"}function $_(t){return t>=ys.EXCELLENT?"text-green-600":t>=ys.GOOD?"text-blue-600":t>=ys.FAIR?"text-amber-600":"text-red-600"}function G_({fillerWordAnalysis:t,score:e,feedback:n,onJumpToTimestamp:i}){const[r,o]=g.useState(null),a=t?.reduce((l,c)=>l+(c.count||0),0)||0;return s.jsxs(Ze,{children:[s.jsxs(Ji,{children:[s.jsx(Xi,{icon:ze,iconColor:"text-orange-500",children:"Fllwrter"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(wa,{variant:"default",children:[a,"x gesamt"]}),e!==void 0&&s.jsxs("span",{className:oe("text-sm font-bold",$_(e)),children:[e,"/100"]})]})]}),t&&t.length>0?s.jsx("div",{className:"space-y-2",children:t.map((l,c)=>s.jsxs("div",{className:"border border-slate-100 rounded-lg overflow-hidden",children:[s.jsxs("button",{onClick:()=>o(r===c?null:c),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L.div,{animate:{rotate:r===c?90:0},transition:{duration:.2},children:s.jsx(It,{className:"icon-sm text-slate-400"})}),s.jsxs("span",{className:"font-medium text-slate-700 text-sm",children:['"',l.word,'"']})]}),s.jsxs("span",{className:oe("text-sm font-bold",V_(l.count)),children:[l.count,"x"]})]}),s.jsx(Ve,{children:r===c&&l.examples&&l.examples.length>0&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsxs("div",{className:"px-3 pb-3 pt-1 bg-slate-50 border-t border-slate-100",children:[s.jsx("p",{className:"text-label mb-2",children:"Klicke zum Anhren:"}),s.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.examples.map((d,u)=>s.jsxs("button",{onClick:h=>{h.stopPropagation(),i?.(d.timestamp)},className:oe("inline-flex items-center gap-1.5 px-2 py-1 rounded-md transition-all group",zo.neutral.all),children:[s.jsx("span",{className:"font-mono text-xs text-blue-600 group-hover:text-blue-700",children:d.timestamp}),d.context&&s.jsxs("span",{className:"text-[10px] text-slate-400 group-hover:text-slate-500",children:["(",d.context,")"]}),s.jsx($t,{className:"icon-xs text-blue-400 group-hover:text-blue-600"})]},u))})]})})})]},c))}):s.jsxs("div",{className:"flex items-center gap-2 text-green-600 py-2",children:[s.jsx(Qn,{className:"icon-sm"}),s.jsx("span",{className:"text-sm",children:"Keine Fllwrter erkannt!"})]}),n&&s.jsx(Oy,{children:n})]})}function q_({issues:t,onJumpToTimestamp:e}){return!t||t.length===0?null:s.jsxs("div",{className:"mt-3 space-y-1.5",children:[s.jsx("p",{className:"text-label font-medium",children:"Auffllige Stellen:"}),t.map((n,i)=>s.jsxs("button",{onClick:()=>e?.(n.timestamp),className:oe("w-full flex items-center gap-2 px-2 py-1.5 rounded-lg text-left","interactive-scale",zo.warning.all),children:[s.jsx(Jd,{variant:"warning",children:n.timestamp}),s.jsx(Mn,{className:"icon-sm text-amber-500 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-slate-700 flex-1 truncate",children:n.issue}),s.jsx($t,{className:"icon-xs text-slate-400"})]},i))]})}function H_(){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(L.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:s.jsx(ye,{className:"w-10 h-10 text-blue-600"})}),s.jsx("p",{className:"mt-3 text-slate-600 text-sm",children:"Audio wird analysiert..."})]})}function K_(){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(Lo,{className:"w-12 h-12 text-slate-200 mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Keine Audio-Analyse verfgbar."}),s.jsx("p",{className:"text-slate-400 text-xs mt-1 text-center",children:"Die Stimmanalyse erscheint hier nach der Aufnahme."})]})}function Y_({message:t}){return s.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:[s.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Audio-Analyse nicht verfgbar"}),s.jsx("p",{className:"text-xs text-amber-600 mt-1",children:t})]})}function J_({audioMetrics:t,onJumpToTimestamp:e}){return s.jsxs("div",{className:"space-y-4",children:[t.confidence_score!==void 0&&s.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-2 flex items-center gap-2",children:[s.jsx(st,{className:"w-4 h-4 text-amber-500"}),"Selbstsicherheit"]}),s.jsx(Py,{score:t.confidence_score,size:160})]}),t.summary_text&&s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.4},className:"p-3 bg-gradient-to-br from-slate-50 to-blue-50 border border-slate-200 rounded-xl",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:t.summary_text})}),t.speech_cleanliness&&s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},children:s.jsx(G_,{fillerWordAnalysis:t.speech_cleanliness.filler_word_analysis,score:t.speech_cleanliness.score,feedback:t.speech_cleanliness.feedback,onJumpToTimestamp:e})}),t.pacing&&s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.4},children:[s.jsx(My,{rating:t.pacing.rating,wpm:t.pacing.perceived_wpm,feedback:t.pacing.feedback}),s.jsx(q_,{issues:t.pacing.issues_detected,onJumpToTimestamp:e})]}),t.tonality&&s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},children:s.jsx(Dy,{rating:t.tonality.rating,highlights:t.tonality.highlights,feedback:t.tonality.feedback,onJumpToTimestamp:e})})]})}function X_({data:t,onJumpToTimestamp:e}){const n=t.audio_metrics||t;return s.jsxs("div",{className:"space-y-4",children:[t.overall_analysis&&s.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-gradient-to-br from-blue-50 to-slate-50 border border-blue-200 rounded-xl",children:[s.jsxs("h4",{className:"text-sm font-bold text-slate-800 mb-2 flex items-center gap-2",children:[s.jsx(Ci,{className:"w-4 h-4 text-blue-500"}),"Gesamtbewertung"]}),s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed",children:typeof t.overall_analysis=="string"?t.overall_analysis:t.overall_analysis?.summary_text||t.overall_analysis?.summary||"Audio-Analyse verfgbar"}),t.overall_analysis?.total_score!==void 0&&s.jsx("div",{className:"mt-2",children:s.jsx(Py,{score:t.overall_analysis.total_score,size:140})})]}),n.pacing&&s.jsx(My,{rating:n.pacing.rating,feedback:n.pacing.feedback}),n.tonality&&s.jsx(Dy,{rating:n.tonality.rating,feedback:n.tonality.feedback,onJumpToTimestamp:e}),!t.overall_analysis&&!n.pacing&&!n.tonality&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(oa,{className:"w-12 h-12 text-slate-200 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-500 text-sm",children:"Keine detaillierten Metriken verfgbar."})]})]})}function Z_({audioAnalysis:t,isLoading:e=!1,onJumpToTimestamp:n}){const i=g.useMemo(()=>ua(t,{context:"audio_analysis"}),[t]),r=dT(i);return e?s.jsx(H_,{}):i?i.error?s.jsx(Y_,{message:i.summary||i.errorMessage||"Unbekannter Fehler"}):r&&i.audio_metrics?s.jsx(J_,{audioMetrics:i.audio_metrics,onJumpToTimestamp:n}):s.jsx(X_,{data:i,onJumpToTimestamp:n}):s.jsx(K_,{})}const Q_=({session:t,scenario:e,feedback:n,audioAnalysis:i,coachingComments:r=[],onRetry:o,onCollapse:a,onJumpToTimestamp:l,isCollapsed:c=!1,className:d})=>{const[u,h]=g.useState("coaching"),[p,m]=g.useState(null),{branding:y}=ge(),f=y?.["--header-gradient"]||Q["--header-gradient"],b=y?.["--primary-accent"]||Q["--primary-accent"],S=y?.["--primary-accent-light"]||Q["--primary-accent-light"],C=g.useMemo(()=>n?.rating?.overall?Math.round(n.rating.overall/10*100):null,[n]);return c?s.jsxs(L.div,{initial:{width:0,opacity:0},animate:{width:48,opacity:1},style:{backgroundColor:"white",borderLeft:`1px solid ${x.slate[200]}`,display:"flex",flexDirection:"column",alignItems:"center",padding:"16px 0"},children:[s.jsx(se,{variant:"ghost",size:"icon",onClick:a,style:{marginBottom:"16px"},children:s.jsx(It,{style:{width:"16px",height:"16px"}})}),s.jsx("div",{style:{writingMode:"vertical-rl",fontSize:"12px",color:x.slate[500],fontWeight:500},children:"Feedback Panel"})]}):s.jsxs(L.div,{initial:{width:0,opacity:0},animate:{width:"100%",opacity:1},style:{backgroundColor:"white",borderLeft:`1px solid ${x.slate[200]}`,display:"flex",flexDirection:"column",overflow:"hidden",height:"calc(100vh - 120px)",maxHeight:"800px"},children:[s.jsxs("div",{style:{background:f,padding:"16px",flexShrink:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Os,{style:{width:"20px",height:"20px",color:x.amber[300]}}),s.jsx("span",{style:{color:"white",fontWeight:600,fontSize:"14px"},children:"Rollenspiel abgeschlossen"})]}),s.jsx(se,{size:"sm",onClick:o,style:{backgroundColor:"rgba(255, 255, 255, 0.15)",color:"white",border:"none",fontSize:"12px"},children:"Erneut ben"})]}),C!==null&&s.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"12px",margin:0},children:["Ihre Punktzahl war ",s.jsxs("span",{style:{color:"white",fontWeight:700},children:[C,"%"]})]})]}),s.jsxs("div",{style:{display:"flex",borderBottom:`1px solid ${x.slate[200]}`,flexShrink:0},children:[s.jsx("button",{onClick:a,style:{padding:"12px",borderRight:`1px solid ${x.slate[200]}`,color:x.slate[400],backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:j=>{j.currentTarget.style.backgroundColor=x.slate[50],j.currentTarget.style.color=x.slate[600]},onMouseLeave:j=>{j.currentTarget.style.backgroundColor="transparent",j.currentTarget.style.color=x.slate[400]},title:"Panel einklappen",children:s.jsx(Uk,{style:{width:"16px",height:"16px"}})}),s.jsxs("button",{onClick:()=>h("coaching"),onMouseEnter:()=>m("coaching"),onMouseLeave:()=>m(null),style:{flex:1,padding:"12px 16px",fontSize:"14px",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:u==="coaching"?S:p==="coaching"?x.slate[50]:"transparent",color:u==="coaching"?b:p==="coaching"?x.slate[700]:x.slate[500],borderBottom:u==="coaching"?`2px solid ${b}`:"2px solid transparent"},children:[s.jsx(ze,{style:{width:"16px",height:"16px"}}),"Coaching"]}),s.jsxs("button",{onClick:()=>h("analysen"),onMouseEnter:()=>m("analysen"),onMouseLeave:()=>m(null),style:{flex:1,padding:"12px 16px",fontSize:"14px",fontWeight:500,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"none",cursor:"pointer",transition:"all 0.2s",backgroundColor:u==="analysen"?S:p==="analysen"?x.slate[50]:"transparent",color:u==="analysen"?b:p==="analysen"?x.slate[700]:x.slate[500],borderBottom:u==="analysen"?`2px solid ${b}`:"2px solid transparent"},children:[s.jsx(oa,{style:{width:"16px",height:"16px"}}),"Analysen"]})]}),s.jsx("div",{style:{flex:1,overflowY:"auto"},children:s.jsxs(Ve,{mode:"wait",children:[u==="coaching"&&s.jsx(L.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},style:{padding:"16px"},children:s.jsx(D_,{feedback:n,isLoading:!1})},"coaching"),u==="analysen"&&s.jsx(L.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},style:{padding:"16px"},children:s.jsx(Z_,{audioAnalysis:i,isLoading:!1,onJumpToTimestamp:l})},"analysen")]})})]})};function eN(t,e){const n=g.useRef(null),i=g.useRef(null),[r,o]=g.useState(!1),[a,l]=g.useState(!1),[c,d]=g.useState(0),[u,h]=g.useState(0),[p,m]=g.useState(null),[y,f]=g.useState(!0);g.useEffect(()=>{if(!e)return;const w=kd(t);return console.log(" [AUDIO] Loading audio:",w),f(!0),m(null),fetch(w,{method:"GET",headers:{"X-WP-Nonce":mt()},credentials:"same-origin"}).then(v=>{if(!v.ok)throw new Error(`HTTP ${v.status}`);return v.blob()}).then(v=>{const E=URL.createObjectURL(v),k=new Audio(E);n.current=k,k._objectUrl=E,k.addEventListener("loadedmetadata",()=>{h(k.duration),f(!1)}),k.addEventListener("timeupdate",()=>d(k.currentTime)),k.addEventListener("play",()=>o(!0)),k.addEventListener("pause",()=>o(!1)),k.addEventListener("ended",()=>o(!1)),k.addEventListener("error",()=>{m("Audio konnte nicht abgespielt werden."),f(!1)})}).catch(v=>{console.error(" [AUDIO] Load error:",v),m("Audio nicht verfgbar."),f(!1)}),()=>{n.current&&(n.current.pause(),n.current._objectUrl&&URL.revokeObjectURL(n.current._objectUrl),n.current=null)}},[t,e]);const b=g.useCallback(()=>{n.current&&(r?n.current.pause():n.current.play())},[r]),S=g.useCallback(()=>{n.current&&(n.current.muted=!a,l(!a))},[a]),C=g.useCallback(w=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+w,u)))},[u]),j=g.useCallback(w=>{n.current&&u>0&&(n.current.currentTime=w)},[u]);return{audioRef:n,progressRef:i,isPlaying:r,isMuted:a,currentTime:c,duration:u,audioError:p,isLoading:y,togglePlay:b,toggleMute:S,skip:C,seekToTime:j}}function tN(t,e){return g.useMemo(()=>{if(!t?.length)return-1;let n=-1;for(let i=0;i<t.length&&(t[i].elapsedTime??0)<=e;i++)n=i;return n},[t,e])}function nN({session:t,onBack:e}){const[n,i]=g.useState(t),[r,o]=g.useState(null),[a,l]=g.useState(!0),[c,d]=g.useState(null),[u,h]=g.useState(!1),p=eN(n?.id,n?.conversation_id),m=g.useMemo(()=>vx(n?.feedback_json),[n?.feedback_json]),y=g.useMemo(()=>Sx(n?.audio_analysis_json),[n?.audio_analysis_json]),f=g.useMemo(()=>kx(n?.transcript),[n?.transcript]),b=tN(f,p.currentTime),S=g.useMemo(()=>!m?.timeline||!p.duration?[]:m.timeline.map(E=>({...E,position:E.timestamp/p.duration*100})),[m,p.duration]);g.useEffect(()=>{C()},[t?.id]);const C=async()=>{try{l(!0),d(null);const E=await wx(t.id);if(i(k=>({...E,feedback_json:E.feedback_json||k?.feedback_json,audio_analysis_json:E.audio_analysis_json||k?.audio_analysis_json,transcript:E.transcript||k?.transcript,conversation_id:E.conversation_id||k?.conversation_id})),E.scenario_id)try{const k=await jx(E.scenario_id);o(k)}catch(k){console.warn("Could not load scenario:",k)}}catch(E){console.error("Failed to load session:",E),d(E.message||"Fehler beim Laden der Session")}finally{l(!1)}},j=g.useCallback(E=>{if(!E)return 0;const k=E.split(":");return k.length===2?(parseInt(k[0],10)||0)*60+(parseInt(k[1],10)||0):0},[]),w=g.useCallback(E=>{const k=j(E);console.log(` [SESSION] Jump to ${E} (${k}s)`),p.seekToTime(k),p.audioRef.current&&!p.isPlaying&&p.audioRef.current.play().catch(()=>{})},[j,p]),v=g.useCallback(E=>{const k=f[E];k?.elapsedTime!==void 0&&p.seekToTime(k.elapsedTime)},[f,p]);return a?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(ye,{className:"w-12 h-12 text-ocean-blue-600 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Gesprchsanalyse wird geladen..."})]})}):c?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[s.jsx(ve,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),s.jsx("p",{className:"text-slate-600 mb-4",children:c}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx(se,{variant:"outline",onClick:e,children:"Zurck"}),s.jsx(se,{onClick:C,children:"Erneut versuchen"})]})]})}):s.jsxs("div",{className:"min-h-screen pb-8",children:[s.jsx(__,{session:n,scenario:r,feedback:m}),s.jsx("div",{className:"w-full px-4 lg:px-8 py-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6 items-start",children:[s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[s.jsx(j_,{isLoading:p.isLoading,audioError:p.audioError,isPlaying:p.isPlaying,isMuted:p.isMuted,currentTime:p.currentTime,duration:p.duration,timelineMarkers:S,onTogglePlay:p.togglePlay,onToggleMute:p.toggleMute,onSkip:p.skip,onSeek:p.seekToTime,progressRef:p.progressRef}),s.jsx(E_,{transcript:f,activeIndex:b,isPlaying:p.isPlaying,scenario:r,onSeekToEntry:v})]}),s.jsx("div",{className:oe("lg:col-span-2 self-start",u&&"lg:col-span-1"),children:s.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:s.jsx(Q_,{session:n,scenario:r,feedback:m,audioAnalysis:y,coachingComments:[],onRetry:()=>{r&&(window.location.href=`?scenario=${r.id}`)},onCollapse:()=>h(!u),onJumpToTimestamp:w,isCollapsed:u})})})]})})]})}const bf=768,iN=()=>{const[t,e]=g.useState(typeof window<"u"?window.innerWidth<bf:!1);return ta.useEffect(()=>{const n=()=>{e(window.innerWidth<bf)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t},io=({label:t,icon:e,isSelected:n,onClick:i,color:r,bgColor:o,primaryAccent:a})=>{const l=r||a,c=o||`${a}15`;return s.jsxs("button",{onClick:i,style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"20px",fontSize:"13px",fontWeight:600,border:`2px solid ${n?l:x.slate[200]}`,backgroundColor:n?c:"white",color:n?l:x.slate[600],cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},children:[e&&s.jsx(e,{style:{width:"14px",height:"14px"}}),t]})},sN=({count:t})=>t===0?null:s.jsx("span",{style:{position:"absolute",top:"-4px",right:"-4px",minWidth:"18px",height:"18px",padding:"0 5px",borderRadius:"9px",backgroundColor:"#ef4444",color:"white",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center"},children:t}),rN=({searchQuery:t,onSearchChange:e,searchPlaceholder:n="Durchsuchen...",showSearch:i=!0,categories:r=[],selectedCategory:o,onCategoryChange:a,showCategories:l=!0,difficultyOptions:c=[],selectedDifficulty:d,onDifficultyChange:u,showDifficulty:h=!1,viewMode:p,onViewModeChange:m,showViewToggle:y=!0,renderCustomFilters:f,children:b})=>{const[S,C]=g.useState(!1),j=iN(),{branding:w}=ge(),v=w?.["--primary-accent"]||Q["--primary-accent"],E=[o?1:0,d&&d!=="all"?1:0,t?.trim()?1:0].reduce((k,T)=>k+T,0);return j?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1"},children:[s.jsx(ei,{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:x.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:k=>e(k.target.value),style:{width:"100%",padding:"10px 12px 10px 38px",borderRadius:"10px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",outline:"none"}})]}),s.jsxs("button",{onClick:()=>C(!0),style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"44px",height:"44px",borderRadius:"10px",border:`1px solid ${E>0?v:x.slate[200]}`,backgroundColor:E>0?`${v}10`:"white",cursor:"pointer",flexShrink:0},children:[s.jsx(lr,{style:{width:"18px",height:"18px",color:E>0?v:x.slate[500]}}),s.jsx(sN,{count:E})]}),y&&p&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2px",padding:"3px",backgroundColor:x.slate[100],borderRadius:"8px",flexShrink:0},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:"6px",borderRadius:"5px",border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Kn,{style:{width:"14px",height:"14px",color:p==="grid"?v:x.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:"6px",borderRadius:"5px",border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Gl,{style:{width:"14px",height:"14px",color:p==="list"?v:x.slate[500]}})})]})]}),s.jsx(Kt,{open:S,onOpenChange:C,children:s.jsxs(Yt,{style:{position:"fixed",bottom:0,left:0,right:0,top:"auto",transform:"none",maxWidth:"100%",width:"100%",borderRadius:"20px 20px 0 0",maxHeight:"80vh",overflow:"auto"},children:[s.jsx(Jt,{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs(Xt,{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(lr,{style:{width:"20px",height:"20px",color:v}}),"Filter"]}),E>0&&s.jsx("button",{onClick:()=>{a?.(null),u?.("all"),e?.("")},style:{padding:"6px 12px",borderRadius:"6px",border:"none",backgroundColor:x.slate[100],color:x.slate[600],fontSize:"13px",fontWeight:500,cursor:"pointer"},children:"Zurcksetzen"})]})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",padding:"8px 0"},children:[h&&c.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"8px"},children:"Schwierigkeit"}),s.jsx("select",{value:d,onChange:k=>u(k.target.value),style:{width:"100%",padding:"12px 14px",borderRadius:"10px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",paddingRight:"40px"},children:c.map(k=>s.jsx("option",{value:k.value,children:k.label},k.value))})]}),l&&r.length>0&&s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:600,color:x.slate[700],marginBottom:"8px"},children:"Kategorie"}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[s.jsx(io,{label:"Alle",icon:Kn,isSelected:!o,onClick:()=>a(null),primaryAccent:v}),r.map(k=>s.jsx(io,{label:k.label,icon:k.icon,isSelected:o===k.key,onClick:()=>a(k.key),color:k.color,bgColor:k.bgColor,primaryAccent:v},k.key))]})]}),f&&s.jsx("div",{children:f()})]}),s.jsx("button",{onClick:()=>C(!1),style:{width:"100%",padding:"14px",marginTop:"12px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${v} 0%, ${v}dd 100%)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer"},children:"Filter anwenden"})]})}),b]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",alignItems:"center"},children:[i&&s.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[s.jsx(ei,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:x.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:n,value:t,onChange:k=>e(k.target.value),style:{width:"100%",padding:"12px 14px 12px 44px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:k=>{k.target.style.borderColor=v,k.target.style.boxShadow=`0 0 0 3px ${v}20`},onBlur:k=>{k.target.style.borderColor=x.slate[200],k.target.style.boxShadow="none"}})]}),h&&c.length>0&&s.jsxs("div",{style:{position:"relative",minWidth:"180px"},children:[s.jsx(lr,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:x.slate[400],pointerEvents:"none"}}),s.jsx("select",{value:d,onChange:k=>u(k.target.value),style:{width:"100%",padding:"12px 14px 12px 40px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",paddingRight:"40px"},children:c.map(k=>s.jsx("option",{value:k.value,children:k.label},k.value))})]}),f&&f(),y&&p&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px",backgroundColor:x.slate[100],borderRadius:"8px"},children:[s.jsx("button",{onClick:()=>m("grid"),style:{padding:"8px",borderRadius:"6px",border:"none",cursor:"pointer",backgroundColor:p==="grid"?"#ffffff":"transparent",boxShadow:p==="grid"?"0 1px 2px rgba(0, 0, 0, 0.05)":"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Kachelansicht",children:s.jsx(Kn,{style:{width:"16px",height:"16px",color:p==="grid"?v:x.slate[500]}})}),s.jsx("button",{onClick:()=>m("list"),style:{padding:"8px",borderRadius:"6px",border:"none",cursor:"pointer",backgroundColor:p==="list"?"#ffffff":"transparent",boxShadow:p==="list"?"0 1px 2px rgba(0, 0, 0, 0.05)":"none",display:"flex",alignItems:"center",justifyContent:"center"},title:"Listenansicht",children:s.jsx(Gl,{style:{width:"16px",height:"16px",color:p==="list"?v:x.slate[500]}})})]})]}),l&&r.length>0&&s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[s.jsx(io,{label:"Alle",icon:Kn,isSelected:!o,onClick:()=>a(null),primaryAccent:v}),r.map(k=>s.jsx(io,{label:k.label,icon:k.icon,isSelected:o===k.key,onClick:()=>a(k.key),color:k.color,bgColor:k.bgColor,primaryAccent:v},k.key))]}),b]})},oN={briefcase:Qt,banknote:ni,user:xt,presentation:dd,target:De,mic:Xe},aN={Briefcase:Qt,Target:De,TrendingUp:Vt,MessageCircle:Ei},tr=t=>aN[t]||Qt,lN=({category:t})=>{const e=gx(t),n=Vj(e);if(!n)return null;const i=tr(n.icon);return s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:n.bgColor,color:n.color},children:[s.jsx(i,{style:{width:"12px",height:"12px"}}),n.shortLabel]})},vf=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>{const{branding:o}=ge(),a=o?.["--header-gradient"]||Q["--header-gradient"],l=o?.["--header-text"]||Q["--header-text"],c=o?.["--primary-accent"]||Q["--primary-accent"],[d,u]=g.useState([]),[h,p]=g.useState(null),[m,y]=g.useState("grid"),[f,b]=g.useState(""),[S,C]=g.useState("all"),j=R=>{if(!e){console.log(" [SimulatorDashboard] Auth required - storing pending scenario:",R.title),i&&i(R),n&&n(()=>{},null);return}t(R)},[w,v]=g.useState(!0),[E,k]=g.useState(null),T=g.useMemo(()=>{let R=[...d];if(h&&(R=R.filter(_=>gx(_.category)===h)),f.trim()){const _=f.toLowerCase();R=R.filter(A=>A.title?.toLowerCase().includes(_)||A.description?.toLowerCase().includes(_))}return S!=="all"&&(R=R.filter(_=>_.difficulty===S)),R},[d,h,f,S]);g.useEffect(()=>{console.log(" [SimulatorDashboard] Loading scenarios..."),N()},[]);const N=async()=>{try{v(!0),k(null);const R=await fetch(`${Pn()}/simulator/scenarios`,{headers:{"X-WP-Nonce":mt()},credentials:"same-origin"});if(!R.ok)throw new Error("Fehler beim Laden der Szenarien");const _=await R.json();if(_.success&&_.data?.scenarios)u(_.data.scenarios);else throw new Error("Keine Szenarien gefunden")}catch(R){console.error("Error loading scenarios:",R),k(R.message||"Fehler beim Laden der Szenarien")}finally{v(!1)}};return w?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(ye,{style:{width:"48px",height:"48px",color:c,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{color:x.slate[600],fontSize:"16px"},children:"Szenarien werden geladen..."}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}):E?s.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 20px",gap:"16px"},children:[s.jsx(ve,{style:{width:"48px",height:"48px",color:"#ef4444"}}),s.jsx("p",{style:{color:"#ef4444",fontSize:"16px",textAlign:"center"},children:E}),s.jsx("button",{onClick:N,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:c,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"Erneut versuchen"})]}):s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:a,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(st,{style:{width:"24px",height:"24px",color:l}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:x.slate[900],margin:0},children:"Szenario-Training"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0},children:"Trainiere wichtige Karriere-Skills mit KI-Feedback"})]})]}),e&&r&&s.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${c}`,backgroundColor:"white",color:c,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(_s,{size:18}),"Meine Szenario-Trainings"]})]}),s.jsx("div",{style:{marginTop:"24px"},children:s.jsx(rN,{searchQuery:f,onSearchChange:b,searchPlaceholder:"Szenarien durchsuchen...",categories:[{key:Pe.CAREER,...Tn[Pe.CAREER],icon:tr(Tn[Pe.CAREER].icon)},{key:Pe.LEADERSHIP,...Tn[Pe.LEADERSHIP],icon:tr(Tn[Pe.LEADERSHIP].icon)},{key:Pe.SALES,...Tn[Pe.SALES],icon:tr(Tn[Pe.SALES].icon)},{key:Pe.COMMUNICATION,...Tn[Pe.COMMUNICATION],icon:tr(Tn[Pe.COMMUNICATION].icon)}],selectedCategory:h,onCategoryChange:p,difficultyOptions:[{value:"all",label:"Alle Schwierigkeiten"},{value:"easy",label:"Einfach"},{value:"beginner",label:"Einsteiger"},{value:"medium",label:"Mittel"},{value:"intermediate",label:"Fortgeschritten"},{value:"hard",label:"Schwer"},{value:"advanced",label:"Experte"}],selectedDifficulty:S,onDifficultyChange:C,showDifficulty:!0,viewMode:m,onViewModeChange:y})})]}),s.jsx("div",{children:s.jsx(Wr,{minCardWidth:"340px",viewMode:m,children:T.map(R=>{const _=oN[R.icon]||Qt;return s.jsx(Ur,{title:R.title,description:R.description,difficulty:R.difficulty,icon:_,categoryBadge:R.category?s.jsx(lN,{category:R.category}):null,meta:[{text:`${R.question_count_min}-${R.question_count_max} Fragen`},{icon:He,text:`${Math.round(R.time_limit_per_question/60)} Min/Frage`}],action:{label:"Starten",icon:Vt},onClick:()=>j(R),viewMode:m},R.id)})})}),T.length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:x.slate[600]},children:[s.jsx(Xe,{style:{width:"48px",height:"48px",marginBottom:"16px",opacity:.5}}),s.jsx("p",{children:h?`Keine Szenarien in der Kategorie "${Tn[h]?.shortLabel||h}" gefunden.`:"Keine Trainingsszenarien verfgbar."}),h&&d.length>0&&s.jsx("button",{onClick:()=>p(null),style:{marginTop:"16px",padding:"10px 20px",borderRadius:"20px",border:`2px solid ${c}`,backgroundColor:"white",color:c,fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"Alle Szenarien anzeigen"})]})]})},Ly=({isLoading:t,message:e="Wird geladen...",subMessage:n=null})=>{const{branding:i}=ge(),r=i?.["--header-gradient"]||Q["--header-gradient"];return s.jsx(Ve,{children:t&&s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:s.jsxs(L.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.3,delay:.1},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"40px 60px",backgroundColor:"white",borderRadius:"24px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.15)"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:r,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ye,{style:{width:"32px",height:"32px",color:"white",animation:"spin 1s linear infinite"}})}),s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("p",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:e}),n&&s.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginTop:"8px",margin:"8px 0 0 0"},children:n})]})]})})})},cN=({field:t,value:e,onChange:n,error:i,focusColor:r})=>{const o=r||"#4a9ec9",a={width:"100%",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${i?x.red[500]:x.slate[200]}`,fontSize:"16px",color:x.slate[900],backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},l={borderColor:o,boxShadow:`0 0 0 3px ${o}1a`},c=h=>{Object.assign(h.target.style,l),setTimeout(()=>{const p=h.target;if(p){const m=p.closest("div");m&&m.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=h=>{h.target.style.borderColor=i?x.red[500]:x.slate[200],h.target.style.boxShadow="none"},u=()=>{switch(t.type){case"text":return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d});case"textarea":return s.jsx("textarea",{value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",rows:4,style:{...a,resize:"vertical",minHeight:"100px"},onFocus:c,onBlur:d});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:h=>n(t.key,h.target.value),style:{...a,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:c,onBlur:d,children:[s.jsx("option",{value:"",children:"Bitte whlen..."}),t.options?.map(h=>s.jsx("option",{value:h.value,children:h.label},h.value))]});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:a,onFocus:c,onBlur:d});default:return s.jsx("input",{type:"text",value:e||"",onChange:h=>n(t.key,h.target.value),placeholder:t.placeholder||"",style:a,onFocus:c,onBlur:d})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:600,color:x.slate[700]},children:[t.label,t.required&&s.jsx("span",{style:{color:x.red[500],marginLeft:"4px"},children:"*"})]}),u(),i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:x.red[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(ve,{style:{width:"14px",height:"14px"}}),i]}),t.hint&&!i&&s.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:x.slate[500],display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(Ns,{style:{width:"14px",height:"14px"}}),t.hint]})]})},dN=({scenario:t,onBack:e,onStart:n,preloadedQuestions:i})=>{const[r,o]=g.useState({}),[a,l]=g.useState({}),[c,d]=g.useState(!1),[u,h]=g.useState(null),[p,m]=g.useState(null),[y,f]=g.useState(!1),{branding:b,demoCode:S}=ge(),C=b?.["--header-gradient"]||Q["--header-gradient"],j=b?.["--button-gradient"]||C,w=b?.["--primary-accent"]||Q["--primary-accent"],v=b?.["--primary-accent-light"]||Q["--primary-accent-light"],E=ta.useMemo(()=>{if(!t?.input_configuration)return[];try{const R=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(R)?R.filter(_=>_.user_input!==!1):[]}catch(R){return console.error("Error parsing input_configuration:",R),[]}},[t?.input_configuration]);g.useEffect(()=>{const R={};E.forEach(_=>{_.default&&(R[_.key]=_.default)}),o(R)},[E]);const k=(R,_)=>{o(A=>({...A,[R]:_})),a[R]&&l(A=>{const Y={...A};return delete Y[R],Y})},T=()=>{const R={};return E.forEach(_=>{const A=r[_.key];if(_.required&&(!A||A.trim()==="")){R[_.key]="Dieses Feld ist erforderlich";return}if(!(!A||A.trim()==="")&&_.validation){const{minLength:Y,maxLength:H,min:$,max:K,pattern:O}=_.validation;Y&&A.length<Y&&(R[_.key]=`Mindestens ${Y} Zeichen erforderlich`),H&&A.length>H&&(R[_.key]=`Maximal ${H} Zeichen erlaubt`),$!==void 0&&Number(A)<$&&(R[_.key]=`Mindestens ${$}`),K!==void 0&&Number(A)>K&&(R[_.key]=`Maximal ${K}`),O&&!new RegExp(O).test(A)&&(R[_.key]="Ungltiges Format")}}),l(R),Object.keys(R).length===0},N=async R=>{if(R.preventDefault(),h(null),!!T()){d(!0);try{const _=await fe.createSimulatorSession({scenario_id:t.id,variables:r,demo_code:S||null,questions:i||null});if(!_.success)throw new Error(_.message||"Fehler beim Erstellen der Session");const A=_.data.session;let Y;if(i&&i.length>0)console.log(" [SimulatorWizard] Using preloaded questions for repeat session"),Y=i,await fe.updateSimulatorSessionQuestions(A.id,Y);else{const H=await fe.generateSimulatorQuestions(A.id);if(!H.success)throw new Error(H.message||"Fehler beim Generieren der Fragen");Y=H.data.questions}n({session:{...A,questions_json:Y},questions:Y,scenario:t,variables:r,selectedMicrophoneId:p})}catch(_){console.error("Error starting session:",_),h(_.message||"Ein Fehler ist aufgetreten")}finally{d(!1)}}};return s.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:x.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:R=>R.target.style.background=x.slate[100],onMouseLeave:R=>R.target.style.background="transparent",children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:C,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(st,{style:{width:"28px",height:"28px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900],margin:0},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:"4px 0 0 0"},children:"Konfiguriere dein Training"})]})]})]}),s.jsx("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:x.slate[100],marginBottom:"24px"},children:s.jsx("p",{style:{fontSize:"14px",color:x.slate[700],margin:0,lineHeight:1.6},children:t.description})}),s.jsxs("form",{onSubmit:N,children:[E.length>0?E.map(R=>s.jsx(cN,{field:R,value:r[R.key],onChange:k,error:a[R.key],focusColor:w},R.key)):s.jsxs("div",{style:{padding:"24px",textAlign:"center",color:x.slate[500]},children:[s.jsx(Zt,{style:{width:"32px",height:"32px",marginBottom:"12px",opacity:.5}}),s.jsx("p",{style:{margin:0},children:"Keine zustzliche Konfiguration erforderlich."})]}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:v,marginTop:"24px",marginBottom:"24px",display:"flex",gap:"20px",flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:"Fragen"}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900]},children:[t.question_count_min,"-",t.question_count_max]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:"Zeit pro Frage"}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900]},children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Xe,{style:{width:"22px",height:"22px",color:w}}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900],margin:0},children:"Mikrofon auswhlen"})]}),s.jsx(Sa,{selectedDeviceId:p,onDeviceChange:m,onTestClick:()=>f(!0)})]}),u&&s.jsxs("div",{style:{padding:"12px 16px",borderRadius:"12px",backgroundColor:x.red[100],color:x.red[500],marginBottom:"20px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ve,{style:{width:"18px",height:"18px"}}),u]}),s.jsxs("button",{type:"submit",disabled:c,style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:c?x.slate[300]:j,color:"white",fontSize:"16px",fontWeight:600,cursor:c?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:c?"none":`0 4px 12px ${w}4d`},onMouseEnter:R=>{c||(R.target.style.transform="translateY(-2px)",R.target.style.boxShadow=`0 6px 16px ${w}66`)},onMouseLeave:R=>{R.target.style.transform="none",R.target.style.boxShadow=c?"none":`0 4px 12px ${w}4d`},children:["Training starten",s.jsx(am,{style:{width:"20px",height:"20px"}})]})]}),s.jsx(ka,{isOpen:y,onClose:()=>f(!1),deviceId:p}),s.jsx(Ly,{isLoading:c,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},so=({score:t,label:e,size:n="normal",primaryAccent:i})=>{const r=t!=null?t*10:null,a=(c=>c>=80?x.green[500]:c>=60?i:c>=40?x.amber[500]:x.red[500])(r),l=n==="large";return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[s.jsx("div",{style:{width:l?"80px":"56px",height:l?"80px":"56px",borderRadius:"50%",backgroundColor:`${a}15`,border:`3px solid ${a}`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("span",{style:{fontSize:l?"28px":"20px",fontWeight:700,color:a},children:r!=null?Math.round(r):"-"})}),s.jsx("span",{style:{fontSize:l?"14px":"12px",color:x.slate[600],fontWeight:500},children:e})]})},Xs=({title:t,icon:e,children:n,defaultOpen:i=!0,primaryAccent:r})=>{const[o,a]=g.useState(i);return s.jsxs("div",{style:{borderRadius:"12px",border:`1px solid ${x.slate[200]}`,backgroundColor:"white",overflow:"hidden",marginBottom:"16px"},children:[s.jsxs("button",{onClick:()=>a(!o),style:{width:"100%",padding:"16px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(e,{style:{width:"20px",height:"20px",color:r}}),s.jsx("span",{style:{fontSize:"15px",fontWeight:600,color:x.slate[800]},children:t})]}),o?s.jsx(ar,{style:{width:"20px",height:"20px",color:x.slate[400]}}):s.jsx(jt,{style:{width:"20px",height:"20px",color:x.slate[400]}})]}),o&&s.jsx("div",{style:{padding:"0 20px 20px 20px",borderTop:`1px solid ${x.slate[100]}`,paddingTop:"16px"},children:n})]})},yl=({text:t,type:e,primaryAccent:n,primaryAccentLight:i})=>{const r={strength:{icon:Fo,color:x.green[500],bg:x.green[100]},improvement:{icon:Mn,color:x.amber[500],bg:x.amber[100]},tip:{icon:Ce,color:n,bg:i}},{icon:o,color:a,bg:l}=r[e]||r.tip;return s.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px",borderRadius:"10px",backgroundColor:l,marginBottom:"8px"},children:[s.jsx(o,{style:{width:"18px",height:"18px",color:a,flexShrink:0,marginTop:"2px"}}),s.jsx("span",{style:{fontSize:"14px",color:x.slate[700],lineHeight:1.5},children:t})]})},uN=({metrics:t})=>{if(!t)return null;const n=(r=>{switch(r){case"optimal":return{label:"Optimal",color:x.green[500]};case"zu_schnell":return{label:"Zu schnell",color:x.amber[500]};case"zu_langsam":return{label:"Zu langsam",color:x.amber[500]};default:return{label:r||"N/A",color:x.slate[500]}}})(t.speech_rate),i=r=>{switch(r){case"niedrig":return x.green[500];case"mittel":return x.amber[500];case"hoch":return x.red[500];default:return x.slate[500]}};return s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px"},children:[s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:x.slate[100]},children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block",marginBottom:"4px"},children:"Sprechtempo"}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600,color:n.color},children:n.label})]}),t.filler_words&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:x.slate[100]},children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block",marginBottom:"4px"},children:"Fllwrter"}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:i(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&s.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:x.slate[100]},children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:x.slate[200],borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?x.green[500]:x.amber[500],borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700]},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:x.slate[100]},children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block",marginBottom:"4px"},children:"Klarheit"}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("div",{style:{flex:1,height:"8px",backgroundColor:x.slate[200],borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?x.green[500]:x.amber[500],borderRadius:"4px"}})}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700]},children:[t.clarity_score,"%"]})]})]}),t.notes&&s.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:x.purple[100],fontSize:"14px",color:x.slate[700],lineHeight:1.5},children:[" ",t.notes]})]})},hN=({transcript:t,feedback:e,audioMetrics:n,onRetry:i,onNext:r,onComplete:o,isLastQuestion:a,hideButtons:l=!1})=>{const{branding:c}=ge(),d=c?.["--button-gradient"]||c?.["--header-gradient"]||Q["--header-gradient"],u=c?.["--primary-accent"]||Q["--primary-accent"],h=c?.["--primary-accent-light"]||Q["--primary-accent-light"],p=typeof e=="string"?JSON.parse(e):e;return s.jsxs("div",{style:{backgroundColor:x.slate[100],borderRadius:"16px",padding:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:"20px",backgroundColor:"white",borderRadius:"12px"},children:[s.jsx(so,{score:p?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:u}),s.jsxs("div",{style:{flex:1},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:x.slate[900],margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0,lineHeight:1.5},children:p?.summary||"Deine Antwort wurde analysiert."})]})]}),p?.scores&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:"white",borderRadius:"12px"},children:[s.jsx(so,{score:p.scores.content,label:"Inhalt",primaryAccent:u}),s.jsx(so,{score:p.scores.structure,label:"Struktur",primaryAccent:u}),s.jsx(so,{score:p.scores.relevance,label:"Relevanz",primaryAccent:u})]}),s.jsx(Xs,{title:"Transkript",icon:ze,defaultOpen:!0,primaryAccent:u,children:s.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:x.slate[100],fontStyle:"italic",color:x.slate[700],lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verfgbar.",'"']})}),p?.strengths?.length>0&&s.jsx(Xs,{title:"Strken",icon:Fo,defaultOpen:!0,primaryAccent:u,children:p.strengths.map((m,y)=>s.jsx(yl,{text:m,type:"strength",primaryAccent:u,primaryAccentLight:h},y))}),p?.improvements?.length>0&&s.jsx(Xs,{title:"Verbesserungen",icon:Mn,defaultOpen:!0,primaryAccent:u,children:p.improvements.map((m,y)=>s.jsx(yl,{text:m,type:"improvement",primaryAccent:u,primaryAccentLight:h},y))}),p?.tips?.length>0&&s.jsx(Xs,{title:"Tipps",icon:Ce,defaultOpen:!1,primaryAccent:u,children:p.tips.map((m,y)=>s.jsx(yl,{text:m,type:"tip",primaryAccent:u,primaryAccentLight:h},y))}),n&&s.jsx(Xs,{title:"Sprechanalyse",icon:Xe,defaultOpen:!1,primaryAccent:u,children:s.jsx(uN,{metrics:n})}),!l&&s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[i&&s.jsxs("button",{onClick:i,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${x.slate[300]}`,backgroundColor:"white",color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:m=>{m.target.style.borderColor=u,m.target.style.color=u},onMouseLeave:m=>{m.target.style.borderColor=x.slate[300],m.target.style.color=x.slate[700]},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),s.jsx("button",{onClick:a?o:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:d,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${u}4d`,transition:"all 0.2s"},onMouseEnter:m=>{m.target.style.transform="translateY(-2px)",m.target.style.boxShadow=`0 6px 16px ${u}66`},onMouseLeave:m=>{m.target.style.transform="none",m.target.style.boxShadow=`0 4px 12px ${u}4d`},children:a?s.jsxs(s.Fragment,{children:[s.jsx(Os,{style:{width:"18px",height:"18px"}}),"Training abschlieen"]}):s.jsxs(s.Fragment,{children:["Nchste Frage",s.jsx(It,{style:{width:"18px",height:"18px"}})]})})]})]})},pN=({current:t,total:e,answeredQuestions:n,primaryAccent:i,labels:r})=>{const o=(t+1)/e*100,a=r?.questionFallback||"Frage";return s.jsxs("div",{style:{marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700]},children:r?.questionCounter?r.questionCounter(t+1,e):`${a} ${t+1} von ${e}`}),s.jsxs("span",{style:{fontSize:"14px",color:x.slate[500]},children:[Math.round(o),"% abgeschlossen"]})]}),s.jsx("div",{style:{height:"8px",backgroundColor:x.slate[200],borderRadius:"4px",overflow:"hidden",marginBottom:"12px"},children:s.jsx(L.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.3},style:{height:"100%",background:i,borderRadius:"4px"}})}),s.jsx("div",{style:{display:"flex",gap:"6px",justifyContent:"center"},children:Array.from({length:e},(l,c)=>{const d=n.includes(c),u=c===t;return s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:u?i:d?x.green[500]:x.slate[300],transition:"all 0.2s"},title:`${a} ${c+1}${d?" (beantwortet)":""}`},c)})})]})},fN=({tips:t,primaryAccent:e,tipsLabel:n})=>{const[i,r]=g.useState(!0);return!t||t.length===0?null:s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",border:"1px solid #e2e8f0",overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>r(!i),style:{width:"100%",padding:"16px 24px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:600,color:"#0f172a"},children:[s.jsx(Ce,{size:18,color:e}),n||"Tipps fr diese Frage"]}),s.jsx(jt,{size:18,color:"#64748b",style:{transform:i?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(Ve,{children:i&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 24px 24px"},children:t.map((o,a)=>s.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 16px",borderRadius:"10px",backgroundColor:x.amber[100]+"60",marginBottom:a<t.length-1?"8px":0},children:[s.jsx(Ce,{style:{width:"16px",height:"16px",color:x.amber[500],flexShrink:0,marginTop:"2px"}}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[700],margin:0,lineHeight:1.5},children:o.replace(/^Tipp \d+:\s*/i,"")})]},a))})})})]})},gN=({seconds:t,maxSeconds:e,isRecording:n})=>{const i=l=>{const c=Math.floor(l/60),d=l%60;return`${c}:${d.toString().padStart(2,"0")}`},r=e>0?t/e*100:0,o=r>75,a=r>90;return s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:a?x.red[100]:o?x.amber[100]:x.slate[100]},children:[s.jsx(He,{style:{width:"20px",height:"20px",color:a?x.red[500]:o?x.amber[500]:x.slate[600]}}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,fontFamily:"monospace",color:a?x.red[500]:o?x.amber[500]:x.slate[700]},children:i(t)}),s.jsxs("span",{style:{fontSize:"14px",color:x.slate[500]},children:["/ ",i(e)]})]})},Sf=({onRecordingComplete:t,timeLimit:e,disabled:n,deviceId:i,themedGradient:r,primaryAccent:o,isSubmitting:a,labels:l})=>{const[c,d]=g.useState("idle"),[u,h]=g.useState(0),[p,m]=g.useState(0),[y,f]=g.useState(!1),b=g.useRef(null),S=g.useRef([]),C=g.useRef(null),j=g.useRef(null),w=g.useRef(null),v=g.useRef(null),E=g.useRef(null),k=g.useRef(0);g.useEffect(()=>()=>{T()},[]),g.useEffect(()=>{c==="recording"&&u>=e&&A()},[u,e,c]);const T=()=>{C.current&&clearInterval(C.current),v.current&&cancelAnimationFrame(v.current),j.current&&(j.current.close(),j.current=null),E.current&&(E.current.getTracks().forEach(H=>H.stop()),E.current=null)},N=async()=>{try{f(!1),S.current=[],h(0);const H=i?{deviceId:{exact:i}}:!0,$=await navigator.mediaDevices.getUserMedia({audio:H});E.current=$,j.current=new(window.AudioContext||window.webkitAudioContext),w.current=j.current.createAnalyser(),j.current.createMediaStreamSource($).connect(w.current),w.current.fftSize=256;const O=()=>{if(w.current&&c==="recording"){const F=new Uint8Array(w.current.frequencyBinCount);w.current.getByteFrequencyData(F);const D=F.reduce((B,G)=>B+G)/F.length;m(D/255)}v.current=requestAnimationFrame(O)};O();const P=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";b.current=new MediaRecorder($,{mimeType:P}),b.current.ondataavailable=F=>{F.data.size>0&&S.current.push(F.data)},b.current.onstop=()=>{const F=new Blob(S.current,{type:P});t(F,k.current)},b.current.start(1e3),d("recording"),C.current=setInterval(()=>{h(F=>F+1)},1e3)}catch(H){console.error("Error starting recording:",H),(H.name==="NotAllowedError"||H.name==="PermissionDeniedError")&&f(!0)}},R=()=>{b.current&&b.current.state==="recording"&&(b.current.pause(),d("paused"),C.current&&(clearInterval(C.current),C.current=null),m(0))},_=()=>{b.current&&b.current.state==="paused"&&(b.current.resume(),d("recording"),C.current=setInterval(()=>{h(H=>H+1)},1e3))},A=()=>{k.current=u,C.current&&(clearInterval(C.current),C.current=null),v.current&&(cancelAnimationFrame(v.current),v.current=null),j.current&&(j.current.close(),j.current=null),b.current&&b.current.state!=="inactive"&&b.current.stop(),E.current&&(E.current.getTracks().forEach(H=>H.stop()),E.current=null),d("idle"),m(0),h(0)},Y=()=>{c==="idle"?N():c==="recording"?R():c==="paused"&&_()};return y?s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:x.red[100],textAlign:"center"},children:[s.jsx(Fk,{style:{width:"48px",height:"48px",color:x.red[500],marginBottom:"12px"}}),s.jsx("p",{style:{color:x.red[500],fontWeight:600,margin:0},children:"Mikrofonzugriff verweigert"}),s.jsx("p",{style:{color:x.slate[600],fontSize:"14px",marginTop:"8px"},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]}):s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:s.jsx(gN,{seconds:u,maxSeconds:e,isRecording:c==="recording"})}),c==="recording"&&s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"4px",height:"60px",marginBottom:"24px"},children:[...Array(20)].map((H,$)=>{const K=Math.max(8,Math.min(50,p*100*Math.random()*2));return s.jsx("div",{style:{width:"6px",height:`${K}px`,backgroundColor:o,borderRadius:"3px",transition:"height 0.1s ease"}},$)})}),c==="paused"&&s.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"60px",marginBottom:"24px",color:x.amber[500]},children:[s.jsx(Xe,{size:24}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600},children:"Aufnahme pausiert"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[s.jsxs("button",{onClick:Y,disabled:n||a,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:"14px 28px",borderRadius:"12px",border:"none",background:c==="idle"?n||a?x.slate[300]:"#ef4444":c==="recording"?x.amber[500]:x.green[500],color:"white",fontSize:"16px",fontWeight:600,cursor:n||a?"not-allowed":"pointer",boxShadow:n||a?"none":"0 4px 14px rgba(0, 0, 0, 0.2)"},children:[c==="idle"&&s.jsxs(s.Fragment,{children:[s.jsx(Xe,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]}),c==="recording"&&s.jsxs(s.Fragment,{children:[s.jsx(Sr,{style:{width:"18px",height:"18px"}}),"Pausieren"]}),c==="paused"&&s.jsxs(s.Fragment,{children:[s.jsx($t,{style:{width:"18px",height:"18px"}}),"Fortsetzen"]})]}),(c==="recording"||c==="paused")&&s.jsxs("button",{onClick:A,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",backgroundColor:x.slate[100],color:x.slate[900],fontSize:"16px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Zt,{style:{width:"18px",height:"18px",color:x.green[500]}}),l?.submitButton||"Antwort abgeben"]})]}),c==="idle"&&!a&&s.jsx("p",{style:{textAlign:"center",marginTop:"16px",color:x.slate[500],fontSize:"14px"},children:l?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"24px"},children:[s.jsx(ye,{style:{width:"32px",height:"32px",color:o,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"12px",color:x.slate[700],fontSize:"14px"},children:l?.analyzing||"Antwort wird analysiert..."})]}),s.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      `})]})},mN=({scenario:t,variables:e,questions:n,onStart:i,onBack:r,selectedMicrophoneId:o,onMicrophoneChange:a,onMicrophoneTest:l,themedGradient:c,primaryAccent:d,primaryAccentLight:u})=>{const h=t?.mode==="SIMULATION",p=h?"Situationen":"Fragen",m=h?"Zeit pro Situation":"Zeit pro Frage",y=[{icon:De,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fr Beispiele aus deiner Erfahrung."},{icon:He,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${h?"Situation":"Frage"}. ${h?"Reagiere":"Antworte"} przise, aber ausfhrlich genug.`},{icon:Xe,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vllig in Ordnung."},{icon:ze,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mglich."}],f=e?Object.entries(e).filter(([b,S])=>S&&S.trim&&S.trim()!=="").map(([b,S])=>({label:b.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase()),value:S})):[];return s.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:r,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:x.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px"},children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:c,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ce,{style:{width:"32px",height:"32px",color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:x.slate[900],margin:0},children:"Vorbereitung"}),s.jsxs("p",{style:{fontSize:"16px",color:x.slate[600],margin:"4px 0 0 0"},children:[t.title,"  ",n.length," ",p]})]})]})]}),f.length>0&&s.jsxs("div",{style:{padding:"20px",borderRadius:"16px",backgroundColor:u,marginBottom:"24px"},children:[s.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:d,margin:"0 0 12px 0",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dein Profil"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:f.map((b,S)=>s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:b.label}),s.jsx("span",{style:{fontSize:"15px",fontWeight:500,color:x.slate[800]},children:b.value})]},S))})]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[s.jsx(Xe,{style:{width:"22px",height:"22px",color:d}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900],margin:0},children:"Mikrofon testen"})]}),s.jsx(Sa,{selectedDeviceId:o,onDeviceChange:a,onTestClick:l})]}),s.jsxs("button",{onClick:i,style:{width:"100%",padding:"18px 28px",borderRadius:"14px",border:"none",background:c,color:"white",fontSize:"18px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:`0 4px 12px ${d}4d`,marginBottom:"24px"},children:[s.jsx($t,{style:{width:"24px",height:"24px"}}),"Gesprch starten"]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`,marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[s.jsx(Ce,{style:{width:"22px",height:"22px",color:x.amber[500]}}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900],margin:0},children:"Tipps fr dein Gesprch"})]}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:y.map((b,S)=>s.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"12px",backgroundColor:x.slate[50]},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:u,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(b.icon,{style:{width:"22px",height:"22px",color:d}})}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:x.slate[800],margin:"0 0 4px 0"},children:b.title}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0,lineHeight:1.5},children:b.description})]})]},S))})]}),s.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:x.slate[100],display:"flex",gap:"24px",flexWrap:"wrap"},children:[s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:p}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900]},children:n.length})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:m}),s.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900]},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:x.slate[500],display:"block"},children:"Wiederholen"}),s.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},xN=({session:t,questions:e,scenario:n,variables:i,onComplete:r,onExit:o,startFromQuestion:a=0})=>{const[l,c]=g.useState(window.innerWidth<768);g.useEffect(()=>{const je=()=>c(window.innerWidth<768);return window.addEventListener("resize",je),()=>window.removeEventListener("resize",je)},[]);const d=n?.mode==="SIMULATION",u={questionLabel:d?"Situation / Aussage des Gegenbers:":"Interviewfrage:",questionFallback:d?"Situation":"Frage",questionLoading:d?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:d?"Deine Reaktion...":"Deine Antwort...",submitButton:d?"Reaktion abgeben":"Antwort abgeben",submitHint:d?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:d?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(je,_t)=>d?`Situation ${je} von ${_t}`:`Frage ${je} von ${_t}`,questionsCount:je=>d?`${je} Situationen`:`${je} Fragen`,answeredCount:(je,_t)=>d?`${je} von ${_t} Situationen`:`${je} von ${_t} Fragen`,tipsLabel:d?"Tipps fr diese Situation":"Tipps fr diese Frage",nextButton:d?"Nchste Situation":"Nchste Frage",timePerQuestion:d?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:d?"Situationen":"Fragen",recommendedTime:d?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},h=a>0,p=h?Array.from({length:a},(je,_t)=>_t):[],[m,y]=g.useState(h?"interview":"preparation"),[f,b]=g.useState(a||t?.current_question_index||0),[S,C]=g.useState(null),[j,w]=g.useState(!1),[v,E]=g.useState(!1),[k,T]=g.useState(null),[N,R]=g.useState([]),[_,A]=g.useState(p),[Y,H]=g.useState(null),[$,K]=g.useState(!1),[O,P]=g.useState(!1),[F,D]=g.useState(!1),{branding:B}=ge(),G=B?.["--header-gradient"]||Q["--header-gradient"],ie=B?.["--button-gradient"]||G,le=B?.["--primary-accent"]||Q["--primary-accent"],re=B?.["--primary-accent-light"]||Q["--primary-accent-light"],U=e[f],be=f===e.length-1,Oe=f===0,bt=async(je,_t)=>{E(!0),T(null);try{const z=await fe.submitSimulatorAnswer(t.id,je,f,U.question,U.category,_t);if(!z.success)throw new Error(z.message||"Fehler beim Analysieren der Antwort");C(z.data),w(!0),R(de=>[...de.filter(Ke=>Ke.questionIndex!==f),{questionIndex:f,feedback:z.data}]),A(de=>de.includes(f)?de:[...de,f])}catch(z){console.error("Error submitting answer:",z),T(z.message||"Ein Fehler ist aufgetreten")}finally{E(!1)}},ce=()=>{C(null),w(!1),T(null)},_e=()=>{C(null),w(!1),T(null),be||b(je=>je+1)},Le=()=>{C(null),w(!1),T(null),Oe||b(je=>je-1)},ot=()=>{P(!0)},Gt=async()=>{P(!1);try{const je=await fe.completeSimulatorSession(t.id);je.success?r(je.data):r({session:{...t,status:"completed"}})}catch(je){console.error("Error completing session:",je),r({session:{...t,status:"completed"}})}},te=()=>{D(!0)},$e=()=>{D(!1),o()},Ne=()=>{y("interview")};return m==="preparation"?s.jsxs(s.Fragment,{children:[s.jsx(mN,{scenario:n,variables:i,questions:e,onStart:Ne,onBack:o,selectedMicrophoneId:Y,onMicrophoneChange:H,onMicrophoneTest:()=>K(!0),themedGradient:ie,primaryAccent:le,primaryAccentLight:re}),s.jsx(ka,{isOpen:$,onClose:()=>K(!1),deviceId:Y})]}):s.jsxs("div",{style:{padding:l?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:l?"column":"row",justifyContent:"space-between",alignItems:l?"stretch":"center",gap:l?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:l?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:l?"space-between":"flex-end"},children:[s.jsxs("button",{onClick:ot,style:{padding:l?"10px 14px":"8px 16px",borderRadius:"8px",background:"#22c55e",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"white",fontSize:"14px",fontWeight:600,boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)",flex:l?1:"none",justifyContent:"center"},children:[s.jsx(Es,{size:16}),l?"Beenden":"Training beenden"]}),s.jsxs("button",{onClick:te,style:{padding:l?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",flex:l?1:"none",justifyContent:"center"},children:[s.jsx(kn,{size:16}),"Abbrechen"]})]})]}),O&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>P(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:je=>je.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Es,{size:24,color:"#22c55e"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training beenden?"})]}),_.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"8px"},children:["Du hast ",s.jsx("strong",{children:u.answeredCount(_.length,e.length)})," beantwortet."]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Mchtest du das Training jetzt mit den bisherigen Antworten abschlieen oder weitere ",u.questionsLabel," beantworten?"]})]}):s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Du hast noch keine ",u.questionsLabel," beantwortet. Mchtest du das Training wirklich beenden?"]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>P(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Weiter trainieren"}),s.jsx("button",{onClick:Gt,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#22c55e",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)"},children:"Training beenden"})]})]})}),F&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>D(!1),children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:je=>je.stopPropagation(),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ve,{size:24,color:"#ef4444"})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training abbrechen?"})]}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:[s.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",_.length>0?` (${_.length} ${u.questionsLabel})`:""," ",s.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>D(!1),style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Zurck zum Training"}),s.jsx("button",{onClick:$e,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:"Training abbrechen"})]})]})}),!j&&s.jsxs("div",{style:{display:"flex",gap:l?"8px":"12px",justifyContent:"center",marginBottom:"16px"},children:[s.jsxs("button",{onClick:Le,disabled:Oe,style:{display:"flex",alignItems:"center",gap:"6px",padding:l?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${x.slate[300]}`,backgroundColor:"white",color:Oe?x.slate[400]:x.slate[700],fontSize:l?"13px":"14px",fontWeight:600,cursor:Oe?"not-allowed":"pointer",opacity:Oe?.5:1,flex:l?1:"none",justifyContent:"center"},children:[s.jsx(Io,{size:16}),"Zurck"]}),s.jsxs("button",{onClick:_e,disabled:be,style:{display:"flex",alignItems:"center",gap:"6px",padding:l?"10px 14px":"12px 20px",borderRadius:"10px",border:`2px solid ${x.slate[300]}`,backgroundColor:"white",color:be?x.slate[400]:x.slate[700],fontSize:l?"13px":"14px",fontWeight:600,cursor:be?"not-allowed":"pointer",opacity:be?.5:1,flex:l?1:"none",justifyContent:"center"},children:[l?"berspringen":"Frage berspringen",s.jsx(It,{size:16})]})]}),s.jsx(pN,{current:f,total:e.length,answeredQuestions:_,primaryAccent:le,labels:u}),j?s.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px",justifyContent:"flex-end"},children:[n.allow_retry&&s.jsxs("button",{onClick:ce,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:`2px solid ${x.slate[300]}`,backgroundColor:"white",color:x.slate[700],fontSize:"14px",fontWeight:600,cursor:"pointer"},children:[s.jsx(Si,{size:16}),"Nochmal versuchen"]}),s.jsxs("button",{onClick:be?Gt:_e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"10px",border:"none",background:ie,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${le}4d`},children:[be?"Training abschlieen":u.nextButton,!be&&s.jsx(It,{size:16})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"20px",border:"1px solid #e2e8f0",marginBottom:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:ie,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:f+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:U?.category||u.questionFallback})]}),s.jsx("p",{style:{fontSize:"16px",fontWeight:500,color:"#0f172a",margin:0,lineHeight:1.5},children:U?.question||u.questionLoading})]}),s.jsx(hN,{transcript:S.transcript,feedback:S.feedback,audioMetrics:S.audio_analysis,hideButtons:!0})]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:l?"16px":"24px"},children:[l?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:ie,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:f+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:U?.category||u.questionFallback})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:U?.question||u.questionLoading}),U?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(He,{size:14}),u.recommendedTime,": ca. ",Math.round(U.estimated_answer_time/60)," Min"]})]}),s.jsx(Sf,{onRecordingComplete:bt,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:Y,themedGradient:ie,primaryAccent:le,isSubmitting:v,labels:u}),k&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"16px",borderRadius:"12px",backgroundColor:x.red[100]},children:[s.jsx(ve,{style:{width:"24px",height:"24px",color:x.red[500]}}),s.jsx("p",{style:{marginTop:"8px",color:x.red[500],fontWeight:500,fontSize:"14px",textAlign:"center"},children:k}),s.jsx("button",{onClick:ce,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:x.red[500],color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsx(Sf,{onRecordingComplete:bt,timeLimit:n.time_limit_per_question||120,disabled:!1,deviceId:Y,themedGradient:ie,primaryAccent:le,isSubmitting:v,labels:u}),k&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",marginTop:"16px",borderRadius:"12px",backgroundColor:x.red[100]},children:[s.jsx(ve,{style:{width:"24px",height:"24px",color:x.red[500]}}),s.jsx("p",{style:{marginTop:"8px",color:x.red[500],fontWeight:500,fontSize:"14px",textAlign:"center"},children:k}),s.jsx("button",{onClick:ce,style:{marginTop:"12px",padding:"8px 16px",borderRadius:"8px",border:"none",backgroundColor:x.red[500],color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Erneut versuchen"})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:ie,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:f+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:U?.category||u.questionFallback})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:U?.question||u.questionLoading}),U?.estimated_answer_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(He,{size:16}),u.recommendedTime,": ca. ",Math.round(U.estimated_answer_time/60)," Min"]})]})]}),U?.tips&&U.tips.length>0&&s.jsx(fN,{tips:U.tips,primaryAccent:le,tipsLabel:u.tipsLabel})]})]})},ro=({score:t,label:e,primaryAccent:n})=>{const i=t!=null?t*10:null,o=(a=>a>=80?x.green[500]:a>=60?n:a>=40?x.amber[500]:"#ef4444")(i);return s.jsxs("div",{style:{textAlign:"center",padding:"16px",backgroundColor:x.slate[100],borderRadius:"12px"},children:[s.jsx("div",{style:{fontSize:"32px",fontWeight:700,color:o,marginBottom:"4px"},children:i!=null?Math.round(i):"-"}),s.jsx("div",{style:{fontSize:"13px",color:x.slate[600]},children:e})]})},bl=({icon:t,value:e,label:n,primaryAccent:i})=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:x.slate[100],borderRadius:"10px"},children:[s.jsx(t,{style:{width:"20px",height:"20px",color:i}}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"18px",fontWeight:600,color:x.slate[900]},children:e}),s.jsx("div",{style:{fontSize:"12px",color:x.slate[500]},children:n})]})]}),yN=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const{branding:r}=ge(),o=r?.["--header-gradient"]||Q["--header-gradient"],a=r?.["--button-gradient"]||o,l=r?.["--primary-accent"]||Q["--primary-accent"],c=r?.["--primary-accent-light"]||Q["--primary-accent-light"],d=t.summary_feedback||t.summary_feedback_json,u=d?typeof d=="string"?JSON.parse(d):d:null,h=t.overall_score||u?.overall_score||0,p=h<=10?h*10:h,y=(f=>f>=90?{text:"Ausgezeichnet!",emoji:""}:f>=80?{text:"Sehr gut!",emoji:""}:f>=70?{text:"Gut!",emoji:""}:f>=60?{text:"Solide Leistung",emoji:""}:f>=50?{text:"Ausbaufhig",emoji:""}:{text:"Weiter ben!",emoji:""})(p);return s.jsxs("div",{style:{padding:"24px",maxWidth:"640px",margin:"0 auto"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:o,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:`0 8px 24px ${l}4d`},children:s.jsx(Os,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsxs("h1",{style:{fontSize:"28px",fontWeight:700,color:x.slate[900],margin:"0 0 8px 0"},children:["Training abgeschlossen! ",y.emoji]}),s.jsxs("p",{style:{fontSize:"16px",color:x.slate[600],margin:0},children:[e?.title||"Skill Training"," - ",y.text]})]}),s.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`,textAlign:"center",marginBottom:"24px"},children:[s.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",border:`6px solid ${l}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",backgroundColor:c},children:s.jsx("span",{style:{fontSize:"48px",fontWeight:700,color:l},children:p?Math.round(p):"-"})}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[500],margin:0},children:p?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"24px"},children:[s.jsx(bl,{icon:Zt,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:l}),s.jsx(bl,{icon:De,value:u?.average_content_score?Math.round(u.average_content_score*10):"-",label:" Inhalt",primaryAccent:l}),s.jsx(bl,{icon:Rt,value:u?.average_delivery_score?Math.round(u.average_delivery_score*10):"-",label:" Prsentation",primaryAccent:l})]}),u?.scores&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"24px"},children:[s.jsx(ro,{score:u.scores.content,label:"Inhalt",primaryAccent:l}),s.jsx(ro,{score:u.scores.structure,label:"Struktur",primaryAccent:l}),s.jsx(ro,{score:u.scores.relevance,label:"Relevanz",primaryAccent:l}),s.jsx(ro,{score:u.scores.delivery,label:"Prsentation",primaryAccent:l})]}),u?.summary&&s.jsxs("div",{style:{padding:"20px",borderRadius:"12px",backgroundColor:x.slate[100],marginBottom:"24px"},children:[s.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:x.slate[700],margin:"0 0 8px 0"},children:"Zusammenfassung"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0,lineHeight:1.6},children:u.summary})]}),u?.key_takeaways?.length>0&&s.jsxs("div",{style:{padding:"20px",borderRadius:"12px",backgroundColor:x.green[100],marginBottom:"24px"},children:[s.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:x.green[500],margin:"0 0 12px 0"},children:" Die wichtigsten Erkenntnisse"}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px",color:x.slate[700],fontSize:"14px",lineHeight:1.6},children:u.key_takeaways.map((f,b)=>s.jsx("li",{style:{marginBottom:"8px"},children:f},b))})]}),s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"32px"},children:[s.jsxs("button",{onClick:n,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${x.slate[300]}`,backgroundColor:"white",color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:f=>{f.target.style.borderColor=l,f.target.style.color=l},onMouseLeave:f=>{f.target.style.borderColor=x.slate[300],f.target.style.color=x.slate[700]},children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:a,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${l}4d`,transition:"all 0.2s"},onMouseEnter:f=>{f.target.style.transform="translateY(-2px)",f.target.style.boxShadow=`0 6px 16px ${l}66`},onMouseLeave:f=>{f.target.style.transform="none",f.target.style.boxShadow=`0 4px 12px ${l}4d`},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal ben"]})]})]})},qt={DASHBOARD:"dashboard",WIZARD:"wizard",SESSION:"session",COMPLETE:"complete"},bN=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingContinueSession:i,clearPendingContinueSession:r,pendingRepeatSession:o,clearPendingRepeatSession:a,onNavigateToHistory:l})=>{const[c,d]=g.useState(qt.DASHBOARD),[u,h]=g.useState(null),[p,m]=g.useState(null),[y,f]=g.useState([]),[b,S]=g.useState({}),[C,j]=g.useState(null),[w,v]=g.useState(null),[E,k]=g.useState(0);g.useEffect(()=>{w&&t&&(console.log(" [SimulatorApp] Processing pending scenario after login:",w.title),h(w),d(qt.WIZARD),v(null))},[w,t]),g.useEffect(()=>{if(i&&t){const{session:$,scenario:K}=i;console.log(" [SimulatorApp] Continuing session:",$.id);const O=$.questions||$.questions_json,P=typeof O=="string"?JSON.parse(O):O||[],F=$.completed_questions||$.answered_count||0;h(K||{id:$.scenario_id,title:$.scenario_title}),m($),f(P),S({}),k(F),d(qt.SESSION),r&&r()}},[i,t,r]),g.useEffect(()=>{if(o&&t){const{session:$,scenario:K}=o;console.log(" [SimulatorApp] Repeating session with same questions:",$.id);const O=$.questions||$.questions_json,P=typeof O=="string"?JSON.parse(O):O||[];h(K||{id:$.scenario_id,title:$.scenario_title}),f(P),S({}),k(0),d(qt.WIZARD),a&&a()}},[o,t,a]),g.useEffect(()=>{window.scrollTo(0,0)},[c]);const T=g.useCallback($=>{h($),d(qt.WIZARD)},[]),N=g.useCallback(()=>{h(null),m(null),f([]),S({}),j(null),k(0),d(qt.DASHBOARD)},[]),R=g.useCallback($=>{m($.session),f($.questions),S($.variables),d(qt.SESSION)},[]),_=g.useCallback($=>{j($.session),d(qt.COMPLETE)},[]),A=g.useCallback(()=>{N()},[N]),Y=g.useCallback(()=>{m(null),f([]),j(null),k(0),d(qt.WIZARD)},[]),H=()=>{switch(c){case qt.DASHBOARD:return s.jsx(vf,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:v,onNavigateToHistory:l});case qt.WIZARD:return s.jsx(dN,{scenario:u,onBack:N,onStart:R,preloadedQuestions:y.length>0?y:null});case qt.SESSION:return s.jsx(xN,{session:p,questions:y,scenario:u,variables:b,onComplete:_,onExit:A,startFromQuestion:E});case qt.COMPLETE:return s.jsx(yN,{session:C,scenario:u,onBackToDashboard:N,onStartNew:Y});default:return s.jsx(vf,{onSelectScenario:T,isAuthenticated:t,requireAuth:e,setPendingScenario:v,onNavigateToHistory:l})}};return s.jsx("div",{style:{minHeight:"100%"},children:H()})},vN={video:ht,user:xt,briefcase:Qt,presentation:dd,mic:Xe,target:De,banknote:ni},Fy={self_presentation:{label:"Selbstprsentation",icon:xt,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgesprch",icon:Qt,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:Ln,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:Mk,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:De,color:"#64748b",bgColor:"#f1f5f9"}},SN=({selectedCategory:t,onSelectCategory:e,primaryAccent:n,availableCategories:i})=>{const r=[{key:null,label:"Alle",icon:Kn},...i.map(o=>({key:o,...Fy[o]}))];return s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginBottom:"24px"},children:r.map(o=>{const a=t===o.key,l=o.icon||Kn,c=o.key===null?n:o.color;return s.jsxs("button",{onClick:()=>e(o.key),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"10px 18px",borderRadius:"24px",fontSize:"14px",fontWeight:600,border:`2px solid ${a?c:x.slate[200]}`,backgroundColor:a?o.key===null?`${n}15`:o.bgColor:"white",color:a?c:x.slate[600],cursor:"pointer",transition:"all 0.2s ease"},children:[s.jsx(l,{style:{width:"16px",height:"16px"}}),o.label]},o.key||"all")})})},kf=({onSelectScenario:t,isAuthenticated:e,requireAuth:n,setPendingScenario:i,onNavigateToHistory:r})=>{const[o,a]=g.useState([]),[l,c]=g.useState(!0),[d,u]=g.useState(null),[h,p]=g.useState("grid"),[m,y]=g.useState(""),[f,b]=g.useState("all"),[S,C]=g.useState(null),{branding:j}=ge(),w=j?.headerGradient||j?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",v=j?.headerText||j?.["--header-text"]||"#ffffff",E=j?.primaryAccent||j?.["--primary-accent"]||"#3A7FA7",k=g.useMemo(()=>{const _=new Set;return o.forEach(A=>{A.scenario_type&&Fy[A.scenario_type]&&_.add(A.scenario_type)}),Array.from(_)},[o]),T=g.useMemo(()=>{let _=[...o];if(S&&(_=_.filter(A=>A.scenario_type===S)),m.trim()){const A=m.toLowerCase();_=_.filter(Y=>Y.title?.toLowerCase().includes(A)||Y.description?.toLowerCase().includes(A))}return f!=="all"&&(_=_.filter(A=>A.difficulty===f)),_},[o,S,m,f]);g.useEffect(()=>{console.log(" [VideoTrainingDashboard] Loading scenarios..."),N()},[]);const N=async()=>{c(!0),u(null);try{const _=await fetch(`${Pn()}/video-training/scenarios`,{headers:{"X-WP-Nonce":mt()}});if(!_.ok)throw new Error("Fehler beim Laden der Szenarien");const A=await _.json();if(A.success&&A.data?.scenarios)a(A.data.scenarios);else throw new Error("Ungltige Antwort vom Server")}catch(_){console.error("[VIDEO TRAINING] Error loading scenarios:",_),u(_.message)}finally{c(!1)}},R=_=>{if(!e){i(_),n(()=>{t(_)},{type:"SELECT_VIDEO_SCENARIO",scenario:_});return}t(_)};return l?s.jsx("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",border:"3px solid #e2e8f0",borderTopColor:E,animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),s.jsx("p",{style:{color:"#64748b"},children:"Szenarien werden geladen..."}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})}):d?s.jsx("div",{style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx(ve,{size:48,color:"#ef4444",style:{margin:"0 auto 16px"}}),s.jsx("h3",{style:{color:"#0f172a",marginBottom:"8px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{color:"#64748b",marginBottom:"16px"},children:d}),s.jsx("button",{onClick:N,style:{padding:"10px 20px",borderRadius:"8px",background:E,color:"#fff",border:"none",cursor:"pointer",fontWeight:500},children:"Erneut versuchen"})]})}):s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:w,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ht,{size:24,color:v})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",margin:0},children:"Wirkungs-Analyse"}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Video-Feedback zu Auftreten und Kommunikation"})]})]}),e&&r&&s.jsxs("button",{onClick:r,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${E}`,backgroundColor:"white",color:E,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(_s,{size:18}),"Meine Wirkungs-Analysen"]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginTop:"24px",alignItems:"center"},children:[s.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[s.jsx(ei,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:x.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:"Szenarien durchsuchen...",value:m,onChange:_=>y(_.target.value),style:{width:"100%",padding:"12px 14px 12px 44px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:_=>{_.target.style.borderColor=E,_.target.style.boxShadow=`0 0 0 3px ${E}20`},onBlur:_=>{_.target.style.borderColor=x.slate[200],_.target.style.boxShadow="none"}})]}),s.jsxs("div",{style:{position:"relative",minWidth:"180px"},children:[s.jsx(lr,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"16px",height:"16px",color:x.slate[400],pointerEvents:"none"}}),s.jsxs("select",{value:f,onChange:_=>b(_.target.value),style:{width:"100%",padding:"12px 14px 12px 40px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",paddingRight:"40px"},children:[s.jsx("option",{value:"all",children:"Alle Schwierigkeiten"}),s.jsx("option",{value:"easy",children:"Einfach"}),s.jsx("option",{value:"beginner",children:"Einsteiger"}),s.jsx("option",{value:"medium",children:"Mittel"}),s.jsx("option",{value:"intermediate",children:"Fortgeschritten"}),s.jsx("option",{value:"hard",children:"Schwer"}),s.jsx("option",{value:"advanced",children:"Experte"})]})]}),s.jsx(aa,{viewMode:h,onViewChange:p})]})]}),k.length>0&&s.jsx(SN,{selectedCategory:S,onSelectCategory:C,primaryAccent:E,availableCategories:k}),T.length===0&&s.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[s.jsx(ht,{size:64,color:"#cbd5e1",style:{marginBottom:"16px"}}),s.jsx("h3",{style:{color:"#64748b",fontWeight:500},children:"Keine Szenarien verfgbar"}),s.jsx("p",{style:{color:"#94a3b8",fontSize:"14px"},children:"Bitte kontaktieren Sie den Administrator."})]}),s.jsx(Wr,{viewMode:h,children:T.map(_=>{const A=vN[_.icon]||ht;return s.jsx(Ur,{title:_.title,description:_.description,difficulty:_.difficulty,icon:A,meta:[{text:`${_.question_count} Fragen`},{icon:He,text:`~${Math.round(_.total_time_limit/60)} Min.`}],action:{label:"Starten",icon:Vt},onClick:()=>R(_),viewMode:h},_.id)})}),s.jsx("div",{style:{marginTop:"40px",padding:"20px",background:`linear-gradient(135deg, ${E}10 0%, ${E}05 100%)`,borderRadius:"12px",border:`1px solid ${E}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(st,{size:20,color:E,style:{flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Wie funktioniert das Video Training?"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6},children:["1. Whle ein Szenario und konfiguriere dein Training",s.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",s.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Krpersprache und Kommunikation"]})]})]})})]})},wf=({type:t,devices:e,selectedDeviceId:n,onDeviceChange:i,isLoading:r,error:o,onRefresh:a,primaryAccent:l,themedGradient:c})=>{const[d,u]=g.useState(!1),h=t==="video"?lm:Xe,p=t==="video"?"Kamera":"Mikrofon",m=b=>{if(b.label){let S=b.label;return S=S.replace(/^Default - /,""),S=S.replace(/^Kommunikation - /,""),S=S.replace(/^Standard - /,""),S.length>35&&(S=S.substring(0,32)+"..."),S}return`${p} ${e.indexOf(b)+1}`},y=e.find(b=>b.deviceId===n),f=b=>{i?.(b),u(!1)};return s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:[s.jsxs("button",{type:"button",onClick:()=>!r&&u(!d),disabled:r,style:{flex:"1 1 250px",minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${o?"#ef4444":"#e2e8f0"}`,backgroundColor:o?"#fef2f2":"#fff",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",background:o?"#fee2e2":c},children:o?s.jsx(ve,{style:{width:"22px",height:"22px",color:"#ef4444"}}):s.jsx(h,{style:{width:"22px",height:"22px",color:"#fff"}})}),s.jsxs("div",{style:{textAlign:"left"},children:[s.jsx("div",{style:{fontSize:"12px",color:"#64748b",fontWeight:500,marginBottom:"2px"},children:p}),s.jsx("div",{style:{fontSize:"14px",fontWeight:600,color:o?"#dc2626":"#1e293b"},children:r?"Lade...":o||(y?m(y):"Bitte whlen")})]})]}),s.jsx(jt,{style:{width:"20px",height:"20px",color:"#94a3b8",transform:d?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]}),o&&a&&s.jsx("button",{type:"button",onClick:a,style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 16px",borderRadius:"12px",border:"2px solid #e2e8f0",backgroundColor:"#fff",cursor:"pointer",transition:"all 0.2s"},children:s.jsx(hn,{style:{width:"20px",height:"20px",color:"#475569"}})})]}),d&&e.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>u(!1),style:{position:"fixed",inset:0,zIndex:40}}),s.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:"#fff",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:"1px solid #e2e8f0",zIndex:50,overflow:"hidden",maxHeight:"280px",overflowY:"auto"},children:e.map((b,S)=>s.jsxs("button",{type:"button",onClick:()=>f(b.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:n===b.deviceId?`${l}15`:"transparent",cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:C=>{n!==b.deviceId&&(C.currentTarget.style.backgroundColor="#f8fafc")},onMouseLeave:C=>{C.currentTarget.style.backgroundColor=n===b.deviceId?`${l}15`:"transparent"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:n===b.deviceId?l:"#f1f5f9"},children:s.jsx(h,{style:{width:"18px",height:"18px",color:n===b.deviceId?"#fff":"#64748b"}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:n===b.deviceId?l:"#1e293b",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m(b)}),b.deviceId==="default"&&s.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Systemstandard"})]}),n===b.deviceId&&s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:l}})]},b.deviceId||S))})]})]})},kN=({field:t,value:e,onChange:n,error:i,primaryAccent:r})=>{const o={width:"100%",padding:"12px 16px",borderRadius:"10px",border:`2px solid ${i?"#ef4444":"#e2e8f0"}`,fontSize:"16px",transition:"all 0.2s ease",outline:"none",background:"#fff"},a=d=>{d.target.style.borderColor=r,d.target.style.boxShadow=`0 0 0 3px ${r}20`},l=d=>{d.target.style.borderColor=i?"#ef4444":"#e2e8f0",d.target.style.boxShadow="none"},c=()=>{switch(t.type){case"select":return s.jsxs("select",{value:e||t.default||"",onChange:d=>n(t.key,d.target.value),style:{...o,cursor:"pointer"},onFocus:a,onBlur:l,required:t.required,children:[!t.default&&s.jsx("option",{value:"",children:"Bitte auswhlen..."}),t.options?.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))]});case"textarea":return s.jsx("textarea",{value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder,style:{...o,minHeight:"100px",resize:"vertical"},onFocus:a,onBlur:l,required:t.required});case"number":return s.jsx("input",{type:"number",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder,style:o,onFocus:a,onBlur:l,required:t.required,min:t.min,max:t.max});default:return s.jsx("input",{type:"text",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder,style:o,onFocus:a,onBlur:l,required:t.required})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#0f172a",marginBottom:"8px"},children:[t.label,t.required&&s.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),c(),t.hint&&s.jsx("p",{style:{fontSize:"13px",color:"#94a3b8",marginTop:"4px"},children:t.hint}),i&&s.jsxs("p",{style:{fontSize:"13px",color:"#ef4444",marginTop:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx(ve,{size:14}),i]})]})},wN=({scenario:t,onBack:e,onStart:n})=>{const[i,r]=g.useState(()=>{const P=t?.input_configuration||[],F={};return P.forEach(D=>{D.default&&(F[D.key]=D.default)}),F}),[o,a]=g.useState({}),[l,c]=g.useState(!1),[d,u]=g.useState(null),[h,p]=g.useState([]),[m,y]=g.useState([]),[f,b]=g.useState(null),[S,C]=g.useState(null),[j,w]=g.useState(!0),[v,E]=g.useState(null),[k,T]=g.useState(null),{branding:N,demoCode:R}=ge(),_=N?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",A=N?.primaryAccent||"#3A7FA7",Y=g.useCallback(async()=>{w(!0),E(null),T(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(G=>G.stop());const F=await navigator.mediaDevices.enumerateDevices(),D=F.filter(G=>G.kind==="audioinput"),B=F.filter(G=>G.kind==="videoinput");if(D.length===0)E("Kein Mikrofon gefunden"),p([]);else if(p(D),!f){const G=D.find(ie=>ie.deviceId==="default")||D[0];b(G.deviceId)}if(B.length===0)T("Keine Kamera gefunden"),y([]);else if(y(B),!S){const G=B.find(ie=>ie.deviceId==="default")||B[0];C(G.deviceId)}}catch(P){console.error("Error loading devices:",P),P.name==="NotAllowedError"||P.name==="PermissionDeniedError"?(E("Zugriff verweigert"),T("Zugriff verweigert")):P.name==="NotFoundError"?(E("Kein Mikrofon gefunden"),T("Keine Kamera gefunden")):(E("Fehler beim Laden"),T("Fehler beim Laden")),p([]),y([])}finally{w(!1)}},[f,S]);g.useEffect(()=>{Y();const P=()=>Y();return navigator.mediaDevices?.addEventListener("devicechange",P),()=>{navigator.mediaDevices?.removeEventListener("devicechange",P)}},[]);const H=g.useCallback((P,F)=>{r(D=>({...D,[P]:F})),o[P]&&a(D=>{const B={...D};return delete B[P],B})},[o]),$=g.useCallback(()=>{const P={};return(t?.input_configuration||[]).forEach(D=>{D.required&&!i[D.key]&&(P[D.key]=`${D.label} ist erforderlich`)}),a(P),Object.keys(P).length===0},[t,i]),K=async()=>{if($()){c(!0),u(null);try{const P=Pn();console.log("[VIDEO TRAINING] Creating session...");const F=await fetch(`${P}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":mt()},body:JSON.stringify({scenario_id:t.id,variables:i,demo_code:R||null})});if(!F.ok)throw new Error("Fehler beim Erstellen der Sitzung");const D=await F.json();if(!D.success||!D.data?.session)throw new Error("Ungltige Antwort beim Erstellen der Sitzung");const B=D.data.session;console.log("[VIDEO TRAINING] Session created:",B.id),console.log("[VIDEO TRAINING] Generating questions...");const G=await fetch(`${P}/video-training/sessions/${B.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":mt()}});if(!G.ok)throw new Error("Fehler beim Generieren der Fragen");const ie=await G.json();if(!ie.success||!ie.data?.questions)throw new Error("Fehler beim Generieren der Fragen");console.log("[VIDEO TRAINING] Questions generated:",ie.data.questions.length),n({session:ie.data.session,questions:ie.data.questions,variables:i,selectedMicrophoneId:f,selectedCameraId:S})}catch(P){console.error("[VIDEO TRAINING] Error starting session:",P),u(P.message)}finally{c(!1)}}},O=t?.input_configuration||[];return s.jsxs("div",{style:{padding:"32px",maxWidth:"700px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"14px",padding:"8px 0",marginBottom:"16px"},children:[s.jsx(pt,{size:18}),"Zurck zur bersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:_,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ht,{size:28,color:"#fff"})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginBottom:"4px"},children:t?.title}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b"},children:"Konfiguriere deine Wirkungs-Analyse"})]})]})]}),s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{padding:"16px 20px",background:`linear-gradient(135deg, ${A}10 0%, ${A}05 100%)`,borderRadius:"12px",border:`1px solid ${A}20`,marginBottom:"32px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ns,{size:20,color:A,style:{flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px",fontSize:"14px"},children:"So funktioniert es"}),s.jsxs("p",{style:{fontSize:"13px",color:"#64748b",lineHeight:1.5},children:["Die KI generiert ",t?.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschlieend detailliertes Feedback."]})]})]}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{background:"#fff",borderRadius:"16px",padding:"28px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"24px"},children:[s.jsx(ud,{size:20,color:A}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Personalisiere dein Training"})]}),O.map(P=>s.jsx(kN,{field:P,value:i[P.key],onChange:H,error:o[P.key],primaryAccent:A},P.key)),O.length===0&&s.jsx("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"Keine zustzliche Konfiguration erforderlich."})]}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},style:{background:"#fff",borderRadius:"16px",padding:"28px",border:"1px solid #e2e8f0",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"24px"},children:[s.jsx(lm,{size:20,color:A}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a"},children:"Kamera & Mikrofon"})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[s.jsx(wf,{type:"video",devices:m,selectedDeviceId:S,onDeviceChange:C,isLoading:j,error:k,onRefresh:Y,primaryAccent:A,themedGradient:_}),s.jsx(wf,{type:"audio",devices:h,selectedDeviceId:f,onDeviceChange:b,isLoading:j,error:v,onRefresh:Y,primaryAccent:A,themedGradient:_})]}),(v||k)&&s.jsxs("p",{style:{fontSize:"13px",color:"#94a3b8",marginTop:"16px",display:"flex",alignItems:"flex-start",gap:"8px"},children:[s.jsx(Ns,{size:16,style:{flexShrink:0,marginTop:"2px"}}),"Bitte erlaube den Zugriff auf Kamera und Mikrofon in deinen Browser-Einstellungen, um die Gerte nutzen zu knnen."]})]}),d&&s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",marginBottom:"24px",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(ve,{size:20,color:"#ef4444"}),s.jsx("p",{style:{color:"#dc2626",fontSize:"14px"},children:d})]}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},style:{background:"#f8fafc",borderRadius:"12px",padding:"20px",marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[s.jsx(st,{size:18,color:A}),s.jsx("span",{style:{fontWeight:600,color:"#0f172a",fontSize:"14px"},children:"Training-Details"})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px"},children:[s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Fragen"}),s.jsx("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:t?.question_count||5})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Zeit pro Frage"}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:["~",Math.round((t?.time_limit_per_question||120)/60)," Min."]})]}),s.jsxs("div",{children:[s.jsx("span",{style:{fontSize:"12px",color:"#94a3b8",display:"block"},children:"Gesamtdauer"}),s.jsxs("span",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a"},children:["~",Math.round((t?.total_time_limit||900)/60)," Min."]})]})]})]}),s.jsxs(L.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},onClick:K,disabled:l,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",background:l?"#94a3b8":_,color:"#fff",border:"none",cursor:l?"not-allowed":"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)",transition:"all 0.2s ease"},children:["Video Training starten",s.jsx(It,{size:20})]}),s.jsx(Ly,{isLoading:l,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},CN=({current:t,total:e,primaryAccent:n})=>{const i=(t+1)/e*100;return s.jsxs("div",{style:{marginBottom:"24px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[s.jsxs("span",{style:{fontSize:"14px",color:"#64748b"},children:["Frage ",t+1," von ",e]}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:n},children:[Math.round(i),"%"]})]}),s.jsx("div",{style:{height:"8px",background:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:s.jsx(L.div,{initial:{width:0},animate:{width:`${i}%`},transition:{duration:.3},style:{height:"100%",background:n,borderRadius:"4px"}})}),s.jsx("div",{style:{display:"flex",gap:"6px",marginTop:"12px",justifyContent:"center"},children:Array.from({length:e}).map((r,o)=>s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:o<t?"#22c55e":o===t?n:"#e2e8f0",transition:"all 0.2s"}},o))})]})},Cf=({tips:t,primaryAccent:e})=>{const[n,i]=g.useState(!1);return!t||t.length===0?null:s.jsxs("div",{style:{marginTop:"16px",background:`linear-gradient(135deg, ${e}08 0%, ${e}04 100%)`,borderRadius:"12px",border:`1px solid ${e}15`,overflow:"hidden"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"14px 16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:600,color:"#0f172a"},children:[s.jsx(Ce,{size:18,color:e}),"Tipps fr diese Frage"]}),s.jsx(It,{size:18,color:"#64748b",style:{transform:n?"rotate(90deg)":"none",transition:"transform 0.2s"}})]}),s.jsx(Ve,{children:n&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsx("div",{style:{padding:"0 16px 16px"},children:s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.map((r,o)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:r},o))})})})})]})},jN=({session:t,questions:e,scenario:n,variables:i,onComplete:r,onExit:o})=>{const[a,l]=g.useState(0),[c,d]=g.useState(!1),[u,h]=g.useState(!1),[p,m]=g.useState(0),[y,f]=g.useState([]),[b,S]=g.useState([]),[C,j]=g.useState(null),[w,v]=g.useState(null),[E,k]=g.useState(!1),[T,N]=g.useState(!1),[R,_]=g.useState(null),[A,Y]=g.useState(window.innerWidth<768);g.useEffect(()=>{const ce=()=>Y(window.innerWidth<768);return window.addEventListener("resize",ce),()=>window.removeEventListener("resize",ce)},[]);const H=g.useRef(null),$=g.useRef(null),K=g.useRef(null),{branding:O}=ge(),P=O?.primaryAccent||"#3A7FA7",F=O?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",D=e[a];g.useEffect(()=>(B(),()=>{G(),K.current&&clearInterval(K.current)}),[]);const B=async()=>{try{v(null);const ce=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0});j(ce),H.current&&(H.current.srcObject=ce)}catch(ce){console.error("[VIDEO TRAINING] Camera error:",ce),v("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},G=()=>{C&&(C.getTracks().forEach(ce=>ce.stop()),j(null))},ie=()=>{if(!C){B();return}try{const ce=new MediaRecorder(C,{mimeType:"video/webm;codecs=vp9,opus"});$.current=ce;const _e=[];ce.ondataavailable=Le=>{Le.data.size>0&&(_e.push(Le.data),f(ot=>[...ot,Le.data]))},ce.onstop=()=>{console.log("[VIDEO TRAINING] Recording stopped")},ce.start(1e3),d(!0),h(!1),S(Le=>[...Le,{question_index:a,start_time:p}]),K.current=setInterval(()=>{m(Le=>Le+1)},1e3),console.log("[VIDEO TRAINING] Recording started")}catch(ce){console.error("[VIDEO TRAINING] Recording error:",ce),_("Fehler beim Starten der Aufnahme")}},le=()=>{$.current&&c&&($.current.stop(),d(!1),K.current&&(clearInterval(K.current),K.current=null))},re=()=>{a<e.length-1&&(c&&S(ce=>[...ce,{question_index:a+1,start_time:p}]),l(ce=>ce+1))},U=()=>{a>0&&l(ce=>ce-1)},be=async()=>{le(),k(!0),_(null);try{const ce=new Blob(y,{type:"video/webm"}),_e=Pn(),Le=new FormData;Le.append("video",ce,`video_${t.id}.webm`),Le.append("video_duration",p.toString()),Le.append("timeline",JSON.stringify(b)),console.log("[VIDEO TRAINING] Uploading video (size: "+(ce.size/1024/1024).toFixed(2)+" MB)...");const ot=await fetch(`${_e}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":mt()},body:Le});if(!ot.ok){const Ne=await ot.text();throw console.error("[VIDEO TRAINING] Upload failed:",ot.status,Ne),ot.status===413?new Error("Das Video ist zu gro zum Hochladen. Bitte versuche eine krzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+ot.status)}const Gt=await ot.json();console.log("[VIDEO TRAINING] Video uploaded:",Gt),k(!1),N(!0),console.log("[VIDEO TRAINING] Analyzing video...");const te=await fetch(`${_e}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":mt()}});if(!te.ok)throw new Error("Fehler bei der Video-Analyse");const $e=await te.json();console.log("[VIDEO TRAINING] Analysis complete:",$e),r({session:$e.data?.session||t,analysis:$e.data?.analysis,categoryScores:$e.data?.category_scores,overallScore:$e.data?.overall_score})}catch(ce){console.error("[VIDEO TRAINING] Upload/Analysis error:",ce),_(ce.message),k(!1),N(!1)}},Oe=ce=>{const _e=Math.floor(ce/60),Le=ce%60;return`${_e.toString().padStart(2,"0")}:${Le.toString().padStart(2,"0")}`},bt=()=>{le(),G(),o()};return E||T?s.jsxs("div",{style:{padding:"32px",textAlign:"center",maxWidth:"600px",margin:"0 auto"},children:[s.jsxs(L.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{background:"#fff",borderRadius:"20px",padding:"48px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:`${P}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(ye,{size:40,color:P,style:{animation:"spin 1s linear infinite"}})}),s.jsx("h2",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",marginBottom:"12px"},children:E?"Video wird hochgeladen...":"KI analysiert dein Video..."}),s.jsx("p",{style:{color:"#64748b",fontSize:"15px",lineHeight:1.6},children:E?"Dein Video wird sicher bertragen. Dies kann je nach Dateigre einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Krpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]}),s.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}):s.jsxs("div",{style:{padding:A?"16px":"24px",maxWidth:"1000px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:A?"column":"row",justifyContent:"space-between",alignItems:A?"stretch":"center",gap:A?"12px":"0",marginBottom:"24px"},children:[s.jsx("h1",{style:{fontSize:A?"18px":"20px",fontWeight:600,color:"#0f172a",margin:0},children:n?.title}),s.jsxs("button",{onClick:bt,style:{padding:A?"10px 14px":"8px 16px",borderRadius:"8px",background:"#f1f5f9",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",color:"#64748b",fontSize:"14px"},children:[s.jsx(kn,{size:16}),"Abbrechen"]})]}),s.jsx(CN,{current:a,total:e.length,primaryAccent:P}),A?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"16px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"26px",height:"26px",borderRadius:"50%",background:F,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"12px",fontWeight:600,flexShrink:0},children:a+1}),s.jsx("span",{style:{fontSize:"13px",color:"#64748b"},children:D?.category||"Frage"})]}),s.jsx("p",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",lineHeight:1.5,margin:0},children:D?.question||"Frage wird geladen..."}),D?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"13px",marginTop:"12px"},children:[s.jsx(He,{size:14}),"Empfohlene Antwortzeit: ~",Math.round(D.estimated_time/60)," Min."]}),n?.enable_tips&&D?.tips&&s.jsx(Cf,{tips:D.tips,primaryAccent:P})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[w?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"16px",textAlign:"center"},children:[s.jsx(fh,{size:40,style:{marginBottom:"12px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"12px",fontSize:"14px"},children:w}),s.jsxs("button",{onClick:B,style:{padding:"10px 16px",borderRadius:"8px",background:P,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},children:[s.jsx(hn,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:H,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),c&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"13px",fontWeight:500},children:Oe(p)})]}),!c&&p>0&&s.jsxs("div",{style:{position:"absolute",top:"12px",left:"12px",display:"flex",alignItems:"center",gap:"6px",background:"rgba(0, 0, 0, 0.6)",padding:"6px 12px",borderRadius:"6px"},children:[s.jsx(He,{size:14,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"13px"},children:Oe(p)})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px"},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center"},children:c?s.jsxs("button",{onClick:le,style:{padding:"14px 24px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",width:"100%",justifyContent:"center"},children:[s.jsx(ph,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:ie,disabled:!C,style:{padding:"14px 24px",borderRadius:"12px",background:C?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:C?"pointer":"not-allowed",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",width:"100%",justifyContent:"center",boxShadow:C?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(ht,{size:20}),"Aufnahme starten"]})}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n?.enable_navigation&&a>0&&s.jsxs("button",{onClick:U,style:{padding:"10px 14px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",flex:1},children:[s.jsx(Io,{size:16}),"Zurck"]}),n?.enable_navigation&&a<e.length-1&&s.jsxs("button",{onClick:re,style:{padding:"10px 14px",borderRadius:"8px",background:P,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:500,flex:1},children:["Nchste",s.jsx(It,{size:16})]}),s.jsxs("button",{onClick:be,disabled:y.length===0,style:{padding:"10px 14px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:600,flex:1,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(Es,{size:16}),"Abschlieen"]})]})]})]})]}):s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{position:"relative",background:"#000",borderRadius:"16px",overflow:"hidden",aspectRatio:"16/9"},children:[w?s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#fff",padding:"20px",textAlign:"center"},children:[s.jsx(fh,{size:48,style:{marginBottom:"16px",opacity:.6}}),s.jsx("p",{style:{marginBottom:"16px"},children:w}),s.jsxs("button",{onClick:B,style:{padding:"10px 20px",borderRadius:"8px",background:P,color:"#fff",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(hn,{size:16}),"Erneut versuchen"]})]}):s.jsx("video",{ref:H,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}}),c&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",animation:"pulse 1.5s infinite"}}),s.jsx("span",{style:{color:"#fff",fontSize:"14px",fontWeight:500},children:Oe(p)})]}),!c&&p>0&&s.jsxs("div",{style:{position:"absolute",top:"16px",left:"16px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(0, 0, 0, 0.6)",padding:"8px 14px",borderRadius:"8px"},children:[s.jsx(He,{size:16,color:"#fff"}),s.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:Oe(p)})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",marginTop:"20px"},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center"},children:c?s.jsxs("button",{onClick:le,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(ph,{size:20,color:"#ef4444"}),"Aufnahme pausieren"]}):s.jsxs("button",{onClick:ie,disabled:!C,style:{padding:"14px 28px",borderRadius:"12px",background:C?"#ef4444":"#94a3b8",color:"#fff",border:"none",cursor:C?"pointer":"not-allowed",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"10px",boxShadow:C?"0 4px 14px rgba(239, 68, 68, 0.4)":"none"},children:[s.jsx(ht,{size:20}),"Aufnahme starten"]})}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px",flexWrap:"wrap"},children:[n?.enable_navigation&&a>0&&s.jsxs("button",{onClick:U,style:{padding:"10px 16px",borderRadius:"8px",background:"#fff",border:"1px solid #e2e8f0",cursor:"pointer",color:"#0f172a",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px"},children:[s.jsx(Io,{size:18}),"Vorherige"]}),n?.enable_navigation&&a<e.length-1&&s.jsxs("button",{onClick:re,style:{padding:"10px 16px",borderRadius:"8px",background:P,border:"none",cursor:"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:500},children:["Nchste",s.jsx(It,{size:18})]}),s.jsxs("button",{onClick:be,disabled:y.length===0,style:{padding:"10px 20px",borderRadius:"8px",background:y.length===0?"#94a3b8":"#22c55e",border:"none",cursor:y.length===0?"not-allowed":"pointer",color:"#fff",display:"flex",alignItems:"center",gap:"6px",fontSize:"14px",fontWeight:600,boxShadow:y.length>0?"0 4px 14px rgba(34, 197, 94, 0.3)":"none"},children:[s.jsx(Es,{size:18}),"Training abschlieen"]})]})]})]}),s.jsxs("div",{style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[s.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:F,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"13px",fontWeight:600},children:a+1}),s.jsx("span",{style:{fontSize:"14px",color:"#64748b"},children:D?.category||"Frage"})]}),s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",lineHeight:1.5,marginBottom:"16px"},children:D?.question||"Frage wird geladen..."}),D?.estimated_time&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontSize:"14px",marginBottom:"16px"},children:[s.jsx(He,{size:16}),"Empfohlene Antwortzeit: ~",Math.round(D.estimated_time/60)," Min."]}),n?.enable_tips&&D?.tips&&s.jsx(Cf,{tips:D.tips,primaryAccent:P})]})]}),R&&s.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{marginTop:"24px",padding:"16px",background:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(ve,{size:20,color:"#ef4444"}),s.jsx("p",{style:{color:"#dc2626",fontSize:"14px",flex:1},children:R}),s.jsx("button",{onClick:()=>_(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:s.jsx(kn,{size:16,color:"#ef4444"})})]}),s.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
          @keyframes spin { to { transform: rotate(360deg); } }
        `})]})},TN={auftreten:dm,selbstbewusstsein:Dt,koerpersprache:xt,kommunikation:ze,professionalitaet:Dt,inhalt:Ce},EN=({score:t,size:e=120,strokeWidth:n=10,primaryAccent:i})=>{const r=(e-n)/2,o=r*2*Math.PI,a=o-t/100*o,l=()=>t>=80?"#22c55e":t>=60?i:t>=40?"#f59e0b":"#ef4444";return s.jsxs("div",{style:{position:"relative",width:e,height:e},children:[s.jsxs("svg",{width:e,height:e,style:{transform:"rotate(-90deg)"},children:[s.jsx("circle",{cx:e/2,cy:e/2,r,fill:"none",stroke:"#e2e8f0",strokeWidth:n}),s.jsx(L.circle,{cx:e/2,cy:e/2,r,fill:"none",stroke:l(),strokeWidth:n,strokeLinecap:"round",strokeDasharray:o,initial:{strokeDashoffset:o},animate:{strokeDashoffset:a},transition:{duration:1.2,ease:"easeOut"}})]}),s.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[s.jsx("span",{style:{fontSize:e/3,fontWeight:700,color:l()},children:Math.round(t)}),s.jsx("span",{style:{fontSize:e/10,color:"#64748b"},children:"von 100"})]})]})},RN=({category:t,primaryAccent:e})=>{const[n,i]=g.useState(!1),r=TN[t.category]||Rt,o=a=>a>=80?"#22c55e":a>=60?e:a>=40?"#f59e0b":"#ef4444";return s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:"#fff",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden",marginBottom:"12px"},children:[s.jsxs("button",{onClick:()=>i(!n),style:{width:"100%",padding:"16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${o(t.score)}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(r,{size:20,color:o(t.score)})}),s.jsxs("div",{style:{flex:1,textAlign:"left"},children:[s.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"2px"},children:t.label}),s.jsxs("p",{style:{fontSize:"13px",color:"#64748b",margin:0},children:[t.feedback?.substring(0,60),"..."]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("span",{style:{fontSize:"20px",fontWeight:700,color:o(t.score)},children:Math.round(t.score)}),s.jsx(jt,{size:20,color:"#64748b",style:{transform:n?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),s.jsx(Ve,{children:n&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:s.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #e2e8f0",paddingTop:"16px"},children:[s.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"16px"},children:t.feedback}),t.strengths&&t.strengths.length>0&&s.jsxs("div",{style:{marginBottom:"12px"},children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#22c55e",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(Zt,{size:14}),"Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.strengths.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]}),t.improvements&&t.improvements.length>0&&s.jsxs("div",{children:[s.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#f59e0b",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx(ve,{size:14}),"Verbesserungspotenzial"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.improvements.map((a,l)=>s.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:a},l))})]})]})})})]})},IN=({session:t,scenario:e,onBackToDashboard:n,onStartNew:i})=>{const{branding:r}=ge(),o=r?.primaryAccent||"#3A7FA7",a=r?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",l=t?.overall_score||0,c=t?.category_scores||[],d=t?.analysis||{},u=t?.summary_feedback||"",h=p=>p>=90?"Ausgezeichnet!":p>=80?"Sehr gut!":p>=70?"Gut!":p>=60?"Solide Leistung":p>=50?"Ausbaufhig":"Weiter ben!";return s.jsxs("div",{style:{padding:"32px",maxWidth:"900px",margin:"0 auto"},children:[s.jsxs(L.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{textAlign:"center",marginBottom:"40px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:a,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.15)"},children:s.jsx(Os,{size:40,color:"#fff"})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Training abgeschlossen!"}),s.jsxs("p",{style:{fontSize:"16px",color:"#64748b"},children:[e?.title," - Deine Auswertung ist bereit"]})]}),s.jsxs(L.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},style:{background:"#fff",borderRadius:"20px",padding:"32px",textAlign:"center",border:"1px solid #e2e8f0",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[s.jsx(EN,{score:l,size:160,primaryAccent:o}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginTop:"20px",marginBottom:"8px"},children:h(l)}),s.jsx("p",{style:{fontSize:"15px",color:"#64748b",maxWidth:"500px",margin:"0 auto",lineHeight:1.6},children:u||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),c.length>0&&s.jsxs(L.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{marginBottom:"24px"},children:[s.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Rt,{size:20,color:o}),"Detaillierte Bewertung"]}),c.map((p,m)=>s.jsx(RN,{category:p,primaryAccent:o},p.category||m))]}),d&&(d.key_strengths?.length>0||d.actionable_tips?.length>0)&&s.jsxs(L.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[d.key_strengths&&d.key_strengths.length>0&&s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#22c55e",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Zt,{size:18}),"Deine Strken"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.key_strengths.map((p,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]}),d.actionable_tips&&d.actionable_tips.length>0&&s.jsxs("div",{children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:o,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(Ce,{size:18}),"Tipps zur Verbesserung"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:d.actionable_tips.map((p,m)=>s.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:p},m))})]})]}),t?.video_url&&s.jsxs(L.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[s.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(ht,{size:18,color:o}),"Deine Aufnahme"]}),s.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),s.jsxs(L.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},style:{display:"flex",gap:"16px",justifyContent:"center"},children:[s.jsxs("button",{onClick:n,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx(pt,{size:18}),"Zur bersicht"]}),s.jsxs("button",{onClick:i,style:{padding:"14px 28px",borderRadius:"12px",background:a,color:"#fff",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)"},children:[s.jsx(hn,{size:18}),"Nochmal ben"]})]})]})},en={DASHBOARD:"dashboard",WIZARD:"wizard",SESSION:"session",COMPLETE:"complete"},_N=({isAuthenticated:t,requireAuth:e,setPendingAction:n,pendingScenario:i,clearPendingScenario:r,onNavigateToHistory:o})=>{const[a,l]=g.useState(en.DASHBOARD),[c,d]=g.useState(null),[u,h]=g.useState(null),[p,m]=g.useState([]),[y,f]=g.useState({}),[b,S]=g.useState(null),[C,j]=g.useState(null);g.useEffect(()=>{i&&t&&(console.log("[VIDEO TRAINING] Processing external pending scenario after login:",i.title),d(i),l(en.WIZARD),r&&r())},[i,t,r]),g.useEffect(()=>{C&&t&&(console.log("[VIDEO TRAINING] Processing internal pending scenario after login:",C.title),d(C),l(en.WIZARD),j(null))},[C,t]),g.useEffect(()=>{window.scrollTo(0,0)},[a]);const w=g.useCallback(_=>{console.log("[VIDEO TRAINING] Scenario selected:",_.title),d(_),l(en.WIZARD)},[]),v=g.useCallback(()=>{console.log("[VIDEO TRAINING] Returning to dashboard"),d(null),h(null),m([]),f({}),S(null),l(en.DASHBOARD)},[]),E=g.useCallback(_=>{console.log("[VIDEO TRAINING] Starting session with",_.questions.length,"questions"),h(_.session),m(_.questions),f(_.variables),l(en.SESSION)},[]),k=g.useCallback(_=>{console.log("[VIDEO TRAINING] Session completed:",_.session?.id),S(_.session),l(en.COMPLETE)},[]),T=g.useCallback(()=>{v()},[v]),N=g.useCallback(()=>{console.log("[VIDEO TRAINING] Starting new session with same scenario"),h(null),m([]),S(null),l(en.WIZARD)},[]),R=()=>{switch(a){case en.DASHBOARD:return s.jsx(kf,{onSelectScenario:w,isAuthenticated:t,requireAuth:e,setPendingScenario:j,onNavigateToHistory:o});case en.WIZARD:return s.jsx(wN,{scenario:c,onBack:v,onStart:E});case en.SESSION:return s.jsx(jN,{session:u,questions:p,scenario:c,variables:y,onComplete:k,onExit:T});case en.COMPLETE:return s.jsx(IN,{session:b,scenario:c,onBackToDashboard:v,onStartNew:N});default:return s.jsx(kf,{onSelectScenario:w,isAuthenticated:t,requireAuth:e,setPendingScenario:j,onNavigateToHistory:o})}};return s.jsx("div",{style:{minHeight:"100%"},children:R()})},By={rocket:Ln,shuffle:qk,zap:fd},oo=({icon:t,label:e,value:n,primaryAccent:i,primaryAccentLight:r,isMobile:o})=>s.jsxs("div",{style:{backgroundColor:"white",borderRadius:o?"10px":"12px",padding:o?"12px":"16px",border:`1px solid ${x.slate[200]}`},children:[s.jsx("div",{style:{width:o?"32px":"40px",height:o?"32px":"40px",borderRadius:o?"8px":"10px",backgroundColor:r,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:o?"8px":"12px"},children:s.jsx(t,{style:{width:o?"16px":"20px",height:o?"16px":"20px",color:i}})}),s.jsx("div",{style:{fontSize:o?"20px":"24px",fontWeight:700,color:x.slate[900]},children:n}),s.jsx("div",{style:{fontSize:o?"11px":"13px",color:x.slate[500]},children:e})]}),NN=({mode:t,onBack:e,onStart:n})=>{const[i,r]=g.useState(""),[o,a]=g.useState(!1),[l,c]=g.useState(null),[d,u]=g.useState(!1),h=By[t.icon]||Ln;Zd[t.id]||Zd.klassiker;const{branding:p}=ge(),m=p?.["--button-gradient"]||p?.["--header-gradient"]||Q["--header-gradient"],y=p?.["--header-gradient"]||Q["--header-gradient"],f=p?.["--primary-accent"]||Q["--primary-accent"];g.useEffect(()=>{t.id==="klassiker"?r(t.topic):t.getTopic&&r(t.getTopic())},[t]);const b=()=>{if(!t.getTopic)return;a(!0);const C=1500,j=100;let w=0;const v=setInterval(()=>{r(t.getTopic()),w+=j,w>=C&&(clearInterval(v),a(!1))},j)},S=()=>{n({mode:t,topic:i,duration:t.duration,selectedMicrophoneId:l})};return s.jsxs("div",{style:{minHeight:"100%",display:"flex",flexDirection:"column",padding:"24px"},children:[s.jsxs(L.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",backgroundColor:"white",border:`1px solid ${x.slate[200]}`,borderRadius:"10px",color:x.slate[600],fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:"32px",width:"fit-content"},children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zurck zur Auswahl"]}),s.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"600px",margin:"0 auto",width:"100%"},children:[s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{textAlign:"center",marginBottom:"32px"},children:[s.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"20px",background:y,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:`0 10px 30px ${f}44`},children:s.jsx(h,{style:{width:"40px",height:"40px",color:"white"}})}),s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:x.slate[900],margin:"0 0 8px 0"},children:t.title}),s.jsxs("p",{style:{fontSize:"15px",color:x.slate[500],margin:0},children:[t.duration," Sekunden  ",t.subtitle]})]}),s.jsxs(L.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{width:"100%",background:y,borderRadius:"20px",padding:"32px",marginBottom:"24px",boxShadow:`0 20px 40px ${f}33`},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"rgba(255,255,255,0.9)"},children:[s.jsx(Ei,{style:{width:"20px",height:"20px"}}),s.jsx("span",{style:{fontWeight:600,fontSize:"15px"},children:t.id==="klassiker"?"Deine Aufgabe":t.id==="stress"?"Die Frage":"Dein Thema"})]}),t.getTopic&&s.jsxs(L.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:b,disabled:o,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 18px",backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"10px",color:"white",fontSize:"14px",fontWeight:600,cursor:o?"not-allowed":"pointer"},children:[s.jsx(hn,{style:{width:"16px",height:"16px",animation:o?"spin 0.5s linear infinite":"none"}}),o?"Dreht...":"Neu wrfeln"]})]}),s.jsx(Ve,{mode:"wait",children:s.jsxs(L.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{fontSize:"22px",fontWeight:600,color:"white",margin:0,lineHeight:1.5,minHeight:"66px"},children:['"',i,'"']},i)})]}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{width:"100%",backgroundColor:"white",borderRadius:"14px",padding:"24px",marginBottom:"24px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px",color:x.slate[700]},children:[s.jsx(Xe,{style:{width:"20px",height:"20px",color:f}}),s.jsx("span",{style:{fontWeight:600,fontSize:"15px"},children:"Mikrofon auswhlen"})]}),s.jsx(Sa,{selectedDeviceId:l,onDeviceChange:c,onTestClick:()=>u(!0)})]}),s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{width:"100%",backgroundColor:x.slate[50],borderRadius:"14px",padding:"20px",marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:x.slate[700]},children:[s.jsx(st,{style:{width:"18px",height:"18px",color:x.amber[500]}}),s.jsx("span",{style:{fontWeight:600,fontSize:"14px"},children:"Tipps fr deine Antwort"})]}),s.jsxs("ul",{style:{margin:0,paddingLeft:"20px",color:x.slate[600],fontSize:"14px",lineHeight:1.7},children:[s.jsx("li",{children:"Atme tief durch bevor du beginnst"}),s.jsx("li",{children:"Sprich in einem ruhigen, gleichmigen Tempo"}),s.jsx("li",{children:'Mache bewusst Pausen statt "hm" zu sagen'}),s.jsx("li",{children:"Strukturiere deine Antwort: Einleitung  Hauptteil  Schluss"})]})]}),s.jsxs(L.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,style:{width:"100%",maxWidth:"400px",padding:"18px 32px",borderRadius:"14px",border:"none",background:m,color:"white",fontSize:"17px",fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:`0 8px 20px ${f}44`},children:[s.jsx($t,{style:{width:"22px",height:"22px"}}),"Aufnahme starten"]})]}),s.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),s.jsx(ka,{isOpen:d,onClose:()=>u(!1),deviceId:l})]})},ss={MODES:"modes",TOPIC:"topic"},AN=({onStartGame:t,isAuthenticated:e,requireAuth:n,setPendingAction:i})=>{const[r,o]=g.useState(ss.MODES),[a,l]=g.useState(null),[c,d]=g.useState("grid"),[u,h]=g.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),[p,m]=g.useState(window.innerWidth<768);g.useEffect(()=>{const N=()=>m(window.innerWidth<768);return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const[y,f]=g.useState(null),{branding:b}=ge(),S=b?.["--header-gradient"]||Q["--header-gradient"],C=b?.["--header-text"]||Q["--header-text"],j=b?.["--primary-accent"]||Q["--primary-accent"],w=b?.["--primary-accent-light"]||Q["--primary-accent-light"];g.useEffect(()=>{const N=async()=>{try{const R=await fe.getGameStats();console.log(" [RhetorikGym] Stats response:",R),R.success&&R.data&&h({totalGames:R.data.total_games||0,bestScore:R.data.best_score||0,avgScore:R.data.avg_score||0,totalPracticeTime:R.data.total_practice_time||0})}catch(R){console.error("Failed to load stats:",R)}};r===ss.MODES&&N()},[r]),g.useEffect(()=>{y&&e&&(console.log(" [RhetorikGym] Processing pending mode after login:",y.title),l(y),o(ss.TOPIC),f(null))},[y,e]),g.useEffect(()=>{window.scrollTo(0,0)},[r]);const v=N=>{if(!e){console.log(" [RhetorikGym] Auth required - storing pending mode:",N.title),f(N),n&&n(()=>{},null);return}l(N),o(ss.TOPIC)},E=()=>{l(null),o(ss.MODES)},k=N=>{t(N)},T=Object.values(nT);return r===ss.TOPIC&&a?s.jsx(NN,{mode:a,onBack:E,onStart:k}):s.jsxs("div",{style:{padding:p?"16px":"24px"},children:[s.jsxs("div",{style:{marginBottom:p?"20px":"32px",textAlign:"center"},children:[s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:p?"10px":"12px",marginBottom:p?"8px":"12px"},children:[s.jsx("div",{style:{width:p?"40px":"48px",height:p?"40px":"48px",borderRadius:p?"12px":"14px",background:S,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ld,{style:{width:p?"20px":"24px",height:p?"20px":"24px",color:C}})}),s.jsx("h1",{style:{fontSize:p?"22px":"28px",fontWeight:700,color:x.slate[900],margin:0},children:"Der Fllwort-Killer"})]}),s.jsx("p",{style:{fontSize:p?"14px":"16px",color:x.slate[600],maxWidth:"600px",margin:"0 auto"},children:"Trainiere deine Rhetorik - sprich flssig und berzeugend ohne hm und h!"})]}),s.jsxs("div",{style:{padding:p?"0 8px":"0 24px"},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:p?"repeat(2, 1fr)":"repeat(auto-fit, minmax(150px, 1fr))",gap:p?"10px":"16px",marginBottom:p?"24px":"32px"},children:[s.jsx(oo,{icon:Os,label:"Highscore",value:u.bestScore||"-",primaryAccent:j,primaryAccentLight:w,isMobile:p}),s.jsx(oo,{icon:De,label:"Spiele",value:u.totalGames||0,primaryAccent:j,primaryAccentLight:w,isMobile:p}),s.jsx(oo,{icon:Vt,label:"Durchschnitt",value:u.avgScore?Math.round(u.avgScore):"-",primaryAccent:j,primaryAccentLight:w,isMobile:p}),s.jsx(oo,{icon:He,label:"Trainingszeit",value:u.totalPracticeTime?`${Math.round(u.totalPracticeTime/60)}m`:"0m",primaryAccent:j,primaryAccentLight:w,isMobile:p})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[s.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:x.slate[800],margin:0},children:"Whle deinen Modus"}),s.jsx(aa,{viewMode:c,onViewChange:d})]}),s.jsx(Wr,{minCardWidth:"280px",viewMode:c,children:T.map(N=>{const R=By[N.icon]||Ln;return s.jsx(Ur,{title:N.title,subtitle:N.subtitle,description:N.description,icon:R,meta:[{icon:He,text:`${N.duration} Sekunden`}],action:{label:"Starten",icon:Vt},onClick:()=>v(N),viewMode:c},N.id)})})]})]})},vt={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},PN=({count:t})=>s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:s.jsxs(L.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},style:{color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"120px",fontWeight:700,marginBottom:"16px"},children:t}),s.jsx("div",{style:{fontSize:"24px",color:x.slate[400]},children:t===3?"Mach dich bereit...":t===2?"Durchatmen...":"Los geht's!"})]},t)}),MN=({seconds:t,total:e,isWarning:n,primaryAccent:i})=>{const r=t/e*100,o=Math.floor(t/60),a=t%60;return s.jsxs("div",{children:[s.jsxs("div",{style:{fontSize:"64px",fontWeight:700,fontFamily:"monospace",textAlign:"center",color:n?x.red[500]:x.slate[900]},children:[o,":",a.toString().padStart(2,"0")]}),s.jsx("div",{style:{marginTop:"16px",height:"8px",backgroundColor:x.slate[200],borderRadius:"4px",overflow:"hidden"},children:s.jsx(L.div,{style:{height:"100%",backgroundColor:n?x.red[500]:i,borderRadius:"4px"},initial:{width:"100%"},animate:{width:`${r}%`},transition:{duration:.5}})})]})},DN=({word:t,count:e})=>s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"6px 12px",backgroundColor:x.red[100],color:x.red[600],borderRadius:"20px",fontSize:"14px",fontWeight:500},children:['"',t,'"',s.jsxs("span",{style:{backgroundColor:x.red[200],padding:"2px 6px",borderRadius:"10px",fontSize:"12px"},children:[e,"x"]})]}),ON=t=>!t||t==="[Keine Sprache erkannt]"?0:t.trim().split(/\s+/).filter(e=>e.length>0).length,LN=t=>!t||!Array.isArray(t)?0:t.reduce((e,n)=>e+(n.count||0),0),FN=(t,e,n,i)=>{const r=ON(t),o=LN(e),a=r>0?o/r*100:0,l=i>0?Math.round(r/i*60):0;let c=0;r>=60?c=25:r>=40?c=15:r>=20?c=10:r>=10&&(c=5);let d=25;a>25?d=0:a>15?d=10:a>10?d=15:a>5&&(d=20);let u=0,h="keine_sprache";r>0&&(l>=100&&l<=140?(u=10,h="optimal"):l>=80&&l<100||l>140&&l<=160?(u=5,h=l<100?"zu_langsam":"zu_schnell"):(u=0,h=l<80?"zu_langsam":"zu_schnell"));const p=Math.min(40,Math.max(0,n||0)),m=c+d+u+p;return{total_words:r,filler_count:o,filler_percentage:a,words_per_minute:l,pace_feedback:h,score:m,score_breakdown:{words_score:c,filler_score:d,tempo_score:u,content_score:p}}},BN=({result:t,onPlayAgain:e,onBack:n,buttonGradient:i,primaryAccent:r,primaryAccentLight:o})=>{const a=Qj(t.score),l=t.score>=70,c=t.pace_feedback==="keine_sprache"||t.transcript==="[Keine Sprache erkannt]";return s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[s.jsxs("div",{style:{borderRadius:"20px",padding:"32px",marginBottom:"24px",background:c?`linear-gradient(135deg, ${x.slate[600]} 0%, ${x.slate[700]} 100%)`:l?`linear-gradient(135deg, ${x.green[500]} 0%, ${x.teal[500]} 100%)`:`linear-gradient(135deg, ${x.amber[500]} 0%, ${x.amber[600]} 100%)`,color:"white",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"48px",marginBottom:"8px"},children:c?"":a.emoji}),s.jsx("div",{style:{fontSize:"72px",fontWeight:700,marginBottom:"8px"},children:t.score}),s.jsx("div",{style:{fontSize:"18px",opacity:.9,marginBottom:"16px"},children:"Punkte"}),s.jsx("p",{style:{fontSize:"16px",margin:0},children:c?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":a.message})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"24px"},children:[s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"14px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:x.teal[600],marginBottom:"6px"},children:[s.jsx(Ei,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Wrter"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900]},children:t.total_words}),s.jsx("div",{style:{fontSize:"11px",color:x.slate[500]},children:"gesprochen"})]}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"14px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:x.red[600],marginBottom:"6px"},children:[s.jsx(Mn,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Fllwrter"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900]},children:t.filler_count}),s.jsxs("div",{style:{fontSize:"11px",color:x.slate[500]},children:[t.filler_percentage?.toFixed(1)||"0","%"]})]}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"14px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:r,marginBottom:"6px"},children:[s.jsx(Ci,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Tempo"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900]},children:t.words_per_minute}),s.jsx("div",{style:{fontSize:"11px",color:x.slate[500]},children:"WPM"})]}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"14px",border:`1px solid ${x.slate[200]}`},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:x.slate[600],marginBottom:"6px"},children:[s.jsx(He,{style:{width:"16px",height:"16px"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Sprechzeit"})]}),s.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900]},children:t.duration_seconds||0}),s.jsx("div",{style:{fontSize:"11px",color:x.slate[500]},children:"Sekunden"})]})]}),t.filler_words&&t.filler_words.length>0&&s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"16px",border:`1px solid ${x.slate[200]}`,marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:x.slate[900],marginBottom:"12px",fontSize:"15px"},children:"Erkannte Fllwrter"}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:t.filler_words.map((d,u)=>s.jsx(DN,{word:d.word,count:d.count},u))})]}),!c&&s.jsxs("div",{style:{backgroundColor:o,border:`1px solid ${r}26`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:r,marginBottom:"12px",fontSize:"15px"},children:"Bewertung im Detail"}),t.score_breakdown&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:t.content_feedback?"12px":0},children:[s.jsxs("div",{style:{fontSize:"13px",color:x.slate[600]},children:[" Wortanzahl: ",s.jsxs("strong",{children:[t.score_breakdown.words_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:x.slate[600]},children:[" Fllwrter: ",s.jsxs("strong",{children:[t.score_breakdown.filler_score||0,"/25"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:x.slate[600]},children:[" Tempo: ",s.jsxs("strong",{children:[t.score_breakdown.tempo_score||0,"/10"]})]}),s.jsxs("div",{style:{fontSize:"13px",color:x.slate[600]},children:[" Inhalt: ",s.jsxs("strong",{children:[t.score_breakdown.content_score||0,"/40"]})]})]}),t.content_feedback&&s.jsx("div",{style:{paddingTop:"12px",borderTop:`1px solid ${r}26`},children:s.jsxs("p",{style:{fontSize:"14px",color:x.slate[700],margin:0,lineHeight:1.5},children:[s.jsx("strong",{children:"Inhaltliches Feedback:"})," ",t.content_feedback]})})]}),t.pace_feedback&&t.pace_feedback!=="optimal"&&t.pace_feedback!=="keine_sprache"&&s.jsxs("div",{style:{backgroundColor:x.amber[50],border:`1px solid ${x.amber[100]}`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[s.jsx("h4",{style:{fontWeight:600,color:x.amber[600],marginBottom:"8px",fontSize:"15px"},children:"Tempo-Hinweis"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],margin:0},children:t.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine Prsentation zu legen."})]}),t.transcript&&t.transcript!=="[Keine Sprache erkannt]"&&s.jsxs("div",{style:{backgroundColor:x.slate[50],borderRadius:"12px",border:`1px solid ${x.slate[200]}`,padding:"16px",marginBottom:"32px"},children:[s.jsx("h4",{style:{fontWeight:600,color:x.slate[900],marginBottom:"12px",fontSize:"15px"},children:"Transkript"}),s.jsx("p",{style:{fontSize:"14px",color:x.slate[600],lineHeight:1.6,margin:0},children:t.transcript})]}),s.jsxs("div",{style:{display:"flex",gap:"16px"},children:[s.jsxs("button",{onClick:e,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:"none",background:i,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx(Si,{style:{width:"18px",height:"18px"}}),"Nochmal spielen"]}),s.jsxs("button",{onClick:n,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,backgroundColor:"white",color:x.slate[700],fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zurck"]})]})]})},zN=({gameConfig:t,onBack:e,onComplete:n})=>{const[i,r]=g.useState(vt.COUNTDOWN),[o,a]=g.useState(3),[l,c]=g.useState(t.duration),[d,u]=g.useState(null),[h,p]=g.useState(null),[m,y]=g.useState(0),[f,b]=g.useState(!1),{branding:S}=ge(),C=S?.["--header-gradient"]||Q["--header-gradient"],j=S?.["--button-gradient"]||C,w=S?.["--primary-accent"]||Q["--primary-accent"],v=S?.["--primary-accent-light"]||Q["--primary-accent-light"],E=g.useRef(null),k=g.useRef([]),T=g.useRef(null),N=g.useRef(null),R=g.useRef(null),_=g.useRef(null),A=g.useRef(null),Y=fe.getGeminiApiKey(),H=g.useCallback(()=>{T.current&&clearInterval(T.current),_.current&&cancelAnimationFrame(_.current),R.current&&(R.current.close(),R.current=null),E.current&&E.current.state!=="inactive"&&E.current.stop()},[]);g.useEffect(()=>H,[H]),g.useEffect(()=>{f||(b(!0),$())},[f]);const $=async()=>{r(vt.COUNTDOWN),a(3);try{const G=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,ie=await navigator.mediaDevices.getUserMedia({audio:G});R.current=new(window.AudioContext||window.webkitAudioContext);const le=R.current.createMediaStreamSource(ie);N.current=R.current.createAnalyser(),N.current.fftSize=256,le.connect(N.current),E.current=new MediaRecorder(ie,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),k.current=[],E.current.ondataavailable=be=>{be.data.size>0&&k.current.push(be.data)};let re=3;const U=setInterval(()=>{re--,a(re),re===0&&(clearInterval(U),O())},1e3)}catch(G){console.error("Microphone access denied:",G),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(vt.ERROR)}},K=g.useCallback(async()=>{r(vt.COUNTDOWN),a(3);try{const G=t.selectedMicrophoneId?{deviceId:{exact:t.selectedMicrophoneId}}:!0,ie=await navigator.mediaDevices.getUserMedia({audio:G});R.current=new(window.AudioContext||window.webkitAudioContext);const le=R.current.createMediaStreamSource(ie);N.current=R.current.createAnalyser(),N.current.fftSize=256,le.connect(N.current),E.current=new MediaRecorder(ie,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),k.current=[],E.current.ondataavailable=be=>{be.data.size>0&&k.current.push(be.data)};let re=3;const U=setInterval(()=>{re--,a(re),re===0&&(clearInterval(U),O())},1e3)}catch(G){console.error("Microphone access denied:",G),p("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),r(vt.ERROR)}},[t.selectedMicrophoneId]),O=g.useCallback(()=>{r(vt.RECORDING),c(t.duration),A.current=Date.now(),E.current.start();const G=()=>{if(N.current){const ie=new Uint8Array(N.current.frequencyBinCount);N.current.getByteFrequencyData(ie);const le=ie.reduce((re,U)=>re+U)/ie.length;y(le/255)}_.current=requestAnimationFrame(G)};G(),T.current=setInterval(()=>{c(ie=>ie<=1?(P(),0):ie-1)},1e3)},[t.duration]),P=g.useCallback(()=>{const G=A.current?Math.round((Date.now()-A.current)/1e3):t.duration;H(),r(vt.PROCESSING),E.current.onstop=async()=>{const ie=new Blob(k.current,{type:E.current.mimeType});E.current.stream.getTracks().forEach(le=>le.stop());try{const le=await lT(ie,Y,t.topic,t.duration),U={...FN(le.transcript,le.filler_words,le.content_score,G),transcript:le.transcript||"[Keine Sprache erkannt]",filler_words:le.filler_words||[],content_feedback:le.content_feedback||"",duration_seconds:G};u(U),r(vt.RESULTS);try{const be={game_type:t.mode.id,topic:t.topic,duration_seconds:G,score:U.score,filler_count:U.filler_count,words_per_minute:U.words_per_minute,transcript:U.transcript,analysis_json:JSON.stringify(U)};console.log(" [GameSession] Saving game session:",be);const Oe=await fe.createGameSession(be);console.log(" [GameSession] Save result:",Oe)}catch(be){console.error(" [GameSession] Failed to save game session:",be)}}catch(le){console.error("Analysis failed:",le),p(`Analyse fehlgeschlagen: ${le.message}`),r(vt.ERROR)}},E.current.stop()},[Y,t,H]),F=()=>{P()},D=()=>{u(null),p(null),c(t.duration),K()},B=()=>{switch(i){case vt.READY:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:""}),s.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:x.slate[900],marginBottom:"12px"},children:"Bereit?"}),s.jsx("p",{style:{fontSize:"16px",color:x.slate[600],marginBottom:"24px",lineHeight:1.6},children:t.topic}),s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:x.slate[100],borderRadius:"20px",color:x.slate[600],fontSize:"14px",marginBottom:"32px"},children:[s.jsx(He,{style:{width:"16px",height:"16px"}}),t.duration," Sekunden"]}),s.jsx("div",{children:s.jsxs("button",{onClick:K,style:{padding:"16px 40px",borderRadius:"14px",border:"none",background:j,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 14px ${w}66`},children:[s.jsx($t,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]})}),s.jsxs("button",{onClick:e,style:{marginTop:"24px",padding:"10px 20px",border:"none",backgroundColor:"transparent",color:x.slate[500],fontSize:"14px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},children:[s.jsx(pt,{style:{width:"16px",height:"16px"}}),"Zurck zur Auswahl"]})]})});case vt.RECORDING:return s.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:s.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[s.jsx(MN,{seconds:l,total:t.duration,isWarning:l<=10,primaryAccent:w}),s.jsxs("div",{style:{marginTop:"32px",marginBottom:"32px",padding:"16px",backgroundColor:x.slate[50],borderRadius:"12px"},children:[s.jsx("p",{style:{fontSize:"13px",color:x.slate[500],marginBottom:"4px"},children:"Dein Thema:"}),s.jsx("p",{style:{fontSize:"15px",fontWeight:500,color:x.slate[900],margin:0},children:t.topic})]}),s.jsx("div",{style:{marginBottom:"32px"},children:s.jsx(L.div,{style:{height:"80px",background:j,borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},animate:{opacity:.6+m*.4},children:s.jsx(L.div,{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},animate:{scale:1+m*.3},children:s.jsx(Xe,{style:{width:"28px",height:"28px",color:"white"}})})})}),s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"32px"},children:[s.jsx(L.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:x.red[500]}}),s.jsx("span",{style:{fontWeight:500,color:x.red[600],fontSize:"14px"},children:"Aufnahme luft..."})]}),s.jsxs("button",{onClick:F,style:{padding:"12px 24px",borderRadius:"12px",border:"none",backgroundColor:x.red[500],color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(Sr,{style:{width:"16px",height:"16px"}}),"Aufnahme beenden"]})]})});case vt.PROCESSING:return s.jsxs("div",{style:{textAlign:"center",padding:"80px 20px"},children:[s.jsx(L.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},style:{width:"56px",height:"56px",border:`4px solid ${w}`,borderTopColor:"transparent",borderRadius:"50%",margin:"0 auto 24px"}}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:x.slate[900],marginBottom:"8px"},children:"Analysiere deine Aufnahme..."}),s.jsx("p",{style:{color:x.slate[500]},children:"Der Fllwort-Killer zhlt nach"})]});case vt.RESULTS:return s.jsx(BN,{result:d,onPlayAgain:D,onBack:e,buttonGradient:j,primaryAccent:w,primaryAccentLight:v});case vt.ERROR:return s.jsx("div",{style:{textAlign:"center",padding:"60px 20px"},children:s.jsxs("div",{style:{maxWidth:"400px",margin:"0 auto"},children:[s.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:x.red[50],display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:s.jsx(Nk,{style:{width:"32px",height:"32px",color:x.red[500]}})}),s.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:x.slate[900],marginBottom:"12px"},children:"Fehler"}),s.jsx("p",{style:{color:x.slate[600],marginBottom:"24px"},children:h}),s.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[s.jsxs("button",{onClick:D,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:j,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(Si,{style:{width:"16px",height:"16px"}}),"Erneut versuchen"]}),s.jsxs("button",{onClick:e,style:{padding:"12px 24px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,backgroundColor:"white",color:x.slate[700],fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[s.jsx(pt,{style:{width:"16px",height:"16px"}}),"Zurck"]})]})]})});default:return null}};return s.jsxs("div",{style:{minHeight:"100%",paddingBottom:"32px"},children:[s.jsx(Ve,{children:i===vt.COUNTDOWN&&s.jsx(PN,{count:o})}),i!==vt.COUNTDOWN&&i!==vt.RECORDING&&s.jsx("div",{style:{padding:"16px 24px",borderBottom:`1px solid ${x.slate[200]}`,backgroundColor:"white",position:"sticky",top:0,zIndex:10},children:s.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"6px",border:"none",backgroundColor:"transparent",color:x.slate[600],fontSize:"14px",cursor:"pointer"},children:[s.jsx(pt,{style:{width:"18px",height:"18px"}}),"Zurck"]}),s.jsx("h1",{style:{fontWeight:600,color:x.slate[900],fontSize:"16px",margin:0},children:t.mode.title}),s.jsx("div",{style:{width:"60px"}})]})}),s.jsx("div",{style:{padding:"24px"},children:s.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:B()})})]})},UN={"file-text":Tt,briefcase:Qt,banknote:ni,users:un,user:xt,"message-circle":Ei,target:De,award:Dt,book:Fr,clipboard:Br,star:Rt,lightbulb:Ce,shield:Hi,compass:zr,rocket:Ln},Tc={CAREER:{label:"Karriere",color:"#3b82f6"},SALES:{label:"Vertrieb",color:"#22c55e"},LEADERSHIP:{label:"Fuhrung",color:"#a855f7"},COMMUNICATION:{label:"Kommunikation",color:"#f59e0b"}},WN=({category:t})=>{const e=Tc[t]||Tc.CAREER;return s.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"16px",fontSize:"11px",fontWeight:600,backgroundColor:`${e.color}15`,color:e.color,textTransform:"uppercase",letterSpacing:"0.5px"},children:e.label})},VN=({onSelectTemplate:t,onShowList:e,isAuthenticated:n,requireAuth:i,setPendingAction:r})=>{const{config:o,branding:a}=ge(),[l,c]=g.useState([]),[d,u]=g.useState(!0),[h,p]=g.useState(null),[m,y]=g.useState(null),[f,b]=g.useState("grid"),[S,C]=g.useState(""),j=a?.["--primary-accent"]||o?.buttonGradientStart||"#3A7FA7";g.useEffect(()=>{(async()=>{try{u(!0),p(null);const T=await fe.request("/smartbriefing/templates",{method:"GET"});if(T.success&&T.data?.templates)c(T.data.templates);else throw new Error("Unerwartete API-Antwort")}catch(T){console.error("[SmartBriefing] Error fetching templates:",T),p(T.message||"Fehler beim Laden der Templates")}finally{u(!1)}})()},[]);const w=k=>{t(k)},v=g.useMemo(()=>[...new Set(l.map(k=>k.category))],[l]),E=g.useMemo(()=>{let k=[...l];if(m&&(k=k.filter(T=>T.category===m)),S.trim()){const T=S.toLowerCase();k=k.filter(N=>N.title?.toLowerCase().includes(T)||N.description?.toLowerCase().includes(T))}return k},[l,m,S]);return s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:`linear-gradient(135deg, ${j}, ${j}dd)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(st,{size:24,style:{color:"white"}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",margin:0},children:"Smart Briefing"}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Dein KI-gesttzter Vorbereitungs-Assistent"})]})]}),n&&e&&s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:`2px solid ${j}`,backgroundColor:"white",color:j,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(_s,{size:18}),"Meine Briefings"]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginTop:"24px",alignItems:"center"},children:[s.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"200px"},children:[s.jsx(ei,{style:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",width:"18px",height:"18px",color:x.slate[400],pointerEvents:"none"}}),s.jsx("input",{type:"text",placeholder:"Templates durchsuchen...",value:S,onChange:k=>C(k.target.value),style:{width:"100%",padding:"12px 14px 12px 44px",borderRadius:"12px",border:`1px solid ${x.slate[200]}`,fontSize:"14px",color:x.slate[900],backgroundColor:"#fff",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:k=>{k.target.style.borderColor=j,k.target.style.boxShadow=`0 0 0 3px ${j}20`},onBlur:k=>{k.target.style.borderColor=x.slate[200],k.target.style.boxShadow="none"}})]}),s.jsx(aa,{viewMode:f,onViewChange:b})]})]}),v.length>1&&s.jsx("div",{style:{marginBottom:"24px"},children:s.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[s.jsx("button",{onClick:()=>y(null),style:{padding:"8px 16px",borderRadius:"20px",border:"none",backgroundColor:m===null?j:"#f1f5f9",color:m===null?"white":"#64748b",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:"Alle"}),v.map(k=>{const T=Tc[k]||{label:k,color:"#64748b"};return s.jsx("button",{onClick:()=>y(k),style:{padding:"8px 16px",borderRadius:"20px",border:"none",backgroundColor:m===k?T.color:"#f1f5f9",color:m===k?"white":"#64748b",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:T.label},k)})]})}),d&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(ye,{size:40,style:{color:j,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Templates werden geladen..."}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}),h&&!d&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(ve,{size:24,style:{color:"#ef4444",flexShrink:0}}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:"0 0 4px 0",color:"#dc2626",fontSize:"16px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:h})]})]}),!d&&!h&&s.jsx(s.Fragment,{children:E.length===0?s.jsxs("div",{style:{textAlign:"center",padding:"48px 24px",backgroundColor:"#f8fafc",borderRadius:"16px"},children:[s.jsx(Tt,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h3",{style:{color:"#64748b",margin:"0 0 8px 0"},children:"Keine Templates gefunden"}),s.jsx("p",{style:{color:"#94a3b8",margin:0},children:m?"In dieser Kategorie sind keine Templates verfgbar.":"Es wurden noch keine Briefing-Templates erstellt."})]}):s.jsx(Wr,{viewMode:f,children:E.map(k=>{const T=UN[k.icon]||Tt,N=k.variables_schema?.length||0;return s.jsx(Ur,{title:k.title,description:k.description,icon:T,categoryBadge:s.jsx(WN,{category:k.category}),meta:[{text:`${N} Eingabefeld${N!==1?"er":""}`}],action:{label:"Briefing erstellen",icon:It},onClick:()=>w(k),viewMode:f},k.id)})})}),s.jsx("div",{style:{marginTop:"48px",padding:"20px 24px",backgroundColor:`${j}08`,borderRadius:"12px",border:`1px solid ${j}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(Ce,{size:20,style:{color:j,flexShrink:0,marginTop:"2px"}}),s.jsxs("div",{children:[s.jsx("h4",{style:{margin:"0 0 4px 0",color:"#0f172a",fontSize:"14px",fontWeight:600},children:"So funktioniert Smart Briefing"}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px",lineHeight:1.6},children:"Wahle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein massgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren Ruckfragen."})]})]})})]})},$N={"file-text":Tt,briefcase:Qt,banknote:ni,users:un,user:xt,"message-circle":Ei,target:De,award:Dt,book:Fr,clipboard:Br,star:Rt,lightbulb:Ce,shield:Hi,compass:zr,rocket:Ln},GN=({field:t,value:e,onChange:n,error:i,primaryAccent:r})=>{const o={width:"100%",padding:"14px 16px",borderRadius:"12px",border:`2px solid ${i?"#ef4444":"#e2e8f0"}`,fontSize:"16px",color:"#0f172a",backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s",boxSizing:"border-box"},a=d=>{d.target.style.borderColor=r,d.target.style.boxShadow=`0 0 0 3px ${r}1a`},l=d=>{d.target.style.borderColor=i?"#ef4444":"#e2e8f0",d.target.style.boxShadow="none"},c=()=>{switch(t.type){case"textarea":return s.jsx("textarea",{value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",rows:4,style:{...o,minHeight:"120px",resize:"vertical"},onFocus:a,onBlur:l});case"select":return s.jsxs("select",{value:e||t.default||"",onChange:d=>n(t.key,d.target.value),style:{...o,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 12px center",backgroundSize:"20px",paddingRight:"44px"},onFocus:a,onBlur:l,children:[s.jsx("option",{value:"",children:"Bitte wahlen..."}),t.options?.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value))]});case"text":default:return s.jsx("input",{type:"text",value:e||"",onChange:d=>n(t.key,d.target.value),placeholder:t.placeholder||"",style:o,onFocus:a,onBlur:l})}};return s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:600,color:"#374151",marginBottom:"8px"},children:[t.label,t.required&&s.jsx("span",{style:{color:"#ef4444",marginLeft:"4px"},children:"*"})]}),c(),i&&s.jsx("p",{style:{color:"#ef4444",fontSize:"13px",marginTop:"6px",margin:"6px 0 0 0"},children:i})]})},qN=({template:t,onBack:e,onBriefingGenerated:n,isAuthenticated:i})=>{const{config:r}=ge(),[o,a]=g.useState({}),[l,c]=g.useState({}),[d,u]=g.useState(!1),[h,p]=g.useState(null),m=r?.buttonGradientStart||"#3A7FA7",y=$N[t?.icon]||Tt;g.useEffect(()=>{if(t?.variables_schema){const C={};t.variables_schema.forEach(j=>{j.default&&(C[j.key]=j.default)}),a(C)}},[t]);const f=(C,j)=>{a(w=>({...w,[C]:j})),l[C]&&c(w=>{const v={...w};return delete v[C],v})},b=()=>{const C={};return t?.variables_schema?.forEach(j=>{j.required&&!o[j.key]&&(C[j.key]="Dieses Feld ist erforderlich")}),C},S=async C=>{C.preventDefault();const j=b();if(Object.keys(j).length>0){c(j);return}u(!0),p(null);try{console.log("[SmartBriefing] Generating briefing with variables:",o);const w=await fe.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify({template_id:t.id,variables:o})});if(w.success&&w.data?.briefing)console.log("[SmartBriefing] Briefing generated successfully"),n(w.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(w){console.error("[SmartBriefing] Error generating briefing:",w),p(w.message||"Fehler beim Generieren des Briefings")}finally{u(!1)}};return t?s.jsxs("div",{style:{padding:"24px",maxWidth:"700px",margin:"0 auto"},children:[s.jsxs("button",{onClick:e,disabled:d,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:d?"not-allowed":"pointer",marginBottom:"24px",opacity:d?.5:1},children:[s.jsx(pt,{size:18}),"Zuruck zur Ubersicht"]}),s.jsx("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",marginBottom:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"12px",background:`linear-gradient(135deg, ${m}15, ${m}25)`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(y,{size:28,style:{color:m}})}),s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"22px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:t.title}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:t.description})]})]})}),s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx("h2",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 20px 0",paddingBottom:"16px",borderBottom:"1px solid #f1f5f9"},children:"Deine Angaben"}),s.jsxs("form",{onSubmit:S,children:[t.variables_schema?.map(C=>s.jsx(GN,{field:C,value:o[C.key],onChange:f,error:l[C.key],primaryAccent:m},C.key)),h&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"16px",marginBottom:"20px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(ve,{size:20,style:{color:"#ef4444",flexShrink:0}}),s.jsx("div",{children:s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:h})})]}),s.jsx("button",{type:"submit",disabled:d,style:{width:"100%",padding:"16px 24px",borderRadius:"12px",border:"none",background:d?"#94a3b8":`linear-gradient(135deg, ${m}, ${m}dd)`,color:"white",fontSize:"16px",fontWeight:600,cursor:d?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s",boxShadow:d?"none":`0 4px 14px ${m}40`},children:d?s.jsxs(s.Fragment,{children:[s.jsx(ye,{size:20,style:{animation:"spin 1s linear infinite"}}),"Briefing wird generiert..."]}):s.jsxs(s.Fragment,{children:[s.jsx(st,{size:20}),"Briefing generieren"]})}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})]}),d&&s.jsx("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${m}08`,borderRadius:"12px",border:`1px solid ${m}20`},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(Ce,{size:18,style:{color:m}}),s.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"13px"},children:"Die KI analysiert deine Angaben und erstellt ein massgeschneidertes Briefing. Dies kann einige Sekunden dauern..."})]})})]}):null},HN={"file-text":Tt,briefcase:Qt,banknote:ni,users:un,user:xt,"message-circle":Ei,target:De,award:Dt,book:Fr,clipboard:Br,star:Rt,lightbulb:Ce,shield:Hi,compass:zr,rocket:Ln},KN=({content:t,primaryAccent:e})=>{if(!t)return null;const n=r=>{const o=r.split(`
`),a=[];let l=[],c=null;const d=()=>{l.length>0&&(a.push(s.jsx("ul",{style:{margin:"12px 0",paddingLeft:"24px",listStyle:"none"},children:l.map((u,h)=>s.jsxs("li",{style:{marginBottom:"8px",fontSize:"15px",lineHeight:1.6,color:"#374151",position:"relative",paddingLeft:"20px"},children:[s.jsx("span",{style:{position:"absolute",left:0,color:e,fontWeight:"bold"},children:c==="number"?`${h+1}.`:""}),i(u)]},h))},`list-${a.length}`)),l=[],c=null)};return o.forEach((u,h)=>{const p=u.trim();if(!p){d();return}if(p.startsWith("### ")){d(),a.push(s.jsx("h3",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"24px 0 12px 0",paddingTop:"16px",borderTop:h>0?"1px solid #f1f5f9":"none",display:"flex",alignItems:"center",gap:"8px"},children:i(p.substring(4))},`h3-${h}`));return}if(p.startsWith("## ")){d(),a.push(s.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"#0f172a",margin:"28px 0 14px 0"},children:i(p.substring(3))},`h2-${h}`));return}if(p.startsWith("# ")){d(),a.push(s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"32px 0 16px 0"},children:i(p.substring(2))},`h1-${h}`));return}if(p.startsWith("- ")||p.startsWith("* ")){c!=="bullet"&&(d(),c="bullet"),l.push(p.substring(2));return}const m=p.match(/^(\d+)\.\s/);if(m){c!=="number"&&(d(),c="number"),l.push(p.substring(m[0].length));return}d(),a.push(s.jsx("p",{style:{margin:"12px 0",fontSize:"15px",lineHeight:1.7,color:"#374151"},children:i(p)},`p-${h}`))}),d(),a},i=r=>{const o=[];let a=r,l=0;for(;a.length>0;){const c=a.match(/\*\*(.+?)\*\*/),d=a.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),u=a.match(/`([^`]+)`/),h=[{match:c,type:"bold"},{match:d,type:"italic"},{match:u,type:"code"}].filter(m=>m.match);if(h.length===0){o.push(a);break}const p=h.reduce((m,y)=>(m.match?.index??1/0)<(y.match?.index??1/0)?m:y);switch(p.match.index>0&&o.push(a.substring(0,p.match.index)),p.type){case"bold":o.push(s.jsx("strong",{style:{fontWeight:600,color:"#0f172a"},children:p.match[1]},l++));break;case"italic":o.push(s.jsx("em",{style:{fontStyle:"italic"},children:p.match[1]||p.match[2]},l++));break;case"code":o.push(s.jsx("code",{style:{backgroundColor:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace",color:e},children:p.match[1]},l++));break}a=a.substring(p.match.index+p.match[0].length)}return o};return s.jsx("div",{children:n(t)})},YN=({briefing:t,template:e,onBack:n,onCreateNew:i,onGenerateAnother:r})=>{const{config:o}=ge(),[a,l]=g.useState(!1),c=g.useRef(null),d=o?.buttonGradientStart||"#3A7FA7",u=HN[e?.icon||t?.template_icon]||Tt,h=y=>y?new Date(y).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",p=async()=>{try{await navigator.clipboard.writeText(t.content_markdown),l(!0),setTimeout(()=>l(!1),2e3)}catch(y){console.error("[SmartBriefing] Failed to copy:",y)}},m=()=>{const y=`${e?.title||t?.template_title}
${"=".repeat(50)}

Erstellt am: ${h(t.created_at)}

${t.content_markdown}`,f=new Blob([y],{type:"text/plain;charset=utf-8"}),b=URL.createObjectURL(f),S=document.createElement("a");S.href=b,S.download=`briefing-${t.id}.txt`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(b)};return t?s.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[s.jsxs("button",{onClick:n,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",border:"none",background:"none",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer",marginBottom:"24px"},children:[s.jsx(pt,{size:18}),"Zuruck zur Ubersicht"]}),s.jsx("div",{style:{backgroundColor:`${d}10`,borderRadius:"16px",padding:"20px 24px",marginBottom:"24px",border:`1px solid ${d}30`},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:d,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(st,{size:22,style:{color:"white"}})}),s.jsxs("div",{children:[s.jsx("h2",{style:{fontSize:"18px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Dein Briefing ist fertig!"}),s.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:e?.title||t?.template_title})]})]})}),s.jsxs("div",{ref:c,style:{backgroundColor:"white",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #f1f5f9",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`linear-gradient(135deg, ${d}15, ${d}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(u,{size:20,style:{color:d}})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:0},children:e?.title||t?.template_title}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#94a3b8",marginTop:"2px"},children:[s.jsx(qi,{size:12}),h(t.created_at)]})]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsxs("button",{onClick:p,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:a?"#dcfce7":"white",color:a?"#16a34a":"#64748b",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},children:[a?s.jsx(Es,{size:16}):s.jsx(cm,{size:16}),a?"Kopiert!":"Kopieren"]}),s.jsxs("button",{onClick:m,style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 14px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"white",color:"#64748b",fontSize:"13px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(Ak,{size:16}),"Speichern"]})]})]}),s.jsx("div",{style:{padding:"24px"},children:s.jsx(KN,{content:t.content_markdown,primaryAccent:d})})]}),s.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",flexWrap:"wrap"},children:[s.jsxs("button",{onClick:r,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${d}`,backgroundColor:"white",color:d,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:[s.jsx(hn,{size:18}),"Mit anderen Angaben neu generieren"]}),s.jsxs("button",{onClick:i,style:{flex:1,minWidth:"200px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${d}, ${d}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 14px ${d}40`},children:[s.jsx(As,{size:18}),"Neues Briefing erstellen"]})]})]}):null},JN={"file-text":Tt,briefcase:Qt,banknote:ni,users:un,user:xt,"message-circle":Ei,target:De,award:Dt,book:Fr,clipboard:Br,star:Rt,lightbulb:Ce,shield:Hi,compass:zr,rocket:Ln},XN=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",ZN=({briefing:t,onOpen:e,onDelete:n,primaryAccent:i,isDeleting:r})=>{const[o,a]=g.useState(!1),[l,c]=g.useState(!1),d=JN[t.template_icon]||Tt,u=h=>{h.stopPropagation(),l?(n(t.id),c(!1)):(c(!0),setTimeout(()=>c(!1),3e3))};return s.jsxs("div",{onClick:()=>e(t),onMouseEnter:()=>a(!0),onMouseLeave:()=>{a(!1),c(!1)},style:{backgroundColor:"white",borderRadius:"16px",padding:"20px",border:`2px solid ${o?i:"#e2e8f0"}`,boxShadow:o?`0 10px 25px -5px rgba(0,0,0,0.1), 0 0 0 1px ${i}20`:"0 1px 3px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.3s ease",transform:o?"translateY(-2px)":"translateY(0)",position:"relative"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[s.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"10px",background:`linear-gradient(135deg, ${i}15, ${i}25)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(d,{size:22,style:{color:i}})}),s.jsx("button",{onClick:u,disabled:r,style:{padding:"8px",borderRadius:"8px",border:"none",backgroundColor:l?"#fef2f2":o?"#f1f5f9":"transparent",color:l?"#ef4444":"#94a3b8",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",opacity:o||l?1:0},children:r?s.jsx(ye,{size:18,style:{animation:"spin 1s linear infinite"}}):s.jsx(pn,{size:18})})]}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",margin:"0 0 4px 0",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title||"Unbenanntes Briefing"}),s.jsx("p",{style:{fontSize:"13px",color:"#64748b",margin:"0 0 12px 0"},children:t.template_title}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"12px",borderTop:"1px solid #f1f5f9"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#94a3b8",fontSize:"12px"},children:[s.jsx(qi,{size:14}),XN(t.created_at)]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:i,fontSize:"13px",fontWeight:500},children:["Offnen",s.jsx(It,{size:16})]})]}),l&&s.jsx("div",{style:{position:"absolute",top:"8px",right:"8px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"8px 12px",fontSize:"12px",color:"#dc2626",fontWeight:500,zIndex:10},onClick:h=>h.stopPropagation(),children:"Nochmal klicken zum Loschen"}),s.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})},QN=({onOpenBriefing:t,onCreateNew:e,isAuthenticated:n})=>{const{config:i}=ge(),[r,o]=g.useState([]),[a,l]=g.useState(!0),[c,d]=g.useState(null),[u,h]=g.useState(null),p=i?.buttonGradientStart||"#3A7FA7";g.useEffect(()=>{(async()=>{if(!n){l(!1);return}try{l(!0),d(null);const f=await fe.request("/smartbriefing/briefings",{method:"GET"});if(f.success&&f.data?.briefings){const b=f.data.briefings.filter(S=>S.status==="completed");o(b)}else throw new Error("Unerwartete API-Antwort")}catch(f){console.error("[SmartBriefing] Error fetching briefings:",f),d(f.message||"Fehler beim Laden der Briefings")}finally{l(!1)}})()},[n]);const m=async y=>{try{if(h(y),(await fe.request(`/smartbriefing/briefings/${y}`,{method:"DELETE"})).success)o(b=>b.filter(S=>S.id!==y));else throw new Error("Fehler beim Loschen")}catch(f){console.error("[SmartBriefing] Error deleting briefing:",f),d(f.message||"Fehler beim Loschen des Briefings")}finally{h(null)}};return n?s.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[s.jsxs("div",{children:[s.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",margin:"0 0 4px 0"},children:"Meine Briefings"}),s.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:[r.length," gespeicherte Briefings"]})]}),s.jsxs("button",{onClick:e,style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[s.jsx(As,{size:18}),"Neues Briefing"]})]}),a&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"64px 24px"},children:[s.jsx(ye,{size:40,style:{color:p,animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{marginTop:"16px",color:"#64748b"},children:"Briefings werden geladen..."})]}),c&&!a&&s.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx(ve,{size:24,style:{color:"#ef4444",flexShrink:0}}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:"0 0 4px 0",color:"#dc2626",fontSize:"16px"},children:"Fehler beim Laden"}),s.jsx("p",{style:{margin:0,color:"#991b1b",fontSize:"14px"},children:c})]})]}),!a&&!c&&s.jsx(s.Fragment,{children:r.length===0?s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(_s,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Noch keine Briefings"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Erstelle dein erstes Briefing, um loszulegen."}),s.jsxs("button",{onClick:e,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:`linear-gradient(135deg, ${p}, ${p}dd)`,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 14px ${p}40`},children:[s.jsx(As,{size:18}),"Briefing erstellen"]})]}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:r.map(y=>s.jsx(ZN,{briefing:y,onOpen:t,onDelete:m,primaryAccent:p,isDeleting:u===y.id},y.id))})})]}):s.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"48px 24px",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[s.jsx(_s,{size:48,style:{color:"#cbd5e1",marginBottom:"16px"}}),s.jsx("h2",{style:{color:"#64748b",margin:"0 0 8px 0",fontSize:"18px"},children:"Anmeldung erforderlich"}),s.jsx("p",{style:{color:"#94a3b8",margin:"0 0 24px 0",fontSize:"14px"},children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},Nt={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},eA=({isAuthenticated:t,requireAuth:e,setPendingAction:n,onNavigateToSimulator:i,onNavigateToHistory:r})=>{const[o,a]=g.useState(Nt.DASHBOARD),[l,c]=g.useState(null),[d,u]=g.useState(null),[h,p]=g.useState(null),[m,y]=g.useState(null);g.useEffect(()=>{m&&t&&(console.log("[SmartBriefing] Processing pending template after login:",m.title),c(m),a(Nt.FORM),y(null))},[m,t]),g.useEffect(()=>{window.scrollTo(0,0)},[o]);const f=g.useCallback(k=>{console.log("[SmartBriefing] Template selected:",k.title),c(k),a(Nt.FORM)},[]),b=g.useCallback(()=>{c(null),u(null),p(null),a(Nt.DASHBOARD)},[]),S=g.useCallback(k=>{console.log("[SmartBriefing] Briefing generated:",k.id),u(k),p(k),a(Nt.WORKBOOK)},[]),C=g.useCallback(()=>{u(null),p(null),c(null),a(Nt.DASHBOARD)},[]),j=g.useCallback(()=>{u(null),p(null),a(Nt.FORM)},[]);g.useCallback(()=>{a(Nt.LIST)},[]);const w=g.useCallback(k=>{console.log("[SmartBriefing] Opening briefing:",k.id),p(k),a(Nt.WORKBOOK)},[]);g.useCallback(()=>{p(null),a(Nt.LIST)},[]);const v=g.useCallback(k=>{console.log("[SmartBriefing] Starting simulation with variables:",k),i&&i(k)},[i]),E=()=>{switch(o){case Nt.FORM:return s.jsx(qN,{template:l,onBack:b,onBriefingGenerated:S,isAuthenticated:t});case Nt.RESULT:return s.jsx(YN,{briefing:d,template:l,onBack:b,onCreateNew:C,onGenerateAnother:j});case Nt.LIST:return s.jsx(QN,{onOpenBriefing:w,onCreateNew:C,isAuthenticated:t});case Nt.WORKBOOK:return s.jsx(Iy,{briefing:h,onBack:b,onStartSimulation:i?v:null});case Nt.DASHBOARD:default:return s.jsx(VN,{onSelectTemplate:f,onShowList:r,isAuthenticated:t,requireAuth:e,setPendingAction:n})}};return s.jsx("div",{style:{minHeight:"100%"},children:E()})},tA=({onNavigateToRoleplay:t,compact:e=!1})=>{const{branding:n,demoCode:i}=ge(),[r,o]=g.useState(!0),[a,l]=g.useState(null),[c,d]=g.useState(null),u=g.useMemo(()=>{const C=n?.["--header-gradient"]||Q["--header-gradient"],j=n?.["--header-text"]||Q["--header-text"],w=n?.["--primary-accent"]||Q["--primary-accent"],v=n?.["--primary-accent-light"]||Q["--primary-accent-light"];return{headerGradient:C,headerText:j,primaryAccent:w,primaryAccentLight:v}},[n]),h=async()=>{try{o(!0),l(null);const C=await fe.getUsageLimits(i);d(C)}catch(C){console.error("[UsageLimits] Error fetching usage data:",C),l(C.message||"Fehler beim Laden der Nutzungsdaten")}finally{o(!1)}};g.useEffect(()=>{h()},[i]);const p=g.useMemo(()=>!c||c.monthly_limit===0?0:Math.min(100,c.used_minutes/c.monthly_limit*100),[c]),m=(C,j)=>{const w=C/j*100;return w<=0?"#ef4444":w<=20?"#f59e0b":w<=50?"#eab308":"#22c55e"},y=C=>C?new Date(C).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",f=C=>C==null?"0 Min.":`${Math.round(C*10)/10} Min.`;if(r)return s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(ye,{className:"w-8 h-8 animate-spin text-slate-400"})});if(a)return s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[s.jsx(ve,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-red-700 text-sm font-medium",children:a})}),s.jsxs(se,{variant:"outline",size:"sm",onClick:h,children:[s.jsx(hn,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(e){const C=m(c?.remaining_minutes||0,c?.monthly_limit||10),j=c?.has_minutes!==!1;return s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:t,title:j?"Live-Gesprch starten":"Keine Minuten mehr verfgbar",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:u.headerGradient},children:s.jsx(Ba,{className:"w-5 h-5",style:{color:u.headerText}})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gesprche"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold text-lg",style:{color:C},children:f(c?.remaining_minutes||0)}),s.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",c?.monthly_limit||10," Min."]})]})]}),!j&&s.jsx(ve,{className:"w-5 h-5 text-red-500"})]}),s.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${p}%`,background:C}})})]})}const b=m(c?.remaining_minutes||0,c?.monthly_limit||10),S=c?.has_minutes!==!1;return s.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4",style:{background:u.headerGradient},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:s.jsx(Ba,{className:"w-6 h-6",style:{color:u.headerText}})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",style:{color:u.headerText},children:"Live-Gesprche"}),s.jsx("p",{className:"text-sm opacity-80",style:{color:u.headerText},children:"Monatliches Kontingent"})]})]}),s.jsx(se,{variant:"ghost",size:"icon",onClick:h,className:"text-white hover:bg-white/10",children:s.jsx(hn,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"text-center mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),s.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:b,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-p)*2.827} 282.7`,className:"transition-all duration-500"})]}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[s.jsx("span",{className:"text-3xl font-bold",style:{color:b},children:f(c?.remaining_minutes||0)}),s.jsx("span",{className:"text-sm text-slate-500",children:"verfgbar"})]})]})}),s.jsx(Ve,{mode:"wait",children:S?p>80?s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ve,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),s.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",f(c?.remaining_minutes)," weise."]})]})]})},"low-minutes"):s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Qn,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfgbar"}),s.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gesprch zum ben."})]})]})},"ok"):s.jsx(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ve,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),s.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",y(c?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(Vt,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),s.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[c?.monthly_limit||10," Min."]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(He,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),s.jsx("span",{className:"text-lg font-bold text-slate-700",children:f(c?.used_minutes||0)})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[s.jsx(qi,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),s.jsx("span",{className:"text-sm font-bold text-slate-700",children:y(c?.next_reset)})]})]}),s.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",y(c?.period_start)," - ",y(c?.period_end)]}),t&&s.jsxs(se,{onClick:t,disabled:!S,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:S?u.headerGradient:"#94a3b8",color:u.headerText},children:[s.jsx(Ba,{className:"w-5 h-5 mr-2"}),S?"Live-Gesprch starten":"Keine Minuten verfgbar"]}),c?.is_demo_user&&c?.demo_code&&s.jsx("div",{className:"mt-4 text-center",children:s.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",s.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:c.demo_code})]})})]})]})},zy=g.createContext(null),jf={success:{bgColor:"#10b981",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},error:{bgColor:"#ef4444",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},info:{bgColor:"#3b82f6",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},warning:{bgColor:"#f59e0b",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}};function nA({id:t,message:e,type:n="success",duration:i=3e3,onDismiss:r}){const o=jf[n]||jf.info;return g.useEffect(()=>{if(i>0){const a=setTimeout(()=>{r(t)},i);return()=>clearTimeout(a)}},[t,i,r]),s.jsxs(L.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px",padding:"14px 20px",backgroundColor:o.bgColor,color:"#ffffff",borderRadius:"12px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",fontSize:"15px",fontWeight:500,minWidth:"280px",maxWidth:"400px"},children:[s.jsx("span",{style:{flexShrink:0},children:o.icon}),s.jsx("span",{style:{flex:1},children:e}),s.jsx("button",{onClick:()=>r(t),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"6px",padding:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",flexShrink:0},onMouseEnter:a=>a.target.style.background="rgba(255, 255, 255, 0.3)",onMouseLeave:a=>a.target.style.background="rgba(255, 255, 255, 0.2)",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function iA({toasts:t,onDismiss:e}){return s.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:s.jsx(Ve,{children:t.map(n=>s.jsx(nA,{...n,onDismiss:e},n.id))})})}function sA({children:t}){const[e,n]=g.useState([]),i=g.useCallback((u,h="success",p=3e3)=>{const m=Date.now()+Math.random();return n(y=>[...y,{id:m,message:u,type:h,duration:p}]),m},[]),r=g.useCallback(u=>{n(h=>h.filter(p=>p.id!==u))},[]),o=g.useCallback((u,h)=>i(u,"success",h),[i]),a=g.useCallback((u,h)=>i(u,"error",h),[i]),l=g.useCallback((u,h)=>i(u,"info",h),[i]),c=g.useCallback((u,h)=>i(u,"warning",h),[i]),d={addToast:i,dismissToast:r,showSuccess:o,showError:a,showInfo:l,showWarning:c};return s.jsxs(zy.Provider,{value:d,children:[t,s.jsx(iA,{toasts:e,onDismiss:r})]})}function Uy(){const t=g.useContext(zy);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}const Te={blue:{50:"#E8F4F8",600:"#3A7FA7",700:"#2D6485"},teal:{500:"#3DA389"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",400:"#94a3b8",700:"#334155",900:"#0f172a"}},Wy=t=>t?{sidebarBg:t["--sidebar-bg-color"]||Te.slate[50],sidebarText:t["--sidebar-text-color"]||Te.slate[900],sidebarTextMuted:t["--sidebar-text-muted"]||Te.slate[400],sidebarActiveBg:t["--sidebar-active-bg"]||Te.blue[50],sidebarActiveText:t["--sidebar-active-text"]||Te.blue[700],sidebarHoverBg:t["--sidebar-hover-bg"]||Te.slate[50],primaryAccent:t["--primary-accent"]||Te.blue[600],borderColor:t["--border-color"]||Te.slate[200],borderColorLight:t["--border-color-light"]||Te.slate[100]}:null,Vy=[{id:"overview",moduleId:"overview",label:"bersicht",shortLabel:"bersicht",icon:Ok,description:"Alle Trainingsmglichkeiten",alwaysVisible:!0},{id:"smart_briefing",moduleId:"smart_briefing",label:"Smart Briefing",shortLabel:"Briefing",icon:st,description:"KI-Vorbereitungs-Assistent"},{id:"simulator",moduleId:"simulator",label:"Szenario-Training",shortLabel:"Szenario",icon:De,description:"Frage-Antwort Training mit KI-Feedback"},{id:"video_training",moduleId:"video_training",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:ht,description:"Video-Aufnahme mit Wirkungs-Analyse"},{id:"dashboard",moduleId:"roleplay",label:"Live-Simulationen",shortLabel:"Live",icon:ze,description:"Live Simulationen mit KI-Interviewer"},{id:"gym",moduleId:"gym",label:"Rhetorik-Gym",shortLabel:"Gym",icon:ld,description:"Spielerisch Rhetorik trainieren",subItems:[{id:"gym_klassiker",label:"Der Fllwort-Killer",shortLabel:"Klassiker",icon:Ln,description:"60s Elevator Pitch"}]},{id:"history",moduleId:"history",label:"Meine Sessions",shortLabel:"Sessions",icon:$l,description:"Vergangene bungen ansehen"},{id:"usage_limits",moduleId:"roleplay",label:"Mein Kontingent",shortLabel:"Kontingent",icon:He,description:"Verfgbare Gesprchsminuten"}],$y=[{id:"admin",label:"Administration",shortLabel:"Admin",icon:Hi,description:"Inhalte verwalten",adminOnly:!0,subItems:[{id:"admin_roleplays",label:"Live-Simulationen",shortLabel:"Live",icon:ze,description:"Simulations-Szenarien verwalten"},{id:"admin_simulator",label:"Szenario-Training",shortLabel:"Simulator",icon:De,description:"Simulator-Szenarien verwalten"},{id:"admin_video",label:"Wirkungs-Analyse",shortLabel:"Wirkung",icon:ht,description:"Wirkungs-Analysen verwalten"},{id:"admin_partners",label:"Partner-Branding",shortLabel:"Partner",icon:un,description:"White-Label Partner verwalten"}]}],rA=({isCollapsed:t,onToggleCollapse:e,activeView:n,onNavigate:i,headerOffset:r=0,onLoginClick:o})=>{const[a,l]=g.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=ge(),{user:m,isAuthenticated:y,isAdmin:f,logout:b}=Ec(),{showSuccess:S}=Uy(),C=Wy(c),j=g.useMemo(()=>{const T=Vy.filter(N=>{if(N.alwaysVisible)return!0;const R=N.moduleId||N.id;return p(R)});return f?[...T,...$y]:T},[p,f]),w=async()=>{await b(),S("Sie wurden erfolgreich abgemeldet",3e3)},v=g.useMemo(()=>C?{sidebarBg:C.sidebarBg,sidebarText:C.sidebarText,sidebarTextMuted:C.sidebarTextMuted,activeBg:C.sidebarActiveBg,activeText:C.sidebarActiveText,hoverBg:C.sidebarHoverBg,primaryAccent:C.primaryAccent,borderColor:C.borderColor,borderColorLight:C.borderColorLight}:{sidebarBg:"#ffffff",sidebarText:Te.slate[900],sidebarTextMuted:Te.slate[400],activeBg:Te.blue[50],activeText:Te.blue[700],hoverBg:Te.slate[50],primaryAccent:Te.blue[600],borderColor:Te.slate[200],borderColorLight:Te.slate[100]},[C]),E=T=>{l(N=>N.includes(T)?N.filter(R=>R!==T):[...N,T])},k=T=>{T.subItems&&!t?E(T.id):i(T.id)};return s.jsxs(L.aside,{initial:!1,animate:{width:t?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{position:"fixed",left:0,top:r,bottom:0,zIndex:40,backgroundColor:v.sidebarBg,borderRight:`1px solid ${v.borderColor}`,display:"flex",flexDirection:"column",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},children:[s.jsx("div",{style:{height:"64px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",borderBottom:`1px solid ${v.borderColorLight}`},children:s.jsx(Ve,{mode:"wait",children:t?s.jsx(L.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},style:{width:"40px",height:"40px",borderRadius:"12px",background:d?v.primaryAccent:`linear-gradient(135deg, ${Te.blue[600]} 0%, ${Te.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",margin:"0 auto",overflow:"hidden"},children:h?s.jsx("img",{src:h,alt:u,style:{width:"100%",height:"100%",objectFit:"contain"}}):s.jsx(Vl,{style:{width:"20px",height:"20px",color:"white"}})},"logo-collapsed"):s.jsxs(L.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.2},style:{display:"flex",alignItems:"center",gap:"12px"},children:[h?s.jsx("img",{src:h,alt:u,style:{width:"40px",height:"40px",borderRadius:"12px",objectFit:"contain"}}):s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:d?v.primaryAccent:`linear-gradient(135deg, ${Te.blue[600]} 0%, ${Te.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:s.jsx(Vl,{style:{width:"20px",height:"20px",color:"white"}})}),s.jsx("div",{style:{display:"flex",flexDirection:"column"},children:d?s.jsx("span",{style:{fontWeight:700,color:v.sidebarText,fontSize:"14px",lineHeight:"1.4"},children:u}):s.jsxs(s.Fragment,{children:[s.jsx("span",{style:{fontWeight:700,color:v.sidebarText,fontSize:"14px",lineHeight:"1.2"},children:"Karriere"}),s.jsx("span",{style:{fontWeight:700,color:v.primaryAccent,fontSize:"14px",lineHeight:"1.2"},children:"Navigation"})]})})]},"logo-full")})}),s.jsx("nav",{style:{flex:1,padding:"8px 12px",overflowY:"auto"},children:j.map((T,N)=>{const R=T.icon,_=n===T.id||T.id==="dashboard"&&n==="roleplay"||T.id==="gym"&&n.startsWith("gym")||T.id==="admin"&&n.startsWith("admin"),A=T.subItems&&T.subItems.length>0,Y=a.includes(T.id),H=T.adminOnly;return s.jsxs("div",{children:[H&&s.jsx("div",{style:{margin:"12px 0",padding:t?"0":"0 4px",borderTop:`1px solid ${v.borderColor}`},children:!t&&s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:v.sidebarTextMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"12px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>k(T),style:{width:"100%",borderRadius:"12px",display:"flex",alignItems:"center",gap:"12px",position:"relative",padding:t?"12px":"12px 16px",justifyContent:t?"center":"flex-start",backgroundColor:_?v.activeBg:"transparent",color:_?v.activeText:v.sidebarText,fontWeight:_?600:400,fontSize:"14px",border:"none",cursor:"pointer",marginBottom:"4px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:$=>{_||($.currentTarget.style.backgroundColor=v.hoverBg,$.currentTarget.style.color=v.sidebarText)},onMouseLeave:$=>{_||($.currentTarget.style.backgroundColor="transparent",$.currentTarget.style.color=v.sidebarText)},children:[_&&s.jsx("div",{style:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:"4px",height:"32px",backgroundColor:v.primaryAccent,borderTopRightRadius:"9999px",borderBottomRightRadius:"9999px"}}),s.jsx(R,{style:{width:"20px",height:"20px",flexShrink:0,color:_?v.primaryAccent:v.sidebarTextMuted}}),!t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",flex:1,minWidth:0},children:[s.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:T.label}),s.jsx("span",{style:{fontSize:"12px",color:v.sidebarTextMuted,whiteSpace:"normal",lineHeight:1.3},children:T.description})]}),A&&s.jsx(jt,{style:{width:"16px",height:"16px",color:v.sidebarTextMuted,transition:"transform 0.2s",transform:Y?"rotate(180deg)":"rotate(0deg)"}})]})]}),A&&!t&&s.jsx(Ve,{children:Y&&s.jsx(L.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},style:{overflow:"hidden",marginLeft:"16px"},children:T.subItems.map($=>{const K=$.icon,O=n===$.id;return s.jsxs("button",{onClick:()=>i($.id),style:{width:"100%",borderRadius:"10px",display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",backgroundColor:O?v.activeBg:"transparent",color:O?v.activeText:v.sidebarText,fontWeight:O?600:400,fontSize:"13px",border:"none",cursor:"pointer",marginBottom:"2px",transition:"all 0.2s",textAlign:"left"},onMouseEnter:P=>{O||(P.currentTarget.style.backgroundColor=v.hoverBg,P.currentTarget.style.color=v.sidebarText)},onMouseLeave:P=>{O||(P.currentTarget.style.backgroundColor="transparent",P.currentTarget.style.color=v.sidebarText)},children:[s.jsx(K,{style:{width:"16px",height:"16px",flexShrink:0,color:O?v.primaryAccent:v.sidebarTextMuted}}),s.jsx("span",{style:{whiteSpace:"nowrap"},children:$.label})]},$.id)})})})]},T.id)})}),s.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${v.borderColorLight}`},children:y&&m?s.jsxs("div",{style:{marginBottom:"8px"},children:[!t&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${v.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:v.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"14px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"14px",color:v.sidebarText,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"12px",color:v.sidebarText,opacity:.7,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:m.email})]})]}),s.jsxs("button",{onClick:w,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:v.sidebarText,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=v.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Abmelden",children:[s.jsx(hm,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:o,style:{width:"100%",borderRadius:"12px",padding:"10px 12px",display:"flex",alignItems:"center",gap:"10px",justifyContent:t?"center":"flex-start",color:v.sidebarText,backgroundColor:"transparent",border:`1px solid ${v.borderColor}`,cursor:"pointer",fontSize:"13px",fontWeight:500,transition:"all 0.2s",marginBottom:"8px"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=v.hoverBg},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent"},title:"Anmelden",children:[s.jsx(Oo,{style:{width:"18px",height:"18px",flexShrink:0}}),!t&&s.jsx("span",{children:"Anmelden"})]})}),s.jsx("div",{style:{padding:"0 12px 12px 12px"},children:s.jsx("button",{onClick:e,style:{width:"100%",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",gap:"12px",justifyContent:t?"center":"flex-start",color:v.sidebarTextMuted,backgroundColor:"transparent",border:"none",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=v.hoverBg,T.currentTarget.style.color=v.sidebarText},onMouseLeave:T=>{T.currentTarget.style.backgroundColor="transparent",T.currentTarget.style.color=v.sidebarTextMuted},children:t?s.jsx(It,{style:{width:"20px",height:"20px"}}):s.jsxs(s.Fragment,{children:[s.jsx(Io,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Einklappen"})]})})})]})},oA=({activeView:t,onNavigate:e,headerOffset:n=0,onLoginClick:i})=>{const[r,o]=g.useState(!1),[a,l]=g.useState([]),{branding:c,isWhiteLabel:d,partnerName:u,logoUrl:h,checkModuleAllowed:p}=ge(),{user:m,isAuthenticated:y,isAdmin:f,logout:b}=Ec(),{showSuccess:S}=Uy(),C=Wy(c),j=g.useMemo(()=>{const T=Vy.filter(N=>{const R=N.moduleId||N.id;return p(R)});return f?[...T,...$y]:T},[p,f]),w=async()=>{await b(),S("Sie wurden erfolgreich abgemeldet",3e3)},v=g.useMemo(()=>C?{headerBg:C.sidebarBg,headerText:C.sidebarText,headerTextMuted:C.sidebarTextMuted,menuBg:"#ffffff",activeBg:C.sidebarActiveBg,activeText:C.sidebarActiveText,hoverBg:C.sidebarHoverBg,primaryAccent:C.primaryAccent,borderColor:C.borderColor,textMain:Te.slate[700],textMuted:Te.slate[400]}:{headerBg:"#ffffff",headerText:Te.slate[900],headerTextMuted:Te.slate[400],menuBg:"#ffffff",activeBg:Te.blue[50],activeText:Te.blue[700],hoverBg:Te.slate[50],primaryAccent:Te.blue[600],borderColor:Te.slate[200],textMain:Te.slate[700],textMuted:Te.slate[400]},[C]),E=T=>{e(T),o(!1)},k=T=>{l(N=>N.includes(T)?N.filter(R=>R!==T):[...N,T])};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{position:"fixed",top:n,left:0,right:0,height:"56px",backgroundColor:v.headerBg,borderBottom:`1px solid ${v.borderColor}`,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",zIndex:50,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)",transition:"top 0.15s ease-out"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[h?s.jsx("img",{src:h,alt:u,style:{width:"36px",height:"36px",borderRadius:"10px",objectFit:"contain"}}):s.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:d?v.primaryAccent:`linear-gradient(135deg, ${Te.blue[600]} 0%, ${Te.teal[500]} 100%)`,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Vl,{style:{width:"18px",height:"18px",color:"white"}})}),s.jsx("span",{style:{fontWeight:700,color:v.headerText,fontSize:"15px"},children:d?u:"Karriere Navigation"})]}),s.jsx("button",{onClick:()=>o(!r),style:{width:"56px",height:"56px",borderRadius:"12px",border:"none",backgroundColor:r?v.hoverBg:"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:r?s.jsx(kn,{style:{width:"40px",height:"40px",color:v.headerText}}):s.jsx(Lk,{style:{width:"40px",height:"40px",color:v.headerText}})})]}),s.jsx(Ve,{children:r&&s.jsxs(s.Fragment,{children:[s.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(!1),style:{position:"fixed",top:n+56,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)",zIndex:40}}),s.jsxs(L.nav,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},style:{position:"fixed",top:n+56,left:0,right:0,backgroundColor:v.menuBg,zIndex:45,padding:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderBottomLeftRadius:"16px",borderBottomRightRadius:"16px",maxHeight:"70vh",overflowY:"auto"},children:[j.map(T=>{const N=T.icon,R=t===T.id||T.id==="dashboard"&&t==="roleplay"||T.id==="gym"&&t.startsWith("gym")||T.id==="admin"&&t.startsWith("admin"),_=T.subItems&&T.subItems.length>0,A=a.includes(T.id),Y=T.adminOnly;return s.jsxs("div",{children:[Y&&s.jsx("div",{style:{margin:"12px 8px",borderTop:`1px solid ${v.borderColor}`},children:s.jsx("span",{style:{display:"block",fontSize:"11px",fontWeight:600,color:v.textMuted,textTransform:"uppercase",letterSpacing:"0.5px",marginTop:"12px",marginBottom:"8px",paddingLeft:"8px"},children:"Admin"})}),s.jsxs("button",{onClick:()=>_?k(T.id):E(T.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:"none",backgroundColor:R?v.activeBg:"transparent",color:R?v.activeText:v.textMain,fontSize:"15px",fontWeight:R?600:500,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx(N,{style:{width:"22px",height:"22px",color:R?v.primaryAccent:v.textMuted}}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{children:T.label}),s.jsx("div",{style:{fontSize:"12px",color:v.textMuted,fontWeight:400},children:T.description})]}),_&&s.jsx(jt,{style:{width:"18px",height:"18px",color:v.textMuted,transition:"transform 0.2s",transform:A?"rotate(180deg)":"rotate(0deg)"}})]}),_&&A&&s.jsx("div",{style:{marginLeft:"20px",marginBottom:"8px"},children:T.subItems.map(H=>{const $=H.icon,K=t===H.id;return s.jsxs("button",{onClick:()=>E(H.id),style:{width:"100%",display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",borderRadius:"10px",border:"none",backgroundColor:K?v.activeBg:"transparent",color:K?v.activeText:v.textMain,fontSize:"14px",fontWeight:K?600:400,cursor:"pointer",textAlign:"left",marginBottom:"4px"},children:[s.jsx($,{style:{width:"18px",height:"18px",color:K?v.primaryAccent:v.textMuted}}),s.jsx("span",{children:H.label})]},H.id)})})]},T.id)}),s.jsx("div",{style:{marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${v.borderColor}`},children:y&&m?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:"transparent",border:`1px solid ${v.borderColor}`,marginBottom:"8px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",backgroundColor:v.primaryAccent,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:"16px",flexShrink:0},children:(m.firstName||m.displayName||"U").charAt(0).toUpperCase()}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontWeight:600,fontSize:"15px",color:v.textMain},children:m.displayName||m.firstName||"Benutzer"}),m.email&&s.jsx("div",{style:{fontSize:"13px",color:v.textMain,opacity:.7},children:m.email})]})]}),s.jsxs("button",{onClick:()=>{w(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",border:"none",backgroundColor:"transparent",color:v.textMain,fontSize:"15px",fontWeight:500,cursor:"pointer",textAlign:"left"},children:[s.jsx(hm,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Abmelden"})]})]}):s.jsxs("button",{onClick:()=>{i&&i(),o(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"14px 16px",borderRadius:"12px",border:`1px solid ${v.borderColor}`,backgroundColor:"transparent",color:v.textMain,fontSize:"15px",fontWeight:600,cursor:"pointer",textAlign:"left"},children:[s.jsx(Oo,{style:{width:"20px",height:"20px"}}),s.jsx("span",{children:"Anmelden"})]})})]})]})})]})},aA=({children:t,activeView:e,onNavigate:n,headerOffset:i=0,onLoginClick:r})=>{const[o,a]=g.useState(!1),[l,c]=g.useState(!1),{branding:d}=ge(),u=g.useMemo(()=>{if(d){const p=d["--app-bg-start"]||"#f8fafc",m=d["--app-bg-mid"]||"#eff6ff",y=d["--app-bg-end"]||"#f0fdfa";return`linear-gradient(135deg, ${p} 0%, ${m} 50%, ${y} 100%)`}return"linear-gradient(135deg, #f8fafc 0%, #eff6ff 50%, #f0fdfa 100%)"},[d]);g.useEffect(()=>{const p=()=>{c(window.innerWidth<768)};p(),window.addEventListener("resize",p);const m=localStorage.getItem("sidebar-collapsed");return m!==null&&a(JSON.parse(m)),()=>window.removeEventListener("resize",p)},[]);const h=()=>{const p=!o;a(p),localStorage.setItem("sidebar-collapsed",JSON.stringify(p))};return l?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(oA,{activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx("main",{"data-main-content":!0,style:{paddingTop:"56px",minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:u,zIndex:-1}}),s.jsxs("div",{style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:[s.jsx(rA,{isCollapsed:o,onToggleCollapse:h,activeView:e,onNavigate:n,headerOffset:i,onLoginClick:r}),s.jsx(L.main,{"data-main-content":!0,initial:!1,animate:{marginLeft:o?72:280},transition:{duration:.3,ease:[.4,0,.2,1]},style:{minHeight:i>0?`calc(100vh - ${i}px)`:"100vh"},children:t})]})]})};function lA({isOpen:t,onClose:e,onSuccess:n}){const{branding:i,partnerName:r,logoUrl:o}=ge(),[a,l]=g.useState(1),[c,d]=g.useState(""),[u,h]=g.useState(""),[p,m]=g.useState(""),[y,f]=g.useState(""),[b,S]=g.useState(""),[C,j]=g.useState(""),[w,v]=g.useState(!1),[E,k]=g.useState(""),[T,N]=g.useState(!1),[R,_]=g.useState(!1),A=i?.["--primary-accent"]||"#3A7FA7",Y=i?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",H=i?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",$=i?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",K=i?.["--header-text"]||"#ffffff",O=i?.["--sidebar-text-color"]||"#ffffff",P=async U=>{if(U.preventDefault(),k(""),!c.trim()){k("Bitte geben Sie Ihren Demo-Code ein.");return}if(c.trim().length!==5){k("Der Demo-Code muss 5 Zeichen lang sein.");return}N(!0);try{const be=Pn(),Oe=mt(),ce=await(await fetch(`${be}/demo/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Oe},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim()})})).json();if(!ce.valid){k("Der Demo-Code ist ungltig. Bitte berprfen Sie Ihre Eingabe.");return}ce.is_activated?(console.log("[DEMO] Code already activated, skipping contact form:",c.toUpperCase()),_(!0),n&&n(c.toUpperCase().trim())):(console.log("[DEMO] Code valid but new, showing contact form"),l(2))}catch(be){console.error("[DEMO] Validation error:",be),k("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{N(!1)}},F=async U=>{if(U.preventDefault(),k(""),!u.trim()){k("Bitte geben Sie den Firmennamen ein.");return}if(!p.trim()){k("Bitte geben Sie den Namen des Ansprechpartners ein.");return}if(!b.trim()){k("Bitte geben Sie eine Kontakt-E-Mail ein.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)){k("Bitte geben Sie eine gltige E-Mail-Adresse ein.");return}if(!w){k("Bitte stimmen Sie den Datenschutzbestimmungen zu.");return}N(!0);try{const Oe=Pn(),bt=mt(),_e=await(await fetch(`${Oe}/demo/activate`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":bt},credentials:"same-origin",body:JSON.stringify({demo_code:c.toUpperCase().trim(),company_name:u.trim(),contact_name:p.trim(),homepage:y.trim(),contact_email:b.trim(),phone:C.trim(),privacy_accepted:w})})).json();_e.success?(console.log("[DEMO] Code activated successfully:",c.toUpperCase()),_(!0),n&&n(c.toUpperCase().trim())):k(_e.error?.message||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}catch(Oe){console.error("[DEMO] Activation error:",Oe),k("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{N(!1)}},D=()=>{R||(l(1),d(""),h(""),m(""),f(""),S(""),j(""),v(!1),k(""),e&&e())},B=()=>{l(1),k("")},G=U=>{U.target===U.currentTarget&&D()};if(ta.useEffect(()=>{const U=be=>{be.key==="Escape"&&t&&D()};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[t,R]),!t)return null;const ie={width:"100%",padding:"10px 14px",fontSize:"14px",border:"1px solid #e2e8f0",borderRadius:"10px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},le={borderColor:A,boxShadow:`0 0 0 3px ${$}`,backgroundColor:"#ffffff"},re={display:"block",fontSize:"13px",fontWeight:"500",color:"#374151",marginBottom:"6px"};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:G,role:"dialog","aria-modal":"true","aria-labelledby":"demo-modal-title",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:H,color:K},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[a===2&&s.jsx("button",{onClick:B,className:"p-1.5 rounded-lg transition-colors",style:{color:K,backgroundColor:"transparent"},onMouseEnter:U=>U.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:U=>U.target.style.backgroundColor="transparent","aria-label":"Zurck",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h2",{id:"demo-modal-title",className:"text-xl font-semibold",style:{color:K},children:a===1?"Demo-Code eingeben":"Kontaktdaten"})]}),s.jsx("button",{onClick:D,className:"p-2 rounded-xl transition-colors",style:{color:K,backgroundColor:"transparent"},onMouseEnter:U=>U.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:U=>U.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o&&a===1&&s.jsx("div",{className:"mt-3 mb-1 flex justify-center",children:s.jsx("img",{src:o,alt:`${r} Logo`,style:{height:"4rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3",children:[s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:K,opacity:a>=1?1:.3}}),s.jsx("div",{className:"w-8 h-1 rounded-full transition-colors",style:{backgroundColor:K,opacity:a>=2?1:.3}})]})]}),a===1&&s.jsxs("form",{onSubmit:P,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-xl text-blue-700 text-sm",children:s.jsx("p",{children:"Willkommen zur Demo! Bitte geben Sie den Demo-Code ein, den Sie von uns erhalten haben."})}),E&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:E})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"demo-code",style:re,children:["Demo-Code ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"demo-code",value:c,onChange:U=>d(U.target.value.toUpperCase()),style:{...ie,fontFamily:"monospace",fontSize:"24px",fontWeight:"600",letterSpacing:"4px",textAlign:"center",padding:"16px 14px"},onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"XXXXX",maxLength:5,disabled:T,autoComplete:"off",autoFocus:!0})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:O,background:T?"#94a3b8":Y,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:U=>{T||(U.target.style.transform="translateY(-1px)",U.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:U=>{U.target.style.transform="translateY(0)",U.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:O,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:O},children:"Wird berprft..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:O,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),s.jsx("span",{style:{color:O},children:"Weiter"})]})}),s.jsxs("p",{className:"text-xs text-center text-gray-500 pt-2",children:["Haben Sie keinen Demo-Code? Kontaktieren Sie uns unter"," ",s.jsx("a",{href:"mailto:info@karriereheld.de",className:"underline",style:{color:A},children:"info@karriereheld.de"})]})]}),a===2&&s.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[s.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Code gltig!"})," Bitte geben Sie noch Ihre Kontaktdaten ein, um die Demo zu starten."]})}),E&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:E})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"company-name",style:re,children:["Firma ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"company-name",value:u,onChange:U=>h(U.target.value),style:ie,onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"Ihre Firma",disabled:T,autoComplete:"organization",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-name",style:re,children:["Ansprechpartner ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"contact-name",value:p,onChange:U=>m(U.target.value),style:ie,onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"Ihr Name",disabled:T,autoComplete:"name"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"contact-email",style:re,children:["E-Mail ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"email",id:"contact-email",value:b,onChange:U=>S(U.target.value),style:ie,onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"email@firma.de",disabled:T,autoComplete:"email"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"homepage",style:re,children:["Homepage ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"url",id:"homepage",value:y,onChange:U=>f(U.target.value),style:ie,onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"https://www.ihre-firma.de",disabled:T,autoComplete:"url"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"phone",style:re,children:["Telefon ",s.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),s.jsx("input",{type:"tel",id:"phone",value:C,onChange:U=>j(U.target.value),style:ie,onFocus:U=>Object.assign(U.target.style,le),onBlur:U=>{U.target.style.borderColor="#e2e8f0",U.target.style.boxShadow="none"},placeholder:"+49 123 456789",disabled:T,autoComplete:"tel"})]}),s.jsxs("div",{className:"flex items-start gap-3 pt-2",children:[s.jsx("input",{type:"checkbox",id:"privacy-accepted",checked:w,onChange:U=>v(U.target.checked),className:"mt-1 w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:T,style:{accentColor:A}}),s.jsxs("label",{htmlFor:"privacy-accepted",className:"text-sm text-gray-600",children:["Ich stimme den"," ",s.jsx("a",{href:"/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-gray-900",style:{color:A},children:"Datenschutzbestimmungen"})," ","zu. ",s.jsx("span",{className:"text-red-500",children:"*"})]})]}),s.jsx("button",{type:"submit",disabled:T,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:O,background:T?"#94a3b8":Y,border:"none",borderRadius:"12px",cursor:T?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:T?.7:1,boxShadow:T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)",marginTop:"16px"},onMouseEnter:U=>{T||(U.target.style.transform="translateY(-1px)",U.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:U=>{U.target.style.transform="translateY(0)",U.target.style.boxShadow=T?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:T?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:O,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:O},children:"Wird aktiviert..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:O,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),s.jsx("span",{style:{color:O},children:"Demo starten"})]})})]})]})})}const cA="demo";function dA({isOpen:t,onClose:e,onLoginSuccess:n}){const{login:i,logout:r,branding:o,partnerName:a,logoUrl:l,setDemoCode:c}=ge(),[d,u]=g.useState(""),[h,p]=g.useState(""),[m,y]=g.useState(""),[f,b]=g.useState(!1),[S,C]=g.useState(!1),[j,w]=g.useState(null),v=o?.["--primary-accent"]||"#3A7FA7",E=o?.["--button-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",k=o?.["--header-gradient"]||"linear-gradient(135deg, #3A7FA7 0%, #3DA389 100%)",T=o?.["--focus-ring"]||"rgba(58, 127, 167, 0.3)",N=o?.["--header-text"]||"#ffffff",R=o?.["--sidebar-text-color"]||"#ffffff",_=async P=>{if(P.preventDefault(),y(""),!d.trim()||!h.trim()){y("Bitte geben Sie Benutzername und Passwort ein.");return}b(!0);try{const F=await i(d,h);F.success?d.toLowerCase()===cA?(localStorage.setItem("bewerbungstrainer_demo_pending","true"),console.log("[LOGIN] Demo process pending, will logout on refresh if not completed"),w(F.user),C(!0),p("")):(u(""),p(""),n&&n(F.user),e&&e()):y(F.error||"Login fehlgeschlagen. Bitte versuchen Sie es erneut.")}catch(F){console.error("Login error:",F),y("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.")}finally{b(!1)}},A=P=>{console.log("[LOGIN] Demo code activated:",P),localStorage.removeItem("bewerbungstrainer_demo_pending"),console.log("[LOGIN] Demo process completed, pending flag cleared"),c&&c(P),u(""),p(""),C(!1),n&&j&&n(j),e&&e()},Y=async()=>{console.log("[LOGIN] Demo registration cancelled, logging out..."),localStorage.removeItem("bewerbungstrainer_demo_pending");try{r&&await r()}catch(P){console.error("[LOGIN] Error logging out demo user:",P)}C(!1),w(null),u(""),p("")},H=()=>{y(""),u(""),p(""),e&&e()},$=P=>{P.target===P.currentTarget&&H()};if(ta.useEffect(()=>{const P=F=>{F.key==="Escape"&&t&&H()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[t]),!t)return null;const K={width:"100%",padding:"12px 16px",fontSize:"15px",border:"1px solid #e2e8f0",borderRadius:"12px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#ffffff"},O={borderColor:v,boxShadow:`0 0 0 3px ${T}`,backgroundColor:"#ffffff"};return s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:$,role:"dialog","aria-modal":"true","aria-labelledby":"login-modal-title",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-5",style:{background:k,color:N},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{id:"login-modal-title",className:"text-xl font-semibold",style:{color:N},children:"Anmelden"}),s.jsx("button",{onClick:H,className:"p-2 rounded-xl transition-colors",style:{color:N,backgroundColor:"transparent"},onMouseEnter:P=>P.target.style.backgroundColor="rgba(255,255,255,0.2)",onMouseLeave:P=>P.target.style.backgroundColor="transparent","aria-label":"Schlieen",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l&&s.jsx("div",{className:"mt-4 mb-2 flex justify-center",children:s.jsx("img",{src:l,alt:`${a} Logo`,style:{height:"8.5rem",maxWidth:"100%",objectFit:"contain"}})}),s.jsxs("p",{className:"text-sm mt-1",style:{color:N,opacity:.8},children:["Bei ",a," anmelden"]})]}),s.jsxs("form",{onSubmit:_,className:"p-6 space-y-5",children:[m&&s.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm flex items-start gap-3",children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{children:m})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Benutzername oder E-Mail"}),s.jsx("input",{type:"text",id:"login-username",value:d,onChange:P=>u(P.target.value),style:K,onFocus:P=>Object.assign(P.target.style,O),onBlur:P=>{P.target.style.borderColor="#e2e8f0",P.target.style.boxShadow="none",P.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Benutzername",disabled:f,autoComplete:"username",autoFocus:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Passwort"}),s.jsx("input",{type:"password",id:"login-password",value:h,onChange:P=>p(P.target.value),style:K,onFocus:P=>Object.assign(P.target.style,O),onBlur:P=>{P.target.style.borderColor="#e2e8f0",P.target.style.boxShadow="none",P.target.style.backgroundColor="#ffffff"},placeholder:"Ihr Passwort",disabled:f,autoComplete:"current-password"})]}),s.jsx("button",{type:"submit",disabled:f,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:600,color:R,background:f?"#94a3b8":E,border:"none",borderRadius:"12px",cursor:f?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"all 0.2s ease",opacity:f?.7:1,boxShadow:f?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},onMouseEnter:P=>{f||(P.target.style.transform="translateY(-1px)",P.target.style.boxShadow="0 6px 20px rgba(58, 127, 167, 0.4)")},onMouseLeave:P=>{P.target.style.transform="translateY(0)",P.target.style.boxShadow=f?"none":"0 4px 14px rgba(58, 127, 167, 0.3)"},children:f?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",style:{width:"20px",height:"20px",color:R,animation:"spin 1s linear infinite"},children:[s.jsx("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{style:{opacity:.75},fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{style:{color:R,fontSize:"16px",fontWeight:600},children:"Wird angemeldet..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:R,style:{width:"20px",height:"20px"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),s.jsx("span",{style:{color:R,fontSize:"16px",fontWeight:600},children:"Anmelden"})]})}),s.jsx("p",{className:"text-xs text-center text-gray-500 pt-2",children:"Verwenden Sie Ihre WordPress-Zugangsdaten zur Anmeldung."})]})]}),s.jsx(lA,{isOpen:S,onClose:Y,onSuccess:A})]})}function uA({onNavigate:t}){const e=[{id:"admin_roleplays",title:"Live-Simulationen",description:"Verwalten Sie Szenarien fr Live-Voice-Interviews mit KI-Gesprchspartnern.",icon:ze,color:"text-blue-600",bgColor:"bg-blue-50",stats:null},{id:"admin_simulator",title:"Szenario-Training",description:"Konfigurieren Sie strukturierte Trainingsszenarien mit Fragen und Feedback.",icon:De,color:"text-green-600",bgColor:"bg-green-50",stats:null},{id:"admin_video",title:"Wirkungs-Analyse",description:"Verwalten Sie Video-basierte Wirkungs-Analysen und bungen.",icon:ht,color:"text-purple-600",bgColor:"bg-purple-50",stats:null},{id:"admin_partners",title:"Partner-Branding",description:"White-Label Partner verwalten: Farben, Logos und Modul-Zugriff.",icon:un,color:"text-orange-600",bgColor:"bg-orange-50",stats:null}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[s.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 shadow-lg",children:s.jsx(Hi,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-[var(--text-main)]",children:"Administration"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:"Verwalten Sie Szenarien, Trainings und Partner-Konfigurationen"})]})]}),s.jsx(Ze,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(ud,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Admin-Bereich"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Dieser Bereich ist nur fr WordPress-Administratoren sichtbar. Hier knnen Sie alle Inhalte und Konfigurationen der Plattform verwalten."})]})]})})}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.map(n=>s.jsx(Ze,{className:"cursor-pointer transition-all hover:shadow-lg hover:border-[var(--primary-accent)] group",onClick:()=>t(n.id),children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:`p-3 rounded-xl ${n.bgColor} transition-transform group-hover:scale-110`,children:s.jsx(n.icon,{className:`w-6 h-6 ${n.color}`})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)] group-hover:text-[var(--primary-accent)] transition-colors",children:n.title}),s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mt-1",children:n.description})]})]}),s.jsx(It,{className:"w-5 h-5 text-[var(--text-muted)] group-hover:text-[var(--primary-accent)] group-hover:translate-x-1 transition-all"})]})})},n.id))}),s.jsxs(Ze,{children:[s.jsxs(Ji,{children:[s.jsx(Xi,{className:"text-lg",children:"Schnellaktionen"}),s.jsx(Ny,{children:"Hufig verwendete Admin-Funktionen"})]}),s.jsx(yt,{children:s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs(se,{variant:"outline",onClick:()=>t("admin_roleplays"),className:"flex items-center gap-2",children:[s.jsx(ze,{className:"w-4 h-4"}),"Neues Roleplay erstellen"]}),s.jsxs(se,{variant:"outline",onClick:()=>t("admin_partners"),className:"flex items-center gap-2",children:[s.jsx(un,{className:"w-4 h-4"}),"Neuen Partner anlegen"]})]})})]})]})}const an=g.forwardRef(({className:t,type:e,...n},i)=>s.jsx("input",{type:e,className:oe("flex h-11 w-full rounded-xl border-2 bg-white px-4 py-2 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","file:border-0 file:bg-ocean-blue-50 file:text-ocean-blue-700 file:text-sm file:font-medium file:mr-4 file:px-4 file:py-2 file:rounded-lg","hover:border-slate-300","transition-all duration-200",t),ref:i,...n}));an.displayName="Input";const ps=g.forwardRef(({className:t,...e},n)=>s.jsx("textarea",{className:oe("flex min-h-[100px] w-full rounded-xl border-2 bg-white px-4 py-3 text-sm text-slate-900","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:border-ocean-blue-400 focus:ring-2 focus:ring-ocean-blue-100","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","hover:border-slate-300","resize-none","transition-all duration-200",t),ref:n,...e}));ps.displayName="Textarea";function Fi({title:t,subtitle:e,icon:n,accentColor:i="blue",children:r,defaultExpanded:o=!1,badge:a}){const[l,c]=g.useState(o),[d,u]=g.useState(!1),h={blue:{headerBg:"#e0f2fe",headerBgHover:"#bae6fd",iconBg:"#ffffff",iconText:"#0284c7",titleText:"#075985"},green:{headerBg:"#d1fae5",headerBgHover:"#a7f3d0",iconBg:"#ffffff",iconText:"#059669",titleText:"#065f46"},purple:{headerBg:"#ede9fe",headerBgHover:"#ddd6fe",iconBg:"#ffffff",iconText:"#7c3aed",titleText:"#5b21b6"},orange:{headerBg:"#fef3c7",headerBgHover:"#fde68a",iconBg:"#ffffff",iconText:"#d97706",titleText:"#92400e"},teal:{headerBg:"#ccfbf1",headerBgHover:"#99f6e4",iconBg:"#ffffff",iconText:"#0d9488",titleText:"#115e59"}},p=h[i]||h.blue,m={width:"100%",display:"block",backgroundColor:"#ffffff",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"none",marginBottom:"0"},y={width:"100%",display:"block",backgroundColor:d?p.headerBgHover:p.headerBg,transition:"background-color 0.2s ease",border:"none",margin:0,padding:0},f={width:"100%",display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",textAlign:"left",cursor:"pointer",border:"none",background:"none",backgroundColor:"transparent",margin:0,outline:"none",fontFamily:"inherit"},b={width:"36px",height:"36px",minWidth:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:p.iconBg,boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},S={flex:1,minWidth:0,overflow:"hidden"},C={fontWeight:600,fontSize:"14px",lineHeight:"1.4",display:"block",color:p.titleText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",margin:0,padding:0},j={fontSize:"12px",lineHeight:"1.4",color:"#64748b",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginTop:"2px",padding:0},w={fontSize:"12px",fontWeight:500,color:"#64748b",backgroundColor:"rgba(255,255,255,0.9)",padding:"4px 10px",borderRadius:"9999px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",flexShrink:0},v={padding:"12px 16px 16px 16px",borderTop:"1px solid #f1f5f9",backgroundColor:"rgba(248, 250, 252, 0.5)"};return s.jsxs(L.div,{style:m,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[s.jsx("div",{style:y,children:s.jsxs("button",{type:"button",onClick:()=>c(!l),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:f,children:[n&&s.jsx("div",{style:b,children:s.jsx(n,{style:{width:"20px",height:"20px",color:p.iconText}})}),s.jsxs("div",{style:S,children:[s.jsx("span",{style:C,children:t}),e&&s.jsx("span",{style:j,children:e})]}),a&&s.jsx("span",{style:w,children:a})]})}),s.jsx(Ve,{children:l&&s.jsx(L.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:s.jsx("div",{style:v,children:r})})})]})}function Gy({children:t,className:e}){const n={display:"flex",flexDirection:"column",gap:"12px",width:"100%"};return s.jsx("div",{style:n,className:e,children:t})}function hA({onBack:t}){const[e,n]=g.useState([]),[i,r]=g.useState(!0),[o,a]=g.useState(null),[l,c]=g.useState(""),[d,u]=g.useState(!1),[h,p]=g.useState(!1),[m,y]=g.useState(!1),[f,b]=g.useState(null),[S,C]=g.useState(!1),[j,w]=g.useState({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),[v,E]=g.useState(null);g.useEffect(()=>{k()},[]);const k=async()=>{try{r(!0),a(null);const D=await fe.adminGetRoleplayScenarios();if(D.success)n(D.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(D){a(D.message),T("error","Fehler beim Laden der Szenarien")}finally{r(!1)}},T=(D,B)=>{E({type:D,message:B}),setTimeout(()=>E(null),4e3)},N=()=>{w({title:"",description:"",agent_id:"",initial_message:"",difficulty:"medium",status:"draft",coaching_hints:"",interviewer_profile:{name:"",role:"",properties:""}}),u(!0)},R=D=>{b(D),w({title:D.title||"",description:D.description||"",agent_id:D.agent_id||"",initial_message:D.initial_message||"",difficulty:D.difficulty||"medium",status:D.status||"draft",coaching_hints:D.coaching_hints||"",interviewer_profile:{name:D.interviewer_profile?.name||"",role:D.interviewer_profile?.role||"",properties:D.interviewer_profile?.properties||""}}),p(!0)},_=D=>{b(D),y(!0)},A=async()=>{if(!j.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(C(!0),(await fe.adminCreateRoleplayScenario(j)).success)T("success","Szenario erfolgreich erstellt"),u(!1),k();else throw new Error("Fehler beim Erstellen")}catch(D){T("error",D.message)}finally{C(!1)}},Y=async()=>{if(!j.title.trim()){T("error","Bitte geben Sie einen Titel ein");return}try{if(C(!0),(await fe.adminUpdateRoleplayScenario(f.id,j)).success)T("success","Szenario erfolgreich aktualisiert"),p(!1),k();else throw new Error("Fehler beim Aktualisieren")}catch(D){T("error",D.message)}finally{C(!1)}},H=async()=>{try{if(C(!0),(await fe.adminDeleteRoleplayScenario(f.id)).success)T("success","Szenario erfolgreich gelscht"),y(!1),k();else throw new Error("Fehler beim Lschen")}catch(D){T("error",D.message)}finally{C(!1)}},$=e.filter(D=>D.title?.toLowerCase().includes(l.toLowerCase())||D.description?.toLowerCase().includes(l.toLowerCase())),K=D=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[D]||D,O=D=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[D]||"bg-gray-100 text-gray-700",P=D=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[D]||D,F=D=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[D]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[v&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${v.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[v.type==="success"?s.jsx(Zt,{className:"w-5 h-5"}):s.jsx(ve,{className:"w-5 h-5"}),v.message,s.jsx("button",{onClick:()=>E(null),className:"ml-2 hover:opacity-80",children:s.jsx(kn,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(se,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(pt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(ze,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Live-Simulationen (Roleplays)"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]}),s.jsxs(se,{onClick:N,className:"flex items-center gap-2",children:[s.jsx(As,{className:"w-4 h-4"}),"Neues Szenario"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(ei,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(an,{placeholder:"Szenarien durchsuchen...",value:l,onChange:D=>c(D.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ye,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(Ze,{className:"border-red-200 bg-red-50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ve,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(se,{variant:"outline",size:"sm",onClick:k,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:$.length===0?s.jsx(Ze,{children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ze,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsx(se,{onClick:N,className:"mt-4",children:"Erstes Szenario erstellen"})]})})}):$.map(D=>s.jsx(Ze,{className:"hover:shadow-md transition-shadow",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:D.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${F(D.status)}`,children:P(D.status)}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${O(D.difficulty)}`,children:K(D.difficulty)})]}),D.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:D.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[D.agent_id&&s.jsxs("span",{children:["Agent: ",D.agent_id.substring(0,12),"..."]}),s.jsxs("span",{children:["ID: ",D.id]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>R(D),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(gm,{className:"w-4 h-4"})}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>_(D),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(pn,{className:"w-4 h-4"})})]})]})})},D.id))}),s.jsx(Kt,{open:d,onOpenChange:u,children:s.jsxs(Yt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Neues Szenario erstellen"}),s.jsx(dn,{children:"Erstellen Sie ein neues Roleplay-Szenario fr Live-Simulationen."})]}),s.jsx(Tf,{formData:j,setFormData:w}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:A,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(Kt,{open:h,onOpenChange:p,children:s.jsxs(Yt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Szenario bearbeiten"}),s.jsx(dn,{children:"Bearbeiten Sie das ausgewhlte Roleplay-Szenario."})]}),s.jsx(Tf,{formData:j,setFormData:w}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:Y,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(Kt,{open:m,onOpenChange:y,children:s.jsxs(Yt,{children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Szenario lschen"}),s.jsxs(dn,{children:['Sind Sie sicher, dass Sie das Szenario "',f?.title,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>y(!1),children:"Abbrechen"}),s.jsxs(se,{variant:"destructive",onClick:H,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function Tf({formData:t,setFormData:e}){return s.jsxs(Gy,{children:[s.jsx(Fi,{title:"Grundinformationen",subtitle:"Titel, Beschreibung und Basiseinstellungen",icon:Tt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Titel ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(an,{value:t.title,onChange:n=>e({...t,title:n.target.value}),placeholder:"z.B. Vorstellungsgesprch IT-Consultant"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(ps,{value:t.description,onChange:n=>e({...t,description:n.target.value}),placeholder:"Kurze Beschreibung des Szenarios...",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:n=>e({...t,status:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Verffentlicht"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Schwierigkeit"}),s.jsxs("select",{value:t.difficulty,onChange:n=>e({...t,difficulty:n.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"easy",children:"Einfach"}),s.jsx("option",{value:"medium",children:"Mittel"}),s.jsx("option",{value:"hard",children:"Schwer"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"ElevenLabs Agent ID"}),s.jsx(an,{value:t.agent_id,onChange:n=>e({...t,agent_id:n.target.value}),placeholder:"agent_xxx..."}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Die Agent ID aus Ihrem ElevenLabs Dashboard"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Erste Nachricht"}),s.jsx(ps,{value:t.initial_message,onChange:n=>e({...t,initial_message:n.target.value}),placeholder:"Die erste Nachricht des KI-Gesprchspartners...",rows:3}),s.jsxs("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:["Platzhalter: ","{{user_name}}",", ","{{company_name}}",", ","{{position}}"]})]})]})}),s.jsx(Fi,{title:"Gesprchspartner-Profil",subtitle:"Name, Rolle und Eigenschaften des KI-Interviewers",icon:xt,accentColor:"teal",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),s.jsx(an,{value:t.interviewer_profile.name,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,name:n.target.value}}),placeholder:"z.B. Dr. Maria Schmidt"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rolle/Position"}),s.jsx(an,{value:t.interviewer_profile.role,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,role:n.target.value}}),placeholder:"z.B. HR-Leiterin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Eigenschaften"}),s.jsx(ps,{value:t.interviewer_profile.properties,onChange:n=>e({...t,interviewer_profile:{...t.interviewer_profile,properties:n.target.value}}),placeholder:"Charaktereigenschaften (eine pro Zeile)...",rows:3})]})]})}),s.jsx(Fi,{title:"Erweiterte Einstellungen",subtitle:"Coaching-Hinweise und zustzliche Konfiguration",icon:ud,accentColor:"purple",children:s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Coaching-Hinweise"}),s.jsx(ps,{value:t.coaching_hints,onChange:n=>e({...t,coaching_hints:n.target.value}),placeholder:"Tipps fr den Benutzer whrend des Gesprchs (eine pro Zeile)...",rows:4}),s.jsx("p",{className:"text-xs text-[var(--text-muted)] mt-1",children:"Diese Hinweise werden im Live-Coaching-Panel angezeigt"})]})})})]})}function pA({onBack:t}){const[e,n]=g.useState([]),[i,r]=g.useState(!0),[o,a]=g.useState(null),[l,c]=g.useState("");g.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const f=await fe.adminGetSimulatorScenarios();if(f.success)n(f.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(f){a(f.message)}finally{r(!1)}},u=e.filter(f=>f.title?.toLowerCase().includes(l.toLowerCase())||f.description?.toLowerCase().includes(l.toLowerCase())),h=f=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[f]||f,p=f=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[f]||"bg-gray-100 text-gray-700",m=f=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[f]||f,y=f=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[f]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(se,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(pt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:s.jsx(De,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Szenario-Training"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(Ze,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(Ns,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Szenario-Training-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(se,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=simulator_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(gs,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(ei,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(an,{placeholder:"Szenarien durchsuchen...",value:l,onChange:f=>c(f.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ye,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(Ze,{className:"border-red-200 bg-red-50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ve,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(se,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(Ze,{children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(De,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Szenarien vorhanden"}),!l&&s.jsxs(se,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=simulator_scenario","_blank"),children:[s.jsx(gs,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(f=>s.jsx(Ze,{className:"hover:shadow-md transition-shadow",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:f.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(f.status)}`,children:h(f.status)}),f.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${y(f.difficulty)}`,children:m(f.difficulty)})]}),f.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:f.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[f.category&&s.jsxs("span",{children:["Kategorie: ",f.category]}),f.questions_count&&s.jsxs("span",{children:[f.questions_count," Fragen"]}),s.jsxs("span",{children:["ID: ",f.id]})]})]}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${f.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(gs,{className:"w-4 h-4"})})]})})},f.id))})]})}function fA({onBack:t}){const[e,n]=g.useState([]),[i,r]=g.useState(!0),[o,a]=g.useState(null),[l,c]=g.useState("");g.useEffect(()=>{d()},[]);const d=async()=>{try{r(!0),a(null);const f=await fe.adminGetVideoTrainingScenarios();if(f.success)n(f.data||[]);else throw new Error("Fehler beim Laden der Szenarien")}catch(f){a(f.message)}finally{r(!1)}},u=e.filter(f=>f.title?.toLowerCase().includes(l.toLowerCase())||f.description?.toLowerCase().includes(l.toLowerCase())),h=f=>({publish:"Verffentlicht",draft:"Entwurf",pending:"Ausstehend"})[f]||f,p=f=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[f]||"bg-gray-100 text-gray-700",m=f=>({easy:"Einfach",medium:"Mittel",hard:"Schwer"})[f]||f,y=f=>({easy:"bg-green-100 text-green-700",medium:"bg-yellow-100 text-yellow-700",hard:"bg-red-100 text-red-700"})[f]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(se,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(pt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:s.jsx(ht,{className:"w-6 h-6 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Wirkungs-Analyse"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Szenarien"]})]})]})]})}),s.jsx(Ze,{className:"border-blue-200 bg-blue-50/50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:s.jsx(Ns,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Verwaltung im WordPress-Backend"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1 mb-3",children:"Wirkungs-Analyse-Szenarien werden im WordPress-Adminbereich verwaltet. Hier sehen Sie eine bersicht der vorhandenen Szenarien."}),s.jsxs(se,{variant:"outline",size:"sm",onClick:()=>window.open("/wp-admin/edit.php?post_type=video_training_scenario","_blank"),className:"flex items-center gap-2",children:[s.jsx(gs,{className:"w-4 h-4"}),"WordPress-Admin ffnen"]})]})]})})}),s.jsxs("div",{className:"relative",children:[s.jsx(ei,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(an,{placeholder:"Szenarien durchsuchen...",value:l,onChange:f=>c(f.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ye,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(Ze,{className:"border-red-200 bg-red-50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ve,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(se,{variant:"outline",size:"sm",onClick:d,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:u.length===0?s.jsx(Ze,{children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ht,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Szenarien gefunden":"Noch keine Wirkungs-Analyse-Szenarien vorhanden"}),!l&&s.jsxs(se,{variant:"outline",className:"mt-4",onClick:()=>window.open("/wp-admin/post-new.php?post_type=video_training_scenario","_blank"),children:[s.jsx(gs,{className:"w-4 h-4 mr-2"}),"Im WordPress-Admin erstellen"]})]})})}):u.map(f=>s.jsx(Ze,{className:"hover:shadow-md transition-shadow",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:f.title}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(f.status)}`,children:h(f.status)}),f.difficulty&&s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${y(f.difficulty)}`,children:m(f.difficulty)})]}),f.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-2",children:f.description}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-[var(--text-muted)]",children:[f.category&&s.jsxs("span",{children:["Kategorie: ",f.category]}),s.jsxs("span",{children:["ID: ",f.id]})]})]}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>window.open(`/wp-admin/post.php?post=${f.id}&action=edit`,"_blank"),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"Im WordPress-Admin bearbeiten",children:s.jsx(gs,{className:"w-4 h-4"})})]})})},f.id))})]})}const gA=[{id:"overview",label:"bersicht"},{id:"dashboard",label:"Dashboard"},{id:"roleplay",label:"Live-Simulation (Roleplay)"},{id:"simulator",label:"Szenario-Training (Simulator)"},{id:"video_training",label:"Wirkungs-Analyse"},{id:"gym",label:"Rhetorik-Gym (Game)"},{id:"history",label:"Verlauf / History"}],St={"--app-bg-start":"#f8fafc","--app-bg-mid":"#eff6ff","--app-bg-end":"#f0fdfa","--card-bg-color":"#ffffff","--sidebar-bg-color":"#ffffff","--sidebar-text-color":"#0f172a","--sidebar-text-muted":"#64748b","--sidebar-active-bg":"#E8F4F8","--sidebar-active-text":"#2D6485","--primary-accent":"#3A7FA7","--primary-accent-hover":"#2D6485","--button-solid":"#3A7FA7","--button-text":"#ffffff","--header-gradient-start":"#3A7FA7","--header-gradient-end":"#3DA389","--header-text":"#ffffff","--icon-primary":"#3A7FA7","--icon-secondary":"#3DA389","--icon-muted":"#94a3b8","--text-main":"#0f172a","--text-secondary":"#475569","--text-muted":"#94a3b8","--border-color":"#e2e8f0","--border-color-light":"#f1f5f9","--focus-ring":"rgba(58, 127, 167, 0.3)"},mA=[{id:"app",title:"App / Allgemein",subtitle:"Hintergrundfarben der Anwendung",accentColor:"blue",iconName:"Layout",fields:[{key:"--app-bg-start",label:"App Hintergrund (Start)",type:"color"},{key:"--app-bg-mid",label:"App Hintergrund (Mitte)",type:"color"},{key:"--app-bg-end",label:"App Hintergrund (Ende)",type:"color"},{key:"--card-bg-color",label:"Karten Hintergrund",type:"color"}]},{id:"sidebar",title:"Sidebar",subtitle:"Farben der Seitennavigation",accentColor:"teal",iconName:"PanelLeft",fields:[{key:"--sidebar-bg-color",label:"Sidebar Hintergrund",type:"color"},{key:"--sidebar-text-color",label:"Sidebar Text",type:"color"},{key:"--sidebar-text-muted",label:"Sidebar Text (gedmpft)",type:"color"},{key:"--sidebar-active-bg",label:"Sidebar Aktiv Hintergrund",type:"color"},{key:"--sidebar-active-text",label:"Sidebar Aktiv Text",type:"color"}]},{id:"accent",title:"Akzentfarben",subtitle:"Primre Markenfarben",accentColor:"purple",iconName:"Sparkles",fields:[{key:"--primary-accent",label:"Primrfarbe",type:"color"},{key:"--primary-accent-hover",label:"Primrfarbe (Hover)",type:"color"}]},{id:"buttons",title:"Buttons",subtitle:"Schaltflchenfarben",accentColor:"green",iconName:"Square",fields:[{key:"--button-solid",label:"Button Farbe",type:"color"},{key:"--button-text",label:"Button Text",type:"color"}]},{id:"header",title:"Header",subtitle:"Kopfzeilenfarben",accentColor:"orange",iconName:"PanelTop",fields:[{key:"--header-gradient-start",label:"Header Gradient (Start)",type:"color"},{key:"--header-gradient-end",label:"Header Gradient (Ende)",type:"color"},{key:"--header-text",label:"Header Text",type:"color"}]},{id:"icons",title:"Icons",subtitle:"Symbolfarben",accentColor:"blue",iconName:"Shapes",fields:[{key:"--icon-primary",label:"Icon Primr",type:"color"},{key:"--icon-secondary",label:"Icon Sekundr",type:"color"},{key:"--icon-muted",label:"Icon (gedmpft)",type:"color"}]},{id:"text",title:"Text",subtitle:"Textfarben",accentColor:"teal",iconName:"Type",fields:[{key:"--text-main",label:"Text Hauptfarbe",type:"color"},{key:"--text-secondary",label:"Text Sekundr",type:"color"},{key:"--text-muted",label:"Text (gedmpft)",type:"color"}]},{id:"borders",title:"Rahmen & Focus",subtitle:"Rahmen- und Fokusfarben",accentColor:"purple",iconName:"Frame",fields:[{key:"--border-color",label:"Rahmenfarbe",type:"color"},{key:"--border-color-light",label:"Rahmenfarbe (hell)",type:"color"},{key:"--focus-ring",label:"Focus Ring",type:"color"}]}],xA={Layout:Vk,PanelLeft:zk,Sparkles:st,Square:Sr,PanelTop:Wk,Shapes:Gk,Type:Hk,Frame:Pk};function yA({onBack:t}){const[e,n]=g.useState([]),[i,r]=g.useState(!0),[o,a]=g.useState(null),[l,c]=g.useState(""),[d,u]=g.useState(!1),[h,p]=g.useState(!1),[m,y]=g.useState(!1),[f,b]=g.useState(null),[S,C]=g.useState(!1),[j,w]=g.useState({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...St}}),[v,E]=g.useState(null);g.useEffect(()=>{k()},[]);const k=async()=>{try{r(!0),a(null);const F=await fe.adminGetPartners();if(F.success)n(F.data||[]);else throw new Error("Fehler beim Laden der Partner")}catch(F){a(F.message),T("error","Fehler beim Laden der Partner")}finally{r(!1)}},T=(F,D)=>{E({type:F,message:D}),setTimeout(()=>E(null),4e3)},N=()=>{w({name:"",slug:"",description:"",status:"draft",modules:[],branding:{...St}}),u(!0)},R=F=>{b(F),w({name:F.name||"",slug:F.slug||"",description:F.description||"",status:F.status||"draft",modules:F.modules||[],branding:{...St,...F.branding}}),p(!0)},_=F=>{b(F),y(!0)},A=async()=>{if(!j.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}const F={...j,slug:j.slug||j.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")};try{if(C(!0),(await fe.adminCreatePartner(F)).success)T("success","Partner erfolgreich erstellt"),u(!1),k();else throw new Error("Fehler beim Erstellen")}catch(D){T("error",D.message)}finally{C(!1)}},Y=async()=>{if(!j.name.trim()){T("error","Bitte geben Sie einen Namen ein");return}try{if(C(!0),(await fe.adminUpdatePartner(f.id,j)).success)T("success","Partner erfolgreich aktualisiert"),p(!1),k();else throw new Error("Fehler beim Aktualisieren")}catch(F){T("error",F.message)}finally{C(!1)}},H=async()=>{try{if(C(!0),(await fe.adminDeletePartner(f.id)).success)T("success","Partner erfolgreich gelscht"),y(!1),k();else throw new Error("Fehler beim Lschen")}catch(F){T("error",F.message)}finally{C(!1)}},$=F=>{const D=`${window.location.origin}${window.location.pathname}?partner=${F}`;navigator.clipboard.writeText(D),T("success","URL in Zwischenablage kopiert")},K=e.filter(F=>F.name?.toLowerCase().includes(l.toLowerCase())||F.slug?.toLowerCase().includes(l.toLowerCase())),O=F=>({publish:"Aktiv",draft:"Entwurf",pending:"Ausstehend"})[F]||F,P=F=>({publish:"bg-green-100 text-green-700",draft:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700"})[F]||"bg-gray-100 text-gray-700";return s.jsxs("div",{className:"space-y-6",children:[v&&s.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${v.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[v.type==="success"?s.jsx(Zt,{className:"w-5 h-5"}):s.jsx(ve,{className:"w-5 h-5"}),v.message,s.jsx("button",{onClick:()=>E(null),className:"ml-2 hover:opacity-80",children:s.jsx(kn,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(se,{variant:"ghost",onClick:t,className:"p-2",children:s.jsx(pt,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-orange-100",children:s.jsx(un,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-[var(--text-main)]",children:"Partner-Branding"}),s.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:[e.length," Partner"]})]})]})]}),s.jsxs(se,{onClick:N,className:"flex items-center gap-2",children:[s.jsx(As,{className:"w-4 h-4"}),"Neuer Partner"]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(ei,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[var(--text-muted)]"}),s.jsx(an,{placeholder:"Partner durchsuchen...",value:l,onChange:F=>c(F.target.value),className:"pl-10"})]}),i&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx(ye,{className:"w-8 h-8 animate-spin text-[var(--primary-accent)]"})}),o&&!i&&s.jsx(Ze,{className:"border-red-200 bg-red-50",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[s.jsx(ve,{className:"w-5 h-5"}),s.jsx("p",{children:o}),s.jsx(se,{variant:"outline",size:"sm",onClick:k,children:"Erneut versuchen"})]})})}),!i&&!o&&s.jsx("div",{className:"space-y-3",children:K.length===0?s.jsx(Ze,{children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(un,{className:"w-12 h-12 text-[var(--text-muted)] mx-auto mb-3"}),s.jsx("p",{className:"text-[var(--text-secondary)]",children:l?"Keine Partner gefunden":"Noch keine Partner vorhanden"}),!l&&s.jsx(se,{onClick:N,className:"mt-4",children:"Ersten Partner erstellen"})]})})}):K.map(F=>s.jsx(Ze,{className:"hover:shadow-md transition-shadow",children:s.jsx(yt,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg border shadow-sm",style:{background:F.branding?.["--primary-accent"]||St["--primary-accent"]}}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-[var(--text-main)]",children:F.name}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${P(F.status)}`,children:O(F.status)})]}),s.jsxs("p",{className:"text-sm text-[var(--text-muted)]",children:["Slug: ",F.slug]})]})]}),F.description&&s.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 line-clamp-1",children:F.description}),s.jsx("div",{className:"flex items-center gap-2 text-xs text-[var(--text-muted)]",children:F.modules?.length>0?s.jsxs("span",{children:[F.modules.length," Module aktiv"]}):s.jsx("span",{children:"Alle Module aktiv"})})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>$(F.slug),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",title:"URL kopieren",children:s.jsx(cm,{className:"w-4 h-4"})}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>R(F),className:"text-[var(--text-secondary)] hover:text-[var(--primary-accent)]",children:s.jsx(gm,{className:"w-4 h-4"})}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>_(F),className:"text-[var(--text-secondary)] hover:text-red-600",children:s.jsx(pn,{className:"w-4 h-4"})})]})]})})},F.id))}),s.jsx(Kt,{open:d,onOpenChange:u,children:s.jsxs(Yt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Neuen Partner erstellen"}),s.jsx(dn,{children:"Erstellen Sie einen neuen White-Label Partner mit eigenem Branding."})]}),s.jsx(Ef,{formData:j,setFormData:w}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>u(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:A,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Erstellen"]})]})]})}),s.jsx(Kt,{open:h,onOpenChange:p,children:s.jsxs(Yt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Partner bearbeiten"}),s.jsx(dn,{children:"Bearbeiten Sie die Konfiguration des ausgewhlten Partners."})]}),s.jsx(Ef,{formData:j,setFormData:w}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),s.jsxs(se,{onClick:Y,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern"]})]})]})}),s.jsx(Kt,{open:m,onOpenChange:y,children:s.jsxs(Yt,{children:[s.jsxs(Jt,{children:[s.jsx(Xt,{children:"Partner lschen"}),s.jsxs(dn,{children:['Sind Sie sicher, dass Sie den Partner "',f?.name,'" lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden.']})]}),s.jsxs(cn,{children:[s.jsx(se,{variant:"outline",onClick:()=>y(!1),children:"Abbrechen"}),s.jsxs(se,{variant:"destructive",onClick:H,disabled:S,children:[S&&s.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Lschen"]})]})]})})]})}function bA({label:t,value:e,defaultValue:n,onChange:i}){const o=e?.startsWith("rgba")||n?.startsWith("rgba")?"#3A7FA7":e||n||"#000000";return s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"color",value:o,onChange:a=>i(a.target.value),className:"w-10 h-8 rounded border cursor-pointer"}),s.jsx(an,{value:e||"",onChange:a=>i(a.target.value),placeholder:n,className:"flex-1 text-xs"})]})]})}function vA({branding:t}){const e=t?.["--app-bg-start"]||St["--app-bg-start"],n=t?.["--app-bg-mid"]||St["--app-bg-mid"],i=t?.["--app-bg-end"]||St["--app-bg-end"],r=t?.["--card-bg-color"]||St["--card-bg-color"],o=t?.["--header-gradient-start"]||St["--header-gradient-start"],a=t?.["--header-gradient-end"]||St["--header-gradient-end"],l=t?.["--header-text"]||St["--header-text"],c=t?.["--text-main"]||St["--text-main"],d=t?.["--text-secondary"]||St["--text-secondary"],u=t?.["--button-solid"]||St["--button-solid"],h=t?.["--button-text"]||St["--button-text"],p=t?.["--border-color"]||St["--border-color"];return s.jsxs("div",{className:"rounded-lg p-4 mb-4",style:{background:`linear-gradient(135deg, ${e} 0%, ${n} 50%, ${i} 100%)`},children:[s.jsx("div",{className:"rounded-t-lg px-3 py-2 mb-2",style:{background:`linear-gradient(135deg, ${o} 0%, ${a} 100%)`},children:s.jsx("span",{className:"text-xs font-medium",style:{color:l},children:"Header Vorschau"})}),s.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:r,border:`1px solid ${p}`},children:[s.jsx("p",{className:"text-sm font-medium mb-1",style:{color:c},children:"Karten-Titel"}),s.jsx("p",{className:"text-xs mb-3",style:{color:d},children:"Sekundrer Text"}),s.jsx("button",{type:"button",className:"px-3 py-1.5 rounded text-xs font-medium",style:{backgroundColor:u,color:h},children:"Button"})]})]})}function Ef({formData:t,setFormData:e}){const n=r=>{const o=t.modules||[];o.includes(r)?e({...t,modules:o.filter(a=>a!==r)}):e({...t,modules:[...o,r]})},i=(r,o)=>{e({...t,branding:{...t.branding,[r]:o}})};return s.jsxs(Gy,{children:[s.jsx(Fi,{title:"Grundinformationen",subtitle:"Name, Slug und Status des Partners",icon:Tt,accentColor:"blue",defaultExpanded:!0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(an,{value:t.name,onChange:r=>e({...t,name:r.target.value}),placeholder:"z.B. Vertriebsakademie Mller"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Slug (URL-ID)"}),s.jsx(an,{value:t.slug,onChange:r=>e({...t,slug:r.target.value.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}),placeholder:"z.B. vertriebsakademie-mueller"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Wird in der URL verwendet: ?partner=",t.slug||"ihr-slug"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beschreibung"}),s.jsx(ps,{value:t.description,onChange:r=>e({...t,description:r.target.value}),placeholder:"Optionale Beschreibung des Partners...",rows:2})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),s.jsxs("select",{value:t.status,onChange:r=>e({...t,status:r.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:"draft",children:"Entwurf"}),s.jsx("option",{value:"publish",children:"Aktiv"}),s.jsx("option",{value:"pending",children:"Ausstehend"})]})]})]})}),s.jsx(Fi,{title:"Erlaubte Module",subtitle:"Welche Funktionen fr diesen Partner verfgbar sind",icon:Dk,accentColor:"green",badge:t.modules?.length>0?`${t.modules.length} ausgewhlt`:"Alle",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Keine Auswahl = Alle Module sind erlaubt"}),s.jsx("div",{className:"space-y-2",children:gA.map(r=>s.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 cursor-pointer transition-colors",children:[s.jsx("input",{type:"checkbox",checked:t.modules?.includes(r.id)||!1,onChange:()=>n(r.id),className:"rounded border-gray-300"}),s.jsx("span",{className:"text-sm",children:r.label})]},r.id))})]})}),s.jsxs(Fi,{title:"Branding Vorschau",subtitle:"Live-Vorschau der konfigurierten Farben",icon:Bk,accentColor:"orange",defaultExpanded:!0,children:[s.jsx(vA,{branding:t.branding}),s.jsx("p",{className:"text-xs text-slate-500 text-center",children:"ndern Sie die Farben in den Sektionen unten"})]}),mA.map(r=>{const o=xA[r.iconName];return s.jsx(Fi,{title:r.title,subtitle:r.subtitle,icon:o,accentColor:r.accentColor,children:s.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.fields.map(a=>s.jsx(bA,{label:a.label,value:t.branding?.[a.key],defaultValue:St[a.key],onChange:l=>i(a.key,l)},a.key))})},r.id)})]})}console.log(" [APP] App.jsx module loaded");const SA=()=>s.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",zIndex:9999},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[s.jsx(ye,{style:{width:"48px",height:"48px",color:"#3A7FA7",animation:"spin 1s linear infinite"}}),s.jsx("p",{style:{fontSize:"16px",color:"#64748b",fontWeight:500,margin:0},children:"Trainingscenter wird geladen..."})]}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `})]}),ae={OVERVIEW:"overview",DASHBOARD:"dashboard",ROLEPLAY:"roleplay",SIMULATOR:"simulator",VIDEO_TRAINING:"video_training",SMART_BRIEFING:"smart_briefing",HISTORY:"history",SESSION_DETAIL:"session_detail",USAGE_LIMITS:"usage_limits",GYM:"gym",GYM_KLASSIKER:"gym_klassiker",GYM_SESSION:"gym_session",ADMIN:"admin",ADMIN_ROLEPLAYS:"admin_roleplays",ADMIN_SIMULATOR:"admin_simulator",ADMIN_VIDEO:"admin_video",ADMIN_PARTNERS:"admin_partners"};function kA(){const t=document.getElementById("wpadminbar");return t?t.offsetHeight:0}function wA(){const t=document.getElementById("bewerbungstrainer-app"),e=kA(),n=document.elementFromPoint(window.innerWidth/2,e+10);if(n){let r=n;for(;r&&r!==document.body;){const o=r.tagName?.toLowerCase();if((o==="header"||o==="nav"||r.classList?.contains("site-header")||r.classList?.contains("elementor-location-header")||r.id==="masthead")&&(!t||!t.contains(r))){const c=r.getBoundingClientRect().bottom;return c<=e?e:Math.max(e,c)}r=r.parentElement}}const i=["header.site-header","#masthead",".site-header",".elementor-location-header",'[data-elementor-type="header"]',".ast-header-wrap","#starter-header",".header-wrapper","header"];for(const r of i){const o=document.querySelector(r);if(o&&(!t||!t.contains(o))){const l=o.getBoundingClientRect().bottom;return l<=e?e:Math.max(e,l)}}if(t){let r=t.previousElementSibling;for(;r;){const o=r.getBoundingClientRect();if(o.height>30&&o.top<100){const a=o.bottom;return a<=e?e:Math.max(e,a)}r=r.previousElementSibling}}return e}function CA(){console.log(" [APP] App component initialized");const{isAuthenticated:t,authLoading:e,isLoading:n}=ge(),{isAdmin:i}=Ec();if(n)return s.jsx(SA,{});const[r,o]=g.useState(ae.OVERVIEW),[a,l]=g.useState(0),[c,d]=g.useState(null),[u,h]=g.useState({}),[p,m]=g.useState(null),[y,f]=g.useState(null),[b,S]=g.useState(null),[C,j]=g.useState(!1),w=()=>j(!0),v=()=>j(!1),[E,k]=g.useState(null),[T,N]=g.useState(null),[R,_]=g.useState(null),[A,Y]=g.useState(null),[H,$]=g.useState(null),[K,O]=g.useState(null),[P,F]=g.useState(null),[D,B]=g.useState(0),G=g.useCallback(z=>{if(z)switch(console.log(" [APP] Executing pending action:",z.type),z.type){case"SELECT_ROLEPLAY_SCENARIO":N(z.scenario),o(ae.DASHBOARD);break;case"SELECT_SIMULATOR_SCENARIO":_(z.scenario),o(ae.SIMULATOR);break;case"START_GYM_GAME":S(z.config),o(ae.GYM_SESSION);break;case"SELECT_GYM_MODE":Y(z.mode),o(ae.GYM_KLASSIKER);break;case"SELECT_VIDEO_TRAINING_SCENARIO":$(z.scenario),o(ae.VIDEO_TRAINING);break;default:console.warn("Unknown pending action type:",z.type)}},[]),ie=g.useCallback((z,de=null)=>t?(z(),!0):(console.log(" [APP] Auth required - storing pending action"),de&&k(de),w(),!1),[t]);g.useEffect(()=>{const z=()=>{const Ye=wA();l(Ye)},de=(Ye=0)=>{z(),Ye<5&&setTimeout(()=>de(Ye+1),200)};requestAnimationFrame(()=>{setTimeout(()=>de(),50)});const Ke=()=>setTimeout(z,100);return window.addEventListener("load",Ke),window.addEventListener("resize",z),window.addEventListener("scroll",z,{passive:!0}),()=>{window.removeEventListener("load",Ke),window.removeEventListener("resize",z),window.removeEventListener("scroll",z)}},[]);const le=g.useCallback(()=>{requestAnimationFrame(()=>{window.scrollTo(0,0);const z=document.getElementById("bewerbungstrainer-app");z&&(z.scrollTop=0);const de=document.querySelector("[data-main-content]");de&&(de.scrollTop=0),document.querySelectorAll('.overflow-y-auto, .overflow-auto, [style*="overflow"]').forEach(Ye=>{Ye.scrollTop>0&&(Ye.scrollTop=0)})})},[]);g.useEffect(()=>{le()},[r,le]);const re=z=>{switch(console.log(" [APP] Sidebar navigation to:",z),le(),z){case"overview":o(ae.OVERVIEW);break;case"dashboard":o(ae.DASHBOARD);break;case"simulator":o(ae.SIMULATOR);break;case"video_training":B(de=>de+1),o(ae.VIDEO_TRAINING);break;case"smart_briefing":o(ae.SMART_BRIEFING);break;case"history":o(ae.HISTORY);break;case"usage_limits":o(ae.USAGE_LIMITS);break;case"gym":case"gym_klassiker":o(ae.GYM_KLASSIKER);break;case"admin":o(ae.ADMIN);break;case"admin_roleplays":o(ae.ADMIN_ROLEPLAYS);break;case"admin_simulator":o(ae.ADMIN_SIMULATOR);break;case"admin_video":o(ae.ADMIN_VIDEO);break;case"admin_partners":o(ae.ADMIN_PARTNERS);break;default:o(ae.OVERVIEW)}},U=(z,de={})=>{console.log(" [APP] Scenario selected:",z),console.log(" [APP] Variables received:",de),d(z),h(de),o(ae.ROLEPLAY)},be=()=>{console.log(" [APP] Roleplay ended - returning to dashboard"),d(null),h({}),o(ae.DASHBOARD)},Oe=z=>{console.log(" [APP] Navigating to session analysis:",z.id),d(null),h({}),m(z),o(ae.SESSION_DETAIL)},bt=(z=null)=>{console.log(" [APP] Opening session history with tab:",z),f(z),o(ae.HISTORY)},ce=()=>{console.log(" [APP] Closing session history"),f(null),o(ae.DASHBOARD)},_e=z=>{console.log(" [APP] Navigating to history with tab:",z);const de={briefings:he.BRIEFINGS,simulator:he.SIMULATOR,video:he.VIDEO,roleplay:he.ROLEPLAY};f(de[z]||null),o(ae.HISTORY)},Le=z=>{console.log(" [APP] Session selected:",z.id),m(z),o(ae.SESSION_DETAIL)},ot=()=>{console.log(" [APP] Closing session detail"),m(null),o(ae.HISTORY)},Gt=(z,de)=>{console.log(" [APP] Continuing simulator session:",z.id),O({session:z,scenario:de}),o(ae.SIMULATOR)},te=(z,de)=>{console.log(" [APP] Repeating simulator session with same questions:",z.id),F({session:z,scenario:de}),o(ae.SIMULATOR)},$e=z=>{console.log(" [APP] Starting game with config:",z),S(z),o(ae.GYM_SESSION)},Ne=()=>{console.log(" [APP] Returning to gym dashboard"),S(null),o(ae.GYM_KLASSIKER)},je=z=>{console.log(" [APP] Game completed with result:",z)},_t=()=>{switch(r){case ae.ROLEPLAY:return s.jsx(t_,{scenario:c,variables:u,onEnd:be,onNavigateToSession:Oe});case ae.SIMULATOR:return s.jsx(bN,{isAuthenticated:t,requireAuth:ie,setPendingAction:k,pendingContinueSession:K,clearPendingContinueSession:()=>O(null),pendingRepeatSession:P,clearPendingRepeatSession:()=>F(null),onNavigateToHistory:()=>_e("simulator")});case ae.VIDEO_TRAINING:return s.jsx(_N,{isAuthenticated:t,requireAuth:ie,setPendingAction:k,pendingScenario:H,clearPendingScenario:()=>$(null),onNavigateToHistory:()=>_e("video")},D);case ae.SMART_BRIEFING:return s.jsx(eA,{isAuthenticated:t,requireAuth:ie,setPendingAction:k,onNavigateToSimulator:z=>{console.log("[APP] Navigating to simulator from Smart Briefing with variables:",z),o(ae.SIMULATOR)},onNavigateToHistory:()=>_e("briefings")});case ae.GYM:case ae.GYM_KLASSIKER:return s.jsx(AN,{onStartGame:$e,isAuthenticated:t,requireAuth:ie,setPendingAction:k});case ae.GYM_SESSION:return s.jsx(zN,{gameConfig:b,onBack:Ne,onComplete:je});case ae.HISTORY:return s.jsx(S_,{onBack:ce,onSelectSession:Le,isAuthenticated:t,onLoginClick:w,onContinueSession:Gt,onRepeatSession:te,initialTab:y,onNavigateToModule:re});case ae.USAGE_LIMITS:return s.jsx("div",{style:{padding:"24px",maxWidth:"600px",margin:"0 auto"},children:s.jsx(tA,{onNavigateToRoleplay:()=>o(ae.DASHBOARD)})});case ae.SESSION_DETAIL:return s.jsx(nN,{session:p,onBack:ot});case ae.DASHBOARD:return s.jsx(CT,{onSelectScenario:U,onOpenHistory:bt,isAuthenticated:t,requireAuth:ie,setPendingAction:k,pendingScenario:T,clearPendingScenario:()=>N(null),onNavigateToHistory:()=>_e("roleplay")});case ae.OVERVIEW:return s.jsx(Ai,{onNavigate:re});case ae.ADMIN:return i?s.jsx("div",{style:{padding:"24px"},children:s.jsx(uA,{onNavigate:re})}):s.jsx(Ai,{onNavigate:re});case ae.ADMIN_ROLEPLAYS:return i?s.jsx("div",{style:{padding:"24px"},children:s.jsx(hA,{onBack:()=>o(ae.ADMIN)})}):s.jsx(Ai,{onNavigate:re});case ae.ADMIN_SIMULATOR:return i?s.jsx("div",{style:{padding:"24px"},children:s.jsx(pA,{onBack:()=>o(ae.ADMIN)})}):s.jsx(Ai,{onNavigate:re});case ae.ADMIN_VIDEO:return i?s.jsx("div",{style:{padding:"24px"},children:s.jsx(fA,{onBack:()=>o(ae.ADMIN)})}):s.jsx(Ai,{onNavigate:re});case ae.ADMIN_PARTNERS:return i?s.jsx("div",{style:{padding:"24px"},children:s.jsx(yA,{onBack:()=>o(ae.ADMIN)})}):s.jsx(Ai,{onNavigate:re});default:return s.jsx(Ai,{onNavigate:re})}};return s.jsxs(s.Fragment,{children:[s.jsx(aA,{activeView:r,onNavigate:re,headerOffset:a,onLoginClick:w,children:_t()}),s.jsx(dA,{isOpen:C,onClose:()=>{v(),k(null)},onLoginSuccess:z=>{console.log(" [APP] User logged in:",z.displayName),E&&(console.log(" [APP] Executing pending action after login:",E.type),G(E),k(null))}})]})}function jA(){return s.jsx(Yy,{children:s.jsx(sA,{children:s.jsx(CA,{})})})}console.log(" [MAIN] Script loaded - starting initialization");let vl=!1,Sl=null;function TA(){if(vl){console.log(" Bewerbungstrainer: App already mounted, skipping...");return}const t=document.getElementById("bewerbungstrainer-app")||document.getElementById("root");if(!t){console.error(" Bewerbungstrainer: Root element not found! Looking for #bewerbungstrainer-app or #root");return}if(t._reactRootContainer||t.__reactRoot||Sl){console.warn(" Bewerbungstrainer: Root element already has a React root, skipping re-mount..."),vl=!0;return}try{for(console.log(" Bewerbungstrainer: Mounting React app on:",t.id);t.firstChild;)t.removeChild(t.firstChild);Sl=Jy.createRoot(t),Sl.render(s.jsx(g.StrictMode,{children:s.jsx(jA,{})})),vl=!0,console.log(" Bewerbungstrainer: React app mounted successfully")}catch(e){console.error(" Bewerbungstrainer: Failed to mount React app:",e)}}function EA(){const t=()=>{requestAnimationFrame(()=>{try{TA()}catch(e){console.error(" Bewerbungstrainer: Error during mount:",e)}})};if(document.getElementById("bewerbungstrainer-app")||document.getElementById("root")){console.log(" Bewerbungstrainer: Element found immediately, scheduling mount..."),setTimeout(t,50);return}if(document.readyState==="loading")console.log(" Bewerbungstrainer: Waiting for DOMContentLoaded..."),document.addEventListener("DOMContentLoaded",()=>setTimeout(t,50));else{console.log(" Bewerbungstrainer: DOM loaded, waiting for element...");let e=0;const n=50,i=setInterval(()=>{e++,document.getElementById("bewerbungstrainer-app")||document.getElementById("root")?(clearInterval(i),console.log(` Bewerbungstrainer: Element found after ${e*100}ms`),setTimeout(t,50)):e>=n&&(clearInterval(i),console.error(" Bewerbungstrainer: Element not found after 5 seconds"))},100)}}EA();
