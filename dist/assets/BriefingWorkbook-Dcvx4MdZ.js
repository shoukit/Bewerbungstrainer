import{F as G,Q as ie,aE as ee,s as je,aF as we,aG as ye,aH as Ne,aI as ve,aJ as ke,t as Ce,L as B,u as Se,T as ze,I as _e,X as le,b as oe,aK as Ee,ah as q,Y as D,aL as Pe,aM as Ae,aN as Be,aO as Ie,g as Le,aP as $e,P as Me,aQ as De,M as Fe,ad as Te,ag as Oe,Z as Ue,aR as Re,aS as Ge,aT as He,i as qe,aU as Je,J as Ke,aA as ce,E as Ve,a3 as We,a8 as Qe,e as Ze,V as Ye,a as te,_ as de,R as me,c as Xe,S as et,z as xe,a2 as tt,ax as st,ay as nt,a1 as at,l as rt,at as he,x as it,U as ue,am as pe,r as ge,j as e,w as ae,$ as lt,y as se,C as ne,A as be,m as X,aV as ot,aW as ct,aC as dt,a0 as mt,h as xt}from"./ui-vendor-4RzMPcHM.js";import{a as l}from"./react-vendor-uDOJF2jQ.js";import{u as ht,w as M,n as ut}from"./FeatureInfoButton-DkKoIptM.js";import{u as pt}from"./useMobile-YxjH166V.js";import{C as K,B as R}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const gt={"file-text":G,briefcase:ge,banknote:pe,users:ue,user:it,"message-circle":he,target:rt,award:at,book:nt,clipboard:st,star:tt,lightbulb:xe,shield:et,compass:Xe,rocket:me,calendar:de,sparkles:te,video:Ye,mic:Ze,play:Qe,"check-circle":We,"alert-circle":Ve,"help-circle":ce,settings:Ke,home:Je,"trending-up":qe,"bar-chart":He,"pie-chart":Ge,activity:Re,zap:Ue,heart:Oe,"thumbs-up":Te,"message-square":Fe,mail:De,phone:Me,"map-pin":$e,clock:Le,bell:Ie,search:Be,filter:Ae,edit:Pe,trash:D,plus:q,minus:Ee,check:oe,x:le,info:_e,warning:ze,refresh:Se,loader:B,globe:Ce,link:ke,bookmark:ve,tag:Ne,code:ye,database:we,server:je,pen:ee,bot:ie},bt={"file-text":G,briefcase:ge,banknote:pe,users:ue},ft=(t,n=G)=>gt[t]||n,Lt=t=>bt[t]||G,jt=t=>{if(!t)return[];const n=t.split(`
`),i=[];for(const d of n){const o=d.trim();if(!o)continue;let s=null;const h=o.match(/^[\*\-â€¢]\s+(.+)$/);h&&(s=h[1].trim());const m=o.match(/^\d+[\.\)]\s+(.+)$/);!s&&m&&(s=m[1].trim());const g=o.match(/^\*\*([^*]+)\*\*:?\s*(.+)$/);if(!s&&g&&(s=o),s){const u=s.match(/^\*\*([^*]+)\*\*:?\s*(.*)$/);if(u&&u[1]){const b=u[1].trim(),C=u[2]?.trim()||"";i.push({id:`ap-${i.length}`,label:b,content:C})}else{const b=s.replace(/\*\*/g,"").replace(/\*/g,""),S=b.split(/\s+/).slice(0,4).join(" ");i.push({id:`ap-${i.length}`,label:S.length>40?S.substring(0,40)+"...":S,content:b})}}}return i},wt={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},yt=t=>wt[t]||t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),J=t=>{if(!t)return null;const n=[];let i=t,d=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),s=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),h=i.match(/`([^`]+)`/),m=[{match:o,type:"bold"},{match:s,type:"italic"},{match:h,type:"code"}].filter(u=>u.match);if(m.length===0){n.push(i);break}const g=m.reduce((u,b)=>(u.match?.index??1/0)<(b.match?.index??1/0)?u:b);switch(g.match.index>0&&n.push(i.substring(0,g.match.index)),g.type){case"bold":n.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:g.match[1]},d++));break;case"italic":n.push(e.jsx("em",{className:"italic",children:g.match[1]||g.match[2]},d++));break;case"code":n.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:g.match[1]},d++));break}i=i.substring(g.match.index+g.match[0].length)}return n},fe=({content:t})=>{if(!t)return null;const n=i=>{const d=i.split(`
`),o=[];let s=[],h=null;const m=()=>{s.length>0&&(o.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:s.map((g,u)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:h==="number"?`${u+1}.`:"â€¢"}),J(g)]},u))},`list-${o.length}`)),s=[],h=null)};return d.forEach((g,u)=>{const b=g.trim();if(!b){m();return}if(b.startsWith("- ")||b.startsWith("* ")){h!=="bullet"&&(m(),h="bullet"),s.push(b.substring(2));return}const C=b.match(/^(\d+)\.\s/);if(C){h!=="number"&&(m(),h="number"),s.push(b.substring(C[0].length));return}m(),o.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:J(b)},`p-${u}`))}),m(),o};return e.jsx("div",{children:n(t)})},Nt=({item:t,onRestore:n})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:t.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(mt,{size:12}),"Wiederherstellen"]})]}),vt=({explanation:t,onDelete:n,onAddAsItem:i,onAddActionPoint:d,itemLabel:o})=>{const[s,h]=l.useState(!0),[m,g]=l.useState(new Set),u=jt(t.answer),b=u.filter(p=>!m.has(p.id)),C=p=>{d(p),g(_=>new Set([..._,p.id]))},S=()=>{if(t.quick_action)switch(t.quick_action){case"explain":return"ðŸ’¡ ErklÃ¤rung";case"examples":return"ðŸ“ Beispiele";case"howto":return"ðŸš€ Umsetzung";default:return"Frage"}return`â“ ${t.question}`},E=t.answer?.length>100?t.answer.substring(0,100)+"...":t.answer;return e.jsxs("div",{className:"bg-white rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>h(!s),className:"w-full px-3 py-2.5 bg-transparent border-none cursor-pointer flex items-center gap-2 text-left hover:bg-amber-50/50 transition-colors",children:[e.jsx(xt,{size:14,className:`text-amber-600 transition-transform flex-shrink-0 ${s?"rotate-90":""}`}),e.jsx("span",{className:"text-[12px] font-medium text-amber-700 flex-1 truncate",children:S()}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:p=>p.stopPropagation(),children:[i&&e.jsx("button",{onClick:p=>{p.stopPropagation(),i(t.answer,o)},title:"Gesamten Block als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(q,{size:14})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),n(t.id)},title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(le,{size:14})})]})]}),!s&&e.jsx("div",{className:"px-3 pb-2.5 pt-0",children:e.jsx("p",{className:"text-[12px] text-slate-500 m-0 line-clamp-2",children:E})}),e.jsx(be,{children:s&&e.jsx(X.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 border-t border-amber-100",children:[e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap mt-2.5 leading-relaxed",children:J(t.answer)}),u.length>0&&d&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-100",children:[e.jsxs("p",{className:"text-[11px] font-medium text-amber-700 mb-2 flex items-center gap-1",children:[e.jsx(q,{size:12}),"Einzelne Punkte hinzufÃ¼gen:",m.size>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",m.size," hinzugefÃ¼gt)"]})]}),b.length>0?e.jsx("div",{className:"space-y-2",children:b.map(p=>e.jsx("div",{className:"p-2.5 bg-white rounded-xl border border-amber-100 hover:border-amber-200 hover:shadow-sm transition-all group",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 flex-shrink-0 mt-1.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"text-[13px] font-semibold text-slate-800 m-0 mb-0.5 leading-snug",children:p.label}),p.content&&e.jsx("p",{className:"text-[12px] text-slate-600 m-0 leading-snug",children:p.content.length>150?p.content.substring(0,150)+"...":p.content})]}),e.jsx("button",{onClick:()=>C(p),title:"Diesen Punkt zur Liste hinzufÃ¼gen",className:"p-1.5 rounded-lg bg-transparent border-none text-amber-600 cursor-pointer hover:text-white hover:bg-indigo-500 transition-all opacity-60 group-hover:opacity-100 flex-shrink-0",children:e.jsx(q,{size:14})})]})},p.id))}):e.jsx("p",{className:"text-[12px] text-green-600 italic m-0",children:"âœ“ Alle Punkte wurden hinzugefÃ¼gt"})]})]})})})]})},re=({item:t,sectionId:n,onUpdateItem:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:h})=>{const[m,g]=l.useState(t.user_note||""),[u,b]=l.useState(!1),[C,S]=l.useState(!1),[E,p]=l.useState(!1),[_,P]=l.useState(!!t.user_note),[z,I]=l.useState(!1),[x,F]=l.useState(""),[k,$]=l.useState(!1),[T,O]=l.useState(!0),L=t.ai_explanations||[];l.useEffect(()=>{p(m!==(t.user_note||""))},[m,t.user_note]);const V=async()=>{b(!0);try{await i(n,t.id,{user_note:m}),S(!0),p(!1),setTimeout(()=>S(!1),2e3)}catch(j){console.error("Error saving note:",j)}finally{b(!1)}},W=async()=>{try{await i(n,t.id,{deleted:!0})}catch(j){console.error("Error deleting item:",j)}},Q=async()=>{try{await i(n,t.id,{deleted:!1})}catch(j){console.error("Error restoring item:",j)}},U=async j=>{if(d){$(!0);try{await d(n,t.id,{quick_action:j}),O(!0)}catch(a){console.error("Error asking AI:",a)}finally{$(!1)}}},H=async()=>{if(!(!d||!x.trim())){$(!0);try{await d(n,t.id,{question:x.trim()}),F(""),O(!0)}catch(j){console.error("Error asking AI:",j)}finally{$(!1)}}},Z=async j=>{if(o)try{await o(n,t.id,j)}catch(a){console.error("Error deleting explanation:",a)}};return t.deleted?e.jsx(Nt,{item:t,onRestore:Q}):e.jsxs(K,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:t.label})]}),t.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:J(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[L.length>0&&!z&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[L.length," KI"]}),t.user_note&&!_&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{I(!z),z||P(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${z?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:()=>{P(!_),_||I(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${_?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:W,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(D,{size:16})})]})]}),z&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>U("explain"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ce,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>U("examples"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ot,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>U("howto"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(me,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:j=>F(j.target.value),onKeyDown:j=>j.key==="Enter"&&!k&&H(),placeholder:"Oder stelle eine eigene Frage...",disabled:k,className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx(R,{variant:"primary",size:"sm",onClick:H,disabled:k||!x.trim(),icon:k?e.jsx(B,{size:14,className:"animate-spin"}):e.jsx(ct,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),k&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(B,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),L.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>O(!T),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[T?e.jsx(se,{size:14}):e.jsx(ne,{size:14}),"KI-ErklÃ¤rungen (",L.length,")"]}),T&&e.jsx("div",{className:"space-y-2",children:L.map(j=>e.jsx(vt,{explanation:j,itemLabel:t.label,onDelete:Z,onAddAsItem:s?(a,r)=>s(n,a,r):null,onAddActionPoint:h?a=>h(n,a,t.label):null},j.id))})]})]}),_&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:m,onChange:j=>g(j.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(R,{variant:"secondary",size:"sm",onClick:()=>{P(!1),g(t.user_note||"")},children:"Abbrechen"}),e.jsx(R,{variant:C?"secondary":"primary",size:"sm",onClick:V,disabled:u||!E,icon:u?e.jsx(B,{size:12,className:"animate-spin"}):C?e.jsx(oe,{size:12}):e.jsx(dt,{size:12}),className:C?"bg-green-100 text-green-700 border-green-200":"",children:C?"Gespeichert!":"Speichern"})]})]})]})},kt=({onClick:t,isGenerating:n})=>e.jsx("button",{onClick:t,disabled:n,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{size:16}),"5 weitere Punkte generieren"]})}),Ct=({section:t,onUpdateItem:n,onGenerateMore:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:h,isExpanded:m,onToggle:g})=>{const[u,b]=l.useState(!1),C=async()=>{b(!0);try{await i(t.id)}catch(x){console.error("Error generating more items:",x)}finally{b(!1)}},S=l.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const x=JSON.parse(t.ai_content);if(x&&Array.isArray(x.items))return{type:"items",items:x.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:E,items:p,content:_}=S(),P=p.filter(x=>!x.deleted),z=p.filter(x=>x.deleted),I=p.some(x=>x.user_note&&!x.deleted);return e.jsxs(K,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:g,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${m?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:t.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[E==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[P.length," Punkte"]}),I&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(ee,{size:12}),"Notizen"]}),m?e.jsx(se,{size:20,className:"text-slate-400"}):e.jsx(ne,{size:20,className:"text-slate-400"})]})]}),m&&e.jsx("div",{className:"px-5 py-4",children:E==="items"?e.jsxs(e.Fragment,{children:[P.map(x=>e.jsx(re,{item:x,sectionId:t.id,onUpdateItem:n,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:h},x.id)),i&&e.jsx(kt,{onClick:C,isGenerating:u}),z.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(D,{size:12}),z.length," gelÃ¶schte ",z.length===1?"Punkt":"Punkte"]}),z.map(x=>e.jsx(re,{item:x,sectionId:t.id,onUpdateItem:n,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:h},x.id))]})]}):E==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ie,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(fe,{content:_})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},Y=({onClick:t,disabled:n,loading:i,icon:d,danger:o,title:s})=>e.jsx("button",{onClick:t,disabled:n,title:s,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${o?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:i?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(d,{size:16})}),St=({variables:t,isExpanded:n,onToggle:i})=>!t||Object.keys(t).length===0?null:e.jsxs(K,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:i,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(t).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:n?"Einklappen":"Ausklappen"}),n?e.jsx(se,{size:16}):e.jsx(ne,{size:16})]})]}),n&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(t).map(([d,o])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[yt(d),":"]})," ",o]},d))})]}),zt=({isOpen:t,onClose:n,onConfirm:i,isDeleting:d})=>e.jsx(be,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(X.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(R,{variant:"secondary",onClick:n,disabled:d,fullWidth:!0,children:"Abbrechen"}),e.jsx(R,{variant:"danger",onClick:i,disabled:d,icon:d?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(D,{size:16}),fullWidth:!0,children:d?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),$t=({briefing:t,onBack:n,onDelete:i})=>{const{config:d}=ht(),o=pt(),[s,h]=l.useState(t),[m,g]=l.useState(!t?.sections),[u,b]=l.useState(null),[C,S]=l.useState({}),[E,p]=l.useState(!1),[_,P]=l.useState(!1),[z,I]=l.useState(!1),[x,F]=l.useState(!1),[k,$]=l.useState(!1);l.useRef(null);const T=ft(s?.template_icon)||G;l.useEffect(()=>{const a=()=>{const r=window.scrollY||document.documentElement.scrollTop;$(r>80)};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),l.useEffect(()=>{const a=async()=>{if(s?.sections){const r={};s.sections.forEach(y=>{r[y.id]=!0}),S(r),g(!1);return}try{g(!0);const r=await M.request(`/smartbriefing/briefings/${s.id}`,{method:"GET"});if(r.success&&r.data?.briefing){h(r.data.briefing);const y={};r.data.briefing.sections?.forEach(v=>{y[v.id]=!0}),S(y)}else throw new Error("Fehler beim Laden des Briefings")}catch(r){console.error("[SmartBriefing] Error fetching briefing:",r),b(r.message)}finally{g(!1)}};s?.id&&a()},[s?.id]);const O=l.useCallback(a=>{S(r=>({...r,[a]:!r[a]}))},[]),L=l.useCallback(async(a,r,y)=>{const v=await M.request(`/smartbriefing/sections/${a}/items/${r}`,{method:"PATCH",body:JSON.stringify(y)});if(!v.success)throw new Error("Fehler beim Speichern");h(N=>({...N,sections:N.sections.map(f=>f.id===a?v.data.section:f)}))},[]),V=l.useCallback(async a=>{const r=await M.request(`/smartbriefing/sections/${a}/generate-more`,{method:"POST"});if(!r.success)throw new Error(r.message||"Fehler beim Generieren");return h(y=>({...y,sections:y.sections.map(v=>v.id===a?r.data.section:v)})),r.data.new_items_count},[]),W=l.useCallback(async(a,r,y)=>{const v=await M.askBriefingItem(a,r,y);return h(N=>({...N,sections:N.sections.map(f=>{if(f.id!==a)return f;let c;try{c=typeof f.ai_content=="string"?JSON.parse(f.ai_content):f.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),f}if(!c?.items)return f;const w=c.items.map(A=>A.id===r?v.item:A);return{...f,ai_content:JSON.stringify({...c,items:w})}})})),v},[]),Q=l.useCallback(async(a,r,y)=>{await M.deleteBriefingItemExplanation(a,r,y),h(v=>({...v,sections:v.sections.map(N=>{if(N.id!==a)return N;let f;try{f=typeof N.ai_content=="string"?JSON.parse(N.ai_content):N.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),N}if(!f?.items)return N;const c=f.items.map(w=>w.id!==r?w:{...w,ai_explanations:(w.ai_explanations||[]).filter(A=>A.id!==y)});return{...N,ai_content:JSON.stringify({...f,items:c})}})}))},[]),U=l.useCallback(async(a,r,y)=>{const v=`Vertiefung: ${y}`,N=r.length>200?r.substring(0,200)+"...":r;h(f=>({...f,sections:f.sections.map(c=>{if(c.id!==a)return c;let w;try{w=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),c}if(!w?.items)return c;const A={id:crypto.randomUUID(),label:v,content:N,user_note:`VollstÃ¤ndige KI-Antwort:

${r}`,deleted:!1,ai_explanations:[]};return{...c,ai_content:JSON.stringify({...w,items:[...w.items,A]})}})}))},[]),H=l.useCallback((a,r,y)=>{const v=r.label||"Neuer Punkt",N=r.content||r.label||"";h(f=>({...f,sections:f.sections.map(c=>{if(c.id!==a)return c;let w;try{w=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),c}if(!w?.items)return c;const A={id:crypto.randomUUID(),label:v,content:N,user_note:"",deleted:!1,ai_explanations:[]};return{...c,ai_content:JSON.stringify({...w,items:[...w.items,A]})}})}))},[]),Z=l.useCallback(async()=>{if(!(x||!s?.id)){F(!0);try{const a=await M.request(`/smartbriefing/briefings/${s.id}/pdf`,{method:"GET"});if(!a.success||!a.data?.pdf_base64)throw new Error(a.message||"PDF-Export fehlgeschlagen");const r=atob(a.data.pdf_base64),y=new Array(r.length);for(let w=0;w<r.length;w++)y[w]=r.charCodeAt(w);const v=new Uint8Array(y),N=new Blob([v],{type:"application/pdf"}),f=window.URL.createObjectURL(N),c=document.createElement("a");c.href=f,c.download=a.data.filename||"Smart-Briefing.pdf",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(f)}catch(a){console.error("[SmartBriefing] PDF download error:",a)}finally{F(!1)}}},[s?.id,x]),j=async()=>{if(!(!i||!s?.id)){I(!0);try{await i(s)}catch(a){console.error("Failed to delete briefing:",a)}finally{I(!1),P(!1)}}};return s?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`sticky top-0 z-40 transition-all duration-300 ease-out ${k?o?"py-2":"py-2.5":o?"py-5":"py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:`max-w-[1400px] mx-auto ${o?"px-4":"px-8"}`,children:[n&&e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${k?"max-h-0 opacity-0 mb-0":"max-h-12 opacity-100 mb-4"}`,children:e.jsxs("button",{onClick:n,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(ae,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]})}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[!o&&e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-out ${k?"w-10 h-10":"w-[90px] h-[90px]"}`,children:e.jsx(T,{size:k?20:40,className:"text-white transition-all duration-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${k?"max-h-0 opacity-0 mb-0":"max-h-10 opacity-100 mb-2"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:s.template_title})]})}),e.jsx("h1",{className:`font-bold text-white m-0 truncate transition-all duration-300 ease-out ${k?"text-base md:text-lg mb-0":o?"text-xl mb-2":"text-2xl mb-2"}`,children:s.title||"Briefing"}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${k?"max-h-0 opacity-0":"max-h-8 opacity-100"}`,children:e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(de,{size:14}),ut(s.created_at)]})})})]}),e.jsxs("div",{className:"flex gap-2 md:gap-2.5 flex-shrink-0",children:[n&&k&&e.jsx(Y,{onClick:n,icon:ae,title:"ZurÃ¼ck zur Ãœbersicht"}),e.jsx(Y,{onClick:Z,disabled:x,loading:x,icon:lt,title:"Als PDF herunterladen"}),i&&e.jsx(Y,{onClick:()=>P(!0),icon:D,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${o?"p-4":"px-8 py-6"}`,children:[e.jsx(St,{variables:s.variables,isExpanded:E,onToggle:()=>p(!E)}),m&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(B,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),u&&!m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:u})}),!m&&!u&&s.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[s.sections.length," Abschnitte"]})]}),s.sections.map(a=>e.jsx(Ct,{section:a,onUpdateItem:L,onGenerateMore:V,onAskItem:W,onDeleteExplanation:Q,onAddAsItem:U,onAddActionPoint:H,isExpanded:C[a.id],onToggle:()=>O(a.id)},a.id))]}),!m&&!u&&(!s.sections||s.sections.length===0)&&s.content_markdown&&e.jsx(K,{className:"p-6",children:e.jsx(fe,{content:s.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(zt,{isOpen:_,onClose:()=>P(!1),onConfirm:j,isDeleting:z})]}):null};export{$t as B,ft as a,Lt as g};
