import{j as e,L as Ke,I as le,a1 as oe,T as cs,z as Z,X as fe,V as T,l as ye,ap as ds,R as ms,B as Ue,w as J,i as xs,g as Y,a as Ge,ak as us,e as Qe,aj as hs,v as He,y as V,f as ps,E as be,M as Ne,ao as gs,aq as Ve,q as _e,h as je,b as Fe,m as I,ar as fs,t as Xe,A as Ze,al as bs,a0 as Je,a8 as Be,a9 as js,C as vs}from"./ui-vendor-BPmrRjpn.js";import{a}from"./react-vendor-uDOJF2jQ.js";import{C as p,k as ys,F as Ns,g as we,a as X,u as Se,l as ws,m as Ye}from"./FeatureInfoButton-C-pllNNf.js";import{S as Ss}from"./ScenarioDashboard-DIOmgkYn.js";import{B as ve}from"./button-BoRGn9H8.js";import{I as ge}from"./input-Dg8SXIdV.js";import{T as ks}from"./textarea-D_5UFHp6.js";import{C as ie,B as H}from"./select-native-DRUSZasO.js";import"./dialog-ClMCq6FL.js";import{D as Cs}from"./DeviceSetupPage-CC-lJTFm.js";import{F as As}from"./fullscreen-loader-BGmBgq-B.js";import{u as Is}from"./useMobile-YxjH166V.js";import{D as Es}from"./DeviceSettingsDialog-oL48EOzx.js";import{A as Me}from"./MicrophoneTestDialog-BMYyyjuu.js";import{P as zs}from"./progress-bar-DvpIpQeJ.js";import{u as Ts}from"./Confetti-DHj-sAKj.js";const Pe={error:{bg:p.red[50],border:p.red[200],text:p.red[600],icon:Z},warning:{bg:p.amber[50],border:p.amber[200],text:p.amber[600],icon:cs},success:{bg:p.green[50],border:p.green[200],text:p.green[600],icon:oe},info:{bg:p.blue[50],border:p.blue[200],text:p.blue[500],icon:le},loading:{bg:p.blue[50],border:p.blue[200],text:p.blue[500],icon:Ke}},Ds=({variant:s="info",message:t,children:n,isToast:o=!1,onDismiss:h,className:d="",style:g={}})=>{const i=Pe[s]||Pe.info,r=i.icon,f=s==="loading";return e.jsxs("div",{className:`flex items-center gap-3 py-3 px-4 rounded-xl text-sm font-medium ${o?"fixed bottom-6 left-1/2 -translate-x-1/2 shadow-lg z-[1000] max-w-[90%]":""} ${d}`,style:{backgroundColor:i.bg,border:`1px solid ${i.border}`,color:i.text,...g},children:[e.jsx(r,{size:20,className:`flex-shrink-0 ${f?"animate-spin":""}`}),e.jsx("span",{className:"flex-1",children:n||t}),h&&e.jsx("button",{onClick:h,className:"bg-transparent border-none p-1 cursor-pointer flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity",style:{color:i.text},"aria-label":"Schließen",children:e.jsx(fe,{size:16})})]})},Rs=({message:s,onDismiss:t,...n})=>e.jsx(Ds,{variant:"error",message:s,isToast:!0,onDismiss:t,...n}),Vs={video:T,user:J,briefcase:Ue,presentation:hs,mic:Qe,target:ye,banknote:us},_s={self_presentation:{label:"Selbstpräsentation",icon:J,color:p.indigo[500],bgColor:p.indigo[50]},interview:{label:"Bewerbungsgespräch",icon:Ue,color:p.emerald[600],bgColor:p.emerald[100]},pitch:{label:"Elevator Pitch",icon:ms,color:p.violet[600],bgColor:p.violet[100]},negotiation:{label:"Verhandlung",icon:ds,color:p.amber[600],bgColor:p.amber[100]},custom:{label:"Training",icon:ye,color:p.slate[500],bgColor:p.slate[100]}},Fs=async()=>{const s=await fetch(`${we()}/video-training/scenarios`,{headers:{"X-WP-Nonce":X()}});if(!s.ok)throw new Error("Fehler beim Laden der Szenarien");const t=await s.json();if(t.success&&t.data?.scenarios)return t.data.scenarios;throw new Error("Ungültige Antwort vom Server")},Bs=s=>Vs[s.icon]||T,Ms=s=>[{text:`${s.question_count} Fragen`},{icon:Y,text:`~${Math.round(s.total_time_limit/60)} Min.`}],Ps=()=>e.jsx("div",{className:"mt-10 p-5 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed m-0",children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Oe=({onSelectScenario:s,isAuthenticated:t,requireAuth:n,setPendingScenario:o,onNavigateToHistory:h})=>e.jsxs(e.Fragment,{children:[e.jsx(ys,{featureId:"videotraining",showOnMount:!0}),e.jsx(Ss,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:T,headerActions:e.jsx(Ns,{featureId:"videotraining",size:"sm"}),fetchScenarios:Fs,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:h,onSelectScenario:s,renderCardMeta:Ms,getIconForScenario:Bs,cardActionLabel:"Starten",cardActionIcon:xs,categoryField:"scenario_type",customCategoryConfig:_s,emptyStateIcon:T,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:Ps,isAuthenticated:t,requireAuth:n,setPendingScenario:o,loadingMessage:"Szenarien werden geladen..."})]}),Os=s=>s?s.split(/(\*\*.*?\*\*)/g).map((n,o)=>n.startsWith("**")&&n.endsWith("**")?e.jsx("strong",{children:n.slice(2,-2)},o):n):null,$e={target:ye,clock:Y,mic:Qe,camera:gs,video:T,"message-square":Ne,lightbulb:V,brain:V,info:le,settings:be,check:oe,sparkles:Ge,user:J,x:Z},$s=[{icon:"camera",text:"Schaue direkt in die Kamera für Augenkontakt."},{icon:"lightbulb",text:"Achte auf gute Beleuchtung von vorne."},{icon:"target",text:"Struktur: Wer → Was → Warum."},{icon:"mic",text:"Sprich deutlich und in ruhigem Tempo."}],Ls=({field:s,value:t,onChange:n,error:o,focusColor:h})=>{const d=i=>{setTimeout(()=>{const r=i.target;if(r){const f=r.closest("div");f&&f.scrollIntoView({behavior:"smooth",block:"center"})}},300)},g=()=>{const i=o?"border-red-500":"";switch(s.type){case"text":return e.jsx(ge,{type:"text",value:t||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",className:i,onFocus:d});case"textarea":return e.jsx(ks,{value:t||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",rows:4,className:`${i} min-h-[100px] resize-y`,onFocus:d});case"select":return e.jsxs("select",{value:t||s.default||"",onChange:r=>n(s.key,r.target.value),className:`w-full px-4 py-3 rounded-xl border-2 text-base text-slate-900 bg-white outline-none transition-all cursor-pointer appearance-none bg-[url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%236b7280%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e')] bg-[position:right_12px_center] bg-no-repeat bg-[length:20px] pr-11 focus:border-primary focus:ring-2 focus:ring-primary/20 ${o?"border-red-500":"border-slate-200"}`,onFocus:d,children:[!s.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),s.options?.slice().sort((r,f)=>r.label.localeCompare(f.label,"de")).map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"number":return e.jsx(ge,{type:"number",value:t||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",min:s.validation?.min,max:s.validation?.max,className:i,onFocus:d});default:return e.jsx(ge,{type:"text",value:t||"",onChange:r=>n(s.key,r.target.value),placeholder:s.placeholder||"",className:i,onFocus:d})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[s.label,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),g(),o&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-red-500 flex items-center gap-1",children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),o]}),s.hint&&!o&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-slate-500 flex items-center gap-1",children:[e.jsx(le,{className:"w-3.5 h-3.5"}),s.hint]})]})},Ws=({scenario:s,onBack:t,onNext:n})=>{const[o,h]=a.useState({}),[d,g]=a.useState({}),i=a.useMemo(()=>{if(!s?.input_configuration)return[];try{return(Array.isArray(s.input_configuration)?s.input_configuration:[]).filter(l=>l.user_input!==!1)}catch(c){return console.error("Error parsing input_configuration:",c),[]}},[s?.input_configuration]);a.useEffect(()=>{const c={};i.forEach(l=>{l.default&&(c[l.key]=l.default)}),h(c)},[i]);const r=(c,l)=>{h(m=>({...m,[c]:l})),d[c]&&g(m=>{const j={...m};return delete j[c],j})},f=()=>{const c={};return i.forEach(l=>{const m=o[l.key];if(l.required&&(!m||typeof m=="string"&&m.trim()==="")){c[l.key]="Dieses Feld ist erforderlich";return}if(!(!m||typeof m=="string"&&m.trim()==="")&&l.validation){const{minLength:j,maxLength:C,min:A,max:z,pattern:N}=l.validation;j&&m.length<j&&(c[l.key]=`Mindestens ${j} Zeichen erforderlich`),C&&m.length>C&&(c[l.key]=`Maximal ${C} Zeichen erlaubt`),A!==void 0&&Number(m)<A&&(c[l.key]=`Mindestens ${A}`),z!==void 0&&Number(m)>z&&(c[l.key]=`Maximal ${z}`),N&&!new RegExp(N).test(m)&&(c[l.key]="Ungültiges Format")}}),g(c),Object.keys(c).length===0},x=c=>{c.preventDefault(),f()&&n(o)};if(a.useEffect(()=>{i.length===0&&n({})},[i,n]),i.length===0)return null;const v=s?.tips&&Array.isArray(s.tips)&&s.tips.length>0?s.tips:$s;return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(He,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(V,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold text-slate-900 m-0",children:"Vorbereitung"}),e.jsx("p",{className:"text-base text-slate-500 m-0 mt-1",children:s?.title})]})]})]}),s?.long_description&&e.jsx(ie,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:Os(s.long_description)})]})]})}),e.jsxs(ie,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Dein Profil"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Personalisiere dein Training"})]})]}),e.jsx("form",{onSubmit:x,id:"variables-form",children:i.map(c=>e.jsx(Ls,{field:c,value:o[c.key],onChange:r,error:d[c.key]},c.key))})]}),e.jsxs(ve,{type:"submit",form:"variables-form",size:"lg",className:"w-full mb-6 gap-2.5",children:["Weiter",e.jsx(ps,{className:"w-5 h-5"})]}),v.length>0&&e.jsxs(ie,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps für dein Training"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise für optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:v.map((c,l)=>{const m=$e[c.icon]||$e[c.icon?.toLowerCase()]||V;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(m,{className:"w-4 h-4 text-slate-600"})}),e.jsx("p",{className:"text-sm text-slate-700 m-0 pt-1",children:c.text||c.description})]},l)})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:16}),e.jsxs("span",{children:[s?.question_count||5," Fragen"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16}),e.jsxs("span",{children:["~",Math.ceil((s?.question_count||5)*(s?.time_limit_per_question||90)/60)," Min."]})]})]})]})},qs=()=>{const[s,t]=a.useState(!1),[n,o]=a.useState(null),{demoCode:h}=Se(),d=a.useCallback(async(i,r,f)=>{o(null),t(!0);try{const x=await i();r(x)}catch(x){console.error("[useSessionStartup] Error:",x);const v=x.message||"Ein Fehler ist aufgetreten";o(v),t(!1),f?.(x)}},[]),g=a.useCallback(()=>{o(null)},[]);return{isSubmitting:s,submitError:n,demoCode:h,startSession:d,clearError:g}},Ks=({scenario:s,variables:t,onBack:n,onStart:o})=>{const{isSubmitting:h,submitError:d,demoCode:g,startSession:i,clearError:r}=qs(),f=async({selectedMicrophoneId:x,selectedCameraId:v})=>{await i(async()=>{const c=we(),l=await fetch(`${c}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()},body:JSON.stringify({scenario_id:s.id,variables:t,demo_code:g||null})});if(!l.ok){const N=await l.json().catch(()=>({}));throw new Error(N.message||"Fehler beim Erstellen der Session")}const m=await l.json(),j=m.data?.session||m.session;if(!j)throw new Error("Keine Session-ID erhalten");const C=await fetch(`${c}/video-training/sessions/${j.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()},body:JSON.stringify({variables:t})});if(!C.ok){const N=await C.json().catch(()=>({}));throw new Error(N.message||"Fehler beim Generieren der Fragen")}const A=await C.json(),z=A.data?.questions||A.questions||[];return{session:{...j,questions:z},questions:z,scenario:s,variables:t,selectedMicrophoneId:x,selectedCameraId:v}},o)};return e.jsxs(e.Fragment,{children:[e.jsx(Cs,{mode:"audio-video",scenario:s,onBack:n,onStart:f,title:s?.title,startButtonLabel:"Video-Training starten",icon:T}),d&&e.jsx(Rs,{message:d,onDismiss:r}),e.jsx(As,{isLoading:h,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},Us=({tips:s,primaryAccent:t})=>{const[n,o]=a.useState(!1);return!s||s.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>o(!n),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(V,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(je,{size:18,className:`text-slate-500 transition-transform duration-200 ${n?"rotate-90":""}`})]}),e.jsx(Ze,{children:n&&e.jsx(I.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:s.map((h,d)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:h},d))})})})})]})},Gs=({number:s,size:t="md"})=>{const n={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${n[t]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:s})},Le=({question:s,index:t,scenario:n,isMobile:o})=>e.jsxs(ie,{className:o?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Gs,{number:t+1,size:o?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:s?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${o?"text-[15px]":"text-lg"} mb-0`,children:s?.question||"Frage wird geladen..."}),s?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(Y,{size:o?14:16}),"Empfohlene Antwortzeit: ~",Math.round(s.estimated_time/60)," Min."]}),n?.enable_tips&&s?.tips&&e.jsx(Us,{tips:s.tips})]}),We=({time:s,isRecording:t})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[t?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(Y,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:ws(s)})]}),qe=({error:s,onRetry:t})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(fs,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:s}),e.jsx(H,{onClick:t,icon:e.jsx(Xe,{size:16}),children:"Erneut versuchen"})]}),Qs=({isUploading:s,isAnalyzing:t})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-indigo-50/30 to-violet-50/30 flex items-center justify-center p-4",children:e.jsxs(I.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx(Ke,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:s?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:s?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),Hs=({session:s,questions:t,scenario:n,variables:o,onComplete:h,onExit:d,selectedMicrophoneId:g,selectedCameraId:i})=>{const[r,f]=a.useState(0),[x,v]=a.useState(!1),[c,l]=a.useState(!1),[m,j]=a.useState(0),[C,A]=a.useState([]),[z,N]=a.useState([]),[w,B]=a.useState(null),[D,M]=a.useState(null),[W,R]=a.useState(!1),[ee,se]=a.useState(!1),[te,P]=a.useState(null),[q,ce]=a.useState(g||null),[K,S]=a.useState(i||null),[es,de]=a.useState(!1),[ke,Ce]=a.useState(0),U=Is(),ae=a.useRef(null),me=a.useRef(null),O=a.useRef(null),G=a.useRef(null),xe=a.useRef(null),$=a.useRef(null),{branding:ss}=Se(),ue=ss?.["--primary-accent"],Ae=t[r];a.useEffect(()=>(L(),()=>{he(),O.current&&clearInterval(O.current),$.current&&cancelAnimationFrame($.current),G.current&&G.current.close()}),[]);const ts=u=>{try{G.current&&G.current.close();const k=new(window.AudioContext||window.webkitAudioContext);G.current=k;const b=k.createAnalyser();b.fftSize=256,b.smoothingTimeConstant=.8,xe.current=b,k.createMediaStreamSource(u).connect(b);const _=new Uint8Array(b.frequencyBinCount),F=()=>{if(!xe.current)return;xe.current.getByteFrequencyData(_);const pe=_.reduce((ls,os)=>ls+os,0)/_.length;Ce(pe/255),$.current=requestAnimationFrame(F)};F()}catch(k){console.error("[VIDEO TRAINING] Audio analysis error:",k)}},as=()=>{$.current&&(cancelAnimationFrame($.current),$.current=null),Ce(0)},L=async(u=q,k=K)=>{try{M(null),w&&w.getTracks().forEach(F=>F.stop());const b=k?{deviceId:{exact:k},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},E=u?{deviceId:{exact:u}}:!0,_=await navigator.mediaDevices.getUserMedia({video:b,audio:E});B(_),ae.current&&(ae.current.srcObject=_)}catch(b){console.error("[VIDEO TRAINING] Camera error:",b),M("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},ns=u=>{ce(u),x||L(u,K)},rs=u=>{S(u),x||L(q,u)},he=()=>{w&&(w.getTracks().forEach(u=>u.stop()),B(null))},Ie=()=>{if(!w){L();return}try{const u=new MediaRecorder(w,{mimeType:"video/webm;codecs=vp9,opus"});me.current=u;const k=[];u.ondataavailable=b=>{b.data.size>0&&(k.push(b.data),A(E=>[...E,b.data]))},u.onstop=()=>{},u.start(1e3),v(!0),l(!1),ts(w),N(b=>[...b,{question_index:r,start_time:m}]),O.current=setInterval(()=>{j(b=>b+1)},1e3)}catch(u){console.error("[VIDEO TRAINING] Recording error:",u),P("Fehler beim Starten der Aufnahme")}},ne=()=>{me.current&&x&&(me.current.stop(),v(!1),as(),O.current&&(clearInterval(O.current),O.current=null))},Ee=()=>{r<t.length-1&&(x&&N(u=>[...u,{question_index:r+1,start_time:m}]),f(u=>u+1))},ze=()=>{r>0&&f(u=>u-1)},Te=async()=>{ne(),he(),R(!0),P(null);try{const u=new Blob(C,{type:"video/webm"}),k=we(),b=new FormData;b.append("video",u,`video_${s.id}.webm`),b.append("video_duration",m.toString()),b.append("timeline",JSON.stringify(z));const E=await fetch(`${k}/video-training/sessions/${s.id}/video`,{method:"POST",headers:{"X-WP-Nonce":X()},body:b});if(!E.ok){const pe=await E.text();throw console.error("[VIDEO TRAINING] Upload failed:",E.status,pe),E.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+E.status)}const _=await E.json();R(!1),se(!0);const F=await fetch(`${k}/video-training/sessions/${s.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()}});if(!F.ok)throw new Error("Fehler bei der Video-Analyse");const Q=await F.json();h({session:Q.data?.session||s,analysis:Q.data?.analysis,categoryScores:Q.data?.category_scores,overallScore:Q.data?.overall_score})}catch(u){console.error("[VIDEO TRAINING] Upload/Analysis error:",u),P(u.message),R(!1),se(!1)}},is=()=>{ne(),he(),d()};if(W||ee)return e.jsx(Qs,{isUploading:W,isAnalyzing:ee});const re=C.length>0,De=n?.enable_navigation&&r>0,Re=n?.enable_navigation&&r<t.length-1;return e.jsxs("div",{className:`${U?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${U?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${U?"text-lg":"text-xl"} font-semibold text-slate-900`,children:n?.title}),e.jsxs("button",{onClick:is,className:`${U?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(fe,{size:16}),"Abbrechen"]})]}),e.jsx(zs,{current:r,total:t.length,primaryAccent:ue,showCompleted:!1}),U?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Le,{question:Ae,index:r,scenario:n,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[D?e.jsx(qe,{error:D,onRetry:L}):e.jsx("video",{ref:ae,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(x||m>0)&&e.jsx(We,{time:m,isRecording:x})]}),x&&e.jsx("div",{className:"mt-4",children:e.jsx(Me,{audioLevel:ke,isActive:!0,variant:"bars",size:"sm",accentColor:ue})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>de(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(be,{size:20,className:"text-slate-500"})}),x?e.jsxs("button",{onClick:ne,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(Ve,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Ie,disabled:!w,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${w?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(T,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[De&&e.jsx(H,{variant:"secondary",size:"sm",icon:e.jsx(_e,{size:16}),onClick:ze,className:"flex-1",children:"Zurück"}),Re&&e.jsx(H,{size:"sm",iconPosition:"right",icon:e.jsx(je,{size:16}),onClick:Ee,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Te,disabled:!re,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${re?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Fe,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[D?e.jsx(qe,{error:D,onRetry:L}):e.jsx("video",{ref:ae,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(x||m>0)&&e.jsx(We,{time:m,isRecording:x})]}),x&&e.jsx("div",{className:"mt-5",children:e.jsx(Me,{audioLevel:ke,isActive:!0,variant:"bars",size:"sm",accentColor:ue})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>de(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(be,{size:20,className:"text-slate-500"})}),x?e.jsxs("button",{onClick:ne,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(Ve,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Ie,disabled:!w,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${w?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(T,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[De&&e.jsx(H,{variant:"secondary",icon:e.jsx(_e,{size:18}),onClick:ze,children:"Vorherige"}),Re&&e.jsx(H,{iconPosition:"right",icon:e.jsx(je,{size:18}),onClick:Ee,children:"Nächste"}),e.jsxs("button",{onClick:Te,disabled:!re,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${re?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Fe,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(Le,{question:Ae,index:r,scenario:n,isMobile:!1})]}),te&&e.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(Z,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:te}),e.jsx("button",{onClick:()=>P(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(fe,{size:16,className:"text-red-500"})})]}),e.jsx(Es,{isOpen:es,onClose:()=>de(!1),mode:"audio-video",selectedMicrophoneId:q,onMicrophoneChange:ns,selectedCameraId:K,onCameraChange:rs})]})},Xs={auftreten:js,selbstbewusstsein:Be,koerpersprache:J,kommunikation:Ne,professionalitaet:Be,inhalt:V},Zs=({score:s,size:t=120,strokeWidth:n=10,primaryAccent:o})=>{const h=(t-n)/2,d=h*2*Math.PI,g=d-s/100*d,i=Ye(s,o);return e.jsxs("div",{className:"relative mx-auto",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,className:"-rotate-90",children:[e.jsx("circle",{cx:t/2,cy:t/2,r:h,fill:"none",stroke:p.slate[200],strokeWidth:n}),e.jsx(I.circle,{cx:t/2,cy:t/2,r:h,fill:"none",stroke:i,strokeWidth:n,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:g},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold text-slate-600",style:{fontSize:t/3,color:i},children:Math.round(s)}),e.jsx("span",{className:"text-slate-500",style:{fontSize:t/10},children:"von 100"})]})]})},Js=({category:s,primaryAccent:t})=>{const[n,o]=a.useState(!1),h=Xs[s.category]||Je,d=Ye(s.score,t);return e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-slate-200 overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>o(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:`${d}15`},children:e.jsx(h,{size:20,color:d})}),e.jsxs("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"text-[15px] font-semibold text-slate-900 mb-0.5",children:s.label}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[s.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",style:{color:d},children:Math.round(s.score)}),e.jsx(vs,{size:20,className:"text-slate-500 transition-transform duration-200",style:{transform:n?"rotate(180deg)":"none"}})]})]}),e.jsx(Ze,{children:n&&e.jsx(I.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:s.feedback}),s.strengths&&s.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-green-600 mb-2 flex items-center gap-1.5",children:[e.jsx(oe,{size:14}),"Stärken"]}),e.jsx("ul",{className:"m-0 pl-5",children:s.strengths.map((g,i)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:g},i))})]}),s.improvements&&s.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-amber-600 mb-2 flex items-center gap-1.5",children:[e.jsx(Z,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:s.improvements.map((g,i)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:g},i))})]})]})})})]})},Ys=({session:s,scenario:t,onBackToDashboard:n,onStartNew:o})=>{const{branding:h}=Se(),d=h?.["--primary-accent"]||p.indigo[500],{triggerConfetti:g,ConfettiComponent:i}=Ts(),r=s?.overall_score||0,f=s?.category_scores||[],x=s?.analysis||{},v=s?.summary_feedback||"",c=l=>l>=90?"Ausgezeichnet!":l>=80?"Sehr gut!":l>=70?"Gut!":l>=60?"Solide Leistung":l>=50?"Ausbaufähig":"Weiter üben!";return a.useEffect(()=>{r>=70&&g()},[r,g]),e.jsxs(e.Fragment,{children:[e.jsx(i,{}),e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs(I.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-brand-gradient flex items-center justify-center mx-auto mb-5 shadow-xl",children:e.jsx(bs,{size:40,color:p.white})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Training abgeschlossen!"}),e.jsxs("p",{className:"text-base text-slate-600",children:[t?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(I.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"bg-white rounded-2xl p-8 text-center border border-slate-200 shadow-md mb-6",children:[e.jsx(Zs,{score:r,size:160,primaryAccent:d}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mt-5 mb-2",children:c(r)}),e.jsx("p",{className:"text-[15px] text-slate-600 max-w-lg mx-auto leading-relaxed",children:v||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),f.length>0&&e.jsxs(I.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Je,{size:20,color:d}),"Detaillierte Bewertung"]}),f.map((l,m)=>e.jsx(Js,{category:l,primaryAccent:d},l.category||m))]}),x&&(x.key_strengths?.length>0||x.actionable_tips?.length>0)&&e.jsxs(I.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[x.key_strengths&&x.key_strengths.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-base font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(oe,{size:18}),"Deine Stärken"]}),e.jsx("ul",{className:"m-0 pl-6",children:x.key_strengths.map((l,m)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:l},m))})]}),x.actionable_tips&&x.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-base font-semibold mb-3 flex items-center gap-2",style:{color:d},children:[e.jsx(V,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-6",children:x.actionable_tips.map((l,m)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:l},m))})]})]}),s?.video_url&&e.jsxs(I.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{size:18,color:d}),"Deine Aufnahme"]}),e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]}),e.jsxs(I.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex gap-4 justify-center",children:[e.jsxs(ve,{onClick:n,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(He,{size:18}),"Zur Übersicht"]}),e.jsxs(ve,{onClick:o,size:"lg",className:"gap-2 shadow-lg",children:[e.jsx(Xe,{size:18}),"Nochmal üben"]})]})]})]})},y={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},gt=({isAuthenticated:s,requireAuth:t,setPendingAction:n,pendingScenario:o,clearPendingScenario:h,onNavigateToHistory:d})=>{const[g,i]=a.useState(y.DASHBOARD),[r,f]=a.useState(null),[x,v]=a.useState(null),[c,l]=a.useState([]),[m,j]=a.useState({}),[C,A]=a.useState(null),[z,N]=a.useState(null),[w,B]=a.useState(null),[D,M]=a.useState(null);a.useEffect(()=>{o&&s&&(f(o),i(y.VARIABLES),h&&h())},[o,s,h]),a.useEffect(()=>{D&&s&&(f(D),i(y.VARIABLES),M(null))},[D,s]),a.useEffect(()=>{window.scrollTo(0,0)},[g]);const W=a.useCallback(S=>{f(S),i(y.VARIABLES)},[]),R=a.useCallback(()=>{f(null),v(null),l([]),j({}),A(null),N(null),B(null),i(y.DASHBOARD)},[]),ee=a.useCallback(S=>{j(S),i(y.DEVICE_SETUP)},[]),se=a.useCallback(()=>{i(y.VARIABLES)},[]),te=a.useCallback(S=>{v(S.session),l(S.questions),j(S.variables),N(S.selectedMicrophoneId),B(S.selectedCameraId),i(y.SESSION)},[]),P=a.useCallback(S=>{A(S.session),i(y.COMPLETE)},[]),q=a.useCallback(()=>{R()},[R]),ce=a.useCallback(()=>{v(null),l([]),A(null),N(null),B(null),i(y.VARIABLES)},[]),K=()=>{switch(g){case y.DASHBOARD:return e.jsx(Oe,{onSelectScenario:W,isAuthenticated:s,requireAuth:t,setPendingScenario:M,onNavigateToHistory:d});case y.VARIABLES:return e.jsx(Ws,{scenario:r,onBack:R,onNext:ee});case y.DEVICE_SETUP:return e.jsx(Ks,{scenario:r,variables:m,onBack:se,onStart:te});case y.SESSION:return e.jsx(Hs,{session:x,questions:c,scenario:r,variables:m,onComplete:P,onExit:q,selectedMicrophoneId:z,selectedCameraId:w});case y.COMPLETE:return e.jsx(Ys,{session:C,scenario:r,onBackToDashboard:R,onStartNew:ce});default:return e.jsx(Oe,{onSelectScenario:W,isAuthenticated:s,requireAuth:t,setPendingScenario:M,onNavigateToHistory:d})}};return e.jsx("div",{className:"min-h-full",children:K()})};export{gt as V,Oe as a,Hs as b,Ys as c};
