import{j as e,p as Z,q as zt,b as J,a as _e,T as te,ai as _t,w as At,aj as Mt,B as it,v as Ae,x as Pe,e as Me,ae as Ce,O as lt,o as ct,z as ue,I as xe,M as de,a7 as Et,aa as dt,k as ut,y as V,_ as We,ak as xt,h as qe,a2 as Rt,l as He,a3 as Ft,a4 as Ze,a5 as Tt,A as It,m as Bt,J as $t,E as Oe,al as Lt,a1 as me,am as Ve,n as mt,X as Dt,i as qt,a0 as Ot}from"./ui-vendor-B9DEMv6g.js";import{a as i,d as pt}from"./react-vendor-uDOJF2jQ.js";import{h as Vt,F as Pt,g as Wt,c as Ht,C as et,u as Ge,D as Be,i as ze,w as K,j as Zt}from"./FeatureInfoButton-Df0Ex1oW.js";import{S as Gt}from"./ScenarioDashboard-DAfi6N72.js";import{u as Ke}from"./useBranding-DY0PKpWK.js";import{u as Kt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-CTkE1bhT.js";import{A as Ut,M as ht,a as ft}from"./MicrophoneTestDialog-CjRagsq0.js";import{D as Jt}from"./DeviceSettingsDialog-v-S3YV_J.js";import{F as gt}from"./fullscreen-loader-REXqrTCW.js";import{B as oe,C as ke}from"./Button-BHvYxNT_.js";import"./select-native-BpAm0hLd.js";import"./dialog-BRm7JlyZ.js";import{D as Xt}from"./DynamicFormField-BZ1JiHJE.js";import"./ScenarioCard-BVMLj9FI.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-FMuxNobR.js";import"./index-CklPxmEV.js";const tt="[SIMULATOR_DASHBOARD]",Yt={briefcase:it,banknote:Mt,user:At,presentation:_t,target:te,mic:Z},es=async()=>{const t=await fetch(`${Wt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Ht()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const r=await t.json();if(r.success&&r.data?.scenarios)return r.data.scenarios;throw new Error("Keine Szenarien gefunden")},ts=t=>Yt[t.icon]||it,ss=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:J,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],st=({onSelectScenario:t,isAuthenticated:r,requireAuth:d,setPendingScenario:s,onNavigateToHistory:a})=>(i.useEffect(()=>(console.log(`${tt} üîµ MOUNT`),()=>{console.log(`${tt} üî¥ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Vt,{featureId:"simulator",showOnMount:!0}),e.jsx(Gt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:_e,headerActions:e.jsx(Pt,{featureId:"simulator",size:"sm"}),fetchScenarios:es,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:a,onSelectScenario:t,renderCardMeta:ss,getIconForScenario:ts,cardActionLabel:"Starten",cardActionIcon:zt,categoryField:"category",emptyStateIcon:Z,emptyStateTitle:"Keine Trainingsszenarien verf√ºgbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:r,requireAuth:d,setPendingScenario:s,loadingMessage:"Szenarien werden geladen..."})]})),rs=({field:t,value:r,onChange:d,error:s,focusColor:a,branding:l})=>{const p=a||"#4a9ec9",N="w-full rounded-lg text-base outline-none transition-all",w="px-4 py-3",x=s?"border-2 border-red-500":"border-2 border-slate-200",c={borderColor:p,boxShadow:`0 0 0 3px ${p}1a`},b=y=>{Object.assign(y.target.style,c),setTimeout(()=>{const h=y.target;if(h){const R=h.closest("div");R&&R.scrollIntoView({behavior:"smooth",block:"center"})}},300)},o=y=>{y.target.style.borderColor=s?et.red[500]:et.slate[200],y.target.style.boxShadow="none"},A=()=>{const y=`${N} ${w} ${x} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:r||"",onChange:h=>d(t.key,h.target.value),placeholder:t.placeholder||"",className:y,onFocus:b,onBlur:o});case"textarea":return e.jsx("textarea",{value:r||"",onChange:h=>d(t.key,h.target.value),placeholder:t.placeholder||"",rows:4,className:`${y} resize-vertical min-h-[100px]`,onFocus:b,onBlur:o});case"select":return e.jsxs("select",{value:r||t.default||"",onChange:h=>d(t.key,h.target.value),className:`${y} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:b,onBlur:o,children:[e.jsx("option",{value:"",children:"Bitte w√§hlen..."}),t.options?.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]});case"number":return e.jsx("input",{type:"number",value:r||"",onChange:h=>d(t.key,h.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:y,onFocus:b,onBlur:o});default:return e.jsx("input",{type:"text",value:r||"",onChange:h=>d(t.key,h.target.value),placeholder:t.placeholder||"",className:y,onFocus:b,onBlur:o})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),A(),s&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),s]}),t.hint&&!s&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),t.hint]})]})},ns=({scenario:t,onBack:r,onNext:d})=>{const[s,a]=i.useState({}),[l,p]=i.useState({}),[N,w]=i.useState([]),[x,c]=i.useState(!1),b=Ke(),o=pt.useMemo(()=>{if(!t?.input_configuration)return[];try{const f=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(f)?f.filter(u=>u.user_input!==!1):[]}catch(f){return console.error("Error parsing input_configuration:",f),[]}},[t?.input_configuration]);i.useEffect(()=>{const f={};o.forEach(u=>{u.default&&(f[u.key]=u.default)}),a(f)},[o]);const A=(f,u)=>{a(n=>({...n,[f]:u})),l[f]&&p(n=>{const m={...n};return delete m[f],m})},y=()=>{w(f=>[...f,{key:"",value:""}])},h=(f,u,n)=>{w(m=>{const z=[...m];return z[f]={...z[f],[u]:n},z})},R=f=>{w(u=>u.filter((n,m)=>m!==f))},T=()=>{const f={};return o.forEach(u=>{const n=s[u.key];if(u.required&&(!n||n.trim()==="")){f[u.key]="Dieses Feld ist erforderlich";return}if(!(!n||n.trim()==="")&&u.validation){const{minLength:m,maxLength:z,min:I,max:B,pattern:$}=u.validation;m&&n.length<m&&(f[u.key]=`Mindestens ${m} Zeichen erforderlich`),z&&n.length>z&&(f[u.key]=`Maximal ${z} Zeichen erlaubt`),I!==void 0&&Number(n)<I&&(f[u.key]=`Mindestens ${I}`),B!==void 0&&Number(n)>B&&(f[u.key]=`Maximal ${B}`),$&&!new RegExp($).test(n)&&(f[u.key]="Ung√ºltiges Format")}}),p(f),Object.keys(f).length===0},C=f=>{if(f.preventDefault(),!T())return;const u={...s};N.forEach(n=>{n.key&&n.value&&(u[n.key]=n.value)}),d(u)};return i.useEffect(()=>{o.length===0&&d({})},[o,d]),o.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:b.headerGradient},children:e.jsx(_e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:C,children:[o.map(f=>e.jsx(rs,{field:f,value:s[f.key],onChange:A,error:l[f.key],focusColor:b.primaryAccent,branding:b},f.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>c(!x),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:x?b.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[x?e.jsx(Pe,{size:18}):e.jsx(Me,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"Zus√§tzliche Variablen hinzuf√ºgen (optional)"})]}),x&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"F√ºge eigene Variablen hinzu, die in das Training einflie√üen sollen."}),N.length>0&&e.jsx("div",{className:"mb-3",children:N.map((f,u)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:f.key||"",onChange:n=>h(u,"key",n.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>R(u),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:16})})]}),e.jsx("textarea",{value:f.value||"",onChange:n=>h(u,"value",n.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},u))}),e.jsxs("button",{type:"button",onClick:y,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(Ce,{size:16}),"Variable hinzuf√ºgen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:b.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-2xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all hover:-translate-y-0.5",style:{background:b.buttonGradient,boxShadow:`0 4px 12px ${b.primaryAccent}4d`},children:["Weiter",e.jsx(ct,{className:"w-5 h-5"})]})]})]})},ve=({score:t,label:r,size:d="normal",primaryAccent:s,branding:a})=>{const l=t!=null?t*10:null,N=(x=>x>=80?a.success:x>=60?s:x>=40?a.warning:a.error)(l),w=d==="large";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:a.space[1]},children:[e.jsx("div",{style:{width:w?"80px":"56px",height:w?"80px":"56px",borderRadius:a.radius.full,backgroundColor:`${N}15`,border:`3px solid ${N}`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:w?a.fontSize["5xl"]:a.fontSize["2xl"],fontWeight:a.fontWeight.bold,color:N},children:l!=null?Math.round(l):"-"})}),e.jsx("span",{style:{fontSize:w?a.fontSize.base:a.fontSize.xs,color:a.textSecondary,fontWeight:a.fontWeight.medium},children:r})]})},ae=({title:t,icon:r,children:d,defaultOpen:s=!0,primaryAccent:a,branding:l})=>{const[p,N]=i.useState(s);return e.jsxs("div",{style:{borderRadius:l.radius.lg,border:`1px solid ${l.borderColor}`,backgroundColor:l.cardBg,overflow:"hidden",marginBottom:l.space[4]},children:[e.jsxs("button",{onClick:()=>N(!p),style:{width:"100%",padding:`${l.space[4]} ${l.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[3]},children:[e.jsx(r,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:a}}),e.jsx("span",{style:{fontSize:l.fontSize.md,fontWeight:l.fontWeight.semibold,color:l.textMain},children:t})]}),p?e.jsx(Pe,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:l.textMuted}}):e.jsx(Me,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:l.textMuted}})]}),p&&e.jsx("div",{style:{padding:`0 ${l.space[5]} ${l.space[5]} ${l.space[5]}`,borderTop:`1px solid ${l.cardBgHover}`,paddingTop:l.space[4]},children:d})]})},$e=({text:t,type:r,primaryAccent:d,primaryAccentLight:s,branding:a})=>{const l={strength:{icon:dt,color:a.success,bg:a.successLight},improvement:{icon:ut,color:a.warning,bg:a.warningLight},tip:{icon:V,color:d,bg:s}},{icon:p,color:N,bg:w}=l[r]||l.tip;return e.jsxs("div",{style:{display:"flex",gap:a.space[3],padding:a.space[3],borderRadius:a.radius.md,backgroundColor:w,marginBottom:a.space[2]},children:[e.jsx(p,{style:{width:a.iconSize.md,height:a.iconSize.md,color:N,flexShrink:0,marginTop:"2px"}}),e.jsx("span",{style:{fontSize:a.fontSize.base,color:a.textSecondary,lineHeight:1.5},children:t})]})},as=({metrics:t,branding:r})=>{if(!t)return null;const s=(l=>{switch(l){case"optimal":return{label:"Optimal",color:r.success};case"zu_schnell":return{label:"Zu schnell",color:r.warning};case"zu_langsam":return{label:"Zu langsam",color:r.warning};default:return{label:l||"N/A",color:r.textMuted}}})(t.speech_rate),a=l=>{switch(l){case"niedrig":return r.success;case"mittel":return r.warning;case"hoch":return r.error;default:return r.textMuted}};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:r.space[4]},children:[e.jsxs("div",{style:{padding:r.space[4],borderRadius:r.radius.md,backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:r.textMuted,display:"block",marginBottom:r.space[1]},children:"Sprechtempo"}),e.jsx("span",{style:{fontSize:r.fontSize.lg,fontWeight:r.fontWeight.semibold,color:s.color},children:s.label})]}),t.filler_words&&e.jsxs("div",{style:{padding:r.space[4],borderRadius:r.radius.md,backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:r.textMuted,display:"block",marginBottom:r.space[1]},children:"F√ºllw√∂rter"}),e.jsxs("span",{style:{fontSize:r.fontSize.lg,fontWeight:600,color:a(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:r.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?r.success:r.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:r.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:r.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:r.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?r.success:r.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:r.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:r.primaryAccentLight,fontSize:"14px",color:r.textSecondary,lineHeight:1.5},children:["üí° ",t.notes]})]})},os=({audioUrl:t,primaryAccent:r,branding:d})=>{const s=i.useRef(null),[a,l]=i.useState(!1),[p,N]=i.useState(0),[w,x]=i.useState(0),[c,b]=i.useState(!0),[o,A]=i.useState(null);i.useEffect(()=>{if(!t)return;b(!0),A(null);const C=new Audio;s.current=C;const f=()=>{const n=C.duration;n&&isFinite(n)&&n>0&&x(n),b(!1)},u=()=>{b(!1);const n=C.duration;n&&isFinite(n)&&n>0&&x(n)};return C.addEventListener("loadedmetadata",f),C.addEventListener("canplaythrough",u),C.addEventListener("timeupdate",()=>N(C.currentTime)),C.addEventListener("play",()=>l(!0)),C.addEventListener("pause",()=>l(!1)),C.addEventListener("ended",()=>l(!1)),C.addEventListener("error",()=>{A("Audio nicht verf√ºgbar"),b(!1)}),C.src=t,C.load(),()=>{C.pause(),C.src=""}},[t]);const y=()=>{s.current&&(a?s.current.pause():s.current.play())},h=C=>{const f=C.currentTarget.getBoundingClientRect(),u=(C.clientX-f.left)/f.width;s.current&&w>0&&(s.current.currentTime=u*w)},R=C=>{s.current&&(s.current.currentTime=Math.max(0,Math.min(s.current.currentTime+C,w)))};if(!t)return null;if(o)return e.jsxs("div",{style:{padding:"12px 16px",background:d.cardBgHover,borderRadius:"10px",color:d.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ue,{size:16})," ",o]});const T=w>0?p/w*100:0;return e.jsxs("div",{style:{background:d.cardBgHover,borderRadius:"12px",padding:"16px"},children:[e.jsx("div",{onClick:h,style:{height:"6px",background:d.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:e.jsx("div",{style:{width:`${T}%`,height:"100%",background:r,borderRadius:"3px",transition:"width 0.1s"}})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[e.jsx("button",{onClick:()=>R(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:d.textMuted,display:"flex",alignItems:"center"},children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:y,disabled:c,style:{width:"44px",height:"44px",borderRadius:"50%",background:r,border:"none",cursor:c?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:c?.7:1},children:c?e.jsx(He,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):a?e.jsx(Ft,{size:20,color:"#ffffff",fill:"#ffffff"}):e.jsx(Ze,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),e.jsx("button",{onClick:()=>R(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:d.textMuted,display:"flex",alignItems:"center"},children:e.jsx(Tt,{size:20})})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:d.textMuted},children:[ze(p)," / ",ze(w)]}),e.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},is=({transcript:t,feedback:r,audioMetrics:d,audioUrl:s,onRetry:a,onNext:l,onComplete:p,isLastQuestion:N,hideButtons:w=!1})=>{const{branding:x}=Ge(),c=Ke(),b=x?.["--button-gradient"]||x?.["--header-gradient"]||Be["--header-gradient"],o=x?.["--primary-accent"]||Be["--primary-accent"],A=x?.["--primary-accent-light"]||Be["--primary-accent-light"],y=typeof r=="string"?JSON.parse(r):r;return e.jsxs("div",{style:{backgroundColor:c.cardBgHover,borderRadius:c.radius.xl,padding:c.space[6]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:c.space[5],backgroundColor:c.cardBg,borderRadius:c.radius.lg},children:[e.jsx(ve,{score:y?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:o,branding:c}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:c.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),e.jsx("p",{style:{fontSize:"14px",color:c.textSecondary,margin:0,lineHeight:1.5},children:y?.summary||"Deine Antwort wurde analysiert."})]})]}),y?.scores&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:c.cardBg,borderRadius:"12px"},children:[e.jsx(ve,{score:y.scores.content,label:"Inhalt",primaryAccent:o,branding:c}),e.jsx(ve,{score:y.scores.structure,label:"Struktur",primaryAccent:o,branding:c}),e.jsx(ve,{score:y.scores.relevance,label:"Relevanz",primaryAccent:o,branding:c})]}),e.jsx(ae,{title:"Transkript",icon:de,defaultOpen:!0,primaryAccent:o,branding:c,children:e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:c.cardBgHover,fontStyle:"italic",color:c.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verf√ºgbar.",'"']})}),s&&e.jsx(ae,{title:"Deine Aufnahme",icon:Et,defaultOpen:!0,primaryAccent:o,branding:c,children:e.jsx(os,{audioUrl:s,primaryAccent:o,branding:c})}),y?.strengths?.length>0&&e.jsx(ae,{title:"St√§rken",icon:dt,defaultOpen:!0,primaryAccent:o,branding:c,children:y.strengths.map((h,R)=>e.jsx($e,{text:h,type:"strength",primaryAccent:o,primaryAccentLight:A,branding:c},R))}),y?.improvements?.length>0&&e.jsx(ae,{title:"Verbesserungen",icon:ut,defaultOpen:!0,primaryAccent:o,branding:c,children:y.improvements.map((h,R)=>e.jsx($e,{text:h,type:"improvement",primaryAccent:o,primaryAccentLight:A,branding:c},R))}),y?.tips?.length>0&&e.jsx(ae,{title:"Tipps",icon:V,defaultOpen:!1,primaryAccent:o,branding:c,children:y.tips.map((h,R)=>e.jsx($e,{text:h,type:"tip",primaryAccent:o,primaryAccentLight:A,branding:c},R))}),d&&e.jsx(ae,{title:"Sprechanalyse",icon:Z,defaultOpen:!1,primaryAccent:o,branding:c,children:e.jsx(as,{metrics:d,branding:c})}),!w&&e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[a&&e.jsxs("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${c.borderColor}`,backgroundColor:c.cardBg,color:c.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.borderColor=o,h.target.style.color=o},onMouseLeave:h=>{h.target.style.borderColor=c.borderColor,h.target.style.color=c.textSecondary},children:[e.jsx(We,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),e.jsx("button",{onClick:N?p:l,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:b,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${o}4d`,transition:"all 0.2s"},onMouseEnter:h=>{h.target.style.transform="translateY(-2px)",h.target.style.boxShadow=`0 6px 16px ${o}66`},onMouseLeave:h=>{h.target.style.transform="none",h.target.style.boxShadow=`0 4px 12px ${o}4d`},children:N?e.jsxs(e.Fragment,{children:[e.jsx(xt,{style:{width:"18px",height:"18px"}}),"Training abschlie√üen"]}):e.jsxs(e.Fragment,{children:["N√§chste Frage",e.jsx(qe,{style:{width:"18px",height:"18px"}})]})})]})]})},ls=({tips:t,primaryAccent:r,tipsLabel:d,branding:s})=>{const[a,l]=i.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:s.cardBg,borderRadius:s.radius.xl,border:`1px solid ${s.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>l(!a),style:{width:"100%",padding:`${s.space[4]} ${s.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:s.space[2],fontSize:s.fontSize.base,fontWeight:s.fontWeight.semibold,color:s.textMain},children:[e.jsx(V,{size:s.iconSize.md,color:r}),d||"Tipps f√ºr diese Frage"]}),e.jsx(Me,{size:s.iconSize.md,color:s.textMuted,style:{transform:a?"rotate(180deg)":"none",transition:s.transition.normal}})]}),e.jsx(It,{children:a&&e.jsx(Bt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${s.space[6]} ${s.space[6]}`},children:t.map((p,N)=>e.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.md,backgroundColor:s.warningLight,marginBottom:N<t.length-1?s.space[2]:0},children:[e.jsx(V,{style:{width:s.iconSize.sm,height:s.iconSize.sm,color:s.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:s.textSecondary,margin:0,lineHeight:1.5},children:p.replace(/^Tipp \d+:\s*/i,"")})]},N))})})})]})},cs=({seconds:t,maxSeconds:r,isRecording:d,branding:s})=>{const a=r>0?t/r*100:0,l=a>75,p=a>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,borderRadius:s.radius.lg,backgroundColor:p?s.errorLight:l?s.warningLight:s.cardBgHover},children:[e.jsx(J,{style:{width:s.iconSize.lg,height:s.iconSize.lg,color:p?s.error:l?s.warning:s.textSecondary}}),e.jsx("span",{style:{fontSize:s.fontSize.xl,fontWeight:s.fontWeight.semibold,fontFamily:"monospace",color:p?s.error:l?s.warning:s.textSecondary},children:ze(t)}),e.jsxs("span",{style:{fontSize:s.fontSize.base,color:s.textMuted},children:["/ ",ze(r)]})]})},rt=({onRecordingComplete:t,timeLimit:r,disabled:d,deviceId:s,themedGradient:a,primaryAccent:l,isSubmitting:p,labels:N,onOpenSettings:w,branding:x,isMobile:c,onStreamChange:b})=>{const[o,A]=i.useState("idle"),[y,h]=i.useState(0),[R,T]=i.useState(0),[C,f]=i.useState(!1),u=i.useRef(null),n=i.useRef([]),m=i.useRef(null),z=i.useRef(null),I=i.useRef(null),B=i.useRef(null),$=i.useRef(null),E=i.useRef(0),P=i.useRef(!1);i.useEffect(()=>()=>{j()},[]),i.useEffect(()=>{o==="recording"&&y>=r&&F()},[y,r,o]);const j=()=>{m.current&&clearInterval(m.current),B.current&&cancelAnimationFrame(B.current),z.current&&(z.current.close(),z.current=null),$.current&&($.current.getTracks().forEach(k=>k.stop()),$.current=null,b&&b(null))},g=async()=>{try{f(!1),n.current=[],h(0);let k;const se={audio:s?{deviceId:{exact:s}}:!0};try{k=await navigator.mediaDevices.getUserMedia(se)}catch(L){throw console.error("[SIMULATOR] Selected device unavailable:",L),L.name==="OverconstrainedError"||L.name==="NotFoundError"?(f(!1),new Error("Das ausgew√§hlte Mikrofon ist nicht verf√ºgbar. Bitte w√§hle ein anderes Mikrofon in den Einstellungen.")):L}$.current=k,b&&b(k),z.current=new(window.AudioContext||window.webkitAudioContext),I.current=z.current.createAnalyser(),z.current.createMediaStreamSource(k).connect(I.current),I.current.fftSize=256;const X=()=>{if(I.current&&P.current){const L=new Uint8Array(I.current.frequencyBinCount);I.current.getByteFrequencyData(L);const G=L.reduce((fe,Ee)=>fe+Ee)/L.length;T(G/255)}B.current=requestAnimationFrame(X)};P.current=!0,X();const he=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";u.current=new MediaRecorder(k,{mimeType:he}),u.current.ondataavailable=L=>{L.data.size>0&&n.current.push(L.data)},u.current.onstop=()=>{const L=new Blob(n.current,{type:he});t(L,E.current)},u.current.start(1e3),A("recording"),m.current=setInterval(()=>{h(L=>L+1)},1e3)}catch(k){console.error("Error starting recording:",k),(k.name==="NotAllowedError"||k.name==="PermissionDeniedError")&&f(!0)}},S=()=>{u.current&&u.current.state==="recording"&&(u.current.pause(),A("paused"),P.current=!1,m.current&&(clearInterval(m.current),m.current=null),T(0))},M=()=>{u.current&&u.current.state==="paused"&&(u.current.resume(),A("recording"),P.current=!0,m.current=setInterval(()=>{h(k=>k+1)},1e3))},F=()=>{E.current=y,P.current=!1,m.current&&(clearInterval(m.current),m.current=null),B.current&&(cancelAnimationFrame(B.current),B.current=null),z.current&&(z.current.close(),z.current=null),u.current&&u.current.state!=="inactive"&&u.current.stop(),$.current&&($.current.getTracks().forEach(k=>k.stop()),$.current=null),A("idle"),T(0),h(0)},v=()=>{o==="idle"?g():o==="recording"?S():o==="paused"&&M()};if(C)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:x.errorLight},children:[e.jsx($t,{className:"w-12 h-12 mb-3 mx-auto",style:{color:x.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:x.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:x.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const O=()=>{const k={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:c?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:c?"15px":"16px",fontWeight:600,cursor:d||p?"not-allowed":"pointer",flex:c?1:"none"};return d||p?{...k,background:x.borderColor,boxShadow:"none"}:o==="idle"?{...k,background:x.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:o==="recording"?{...k,background:x.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...k,background:x.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:x.cardBg,border:`1px solid ${x.borderColor}`},children:[c&&e.jsx("button",{onClick:w,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:x.cardBgHover,border:`1px solid ${x.borderColor}`},children:e.jsx(Oe,{size:18,style:{color:x.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(cs,{seconds:y,maxSeconds:r,isRecording:o==="recording",branding:x})}),o==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{audioLevel:R,isActive:!0,variant:"bars",size:"sm",accentColor:l})}),o==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:x.warning},children:[e.jsx(Z,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!c&&e.jsx("button",{onClick:w,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:x.cardBgHover,border:`1px solid ${x.borderColor}`},children:e.jsx(Oe,{size:20,style:{color:x.textMuted}})}),e.jsxs("button",{onClick:v,disabled:d||p,style:O(),children:[o==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5"}),"Aufnahme starten"]}),o==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),o==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(o==="recording"||o==="paused")&&e.jsxs("button",{onClick:F,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:c?"14px 16px":"14px 24px",flex:c?1:"none",backgroundColor:x.cardBgHover,color:x.textMain,fontSize:c?"15px":"16px"},children:[e.jsx(me,{className:"w-[18px] h-[18px]",style:{color:x.success}}),N?.submitButton||"Antwort abgeben"]})]}),o==="idle"&&!p&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:x.textMuted},children:N?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),p&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(He,{className:"w-8 h-8 animate-spin",style:{color:l}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:x.textSecondary},children:N?.analyzing||"Antwort wird analysiert..."})]})]})},nt={target:te,clock:J,mic:Z,"message-square":de,lightbulb:V,brain:Ve,info:xe,settings:Oe,check:me,Target:te,Clock:J,Mic:Z,MessageSquare:de,Lightbulb:V,Brain:Ve},ds=({scenario:t,variables:r,questions:d,onStart:s,onBack:a,selectedMicrophoneId:l,onMicrophoneChange:p,onMicrophoneTest:N,themedGradient:w,primaryAccent:x,primaryAccentLight:c,isLoading:b,branding:o})=>{const A=t?.mode==="SIMULATION",y=A?"Situationen":"Fragen",h=A?"Zeit pro Situation":"Zeit pro Frage",R=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) f√ºr Beispiele aus deiner Erfahrung."},{icon:J,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${A?"Situation":"Frage"}. ${A?"Reagiere":"Antworte"} pr√§zise, aber ausf√ºhrlich genug.`},{icon:Z,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind v√∂llig in Ordnung."},{icon:de,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo m√∂glich."}],T=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((n,m)=>typeof n=="string"?{icon:V,title:`Tipp ${m+1}`,description:n}:{icon:nt[n.icon]||nt[n.icon?.toLowerCase()]||V,title:n.title||`Tipp ${m+1}`,description:n.text||n.description||""}):R,C=i.useMemo(()=>{if(!t?.input_configuration)return{};try{const n=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(n)?n.reduce((m,z)=>(z.key&&z.label&&(m[z.key]=z.label),m),{}):{}}catch{return{}}},[t?.input_configuration]),f=r?Object.entries(r).filter(([n,m])=>m&&m.trim&&m.trim()!=="").map(([n,m])=>({label:C[n]||n.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase()),value:m})):[],u=n=>{if(!n||!r)return n;let m=n;return Object.entries(r).forEach(([z,I])=>{I&&(m=m.replace(new RegExp(`\\$\\{${z}\\}`,"g"),I),m=m.replace(new RegExp(`\\{${z}\\}`,"g"),I))}),m};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:o.textSecondary},children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:w},children:e.jsx(V,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:o.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:o.textSecondary},children:[t.title,d.length>0?` ‚Ä¢ ${d.length} ${y}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:w},children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:o.textMain},children:"Deine Aufgabe"}),e.jsx("p",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:o.textSecondary},children:u(t.long_description?.replace(/\/n/g,`
`))})]})]})}),f.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:c},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:x},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:f.map((n,m)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:n.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:o.textMain},children:n.value})]},m))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Z,{className:"w-[22px] h-[22px]",style:{color:x}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Mikrofon testen"})]}),e.jsx(ht,{selectedDeviceId:l,onDeviceChange:p,onTestClick:N})]}),e.jsxs("button",{onClick:s,disabled:b,className:"w-full py-[18px] px-7 rounded-[14px] border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 transition-all",style:{background:b?o.borderColor:w,boxShadow:b?"none":`0 4px 12px ${x}4d`,cursor:b?"not-allowed":"pointer"},children:[e.jsx(Ze,{className:"w-6 h-6"}),"Gespr√§ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(V,{className:"w-[22px] h-[22px]",style:{color:o.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:o.textMain},children:"Tipps f√ºr dein Gespr√§ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:T.map((n,m)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:o.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:c},children:e.jsx(n.icon,{className:"w-[22px] h-[22px]",style:{color:x}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:o.textMain},children:n.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:o.textSecondary},children:n.description})]})]},m))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:o.cardBgHover},children:[d.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:y}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:d.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:h}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:o.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:o.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},us=({isOpen:t,onClose:r,onConfirm:d,answeredCount:s,totalCount:a,labels:l})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:r,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(mt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),s>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:l.answeredCount(s,a)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["M√∂chtest du das Training jetzt mit den bisherigen Antworten abschlie√üen oder weitere ",l.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",l.questionsLabel," beantwortet. M√∂chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:d,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,xs=({isOpen:t,onClose:r,onConfirm:d,answeredCount:s,labels:a})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:r,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(ue,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",s>0?` (${s} ${a.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Zur√ºck"}),e.jsx("button",{onClick:d,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,ms=({number:t,size:r="md"})=>{const d={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${d[r]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},Le=({question:t,index:r,labels:d,isMobile:s})=>e.jsxs(ke,{className:s?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(ms,{number:r+1,size:s?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||d.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${s?"text-[15px]":"text-lg"} mb-0`,children:t?.question||d.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(J,{size:s?14:16}),d.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),at=({error:t,onRetry:r,isMobile:d})=>e.jsxs("div",{className:`flex flex-col items-center ${d?"p-4":"p-5 mt-4"} rounded-xl bg-red-50`,children:[e.jsx(ue,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500 font-medium text-sm text-center",children:t}),e.jsx(oe,{variant:"danger",size:"sm",onClick:r,className:"mt-3",children:"Erneut versuchen"})]}),ps=({session:t,questions:r,scenario:d,variables:s,preloadedQuestions:a,onSessionCreated:l,onComplete:p,onExit:N,startFromQuestion:w=0,initialMicrophoneId:x})=>{const c=Kt(),[b,o]=i.useState(t),[A,y]=i.useState(r||[]),[h,R]=i.useState(!1),[T,C]=i.useState(null),{demoCode:f,branding:u}=Ge(),n=d?.mode==="SIMULATION",m={questionLabel:n?"Situation / Aussage des Gegen√ºbers:":"Interviewfrage:",questionFallback:n?"Situation":"Frage",questionLoading:n?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:n?"Deine Reaktion...":"Deine Antwort...",submitButton:n?"Reaktion abgeben":"Antwort abgeben",submitHint:n?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:n?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(_,D)=>n?`Situation ${_} von ${D}`:`Frage ${_} von ${D}`,questionsCount:_=>n?`${_} Situationen`:`${_} Fragen`,answeredCount:(_,D)=>n?`${_} von ${D} Situationen`:`${_} von ${D} Fragen`,tipsLabel:n?"Tipps f√ºr diese Situation":"Tipps f√ºr diese Frage",nextButton:n?"N√§chste Situation":"N√§chste Frage",timePerQuestion:n?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:n?"Situationen":"Fragen",recommendedTime:n?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},z=w>0,I=z?Array.from({length:w},(_,D)=>D):[],[B,$]=i.useState(z?"interview":"preparation"),[E,P]=i.useState(w||b?.current_question_index||0),[j,g]=i.useState(null),[S,M]=i.useState(!1),[F,v]=i.useState(!1),[O,k]=i.useState(null),[se,pe]=i.useState([]),[X,he]=i.useState(I),L="karriereheld_selected_microphone",[G,fe]=i.useState(()=>{if(x)return x;try{return localStorage.getItem(L)||null}catch{return null}}),[Ee,ge]=i.useState(!1),[bt,ie]=i.useState(!1),be=i.useRef(null),je=i.useCallback(()=>{be.current&&(be.current.getTracks().forEach(_=>_.stop()),be.current=null)},[]),Qe=i.useCallback(_=>{be.current=_},[]);i.useEffect(()=>()=>{je()},[je]),i.useEffect(()=>{if(G)try{localStorage.setItem(L,G)}catch{}},[G]);const[jt,Re]=i.useState(!1),[yt,Fe]=i.useState(!1),[ye,Ue]=i.useState(!1),[le,we]=i.useState(null),[Q,Je]=i.useState(!1),U=A[E],re=E===A.length-1,Xe=E===0,Ye=async(_,D)=>{if(D<2){k("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(_.size<5e3){console.warn("[SimulatorSession] Audio too small:",_.size,"bytes"),k("Die Aufnahme enth√§lt keine verwertbaren Audiodaten. Bitte sprechen Sie w√§hrend der Aufnahme und versuchen Sie es erneut.");return}v(!0),k(null);try{const q=await K.submitSimulatorAnswer(b.id,_,E,U.question,U.category,D);if(!q.success)throw new Error(q.message||"Fehler beim Analysieren der Antwort");if(g(q.data),M(!0),pe(H=>[...H.filter(Y=>Y.questionIndex!==E),{questionIndex:E,feedback:q.data}]),he(H=>H.includes(E)?H:[...H,E]),n&&!Q){Ue(!0),we(null);const H=X.includes(E);try{const Y=await K.generateNextTurn(b.id);if(Y.success){const ne=Y.data.next_question;Y.data.is_finished?(we(ne),y(H?ee=>{const ce=[...ee];return ce[E+1]=ne,ce.slice(0,E+2)}:ee=>[...ee,ne]),Je(!0)):(we(ne),H?(y(ee=>{const ce=[...ee];return ce[E+1]=ne,ce.slice(0,E+2)}),Je(!1)):y(ee=>[...ee,ne]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{Ue(!1)}}}catch(q){console.error("Error submitting answer:",q),k(q.message||"Ein Fehler ist aufgetreten")}finally{v(!1)}},Te=()=>{g(null),M(!1),k(null)},Ie=()=>{if(g(null),M(!1),k(null),n){if(le){P(_=>_+1),we(null);return}if(Q){Se();return}}else re||P(_=>_+1)},wt=()=>{g(null),M(!1),k(null),Xe||P(_=>_-1)},St=()=>{Re(!0)},Se=async()=>{Re(!1),ie(!1),ge(!1),je();try{const _=await K.completeSimulatorSession(b.id);_.success?p(_.data):p({session:{...b,status:"completed"}})}catch(_){console.error("Error completing session:",_),p({session:{...b,status:"completed"}})}},vt=()=>{Fe(!0)},Nt=()=>{Fe(!1),ie(!1),ge(!1),je(),N()},kt=async()=>{if(b&&A.length>0){$("interview");return}R(!0),C(null);try{const _=await K.createSimulatorSession({scenario_id:d.id,variables:s,demo_code:f||null,questions:a||null});if(!_.success)throw new Error(_.message||"Fehler beim Erstellen der Session");const D=_.data.session;let q;if(a&&a.length>0)q=a,await K.updateSimulatorSessionQuestions(D.id,q);else{const H=await K.generateSimulatorQuestions(D.id);if(!H.success)throw new Error(H.message||"Fehler beim Generieren der Fragen");q=H.data.questions}o({...D,questions_json:q}),y(q),l&&l({session:{...D,questions_json:q},questions:q,selectedMicrophoneId:G}),$("interview")}catch(_){console.error("Error creating session:",_),C(_.message||"Ein Fehler ist aufgetreten")}finally{R(!1)}};if(B==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(ds,{scenario:d,variables:s,questions:A,onStart:kt,onBack:N,selectedMicrophoneId:G,onMicrophoneChange:fe,onMicrophoneTest:()=>ge(!0),themedGradient:u?.["--button-gradient"]||u?.["--header-gradient"],primaryAccent:u?.["--primary-accent"],primaryAccentLight:u?.["--primary-accent-light"],isLoading:h}),e.jsx(ft,{isOpen:Ee,onClose:()=>ge(!1),deviceId:G}),T&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:T}),e.jsx(gt,{isLoading:h,message:n?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const Ct=S&&(n&&Q&&!le||!n&&re);return e.jsxs("div",{className:`${c?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${c?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${c?"text-lg":"text-xl"} font-semibold text-slate-900`,children:d?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${c?"justify-between":"justify-end"}`,children:[!Ct&&e.jsxs("button",{onClick:St,className:`${c?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 transition-colors`,children:[e.jsx(mt,{size:16}),c?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:vt,className:`${c?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Dt,{size:16}),"Abbrechen"]})]})]}),e.jsx(us,{isOpen:jt,onClose:()=>Re(!1),onConfirm:Se,answeredCount:X.length,totalCount:A.length,labels:m}),e.jsx(xs,{isOpen:yt,onClose:()=>Fe(!1),onConfirm:Nt,answeredCount:X.length,labels:m}),!S&&!n&&e.jsxs("div",{className:`flex ${c?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(oe,{variant:"secondary",size:c?"sm":"md",icon:e.jsx(qt,{size:16}),onClick:wt,disabled:Xe,className:c?"flex-1":"",children:"Zur√ºck"}),e.jsx(oe,{variant:"secondary",size:c?"sm":"md",iconPosition:"right",icon:e.jsx(qe,{size:16}),onClick:Ie,disabled:re,className:c?"flex-1":"",children:c?"√úberspringen":"Frage √ºberspringen"})]}),e.jsx(Qt,{current:E,total:A.length,answeredQuestions:X,primaryAccent:u?.["--primary-accent"],labels:m}),S?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[d.allow_retry&&e.jsx(oe,{variant:"secondary",icon:e.jsx(We,{size:16}),onClick:Te,children:"Nochmal versuchen"}),e.jsxs(oe,{onClick:n?Q&&!le?Se:Ie:re?Se:Ie,disabled:n&&ye&&!Q,icon:ye?e.jsx(He,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[n&&ye&&!Q?"Gespr√§chspartner tippt...":n?Q&&!le?"Training abschlie√üen":m.nextButton:re?"Training abschlie√üen":m.nextButton,!ye&&!(n?Q&&!le:re)&&e.jsx(qe,{size:16,className:"ml-1"})]})]}),e.jsx(Le,{question:U,index:E,labels:m,isMobile:c}),e.jsx("div",{className:"mt-4",children:e.jsx(is,{transcript:j.transcript,feedback:j.feedback,audioMetrics:j.audio_analysis,audioUrl:j.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${c?"gap-4":"gap-6"}`,children:[c?e.jsxs(e.Fragment,{children:[e.jsx(Le,{question:U,index:E,labels:m,isMobile:!0}),e.jsx(rt,{onRecordingComplete:Ye,timeLimit:d.time_limit_per_question||120,disabled:!1,deviceId:G,themedGradient:u?.["--button-gradient"]||u?.["--header-gradient"],primaryAccent:u?.["--primary-accent"],isSubmitting:F,labels:m,onOpenSettings:()=>ie(!0),isMobile:!0,onStreamChange:Qe}),O&&e.jsx(at,{error:O,onRetry:Te,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(rt,{onRecordingComplete:Ye,timeLimit:d.time_limit_per_question||120,disabled:!1,deviceId:G,themedGradient:u?.["--button-gradient"]||u?.["--header-gradient"],primaryAccent:u?.["--primary-accent"],isSubmitting:F,labels:m,onOpenSettings:()=>ie(!0),isMobile:!1,onStreamChange:Qe}),O&&e.jsx(at,{error:O,onRetry:Te,isMobile:!1})]}),e.jsx(Le,{question:U,index:E,labels:m,isMobile:!1})]}),U?.tips&&U.tips.length>0&&e.jsx(ls,{tips:U.tips,primaryAccent:u?.["--primary-accent"],tipsLabel:m.tipsLabel})]}),e.jsx(Jt,{isOpen:bt,onClose:()=>ie(!1),mode:"audio",selectedMicrophoneId:G,onMicrophoneChange:fe})]})},Ne=({score:t,label:r,primaryAccent:d,b:s})=>{const a=t!=null?t*10:null,l=Zt(a,d);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:l},children:a!=null?Math.round(a):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:r})]})},De=({icon:t,value:r,label:d,primaryAccent:s,b:a})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:s}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:r}),e.jsx("div",{className:"text-xs text-slate-500",children:d})]})]}),hs=({session:t,scenario:r,onBackToDashboard:d,onStartNew:s})=>{const a=Ke(),l=t.summary_feedback||t.summary_feedback_json,p=l?typeof l=="string"?JSON.parse(l):l:null,N=t.overall_score||p?.overall_score||0,w=N<=10?N*10:N,c=(b=>b>=90?{text:"Ausgezeichnet!",emoji:"üåü"}:b>=80?{text:"Sehr gut!",emoji:"üéâ"}:b>=70?{text:"Gut!",emoji:"üëè"}:b>=60?{text:"Solide Leistung",emoji:"üëç"}:b>=50?{text:"Ausbauf√§hig",emoji:"üí™"}:{text:"Weiter √ºben!",emoji:"üìö"})(w);return e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:a.headerGradient,boxShadow:`0 8px 24px ${a.primaryAccent}4d`},children:e.jsx(xt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",c.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[r?.title||"Skill Training"," - ",c.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${a.primaryAccent}`,backgroundColor:a.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:a.primaryAccent},children:w?Math.round(w):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:w?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(De,{icon:me,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:a.primaryAccent,b:a}),e.jsx(De,{icon:te,value:p?.average_content_score?Math.round(p.average_content_score*10):"-",label:"√ò Inhalt",primaryAccent:a.primaryAccent,b:a}),e.jsx(De,{icon:Ot,value:p?.average_delivery_score?Math.round(p.average_delivery_score*10):"-",label:"√ò Pr√§sentation",primaryAccent:a.primaryAccent,b:a})]}),p?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Ne,{score:p.scores.content,label:"Inhalt",primaryAccent:a.primaryAccent,b:a}),e.jsx(Ne,{score:p.scores.structure,label:"Struktur",primaryAccent:a.primaryAccent,b:a}),e.jsx(Ne,{score:p.scores.relevance,label:"Relevanz",primaryAccent:a.primaryAccent,b:a}),e.jsx(Ne,{score:p.scores.delivery,label:"Pr√§sentation",primaryAccent:a.primaryAccent,b:a})]}),p?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:p.summary})]}),p?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"üí° Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:p.key_takeaways.map((b,o)=>e.jsx("li",{className:"mb-2",children:b},o))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:d,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur √úbersicht"]}),e.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-none text-white text-base font-semibold cursor-pointer transition-all hover:-translate-y-0.5",style:{background:a.buttonGradient,boxShadow:`0 4px 12px ${a.primaryAccent}4d`},children:[e.jsx(We,{className:"w-[18px] h-[18px]"}),"Nochmal √ºben"]})]})]})},W={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Is=({isAuthenticated:t,requireAuth:r,setPendingAction:d,pendingContinueSession:s,clearPendingContinueSession:a,pendingRepeatSession:l,clearPendingRepeatSession:p,onNavigateToHistory:N})=>{const[w,x]=i.useState(W.DASHBOARD),[c,b]=i.useState(null),[o,A]=i.useState(null),[y,h]=i.useState([]),[R,T]=i.useState({}),[C,f]=i.useState(null),[u,n]=i.useState(null),[m,z]=i.useState(null),[I,B]=i.useState(0);i.useEffect(()=>{m&&t&&(b(m),x(W.VARIABLES),z(null))},[m,t]),i.useEffect(()=>{if(s&&t){const{session:v,scenario:O}=s,k=v.questions||v.questions_json,se=typeof k=="string"?JSON.parse(k):k||[],pe=v.completed_questions||v.answered_count||0;b(O||{id:v.scenario_id,title:v.scenario_title}),A(v),h(se),T({}),B(pe),x(W.SESSION),a&&a()}},[s,t,a]),i.useEffect(()=>{if(l&&t){const{session:v,scenario:O}=l,k=v.questions||v.questions_json,se=typeof k=="string"?JSON.parse(k):k||[];b(O||{id:v.scenario_id,title:v.scenario_title}),h(se),T({}),B(0),x(W.SESSION),p&&p()}},[l,t,p]),i.useEffect(()=>{window.scrollTo(0,0)},[w]);const $=i.useCallback(v=>{b(v),x(W.VARIABLES)},[]),E=i.useCallback(()=>{b(null),A(null),h([]),T({}),f(null),B(0),n(null),x(W.DASHBOARD)},[]),P=i.useCallback(v=>{T(v),x(W.SESSION)},[]),j=i.useCallback(v=>{A(v.session),h(v.questions),v.selectedMicrophoneId&&n(v.selectedMicrophoneId)},[]),g=i.useCallback(v=>{f(v.session),x(W.COMPLETE)},[]),S=i.useCallback(()=>{E()},[E]),M=i.useCallback(()=>{A(null),h([]),f(null),B(0),n(null),x(W.VARIABLES)},[]),F=()=>{switch(w){case W.DASHBOARD:return e.jsx(st,{onSelectScenario:$,isAuthenticated:t,requireAuth:r,setPendingScenario:z,onNavigateToHistory:N});case W.VARIABLES:return e.jsx(ns,{scenario:c,onBack:E,onNext:P});case W.SESSION:return e.jsx(ps,{session:o,questions:y,scenario:c,variables:R,preloadedQuestions:y.length>0?y:null,onSessionCreated:j,onComplete:g,onExit:S,startFromQuestion:I,initialMicrophoneId:u});case W.COMPLETE:return e.jsx(hs,{session:C,scenario:c,onBackToDashboard:E,onStartNew:M});default:return e.jsx(st,{onSelectScenario:$,isAuthenticated:t,requireAuth:r,setPendingScenario:z,onNavigateToHistory:N})}};return e.jsx("div",{className:"min-h-full",children:F()})},ot={target:te,clock:J,mic:Z,"message-square":de,lightbulb:V,brain:Ve,info:xe,check:me,sparkles:_e},fs=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) f√ºr Beispiele."},{icon:J,title:"Zeit im Blick",description:"Antworte pr√§zise, aber ausf√ºhrlich genug."},{icon:Z,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind v√∂llig in Ordnung."}],Bs=({scenario:t,onBack:r,onStart:d,preloadedQuestions:s})=>{const[a,l]=i.useState({}),[p,N]=i.useState({}),[w,x]=i.useState(!1),[c,b]=i.useState(null),[o,A]=i.useState(null),[y,h]=i.useState(!1),[R,T]=i.useState([]),[C,f]=i.useState(!1),{demoCode:u}=Ge(),n=pt.useMemo(()=>{if(!t?.input_configuration)return[];try{const j=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(j)?j.filter(g=>g.user_input!==!1):[]}catch(j){return console.error("Error parsing input_configuration:",j),[]}},[t?.input_configuration]);i.useEffect(()=>{const j={};n.forEach(g=>{g.default&&(j[g.key]=g.default)}),l(j)},[n]);const m=(j,g)=>{if(!j)return j;let S=j;return Object.entries(g||{}).forEach(([M,F])=>{F&&(S=S.replace(new RegExp(`\\$\\{${M}\\}`,"g"),F),S=S.replace(new RegExp(`\\{${M}\\}`,"g"),F))}),S},z=(j,g)=>{l(S=>({...S,[j]:g})),p[j]&&N(S=>{const M={...S};return delete M[j],M})},I=()=>{T(j=>[...j,{key:"",value:""}])},B=(j,g,S)=>{T(M=>{const F=[...M];return F[j]={...F[j],[g]:S},F})},$=j=>{T(g=>g.filter((S,M)=>M!==j))},E=()=>{const j={};return n.forEach(g=>{const S=a[g.key];if(g.required&&(!S||S.trim()==="")){j[g.key]="Dieses Feld ist erforderlich";return}if(!(!S||S.trim()==="")&&g.validation){const{minLength:M,maxLength:F,min:v,max:O,pattern:k}=g.validation;M&&S.length<M&&(j[g.key]=`Mindestens ${M} Zeichen erforderlich`),F&&S.length>F&&(j[g.key]=`Maximal ${F} Zeichen erlaubt`),v!==void 0&&Number(S)<v&&(j[g.key]=`Mindestens ${v}`),O!==void 0&&Number(S)>O&&(j[g.key]=`Maximal ${O}`),k&&!new RegExp(k).test(S)&&(j[g.key]="Ung√ºltiges Format")}}),N(j),Object.keys(j).length===0},P=async j=>{if(j.preventDefault(),b(null),!!E()){x(!0);try{const g={...a};R.forEach(v=>{v.key&&v.value&&(g[v.key]=v.value)});const S=await K.createSimulatorSession({scenario_id:t.id,variables:g,demo_code:u||null,questions:s||null});if(!S.success)throw new Error(S.message||"Fehler beim Erstellen der Session");const M=S.data.session;let F;if(s&&s.length>0)F=s,await K.updateSimulatorSessionQuestions(M.id,F);else{const v=await K.generateSimulatorQuestions(M.id);if(!v.success)throw new Error(v.message||"Fehler beim Generieren der Fragen");F=v.data.questions}d({session:{...M,questions_json:F},questions:F,scenario:t,variables:g,selectedMicrophoneId:o})}catch(g){console.error("Error starting session:",g),b(g.message||"Ein Fehler ist aufgetreten")}finally{x(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(Ae,{className:"w-[18px] h-[18px]"}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(_e,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ke,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:m(t.long_description?.replace(/\/n/g,`
`),a)})]})]})}),(()=>{const j=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((g,S)=>typeof g=="string"?{icon:V,title:`Tipp ${S+1}`,description:g}:{icon:ot[g.icon]||ot[g.icon?.toLowerCase()]||V,title:g.title||`Tipp ${S+1}`,description:g.text||g.description||""}):fs;return e.jsxs(ke,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps f√ºr dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:j.map((g,S)=>{const M=g.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:g.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:g.description})]})]},S)})})]})})(),e.jsxs("form",{onSubmit:P,children:[n.length>0?n.map(j=>e.jsx(Xt,{field:j,value:a[j.key],onChange:z,error:p[j.key]},j.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(me,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zus√§tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>f(!C),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${C?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[C?e.jsx(Pe,{size:18}):e.jsx(Me,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"Zus√§tzliche Variablen hinzuf√ºgen (optional)"})]}),C&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"F√ºge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflie√üen sollen."}),R.length>0&&e.jsx("div",{className:"mb-3",children:R.map((j,g)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:j.key||"",onChange:S=>B(g,"key",S.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>$(g),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:18})})]}),e.jsx("textarea",{value:j.value||"",onChange:S=>B(g,"value",S.target.value),placeholder:"Wert eingeben... (mehrzeilig m√∂glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},g))}),e.jsxs("button",{type:"button",onClick:I,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Ce,{size:16}),"Variable hinzuf√ºgen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ke,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Z,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon ausw√§hlen"})]}),e.jsx(ht,{selectedDeviceId:o,onDeviceChange:A,onTestClick:()=>h(!0)})]}),c&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(ue,{className:"w-[18px] h-[18px]"}),c]}),e.jsx(oe,{type:"submit",disabled:w,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(ct,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(ft,{isOpen:y,onClose:()=>h(!1),deviceId:o}),e.jsx(gt,{isLoading:w,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{xs as CancelConfirmDialog,us as CompleteConfirmDialog,is as ImmediateFeedback,ds as PreSessionView,ls as QuestionTips,hs as SessionComplete,cs as SessionTimer,Is as SimulatorApp,rt as SimulatorAudioRecorder,st as SimulatorDashboard,ps as SimulatorSession,Bs as SimulatorWizard};
