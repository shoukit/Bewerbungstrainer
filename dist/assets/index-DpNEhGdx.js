import{j as e,D as he,J as ue,T as ye,q as re,b as F,Z as ge,av as fe,R as q,m as v,Q as G,E as oe,O as me,A as se,p as ne,a as Se,aa as ae,aw as je,y as ce,aq as we,k as ve,ad as ke}from"./ui-vendor-BAEfSb-X.js";import{a as n}from"./react-vendor-uDOJF2jQ.js";import{u as ze}from"./useMobile-YxjH166V.js";import{F as be,k as Ce,v as Re,l as Ie,m as _e,M as Me,n as Ae}from"./index.js";import{C as j,w as K,G as ie,u as Te,D as Z}from"./designTokens-LSOQEIoP.js";import{a as Be,M as We}from"./MicrophoneTestDialog-Bxd46hzl.js";import{u as Y}from"./useBranding-CRmuKfX5.js";import{V as De,S as Ee,a as Oe}from"./ScenarioCard-Da4NRxEW.js";import"./utils-BEHD0UYf.js";const le={rocket:q,shuffle:fe,zap:ge},N=({icon:r,label:d,value:a,primaryAccent:y,primaryAccentLight:o,isMobile:c,b:t})=>e.jsxs("div",{style:{backgroundColor:"white",borderRadius:c?t.radius.md:t.radius.lg,padding:c?t.space[3]:t.space[4],border:`1px solid ${j.slate[200]}`},children:[e.jsx("div",{style:{width:c?"32px":"40px",height:c?"32px":"40px",borderRadius:c?t.radius.sm:t.radius.md,backgroundColor:o,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:c?t.space[2]:t.space[3]},children:e.jsx(r,{style:{width:c?"16px":"20px",height:c?"16px":"20px",color:y}})}),e.jsx("div",{style:{fontSize:c?t.fontSize.xl:t.fontSize["2xl"],fontWeight:700,color:j.slate[900]},children:a}),e.jsx("div",{style:{fontSize:c?t.fontSize["2xs"]:t.fontSize.xs,color:j.slate[500]},children:d})]}),$e=({mode:r,onBack:d,onStart:a})=>{const[y,o]=n.useState(""),[c,t]=n.useState(!1),[p,g]=n.useState(null),[m,h]=n.useState(!1),k=le[r.icon]||q;ie[r.id]||ie.klassiker;const i=Y();n.useEffect(()=>{r.id==="klassiker"?o(r.topic):r.getTopic&&o(r.getTopic())},[r]);const R=()=>{if(!r.getTopic)return;t(!0);const s=1500,B=100;let I=0;const O=setInterval(()=>{o(r.getTopic()),I+=B,I>=s&&(clearInterval(O),t(!1))},B)},T=()=>{a({mode:r,topic:y,duration:r.duration,selectedMicrophoneId:p})};return e.jsxs("div",{style:{minHeight:"100%",display:"flex",flexDirection:"column",padding:i.space[6]},children:[e.jsxs(v.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:d,style:{display:"flex",alignItems:"center",gap:i.space[2],padding:`${i.space[2.5]} ${i.space[4]}`,backgroundColor:"white",border:`1px solid ${j.slate[200]}`,borderRadius:i.radius.md,color:j.slate[600],fontSize:i.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:i.space[8],width:"fit-content"},children:[e.jsx(G,{style:{width:"18px",height:"18px"}}),"ZurÃ¼ck zur Auswahl"]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",maxWidth:"600px",margin:"0 auto",width:"100%"},children:[e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},style:{textAlign:"center",marginBottom:i.space[8]},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:i.radius["2xl"],background:i.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:`0 auto ${i.space[5]}`,boxShadow:i.coloredShadow(i.primaryAccent,"lg")},children:e.jsx(k,{style:{width:"40px",height:"40px",color:"white"}})}),e.jsx("h1",{style:{fontSize:i.fontSize["3xl"],fontWeight:700,color:j.slate[900],margin:`0 0 ${i.space[2]} 0`},children:r.title}),e.jsxs("p",{style:{fontSize:i.fontSize.md,color:j.slate[500],margin:0},children:[r.duration," Sekunden â€¢ ",r.subtitle]})]}),e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{width:"100%",background:i.headerGradient,borderRadius:i.radius["2xl"],padding:i.space[8],marginBottom:i.space[6],boxShadow:i.coloredShadow(i.primaryAccent,"xl")},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:i.space[5]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2.5],color:"rgba(255,255,255,0.9)"},children:[e.jsx(oe,{style:{width:"20px",height:"20px"}}),e.jsx("span",{style:{fontWeight:600,fontSize:i.fontSize.md},children:r.id==="klassiker"?"Deine Aufgabe":r.id==="stress"?"Die Frage":"Dein Thema"})]}),r.getTopic&&e.jsxs(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:R,disabled:c,style:{display:"flex",alignItems:"center",gap:i.space[2],padding:`${i.space[2.5]} ${i.space[4.5]}`,backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:i.radius.md,color:"white",fontSize:i.fontSize.sm,fontWeight:600,cursor:c?"not-allowed":"pointer"},children:[e.jsx(me,{style:{width:"16px",height:"16px",animation:c?"spin 0.5s linear infinite":"none"}}),c?"Dreht...":"Neu wÃ¼rfeln"]})]}),e.jsx(se,{mode:"wait",children:e.jsxs(v.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},style:{fontSize:i.fontSize["2xl"],fontWeight:600,color:"white",margin:0,lineHeight:1.5,minHeight:"66px"},children:['"',y,'"']},y)})]}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},style:{width:"100%",backgroundColor:"white",borderRadius:i.radius.xl,padding:i.space[6],marginBottom:i.space[6],border:`1px solid ${j.slate[200]}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2.5],marginBottom:i.space[4],color:j.slate[700]},children:[e.jsx(ne,{style:{width:"20px",height:"20px",color:i.primaryAccent}}),e.jsx("span",{style:{fontWeight:600,fontSize:i.fontSize.md},children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Be,{selectedDeviceId:p,onDeviceChange:g,onTestClick:()=>h(!0)})]}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{width:"100%",backgroundColor:j.slate[50],borderRadius:i.radius.xl,padding:i.space[5],marginBottom:i.space[8]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:i.space[2],marginBottom:i.space[3],color:j.slate[700]},children:[e.jsx(Se,{style:{width:"18px",height:"18px",color:j.amber[500]}}),e.jsx("span",{style:{fontWeight:600,fontSize:i.fontSize.sm},children:"Tipps fÃ¼r deine Antwort"})]}),e.jsxs("ul",{style:{margin:0,paddingLeft:i.space[5],color:j.slate[600],fontSize:i.fontSize.sm,lineHeight:1.7},children:[e.jsx("li",{children:"Atme tief durch bevor du beginnst"}),e.jsx("li",{children:"Sprich in einem ruhigen, gleichmÃ¤ÃŸigen Tempo"}),e.jsx("li",{children:'Mache bewusst Pausen statt "Ã„hm" zu sagen'}),e.jsx("li",{children:"Strukturiere deine Antwort: Einleitung â†’ Hauptteil â†’ Schluss"})]})]}),e.jsxs(v.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:T,style:{width:"100%",maxWidth:"400px",padding:`${i.space[4.5]} ${i.space[8]}`,borderRadius:i.radius.xl,border:"none",background:i.buttonGradient,color:"white",fontSize:i.fontSize.lg,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:i.space[3],boxShadow:i.coloredShadow(i.primaryAccent,"md")},children:[e.jsx(ae,{style:{width:"22px",height:"22px"}}),"Aufnahme starten"]})]}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),e.jsx(We,{isOpen:m,onClose:()=>h(!1),deviceId:p})]})},E={MODES:"modes",TOPIC:"topic"},tt=({onStartGame:r,isAuthenticated:d,requireAuth:a,setPendingAction:y})=>{const[o,c]=n.useState(E.MODES),[t,p]=n.useState(null),[g,m]=n.useState("grid"),[h,k]=n.useState({totalGames:0,bestScore:0,avgScore:0,totalPracticeTime:0}),i=ze(),[R,T]=n.useState(null),s=Y();n.useEffect(()=>{const u=async()=>{try{const z=await K.getGameStats();z.success&&z.data&&k({totalGames:z.data.total_games||0,bestScore:z.data.best_score||0,avgScore:z.data.avg_score||0,totalPracticeTime:z.data.total_practice_time||0})}catch(z){console.error("Failed to load stats:",z)}};o===E.MODES&&u()},[o]),n.useEffect(()=>{R&&d&&(p(R),c(E.TOPIC),T(null))},[R,d]),n.useEffect(()=>{window.scrollTo(0,0)},[o]);const B=u=>{if(!d){T(u),a&&a(()=>{},null);return}p(u),c(E.TOPIC)},I=()=>{p(null),c(E.MODES)},O=u=>{r(u)},W=Object.values(Ce);return o===E.TOPIC&&t?e.jsx($e,{mode:t,onBack:I,onStart:O}):e.jsxs(e.Fragment,{children:[e.jsx(be,{featureId:"rhetorikgym",showOnMount:!0}),e.jsxs("div",{style:{padding:i?s.space[4]:s.space[6]},children:[e.jsxs("div",{style:{marginBottom:i?s.space[5]:s.space[8],textAlign:"center"},children:[e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:i?s.space[2.5]:s.space[3],marginBottom:i?s.space[2]:s.space[3]},children:[e.jsx("div",{style:{width:i?"40px":"48px",height:i?"40px":"48px",borderRadius:i?s.radius.lg:s.radius.xl,background:s.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(he,{style:{width:i?"20px":"24px",height:i?"20px":"24px",color:s.headerText}})}),e.jsx("h1",{style:{fontSize:i?s.fontSize["2xl"]:s.fontSize["3xl"],fontWeight:700,color:j.slate[900],margin:0},children:"Der FÃ¼llwort-Killer"})]}),e.jsx("p",{style:{fontSize:i?s.fontSize.sm:s.fontSize.base,color:j.slate[600],maxWidth:"600px",margin:"0 auto"},children:"Trainiere deine Rhetorik - sprich flÃ¼ssig und Ã¼berzeugend ohne Ã„hm und Ã–h!"})]}),e.jsxs("div",{style:{padding:i?`0 ${s.space[2]}`:`0 ${s.space[6]}`},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:i?"repeat(2, 1fr)":"repeat(auto-fit, minmax(150px, 1fr))",gap:i?s.space[2.5]:s.space[4],marginBottom:i?s.space[6]:s.space[8]},children:[e.jsx(N,{icon:ue,label:"Highscore",value:h.bestScore||"-",primaryAccent:s.primaryAccent,primaryAccentLight:s.primaryAccentLight,isMobile:i,b:s}),e.jsx(N,{icon:ye,label:"Spiele",value:h.totalGames||0,primaryAccent:s.primaryAccent,primaryAccentLight:s.primaryAccentLight,isMobile:i,b:s}),e.jsx(N,{icon:re,label:"Durchschnitt",value:h.avgScore?Math.round(h.avgScore):"-",primaryAccent:s.primaryAccent,primaryAccentLight:s.primaryAccentLight,isMobile:i,b:s}),e.jsx(N,{icon:F,label:"Trainingszeit",value:h.totalPracticeTime?`${Math.round(h.totalPracticeTime/60)}m`:"0m",primaryAccent:s.primaryAccent,primaryAccentLight:s.primaryAccentLight,isMobile:i,b:s})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:s.space[4]},children:[e.jsx("h2",{style:{fontSize:s.fontSize.lg,fontWeight:600,color:j.slate[800],margin:0},children:"WÃ¤hle deinen Modus"}),e.jsx(De,{viewMode:g,onViewChange:m})]}),e.jsx(Ee,{minCardWidth:"280px",viewMode:g,children:W.map(u=>{const z=le[u.icon]||q;return e.jsx(Oe,{title:u.title,subtitle:u.subtitle,description:u.description,icon:z,meta:[{icon:F,text:`${u.duration} Sekunden`}],action:{label:"Starten",icon:re},onClick:()=>B(u),viewMode:g},u.id)})})]})]})]})},f={READY:"ready",COUNTDOWN:"countdown",RECORDING:"recording",PROCESSING:"processing",RESULTS:"results",ERROR:"error"},Ge=({count:r,branding:d})=>e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,backgroundColor:"rgba(15, 23, 42, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:e.jsxs(v.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},style:{color:"white",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"120px",fontWeight:700,marginBottom:"16px"},children:r}),e.jsx("div",{style:{fontSize:"24px",color:d.textMuted},children:r===3?"Mach dich bereit...":r===2?"Durchatmen...":"Los geht's!"})]},r)}),Le=({seconds:r,total:d,isWarning:a,primaryAccent:y,branding:o})=>{const c=r/d*100,t=Math.floor(r/60),p=r%60;return e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"64px",fontWeight:700,fontFamily:"monospace",textAlign:"center",color:a?o.error:o.textMain},children:[t,":",p.toString().padStart(2,"0")]}),e.jsx("div",{style:{marginTop:"16px",height:"8px",backgroundColor:o.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx(v.div,{style:{height:"100%",backgroundColor:a?o.error:y,borderRadius:"4px"},initial:{width:"100%"},animate:{width:`${c}%`},transition:{duration:.5}})})]})},Ne=({word:r,count:d,branding:a})=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:a.space[1],padding:`${a.space[1.5]} ${a.space[3]}`,backgroundColor:a.errorLight,color:a.error,borderRadius:a.radius["2xl"],fontSize:a.fontSize.base,fontWeight:a.fontWeight.medium},children:['"',r,'"',e.jsxs("span",{style:{backgroundColor:`${a.error}30`,padding:`${a.space[.5]||"2px"} ${a.space[1.5]}`,borderRadius:a.radius.md,fontSize:a.fontSize.xs},children:[d,"x"]})]}),Fe=r=>!r||r==="[Keine Sprache erkannt]"?0:r.trim().split(/\s+/).filter(d=>d.length>0).length,Pe=r=>!r||!Array.isArray(r)?0:r.reduce((d,a)=>d+(a.count||0),0),He=(r,d,a,y)=>{const o=Fe(r),c=Pe(d),t=o>0?c/o*100:0,p=y>0?Math.round(o/y*60):0;let g=0;o>=60?g=25:o>=40?g=15:o>=20?g=10:o>=10&&(g=5);let m=25;t>25?m=0:t>15?m=10:t>10?m=15:t>5&&(m=20);let h=0,k="keine_sprache";o>0&&(p>=100&&p<=140?(h=10,k="optimal"):p>=80&&p<100||p>140&&p<=160?(h=5,k=p<100?"zu_langsam":"zu_schnell"):(h=0,k=p<80?"zu_langsam":"zu_schnell"));const i=Math.min(40,Math.max(0,a||0)),R=g+m+h+i;return{total_words:o,filler_count:c,filler_percentage:t,words_per_minute:p,pace_feedback:k,score:R,score_breakdown:{words_score:g,filler_score:m,tempo_score:h,content_score:i}}},Ue=({result:r,onPlayAgain:d,onBack:a,buttonGradient:y,primaryAccent:o,primaryAccentLight:c,branding:t})=>{const p=Ae(r.score),g=r.score>=70,m=r.pace_feedback==="keine_sprache"||r.transcript==="[Keine Sprache erkannt]";return e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsxs("div",{style:{borderRadius:t.radius["2xl"],padding:t.space[8],marginBottom:t.space[6],background:m?`linear-gradient(135deg, ${t.textSecondary} 0%, ${t.textMuted} 100%)`:g?`linear-gradient(135deg, ${t.success} 0%, ${o} 100%)`:`linear-gradient(135deg, ${t.warning} 0%, ${t.warningDark||t.warning} 100%)`,color:"white",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:t.iconSize["4xl"],marginBottom:t.space[2]},children:m?"ðŸŽ¤":p.emoji}),e.jsx("div",{style:{fontSize:"72px",fontWeight:t.fontWeight.bold,marginBottom:t.space[2]},children:r.score}),e.jsx("div",{style:{fontSize:t.fontSize.xl,opacity:.9,marginBottom:t.space[4]},children:"Punkte"}),e.jsx("p",{style:{fontSize:t.fontSize.lg,margin:0},children:m?"Keine Sprache erkannt. Bitte sprich lauter ins Mikrofon.":p.message})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:t.space[3],marginBottom:t.space[6]},children:[e.jsxs("div",{style:{backgroundColor:t.cardBg,borderRadius:t.radius.lg,padding:t.space[3.5],border:`1px solid ${t.borderColor}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:t.space[1.5],color:o,marginBottom:t.space[1.5]},children:[e.jsx(oe,{style:{width:t.iconSize.sm,height:t.iconSize.sm}}),e.jsx("span",{style:{fontWeight:t.fontWeight.medium,fontSize:t.fontSize.sm},children:"WÃ¶rter"})]}),e.jsx("div",{style:{fontSize:t.fontSize["4xl"],fontWeight:t.fontWeight.bold,color:t.textMain},children:r.total_words}),e.jsx("div",{style:{fontSize:t.fontSize["2xs"],color:t.textMuted},children:"gesprochen"})]}),e.jsxs("div",{style:{backgroundColor:t.cardBg,borderRadius:t.radius.lg,padding:t.space[3.5],border:`1px solid ${t.borderColor}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.error,marginBottom:"6px"},children:[e.jsx(ve,{style:{width:"16px",height:"16px"}}),e.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"FÃ¼llwÃ¶rter"})]}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:t.textMain},children:r.filler_count}),e.jsxs("div",{style:{fontSize:"11px",color:t.textMuted},children:[r.filler_percentage?.toFixed(1)||"0","%"]})]}),e.jsxs("div",{style:{backgroundColor:t.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${t.borderColor}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:o,marginBottom:"6px"},children:[e.jsx(ke,{style:{width:"16px",height:"16px"}}),e.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Tempo"})]}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:t.textMain},children:r.words_per_minute}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"WPM"})]}),e.jsxs("div",{style:{backgroundColor:t.cardBg,borderRadius:"12px",padding:"14px",border:`1px solid ${t.borderColor}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:t.textSecondary,marginBottom:"6px"},children:[e.jsx(F,{style:{width:"16px",height:"16px"}}),e.jsx("span",{style:{fontWeight:500,fontSize:"13px"},children:"Sprechzeit"})]}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:t.textMain},children:r.duration_seconds||0}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"Sekunden"})]})]}),r.filler_words&&r.filler_words.length>0&&e.jsxs("div",{style:{backgroundColor:t.cardBg,borderRadius:"12px",padding:"16px",border:`1px solid ${t.borderColor}`,marginBottom:"24px"},children:[e.jsx("h4",{style:{fontWeight:600,color:t.textMain,marginBottom:"12px",fontSize:"15px"},children:"Erkannte FÃ¼llwÃ¶rter"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:r.filler_words.map((h,k)=>e.jsx(Ne,{word:h.word,count:h.count,branding:t},k))})]}),!m&&e.jsxs("div",{style:{backgroundColor:c,border:`1px solid ${o}26`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[e.jsx("h4",{style:{fontWeight:600,color:o,marginBottom:"12px",fontSize:"15px"},children:"Bewertung im Detail"}),r.score_breakdown&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:r.content_feedback?"12px":0},children:[e.jsxs("div",{style:{fontSize:"13px",color:t.textSecondary},children:["ðŸ“ Wortanzahl: ",e.jsxs("strong",{children:[r.score_breakdown.words_score||0,"/25"]})]}),e.jsxs("div",{style:{fontSize:"13px",color:t.textSecondary},children:["ðŸš« FÃ¼llwÃ¶rter: ",e.jsxs("strong",{children:[r.score_breakdown.filler_score||0,"/25"]})]}),e.jsxs("div",{style:{fontSize:"13px",color:t.textSecondary},children:["â±ï¸ Tempo: ",e.jsxs("strong",{children:[r.score_breakdown.tempo_score||0,"/10"]})]}),e.jsxs("div",{style:{fontSize:"13px",color:t.textSecondary},children:["ðŸ’¡ Inhalt: ",e.jsxs("strong",{children:[r.score_breakdown.content_score||0,"/40"]})]})]}),r.content_feedback&&e.jsx("div",{style:{paddingTop:"12px",borderTop:`1px solid ${o}26`},children:e.jsxs("p",{style:{fontSize:"14px",color:t.textSecondary,margin:0,lineHeight:1.5},children:[e.jsx("strong",{children:"Inhaltliches Feedback:"})," ",r.content_feedback]})})]}),r.pace_feedback&&r.pace_feedback!=="optimal"&&r.pace_feedback!=="keine_sprache"&&e.jsxs("div",{style:{backgroundColor:t.warningLight,border:`1px solid ${t.warning}40`,borderRadius:"12px",padding:"16px",marginBottom:"24px"},children:[e.jsx("h4",{style:{fontWeight:600,color:t.warning,marginBottom:"8px",fontSize:"15px"},children:"Tempo-Hinweis"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,margin:0},children:r.pace_feedback==="zu_schnell"?"Du sprichst etwas zu schnell. Versuche, bewusst langsamer und deutlicher zu sprechen.":"Du sprichst etwas zu langsam. Versuche, etwas mehr Energie in deine PrÃ¤sentation zu legen."})]}),r.transcript&&r.transcript!=="[Keine Sprache erkannt]"&&e.jsxs("div",{style:{backgroundColor:t.cardBgHover,borderRadius:"12px",border:`1px solid ${t.borderColor}`,padding:"16px",marginBottom:"32px"},children:[e.jsx("h4",{style:{fontWeight:600,color:t.textMain,marginBottom:"12px",fontSize:"15px"},children:"Transkript"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,lineHeight:1.6,margin:0},children:r.transcript})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("button",{onClick:d,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:"none",background:y,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(ce,{style:{width:"18px",height:"18px"}}),"Nochmal spielen"]}),e.jsxs("button",{onClick:a,style:{flex:1,padding:"14px 24px",borderRadius:"12px",border:`1px solid ${t.borderColor}`,backgroundColor:t.cardBg,color:t.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(G,{style:{width:"18px",height:"18px"}}),"ZurÃ¼ck"]})]})]})},rt=({gameConfig:r,onBack:d,onComplete:a})=>{const[y,o]=n.useState(f.COUNTDOWN),[c,t]=n.useState(3),[p,g]=n.useState(r.duration),[m,h]=n.useState(null),[k,i]=n.useState(null),[R,T]=n.useState(0),[s,B]=n.useState(!1),{branding:I}=Te(),O=I?.["--header-gradient"]||Z["--header-gradient"],W=I?.["--button-gradient"]||O,u=I?.["--primary-accent"]||Z["--primary-accent"],z=I?.["--primary-accent-light"]||Z["--primary-accent-light"],l=Y(),b=n.useRef(null),$=n.useRef([]),P=n.useRef(null),_=n.useRef(null),M=n.useRef(null),H=n.useRef(null),U=n.useRef(null),J=K.getGeminiApiKey(),L=n.useCallback(()=>{P.current&&clearInterval(P.current),H.current&&cancelAnimationFrame(H.current),M.current&&(M.current.close(),M.current=null),b.current&&b.current.state!=="inactive"&&b.current.stop()},[]);n.useEffect(()=>L,[L]),n.useEffect(()=>{s||(B(!0),de())},[s]);const de=async()=>{o(f.COUNTDOWN),t(3);try{const w=r.selectedMicrophoneId?{deviceId:{exact:r.selectedMicrophoneId}}:!0,S=await navigator.mediaDevices.getUserMedia({audio:w});M.current=new(window.AudioContext||window.webkitAudioContext);const A=M.current.createMediaStreamSource(S);_.current=M.current.createAnalyser(),_.current.fftSize=256,A.connect(_.current),b.current=new MediaRecorder(S,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),$.current=[],b.current.ondataavailable=C=>{C.data.size>0&&$.current.push(C.data)};let x=3;const D=setInterval(()=>{x--,t(x),x===0&&(clearInterval(D),X())},1e3)}catch(w){console.error("Microphone access denied:",w),i("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),o(f.ERROR)}},Q=n.useCallback(async()=>{o(f.COUNTDOWN),t(3);try{const w=r.selectedMicrophoneId?{deviceId:{exact:r.selectedMicrophoneId}}:!0,S=await navigator.mediaDevices.getUserMedia({audio:w});M.current=new(window.AudioContext||window.webkitAudioContext);const A=M.current.createMediaStreamSource(S);_.current=M.current.createAnalyser(),_.current.fftSize=256,A.connect(_.current),b.current=new MediaRecorder(S,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),$.current=[],b.current.ondataavailable=C=>{C.data.size>0&&$.current.push(C.data)};let x=3;const D=setInterval(()=>{x--,t(x),x===0&&(clearInterval(D),X())},1e3)}catch(w){console.error("Microphone access denied:",w),i("Bitte erlaube den Zugriff auf das Mikrofon, um zu spielen."),o(f.ERROR)}},[r.selectedMicrophoneId]),X=n.useCallback(()=>{o(f.RECORDING),g(r.duration),U.current=Date.now(),b.current.start();const w=()=>{if(_.current){const S=new Uint8Array(_.current.frequencyBinCount);_.current.getByteFrequencyData(S);const A=S.reduce((x,D)=>x+D)/S.length;T(A/255)}H.current=requestAnimationFrame(w)};w(),P.current=setInterval(()=>{g(S=>S<=1?(ee(),0):S-1)},1e3)},[r.duration]),ee=n.useCallback(()=>{const w=U.current?Math.round((Date.now()-U.current)/1e3):r.duration;L(),o(f.PROCESSING),b.current.onstop=async()=>{const S=new Blob($.current,{type:b.current.mimeType});b.current.stream.getTracks().forEach(x=>x.stop());const A=Re(S,{minSize:Me});if(!A.valid){console.warn("[GameSession] Audio validation failed:",A.error,"Size:",S.size);const x={...Ie("game"),score:0,word_count:0,filler_count:0,words_per_minute:0,duration_seconds:w};h(x),o(f.RESULTS);return}try{const x=await _e(S,J,r.topic,r.duration),C={...He(x.transcript,x.filler_words,x.content_score,w),transcript:x.transcript||"[Keine Sprache erkannt]",filler_words:x.filler_words||[],content_feedback:x.content_feedback||"",duration_seconds:w};h(C),o(f.RESULTS);try{const V={game_type:r.mode.id,topic:r.topic,duration_seconds:w,score:C.score,filler_count:C.filler_count,words_per_minute:C.words_per_minute,transcript:C.transcript,analysis_json:JSON.stringify(C)};await K.createGameSession(V)}catch(V){console.error("[GameSession] Failed to save game session:",V)}}catch(x){console.error("Analysis failed:",x),i(`Analyse fehlgeschlagen: ${x.message}`),o(f.ERROR)}},b.current.stop()},[J,r,L]),pe=()=>{ee()},te=()=>{h(null),i(null),g(r.duration),Q()},xe=()=>{switch(y){case f.READY:return e.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:e.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[e.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:"ðŸŽ¤"}),e.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:l.textMain,marginBottom:"12px"},children:"Bereit?"}),e.jsx("p",{style:{fontSize:"16px",color:l.textSecondary,marginBottom:"24px",lineHeight:1.6},children:r.topic}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:l.cardBgHover,borderRadius:"20px",color:l.textSecondary,fontSize:"14px",marginBottom:"32px"},children:[e.jsx(F,{style:{width:"16px",height:"16px"}}),r.duration," Sekunden"]}),e.jsx("div",{children:e.jsxs("button",{onClick:Q,style:{padding:"16px 40px",borderRadius:"14px",border:"none",background:W,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:`0 4px 14px ${u}66`},children:[e.jsx(ae,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]})}),e.jsxs("button",{onClick:d,style:{marginTop:"24px",padding:"10px 20px",border:"none",backgroundColor:"transparent",color:l.textMuted,fontSize:"14px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(G,{style:{width:"16px",height:"16px"}}),"ZurÃ¼ck zur Auswahl"]})]})});case f.RECORDING:return e.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:e.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[e.jsx(Le,{seconds:p,total:r.duration,isWarning:p<=10,primaryAccent:u,branding:l}),e.jsxs("div",{style:{marginTop:"32px",marginBottom:"32px",padding:"16px",backgroundColor:l.cardBgHover,borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"13px",color:l.textMuted,marginBottom:"4px"},children:"Dein Thema:"}),e.jsx("p",{style:{fontSize:"15px",fontWeight:500,color:l.textMain,margin:0},children:r.topic})]}),e.jsx("div",{style:{marginBottom:"32px"},children:e.jsx(v.div,{style:{height:"80px",background:W,borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},animate:{opacity:.6+R*.4},children:e.jsx(v.div,{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"},animate:{scale:1+R*.3},children:e.jsx(ne,{style:{width:"28px",height:"28px",color:"white"}})})})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"32px"},children:[e.jsx(v.div,{animate:{scale:[1,1.2,1],opacity:1},transition:{repeat:1/0,duration:1},style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:l.error}}),e.jsx("span",{style:{fontWeight:500,color:l.error,fontSize:"14px"},children:"Aufnahme lÃ¤uft..."})]}),e.jsxs("button",{onClick:pe,style:{padding:"12px 24px",borderRadius:"12px",border:"none",backgroundColor:l.error,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(we,{style:{width:"16px",height:"16px"}}),"Aufnahme beenden"]})]})});case f.PROCESSING:return e.jsxs("div",{style:{textAlign:"center",padding:"80px 20px"},children:[e.jsx(v.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},style:{width:"56px",height:"56px",border:`4px solid ${u}`,borderTopColor:"transparent",borderRadius:"50%",margin:"0 auto 24px"}}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:l.textMain,marginBottom:"8px"},children:"Analysiere deine Aufnahme..."}),e.jsx("p",{style:{color:l.textMuted},children:"Der FÃ¼llwort-Killer zÃ¤hlt nach"})]});case f.RESULTS:return e.jsx(Ue,{result:m,onPlayAgain:te,onBack:d,buttonGradient:W,primaryAccent:u,primaryAccentLight:z,branding:l});case f.ERROR:return e.jsx("div",{style:{textAlign:"center",padding:"60px 20px"},children:e.jsxs("div",{style:{maxWidth:"400px",margin:"0 auto"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:l.errorLight,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:e.jsx(je,{style:{width:"32px",height:"32px",color:l.error}})}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:600,color:l.textMain,marginBottom:"12px"},children:"Fehler"}),e.jsx("p",{style:{color:l.textSecondary,marginBottom:"24px"},children:k}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsxs("button",{onClick:te,style:{padding:"12px 24px",borderRadius:"12px",border:"none",background:W,color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(ce,{style:{width:"16px",height:"16px"}}),"Erneut versuchen"]}),e.jsxs("button",{onClick:d,style:{padding:"12px 24px",borderRadius:"12px",border:`1px solid ${l.borderColor}`,backgroundColor:l.cardBg,color:l.textSecondary,fontSize:"14px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(G,{style:{width:"16px",height:"16px"}}),"ZurÃ¼ck"]})]})]})});default:return null}};return e.jsxs("div",{style:{minHeight:"100%",paddingBottom:"32px"},children:[e.jsx(se,{children:y===f.COUNTDOWN&&e.jsx(Ge,{count:c,branding:l})}),y!==f.COUNTDOWN&&y!==f.RECORDING&&e.jsx("div",{style:{padding:"16px 24px",borderBottom:`1px solid ${l.borderColor}`,backgroundColor:l.cardBg,position:"sticky",top:0,zIndex:10},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("button",{onClick:d,style:{display:"flex",alignItems:"center",gap:"6px",border:"none",backgroundColor:"transparent",color:l.textSecondary,fontSize:"14px",cursor:"pointer"},children:[e.jsx(G,{style:{width:"18px",height:"18px"}}),"ZurÃ¼ck"]}),e.jsx("h1",{style:{fontWeight:600,color:l.textMain,fontSize:"16px",margin:0},children:r.mode.title}),e.jsx("div",{style:{width:"60px"}})]})}),e.jsx("div",{style:{padding:"24px"},children:e.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:xe()})})]})};export{rt as GameSession,tt as RhetorikGym};
