import{j as e,e as U,i as Tt,g as X,a as Ie,l as Y,ak as Et,x as Mt,al as zt,r as mt,M as re,z as K,B as be,a2 as xe,J as Me,I as le,w as je,f as Ge,y as Ue,C as $e,ag as ze,Q as xt,E as ye,aa as Ft,ac as pt,T as ht,$ as He,am as gt,h as Ze,a5 as Rt,L as Qe,a6 as It,a7 as Je,a8 as $t,A as Bt,m as Lt,K as Ot,an as Dt,b as ft,X as qt,q as Pt,a1 as Vt}from"./ui-vendor-5MgJaMcm.js";import{a as s,d as Fe}from"./react-vendor-uDOJF2jQ.js";import{k as Wt,F as Kt,g as Zt,a as Gt,b as pe,C as Pe,l as Re,u as bt,w as H,m as Ut}from"./FeatureInfoButton-DKJpBK9J.js";import{S as Ht}from"./ScenarioDashboard-D9WKTzzj.js";import{M as Xe,a as Ye,A as Qt}from"./MicrophoneTestDialog-4n7IehTU.js";import{C as ie,B as me}from"./select-native-DIQ3pQYe.js";import"./dialog-DvONxC4-.js";import{B as Jt}from"./button-BWr_-W7v.js";import{u as Xt}from"./useMobile-YxjH166V.js";import{n as Yt,h as es,A as ts}from"./audioMetricsAdapter-yb4my67J.js";import{P as ss}from"./progress-bar-Btd43BWN.js";import{D as ns}from"./DeviceSettingsDialog-B8qQi37G.js";import{F as jt}from"./fullscreen-loader-BMxOTZY7.js";import{u as rs}from"./Confetti-IPTM93dA.js";import{D as as}from"./DynamicFormField-DQOe3Mvi.js";import"./ScenarioCard-cnbV_gmF.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./DeviceSetupPage-CqMxPqzd.js";const at="[SIMULATOR_DASHBOARD]",is={briefcase:mt,banknote:zt,user:Mt,presentation:Et,target:Y,mic:U},ls=async()=>{const t=await fetch(`${Zt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Gt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const c=await t.json();if(c.success&&c.data?.scenarios)return c.data.scenarios;throw new Error("Keine Szenarien gefunden")},os=t=>is[t.icon]||mt,cs=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],it=({onSelectScenario:t,isAuthenticated:c,requireAuth:r,setPendingScenario:o,onNavigateToHistory:i})=>(s.useEffect(()=>(console.log(`${at} ðŸ”µ MOUNT`),()=>{console.log(`${at} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Wt,{featureId:"simulator",showOnMount:!0}),e.jsx(Ht,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ie,headerActions:e.jsx(Kt,{featureId:"simulator",size:"sm"}),fetchScenarios:ls,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:i,onSelectScenario:t,renderCardMeta:cs,getIconForScenario:os,cardActionLabel:"Starten",cardActionIcon:Tt,categoryField:"category",emptyStateIcon:U,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:c,requireAuth:r,setPendingScenario:o,loadingMessage:"Szenarien werden geladen..."})]})),ds=t=>t?t.split(/(\*\*.*?\*\*)/g).map((r,o)=>r.startsWith("**")&&r.endsWith("**")?e.jsx("strong",{children:r.slice(2,-2)},o):r):null,lt={target:Y,clock:X,mic:U,"message-square":re,lightbulb:K,brain:be,info:le,settings:Me,check:xe,Target:Y,Clock:X,Mic:U,MessageSquare:re,Lightbulb:K,Brain:be},us=({scenario:t,onBack:c,onNext:r,hasVariables:o=!1})=>{const[i,n]=Fe.useState(null),[N,v]=Fe.useState(!1),h=t?.mode==="SIMULATION",T=[{icon:Y,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t?.time_limit_per_question||120)/60)} Minuten pro ${h?"Situation":"Frage"}. ${h?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:U,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:re,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],y=s.useMemo(()=>!t?.tips||!Array.isArray(t.tips)||t.tips.length===0?T:t.tips.map((u,f)=>typeof u=="string"?{icon:K,title:`Tipp ${f+1}`,description:u}:{icon:lt[u.icon]||lt[u.icon?.toLowerCase()]||K,title:u.title||`Tipp ${f+1}`,description:u.text||u.description||""}),[t?.tips,h]),g=()=>{r({selectedMicrophoneId:i})};return e.jsxs("div",{className:"p-6 md:p-8 pb-52 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(je,{size:18}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(K,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600 m-0 mb-1",children:"Vorbereitung"}),e.jsx("h1",{className:"text-[24px] font-bold text-slate-900 m-0",children:t?.title||"Training"})]})]})]}),t?.long_description&&e.jsx(ie,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:ds(t.long_description?.replace(/\/n/g,`
`))})]})]})}),e.jsxs(ie,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3.5 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Tipps fÃ¼r dein GesprÃ¤ch"}),e.jsx("p",{className:"text-sm text-slate-500 m-0 mt-0.5",children:"Beachte diese Hinweise fÃ¼r optimale Ergebnisse"})]})]}),e.jsx("div",{className:"grid gap-3",children:y.map((u,f)=>{const l=u.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(l,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("div",{className:"pt-0.5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 mb-0.5",children:u.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0",children:u.description})]})]},f)})})]}),e.jsxs(ie,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(U,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0",children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:i,onDeviceChange:n,onTestClick:()=>v(!0)})]}),e.jsxs(Jt,{onClick:g,disabled:!i,size:"lg",className:"w-full gap-2.5",children:[o?"Weiter zur Konfiguration":"Training starten",e.jsx(Ge,{className:"w-5 h-5"})]}),e.jsx(Ye,{isOpen:N,onClose:()=>v(!1),deviceId:i})]})},ms=({field:t,value:c,onChange:r,error:o,focusColor:i,branding:n})=>{const N=i||Pe.blue[400],v="w-full rounded-lg text-base outline-none transition-all",h="px-4 py-3",T=o?"border-2 border-red-500":"border-2 border-slate-200",y={borderColor:N,boxShadow:`0 0 0 3px ${N}1a`},g=l=>{Object.assign(l.target.style,y),setTimeout(()=>{const j=l.target;if(j){const R=j.closest("div");R&&R.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=l=>{l.target.style.borderColor=o?Pe.red[500]:Pe.slate[200],l.target.style.boxShadow="none"},f=()=>{const l=`${v} ${h} ${T} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:c||"",onChange:j=>r(t.key,j.target.value),placeholder:t.placeholder||"",className:l,onFocus:g,onBlur:u});case"textarea":return e.jsx("textarea",{value:c||"",onChange:j=>r(t.key,j.target.value),placeholder:t.placeholder||"",rows:4,className:`${l} resize-vertical min-h-[100px]`,onFocus:g,onBlur:u});case"select":return e.jsxs("select",{value:c||t.default||"",onChange:j=>r(t.key,j.target.value),className:`${l} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:g,onBlur:u,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.slice().sort((j,R)=>j.label.localeCompare(R.label,"de")).map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))]});case"number":return e.jsx("input",{type:"number",value:c||"",onChange:j=>r(t.key,j.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:l,onFocus:g,onBlur:u});default:return e.jsx("input",{type:"text",value:c||"",onChange:j=>r(t.key,j.target.value),placeholder:t.placeholder||"",className:l,onFocus:g,onBlur:u})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),f(),o&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),o]}),t.hint&&!o&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(le,{className:"w-3.5 h-3.5"}),t.hint]})]})},xs=({scenario:t,onBack:c,onNext:r})=>{const[o,i]=s.useState({}),[n,N]=s.useState({}),[v,h]=s.useState([]),[T,y]=s.useState(!1),g=pe(),u=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const b=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(b)?b.filter(m=>m.user_input!==!1):[]}catch(b){return console.error("Error parsing input_configuration:",b),[]}},[t?.input_configuration]);s.useEffect(()=>{const b={};u.forEach(m=>{m.default&&(b[m.key]=m.default)}),i(b)},[u]);const f=(b,m)=>{i(a=>({...a,[b]:m})),n[b]&&N(a=>{const S={...a};return delete S[b],S})},l=()=>{h(b=>[...b,{key:"",value:""}])},j=(b,m,a)=>{h(S=>{const A=[...S];return A[b]={...A[b],[m]:a},A})},R=b=>{h(m=>m.filter((a,S)=>S!==b))},L=()=>{const b={};return u.forEach(m=>{const a=o[m.key];if(m.required&&(!a||a.trim()==="")){b[m.key]="Dieses Feld ist erforderlich";return}if(!(!a||a.trim()==="")&&m.validation){const{minLength:S,maxLength:A,min:x,max:k,pattern:M}=m.validation;S&&a.length<S&&(b[m.key]=`Mindestens ${S} Zeichen erforderlich`),A&&a.length>A&&(b[m.key]=`Maximal ${A} Zeichen erlaubt`),x!==void 0&&Number(a)<x&&(b[m.key]=`Mindestens ${x}`),k!==void 0&&Number(a)>k&&(b[m.key]=`Maximal ${k}`),M&&!new RegExp(M).test(a)&&(b[m.key]="UngÃ¼ltiges Format")}}),N(b),Object.keys(b).length===0},C=(b,m)=>{if(b.type!=="select"||!b.options||!m)return null;const a=b.options.find(S=>S.value===m);return a?a.label:m},B=b=>{if(b.preventDefault(),!L())return;const m={...o};v.forEach(a=>{a.key&&a.value&&(m[a.key]=a.value)}),u.forEach(a=>{if(a.type==="select"&&o[a.key]){const S=C(a,o[a.key]);S&&(m[`${a.key}_label`]=S)}}),r(m)};return s.useEffect(()=>{u.length===0&&r({})},[u,r]),u.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(je,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:g.headerGradient},children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:B,children:[u.map(b=>e.jsx(ms,{field:b,value:o[b.key],onChange:f,error:n[b.key],focusColor:g.primaryAccent,branding:g},b.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>y(!T),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:T?g.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[T?e.jsx(Ue,{size:18}):e.jsx($e,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),T&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),v.length>0&&e.jsx("div",{className:"mb-3",children:v.map((b,m)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:b.key||"",onChange:a=>j(m,"key",a.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>R(m),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(xt,{size:16})})]}),e.jsx("textarea",{value:b.value||"",onChange:a=>j(m,"value",a.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},m))}),e.jsxs("button",{type:"button",onClick:l,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(Ge,{className:"w-5 h-5"})]})]})]})},Te=({score:t,label:c,size:r="normal",variant:o="default"})=>{const i=t!=null?t*10:null,N=(h=>o==="white"?"bg-white/20 border-white text-white":h>=80?"bg-green-50 border-green-500 text-green-600":h>=60?"bg-blue-50 border-blue-500 text-blue-600":h>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(i),v=r==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${v?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${N}
      `,children:e.jsx("span",{className:`
          ${v?"text-3xl":"text-2xl"}
          font-bold
        `,children:i!=null?Math.round(i):"-"})}),e.jsx("span",{className:`
        ${v?"text-sm":"text-xs"}
        ${o==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:c})]})},ue=({title:t,icon:c,children:r,defaultOpen:o=!0})=>{const[i,n]=s.useState(o);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(!i),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),i?e.jsx(Ue,{className:"w-5 h-5 text-slate-400"}):e.jsx($e,{className:"w-5 h-5 text-slate-400"})]}),i&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:r})]})},Ve=({text:t,type:c})=>{const r={strength:{icon:pt,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:ht,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:K,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:o,iconClass:i,bgClass:n}=r[c]||r.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${n} mb-2`,children:[e.jsx(o,{className:`w-5 h-5 ${i} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},ps=({audioUrl:t,externalAudioRef:c})=>{const r=s.useRef(null),o=c||r,[i,n]=s.useState(!1),[N,v]=s.useState(0),[h,T]=s.useState(0),[y,g]=s.useState(!0),[u,f]=s.useState(null);s.useEffect(()=>{if(!t)return;g(!0),f(null);const C=new Audio;o.current=C,C.preload="auto";const B=()=>{const A=C.duration;A&&isFinite(A)&&A>0&&T(A)},b=()=>{if(B(),g(!1),!isFinite(C.duration)||C.duration===0){const A=C.currentTime;C.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{B(),C.currentTime=A},100)}},m=()=>{g(!1),B()},a=()=>{B()},S=()=>{v(C.currentTime),B()};return C.addEventListener("loadedmetadata",b),C.addEventListener("canplaythrough",m),C.addEventListener("durationchange",a),C.addEventListener("timeupdate",S),C.addEventListener("play",()=>n(!0)),C.addEventListener("pause",()=>n(!1)),C.addEventListener("ended",()=>n(!1)),C.addEventListener("error",()=>{f("Audio nicht verfÃ¼gbar"),g(!1)}),C.src=t,C.load(),()=>{C.pause(),C.src=""}},[t]);const l=()=>{o.current&&(i?o.current.pause():o.current.play())},j=C=>{const B=C.currentTarget.getBoundingClientRect(),b=(C.clientX-B.left)/B.width;o.current&&h>0&&(o.current.currentTime=b*h)},R=C=>{o.current&&(o.current.currentTime=Math.max(0,Math.min(o.current.currentTime+C,h)))};if(!t)return null;if(u)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(ye,{size:16})," ",u]});const L=h>0?N/h*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:j,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${L}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>R(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Rt,{size:20})}),e.jsx("button",{onClick:l,disabled:y,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${y?"cursor-wait opacity-70":"cursor-pointer"}`,children:y?e.jsx(Qe,{size:20,className:"animate-spin"}):i?e.jsx(It,{size:20,fill:"white"}):e.jsx(Je,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>R(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx($t,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[Re(N)," / ",Re(h)]})]})},hs=({transcript:t,feedback:c,audioMetrics:r,audioUrl:o,onRetry:i,onNext:n,onComplete:N,isLastQuestion:v,hideButtons:h=!1})=>{const T=s.useRef(null),y=typeof c=="string"?JSON.parse(c):c,g=s.useMemo(()=>Yt(r),[r]),u=es(r),f=l=>{T.current&&(T.current.currentTime=l,T.current.play())};return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(Te,{score:y?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:y?.summary||"Deine Antwort wurde analysiert."})]})]}),y?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(Te,{score:y.scores.content,label:"Inhalt"}),e.jsx(Te,{score:y.scores.structure,label:"Struktur"}),e.jsx(Te,{score:y.scores.relevance,label:"Relevanz"})]}),e.jsx(ue,{title:"Transkript",icon:re,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),o&&e.jsx(ue,{title:"Deine Aufnahme",icon:Ft,defaultOpen:!0,children:e.jsx(ps,{audioUrl:o,externalAudioRef:T})}),y?.strengths?.length>0&&e.jsx(ue,{title:"StÃ¤rken",icon:pt,defaultOpen:!0,children:y.strengths.map((l,j)=>e.jsx(Ve,{text:l,type:"strength"},j))}),y?.improvements?.length>0&&e.jsx(ue,{title:"Verbesserungen",icon:ht,defaultOpen:!0,children:y.improvements.map((l,j)=>e.jsx(Ve,{text:l,type:"improvement"},j))}),y?.tips?.length>0&&e.jsx(ue,{title:"Tipps",icon:K,defaultOpen:!0,children:y.tips.map((l,j)=>e.jsx(Ve,{text:l,type:"tip"},j))}),u&&e.jsx(ue,{title:"Sprechanalyse",icon:U,defaultOpen:!0,children:e.jsx(ts,{audioAnalysis:g,onJumpToTimestamp:f})}),!h&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(He,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:v?N:n,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:v?e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(Ze,{className:"w-4 h-4"})]})})]})]})},gs=({tips:t,primaryAccent:c,tipsLabel:r,branding:o})=>{const i=pe(),n=o||i,[N,v]=s.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>v(!N),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(K,{size:n.iconSize.md,color:c}),r||"Tipps fÃ¼r diese Frage"]}),e.jsx($e,{size:n.iconSize.md,color:n.textMuted,style:{transform:N?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx(Bt,{children:N&&e.jsx(Lt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((h,T)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:T<t.length-1?n.space[2]:0},children:[e.jsx(K,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:h.replace(/^Tipp \d+:\s*/i,"")})]},T))})})})]})},fs=({seconds:t,maxSeconds:c,isRecording:r,branding:o})=>{const i=pe(),n=o||i,N=c>0?t/c*100:0,v=N>75,h=N>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:h?n.errorLight:v?n.warningLight:n.cardBgHover},children:[e.jsx(X,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:h?n.error:v?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:h?n.error:v?n.warning:n.textSecondary},children:Re(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",Re(c)]})]})},ot=({onRecordingComplete:t,timeLimit:c,disabled:r,deviceId:o,themedGradient:i,primaryAccent:n,isSubmitting:N,labels:v,onOpenSettings:h,branding:T,isMobile:y,onStreamChange:g})=>{const u=pe(),f=T||u,[l,j]=s.useState("idle"),[R,L]=s.useState(0),[C,B]=s.useState(0),[b,m]=s.useState(!1),a=s.useRef(null),S=s.useRef([]),A=s.useRef(null),x=s.useRef(null),k=s.useRef(null),M=s.useRef(null),$=s.useRef(null),d=s.useRef(0),p=s.useRef(!1);s.useEffect(()=>()=>{w()},[]),s.useEffect(()=>{l==="recording"&&R>=c&&Q()},[R,c,l]);const w=()=>{A.current&&clearInterval(A.current),M.current&&cancelAnimationFrame(M.current),x.current&&(x.current.close(),x.current=null),$.current&&($.current.getTracks().forEach(I=>I.stop()),$.current=null,g&&g(null))},z=async()=>{try{m(!1),S.current=[],L(0);let I;const we={audio:o?{deviceId:{exact:o}}:!0};try{I=await navigator.mediaDevices.getUserMedia(we)}catch(F){throw console.error("[SIMULATOR] Selected device unavailable:",F),F.name==="OverconstrainedError"||F.name==="NotFoundError"?(m(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):F}$.current=I,g&&g(I),x.current=new(window.AudioContext||window.webkitAudioContext),k.current=x.current.createAnalyser(),x.current.createMediaStreamSource(I).connect(k.current),k.current.fftSize=256;const _=()=>{if(k.current&&p.current){const F=new Uint8Array(k.current.frequencyBinCount);k.current.getByteFrequencyData(F);const D=F.reduce((oe,Be)=>oe+Be)/F.length;B(D/255)}M.current=requestAnimationFrame(_)};p.current=!0,_();const Z=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";a.current=new MediaRecorder(I,{mimeType:Z}),a.current.ondataavailable=F=>{F.data.size>0&&S.current.push(F.data)},a.current.onstop=()=>{const F=new Blob(S.current,{type:Z});t(F,d.current)},a.current.start(1e3),j("recording"),A.current=setInterval(()=>{L(F=>F+1)},1e3)}catch(I){console.error("Error starting recording:",I),(I.name==="NotAllowedError"||I.name==="PermissionDeniedError")&&m(!0)}},O=()=>{a.current&&a.current.state==="recording"&&(a.current.pause(),j("paused"),p.current=!1,A.current&&(clearInterval(A.current),A.current=null),B(0))},P=()=>{a.current&&a.current.state==="paused"&&(a.current.resume(),j("recording"),p.current=!0,A.current=setInterval(()=>{L(I=>I+1)},1e3))},Q=()=>{d.current=R,p.current=!1,A.current&&(clearInterval(A.current),A.current=null),M.current&&(cancelAnimationFrame(M.current),M.current=null),x.current&&(x.current.close(),x.current=null),a.current&&a.current.state!=="inactive"&&a.current.stop(),$.current&&($.current.getTracks().forEach(I=>I.stop()),$.current=null),j("idle"),B(0),L(0)},ee=()=>{l==="idle"?z():l==="recording"?O():l==="paused"&&P()};if(b)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:f.errorLight},children:[e.jsx(Ot,{className:"w-12 h-12 mb-3 mx-auto",style:{color:f.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:f.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:f.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const te=()=>{const I={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:y?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:y?"15px":"16px",fontWeight:600,cursor:r||N?"not-allowed":"pointer",flex:y?1:"none"};return r||N?{...I,background:f.borderColor,boxShadow:"none"}:l==="idle"?{...I,background:f.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:l==="recording"?{...I,background:f.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...I,background:f.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:f.cardBg,border:`1px solid ${f.borderColor}`},children:[y&&e.jsx("button",{onClick:h,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:f.cardBgHover,border:`1px solid ${f.borderColor}`},children:e.jsx(Me,{size:18,style:{color:f.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(fs,{seconds:R,maxSeconds:c,isRecording:l==="recording",branding:f})}),l==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Qt,{audioLevel:C,isActive:!0,variant:"bars",size:"sm",accentColor:n})}),l==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:f.warning},children:[e.jsx(U,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!y&&e.jsx("button",{onClick:h,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:f.cardBgHover,border:`1px solid ${f.borderColor}`},children:e.jsx(Me,{size:20,style:{color:f.textMuted}})}),e.jsxs("button",{onClick:ee,disabled:r||N,style:te(),children:[l==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5"}),"Aufnahme starten"]}),l==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),l==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(l==="recording"||l==="paused")&&e.jsxs("button",{onClick:Q,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:y?"14px 16px":"14px 24px",flex:y?1:"none",backgroundColor:f.cardBgHover,color:f.textMain,fontSize:y?"15px":"16px"},children:[e.jsx(xe,{className:"w-[18px] h-[18px]",style:{color:f.success}}),v?.submitButton||"Antwort abgeben"]})]}),l==="idle"&&!N&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:f.textMuted},children:v?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),N&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Qe,{className:"w-8 h-8 animate-spin",style:{color:n}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:f.textSecondary},children:v?.analyzing||"Antwort wird analysiert..."})]})]})},bs=t=>t?t.split(/(\*\*.*?\*\*)/g).map((r,o)=>r.startsWith("**")&&r.endsWith("**")?e.jsx("strong",{children:r.slice(2,-2)},o):r):null,ct={target:Y,clock:X,mic:U,"message-square":re,lightbulb:K,brain:be,info:le,settings:Me,check:xe,Target:Y,Clock:X,Mic:U,MessageSquare:re,Lightbulb:K,Brain:be},js=({scenario:t,variables:c,questions:r,onStart:o,onBack:i,selectedMicrophoneId:n,onMicrophoneChange:N,onMicrophoneTest:v,themedGradient:h,primaryAccent:T,primaryAccentLight:y,isLoading:g,branding:u})=>{const f=pe(),l=u||f,j=t?.mode==="SIMULATION",R=j?"Situationen":"Fragen",L=j?"Zeit pro Situation":"Zeit pro Frage",C=[{icon:Y,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${j?"Situation":"Frage"}. ${j?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:U,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:re,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],B=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((x,k)=>typeof x=="string"?{icon:K,title:`Tipp ${k+1}`,description:x}:{icon:ct[x.icon]||ct[x.icon?.toLowerCase()]||K,title:x.title||`Tipp ${k+1}`,description:x.text||x.description||""}):C,{inputConfigLabels:b,selectOptionsMap:m}=s.useMemo(()=>{if(!t?.input_configuration)return{inputConfigLabels:{},selectOptionsMap:{}};try{const x=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;if(!Array.isArray(x))return{inputConfigLabels:{},selectOptionsMap:{}};const k={},M={};return x.forEach($=>{$.key&&$.label&&(k[$.key]=$.label),$.type==="select"&&$.options&&(M[$.key]=$.options)}),{inputConfigLabels:k,selectOptionsMap:M}}catch{return{inputConfigLabels:{},selectOptionsMap:{}}}},[t?.input_configuration]),a=(x,k)=>{if(x.endsWith("_label"))return null;if(c[`${x}_label`])return c[`${x}_label`];if(m[x]){const M=m[x].find($=>$.value===k);if(M)return M.label}return k},S=c?Object.entries(c).filter(([x,k])=>x.endsWith("_label")?!1:k&&(typeof k=="string"?k.trim()!=="":!0)).map(([x,k])=>({label:b[x]||x.replace(/_/g," ").replace(/\b\w/g,M=>M.toUpperCase()),value:a(x,k)})).filter(x=>x.value):[],A=x=>{if(!x||!c)return x;let k=x;return Object.entries(c).forEach(([M,$])=>{$&&(k=k.replace(new RegExp(`\\$\\{${M}\\}`,"g"),$),k=k.replace(new RegExp(`\\{${M}\\}`,"g"),$))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:l.textSecondary},children:[e.jsx(je,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:h},children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium m-0 mb-1",style:{color:l.primaryAccent},children:["Vorbereitung",r.length>0?` â€¢ ${r.length} ${R}`:""]}),e.jsx("h1",{className:"text-[24px] font-bold m-0",style:{color:l.textMain},children:t.title})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:h},children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:l.textMain},children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:l.textSecondary},children:bs(A(t.long_description?.replace(/\/n/g,`
`)))})]})]})}),S.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:y},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:T},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:S.map((x,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:x.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:l.textMain},children:x.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(U,{className:"w-[22px] h-[22px]",style:{color:T}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:l.textMain},children:"Mikrofon testen"})]}),e.jsx(Xe,{selectedDeviceId:n,onDeviceChange:N,onTestClick:v})]}),e.jsxs("button",{onClick:o,disabled:g,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Je,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:l.cardBg,border:`1px solid ${l.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(K,{className:"w-[22px] h-[22px]",style:{color:l.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:l.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:B.map((x,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:l.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:y},children:e.jsx(x.icon,{className:"w-[22px] h-[22px]",style:{color:T}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:l.textMain},children:x.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:l.textSecondary},children:x.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:l.cardBgHover},children:[r.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:R}),e.jsx("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:r.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:L}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:l.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:l.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},ys=({isOpen:t,onClose:c,onConfirm:r,answeredCount:o,totalCount:i,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(ft,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),o>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:n.answeredCount(o,i)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",n.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",n.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,ws=({isOpen:t,onClose:c,onConfirm:r,answeredCount:o,labels:i})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:c,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(ye,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",o>0?` (${o} ${i.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:c,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:r,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,Ns=({number:t,size:c="md"})=>{const r={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${r[c]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},We=({question:t,index:c,labels:r,isMobile:o})=>e.jsxs(ie,{className:o?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Ns,{number:c+1,size:o?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||r.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${o?"text-[15px]":"text-lg"} mb-0`,children:t?.question||r.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:o?14:16}),r.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),dt=({error:t,onRetry:c,isMobile:r})=>e.jsxs("div",{className:`flex flex-col items-center ${r?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(ye,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(me,{variant:"danger",size:"sm",onClick:c,className:"mt-3",children:"Erneut versuchen"})]}),vs=({session:t,questions:c,scenario:r,variables:o,preloadedQuestions:i,onSessionCreated:n,onComplete:N,onExit:v,startFromQuestion:h=0,initialMicrophoneId:T,skipPreSession:y=!1})=>{const g=Xt(),[u,f]=s.useState(t),[l,j]=s.useState(c||[]),[R,L]=s.useState(!1),[C,B]=s.useState(null),{demoCode:b,branding:m}=bt(),a=r?.mode==="SIMULATION",S={questionLabel:a?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:a?"Situation":"Frage",questionLoading:a?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:a?"Deine Reaktion...":"Deine Antwort...",submitButton:a?"Reaktion abgeben":"Antwort abgeben",submitHint:a?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:a?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(E,q)=>a?`Situation ${E} von ${q}`:`Frage ${E} von ${q}`,questionsCount:E=>a?`${E} Situationen`:`${E} Fragen`,answeredCount:(E,q)=>a?`${E} von ${q} Situationen`:`${E} von ${q} Fragen`,tipsLabel:a?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:a?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:a?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:a?"Situationen":"Fragen",recommendedTime:a?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},A=h>0,x=A?Array.from({length:h},(E,q)=>q):[],k=A||y,[M,$]=s.useState(k?"interview":"preparation"),[d,p]=s.useState(h||u?.current_question_index||0),[w,z]=s.useState(null),[O,P]=s.useState(!1),[Q,ee]=s.useState(!1),[te,I]=s.useState(null),[we,Ne]=s.useState([]),[_,Z]=s.useState(x),F="karriereheld_selected_microphone",[D,oe]=s.useState(()=>{if(T)return T;try{return localStorage.getItem(F)||null}catch{return null}}),[Be,ve]=s.useState(!1),[yt,he]=s.useState(!1),Se=s.useRef(null),ke=s.useCallback(()=>{Se.current&&(Se.current.getTracks().forEach(E=>E.stop()),Se.current=null)},[]),et=s.useCallback(E=>{Se.current=E},[]);s.useEffect(()=>()=>{ke()},[ke]),s.useEffect(()=>{if(D)try{localStorage.setItem(F,D)}catch{}},[D]),s.useEffect(()=>{k&&M==="interview"&&!u&&!R&&(async()=>{L(!0),B(null);try{const q=await H.createSimulatorSession({scenario_id:r.id,variables:o,demo_code:b||null,questions:i||null});if(!q.success)throw new Error(q.message||"Fehler beim Erstellen der Session");const V=q.data.session;let W;if(i&&i.length>0)W=i,await H.updateSimulatorSessionQuestions(V.id,W);else{const J=await H.generateSimulatorQuestions(V.id);if(!J.success)throw new Error(J.message||"Fehler beim Generieren der Fragen");W=J.data.questions}f({...V,questions_json:W}),j(W),n&&n({session:{...V,questions_json:W},questions:W,selectedMicrophoneId:D})}catch(q){console.error("Error creating session:",q),B(q.message||"Ein Fehler ist aufgetreten")}finally{L(!1)}})()},[k,M,u,R,r,o,b,i,D,n]);const[wt,Le]=s.useState(!1),[Nt,Oe]=s.useState(!1),[Ce,tt]=s.useState(!1),[ge,Ae]=s.useState(null),[se,st]=s.useState(!1),ne=l[d],ce=d===l.length-1,nt=d===0,rt=async(E,q)=>{if(q<2){I("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(E.size<5e3){console.warn("[SimulatorSession] Audio too small:",E.size,"bytes"),I("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}ee(!0),I(null);try{const V=await H.submitSimulatorAnswer(u.id,E,d,ne.question,ne.category,q);if(!V.success)throw new Error(V.message||"Fehler beim Analysieren der Antwort");if(z(V.data),P(!0),Ne(W=>[...W.filter(J=>J.questionIndex!==d),{questionIndex:d,feedback:V.data}]),Z(W=>W.includes(d)?W:[...W,d]),a&&!se){tt(!0),Ae(null);const W=_.includes(d);try{const J=await H.generateNextTurn(u.id);if(J.success){const de=J.data.next_question;J.data.is_finished?(Ae(de),j(W?ae=>{const fe=[...ae];return fe[d+1]=de,fe.slice(0,d+2)}:ae=>[...ae,de]),st(!0)):(Ae(de),W?(j(ae=>{const fe=[...ae];return fe[d+1]=de,fe.slice(0,d+2)}),st(!1)):j(ae=>[...ae,de]))}}catch(J){console.error("Error generating next turn:",J)}finally{tt(!1)}}}catch(V){console.error("Error submitting answer:",V),I(V.message||"Ein Fehler ist aufgetreten")}finally{ee(!1)}},De=()=>{z(null),P(!1),I(null)},qe=()=>{if(z(null),P(!1),I(null),a){if(ge){p(E=>E+1),Ae(null);return}if(se){_e();return}}else ce||p(E=>E+1)},vt=()=>{z(null),P(!1),I(null),nt||p(E=>E-1)},St=()=>{Le(!0)},_e=async()=>{Le(!1),he(!1),ve(!1),ke();try{const E=await H.completeSimulatorSession(u.id);E.success?N(E.data):N({session:{...u,status:"completed"}})}catch(E){console.error("Error completing session:",E),N({session:{...u,status:"completed"}})}},kt=()=>{Oe(!0)},Ct=()=>{Oe(!1),he(!1),ve(!1),ke(),v()},At=async()=>{if(u&&l.length>0){$("interview");return}L(!0),B(null);try{const E=await H.createSimulatorSession({scenario_id:r.id,variables:o,demo_code:b||null,questions:i||null});if(!E.success)throw new Error(E.message||"Fehler beim Erstellen der Session");const q=E.data.session;let V;if(i&&i.length>0)V=i,await H.updateSimulatorSessionQuestions(q.id,V);else{const W=await H.generateSimulatorQuestions(q.id);if(!W.success)throw new Error(W.message||"Fehler beim Generieren der Fragen");V=W.data.questions}f({...q,questions_json:V}),j(V),n&&n({session:{...q,questions_json:V},questions:V,selectedMicrophoneId:D}),$("interview")}catch(E){console.error("Error creating session:",E),B(E.message||"Ein Fehler ist aufgetreten")}finally{L(!1)}};if(M==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(js,{scenario:r,variables:o,questions:l,onStart:At,onBack:v,selectedMicrophoneId:D,onMicrophoneChange:oe,onMicrophoneTest:()=>ve(!0),themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],primaryAccentLight:m?.["--primary-accent-light"],isLoading:R}),e.jsx(Ye,{isOpen:Be,onClose:()=>ve(!1),deviceId:D}),C&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:C}),e.jsx(jt,{isLoading:R,message:a?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const _t=O&&(a&&se&&!ge||!a&&ce);return e.jsxs("div",{className:`${g?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${g?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${g?"text-lg":"text-xl"} font-semibold text-slate-900`,children:r?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${g?"justify-between":"justify-end"}`,children:[!_t&&e.jsxs("button",{onClick:St,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(ft,{size:16}),g?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:kt,className:`${g?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(qt,{size:16}),"Abbrechen"]})]})]}),e.jsx(ys,{isOpen:wt,onClose:()=>Le(!1),onConfirm:_e,answeredCount:_.length,totalCount:l.length,labels:S}),e.jsx(ws,{isOpen:Nt,onClose:()=>Oe(!1),onConfirm:Ct,answeredCount:_.length,labels:S}),!O&&!a&&e.jsxs("div",{className:`flex ${g?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(me,{variant:"secondary",size:g?"sm":"md",icon:e.jsx(Pt,{size:16}),onClick:vt,disabled:nt,className:g?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(me,{variant:"secondary",size:g?"sm":"md",iconPosition:"right",icon:e.jsx(Ze,{size:16}),onClick:qe,disabled:ce,className:g?"flex-1":"",children:g?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(ss,{current:d,total:l.length,answeredQuestions:_,primaryAccent:m?.["--primary-accent"],labels:S}),O?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[r.allow_retry&&e.jsx(me,{variant:"secondary",icon:e.jsx(He,{size:16}),onClick:De,children:"Nochmal versuchen"}),e.jsxs(me,{onClick:a?se&&!ge?_e:qe:ce?_e:qe,disabled:a&&Ce&&!se,icon:Ce?e.jsx(Qe,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[a&&Ce&&!se?"GesprÃ¤chspartner tippt...":a?se&&!ge?"Training abschlieÃŸen":S.nextButton:ce?"Training abschlieÃŸen":S.nextButton,!Ce&&!(a?se&&!ge:ce)&&e.jsx(Ze,{size:16,className:"ml-1"})]})]}),e.jsx(We,{question:ne,index:d,labels:S,isMobile:g}),e.jsx("div",{className:"mt-4",children:e.jsx(hs,{transcript:w.transcript,feedback:w.feedback,audioMetrics:w.audio_analysis,audioUrl:w.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${g?"gap-4":"gap-6"}`,children:[g?e.jsxs(e.Fragment,{children:[e.jsx(We,{question:ne,index:d,labels:S,isMobile:!0}),e.jsx(ot,{onRecordingComplete:rt,timeLimit:r.time_limit_per_question||120,disabled:!1,deviceId:D,themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],isSubmitting:Q,labels:S,onOpenSettings:()=>he(!0),isMobile:!0,onStreamChange:et}),te&&e.jsx(dt,{error:te,onRetry:De,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(ot,{onRecordingComplete:rt,timeLimit:r.time_limit_per_question||120,disabled:!1,deviceId:D,themedGradient:m?.["--button-gradient"]||m?.["--header-gradient"],primaryAccent:m?.["--primary-accent"],isSubmitting:Q,labels:S,onOpenSettings:()=>he(!0),isMobile:!1,onStreamChange:et}),te&&e.jsx(dt,{error:te,onRetry:De,isMobile:!1})]}),e.jsx(We,{question:ne,index:d,labels:S,isMobile:!1})]}),ne?.tips&&ne.tips.length>0&&e.jsx(gs,{tips:ne.tips,primaryAccent:m?.["--primary-accent"],tipsLabel:S.tipsLabel})]}),e.jsx(ns,{isOpen:yt,onClose:()=>he(!1),mode:"audio",selectedMicrophoneId:D,onMicrophoneChange:oe})]})},Ee=({score:t,label:c,primaryAccent:r,b:o})=>{const i=t!=null?t*10:null,n=Ut(i,r);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:n},children:i!=null?Math.round(i):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:c})]})},Ke=({icon:t,value:c,label:r,primaryAccent:o,b:i})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:o}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:c}),e.jsx("div",{className:"text-xs text-slate-500",children:r})]})]}),Ss=({session:t,scenario:c,onBackToDashboard:r,onStartNew:o})=>{const i=pe(),{triggerConfetti:n,ConfettiComponent:N}=rs(),v=t.summary_feedback||t.summary_feedback_json,h=v?typeof v=="string"?JSON.parse(v):v:null,T=t.overall_score||h?.overall_score||0,y=T<=10?T*10:T,u=(f=>f>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:f>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:f>=70?{text:"Gut!",emoji:"ðŸ‘"}:f>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:f>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(y);return s.useEffect(()=>{y>=70&&n()},[y,n]),e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:i.headerGradient,boxShadow:`0 8px 24px ${i.primaryAccent}4d`},children:e.jsx(gt,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",u.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[c?.title||"Skill Training"," - ",u.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${i.primaryAccent}`,backgroundColor:i.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:i.primaryAccent},children:y?Math.round(y):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:y?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(Ke,{icon:xe,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ke,{icon:Y,value:h?.average_content_score?Math.round(h.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ke,{icon:Vt,value:h?.average_delivery_score?Math.round(h.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),h?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Ee,{score:h.scores.content,label:"Inhalt",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ee,{score:h.scores.structure,label:"Struktur",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ee,{score:h.scores.relevance,label:"Relevanz",primaryAccent:i.primaryAccent,b:i}),e.jsx(Ee,{score:h.scores.delivery,label:"PrÃ¤sentation",primaryAccent:i.primaryAccent,b:i})]}),h?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:h.summary})]}),h?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:h.key_takeaways.map((f,l)=>e.jsx("li",{className:"mb-2",children:f},l))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(je,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(He,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})]})},G={DASHBOARD:"dashboard",PREPARATION:"preparation",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Zs=({isAuthenticated:t,requireAuth:c,setPendingAction:r,pendingContinueSession:o,clearPendingContinueSession:i,pendingRepeatSession:n,clearPendingRepeatSession:N,pendingScenario:v,clearPendingScenario:h,onNavigateToHistory:T})=>{const[y,g]=s.useState(G.DASHBOARD),[u,f]=s.useState(null),[l,j]=s.useState(null),[R,L]=s.useState([]),[C,B]=s.useState({}),[b,m]=s.useState(null),[a,S]=s.useState(null),[A,x]=s.useState(null);s.useEffect(()=>{v&&t&&(x(v),h?.())},[v,t,h]);const[k,M]=s.useState(0),[$,d]=s.useState(!1),p=s.useMemo(()=>{if(!u?.input_configuration)return!1;try{const _=typeof u.input_configuration=="string"?JSON.parse(u.input_configuration):u.input_configuration;return Array.isArray(_)?_.filter(Z=>Z.user_input!==!1).length>0:!1}catch{return!1}},[u?.input_configuration]);s.useEffect(()=>{(async()=>{if(A&&t){let Z=A;if(A.id&&!A.title)try{const F=window.bewerbungstrainerData?.restUrl||"/wp-json/bewerbungstrainer/v1",D=await fetch(`${F}/simulator/scenarios/${A.id}`);if(D.ok)Z=await D.json(),console.log("[SimulatorApp] Fetched scenario:",Z.title);else{console.error("[SimulatorApp] Failed to fetch scenario:",D.status),x(null);return}}catch(F){console.error("[SimulatorApp] Error fetching scenario:",F),x(null);return}f(Z),g(G.PREPARATION),x(null)}})()},[A,t]),s.useEffect(()=>{if(o&&t){const{session:_,scenario:Z}=o,F=_.questions||_.questions_json,D=typeof F=="string"?JSON.parse(F):F||[],oe=_.completed_questions||_.answered_count||0;f(Z||{id:_.scenario_id,title:_.scenario_title}),j(_),L(D),B({}),M(oe),d(!0),g(G.SESSION),i&&i()}},[o,t,i]),s.useEffect(()=>{if(n&&t){const{session:_,scenario:Z}=n,F=_.questions||_.questions_json,D=typeof F=="string"?JSON.parse(F):F||[];f(Z||{id:_.scenario_id,title:_.scenario_title}),L(D),B({}),M(0),g(G.PREPARATION),N&&N()}},[n,t,N]),s.useEffect(()=>{window.scrollTo(0,0)},[y]);const w=s.useCallback(_=>{f(_),g(G.PREPARATION)},[]),z=s.useCallback(()=>{f(null),j(null),L([]),B({}),m(null),M(0),S(null),d(!1),g(G.DASHBOARD)},[]),O=s.useCallback(_=>{if(S(_.selectedMicrophoneId),u?.input_configuration){const Z=typeof u.input_configuration=="string"?JSON.parse(u.input_configuration):u.input_configuration;if(Array.isArray(Z)&&Z.filter(D=>D.user_input!==!1).length>0){g(G.VARIABLES);return}}d(!0),g(G.SESSION)},[u]),P=s.useCallback(()=>{g(G.PREPARATION)},[]),Q=s.useCallback(_=>{B(_),d(!0),g(G.SESSION)},[]),ee=s.useCallback(_=>{j(_.session),L(_.questions),_.selectedMicrophoneId&&S(_.selectedMicrophoneId)},[]),te=s.useCallback(_=>{m(_.session),g(G.COMPLETE)},[]),I=s.useCallback(()=>{z()},[z]),we=s.useCallback(()=>{j(null),L([]),m(null),M(0),S(null),d(!1),g(G.PREPARATION)},[]),Ne=()=>{switch(y){case G.DASHBOARD:return e.jsx(it,{onSelectScenario:w,isAuthenticated:t,requireAuth:c,setPendingScenario:x,onNavigateToHistory:T});case G.PREPARATION:return e.jsx(us,{scenario:u,onBack:z,onNext:O,hasVariables:p});case G.VARIABLES:return e.jsx(xs,{scenario:u,onBack:P,onNext:Q});case G.SESSION:return e.jsx(vs,{session:l,questions:R,scenario:u,variables:C,preloadedQuestions:R.length>0?R:null,onSessionCreated:ee,onComplete:te,onExit:I,startFromQuestion:k,initialMicrophoneId:a,skipPreSession:$});case G.COMPLETE:return e.jsx(Ss,{session:b,scenario:u,onBackToDashboard:z,onStartNew:we});default:return e.jsx(it,{onSelectScenario:w,isAuthenticated:t,requireAuth:c,setPendingScenario:x,onNavigateToHistory:T})}};return e.jsx("div",{className:"min-h-full",children:Ne()})},ks=t=>t?t.split(/(\*\*.*?\*\*)/g).map((r,o)=>r.startsWith("**")&&r.endsWith("**")?e.jsx("strong",{children:r.slice(2,-2)},o):r):null,ut={target:Y,clock:X,mic:U,"message-square":re,lightbulb:K,brain:be,info:le,check:xe,sparkles:Ie},Cs=[{icon:Y,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:U,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Gs=({scenario:t,onBack:c,onStart:r,preloadedQuestions:o})=>{const[i,n]=s.useState({}),[N,v]=s.useState({}),[h,T]=s.useState(!1),[y,g]=s.useState(null),[u,f]=s.useState(null),[l,j]=s.useState(!1),[R,L]=s.useState([]),[C,B]=s.useState(!1),{demoCode:b}=bt(),m=Fe.useMemo(()=>{if(!t?.input_configuration)return[];try{const d=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(d)?d.filter(p=>p.user_input!==!1):[]}catch(d){return console.error("Error parsing input_configuration:",d),[]}},[t?.input_configuration]);s.useEffect(()=>{const d={};m.forEach(p=>{p.default&&(d[p.key]=p.default)}),n(d)},[m]);const a=(d,p)=>{if(!d)return d;let w=d;return Object.entries(p||{}).forEach(([z,O])=>{O&&(w=w.replace(new RegExp(`\\$\\{${z}\\}`,"g"),O),w=w.replace(new RegExp(`\\{${z}\\}`,"g"),O))}),w},S=(d,p)=>{n(w=>({...w,[d]:p})),N[d]&&v(w=>{const z={...w};return delete z[d],z})},A=()=>{L(d=>[...d,{key:"",value:""}])},x=(d,p,w)=>{L(z=>{const O=[...z];return O[d]={...O[d],[p]:w},O})},k=d=>{L(p=>p.filter((w,z)=>z!==d))},M=()=>{const d={};return m.forEach(p=>{const w=i[p.key];if(p.required&&(!w||w.trim()==="")){d[p.key]="Dieses Feld ist erforderlich";return}if(!(!w||w.trim()==="")&&p.validation){const{minLength:z,maxLength:O,min:P,max:Q,pattern:ee}=p.validation;z&&w.length<z&&(d[p.key]=`Mindestens ${z} Zeichen erforderlich`),O&&w.length>O&&(d[p.key]=`Maximal ${O} Zeichen erlaubt`),P!==void 0&&Number(w)<P&&(d[p.key]=`Mindestens ${P}`),Q!==void 0&&Number(w)>Q&&(d[p.key]=`Maximal ${Q}`),ee&&!new RegExp(ee).test(w)&&(d[p.key]="UngÃ¼ltiges Format")}}),v(d),Object.keys(d).length===0},$=async d=>{if(d.preventDefault(),g(null),!!M()){T(!0);try{const p={...i};R.forEach(P=>{P.key&&P.value&&(p[P.key]=P.value)});const w=await H.createSimulatorSession({scenario_id:t.id,variables:p,demo_code:b||null,questions:o||null});if(!w.success)throw new Error(w.message||"Fehler beim Erstellen der Session");const z=w.data.session;let O;if(o&&o.length>0)O=o,await H.updateSimulatorSessionQuestions(z.id,O);else{const P=await H.generateSimulatorQuestions(z.id);if(!P.success)throw new Error(P.message||"Fehler beim Generieren der Fragen");O=P.data.questions}r({session:{...z,questions_json:O},questions:O,scenario:t,variables:p,selectedMicrophoneId:u})}catch(p){console.error("Error starting session:",p),g(p.message||"Ein Fehler ist aufgetreten")}finally{T(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(je,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ie,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:ks(a(t.long_description?.replace(/\/n/g,`
`),i))})]})]})}),(()=>{const d=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((p,w)=>typeof p=="string"?{icon:K,title:`Tipp ${w+1}`,description:p}:{icon:ut[p.icon]||ut[p.icon?.toLowerCase()]||K,title:p.title||`Tipp ${w+1}`,description:p.text||p.description||""}):Cs;return e.jsxs(ie,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:d.map((p,w)=>{const z=p.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:p.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:p.description})]})]},w)})})]})})(),e.jsxs("form",{onSubmit:$,children:[m.length>0?m.map(d=>e.jsx(as,{field:d,value:i[d.key],onChange:S,error:N[d.key]},d.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(xe,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>B(!C),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${C?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[C?e.jsx(Ue,{size:18}):e.jsx($e,{size:18}),e.jsx(ze,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),C&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),R.length>0&&e.jsx("div",{className:"mb-3",children:R.map((d,p)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:d.key||"",onChange:w=>x(p,"key",w.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>k(p),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(xt,{size:18})})]}),e.jsx("textarea",{value:d.value||"",onChange:w=>x(p,"value",w.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},p))}),e.jsxs("button",{type:"button",onClick:A,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(ze,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ie,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(U,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(Xe,{selectedDeviceId:u,onDeviceChange:f,onTestClick:()=>j(!0)})]}),y&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(ye,{className:"w-[18px] h-[18px]"}),y]}),e.jsx(me,{type:"submit",disabled:h,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(Ge,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(Ye,{isOpen:l,onClose:()=>j(!1),deviceId:u}),e.jsx(jt,{isLoading:h,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{ws as CancelConfirmDialog,ys as CompleteConfirmDialog,hs as ImmediateFeedback,js as PreSessionView,gs as QuestionTips,Ss as SessionComplete,fs as SessionTimer,Zs as SimulatorApp,ot as SimulatorAudioRecorder,it as SimulatorDashboard,vs as SimulatorSession,Gs as SimulatorWizard};
