import{j as e,O as V,l as P,z as ue,v as js,Q as ve,b as be,Y as bs,_ as We,m as C,V as Ae,M as fe,$ as rs,F as Ns,a0 as pe,a1 as Te,y as ye,e as ys,A as vs,p as Ke,a2 as ws,a3 as ks,a4 as Ie,a5 as Ss,a6 as Ws,a7 as Vs,w as Is,a8 as ls,a9 as Ks,h as le,T as Me,S as De,aa as cs,ab as os,C as Ee,ac as qs,s as Hs,ad as Ys,a as qe,H as ds,g as xs,t as ms,ae as Xs}from"./ui-vendor-B9DEMv6g.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{B as H,C as $}from"./Button-CE7zPp3G.js";import{S as Oe,a as Js}from"./select-native-CL_xNWig.js";import{u as Ds,D as Zs,g as Ne,c as re,j as Y,i as ge,k as ce,w as q}from"./FeatureInfoButton-LVfo9WeN.js";import{D as Qs,a as et,b as st,c as tt,d as at,e as nt}from"./dialog-l-KFjSys.js";import{b as it,p as rt,d as lt,e as ct,h as ot,i as dt,j as xt,g as mt}from"./index.js";import{u as we}from"./useMobile-YxjH166V.js";import{R as ht}from"./RoleplaySessionReport-Ddh8gap7.js";import{g as ut,B as pt}from"./BriefingWorkbook-BfM3v5DG.js";import{D as gt,a as ft}from"./DecisionBoardResult-CY9M6b4p.js";import{I as jt,a as bt}from"./IkigaiResults-AKy3tGLW.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./useBranding-CH0MjVQt.js";import"./input-bZ0xV0EL.js";import"./textarea-BRoWW6vA.js";import"./AudioRecorder-DXZ6DO0-.js";import"./button-PAaCSeTT.js";import"./card-D95zbVcL.js";const oe=({isOpen:s,onClose:a,onConfirm:n,title:g="L√∂schen best√§tigen",description:d="Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:r=!1,confirmLabel:x="L√∂schen",cancelLabel:h="Abbrechen"})=>{const{branding:b}=Ds(),p=b?.["--primary-accent"]||Zs["--primary-accent"];return e.jsx(Qs,{open:s,onOpenChange:a,children:e.jsxs(et,{className:"max-w-[400px]",children:[e.jsxs(st,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-white"})}),e.jsx(tt,{children:g})]}),e.jsx(at,{children:d})]}),e.jsxs(nt,{className:"mt-4",children:[e.jsx("button",{onClick:a,disabled:r,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg bg-white text-sm font-medium transition-all hover:bg-slate-50",style:{border:`2px solid ${p}`,color:p,cursor:r?"not-allowed":"pointer",opacity:r?.5:1},children:h}),e.jsx("button",{onClick:n,disabled:r,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg border-none bg-gradient-to-br from-red-500 to-red-600 text-white text-sm font-medium transition-all inline-flex items-center justify-center gap-2 hover:opacity-90",style:{cursor:r?"not-allowed":"pointer",opacity:r?.5:1},children:r?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 animate-spin"}),x,"..."]}):x})]})]})})},Nt={auftreten:Ks,selbstbewusstsein:ls,koerpersprache:Is,kommunikation:fe,professionalitaet:ls,inhalt:ye},yt=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"Weiter √ºben!",vt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",wt=s=>s==="video"?"Wirkungs-Analyse":s==="roleplay"?"Live-Simulation":"Szenario-Training",kt=({score:s,size:a=120,isHeader:n=!1})=>{const g=Math.min(100,Math.max(0,s||0)),d=(a-12)/2,r=d*2*Math.PI,x=r-g/100*r,h=Y(s);return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:n?"rgba(255,255,255,0.3)":"#e2e8f0",strokeWidth:10}),e.jsx(C.circle,{cx:a/2,cy:a/2,r:d,fill:"none",stroke:h,strokeWidth:10,strokeLinecap:"round",strokeDasharray:r,initial:{strokeDashoffset:r},animate:{strokeDashoffset:x},transition:{duration:1,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{style:{fontSize:a/3.5,fontWeight:700,color:h},children:Math.round(s)}),e.jsx("span",{className:`${n?"text-white":"text-slate-500"}`,style:{fontSize:a/10},children:"von 100"})]})]})},St=({audioUrl:s,durationHint:a})=>{const n=o.useRef(null),[g,d]=o.useState(!1),[r,x]=o.useState(0),[h,b]=o.useState(a||0),[p,c]=o.useState(!0),[D,w]=o.useState(null);o.useEffect(()=>{if(!s)return;c(!0),w(null),b(a||0);const m=new Audio;n.current=m;const z=()=>{const A=m.duration;A&&isFinite(A)&&A>0&&b(A),c(!1)},T=()=>{const A=m.duration;A&&isFinite(A)&&A>0&&b(A)},I=()=>{c(!1);const A=m.duration;A&&isFinite(A)&&A>0&&b(A)};return m.addEventListener("loadedmetadata",z),m.addEventListener("durationchange",T),m.addEventListener("canplaythrough",I),m.addEventListener("timeupdate",()=>x(m.currentTime)),m.addEventListener("play",()=>d(!0)),m.addEventListener("pause",()=>d(!1)),m.addEventListener("ended",()=>d(!1)),m.addEventListener("error",()=>{w("Audio nicht verf√ºgbar"),c(!1)}),m.src=s,m.load(),()=>{m.pause(),m.removeEventListener("loadedmetadata",z),m.removeEventListener("durationchange",T),m.removeEventListener("canplaythrough",I),m.src=""}},[s,a]);const N=()=>{n.current&&(g?n.current.pause():n.current.play())},k=m=>{const z=m.currentTarget.getBoundingClientRect(),T=(m.clientX-z.left)/z.width;n.current&&(n.current.currentTime=T*h)},O=m=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+m,h)))};if(D)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-slate-500 text-[13px] flex items-center gap-2",children:[e.jsx(ue,{size:16})," ",D]});if(!s)return null;const E=h>0?r/h*100:0;return e.jsxs($,{className:"p-5",children:[e.jsx("div",{onClick:k,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${E}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>O(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(ws,{size:20})}),e.jsx("button",{onClick:N,disabled:p,className:`w-12 h-12 rounded-full bg-primary border-none flex items-center justify-center text-white ${p?"cursor-wait opacity-70":"cursor-pointer"}`,children:p?e.jsx(P,{size:22,className:"animate-spin"}):g?e.jsx(ks,{size:22,fill:"white"}):e.jsx(Ie,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>O(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[ge(r)," / ",ge(h)]})]})},It=({sessionId:s,conversationId:a})=>{const n=o.useRef(null),[g,d]=o.useState(!1),[r,x]=o.useState(!1),[h,b]=o.useState(0),[p,c]=o.useState(0),[D,w]=o.useState(null),[N,k]=o.useState(!0);o.useEffect(()=>{if(!a){k(!1),w("Keine Audio-Aufnahme verf√ºgbar");return}const T=dt(s);return k(!0),w(null),fetch(T,{headers:{"X-WP-Nonce":re()},credentials:"same-origin"}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}`);return I.blob()}).then(I=>{const A=URL.createObjectURL(I),y=new Audio(A);n.current=y,y._objectUrl=A,y.addEventListener("loadedmetadata",()=>{c(y.duration),k(!1)}),y.addEventListener("timeupdate",()=>b(y.currentTime)),y.addEventListener("play",()=>d(!0)),y.addEventListener("pause",()=>d(!1)),y.addEventListener("ended",()=>d(!1)),y.addEventListener("error",()=>{w("Audio konnte nicht abgespielt werden."),k(!1)})}).catch(()=>{w("Audio nicht verf√ºgbar."),k(!1)}),()=>{n.current&&(n.current.pause(),n.current._objectUrl&&URL.revokeObjectURL(n.current._objectUrl),n.current=null)}},[s,a]);const O=()=>{n.current&&(g?n.current.pause():n.current.play())},E=()=>{n.current&&(n.current.muted=!r,x(!r))},m=T=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+T,p)))},z=T=>{const I=T.currentTarget.getBoundingClientRect(),A=(T.clientX-I.left)/I.width;n.current&&(n.current.currentTime=A*p)};return N?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(P,{size:24,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:"Audio wird geladen..."})]}):D?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ue,{size:24,className:"text-slate-400 mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:D})]}):e.jsxs($,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Ke,{size:18,className:"text-primary"})," Gespr√§chsaufnahme"]}),e.jsx("div",{onClick:z,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${h/p*100||0}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>m(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(ws,{size:20})}),e.jsx("button",{onClick:O,className:"w-12 h-12 rounded-full bg-primary border-none cursor-pointer flex items-center justify-center text-white",children:g?e.jsx(ks,{size:22,fill:"white"}):e.jsx(Ie,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>m(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})}),e.jsx("button",{onClick:E,className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600 ml-auto",children:r?e.jsx(Ws,{size:20}):e.jsx(Vs,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[ge(h)," / ",ge(p)]})]})},Dt=({entry:s})=>{const a=s.role==="user";return e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${a?"bg-primary":"bg-slate-200"}`,children:e.jsx(Is,{size:16,className:a?"text-white":"text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-semibold mb-1 ${a?"text-primary":"text-slate-400"}`,children:a?"Du":"Interviewer"}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed m-0",children:s.text||s.message})]})]})},Et=({answer:s,index:a})=>{const[n,g]=o.useState(!1),d=s.feedback?typeof s.feedback=="string"?JSON.parse(s.feedback):s.feedback:null,r=s.audio_analysis?typeof s.audio_analysis=="string"?JSON.parse(s.audio_analysis):s.audio_analysis:null,x=s.transcript==="[Keine Sprache erkannt]"||r?.speech_rate==="keine_sprache";return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},children:e.jsxs($,{className:"mb-4 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>g(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3 text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center text-primary font-bold text-sm flex-shrink-0",children:a+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 truncate",children:s.question_text||`Frage ${a+1}`})}),s.overall_score!=null&&e.jsx("span",{className:"text-base font-bold",style:{color:x?"#94a3b8":Y(s.overall_score*10)},children:x?"‚Äì":`${Math.round(s.overall_score*10)}%`}),e.jsx(ys,{size:18,className:`text-slate-400 transition-transform ${n?"rotate-180":""}`})]}),e.jsx(vs,{children:n&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-5 pb-5 pt-4 border-t border-slate-100",children:[s.question_text&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(fe,{size:14,className:"text-primary"})," Frage / Situation"]}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed bg-primary/5 p-3 rounded-lg m-0 border border-primary/10",children:s.question_text})]}),s.audio_url&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(Ke,{size:14,className:"text-primary"})," Deine Aufnahme"]}),e.jsx(St,{audioUrl:s.audio_url,durationHint:s.audio_duration_seconds})]}),s.transcript&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(Ns,{size:14,className:"text-primary"})," Transkript"]}),e.jsxs("p",{className:`text-[13px] leading-relaxed bg-slate-50 p-3 rounded-lg m-0 italic break-words ${x?"text-slate-400":"text-slate-600"}`,children:['"',s.transcript,'"']})]}),d?.scores&&!x&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2.5 flex items-center gap-1.5",children:[e.jsx(pe,{size:14,className:"text-primary"})," Bewertung"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Pr√§sentation"}].map(({key:h,label:b})=>{const p=d.scores[h],c=p!=null?p*10:null;return e.jsxs("div",{className:"p-2.5 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-base font-bold",style:{color:c!=null?Y(c):"#94a3b8"},children:c!=null?Math.round(c):"-"}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:b})]},h)})}),(()=>{const h=d.scores.overall,b=h!=null?h*10:null;return e.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg text-center border border-primary/20 flex items-center justify-center gap-3",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:"Gesamt"}),e.jsx("div",{className:"text-xl font-bold",style:{color:b!=null?Y(b):"#94a3b8"},children:b!=null?Math.round(b):"-"})]})})()]}),d?.summary&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-3",children:d.summary}),d?.strengths?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1.5 flex items-center gap-1",children:[e.jsx(Te,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.strengths.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),d?.improvements?.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1.5 flex items-center gap-1",children:[e.jsx(ue,{size:12})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.improvements.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),d?.tips?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-primary mb-1.5 flex items-center gap-1",children:[e.jsx(ye,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.tips.map((h,b)=>e.jsx("li",{className:"mb-1",children:h},b))})]}),r&&!x&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-3 flex items-center gap-1.5",children:[e.jsx(Ke,{size:14,className:"text-primary"})," Sprechanalyse"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[r.speech_rate&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Sprechtempo"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 capitalize",children:r.speech_rate==="optimal"?"‚úì Optimal":r.speech_rate==="zu_schnell"?"‚ö° Zu schnell":r.speech_rate==="zu_langsam"?"üê¢ Zu langsam":r.speech_rate})]}),r.filler_words&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"F√ºllw√∂rter"}),e.jsxs("div",{className:`text-sm font-semibold ${r.filler_words.count<=2?"text-green-600":r.filler_words.count<=5?"text-amber-600":"text-red-600"}`,children:[r.filler_words.count||0," erkannt"]}),r.filler_words.words?.length>0&&e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:r.filler_words.words.slice(0,5).join(", ")})]}),r.confidence_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Selbstsicherheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:Y(r.confidence_score)},children:[r.confidence_score,"%"]})]}),r.clarity_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Klarheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:Y(r.clarity_score)},children:[r.clarity_score,"%"]})]})]}),r.notes&&e.jsx("p",{className:"text-xs text-slate-500 mt-2.5 italic",children:r.notes})]})]})})})]})})},At=({isOpen:s,onClose:a,onConfirm:n,isDeleting:g})=>s?e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:a,children:e.jsxs(C.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl p-6 max-w-[400px] w-[90%] shadow-2xl",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(V,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Session l√∂schen?"})]}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:"M√∂chtest du diese Session wirklich l√∂schen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(H,{variant:"secondary",onClick:a,disabled:g,children:"Abbrechen"}),e.jsx(H,{variant:"danger",onClick:n,disabled:g,icon:g?e.jsx(P,{size:16,className:"animate-spin"}):e.jsx(V,{size:16}),children:g?"L√∂schen...":"L√∂schen"})]})]})}):null,_t=({category:s})=>{const[a,n]=o.useState(!1),g=Nt[s.category]||pe,d=Y(s.score);return e.jsxs($,{className:"mb-2.5 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>n(!a),className:"w-full p-3.5 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{backgroundColor:`${d}15`},children:e.jsx(g,{size:18,style:{color:d}})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})}),e.jsxs("span",{className:"text-base font-bold",style:{color:d},children:[Math.round(s.score),"%"]}),e.jsx(ys,{size:18,className:`text-slate-400 transition-transform ${a?"rotate-180":""}`})]}),e.jsx(vs,{children:a&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-3 border-t border-slate-100",children:[s.feedback&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-2.5",children:s.feedback}),s.strengths?.length>0&&e.jsxs("div",{className:"mb-2.5",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1 flex items-center gap-1",children:[e.jsx(Te,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.strengths.map((r,x)=>e.jsx("li",{children:r},x))})]}),s.improvements?.length>0&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1 flex items-center gap-1",children:[e.jsx(ye,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.improvements.map((r,x)=>e.jsx("li",{children:r},x))})]})]})})})]})},Ct=({session:s,type:a,scenario:n,onBack:g,onContinueSession:d,onRepeatSession:r,onDeleteSession:x})=>{const h=we(),[b,p]=o.useState(!1);o.useEffect(()=>{const i=()=>{const f=window.innerWidth;p(f>=768&&f<1200)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const[c,D]=o.useState([]),[w,N]=o.useState(!0),[k,O]=o.useState(null),[E,m]=o.useState(!1),[z,T]=o.useState(!1),[I,A]=o.useState(!1),[y,de]=o.useState(null),[ee,je]=o.useState(n),R=a==="video",B=a==="simulator",U=a==="roleplay",xe=(()=>{const i=s?.questions||s?.questions_json;if(!i)return!1;try{const f=typeof i=="string"?JSON.parse(i):i;return Array.isArray(f)&&f.length>0}catch{return!1}})(),S=(()=>{if(!B||!xe)return!1;const i=s?.total_questions||0,f=s?.completed_questions||0;return i>0&&f<i})(),G=async()=>{if(x){T(!0);try{await x(s,a)}catch(i){console.error("Failed to delete session:",i),T(!1),m(!1)}}},K=async()=>{if(!(I||!s?.id)){A(!0);try{let i;if(B)i=`${Ne()}/simulator/sessions/${s.id}/export-pdf`;else if(R)i=`${Ne()}/video-training/sessions/${s.id}/export-pdf`;else if(U)i=`${Ne()}/sessions/${s.id}/export-pdf`;else throw new Error("Unsupported session type for PDF export");const f=await fetch(i,{method:"POST",headers:{"X-WP-Nonce":re(),"Content-Type":"application/json"},credentials:"same-origin"}),_=await f.json();if(!f.ok)throw new Error(_.error||`HTTP ${f.status}`);if(!_.success||!_.pdf_base64)throw new Error(_.error||"PDF generation failed");const ne=atob(_.pdf_base64),ke=new Array(ne.length);for(let ie=0;ie<ne.length;ie++)ke[ie]=ne.charCodeAt(ie);const me=new Uint8Array(ke),Re=new Blob([me],{type:_.content_type||"application/pdf"}),Se=window.URL.createObjectURL(Re),Z=document.createElement("a");Z.href=Se,Z.download=_.filename||"Training.pdf",document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),window.URL.revokeObjectURL(Se)}catch(i){console.error("Failed to download PDF:",i)}finally{A(!1)}}};o.useEffect(()=>{B&&s?.id?Fe():U&&s?.id?_e():N(!1)},[s?.id,a]);const Fe=async()=>{try{N(!0);const f=await(await fetch(`${Ne()}/simulator/sessions/${s.id}/answers`,{headers:{"X-WP-Nonce":re()}})).json();f.success&&f.data?.answers?D(f.data.answers):Array.isArray(f.data)&&D(f.data)}catch(i){console.error("Failed to load answers:",i),O("Fehler beim Laden der Antworten")}finally{N(!1)}},_e=async()=>{try{N(!0);const i=await it(s.id);if(de({...s,...i,feedback:ct(i.feedback_json||s.feedback_json),audioAnalysis:lt(i.audio_analysis_json||s.audio_analysis_json),transcript:rt(i.transcript||s.transcript)}),!n&&i.scenario_id)try{const f=await ot(i.scenario_id);je(f)}catch(f){console.warn("Could not load scenario:",f)}}catch(i){console.error("Failed to load roleplay data:",i),O("Fehler beim Laden der Gespr√§chsdaten")}finally{N(!1)}},X=s?.summary_feedback_json?typeof s.summary_feedback_json=="string"?JSON.parse(s.summary_feedback_json):s.summary_feedback_json:null,F=s?.category_scores||[],J=s?.analysis||{},ae=(()=>{let i=0;return U&&y?.feedback?.rating?.overall?i=y.feedback.rating.overall:i=s?.overall_score||X?.overall_score||0,(B||U)&&i<=10?i*10:i})();return w?e.jsx("div",{className:"w-full min-h-[60vh] flex items-center justify-center p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{size:48,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-4",children:"Analyse wird geladen..."})]})}):k?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ue,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-600 mb-6",children:k}),e.jsx(H,{variant:"secondary",onClick:g,children:"Zur√ºck"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 overflow-hidden max-w-full",children:[e.jsx("div",{className:`sticky top-0 z-40 ${h?"px-4 py-5":"px-8 py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[g&&e.jsxs("button",{onClick:g,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(js,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx(kt,{score:ae,size:100,isHeader:!0}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:wt(a)}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:Y(ae)},children:yt(ae)})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:(U?ee?.title:n?.title)||s?.scenario_title||s?.position||"Training"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ve,{size:14}),vt(s?.created_at)]}),s?.duration&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(be,{size:14}),ge(s.duration)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:K,disabled:I,title:"Als PDF herunterladen",className:`flex items-center justify-center bg-white/20 border border-white/30 rounded-lg px-3 py-2.5 text-white outline-none transition-colors hover:bg-white/30 ${I?"cursor-wait opacity-70":"cursor-pointer"}`,children:I?e.jsx(P,{size:16,className:"animate-spin"}):e.jsx(bs,{size:16})}),!h&&r&&e.jsxs("button",{onClick:()=>r(s,n),className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-lg px-5 py-2.5 cursor-pointer text-white text-sm font-medium outline-none hover:bg-white/30 transition-colors",children:[e.jsx(We,{size:16}),"Erneut √ºben"]}),x&&e.jsx("button",{onClick:()=>m(!0),className:`flex items-center gap-2 bg-red-500/20 border border-red-500/40 rounded-lg cursor-pointer text-white text-sm font-medium outline-none hover:bg-red-500/30 transition-colors ${h?"px-3 py-2.5":"px-4 py-2.5"}`,children:e.jsx(V,{size:16})})]})]})]})}),e.jsx("div",{className:`overflow-hidden ${h?"p-4":"px-8 py-6"}`,children:e.jsxs("div",{className:"grid gap-6 overflow-hidden",style:{gridTemplateColumns:h||b?"1fr":"1fr 400px"},children:[e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[R&&s?.video_url&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs($,{className:"mb-5 p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(Ae,{size:18,className:"text-primary"})," Deine Aufnahme"]}),e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]})}),B&&c.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(fe,{size:18,className:"text-primary"})," Deine Antworten (",c.length,")"]}),c.map((i,f)=>e.jsx(Et,{answer:i,index:f},i.id||f)),S&&(d||r)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap mt-6 p-5 bg-slate-50 rounded-xl border border-dashed border-slate-300",children:[e.jsx("p",{className:"w-full text-center text-slate-600 text-sm mb-3",children:"Diese Session ist noch nicht abgeschlossen."}),d&&e.jsx(H,{onClick:()=>d(s,n),icon:e.jsx(rs,{size:18}),children:"Fortsetzen"}),r&&e.jsx(H,{variant:"secondary",onClick:()=>r(s,n),icon:e.jsx(We,{size:18}),children:"Erneut starten"})]})]}),B&&c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6 bg-slate-50 rounded-2xl",children:[e.jsx(ue,{size:48,className:"text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Keine Antworten vorhanden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:xe?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),S&&(d||r)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap",children:[d&&e.jsx(H,{onClick:()=>d(s,n),icon:e.jsx(rs,{size:18}),children:"Fortsetzen"}),r&&e.jsx(H,{variant:"secondary",onClick:()=>r(s,n),icon:e.jsx(We,{size:18}),children:"Erneut starten"})]})]}),U&&y&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-5",children:e.jsx(It,{sessionId:s.id,conversationId:y.conversation_id})}),U&&y?.transcript?.length>0&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs($,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Ns,{size:18,className:"text-primary"})," Gespr√§chsverlauf"]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:y.transcript.map((i,f)=>e.jsx(Dt,{entry:i},f))})]})})]}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[R&&F.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-primary"})," Detaillierte Bewertung"]}),F.map((i,f)=>e.jsx(_t,{category:i},i.category||f))]}),R&&(J.key_strengths?.length>0||J.actionable_tips?.length>0)&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs($,{className:"mb-5 p-5",children:[J.key_strengths?.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(Te,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:J.key_strengths.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},f))})]}),J.actionable_tips?.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-primary mb-2.5 flex items-center gap-1.5",children:[e.jsx(ye,{size:16})," Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-5",children:J.actionable_tips.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},f))})]})]})}),R&&s?.summary_feedback&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:s.summary_feedback})]})}),B&&X&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[X.summary&&e.jsxs($,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:X.summary})]}),X.scores&&e.jsxs($,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Bewertung"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:Object.entries(X.scores).map(([i,f])=>{const _=f!=null?f*10:null;return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-xl font-bold",style:{color:Y(_)},children:_!=null?Math.round(_):"-"}),e.jsx("div",{className:"text-[11px] text-slate-500 capitalize",children:i})]},i)})})]}),X.key_takeaways?.length>0&&e.jsxs("div",{className:"bg-green-50 rounded-2xl p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(ye,{size:16})," Wichtigste Erkenntnisse"]}),e.jsx("ul",{className:"m-0 pl-5 text-[13px] text-slate-900 leading-snug",children:X.key_takeaways.map((i,f)=>e.jsx("li",{className:"mb-1.5",children:i},f))})]})]}),U&&y?.feedback&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[y.feedback.rating&&e.jsxs($,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-primary"})," Bewertungskriterien"]}),e.jsx("div",{className:"flex flex-col gap-2.5",children:Object.entries(y.feedback.rating).filter(([i])=>i!=="overall").map(([i,f])=>{const _=f*10;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"flex-1 text-[13px] font-medium text-slate-900 capitalize",children:i.replace(/_/g," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-1.5 bg-slate-200 rounded",children:e.jsx("div",{className:"h-full rounded",style:{width:`${_}%`,backgroundColor:Y(_)}})}),e.jsx("span",{className:"text-sm font-semibold min-w-[45px]",style:{color:Y(_)},children:Math.round(_)})]})]},i)})})]}),y.feedback.strengths?.length>0&&e.jsxs($,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-3 flex items-center gap-1.5",children:[e.jsx(Te,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:y.feedback.strengths.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},f))})]}),y.feedback.improvements?.length>0&&e.jsxs($,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-amber-600 mb-3 flex items-center gap-1.5",children:[e.jsx(ye,{size:16})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:y.feedback.improvements.map((i,f)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},f))})]}),y.feedback.summary&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:y.feedback.summary})]})]}),U&&!y?.feedback&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ue,{size:32,className:"text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 m-0",children:"Keine Analyse verf√ºgbar f√ºr dieses Gespr√§ch."})]})]})]})}),e.jsx(At,{isOpen:E,onClose:()=>m(!1),onConfirm:G,isDeleting:z})]})},zt=({briefing:s,onClick:a,onDelete:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=we(900),D=ut(s.template_icon),w=k=>{k.stopPropagation(),p(!0)},N=async()=>{h(!0);try{await n(s.id),p(!1)}catch(k){console.error("Error deleting briefing:",k)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-[22px] h-[22px] text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.title||"Briefing"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:ce(s.created_at)})]}),e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2.5 py-1 rounded-[10px] text-xs font-medium max-w-[70%] overflow-hidden text-ellipsis whitespace-nowrap",children:s.template_title}),e.jsx(le,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:N,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:s.title||"Briefing"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-[10px] text-xs font-medium",children:s.template_title}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:14}),ce(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})}),e.jsx(le,{size:20,className:"text-slate-400"})]})]})}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:N,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},te={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},Lt=({session:s,type:a,scenario:n,onClick:g,onContinueSession:d,onDeleteSession:r,headerGradient:x,headerText:h,primaryAccent:b})=>{const[p,c]=o.useState(!1),[D,w]=o.useState(!1),N=we(900),k=()=>{let S=null;if(a===te.SIMULATOR)S=s.overall_score||s.average_score;else if(a===te.VIDEO)S=s.overall_score;else if(s.feedback_json)try{let G=s.feedback_json;if(typeof G=="string"){let K=G.trim();K.startsWith("```json")?K=K.replace(/```json\s*/g,"").replace(/```\s*$/g,""):K.startsWith("```")&&(K=K.replace(/```\s*/g,"").replace(/```\s*$/g,"")),G=JSON.parse(K)}S=G.rating?.overall||null}catch{S=null}return S==null||isNaN(S)||S===0?null:S},O=()=>a===te.SIMULATOR||a===te.VIDEO?s.status:s.feedback_json?"completed":"pending",E=k(),z=O()==="completed",T=s.total_questions>0&&(s.completed_questions||0)<s.total_questions,I=a===te.SIMULATOR&&T,A=()=>{if(!I)return null;const S=s.completed_questions||0,G=s.total_questions||0;return`${S}/${G} Fragen`},y=S=>{S.stopPropagation(),d&&d(s,n)},de=S=>{S.stopPropagation(),w(!0)},ee=async()=>{c(!0);try{await r(s,a),w(!1)}catch(S){console.error("Error deleting session:",S)}finally{c(!1)}},R=(()=>{if(E==null||isNaN(E))return null;if(a===te.SIMULATOR||a===te.ROLEPLAY){const S=E<=10?E*10:E;return isNaN(S)?null:S}return isNaN(E)?null:E})(),B=S=>{if(!S&&S!==0)return{background:"#f1f5f9",color:"#64748b"};const G=parseFloat(S);return G>=80?{background:"#dcfce7",color:"#166534"}:G>=60?{background:"#fef9c3",color:"#854d0e"}:{background:"#fee2e2",color:"#991b1b"}},xe=(()=>{switch(a){case te.SIMULATOR:return Me;case te.VIDEO:return Ae;default:return fe}})();return N?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:g,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(xe,{className:"w-[22px] h-[22px]",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3]",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsx("div",{className:"text-[13px] text-slate-500",children:ce(s.created_at)})]}),r&&e.jsx("button",{onClick:de,disabled:p,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600 hover:bg-slate-100 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:p?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(be,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full text-[13px] font-semibold",style:B(R),children:[e.jsx(pe,{size:13}),R!==null?`${Math.round(R)}%`:"-- %"]}),(s.duration||s.video_duration_seconds)&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(be,{size:12}),ge(s.duration||s.video_duration_seconds)]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:A()})]}),I&&d?e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-4 py-2.5 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:shadow-lg transition-shadow shrink-0",children:[e.jsx(Ie,{size:14}),"Fortsetzen"]}):e.jsx(le,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(oe,{isOpen:D,onClose:()=>w(!1),onConfirm:ee,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:p})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:g,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(xe,{className:"w-6 h-6",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:14}),ce(s.created_at)]}),s.duration||s.video_duration_seconds?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{size:14}),ge(s.duration||s.video_duration_seconds)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[I&&d&&e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:scale-105 hover:shadow-lg transition-all",children:[e.jsx(Ie,{size:14}),"Fortsetzen"]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:A()}),!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(be,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-semibold",style:B(R),children:[e.jsx(pe,{size:14}),R!==null?`${Math.round(R)}%`:"-- %"]}),r&&e.jsx("button",{onClick:de,disabled:p,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:p?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})}),e.jsx(le,{size:20,className:"text-slate-400"})]})]})}),e.jsx(oe,{isOpen:D,onClose:()=>w(!1),onConfirm:ee,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:p})]})},hs=({proScore:s,contraScore:a})=>{const n=s+a,g=n>0?Math.round(s/n*100):50;return e.jsxs("div",{className:"h-1.5 rounded-[3px] overflow-hidden flex bg-slate-100 w-full max-w-[120px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full",style:{width:`${g}%`}}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 h-full",style:{width:`${100-g}%`}})]})},Ot=({decision:s,onClick:a,onDelete:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=we(900),D=(s.pros||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),w=(s.cons||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),N=(s.pros||[]).filter(m=>m.text?.trim()).length,k=(s.cons||[]).filter(m=>m.text?.trim()).length,O=m=>{m.stopPropagation(),p(!0)},E=async()=>{h(!0);try{await n(s.id),p(!1)}catch(m){console.error("Error deleting decision:",m)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(De,{className:"w-[22px] h-[22px] text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.topic||"Entscheidung"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:ce(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(cs,{size:14,className:"text-green-600"}),e.jsx("span",{className:"text-[13px] font-medium text-green-600",children:N})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{size:14,className:"text-red-600"}),e.jsx("span",{className:"text-[13px] font-medium text-red-600",children:k})]}),e.jsx(hs,{proScore:D,contraScore:w})]}),e.jsx(le,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:E,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(De,{className:"w-6 h-6 text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1.5 whitespace-nowrap overflow-hidden text-ellipsis",children:s.topic||"Entscheidung"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(cs,{size:14,className:"text-green-600"}),e.jsxs("span",{className:"font-medium text-green-600",children:[N," Pro"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{size:14,className:"text-red-600"}),e.jsxs("span",{className:"font-medium text-red-600",children:[k," Contra"]})]})]}),e.jsx(hs,{proScore:D,contraScore:w}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:14}),ce(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})}),e.jsx(le,{size:20,className:"text-slate-400"})]})]})}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:E,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},Tt={love:{icon:Ys,color:"#E11D48",label:"Liebe"},talent:{icon:pe,color:"#F59E0B",label:"Talent"},need:{icon:Hs,color:"#10B981",label:"Welt"},market:{icon:qs,color:"#6366F1",label:"Markt"}},us=({dimensions:s})=>e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Object.entries(Tt).map(([a,n])=>{const g=s?.[a]||[],d=g.length>0,r=n.icon;return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-xl text-xs font-medium",style:{backgroundColor:d?`${n.color}15`:"#f1f5f9",color:d?n.color:"#94a3b8",border:d?`1px solid ${n.color}30`:"1px solid #e2e8f0"},children:[e.jsx(r,{size:12}),e.jsx("span",{children:g.length})]},a)})}),Mt=({ikigai:s,onDelete:a,onNavigate:n,headerGradient:g,headerText:d,primaryAccent:r})=>{const[x,h]=o.useState(!1),[b,p]=o.useState(!1),c=we(900),D={love:s.love_tags||[],talent:s.talent_tags||[],need:s.need_tags||[],market:s.market_tags||[]},w=Object.values(D).filter(m=>m.length>0).length,N=s.status==="completed",k=s.paths?.[0]?.role_title||(N?"Ikigai-Analyse abgeschlossen":"Ikigai-Analyse"),O=m=>{m.stopPropagation(),p(!0)},E=async()=>{h(!0);try{await a(s.id),p(!1)}catch(m){console.error("Error deleting ikigai:",m)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:n,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:N?"linear-gradient(135deg, #E11D48, #F59E0B, #10B981, #6366F1)":"linear-gradient(135deg, #6366F115, #6366F130)"},children:e.jsx(Ee,{className:`w-[22px] h-[22px] ${N?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:k}),e.jsx("div",{className:"text-[13px] text-slate-500",children:ce(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsx(us,{dimensions:D}),e.jsx(le,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:E,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:n,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:N?"linear-gradient(135deg, #E11D48, #F59E0B, #10B981, #6366F1)":"linear-gradient(135deg, #6366F115, #6366F130)"},children:e.jsx(Ee,{className:`w-6 h-6 ${N?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 whitespace-nowrap overflow-hidden text-ellipsis",children:k}),N&&e.jsx("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-gradient-to-r from-green-500 to-green-600 text-white",children:"Abgeschlossen"}),!N&&w>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-amber-500/10 text-amber-500",children:[w,"/4 Dimensionen"]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsx(us,{dimensions:D}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{size:14}),ce(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(P,{size:18,className:"animate-spin"}):e.jsx(V,{size:18})}),e.jsx(le,{size:20,className:"text-slate-400"})]})]})}),e.jsx(oe,{isOpen:b,onClose:()=>p(!1),onConfirm:E,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},Ft=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Rt=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"In Arbeit",ps={ikigai:{label:"Ikigai-Kompass",icon:Ee},decision:{label:"Entscheidungs-Board",icon:De},briefing:{label:"Smart Briefing",icon:qe},simulator:{label:"Szenario-Training",icon:Me},video:{label:"Wirkungs-Analyse",icon:Ae},roleplay:{label:"Live-Simulation",icon:fe}},Bt=({score:s,size:a=80})=>{const n=Math.min(100,Math.max(0,s||0)),g=(a-10)/2,d=g*2*Math.PI,r=d-n/100*d;return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"-rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:g,fill:"none",stroke:"rgba(255,255,255,0.25)",strokeWidth:8}),e.jsx(C.circle,{cx:a/2,cy:a/2,r:g,fill:"none",stroke:"#fff",strokeWidth:8,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:r},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx(C.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},className:"font-bold text-white leading-none",style:{fontSize:a/3},children:Math.round(s)})})]})},gs=({type:s,title:a,subtitle:n,score:g,status:d,createdAt:r,duration:x,onBack:h,onDelete:b,onDownload:p,isDeleting:c=!1,isDownloading:D=!1,extraActions:w})=>{const N=we(768),k=ps[s]||ps.simulator,O=k.icon,E=g!=null&&g>0;return e.jsx("div",{className:"sticky top-0 z-40 bg-brand-gradient",style:{padding:N?"20px 16px":"24px 32px"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[h&&e.jsxs("button",{onClick:h,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(js,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!N&&E&&e.jsx(Bt,{score:g,size:80}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[11px] font-semibold uppercase tracking-wider px-2.5 py-1 rounded-full bg-white/20 text-white",children:[e.jsx(O,{size:14}),k.label]}),E&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:Y(g)},children:Rt(g)}),d==="in_progress"&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-amber-600",children:"In Bearbeitung"})]}),e.jsx("h1",{className:"font-bold text-white m-0 truncate",style:{fontSize:N?"20px":"24px",marginBottom:n?"4px":"8px"},children:a}),n&&e.jsx("p",{className:"text-sm text-white/80 m-0 mb-2",children:n}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[r&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ve,{size:14}),Ft(r)]}),x&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(be,{size:14}),Math.floor(x/60),":",String(x%60).padStart(2,"0")," Min."]})]})]}),e.jsxs("div",{className:"flex gap-3 flex-shrink-0",children:[p&&e.jsxs("button",{onClick:p,disabled:D,title:"Als PDF herunterladen",className:"flex items-center justify-center gap-1.5 bg-white/15 border-none rounded-lg text-white text-[13px] font-medium hover:bg-white/25 transition-colors disabled:opacity-70",style:{padding:N?"10px":"10px 16px",cursor:D?"wait":"pointer"},children:[e.jsx(bs,{size:16}),!N&&"PDF"]}),w,b&&e.jsxs("button",{onClick:b,disabled:c,title:"L√∂schen",className:"flex items-center justify-center gap-1.5 bg-red-500/20 border border-red-500/40 rounded-lg text-white text-[13px] font-medium hover:bg-red-500/30 transition-colors disabled:opacity-70",style:{padding:N?"10px":"10px 16px",cursor:c?"wait":"pointer"},children:[e.jsx(V,{size:16}),!N&&"L√∂schen"]})]})]})]})})},fs={love:{key:"love",label:"Liebe",icon:"‚ù§Ô∏è",color:"#E11D48",question:"Vergiss mal Geld und Karriere. Bei welchen T√§tigkeiten vergisst du die Zeit?",placeholder:"Erz√§hle mir, was du wirklich liebst zu tun...",description:"Was du liebst"},talent:{key:"talent",label:"Talent",icon:"‚≠ê",color:"#F59E0B",question:"Worin bist du richtig gut? Was f√§llt dir leicht, w√§hrend andere damit k√§mpfen?",placeholder:"Beschreibe deine St√§rken und F√§higkeiten...",description:"Worin du gut bist"},need:{key:"need",label:"Welt",icon:"üåç",color:"#10B981",question:"Welche Probleme der Welt w√ºrdest du gerne l√∂sen? Wo siehst du Bedarf?",placeholder:"Welchen Beitrag m√∂chtest du leisten...",description:"Was die Welt braucht"},market:{key:"market",label:"Markt",icon:"üí∞",color:"#6366F1",question:"Wof√ºr werden Menschen in deinem Bereich bezahlt? Was ist gefragt?",placeholder:"Welche Berufe oder M√§rkte interessieren dich...",description:"Wof√ºr du bezahlt wirst"}},l={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings",DECISIONS:"decisions",IKIGAI:"ikigai"},Ve=[{id:l.BRIEFINGS,label:"Smart Briefings",icon:qe},{id:l.DECISIONS,label:"Entscheidungs-Kompass",icon:De},{id:l.IKIGAI,label:"Ikigai-Kompass",icon:Ee},{id:l.SIMULATOR,label:"Szenario-Training",icon:Me},{id:l.VIDEO,label:"Wirkungs-Analyse",icon:Ae},{id:l.ROLEPLAY,label:"Live-Simulationen",icon:fe}],ra=l,la=({onBack:s,onSelectSession:a,isAuthenticated:n,onLoginClick:g,onContinueSession:d,onRepeatSession:r,initialTab:x,onNavigateToModule:h})=>{const{branding:b,demoCode:p}=Ds(),[c,D]=o.useState(x||l.BRIEFINGS);o.useEffect(()=>{x&&D(x)},[x]);const[w,N]=o.useState(null),[k,O]=o.useState(null);o.useEffect(()=>{window.scrollTo(0,0)},[c,w]);const[E,m]=o.useState([]),[z,T]=o.useState([]),[I,A]=o.useState([]),[y,de]=o.useState([]),[ee,je]=o.useState([]),[R,B]=o.useState([]),[U,xe]=o.useState([]),[S,G]=o.useState([]),[K,Fe]=o.useState([]),[_e,X]=o.useState(null),[F,J]=o.useState(null),[Ce,ae]=o.useState(null),[i,f]=o.useState(null),[_,ne]=o.useState({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),[ke,me]=o.useState(null),[Re,Se]=o.useState(!1),[Z,ie]=o.useState(!0),[He,Ye]=o.useState(null);o.useEffect(()=>{n?ze():ie(!1)},[n]);const ze=async()=>{ie(!0),Ye(null);try{const t=Ne(),u=p?`&demo_code=${encodeURIComponent(p)}`:"",[j,v,M,W,Q,se,he,Us,Gs]=await Promise.all([xt({limit:50,...p&&{demo_code:p}}).catch(()=>({data:[]})),fetch(`${t}/simulator/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":re()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":re()}}).then(L=>L.json()).catch(()=>({data:[]})),q.request(`/smartbriefing/briefings?limit=50${p?`&demo_code=${encodeURIComponent(p)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),q.getDecisions().catch(()=>({success:!1,data:{decisions:[]}})),q.getIkigais().catch(()=>({success:!1,data:{ikigais:[]}})),mt().catch(()=>[]),fetch(`${t}/simulator/scenarios`,{headers:{"X-WP-Nonce":re()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/scenarios`,{headers:{"X-WP-Nonce":re()}}).then(L=>L.json()).catch(()=>({data:[]}))]),Ue=(L,Le="sessions")=>Array.isArray(L?.data)?L.data:Array.isArray(L?.data?.[Le])?L.data[Le]:Array.isArray(L?.[Le])?L[Le]:Array.isArray(L)?L:[],Ge=L=>Array.isArray(L?.data?.scenarios)?L.data.scenarios:Array.isArray(L?.data)?L.data:Array.isArray(L)?L:[];m(Ue(j)),T(Ue(v)),A(Ue(M)),de(W?.data?.briefings||[]),je(Q?.data?.decisions||[]),B(se?.data?.ikigais||[]),xe(Ge(he)),G(Ge(Us)),Fe(Ge(Gs))}catch(t){console.error("Failed to load sessions:",t),Ye(t.message||"Fehler beim Laden der Daten")}finally{ie(!1)}},Xe=o.useMemo(()=>{const t={};return U.forEach(u=>{t[u.id]=u}),t},[U]),Je=o.useMemo(()=>{const t={};return S.forEach(u=>{t[u.id]=u}),t},[S]),Ze=o.useMemo(()=>{const t={};return K.forEach(u=>{t[u.id]=u}),t},[K]),Es=()=>{switch(c){case l.SIMULATOR:return z;case l.VIDEO:return I;case l.BRIEFINGS:return y;case l.DECISIONS:return ee;case l.IKIGAI:return R;default:return E}},As=()=>{switch(c){case l.SIMULATOR:return Je;case l.VIDEO:return Ze;default:return Xe}},Qe=E.length+z.length+I.length+y.length+ee.length,es=async t=>{(await q.request(`/smartbriefing/briefings/${t}`,{method:"DELETE"})).success&&de(j=>j.filter(v=>v.id!==t))},_s=t=>{X(t)},Cs=()=>{X(null)},ss=async t=>{(await q.deleteDecision(t)).success&&je(j=>j.filter(v=>v.id!==t))},ts=async t=>{await q.deleteIkigai(t)&&B(j=>j.filter(v=>v.id!==t))},zs=t=>{J(t)},as=()=>{J(null),ae(null)},Ls=t=>{f(t),ne({love:{input:t.love_input||"",tags:t.love_tags||[]},talent:{input:t.talent_input||"",tags:t.talent_tags||[]},need:{input:t.need_input||"",tags:t.need_tags||[]},market:{input:t.market_input||"",tags:t.market_tags||[]}}),t.status==="completed"&&t.paths?me({summary:t.summary,paths:t.paths}):me(null)},Be=()=>{f(null),ne({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),me(null)},Os=async(t,u,j)=>{if(ne(v=>({...v,[t]:{input:u,tags:j}})),i?.id)try{await q.updateIkigai(i.id,{[`${t}_input`]:u,[`${t}_tags`]:j})}catch(v){console.error("[Ikigai] Failed to save dimension:",v)}},Ts=async(t,u)=>{try{return(await q.extractIkigaiKeywords(t,u))?.keywords||[]}catch(j){return console.error("[Ikigai] Failed to extract keywords:",j),[]}},Ms=(t,u)=>{ne(j=>{const v=j[t].tags.filter(M=>M!==u);return{...j,[t]:{...j[t],tags:v}}})},Fs=async()=>{if(Object.values(_).every(u=>u.tags&&u.tags.length>0)){Se(!0);try{const u=await q.synthesizeIkigaiPaths({love_tags:_.love.tags,talent_tags:_.talent.tags,need_tags:_.need.tags,market_tags:_.market.tags});u&&(me(u),i?.id&&(await q.updateIkigai(i.id,{summary:u.summary,paths:u.paths,status:"completed"}),B(j=>j.map(v=>v.id===i.id?{...v,summary:u.summary,paths:u.paths,status:"completed"}:v))))}catch(u){console.error("[Ikigai] Failed to synthesize paths:",u)}finally{Se(!1)}}},Rs=Object.values(_).every(t=>t.tags&&t.tags.length>0),Bs=t=>{je(u=>u.map(j=>j.id===t.id?t:j)),J(t)},$s=t=>{N(t),O(c)},$e=()=>{N(null),O(null)},Pe=async(t,u)=>{const j=Ne();try{let v,M;switch(u){case l.SIMULATOR:v=`${j}/simulator/sessions/${t.id}`,M=()=>T(se=>se.filter(he=>he.id!==t.id));break;case l.ROLEPLAY:v=`${j}/sessions/${t.id}`,M=()=>m(se=>se.filter(he=>he.id!==t.id));break;case l.VIDEO:v=`${j}/video-training/sessions/${t.id}`,M=()=>A(se=>se.filter(he=>he.id!==t.id));break;default:throw new Error("Unknown session type")}const Q=await(await fetch(v,{method:"DELETE",headers:{"X-WP-Nonce":re()}})).json();if(Q.success)M(),w&&$e();else throw new Error(Q.message||"Delete failed")}catch(v){throw console.error("Failed to delete session:",v),v}},ns=(t,u)=>(u===l.SIMULATOR?Je:u===l.VIDEO?Ze:Xe)[t?.scenario_id];if(_e)return e.jsx(pt,{briefing:_e,onBack:Cs,onDelete:es});if(F){const t={topic:F.topic||"",context:F.context||"",pros:F.pros||[],cons:F.cons||[],proScore:F.pro_score||0,contraScore:F.contra_score||0},u=async(M,W)=>{try{const Q={topic:M.topic,context:M.context||null,pros:M.pros,cons:M.cons,pro_score:M.proScore,contra_score:M.contraScore,analysis:W,status:"completed"};await q.updateDecision(F.id,Q);const se={...F,...Q};Bs(se),ae({data:M,result:W})}catch(Q){console.error("[SessionHistory] Failed to update decision:",Q)}},j=async M=>F.id,v=async(M,W)=>{try{await q.updateDecision(M,{topic:W.topic,context:W.context||null,pros:W.pros,cons:W.cons,pro_score:W.proScore,contra_score:W.contraScore,status:W.status||"draft"})}catch(Q){console.error("[SessionHistory] Failed to update decision:",Q)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(gs,{type:"decision",title:F.topic||"Entscheidung",status:F.status,createdAt:F.created_at,onBack:as,onDelete:()=>{window.confirm("M√∂chtest du diese Entscheidungs-Analyse wirklich l√∂schen?")&&(ss(F.id),as())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:Ce?e.jsx(gt,{decisionData:Ce.data,analysisResult:Ce.result,onStartNew:()=>{ae(null),J(null)},onEditDecision:()=>{ae(null)}}):e.jsx(ft,{initialData:t,onAnalysisComplete:u,isAuthenticated:n,savedDecisionId:F.id,onSaveDraft:j,onUpdateSession:v,onDecisionIdChange:()=>{}})})]})}if(i)return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(gs,{type:"ikigai",title:"Ikigai-Analyse",subtitle:i.status==="completed"?"Berufliche Orientierung":"In Bearbeitung",status:i.status,createdAt:i.created_at,onBack:Be,onDelete:()=>{window.confirm("M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen?")&&(ts(i.id),Be())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:ke?e.jsx(jt,{dimensions:_,synthesisResult:ke,onStartNew:Be,onEdit:()=>me(null),DIMENSIONS:fs}):e.jsx(bt,{dimensions:_,DIMENSIONS:fs,onExtractKeywords:Ts,onUpdateDimension:Os,onRemoveTag:Ms,allDimensionsFilled:Rs,onSynthesize:Fs,isSynthesizing:Re})})]});if(w){if(k===l.ROLEPLAY){const j=ns(w,k);return e.jsx(ht,{session:w,scenario:j,onBack:$e,onRepeat:()=>r?.(w,j,"roleplay"),onDelete:v=>Pe(v,l.ROLEPLAY)})}const u={[l.SIMULATOR]:"simulator",[l.VIDEO]:"video"}[k]||"simulator";return e.jsx(Ct,{session:w,type:k,scenario:ns(w,k),onBack:$e,onContinueSession:d,onRepeatSession:(j,v)=>r?.(j,v,u),onDeleteSession:Pe})}if(!n)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ds,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsx("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:"Hier findest du deine gespeicherten √úbungen und Fortschritte"})]}),e.jsxs($,{className:"max-w-[500px] mx-auto mt-16 p-10 text-center rounded-2xl shadow-card",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto mb-5",children:e.jsx(xs,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-slate-500 mb-6 leading-relaxed",children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),e.jsx(H,{onClick:g,size:"lg",icon:e.jsx(xs,{className:"w-5 h-5"}),children:"Jetzt anmelden"})]})]});if(Z)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx(Oe,{className:"w-12 h-12 rounded-2xl"}),e.jsx(Oe,{className:"h-10 w-48"})]}),e.jsx(Oe,{className:"h-5 w-32 mx-auto"})]}),e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:[1,2,3,4,5,6].map(t=>e.jsx(Oe,{className:"h-12 w-28 rounded-xl"},t))}),e.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:[1,2,3,4,5].map(t=>e.jsx(Js,{},t))})]});if(He)return e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ue,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:He}),e.jsx(H,{onClick:ze,children:"Erneut versuchen"})]})});const is=Es(),Ps=As();return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center relative",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ds,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsxs("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:[Qe," ",Qe===1?"√úbung":"√úbungen"," gespeichert"]}),e.jsx("button",{onClick:ze,disabled:Z,className:"absolute top-0 right-0 p-2.5 rounded-xl border border-slate-200 bg-white text-slate-500 shadow-sm flex items-center justify-center md:hidden disabled:opacity-50 hover:shadow-md transition-shadow",children:e.jsx(ms,{className:`w-5 h-5 ${Z?"animate-spin":""}`})})]}),e.jsx("div",{className:"hidden lg:flex flex-wrap gap-2 mx-6 mb-6 bg-slate-100 p-1.5 rounded-2xl",children:Ve.map(t=>{const u=t.icon,j=c===t.id,v=t.id===l.SIMULATOR?z.length:t.id===l.VIDEO?I.length:t.id===l.BRIEFINGS?y.length:t.id===l.DECISIONS?ee.length:t.id===l.IKIGAI?R.length:E.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 min-w-fit py-3 px-4 rounded-xl border-none text-sm cursor-pointer flex items-center justify-center gap-2 transition-all ${j?"bg-white text-slate-900 font-semibold shadow-md":"bg-transparent text-slate-500 font-medium hover:bg-white/50"}`,children:[e.jsx(u,{size:18}),e.jsx("span",{children:t.label}),e.jsx("span",{className:`py-0.5 px-2 rounded-xl text-xs font-semibold min-w-[24px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsxs("div",{className:"lg:hidden mx-4 mb-4",children:[e.jsx("div",{className:"flex gap-2 justify-center mb-3",children:Ve.map(t=>{const u=t.icon,j=c===t.id,v=t.id===l.SIMULATOR?z.length:t.id===l.VIDEO?I.length:t.id===l.BRIEFINGS?y.length:t.id===l.DECISIONS?ee.length:t.id===l.IKIGAI?R.length:E.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 max-w-[80px] py-3 px-2 rounded-xl border-2 cursor-pointer flex flex-col items-center justify-center gap-1 transition-all ${j?"bg-white shadow-md border-indigo-500":"bg-slate-100 border-transparent hover:bg-white/60"}`,children:[e.jsx(u,{size:20,className:j?"text-indigo-500":"text-slate-500"}),e.jsx("span",{className:`py-0.5 px-1.5 rounded-lg text-[11px] font-semibold min-w-[20px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsx("div",{className:"text-center text-[15px] font-semibold text-slate-900 py-2 px-4 bg-white rounded-xl shadow-sm",children:Ve.find(t=>t.id===c)?.label})]}),e.jsxs("div",{className:"hidden sm:flex justify-center lg:justify-end flex-wrap gap-3 mx-6 mb-6",children:[e.jsx(H,{variant:"outline",onClick:ze,disabled:Z,title:"Aktualisieren",children:e.jsx(ms,{className:`w-4 h-4 ${Z?"animate-spin":""}`})}),h&&e.jsxs(H,{onClick:()=>{const t={[l.BRIEFINGS]:"smart_briefing",[l.DECISIONS]:"decision_board",[l.IKIGAI]:"ikigai",[l.SIMULATOR]:"simulator",[l.VIDEO]:"video_training",[l.ROLEPLAY]:"dashboard"};h(t[c]||"overview")},children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),c===l.BRIEFINGS?"Neues Briefing":c===l.DECISIONS?"Neue Entscheidungs-Analyse":c===l.IKIGAI?"Neue Ikigai-Analyse":c===l.SIMULATOR?"Neues Szenario-Training":c===l.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),e.jsx("div",{className:"mx-4 sm:mx-6",children:is.length===0?e.jsxs($,{className:"text-center py-16 px-6 rounded-2xl shadow-card",children:[c===l.SIMULATOR&&e.jsx(Me,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.ROLEPLAY&&e.jsx(fe,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.VIDEO&&e.jsx(Ae,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.BRIEFINGS&&e.jsx(qe,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.DECISIONS&&e.jsx(De,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===l.IKIGAI&&e.jsx(Ee,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-slate-600 mb-2",children:["Noch keine ",c===l.SIMULATOR?"Szenario-Trainings":c===l.VIDEO?"Wirkungs-Analysen":c===l.BRIEFINGS?"Smart Briefings":c===l.DECISIONS?"Entscheidungs-Analysen":c===l.IKIGAI?"Ikigai-Analysen":"Live-Simulationen"]}),e.jsx("p",{className:"text-slate-500 mb-6",children:c===l.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":c===l.DECISIONS?"Nutze den Entscheidungs-Kompass, um deine erste Entscheidung zu analysieren.":c===l.IKIGAI?"Entdecke deinen idealen Karrierepfad mit dem Ikigai-Kompass.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),e.jsxs(H,{onClick:s,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),c===l.BRIEFINGS?"Briefing erstellen":c===l.DECISIONS?"Entscheidung analysieren":c===l.IKIGAI?"Ikigai entdecken":"Training starten"]})]}):e.jsx(C.div,{className:"flex flex-col gap-3",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:c===l.BRIEFINGS?y.map(t=>e.jsx(zt,{briefing:t,onClick:()=>_s(t),onDelete:es},t.id)):c===l.DECISIONS?ee.map(t=>e.jsx(Ot,{decision:t,onClick:()=>zs(t),onDelete:ss},t.id)):c===l.IKIGAI?R.map(t=>e.jsx(Mt,{ikigai:t,onDelete:ts,onNavigate:()=>Ls(t)},t.id)):is.map(t=>{const u=Ps[t.scenario_id];return e.jsx(Lt,{session:t,type:c,scenario:u,onClick:()=>$s(t),onContinueSession:d,onDeleteSession:Pe},t.id)})})})]})};export{ra as SESSION_TABS,la as default};
