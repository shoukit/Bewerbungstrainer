import{j as e,L as $e,I as he,a1 as pe,T as nt,z as ae,X as xe,V as D,l as Le,ao as rt,R as it,B as Ke,w as ge,i as ot,g as be,a as lt,aj as ct,f as dt,ai as mt,v as Ue,e as xt,E as ze,ap as De,q as Te,h as ue,b as Re,m as A,aq as ut,t as qe,y as fe,A as We,ak as ht,a0 as Ge,a8 as Ve,M as pt,a9 as gt,C as bt}from"./ui-vendor-CgXEyNXi.js";import{a}from"./react-vendor-uDOJF2jQ.js";import{C as h,e as ft,F as jt,g as je,a as H,u as ye,i as yt,j as Qe}from"./FeatureInfoButton-CyErgWRh.js";import{S as vt}from"./ScenarioDashboard-Bd16vzqh.js";import{B as se}from"./button-DU-2yNPf.js";import{I as me}from"./input-lfaX5RPk.js";import{T as Nt}from"./textarea-CvyTjNsl.js";import{D as wt}from"./DeviceSetupPage-BvpgCvbL.js";import{F as St}from"./fullscreen-loader-QVzgL1bS.js";import{u as Ct}from"./useMobile-YxjH166V.js";import{D as kt}from"./DeviceSettingsDialog-BwJw0HZI.js";import{A as _e}from"./MicrophoneTestDialog-DmGpMoMn.js";import{P as At}from"./progress-bar-D8XfLA_b.js";import{B as Q,C as It}from"./Button-j0YrfSxa.js";import"./select-native-BxSPgKHW.js";import"./dialog-dwOizz02.js";import{u as Et}from"./Confetti-BZNGNZhn.js";const Fe={error:{bg:h.red[50],border:h.red[200],text:h.red[600],icon:ae},warning:{bg:h.amber[50],border:h.amber[200],text:h.amber[600],icon:nt},success:{bg:h.green[50],border:h.green[200],text:h.green[600],icon:pe},info:{bg:h.blue[50],border:h.blue[200],text:h.blue[500],icon:he},loading:{bg:h.blue[50],border:h.blue[200],text:h.blue[500],icon:$e}},zt=({variant:t="info",message:s,children:i,isToast:c=!1,onDismiss:u,className:d="",style:b={}})=>{const r=Fe[t]||Fe.info,n=r.icon,f=t==="loading";return e.jsxs("div",{className:`flex items-center gap-3 py-3 px-4 rounded-xl text-sm font-medium ${c?"fixed bottom-6 left-1/2 -translate-x-1/2 shadow-lg z-[1000] max-w-[90%]":""} ${d}`,style:{backgroundColor:r.bg,border:`1px solid ${r.border}`,color:r.text,...b},children:[e.jsx(n,{size:20,className:`flex-shrink-0 ${f?"animate-spin":""}`}),e.jsx("span",{className:"flex-1",children:i||s}),u&&e.jsx("button",{onClick:u,className:"bg-transparent border-none p-1 cursor-pointer flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity",style:{color:r.text},"aria-label":"Schließen",children:e.jsx(xe,{size:16})})]})},Dt=({message:t,onDismiss:s,...i})=>e.jsx(zt,{variant:"error",message:t,isToast:!0,onDismiss:s,...i}),Tt={video:D,user:ge,briefcase:Ke,presentation:mt,mic:dt,target:Le,banknote:ct},Rt={self_presentation:{label:"Selbstpräsentation",icon:ge,color:h.indigo[500],bgColor:h.indigo[50]},interview:{label:"Bewerbungsgespräch",icon:Ke,color:h.emerald[600],bgColor:h.emerald[100]},pitch:{label:"Elevator Pitch",icon:it,color:h.violet[600],bgColor:h.violet[100]},negotiation:{label:"Verhandlung",icon:rt,color:h.amber[600],bgColor:h.amber[100]},custom:{label:"Training",icon:Le,color:h.slate[500],bgColor:h.slate[100]}},Vt=async()=>{const t=await fetch(`${je()}/video-training/scenarios`,{headers:{"X-WP-Nonce":H()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const s=await t.json();if(s.success&&s.data?.scenarios)return s.data.scenarios;throw new Error("Ungültige Antwort vom Server")},_t=t=>Tt[t.icon]||D,Ft=t=>[{text:`${t.question_count} Fragen`},{icon:be,text:`~${Math.round(t.total_time_limit/60)} Min.`}],Bt=()=>e.jsx("div",{className:"mt-10 p-5 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(lt,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed m-0",children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Be=({onSelectScenario:t,isAuthenticated:s,requireAuth:i,setPendingScenario:c,onNavigateToHistory:u})=>e.jsxs(e.Fragment,{children:[e.jsx(ft,{featureId:"videotraining",showOnMount:!0}),e.jsx(vt,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:D,headerActions:e.jsx(jt,{featureId:"videotraining",size:"sm"}),fetchScenarios:Vt,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:u,onSelectScenario:t,renderCardMeta:Ft,getIconForScenario:_t,cardActionLabel:"Starten",cardActionIcon:ot,categoryField:"scenario_type",customCategoryConfig:Rt,emptyStateIcon:D,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:Bt,isAuthenticated:s,requireAuth:i,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]}),Mt=({field:t,value:s,onChange:i,error:c,focusColor:u})=>{const d=r=>{setTimeout(()=>{const n=r.target;if(n){const f=n.closest("div");f&&f.scrollIntoView({behavior:"smooth",block:"center"})}},300)},b=()=>{const r=c?"border-red-500":"";switch(t.type){case"text":return e.jsx(me,{type:"text",value:s||"",onChange:n=>i(t.key,n.target.value),placeholder:t.placeholder||"",className:r,onFocus:d});case"textarea":return e.jsx(Nt,{value:s||"",onChange:n=>i(t.key,n.target.value),placeholder:t.placeholder||"",rows:4,className:`${r} min-h-[100px] resize-y`,onFocus:d});case"select":return e.jsxs("select",{value:s||t.default||"",onChange:n=>i(t.key,n.target.value),className:`w-full px-4 py-3 rounded-xl border-2 text-base text-slate-900 bg-white outline-none transition-all cursor-pointer appearance-none bg-[url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%236b7280%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e')] bg-[position:right_12px_center] bg-no-repeat bg-[length:20px] pr-11 focus:border-primary focus:ring-2 focus:ring-primary/20 ${c?"border-red-500":"border-slate-200"}`,onFocus:d,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),t.options?.slice().sort((n,f)=>n.label.localeCompare(f.label,"de")).map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]});case"number":return e.jsx(me,{type:"number",value:s||"",onChange:n=>i(t.key,n.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:r,onFocus:d});default:return e.jsx(me,{type:"text",value:s||"",onChange:n=>i(t.key,n.target.value),placeholder:t.placeholder||"",className:r,onFocus:d})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),b(),c&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-red-500 flex items-center gap-1",children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-slate-500 flex items-center gap-1",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),t.hint]})]})},Pt=({scenario:t,onBack:s,onNext:i})=>{const[c,u]=a.useState({}),[d,b]=a.useState({}),r=a.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(p=>p.user_input!==!1)}catch(o){return console.error("Error parsing input_configuration:",o),[]}},[t?.input_configuration]);a.useEffect(()=>{const o={};r.forEach(p=>{p.default&&(o[p.key]=p.default)}),u(o)},[r]);const n=(o,p)=>{u(l=>({...l,[o]:p})),d[o]&&b(l=>{const g={...l};return delete g[o],g})},f=()=>{const o={};return r.forEach(p=>{const l=c[p.key];if(p.required&&(!l||typeof l=="string"&&l.trim()==="")){o[p.key]="Dieses Feld ist erforderlich";return}if(!(!l||typeof l=="string"&&l.trim()==="")&&p.validation){const{minLength:g,maxLength:v,min:C,max:k,pattern:z}=p.validation;g&&l.length<g&&(o[p.key]=`Mindestens ${g} Zeichen erforderlich`),v&&l.length>v&&(o[p.key]=`Maximal ${v} Zeichen erlaubt`),C!==void 0&&Number(l)<C&&(o[p.key]=`Mindestens ${C}`),k!==void 0&&Number(l)>k&&(o[p.key]=`Maximal ${k}`),z&&!new RegExp(z).test(l)&&(o[p.key]="Ungültiges Format")}}),b(o),Object.keys(o).length===0},m=o=>{o.preventDefault(),f()&&i(c)};return a.useEffect(()=>{r.length===0&&i({})},[r,i]),r.length===0?null:e.jsxs("div",{className:"p-6 pb-52 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(se,{onClick:s,variant:"ghost",className:"inline-flex items-center gap-2 px-3 py-2 mb-4 text-sm",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(D,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 mt-1 mb-0",children:"Personalisiere dein Training"})]})]})]}),t.description&&e.jsx("div",{className:"p-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("div",{className:"p-4 px-5 rounded-xl bg-primary/10 mb-6 flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 m-0 mb-1",children:"So funktioniert es"}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 leading-normal",children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),e.jsxs("form",{onSubmit:m,children:[r.map(o=>e.jsx(Mt,{field:o,value:c[o.key],onChange:n,error:d[o.key]},o.key)),e.jsxs(se,{type:"submit",size:"lg",className:"w-full mt-6 gap-2.5",children:["Weiter",e.jsx(xt,{className:"w-5 h-5"})]})]})]})},Ot=()=>{const[t,s]=a.useState(!1),[i,c]=a.useState(null),{demoCode:u}=ye(),d=a.useCallback(async(r,n,f)=>{c(null),s(!0);try{const m=await r();n(m)}catch(m){console.error("[useSessionStartup] Error:",m);const o=m.message||"Ein Fehler ist aufgetreten";c(o),s(!1),f?.(m)}},[]),b=a.useCallback(()=>{c(null)},[]);return{isSubmitting:t,submitError:i,demoCode:u,startSession:d,clearError:b}},$t=({scenario:t,variables:s,onBack:i,onStart:c})=>{const{isSubmitting:u,submitError:d,demoCode:b,startSession:r,clearError:n}=Ot(),f=async({selectedMicrophoneId:m,selectedCameraId:o})=>{await r(async()=>{const p=je(),l=await fetch(`${p}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()},body:JSON.stringify({scenario_id:t.id,variables:s,demo_code:b||null})});if(!l.ok){const E=await l.json().catch(()=>({}));throw new Error(E.message||"Fehler beim Erstellen der Session")}const g=await l.json(),v=g.data?.session||g.session;if(!v)throw new Error("Keine Session-ID erhalten");const C=await fetch(`${p}/video-training/sessions/${v.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()},body:JSON.stringify({variables:s})});if(!C.ok){const E=await C.json().catch(()=>({}));throw new Error(E.message||"Fehler beim Generieren der Fragen")}const k=await C.json(),z=k.data?.questions||k.questions||[];return{session:{...v,questions:z},questions:z,scenario:t,variables:s,selectedMicrophoneId:m,selectedCameraId:o}},c)};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{mode:"audio-video",scenario:t,onBack:i,onStart:f,title:t?.title,startButtonLabel:"Video-Training starten",icon:D}),d&&e.jsx(Dt,{message:d,onDismiss:n}),e.jsx(St,{isLoading:u,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},Lt=({tips:t,primaryAccent:s})=>{const[i,c]=a.useState(!1);return!t||t.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>c(!i),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(fe,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(ue,{size:18,className:`text-slate-500 transition-transform duration-200 ${i?"rotate-90":""}`})]}),e.jsx(We,{children:i&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:t.map((u,d)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:u},d))})})})})]})},Kt=({number:t,size:s="md"})=>{const i={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${i[s]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},Me=({question:t,index:s,scenario:i,isMobile:c})=>e.jsxs(It,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Kt,{number:s+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||"Frage wird geladen..."}),t?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(be,{size:c?14:16}),"Empfohlene Antwortzeit: ~",Math.round(t.estimated_time/60)," Min."]}),i?.enable_tips&&t?.tips&&e.jsx(Lt,{tips:t.tips})]}),Pe=({time:t,isRecording:s})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[s?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(be,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:yt(t)})]}),Oe=({error:t,onRetry:s})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(ut,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:t}),e.jsx(Q,{onClick:s,icon:e.jsx(qe,{size:16}),children:"Erneut versuchen"})]}),Ut=({isUploading:t,isAnalyzing:s})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-indigo-50/30 to-violet-50/30 flex items-center justify-center p-4",children:e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx($e,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:t?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:t?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),qt=({session:t,questions:s,scenario:i,variables:c,onComplete:u,onExit:d,selectedMicrophoneId:b,selectedCameraId:r})=>{const[n,f]=a.useState(0),[m,o]=a.useState(!1),[p,l]=a.useState(!1),[g,v]=a.useState(0),[C,k]=a.useState([]),[z,E]=a.useState([]),[N,F]=a.useState(null),[T,B]=a.useState(null),[L,R]=a.useState(!1),[X,Z]=a.useState(!1),[J,M]=a.useState(null),[K,ne]=a.useState(b||null),[U,w]=a.useState(r||null),[He,re]=a.useState(!1),[ve,Ne]=a.useState(0),q=Ct(),Y=a.useRef(null),ie=a.useRef(null),P=a.useRef(null),W=a.useRef(null),oe=a.useRef(null),O=a.useRef(null),{branding:Xe}=ye(),le=Xe?.["--primary-accent"],we=s[n];a.useEffect(()=>($(),()=>{ce(),P.current&&clearInterval(P.current),O.current&&cancelAnimationFrame(O.current),W.current&&W.current.close()}),[]);const Ze=x=>{try{W.current&&W.current.close();const S=new(window.AudioContext||window.webkitAudioContext);W.current=S;const j=S.createAnalyser();j.fftSize=256,j.smoothingTimeConstant=.8,oe.current=j,S.createMediaStreamSource(x).connect(j);const V=new Uint8Array(j.frequencyBinCount),_=()=>{if(!oe.current)return;oe.current.getByteFrequencyData(V);const de=V.reduce((st,at)=>st+at,0)/V.length;Ne(de/255),O.current=requestAnimationFrame(_)};_()}catch(S){console.error("[VIDEO TRAINING] Audio analysis error:",S)}},Je=()=>{O.current&&(cancelAnimationFrame(O.current),O.current=null),Ne(0)},$=async(x=K,S=U)=>{try{B(null),N&&N.getTracks().forEach(_=>_.stop());const j=S?{deviceId:{exact:S},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},I=x?{deviceId:{exact:x}}:!0,V=await navigator.mediaDevices.getUserMedia({video:j,audio:I});F(V),Y.current&&(Y.current.srcObject=V)}catch(j){console.error("[VIDEO TRAINING] Camera error:",j),B("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Ye=x=>{ne(x),m||$(x,U)},et=x=>{w(x),m||$(K,x)},ce=()=>{N&&(N.getTracks().forEach(x=>x.stop()),F(null))},Se=()=>{if(!N){$();return}try{const x=new MediaRecorder(N,{mimeType:"video/webm;codecs=vp9,opus"});ie.current=x;const S=[];x.ondataavailable=j=>{j.data.size>0&&(S.push(j.data),k(I=>[...I,j.data]))},x.onstop=()=>{},x.start(1e3),o(!0),l(!1),Ze(N),E(j=>[...j,{question_index:n,start_time:g}]),P.current=setInterval(()=>{v(j=>j+1)},1e3)}catch(x){console.error("[VIDEO TRAINING] Recording error:",x),M("Fehler beim Starten der Aufnahme")}},ee=()=>{ie.current&&m&&(ie.current.stop(),o(!1),Je(),P.current&&(clearInterval(P.current),P.current=null))},Ce=()=>{n<s.length-1&&(m&&E(x=>[...x,{question_index:n+1,start_time:g}]),f(x=>x+1))},ke=()=>{n>0&&f(x=>x-1)},Ae=async()=>{ee(),ce(),R(!0),M(null);try{const x=new Blob(C,{type:"video/webm"}),S=je(),j=new FormData;j.append("video",x,`video_${t.id}.webm`),j.append("video_duration",g.toString()),j.append("timeline",JSON.stringify(z));const I=await fetch(`${S}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":H()},body:j});if(!I.ok){const de=await I.text();throw console.error("[VIDEO TRAINING] Upload failed:",I.status,de),I.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+I.status)}const V=await I.json();R(!1),Z(!0);const _=await fetch(`${S}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()}});if(!_.ok)throw new Error("Fehler bei der Video-Analyse");const G=await _.json();u({session:G.data?.session||t,analysis:G.data?.analysis,categoryScores:G.data?.category_scores,overallScore:G.data?.overall_score})}catch(x){console.error("[VIDEO TRAINING] Upload/Analysis error:",x),M(x.message),R(!1),Z(!1)}},tt=()=>{ee(),ce(),d()};if(L||X)return e.jsx(Ut,{isUploading:L,isAnalyzing:X});const te=C.length>0,Ie=i?.enable_navigation&&n>0,Ee=i?.enable_navigation&&n<s.length-1;return e.jsxs("div",{className:`${q?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${q?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${q?"text-lg":"text-xl"} font-semibold text-slate-900`,children:i?.title}),e.jsxs("button",{onClick:tt,className:`${q?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(xe,{size:16}),"Abbrechen"]})]}),e.jsx(At,{current:n,total:s.length,primaryAccent:le,showCompleted:!1}),q?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Me,{question:we,index:n,scenario:i,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[T?e.jsx(Oe,{error:T,onRetry:$}):e.jsx("video",{ref:Y,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(m||g>0)&&e.jsx(Pe,{time:g,isRecording:m})]}),m&&e.jsx("div",{className:"mt-4",children:e.jsx(_e,{audioLevel:ve,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>re(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),m?e.jsxs("button",{onClick:ee,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(De,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Se,disabled:!N,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[Ie&&e.jsx(Q,{variant:"secondary",size:"sm",icon:e.jsx(Te,{size:16}),onClick:ke,className:"flex-1",children:"Zurück"}),Ee&&e.jsx(Q,{size:"sm",iconPosition:"right",icon:e.jsx(ue,{size:16}),onClick:Ce,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Ae,disabled:!te,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${te?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[T?e.jsx(Oe,{error:T,onRetry:$}):e.jsx("video",{ref:Y,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(m||g>0)&&e.jsx(Pe,{time:g,isRecording:m})]}),m&&e.jsx("div",{className:"mt-5",children:e.jsx(_e,{audioLevel:ve,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>re(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),m?e.jsxs("button",{onClick:ee,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(De,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Se,disabled:!N,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[Ie&&e.jsx(Q,{variant:"secondary",icon:e.jsx(Te,{size:18}),onClick:ke,children:"Vorherige"}),Ee&&e.jsx(Q,{iconPosition:"right",icon:e.jsx(ue,{size:18}),onClick:Ce,children:"Nächste"}),e.jsxs("button",{onClick:Ae,disabled:!te,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${te?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(Me,{question:we,index:n,scenario:i,isMobile:!1})]}),J&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(ae,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:J}),e.jsx("button",{onClick:()=>M(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(xe,{size:16,className:"text-red-500"})})]}),e.jsx(kt,{isOpen:He,onClose:()=>re(!1),mode:"audio-video",selectedMicrophoneId:K,onMicrophoneChange:Ye,selectedCameraId:U,onCameraChange:et})]})},Wt={auftreten:gt,selbstbewusstsein:Ve,koerpersprache:ge,kommunikation:pt,professionalitaet:Ve,inhalt:fe},Gt=({score:t,size:s=120,strokeWidth:i=10,primaryAccent:c})=>{const u=(s-i)/2,d=u*2*Math.PI,b=d-t/100*d,r=Qe(t,c);return e.jsxs("div",{className:"relative mx-auto",style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,className:"-rotate-90",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:u,fill:"none",stroke:h.slate[200],strokeWidth:i}),e.jsx(A.circle,{cx:s/2,cy:s/2,r:u,fill:"none",stroke:r,strokeWidth:i,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:b},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold text-slate-600",style:{fontSize:s/3,color:r},children:Math.round(t)}),e.jsx("span",{className:"text-slate-500",style:{fontSize:s/10},children:"von 100"})]})]})},Qt=({category:t,primaryAccent:s})=>{const[i,c]=a.useState(!1),u=Wt[t.category]||Ge,d=Qe(t.score,s);return e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-slate-200 overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>c(!i),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:`${d}15`},children:e.jsx(u,{size:20,color:d})}),e.jsxs("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"text-[15px] font-semibold text-slate-900 mb-0.5",children:t.label}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[t.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",style:{color:d},children:Math.round(t.score)}),e.jsx(bt,{size:20,className:"text-slate-500 transition-transform duration-200",style:{transform:i?"rotate(180deg)":"none"}})]})]}),e.jsx(We,{children:i&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:t.feedback}),t.strengths&&t.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-green-600 mb-2 flex items-center gap-1.5",children:[e.jsx(pe,{size:14}),"Stärken"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.strengths.map((b,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:b},r))})]}),t.improvements&&t.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-amber-600 mb-2 flex items-center gap-1.5",children:[e.jsx(ae,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.improvements.map((b,r)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:b},r))})]})]})})})]})},Ht=({session:t,scenario:s,onBackToDashboard:i,onStartNew:c})=>{const{branding:u}=ye(),d=u?.["--primary-accent"]||h.indigo[500],{triggerConfetti:b,ConfettiComponent:r}=Et(),n=t?.overall_score||0,f=t?.category_scores||[],m=t?.analysis||{},o=t?.summary_feedback||"",p=l=>l>=90?"Ausgezeichnet!":l>=80?"Sehr gut!":l>=70?"Gut!":l>=60?"Solide Leistung":l>=50?"Ausbaufähig":"Weiter üben!";return a.useEffect(()=>{n>=70&&b()},[n,b]),e.jsxs(e.Fragment,{children:[e.jsx(r,{}),e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-brand-gradient flex items-center justify-center mx-auto mb-5 shadow-xl",children:e.jsx(ht,{size:40,color:h.white})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Training abgeschlossen!"}),e.jsxs("p",{className:"text-base text-slate-600",children:[s?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"bg-white rounded-2xl p-8 text-center border border-slate-200 shadow-md mb-6",children:[e.jsx(Gt,{score:n,size:160,primaryAccent:d}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mt-5 mb-2",children:p(n)}),e.jsx("p",{className:"text-[15px] text-slate-600 max-w-lg mx-auto leading-relaxed",children:o||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),f.length>0&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Ge,{size:20,color:d}),"Detaillierte Bewertung"]}),f.map((l,g)=>e.jsx(Qt,{category:l,primaryAccent:d},l.category||g))]}),m&&(m.key_strengths?.length>0||m.actionable_tips?.length>0)&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[m.key_strengths&&m.key_strengths.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-base font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:18}),"Deine Stärken"]}),e.jsx("ul",{className:"m-0 pl-6",children:m.key_strengths.map((l,g)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:l},g))})]}),m.actionable_tips&&m.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-base font-semibold mb-3 flex items-center gap-2",style:{color:d},children:[e.jsx(fe,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-6",children:m.actionable_tips.map((l,g)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:l},g))})]})]}),t?.video_url&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(D,{size:18,color:d}),"Deine Aufnahme"]}),e.jsx("video",{src:t.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex gap-4 justify-center",children:[e.jsxs(se,{onClick:i,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(Ue,{size:18}),"Zur Übersicht"]}),e.jsxs(se,{onClick:c,size:"lg",className:"gap-2 shadow-lg",children:[e.jsx(qe,{size:18}),"Nochmal üben"]})]})]})]})},y={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},us=({isAuthenticated:t,requireAuth:s,setPendingAction:i,pendingScenario:c,clearPendingScenario:u,onNavigateToHistory:d})=>{const[b,r]=a.useState(y.DASHBOARD),[n,f]=a.useState(null),[m,o]=a.useState(null),[p,l]=a.useState([]),[g,v]=a.useState({}),[C,k]=a.useState(null),[z,E]=a.useState(null),[N,F]=a.useState(null),[T,B]=a.useState(null);a.useEffect(()=>{c&&t&&(f(c),r(y.VARIABLES),u&&u())},[c,t,u]),a.useEffect(()=>{T&&t&&(f(T),r(y.VARIABLES),B(null))},[T,t]),a.useEffect(()=>{window.scrollTo(0,0)},[b]);const L=a.useCallback(w=>{f(w),r(y.VARIABLES)},[]),R=a.useCallback(()=>{f(null),o(null),l([]),v({}),k(null),E(null),F(null),r(y.DASHBOARD)},[]),X=a.useCallback(w=>{v(w),r(y.DEVICE_SETUP)},[]),Z=a.useCallback(()=>{r(y.VARIABLES)},[]),J=a.useCallback(w=>{o(w.session),l(w.questions),v(w.variables),E(w.selectedMicrophoneId),F(w.selectedCameraId),r(y.SESSION)},[]),M=a.useCallback(w=>{k(w.session),r(y.COMPLETE)},[]),K=a.useCallback(()=>{R()},[R]),ne=a.useCallback(()=>{o(null),l([]),k(null),E(null),F(null),r(y.VARIABLES)},[]),U=()=>{switch(b){case y.DASHBOARD:return e.jsx(Be,{onSelectScenario:L,isAuthenticated:t,requireAuth:s,setPendingScenario:B,onNavigateToHistory:d});case y.VARIABLES:return e.jsx(Pt,{scenario:n,onBack:R,onNext:X});case y.DEVICE_SETUP:return e.jsx($t,{scenario:n,variables:g,onBack:Z,onStart:J});case y.SESSION:return e.jsx(qt,{session:m,questions:p,scenario:n,variables:g,onComplete:M,onExit:K,selectedMicrophoneId:z,selectedCameraId:N});case y.COMPLETE:return e.jsx(Ht,{session:C,scenario:n,onBackToDashboard:R,onStartNew:ne});default:return e.jsx(Be,{onSelectScenario:L,isAuthenticated:t,requireAuth:s,setPendingScenario:B,onNavigateToHistory:d})}};return e.jsx("div",{className:"min-h-full",children:U()})};export{us as V,Be as a,qt as b,Ht as c};
