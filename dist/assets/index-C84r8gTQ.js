import{j as S}from"./ui-vendor-BAEfSb-X.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{a as A,D as b}from"./DecisionBoardResult-B8HZl27b.js";import{w as u}from"./designTokens-C-Oq4uPZ.js";import"./card-CRd_k1Xo.js";import"./utils-BEHD0UYf.js";import"./button-Cx1uqZws.js";import"./input-B2p07toF.js";import"./textarea-AQGmZicy.js";import"./useBranding-C82W9Jgj.js";import"./index.js";import"./AudioRecorder-BwTjhjXB.js";const c={INPUT:"input",RESULT:"result"},K=({isAuthenticated:h,requireAuth:C,setPendingAction:k,onNavigateToHistory:l})=>{const[m,p]=o.useState(c.INPUT),[w,d]=o.useState(null),[I,a]=o.useState(null),[t,r]=o.useState(null),[P,g]=o.useState(!1),i=o.useRef(!1);o.useEffect(()=>{window.scrollTo(0,0)},[m]);const x=o.useCallback(async e=>{if(i.current||!e.topic?.trim())return null;try{const s={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},n=await u.createDecision(s);if(n?.id)return i.current=!0,r(n.id),console.log("[DecisionBoard] Draft session saved with ID:",n.id),n.id}catch(s){console.error("[DecisionBoard] Failed to save draft session:",s)}return null},[]),D=o.useCallback(async(e,s)=>{if(e)try{const n={topic:s.topic,context:s.context||null,pros:s.pros||[],cons:s.cons||[],pro_score:s.proScore||0,contra_score:s.contraScore||0,analysis:s.analysis||null,status:s.status||"completed"};await u.updateDecision(e,n),console.log("[DecisionBoard] Session updated:",e)}catch(n){console.error("[DecisionBoard] Failed to update session:",n)}},[]),y=o.useCallback(async e=>{if(e)try{await u.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(s){console.error("[DecisionBoard] Failed to delete session:",s)}},[]),B=o.useCallback(async(e,s)=>{d(e),a(s),p(c.RESULT);try{if(t)await D(t,{...e,analysis:s,status:"completed"});else{const n={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:s,status:"completed"},f=await u.createDecision(n);f?.id&&(r(f.id),i.current=!0,console.log("[DecisionBoard] Decision saved with ID:",f.id))}}catch(n){console.error("[DecisionBoard] Failed to save decision:",n)}},[t,D]),v=o.useCallback(()=>{d(null),a(null),r(null),i.current=!1,p(c.INPUT)},[]),E=o.useCallback(()=>{a(null),p(c.INPUT)},[]),R=o.useCallback(async()=>{t&&await y(t),d(null),a(null),r(null),i.current=!1,l&&l()},[t,y,l]),U=()=>{switch(m){case c.RESULT:return S.jsx(b,{decisionData:w,analysisResult:I,onStartNew:v,onEditDecision:E});case c.INPUT:default:return S.jsx(A,{initialData:w,onAnalysisComplete:B,onCancel:l?R:null,isAuthenticated:h,requireAuth:C,savedDecisionId:t,onSaveDraft:x,onUpdateSession:D,onDecisionIdChange:r})}};return S.jsx("div",{style:{minHeight:"100%"},children:U()})};export{K as DecisionBoardApp,A as DecisionBoardInput,b as DecisionBoardResult};
