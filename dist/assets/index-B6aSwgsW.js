import{j as e,p as G,q as Rt,b as X,a as Ie,T as se,ai as At,w as It,aj as _t,B as ot,v as _e,x as Ve,e as Be,ae as Re,O as at,o as lt,z as xe,I as he,M as ue,a7 as Bt,aa as ct,k as dt,y as V,_ as Pe,ak as pt,h as De,a2 as Mt,l as He,a3 as Nt,a4 as Ze,a5 as $t,A as Et,m as Tt,J as Ft,E as qe,al as Lt,a1 as ge,am as Oe,n as ut,X as Wt,i as Dt,a0 as qt}from"./ui-vendor-B9DEMv6g.js";import{a as c,d as xt}from"./react-vendor-uDOJF2jQ.js";import{h as Ot,F as Vt,g as Pt,c as Ht,C as j,u as Ge,D as Te,i as Ae,w as Q,j as Zt}from"./FeatureInfoButton-DsfjgKw4.js";import{S as Gt}from"./ScenarioDashboard-Db_QZFbt.js";import{u as Ke}from"./useBranding-CjHnMPMs.js";import{u as Kt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-B3p3lDN6.js";import{A as Ut,M as ht,a as gt}from"./MicrophoneTestDialog-BLXXwYm5.js";import{D as Jt}from"./DeviceSettingsDialog-CMTdWkBo.js";import{F as mt}from"./fullscreen-loader-CGHRnDJu.js";import{B as ae,C as ze}from"./Button-BHvYxNT_.js";import"./select-native-BMh_kGEB.js";import"./dialog-Dg1K-ctH.js";import{D as Xt}from"./DynamicFormField-BNIpbzt6.js";import"./ScenarioCard-OpqbSsPm.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-DrPY-0u7.js";import"./index-CklPxmEV.js";const et="[SIMULATOR_DASHBOARD]",Yt={briefcase:ot,banknote:_t,user:It,presentation:At,target:se,mic:G},es=async()=>{const t=await fetch(`${Pt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Ht()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const i=await t.json();if(i.success&&i.data?.scenarios)return i.data.scenarios;throw new Error("Keine Szenarien gefunden")},ts=t=>Yt[t.icon]||ot,ss=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],tt=({onSelectScenario:t,isAuthenticated:i,requireAuth:p,setPendingScenario:n,onNavigateToHistory:s})=>(c.useEffect(()=>(console.log(`${et} ðŸ”µ MOUNT`),()=>{console.log(`${et} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Ot,{featureId:"simulator",showOnMount:!0}),e.jsx(Gt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ie,headerActions:e.jsx(Vt,{featureId:"simulator",size:"sm"}),fetchScenarios:es,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:s,onSelectScenario:t,renderCardMeta:ss,getIconForScenario:ts,cardActionLabel:"Starten",cardActionIcon:Rt,categoryField:"category",emptyStateIcon:G,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:i,requireAuth:p,setPendingScenario:n,loadingMessage:"Szenarien werden geladen..."})]})),rs=({field:t,value:i,onChange:p,error:n,focusColor:s,branding:l})=>{const m=s||"#4a9ec9",b={width:"100%",padding:`${l.space[3]} ${l.space[4]}`,borderRadius:l.radius.lg,border:`2px solid ${n?j.red[500]:j.slate[200]}`,fontSize:l.fontSize.base,color:j.slate[900],backgroundColor:"white",outline:"none",transition:l.transition.normal},S={borderColor:m,boxShadow:`0 0 0 3px ${m}1a`},u=o=>{Object.assign(o.target.style,S),setTimeout(()=>{const A=o.target;if(A){const C=A.closest("div");C&&C.scrollIntoView({behavior:"smooth",block:"center"})}},300)},d=o=>{o.target.style.borderColor=n?j.red[500]:j.slate[200],o.target.style.boxShadow="none"},r=()=>{switch(t.type){case"text":return e.jsx("input",{type:"text",value:i||"",onChange:o=>p(t.key,o.target.value),placeholder:t.placeholder||"",style:b,onFocus:u,onBlur:d});case"textarea":return e.jsx("textarea",{value:i||"",onChange:o=>p(t.key,o.target.value),placeholder:t.placeholder||"",rows:4,style:{...b,resize:"vertical",minHeight:"100px"},onFocus:u,onBlur:d});case"select":return e.jsxs("select",{value:i||t.default||"",onChange:o=>p(t.key,o.target.value),style:{...b,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:u,onBlur:d,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]});case"number":return e.jsx("input",{type:"number",value:i||"",onChange:o=>p(t.key,o.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:b,onFocus:u,onBlur:d});default:return e.jsx("input",{type:"text",value:i||"",onChange:o=>p(t.key,o.target.value),placeholder:t.placeholder||"",style:b,onFocus:u,onBlur:d})}};return e.jsxs("div",{style:{marginBottom:l.space[5]},children:[e.jsxs("label",{style:{display:"block",marginBottom:l.space[2],fontSize:l.fontSize.sm,fontWeight:600,color:j.slate[700]},children:[t.label,t.required&&e.jsx("span",{style:{color:j.red[500],marginLeft:l.space[1]},children:"*"})]}),r(),n&&e.jsxs("p",{style:{marginTop:l.space[1.5],fontSize:l.fontSize.xs,color:j.red[500],display:"flex",alignItems:"center",gap:l.space[1]},children:[e.jsx(xe,{style:{width:"14px",height:"14px"}}),n]}),t.hint&&!n&&e.jsxs("p",{style:{marginTop:l.space[1.5],fontSize:l.fontSize.xs,color:j.slate[500],display:"flex",alignItems:"center",gap:l.space[1]},children:[e.jsx(he,{style:{width:"14px",height:"14px"}}),t.hint]})]})},ns=({scenario:t,onBack:i,onNext:p})=>{const[n,s]=c.useState({}),[l,m]=c.useState({}),[b,S]=c.useState([]),[u,d]=c.useState(!1),r=Ke(),o=xt.useMemo(()=>{if(!t?.input_configuration)return[];try{const x=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(x)?x.filter(h=>h.user_input!==!1):[]}catch(x){return console.error("Error parsing input_configuration:",x),[]}},[t?.input_configuration]);c.useEffect(()=>{const x={};o.forEach(h=>{h.default&&(x[h.key]=h.default)}),s(x)},[o]);const A=(x,h)=>{s(a=>({...a,[x]:h})),l[x]&&m(a=>{const g={...a};return delete g[x],g})},C=()=>{S(x=>[...x,{key:"",value:""}])},v=(x,h,a)=>{S(g=>{const R=[...g];return R[x]={...R[x],[h]:a},R})},$=x=>{S(h=>h.filter((a,g)=>g!==x))},E=()=>{const x={};return o.forEach(h=>{const a=n[h.key];if(h.required&&(!a||a.trim()==="")){x[h.key]="Dieses Feld ist erforderlich";return}if(!(!a||a.trim()==="")&&h.validation){const{minLength:g,maxLength:R,min:T,max:F,pattern:W}=h.validation;g&&a.length<g&&(x[h.key]=`Mindestens ${g} Zeichen erforderlich`),R&&a.length>R&&(x[h.key]=`Maximal ${R} Zeichen erlaubt`),T!==void 0&&Number(a)<T&&(x[h.key]=`Mindestens ${T}`),F!==void 0&&Number(a)>F&&(x[h.key]=`Maximal ${F}`),W&&!new RegExp(W).test(a)&&(x[h.key]="UngÃ¼ltiges Format")}}),m(x),Object.keys(x).length===0},z=x=>{if(x.preventDefault(),!E())return;const h={...n};b.forEach(a=>{a.key&&a.value&&(h[a.key]=a.value)}),p(h)};return c.useEffect(()=>{o.length===0&&p({})},[o,p]),o.length===0?null:e.jsxs("div",{style:{padding:r.space[6],paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:r.space[8]},children:[e.jsxs("button",{onClick:i,style:{display:"inline-flex",alignItems:"center",gap:r.space[2],padding:`${r.space[2]} ${r.space[3]}`,marginBottom:r.space[4],border:"none",background:"transparent",color:j.slate[600],fontSize:r.fontSize.sm,cursor:"pointer",borderRadius:r.radius.md,transition:r.transition.normal},onMouseEnter:x=>x.target.style.background=j.slate[100],onMouseLeave:x=>x.target.style.background="transparent",children:[e.jsx(_e,{style:{width:"18px",height:"18px"}}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:r.space[4]},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:r.radius.xl,background:r.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{style:{width:"28px",height:"28px",color:"white"}})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:r.fontSize["2xl"],fontWeight:700,color:j.slate[900],margin:0},children:t.title}),e.jsx("p",{style:{fontSize:r.fontSize.sm,color:j.slate[600],margin:`${r.space[1]} 0 0 0`},children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{style:{padding:`${r.space[4]} ${r.space[5]}`,borderRadius:r.radius.lg,backgroundColor:j.slate[100],marginBottom:r.space[6]},children:e.jsx("p",{style:{fontSize:r.fontSize.sm,color:j.slate[700],margin:0,lineHeight:1.6},children:t.description})}),e.jsxs("form",{onSubmit:z,children:[o.map(x=>e.jsx(rs,{field:x,value:n[x.key],onChange:A,error:l[x.key],focusColor:r.primaryAccent,branding:r},x.key)),t?.allow_custom_variables&&e.jsxs("div",{style:{marginTop:r.space[5],marginBottom:r.space[5],paddingTop:r.space[5],borderTop:`1px solid ${j.slate[200]}`},children:[e.jsxs("button",{type:"button",onClick:()=>d(!u),style:{display:"flex",alignItems:"flex-start",gap:r.space[2],padding:"0",border:"none",background:"none",color:j.slate[500],fontSize:r.fontSize.sm,fontWeight:500,cursor:"pointer",marginBottom:u?r.space[4]:"0",textAlign:"left"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:r.space[2],flexShrink:0},children:[u?e.jsx(Ve,{size:18}):e.jsx(Be,{size:18}),e.jsx(Re,{size:16})]}),e.jsx("span",{style:{lineHeight:"1.4"},children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),u&&e.jsxs("div",{style:{backgroundColor:j.slate[50],borderRadius:r.radius.lg,padding:r.space[4]},children:[e.jsx("p",{style:{fontSize:r.fontSize.sm,color:j.slate[500],margin:`0 0 ${r.space[3]} 0`},children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),b.length>0&&e.jsx("div",{style:{marginBottom:r.space[3]},children:b.map((x,h)=>e.jsxs("div",{style:{backgroundColor:"white",border:`1px solid ${j.slate[200]}`,borderRadius:r.radius.md,padding:r.space[3],marginBottom:r.space[3]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:r.space[2]},children:[e.jsx("input",{type:"text",value:x.key||"",onChange:a=>v(h,"key",a.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",style:{padding:`${r.space[2]} ${r.space[3]}`,borderRadius:r.radius.md,border:`1px solid ${j.slate[200]}`,fontSize:r.fontSize.sm,fontFamily:"monospace",backgroundColor:j.slate[50],flex:1,marginRight:r.space[2]}}),e.jsx("button",{type:"button",onClick:()=>$(h),style:{padding:r.space[2],border:"none",backgroundColor:"transparent",cursor:"pointer",color:j.red[500],display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(at,{size:16})})]}),e.jsx("textarea",{value:x.value||"",onChange:a=>v(h,"value",a.target.value),placeholder:"Wert der Variable...",rows:2,style:{width:"100%",padding:`${r.space[2]} ${r.space[3]}`,borderRadius:r.radius.md,border:`1px solid ${j.slate[200]}`,fontSize:r.fontSize.sm,resize:"vertical"}})]},h))}),e.jsxs("button",{type:"button",onClick:C,style:{display:"flex",alignItems:"center",gap:r.space[2],padding:`${r.space[2]} ${r.space[3]}`,border:`1px dashed ${j.slate[300]}`,borderRadius:r.radius.md,backgroundColor:"white",color:j.slate[600],fontSize:r.fontSize.sm,cursor:"pointer",width:"100%",justifyContent:"center"},children:[e.jsx(Re,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{style:{padding:`${r.space[4]} ${r.space[5]}`,borderRadius:r.radius.lg,backgroundColor:r.primaryAccentLight,marginTop:r.space[6],marginBottom:r.space[6],display:"flex",gap:r.space[5],flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:j.slate[500],display:"block"},children:"Fragen"}),e.jsxs("span",{style:{fontSize:r.fontSize.base,fontWeight:600,color:j.slate[900]},children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:j.slate[500],display:"block"},children:"Zeit pro Frage"}),e.jsxs("span",{style:{fontSize:r.fontSize.base,fontWeight:600,color:j.slate[900]},children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:r.fontSize.xs,color:j.slate[500],display:"block"},children:"Wiederholen"}),e.jsx("span",{style:{fontSize:r.fontSize.base,fontWeight:600,color:j.slate[900]},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",style:{width:"100%",padding:`${r.space[4]} ${r.space[6]}`,borderRadius:r.radius.xl,border:"none",background:r.buttonGradient,color:"white",fontSize:r.fontSize.base,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:r.space[2.5],transition:r.transition.normal,boxShadow:`0 4px 12px ${r.primaryAccent}4d`},onMouseEnter:x=>{x.target.style.transform="translateY(-2px)",x.target.style.boxShadow=`0 6px 16px ${r.primaryAccent}66`},onMouseLeave:x=>{x.target.style.transform="none",x.target.style.boxShadow=`0 4px 12px ${r.primaryAccent}4d`},children:["Weiter",e.jsx(lt,{style:{width:"20px",height:"20px"}})]})]})]})},ke=({score:t,label:i,size:p="normal",primaryAccent:n,branding:s})=>{const l=t!=null?t*10:null,b=(u=>u>=80?s.success:u>=60?n:u>=40?s.warning:s.error)(l),S=p==="large";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:s.space[1]},children:[e.jsx("div",{style:{width:S?"80px":"56px",height:S?"80px":"56px",borderRadius:s.radius.full,backgroundColor:`${b}15`,border:`3px solid ${b}`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontSize:S?s.fontSize["5xl"]:s.fontSize["2xl"],fontWeight:s.fontWeight.bold,color:b},children:l!=null?Math.round(l):"-"})}),e.jsx("span",{style:{fontSize:S?s.fontSize.base:s.fontSize.xs,color:s.textSecondary,fontWeight:s.fontWeight.medium},children:i})]})},oe=({title:t,icon:i,children:p,defaultOpen:n=!0,primaryAccent:s,branding:l})=>{const[m,b]=c.useState(n);return e.jsxs("div",{style:{borderRadius:l.radius.lg,border:`1px solid ${l.borderColor}`,backgroundColor:l.cardBg,overflow:"hidden",marginBottom:l.space[4]},children:[e.jsxs("button",{onClick:()=>b(!m),style:{width:"100%",padding:`${l.space[4]} ${l.space[5]}`,display:"flex",alignItems:"center",justifyContent:"space-between",border:"none",backgroundColor:"transparent",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:l.space[3]},children:[e.jsx(i,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:s}}),e.jsx("span",{style:{fontSize:l.fontSize.md,fontWeight:l.fontWeight.semibold,color:l.textMain},children:t})]}),m?e.jsx(Ve,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:l.textMuted}}):e.jsx(Be,{style:{width:l.iconSize.lg,height:l.iconSize.lg,color:l.textMuted}})]}),m&&e.jsx("div",{style:{padding:`0 ${l.space[5]} ${l.space[5]} ${l.space[5]}`,borderTop:`1px solid ${l.cardBgHover}`,paddingTop:l.space[4]},children:p})]})},Fe=({text:t,type:i,primaryAccent:p,primaryAccentLight:n,branding:s})=>{const l={strength:{icon:ct,color:s.success,bg:s.successLight},improvement:{icon:dt,color:s.warning,bg:s.warningLight},tip:{icon:V,color:p,bg:n}},{icon:m,color:b,bg:S}=l[i]||l.tip;return e.jsxs("div",{style:{display:"flex",gap:s.space[3],padding:s.space[3],borderRadius:s.radius.md,backgroundColor:S,marginBottom:s.space[2]},children:[e.jsx(m,{style:{width:s.iconSize.md,height:s.iconSize.md,color:b,flexShrink:0,marginTop:"2px"}}),e.jsx("span",{style:{fontSize:s.fontSize.base,color:s.textSecondary,lineHeight:1.5},children:t})]})},is=({metrics:t,branding:i})=>{if(!t)return null;const n=(l=>{switch(l){case"optimal":return{label:"Optimal",color:i.success};case"zu_schnell":return{label:"Zu schnell",color:i.warning};case"zu_langsam":return{label:"Zu langsam",color:i.warning};default:return{label:l||"N/A",color:i.textMuted}}})(t.speech_rate),s=l=>{switch(l){case"niedrig":return i.success;case"mittel":return i.warning;case"hoch":return i.error;default:return i.textMuted}};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:i.space[4]},children:[e.jsxs("div",{style:{padding:i.space[4],borderRadius:i.radius.md,backgroundColor:i.cardBgHover},children:[e.jsx("span",{style:{fontSize:i.fontSize.xs,color:i.textMuted,display:"block",marginBottom:i.space[1]},children:"Sprechtempo"}),e.jsx("span",{style:{fontSize:i.fontSize.lg,fontWeight:i.fontWeight.semibold,color:n.color},children:n.label})]}),t.filler_words&&e.jsxs("div",{style:{padding:i.space[4],borderRadius:i.radius.md,backgroundColor:i.cardBgHover},children:[e.jsx("span",{style:{fontSize:i.fontSize.xs,color:i.textMuted,display:"block",marginBottom:i.space[1]},children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{style:{fontSize:i.fontSize.lg,fontWeight:600,color:s(t.filler_words.severity)},children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{style:{fontSize:"12px",fontWeight:400,marginLeft:"8px"},children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:i.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:i.textMuted,display:"block",marginBottom:"4px"},children:"Selbstbewusstsein"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:i.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.confidence_score}%`,height:"100%",backgroundColor:t.confidence_score>=70?i.success:i.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:i.textSecondary},children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:i.cardBgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:i.textMuted,display:"block",marginBottom:"4px"},children:"Klarheit"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{flex:1,height:"8px",backgroundColor:i.borderColor,borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t.clarity_score}%`,height:"100%",backgroundColor:t.clarity_score>=70?i.success:i.warning,borderRadius:"4px"}})}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:600,color:i.textSecondary},children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{style:{gridColumn:"1 / -1",padding:"12px 16px",borderRadius:"10px",backgroundColor:i.primaryAccentLight,fontSize:"14px",color:i.textSecondary,lineHeight:1.5},children:["ðŸ’¡ ",t.notes]})]})},os=({audioUrl:t,primaryAccent:i,branding:p})=>{const n=c.useRef(null),[s,l]=c.useState(!1),[m,b]=c.useState(0),[S,u]=c.useState(0),[d,r]=c.useState(!0),[o,A]=c.useState(null);c.useEffect(()=>{if(!t)return;r(!0),A(null);const z=new Audio;n.current=z;const x=()=>{const a=z.duration;a&&isFinite(a)&&a>0&&u(a),r(!1)},h=()=>{r(!1);const a=z.duration;a&&isFinite(a)&&a>0&&u(a)};return z.addEventListener("loadedmetadata",x),z.addEventListener("canplaythrough",h),z.addEventListener("timeupdate",()=>b(z.currentTime)),z.addEventListener("play",()=>l(!0)),z.addEventListener("pause",()=>l(!1)),z.addEventListener("ended",()=>l(!1)),z.addEventListener("error",()=>{A("Audio nicht verfÃ¼gbar"),r(!1)}),z.src=t,z.load(),()=>{z.pause(),z.src=""}},[t]);const C=()=>{n.current&&(s?n.current.pause():n.current.play())},v=z=>{const x=z.currentTarget.getBoundingClientRect(),h=(z.clientX-x.left)/x.width;n.current&&S>0&&(n.current.currentTime=h*S)},$=z=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+z,S)))};if(!t)return null;if(o)return e.jsxs("div",{style:{padding:"12px 16px",background:p.cardBgHover,borderRadius:"10px",color:p.textMuted,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(xe,{size:16})," ",o]});const E=S>0?m/S*100:0;return e.jsxs("div",{style:{background:p.cardBgHover,borderRadius:"12px",padding:"16px"},children:[e.jsx("div",{onClick:v,style:{height:"6px",background:p.borderColor,borderRadius:"3px",cursor:"pointer",marginBottom:"12px"},children:e.jsx("div",{style:{width:`${E}%`,height:"100%",background:i,borderRadius:"3px",transition:"width 0.1s"}})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[e.jsx("button",{onClick:()=>$(-10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:p.textMuted,display:"flex",alignItems:"center"},children:e.jsx(Mt,{size:20})}),e.jsx("button",{onClick:C,disabled:d,style:{width:"44px",height:"44px",borderRadius:"50%",background:i,border:"none",cursor:d?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",opacity:d?.7:1},children:d?e.jsx(He,{size:20,color:"#ffffff",style:{animation:"spin 1s linear infinite"}}):s?e.jsx(Nt,{size:20,color:"#ffffff",fill:"#ffffff"}):e.jsx(Ze,{size:20,color:"#ffffff",fill:"#ffffff",style:{marginLeft:"2px"}})}),e.jsx("button",{onClick:()=>$(10),style:{background:"none",border:"none",cursor:"pointer",padding:"6px",color:p.textMuted,display:"flex",alignItems:"center"},children:e.jsx($t,{size:20})})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"8px",fontSize:"12px",color:p.textMuted},children:[Ae(m)," / ",Ae(S)]}),e.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})},as=({transcript:t,feedback:i,audioMetrics:p,audioUrl:n,onRetry:s,onNext:l,onComplete:m,isLastQuestion:b,hideButtons:S=!1})=>{const{branding:u}=Ge(),d=Ke(),r=u?.["--button-gradient"]||u?.["--header-gradient"]||Te["--header-gradient"],o=u?.["--primary-accent"]||Te["--primary-accent"],A=u?.["--primary-accent-light"]||Te["--primary-accent-light"],C=typeof i=="string"?JSON.parse(i):i;return e.jsxs("div",{style:{backgroundColor:d.cardBgHover,borderRadius:d.radius.xl,padding:d.space[6]},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"20px",marginBottom:"24px",padding:d.space[5],backgroundColor:d.cardBg,borderRadius:d.radius.lg},children:[e.jsx(ke,{score:C?.scores?.overall,label:"Gesamt",size:"large",primaryAccent:o,branding:d}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:d.textMain,margin:"0 0 8px 0"},children:"Feedback zu deiner Antwort"}),e.jsx("p",{style:{fontSize:"14px",color:d.textSecondary,margin:0,lineHeight:1.5},children:C?.summary||"Deine Antwort wurde analysiert."})]})]}),C?.scores&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"32px",padding:"16px",marginBottom:"16px",backgroundColor:d.cardBg,borderRadius:"12px"},children:[e.jsx(ke,{score:C.scores.content,label:"Inhalt",primaryAccent:o,branding:d}),e.jsx(ke,{score:C.scores.structure,label:"Struktur",primaryAccent:o,branding:d}),e.jsx(ke,{score:C.scores.relevance,label:"Relevanz",primaryAccent:o,branding:d})]}),e.jsx(oe,{title:"Transkript",icon:ue,defaultOpen:!0,primaryAccent:o,branding:d,children:e.jsxs("div",{style:{padding:"16px",borderRadius:"10px",backgroundColor:d.cardBgHover,fontStyle:"italic",color:d.textSecondary,lineHeight:1.6,fontSize:"14px"},children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),n&&e.jsx(oe,{title:"Deine Aufnahme",icon:Bt,defaultOpen:!0,primaryAccent:o,branding:d,children:e.jsx(os,{audioUrl:n,primaryAccent:o,branding:d})}),C?.strengths?.length>0&&e.jsx(oe,{title:"StÃ¤rken",icon:ct,defaultOpen:!0,primaryAccent:o,branding:d,children:C.strengths.map((v,$)=>e.jsx(Fe,{text:v,type:"strength",primaryAccent:o,primaryAccentLight:A,branding:d},$))}),C?.improvements?.length>0&&e.jsx(oe,{title:"Verbesserungen",icon:dt,defaultOpen:!0,primaryAccent:o,branding:d,children:C.improvements.map((v,$)=>e.jsx(Fe,{text:v,type:"improvement",primaryAccent:o,primaryAccentLight:A,branding:d},$))}),C?.tips?.length>0&&e.jsx(oe,{title:"Tipps",icon:V,defaultOpen:!1,primaryAccent:o,branding:d,children:C.tips.map((v,$)=>e.jsx(Fe,{text:v,type:"tip",primaryAccent:o,primaryAccentLight:A,branding:d},$))}),p&&e.jsx(oe,{title:"Sprechanalyse",icon:G,defaultOpen:!1,primaryAccent:o,branding:d,children:e.jsx(is,{metrics:p,branding:d})}),!S&&e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end",flexWrap:"wrap"},children:[s&&e.jsxs("button",{onClick:s,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:`2px solid ${d.borderColor}`,backgroundColor:d.cardBg,color:d.textSecondary,fontSize:"15px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:v=>{v.target.style.borderColor=o,v.target.style.color=o},onMouseLeave:v=>{v.target.style.borderColor=d.borderColor,v.target.style.color=d.textSecondary},children:[e.jsx(Pe,{style:{width:"18px",height:"18px"}}),"Nochmal versuchen"]}),e.jsx("button",{onClick:b?m:l,style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 24px",borderRadius:"12px",border:"none",background:r,color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${o}4d`,transition:"all 0.2s"},onMouseEnter:v=>{v.target.style.transform="translateY(-2px)",v.target.style.boxShadow=`0 6px 16px ${o}66`},onMouseLeave:v=>{v.target.style.transform="none",v.target.style.boxShadow=`0 4px 12px ${o}4d`},children:b?e.jsxs(e.Fragment,{children:[e.jsx(pt,{style:{width:"18px",height:"18px"}}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(De,{style:{width:"18px",height:"18px"}})]})})]})]})},ls=({tips:t,primaryAccent:i,tipsLabel:p,branding:n})=>{const[s,l]=c.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>l(!s),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(V,{size:n.iconSize.md,color:i}),p||"Tipps fÃ¼r diese Frage"]}),e.jsx(Be,{size:n.iconSize.md,color:n.textMuted,style:{transform:s?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx(Et,{children:s&&e.jsx(Tt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((m,b)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:b<t.length-1?n.space[2]:0},children:[e.jsx(V,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:m.replace(/^Tipp \d+:\s*/i,"")})]},b))})})})]})},cs=({seconds:t,maxSeconds:i,isRecording:p,branding:n})=>{const s=i>0?t/i*100:0,l=s>75,m=s>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:m?n.errorLight:l?n.warningLight:n.cardBgHover},children:[e.jsx(X,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:m?n.error:l?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:m?n.error:l?n.warning:n.textSecondary},children:Ae(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",Ae(i)]})]})},st=({onRecordingComplete:t,timeLimit:i,disabled:p,deviceId:n,themedGradient:s,primaryAccent:l,isSubmitting:m,labels:b,onOpenSettings:S,branding:u,isMobile:d,onStreamChange:r})=>{const[o,A]=c.useState("idle"),[C,v]=c.useState(0),[$,E]=c.useState(0),[z,x]=c.useState(!1),h=c.useRef(null),a=c.useRef([]),g=c.useRef(null),R=c.useRef(null),T=c.useRef(null),F=c.useRef(null),W=c.useRef(null),M=c.useRef(0),P=c.useRef(!1);c.useEffect(()=>()=>{y()},[]),c.useEffect(()=>{o==="recording"&&C>=i&&N()},[C,i,o]);const y=()=>{g.current&&clearInterval(g.current),F.current&&cancelAnimationFrame(F.current),R.current&&(R.current.close(),R.current=null),W.current&&(W.current.getTracks().forEach(B=>B.stop()),W.current=null,r&&r(null))},f=async()=>{try{x(!1),a.current=[],v(0);let B;const L={audio:n?{deviceId:{exact:n}}:!0};try{B=await navigator.mediaDevices.getUserMedia(L)}catch(D){throw console.error("[SIMULATOR] Selected device unavailable:",D),D.name==="OverconstrainedError"||D.name==="NotFoundError"?(x(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):D}W.current=B,r&&r(B),R.current=new(window.AudioContext||window.webkitAudioContext),T.current=R.current.createAnalyser(),R.current.createMediaStreamSource(B).connect(T.current),T.current.fftSize=256;const re=()=>{if(T.current&&P.current){const D=new Uint8Array(T.current.frequencyBinCount);T.current.getByteFrequencyData(D);const me=D.reduce((K,fe)=>K+fe)/D.length;E(me/255)}F.current=requestAnimationFrame(re)};P.current=!0,re();const Y=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";h.current=new MediaRecorder(B,{mimeType:Y}),h.current.ondataavailable=D=>{D.data.size>0&&a.current.push(D.data)},h.current.onstop=()=>{const D=new Blob(a.current,{type:Y});t(D,M.current)},h.current.start(1e3),A("recording"),g.current=setInterval(()=>{v(D=>D+1)},1e3)}catch(B){console.error("Error starting recording:",B),(B.name==="NotAllowedError"||B.name==="PermissionDeniedError")&&x(!0)}},w=()=>{h.current&&h.current.state==="recording"&&(h.current.pause(),A("paused"),P.current=!1,g.current&&(clearInterval(g.current),g.current=null),E(0))},_=()=>{h.current&&h.current.state==="paused"&&(h.current.resume(),A("recording"),P.current=!0,g.current=setInterval(()=>{v(B=>B+1)},1e3))},N=()=>{M.current=C,P.current=!1,g.current&&(clearInterval(g.current),g.current=null),F.current&&(cancelAnimationFrame(F.current),F.current=null),R.current&&(R.current.close(),R.current=null),h.current&&h.current.state!=="inactive"&&h.current.stop(),W.current&&(W.current.getTracks().forEach(B=>B.stop()),W.current=null),A("idle"),E(0),v(0)},k=()=>{o==="idle"?f():o==="recording"?w():o==="paused"&&_()};return z?e.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:u.errorLight,textAlign:"center"},children:[e.jsx(Ft,{style:{width:"48px",height:"48px",color:u.error,marginBottom:"12px"}}),e.jsx("p",{style:{color:u.error,fontWeight:600,margin:0},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{style:{color:u.textSecondary,fontSize:"14px",marginTop:"8px"},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]}):e.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:u.cardBg,border:`1px solid ${u.borderColor}`,position:"relative"},children:[d&&e.jsx("button",{onClick:S,style:{position:"absolute",top:"12px",right:"12px",padding:"10px",borderRadius:"10px",background:u.cardBgHover,border:`1px solid ${u.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(qe,{size:18,color:u.textMuted})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:e.jsx(cs,{seconds:C,maxSeconds:i,isRecording:o==="recording",branding:u})}),o==="recording"&&e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(Ut,{audioLevel:$,isActive:!0,variant:"bars",size:"sm",accentColor:l})}),o==="paused"&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"60px",marginBottom:"24px",color:u.warning},children:[e.jsx(G,{size:24}),e.jsx("span",{style:{fontSize:"16px",fontWeight:600},children:"Aufnahme pausiert"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"12px"},children:[!d&&e.jsx("button",{onClick:S,style:{padding:"14px",borderRadius:"12px",background:u.cardBgHover,border:`1px solid ${u.borderColor}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(qe,{size:20,color:u.textMuted})}),e.jsxs("button",{onClick:k,disabled:p||m,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:d?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",flex:d?1:"none",background:o==="idle"?p||m?u.borderColor:u.error:o==="recording"?u.warning:u.success,color:"white",fontSize:d?"15px":"16px",fontWeight:600,cursor:p||m?"not-allowed":"pointer",boxShadow:p||m?"none":"0 4px 14px rgba(0, 0, 0, 0.2)"},children:[o==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{style:{width:"20px",height:"20px"}}),"Aufnahme starten"]}),o==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{style:{width:"18px",height:"18px"}}),"Pausieren"]}),o==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ze,{style:{width:"18px",height:"18px"}}),"Fortsetzen"]})]}),(o==="recording"||o==="paused")&&e.jsxs("button",{onClick:N,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:d?"14px 16px":"14px 24px",borderRadius:"12px",border:"none",flex:d?1:"none",backgroundColor:u.cardBgHover,color:u.textMain,fontSize:d?"15px":"16px",fontWeight:600,cursor:"pointer"},children:[e.jsx(ge,{style:{width:"18px",height:"18px",color:u.success}}),b?.submitButton||"Antwort abgeben"]})]}),o==="idle"&&!m&&e.jsx("p",{style:{textAlign:"center",marginTop:"16px",color:u.textMuted,fontSize:"14px"},children:b?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),m&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"24px"},children:[e.jsx(He,{style:{width:"32px",height:"32px",color:l,animation:"spin 1s linear infinite"}}),e.jsx("p",{style:{marginTop:"12px",color:u.textSecondary,fontSize:"14px"},children:b?.analyzing||"Antwort wird analysiert..."})]}),e.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      `})]})},rt={target:se,clock:X,mic:G,"message-square":ue,lightbulb:V,brain:Oe,info:he,settings:qe,check:ge,Target:se,Clock:X,Mic:G,MessageSquare:ue,Lightbulb:V,Brain:Oe},ds=({scenario:t,variables:i,questions:p,onStart:n,onBack:s,selectedMicrophoneId:l,onMicrophoneChange:m,onMicrophoneTest:b,themedGradient:S,primaryAccent:u,primaryAccentLight:d,isLoading:r,branding:o})=>{const A=t?.mode==="SIMULATION",C=A?"Situationen":"Fragen",v=A?"Zeit pro Situation":"Zeit pro Frage",$=[{icon:se,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${A?"Situation":"Frage"}. ${A?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:G,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:ue,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],E=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((a,g)=>typeof a=="string"?{icon:V,title:`Tipp ${g+1}`,description:a}:{icon:rt[a.icon]||rt[a.icon?.toLowerCase()]||V,title:a.title||`Tipp ${g+1}`,description:a.text||a.description||""}):$,z=c.useMemo(()=>{if(!t?.input_configuration)return{};try{const a=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(a)?a.reduce((g,R)=>(R.key&&R.label&&(g[R.key]=R.label),g),{}):{}}catch{return{}}},[t?.input_configuration]),x=i?Object.entries(i).filter(([a,g])=>g&&g.trim&&g.trim()!=="").map(([a,g])=>({label:z[a]||a.replace(/_/g," ").replace(/\b\w/g,R=>R.toUpperCase()),value:g})):[],h=a=>{if(!a||!i)return a;let g=a;return Object.entries(i).forEach(([R,T])=>{T&&(g=g.replace(new RegExp(`\\$\\{${R}\\}`,"g"),T),g=g.replace(new RegExp(`\\{${R}\\}`,"g"),T))}),g};return e.jsxs("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("button",{onClick:s,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:o.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px"},children:[e.jsx(_e,{style:{width:"18px",height:"18px"}}),"ZurÃ¼ck"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",background:S,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{style:{width:"32px",height:"32px",color:"white"}})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:o.textMain,margin:0},children:"Vorbereitung"}),e.jsxs("p",{style:{fontSize:"16px",color:o.textSecondary,margin:"4px 0 0 0"},children:[t.title,p.length>0?` â€¢ ${p.length} ${C}`:""]})]})]})]}),t.long_description&&e.jsx("div",{style:{padding:"20px 24px",borderRadius:"16px",backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`,marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:S,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(he,{style:{width:"20px",height:"20px",color:"white"}})}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:o.textMain,margin:"0 0 8px 0"},children:"Deine Aufgabe"}),e.jsx("p",{style:{fontSize:"15px",lineHeight:"1.6",color:o.textSecondary,margin:0,whiteSpace:"pre-wrap"},children:h(t.long_description?.replace(/\/n/g,`
`))})]})]})}),x.length>0&&e.jsxs("div",{style:{padding:"20px",borderRadius:"16px",backgroundColor:d,marginBottom:"24px"},children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:600,color:u,margin:"0 0 12px 0",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dein Profil"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:x.map((a,g)=>e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:o.textMuted,display:"block"},children:a.label}),e.jsx("span",{style:{fontSize:"15px",fontWeight:500,color:o.textMain},children:a.value})]},g))})]}),e.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`,marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx(G,{style:{width:"22px",height:"22px",color:u}}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:o.textMain,margin:0},children:"Mikrofon testen"})]}),e.jsx(ht,{selectedDeviceId:l,onDeviceChange:m,onTestClick:b})]}),e.jsxs("button",{onClick:n,disabled:r,style:{width:"100%",padding:"18px 28px",borderRadius:"14px",border:"none",background:r?o.borderColor:S,color:"white",fontSize:"18px",fontWeight:600,cursor:r?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",boxShadow:r?"none":`0 4px 12px ${u}4d`,marginBottom:"24px",opacity:r?.7:1},children:[e.jsx(Ze,{style:{width:"24px",height:"24px"}}),"GesprÃ¤ch starten"]}),e.jsxs("div",{style:{padding:"24px",borderRadius:"16px",backgroundColor:o.cardBg,border:`1px solid ${o.borderColor}`,marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"20px"},children:[e.jsx(V,{style:{width:"22px",height:"22px",color:o.warning}}),e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:o.textMain,margin:0},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:E.map((a,g)=>e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px",borderRadius:"12px",backgroundColor:o.cardBgHover},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:d,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(a.icon,{style:{width:"22px",height:"22px",color:u}})}),e.jsxs("div",{children:[e.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:o.textMain,margin:"0 0 4px 0"},children:a.title}),e.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,margin:0,lineHeight:1.5},children:a.description})]})]},g))})]}),e.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:o.cardBgHover,display:"flex",gap:"24px",flexWrap:"wrap"},children:[p.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:o.textMuted,display:"block"},children:C}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:o.textMain},children:p.length})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:o.textMuted,display:"block"},children:v}),e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:o.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"12px",color:o.textMuted,display:"block"},children:"Wiederholen"}),e.jsx("span",{style:{fontSize:"18px",fontWeight:600,color:o.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},ps=({isOpen:t,onClose:i,onConfirm:p,answeredCount:n,totalCount:s,labels:l})=>t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:i,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#dcfce7",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ut,{size:24,color:"#22c55e"})}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training beenden?"})]}),n>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"8px"},children:["Du hast ",e.jsx("strong",{children:l.answeredCount(n,s)})," beantwortet."]}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",l.questionsLabel," beantworten?"]})]}):e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:["Du hast noch keine ",l.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Weiter trainieren"}),e.jsx("button",{onClick:p,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#22c55e",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(34, 197, 94, 0.3)"},children:"Training beenden"})]})]})}):null,us=({isOpen:t,onClose:i,onConfirm:p,answeredCount:n,labels:s})=>t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:i,children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",boxShadow:"0 20px 50px rgba(0, 0, 0, 0.2)"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:"#fee2e2",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{size:24,color:"#ef4444"})}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",margin:0},children:"Training abbrechen?"})]}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"24px"},children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",n>0?` (${n} ${s.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,style:{padding:"10px 20px",borderRadius:"10px",border:"1px solid #e2e8f0",background:"white",color:"#64748b",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"ZurÃ¼ck"}),e.jsx("button",{onClick:p,style:{padding:"10px 20px",borderRadius:"10px",border:"none",background:"#ef4444",color:"white",fontSize:"14px",fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(239, 68, 68, 0.3)"},children:"Abbrechen"})]})]})}):null,xs=({number:t,size:i="md"})=>{const p={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${p[i]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},Le=({question:t,index:i,labels:p,isMobile:n})=>e.jsxs(ze,{className:n?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(xs,{number:i+1,size:n?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||p.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${n?"text-[15px]":"text-lg"} mb-0`,children:t?.question||p.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:n?14:16}),p.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),nt=({error:t,onRetry:i,isMobile:p})=>e.jsxs("div",{className:`flex flex-col items-center ${p?"p-4":"p-5 mt-4"} rounded-xl bg-red-50`,children:[e.jsx(xe,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500 font-medium text-sm text-center",children:t}),e.jsx(ae,{variant:"danger",size:"sm",onClick:i,className:"mt-3",children:"Erneut versuchen"})]}),hs=({session:t,questions:i,scenario:p,variables:n,preloadedQuestions:s,onSessionCreated:l,onComplete:m,onExit:b,startFromQuestion:S=0,initialMicrophoneId:u})=>{const d=Kt(),[r,o]=c.useState(t),[A,C]=c.useState(i||[]),[v,$]=c.useState(!1),[E,z]=c.useState(null),{demoCode:x,branding:h}=Ge(),a=p?.mode==="SIMULATION",g={questionLabel:a?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:a?"Situation":"Frage",questionLoading:a?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:a?"Deine Reaktion...":"Deine Antwort...",submitButton:a?"Reaktion abgeben":"Antwort abgeben",submitHint:a?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:a?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(I,q)=>a?`Situation ${I} von ${q}`:`Frage ${I} von ${q}`,questionsCount:I=>a?`${I} Situationen`:`${I} Fragen`,answeredCount:(I,q)=>a?`${I} von ${q} Situationen`:`${I} von ${q} Fragen`,tipsLabel:a?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:a?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:a?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:a?"Situationen":"Fragen",recommendedTime:a?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},R=S>0,T=R?Array.from({length:S},(I,q)=>q):[],[F,W]=c.useState(R?"interview":"preparation"),[M,P]=c.useState(S||r?.current_question_index||0),[y,f]=c.useState(null),[w,_]=c.useState(!1),[N,k]=c.useState(!1),[B,L]=c.useState(null),[le,re]=c.useState([]),[Y,D]=c.useState(T),me="karriereheld_selected_microphone",[K,fe]=c.useState(()=>{if(u)return u;try{return localStorage.getItem(me)||null}catch{return null}}),[ft,ye]=c.useState(!1),[yt,ce]=c.useState(!1),je=c.useRef(null),be=c.useCallback(()=>{je.current&&(je.current.getTracks().forEach(I=>I.stop()),je.current=null)},[]),Qe=c.useCallback(I=>{je.current=I},[]);c.useEffect(()=>()=>{be()},[be]),c.useEffect(()=>{if(K)try{localStorage.setItem(me,K)}catch{}},[K]);const[jt,Me]=c.useState(!1),[bt,Ne]=c.useState(!1),[Se,Ue]=c.useState(!1),[de,we]=c.useState(null),[U,Je]=c.useState(!1),J=A[M],ne=M===A.length-1,Xe=M===0,Ye=async(I,q)=>{if(q<2){L("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(I.size<5e3){console.warn("[SimulatorSession] Audio too small:",I.size,"bytes"),L("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}k(!0),L(null);try{const O=await Q.submitSimulatorAnswer(r.id,I,M,J.question,J.category,q);if(!O.success)throw new Error(O.message||"Fehler beim Analysieren der Antwort");if(f(O.data),_(!0),re(Z=>[...Z.filter(ee=>ee.questionIndex!==M),{questionIndex:M,feedback:O.data}]),D(Z=>Z.includes(M)?Z:[...Z,M]),a&&!U){Ue(!0),we(null);const Z=Y.includes(M);try{const ee=await Q.generateNextTurn(r.id);if(ee.success){const ie=ee.data.next_question;ee.data.is_finished?(we(ie),C(Z?te=>{const pe=[...te];return pe[M+1]=ie,pe.slice(0,M+2)}:te=>[...te,ie]),Je(!0)):(we(ie),Z?(C(te=>{const pe=[...te];return pe[M+1]=ie,pe.slice(0,M+2)}),Je(!1)):C(te=>[...te,ie]))}}catch(ee){console.error("Error generating next turn:",ee)}finally{Ue(!1)}}}catch(O){console.error("Error submitting answer:",O),L(O.message||"Ein Fehler ist aufgetreten")}finally{k(!1)}},$e=()=>{f(null),_(!1),L(null)},Ee=()=>{if(f(null),_(!1),L(null),a){if(de){P(I=>I+1),we(null);return}if(U){ve();return}}else ne||P(I=>I+1)},St=()=>{f(null),_(!1),L(null),Xe||P(I=>I-1)},wt=()=>{Me(!0)},ve=async()=>{Me(!1),ce(!1),ye(!1),be();try{const I=await Q.completeSimulatorSession(r.id);I.success?m(I.data):m({session:{...r,status:"completed"}})}catch(I){console.error("Error completing session:",I),m({session:{...r,status:"completed"}})}},vt=()=>{Ne(!0)},kt=()=>{Ne(!1),ce(!1),ye(!1),be(),b()},Ct=async()=>{if(r&&A.length>0){W("interview");return}$(!0),z(null);try{const I=await Q.createSimulatorSession({scenario_id:p.id,variables:n,demo_code:x||null,questions:s||null});if(!I.success)throw new Error(I.message||"Fehler beim Erstellen der Session");const q=I.data.session;let O;if(s&&s.length>0)O=s,await Q.updateSimulatorSessionQuestions(q.id,O);else{const Z=await Q.generateSimulatorQuestions(q.id);if(!Z.success)throw new Error(Z.message||"Fehler beim Generieren der Fragen");O=Z.data.questions}o({...q,questions_json:O}),C(O),l&&l({session:{...q,questions_json:O},questions:O,selectedMicrophoneId:K}),W("interview")}catch(I){console.error("Error creating session:",I),z(I.message||"Ein Fehler ist aufgetreten")}finally{$(!1)}};if(F==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(ds,{scenario:p,variables:n,questions:A,onStart:Ct,onBack:b,selectedMicrophoneId:K,onMicrophoneChange:fe,onMicrophoneTest:()=>ye(!0),themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],primaryAccentLight:h?.["--primary-accent-light"],isLoading:v}),e.jsx(gt,{isOpen:ft,onClose:()=>ye(!1),deviceId:K}),E&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:E}),e.jsx(mt,{isLoading:v,message:a?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const zt=w&&(a&&U&&!de||!a&&ne);return e.jsxs("div",{className:`${d?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${d?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${d?"text-lg":"text-xl"} font-semibold text-slate-900`,children:p?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${d?"justify-between":"justify-end"}`,children:[!zt&&e.jsxs("button",{onClick:wt,className:`${d?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 transition-colors`,children:[e.jsx(ut,{size:16}),d?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:vt,className:`${d?"flex-1 py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Wt,{size:16}),"Abbrechen"]})]})]}),e.jsx(ps,{isOpen:jt,onClose:()=>Me(!1),onConfirm:ve,answeredCount:Y.length,totalCount:A.length,labels:g}),e.jsx(us,{isOpen:bt,onClose:()=>Ne(!1),onConfirm:kt,answeredCount:Y.length,labels:g}),!w&&!a&&e.jsxs("div",{className:`flex ${d?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(ae,{variant:"secondary",size:d?"sm":"md",icon:e.jsx(Dt,{size:16}),onClick:St,disabled:Xe,className:d?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(ae,{variant:"secondary",size:d?"sm":"md",iconPosition:"right",icon:e.jsx(De,{size:16}),onClick:Ee,disabled:ne,className:d?"flex-1":"",children:d?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Qt,{current:M,total:A.length,answeredQuestions:Y,primaryAccent:h?.["--primary-accent"],labels:g}),w?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[p.allow_retry&&e.jsx(ae,{variant:"secondary",icon:e.jsx(Pe,{size:16}),onClick:$e,children:"Nochmal versuchen"}),e.jsxs(ae,{onClick:a?U&&!de?ve:Ee:ne?ve:Ee,disabled:a&&Se&&!U,icon:Se?e.jsx(He,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[a&&Se&&!U?"GesprÃ¤chspartner tippt...":a?U&&!de?"Training abschlieÃŸen":g.nextButton:ne?"Training abschlieÃŸen":g.nextButton,!Se&&!(a?U&&!de:ne)&&e.jsx(De,{size:16,className:"ml-1"})]})]}),e.jsx(Le,{question:J,index:M,labels:g,isMobile:d}),e.jsx("div",{className:"mt-4",children:e.jsx(as,{transcript:y.transcript,feedback:y.feedback,audioMetrics:y.audio_analysis,audioUrl:y.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${d?"gap-4":"gap-6"}`,children:[d?e.jsxs(e.Fragment,{children:[e.jsx(Le,{question:J,index:M,labels:g,isMobile:!0}),e.jsx(st,{onRecordingComplete:Ye,timeLimit:p.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],isSubmitting:N,labels:g,onOpenSettings:()=>ce(!0),isMobile:!0,onStreamChange:Qe}),B&&e.jsx(nt,{error:B,onRetry:$e,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(st,{onRecordingComplete:Ye,timeLimit:p.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],isSubmitting:N,labels:g,onOpenSettings:()=>ce(!0),isMobile:!1,onStreamChange:Qe}),B&&e.jsx(nt,{error:B,onRetry:$e,isMobile:!1})]}),e.jsx(Le,{question:J,index:M,labels:g,isMobile:!1})]}),J?.tips&&J.tips.length>0&&e.jsx(ls,{tips:J.tips,primaryAccent:h?.["--primary-accent"],tipsLabel:g.tipsLabel})]}),e.jsx(Jt,{isOpen:yt,onClose:()=>ce(!1),mode:"audio",selectedMicrophoneId:K,onMicrophoneChange:fe})]})},Ce=({score:t,label:i,primaryAccent:p,b:n})=>{const s=t!=null?t*10:null,l=Zt(s,p);return e.jsxs("div",{style:{textAlign:"center",padding:n.space[4],backgroundColor:j.slate[100],borderRadius:n.radius.lg},children:[e.jsx("div",{style:{fontSize:n.fontSize["4xl"],fontWeight:700,color:l,marginBottom:"4px"},children:s!=null?Math.round(s):"-"}),e.jsx("div",{style:{fontSize:n.fontSize.sm,color:j.slate[600]},children:i})]})},We=({icon:t,value:i,label:p,primaryAccent:n,b:s})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:s.space[3],padding:`${s.space[3]} ${s.space[4]}`,backgroundColor:j.slate[100],borderRadius:s.radius.md},children:[e.jsx(t,{style:{width:"20px",height:"20px",color:n}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:s.fontSize.xl,fontWeight:600,color:j.slate[900]},children:i}),e.jsx("div",{style:{fontSize:s.fontSize.xs,color:j.slate[500]},children:p})]})]}),gs=({session:t,scenario:i,onBackToDashboard:p,onStartNew:n})=>{const s=Ke(),l=t.summary_feedback||t.summary_feedback_json,m=l?typeof l=="string"?JSON.parse(l):l:null,b=t.overall_score||m?.overall_score||0,S=b<=10?b*10:b,d=(r=>r>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:r>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:r>=70?{text:"Gut!",emoji:"ðŸ‘"}:r>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:r>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(S);return e.jsxs("div",{style:{padding:s.space[6],maxWidth:"640px",margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"32px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:s.headerGradient,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",boxShadow:`0 8px 24px ${s.primaryAccent}4d`},children:e.jsx(pt,{style:{width:"40px",height:"40px",color:"white"}})}),e.jsxs("h1",{style:{fontSize:s.fontSize["5xl"],fontWeight:700,color:j.slate[900],margin:"0 0 8px 0"},children:["Training abgeschlossen! ",d.emoji]}),e.jsxs("p",{style:{fontSize:s.fontSize.lg,color:j.slate[600],margin:0},children:[i?.title||"Skill Training"," - ",d.text]})]}),e.jsxs("div",{style:{padding:s.space[6],borderRadius:s.radius.xl,backgroundColor:"white",border:`1px solid ${j.slate[200]}`,textAlign:"center",marginBottom:s.space[6]},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",border:`6px solid ${s.primaryAccent}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",backgroundColor:s.primaryAccentLight},children:e.jsx("span",{style:{fontSize:s.fontSize["5xl"],fontWeight:700,color:s.primaryAccent},children:S?Math.round(S):"-"})}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:j.slate[500],margin:0},children:S?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:s.space[3],marginBottom:s.space[6]},children:[e.jsx(We,{icon:ge,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:s.primaryAccent,b:s}),e.jsx(We,{icon:se,value:m?.average_content_score?Math.round(m.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:s.primaryAccent,b:s}),e.jsx(We,{icon:qt,value:m?.average_delivery_score?Math.round(m.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:s.primaryAccent,b:s})]}),m?.scores&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:s.space[3],marginBottom:s.space[6]},children:[e.jsx(Ce,{score:m.scores.content,label:"Inhalt",primaryAccent:s.primaryAccent,b:s}),e.jsx(Ce,{score:m.scores.structure,label:"Struktur",primaryAccent:s.primaryAccent,b:s}),e.jsx(Ce,{score:m.scores.relevance,label:"Relevanz",primaryAccent:s.primaryAccent,b:s}),e.jsx(Ce,{score:m.scores.delivery,label:"PrÃ¤sentation",primaryAccent:s.primaryAccent,b:s})]}),m?.summary&&e.jsxs("div",{style:{padding:s.space[5],borderRadius:s.radius.lg,backgroundColor:j.slate[100],marginBottom:s.space[6]},children:[e.jsx("h3",{style:{fontSize:s.fontSize.base,fontWeight:600,color:j.slate[700],margin:"0 0 8px 0"},children:"Zusammenfassung"}),e.jsx("p",{style:{fontSize:s.fontSize.base,color:j.slate[600],margin:0,lineHeight:1.6},children:m.summary})]}),m?.key_takeaways?.length>0&&e.jsxs("div",{style:{padding:s.space[5],borderRadius:s.radius.lg,backgroundColor:j.green[100],marginBottom:s.space[6]},children:[e.jsx("h3",{style:{fontSize:s.fontSize.base,fontWeight:600,color:j.green[500],margin:"0 0 12px 0"},children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{style:{margin:0,paddingLeft:s.space[5],color:j.slate[700],fontSize:s.fontSize.base,lineHeight:1.6},children:m.key_takeaways.map((r,o)=>e.jsx("li",{style:{marginBottom:"8px"},children:r},o))})]}),e.jsxs("div",{style:{display:"flex",gap:s.space[3],marginTop:"32px"},children:[e.jsxs("button",{onClick:p,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:s.space[2],padding:`${s.space[3.5]} ${s.space[6]}`,borderRadius:s.radius.lg,border:`2px solid ${j.slate[300]}`,backgroundColor:"white",color:j.slate[700],fontSize:s.fontSize.base,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:r=>{r.target.style.borderColor=s.primaryAccent,r.target.style.color=s.primaryAccent},onMouseLeave:r=>{r.target.style.borderColor=j.slate[300],r.target.style.color=j.slate[700]},children:[e.jsx(_e,{style:{width:"18px",height:"18px"}}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:n,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:s.space[2],padding:`${s.space[3.5]} ${s.space[6]}`,borderRadius:s.radius.lg,border:"none",background:s.buttonGradient,color:"white",fontSize:s.fontSize.base,fontWeight:600,cursor:"pointer",boxShadow:`0 4px 12px ${s.primaryAccent}4d`,transition:"all 0.2s"},onMouseEnter:r=>{r.target.style.transform="translateY(-2px)",r.target.style.boxShadow=`0 6px 16px ${s.primaryAccent}66`},onMouseLeave:r=>{r.target.style.transform="none",r.target.style.boxShadow=`0 4px 12px ${s.primaryAccent}4d`},children:[e.jsx(Pe,{style:{width:"18px",height:"18px"}}),"Nochmal Ã¼ben"]})]})]})},H={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Es=({isAuthenticated:t,requireAuth:i,setPendingAction:p,pendingContinueSession:n,clearPendingContinueSession:s,pendingRepeatSession:l,clearPendingRepeatSession:m,onNavigateToHistory:b})=>{const[S,u]=c.useState(H.DASHBOARD),[d,r]=c.useState(null),[o,A]=c.useState(null),[C,v]=c.useState([]),[$,E]=c.useState({}),[z,x]=c.useState(null),[h,a]=c.useState(null),[g,R]=c.useState(null),[T,F]=c.useState(0);c.useEffect(()=>{g&&t&&(r(g),u(H.VARIABLES),R(null))},[g,t]),c.useEffect(()=>{if(n&&t){const{session:k,scenario:B}=n,L=k.questions||k.questions_json,le=typeof L=="string"?JSON.parse(L):L||[],re=k.completed_questions||k.answered_count||0;r(B||{id:k.scenario_id,title:k.scenario_title}),A(k),v(le),E({}),F(re),u(H.SESSION),s&&s()}},[n,t,s]),c.useEffect(()=>{if(l&&t){const{session:k,scenario:B}=l,L=k.questions||k.questions_json,le=typeof L=="string"?JSON.parse(L):L||[];r(B||{id:k.scenario_id,title:k.scenario_title}),v(le),E({}),F(0),u(H.SESSION),m&&m()}},[l,t,m]),c.useEffect(()=>{window.scrollTo(0,0)},[S]);const W=c.useCallback(k=>{r(k),u(H.VARIABLES)},[]),M=c.useCallback(()=>{r(null),A(null),v([]),E({}),x(null),F(0),a(null),u(H.DASHBOARD)},[]),P=c.useCallback(k=>{E(k),u(H.SESSION)},[]),y=c.useCallback(k=>{A(k.session),v(k.questions),k.selectedMicrophoneId&&a(k.selectedMicrophoneId)},[]),f=c.useCallback(k=>{x(k.session),u(H.COMPLETE)},[]),w=c.useCallback(()=>{M()},[M]),_=c.useCallback(()=>{A(null),v([]),x(null),F(0),a(null),u(H.VARIABLES)},[]),N=()=>{switch(S){case H.DASHBOARD:return e.jsx(tt,{onSelectScenario:W,isAuthenticated:t,requireAuth:i,setPendingScenario:R,onNavigateToHistory:b});case H.VARIABLES:return e.jsx(ns,{scenario:d,onBack:M,onNext:P});case H.SESSION:return e.jsx(hs,{session:o,questions:C,scenario:d,variables:$,preloadedQuestions:C.length>0?C:null,onSessionCreated:y,onComplete:f,onExit:w,startFromQuestion:T,initialMicrophoneId:h});case H.COMPLETE:return e.jsx(gs,{session:z,scenario:d,onBackToDashboard:M,onStartNew:_});default:return e.jsx(tt,{onSelectScenario:W,isAuthenticated:t,requireAuth:i,setPendingScenario:R,onNavigateToHistory:b})}};return e.jsx("div",{style:{minHeight:"100%"},children:N()})},it={target:se,clock:X,mic:G,"message-square":ue,lightbulb:V,brain:Oe,info:he,check:ge,sparkles:Ie},ms=[{icon:se,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:G,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Ts=({scenario:t,onBack:i,onStart:p,preloadedQuestions:n})=>{const[s,l]=c.useState({}),[m,b]=c.useState({}),[S,u]=c.useState(!1),[d,r]=c.useState(null),[o,A]=c.useState(null),[C,v]=c.useState(!1),[$,E]=c.useState([]),[z,x]=c.useState(!1),{demoCode:h}=Ge(),a=xt.useMemo(()=>{if(!t?.input_configuration)return[];try{const y=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(y)?y.filter(f=>f.user_input!==!1):[]}catch(y){return console.error("Error parsing input_configuration:",y),[]}},[t?.input_configuration]);c.useEffect(()=>{const y={};a.forEach(f=>{f.default&&(y[f.key]=f.default)}),l(y)},[a]);const g=(y,f)=>{if(!y)return y;let w=y;return Object.entries(f||{}).forEach(([_,N])=>{N&&(w=w.replace(new RegExp(`\\$\\{${_}\\}`,"g"),N),w=w.replace(new RegExp(`\\{${_}\\}`,"g"),N))}),w},R=(y,f)=>{l(w=>({...w,[y]:f})),m[y]&&b(w=>{const _={...w};return delete _[y],_})},T=()=>{E(y=>[...y,{key:"",value:""}])},F=(y,f,w)=>{E(_=>{const N=[..._];return N[y]={...N[y],[f]:w},N})},W=y=>{E(f=>f.filter((w,_)=>_!==y))},M=()=>{const y={};return a.forEach(f=>{const w=s[f.key];if(f.required&&(!w||w.trim()==="")){y[f.key]="Dieses Feld ist erforderlich";return}if(!(!w||w.trim()==="")&&f.validation){const{minLength:_,maxLength:N,min:k,max:B,pattern:L}=f.validation;_&&w.length<_&&(y[f.key]=`Mindestens ${_} Zeichen erforderlich`),N&&w.length>N&&(y[f.key]=`Maximal ${N} Zeichen erlaubt`),k!==void 0&&Number(w)<k&&(y[f.key]=`Mindestens ${k}`),B!==void 0&&Number(w)>B&&(y[f.key]=`Maximal ${B}`),L&&!new RegExp(L).test(w)&&(y[f.key]="UngÃ¼ltiges Format")}}),b(y),Object.keys(y).length===0},P=async y=>{if(y.preventDefault(),r(null),!!M()){u(!0);try{const f={...s};$.forEach(k=>{k.key&&k.value&&(f[k.key]=k.value)});const w=await Q.createSimulatorSession({scenario_id:t.id,variables:f,demo_code:h||null,questions:n||null});if(!w.success)throw new Error(w.message||"Fehler beim Erstellen der Session");const _=w.data.session;let N;if(n&&n.length>0)N=n,await Q.updateSimulatorSessionQuestions(_.id,N);else{const k=await Q.generateSimulatorQuestions(_.id);if(!k.success)throw new Error(k.message||"Fehler beim Generieren der Fragen");N=k.data.questions}p({session:{..._,questions_json:N},questions:N,scenario:t,variables:f,selectedMicrophoneId:o})}catch(f){console.error("Error starting session:",f),r(f.message||"Ein Fehler ist aufgetreten")}finally{u(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(_e,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ie,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ze,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(he,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:g(t.long_description?.replace(/\/n/g,`
`),s)})]})]})}),(()=>{const y=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((f,w)=>typeof f=="string"?{icon:V,title:`Tipp ${w+1}`,description:f}:{icon:it[f.icon]||it[f.icon?.toLowerCase()]||V,title:f.title||`Tipp ${w+1}`,description:f.text||f.description||""}):ms;return e.jsxs(ze,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:y.map((f,w)=>{const _=f.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(_,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:f.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:f.description})]})]},w)})})]})})(),e.jsxs("form",{onSubmit:P,children:[a.length>0?a.map(y=>e.jsx(Xt,{field:y,value:s[y.key],onChange:R,error:m[y.key]},y.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(ge,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>x(!z),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${z?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[z?e.jsx(Ve,{size:18}):e.jsx(Be,{size:18}),e.jsx(Re,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),z&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),$.length>0&&e.jsx("div",{className:"mb-3",children:$.map((y,f)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:y.key||"",onChange:w=>F(f,"key",w.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>W(f),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(at,{size:18})})]}),e.jsx("textarea",{value:y.value||"",onChange:w=>F(f,"value",w.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},f))}),e.jsxs("button",{type:"button",onClick:T,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Re,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ze,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(G,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(ht,{selectedDeviceId:o,onDeviceChange:A,onTestClick:()=>v(!0)})]}),d&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(xe,{className:"w-[18px] h-[18px]"}),d]}),e.jsx(ae,{type:"submit",disabled:S,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(lt,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(gt,{isOpen:C,onClose:()=>v(!1),deviceId:o}),e.jsx(mt,{isLoading:S,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{us as CancelConfirmDialog,ps as CompleteConfirmDialog,as as ImmediateFeedback,ds as PreSessionView,ls as QuestionTips,gs as SessionComplete,cs as SessionTimer,Es as SimulatorApp,st as SimulatorAudioRecorder,tt as SimulatorDashboard,hs as SimulatorSession,Ts as SimulatorWizard};
