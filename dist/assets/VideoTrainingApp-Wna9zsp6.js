import{j as e,l as $e,I as he,a1 as pe,k as at,z as ae,X as xe,V as D,T as Le,ao as nt,R as rt,B as Ke,w as ge,q as it,b as fe,a as ot,aj as lt,p as ct,ai as dt,v as Ue,o as mt,E as ze,ap as De,i as Te,h as ue,n as Re,m as A,aq as xt,t as qe,y as be,A as We,ak as ut,a0 as Ge,a8 as Ve,M as ht,a9 as pt,e as gt}from"./ui-vendor-B9DEMv6g.js";import{a}from"./react-vendor-uDOJF2jQ.js";import{C as j,h as ft,F as bt,g as je,c as H,u as ye,i as jt}from"./FeatureInfoButton-ZHD_p0zG.js";import{S as yt}from"./ScenarioDashboard-B4VCawg1.js";import{B as se}from"./button-C80IFm_X.js";import{I as me}from"./input-B9TvIUbd.js";import{T as vt}from"./textarea-Bk12bbFh.js";import{D as Nt}from"./DeviceSetupPage-S-Mr7VxU.js";import{F as wt}from"./fullscreen-loader-BGHAvS2i.js";import{u as St}from"./useMobile-YxjH166V.js";import{D as kt}from"./DeviceSettingsDialog-C-NwpFg0.js";import{A as Fe}from"./MicrophoneTestDialog-CjRagsq0.js";import{P as Ct}from"./progress-bar-DuNWsfsv.js";import{B as Q,C as At}from"./Button-DIyOYEUG.js";import"./select-native-hA6ciQRA.js";import"./dialog-BRm7JlyZ.js";const _e={error:{bg:j.red[50],border:j.red[200],text:j.red[600],icon:ae},warning:{bg:j.amber[50],border:j.amber[200],text:j.amber[600],icon:at},success:{bg:j.green[50],border:j.green[200],text:j.green[600],icon:pe},info:{bg:j.blue[50],border:j.blue[200],text:j.blue[500],icon:he},loading:{bg:j.blue[50],border:j.blue[200],text:j.blue[500],icon:$e}},It=({variant:t="info",message:s,children:o,isToast:l=!1,onDismiss:x,className:c="",style:u={}})=>{const i=_e[t]||_e.info,n=i.icon,f=t==="loading";return e.jsxs("div",{className:`flex items-center gap-3 py-3 px-4 rounded-xl text-sm font-medium ${l?"fixed bottom-6 left-1/2 -translate-x-1/2 shadow-lg z-[1000] max-w-[90%]":""} ${c}`,style:{backgroundColor:i.bg,border:`1px solid ${i.border}`,color:i.text,...u},children:[e.jsx(n,{size:20,className:`flex-shrink-0 ${f?"animate-spin":""}`}),e.jsx("span",{className:"flex-1",children:o||s}),x&&e.jsx("button",{onClick:x,className:"bg-transparent border-none p-1 cursor-pointer flex items-center justify-center opacity-70 hover:opacity-100 transition-opacity",style:{color:i.text},"aria-label":"Schließen",children:e.jsx(xe,{size:16})})]})},Et=({message:t,onDismiss:s,...o})=>e.jsx(It,{variant:"error",message:t,isToast:!0,onDismiss:s,...o}),zt={video:D,user:ge,briefcase:Ke,presentation:dt,mic:ct,target:Le,banknote:lt},Dt={self_presentation:{label:"Selbstpräsentation",icon:ge,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgespräch",icon:Ke,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:rt,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:nt,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:Le,color:"#64748b",bgColor:"#f1f5f9"}},Tt=async()=>{const t=await fetch(`${je()}/video-training/scenarios`,{headers:{"X-WP-Nonce":H()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const s=await t.json();if(s.success&&s.data?.scenarios)return s.data.scenarios;throw new Error("Ungültige Antwort vom Server")},Rt=t=>zt[t.icon]||D,Vt=t=>[{text:`${t.question_count} Fragen`},{icon:fe,text:`~${Math.round(t.total_time_limit/60)} Min.`}],Ft=()=>e.jsx("div",{className:"mt-10 p-5 bg-primary/5 rounded-xl border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ot,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed m-0",children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Be=({onSelectScenario:t,isAuthenticated:s,requireAuth:o,setPendingScenario:l,onNavigateToHistory:x})=>e.jsxs(e.Fragment,{children:[e.jsx(ft,{featureId:"videotraining",showOnMount:!0}),e.jsx(yt,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:D,headerActions:e.jsx(bt,{featureId:"videotraining",size:"sm"}),fetchScenarios:Tt,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:x,onSelectScenario:t,renderCardMeta:Vt,getIconForScenario:Rt,cardActionLabel:"Starten",cardActionIcon:it,categoryField:"scenario_type",customCategoryConfig:Dt,emptyStateIcon:D,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:Ft,isAuthenticated:s,requireAuth:o,setPendingScenario:l,loadingMessage:"Szenarien werden geladen..."})]}),_t=({field:t,value:s,onChange:o,error:l,focusColor:x})=>{const c=i=>{setTimeout(()=>{const n=i.target;if(n){const f=n.closest("div");f&&f.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=()=>{const i=l?"border-red-500":"";switch(t.type){case"text":return e.jsx(me,{type:"text",value:s||"",onChange:n=>o(t.key,n.target.value),placeholder:t.placeholder||"",className:i,onFocus:c});case"textarea":return e.jsx(vt,{value:s||"",onChange:n=>o(t.key,n.target.value),placeholder:t.placeholder||"",rows:4,className:`${i} min-h-[100px] resize-y`,onFocus:c});case"select":return e.jsxs("select",{value:s||t.default||"",onChange:n=>o(t.key,n.target.value),className:`w-full px-4 py-3 rounded-xl border-2 text-base text-slate-900 bg-white outline-none transition-all cursor-pointer appearance-none bg-[url('data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 20 20%27%3e%3cpath stroke=%27%236b7280%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%271.5%27 d=%27M6 8l4 4 4-4%27/%3e%3c/svg%3e')] bg-[position:right_12px_center] bg-no-repeat bg-[length:20px] pr-11 focus:border-primary focus:ring-2 focus:ring-primary/20 ${l?"border-red-500":"border-slate-200"}`,onFocus:c,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),t.options?.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]});case"number":return e.jsx(me,{type:"number",value:s||"",onChange:n=>o(t.key,n.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:i,onFocus:c});default:return e.jsx(me,{type:"text",value:s||"",onChange:n=>o(t.key,n.target.value),placeholder:t.placeholder||"",className:i,onFocus:c})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),u(),l&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-red-500 flex items-center gap-1",children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),l]}),t.hint&&!l&&e.jsxs("p",{className:"mt-1.5 text-[13px] text-slate-500 flex items-center gap-1",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),t.hint]})]})},Bt=({scenario:t,onBack:s,onNext:o})=>{const[l,x]=a.useState({}),[c,u]=a.useState({}),i=a.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(d=>d.user_input!==!1)}catch(r){return console.error("Error parsing input_configuration:",r),[]}},[t?.input_configuration]);a.useEffect(()=>{const r={};i.forEach(d=>{d.default&&(r[d.key]=d.default)}),x(r)},[i]);const n=(r,d)=>{x(p=>({...p,[r]:d})),c[r]&&u(p=>{const b={...p};return delete b[r],b})},f=()=>{const r={};return i.forEach(d=>{const p=l[d.key];if(d.required&&(!p||typeof p=="string"&&p.trim()==="")){r[d.key]="Dieses Feld ist erforderlich";return}if(!(!p||typeof p=="string"&&p.trim()==="")&&d.validation){const{minLength:b,maxLength:v,min:k,max:C,pattern:z}=d.validation;b&&p.length<b&&(r[d.key]=`Mindestens ${b} Zeichen erforderlich`),v&&p.length>v&&(r[d.key]=`Maximal ${v} Zeichen erlaubt`),k!==void 0&&Number(p)<k&&(r[d.key]=`Mindestens ${k}`),C!==void 0&&Number(p)>C&&(r[d.key]=`Maximal ${C}`),z&&!new RegExp(z).test(p)&&(r[d.key]="Ungültiges Format")}}),u(r),Object.keys(r).length===0},h=r=>{r.preventDefault(),f()&&o(l)};return a.useEffect(()=>{i.length===0&&o({})},[i,o]),i.length===0?null:e.jsxs("div",{className:"p-6 pb-52 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(se,{onClick:s,variant:"ghost",className:"inline-flex items-center gap-2 px-3 py-2 mb-4 text-sm",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(D,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 mt-1 mb-0",children:"Personalisiere dein Training"})]})]})]}),t.description&&e.jsx("div",{className:"p-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("div",{className:"p-4 px-5 rounded-xl bg-primary/10 mb-6 flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 m-0 mb-1",children:"So funktioniert es"}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 leading-normal",children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),e.jsxs("form",{onSubmit:h,children:[i.map(r=>e.jsx(_t,{field:r,value:l[r.key],onChange:n,error:c[r.key]},r.key)),e.jsxs(se,{type:"submit",size:"lg",className:"w-full mt-6 gap-2.5",children:["Weiter",e.jsx(mt,{className:"w-5 h-5"})]})]})]})},Mt=()=>{const[t,s]=a.useState(!1),[o,l]=a.useState(null),{demoCode:x}=ye(),c=a.useCallback(async(i,n,f)=>{l(null),s(!0);try{const h=await i();n(h)}catch(h){console.error("[useSessionStartup] Error:",h);const r=h.message||"Ein Fehler ist aufgetreten";l(r),s(!1),f?.(h)}},[]),u=a.useCallback(()=>{l(null)},[]);return{isSubmitting:t,submitError:o,demoCode:x,startSession:c,clearError:u}},Pt=({scenario:t,variables:s,onBack:o,onStart:l})=>{const{isSubmitting:x,submitError:c,demoCode:u,startSession:i,clearError:n}=Mt(),f=async({selectedMicrophoneId:h,selectedCameraId:r})=>{await i(async()=>{const d=je(),p=await fetch(`${d}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()},body:JSON.stringify({scenario_id:t.id,variables:s,demo_code:u||null})});if(!p.ok){const E=await p.json().catch(()=>({}));throw new Error(E.message||"Fehler beim Erstellen der Session")}const b=await p.json(),v=b.data?.session||b.session;if(!v)throw new Error("Keine Session-ID erhalten");const k=await fetch(`${d}/video-training/sessions/${v.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()},body:JSON.stringify({variables:s})});if(!k.ok){const E=await k.json().catch(()=>({}));throw new Error(E.message||"Fehler beim Generieren der Fragen")}const C=await k.json(),z=C.data?.questions||C.questions||[];return{session:{...v,questions:z},questions:z,scenario:t,variables:s,selectedMicrophoneId:h,selectedCameraId:r}},l)};return e.jsxs(e.Fragment,{children:[e.jsx(Nt,{mode:"audio-video",scenario:t,onBack:o,onStart:f,title:t?.title,startButtonLabel:"Video-Training starten",icon:D}),c&&e.jsx(Et,{message:c,onDismiss:n}),e.jsx(wt,{isLoading:x,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},Ot=({tips:t,primaryAccent:s})=>{const[o,l]=a.useState(!1);return!t||t.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>l(!o),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(be,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(ue,{size:18,className:`text-slate-500 transition-transform duration-200 ${o?"rotate-90":""}`})]}),e.jsx(We,{children:o&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:t.map((x,c)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:x},c))})})})})]})},$t=({number:t,size:s="md"})=>{const o={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${o[s]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},Me=({question:t,index:s,scenario:o,isMobile:l})=>e.jsxs(At,{className:l?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx($t,{number:s+1,size:l?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${l?"text-[15px]":"text-lg"} mb-0`,children:t?.question||"Frage wird geladen..."}),t?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(fe,{size:l?14:16}),"Empfohlene Antwortzeit: ~",Math.round(t.estimated_time/60)," Min."]}),o?.enable_tips&&t?.tips&&e.jsx(Ot,{tips:t.tips})]}),Pe=({time:t,isRecording:s})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[s?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(fe,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:jt(t)})]}),Oe=({error:t,onRetry:s})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(xt,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:t}),e.jsx(Q,{onClick:s,icon:e.jsx(qe,{size:16}),children:"Erneut versuchen"})]}),Lt=({isUploading:t,isAnalyzing:s})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx($e,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:t?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:t?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),Kt=({session:t,questions:s,scenario:o,variables:l,onComplete:x,onExit:c,selectedMicrophoneId:u,selectedCameraId:i})=>{const[n,f]=a.useState(0),[h,r]=a.useState(!1),[d,p]=a.useState(!1),[b,v]=a.useState(0),[k,C]=a.useState([]),[z,E]=a.useState([]),[N,_]=a.useState(null),[T,B]=a.useState(null),[L,R]=a.useState(!1),[X,Z]=a.useState(!1),[J,M]=a.useState(null),[K,ne]=a.useState(u||null),[U,w]=a.useState(i||null),[Qe,re]=a.useState(!1),[ve,Ne]=a.useState(0),q=St(),Y=a.useRef(null),ie=a.useRef(null),P=a.useRef(null),W=a.useRef(null),oe=a.useRef(null),O=a.useRef(null),{branding:He}=ye(),le=He?.["--primary-accent"],we=s[n];a.useEffect(()=>($(),()=>{ce(),P.current&&clearInterval(P.current),O.current&&cancelAnimationFrame(O.current),W.current&&W.current.close()}),[]);const Xe=m=>{try{W.current&&W.current.close();const S=new(window.AudioContext||window.webkitAudioContext);W.current=S;const g=S.createAnalyser();g.fftSize=256,g.smoothingTimeConstant=.8,oe.current=g,S.createMediaStreamSource(m).connect(g);const V=new Uint8Array(g.frequencyBinCount),F=()=>{if(!oe.current)return;oe.current.getByteFrequencyData(V);const de=V.reduce((tt,st)=>tt+st,0)/V.length;Ne(de/255),O.current=requestAnimationFrame(F)};F()}catch(S){console.error("[VIDEO TRAINING] Audio analysis error:",S)}},Ze=()=>{O.current&&(cancelAnimationFrame(O.current),O.current=null),Ne(0)},$=async(m=K,S=U)=>{try{B(null),N&&N.getTracks().forEach(F=>F.stop());const g=S?{deviceId:{exact:S},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},I=m?{deviceId:{exact:m}}:!0,V=await navigator.mediaDevices.getUserMedia({video:g,audio:I});_(V),Y.current&&(Y.current.srcObject=V)}catch(g){console.error("[VIDEO TRAINING] Camera error:",g),B("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Je=m=>{ne(m),h||$(m,U)},Ye=m=>{w(m),h||$(K,m)},ce=()=>{N&&(N.getTracks().forEach(m=>m.stop()),_(null))},Se=()=>{if(!N){$();return}try{const m=new MediaRecorder(N,{mimeType:"video/webm;codecs=vp9,opus"});ie.current=m;const S=[];m.ondataavailable=g=>{g.data.size>0&&(S.push(g.data),C(I=>[...I,g.data]))},m.onstop=()=>{},m.start(1e3),r(!0),p(!1),Xe(N),E(g=>[...g,{question_index:n,start_time:b}]),P.current=setInterval(()=>{v(g=>g+1)},1e3)}catch(m){console.error("[VIDEO TRAINING] Recording error:",m),M("Fehler beim Starten der Aufnahme")}},ee=()=>{ie.current&&h&&(ie.current.stop(),r(!1),Ze(),P.current&&(clearInterval(P.current),P.current=null))},ke=()=>{n<s.length-1&&(h&&E(m=>[...m,{question_index:n+1,start_time:b}]),f(m=>m+1))},Ce=()=>{n>0&&f(m=>m-1)},Ae=async()=>{ee(),ce(),R(!0),M(null);try{const m=new Blob(k,{type:"video/webm"}),S=je(),g=new FormData;g.append("video",m,`video_${t.id}.webm`),g.append("video_duration",b.toString()),g.append("timeline",JSON.stringify(z));const I=await fetch(`${S}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":H()},body:g});if(!I.ok){const de=await I.text();throw console.error("[VIDEO TRAINING] Upload failed:",I.status,de),I.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+I.status)}const V=await I.json();R(!1),Z(!0);const F=await fetch(`${S}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":H()}});if(!F.ok)throw new Error("Fehler bei der Video-Analyse");const G=await F.json();x({session:G.data?.session||t,analysis:G.data?.analysis,categoryScores:G.data?.category_scores,overallScore:G.data?.overall_score})}catch(m){console.error("[VIDEO TRAINING] Upload/Analysis error:",m),M(m.message),R(!1),Z(!1)}},et=()=>{ee(),ce(),c()};if(L||X)return e.jsx(Lt,{isUploading:L,isAnalyzing:X});const te=k.length>0,Ie=o?.enable_navigation&&n>0,Ee=o?.enable_navigation&&n<s.length-1;return e.jsxs("div",{className:`${q?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${q?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${q?"text-lg":"text-xl"} font-semibold text-slate-900`,children:o?.title}),e.jsxs("button",{onClick:et,className:`${q?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(xe,{size:16}),"Abbrechen"]})]}),e.jsx(Ct,{current:n,total:s.length,primaryAccent:le,showCompleted:!1}),q?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Me,{question:we,index:n,scenario:o,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[T?e.jsx(Oe,{error:T,onRetry:$}):e.jsx("video",{ref:Y,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(h||b>0)&&e.jsx(Pe,{time:b,isRecording:h})]}),h&&e.jsx("div",{className:"mt-4",children:e.jsx(Fe,{audioLevel:ve,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>re(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),h?e.jsxs("button",{onClick:ee,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(De,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Se,disabled:!N,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[Ie&&e.jsx(Q,{variant:"secondary",size:"sm",icon:e.jsx(Te,{size:16}),onClick:Ce,className:"flex-1",children:"Zurück"}),Ee&&e.jsx(Q,{size:"sm",iconPosition:"right",icon:e.jsx(ue,{size:16}),onClick:ke,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Ae,disabled:!te,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${te?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[T?e.jsx(Oe,{error:T,onRetry:$}):e.jsx("video",{ref:Y,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(h||b>0)&&e.jsx(Pe,{time:b,isRecording:h})]}),h&&e.jsx("div",{className:"mt-5",children:e.jsx(Fe,{audioLevel:ve,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>re(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),h?e.jsxs("button",{onClick:ee,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(De,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:Se,disabled:!N,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${N?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[Ie&&e.jsx(Q,{variant:"secondary",icon:e.jsx(Te,{size:18}),onClick:Ce,children:"Vorherige"}),Ee&&e.jsx(Q,{iconPosition:"right",icon:e.jsx(ue,{size:18}),onClick:ke,children:"Nächste"}),e.jsxs("button",{onClick:Ae,disabled:!te,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${te?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(Me,{question:we,index:n,scenario:o,isMobile:!1})]}),J&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(ae,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:J}),e.jsx("button",{onClick:()=>M(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(xe,{size:16,className:"text-red-500"})})]}),e.jsx(kt,{isOpen:Qe,onClose:()=>re(!1),mode:"audio-video",selectedMicrophoneId:K,onMicrophoneChange:Je,selectedCameraId:U,onCameraChange:Ye})]})},Ut={auftreten:pt,selbstbewusstsein:Ve,koerpersprache:ge,kommunikation:ht,professionalitaet:Ve,inhalt:be},qt=({score:t,size:s=120,strokeWidth:o=10,primaryAccent:l})=>{const x=(s-o)/2,c=x*2*Math.PI,u=c-t/100*c,i=()=>t>=80?"#22c55e":t>=60?l:t>=40?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"relative mx-auto",style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,className:"-rotate-90",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:x,fill:"none",stroke:"#e2e8f0",strokeWidth:o}),e.jsx(A.circle,{cx:s/2,cy:s/2,r:x,fill:"none",stroke:i(),strokeWidth:o,strokeLinecap:"round",strokeDasharray:c,initial:{strokeDashoffset:c},animate:{strokeDashoffset:u},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"font-bold text-slate-600",style:{fontSize:s/3,color:i()},children:Math.round(t)}),e.jsx("span",{className:"text-slate-500",style:{fontSize:s/10},children:"von 100"})]})]})},Wt=({category:t,primaryAccent:s})=>{const[o,l]=a.useState(!1),x=Ut[t.category]||Ge,c=u=>u>=80?"#22c55e":u>=60?s:u>=40?"#f59e0b":"#ef4444";return e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-slate-200 overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>l(!o),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{background:`${c(t.score)}15`},children:e.jsx(x,{size:20,color:c(t.score)})}),e.jsxs("div",{className:"flex-1 text-left min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"text-[15px] font-semibold text-slate-900 mb-0.5",children:t.label}),e.jsxs("p",{className:"text-[13px] text-slate-600 m-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[t.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",style:{color:c(t.score)},children:Math.round(t.score)}),e.jsx(gt,{size:20,className:"text-slate-500 transition-transform duration-200",style:{transform:o?"rotate(180deg)":"none"}})]})]}),e.jsx(We,{children:o&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 border-t border-slate-200 pt-4",children:[e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:t.feedback}),t.strengths&&t.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-green-600 mb-2 flex items-center gap-1.5",children:[e.jsx(pe,{size:14}),"Stärken"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.strengths.map((u,i)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:u},i))})]}),t.improvements&&t.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-amber-600 mb-2 flex items-center gap-1.5",children:[e.jsx(ae,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:t.improvements.map((u,i)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1",children:u},i))})]})]})})})]})},Gt=({session:t,scenario:s,onBackToDashboard:o,onStartNew:l})=>{const{branding:x}=ye(),c=x?.primaryAccent||"#3A7FA7",u=t?.overall_score||0,i=t?.category_scores||[],n=t?.analysis||{},f=t?.summary_feedback||"",h=r=>r>=90?"Ausgezeichnet!":r>=80?"Sehr gut!":r>=70?"Gut!":r>=60?"Solide Leistung":r>=50?"Ausbaufähig":"Weiter üben!";return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-brand-gradient flex items-center justify-center mx-auto mb-5 shadow-xl",children:e.jsx(ut,{size:40,color:"#fff"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Training abgeschlossen!"}),e.jsxs("p",{className:"text-base text-slate-600",children:[s?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},className:"bg-white rounded-2xl p-8 text-center border border-slate-200 shadow-md mb-6",children:[e.jsx(qt,{score:u,size:160,primaryAccent:c}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mt-5 mb-2",children:h(u)}),e.jsx("p",{className:"text-[15px] text-slate-600 max-w-lg mx-auto leading-relaxed",children:f||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),i.length>0&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Ge,{size:20,color:c}),"Detaillierte Bewertung"]}),i.map((r,d)=>e.jsx(Wt,{category:r,primaryAccent:c},r.category||d))]}),n&&(n.key_strengths?.length>0||n.actionable_tips?.length>0)&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[n.key_strengths&&n.key_strengths.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"text-base font-semibold text-green-600 mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:18}),"Deine Stärken"]}),e.jsx("ul",{className:"m-0 pl-6",children:n.key_strengths.map((r,d)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:r},d))})]}),n.actionable_tips&&n.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-base font-semibold mb-3 flex items-center gap-2",style:{color:c},children:[e.jsx(be,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-6",children:n.actionable_tips.map((r,d)=>e.jsx("li",{className:"text-sm text-slate-600 mb-2 leading-normal",children:r},d))})]})]}),t?.video_url&&e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"bg-white rounded-2xl p-6 border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(D,{size:18,color:c}),"Deine Aufnahme"]}),e.jsx("video",{src:t.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex gap-4 justify-center",children:[e.jsxs(se,{onClick:o,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(Ue,{size:18}),"Zur Übersicht"]}),e.jsxs(se,{onClick:l,size:"lg",className:"gap-2 shadow-lg",children:[e.jsx(qe,{size:18}),"Nochmal üben"]})]})]})},y={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},ds=({isAuthenticated:t,requireAuth:s,setPendingAction:o,pendingScenario:l,clearPendingScenario:x,onNavigateToHistory:c})=>{const[u,i]=a.useState(y.DASHBOARD),[n,f]=a.useState(null),[h,r]=a.useState(null),[d,p]=a.useState([]),[b,v]=a.useState({}),[k,C]=a.useState(null),[z,E]=a.useState(null),[N,_]=a.useState(null),[T,B]=a.useState(null);a.useEffect(()=>{l&&t&&(f(l),i(y.VARIABLES),x&&x())},[l,t,x]),a.useEffect(()=>{T&&t&&(f(T),i(y.VARIABLES),B(null))},[T,t]),a.useEffect(()=>{window.scrollTo(0,0)},[u]);const L=a.useCallback(w=>{f(w),i(y.VARIABLES)},[]),R=a.useCallback(()=>{f(null),r(null),p([]),v({}),C(null),E(null),_(null),i(y.DASHBOARD)},[]),X=a.useCallback(w=>{v(w),i(y.DEVICE_SETUP)},[]),Z=a.useCallback(()=>{i(y.VARIABLES)},[]),J=a.useCallback(w=>{r(w.session),p(w.questions),v(w.variables),E(w.selectedMicrophoneId),_(w.selectedCameraId),i(y.SESSION)},[]),M=a.useCallback(w=>{C(w.session),i(y.COMPLETE)},[]),K=a.useCallback(()=>{R()},[R]),ne=a.useCallback(()=>{r(null),p([]),C(null),E(null),_(null),i(y.VARIABLES)},[]),U=()=>{switch(u){case y.DASHBOARD:return e.jsx(Be,{onSelectScenario:L,isAuthenticated:t,requireAuth:s,setPendingScenario:B,onNavigateToHistory:c});case y.VARIABLES:return e.jsx(Bt,{scenario:n,onBack:R,onNext:X});case y.DEVICE_SETUP:return e.jsx(Pt,{scenario:n,variables:b,onBack:Z,onStart:J});case y.SESSION:return e.jsx(Kt,{session:h,questions:d,scenario:n,variables:b,onComplete:M,onExit:K,selectedMicrophoneId:z,selectedCameraId:N});case y.COMPLETE:return e.jsx(Gt,{session:k,scenario:n,onBackToDashboard:R,onStartNew:ne});default:return e.jsx(Be,{onSelectScenario:L,isAuthenticated:t,requireAuth:s,setPendingScenario:B,onNavigateToHistory:c})}};return e.jsx("div",{className:"min-h-full",children:U()})};export{ds as V,Be as a,Kt as b,Gt as c};
