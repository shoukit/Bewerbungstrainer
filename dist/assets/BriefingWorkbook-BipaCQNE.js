import{F as U,Q as te,aE as J,s as ue,aF as pe,aG as ge,aH as be,aI as fe,aJ as je,t as ye,L as E,u as Ne,T as we,I as ke,X as se,b as ae,aK as ve,ah as ne,Y as M,aL as Ce,aM as _e,aN as Se,aO as ze,g as Ee,aP as Ae,P as Be,aQ as Pe,M as Ie,ad as Fe,ag as Le,Z as Me,aR as De,aS as Te,aT as Oe,i as $e,aU as Ue,J as Ge,aA as re,E as Re,a3 as qe,a8 as Ke,e as He,V as Ve,a as W,_ as ie,R as le,c as Je,S as We,z as oe,a2 as Qe,ax as Ze,ay as Ye,a1 as Xe,l as et,at as ce,x as tt,U as de,am as me,r as xe,j as e,w as st,$ as at,y as Q,C as Z,A as nt,m as Y,aV as rt,aW as it,aC as lt,a0 as ot}from"./ui-vendor-4RzMPcHM.js";import{a as i}from"./react-vendor-uDOJF2jQ.js";import{u as ct,w as L,n as dt}from"./FeatureInfoButton-DkKoIptM.js";import{u as mt}from"./useMobile-YxjH166V.js";import{C as q,B as $}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const xt={"file-text":U,briefcase:xe,banknote:me,users:de,user:tt,"message-circle":ce,target:et,award:Xe,book:Ye,clipboard:Ze,star:Qe,lightbulb:oe,shield:We,compass:Je,rocket:le,calendar:ie,sparkles:W,video:Ve,mic:He,play:Ke,"check-circle":qe,"alert-circle":Re,"help-circle":re,settings:Ge,home:Ue,"trending-up":$e,"bar-chart":Oe,"pie-chart":Te,activity:De,zap:Me,heart:Le,"thumbs-up":Fe,"message-square":Ie,mail:Pe,phone:Be,"map-pin":Ae,clock:Ee,bell:ze,search:Se,filter:_e,edit:Ce,trash:M,plus:ne,minus:ve,check:ae,x:se,info:ke,warning:we,refresh:Ne,loader:E,globe:ye,link:je,bookmark:fe,tag:be,code:ge,database:pe,server:ue,pen:J,bot:te},ht={"file-text":U,briefcase:xe,banknote:me,users:de},ut=(s,a=U)=>xt[s]||a,zt=s=>ht[s]||U,pt={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},gt=s=>pt[s]||s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),R=s=>{if(!s)return null;const a=[];let l=s,c=0;for(;l.length>0;){const p=l.match(/\*\*(.+?)\*\*/),n=l.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),d=l.match(/`([^`]+)`/),f=[{match:p,type:"bold"},{match:n,type:"italic"},{match:d,type:"code"}].filter(g=>g.match);if(f.length===0){a.push(l);break}const x=f.reduce((g,b)=>(g.match?.index??1/0)<(b.match?.index??1/0)?g:b);switch(x.match.index>0&&a.push(l.substring(0,x.match.index)),x.type){case"bold":a.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:x.match[1]},c++));break;case"italic":a.push(e.jsx("em",{className:"italic",children:x.match[1]||x.match[2]},c++));break;case"code":a.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:x.match[1]},c++));break}l=l.substring(x.match.index+x.match[0].length)}return a},he=({content:s})=>{if(!s)return null;const a=l=>{const c=l.split(`
`),p=[];let n=[],d=null;const f=()=>{n.length>0&&(p.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:n.map((x,g)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:d==="number"?`${g+1}.`:"â€¢"}),R(x)]},g))},`list-${p.length}`)),n=[],d=null)};return c.forEach((x,g)=>{const b=x.trim();if(!b){f();return}if(b.startsWith("- ")||b.startsWith("* ")){d!=="bullet"&&(f(),d="bullet"),n.push(b.substring(2));return}const v=b.match(/^(\d+)\.\s/);if(v){d!=="number"&&(f(),d="number"),n.push(b.substring(v[0].length));return}f(),p.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:R(b)},`p-${g}`))}),f(),p};return e.jsx("div",{children:a(s)})},bt=({item:s,onRestore:a})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:s.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(ot,{size:12}),"Wiederherstellen"]})]}),X=({item:s,sectionId:a,onUpdateItem:l,onAskItem:c,onDeleteExplanation:p,onAddAsItem:n})=>{const[d,f]=i.useState(s.user_note||""),[x,g]=i.useState(!1),[b,v]=i.useState(!1),[C,_]=i.useState(!1),[S,z]=i.useState(!!s.user_note),[w,P]=i.useState(!1),[o,A]=i.useState(""),[k,I]=i.useState(!1),[D,T]=i.useState(!0),B=s.ai_explanations||[];i.useEffect(()=>{_(d!==(s.user_note||""))},[d,s.user_note]);const K=async()=>{g(!0);try{await l(a,s.id,{user_note:d}),v(!0),_(!1),setTimeout(()=>v(!1),2e3)}catch(t){console.error("Error saving note:",t)}finally{g(!1)}},H=async()=>{try{await l(a,s.id,{deleted:!0})}catch(t){console.error("Error deleting item:",t)}},V=async()=>{try{await l(a,s.id,{deleted:!1})}catch(t){console.error("Error restoring item:",t)}},O=async t=>{if(c){I(!0);try{await c(a,s.id,{quick_action:t}),T(!0)}catch(m){console.error("Error asking AI:",m)}finally{I(!1)}}},G=async()=>{if(!(!c||!o.trim())){I(!0);try{await c(a,s.id,{question:o.trim()}),A(""),T(!0)}catch(t){console.error("Error asking AI:",t)}finally{I(!1)}}},r=async t=>{if(p)try{await p(a,s.id,t)}catch(m){console.error("Error deleting explanation:",m)}};return s.deleted?e.jsx(bt,{item:s,onRestore:V}):e.jsxs(q,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})]}),s.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:R(s.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[B.length>0&&!w&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[B.length," KI"]}),s.user_note&&!S&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{P(!w),w||z(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${w?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(ce,{size:16})}),e.jsx("button",{onClick:()=>{z(!S),S||P(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${S?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(J,{size:16})}),e.jsx("button",{onClick:H,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(M,{size:16})})]})]}),w&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>O("explain"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(re,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>O("examples"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(rt,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>O("howto"),disabled:k,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(le,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:t=>A(t.target.value),onKeyDown:t=>t.key==="Enter"&&!k&&G(),placeholder:"Oder stelle eine eigene Frage...",disabled:k,className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx($,{variant:"primary",size:"sm",onClick:G,disabled:k||!o.trim(),icon:k?e.jsx(E,{size:14,className:"animate-spin"}):e.jsx(it,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),k&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(E,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),B.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>T(!D),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[D?e.jsx(Q,{size:14}):e.jsx(Z,{size:14}),"KI-ErklÃ¤rungen (",B.length,")"]}),D&&e.jsx("div",{className:"space-y-2",children:B.map(t=>e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-amber-200",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("p",{className:"text-[12px] font-medium text-amber-700 m-0",children:t.quick_action?t.quick_action==="explain"?"ðŸ’¡ ErklÃ¤rung":t.quick_action==="examples"?"ðŸ“ Beispiele":t.quick_action==="howto"?"ðŸš€ Umsetzung":"Frage":`â“ ${t.question}`}),e.jsxs("div",{className:"flex items-center gap-1",children:[n&&e.jsx("button",{onClick:()=>n(a,t.answer,s.label),title:"Als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(ne,{size:14})}),e.jsx("button",{onClick:()=>r(t.id),title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(se,{size:14})})]})]}),e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap",children:R(t.answer)})]},t.id))})]})]}),S&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:d,onChange:t=>f(t.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx($,{variant:"secondary",size:"sm",onClick:()=>{z(!1),f(s.user_note||"")},children:"Abbrechen"}),e.jsx($,{variant:b?"secondary":"primary",size:"sm",onClick:K,disabled:x||!C,icon:x?e.jsx(E,{size:12,className:"animate-spin"}):b?e.jsx(ae,{size:12}):e.jsx(lt,{size:12}),className:b?"bg-green-100 text-green-700 border-green-200":"",children:b?"Gespeichert!":"Speichern"})]})]})]})},ft=({onClick:s,isGenerating:a})=>e.jsx("button",{onClick:s,disabled:a,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:16}),"5 weitere Punkte generieren"]})}),jt=({section:s,onUpdateItem:a,onGenerateMore:l,onAskItem:c,onDeleteExplanation:p,onAddAsItem:n,isExpanded:d,onToggle:f})=>{const[x,g]=i.useState(!1),b=async()=>{g(!0);try{await l(s.id)}catch(o){console.error("Error generating more items:",o)}finally{g(!1)}},v=i.useCallback(()=>{if(!s.ai_content)return{type:"empty",items:[],content:""};try{const o=JSON.parse(s.ai_content);if(o&&Array.isArray(o.items))return{type:"items",items:o.items,content:""}}catch{}return{type:"markdown",items:[],content:s.ai_content}},[s.ai_content]),{type:C,items:_,content:S}=v(),z=_.filter(o=>!o.deleted),w=_.filter(o=>o.deleted),P=_.some(o=>o.user_note&&!o.deleted);return e.jsxs(q,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:f,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${d?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:s.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[C==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[z.length," Punkte"]}),P&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(J,{size:12}),"Notizen"]}),d?e.jsx(Q,{size:20,className:"text-slate-400"}):e.jsx(Z,{size:20,className:"text-slate-400"})]})]}),d&&e.jsx("div",{className:"px-5 py-4",children:C==="items"?e.jsxs(e.Fragment,{children:[z.map(o=>e.jsx(X,{item:o,sectionId:s.id,onUpdateItem:a,onAskItem:c,onDeleteExplanation:p,onAddAsItem:n},o.id)),l&&e.jsx(ft,{onClick:b,isGenerating:x}),w.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(M,{size:12}),w.length," gelÃ¶schte ",w.length===1?"Punkt":"Punkte"]}),w.map(o=>e.jsx(X,{item:o,sectionId:s.id,onUpdateItem:a,onAskItem:c,onDeleteExplanation:p,onAddAsItem:n},o.id))]})]}):C==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(he,{content:S})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},ee=({onClick:s,disabled:a,loading:l,icon:c,danger:p,title:n})=>e.jsx("button",{onClick:s,disabled:a,title:n,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${p?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:l?e.jsx(E,{size:16,className:"animate-spin"}):e.jsx(c,{size:16})}),yt=({variables:s,isExpanded:a,onToggle:l})=>!s||Object.keys(s).length===0?null:e.jsxs(q,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:l,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(s).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:a?"Einklappen":"Ausklappen"}),a?e.jsx(Q,{size:16}):e.jsx(Z,{size:16})]})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(s).map(([c,p])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[gt(c),":"]})," ",p]},c))})]}),Nt=({isOpen:s,onClose:a,onConfirm:l,isDeleting:c})=>e.jsx(nt,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{variant:"secondary",onClick:a,disabled:c,fullWidth:!0,children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:l,disabled:c,icon:c?e.jsx(E,{size:16,className:"animate-spin"}):e.jsx(M,{size:16}),fullWidth:!0,children:c?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),Et=({briefing:s,onBack:a,onDelete:l})=>{const{config:c}=ct(),p=mt(),[n,d]=i.useState(s),[f,x]=i.useState(!s?.sections),[g,b]=i.useState(null),[v,C]=i.useState({}),[_,S]=i.useState(!1),[z,w]=i.useState(!1),[P,o]=i.useState(!1),[A,k]=i.useState(!1),I=ut(n?.template_icon)||U;i.useEffect(()=>{const r=async()=>{if(n?.sections){const t={};n.sections.forEach(m=>{t[m.id]=!0}),C(t),x(!1);return}try{x(!0);const t=await L.request(`/smartbriefing/briefings/${n.id}`,{method:"GET"});if(t.success&&t.data?.briefing){d(t.data.briefing);const m={};t.data.briefing.sections?.forEach(y=>{m[y.id]=!0}),C(m)}else throw new Error("Fehler beim Laden des Briefings")}catch(t){console.error("[SmartBriefing] Error fetching briefing:",t),b(t.message)}finally{x(!1)}};n?.id&&r()},[n?.id]);const D=i.useCallback(r=>{C(t=>({...t,[r]:!t[r]}))},[]),T=i.useCallback(async(r,t,m)=>{const y=await L.request(`/smartbriefing/sections/${r}/items/${t}`,{method:"PATCH",body:JSON.stringify(m)});if(!y.success)throw new Error("Fehler beim Speichern");d(j=>({...j,sections:j.sections.map(h=>h.id===r?y.data.section:h)}))},[]),B=i.useCallback(async r=>{const t=await L.request(`/smartbriefing/sections/${r}/generate-more`,{method:"POST"});if(!t.success)throw new Error(t.message||"Fehler beim Generieren");return d(m=>({...m,sections:m.sections.map(y=>y.id===r?t.data.section:y)})),t.data.new_items_count},[]),K=i.useCallback(async(r,t,m)=>{const y=await L.askBriefingItem(r,t,m);return d(j=>({...j,sections:j.sections.map(h=>{if(h.id!==r)return h;let u;try{u=typeof h.ai_content=="string"?JSON.parse(h.ai_content):h.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),h}if(!u?.items)return h;const N=u.items.map(F=>F.id===t?y.item:F);return{...h,ai_content:JSON.stringify({...u,items:N})}})})),y},[]),H=i.useCallback(async(r,t,m)=>{await L.deleteBriefingItemExplanation(r,t,m),d(y=>({...y,sections:y.sections.map(j=>{if(j.id!==r)return j;let h;try{h=typeof j.ai_content=="string"?JSON.parse(j.ai_content):j.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),j}if(!h?.items)return j;const u=h.items.map(N=>N.id!==t?N:{...N,ai_explanations:(N.ai_explanations||[]).filter(F=>F.id!==m)});return{...j,ai_content:JSON.stringify({...h,items:u})}})}))},[]),V=i.useCallback(async(r,t,m)=>{const y=`Vertiefung: ${m}`,j=t.length>200?t.substring(0,200)+"...":t;d(h=>({...h,sections:h.sections.map(u=>{if(u.id!==r)return u;let N;try{N=typeof u.ai_content=="string"?JSON.parse(u.ai_content):u.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),u}if(!N?.items)return u;const F={id:crypto.randomUUID(),label:y,content:j,user_note:`VollstÃ¤ndige KI-Antwort:

${t}`,deleted:!1,ai_explanations:[]};return{...u,ai_content:JSON.stringify({...N,items:[...N.items,F]})}})}))},[]),O=i.useCallback(async()=>{if(!(A||!n?.id)){k(!0);try{const r=await L.request(`/smartbriefing/briefings/${n.id}/pdf`,{method:"GET"});if(!r.success||!r.data?.pdf_base64)throw new Error(r.message||"PDF-Export fehlgeschlagen");const t=atob(r.data.pdf_base64),m=new Array(t.length);for(let N=0;N<t.length;N++)m[N]=t.charCodeAt(N);const y=new Uint8Array(m),j=new Blob([y],{type:"application/pdf"}),h=window.URL.createObjectURL(j),u=document.createElement("a");u.href=h,u.download=r.data.filename||"Smart-Briefing.pdf",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h)}catch(r){console.error("[SmartBriefing] PDF download error:",r)}finally{k(!1)}}},[n?.id,A]),G=async()=>{if(!(!l||!n?.id)){o(!0);try{await l(n)}catch(r){console.error("Failed to delete briefing:",r)}finally{o(!1),w(!1)}}};return n?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 py-5 md:px-8 md:py-6",style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[a&&e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(st,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!p&&e.jsx("div",{className:"w-[90px] h-[90px] rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(I,{size:40,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:n.template_title})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${p?"text-xl":"text-2xl"}`,children:n.title||"Briefing"}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ie,{size:14}),dt(n.created_at)]})})]}),e.jsxs("div",{className:"flex gap-2.5 flex-shrink-0",children:[e.jsx(ee,{onClick:O,disabled:A,loading:A,icon:at,title:"Als PDF herunterladen"}),l&&e.jsx(ee,{onClick:()=>w(!0),icon:M,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${p?"p-4":"px-8 py-6"}`,children:[e.jsx(yt,{variables:n.variables,isExpanded:_,onToggle:()=>S(!_)}),f&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(E,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),g&&!f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:g})}),!f&&!g&&n.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[n.sections.length," Abschnitte"]})]}),n.sections.map(r=>e.jsx(jt,{section:r,onUpdateItem:T,onGenerateMore:B,onAskItem:K,onDeleteExplanation:H,onAddAsItem:V,isExpanded:v[r.id],onToggle:()=>D(r.id)},r.id))]}),!f&&!g&&(!n.sections||n.sections.length===0)&&n.content_markdown&&e.jsx(q,{className:"p-6",children:e.jsx(he,{content:n.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(Nt,{isOpen:z,onClose:()=>w(!1),onConfirm:G,isDeleting:P})]}):null};export{Et as B,ut as a,zt as g};
