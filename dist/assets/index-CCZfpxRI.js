import{V as Pe,c as We,a as Oe,b as Ge}from"./VideoTrainingApp-CbkPHHcV.js";import{j as e,v as re,V as Q,m as b,I as z,y as S,ao as F,e as K,l as Y,a as ee,a1 as le,E as te,an as oe,M as ce,g as de,z as L,h as me,C as ue,t as xe}from"./ui-vendor-BPmrRjpn.js";import{a as i}from"./react-vendor-uDOJF2jQ.js";import{u as pe,g as he,a as X}from"./FeatureInfoButton-C-pllNNf.js";import{F as ge}from"./fullscreen-loader-BGmBgq-B.js";import{C as I,B as fe}from"./select-native-DRUSZasO.js";import"./dialog-ClMCq6FL.js";import"./ScenarioDashboard-DIOmgkYn.js";import"./ScenarioCard-CxeCLbz0.js";import"./useMobile-YxjH166V.js";import"./button-BoRGn9H8.js";import"./input-Dg8SXIdV.js";import"./utils-BEHD0UYf.js";import"./textarea-D_5UFHp6.js";import"./DeviceSetupPage-CC-lJTFm.js";import"./MicrophoneTestDialog-BMYyyjuu.js";import"./DeviceSettingsDialog-oL48EOzx.js";import"./progress-bar-DvpIpQeJ.js";import"./Confetti-DHj-sAKj.js";import"./index-CklPxmEV.js";const be=t=>t?t.split(/(\*\*.*?\*\*)/g).map((c,m)=>c.startsWith("**")&&c.endsWith("**")?e.jsx("strong",{children:c.slice(2,-2)},m):c):null,J={target:Y,clock:de,mic:K,camera:F,video:Q,"message-square":ce,lightbulb:S,brain:oe,info:z,settings:te,check:le,sparkles:ee},ve=[{icon:F,title:"Blick in die Kamera",description:"Schaue direkt in die Kamera, um Augenkontakt zu simulieren."},{icon:S,title:"Gute Beleuchtung",description:"Achte auf ausreichend Licht von vorne, um professionell zu wirken."},{icon:K,title:"Klare Aussprache",description:"Sprich deutlich und in angemessenem Tempo."},{icon:Y,title:"Strukturierte Antworten",description:"Nutze die STAR-Methode: Situation, Task, Action, Result."}],H=({type:t,devices:x,selectedDeviceId:c,onDeviceChange:m,isLoading:p,error:u,onRefresh:r})=>{const[g,j]=i.useState(!1),N=t==="video"?F:K,w=t==="video"?"Kamera":"Mikrofon",D=l=>{if(l.label){let o=l.label;return o=o.replace(/^Default - /,""),o=o.replace(/^Kommunikation - /,""),o=o.replace(/^Standard - /,""),o.length>35&&(o=o.substring(0,32)+"..."),o}return`${w} ${x.indexOf(l)+1}`},y=x.find(l=>l.deviceId===c),q=l=>{m?.(l),j(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>!p&&j(!g),disabled:p,className:`flex-1 min-w-[200px] flex items-center justify-between gap-3 p-3 rounded-xl border-2 transition-all
            ${u?"border-red-500 bg-red-50":"border-slate-200 bg-white"}
            ${p?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-[10px] flex items-center justify-center
              ${u?"bg-red-100":"bg-brand-gradient"}`,children:u?e.jsx(L,{className:"w-[22px] h-[22px] text-red-500"}):e.jsx(N,{className:"w-[22px] h-[22px] text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium mb-0.5",children:w}),e.jsx("div",{className:`text-sm font-semibold ${u?"text-red-600":"text-slate-900"}`,children:p?"Lade...":u||(y?D(y):"Bitte wählen")})]})]}),e.jsx(ue,{className:`w-5 h-5 text-slate-400 transition-transform duration-200 ${g?"rotate-180":""}`})]}),u&&r&&e.jsx("button",{type:"button",onClick:r,className:"flex items-center justify-center px-4 py-3 rounded-xl border-2 border-slate-200 bg-white cursor-pointer hover:bg-slate-50 transition-colors",children:e.jsx(xe,{className:"w-5 h-5 text-slate-600"})})]}),g&&x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>j(!1),className:"fixed inset-0 z-40"}),e.jsx("div",{className:"absolute top-[calc(100%+8px)] left-0 right-0 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden max-h-[280px] overflow-y-auto",children:x.map((l,o)=>{const f=c===l.deviceId;return e.jsxs("button",{type:"button",onClick:()=>q(l.deviceId),className:`w-full py-3.5 px-4 text-left flex items-center gap-3 border-none cursor-pointer transition-colors
                    ${f?"bg-primary/10":"bg-transparent hover:bg-slate-50"}`,children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center
                    ${f?"bg-primary":"bg-slate-100"}`,children:e.jsx(N,{className:`w-[18px] h-[18px] ${f?"text-white":"text-slate-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`text-sm font-medium truncate ${f?"text-primary":"text-slate-900"}`,children:D(l)}),l.deviceId==="default"&&e.jsx("div",{className:"text-xs text-slate-400",children:"Systemstandard"})]}),f&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},l.deviceId||o)})})]})]})},je=({field:t,value:x,onChange:c,error:m})=>{const p=`w-full py-3 px-4 rounded-[10px] border-2 text-base transition-all outline-none bg-white
    ${m?"border-red-500":"border-slate-200"}
    focus:border-primary focus:ring-2 focus:ring-primary/20`,u=()=>{switch(t.type){case"select":return e.jsxs("select",{value:x||t.default||"",onChange:r=>c(t.key,r.target.value),className:`${p} cursor-pointer`,required:t.required,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte auswählen..."}),t.options?.slice().sort((r,g)=>r.label.localeCompare(g.label,"de")).map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"textarea":return e.jsx("textarea",{value:x||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,className:`${p} min-h-[100px] resize-y`,required:t.required});case"number":return e.jsx("input",{type:"number",value:x||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,className:p,required:t.required,min:t.min,max:t.max});default:return e.jsx("input",{type:"text",value:x||"",onChange:r=>c(t.key,r.target.value),placeholder:t.placeholder,className:p,required:t.required})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),u(),t.hint&&e.jsx("p",{className:"text-[13px] text-slate-400 mt-1",children:t.hint}),m&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(L,{size:14}),m]})]})},Le=({scenario:t,onBack:x,onStart:c})=>{const[m,p]=i.useState(()=>{const s=t?.input_configuration||[],a={};return s.forEach(n=>{n.default&&(a[n.key]=n.default)}),a}),[u,r]=i.useState({}),[g,j]=i.useState(!1),[N,w]=i.useState(null),[D,y]=i.useState([]),[q,l]=i.useState([]),[o,f]=i.useState(null),[A,_]=i.useState(null),[B,P]=i.useState(!0),[W,k]=i.useState(null),[O,C]=i.useState(null),M=i.useRef(0),T=i.useRef(!1),R=i.useRef(!0),V=i.useRef(0),G=i.useRef(null),Z=i.useRef(null),{demoCode:se}=pe();G.current=o,Z.current=A;const E=i.useCallback(async(s=!1)=>{if(T.current){console.log("[VideoTraining] Skipping loadDevices - already loading");return}if(s){if(R.current){console.log("[VideoTraining] Skipping devicechange - ignore flag set");return}const a=Date.now()-M.current;if(a<5e3){console.log("[VideoTraining] Skipping devicechange - too soon:",a,"ms");return}if(V.current+=1,V.current>3){console.log("[VideoTraining] Skipping devicechange - too many events:",V.current);return}}T.current=!0,M.current=Date.now(),P(!0),k(null),C(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(d=>d.stop());const n=await navigator.mediaDevices.enumerateDevices(),h=n.filter(d=>d.kind==="audioinput"),v=n.filter(d=>d.kind==="videoinput");if(h.length===0)k("Kein Mikrofon gefunden"),y([]);else if(y(h),!G.current){const d=h.find($=>$.deviceId==="default")||h[0];f(d.deviceId)}if(v.length===0)C("Keine Kamera gefunden"),l([]);else if(l(v),!Z.current){const d=v.find($=>$.deviceId==="default")||v[0];_(d.deviceId)}}catch(a){console.error("Error loading devices:",a),a.name==="NotAllowedError"||a.name==="PermissionDeniedError"?(k("Zugriff verweigert"),C("Zugriff verweigert")):a.name==="NotFoundError"?(k("Kein Mikrofon gefunden"),C("Keine Kamera gefunden")):(k("Fehler beim Laden"),C("Fehler beim Laden")),y([]),l([])}finally{P(!1),T.current=!1,M.current=Date.now(),s||setTimeout(()=>{R.current=!1,console.log("[VideoTraining] Now accepting devicechange events")},5e3)}},[]);i.useEffect(()=>{E(!1);let s=null;const a=()=>{R.current||T.current||(s&&clearTimeout(s),s=setTimeout(()=>{E(!0)},1e3))};return navigator.mediaDevices?.addEventListener("devicechange",a),()=>{s&&clearTimeout(s),navigator.mediaDevices?.removeEventListener("devicechange",a)}},[]);const ae=i.useCallback((s,a)=>{p(n=>({...n,[s]:a})),u[s]&&r(n=>{const h={...n};return delete h[s],h})},[u]),ie=i.useCallback(()=>{const s={};return(t?.input_configuration||[]).forEach(n=>{n.required&&!m[n.key]&&(s[n.key]=`${n.label} ist erforderlich`)}),r(s),Object.keys(s).length===0},[t,m]),ne=async()=>{if(ie()){j(!0),w(null);try{const s=he(),a=await fetch(`${s}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()},body:JSON.stringify({scenario_id:t.id,variables:m,demo_code:se||null})});if(!a.ok)throw new Error("Fehler beim Erstellen der Sitzung");const n=await a.json();if(!n.success||!n.data?.session)throw new Error("Ungültige Antwort beim Erstellen der Sitzung");const h=n.data.session,v=await fetch(`${s}/video-training/sessions/${h.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()}});if(!v.ok)throw new Error("Fehler beim Generieren der Fragen");const d=await v.json();if(!d.success||!d.data?.questions)throw new Error("Fehler beim Generieren der Fragen");c({session:d.data.session,questions:d.data.questions,variables:m,selectedMicrophoneId:o,selectedCameraId:A})}catch(s){console.error("[VIDEO TRAINING] Error starting session:",s),w(s.message)}finally{j(!1)}}},U=t?.input_configuration||[];return e.jsxs("div",{className:"p-6 md:p-8 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(re,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-[14px] bg-brand-gradient flex items-center justify-center",children:e.jsx(Q,{size:28,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:t?.title}),e.jsx("p",{className:"text-sm text-slate-500",children:"Konfiguriere deine Wirkungs-Analyse"})]})]})]}),e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"py-4 px-5 bg-primary/5 rounded-xl border border-primary/20 mb-8 flex items-start gap-3",children:[e.jsx(z,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-sm",children:"So funktioniert es"}),e.jsxs("p",{className:"text-[13px] text-slate-500 leading-relaxed",children:["Die KI generiert ",t?.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),t?.long_description&&e.jsx(I,{as:b.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-sm leading-relaxed text-slate-600 whitespace-pre-wrap",children:be(t.long_description?.replace(/\/n/g,`
`))})]})]})}),e.jsxs(I,{as:b.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(S,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Tipps für dein Video-Training"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:(t?.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((s,a)=>typeof s=="string"?{icon:S,title:`Tipp ${a+1}`,description:s}:{icon:J[s.icon]||J[s.icon?.toLowerCase()]||S,title:s.title||`Tipp ${a+1}`,description:s.text||s.description||""}):ve).map((s,a)=>{const n=s.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-9 h-9 rounded-[10px] bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(n,{className:"w-[18px] h-[18px] text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-[13px] text-slate-500 leading-relaxed",children:s.description})]})]},a)})})]}),e.jsxs(I,{as:b.div,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-6 md:p-7 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-6",children:[e.jsx(te,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Personalisiere dein Training"})]}),U.map(s=>e.jsx(je,{field:s,value:m[s.key],onChange:ae,error:u[s.key]},s.key)),U.length===0&&e.jsx("p",{className:"text-slate-500 text-center py-5",children:"Keine zusätzliche Konfiguration erforderlich."})]}),e.jsxs(I,{as:b.div,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-6 md:p-7 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-6",children:[e.jsx(F,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Kamera & Mikrofon"})]}),e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx(H,{type:"video",devices:q,selectedDeviceId:A,onDeviceChange:_,isLoading:B,error:O,onRefresh:E}),e.jsx(H,{type:"audio",devices:D,selectedDeviceId:o,onDeviceChange:f,isLoading:B,error:W,onRefresh:E})]}),(W||O)&&e.jsxs("p",{className:"text-[13px] text-slate-400 mt-4 flex items-start gap-2",children:[e.jsx(z,{size:16,className:"flex-shrink-0 mt-0.5"}),"Bitte erlaube den Zugriff auf Kamera und Mikrofon in deinen Browser-Einstellungen, um die Geräte nutzen zu können."]})]}),N&&e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 bg-red-50 rounded-xl border border-red-200 mb-6 flex items-center gap-3",children:[e.jsx(L,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm",children:N})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-slate-50 rounded-xl p-5 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[e.jsx(ee,{size:18,className:"text-primary"}),e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:"Training-Details"})]}),e.jsxs("div",{className:"flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Fragen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t?.question_count||5})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:["~",Math.round((t?.time_limit_per_question||120)/60)," Min."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Gesamtdauer"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:["~",Math.round((t?.total_time_limit||900)/60)," Min."]})]})]})]}),e.jsx(fe,{as:b.button,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},onClick:ne,disabled:g,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(me,{size:20}),children:"Video Training starten"}),e.jsx(ge,{isLoading:g,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{Pe as VideoTrainingApp,We as VideoTrainingComplete,Oe as VideoTrainingDashboard,Ge as VideoTrainingSession,Le as VideoTrainingWizard};
