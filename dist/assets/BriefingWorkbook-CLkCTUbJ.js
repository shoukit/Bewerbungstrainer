import{F as q,Q as le,aE as te,s as je,aF as ye,aG as we,aH as Ne,aI as ke,aJ as ve,t as Ce,L as B,u as _e,T as Se,I as ze,X as oe,b as ce,aK as Ee,ah as K,Y as $,aL as Pe,aM as Ae,aN as Be,aO as Ie,g as Le,aP as Me,P as De,aQ as Fe,M as Te,ad as Oe,ag as $e,Z as Ue,aR as Re,aS as Ge,aT as He,i as qe,aU as Je,J as Ke,aA as de,E as Ve,a3 as We,a8 as Qe,e as Ze,V as Ye,a as se,_ as me,R as xe,c as Xe,S as et,z as he,a2 as tt,ax as st,ay as at,a1 as nt,l as rt,at as ue,x as it,U as pe,am as ge,r as be,j as e,m as A,A as O,w as re,$ as lt,y as ae,C as ne,aV as ot,aW as ct,aC as dt,a0 as mt,h as xt}from"./ui-vendor-4RzMPcHM.js";import{a as l}from"./react-vendor-uDOJF2jQ.js";import{u as ht,w as T,n as ut}from"./FeatureInfoButton-DkKoIptM.js";import{u as pt}from"./useMobile-YxjH166V.js";import{C as W,B as H}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const gt={"file-text":q,briefcase:be,banknote:ge,users:pe,user:it,"message-circle":ue,target:rt,award:nt,book:at,clipboard:st,star:tt,lightbulb:he,shield:et,compass:Xe,rocket:xe,calendar:me,sparkles:se,video:Ye,mic:Ze,play:Qe,"check-circle":We,"alert-circle":Ve,"help-circle":de,settings:Ke,home:Je,"trending-up":qe,"bar-chart":He,"pie-chart":Ge,activity:Re,zap:Ue,heart:$e,"thumbs-up":Oe,"message-square":Te,mail:Fe,phone:De,"map-pin":Me,clock:Le,bell:Ie,search:Be,filter:Ae,edit:Pe,trash:$,plus:K,minus:Ee,check:ce,x:oe,info:ze,warning:Se,refresh:_e,loader:B,globe:Ce,link:ve,bookmark:ke,tag:Ne,code:we,database:ye,server:je,pen:te,bot:le},bt={"file-text":q,briefcase:be,banknote:ge,users:pe},ft=(t,s=q)=>gt[t]||s,Lt=t=>bt[t]||q,jt=t=>{if(!t)return[];const s=t.split(`
`),i=[];for(const d of s){const o=d.trim(),a=o.match(/^[\*\-â€¢]\s+(.+)$/),h=o.match(/^\d+[\.\)]\s+(.+)$/);a?i.push(a[1].trim()):h&&i.push(h[1].trim())}return i},yt={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},wt=t=>yt[t]||t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),V=t=>{if(!t)return null;const s=[];let i=t,d=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),a=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),h=i.match(/`([^`]+)`/),p=[{match:o,type:"bold"},{match:a,type:"italic"},{match:h,type:"code"}].filter(f=>f.match);if(p.length===0){s.push(i);break}const g=p.reduce((f,m)=>(f.match?.index??1/0)<(m.match?.index??1/0)?f:m);switch(g.match.index>0&&s.push(i.substring(0,g.match.index)),g.type){case"bold":s.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:g.match[1]},d++));break;case"italic":s.push(e.jsx("em",{className:"italic",children:g.match[1]||g.match[2]},d++));break;case"code":s.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:g.match[1]},d++));break}i=i.substring(g.match.index+g.match[0].length)}return s},fe=({content:t})=>{if(!t)return null;const s=i=>{const d=i.split(`
`),o=[];let a=[],h=null;const p=()=>{a.length>0&&(o.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:a.map((g,f)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:h==="number"?`${f+1}.`:"â€¢"}),V(g)]},f))},`list-${o.length}`)),a=[],h=null)};return d.forEach((g,f)=>{const m=g.trim();if(!m){p();return}if(m.startsWith("- ")||m.startsWith("* ")){h!=="bullet"&&(p(),h="bullet"),a.push(m.substring(2));return}const v=m.match(/^(\d+)\.\s/);if(v){h!=="number"&&(p(),h="number"),a.push(m.substring(v[0].length));return}p(),o.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:V(m)},`p-${f}`))}),p(),o};return e.jsx("div",{children:s(t)})},Nt=({item:t,onRestore:s})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:t.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(mt,{size:12}),"Wiederherstellen"]})]}),kt=({explanation:t,onDelete:s,onAddAsItem:i,onAddActionPoint:d,itemLabel:o})=>{const[a,h]=l.useState(!1),p=jt(t.answer),g=()=>{if(t.quick_action)switch(t.quick_action){case"explain":return"ðŸ’¡ ErklÃ¤rung";case"examples":return"ðŸ“ Beispiele";case"howto":return"ðŸš€ Umsetzung";default:return"Frage"}return`â“ ${t.question}`},f=t.answer?.length>100?t.answer.substring(0,100)+"...":t.answer;return e.jsxs("div",{className:"bg-white rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>h(!a),className:"w-full px-3 py-2.5 bg-transparent border-none cursor-pointer flex items-center gap-2 text-left hover:bg-amber-50/50 transition-colors",children:[e.jsx(xt,{size:14,className:`text-amber-600 transition-transform flex-shrink-0 ${a?"rotate-90":""}`}),e.jsx("span",{className:"text-[12px] font-medium text-amber-700 flex-1 truncate",children:g()}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:m=>m.stopPropagation(),children:[i&&e.jsx("button",{onClick:m=>{m.stopPropagation(),i(t.answer,o)},title:"Gesamten Block als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(K,{size:14})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),s(t.id)},title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(oe,{size:14})})]})]}),!a&&e.jsx("div",{className:"px-3 pb-2.5 pt-0",children:e.jsx("p",{className:"text-[12px] text-slate-500 m-0 line-clamp-2",children:f})}),e.jsx(O,{children:a&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 border-t border-amber-100",children:[e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap mt-2.5 leading-relaxed",children:V(t.answer)}),p.length>0&&d&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-100",children:[e.jsxs("p",{className:"text-[11px] font-medium text-amber-700 mb-2 flex items-center gap-1",children:[e.jsx(K,{size:12}),"Einzelne Punkte hinzufÃ¼gen:"]}),e.jsx("div",{className:"space-y-1.5",children:p.map((m,v)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-amber-50/50 rounded-lg hover:bg-amber-100/50 transition-colors group",children:[e.jsx("span",{className:"text-[12px] text-slate-600 flex-1 leading-snug",children:m.length>80?m.substring(0,80)+"...":m}),e.jsx("button",{onClick:()=>d(m),title:"Diesen Punkt zur Liste hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-amber-600 cursor-pointer hover:text-indigo-600 hover:bg-white transition-all opacity-60 group-hover:opacity-100",children:e.jsx(K,{size:14})})]},v))})]})]})})})]})},ie=({item:t,sectionId:s,onUpdateItem:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:a,onAddActionPoint:h})=>{const[p,g]=l.useState(t.user_note||""),[f,m]=l.useState(!1),[v,z]=l.useState(!1),[E,P]=l.useState(!1),[S,_]=l.useState(!!t.user_note),[C,I]=l.useState(!1),[x,U]=l.useState(""),[N,M]=l.useState(!1),[D,R]=l.useState(!0),L=t.ai_explanations||[];l.useEffect(()=>{P(p!==(t.user_note||""))},[p,t.user_note]);const Q=async()=>{m(!0);try{await i(s,t.id,{user_note:p}),z(!0),P(!1),setTimeout(()=>z(!1),2e3)}catch(b){console.error("Error saving note:",b)}finally{m(!1)}},Z=async()=>{try{await i(s,t.id,{deleted:!0})}catch(b){console.error("Error deleting item:",b)}},Y=async()=>{try{await i(s,t.id,{deleted:!1})}catch(b){console.error("Error restoring item:",b)}},G=async b=>{if(d){M(!0);try{await d(s,t.id,{quick_action:b}),R(!0)}catch(n){console.error("Error asking AI:",n)}finally{M(!1)}}},J=async()=>{if(!(!d||!x.trim())){M(!0);try{await d(s,t.id,{question:x.trim()}),U(""),R(!0)}catch(b){console.error("Error asking AI:",b)}finally{M(!1)}}},X=async b=>{if(o)try{await o(s,t.id,b)}catch(n){console.error("Error deleting explanation:",n)}};return t.deleted?e.jsx(Nt,{item:t,onRestore:Y}):e.jsxs(W,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:t.label})]}),t.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:V(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[L.length>0&&!C&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[L.length," KI"]}),t.user_note&&!S&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{I(!C),C||_(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${C?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(ue,{size:16})}),e.jsx("button",{onClick:()=>{_(!S),S||I(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${S?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:Z,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx($,{size:16})})]})]}),C&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>G("explain"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(de,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>G("examples"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(ot,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>G("howto"),disabled:N,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(xe,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:b=>U(b.target.value),onKeyDown:b=>b.key==="Enter"&&!N&&J(),placeholder:"Oder stelle eine eigene Frage...",disabled:N,className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx(H,{variant:"primary",size:"sm",onClick:J,disabled:N||!x.trim(),icon:N?e.jsx(B,{size:14,className:"animate-spin"}):e.jsx(ct,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),N&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(B,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),L.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>R(!D),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[D?e.jsx(ae,{size:14}):e.jsx(ne,{size:14}),"KI-ErklÃ¤rungen (",L.length,")"]}),D&&e.jsx("div",{className:"space-y-2",children:L.map(b=>e.jsx(kt,{explanation:b,itemLabel:t.label,onDelete:X,onAddAsItem:a?(n,r)=>a(s,n,r):null,onAddActionPoint:h?n=>h(s,n,t.label):null},b.id))})]})]}),S&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:p,onChange:b=>g(b.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(H,{variant:"secondary",size:"sm",onClick:()=>{_(!1),g(t.user_note||"")},children:"Abbrechen"}),e.jsx(H,{variant:v?"secondary":"primary",size:"sm",onClick:Q,disabled:f||!E,icon:f?e.jsx(B,{size:12,className:"animate-spin"}):v?e.jsx(ce,{size:12}):e.jsx(dt,{size:12}),className:v?"bg-green-100 text-green-700 border-green-200":"",children:v?"Gespeichert!":"Speichern"})]})]})]})},vt=({onClick:t,isGenerating:s})=>e.jsx("button",{onClick:t,disabled:s,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16}),"5 weitere Punkte generieren"]})}),Ct=({section:t,onUpdateItem:s,onGenerateMore:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:a,onAddActionPoint:h,isExpanded:p,onToggle:g})=>{const[f,m]=l.useState(!1),v=async()=>{m(!0);try{await i(t.id)}catch(x){console.error("Error generating more items:",x)}finally{m(!1)}},z=l.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const x=JSON.parse(t.ai_content);if(x&&Array.isArray(x.items))return{type:"items",items:x.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:E,items:P,content:S}=z(),_=P.filter(x=>!x.deleted),C=P.filter(x=>x.deleted),I=P.some(x=>x.user_note&&!x.deleted);return e.jsxs(W,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:g,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${p?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:t.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[E==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[_.length," Punkte"]}),I&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(te,{size:12}),"Notizen"]}),p?e.jsx(ae,{size:20,className:"text-slate-400"}):e.jsx(ne,{size:20,className:"text-slate-400"})]})]}),p&&e.jsx("div",{className:"px-5 py-4",children:E==="items"?e.jsxs(e.Fragment,{children:[_.map(x=>e.jsx(ie,{item:x,sectionId:t.id,onUpdateItem:s,onAskItem:d,onDeleteExplanation:o,onAddAsItem:a,onAddActionPoint:h},x.id)),i&&e.jsx(vt,{onClick:v,isGenerating:f}),C.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx($,{size:12}),C.length," gelÃ¶schte ",C.length===1?"Punkt":"Punkte"]}),C.map(x=>e.jsx(ie,{item:x,sectionId:t.id,onUpdateItem:s,onAskItem:d,onDeleteExplanation:o,onAddAsItem:a,onAddActionPoint:h},x.id))]})]}):E==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(le,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(fe,{content:S})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},ee=({onClick:t,disabled:s,loading:i,icon:d,danger:o,title:a})=>e.jsx("button",{onClick:t,disabled:s,title:a,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${o?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:i?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx(d,{size:16})}),_t=({variables:t,isExpanded:s,onToggle:i})=>!t||Object.keys(t).length===0?null:e.jsxs(W,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:i,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(t).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:s?"Einklappen":"Ausklappen"}),s?e.jsx(ae,{size:16}):e.jsx(ne,{size:16})]})]}),s&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(t).map(([d,o])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[wt(d),":"]})," ",o]},d))})]}),St=({isOpen:t,onClose:s,onConfirm:i,isDeleting:d})=>e.jsx(O,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx($,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(H,{variant:"secondary",onClick:s,disabled:d,fullWidth:!0,children:"Abbrechen"}),e.jsx(H,{variant:"danger",onClick:i,disabled:d,icon:d?e.jsx(B,{size:16,className:"animate-spin"}):e.jsx($,{size:16}),fullWidth:!0,children:d?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),Mt=({briefing:t,onBack:s,onDelete:i})=>{const{config:d}=ht(),o=pt(),[a,h]=l.useState(t),[p,g]=l.useState(!t?.sections),[f,m]=l.useState(null),[v,z]=l.useState({}),[E,P]=l.useState(!1),[S,_]=l.useState(!1),[C,I]=l.useState(!1),[x,U]=l.useState(!1),[N,M]=l.useState(!1);l.useRef(null);const D=ft(a?.template_icon)||q;l.useEffect(()=>{const n=()=>{const r=window.scrollY||document.documentElement.scrollTop;M(r>80)};return window.addEventListener("scroll",n,{passive:!0}),()=>window.removeEventListener("scroll",n)},[]),l.useEffect(()=>{const n=async()=>{if(a?.sections){const r={};a.sections.forEach(y=>{r[y.id]=!0}),z(r),g(!1);return}try{g(!0);const r=await T.request(`/smartbriefing/briefings/${a.id}`,{method:"GET"});if(r.success&&r.data?.briefing){h(r.data.briefing);const y={};r.data.briefing.sections?.forEach(w=>{y[w.id]=!0}),z(y)}else throw new Error("Fehler beim Laden des Briefings")}catch(r){console.error("[SmartBriefing] Error fetching briefing:",r),m(r.message)}finally{g(!1)}};a?.id&&n()},[a?.id]);const R=l.useCallback(n=>{z(r=>({...r,[n]:!r[n]}))},[]),L=l.useCallback(async(n,r,y)=>{const w=await T.request(`/smartbriefing/sections/${n}/items/${r}`,{method:"PATCH",body:JSON.stringify(y)});if(!w.success)throw new Error("Fehler beim Speichern");h(j=>({...j,sections:j.sections.map(c=>c.id===n?w.data.section:c)}))},[]),Q=l.useCallback(async n=>{const r=await T.request(`/smartbriefing/sections/${n}/generate-more`,{method:"POST"});if(!r.success)throw new Error(r.message||"Fehler beim Generieren");return h(y=>({...y,sections:y.sections.map(w=>w.id===n?r.data.section:w)})),r.data.new_items_count},[]),Z=l.useCallback(async(n,r,y)=>{const w=await T.askBriefingItem(n,r,y);return h(j=>({...j,sections:j.sections.map(c=>{if(c.id!==n)return c;let u;try{u=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),c}if(!u?.items)return c;const k=u.items.map(F=>F.id===r?w.item:F);return{...c,ai_content:JSON.stringify({...u,items:k})}})})),w},[]),Y=l.useCallback(async(n,r,y)=>{await T.deleteBriefingItemExplanation(n,r,y),h(w=>({...w,sections:w.sections.map(j=>{if(j.id!==n)return j;let c;try{c=typeof j.ai_content=="string"?JSON.parse(j.ai_content):j.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),j}if(!c?.items)return j;const u=c.items.map(k=>k.id!==r?k:{...k,ai_explanations:(k.ai_explanations||[]).filter(F=>F.id!==y)});return{...j,ai_content:JSON.stringify({...c,items:u})}})}))},[]),G=l.useCallback(async(n,r,y)=>{const w=`Vertiefung: ${y}`,j=r.length>200?r.substring(0,200)+"...":r;h(c=>({...c,sections:c.sections.map(u=>{if(u.id!==n)return u;let k;try{k=typeof u.ai_content=="string"?JSON.parse(u.ai_content):u.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),u}if(!k?.items)return u;const F={id:crypto.randomUUID(),label:w,content:j,user_note:`VollstÃ¤ndige KI-Antwort:

${r}`,deleted:!1,ai_explanations:[]};return{...u,ai_content:JSON.stringify({...k,items:[...k.items,F]})}})}))},[]),J=l.useCallback((n,r,y)=>{const w=r.length>60?r.substring(0,60)+"...":r;h(j=>({...j,sections:j.sections.map(c=>{if(c.id!==n)return c;let u;try{u=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),c}if(!u?.items)return c;const k={id:crypto.randomUUID(),label:w,content:r,user_note:"",deleted:!1,ai_explanations:[]};return{...c,ai_content:JSON.stringify({...u,items:[...u.items,k]})}})}))},[]),X=l.useCallback(async()=>{if(!(x||!a?.id)){U(!0);try{const n=await T.request(`/smartbriefing/briefings/${a.id}/pdf`,{method:"GET"});if(!n.success||!n.data?.pdf_base64)throw new Error(n.message||"PDF-Export fehlgeschlagen");const r=atob(n.data.pdf_base64),y=new Array(r.length);for(let k=0;k<r.length;k++)y[k]=r.charCodeAt(k);const w=new Uint8Array(y),j=new Blob([w],{type:"application/pdf"}),c=window.URL.createObjectURL(j),u=document.createElement("a");u.href=c,u.download=n.data.filename||"Smart-Briefing.pdf",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(c)}catch(n){console.error("[SmartBriefing] PDF download error:",n)}finally{U(!1)}}},[a?.id,x]),b=async()=>{if(!(!i||!a?.id)){I(!0);try{await i(a)}catch(n){console.error("Failed to delete briefing:",n)}finally{I(!1),_(!1)}}};return a?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(A.div,{className:"sticky top-0 z-40 transition-all duration-300",style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},animate:{paddingTop:N?o?"8px":"10px":o?"20px":"24px",paddingBottom:N?o?"8px":"10px":o?"20px":"24px"},transition:{duration:.2},children:e.jsxs("div",{className:`max-w-[1400px] mx-auto ${o?"px-4":"px-8"}`,children:[e.jsx(O,{children:s&&!N&&e.jsxs(A.button,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},onClick:s,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(re,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]})}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[e.jsx(O,{children:!o&&!N&&e.jsx(A.div,{initial:{opacity:0,scale:.8,width:0},animate:{opacity:1,scale:1,width:"90px"},exit:{opacity:0,scale:.8,width:0},className:"h-[90px] rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(D,{size:40,className:"text-white"})})}),!o&&N&&e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(D,{size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(O,{children:!N&&e.jsxs(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:a.template_title})]})}),e.jsx("h1",{className:`font-bold text-white m-0 truncate transition-all duration-200 ${N?"text-base md:text-lg mb-0":o?"text-xl mb-2":"text-2xl mb-2"}`,children:a.title||"Briefing"}),e.jsx(O,{children:!N&&e.jsx(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(me,{size:14}),ut(a.created_at)]})})})]}),e.jsxs("div",{className:"flex gap-2 md:gap-2.5 flex-shrink-0",children:[s&&N&&e.jsx(ee,{onClick:s,icon:re,title:"ZurÃ¼ck zur Ãœbersicht"}),e.jsx(ee,{onClick:X,disabled:x,loading:x,icon:lt,title:"Als PDF herunterladen"}),i&&e.jsx(ee,{onClick:()=>_(!0),icon:$,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${o?"p-4":"px-8 py-6"}`,children:[e.jsx(_t,{variables:a.variables,isExpanded:E,onToggle:()=>P(!E)}),p&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(B,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),f&&!p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:f})}),!p&&!f&&a.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(se,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[a.sections.length," Abschnitte"]})]}),a.sections.map(n=>e.jsx(Ct,{section:n,onUpdateItem:L,onGenerateMore:Q,onAskItem:Z,onDeleteExplanation:Y,onAddAsItem:G,onAddActionPoint:J,isExpanded:v[n.id],onToggle:()=>R(n.id)},n.id))]}),!p&&!f&&(!a.sections||a.sections.length===0)&&a.content_markdown&&e.jsx(W,{className:"p-6",children:e.jsx(fe,{content:a.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(St,{isOpen:S,onClose:()=>_(!1),onConfirm:b,isDeleting:C})]}):null};export{Mt as B,ft as a,Lt as g};
