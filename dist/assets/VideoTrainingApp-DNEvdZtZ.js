import{j as e,l as Oe,I as me,a1 as ge,k as nt,z as se,X as pe,V as D,T as Pe,ao as st,R as rt,B as We,w as he,q as it,b as fe,a as at,aj as ot,p as lt,ai as ct,v as $e,o as dt,E as ze,ap as Ee,i as Be,h as ue,n as Re,m as z,aq as xt,t as Ge,y as be,A as He,ak as pt,a0 as Ke,a8 as Te,M as ut,a9 as mt,e as gt}from"./ui-vendor-B9DEMv6g.js";import{a as s}from"./react-vendor-uDOJF2jQ.js";import{C as m,u as X,h as ht,F as ft,g as ye,c as Q,D as xe,i as bt}from"./FeatureInfoButton-DsfjgKw4.js";import{S as yt}from"./ScenarioDashboard-Db_QZFbt.js";import{D as jt}from"./DeviceSetupPage-DrPY-0u7.js";import{F as St}from"./fullscreen-loader-CGHRnDJu.js";import{u as vt}from"./useMobile-YxjH166V.js";import{D as wt}from"./DeviceSettingsDialog-CMTdWkBo.js";import{A as De}from"./MicrophoneTestDialog-BLXXwYm5.js";import{P as kt}from"./progress-bar-B3p3lDN6.js";import{B as q,C as Ct}from"./Button-BHvYxNT_.js";import"./select-native-BMh_kGEB.js";import"./dialog-Dg1K-ctH.js";const Fe={error:{bg:m.red[50],border:m.red[200],text:m.red[600],icon:se},warning:{bg:m.amber[50],border:m.amber[200],text:m.amber[600],icon:nt},success:{bg:m.green[50],border:m.green[200],text:m.green[600],icon:ge},info:{bg:m.blue[50],border:m.blue[200],text:m.blue[500],icon:me},loading:{bg:m.blue[50],border:m.blue[200],text:m.blue[500],icon:Oe}},It=({variant:t="info",message:n,children:r,isToast:o=!1,onDismiss:g,className:l="",style:c={}})=>{const a=Fe[t]||Fe.info,p=a.icon,u=t==="loading",d={display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"12px",backgroundColor:a.bg,border:`1px solid ${a.border}`,color:a.text,fontSize:"14px",fontWeight:500,...o&&{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:1e3,maxWidth:"90%"},...c};return e.jsxs("div",{style:d,className:l,children:[e.jsx(p,{size:20,style:{flexShrink:0,...u&&{animation:"spin 1s linear infinite"}},className:u?"animate-spin":""}),e.jsx("span",{style:{flex:1},children:r||n}),g&&e.jsx("button",{onClick:g,style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:a.text,opacity:.7,display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Schließen",children:e.jsx(pe,{size:16})})]})},At=({message:t,onDismiss:n,...r})=>e.jsx(It,{variant:"error",message:t,isToast:!0,onDismiss:n,...r}),Nt={video:D,user:he,briefcase:We,presentation:ct,mic:lt,target:Pe,banknote:ot},zt={self_presentation:{label:"Selbstpräsentation",icon:he,color:"#3A7FA7",bgColor:"#E8F4F8"},interview:{label:"Bewerbungsgespräch",icon:We,color:"#059669",bgColor:"#d1fae5"},pitch:{label:"Elevator Pitch",icon:rt,color:"#7c3aed",bgColor:"#ede9fe"},negotiation:{label:"Verhandlung",icon:st,color:"#d97706",bgColor:"#fef3c7"},custom:{label:"Training",icon:Pe,color:"#64748b",bgColor:"#f1f5f9"}},Et=async()=>{const t=await fetch(`${ye()}/video-training/scenarios`,{headers:{"X-WP-Nonce":Q()}});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const n=await t.json();if(n.success&&n.data?.scenarios)return n.data.scenarios;throw new Error("Ungültige Antwort vom Server")},Bt=t=>Nt[t.icon]||D,Rt=t=>[{text:`${t.question_count} Fragen`},{icon:fe,text:`~${Math.round(t.total_time_limit/60)} Min.`}],Tt=t=>e.jsx("div",{style:{marginTop:"40px",padding:"20px",background:`linear-gradient(135deg, ${t}10 0%, ${t}05 100%)`,borderRadius:"12px",border:`1px solid ${t}20`},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx(at,{size:20,color:t,style:{flexShrink:0,marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{style:{fontWeight:600,color:"#0f172a",marginBottom:"4px"},children:"Wie funktioniert das Video Training?"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,margin:0},children:["1. Wähle ein Szenario und konfiguriere dein Training",e.jsx("br",{}),"2. Beantworte die generierten Fragen per Video-Aufnahme",e.jsx("br",{}),"3. Die KI analysiert dein Video und gibt detailliertes Feedback zu Auftreten, Körpersprache und Kommunikation"]})]})]})}),Ve=({onSelectScenario:t,isAuthenticated:n,requireAuth:r,setPendingScenario:o,onNavigateToHistory:g})=>{const{branding:l}=X(),c=l?.primaryAccent||l?.["--primary-accent"]||"#3A7FA7";return e.jsxs(e.Fragment,{children:[e.jsx(ht,{featureId:"videotraining",showOnMount:!0}),e.jsx(yt,{title:"Wirkungs-Analyse",subtitle:"Video-Feedback zu Auftreten und Kommunikation",headerIcon:D,headerActions:e.jsx(ft,{featureId:"videotraining",size:"sm"}),fetchScenarios:Et,moduleKey:"video_training",historyButtonLabel:"Meine Wirkungs-Analysen",onNavigateToHistory:g,onSelectScenario:t,renderCardMeta:Rt,getIconForScenario:Bt,cardActionLabel:"Starten",cardActionIcon:it,categoryField:"scenario_type",customCategoryConfig:zt,emptyStateIcon:D,emptyStateTitle:"Keine Szenarien verfügbar",searchPlaceholder:"Szenarien durchsuchen...",renderInfoBox:()=>Tt(c),isAuthenticated:n,requireAuth:r,setPendingScenario:o,loadingMessage:"Szenarien werden geladen..."})]})},Dt=({field:t,value:n,onChange:r,error:o,focusColor:g})=>{const l=g||"#4a9ec9",c={width:"100%",padding:"12px 16px",borderRadius:"12px",border:`2px solid ${o?m.red[500]:m.slate[200]}`,fontSize:"16px",color:m.slate[900],backgroundColor:"white",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},a={borderColor:l,boxShadow:`0 0 0 3px ${l}1a`},p=x=>{Object.assign(x.target.style,a),setTimeout(()=>{const f=x.target;if(f){const S=f.closest("div");S&&S.scrollIntoView({behavior:"smooth",block:"center"})}},300)},u=x=>{x.target.style.borderColor=o?m.red[500]:m.slate[200],x.target.style.boxShadow="none"},d=()=>{switch(t.type){case"text":return e.jsx("input",{type:"text",value:n||"",onChange:x=>r(t.key,x.target.value),placeholder:t.placeholder||"",style:c,onFocus:p,onBlur:u});case"textarea":return e.jsx("textarea",{value:n||"",onChange:x=>r(t.key,x.target.value),placeholder:t.placeholder||"",rows:4,style:{...c,resize:"vertical",minHeight:"100px"},onFocus:p,onBlur:u});case"select":return e.jsxs("select",{value:n||t.default||"",onChange:x=>r(t.key,x.target.value),style:{...c,cursor:"pointer",appearance:"none",backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px",paddingRight:"44px"},onFocus:p,onBlur:u,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte wählen..."}),t.options?.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]});case"number":return e.jsx("input",{type:"number",value:n||"",onChange:x=>r(t.key,x.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,style:c,onFocus:p,onBlur:u});default:return e.jsx("input",{type:"text",value:n||"",onChange:x=>r(t.key,x.target.value),placeholder:t.placeholder||"",style:c,onFocus:p,onBlur:u})}};return e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:600,color:m.slate[700]},children:[t.label,t.required&&e.jsx("span",{style:{color:m.red[500],marginLeft:"4px"},children:"*"})]}),d(),o&&e.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:m.red[500],display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(se,{style:{width:"14px",height:"14px"}}),o]}),t.hint&&!o&&e.jsxs("p",{style:{marginTop:"6px",fontSize:"13px",color:m.slate[500],display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(me,{style:{width:"14px",height:"14px"}}),t.hint]})]})},Ft=({scenario:t,onBack:n,onNext:r})=>{const[o,g]=s.useState({}),[l,c]=s.useState({}),{branding:a}=X(),p=a?.["--header-gradient"]||xe["--header-gradient"],u=a?.["--button-gradient"]||p,d=a?.["--primary-accent"]||xe["--primary-accent"],x=a?.["--primary-accent-light"]||xe["--primary-accent-light"],f=s.useMemo(()=>{if(!t?.input_configuration)return[];try{return(Array.isArray(t.input_configuration)?t.input_configuration:[]).filter(b=>b.user_input!==!1)}catch(i){return console.error("Error parsing input_configuration:",i),[]}},[t?.input_configuration]);s.useEffect(()=>{const i={};f.forEach(b=>{b.default&&(i[b.key]=b.default)}),g(i)},[f]);const S=(i,b)=>{g(y=>({...y,[i]:b})),l[i]&&c(y=>{const v={...y};return delete v[i],v})},k=()=>{const i={};return f.forEach(b=>{const y=o[b.key];if(b.required&&(!y||typeof y=="string"&&y.trim()==="")){i[b.key]="Dieses Feld ist erforderlich";return}if(!(!y||typeof y=="string"&&y.trim()==="")&&b.validation){const{minLength:v,maxLength:w,min:R,max:N,pattern:T}=b.validation;v&&y.length<v&&(i[b.key]=`Mindestens ${v} Zeichen erforderlich`),w&&y.length>w&&(i[b.key]=`Maximal ${w} Zeichen erlaubt`),R!==void 0&&Number(y)<R&&(i[b.key]=`Mindestens ${R}`),N!==void 0&&Number(y)>N&&(i[b.key]=`Maximal ${N}`),T&&!new RegExp(T).test(y)&&(i[b.key]="Ungültiges Format")}}),c(i),Object.keys(i).length===0},E=i=>{i.preventDefault(),k()&&r(o)};return s.useEffect(()=>{f.length===0&&r({})},[f,r]),f.length===0?null:e.jsxs("div",{style:{padding:"24px",paddingBottom:"200px",maxWidth:"640px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("button",{onClick:n,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:"transparent",color:m.slate[600],fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:i=>i.target.style.background=m.slate[100],onMouseLeave:i=>i.target.style.background="transparent",children:[e.jsx($e,{style:{width:"18px",height:"18px"}}),"Zurück zur Übersicht"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:p,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(D,{style:{width:"28px",height:"28px",color:"white"}})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:m.slate[900],margin:0},children:t.title}),e.jsx("p",{style:{fontSize:"14px",color:m.slate[600],margin:"4px 0 0 0"},children:"Personalisiere dein Training"})]})]})]}),t.description&&e.jsx("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:m.slate[100],marginBottom:"24px"},children:e.jsx("p",{style:{fontSize:"14px",color:m.slate[700],margin:0,lineHeight:1.6},children:t.description})}),e.jsxs("div",{style:{padding:"16px 20px",borderRadius:"12px",backgroundColor:x,marginBottom:"24px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx(me,{style:{width:"20px",height:"20px",color:d,flexShrink:0,marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:600,color:m.slate[900],margin:"0 0 4px 0"},children:"So funktioniert es"}),e.jsxs("p",{style:{fontSize:"13px",color:m.slate[600],margin:0,lineHeight:1.5},children:["Die KI generiert ",t.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),e.jsxs("form",{onSubmit:E,children:[f.map(i=>e.jsx(Dt,{field:i,value:o[i.key],onChange:S,error:l[i.key],focusColor:d},i.key)),e.jsxs("button",{type:"submit",style:{width:"100%",padding:"16px 24px",borderRadius:"14px",border:"none",background:u,color:"white",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:`0 4px 12px ${d}4d`,marginTop:"24px"},onMouseEnter:i=>{i.target.style.transform="translateY(-2px)",i.target.style.boxShadow=`0 6px 16px ${d}66`},onMouseLeave:i=>{i.target.style.transform="none",i.target.style.boxShadow=`0 4px 12px ${d}4d`},children:["Weiter",e.jsx(dt,{style:{width:"20px",height:"20px"}})]})]})]})},Vt=()=>{const[t,n]=s.useState(!1),[r,o]=s.useState(null),{demoCode:g}=X(),l=s.useCallback(async(a,p,u)=>{o(null),n(!0);try{const d=await a();p(d)}catch(d){console.error("[useSessionStartup] Error:",d);const x=d.message||"Ein Fehler ist aufgetreten";o(x),n(!1),u?.(d)}},[]),c=s.useCallback(()=>{o(null)},[]);return{isSubmitting:t,submitError:r,demoCode:g,startSession:l,clearError:c}},_t=({scenario:t,variables:n,onBack:r,onStart:o})=>{const{isSubmitting:g,submitError:l,demoCode:c,startSession:a,clearError:p}=Vt(),u=async({selectedMicrophoneId:d,selectedCameraId:x})=>{await a(async()=>{const f=ye(),S=await fetch(`${f}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Q()},body:JSON.stringify({scenario_id:t.id,variables:n,demo_code:c||null})});if(!S.ok){const v=await S.json().catch(()=>({}));throw new Error(v.message||"Fehler beim Erstellen der Session")}const k=await S.json(),E=k.data?.session||k.session;if(!E)throw new Error("Keine Session-ID erhalten");const i=await fetch(`${f}/video-training/sessions/${E.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Q()},body:JSON.stringify({variables:n})});if(!i.ok){const v=await i.json().catch(()=>({}));throw new Error(v.message||"Fehler beim Generieren der Fragen")}const b=await i.json(),y=b.data?.questions||b.questions||[];return{session:{...E,questions:y},questions:y,scenario:t,variables:n,selectedMicrophoneId:d,selectedCameraId:x}},o)};return e.jsxs(e.Fragment,{children:[e.jsx(jt,{mode:"audio-video",scenario:t,onBack:r,onStart:u,title:t?.title,startButtonLabel:"Video-Training starten",icon:D}),l&&e.jsx(At,{message:l,onDismiss:p}),e.jsx(St,{isLoading:g,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})},Mt=({tips:t,primaryAccent:n})=>{const[r,o]=s.useState(!1);return!t||t.length===0?null:e.jsxs("div",{className:"mt-4 rounded-xl border overflow-hidden bg-primary-light/50 border-primary/10",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full px-4 py-3.5 bg-transparent border-none cursor-pointer flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx(be,{size:18,className:"text-primary"}),"Tipps für diese Frage"]}),e.jsx(ue,{size:18,className:`text-slate-500 transition-transform duration-200 ${r?"rotate-90":""}`})]}),e.jsx(He,{children:r&&e.jsx(z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-4 pb-4",children:e.jsx("ul",{className:"m-0 pl-5 list-disc",children:t.map((g,l)=>e.jsx("li",{className:"text-sm text-slate-500 mb-2 leading-relaxed",children:g},l))})})})})]})},Lt=({number:t,size:n="md"})=>{const r={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${r[n]} rounded-full bg-brand-gradient flex-center text-white font-semibold flex-shrink-0`,children:t})},_e=({question:t,index:n,scenario:r,isMobile:o})=>e.jsxs(Ct,{className:o?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(Lt,{number:n+1,size:o?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||"Frage"})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${o?"text-[15px]":"text-lg"} mb-0`,children:t?.question||"Frage wird geladen..."}),t?.estimated_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(fe,{size:o?14:16}),"Empfohlene Antwortzeit: ~",Math.round(t.estimated_time/60)," Min."]}),r?.enable_tips&&t?.tips&&e.jsx(Mt,{tips:t.tips})]}),Me=({time:t,isRecording:n})=>e.jsxs("div",{className:"absolute top-3 md:top-4 left-3 md:left-4 flex items-center gap-1.5 md:gap-2 bg-black/60 px-3 py-1.5 rounded-lg",children:[n?e.jsx("div",{className:"w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-red-500 animate-pulse"}):e.jsx(fe,{size:14,className:"text-white"}),e.jsx("span",{className:"text-white text-[13px] md:text-sm font-medium",children:bt(t)})]}),Le=({error:t,onRetry:n})=>e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white p-4 md:p-5 text-center",children:[e.jsx(xt,{size:40,className:"mb-3 md:mb-4 opacity-60"}),e.jsx("p",{className:"mb-3 md:mb-4 text-sm md:text-base",children:t}),e.jsx(q,{onClick:n,icon:e.jsx(Ge,{size:16}),children:"Erneut versuchen"})]}),Ot=({isUploading:t,isAnalyzing:n})=>e.jsx("div",{className:"fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 flex items-center justify-center p-4",children:e.jsxs(z.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl p-12 shadow-xl max-w-[500px] w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary-light flex-center mx-auto mb-6",children:e.jsx(Oe,{size:40,className:"text-primary animate-spin"})}),e.jsx("h2",{className:"text-xl md:text-[22px] font-bold text-slate-900 mb-3",children:t?"Video wird hochgeladen...":"KI analysiert dein Video..."}),e.jsx("p",{className:"text-slate-500 text-[15px] leading-relaxed",children:t?"Dein Video wird sicher übertragen. Dies kann je nach Dateigröße einen Moment dauern.":"Die KI analysiert dein Auftreten, deine Körpersprache und Kommunikation. Das dauert etwa 30-60 Sekunden."})]})}),Pt=({session:t,questions:n,scenario:r,variables:o,onComplete:g,onExit:l,selectedMicrophoneId:c,selectedCameraId:a})=>{const[p,u]=s.useState(0),[d,x]=s.useState(!1),[f,S]=s.useState(!1),[k,E]=s.useState(0),[i,b]=s.useState([]),[y,v]=s.useState([]),[w,R]=s.useState(null),[N,T]=s.useState(null),[W,F]=s.useState(!1),[Z,J]=s.useState(!1),[Y,M]=s.useState(null),[$,re]=s.useState(c||null),[G,I]=s.useState(a||null),[Ue,ie]=s.useState(!1),[je,Se]=s.useState(0),H=vt(),ee=s.useRef(null),ae=s.useRef(null),L=s.useRef(null),K=s.useRef(null),oe=s.useRef(null),O=s.useRef(null),{branding:qe}=X(),le=qe?.["--primary-accent"],ve=n[p];s.useEffect(()=>(P(),()=>{ce(),L.current&&clearInterval(L.current),O.current&&cancelAnimationFrame(O.current),K.current&&K.current.close()}),[]);const Qe=h=>{try{K.current&&K.current.close();const A=new(window.AudioContext||window.webkitAudioContext);K.current=A;const j=A.createAnalyser();j.fftSize=256,j.smoothingTimeConstant=.8,oe.current=j,A.createMediaStreamSource(h).connect(j);const V=new Uint8Array(j.frequencyBinCount),_=()=>{if(!oe.current)return;oe.current.getByteFrequencyData(V);const de=V.reduce((et,tt)=>et+tt,0)/V.length;Se(de/255),O.current=requestAnimationFrame(_)};_()}catch(A){console.error("[VIDEO TRAINING] Audio analysis error:",A)}},Xe=()=>{O.current&&(cancelAnimationFrame(O.current),O.current=null),Se(0)},P=async(h=$,A=G)=>{try{T(null),w&&w.getTracks().forEach(_=>_.stop());const j=A?{deviceId:{exact:A},width:{ideal:1280},height:{ideal:720}}:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},B=h?{deviceId:{exact:h}}:!0,V=await navigator.mediaDevices.getUserMedia({video:j,audio:B});R(V),ee.current&&(ee.current.srcObject=V)}catch(j){console.error("[VIDEO TRAINING] Camera error:",j),T("Kamera konnte nicht gestartet werden. Bitte erlaube den Zugriff auf Kamera und Mikrofon.")}},Ze=h=>{re(h),d||P(h,G)},Je=h=>{I(h),d||P($,h)},ce=()=>{w&&(w.getTracks().forEach(h=>h.stop()),R(null))},we=()=>{if(!w){P();return}try{const h=new MediaRecorder(w,{mimeType:"video/webm;codecs=vp9,opus"});ae.current=h;const A=[];h.ondataavailable=j=>{j.data.size>0&&(A.push(j.data),b(B=>[...B,j.data]))},h.onstop=()=>{},h.start(1e3),x(!0),S(!1),Qe(w),v(j=>[...j,{question_index:p,start_time:k}]),L.current=setInterval(()=>{E(j=>j+1)},1e3)}catch(h){console.error("[VIDEO TRAINING] Recording error:",h),M("Fehler beim Starten der Aufnahme")}},te=()=>{ae.current&&d&&(ae.current.stop(),x(!1),Xe(),L.current&&(clearInterval(L.current),L.current=null))},ke=()=>{p<n.length-1&&(d&&v(h=>[...h,{question_index:p+1,start_time:k}]),u(h=>h+1))},Ce=()=>{p>0&&u(h=>h-1)},Ie=async()=>{te(),ce(),F(!0),M(null);try{const h=new Blob(i,{type:"video/webm"}),A=ye(),j=new FormData;j.append("video",h,`video_${t.id}.webm`),j.append("video_duration",k.toString()),j.append("timeline",JSON.stringify(y));const B=await fetch(`${A}/video-training/sessions/${t.id}/video`,{method:"POST",headers:{"X-WP-Nonce":Q()},body:j});if(!B.ok){const de=await B.text();throw console.error("[VIDEO TRAINING] Upload failed:",B.status,de),B.status===413?new Error("Das Video ist zu groß zum Hochladen. Bitte versuche eine kürzere Aufnahme."):new Error("Fehler beim Hochladen des Videos. Status: "+B.status)}const V=await B.json();F(!1),J(!0);const _=await fetch(`${A}/video-training/sessions/${t.id}/analyze`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Q()}});if(!_.ok)throw new Error("Fehler bei der Video-Analyse");const U=await _.json();g({session:U.data?.session||t,analysis:U.data?.analysis,categoryScores:U.data?.category_scores,overallScore:U.data?.overall_score})}catch(h){console.error("[VIDEO TRAINING] Upload/Analysis error:",h),M(h.message),F(!1),J(!1)}},Ye=()=>{te(),ce(),l()};if(W||Z)return e.jsx(Ot,{isUploading:W,isAnalyzing:Z});const ne=i.length>0,Ae=r?.enable_navigation&&p>0,Ne=r?.enable_navigation&&p<n.length-1;return e.jsxs("div",{className:`${H?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${H?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${H?"text-lg":"text-xl"} font-semibold text-slate-900`,children:r?.title}),e.jsxs("button",{onClick:Ye,className:`${H?"py-2.5 px-3.5":"py-2 px-4"} rounded-lg bg-slate-100 text-slate-500 text-sm flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(pe,{size:16}),"Abbrechen"]})]}),e.jsx(kt,{current:p,total:n.length,primaryAccent:le,showCompleted:!1}),H?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(_e,{question:ve,index:p,scenario:r,isMobile:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[N?e.jsx(Le,{error:N,onRetry:P}):e.jsx("video",{ref:ee,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(d||k>0)&&e.jsx(Me,{time:k,isRecording:d})]}),d&&e.jsx("div",{className:"mt-4",children:e.jsx(De,{audioLevel:je,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs("div",{className:"flex justify-center gap-2.5",children:[e.jsx("button",{onClick:()=>ie(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),d?e.jsxs("button",{onClick:te,className:"flex-1 py-3.5 px-6 rounded-xl bg-slate-100 text-slate-900 text-[15px] font-semibold flex items-center justify-center gap-2.5",children:[e.jsx(Ee,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:we,disabled:!w,className:`flex-1 py-3.5 px-6 rounded-xl text-white text-[15px] font-semibold flex items-center justify-center gap-2.5 ${w?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex gap-2",children:[Ae&&e.jsx(q,{variant:"secondary",size:"sm",icon:e.jsx(Be,{size:16}),onClick:Ce,className:"flex-1",children:"Zurück"}),Ne&&e.jsx(q,{size:"sm",iconPosition:"right",icon:e.jsx(ue,{size:16}),onClick:ke,className:"flex-1",children:"Nächste"}),e.jsxs("button",{onClick:Ie,disabled:!ne,className:`flex-1 py-2.5 px-3.5 rounded-lg text-white text-[13px] font-semibold flex items-center justify-center gap-1 ${ne?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:16}),"Abschließen"]})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-video",children:[N?e.jsx(Le,{error:N,onRetry:P}):e.jsx("video",{ref:ee,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover scale-x-[-1]"}),(d||k>0)&&e.jsx(Me,{time:k,isRecording:d})]}),d&&e.jsx("div",{className:"mt-5",children:e.jsx(De,{audioLevel:je,isActive:!0,variant:"bars",size:"sm",accentColor:le})}),e.jsxs("div",{className:"flex flex-col gap-4 mt-5",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>ie(!0),className:"p-3.5 rounded-xl bg-slate-100 border border-slate-200 flex-center",children:e.jsx(ze,{size:20,className:"text-slate-500"})}),d?e.jsxs("button",{onClick:te,className:"py-3.5 px-7 rounded-xl bg-slate-100 text-slate-900 text-base font-semibold flex items-center gap-2.5",children:[e.jsx(Ee,{size:20,className:"text-red-500"}),"Aufnahme pausieren"]}):e.jsxs("button",{onClick:we,disabled:!w,className:`py-3.5 px-7 rounded-xl text-white text-base font-semibold flex items-center gap-2.5 ${w?"bg-red-500 shadow-lg shadow-red-500/40":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(D,{size:20}),"Aufnahme starten"]})]}),e.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[Ae&&e.jsx(q,{variant:"secondary",icon:e.jsx(Be,{size:18}),onClick:Ce,children:"Vorherige"}),Ne&&e.jsx(q,{iconPosition:"right",icon:e.jsx(ue,{size:18}),onClick:ke,children:"Nächste"}),e.jsxs("button",{onClick:Ie,disabled:!ne,className:`py-2.5 px-5 rounded-lg text-white text-sm font-semibold flex items-center gap-1.5 ${ne?"bg-green-500 shadow-md shadow-green-500/30":"bg-slate-400 cursor-not-allowed"}`,children:[e.jsx(Re,{size:18}),"Training abschließen"]})]})]})]}),e.jsx(_e,{question:ve,index:p,scenario:r,isMobile:!1})]}),Y&&e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 bg-red-50 rounded-xl border border-red-200 flex items-center gap-3",children:[e.jsx(se,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm flex-1",children:Y}),e.jsx("button",{onClick:()=>M(null),className:"bg-transparent border-none cursor-pointer p-1",children:e.jsx(pe,{size:16,className:"text-red-500"})})]}),e.jsx(wt,{isOpen:Ue,onClose:()=>ie(!1),mode:"audio-video",selectedMicrophoneId:$,onMicrophoneChange:Ze,selectedCameraId:G,onCameraChange:Je})]})},Wt={auftreten:mt,selbstbewusstsein:Te,koerpersprache:he,kommunikation:ut,professionalitaet:Te,inhalt:be},$t=({score:t,size:n=120,strokeWidth:r=10,primaryAccent:o})=>{const g=(n-r)/2,l=g*2*Math.PI,c=l-t/100*l,a=()=>t>=80?"#22c55e":t>=60?o:t>=40?"#f59e0b":"#ef4444";return e.jsxs("div",{style:{position:"relative",width:n,height:n,margin:"0 auto"},children:[e.jsxs("svg",{width:n,height:n,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:n/2,cy:n/2,r:g,fill:"none",stroke:"#e2e8f0",strokeWidth:r}),e.jsx(z.circle,{cx:n/2,cy:n/2,r:g,fill:"none",stroke:a(),strokeWidth:r,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:c},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontSize:n/3,fontWeight:700,color:a()},children:Math.round(t)}),e.jsx("span",{style:{fontSize:n/10,color:"#64748b"},children:"von 100"})]})]})},Gt=({category:t,primaryAccent:n})=>{const[r,o]=s.useState(!1),g=Wt[t.category]||Ke,l=c=>c>=80?"#22c55e":c>=60?n:c>=40?"#f59e0b":"#ef4444";return e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{background:"#fff",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden",marginBottom:"12px"},children:[e.jsxs("button",{onClick:()=>o(!r),style:{width:"100%",padding:"16px",background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:`${l(t.score)}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{size:20,color:l(t.score)})}),e.jsxs("div",{style:{flex:1,textAlign:"left",minWidth:0,overflow:"hidden"},children:[e.jsx("h4",{style:{fontSize:"15px",fontWeight:600,color:"#0f172a",marginBottom:"2px"},children:t.label}),e.jsxs("p",{style:{fontSize:"13px",color:"#64748b",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.feedback?.substring(0,60),"..."]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{fontSize:"20px",fontWeight:700,color:l(t.score)},children:Math.round(t.score)}),e.jsx(gt,{size:20,color:"#64748b",style:{transform:r?"rotate(180deg)":"none",transition:"transform 0.2s"}})]})]}),e.jsx(He,{children:r&&e.jsx(z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #e2e8f0",paddingTop:"16px"},children:[e.jsx("p",{style:{fontSize:"14px",color:"#64748b",lineHeight:1.6,marginBottom:"16px"},children:t.feedback}),t.strengths&&t.strengths.length>0&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#22c55e",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ge,{size:14}),"Stärken"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.strengths.map((c,a)=>e.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:c},a))})]}),t.improvements&&t.improvements.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{style:{fontSize:"13px",fontWeight:600,color:"#f59e0b",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(se,{size:14}),"Verbesserungspotenzial"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:t.improvements.map((c,a)=>e.jsx("li",{style:{fontSize:"13px",color:"#64748b",marginBottom:"4px"},children:c},a))})]})]})})})]})},Ht=({session:t,scenario:n,onBackToDashboard:r,onStartNew:o})=>{const{branding:g}=X(),l=g?.primaryAccent||"#3A7FA7",c=g?.headerGradient||"linear-gradient(135deg, #3A7FA7 0%, #2d6a8a 100%)",a=t?.overall_score||0,p=t?.category_scores||[],u=t?.analysis||{},d=t?.summary_feedback||"",x=f=>f>=90?"Ausgezeichnet!":f>=80?"Sehr gut!":f>=70?"Gut!":f>=60?"Solide Leistung":f>=50?"Ausbaufähig":"Weiter üben!";return e.jsxs("div",{style:{padding:"32px",maxWidth:"900px",margin:"0 auto"},children:[e.jsxs(z.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{textAlign:"center",marginBottom:"40px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:c,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.15)"},children:e.jsx(pt,{size:40,color:"#fff"})}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:700,color:"#0f172a",marginBottom:"8px"},children:"Training abgeschlossen!"}),e.jsxs("p",{style:{fontSize:"16px",color:"#64748b"},children:[n?.title," - Deine Auswertung ist bereit"]})]}),e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},style:{background:"#fff",borderRadius:"20px",padding:"32px",textAlign:"center",border:"1px solid #e2e8f0",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:"24px"},children:[e.jsx($t,{score:a,size:160,primaryAccent:l}),e.jsx("h2",{style:{fontSize:"24px",fontWeight:700,color:"#0f172a",marginTop:"20px",marginBottom:"8px"},children:x(a)}),e.jsx("p",{style:{fontSize:"15px",color:"#64748b",maxWidth:"500px",margin:"0 auto",lineHeight:1.6},children:d||"Deine Video-Analyse wurde erfolgreich abgeschlossen."})]}),p.length>0&&e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ke,{size:20,color:l}),"Detaillierte Bewertung"]}),p.map((f,S)=>e.jsx(Gt,{category:f,primaryAccent:l},f.category||S))]}),u&&(u.key_strengths?.length>0||u.actionable_tips?.length>0)&&e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[u.key_strengths&&u.key_strengths.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#22c55e",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ge,{size:18}),"Deine Stärken"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:u.key_strengths.map((f,S)=>e.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:f},S))})]}),u.actionable_tips&&u.actionable_tips.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:l,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(be,{size:18}),"Tipps zur Verbesserung"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"24px"},children:u.actionable_tips.map((f,S)=>e.jsx("li",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px",lineHeight:1.5},children:f},S))})]})]}),t?.video_url&&e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},style:{background:"#fff",borderRadius:"16px",padding:"24px",border:"1px solid #e2e8f0",marginBottom:"24px"},children:[e.jsxs("h4",{style:{fontSize:"16px",fontWeight:600,color:"#0f172a",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(D,{size:18,color:l}),"Deine Aufnahme"]}),e.jsx("video",{src:t.video_url,controls:!0,style:{width:"100%",maxWidth:"640px",maxHeight:"360px",borderRadius:"12px",background:"#000",objectFit:"contain"}})]}),e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},style:{display:"flex",gap:"16px",justifyContent:"center"},children:[e.jsxs("button",{onClick:r,style:{padding:"14px 28px",borderRadius:"12px",background:"#f1f5f9",color:"#0f172a",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx($e,{size:18}),"Zur Übersicht"]}),e.jsxs("button",{onClick:o,style:{padding:"14px 28px",borderRadius:"12px",background:c,color:"#fff",border:"none",cursor:"pointer",fontSize:"15px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.15)"},children:[e.jsx(Ge,{size:18}),"Nochmal üben"]})]})]})},C={DASHBOARD:"dashboard",VARIABLES:"variables",DEVICE_SETUP:"device_setup",SESSION:"session",COMPLETE:"complete"},an=({isAuthenticated:t,requireAuth:n,setPendingAction:r,pendingScenario:o,clearPendingScenario:g,onNavigateToHistory:l})=>{const[c,a]=s.useState(C.DASHBOARD),[p,u]=s.useState(null),[d,x]=s.useState(null),[f,S]=s.useState([]),[k,E]=s.useState({}),[i,b]=s.useState(null),[y,v]=s.useState(null),[w,R]=s.useState(null),[N,T]=s.useState(null);s.useEffect(()=>{o&&t&&(u(o),a(C.VARIABLES),g&&g())},[o,t,g]),s.useEffect(()=>{N&&t&&(u(N),a(C.VARIABLES),T(null))},[N,t]),s.useEffect(()=>{window.scrollTo(0,0)},[c]);const W=s.useCallback(I=>{u(I),a(C.VARIABLES)},[]),F=s.useCallback(()=>{u(null),x(null),S([]),E({}),b(null),v(null),R(null),a(C.DASHBOARD)},[]),Z=s.useCallback(I=>{E(I),a(C.DEVICE_SETUP)},[]),J=s.useCallback(()=>{a(C.VARIABLES)},[]),Y=s.useCallback(I=>{x(I.session),S(I.questions),E(I.variables),v(I.selectedMicrophoneId),R(I.selectedCameraId),a(C.SESSION)},[]),M=s.useCallback(I=>{b(I.session),a(C.COMPLETE)},[]),$=s.useCallback(()=>{F()},[F]),re=s.useCallback(()=>{x(null),S([]),b(null),v(null),R(null),a(C.VARIABLES)},[]),G=()=>{switch(c){case C.DASHBOARD:return e.jsx(Ve,{onSelectScenario:W,isAuthenticated:t,requireAuth:n,setPendingScenario:T,onNavigateToHistory:l});case C.VARIABLES:return e.jsx(Ft,{scenario:p,onBack:F,onNext:Z});case C.DEVICE_SETUP:return e.jsx(_t,{scenario:p,variables:k,onBack:J,onStart:Y});case C.SESSION:return e.jsx(Pt,{session:d,questions:f,scenario:p,variables:k,onComplete:M,onExit:$,selectedMicrophoneId:y,selectedCameraId:w});case C.COMPLETE:return e.jsx(Ht,{session:i,scenario:p,onBackToDashboard:F,onStartNew:re});default:return e.jsx(Ve,{onSelectScenario:W,isAuthenticated:t,requireAuth:n,setPendingScenario:T,onNavigateToHistory:l})}};return e.jsx("div",{style:{minHeight:"100%"},children:G()})};export{an as V,Ve as a,Pt as b,Ht as c};
