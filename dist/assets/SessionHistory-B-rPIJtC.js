import{j as e,O as q,L as G,z as ge,v as Ns,Q as ke,g as ye,Y as ys,_ as Ke,m as C,V as Ce,M as be,$ as cs,F as vs,a0 as fe,a1 as Re,y as we,C as ws,A as ks,e as He,a2 as Ss,a3 as Is,a4 as Ae,a5 as Ds,a6 as Vs,a7 as Ks,w as As,a8 as os,a9 as qs,h as oe,l as $e,d as _e,aa as ds,ab as xs,c as Ee,ac as Hs,s as Ys,ad as Xs,a as Ye,H as ms,p as hs,t as us,ae as Js}from"./ui-vendor-w3QMwUw1.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{B as X,C as U,S as Me,a as Zs}from"./select-native-a06Ufdzz.js";import{g as ve,a as ce,m as J,l as je,C as R,n as de,I as F,u as Qs,w as Y}from"./FeatureInfoButton-DOlrUowH.js";import{D as et,a as st,b as tt,c as at,d as nt,e as it}from"./dialog-Dl3u2MoA.js";import{b as rt,p as lt,d as ct,e as ot,h as dt,i as xt,j as mt,g as ht}from"./index.js";import{u as Se}from"./useMobile-YxjH166V.js";import{R as ut}from"./RoleplaySessionReport-D1ZbXUsT.js";import{g as pt,B as gt}from"./BriefingWorkbook-i1B4AI_i.js";import{D as ft,a as jt}from"./DecisionBoardResult-BVBdNYLx.js";import{I as bt,a as Nt}from"./IkigaiResults-dwNjj4xn.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";import"./input-BGIQpOO6.js";import"./textarea-DNkfWAYb.js";import"./AudioRecorder-_eG8qG_8.js";import"./button-DCmq61py.js";import"./card-26TC7KQi.js";import"./DeviceSettingsDialog-DFna2PQe.js";import"./DeviceSetupPage-CFOeWoMd.js";import"./MicrophoneTestDialog-DCA5UGAo.js";const xe=({isOpen:s,onClose:a,onConfirm:n,title:p="L√∂schen best√§tigen",description:d="Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:l=!1,confirmLabel:x="L√∂schen",cancelLabel:h="Abbrechen"})=>e.jsx(et,{open:s,onOpenChange:a,children:e.jsxs(st,{className:"max-w-[400px]",children:[e.jsxs(tt,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-white"})}),e.jsx(at,{children:p})]}),e.jsx(nt,{children:d})]}),e.jsxs(it,{className:"mt-4",children:[e.jsx("button",{onClick:a,disabled:l,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg border border-slate-200 bg-white text-slate-900 text-sm font-medium transition-all hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:h}),e.jsx("button",{onClick:n,disabled:l,className:"min-w-[100px] h-10 px-5 py-2 rounded-lg border-none bg-gradient-to-br from-red-500 to-red-600 text-white text-sm font-medium transition-all inline-flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:l?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin"}),x,"..."]}):x})]})]})}),yt={auftreten:qs,selbstbewusstsein:os,koerpersprache:As,kommunikation:be,professionalitaet:os,inhalt:we},vt=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"Weiter √ºben!",wt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",kt=s=>s==="video"?"Wirkungs-Analyse":s==="roleplay"?"Live-Simulation":"Szenario-Training",St=({score:s,size:a=120,isHeader:n=!1})=>{const p=Math.min(100,Math.max(0,s||0)),d=(a-12)/2,l=d*2*Math.PI,x=l-p/100*l,h=J(s);return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:n?"rgba(255,255,255,0.3)":R.slate[200],strokeWidth:10}),e.jsx(C.circle,{cx:a/2,cy:a/2,r:d,fill:"none",stroke:h,strokeWidth:10,strokeLinecap:"round",strokeDasharray:l,initial:{strokeDashoffset:l},animate:{strokeDashoffset:x},transition:{duration:1,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{style:{fontSize:a/3.5,fontWeight:700,color:h},children:Math.round(s)}),e.jsx("span",{className:`${n?"text-white":"text-slate-500"}`,style:{fontSize:a/10},children:"von 100"})]})]})},It=({audioUrl:s,durationHint:a})=>{const n=o.useRef(null),[p,d]=o.useState(!1),[l,x]=o.useState(0),[h,y]=o.useState(a||0),[f,c]=o.useState(!0),[D,w]=o.useState(null);o.useEffect(()=>{if(!s)return;c(!0),w(null),y(a||0);const m=new Audio;n.current=m;const z=()=>{const _=m.duration;_&&isFinite(_)&&_>0&&y(_),c(!1)},T=()=>{const _=m.duration;_&&isFinite(_)&&_>0&&y(_)},I=()=>{c(!1);const _=m.duration;_&&isFinite(_)&&_>0&&y(_)};return m.addEventListener("loadedmetadata",z),m.addEventListener("durationchange",T),m.addEventListener("canplaythrough",I),m.addEventListener("timeupdate",()=>x(m.currentTime)),m.addEventListener("play",()=>d(!0)),m.addEventListener("pause",()=>d(!1)),m.addEventListener("ended",()=>d(!1)),m.addEventListener("error",()=>{w("Audio nicht verf√ºgbar"),c(!1)}),m.src=s,m.load(),()=>{m.pause(),m.removeEventListener("loadedmetadata",z),m.removeEventListener("durationchange",T),m.removeEventListener("canplaythrough",I),m.src=""}},[s,a]);const b=()=>{n.current&&(p?n.current.pause():n.current.play())},k=m=>{const z=m.currentTarget.getBoundingClientRect(),T=(m.clientX-z.left)/z.width;n.current&&(n.current.currentTime=T*h)},O=m=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+m,h)))};if(D)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-slate-500 text-[13px] flex items-center gap-2",children:[e.jsx(ge,{size:16})," ",D]});if(!s)return null;const A=h>0?l/h*100:0;return e.jsxs(U,{className:"p-5",children:[e.jsx("div",{onClick:k,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${A}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>O(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})}),e.jsx("button",{onClick:b,disabled:f,className:`w-12 h-12 rounded-full bg-primary border-none flex items-center justify-center text-white ${f?"cursor-wait opacity-70":"cursor-pointer"}`,children:f?e.jsx(G,{size:22,className:"animate-spin"}):p?e.jsx(Is,{size:22,fill:"white"}):e.jsx(Ae,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>O(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ds,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[je(l)," / ",je(h)]})]})},Dt=({sessionId:s,conversationId:a})=>{const n=o.useRef(null),[p,d]=o.useState(!1),[l,x]=o.useState(!1),[h,y]=o.useState(0),[f,c]=o.useState(0),[D,w]=o.useState(null),[b,k]=o.useState(!0);o.useEffect(()=>{if(!a){k(!1),w("Keine Audio-Aufnahme verf√ºgbar");return}const T=xt(s);return k(!0),w(null),fetch(T,{headers:{"X-WP-Nonce":ce()},credentials:"same-origin"}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}`);return I.blob()}).then(I=>{const _=URL.createObjectURL(I),N=new Audio(_);n.current=N,N._objectUrl=_,N.addEventListener("loadedmetadata",()=>{c(N.duration),k(!1)}),N.addEventListener("timeupdate",()=>y(N.currentTime)),N.addEventListener("play",()=>d(!0)),N.addEventListener("pause",()=>d(!1)),N.addEventListener("ended",()=>d(!1)),N.addEventListener("error",()=>{w("Audio konnte nicht abgespielt werden."),k(!1)})}).catch(()=>{w("Audio nicht verf√ºgbar."),k(!1)}),()=>{n.current&&(n.current.pause(),n.current._objectUrl&&URL.revokeObjectURL(n.current._objectUrl),n.current=null)}},[s,a]);const O=()=>{n.current&&(p?n.current.pause():n.current.play())},A=()=>{n.current&&(n.current.muted=!l,x(!l))},m=T=>{n.current&&(n.current.currentTime=Math.max(0,Math.min(n.current.currentTime+T,f)))},z=T=>{const I=T.currentTarget.getBoundingClientRect(),_=(T.clientX-I.left)/I.width;n.current&&(n.current.currentTime=_*f)};return b?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(G,{size:24,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:"Audio wird geladen..."})]}):D?e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ge,{size:24,className:"text-slate-400 mx-auto"}),e.jsx("p",{className:"text-[13px] text-slate-500 mt-2",children:D})]}):e.jsxs(U,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(He,{size:18,className:"text-primary"})," Gespr√§chsaufnahme"]}),e.jsx("div",{onClick:z,className:"h-2 bg-slate-200 rounded cursor-pointer mb-4",children:e.jsx("div",{className:"h-full bg-primary rounded transition-all duration-100",style:{width:`${h/f*100||0}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>m(-10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ss,{size:20})}),e.jsx("button",{onClick:O,className:"w-12 h-12 rounded-full bg-primary border-none cursor-pointer flex items-center justify-center text-white",children:p?e.jsx(Is,{size:22,fill:"white"}):e.jsx(Ae,{size:22,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>m(10),className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600",children:e.jsx(Ds,{size:20})}),e.jsx("button",{onClick:A,className:"p-2 bg-transparent border-none cursor-pointer text-slate-400 hover:text-slate-600 ml-auto",children:l?e.jsx(Vs,{size:20}):e.jsx(Ks,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-[13px] text-slate-500",children:[je(h)," / ",je(f)]})]})},At=({entry:s})=>{const a=s.role==="user";return e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${a?"bg-primary":"bg-slate-200"}`,children:e.jsx(As,{size:16,className:a?"text-white":"text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-xs font-semibold mb-1 ${a?"text-primary":"text-slate-400"}`,children:a?"Du":"Interviewer"}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed m-0",children:s.text||s.message})]})]})},_t=({answer:s,index:a})=>{const[n,p]=o.useState(!1),d=s.feedback?typeof s.feedback=="string"?JSON.parse(s.feedback):s.feedback:null,l=s.audio_analysis?typeof s.audio_analysis=="string"?JSON.parse(s.audio_analysis):s.audio_analysis:null,x=s.transcript==="[Keine Sprache erkannt]"||l?.speech_rate==="keine_sprache";return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},children:e.jsxs(U,{className:"mb-4 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>p(!n),className:"w-full p-4 bg-transparent border-none cursor-pointer flex items-center gap-3 text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center text-primary font-bold text-sm flex-shrink-0",children:a+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0 truncate",children:s.question_text||`Frage ${a+1}`})}),s.overall_score!=null&&e.jsx("span",{className:"text-base font-bold",style:{color:x?R.slate[400]:J(s.overall_score*10)},children:x?"‚Äì":`${Math.round(s.overall_score*10)}%`}),e.jsx(ws,{size:18,className:`text-slate-400 transition-transform ${n?"rotate-180":""}`})]}),e.jsx(ks,{children:n&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-5 pb-5 pt-4 border-t border-slate-100",children:[s.question_text&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(be,{size:14,className:"text-primary"})," Frage / Situation"]}),e.jsx("p",{className:"text-sm text-slate-900 leading-relaxed bg-primary/5 p-3 rounded-lg m-0 border border-primary/10",children:s.question_text})]}),s.audio_url&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(He,{size:14,className:"text-primary"})," Deine Aufnahme"]}),e.jsx(It,{audioUrl:s.audio_url,durationHint:s.audio_duration_seconds})]}),s.transcript&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2 flex items-center gap-1.5",children:[e.jsx(vs,{size:14,className:"text-primary"})," Transkript"]}),e.jsxs("p",{className:`text-[13px] leading-relaxed bg-slate-50 p-3 rounded-lg m-0 italic break-words ${x?"text-slate-400":"text-slate-600"}`,children:['"',s.transcript,'"']})]}),d?.scores&&!x&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-2.5 flex items-center gap-1.5",children:[e.jsx(fe,{size:14,className:"text-primary"})," Bewertung"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2",children:[{key:"content",label:"Inhalt"},{key:"structure",label:"Struktur"},{key:"relevance",label:"Relevanz"},{key:"delivery",label:"Pr√§sentation"}].map(({key:h,label:y})=>{const f=d.scores[h],c=f!=null?f*10:null;return e.jsxs("div",{className:"p-2.5 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-base font-bold",style:{color:c!=null?J(c):R.slate[400]},children:c!=null?Math.round(c):"-"}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:y})]},h)})}),(()=>{const h=d.scores.overall,y=h!=null?h*10:null;return e.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg text-center border border-primary/20 flex items-center justify-center gap-3",children:[e.jsx("div",{className:"text-[10px] text-slate-500",children:"Gesamt"}),e.jsx("div",{className:"text-xl font-bold",style:{color:y!=null?J(y):R.slate[400]},children:y!=null?Math.round(y):"-"})]})})()]}),d?.summary&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-3",children:d.summary}),d?.strengths?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1.5 flex items-center gap-1",children:[e.jsx(Re,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.strengths.map((h,y)=>e.jsx("li",{className:"mb-1",children:h},y))})]}),d?.improvements?.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1.5 flex items-center gap-1",children:[e.jsx(ge,{size:12})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.improvements.map((h,y)=>e.jsx("li",{className:"mb-1",children:h},y))})]}),d?.tips?.length>0&&!x&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-xs font-semibold text-primary mb-1.5 flex items-center gap-1",children:[e.jsx(we,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-slate-600 text-xs",children:d.tips.map((h,y)=>e.jsx("li",{className:"mb-1",children:h},y))})]}),l&&!x&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsxs("h5",{className:"text-[13px] font-semibold text-slate-900 mb-3 flex items-center gap-1.5",children:[e.jsx(He,{size:14,className:"text-primary"})," Sprechanalyse"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[l.speech_rate&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Sprechtempo"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 capitalize",children:l.speech_rate==="optimal"?"‚úì Optimal":l.speech_rate==="zu_schnell"?"‚ö° Zu schnell":l.speech_rate==="zu_langsam"?"üê¢ Zu langsam":l.speech_rate})]}),l.filler_words&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"F√ºllw√∂rter"}),e.jsxs("div",{className:`text-sm font-semibold ${l.filler_words.count<=2?"text-green-600":l.filler_words.count<=5?"text-amber-600":"text-red-600"}`,children:[l.filler_words.count||0," erkannt"]}),l.filler_words.words?.length>0&&e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:l.filler_words.words.slice(0,5).join(", ")})]}),l.confidence_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Selbstsicherheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:J(l.confidence_score)},children:[l.confidence_score,"%"]})]}),l.clarity_score!=null&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Klarheit"}),e.jsxs("div",{className:"text-sm font-semibold",style:{color:J(l.clarity_score)},children:[l.clarity_score,"%"]})]})]}),l.notes&&e.jsx("p",{className:"text-xs text-slate-500 mt-2.5 italic",children:l.notes})]})]})})})]})})},Et=({isOpen:s,onClose:a,onConfirm:n,isDeleting:p})=>s?e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center bg-black/50",onClick:a,children:e.jsxs(C.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl p-6 max-w-[400px] w-[90%] shadow-2xl",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(q,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Session l√∂schen?"})]}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:"M√∂chtest du diese Session wirklich l√∂schen? Alle Antworten und Feedback werden unwiderruflich entfernt."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(X,{variant:"secondary",onClick:a,disabled:p,children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:n,disabled:p,icon:p?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(q,{size:16}),children:p?"L√∂schen...":"L√∂schen"})]})]})}):null,Ct=({category:s})=>{const[a,n]=o.useState(!1),p=yt[s.category]||fe,d=J(s.score);return e.jsxs(U,{className:"mb-2.5 overflow-hidden p-0",children:[e.jsxs("button",{onClick:()=>n(!a),className:"w-full p-3.5 bg-transparent border-none cursor-pointer flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{backgroundColor:`${d}15`},children:e.jsx(p,{size:18,style:{color:d}})}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})}),e.jsxs("span",{className:"text-base font-bold",style:{color:d},children:[Math.round(s.score),"%"]}),e.jsx(ws,{size:18,className:`text-slate-400 transition-transform ${a?"rotate-180":""}`})]}),e.jsx(ks,{children:a&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-3 border-t border-slate-100",children:[s.feedback&&e.jsx("p",{className:"text-[13px] text-slate-600 leading-snug mb-2.5",children:s.feedback}),s.strengths?.length>0&&e.jsxs("div",{className:"mb-2.5",children:[e.jsxs("h6",{className:"text-xs font-semibold text-green-600 mb-1 flex items-center gap-1",children:[e.jsx(Re,{size:12})," St√§rken"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.strengths.map((l,x)=>e.jsx("li",{children:l},x))})]}),s.improvements?.length>0&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-xs font-semibold text-amber-600 mb-1 flex items-center gap-1",children:[e.jsx(we,{size:12})," Tipps"]}),e.jsx("ul",{className:"m-0 pl-4 text-xs text-slate-600",children:s.improvements.map((l,x)=>e.jsx("li",{children:l},x))})]})]})})})]})},zt=({session:s,type:a,scenario:n,onBack:p,onContinueSession:d,onRepeatSession:l,onDeleteSession:x})=>{const h=Se(),[y,f]=o.useState(!1);o.useEffect(()=>{const i=()=>{const g=window.innerWidth;f(g>=768&&g<1200)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const[c,D]=o.useState([]),[w,b]=o.useState(!0),[k,O]=o.useState(null),[A,m]=o.useState(!1),[z,T]=o.useState(!1),[I,_]=o.useState(!1),[N,me]=o.useState(null),[te,Ne]=o.useState(n),B=a==="video",P=a==="simulator",W=a==="roleplay",he=(()=>{const i=s?.questions||s?.questions_json;if(!i)return!1;try{const g=typeof i=="string"?JSON.parse(i):i;return Array.isArray(g)&&g.length>0}catch{return!1}})(),S=(()=>{if(!P||!he)return!1;const i=s?.total_questions||0,g=s?.completed_questions||0;return i>0&&g<i})(),V=async()=>{if(x){T(!0);try{await x(s,a)}catch(i){console.error("Failed to delete session:",i),T(!1),m(!1)}}},H=async()=>{if(!(I||!s?.id)){_(!0);try{let i;if(P)i=`${ve()}/simulator/sessions/${s.id}/export-pdf`;else if(B)i=`${ve()}/video-training/sessions/${s.id}/export-pdf`;else if(W)i=`${ve()}/sessions/${s.id}/export-pdf`;else throw new Error("Unsupported session type for PDF export");const g=await fetch(i,{method:"POST",headers:{"X-WP-Nonce":ce(),"Content-Type":"application/json"},credentials:"same-origin"}),E=await g.json();if(!g.ok)throw new Error(E.error||`HTTP ${g.status}`);if(!E.success||!E.pdf_base64)throw new Error(E.error||"PDF generation failed");const re=atob(E.pdf_base64),Ie=new Array(re.length);for(let le=0;le<re.length;le++)Ie[le]=re.charCodeAt(le);const ue=new Uint8Array(Ie),Fe=new Blob([ue],{type:E.content_type||"application/pdf"}),De=window.URL.createObjectURL(Fe),ee=document.createElement("a");ee.href=De,ee.download=E.filename||"Training.pdf",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),window.URL.revokeObjectURL(De)}catch(i){console.error("Failed to download PDF:",i)}finally{_(!1)}}};o.useEffect(()=>{P&&s?.id?Be():W&&s?.id?ze():b(!1)},[s?.id,a]);const Be=async()=>{try{b(!0);const g=await(await fetch(`${ve()}/simulator/sessions/${s.id}/answers`,{headers:{"X-WP-Nonce":ce()}})).json();g.success&&g.data?.answers?D(g.data.answers):Array.isArray(g.data)&&D(g.data)}catch(i){console.error("Failed to load answers:",i),O("Fehler beim Laden der Antworten")}finally{b(!1)}},ze=async()=>{try{b(!0);const i=await rt(s.id);if(me({...s,...i,feedback:ot(i.feedback_json||s.feedback_json),audioAnalysis:ct(i.audio_analysis_json||s.audio_analysis_json),transcript:lt(i.transcript||s.transcript)}),!n&&i.scenario_id)try{const g=await dt(i.scenario_id);Ne(g)}catch(g){console.warn("Could not load scenario:",g)}}catch(i){console.error("Failed to load roleplay data:",i),O("Fehler beim Laden der Gespr√§chsdaten")}finally{b(!1)}},Z=s?.summary_feedback_json?typeof s.summary_feedback_json=="string"?JSON.parse(s.summary_feedback_json):s.summary_feedback_json:null,$=s?.category_scores||[],Q=s?.analysis||{},ie=(()=>{let i=0;return W&&N?.feedback?.rating?.overall?i=N.feedback.rating.overall:i=s?.overall_score||Z?.overall_score||0,(P||W)&&i<=10?i*10:i})();return w?e.jsx("div",{className:"w-full min-h-[60vh] flex items-center justify-center p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{size:48,className:"text-primary animate-spin mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-4",children:"Analyse wird geladen..."})]})}):k?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ge,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-600 mb-6",children:k}),e.jsx(X,{variant:"secondary",onClick:p,children:"Zur√ºck"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 overflow-hidden max-w-full",children:[e.jsx("div",{className:`sticky top-0 z-40 ${h?"px-4 py-5":"px-8 py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[p&&e.jsxs("button",{onClick:p,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ns,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx(St,{score:ie,size:100,isHeader:!0}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:kt(a)}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:J(ie)},children:vt(ie)})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:(W?te?.title:n?.title)||s?.scenario_title||s?.position||"Training"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ke,{size:14}),wt(s?.created_at)]}),s?.duration&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ye,{size:14}),je(s.duration)]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:H,disabled:I,title:"Als PDF herunterladen",className:`flex items-center justify-center bg-white/20 border border-white/30 rounded-lg px-3 py-2.5 text-white outline-none transition-colors hover:bg-white/30 ${I?"cursor-wait opacity-70":"cursor-pointer"}`,children:I?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(ys,{size:16})}),!h&&l&&e.jsxs("button",{onClick:()=>l(s,n),className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-lg px-5 py-2.5 cursor-pointer text-white text-sm font-medium outline-none hover:bg-white/30 transition-colors",children:[e.jsx(Ke,{size:16}),"Erneut √ºben"]}),x&&e.jsx("button",{onClick:()=>m(!0),className:`flex items-center gap-2 bg-red-500/20 border border-red-500/40 rounded-lg cursor-pointer text-white text-sm font-medium outline-none hover:bg-red-500/30 transition-colors ${h?"px-3 py-2.5":"px-4 py-2.5"}`,children:e.jsx(q,{size:16})})]})]})]})}),e.jsx("div",{className:`overflow-hidden ${h?"p-4":"px-8 py-6"}`,children:e.jsxs("div",{className:"grid gap-6 overflow-hidden",style:{gridTemplateColumns:h||y?"1fr":"1fr 400px"},children:[e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[B&&s?.video_url&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(Ce,{size:18,className:"text-primary"})," Deine Aufnahme"]}),e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-w-[640px] max-h-[360px] rounded-xl bg-black object-contain"})]})}),P&&c.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(be,{size:18,className:"text-primary"})," Deine Antworten (",c.length,")"]}),c.map((i,g)=>e.jsx(_t,{answer:i,index:g},i.id||g)),S&&(d||l)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap mt-6 p-5 bg-slate-50 rounded-xl border border-dashed border-slate-300",children:[e.jsx("p",{className:"w-full text-center text-slate-600 text-sm mb-3",children:"Diese Session ist noch nicht abgeschlossen."}),d&&e.jsx(X,{onClick:()=>d(s,n),icon:e.jsx(cs,{size:18}),children:"Fortsetzen"}),l&&e.jsx(X,{variant:"secondary",onClick:()=>l(s,n),icon:e.jsx(Ke,{size:18}),children:"Erneut starten"})]})]}),P&&c.length===0&&e.jsxs("div",{className:"text-center py-12 px-6 bg-slate-50 rounded-2xl",children:[e.jsx(ge,{size:48,className:"text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Keine Antworten vorhanden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:he?"Diese Session wurde nicht abgeschlossen. Du kannst sie fortsetzen oder erneut starten.":"Diese Session wurde verlassen, bevor Fragen generiert wurden."}),S&&(d||l)&&e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap",children:[d&&e.jsx(X,{onClick:()=>d(s,n),icon:e.jsx(cs,{size:18}),children:"Fortsetzen"}),l&&e.jsx(X,{variant:"secondary",onClick:()=>l(s,n),icon:e.jsx(Ke,{size:18}),children:"Erneut starten"})]})]}),W&&N&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-5",children:e.jsx(Dt,{sessionId:s.id,conversationId:N.conversation_id})}),W&&N?.transcript?.length>0&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(U,{className:"p-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(vs,{size:18,className:"text-primary"})," Gespr√§chsverlauf"]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:N.transcript.map((i,g)=>e.jsx(At,{entry:i},g))})]})})]}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[B&&$.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-5",children:[e.jsxs("h3",{className:"text-[15px] font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-primary"})," Detaillierte Bewertung"]}),$.map((i,g)=>e.jsx(Ct,{category:i},i.category||g))]}),B&&(Q.key_strengths?.length>0||Q.actionable_tips?.length>0)&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(U,{className:"mb-5 p-5",children:[Q.key_strengths?.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(Re,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:Q.key_strengths.map((i,g)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},g))})]}),Q.actionable_tips?.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-primary mb-2.5 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Tipps zur Verbesserung"]}),e.jsx("ul",{className:"m-0 pl-5",children:Q.actionable_tips.map((i,g)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-1.5 leading-snug",children:i},g))})]})]})}),B&&s?.summary_feedback&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:s.summary_feedback})]})}),P&&Z&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[Z.summary&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:Z.summary})]}),Z.scores&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Bewertung"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:Object.entries(Z.scores).map(([i,g])=>{const E=g!=null?g*10:null;return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-xl font-bold",style:{color:J(E)},children:E!=null?Math.round(E):"-"}),e.jsx("div",{className:"text-[11px] text-slate-500 capitalize",children:i})]},i)})})]}),Z.key_takeaways?.length>0&&e.jsxs("div",{className:"bg-green-50 rounded-2xl p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-2.5 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Wichtigste Erkenntnisse"]}),e.jsx("ul",{className:"m-0 pl-5 text-[13px] text-slate-900 leading-snug",children:Z.key_takeaways.map((i,g)=>e.jsx("li",{className:"mb-1.5",children:i},g))})]})]}),W&&N?.feedback&&e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[N.feedback.rating&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-[15px] font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-primary"})," Bewertungskriterien"]}),e.jsx("div",{className:"flex flex-col gap-2.5",children:Object.entries(N.feedback.rating).filter(([i])=>i!=="overall").map(([i,g])=>{const E=g*10;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[e.jsx("div",{className:"flex-1 text-[13px] font-medium text-slate-900 capitalize",children:i.replace(/_/g," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-1.5 bg-slate-200 rounded",children:e.jsx("div",{className:"h-full rounded",style:{width:`${E}%`,backgroundColor:J(E)}})}),e.jsx("span",{className:"text-sm font-semibold min-w-[45px]",style:{color:J(E)},children:Math.round(E)})]})]},i)})})]}),N.feedback.strengths?.length>0&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 mb-3 flex items-center gap-1.5",children:[e.jsx(Re,{size:16})," Deine St√§rken"]}),e.jsx("ul",{className:"m-0 pl-5",children:N.feedback.strengths.map((i,g)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},g))})]}),N.feedback.improvements?.length>0&&e.jsxs(U,{className:"mb-5 p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-amber-600 mb-3 flex items-center gap-1.5",children:[e.jsx(we,{size:16})," Verbesserungspotenzial"]}),e.jsx("ul",{className:"m-0 pl-5",children:N.feedback.improvements.map((i,g)=>e.jsx("li",{className:"text-[13px] text-slate-600 mb-2 leading-snug",children:i},g))})]}),N.feedback.summary&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-5",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-2.5",children:"Zusammenfassung"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed m-0",children:N.feedback.summary})]})]}),W&&!N?.feedback&&e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 text-center",children:[e.jsx(ge,{size:32,className:"text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-500 m-0",children:"Keine Analyse verf√ºgbar f√ºr dieses Gespr√§ch."})]})]})]})}),e.jsx(Et,{isOpen:A,onClose:()=>m(!1),onConfirm:V,isDeleting:z})]})},Lt=({briefing:s,onClick:a,onDelete:n,headerGradient:p,headerText:d,primaryAccent:l})=>{const[x,h]=o.useState(!1),[y,f]=o.useState(!1),c=Se(900),D=pt(s.template_icon),w=k=>{k.stopPropagation(),f(!0)},b=async()=>{h(!0);try{await n(s.id),f(!1)}catch(k){console.error("Error deleting briefing:",k)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-[22px] h-[22px] text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.title||"Briefing"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2.5 py-1 rounded-[10px] text-xs font-medium max-w-[70%] overflow-hidden text-ellipsis whitespace-nowrap",children:s.template_title}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:b,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(D,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:s.title||"Briefing"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-[10px] text-xs font-medium",children:s.template_title}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:w,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:b,title:"Briefing l√∂schen",description:"M√∂chtest du dieses Briefing wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},ne={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video"},Ot=({session:s,type:a,scenario:n,onClick:p,onContinueSession:d,onDeleteSession:l,headerGradient:x,headerText:h,primaryAccent:y})=>{const[f,c]=o.useState(!1),[D,w]=o.useState(!1),b=Se(900),k=()=>{let S=null;if(a===ne.SIMULATOR)S=s.overall_score||s.average_score;else if(a===ne.VIDEO)S=s.overall_score;else if(s.feedback_json)try{let V=s.feedback_json;if(typeof V=="string"){let H=V.trim();H.startsWith("```json")?H=H.replace(/```json\s*/g,"").replace(/```\s*$/g,""):H.startsWith("```")&&(H=H.replace(/```\s*/g,"").replace(/```\s*$/g,"")),V=JSON.parse(H)}S=V.rating?.overall||null}catch{S=null}return S==null||isNaN(S)||S===0?null:S},O=()=>a===ne.SIMULATOR||a===ne.VIDEO?s.status:s.feedback_json?"completed":"pending",A=k(),z=O()==="completed",T=s.total_questions>0&&(s.completed_questions||0)<s.total_questions,I=a===ne.SIMULATOR&&T,_=()=>{if(!I)return null;const S=s.completed_questions||0,V=s.total_questions||0;return`${S}/${V} Fragen`},N=S=>{S.stopPropagation(),d&&d(s,n)},me=S=>{S.stopPropagation(),w(!0)},te=async()=>{c(!0);try{await l(s,a),w(!1)}catch(S){console.error("Error deleting session:",S)}finally{c(!1)}},B=(()=>{if(A==null||isNaN(A))return null;if(a===ne.SIMULATOR||a===ne.ROLEPLAY){const S=A<=10?A*10:A;return isNaN(S)?null:S}return isNaN(A)?null:A})(),P=S=>{if(!S&&S!==0)return{background:R.slate[100],color:R.slate[500]};const V=parseFloat(S);return V>=80?{background:R.green[100],color:R.green[800]}:V>=60?{background:R.amber[100],color:R.amber[800]}:{background:R.red[100],color:R.red[800]}},he=(()=>{switch(a){case ne.SIMULATOR:return $e;case ne.VIDEO:return Ce;default:return be}})();return b?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:p,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(he,{className:"w-[22px] h-[22px]",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3]",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),l&&e.jsx("button",{onClick:me,disabled:f,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600 hover:bg-slate-100 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:f?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(ye,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1.5 rounded-full text-[13px] font-semibold",style:P(B),children:[e.jsx(fe,{size:13}),B!==null?`${Math.round(B)}%`:"-- %"]}),(s.duration||s.video_duration_seconds)&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(ye,{size:12}),je(s.duration||s.video_duration_seconds)]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:_()})]}),I&&d?e.jsxs("button",{onClick:N,className:"flex items-center gap-1.5 px-4 py-2.5 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:shadow-lg transition-shadow shrink-0",children:[e.jsx(Ae,{size:14}),"Fortsetzen"]}):e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:D,onClose:()=>w(!1),onConfirm:te,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:f})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:p,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:x},children:e.jsx(he,{className:"w-6 h-6",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 whitespace-nowrap overflow-hidden text-ellipsis",children:n?.title||s.scenario_title||`Session #${s.id}`}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]}),s.duration||s.video_duration_seconds?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{size:14}),je(s.duration||s.video_duration_seconds)]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[I&&d&&e.jsxs("button",{onClick:N,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-[10px] border-none bg-primary text-white text-[13px] font-semibold cursor-pointer shadow-md hover:scale-105 hover:shadow-lg transition-all",children:[e.jsx(Ae,{size:14}),"Fortsetzen"]}),I&&e.jsx("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:_()}),!z&&!I&&e.jsxs("span",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-medium",children:[e.jsx(ye,{size:12}),"In Bearbeitung"]}),e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1.5 rounded-full text-sm font-semibold",style:P(B),children:[e.jsx(fe,{size:14}),B!==null?`${Math.round(B)}%`:"-- %"]}),l&&e.jsx("button",{onClick:me,disabled:f,className:"p-3 rounded-xl border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-colors min-w-[44px] min-h-[44px]",title:"L√∂schen",children:f?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:D,onClose:()=>w(!1),onConfirm:te,title:"Session l√∂schen",description:"M√∂chtest du diese Session wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:f})]})},ps=({proScore:s,contraScore:a})=>{const n=s+a,p=n>0?Math.round(s/n*100):50;return e.jsxs("div",{className:"h-1.5 rounded-[3px] overflow-hidden flex bg-slate-100 w-full max-w-[120px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full",style:{width:`${p}%`}}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 h-full",style:{width:`${100-p}%`}})]})},Tt=({decision:s,onClick:a,onDelete:n,headerGradient:p,headerText:d,primaryAccent:l})=>{const[x,h]=o.useState(!1),[y,f]=o.useState(!1),c=Se(900),D=(s.pros||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),w=(s.cons||[]).reduce((m,z)=>m+(z.text?.trim()?z.weight||5:0),0),b=(s.pros||[]).filter(m=>m.text?.trim()).length,k=(s.cons||[]).filter(m=>m.text?.trim()).length,O=m=>{m.stopPropagation(),f(!0)},A=async()=>{h(!0);try{await n(s.id),f(!1)}catch(m){console.error("Error deleting decision:",m)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:a,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(_e,{className:"w-[22px] h-[22px] text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:s.topic||"Entscheidung"}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14,className:"text-green-600"}),e.jsx("span",{className:"text-[13px] font-medium text-green-600",children:b})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{size:14,className:"text-red-600"}),e.jsx("span",{className:"text-[13px] font-medium text-red-600",children:k})]}),e.jsx(ps,{proScore:D,contraScore:w})]}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:A,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:a,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0",children:e.jsx(_e,{className:"w-6 h-6 text-purple-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1.5 whitespace-nowrap overflow-hidden text-ellipsis",children:s.topic||"Entscheidung"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ds,{size:14,className:"text-green-600"}),e.jsxs("span",{className:"font-medium text-green-600",children:[b," Pro"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{size:14,className:"text-red-600"}),e.jsxs("span",{className:"font-medium text-red-600",children:[k," Contra"]})]})]}),e.jsx(ps,{proScore:D,contraScore:w}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:A,title:"Entscheidung l√∂schen",description:"M√∂chtest du diese Entscheidung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},Mt={love:{icon:Xs,color:F.love.color,label:"Liebe"},talent:{icon:fe,color:F.talent.color,label:"Talent"},need:{icon:Ys,color:F.need.color,label:"Welt"},market:{icon:Hs,color:F.market.color,label:"Markt"}},gs=({dimensions:s})=>e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Object.entries(Mt).map(([a,n])=>{const p=s?.[a]||[],d=p.length>0,l=n.icon;return e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-xl text-xs font-medium",style:{backgroundColor:d?`${n.color}15`:R.slate[100],color:d?n.color:R.slate[400],border:d?`1px solid ${n.color}30`:`1px solid ${R.slate[200]}`},children:[e.jsx(l,{size:12}),e.jsx("span",{children:p.length})]},a)})}),Rt=({ikigai:s,onDelete:a,onNavigate:n,headerGradient:p,headerText:d,primaryAccent:l})=>{const[x,h]=o.useState(!1),[y,f]=o.useState(!1),c=Se(900),D={love:s.love_tags||[],talent:s.talent_tags||[],need:s.need_tags||[],market:s.market_tags||[]},w=Object.values(D).filter(m=>m.length>0).length,b=s.status==="completed",k=s.paths?.[0]?.role_title||(b?"Ikigai-Analyse abgeschlossen":"Ikigai-Analyse"),O=m=>{m.stopPropagation(),f(!0)},A=async()=>{h(!0);try{await a(s.id),f(!1)}catch(m){console.error("Error deleting ikigai:",m)}finally{h(!1)}};return c?e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileTap:{scale:.98},children:[e.jsxs("div",{onClick:n,className:"bg-white rounded-2xl p-4 cursor-pointer border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center shrink-0",style:{background:b?`linear-gradient(135deg, ${F.love.color}, ${F.talent.color}, ${F.need.color}, ${F.market.color})`:`linear-gradient(135deg, ${R.indigo[500]}15, ${R.indigo[500]}30)`},children:e.jsx(Ee,{className:`w-[22px] h-[22px] ${b?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-1 leading-[1.3] line-clamp-2",children:k}),e.jsx("div",{className:"text-[13px] text-slate-500",children:de(s.created_at)})]}),e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center shrink-0 hover:text-slate-600",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-3 border-t border-slate-100",children:[e.jsx(gs,{dimensions:D}),e.jsx(oe,{size:22,className:"text-slate-400 shrink-0"})]})]}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:A,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]}):e.jsxs(C.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{onClick:n,className:"bg-white rounded-2xl p-5 cursor-pointer border border-slate-200 shadow-sm hover:shadow-lg hover:border-slate-300 transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:b?`linear-gradient(135deg, ${F.love.color}, ${F.talent.color}, ${F.need.color}, ${F.market.color})`:`linear-gradient(135deg, ${R.indigo[500]}15, ${R.indigo[500]}30)`},children:e.jsx(Ee,{className:`w-6 h-6 ${b?"text-white":"text-indigo-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 whitespace-nowrap overflow-hidden text-ellipsis",children:k}),b&&e.jsx("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-gradient-to-r from-green-500 to-green-600 text-white",children:"Abgeschlossen"}),!b&&w>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded-[10px] text-[11px] font-semibold bg-amber-500/10 text-amber-500",children:[w,"/4 Dimensionen"]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap text-[13px] text-slate-500",children:[e.jsx(gs,{dimensions:D}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),de(s.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:O,disabled:x,className:"p-2 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 transition-colors",title:"L√∂schen",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})}),e.jsx(oe,{size:20,className:"text-slate-400"})]})]})}),e.jsx(xe,{isOpen:y,onClose:()=>f(!1),onConfirm:A,title:"Ikigai-Analyse l√∂schen",description:"M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.",isDeleting:x})]})},$t=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",Bt=s=>s>=90?"Ausgezeichnet!":s>=80?"Sehr gut!":s>=70?"Gut!":s>=60?"Solide Leistung":s>=50?"Ausbauf√§hig":"In Arbeit",fs={ikigai:{label:"Ikigai-Kompass",icon:Ee},decision:{label:"Entscheidungs-Board",icon:_e},briefing:{label:"Smart Briefing",icon:Ye},simulator:{label:"Szenario-Training",icon:$e},video:{label:"Wirkungs-Analyse",icon:Ce},roleplay:{label:"Live-Simulation",icon:be}},Ft=({score:s,size:a=80})=>{const n=Math.min(100,Math.max(0,s||0)),p=(a-10)/2,d=p*2*Math.PI,l=d-n/100*d;return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"-rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:p,fill:"none",stroke:"rgba(255,255,255,0.25)",strokeWidth:8}),e.jsx(C.circle,{cx:a/2,cy:a/2,r:p,fill:"none",stroke:"#fff",strokeWidth:8,strokeLinecap:"round",strokeDasharray:d,initial:{strokeDashoffset:d},animate:{strokeDashoffset:l},transition:{duration:1.2,ease:"easeOut"}})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx(C.span,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.4},className:"font-bold text-white leading-none",style:{fontSize:a/3},children:Math.round(s)})})]})},js=({type:s,title:a,subtitle:n,score:p,status:d,createdAt:l,duration:x,onBack:h,onDelete:y,onDownload:f,isDeleting:c=!1,isDownloading:D=!1,extraActions:w})=>{const b=Se(768),k=fs[s]||fs.simulator,O=k.icon,A=p!=null&&p>0;return e.jsx("div",{className:"sticky top-0 z-40 bg-brand-gradient",style:{padding:b?"20px 16px":"24px 32px"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[h&&e.jsxs("button",{onClick:h,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ns,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!b&&A&&e.jsx(Ft,{score:p,size:80}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-[11px] font-semibold uppercase tracking-wider px-2.5 py-1 rounded-full bg-white/20 text-white",children:[e.jsx(O,{size:14}),k.label]}),A&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90",style:{color:J(p)},children:Bt(p)}),d==="in_progress"&&e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-amber-600",children:"In Bearbeitung"})]}),e.jsx("h1",{className:"font-bold text-white m-0 truncate",style:{fontSize:b?"20px":"24px",marginBottom:n?"4px":"8px"},children:a}),n&&e.jsx("p",{className:"text-sm text-white/80 m-0 mb-2",children:n}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[l&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ke,{size:14}),$t(l)]}),x&&e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ye,{size:14}),Math.floor(x/60),":",String(x%60).padStart(2,"0")," Min."]})]})]}),e.jsxs("div",{className:"flex gap-3 flex-shrink-0",children:[f&&e.jsxs("button",{onClick:f,disabled:D,title:"Als PDF herunterladen",className:"flex items-center justify-center gap-1.5 bg-white/15 border-none rounded-lg text-white text-[13px] font-medium hover:bg-white/25 transition-colors disabled:opacity-70",style:{padding:b?"10px":"10px 16px",cursor:D?"wait":"pointer"},children:[e.jsx(ys,{size:16}),!b&&"PDF"]}),w,y&&e.jsxs("button",{onClick:y,disabled:c,title:"L√∂schen",className:"flex items-center justify-center gap-1.5 bg-red-500/20 border border-red-500/40 rounded-lg text-white text-[13px] font-medium hover:bg-red-500/30 transition-colors disabled:opacity-70",style:{padding:b?"10px":"10px 16px",cursor:c?"wait":"pointer"},children:[e.jsx(q,{size:16}),!b&&"L√∂schen"]})]})]})]})})},bs={love:{key:"love",label:"Liebe",icon:"‚ù§Ô∏è",color:F.love.color,question:"Vergiss mal Geld und Karriere. Bei welchen T√§tigkeiten vergisst du die Zeit?",placeholder:"Erz√§hle mir, was du wirklich liebst zu tun...",description:"Was du liebst"},talent:{key:"talent",label:"Talent",icon:"‚≠ê",color:F.talent.color,question:"Worin bist du richtig gut? Was f√§llt dir leicht, w√§hrend andere damit k√§mpfen?",placeholder:"Beschreibe deine St√§rken und F√§higkeiten...",description:"Worin du gut bist"},need:{key:"need",label:"Welt",icon:"üåç",color:F.need.color,question:"Welche Probleme der Welt w√ºrdest du gerne l√∂sen? Wo siehst du Bedarf?",placeholder:"Welchen Beitrag m√∂chtest du leisten...",description:"Was die Welt braucht"},market:{key:"market",label:"Markt",icon:"üí∞",color:F.market.color,question:"Wof√ºr werden Menschen in deinem Bereich bezahlt? Was ist gefragt?",placeholder:"Welche Berufe oder M√§rkte interessieren dich...",description:"Wof√ºr du bezahlt wirst"}},r={SIMULATOR:"simulator",ROLEPLAY:"roleplay",VIDEO:"video",BRIEFINGS:"briefings",DECISIONS:"decisions",IKIGAI:"ikigai"},qe=[{id:r.BRIEFINGS,label:"Smart Briefings",icon:Ye},{id:r.DECISIONS,label:"Entscheidungs-Kompass",icon:_e},{id:r.IKIGAI,label:"Ikigai-Kompass",icon:Ee},{id:r.SIMULATOR,label:"Szenario-Training",icon:$e},{id:r.VIDEO,label:"Wirkungs-Analyse",icon:Ce},{id:r.ROLEPLAY,label:"Live-Simulationen",icon:be}],ca=r,oa=({onBack:s,onSelectSession:a,isAuthenticated:n,onLoginClick:p,onContinueSession:d,onRepeatSession:l,initialTab:x,onNavigateToModule:h})=>{const{branding:y,demoCode:f}=Qs(),[c,D]=o.useState(x||r.BRIEFINGS);o.useEffect(()=>{x&&D(x)},[x]);const[w,b]=o.useState(null),[k,O]=o.useState(null);o.useEffect(()=>{window.scrollTo(0,0)},[c,w]);const[A,m]=o.useState([]),[z,T]=o.useState([]),[I,_]=o.useState([]),[N,me]=o.useState([]),[te,Ne]=o.useState([]),[B,P]=o.useState([]),[W,he]=o.useState([]),[S,V]=o.useState([]),[H,Be]=o.useState([]),[ze,Z]=o.useState(null),[$,Q]=o.useState(null),[Le,ie]=o.useState(null),[i,g]=o.useState(null),[E,re]=o.useState({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),[Ie,ue]=o.useState(null),[Fe,De]=o.useState(!1),[ee,le]=o.useState(!0),[Xe,Je]=o.useState(null);o.useEffect(()=>{n?Oe():le(!1)},[n]);const Oe=async()=>{le(!0),Je(null);try{const t=ve(),u=f?`&demo_code=${encodeURIComponent(f)}`:"",[j,v,M,K,se,ae,pe,Gs,Ws]=await Promise.all([mt({limit:50,...f&&{demo_code:f}}).catch(()=>({data:[]})),fetch(`${t}/simulator/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/sessions?limit=50${u}`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),Y.request(`/smartbriefing/briefings?limit=50${f?`&demo_code=${encodeURIComponent(f)}`:""}`,{method:"GET"}).catch(()=>({success:!1,data:{briefings:[]}})),Y.getDecisions().catch(()=>({success:!1,data:{decisions:[]}})),Y.getIkigais().catch(()=>({success:!1,data:{ikigais:[]}})),ht().catch(()=>[]),fetch(`${t}/simulator/scenarios`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]})),fetch(`${t}/video-training/scenarios`,{headers:{"X-WP-Nonce":ce()}}).then(L=>L.json()).catch(()=>({data:[]}))]),We=(L,Te="sessions")=>Array.isArray(L?.data)?L.data:Array.isArray(L?.data?.[Te])?L.data[Te]:Array.isArray(L?.[Te])?L[Te]:Array.isArray(L)?L:[],Ve=L=>Array.isArray(L?.data?.scenarios)?L.data.scenarios:Array.isArray(L?.data)?L.data:Array.isArray(L)?L:[];m(We(j)),T(We(v)),_(We(M)),me(K?.data?.briefings||[]),Ne(se?.data?.decisions||[]),P(ae?.data?.ikigais||[]),he(Ve(pe)),V(Ve(Gs)),Be(Ve(Ws))}catch(t){console.error("Failed to load sessions:",t),Je(t.message||"Fehler beim Laden der Daten")}finally{le(!1)}},Ze=o.useMemo(()=>{const t={};return W.forEach(u=>{t[u.id]=u}),t},[W]),Qe=o.useMemo(()=>{const t={};return S.forEach(u=>{t[u.id]=u}),t},[S]),es=o.useMemo(()=>{const t={};return H.forEach(u=>{t[u.id]=u}),t},[H]),_s=()=>{switch(c){case r.SIMULATOR:return z;case r.VIDEO:return I;case r.BRIEFINGS:return N;case r.DECISIONS:return te;case r.IKIGAI:return B;default:return A}},Es=()=>{switch(c){case r.SIMULATOR:return Qe;case r.VIDEO:return es;default:return Ze}},ss=A.length+z.length+I.length+N.length+te.length,ts=async t=>{(await Y.request(`/smartbriefing/briefings/${t}`,{method:"DELETE"})).success&&me(j=>j.filter(v=>v.id!==t))},Cs=t=>{Z(t)},zs=()=>{Z(null)},as=async t=>{(await Y.deleteDecision(t)).success&&Ne(j=>j.filter(v=>v.id!==t))},ns=async t=>{await Y.deleteIkigai(t)&&P(j=>j.filter(v=>v.id!==t))},Ls=t=>{Q(t)},is=()=>{Q(null),ie(null)},Os=t=>{g(t),re({love:{input:t.love_input||"",tags:t.love_tags||[]},talent:{input:t.talent_input||"",tags:t.talent_tags||[]},need:{input:t.need_input||"",tags:t.need_tags||[]},market:{input:t.market_input||"",tags:t.market_tags||[]}}),t.status==="completed"&&t.paths?ue({summary:t.summary,paths:t.paths}):ue(null)},Pe=()=>{g(null),re({love:{input:"",tags:[]},talent:{input:"",tags:[]},need:{input:"",tags:[]},market:{input:"",tags:[]}}),ue(null)},Ts=async(t,u,j)=>{if(re(v=>({...v,[t]:{input:u,tags:j}})),i?.id)try{await Y.updateIkigai(i.id,{[`${t}_input`]:u,[`${t}_tags`]:j})}catch(v){console.error("[Ikigai] Failed to save dimension:",v)}},Ms=async(t,u)=>{try{return(await Y.extractIkigaiKeywords(t,u))?.keywords||[]}catch(j){return console.error("[Ikigai] Failed to extract keywords:",j),[]}},Rs=(t,u)=>{re(j=>{const v=j[t].tags.filter(M=>M!==u);return{...j,[t]:{...j[t],tags:v}}})},$s=async()=>{if(Object.values(E).every(u=>u.tags&&u.tags.length>0)){De(!0);try{const u=await Y.synthesizeIkigaiPaths({love_tags:E.love.tags,talent_tags:E.talent.tags,need_tags:E.need.tags,market_tags:E.market.tags});u&&(ue(u),i?.id&&(await Y.updateIkigai(i.id,{summary:u.summary,paths:u.paths,status:"completed"}),P(j=>j.map(v=>v.id===i.id?{...v,summary:u.summary,paths:u.paths,status:"completed"}:v))))}catch(u){console.error("[Ikigai] Failed to synthesize paths:",u)}finally{De(!1)}}},Bs=Object.values(E).every(t=>t.tags&&t.tags.length>0),Fs=t=>{Ne(u=>u.map(j=>j.id===t.id?t:j)),Q(t)},Ps=t=>{b(t),O(c)},Ue=()=>{b(null),O(null)},Ge=async(t,u)=>{const j=ve();try{let v,M;switch(u){case r.SIMULATOR:v=`${j}/simulator/sessions/${t.id}`,M=()=>T(ae=>ae.filter(pe=>pe.id!==t.id));break;case r.ROLEPLAY:v=`${j}/roleplays/sessions/${t.id}`,M=()=>m(ae=>ae.filter(pe=>pe.id!==t.id));break;case r.VIDEO:v=`${j}/video-training/sessions/${t.id}`,M=()=>_(ae=>ae.filter(pe=>pe.id!==t.id));break;default:throw new Error("Unknown session type")}const se=await(await fetch(v,{method:"DELETE",headers:{"X-WP-Nonce":ce()}})).json();if(se.success)M(),w&&Ue();else throw new Error(se.message||"Delete failed")}catch(v){throw console.error("Failed to delete session:",v),v}},rs=(t,u)=>(u===r.SIMULATOR?Qe:u===r.VIDEO?es:Ze)[t?.scenario_id];if(ze)return e.jsx(gt,{briefing:ze,onBack:zs,onDelete:ts});if($){const t={topic:$.topic||"",context:$.context||"",pros:$.pros||[],cons:$.cons||[],proScore:$.pro_score||0,contraScore:$.contra_score||0},u=async(M,K)=>{try{const se={topic:M.topic,context:M.context||null,pros:M.pros,cons:M.cons,pro_score:M.proScore,contra_score:M.contraScore,analysis:K,status:"completed"};await Y.updateDecision($.id,se);const ae={...$,...se};Fs(ae),ie({data:M,result:K})}catch(se){console.error("[SessionHistory] Failed to update decision:",se)}},j=async M=>$.id,v=async(M,K)=>{try{await Y.updateDecision(M,{topic:K.topic,context:K.context||null,pros:K.pros,cons:K.cons,pro_score:K.proScore,contra_score:K.contraScore,status:K.status||"draft"})}catch(se){console.error("[SessionHistory] Failed to update decision:",se)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(js,{type:"decision",title:$.topic||"Entscheidung",status:$.status,createdAt:$.created_at,onBack:is,onDelete:()=>{window.confirm("M√∂chtest du diese Entscheidungs-Analyse wirklich l√∂schen?")&&(as($.id),is())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:Le?e.jsx(ft,{decisionData:Le.data,analysisResult:Le.result,onStartNew:()=>{ie(null),Q(null)},onEditDecision:()=>{ie(null)}}):e.jsx(jt,{initialData:t,onAnalysisComplete:u,isAuthenticated:n,savedDecisionId:$.id,onSaveDraft:j,onUpdateSession:v,onDecisionIdChange:()=>{}})})]})}if(i)return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(js,{type:"ikigai",title:"Ikigai-Analyse",subtitle:i.status==="completed"?"Berufliche Orientierung":"In Bearbeitung",status:i.status,createdAt:i.created_at,onBack:Pe,onDelete:()=>{window.confirm("M√∂chtest du diese Ikigai-Analyse wirklich l√∂schen?")&&(ns(i.id),Pe())}}),e.jsx("div",{className:"p-6 max-w-[900px] mx-auto",children:Ie?e.jsx(bt,{dimensions:E,synthesisResult:Ie,onStartNew:Pe,onEdit:()=>ue(null),DIMENSIONS:bs}):e.jsx(Nt,{dimensions:E,DIMENSIONS:bs,onExtractKeywords:Ms,onUpdateDimension:Ts,onRemoveTag:Rs,allDimensionsFilled:Bs,onSynthesize:$s,isSynthesizing:Fe})})]});if(w){if(k===r.ROLEPLAY){const j=rs(w,k);return e.jsx(ut,{session:w,scenario:j,onBack:Ue,onRepeat:()=>l?.(w,j,"roleplay"),onDelete:v=>Ge(v,r.ROLEPLAY)})}const u={[r.SIMULATOR]:"simulator",[r.VIDEO]:"video"}[k]||"simulator";return e.jsx(zt,{session:w,type:k,scenario:rs(w,k),onBack:Ue,onContinueSession:d,onRepeatSession:(j,v)=>l?.(j,v,u),onDeleteSession:Ge})}if(!n)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ms,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsx("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:"Hier findest du deine gespeicherten √úbungen und Fortschritte"})]}),e.jsxs(U,{className:"max-w-[500px] mx-auto mt-16 p-10 text-center rounded-2xl shadow-card",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center mx-auto mb-5",children:e.jsx(hs,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-slate-500 mb-6 leading-relaxed",children:"Um deine gespeicherten Sessions zu sehen, musst du dich zuerst anmelden."}),e.jsx(X,{onClick:p,size:"lg",icon:e.jsx(hs,{className:"w-5 h-5"}),children:"Jetzt anmelden"})]})]});if(ee)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx(Me,{className:"w-12 h-12 rounded-2xl"}),e.jsx(Me,{className:"h-10 w-48"})]}),e.jsx(Me,{className:"h-5 w-32 mx-auto"})]}),e.jsx("div",{className:"flex justify-center gap-2 mb-8",children:[1,2,3,4,5,6].map(t=>e.jsx(Me,{className:"h-12 w-28 rounded-xl"},t))}),e.jsx("div",{className:"space-y-3 max-w-4xl mx-auto",children:[1,2,3,4,5].map(t=>e.jsx(Zs,{},t))})]});if(Xe)return e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-[400px] p-6",children:[e.jsx(ge,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-slate-500 mb-6",children:Xe}),e.jsx(X,{onClick:Oe,children:"Erneut versuchen"})]})});const ls=_s(),Us=Es();return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8 text-center relative",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center",children:e.jsx(ms,{className:"w-7 h-7 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900",children:"Meine Sessions"})]}),e.jsxs("p",{className:"text-lg text-slate-500 max-w-[600px] mx-auto",children:[ss," ",ss===1?"√úbung":"√úbungen"," gespeichert"]}),e.jsx("button",{onClick:Oe,disabled:ee,className:"absolute top-0 right-0 p-2.5 rounded-xl border border-slate-200 bg-white text-slate-500 shadow-sm flex items-center justify-center md:hidden disabled:opacity-50 hover:shadow-md transition-shadow",children:e.jsx(us,{className:`w-5 h-5 ${ee?"animate-spin":""}`})})]}),e.jsx("div",{className:"hidden lg:flex flex-wrap gap-2 mx-6 mb-6 bg-slate-100 p-1.5 rounded-2xl",children:qe.map(t=>{const u=t.icon,j=c===t.id,v=t.id===r.SIMULATOR?z.length:t.id===r.VIDEO?I.length:t.id===r.BRIEFINGS?N.length:t.id===r.DECISIONS?te.length:t.id===r.IKIGAI?B.length:A.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 min-w-fit py-3 px-4 rounded-xl border-none text-sm cursor-pointer flex items-center justify-center gap-2 transition-all ${j?"bg-white text-slate-900 font-semibold shadow-md":"bg-transparent text-slate-500 font-medium hover:bg-white/50"}`,children:[e.jsx(u,{size:18}),e.jsx("span",{children:t.label}),e.jsx("span",{className:`py-0.5 px-2 rounded-xl text-xs font-semibold min-w-[24px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsxs("div",{className:"lg:hidden mx-4 mb-4",children:[e.jsx("div",{className:"flex gap-2 justify-center mb-3",children:qe.map(t=>{const u=t.icon,j=c===t.id,v=t.id===r.SIMULATOR?z.length:t.id===r.VIDEO?I.length:t.id===r.BRIEFINGS?N.length:t.id===r.DECISIONS?te.length:t.id===r.IKIGAI?B.length:A.length;return e.jsxs("button",{onClick:()=>D(t.id),className:`flex-1 max-w-[80px] py-3 px-2 rounded-xl border-2 cursor-pointer flex flex-col items-center justify-center gap-1 transition-all ${j?"bg-white shadow-md border-indigo-500":"bg-slate-100 border-transparent hover:bg-white/60"}`,children:[e.jsx(u,{size:20,className:j?"text-indigo-500":"text-slate-500"}),e.jsx("span",{className:`py-0.5 px-1.5 rounded-lg text-[11px] font-semibold min-w-[20px] text-center ${j?"bg-indigo-500 text-white":"bg-slate-200 text-slate-500"}`,children:v})]},t.id)})}),e.jsx("div",{className:"text-center text-[15px] font-semibold text-slate-900 py-2 px-4 bg-white rounded-xl shadow-sm",children:qe.find(t=>t.id===c)?.label})]}),e.jsxs("div",{className:"hidden sm:flex justify-center lg:justify-end flex-wrap gap-3 mx-6 mb-6",children:[e.jsx(X,{variant:"outline",onClick:Oe,disabled:ee,title:"Aktualisieren",children:e.jsx(us,{className:`w-4 h-4 ${ee?"animate-spin":""}`})}),h&&e.jsxs(X,{onClick:()=>{const t={[r.BRIEFINGS]:"smart_briefing",[r.DECISIONS]:"decision_board",[r.IKIGAI]:"ikigai",[r.SIMULATOR]:"simulator",[r.VIDEO]:"video_training",[r.ROLEPLAY]:"dashboard"};h(t[c]||"overview")},children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),c===r.BRIEFINGS?"Neues Briefing":c===r.DECISIONS?"Neue Entscheidungs-Analyse":c===r.IKIGAI?"Neue Ikigai-Analyse":c===r.SIMULATOR?"Neues Szenario-Training":c===r.VIDEO?"Neue Wirkungs-Analyse":"Neue Live-Simulation"]})]}),e.jsx("div",{className:"mx-4 sm:mx-6",children:ls.length===0?e.jsxs(U,{className:"text-center py-16 px-6 rounded-2xl shadow-card",children:[c===r.SIMULATOR&&e.jsx($e,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===r.ROLEPLAY&&e.jsx(be,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===r.VIDEO&&e.jsx(Ce,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===r.BRIEFINGS&&e.jsx(Ye,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===r.DECISIONS&&e.jsx(_e,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),c===r.IKIGAI&&e.jsx(Ee,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-slate-600 mb-2",children:["Noch keine ",c===r.SIMULATOR?"Szenario-Trainings":c===r.VIDEO?"Wirkungs-Analysen":c===r.BRIEFINGS?"Smart Briefings":c===r.DECISIONS?"Entscheidungs-Analysen":c===r.IKIGAI?"Ikigai-Analysen":"Live-Simulationen"]}),e.jsx("p",{className:"text-slate-500 mb-6",children:c===r.BRIEFINGS?"Erstelle dein erstes Briefing, um dich optimal vorzubereiten.":c===r.DECISIONS?"Nutze den Entscheidungs-Kompass, um deine erste Entscheidung zu analysieren.":c===r.IKIGAI?"Entdecke deinen idealen Karrierepfad mit dem Ikigai-Kompass.":"Starte dein erstes Training, um hier deine Fortschritte zu sehen."}),e.jsxs(X,{onClick:()=>{if(h){const t={[r.BRIEFINGS]:"smart_briefing",[r.DECISIONS]:"decision_board",[r.IKIGAI]:"ikigai",[r.SIMULATOR]:"simulator",[r.VIDEO]:"video_training",[r.ROLEPLAY]:"dashboard"};h(t[c]||"overview")}else s?.()},children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),c===r.BRIEFINGS?"Briefing erstellen":c===r.DECISIONS?"Entscheidung analysieren":c===r.IKIGAI?"Ikigai entdecken":"Training starten"]})]}):e.jsx(C.div,{className:"flex flex-col gap-3",initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},children:c===r.BRIEFINGS?N.map(t=>e.jsx(Lt,{briefing:t,onClick:()=>Cs(t),onDelete:ts},t.id)):c===r.DECISIONS?te.map(t=>e.jsx(Tt,{decision:t,onClick:()=>Ls(t),onDelete:as},t.id)):c===r.IKIGAI?B.map(t=>e.jsx(Rt,{ikigai:t,onDelete:ns,onNavigate:()=>Os(t)},t.id)):ls.map(t=>{const u=Us[t.scenario_id];return e.jsx(Ot,{session:t,type:c,scenario:u,onClick:()=>Ps(t),onContinueSession:d,onDeleteSession:Ge},t.id)})})})]})};export{ca as SESSION_TABS,oa as default};
