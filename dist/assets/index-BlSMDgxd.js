import{j as e,f as Q,i as Ct,g as X,a as Ae,l as te,ai as _t,w as At,aj as Et,B as it,v as Ee,x as Ze,C as ze,ae as Ce,O as lt,e as ot,z as pe,I as ge,M as he,a7 as zt,aa as ct,T as dt,y as Z,_ as We,ak as ut,h as Oe,a2 as Mt,L as Ke,a3 as Ft,a4 as Ge,a5 as Tt,A as $t,m as Rt,J as It,E as Ve,al as Bt,a1 as be,am as Pe,b as xt,X as Lt,q as Dt,a0 as qt}from"./ui-vendor-CgXEyNXi.js";import{a as s,d as mt}from"./react-vendor-uDOJF2jQ.js";import{i as Ot,F as Vt,g as Pt,a as Zt,C as Be,j as _e,u as ht,w as U,k as Wt}from"./FeatureInfoButton-BUfqVR8e.js";import{S as Kt}from"./ScenarioDashboard-XeZFBipX.js";import{u as ce}from"./useBranding-CHnx5Uxf.js";import{u as Gt}from"./useMobile-YxjH166V.js";import{P as Qt}from"./progress-bar-CyP7P_HM.js";import{A as Ut,M as pt,a as gt}from"./MicrophoneTestDialog-BayuTD9w.js";import{D as Ht}from"./DeviceSettingsDialog-BlRrTbjP.js";import{F as bt}from"./fullscreen-loader-XqMT4pXm.js";import{B as oe,C as ke}from"./Button-j0YrfSxa.js";import"./select-native-BxSPgKHW.js";import"./dialog-dwOizz02.js";import{u as Jt}from"./Confetti-CkXDiOMv.js";import{D as Xt}from"./DynamicFormField-5GP3wJIq.js";import"./ScenarioCard-tJV8vFzZ.js";import"./utils-BEHD0UYf.js";import"./DeviceSetupPage-SATOB3io.js";import"./index-CklPxmEV.js";const et="[SIMULATOR_DASHBOARD]",Yt={briefcase:it,banknote:Et,user:At,presentation:_t,target:te,mic:Q},es=async()=>{const t=await fetch(`${Pt()}/simulator/scenarios`,{headers:{"X-WP-Nonce":Zt()},credentials:"same-origin"});if(!t.ok)throw new Error("Fehler beim Laden der Szenarien");const a=await t.json();if(a.success&&a.data?.scenarios)return a.data.scenarios;throw new Error("Keine Szenarien gefunden")},ts=t=>Yt[t.icon]||it,ss=t=>[{text:`${t.question_count_min}-${t.question_count_max} Fragen`},{icon:X,text:`${Math.round(t.time_limit_per_question/60)} Min/Frage`}],tt=({onSelectScenario:t,isAuthenticated:a,requireAuth:o,setPendingScenario:c,onNavigateToHistory:r})=>(s.useEffect(()=>(console.log(`${et} ðŸ”µ MOUNT`),()=>{console.log(`${et} ðŸ”´ UNMOUNT`)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(Ot,{featureId:"simulator",showOnMount:!0}),e.jsx(Kt,{title:"Szenario-Training",subtitle:"Trainiere wichtige Karriere-Skills mit KI-Feedback",headerIcon:Ae,headerActions:e.jsx(Vt,{featureId:"simulator",size:"sm"}),fetchScenarios:es,moduleKey:"simulator",historyButtonLabel:"Meine Szenario-Trainings",onNavigateToHistory:r,onSelectScenario:t,renderCardMeta:ss,getIconForScenario:ts,cardActionLabel:"Starten",cardActionIcon:Ct,categoryField:"category",emptyStateIcon:Q,emptyStateTitle:"Keine Trainingsszenarien verfÃ¼gbar.",searchPlaceholder:"Szenarien durchsuchen...",isAuthenticated:a,requireAuth:o,setPendingScenario:c,loadingMessage:"Szenarien werden geladen..."})]})),ns=({field:t,value:a,onChange:o,error:c,focusColor:r,branding:n})=>{const w=r||Be.blue[400],_="w-full rounded-lg text-base outline-none transition-all",g="px-4 py-3",b=c?"border-2 border-red-500":"border-2 border-slate-200",u={borderColor:w,boxShadow:`0 0 0 3px ${w}1a`},N=i=>{Object.assign(i.target.style,u),setTimeout(()=>{const v=i.target;if(v){const j=v.closest("div");j&&j.scrollIntoView({behavior:"smooth",block:"center"})}},300)},M=i=>{i.target.style.borderColor=c?Be.red[500]:Be.slate[200],i.target.style.boxShadow="none"},x=()=>{const i=`${_} ${g} ${b} text-slate-900 bg-white`;switch(t.type){case"text":return e.jsx("input",{type:"text",value:a||"",onChange:v=>o(t.key,v.target.value),placeholder:t.placeholder||"",className:i,onFocus:N,onBlur:M});case"textarea":return e.jsx("textarea",{value:a||"",onChange:v=>o(t.key,v.target.value),placeholder:t.placeholder||"",rows:4,className:`${i} resize-vertical min-h-[100px]`,onFocus:N,onBlur:M});case"select":return e.jsxs("select",{value:a||t.default||"",onChange:v=>o(t.key,v.target.value),className:`${i} cursor-pointer appearance-none pr-11`,style:{backgroundImage:`url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`,backgroundPosition:"right 12px center",backgroundRepeat:"no-repeat",backgroundSize:"20px"},onFocus:N,onBlur:M,children:[e.jsx("option",{value:"",children:"Bitte wÃ¤hlen..."}),t.options?.slice().sort((v,j)=>v.label.localeCompare(j.label,"de")).map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))]});case"number":return e.jsx("input",{type:"number",value:a||"",onChange:v=>o(t.key,v.target.value),placeholder:t.placeholder||"",min:t.validation?.min,max:t.validation?.max,className:i,onFocus:N,onBlur:M});default:return e.jsx("input",{type:"text",value:a||"",onChange:v=>o(t.key,v.target.value),placeholder:t.placeholder||"",className:i,onFocus:N,onBlur:M})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block mb-2 text-sm font-semibold text-slate-700",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),x(),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-500 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),c]}),t.hint&&!c&&e.jsxs("p",{className:"mt-1.5 text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),t.hint]})]})},rs=({scenario:t,onBack:a,onNext:o})=>{const[c,r]=s.useState({}),[n,w]=s.useState({}),[_,g]=s.useState([]),[b,u]=s.useState(!1),N=ce(),M=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const m=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(m)?m.filter(h=>h.user_input!==!1):[]}catch(m){return console.error("Error parsing input_configuration:",m),[]}},[t?.input_configuration]);s.useEffect(()=>{const m={};M.forEach(h=>{h.default&&(m[h.key]=h.default)}),r(m)},[M]);const x=(m,h)=>{r(l=>({...l,[m]:h})),n[m]&&w(l=>{const f={...l};return delete f[m],f})},i=()=>{g(m=>[...m,{key:"",value:""}])},v=(m,h,l)=>{g(f=>{const y=[...f];return y[m]={...y[m],[h]:l},y})},j=m=>{g(h=>h.filter((l,f)=>f!==m))},F=()=>{const m={};return M.forEach(h=>{const l=c[h.key];if(h.required&&(!l||l.trim()==="")){m[h.key]="Dieses Feld ist erforderlich";return}if(!(!l||l.trim()==="")&&h.validation){const{minLength:f,maxLength:y,min:k,max:E,pattern:I}=h.validation;f&&l.length<f&&(m[h.key]=`Mindestens ${f} Zeichen erforderlich`),y&&l.length>y&&(m[h.key]=`Maximal ${y} Zeichen erlaubt`),k!==void 0&&Number(l)<k&&(m[h.key]=`Mindestens ${k}`),E!==void 0&&Number(l)>E&&(m[h.key]=`Maximal ${E}`),I&&!new RegExp(I).test(l)&&(m[h.key]="UngÃ¼ltiges Format")}}),w(m),Object.keys(m).length===0},L=m=>{if(m.preventDefault(),!F())return;const h={...c};_.forEach(l=>{l.key&&l.value&&(h[l.key]=l.value)}),o(h)};return s.useEffect(()=>{M.length===0&&o({})},[M,o]),M.length===0?null:e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent text-slate-600 text-sm cursor-pointer rounded-lg transition-colors hover:bg-slate-100",children:[e.jsx(Ee,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:N.headerGradient},children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 m-0",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 m-0 mt-1",children:"Personalisiere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-lg bg-slate-100 mb-6",children:e.jsx("p",{className:"text-sm text-slate-700 m-0 leading-relaxed",children:t.description})}),e.jsxs("form",{onSubmit:L,children:[M.map(m=>e.jsx(ns,{field:m,value:c[m.key],onChange:x,error:n[m.key],focusColor:N.primaryAccent,branding:N},m.key)),t?.allow_custom_variables&&e.jsxs("div",{className:"mt-5 mb-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>u(!b),className:"flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left",style:{marginBottom:b?N.space[4]:"0"},children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[b?e.jsx(Ze,{size:18}):e.jsx(ze,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-snug",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),b&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 m-0 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in das Training einflieÃŸen sollen."}),_.length>0&&e.jsx("div",{className:"mb-3",children:_.map((m,h)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:m.key||"",onChange:l=>v(h,"key",l.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"p-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 flex-1 mr-2"}),e.jsx("button",{type:"button",onClick:()=>j(h),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:16})})]}),e.jsx("textarea",{value:m.value||"",onChange:l=>v(h,"value",l.target.value),placeholder:"Wert der Variable...",rows:2,className:"w-full p-2 px-3 rounded-lg border border-slate-200 text-sm resize-vertical"})]},h))}),e.jsxs("button",{type:"button",onClick:i,className:"flex items-center gap-2 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-600 text-sm cursor-pointer w-full justify-center",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-lg mt-6 mb-6 flex gap-5 flex-wrap",style:{backgroundColor:N.primaryAccentLight},children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:["Weiter",e.jsx(ot,{className:"w-5 h-5"})]})]})]})},ve=({score:t,label:a,size:o="normal",variant:c="default"})=>{const r=t!=null?t*10:null,w=(g=>c==="white"?"bg-white/20 border-white text-white":g>=80?"bg-green-50 border-green-500 text-green-600":g>=60?"bg-blue-50 border-blue-500 text-blue-600":g>=40?"bg-amber-50 border-amber-500 text-amber-600":"bg-red-50 border-red-500 text-red-600")(r),_=o==="large";return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`
        ${_?"w-20 h-20":"w-14 h-14"}
        rounded-full border-3 flex items-center justify-center
        ${w}
      `,children:e.jsx("span",{className:`
          ${_?"text-3xl":"text-2xl"}
          font-bold
        `,children:r!=null?Math.round(r):"-"})}),e.jsx("span",{className:`
        ${_?"text-sm":"text-xs"}
        ${c==="white"?"text-white":"text-slate-600"}
        font-medium
      `,children:a})]})},le=({title:t,icon:a,children:o,defaultOpen:c=!0})=>{const[r,n]=s.useState(c);return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white overflow-hidden mb-4 shadow-sm",children:[e.jsxs("button",{onClick:()=>n(!r),className:"w-full px-6 py-4 flex items-center justify-between border-none bg-transparent cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t})]}),r?e.jsx(Ze,{className:"w-5 h-5 text-slate-400"}):e.jsx(ze,{className:"w-5 h-5 text-slate-400"})]}),r&&e.jsx("div",{className:"px-6 pb-6 border-t border-slate-100 pt-4",children:o})]})},Le=({text:t,type:a})=>{const o={strength:{icon:ct,iconClass:"text-green-600",bgClass:"bg-green-50"},improvement:{icon:dt,iconClass:"text-amber-600",bgClass:"bg-amber-50"},tip:{icon:Z,iconClass:"text-blue-600",bgClass:"bg-blue-50"}},{icon:c,iconClass:r,bgClass:n}=o[a]||o.tip;return e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${n} mb-2`,children:[e.jsx(c,{className:`w-5 h-5 ${r} flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-sm text-slate-700 leading-relaxed",children:t})]})},as=({metrics:t})=>{if(!t)return null;const o=(r=>{switch(r){case"optimal":return{label:"Optimal",colorClass:"text-green-600"};case"zu_schnell":return{label:"Zu schnell",colorClass:"text-amber-600"};case"zu_langsam":return{label:"Zu langsam",colorClass:"text-amber-600"};default:return{label:r||"N/A",colorClass:"text-slate-400"}}})(t.speech_rate),c=r=>{switch(r){case"niedrig":return"text-green-600";case"mittel":return"text-amber-600";case"hoch":return"text-red-600";default:return"text-slate-400"}};return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Sprechtempo"}),e.jsx("span",{className:`text-lg font-semibold ${o.colorClass}`,children:o.label})]}),t.filler_words&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"FÃ¼llwÃ¶rter"}),e.jsxs("span",{className:`text-lg font-semibold ${c(t.filler_words.severity)}`,children:[t.filler_words.count||0,t.filler_words.words?.length>0&&e.jsxs("span",{className:"text-xs font-normal ml-2",children:["(",t.filler_words.words.slice(0,3).join(", "),")"]})]})]}),t.confidence_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Selbstbewusstsein"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.confidence_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.confidence_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.confidence_score,"%"]})]})]}),t.clarity_score!==void 0&&e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50",children:[e.jsx("span",{className:"text-xs text-slate-500 block mb-1",children:"Klarheit"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.clarity_score>=70?"bg-green-500":"bg-amber-500"}`,style:{width:`${t.clarity_score}%`}})}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700",children:[t.clarity_score,"%"]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2 p-4 rounded-xl bg-blue-50 text-sm text-slate-700 leading-relaxed",children:["ðŸ’¡ ",t.notes]})]})},is=({audioUrl:t})=>{const a=s.useRef(null),[o,c]=s.useState(!1),[r,n]=s.useState(0),[w,_]=s.useState(0),[g,b]=s.useState(!0),[u,N]=s.useState(null);s.useEffect(()=>{if(!t)return;b(!0),N(null);const j=new Audio;a.current=j,j.preload="auto";const F=()=>{const f=j.duration;f&&isFinite(f)&&f>0&&_(f)},L=()=>{if(F(),b(!1),!isFinite(j.duration)||j.duration===0){const f=j.currentTime;j.currentTime=Number.MAX_SAFE_INTEGER,setTimeout(()=>{F(),j.currentTime=f},100)}},m=()=>{b(!1),F()},h=()=>{F()},l=()=>{n(j.currentTime),F()};return j.addEventListener("loadedmetadata",L),j.addEventListener("canplaythrough",m),j.addEventListener("durationchange",h),j.addEventListener("timeupdate",l),j.addEventListener("play",()=>c(!0)),j.addEventListener("pause",()=>c(!1)),j.addEventListener("ended",()=>c(!1)),j.addEventListener("error",()=>{N("Audio nicht verfÃ¼gbar"),b(!1)}),j.src=t,j.load(),()=>{j.pause(),j.src=""}},[t]);const M=()=>{a.current&&(o?a.current.pause():a.current.play())},x=j=>{const F=j.currentTarget.getBoundingClientRect(),L=(j.clientX-F.left)/F.width;a.current&&w>0&&(a.current.currentTime=L*w)},i=j=>{a.current&&(a.current.currentTime=Math.max(0,Math.min(a.current.currentTime+j,w)))};if(!t)return null;if(u)return e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(pe,{size:16})," ",u]});const v=w>0?r/w*100:0;return e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("div",{onClick:x,className:"h-1.5 bg-slate-200 rounded-full cursor-pointer mb-3",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${v}%`}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>i(-10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Mt,{size:20})}),e.jsx("button",{onClick:M,disabled:g,className:`w-11 h-11 rounded-full bg-blue-500 hover:bg-blue-600 border-none flex items-center justify-center text-white shadow-md transition-all ${g?"cursor-wait opacity-70":"cursor-pointer"}`,children:g?e.jsx(Ke,{size:20,className:"animate-spin"}):o?e.jsx(Ft,{size:20,fill:"white"}):e.jsx(Ge,{size:20,fill:"white",className:"ml-0.5"})}),e.jsx("button",{onClick:()=>i(10),className:"bg-transparent border-none cursor-pointer p-1.5 text-slate-500 hover:text-slate-700 flex items-center transition-colors",children:e.jsx(Tt,{size:20})})]}),e.jsxs("div",{className:"text-center mt-2 text-xs text-slate-500",children:[_e(r)," / ",_e(w)]})]})},ls=({transcript:t,feedback:a,audioMetrics:o,audioUrl:c,onRetry:r,onNext:n,onComplete:w,isLastQuestion:_,hideButtons:g=!1})=>{const b=typeof a=="string"?JSON.parse(a):a;return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-start gap-5 mb-6 p-6 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-2xl shadow-lg",children:[e.jsx(ve,{score:b?.scores?.overall,label:"Gesamt",size:"large",variant:"white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Feedback zu deiner Antwort"}),e.jsx("p",{className:"text-sm text-blue-50 leading-relaxed",children:b?.summary||"Deine Antwort wurde analysiert."})]})]}),b?.scores&&e.jsxs("div",{className:"flex justify-center gap-8 p-4 mb-4 bg-white rounded-2xl shadow-sm",children:[e.jsx(ve,{score:b.scores.content,label:"Inhalt"}),e.jsx(ve,{score:b.scores.structure,label:"Struktur"}),e.jsx(ve,{score:b.scores.relevance,label:"Relevanz"})]}),e.jsx(le,{title:"Transkript",icon:he,defaultOpen:!0,children:e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 italic text-slate-700 leading-relaxed text-sm",children:['"',t||"Keine Transkription verfÃ¼gbar.",'"']})}),c&&e.jsx(le,{title:"Deine Aufnahme",icon:zt,defaultOpen:!0,children:e.jsx(is,{audioUrl:c})}),b?.strengths?.length>0&&e.jsx(le,{title:"StÃ¤rken",icon:ct,defaultOpen:!0,children:b.strengths.map((u,N)=>e.jsx(Le,{text:u,type:"strength"},N))}),b?.improvements?.length>0&&e.jsx(le,{title:"Verbesserungen",icon:dt,defaultOpen:!0,children:b.improvements.map((u,N)=>e.jsx(Le,{text:u,type:"improvement"},N))}),b?.tips?.length>0&&e.jsx(le,{title:"Tipps",icon:Z,defaultOpen:!0,children:b.tips.map((u,N)=>e.jsx(Le,{text:u,type:"tip"},N))}),o&&e.jsx(le,{title:"Sprechanalyse",icon:Q,defaultOpen:!0,children:e.jsx(as,{metrics:o})}),!g&&e.jsxs("div",{className:"flex gap-3 mt-6 justify-end flex-wrap",children:[r&&e.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-2 border-slate-300 bg-white text-slate-700 text-sm font-semibold cursor-pointer transition-all hover:border-blue-500 hover:text-blue-600 shadow-sm",children:[e.jsx(We,{className:"w-4 h-4"}),"Nochmal versuchen"]}),e.jsx("button",{onClick:_?w:n,className:"flex items-center gap-2 px-6 py-3.5 rounded-xl border-none bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-sm font-semibold cursor-pointer shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4"}),"Training abschlieÃŸen"]}):e.jsxs(e.Fragment,{children:["NÃ¤chste Frage",e.jsx(Oe,{className:"w-4 h-4"})]})})]})]})},os=({tips:t,primaryAccent:a,tipsLabel:o,branding:c})=>{const r=ce(),n=c||r,[w,_]=s.useState(!0);return!t||t.length===0?null:e.jsxs("div",{style:{background:n.cardBg,borderRadius:n.radius.xl,border:`1px solid ${n.borderColor}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>_(!w),style:{width:"100%",padding:`${n.space[4]} ${n.space[6]}`,background:"none",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:n.space[2],fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:n.textMain},children:[e.jsx(Z,{size:n.iconSize.md,color:a}),o||"Tipps fÃ¼r diese Frage"]}),e.jsx(ze,{size:n.iconSize.md,color:n.textMuted,style:{transform:w?"rotate(180deg)":"none",transition:n.transition.normal}})]}),e.jsx($t,{children:w&&e.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},style:{overflow:"hidden"},children:e.jsx("div",{style:{padding:`0 ${n.space[6]} ${n.space[6]}`},children:t.map((g,b)=>e.jsxs("div",{style:{display:"flex",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.md,backgroundColor:n.warningLight,marginBottom:b<t.length-1?n.space[2]:0},children:[e.jsx(Z,{style:{width:n.iconSize.sm,height:n.iconSize.sm,color:n.warning,flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:n.fontSize.base,color:n.textSecondary,margin:0,lineHeight:1.5},children:g.replace(/^Tipp \d+:\s*/i,"")})]},b))})})})]})},cs=({seconds:t,maxSeconds:a,isRecording:o,branding:c})=>{const r=ce(),n=c||r,w=a>0?t/a*100:0,_=w>75,g=w>90;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n.space[3],padding:`${n.space[3]} ${n.space[4]}`,borderRadius:n.radius.lg,backgroundColor:g?n.errorLight:_?n.warningLight:n.cardBgHover},children:[e.jsx(X,{style:{width:n.iconSize.lg,height:n.iconSize.lg,color:g?n.error:_?n.warning:n.textSecondary}}),e.jsx("span",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.semibold,fontFamily:"monospace",color:g?n.error:_?n.warning:n.textSecondary},children:_e(t)}),e.jsxs("span",{style:{fontSize:n.fontSize.base,color:n.textMuted},children:["/ ",_e(a)]})]})},st=({onRecordingComplete:t,timeLimit:a,disabled:o,deviceId:c,themedGradient:r,primaryAccent:n,isSubmitting:w,labels:_,onOpenSettings:g,branding:b,isMobile:u,onStreamChange:N})=>{const M=ce(),x=b||M,[i,v]=s.useState("idle"),[j,F]=s.useState(0),[L,m]=s.useState(0),[h,l]=s.useState(!1),f=s.useRef(null),y=s.useRef([]),k=s.useRef(null),E=s.useRef(null),I=s.useRef(null),z=s.useRef(null),q=s.useRef(null),p=s.useRef(0),d=s.useRef(!1);s.useEffect(()=>()=>{S()},[]),s.useEffect(()=>{i==="recording"&&j>=a&&O()},[j,a,i]);const S=()=>{k.current&&clearInterval(k.current),z.current&&cancelAnimationFrame(z.current),E.current&&(E.current.close(),E.current=null),q.current&&(q.current.getTracks().forEach(R=>R.stop()),q.current=null,N&&N(null))},T=async()=>{try{l(!1),y.current=[],F(0);let R;const ne={audio:c?{deviceId:{exact:c}}:!0};try{R=await navigator.mediaDevices.getUserMedia(ne)}catch(D){throw console.error("[SIMULATOR] Selected device unavailable:",D),D.name==="OverconstrainedError"||D.name==="NotFoundError"?(l(!1),new Error("Das ausgewÃ¤hlte Mikrofon ist nicht verfÃ¼gbar. Bitte wÃ¤hle ein anderes Mikrofon in den Einstellungen.")):D}q.current=R,N&&N(R),E.current=new(window.AudioContext||window.webkitAudioContext),I.current=E.current.createAnalyser(),E.current.createMediaStreamSource(R).connect(I.current),I.current.fftSize=256;const de=()=>{if(I.current&&d.current){const D=new Uint8Array(I.current.frequencyBinCount);I.current.getByteFrequencyData(D);const Me=D.reduce((re,Fe)=>re+Fe)/D.length;m(Me/255)}z.current=requestAnimationFrame(de)};d.current=!0,de();const K=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4";f.current=new MediaRecorder(R,{mimeType:K}),f.current.ondataavailable=D=>{D.data.size>0&&y.current.push(D.data)},f.current.onstop=()=>{const D=new Blob(y.current,{type:K});t(D,p.current)},f.current.start(1e3),v("recording"),k.current=setInterval(()=>{F(D=>D+1)},1e3)}catch(R){console.error("Error starting recording:",R),(R.name==="NotAllowedError"||R.name==="PermissionDeniedError")&&l(!0)}},$=()=>{f.current&&f.current.state==="recording"&&(f.current.pause(),v("paused"),d.current=!1,k.current&&(clearInterval(k.current),k.current=null),m(0))},C=()=>{f.current&&f.current.state==="paused"&&(f.current.resume(),v("recording"),d.current=!0,k.current=setInterval(()=>{F(R=>R+1)},1e3))},O=()=>{p.current=j,d.current=!1,k.current&&(clearInterval(k.current),k.current=null),z.current&&(cancelAnimationFrame(z.current),z.current=null),E.current&&(E.current.close(),E.current=null),f.current&&f.current.state!=="inactive"&&f.current.stop(),q.current&&(q.current.getTracks().forEach(R=>R.stop()),q.current=null),v("idle"),m(0),F(0)},B=()=>{i==="idle"?T():i==="recording"?$():i==="paused"&&C()};if(h)return e.jsxs("div",{className:"p-6 rounded-2xl text-center",style:{backgroundColor:x.errorLight},children:[e.jsx(It,{className:"w-12 h-12 mb-3 mx-auto",style:{color:x.error}}),e.jsx("p",{className:"font-semibold m-0",style:{color:x.error},children:"Mikrofonzugriff verweigert"}),e.jsx("p",{className:"text-sm mt-2",style:{color:x.textSecondary},children:"Bitte erlaube den Zugriff auf dein Mikrofon in den Browser-Einstellungen."})]});const se=()=>{const R={display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:u?"14px 20px":"14px 28px",borderRadius:"12px",border:"none",color:"white",fontSize:u?"15px":"16px",fontWeight:600,cursor:o||w?"not-allowed":"pointer",flex:u?1:"none"};return o||w?{...R,background:x.borderColor,boxShadow:"none"}:i==="idle"?{...R,background:x.error,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:i==="recording"?{...R,background:x.warning,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}:{...R,background:x.success,boxShadow:"0 4px 14px rgba(0, 0, 0, 0.2)"}};return e.jsxs("div",{className:"p-6 rounded-2xl relative",style:{backgroundColor:x.cardBg,border:`1px solid ${x.borderColor}`},children:[u&&e.jsx("button",{onClick:g,className:"absolute top-3 right-3 p-2.5 rounded-xl flex items-center justify-center",style:{background:x.cardBgHover,border:`1px solid ${x.borderColor}`},children:e.jsx(Ve,{size:18,style:{color:x.textMuted}})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(cs,{seconds:j,maxSeconds:a,isRecording:i==="recording",branding:x})}),i==="recording"&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{audioLevel:L,isActive:!0,variant:"bars",size:"sm",accentColor:n})}),i==="paused"&&e.jsxs("div",{className:"flex justify-center items-center gap-2 h-[60px] mb-6",style:{color:x.warning},children:[e.jsx(Q,{size:24}),e.jsx("span",{className:"text-base font-semibold",children:"Aufnahme pausiert"})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[!u&&e.jsx("button",{onClick:g,className:"p-3.5 rounded-xl flex items-center justify-center",style:{background:x.cardBgHover,border:`1px solid ${x.borderColor}`},children:e.jsx(Ve,{size:20,style:{color:x.textMuted}})}),e.jsxs("button",{onClick:B,disabled:o||w,style:se(),children:[i==="idle"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Aufnahme starten"]}),i==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx(Bt,{className:"w-[18px] h-[18px]"}),"Pausieren"]}),i==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-[18px] h-[18px]"}),"Fortsetzen"]})]}),(i==="recording"||i==="paused")&&e.jsxs("button",{onClick:O,className:"flex items-center justify-center gap-2 rounded-xl border-none font-semibold cursor-pointer",style:{padding:u?"14px 16px":"14px 24px",flex:u?1:"none",backgroundColor:x.cardBgHover,color:x.textMain,fontSize:u?"15px":"16px"},children:[e.jsx(be,{className:"w-[18px] h-[18px]",style:{color:x.success}}),_?.submitButton||"Antwort abgeben"]})]}),i==="idle"&&!w&&e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:x.textMuted},children:_?.submitHint||"Klicke auf den Button, um deine Antwort aufzunehmen"}),w&&e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(Ke,{className:"w-8 h-8 animate-spin",style:{color:n}}),e.jsx("p",{className:"mt-3 text-sm",style:{color:x.textSecondary},children:_?.analyzing||"Antwort wird analysiert..."})]})]})},nt={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Pe,info:ge,settings:Ve,check:be,Target:te,Clock:X,Mic:Q,MessageSquare:he,Lightbulb:Z,Brain:Pe},ds=({scenario:t,variables:a,questions:o,onStart:c,onBack:r,selectedMicrophoneId:n,onMicrophoneChange:w,onMicrophoneTest:_,themedGradient:g,primaryAccent:b,primaryAccentLight:u,isLoading:N,branding:M})=>{const x=ce(),i=M||x,v=t?.mode==="SIMULATION",j=v?"Situationen":"Fragen",F=v?"Zeit pro Situation":"Zeit pro Frage",L=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele aus deiner Erfahrung."},{icon:X,title:"Zeit im Blick behalten",description:`Du hast ${Math.round((t.time_limit_per_question||120)/60)} Minuten pro ${v?"Situation":"Frage"}. ${v?"Reagiere":"Antworte"} prÃ¤zise, aber ausfÃ¼hrlich genug.`},{icon:Q,title:"Klar und deutlich sprechen",description:"Sprich in normalem Tempo. Kurze Pausen zum Nachdenken sind vÃ¶llig in Ordnung."},{icon:he,title:"Konkrete Beispiele nennen",description:"Belege deine Aussagen mit konkreten Beispielen und Zahlen wo mÃ¶glich."}],m=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((y,k)=>typeof y=="string"?{icon:Z,title:`Tipp ${k+1}`,description:y}:{icon:nt[y.icon]||nt[y.icon?.toLowerCase()]||Z,title:y.title||`Tipp ${k+1}`,description:y.text||y.description||""}):L,h=s.useMemo(()=>{if(!t?.input_configuration)return{};try{const y=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(y)?y.reduce((k,E)=>(E.key&&E.label&&(k[E.key]=E.label),k),{}):{}}catch{return{}}},[t?.input_configuration]),l=a?Object.entries(a).filter(([y,k])=>k&&k.trim&&k.trim()!=="").map(([y,k])=>({label:h[y]||y.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),value:k})):[],f=y=>{if(!y||!a)return y;let k=y;return Object.entries(a).forEach(([E,I])=>{I&&(k=k.replace(new RegExp(`\\$\\{${E}\\}`,"g"),I),k=k.replace(new RegExp(`\\{${E}\\}`,"g"),I))}),k};return e.jsxs("div",{className:"p-6 max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-3 py-2 mb-4 border-none bg-transparent cursor-pointer rounded-lg hover:bg-slate-100 transition-colors",style:{color:i.textSecondary},children:[e.jsx(Ee,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:g},children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[28px] font-bold m-0",style:{color:i.textMain},children:"Vorbereitung"}),e.jsxs("p",{className:"text-base m-0 mt-1",style:{color:i.textSecondary},children:[t.title,o.length>0?` â€¢ ${o.length} ${j}`:""]})]})]})]}),t.long_description&&e.jsx("div",{className:"p-5 px-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:g},children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold m-0 mb-2",style:{color:i.textMain},children:"Deine Aufgabe"}),e.jsx("p",{className:"text-[15px] leading-relaxed m-0 whitespace-pre-wrap",style:{color:i.textSecondary},children:f(t.long_description?.replace(/\/n/g,`
`))})]})]})}),l.length>0&&e.jsxs("div",{className:"p-5 rounded-2xl mb-6",style:{backgroundColor:u},children:[e.jsx("h3",{className:"text-sm font-semibold m-0 mb-3 uppercase tracking-wide",style:{color:b},children:"Dein Profil"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:l.map((y,k)=>e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:y.label}),e.jsx("span",{className:"text-[15px] font-medium",style:{color:i.textMain},children:y.value})]},k))})]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px]",style:{color:b}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Mikrofon testen"})]}),e.jsx(pt,{selectedDeviceId:n,onDeviceChange:w,onTestClick:_})]}),e.jsxs("button",{onClick:c,disabled:N,className:"w-full py-[18px] px-7 rounded-xl border-none text-white text-lg font-semibold flex items-center justify-center gap-3 mb-6 disabled:cursor-not-allowed disabled:opacity-70 disabled:bg-slate-400 transition-all duration-200 hover:enabled:-translate-y-0.5 hover:enabled:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(Ge,{className:"w-6 h-6"}),"GesprÃ¤ch starten"]}),e.jsxs("div",{className:"p-6 rounded-2xl mb-6",style:{backgroundColor:i.cardBg,border:`1px solid ${i.borderColor}`},children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(Z,{className:"w-[22px] h-[22px]",style:{color:i.warning}}),e.jsx("h2",{className:"text-lg font-semibold m-0",style:{color:i.textMain},children:"Tipps fÃ¼r dein GesprÃ¤ch"})]}),e.jsx("div",{className:"flex flex-col gap-4",children:m.map((y,k)=>e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl",style:{backgroundColor:i.cardBgHover},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:u},children:e.jsx(y.icon,{className:"w-[22px] h-[22px]",style:{color:b}})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-semibold m-0 mb-1",style:{color:i.textMain},children:y.title}),e.jsx("p",{className:"text-sm m-0 leading-normal",style:{color:i.textSecondary},children:y.description})]})]},k))})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl flex gap-6 flex-wrap",style:{backgroundColor:i.cardBgHover},children:[o.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:j}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:o.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:F}),e.jsxs("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:[Math.round((t.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs block",style:{color:i.textMuted},children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold",style:{color:i.textMain},children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]})]})},us=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,totalCount:r,labels:n})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(xt,{size:24,className:"text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training beenden?"})]}),c>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-2",children:["Du hast ",e.jsx("strong",{children:n.answeredCount(c,r)})," beantwortet."]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["MÃ¶chtest du das Training jetzt mit den bisherigen Antworten abschlieÃŸen oder weitere ",n.questionsLabel," beantworten?"]})]}):e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:["Du hast noch keine ",n.questionsLabel," beantwortet. MÃ¶chtest du das Training wirklich beenden?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Weiter trainieren"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-green-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-green-500/30 hover:bg-green-600 transition-colors",children:"Training beenden"})]})]})}):null,xs=({isOpen:t,onClose:a,onConfirm:o,answeredCount:c,labels:r})=>t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1000]",onClick:a,children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[420px] w-[90%] shadow-2xl",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(pe,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0",children:"Training abbrechen?"})]}),e.jsxs("p",{className:"text-sm text-slate-600 leading-relaxed mb-6",children:[e.jsx("strong",{children:"Achtung:"})," Wenn du das Training abbrichst, werden alle deine bisherigen Antworten",c>0?` (${c} ${r.questionsLabel})`:""," ",e.jsx("strong",{children:"nicht gespeichert"})," und gehen verloren."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"ZurÃ¼ck"}),e.jsx("button",{onClick:o,className:"px-5 py-2.5 rounded-xl border-none bg-red-500 text-white text-sm font-semibold cursor-pointer shadow-md shadow-red-500/30 hover:bg-red-600 transition-colors",children:"Abbrechen"})]})]})}):null,ms=({number:t,size:a="md"})=>{const o={sm:"w-[26px] h-[26px] text-xs",md:"w-7 h-7 text-[13px]"};return e.jsx("div",{className:`${o[a]} rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white font-semibold flex-shrink-0 shadow-sm`,children:t})},De=({question:t,index:a,labels:o,isMobile:c})=>e.jsxs(ke,{className:c?"p-4":"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 md:mb-4",children:[e.jsx(ms,{number:a+1,size:c?"sm":"md"}),e.jsx("span",{className:"text-[13px] md:text-sm text-slate-500",children:t?.category||o.questionFallback})]}),e.jsx("h2",{className:`font-semibold text-slate-900 leading-relaxed ${c?"text-[15px]":"text-lg"} mb-0`,children:t?.question||o.questionLoading}),t?.estimated_answer_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[13px] md:text-sm mt-3 md:mt-4",children:[e.jsx(X,{size:c?14:16}),o.recommendedTime,": ca. ",Math.round(t.estimated_answer_time/60)," Min"]})]}),rt=({error:t,onRetry:a,isMobile:o})=>e.jsxs("div",{className:`flex flex-col items-center ${o?"p-4":"p-5 mt-4"} rounded-2xl bg-red-50 border border-red-200 shadow-sm`,children:[e.jsx(pe,{className:"w-6 h-6 text-red-500"}),e.jsx("p",{className:"mt-2 text-red-600 font-medium text-sm text-center",children:t}),e.jsx(oe,{variant:"danger",size:"sm",onClick:a,className:"mt-3",children:"Erneut versuchen"})]}),hs=({session:t,questions:a,scenario:o,variables:c,preloadedQuestions:r,onSessionCreated:n,onComplete:w,onExit:_,startFromQuestion:g=0,initialMicrophoneId:b})=>{const u=Gt(),[N,M]=s.useState(t),[x,i]=s.useState(a||[]),[v,j]=s.useState(!1),[F,L]=s.useState(null),{demoCode:m,branding:h}=ht(),l=o?.mode==="SIMULATION",f={questionLabel:l?"Situation / Aussage des GegenÃ¼bers:":"Interviewfrage:",questionFallback:l?"Situation":"Frage",questionLoading:l?"Situation wird geladen...":"Frage wird geladen...",answerPlaceholder:l?"Deine Reaktion...":"Deine Antwort...",submitButton:l?"Reaktion abgeben":"Antwort abgeben",submitHint:l?"Klicke auf den Button, um deine Reaktion aufzunehmen":"Klicke auf den Button, um deine Antwort aufzunehmen",analyzing:l?"Reaktion wird analysiert...":"Antwort wird analysiert...",questionCounter:(A,V)=>l?`Situation ${A} von ${V}`:`Frage ${A} von ${V}`,questionsCount:A=>l?`${A} Situationen`:`${A} Fragen`,answeredCount:(A,V)=>l?`${A} von ${V} Situationen`:`${A} von ${V} Fragen`,tipsLabel:l?"Tipps fÃ¼r diese Situation":"Tipps fÃ¼r diese Frage",nextButton:l?"NÃ¤chste Situation":"NÃ¤chste Frage",timePerQuestion:l?"Zeit pro Situation":"Zeit pro Frage",questionsLabel:l?"Situationen":"Fragen",recommendedTime:l?"Empfohlene Reaktionszeit":"Empfohlene Antwortzeit"},y=g>0,k=y?Array.from({length:g},(A,V)=>V):[],[E,I]=s.useState(y?"interview":"preparation"),[z,q]=s.useState(g||N?.current_question_index||0),[p,d]=s.useState(null),[S,T]=s.useState(!1),[$,C]=s.useState(!1),[O,B]=s.useState(null),[se,R]=s.useState([]),[ne,Qe]=s.useState(k),de="karriereheld_selected_microphone",[K,D]=s.useState(()=>{if(b)return b;try{return localStorage.getItem(de)||null}catch{return null}}),[Me,re]=s.useState(!1),[Fe,ue]=s.useState(!1),fe=s.useRef(null),je=s.useCallback(()=>{fe.current&&(fe.current.getTracks().forEach(A=>A.stop()),fe.current=null)},[]),Ue=s.useCallback(A=>{fe.current=A},[]);s.useEffect(()=>()=>{je()},[je]),s.useEffect(()=>{if(K)try{localStorage.setItem(de,K)}catch{}},[K]);const[ft,Te]=s.useState(!1),[jt,$e]=s.useState(!1),[ye,He]=s.useState(!1),[xe,we]=s.useState(null),[H,Je]=s.useState(!1),J=x[z],ae=z===x.length-1,Xe=z===0,Ye=async(A,V)=>{if(V<2){B("Die Aufnahme ist zu kurz. Bitte sprechen Sie mindestens 2 Sekunden.");return}if(A.size<5e3){console.warn("[SimulatorSession] Audio too small:",A.size,"bytes"),B("Die Aufnahme enthÃ¤lt keine verwertbaren Audiodaten. Bitte sprechen Sie wÃ¤hrend der Aufnahme und versuchen Sie es erneut.");return}C(!0),B(null);try{const P=await U.submitSimulatorAnswer(N.id,A,z,J.question,J.category,V);if(!P.success)throw new Error(P.message||"Fehler beim Analysieren der Antwort");if(d(P.data),T(!0),R(G=>[...G.filter(Y=>Y.questionIndex!==z),{questionIndex:z,feedback:P.data}]),Qe(G=>G.includes(z)?G:[...G,z]),l&&!H){He(!0),we(null);const G=ne.includes(z);try{const Y=await U.generateNextTurn(N.id);if(Y.success){const ie=Y.data.next_question;Y.data.is_finished?(we(ie),i(G?ee=>{const me=[...ee];return me[z+1]=ie,me.slice(0,z+2)}:ee=>[...ee,ie]),Je(!0)):(we(ie),G?(i(ee=>{const me=[...ee];return me[z+1]=ie,me.slice(0,z+2)}),Je(!1)):i(ee=>[...ee,ie]))}}catch(Y){console.error("Error generating next turn:",Y)}finally{He(!1)}}}catch(P){console.error("Error submitting answer:",P),B(P.message||"Ein Fehler ist aufgetreten")}finally{C(!1)}},Re=()=>{d(null),T(!1),B(null)},Ie=()=>{if(d(null),T(!1),B(null),l){if(xe){q(A=>A+1),we(null);return}if(H){Ne();return}}else ae||q(A=>A+1)},yt=()=>{d(null),T(!1),B(null),Xe||q(A=>A-1)},wt=()=>{Te(!0)},Ne=async()=>{Te(!1),ue(!1),re(!1),je();try{const A=await U.completeSimulatorSession(N.id);A.success?w(A.data):w({session:{...N,status:"completed"}})}catch(A){console.error("Error completing session:",A),w({session:{...N,status:"completed"}})}},Nt=()=>{$e(!0)},vt=()=>{$e(!1),ue(!1),re(!1),je(),_()},St=async()=>{if(N&&x.length>0){I("interview");return}j(!0),L(null);try{const A=await U.createSimulatorSession({scenario_id:o.id,variables:c,demo_code:m||null,questions:r||null});if(!A.success)throw new Error(A.message||"Fehler beim Erstellen der Session");const V=A.data.session;let P;if(r&&r.length>0)P=r,await U.updateSimulatorSessionQuestions(V.id,P);else{const G=await U.generateSimulatorQuestions(V.id);if(!G.success)throw new Error(G.message||"Fehler beim Generieren der Fragen");P=G.data.questions}M({...V,questions_json:P}),i(P),n&&n({session:{...V,questions_json:P},questions:P,selectedMicrophoneId:K}),I("interview")}catch(A){console.error("Error creating session:",A),L(A.message||"Ein Fehler ist aufgetreten")}finally{j(!1)}};if(E==="preparation")return e.jsxs(e.Fragment,{children:[e.jsx(ds,{scenario:o,variables:c,questions:x,onStart:St,onBack:_,selectedMicrophoneId:K,onMicrophoneChange:D,onMicrophoneTest:()=>re(!0),themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],primaryAccentLight:h?.["--primary-accent-light"],isLoading:v}),e.jsx(gt,{isOpen:Me,onClose:()=>re(!1),deviceId:K}),F&&e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl bg-red-50 border border-red-200 text-red-600 text-sm font-medium shadow-lg z-[100]",children:F}),e.jsx(bt,{isLoading:v,message:l?"Situationen werden generiert...":"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Inhalte basierend auf deinen Angaben."})]});const kt=S&&(l&&H&&!xe||!l&&ae);return e.jsxs("div",{className:`${u?"p-4":"p-6"} max-w-[1000px] mx-auto`,children:[e.jsxs("div",{className:`flex ${u?"flex-col gap-3":"flex-row justify-between items-center"} mb-6`,children:[e.jsx("h1",{className:`${u?"text-lg":"text-xl"} font-semibold text-slate-900`,children:o?.title}),e.jsxs("div",{className:`flex gap-2 items-center ${u?"justify-between":"justify-end"}`,children:[!kt&&e.jsxs("button",{onClick:wt,className:`${u?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-green-500 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-md hover:bg-green-600 hover:shadow-lg transition-all`,children:[e.jsx(xt,{size:16}),u?"Beenden":"Training beenden"]}),e.jsxs("button",{onClick:Nt,className:`${u?"flex-1 py-2.5 px-3.5":"py-2.5 px-4"} rounded-xl bg-slate-100 text-slate-600 text-sm font-semibold flex items-center justify-center gap-1.5 hover:bg-slate-200 transition-colors`,children:[e.jsx(Lt,{size:16}),"Abbrechen"]})]})]}),e.jsx(us,{isOpen:ft,onClose:()=>Te(!1),onConfirm:Ne,answeredCount:ne.length,totalCount:x.length,labels:f}),e.jsx(xs,{isOpen:jt,onClose:()=>$e(!1),onConfirm:vt,answeredCount:ne.length,labels:f}),!S&&!l&&e.jsxs("div",{className:`flex ${u?"gap-2":"gap-3"} justify-center mb-4`,children:[e.jsx(oe,{variant:"secondary",size:u?"sm":"md",icon:e.jsx(Dt,{size:16}),onClick:yt,disabled:Xe,className:u?"flex-1":"",children:"ZurÃ¼ck"}),e.jsx(oe,{variant:"secondary",size:u?"sm":"md",iconPosition:"right",icon:e.jsx(Oe,{size:16}),onClick:Ie,disabled:ae,className:u?"flex-1":"",children:u?"Ãœberspringen":"Frage Ã¼berspringen"})]}),e.jsx(Qt,{current:z,total:x.length,answeredQuestions:ne,primaryAccent:h?.["--primary-accent"],labels:f}),S?e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex gap-3 mb-4 justify-end",children:[o.allow_retry&&e.jsx(oe,{variant:"secondary",icon:e.jsx(We,{size:16}),onClick:Re,children:"Nochmal versuchen"}),e.jsxs(oe,{onClick:l?H&&!xe?Ne:Ie:ae?Ne:Ie,disabled:l&&ye&&!H,icon:ye?e.jsx(Ke,{size:16,className:"animate-spin"}):null,iconPosition:"left",children:[l&&ye&&!H?"GesprÃ¤chspartner tippt...":l?H&&!xe?"Training abschlieÃŸen":f.nextButton:ae?"Training abschlieÃŸen":f.nextButton,!ye&&!(l?H&&!xe:ae)&&e.jsx(Oe,{size:16,className:"ml-1"})]})]}),e.jsx(De,{question:J,index:z,labels:f,isMobile:u}),e.jsx("div",{className:"mt-4",children:e.jsx(ls,{transcript:p.transcript,feedback:p.feedback,audioMetrics:p.audio_analysis,audioUrl:p.audio_url,hideButtons:!0})})]}):e.jsxs("div",{className:`flex flex-col ${u?"gap-4":"gap-6"}`,children:[u?e.jsxs(e.Fragment,{children:[e.jsx(De,{question:J,index:z,labels:f,isMobile:!0}),e.jsx(st,{onRecordingComplete:Ye,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],isSubmitting:$,labels:f,onOpenSettings:()=>ue(!0),isMobile:!0,onStreamChange:Ue}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(st,{onRecordingComplete:Ye,timeLimit:o.time_limit_per_question||120,disabled:!1,deviceId:K,themedGradient:h?.["--button-gradient"]||h?.["--header-gradient"],primaryAccent:h?.["--primary-accent"],isSubmitting:$,labels:f,onOpenSettings:()=>ue(!0),isMobile:!1,onStreamChange:Ue}),O&&e.jsx(rt,{error:O,onRetry:Re,isMobile:!1})]}),e.jsx(De,{question:J,index:z,labels:f,isMobile:!1})]}),J?.tips&&J.tips.length>0&&e.jsx(os,{tips:J.tips,primaryAccent:h?.["--primary-accent"],tipsLabel:f.tipsLabel})]}),e.jsx(Ht,{isOpen:Fe,onClose:()=>ue(!1),mode:"audio",selectedMicrophoneId:K,onMicrophoneChange:D})]})},Se=({score:t,label:a,primaryAccent:o,b:c})=>{const r=t!=null?t*10:null,n=Wt(r,o);return e.jsxs("div",{className:"text-center p-4 bg-slate-100 rounded-lg",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:n},children:r!=null?Math.round(r):"-"}),e.jsx("div",{className:"text-sm text-slate-600",children:a})]})},qe=({icon:t,value:a,label:o,primaryAccent:c,b:r})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-100 rounded-lg",children:[e.jsx(t,{className:"w-5 h-5",style:{color:c}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-semibold text-slate-900",children:a}),e.jsx("div",{className:"text-xs text-slate-500",children:o})]})]}),ps=({session:t,scenario:a,onBackToDashboard:o,onStartNew:c})=>{const r=ce(),{triggerConfetti:n,ConfettiComponent:w}=Jt(),_=t.summary_feedback||t.summary_feedback_json,g=_?typeof _=="string"?JSON.parse(_):_:null,b=t.overall_score||g?.overall_score||0,u=b<=10?b*10:b,M=(x=>x>=90?{text:"Ausgezeichnet!",emoji:"ðŸŒŸ"}:x>=80?{text:"Sehr gut!",emoji:"ðŸŽ‰"}:x>=70?{text:"Gut!",emoji:"ðŸ‘"}:x>=60?{text:"Solide Leistung",emoji:"ðŸ‘"}:x>=50?{text:"AusbaufÃ¤hig",emoji:"ðŸ’ª"}:{text:"Weiter Ã¼ben!",emoji:"ðŸ“š"})(u);return s.useEffect(()=>{u>=70&&n()},[u,n]),e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsxs("div",{className:"p-6 max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{background:r.headerGradient,boxShadow:`0 8px 24px ${r.primaryAccent}4d`},children:e.jsx(ut,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-5xl font-bold text-slate-900 m-0 mb-2",children:["Training abgeschlossen! ",M.emoji]}),e.jsxs("p",{className:"text-lg text-slate-600 m-0",children:[a?.title||"Skill Training"," - ",M.text]})]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-white border border-slate-200 text-center mb-6",children:[e.jsx("div",{className:"w-[120px] h-[120px] rounded-full flex items-center justify-center mx-auto mb-4",style:{border:`6px solid ${r.primaryAccent}`,backgroundColor:r.primaryAccentLight},children:e.jsx("span",{className:"text-5xl font-bold",style:{color:r.primaryAccent},children:u?Math.round(u):"-"})}),e.jsx("p",{className:"text-base text-slate-500 m-0",children:u?"Gesamtbewertung (von 100)":"Keine Fragen beantwortet"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(qe,{icon:be,value:`${t.completed_questions??0}/${t.total_questions||"-"}`,label:"Fragen",primaryAccent:r.primaryAccent,b:r}),e.jsx(qe,{icon:te,value:g?.average_content_score?Math.round(g.average_content_score*10):"-",label:"Ã˜ Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(qe,{icon:qt,value:g?.average_delivery_score?Math.round(g.average_delivery_score*10):"-",label:"Ã˜ PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),g?.scores&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsx(Se,{score:g.scores.content,label:"Inhalt",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:g.scores.structure,label:"Struktur",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:g.scores.relevance,label:"Relevanz",primaryAccent:r.primaryAccent,b:r}),e.jsx(Se,{score:g.scores.delivery,label:"PrÃ¤sentation",primaryAccent:r.primaryAccent,b:r})]}),g?.summary&&e.jsxs("div",{className:"p-5 rounded-lg bg-slate-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-700 m-0 mb-2",children:"Zusammenfassung"}),e.jsx("p",{className:"text-base text-slate-600 m-0 leading-relaxed",children:g.summary})]}),g?.key_takeaways?.length>0&&e.jsxs("div",{className:"p-5 rounded-lg bg-green-100 mb-6",children:[e.jsx("h3",{className:"text-base font-semibold text-green-500 m-0 mb-3",children:"ðŸ’¡ Die wichtigsten Erkenntnisse"}),e.jsx("ul",{className:"m-0 pl-5 text-slate-700 text-base leading-relaxed",children:g.key_takeaways.map((x,i)=>e.jsx("li",{className:"mb-2",children:x},i))})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsxs("button",{onClick:o,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-lg border-2 border-slate-300 bg-white text-slate-700 text-base font-semibold cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(Ee,{className:"w-[18px] h-[18px]"}),"Zur Ãœbersicht"]}),e.jsxs("button",{onClick:c,className:"flex-1 flex items-center justify-center gap-2 py-3.5 px-6 rounded-xl border-none text-white text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg bg-gradient-to-r from-indigo-500 to-violet-500 shadow-primary",children:[e.jsx(We,{className:"w-[18px] h-[18px]"}),"Nochmal Ã¼ben"]})]})]})]})},W={DASHBOARD:"dashboard",VARIABLES:"variables",SESSION:"session",COMPLETE:"complete"},Is=({isAuthenticated:t,requireAuth:a,setPendingAction:o,pendingContinueSession:c,clearPendingContinueSession:r,pendingRepeatSession:n,clearPendingRepeatSession:w,onNavigateToHistory:_})=>{const[g,b]=s.useState(W.DASHBOARD),[u,N]=s.useState(null),[M,x]=s.useState(null),[i,v]=s.useState([]),[j,F]=s.useState({}),[L,m]=s.useState(null),[h,l]=s.useState(null),[f,y]=s.useState(null),[k,E]=s.useState(0);s.useEffect(()=>{f&&t&&(N(f),b(W.VARIABLES),y(null))},[f,t]),s.useEffect(()=>{if(c&&t){const{session:C,scenario:O}=c,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[],R=C.completed_questions||C.answered_count||0;N(O||{id:C.scenario_id,title:C.scenario_title}),x(C),v(se),F({}),E(R),b(W.SESSION),r&&r()}},[c,t,r]),s.useEffect(()=>{if(n&&t){const{session:C,scenario:O}=n,B=C.questions||C.questions_json,se=typeof B=="string"?JSON.parse(B):B||[];N(O||{id:C.scenario_id,title:C.scenario_title}),v(se),F({}),E(0),b(W.SESSION),w&&w()}},[n,t,w]),s.useEffect(()=>{window.scrollTo(0,0)},[g]);const I=s.useCallback(C=>{N(C),b(W.VARIABLES)},[]),z=s.useCallback(()=>{N(null),x(null),v([]),F({}),m(null),E(0),l(null),b(W.DASHBOARD)},[]),q=s.useCallback(C=>{F(C),b(W.SESSION)},[]),p=s.useCallback(C=>{x(C.session),v(C.questions),C.selectedMicrophoneId&&l(C.selectedMicrophoneId)},[]),d=s.useCallback(C=>{m(C.session),b(W.COMPLETE)},[]),S=s.useCallback(()=>{z()},[z]),T=s.useCallback(()=>{x(null),v([]),m(null),E(0),l(null),b(W.VARIABLES)},[]),$=()=>{switch(g){case W.DASHBOARD:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:y,onNavigateToHistory:_});case W.VARIABLES:return e.jsx(rs,{scenario:u,onBack:z,onNext:q});case W.SESSION:return e.jsx(hs,{session:M,questions:i,scenario:u,variables:j,preloadedQuestions:i.length>0?i:null,onSessionCreated:p,onComplete:d,onExit:S,startFromQuestion:k,initialMicrophoneId:h});case W.COMPLETE:return e.jsx(ps,{session:L,scenario:u,onBackToDashboard:z,onStartNew:T});default:return e.jsx(tt,{onSelectScenario:I,isAuthenticated:t,requireAuth:a,setPendingScenario:y,onNavigateToHistory:_})}};return e.jsx("div",{className:"min-h-full",children:$()})},at={target:te,clock:X,mic:Q,"message-square":he,lightbulb:Z,brain:Pe,info:ge,check:be,sparkles:Ae},gs=[{icon:te,title:"Strukturiert antworten",description:"Nutze die STAR-Methode (Situation, Task, Action, Result) fÃ¼r Beispiele."},{icon:X,title:"Zeit im Blick",description:"Antworte prÃ¤zise, aber ausfÃ¼hrlich genug."},{icon:Q,title:"Klar sprechen",description:"Sprich in normalem Tempo. Pausen sind vÃ¶llig in Ordnung."}],Bs=({scenario:t,onBack:a,onStart:o,preloadedQuestions:c})=>{const[r,n]=s.useState({}),[w,_]=s.useState({}),[g,b]=s.useState(!1),[u,N]=s.useState(null),[M,x]=s.useState(null),[i,v]=s.useState(!1),[j,F]=s.useState([]),[L,m]=s.useState(!1),{demoCode:h}=ht(),l=mt.useMemo(()=>{if(!t?.input_configuration)return[];try{const p=typeof t.input_configuration=="string"?JSON.parse(t.input_configuration):t.input_configuration;return Array.isArray(p)?p.filter(d=>d.user_input!==!1):[]}catch(p){return console.error("Error parsing input_configuration:",p),[]}},[t?.input_configuration]);s.useEffect(()=>{const p={};l.forEach(d=>{d.default&&(p[d.key]=d.default)}),n(p)},[l]);const f=(p,d)=>{if(!p)return p;let S=p;return Object.entries(d||{}).forEach(([T,$])=>{$&&(S=S.replace(new RegExp(`\\$\\{${T}\\}`,"g"),$),S=S.replace(new RegExp(`\\{${T}\\}`,"g"),$))}),S},y=(p,d)=>{n(S=>({...S,[p]:d})),w[p]&&_(S=>{const T={...S};return delete T[p],T})},k=()=>{F(p=>[...p,{key:"",value:""}])},E=(p,d,S)=>{F(T=>{const $=[...T];return $[p]={...$[p],[d]:S},$})},I=p=>{F(d=>d.filter((S,T)=>T!==p))},z=()=>{const p={};return l.forEach(d=>{const S=r[d.key];if(d.required&&(!S||S.trim()==="")){p[d.key]="Dieses Feld ist erforderlich";return}if(!(!S||S.trim()==="")&&d.validation){const{minLength:T,maxLength:$,min:C,max:O,pattern:B}=d.validation;T&&S.length<T&&(p[d.key]=`Mindestens ${T} Zeichen erforderlich`),$&&S.length>$&&(p[d.key]=`Maximal ${$} Zeichen erlaubt`),C!==void 0&&Number(S)<C&&(p[d.key]=`Mindestens ${C}`),O!==void 0&&Number(S)>O&&(p[d.key]=`Maximal ${O}`),B&&!new RegExp(B).test(S)&&(p[d.key]="UngÃ¼ltiges Format")}}),_(p),Object.keys(p).length===0},q=async p=>{if(p.preventDefault(),N(null),!!z()){b(!0);try{const d={...r};j.forEach(C=>{C.key&&C.value&&(d[C.key]=C.value)});const S=await U.createSimulatorSession({scenario_id:t.id,variables:d,demo_code:h||null,questions:c||null});if(!S.success)throw new Error(S.message||"Fehler beim Erstellen der Session");const T=S.data.session;let $;if(c&&c.length>0)$=c,await U.updateSimulatorSessionQuestions(T.id,$);else{const C=await U.generateSimulatorQuestions(T.id);if(!C.success)throw new Error(C.message||"Fehler beim Generieren der Fragen");$=C.data.questions}o({session:{...T,questions_json:$},questions:$,scenario:t,variables:d,selectedMicrophoneId:M})}catch(d){console.error("Error starting session:",d),N(d.message||"Ein Fehler ist aufgetreten")}finally{b(!1)}}};return e.jsxs("div",{className:"p-6 pb-[200px] max-w-[640px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 py-2 px-3 mb-4 border-none bg-transparent text-slate-600 text-base cursor-pointer rounded-md transition-all hover:bg-slate-100",children:[e.jsx(Ee,{className:"w-[18px] h-[18px]"}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-brand-gradient flex items-center justify-center",children:e.jsx(Ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-base text-slate-600 mt-1",children:"Konfiguriere dein Training"})]})]})]}),e.jsx("div",{className:"py-4 px-5 rounded-xl bg-slate-100 mb-6",children:e.jsx("p",{className:"text-base text-slate-700 leading-relaxed",children:t.description})}),t.long_description&&e.jsx(ke,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(ge,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-base leading-relaxed text-slate-700 whitespace-pre-wrap",children:f(t.long_description?.replace(/\/n/g,`
`),r)})]})]})}),(()=>{const p=t.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((d,S)=>typeof d=="string"?{icon:Z,title:`Tipp ${S+1}`,description:d}:{icon:at[d.icon]||at[d.icon?.toLowerCase()]||Z,title:d.title||`Tipp ${S+1}`,description:d.text||d.description||""}):gs;return e.jsxs(ke,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Tipps fÃ¼r dein Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:p.map((d,S)=>{const T=d.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-lg bg-slate-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-md bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-base mb-0.5",children:d.title}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:d.description})]})]},S)})})]})})(),e.jsxs("form",{onSubmit:q,children:[l.length>0?l.map(p=>e.jsx(Xt,{field:p,value:r[p.key],onChange:y,error:w[p.key]},p.key)):e.jsxs("div",{className:"p-6 text-center text-slate-500",children:[e.jsx(be,{className:"w-8 h-8 mb-3 mx-auto opacity-50"}),e.jsx("p",{children:"Keine zusÃ¤tzliche Konfiguration erforderlich."})]}),t?.allow_custom_variables&&e.jsxs("div",{className:"my-5 pt-5 border-t border-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>m(!L),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${L?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[L?e.jsx(Ze,{size:18}):e.jsx(ze,{size:18}),e.jsx(Ce,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),L&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Fragen-Generierung und Feedback einflieÃŸen sollen."}),j.length>0&&e.jsx("div",{className:"mb-3",children:j.map((p,d)=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:p.key||"",onChange:S=>E(d,"key",S.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-lg border border-slate-200 text-sm font-mono bg-slate-50 mr-2"}),e.jsx("button",{type:"button",onClick:()=>I(d),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center",children:e.jsx(lt,{size:18})})]}),e.jsx("textarea",{value:p.value||"",onChange:S=>E(d,"value",S.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2 px-3 rounded-lg border border-slate-200 text-sm resize-y min-h-[80px] box-border"})]},d))}),e.jsxs("button",{type:"button",onClick:k,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-transparent text-slate-600 text-sm cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(Ce,{size:16}),"Variable hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"py-4 px-5 rounded-xl bg-primary/10 my-6 flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Fragen"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[t.question_count_min,"-",t.question_count_max]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:[Math.round(t.time_limit_per_question/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Wiederholen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t.allow_retry?"Erlaubt":"Nicht erlaubt"})]})]}),e.jsxs(ke,{className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(Q,{className:"w-[22px] h-[22px] text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Mikrofon auswÃ¤hlen"})]}),e.jsx(pt,{selectedDeviceId:M,onDeviceChange:x,onTestClick:()=>v(!0)})]}),u&&e.jsxs("div",{className:"py-3 px-4 rounded-xl bg-red-100 text-red-500 mb-5 flex items-center gap-2",children:[e.jsx(pe,{className:"w-[18px] h-[18px]"}),u]}),e.jsx(oe,{type:"submit",disabled:g,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(ot,{className:"w-5 h-5"}),children:"Training starten"})]}),e.jsx(gt,{isOpen:i,onClose:()=>v(!1),deviceId:M}),e.jsx(bt,{isLoading:g,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{xs as CancelConfirmDialog,us as CompleteConfirmDialog,ls as ImmediateFeedback,ds as PreSessionView,os as QuestionTips,ps as SessionComplete,cs as SessionTimer,Is as SimulatorApp,st as SimulatorAudioRecorder,tt as SimulatorDashboard,hs as SimulatorSession,Bs as SimulatorWizard};
