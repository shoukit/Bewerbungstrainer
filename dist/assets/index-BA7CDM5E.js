import{j as e,O as K,F as _,h as $e,y as W,ae as I,au as He,i as qe,av as Je,ad as Ze,R as H,c as te,S as se,a0 as re,aw as ne,ax as ie,a8 as ae,l as q,as as J,w as le,U as oe,aj as Z,B as Q,v as Ae,x as Ne,C as ce,z as de,a as me,Q as De,b as ke,ay as ee,Y as Se,t as Qe,az as Ce,L as xe,m as ue,a9 as ye,X as Te,aA as Be,aB as Ye,aC as Re,A as _e}from"./ui-vendor-w3QMwUw1.js";import{a as r}from"./react-vendor-uDOJF2jQ.js";import{w as F,k as Xe,F as et,C as tt}from"./FeatureInfoButton-DOlrUowH.js";import{S as st}from"./ScenarioDashboard-CCSgNc4o.js";import{B as G,C as U}from"./select-native-a06Ufdzz.js";import"./dialog-Dl3u2MoA.js";import{F as rt}from"./fullscreen-loader-DAGTqrko.js";import{D as nt}from"./DynamicFormField-BurqvDw2.js";import{a as it,B as at}from"./BriefingWorkbook-i1B4AI_i.js";import{u as lt}from"./useMobile-YxjH166V.js";import"./ScenarioCard-pFKbP67R.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";const ot={"file-text":_,briefcase:Q,banknote:Z,users:oe,user:le,"message-circle":J,target:q,award:ae,book:ie,clipboard:ne,star:re,lightbulb:W,shield:se,compass:te,rocket:H,heart:Ze,folder:Je,"trending-up":qe},ct=({onSelectTemplate:s,onShowList:y,onCreateTemplate:m,onEditTemplate:o,isAuthenticated:p,requireAuth:a,setPendingAction:h,demoCode:d})=>{const[w,N]=r.useState(null),[b,n]=r.useState(0),x=r.useCallback(async()=>{const u=new URLSearchParams;d&&u.append("demo_code",d);const g=await F.request(`/smartbriefing/templates?${u.toString()}`,{method:"GET"});if(g.success&&g.data?.templates)return g.data.templates;throw new Error("Unerwartete API-Antwort")},[d,b]),i=()=>{if(!p&&!d){a&&(h(()=>m),a());return}m?.()},f=(u,g)=>{u.stopPropagation(),o?.(g)},j=(u,g)=>{u.stopPropagation(),N(g)},v=async()=>{if(w)try{const u=new URLSearchParams;d&&u.append("demo_code",d),(await F.request(`/smartbriefing/templates/${w.id}?${u.toString()}`,{method:"DELETE"})).success&&n(C=>C+1)}catch(u){console.error("[SmartBriefing] Error deleting template:",u)}finally{N(null)}},l=u=>ot[u.icon]||_,S=u=>{const g=u.variables_schema?.length||0;return[{text:`${g} Eingabefeld${g!==1?"er":""}`}]},$=u=>u.is_custom?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:g=>f(g,u),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-slate-100 hover:text-primary",title:"Template bearbeiten",children:e.jsx(He,{size:16})}),e.jsx("button",{onClick:g=>j(g,u),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-red-50 hover:text-red-500",title:"Template l√∂schen",children:e.jsx(K,{size:16})})]}):null,T=(p||d)&&m?e.jsxs("button",{onClick:i,className:"flex items-center gap-2 py-2.5 px-4 rounded-xl border-2 border-dashed border-indigo-200 bg-white text-indigo-500 text-sm font-medium cursor-pointer transition-all whitespace-nowrap hover:border-indigo-400 hover:bg-indigo-50 hover:shadow-sm",children:[e.jsx(I,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"pers√∂nliches Template"}),e.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,A=()=>e.jsx("div",{className:"mt-12 py-5 px-6 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(W,{size:20,className:"text-indigo-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-1",children:"So funktioniert Smart Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed",children:"W√§hle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein ma√ügeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren R√ºckfragen."})]})]})}),L=w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>N(null),children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[400px] w-full shadow-2xl transform transition-all",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center",children:e.jsx(K,{size:24,className:"text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Template l√∂schen?"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Diese Aktion kann nicht r√ºckg√§ngig gemacht werden."})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-xl p-3 mb-5",children:e.jsx("p",{className:"text-sm text-slate-700",children:e.jsx("strong",{children:w.title})})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(G,{variant:"secondary",onClick:()=>N(null),children:"Abbrechen"}),e.jsx(G,{variant:"danger",onClick:v,children:"L√∂schen"})]})]})});return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{featureId:"smartbriefing",showOnMount:!0}),e.jsx(st,{title:"Smart Briefing",subtitle:"Dein KI-gest√ºtzter Vorbereitungs-Assistent",headerIcon:_,headerActions:e.jsx(et,{featureId:"smartbriefing",size:"sm"}),fetchScenarios:x,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:y,onSelectScenario:s,renderCardMeta:S,getIconForScenario:l,getCardCustomActions:$,cardActionLabel:"Briefing erstellen",cardActionIcon:$e,categoryField:"category",emptyStateIcon:_,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:T,renderInfoBox:A,extraContent:L,isAuthenticated:p,requireAuth:a,setPendingAction:h,demoCode:d,loadingMessage:"Templates werden geladen..."},b)]})},dt=({variable:s,index:y,onChange:m,onDelete:o})=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:s.key||"",onChange:p=>m(y,"key",p.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-md border border-slate-200 text-sm font-mono bg-slate-50 mr-2 outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"}),e.jsx("button",{type:"button",onClick:()=>o(y),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center hover:bg-red-50 rounded-md transition-colors",children:e.jsx(K,{size:18})})]}),e.jsx("textarea",{value:s.value||"",onChange:p=>m(y,"value",p.target.value),placeholder:"Wert eingeben... (mehrzeilig m√∂glich)",rows:3,className:"w-full py-2.5 px-3 rounded-md border border-slate-200 text-sm resize-y min-h-[80px] box-border outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"})]}),mt=({template:s,onBack:y,onBriefingGenerated:m,isAuthenticated:o})=>{const[p,a]=r.useState({}),[h,d]=r.useState({}),[w,N]=r.useState(!1),[b,n]=r.useState(null),[x,i]=r.useState([]),[f,j]=r.useState(!1),v=it(s?.icon);r.useEffect(()=>{if(s?.variables_schema){const u={};s.variables_schema.forEach(g=>{g.default&&(u[g.key]=g.default)}),a(u)}i([]),j(!1)},[s]);const l=()=>{i([...x,{key:"",value:""}])},S=(u,g,C)=>{const B=[...x];B[u][g]=C,i(B)},$=u=>{i(x.filter((g,C)=>C!==u))},T=(u,g)=>{a(C=>({...C,[u]:g})),h[u]&&d(C=>{const B={...C};return delete B[u],B})},A=()=>{const u={};return s?.variables_schema?.forEach(g=>{g.required&&!p[g.key]&&(u[g.key]="Dieses Feld ist erforderlich")}),u},L=async u=>{u.preventDefault();const g=A();if(Object.keys(g).length>0){d(g);return}N(!0),n(null);try{const C={};x.forEach(R=>{R.key&&R.value&&(C[R.key]=R.value)});const B={template_id:s.id,variables:p};Object.keys(C).length>0&&(B.custom_variables=C);const V=await F.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(B)});if(V.success&&V.data?.briefing)m(V.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(C){console.error("[SmartBriefing] Error generating briefing:",C),n(C.message||"Fehler beim Generieren des Briefings")}finally{N(!1)}};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 pt-8 max-w-[700px] mx-auto",children:[e.jsxs("button",{onClick:y,disabled:w,className:`flex items-center gap-2 py-2 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer mb-6 transition-opacity ${w?"opacity-50 cursor-not-allowed":"hover:text-slate-700"}`,children:[e.jsx(Ae,{size:18}),e.jsx("span",{className:"leading-relaxed",children:"Zur√ºck zur √úbersicht"})]}),e.jsx(U,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(v,{size:28,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[22px] font-bold text-slate-900 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-slate-500",children:s.description})]})]})}),e.jsxs(U,{className:"p-6",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900 mb-5 pb-4 border-b border-slate-100",children:"Deine Angaben"}),e.jsxs("form",{onSubmit:L,children:[s.variables_schema?.map(u=>e.jsx(nt,{field:u,value:p[u.key],onChange:T,error:h[u.key]},u.key)),s.allow_custom_variables&&e.jsxs("div",{className:"mt-6 mb-5 pt-5 border-t border-slate-100",children:[e.jsxs("button",{type:"button",onClick:()=>j(!f),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${f?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[f?e.jsx(Ne,{size:18}):e.jsx(ce,{size:18}),e.jsx(I,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"Zus√§tzliche Variablen hinzuf√ºgen (optional)"})]}),f&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:"F√ºge eigene Variablen hinzu, die in die Briefing-Generierung einflie√üen sollen."}),x.length>0&&e.jsx("div",{className:"mb-3",children:x.map((u,g)=>e.jsx(dt,{variable:u,index:g,onChange:S,onDelete:$},g))}),e.jsxs("button",{type:"button",onClick:l,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-500 text-[13px] cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(I,{size:14}),"Variable hinzuf√ºgen"]})]})]}),b&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-5 flex items-start gap-3",children:[e.jsx(de,{size:20,className:"text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:b})]}),e.jsx(G,{type:"submit",disabled:w,size:"lg",fullWidth:!0,icon:e.jsx(me,{size:20}),children:"Briefing generieren"})]})]})]}),e.jsx(rt,{isLoading:w,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein ma√ügeschneidertes Briefing."})]}):null},xt={"file-text":_,briefcase:Q,banknote:Z,users:oe,user:le,"message-circle":J,target:q,award:ae,book:ie,clipboard:ne,star:re,lightbulb:W,shield:se,compass:te,rocket:H},ut=({content:s})=>{if(!s)return null;const y=o=>{const p=o.split(`
`),a=[];let h=[],d=null;const w=()=>{h.length>0&&(a.push(e.jsx("ul",{className:"my-3 pl-6 list-none",children:h.map((N,b)=>e.jsxs("li",{className:"mb-2 text-[15px] leading-relaxed text-gray-700 relative pl-5",children:[e.jsx("span",{className:"absolute left-0 text-primary font-bold",children:d==="number"?`${b+1}.`:"‚Ä¢"}),m(N)]},b))},`list-${a.length}`)),h=[],d=null)};return p.forEach((N,b)=>{const n=N.trim();if(!n){w();return}if(n.startsWith("### ")){w(),a.push(e.jsx("h3",{className:`text-lg font-bold text-slate-900 my-6 mb-3 pt-4 flex items-center gap-2 ${b>0?"border-t border-slate-100":""}`,children:m(n.substring(4))},`h3-${b}`));return}if(n.startsWith("## ")){w(),a.push(e.jsx("h2",{className:"text-xl font-bold text-slate-900 my-7 mb-3.5",children:m(n.substring(3))},`h2-${b}`));return}if(n.startsWith("# ")){w(),a.push(e.jsx("h1",{className:"text-2xl font-bold text-slate-900 my-8 mb-4",children:m(n.substring(2))},`h1-${b}`));return}if(n.startsWith("- ")||n.startsWith("* ")){d!=="bullet"&&(w(),d="bullet"),h.push(n.substring(2));return}const x=n.match(/^(\d+)\.\s/);if(x){d!=="number"&&(w(),d="number"),h.push(n.substring(x[0].length));return}w(),a.push(e.jsx("p",{className:"my-3 text-[15px] leading-relaxed text-gray-700",children:m(n)},`p-${b}`))}),w(),a},m=o=>{const p=[];let a=o,h=0;for(;a.length>0;){const d=a.match(/\*\*(.+?)\*\*/),w=a.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),N=a.match(/`([^`]+)`/),b=[{match:d,type:"bold"},{match:w,type:"italic"},{match:N,type:"code"}].filter(x=>x.match);if(b.length===0){p.push(a);break}const n=b.reduce((x,i)=>(x.match?.index??1/0)<(i.match?.index??1/0)?x:i);switch(n.match.index>0&&p.push(a.substring(0,n.match.index)),n.type){case"bold":p.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:n.match[1]},h++));break;case"italic":p.push(e.jsx("em",{className:"italic",children:n.match[1]||n.match[2]},h++));break;case"code":p.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-[13px] font-mono text-primary",children:n.match[1]},h++));break}a=a.substring(n.match.index+n.match[0].length)}return p};return e.jsx("div",{children:y(s)})},ht=({briefing:s,template:y,onBack:m,onCreateNew:o,onGenerateAnother:p})=>{const a=lt(),[h,d]=r.useState(!1),w=r.useRef(null),N=xt[y?.icon||s?.template_icon]||_,b=i=>i?new Date(i).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",n=async()=>{try{await navigator.clipboard.writeText(s.content_markdown),d(!0),setTimeout(()=>d(!1),2e3)}catch(i){console.error("[SmartBriefing] Failed to copy:",i)}},x=()=>{const i=`${y?.title||s?.template_title}
${"=".repeat(50)}

Erstellt am: ${b(s.created_at)}

${s.content_markdown}`,f=new Blob([i],{type:"text/plain;charset=utf-8"}),j=URL.createObjectURL(f),v=document.createElement("a");v.href=j,v.download=`briefing-${s.id}.txt`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(j)};return s?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`bg-brand-gradient sticky top-0 z-40 ${a?"px-4 py-5":"px-8 py-6"}`,children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[m&&e.jsxs("button",{onClick:m,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Ae,{size:16}),"Zur√ºck zur √úbersicht"]}),e.jsxs("div",{className:`flex items-center gap-6 ${a?"flex-col items-start gap-4":""}`,children:[e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 ${a?"w-[70px] h-[70px]":"w-[90px] h-[90px]"}`,children:e.jsx(N,{size:a?32:40,color:tt.white})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsxs("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-primary flex items-center gap-1",children:[e.jsx(me,{size:12}),"Fertig!"]})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${a?"text-xl":"text-2xl"}`,children:y?.title||s?.template_title}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(De,{size:14}),b(s.created_at)]})})]}),!a&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:n,className:`flex items-center gap-2 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium border border-white/30 transition-colors ${h?"bg-green-500/30":"bg-white/20 hover:bg-white/30"}`,children:[h?e.jsx(ke,{size:16}):e.jsx(ee,{size:16}),h?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-white/30 transition-colors",children:[e.jsx(Se,{size:16}),"Speichern"]})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${a?"p-4":"px-8 py-6"}`,children:[a&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:n,className:`flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border text-[13px] font-medium cursor-pointer transition-colors ${h?"bg-green-50 border-green-200 text-green-700":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[h?e.jsx(ke,{size:16}):e.jsx(ee,{size:16}),h?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:x,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-[13px] font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(Se,{size:16}),"Speichern"]})]}),e.jsx("div",{ref:w,className:"bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200",children:e.jsx("div",{className:a?"p-5":"p-8",children:e.jsx(ut,{content:s.content_markdown})})}),e.jsxs("div",{className:"flex gap-3 mt-6 flex-wrap",children:[e.jsxs("button",{onClick:p,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-2 border-primary bg-white text-primary text-[15px] font-semibold cursor-pointer transition-all hover:bg-primary/5",children:[e.jsx(Qe,{size:18}),"Mit anderen Angaben neu generieren"]}),e.jsxs("button",{onClick:o,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-none bg-brand-gradient text-white text-[15px] font-semibold cursor-pointer transition-all shadow-primary/40 shadow-lg hover:shadow-xl",children:[e.jsx(I,{size:18}),"Neues Briefing erstellen"]})]})]})]}):null},pt={"file-text":_,briefcase:Q,banknote:Z,users:oe,user:le,"message-circle":J,target:q,award:ae,book:ie,clipboard:ne,star:re,lightbulb:W,shield:se,compass:te,rocket:H},bt=s=>s?new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",gt=({briefing:s,onOpen:y,onDelete:m,isDeleting:o})=>{const[p,a]=r.useState(!1),[h,d]=r.useState(!1),w=pt[s.template_icon]||_,N=b=>{b.stopPropagation(),h?(m(s.id),d(!1)):(d(!0),setTimeout(()=>d(!1),3e3))};return e.jsxs(U,{onClick:()=>y(s),onMouseEnter:()=>a(!0),onMouseLeave:()=>{a(!1),d(!1)},className:`p-5 cursor-pointer transition-all duration-300 relative ${p?"border-primary shadow-lg -translate-y-0.5":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-[10px] bg-primary/10 flex items-center justify-center",children:e.jsx(w,{size:22,className:"text-primary"})}),e.jsx("button",{onClick:N,disabled:o,className:`p-2 rounded-lg border-none cursor-pointer transition-all ${h?"bg-red-50 text-red-500":p?"bg-slate-100 text-slate-400":"bg-transparent text-slate-400"} ${p||h?"opacity-100":"opacity-0"} ${o?"cursor-not-allowed":""}`,children:o?e.jsx(xe,{size:18,className:"animate-spin"}):e.jsx(K,{size:18})})]}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 leading-tight truncate",children:s.title||"Unbenanntes Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:s.template_title}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-xs",children:[e.jsx(De,{size:14}),bt(s.created_at)]}),e.jsxs("div",{className:"flex items-center gap-1 text-primary text-[13px] font-medium",children:["√ñffnen",e.jsx($e,{size:16})]})]}),h&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-50 border border-red-200 rounded-lg py-2 px-3 text-xs text-red-600 font-medium z-10",onClick:b=>b.stopPropagation(),children:"Nochmal klicken zum L√∂schen"})]})},ft=({onOpenBriefing:s,onCreateNew:y,isAuthenticated:m})=>{const[o,p]=r.useState([]),[a,h]=r.useState(!0),[d,w]=r.useState(null),[N,b]=r.useState(null);r.useEffect(()=>{(async()=>{if(!m){h(!1);return}try{h(!0),w(null);const i=await F.request("/smartbriefing/briefings",{method:"GET"});if(i.success&&i.data?.briefings){const f=i.data.briefings.filter(j=>j.status==="completed");p(f)}else throw new Error("Unerwartete API-Antwort")}catch(i){console.error("[SmartBriefing] Error fetching briefings:",i),w(i.message||"Fehler beim Laden der Briefings")}finally{h(!1)}})()},[m]);const n=async x=>{try{if(b(x),(await F.request(`/smartbriefing/briefings/${x}`,{method:"DELETE"})).success)p(f=>f.filter(j=>j.id!==x));else throw new Error("Fehler beim L√∂schen")}catch(i){console.error("[SmartBriefing] Error deleting briefing:",i),w(i.message||"Fehler beim L√∂schen des Briefings")}finally{b(null)}};return m?e.jsxs("div",{className:"p-6 max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Meine Briefings"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[o.length," gespeicherte Briefings"]})]}),e.jsx(G,{onClick:y,icon:e.jsx(I,{size:18}),children:"Neues Briefing"})]}),a&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(xe,{size:40,className:"text-primary animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-500",children:"Briefings werden geladen..."})]}),d&&!a&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 flex items-start gap-3",children:[e.jsx(de,{size:24,className:"text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base text-red-600 font-medium mb-1",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-sm text-red-700",children:d})]})]}),!a&&!d&&e.jsx(e.Fragment,{children:o.length===0?e.jsxs(U,{className:"py-12 px-6 text-center",children:[e.jsx(Ce,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Noch keine Briefings"}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Erstelle dein erstes Briefing, um loszulegen."}),e.jsx(G,{onClick:y,icon:e.jsx(I,{size:18}),children:"Briefing erstellen"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:o.map(x=>e.jsx(gt,{briefing:x,onOpen:s,onDelete:n,isDeleting:N===x.id},x.id))})})]}):e.jsx("div",{className:"p-6 max-w-[800px] mx-auto",children:e.jsxs(U,{className:"py-12 px-6 text-center",children:[e.jsx(Ce,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},Ie=[{key:"file-text",icon:_,label:"Dokument"},{key:"briefcase",icon:Q,label:"Koffer"},{key:"banknote",icon:Z,label:"Geld"},{key:"users",icon:oe,label:"Team"},{key:"user",icon:le,label:"Person"},{key:"target",icon:q,label:"Ziel"},{key:"lightbulb",icon:W,label:"Idee"},{key:"star",icon:re,label:"Stern"},{key:"shield",icon:se,label:"Schutz"},{key:"compass",icon:te,label:"Kompass"},{key:"rocket",icon:H,label:"Rakete"},{key:"message-circle",icon:J,label:"Nachricht"},{key:"award",icon:ae,label:"Auszeichnung"},{key:"book",icon:ie,label:"Buch"},{key:"clipboard",icon:ne,label:"Checkliste"}],ze=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],Ee=[{key:"empty",label:"--- Vorlage w√§hlen ---",icon:_,aiRole:"",sections:[],aiBehavior:""},{key:"sales",label:"üéØ Sales / Kundengespr√§ch",icon:q,aiRole:"Du bist ein erfahrener Sales-Coach und Vertriebsexperte mit 15+ Jahren Erfahrung im B2B-Vertrieb.",sections:[{id:"hook",title:"The Hook ü™ù",instruction:"Erstelle einen packenden Gespr√§chseinstieg f√ºr ${customer_type} Kunden"},{id:"discovery",title:"Discovery Questions üîç",instruction:"Formuliere 5-7 offene Fragen um Bedarf zu wecken und Pain Points zu identifizieren"},{id:"value",title:"Value Proposition üíé",instruction:"Beschreibe den Mehrwert basierend auf ${product_service}"},{id:"objections",title:"Einwandbehandlung üõ°Ô∏è",instruction:"Liste typische Einw√§nde und passende Antworten"},{id:"closing",title:"Closing Path üéØ",instruction:"Entwickle einen Weg zum Ziel: ${meeting_goal}"}],aiBehavior:"Schreibe praxisnah und actionable. Jeder Punkt soll direkt umsetzbar sein. Vermeide Theorie - fokussiere auf konkrete Formulierungen und Techniken."},{key:"career",label:"üíº Karriere / Vorstellungsgespr√§ch",icon:Q,aiRole:"Du bist ein erfahrener Karriere-Coach und HR-Experte mit umfassender Erfahrung in Bewerbungsprozessen.",sections:[{id:"company",title:"Unternehmens-Insights üè¢",instruction:"Recherchiere wichtige Fakten √ºber ${unternehmen} die im Gespr√§ch relevant sind"},{id:"position",title:"Positions-Analyse üìã",instruction:"Analysiere die Anforderungen f√ºr ${position} und wie der Kandidat diese erf√ºllt"},{id:"questions",title:"Typische Fragen ‚ùì",instruction:"Liste die 10 wahrscheinlichsten Interviewfragen mit Antwortstrategien"},{id:"stories",title:"STAR-Stories ‚≠ê",instruction:"Entwickle 3-5 Erfolgsgeschichten nach der STAR-Methode"},{id:"questions_to_ask",title:"Eigene Fragen üôã",instruction:"Formuliere 5-7 kluge R√ºckfragen an den Interviewer"}],aiBehavior:"Sei konkret und praxisorientiert. Gib Formulierungsvorschl√§ge die direkt verwendet werden k√∂nnen. Ber√ºcksichtige deutsche Gesch√§ftskultur."},{key:"negotiation",label:"üí∞ Gehaltsverhandlung",icon:Z,aiRole:"Du bist ein Experte f√ºr Gehaltsverhandlungen und Karriereentwicklung.",sections:[{id:"market",title:"Marktanalyse üìä",instruction:"Analysiere Gehaltsspannen f√ºr ${position} in ${branche} und ${region}"},{id:"arguments",title:"Argumente üí™",instruction:"Entwickle 5-7 √ºberzeugende Argumente f√ºr eine Gehaltserh√∂hung basierend auf ${erfolge}"},{id:"counter",title:"Konterstrategien üõ°Ô∏è",instruction:"Bereite Antworten auf typische Gegenargumente des Arbeitgebers vor"},{id:"tactics",title:"Verhandlungstaktiken üéØ",instruction:"Beschreibe bew√§hrte Taktiken f√ºr die Gehaltsverhandlung"},{id:"alternatives",title:"Alternativen üîÑ",instruction:"Liste nicht-monet√§re Benefits die verhandelbar sind"}],aiBehavior:"Fokussiere auf konkrete Zahlen und Formulierungen. Sei selbstbewusst aber nicht arrogant im Ton."},{key:"presentation",label:"üé§ Pr√§sentation / Pitch",icon:H,aiRole:"Du bist ein Pr√§sentations-Coach und Storytelling-Experte.",sections:[{id:"hook",title:"Er√∂ffnung üé¨",instruction:"Erstelle einen aufmerksamkeitsstarken Einstieg f√ºr ${thema}"},{id:"problem",title:"Problem/Herausforderung ‚ö°",instruction:"Beschreibe das Problem das ${zielgruppe} hat"},{id:"solution",title:"L√∂sung/Angebot üí°",instruction:"Pr√§sentiere die L√∂sung klar und √ºberzeugend"},{id:"proof",title:"Beweise/Beispiele üìà",instruction:"Liste Erfolgsbeispiele, Zahlen und Social Proof"},{id:"cta",title:"Call-to-Action üéØ",instruction:"Formuliere einen klaren n√§chsten Schritt"}],aiBehavior:"Schreibe in aktivem, energetischem Stil. Jeder Abschnitt soll eine klare Botschaft haben. Nutze Storytelling-Elemente."},{key:"feedback",label:"üí¨ Feedback-Gespr√§ch",icon:J,aiRole:"Du bist ein erfahrener Leadership-Coach und Experte f√ºr Mitarbeiterf√ºhrung.",sections:[{id:"context",title:"Gespr√§chsrahmen üìã",instruction:"Bereite den Rahmen f√ºr das Feedback-Gespr√§ch mit ${mitarbeiter_name} vor"},{id:"positive",title:"St√§rken & Erfolge ‚≠ê",instruction:"Liste konkrete positive Beobachtungen und Erfolge"},{id:"development",title:"Entwicklungsfelder üå±",instruction:"Beschreibe Verbesserungspotenziale konstruktiv"},{id:"goals",title:"Zielvereinbarung üéØ",instruction:"Formuliere SMART-Ziele f√ºr die n√§chste Periode"},{id:"support",title:"Unterst√ºtzungsangebote ü§ù",instruction:"Liste m√∂gliche Unterst√ºtzungsma√ünahmen"}],aiBehavior:"Schreibe wertsch√§tzend und konstruktiv. Fokussiere auf Verhalten, nicht auf Pers√∂nlichkeit. Nutze die SBI-Methode (Situation-Behavior-Impact)."}],P=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,jt=()=>({id:P(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),yt=()=>({id:P(),value:"",label:""}),wt=()=>({id:P(),title:"",instruction:""}),Nt=({variable:s,index:y,total:m,onChange:o,onDelete:p,onMoveUp:a,onMoveDown:h})=>{const[d,w]=r.useState(!0),[N,b]=r.useState(s.label);r.useEffect(()=>{b(s.label)},[s.label]);const n=(l,S)=>{o({...s,[l]:S})},x=()=>{const l=[...s.options||[],yt()];o({...s,options:l})},i=(l,S,$)=>{const T=s.options.map(A=>A.id===l?{...A,[S]:$}:A);o({...s,options:T})},f=l=>{const S=s.options.filter($=>$.id!==l);o({...s,options:S})},j=l=>l.toLowerCase().replace(/[√§√∂√º√ü]/g,S=>({√§:"ae",√∂:"oe",√º:"ue",√ü:"ss"})[S]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),v=()=>{if(N!==s.label){const l={label:N};(!s.key||s.key===j(s.label))&&(l.key=j(N)),o({...s,...l})}};return e.jsxs("div",{className:"bg-slate-50 rounded-xl border border-slate-200 mb-3 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 bg-white cursor-pointer ${d?"border-b border-slate-200":""}`,onClick:()=>w(!d),children:[e.jsx(Re,{size:16,className:"text-slate-400 cursor-grab"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:s.label||`Variable ${y+1}`}),s.key&&e.jsxs("span",{className:"ml-2 text-slate-500 text-xs",children:["$","{","$",s.key,"}"]})]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-[11px] font-medium bg-primary/10 text-primary",children:ze.find(l=>l.value===s.type)?.label||s.type}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),a()},disabled:y===0,className:`p-1 border-none bg-transparent ${y===0?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(Ne,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),h()},disabled:y===m-1,className:`p-1 border-none bg-transparent ${y===m-1?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(ce,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),p()},className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(K,{size:16})})]}),e.jsx(_e,{children:d&&e.jsx(ue.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:e.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldbezeichnung *"}),e.jsx("input",{type:"text",value:N,onChange:l=>b(l.target.value),onBlur:v,placeholder:"z.B. Unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Variablenname *"}),e.jsx("input",{type:"text",value:s.key,onChange:l=>n("key",l.target.value),placeholder:"z.B. unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm font-mono"})]})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldtyp"}),e.jsx("select",{value:s.type,onChange:l=>n("type",l.target.value),className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm bg-white",children:ze.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 py-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.required,onChange:l=>n("required",l.target.checked),className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Pflichtfeld"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Platzhalter-Text (optional)"}),e.jsx("input",{type:"text",value:s.placeholder,onChange:l=>n("placeholder",l.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),s.type==="select"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-2",children:"Auswahloptionen"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[(s.options||[]).map(l=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:l.value,onChange:S=>i(l.id,"value",S.target.value),placeholder:"Wert",className:"flex-1 px-2.5 py-2 rounded-md border border-slate-200 text-[13px] font-mono"}),e.jsx("input",{type:"text",value:l.label,onChange:S=>i(l.id,"label",S.target.value),placeholder:"Anzeigename",className:"flex-[2] px-2.5 py-2 rounded-md border border-slate-200 text-[13px]"}),e.jsx("button",{onClick:()=>f(l.id),className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(K,{size:14})})]},l.id)),e.jsxs("button",{onClick:x,className:"flex items-center gap-1.5 px-3 py-2 border border-dashed border-slate-300 rounded-md bg-transparent text-slate-500 text-[13px] cursor-pointer mt-1 hover:bg-slate-50",children:[e.jsx(I,{size:14}),"Option hinzuf√ºgen"]})]})]})]})})})]})},vt=({section:s,index:y,total:m,variables:o,onChange:p,onDelete:a,onMoveUp:h,onMoveDown:d,onInsertVariable:w})=>{const N=r.useRef(null),b=(x,i)=>{p({...s,[x]:i})},n=x=>{const i=N.current;if(i){const f=i.selectionStart,j=i.selectionEnd,v=s.instruction,l=`\${${x}}`,S=v.substring(0,f)+l+v.substring(j);b("instruction",S),setTimeout(()=>{i.focus(),i.setSelectionRange(f+l.length,f+l.length)},0)}else b("instruction",s.instruction+`\${${x}}`)};return e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 mb-3 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-indigo-50 to-violet-50 border-b border-slate-200",children:[e.jsx(Re,{size:16,className:"text-slate-400 cursor-grab"}),e.jsx("span",{className:"w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 text-xs font-bold flex items-center justify-center",children:y+1}),e.jsx("input",{type:"text",value:s.title,onChange:x=>b("title",x.target.value),placeholder:"Abschnittstitel (z.B. 'Discovery Questions üîç')",className:"flex-1 px-2 py-1 rounded border-0 bg-transparent text-sm font-semibold text-slate-800 placeholder:text-slate-400"}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:h,disabled:y===0,className:`p-1 border-none bg-transparent ${y===0?"opacity-30":"cursor-pointer"}`,children:e.jsx(Ne,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:d,disabled:y===m-1,className:`p-1 border-none bg-transparent ${y===m-1?"opacity-30":"cursor-pointer"}`,children:e.jsx(ce,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:a,className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500 hover:bg-red-50 rounded",children:e.jsx(K,{size:16})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600",children:"Anweisung f√ºr diesen Abschnitt"}),o.length>0&&e.jsx(we,{variables:o,onSelect:n})]}),e.jsx("textarea",{ref:N,value:s.instruction,onChange:x=>b("instruction",x.target.value),placeholder:"z.B. 'Erstelle 5-7 offene Fragen um Bedarf zu wecken basierend auf ${customer_type}'",rows:2,className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm resize-y"})]})]})},we=({variables:s,onSelect:y})=>{const[m,o]=r.useState(!1),p=r.useRef(null);return r.useEffect(()=>{const a=h=>{p.current&&!p.current.contains(h.target)&&o(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),s.length===0?null:e.jsxs("div",{className:"relative",ref:p,children:[e.jsxs("button",{onClick:()=>o(!m),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-indigo-50 text-indigo-600 text-xs font-medium border-none cursor-pointer hover:bg-indigo-100 transition-colors",children:[e.jsx(I,{size:14}),"Variable einf√ºgen",e.jsx(ce,{size:14,className:`transition-transform ${m?"rotate-180":""}`})]}),e.jsx(_e,{children:m&&e.jsx(ue.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-slate-200 z-50 min-w-[180px] py-1",children:s.map(a=>e.jsxs("button",{onClick:()=>{y(a.key),o(!1)},className:"w-full px-3 py-2.5 text-left text-sm hover:bg-indigo-50 border-none bg-transparent cursor-pointer flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-slate-800 font-medium",children:a.label}),e.jsxs("code",{className:"text-xs text-indigo-700 bg-indigo-100 px-2 py-1 rounded font-mono font-semibold whitespace-nowrap",children:["$","{","$",a.key,"}"]})]},a.id))})})]})},kt=({selectedIcon:s,onSelect:y})=>e.jsx("div",{className:"flex flex-wrap gap-3",children:Ie.map(({key:m,icon:o,label:p})=>{const a=s===m;return e.jsx("button",{onClick:()=>y(m),title:p,className:`w-[60px] h-[60px] rounded-xl border-2 flex items-center justify-center cursor-pointer transition-all ${a?"border-primary bg-primary/10":"border-slate-200 bg-white hover:border-primary/40"}`,children:e.jsx(o,{size:28,className:a?"text-primary":"text-slate-500"})},m)})}),St=({isOpen:s,onClose:y,templateData:m,variables:o})=>{const[p,a]=r.useState(!1),[h,d]=r.useState(null),[w,N]=r.useState(null),[b,n]=r.useState({});r.useEffect(()=>{const i={};o.forEach(f=>{i[f.key]=f.placeholder||`[${f.label}]`}),n(i),d(null)},[o]);const x=async()=>{a(!0),N(null);try{if(!F.getGeminiApiKey())throw new Error("Kein Gemini API-Key konfiguriert");let f=m.aiRole+`

`;m.sections.length>0&&(f+=`Erstelle ein strukturiertes Briefing mit folgenden Abschnitten:

`,m.sections.forEach((j,v)=>{f+=`### ${v+1}. ${j.title}
${j.instruction}

`})),m.aiBehavior&&(f+=`

WICHTIG: ${m.aiBehavior}`),Object.entries(b).forEach(([j,v])=>{f=f.replace(new RegExp(`\\$\\{${j}\\}`,"g"),v)}),d({prompt:f,sections:m.sections.map(j=>({title:j.title,instruction:j.instruction.replace(/\$\{(\w+)\}/g,(v,l)=>b[l]||`[${l}]`)}))})}catch(i){N(i.message)}finally{a(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4",children:e.jsxs(ue.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl w-full max-w-[800px] max-h-[85vh] flex flex-col shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 flex items-center justify-between bg-gradient-to-r from-indigo-50 to-violet-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{size:20,className:"text-indigo-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Template Vorschau"})]}),e.jsx("button",{onClick:y,className:"p-2 border-none bg-white/80 rounded-lg cursor-pointer hover:bg-white transition-colors",children:e.jsx(Te,{size:18,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[o.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Testwerte f√ºr Variablen:"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map(i=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:i.label}),e.jsx("input",{type:"text",value:b[i.key]||"",onChange:f=>n(j=>({...j,[i.key]:f.target.value})),className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm"})]},i.id))})]}),e.jsx("button",{onClick:x,disabled:p,className:"w-full mb-6 flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-violet-500 text-white font-semibold border-none cursor-pointer disabled:opacity-50",children:p?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:18,className:"animate-spin"}),"Generiere Vorschau..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:18}),"Vorschau generieren"]})}),w&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 mb-4 flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-red-500"}),e.jsx("span",{className:"text-red-700 text-sm",children:w})]}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-500 uppercase mb-2",children:"KI-Rolle"}),e.jsx("p",{className:"text-sm text-slate-700",children:m.aiRole})]}),h.sections.map((i,f)=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-200",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:i.title}),e.jsx("p",{className:"text-sm text-slate-600",children:i.instruction})]},f)),m.aiBehavior&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-amber-600 uppercase mb-2",children:"Verhalten"}),e.jsx("p",{className:"text-sm text-amber-800",children:m.aiBehavior})]}),e.jsxs("div",{className:"bg-slate-900 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-400 uppercase",children:"Vollst√§ndiger Prompt"}),e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(h.prompt),className:"flex items-center gap-1.5 px-2 py-1 rounded bg-slate-800 text-slate-300 text-xs border-none cursor-pointer hover:bg-slate-700",children:[e.jsx(ee,{size:12}),"Kopieren"]})]}),e.jsx("pre",{className:"text-sm text-slate-300 whitespace-pre-wrap font-mono leading-relaxed max-h-[300px] overflow-auto",children:h.prompt})]})]})]})]})}):null},Ct=({isOpen:s,onClose:y,onSave:m,editTemplate:o=null,demoCode:p})=>{const[a,h]=r.useState(""),[d,w]=r.useState(""),[N,b]=r.useState("file-text"),[n,x]=r.useState([]),[i,f]=r.useState(""),[j,v]=r.useState([]),[l,S]=r.useState(""),[$,T]=r.useState("empty"),[A,L]=r.useState(!1),[u,g]=r.useState(null),[C,B]=r.useState("basics"),[V,R]=r.useState(!1),Y=r.useRef(null),X=r.useRef(null);r.useEffect(()=>{if(o){if(h(o.title||""),w(o.description||""),b(o.icon||"file-text"),x((o.variables_schema||[]).map(t=>({...t,id:t.id||P(),options:(t.options||[]).map(c=>({...c,id:c.id||P()}))}))),o.ai_role?f(o.ai_role):o.system_prompt&&f(o.system_prompt),o.ai_task)try{const t=JSON.parse(o.ai_task);Array.isArray(t)&&v(t.map(c=>({...c,id:c.id||P()})))}catch{v([{id:P(),title:"Hauptabschnitt",instruction:o.ai_task}])}S(o.ai_behavior||""),T("empty")}else h(""),w(""),b("file-text"),x([]),f(""),v([]),S(""),T("empty");B("basics"),g(null)},[o,s]);const he=t=>{const c=Ee.find(k=>k.key===t);if(!c||t==="empty"){T("empty");return}T(t),f(c.aiRole),v(c.sections.map(k=>({...k,id:P()}))),S(c.aiBehavior),b(Ie.find(k=>k.icon===c.icon)?.key||"file-text")},pe=()=>{x([...n,jt()])},be=(t,c)=>{const k=[...n];k[t]=c,x(k)},ge=t=>{x(n.filter((c,k)=>k!==t))},E=t=>{if(t===0)return;const c=[...n];[c[t-1],c[t]]=[c[t],c[t-1]],x(c)},M=t=>{if(t===n.length-1)return;const c=[...n];[c[t],c[t+1]]=[c[t+1],c[t]],x(c)},Fe=()=>{v([...j,wt()])},Le=(t,c)=>{const k=[...j];k[t]=c,v(k)},Oe=t=>{v(j.filter((c,k)=>k!==t))},Pe=t=>{if(t===0)return;const c=[...j];[c[t-1],c[t]]=[c[t],c[t-1]],v(c)},Ve=t=>{if(t===j.length-1)return;const c=[...j];[c[t],c[t+1]]=[c[t+1],c[t]],v(c)},ve=(t,c,k,D)=>{const O=t.current;if(O){const fe=O.selectionStart,Ue=O.selectionEnd,je=`\${${D}}`,We=k.substring(0,fe)+je+k.substring(Ue);c(We),setTimeout(()=>{O.focus(),O.setSelectionRange(fe+je.length,fe+je.length)},0)}else c(k+`\${${D}}`)},Me=()=>{let t=i+`

`;return j.length>0&&(t+=`Erstelle ein strukturiertes Briefing mit folgenden Abschnitten:

`,j.forEach((c,k)=>{t+=`### ${k+1}. ${c.title}
${c.instruction}

`})),l&&(t+=`
WICHTIG: ${l}`),t},Ke=()=>{if(!a.trim())return g("Bitte gib einen Titel ein."),B("basics"),!1;if(!i.trim())return g("Bitte definiere eine KI-Rolle."),B("prompt"),!1;if(j.length===0)return g("Bitte f√ºge mindestens einen Abschnitt hinzu."),B("prompt"),!1;for(const t of j)if(!t.title.trim())return g("Alle Abschnitte ben√∂tigen einen Titel."),B("prompt"),!1;for(const t of n){if(!t.key.trim()||!t.label.trim())return g("Alle Variablen ben√∂tigen einen Namen und eine Bezeichnung."),B("variables"),!1;if(t.type==="select"&&(!t.options||t.options.length===0))return g(`Variable "${t.label}" ben√∂tigt mindestens eine Auswahloption.`),B("variables"),!1}return!0},Ge=async()=>{if(g(null),!!Ke()){L(!0);try{const t=n.map(D=>({key:D.key,label:D.label,type:D.type,required:D.required,placeholder:D.placeholder,...D.type==="select"?{options:D.options.map(O=>({value:O.value,label:O.label}))}:{}})),c={title:a.trim(),description:d.trim(),icon:N,ai_role:i,ai_task:JSON.stringify(j.map(D=>({title:D.title,instruction:D.instruction}))),ai_behavior:l,system_prompt:Me(),variables_schema:t,...p?{demo_code:p}:{}};let k;if(o?k=await F.request(`/smartbriefing/templates/${o.id}`,{method:"PUT",body:JSON.stringify(c)}):k=await F.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(c)}),k.success)m?.(k.data.template),y();else throw new Error(k.message||"Fehler beim Speichern")}catch(t){console.error("[CreateTemplateDialog] Save error:",t),g(t.message||"Fehler beim Speichern des Templates")}finally{L(!1)}}};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(ue.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-[750px] max-h-[90vh] flex flex-col shadow-2xl overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-slate-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 text-xl font-bold text-slate-900",children:o?"Template bearbeiten":"Neues Template erstellen"}),e.jsx("p",{className:"mt-1 mb-0 text-sm text-slate-500",children:"Erstelle ein pers√∂nliches Briefing-Template"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-1.5 px-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(ye,{size:16}),"Vorschau"]}),e.jsx("button",{onClick:y,className:"p-2 border-none bg-slate-100 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors",children:e.jsx(Te,{size:20,className:"text-slate-500"})})]})]}),e.jsx("div",{className:"flex border-b border-slate-200 px-6",children:[{key:"basics",label:"1. Grundlagen"},{key:"variables",label:"2. Eingabefelder"},{key:"prompt",label:"3. KI-Anweisung"}].map(t=>e.jsx("button",{onClick:()=>B(t.key),className:`px-5 py-3 border-none bg-transparent text-sm font-semibold cursor-pointer -mb-px transition-all ${C===t.key?"text-primary border-b-[3px] border-primary":"text-slate-500 border-b-[3px] border-transparent hover:text-slate-700"}`,children:t.label},t.key))}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[u&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 mb-4 flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:u})]}),C==="basics"&&e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Titel *"}),e.jsx("input",{type:"text",value:a,onChange:t=>h(t.target.value),placeholder:"z.B. Sales Discovery Call Prep",className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-[15px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Beschreibung"}),e.jsx("textarea",{value:d,onChange:t=>w(t.target.value),placeholder:"Kurze Beschreibung, wof√ºr dieses Template verwendet wird...",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Symbol"}),e.jsx(kt,{selectedIcon:N,onSelect:b})]})]}),C==="variables"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{size:16,className:"text-slate-500"}),e.jsxs("span",{className:"text-[13px] text-slate-500",children:["Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausf√ºllen soll. Diese k√∂nnen dann im Prompt als $","{variablenname}"," verwendet werden."]})]})}),n.map((t,c)=>e.jsx(Nt,{variable:t,index:c,total:n.length,onChange:k=>be(c,k),onDelete:()=>ge(c),onMoveUp:()=>E(c),onMoveDown:()=>M(c)},t.id)),e.jsxs("button",{onClick:pe,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3.5 rounded-xl border-2 border-dashed border-slate-300 bg-white text-slate-500 text-sm font-medium cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(I,{size:18}),"Eingabefeld hinzuf√ºgen"]}),n.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Noch keine Eingabefelder definiert."})]}),C==="prompt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-violet-50 rounded-xl p-4 border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(me,{size:18,className:"text-indigo-600"}),e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Schnellstart mit Vorlage"})]}),e.jsx("select",{value:$,onChange:t=>he(t.target.value),className:"w-full px-3.5 py-3 rounded-xl border border-indigo-200 text-sm bg-white cursor-pointer",children:Ee.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"KI-Rolle *"}),n.length>0&&e.jsx(we,{variables:n,onSelect:t=>ve(Y,f,i,t)})]}),e.jsx("textarea",{ref:Y,value:i,onChange:t=>f(t.target.value),placeholder:"z.B. 'Du bist ein erfahrener Sales-Coach mit 15+ Jahren B2B-Vertriebserfahrung...'",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Briefing-Abschnitte *"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[j.length," Abschnitt",j.length!==1?"e":""]})]}),j.map((t,c)=>e.jsx(vt,{section:t,index:c,total:j.length,variables:n,onChange:k=>Le(c,k),onDelete:()=>Oe(c),onMoveUp:()=>Pe(c),onMoveDown:()=>Ve(c)},t.id)),e.jsxs("button",{onClick:Fe,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3 rounded-xl border-2 border-dashed border-indigo-300 bg-indigo-50/50 text-indigo-600 text-sm font-medium cursor-pointer transition-all hover:bg-indigo-100",children:[e.jsx(I,{size:18}),"Abschnitt hinzuf√ºgen"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Verhalten & Stil (optional)"}),n.length>0&&e.jsx(we,{variables:n,onSelect:t=>ve(X,S,l,t)})]}),e.jsx("textarea",{ref:X,value:l,onChange:t=>S(t.target.value),placeholder:"z.B. 'Schreibe praxisnah und actionable. Vermeide Theorie - fokussiere auf konkrete Formulierungen.'",rows:2,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),n.length>0&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"Verf√ºgbare Variablen (klicken zum Kopieren)"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(t=>e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`\${${t.key}}`)},className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-white rounded-lg border border-slate-200 text-xs cursor-pointer hover:border-indigo-300 hover:bg-indigo-50 transition-colors",children:[e.jsx("span",{className:"text-slate-600",children:t.label}),e.jsxs("code",{className:"font-mono text-indigo-600",children:["$","{","$",t.key,"}"]}),e.jsx(ee,{size:12,className:"text-slate-400"})]},t.id))})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 flex justify-between items-center gap-3",children:[e.jsx("button",{onClick:y,className:"px-6 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Abbrechen"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(ye,{size:16}),"Vorschau"]}),e.jsx("button",{onClick:Ge,disabled:A,className:`flex items-center gap-2 px-6 py-3 rounded-xl border-none bg-brand-gradient text-white text-sm font-semibold transition-all ${A?"cursor-not-allowed opacity-70":"cursor-pointer"}`,children:A?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:18,className:"animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:18}),o?"Speichern":"Template erstellen"]})})]})]})]})}),e.jsx(St,{isOpen:V,onClose:()=>R(!1),templateData:{aiRole:i,sections:j,aiBehavior:l},variables:n})]}):null},z={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},Pt=({isAuthenticated:s,requireAuth:y,setPendingAction:m,onNavigateToSimulator:o,onNavigateToHistory:p,demoCode:a})=>{const[h,d]=r.useState(z.DASHBOARD),[w,N]=r.useState(null),[b,n]=r.useState(null),[x,i]=r.useState(null),[f,j]=r.useState(null),[v,l]=r.useState(!1),[S,$]=r.useState(null),[T,A]=r.useState(0);r.useEffect(()=>{f&&s&&(N(f),d(z.FORM),j(null))},[f,s]),r.useEffect(()=>{window.scrollTo(0,0)},[h]);const L=r.useCallback(E=>{N(E),d(z.FORM)},[]),u=r.useCallback(()=>{N(null),n(null),i(null),d(z.DASHBOARD)},[]),g=r.useCallback(E=>{n(E),i(E),d(z.WORKBOOK)},[]),C=r.useCallback(()=>{n(null),i(null),N(null),d(z.DASHBOARD)},[]),B=r.useCallback(()=>{n(null),i(null),d(z.FORM)},[]);r.useCallback(()=>{d(z.LIST)},[]);const V=r.useCallback(E=>{i(E),d(z.WORKBOOK)},[]);r.useCallback(()=>{i(null),d(z.LIST)},[]);const R=r.useCallback(E=>{o&&o(E)},[o]),Y=r.useCallback(async E=>{try{if((await F.request(`/smartbriefing/briefings/${E.id}`,{method:"DELETE"})).success)i(null),d(z.DASHBOARD);else throw new Error("Fehler beim L√∂schen")}catch(M){throw console.error("[SmartBriefing] Error deleting briefing:",M),M}},[]),X=r.useCallback(()=>{$(null),l(!0)},[]),he=r.useCallback(E=>{$(E),l(!0)},[]),pe=r.useCallback(()=>{l(!1),$(null)},[]),be=r.useCallback(E=>{A(M=>M+1)},[]),ge=()=>{switch(h){case z.FORM:return e.jsx(mt,{template:w,onBack:u,onBriefingGenerated:g,isAuthenticated:s});case z.RESULT:return e.jsx(ht,{briefing:b,template:w,onBack:u,onCreateNew:C,onGenerateAnother:B});case z.LIST:return e.jsx(ft,{onOpenBriefing:V,onCreateNew:C,isAuthenticated:s});case z.WORKBOOK:return e.jsx(at,{briefing:x,onBack:u,onDelete:Y,onStartSimulation:o?R:null});case z.DASHBOARD:default:return e.jsx(ct,{onSelectTemplate:L,onShowList:p,onCreateTemplate:X,onEditTemplate:he,isAuthenticated:s,requireAuth:y,setPendingAction:m,demoCode:a},T)}};return e.jsxs("div",{className:"min-h-full",children:[ge(),e.jsx(Ct,{isOpen:v,onClose:pe,onSave:be,editTemplate:S,demoCode:a})]})};export{ft as BriefingList,ht as BriefingResult,at as BriefingWorkbook,Pt as SmartBriefingApp,ct as SmartBriefingDashboard,mt as SmartBriefingForm};
