import{F as K,Q as de,aE as ae,s as ve,aF as ke,aG as Ce,aH as Se,aI as _e,aJ as ze,t as Pe,L as M,u as Ee,T as Ae,I as Be,X as me,b as xe,aK as $e,ah as W,Y as O,aL as Le,aM as Me,aN as Ie,aO as Fe,g as Te,aP as De,P as Oe,aQ as Ue,M as Re,ad as Ge,ag as Je,Z as He,aR as qe,aS as Ke,aT as Ve,i as We,aU as Qe,J as Ze,aA as he,E as Ye,a3 as Xe,a8 as et,e as tt,V as st,a as re,_ as ue,R as pe,c as nt,S as at,z as ge,a2 as rt,ax as it,ay as lt,a1 as ot,l as ct,at as be,x as dt,U as fe,am as je,r as we,j as e,w as oe,$ as mt,y as ie,C as le,A as ye,m as ne,aV as xt,aW as ht,aC as ut,a0 as pt,h as gt}from"./ui-vendor-4RzMPcHM.js";import{a as l}from"./react-vendor-uDOJF2jQ.js";import{u as bt,w as L,n as ft}from"./FeatureInfoButton-DkKoIptM.js";import{u as jt}from"./useMobile-YxjH166V.js";import{C as Z,B as q}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";const wt={"file-text":K,briefcase:we,banknote:je,users:fe,user:dt,"message-circle":be,target:ct,award:ot,book:lt,clipboard:it,star:rt,lightbulb:ge,shield:at,compass:nt,rocket:pe,calendar:ue,sparkles:re,video:st,mic:tt,play:et,"check-circle":Xe,"alert-circle":Ye,"help-circle":he,settings:Ze,home:Qe,"trending-up":We,"bar-chart":Ve,"pie-chart":Ke,activity:qe,zap:He,heart:Je,"thumbs-up":Ge,"message-square":Re,mail:Ue,phone:Oe,"map-pin":De,clock:Te,bell:Fe,search:Ie,filter:Me,edit:Le,trash:O,plus:W,minus:$e,check:xe,x:me,info:Be,warning:Ae,refresh:Ee,loader:M,globe:Pe,link:ze,bookmark:_e,tag:Se,code:Ce,database:ke,server:ve,pen:ae,bot:de},yt={"file-text":K,briefcase:we,banknote:je,users:fe},Nt=(t,a=K)=>wt[t]||a,Tt=t=>yt[t]||K,vt=t=>{if(!t)return[];const a=t.split(`
`),i=[];for(const d of a){const o=d.trim();if(!o)continue;let s=null;const m=o.match(/^[\*\-â€¢]\s+(.+)$/);m&&(s=m[1].trim());const x=o.match(/^\d+[\.\)]\s+(.+)$/);!s&&x&&(s=x[1].trim());const g=o.match(/^\*\*([^*]+)\*\*:?\s*(.+)$/);if(!s&&g&&(s=o),s){const u=s.match(/^\*\*([^*]+)\*\*:?\s*(.*)$/);if(u&&u[1]){const b=u[1].trim(),k=u[2]?.trim()||"";i.push({id:`ap-${i.length}`,label:b,content:k})}else{const b=s.replace(/\*\*/g,"").replace(/\*/g,""),S=b.split(/\s+/).slice(0,4).join(" ");i.push({id:`ap-${i.length}`,label:S.length>40?S.substring(0,40)+"...":S,content:b})}}}return i},kt={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"GesprÃ¤chsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"GesprÃ¤chsziel",product_service:"Produkt/Service",user_name:"Name",skills:"FÃ¤higkeiten",strengths:"StÃ¤rken",challenges:"Herausforderungen"},Ct=t=>kt[t]||t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),Q=t=>{if(!t)return null;const a=[];let i=t,d=0;for(;i.length>0;){const o=i.match(/\*\*(.+?)\*\*/),s=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),m=i.match(/`([^`]+)`/),x=[{match:o,type:"bold"},{match:s,type:"italic"},{match:m,type:"code"}].filter(u=>u.match);if(x.length===0){a.push(i);break}const g=x.reduce((u,b)=>(u.match?.index??1/0)<(b.match?.index??1/0)?u:b);switch(g.match.index>0&&a.push(i.substring(0,g.match.index)),g.type){case"bold":a.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:g.match[1]},d++));break;case"italic":a.push(e.jsx("em",{className:"italic",children:g.match[1]||g.match[2]},d++));break;case"code":a.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:g.match[1]},d++));break}i=i.substring(g.match.index+g.match[0].length)}return a},Ne=({content:t})=>{if(!t)return null;const a=i=>{const d=i.split(`
`),o=[];let s=[],m=null;const x=()=>{s.length>0&&(o.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:s.map((g,u)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:m==="number"?`${u+1}.`:"â€¢"}),Q(g)]},u))},`list-${o.length}`)),s=[],m=null)};return d.forEach((g,u)=>{const b=g.trim();if(!b){x();return}if(b.startsWith("- ")||b.startsWith("* ")){m!=="bullet"&&(x(),m="bullet"),s.push(b.substring(2));return}const k=b.match(/^(\d+)\.\s/);if(k){m!=="number"&&(x(),m="number"),s.push(b.substring(k[0].length));return}x(),o.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:Q(b)},`p-${u}`))}),x(),o};return e.jsx("div",{children:a(t)})},St=({item:t,onRestore:a})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:t.label})," - gelÃ¶scht"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(pt,{size:12}),"Wiederherstellen"]})]}),_t=({explanation:t,onDelete:a,onAddAsItem:i,onAddActionPoint:d,itemLabel:o})=>{const[s,m]=l.useState(!0),[x,g]=l.useState(new Set),u=vt(t.answer),b=u.filter(p=>!x.has(p.id)),k=p=>{d(p),g(E=>new Set([...E,p.id]))},S=()=>{if(t.quick_action)switch(t.quick_action){case"explain":return"ðŸ’¡ ErklÃ¤rung";case"examples":return"ðŸ“ Beispiele";case"howto":return"ðŸš€ Umsetzung";default:return"Frage"}return`â“ ${t.question}`},A=t.answer?.length>100?t.answer.substring(0,100)+"...":t.answer;return e.jsxs("div",{className:"bg-white rounded-xl border border-amber-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>m(!s),className:"w-full px-3 py-2.5 bg-transparent border-none cursor-pointer flex items-center gap-2 text-left hover:bg-amber-50/50 transition-colors",children:[e.jsx(gt,{size:14,className:`text-amber-600 transition-transform flex-shrink-0 ${s?"rotate-90":""}`}),e.jsx("span",{className:"text-[12px] font-medium text-amber-700 flex-1 truncate",children:S()}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",onClick:p=>p.stopPropagation(),children:[i&&e.jsx("button",{onClick:p=>{p.stopPropagation(),i(t.answer,o)},title:"Gesamten Block als neuen Punkt hinzufÃ¼gen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:e.jsx(W,{size:14})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),a(t.id)},title:"ErklÃ¤rung lÃ¶schen",className:"p-1 rounded bg-transparent border-none text-slate-400 cursor-pointer hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(me,{size:14})})]})]}),!s&&e.jsx("div",{className:"px-3 pb-2.5 pt-0",children:e.jsx("p",{className:"text-[12px] text-slate-500 m-0 line-clamp-2",children:A})}),e.jsx(ye,{children:s&&e.jsx(ne.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 border-t border-amber-100",children:[e.jsx("div",{className:"text-[13px] text-slate-600 whitespace-pre-wrap mt-2.5 leading-relaxed",children:Q(t.answer)}),u.length>0&&d&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-100",children:[e.jsxs("p",{className:"text-[11px] font-medium text-amber-700 mb-2 flex items-center gap-1",children:[e.jsx(W,{size:12}),"Einzelne Punkte hinzufÃ¼gen:",x.size>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",x.size," hinzugefÃ¼gt)"]})]}),b.length>0?e.jsx("div",{className:"space-y-2",children:b.map(p=>e.jsx("div",{className:"p-2.5 bg-white rounded-xl border border-amber-100 hover:border-amber-200 hover:shadow-sm transition-all group",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500 flex-shrink-0 mt-1.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"text-[13px] font-semibold text-slate-800 m-0 mb-0.5 leading-snug",children:p.label}),p.content&&e.jsx("p",{className:"text-[12px] text-slate-600 m-0 leading-snug",children:p.content.length>150?p.content.substring(0,150)+"...":p.content})]}),e.jsx("button",{onClick:()=>k(p),title:"Diesen Punkt zur Liste hinzufÃ¼gen",className:"p-1.5 rounded-lg bg-transparent border-none text-amber-600 cursor-pointer hover:text-white hover:bg-indigo-500 transition-all opacity-60 group-hover:opacity-100 flex-shrink-0",children:e.jsx(W,{size:14})})]})},p.id))}):e.jsx("p",{className:"text-[12px] text-green-600 italic m-0",children:"âœ“ Alle Punkte wurden hinzugefÃ¼gt"})]})]})})})]})},ce=({item:t,sectionId:a,onUpdateItem:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:m})=>{const[x,g]=l.useState(t.user_note||""),[u,b]=l.useState(!1),[k,S]=l.useState(!1),[A,p]=l.useState(!1),[E,B]=l.useState(!!t.user_note),[P,I]=l.useState(!1),[h,U]=l.useState(""),[v,D]=l.useState(!1),[R,G]=l.useState(!0),F=t.ai_explanations||[];l.useEffect(()=>{p(x!==(t.user_note||""))},[x,t.user_note]);const Y=async()=>{b(!0);try{await i(a,t.id,{user_note:x}),S(!0),p(!1),setTimeout(()=>S(!1),2e3)}catch(f){console.error("Error saving note:",f)}finally{b(!1)}},X=async()=>{try{await i(a,t.id,{deleted:!0})}catch(f){console.error("Error deleting item:",f)}},ee=async()=>{try{await i(a,t.id,{deleted:!1})}catch(f){console.error("Error restoring item:",f)}},J=async f=>{if(d){D(!0);try{await d(a,t.id,{quick_action:f}),G(!0)}catch(n){console.error("Error asking AI:",n)}finally{D(!1)}}},V=async()=>{if(!(!d||!h.trim())){D(!0);try{await d(a,t.id,{question:h.trim()}),U(""),G(!0)}catch(f){console.error("Error asking AI:",f)}finally{D(!1)}}},te=async f=>{if(o)try{await o(a,t.id,f)}catch(n){console.error("Error deleting explanation:",n)}};return t.deleted?e.jsx(St,{item:t,onRestore:ee}):e.jsxs(Z,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:t.label})]}),t.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:Q(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[F.length>0&&!P&&e.jsxs("span",{className:"text-[11px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:[F.length," KI"]}),t.user_note&&!E&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>{I(!P),P||B(!1)},title:"KI-Hilfe",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${P?"bg-amber-100 text-amber-600":"bg-transparent text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,children:e.jsx(be,{size:16})}),e.jsx("button",{onClick:()=>{B(!E),E||I(!1)},title:"Notiz hinzufÃ¼gen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${E?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(ae,{size:16})}),e.jsx("button",{onClick:X,title:"LÃ¶schen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(O,{size:16})})]})]}),P&&e.jsxs("div",{className:"px-3.5 py-3 bg-amber-50 border-t border-amber-100",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>J("explain"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(he,{size:14}),"ErklÃ¤re genauer"]}),e.jsxs("button",{onClick:()=>J("examples"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(xt,{size:14}),"Beispiele"]}),e.jsxs("button",{onClick:()=>J("howto"),disabled:v,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-white border border-amber-200 text-amber-700 text-[12px] font-medium cursor-pointer hover:bg-amber-100 hover:border-amber-300 transition-all disabled:opacity-50 disabled:cursor-wait",children:[e.jsx(pe,{size:14}),"Wie umsetzen?"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:f=>U(f.target.value),onKeyDown:f=>f.key==="Enter"&&!v&&V(),placeholder:"Oder stelle eine eigene Frage...",disabled:v,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false","data-form-type":"other",className:"flex-1 px-3 py-2 rounded-xl border border-amber-200 text-[13px] text-slate-700 outline-none transition-colors focus:border-amber-400 focus:ring-2 focus:ring-amber-100 disabled:bg-gray-50"}),e.jsx(q,{variant:"primary",size:"sm",onClick:V,disabled:v||!h.trim(),icon:v?e.jsx(M,{size:14,className:"animate-spin"}):e.jsx(ht,{size:14}),className:"bg-amber-500 hover:bg-amber-600 border-amber-500",children:"Fragen"})]}),v&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-amber-600 text-[13px]",children:[e.jsx(M,{size:14,className:"animate-spin"}),"KI denkt nach..."]}),F.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>G(!R),className:"flex items-center gap-1 text-[12px] font-medium text-amber-700 bg-transparent border-none cursor-pointer mb-2",children:[R?e.jsx(ie,{size:14}):e.jsx(le,{size:14}),"KI-ErklÃ¤rungen (",F.length,")"]}),R&&e.jsx("div",{className:"space-y-2",children:F.map(f=>e.jsx(_t,{explanation:f,itemLabel:t.label,onDelete:te,onAddAsItem:s?(n,r)=>s(a,n,r):null,onAddActionPoint:m?n=>m(a,n,t.label):null},f.id))})]})]}),E&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:x,onChange:f=>g(f.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(q,{variant:"secondary",size:"sm",onClick:()=>{B(!1),g(t.user_note||"")},children:"Abbrechen"}),e.jsx(q,{variant:k?"secondary":"primary",size:"sm",onClick:Y,disabled:u||!A,icon:u?e.jsx(M,{size:12,className:"animate-spin"}):k?e.jsx(xe,{size:12}):e.jsx(ut,{size:12}),className:k?"bg-green-100 text-green-700 border-green-200":"",children:k?"Gespeichert!":"Speichern"})]})]})]})},zt=({onClick:t,isGenerating:a})=>e.jsx("button",{onClick:t,disabled:a,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{size:16}),"5 weitere Punkte generieren"]})}),Pt=({section:t,onUpdateItem:a,onGenerateMore:i,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:m,isExpanded:x,onToggle:g})=>{const[u,b]=l.useState(!1),k=async()=>{b(!0);try{await i(t.id)}catch(h){console.error("Error generating more items:",h)}finally{b(!1)}},S=l.useCallback(()=>{if(!t.ai_content)return{type:"empty",items:[],content:""};try{const h=JSON.parse(t.ai_content);if(h&&Array.isArray(h.items))return{type:"items",items:h.items,content:""}}catch{}return{type:"markdown",items:[],content:t.ai_content}},[t.ai_content]),{type:A,items:p,content:E}=S(),B=p.filter(h=>!h.deleted),P=p.filter(h=>h.deleted),I=p.some(h=>h.user_note&&!h.deleted);return e.jsxs(Z,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:g,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${x?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:t.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[A==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[B.length," Punkte"]}),I&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(ae,{size:12}),"Notizen"]}),x?e.jsx(ie,{size:20,className:"text-slate-400"}):e.jsx(le,{size:20,className:"text-slate-400"})]})]}),x&&e.jsx("div",{className:"px-5 py-4",children:A==="items"?e.jsxs(e.Fragment,{children:[B.map(h=>e.jsx(ce,{item:h,sectionId:t.id,onUpdateItem:a,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:m},h.id)),i&&e.jsx(zt,{onClick:k,isGenerating:u}),P.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(O,{size:12}),P.length," gelÃ¶schte ",P.length===1?"Punkt":"Punkte"]}),P.map(h=>e.jsx(ce,{item:h,sectionId:t.id,onUpdateItem:a,onAskItem:d,onDeleteExplanation:o,onAddAsItem:s,onAddActionPoint:m},h.id))]})]}):A==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(de,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(Ne,{content:E})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfÃ¼gbar"})})]})},se=({onClick:t,disabled:a,loading:i,icon:d,danger:o,title:s})=>e.jsx("button",{onClick:t,disabled:a,title:s,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${o?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:i?e.jsx(M,{size:16,className:"animate-spin"}):e.jsx(d,{size:16})}),Et=({variables:t,isExpanded:a,onToggle:i})=>!t||Object.keys(t).length===0?null:e.jsxs(Z,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:i,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(t).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:a?"Einklappen":"Ausklappen"}),a?e.jsx(ie,{size:16}):e.jsx(le,{size:16})]})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(t).map(([d,o])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[Ct(d),":"]})," ",o]},d))})]}),At=({isOpen:t,onClose:a,onConfirm:i,isDeleting:d})=>e.jsx(ye,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(O,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelÃ¶scht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{variant:"secondary",onClick:a,disabled:d,fullWidth:!0,children:"Abbrechen"}),e.jsx(q,{variant:"danger",onClick:i,disabled:d,icon:d?e.jsx(M,{size:16,className:"animate-spin"}):e.jsx(O,{size:16}),fullWidth:!0,children:d?"LÃ¶schen...":"LÃ¶schen"})]})]})})]})}),Dt=({briefing:t,onBack:a,onDelete:i})=>{const{config:d}=bt(),o=jt(),[s,m]=l.useState(t),[x,g]=l.useState(!t?.sections),[u,b]=l.useState(null),[k,S]=l.useState({}),[A,p]=l.useState(!1),[E,B]=l.useState(!1),[P,I]=l.useState(!1),[h,U]=l.useState(!1),[v,D]=l.useState(!1);l.useRef(null);const R=Nt(s?.template_icon)||K;l.useEffect(()=>{const n=()=>{const r=window.scrollY||document.documentElement.scrollTop;D(r>80)};return window.addEventListener("scroll",n,{passive:!0}),()=>window.removeEventListener("scroll",n)},[]),l.useEffect(()=>{const n=async()=>{if(s?.sections){const r={};s.sections.forEach(w=>{r[w.id]=!0}),S(r),g(!1);return}try{g(!0);const r=await L.request(`/smartbriefing/briefings/${s.id}`,{method:"GET"});if(r.success&&r.data?.briefing){m(r.data.briefing);const w={};r.data.briefing.sections?.forEach(N=>{w[N.id]=!0}),S(w)}else throw new Error("Fehler beim Laden des Briefings")}catch(r){console.error("[SmartBriefing] Error fetching briefing:",r),b(r.message)}finally{g(!1)}};s?.id&&n()},[s?.id]);const G=l.useCallback(n=>{S(r=>({...r,[n]:!r[n]}))},[]),F=l.useCallback(async(n,r,w)=>{const N=await L.request(`/smartbriefing/sections/${n}/items/${r}`,{method:"PATCH",body:JSON.stringify(w)});if(!N.success)throw new Error("Fehler beim Speichern");m(y=>({...y,sections:y.sections.map(c=>c.id===n?N.data.section:c)}))},[]),Y=l.useCallback(async n=>{const r=await L.request(`/smartbriefing/sections/${n}/generate-more`,{method:"POST"});if(!r.success)throw new Error(r.message||"Fehler beim Generieren");return m(w=>({...w,sections:w.sections.map(N=>N.id===n?r.data.section:N)})),r.data.new_items_count},[]),X=l.useCallback(async(n,r,w)=>{const N=await L.askBriefingItem(n,r,w);return m(y=>({...y,sections:y.sections.map(c=>{if(c.id!==n)return c;let j;try{j=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),c}if(!j?.items)return c;const C=j.items.map($=>$.id===r?N.item:$);return{...c,ai_content:JSON.stringify({...j,items:C})}})})),N},[]),ee=l.useCallback(async(n,r,w)=>{await L.deleteBriefingItemExplanation(n,r,w),m(N=>({...N,sections:N.sections.map(y=>{if(y.id!==n)return y;let c;try{c=typeof y.ai_content=="string"?JSON.parse(y.ai_content):y.ai_content}catch{return console.error("[SmartBriefing] Failed to parse ai_content"),y}if(!c?.items)return y;const j=c.items.map(C=>C.id!==r?C:{...C,ai_explanations:(C.ai_explanations||[]).filter($=>$.id!==w)});return{...y,ai_content:JSON.stringify({...c,items:j})}})}))},[]),J=l.useCallback(async(n,r,w)=>{const N=`Vertiefung: ${w}`,y=r.length>200?r.substring(0,200)+"...":r,c=s?.sections?.find(_=>_.id===n);if(!c)return;let j;try{j=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{console.error("[SmartBriefing] Failed to parse ai_content");return}if(!j?.items)return;const C={id:crypto.randomUUID(),label:N,content:y,user_note:`VollstÃ¤ndige KI-Antwort:

${r}`,deleted:!1,ai_explanations:[]},$={...j,items:[...j.items,C]},H=JSON.stringify($);m(_=>({..._,sections:_.sections.map(z=>z.id===n?{...z,ai_content:H}:z)}));try{await L.request(`/smartbriefing/sections/${n}`,{method:"PATCH",body:JSON.stringify({ai_content:H})})}catch(_){console.error("[SmartBriefing] Failed to save new item:",_),m(z=>({...z,sections:z.sections.map(T=>T.id===n?{...T,ai_content:c.ai_content}:T)}))}},[s?.sections]),V=l.useCallback(async(n,r,w)=>{const N=r.label||"Neuer Punkt",y=r.content||r.label||"",c=s?.sections?.find(_=>_.id===n);if(!c)return;let j;try{j=typeof c.ai_content=="string"?JSON.parse(c.ai_content):c.ai_content}catch{console.error("[SmartBriefing] Failed to parse ai_content");return}if(!j?.items)return;const C={id:crypto.randomUUID(),label:N,content:y,user_note:"",deleted:!1,ai_explanations:[]},$={...j,items:[...j.items,C]},H=JSON.stringify($);m(_=>({..._,sections:_.sections.map(z=>z.id===n?{...z,ai_content:H}:z)}));try{await L.request(`/smartbriefing/sections/${n}`,{method:"PATCH",body:JSON.stringify({ai_content:H})})}catch(_){console.error("[SmartBriefing] Failed to save new item:",_),m(z=>({...z,sections:z.sections.map(T=>T.id===n?{...T,ai_content:c.ai_content}:T)}))}},[s?.sections]),te=l.useCallback(async()=>{if(!(h||!s?.id)){U(!0);try{const n=await L.request(`/smartbriefing/briefings/${s.id}/pdf`,{method:"GET"});if(!n.success||!n.data?.pdf_base64)throw new Error(n.message||"PDF-Export fehlgeschlagen");const r=atob(n.data.pdf_base64),w=new Array(r.length);for(let C=0;C<r.length;C++)w[C]=r.charCodeAt(C);const N=new Uint8Array(w),y=new Blob([N],{type:"application/pdf"}),c=window.URL.createObjectURL(y),j=document.createElement("a");j.href=c,j.download=n.data.filename||"Smart-Briefing.pdf",document.body.appendChild(j),j.click(),document.body.removeChild(j),window.URL.revokeObjectURL(c)}catch(n){console.error("[SmartBriefing] PDF download error:",n)}finally{U(!1)}}},[s?.id,h]),f=async()=>{if(!(!i||!s?.id)){I(!0);try{await i(s)}catch(n){console.error("Failed to delete briefing:",n)}finally{I(!1),B(!1)}}};return s?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`sticky top-0 z-40 transition-all duration-300 ease-out ${v?o?"py-2":"py-2.5":o?"py-5":"py-6"}`,style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:`max-w-[1400px] mx-auto ${o?"px-4":"px-8"}`,children:[a&&e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0 mb-0":"max-h-12 opacity-100 mb-4"}`,children:e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(oe,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]})}),e.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[!o&&e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 transition-all duration-300 ease-out ${v?"w-10 h-10":"w-[90px] h-[90px]"}`,children:e.jsx(R,{size:v?20:40,className:"text-white transition-all duration-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0 mb-0":"max-h-10 opacity-100 mb-2"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:s.template_title})]})}),e.jsx("h1",{className:`font-bold text-white m-0 truncate transition-all duration-300 ease-out ${v?"text-base md:text-lg mb-0":o?"text-xl mb-2":"text-2xl mb-2"}`,children:s.title||"Briefing"}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${v?"max-h-0 opacity-0":"max-h-8 opacity-100"}`,children:e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(ue,{size:14}),ft(s.created_at)]})})})]}),e.jsxs("div",{className:"flex gap-2 md:gap-2.5 flex-shrink-0",children:[a&&v&&e.jsx(se,{onClick:a,icon:oe,title:"ZurÃ¼ck zur Ãœbersicht"}),e.jsx(se,{onClick:te,disabled:h,loading:h,icon:mt,title:"Als PDF herunterladen"}),i&&e.jsx(se,{onClick:()=>B(!0),icon:O,danger:!0,title:"Briefing lÃ¶schen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${o?"p-4":"px-8 py-6"}`,children:[e.jsx(Et,{variables:s.variables,isExpanded:A,onToggle:()=>p(!A)}),x&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(M,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),u&&!x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:u})}),!x&&!u&&s.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[s.sections.length," Abschnitte"]})]}),s.sections.map(n=>e.jsx(Pt,{section:n,onUpdateItem:F,onGenerateMore:Y,onAskItem:X,onDeleteExplanation:ee,onAddAsItem:J,onAddActionPoint:V,isExpanded:k[n.id],onToggle:()=>G(n.id)},n.id))]}),!x&&!u&&(!s.sections||s.sections.length===0)&&s.content_markdown&&e.jsx(Z,{className:"p-6",children:e.jsx(Ne,{content:s.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufÃ¼gen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(At,{isOpen:E,onClose:()=>B(!1),onConfirm:f,isDeleting:P})]}):null};export{Dt as B,Nt as a,Tt as g};
