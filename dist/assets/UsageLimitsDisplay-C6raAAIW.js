import{j as e,p as A,Y as o,O as k,a0 as g,m as x,A as G,P as E,o as U,b as z,a4 as S}from"./ui-vendor-DceLfMgS.js";import{a as n}from"./react-vendor-uDOJF2jQ.js";import{B as p}from"./button-CkRsmUDc.js";import{u as T,D as h,w as K}from"./colors-BoNy0q8t.js";import"./designTokens-DbcSlXo4.js";const R=({onNavigateToRoleplay:u,compact:D=!1})=>{const{branding:i,demoCode:N}=T(),[L,b]=n.useState(!0),[y,v]=n.useState(null),[s,M]=n.useState(null),a=n.useMemo(()=>{const t=i?.["--header-gradient"]||h["--header-gradient"],r=i?.["--header-text"]||h["--header-text"],l=i?.["--primary-accent"]||h["--primary-accent"],C=i?.["--primary-accent-light"]||h["--primary-accent-light"];return{headerGradient:t,headerText:r,primaryAccent:l,primaryAccentLight:C}},[i]),f=async()=>{try{b(!0),v(null);const t=await K.getUsageLimits(N);M(t)}catch(t){console.error("[UsageLimits] Error fetching usage data:",t),v(t.message||"Fehler beim Laden der Nutzungsdaten")}finally{b(!1)}};n.useEffect(()=>{f()},[N]);const j=n.useMemo(()=>!s||s.monthly_limit===0?0:Math.min(100,s.used_minutes/s.monthly_limit*100),[s]),w=(t,r)=>{const l=t/r*100;return l<=0?"#ef4444":l<=20?"#f59e0b":l<=50?"#eab308":"#22c55e"},c=t=>t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",d=t=>t==null?"0 Min.":`${Math.round(t*10)/10} Min.`;if(L)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-slate-400"})});if(y)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[e.jsx(o,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:y})}),e.jsxs(p,{variant:"outline",size:"sm",onClick:f,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Erneut versuchen"]})]});if(D){const t=w(s?.remaining_minutes||0,s?.monthly_limit||10),r=s?.has_minutes!==!1;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:u,title:r?"Live-Gespräch starten":"Keine Minuten mehr verfügbar",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:a.headerGradient},children:e.jsx(g,{className:"w-5 h-5",style:{color:a.headerText}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Live-Gespräche"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg",style:{color:t},children:d(s?.remaining_minutes||0)}),e.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",s?.monthly_limit||10," Min."]})]})]}),!r&&e.jsx(o,{className:"w-5 h-5 text-red-500"})]}),e.jsx("div",{className:"mt-2 bg-slate-100 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${j}%`,background:t}})})]})}const _=w(s?.remaining_minutes||0,s?.monthly_limit||10),m=s?.has_minutes!==!1;return e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4",style:{background:a.headerGradient},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6",style:{color:a.headerText}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:a.headerText},children:"Live-Gespräche"}),e.jsx("p",{className:"text-sm opacity-80",style:{color:a.headerText},children:"Monatliches Kontingent"})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:f,className:"text-white hover:bg-white/10",children:e.jsx(k,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:_,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${(100-j)*2.827} 282.7`,className:"transition-all duration-500"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-3xl font-bold",style:{color:_},children:d(s?.remaining_minutes||0)}),e.jsx("span",{className:"text-sm text-slate-500",children:"verfügbar"})]})]})}),e.jsx(G,{mode:"wait",children:m?j>80?e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-800 font-medium text-sm",children:"Dein Kontingent ist fast aufgebraucht"}),e.jsxs("p",{className:"text-orange-600 text-xs mt-1",children:["Nutze deine verbleibenden ",d(s?.remaining_minutes)," weise."]})]})]})},"low-minutes"):e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-800 font-medium text-sm",children:"Du hast noch Minuten verfügbar"}),e.jsx("p",{className:"text-green-600 text-xs mt-1",children:"Starte jetzt ein Live-Gespräch zum Üben."})]})]})},"ok"):e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium text-sm",children:"Dein Kontingent ist aufgebraucht"}),e.jsxs("p",{className:"text-red-600 text-xs mt-1",children:["Am ",c(s?.next_reset)," werden deine Minuten wieder aufgeladen."]})]})]})},"no-minutes")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Limit"})]}),e.jsxs("span",{className:"text-lg font-bold text-slate-700",children:[s?.monthly_limit||10," Min."]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Verbraucht"})]}),e.jsx("span",{className:"text-lg font-bold text-slate-700",children:d(s?.used_minutes||0)})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-slate-400 mb-1",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Aufladung"})]}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:c(s?.next_reset)})]})]}),e.jsxs("div",{className:"text-center text-xs text-slate-400 mb-6",children:["Abrechnungszeitraum: ",c(s?.period_start)," - ",c(s?.period_end)]}),u&&e.jsxs(p,{onClick:u,disabled:!m,className:"w-full py-6 text-base font-semibold rounded-xl",style:{background:m?a.headerGradient:"#94a3b8",color:a.headerText},children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),m?"Live-Gespräch starten":"Keine Minuten verfügbar"]}),s?.is_demo_user&&s?.demo_code&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:["Demo-Zugang:",e.jsx("code",{className:"bg-slate-100 px-2 py-0.5 rounded font-mono font-bold",children:s.demo_code})]})})]})]})};export{R as default};
