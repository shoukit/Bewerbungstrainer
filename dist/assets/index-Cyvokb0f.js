import{j as r}from"./ui-vendor-BAEfSb-X.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{a as b,D as A}from"./DecisionBoardResult-DkMvD6rZ.js";import{w as p}from"./designTokens-LSOQEIoP.js";import{F as g}from"./index.js";import"./card-CRd_k1Xo.js";import"./utils-BEHD0UYf.js";import"./button-C27wFDRr.js";import"./input-B2p07toF.js";import"./textarea-AQGmZicy.js";import"./useBranding-CRmuKfX5.js";import"./AudioRecorder-BiZGQqjM.js";const c={INPUT:"input",RESULT:"result"},J=({isAuthenticated:h,requireAuth:I,setPendingAction:j,onNavigateToHistory:a})=>{const[S,d]=o.useState(c.INPUT),[w,D]=o.useState(null),[x,u]=o.useState(null),[t,i]=o.useState(null),[k,F]=o.useState(!1),l=o.useRef(!1);o.useEffect(()=>{window.scrollTo(0,0)},[S]);const C=o.useCallback(async e=>{if(l.current||!e.topic?.trim())return null;try{const s={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},n=await p.createDecision(s);if(n?.id)return l.current=!0,i(n.id),console.log("[DecisionBoard] Draft session saved with ID:",n.id),n.id}catch(s){console.error("[DecisionBoard] Failed to save draft session:",s)}return null},[]),f=o.useCallback(async(e,s)=>{if(e)try{const n={topic:s.topic,context:s.context||null,pros:s.pros||[],cons:s.cons||[],pro_score:s.proScore||0,contra_score:s.contraScore||0,analysis:s.analysis||null,status:s.status||"completed"};await p.updateDecision(e,n),console.log("[DecisionBoard] Session updated:",e)}catch(n){console.error("[DecisionBoard] Failed to update session:",n)}},[]),y=o.useCallback(async e=>{if(e)try{await p.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(s){console.error("[DecisionBoard] Failed to delete session:",s)}},[]),B=o.useCallback(async(e,s)=>{D(e),u(s),d(c.RESULT);try{if(t)await f(t,{...e,analysis:s,status:"completed"});else{const n={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:s,status:"completed"},m=await p.createDecision(n);m?.id&&(i(m.id),l.current=!0,console.log("[DecisionBoard] Decision saved with ID:",m.id))}}catch(n){console.error("[DecisionBoard] Failed to save decision:",n)}},[t,f]),v=o.useCallback(()=>{D(null),u(null),i(null),l.current=!1,d(c.INPUT)},[]),E=o.useCallback(()=>{u(null),d(c.INPUT)},[]),R=o.useCallback(async()=>{t&&await y(t),D(null),u(null),i(null),l.current=!1,a&&a()},[t,y,a]),U=()=>{switch(S){case c.RESULT:return r.jsx(A,{decisionData:w,analysisResult:x,onStartNew:v,onEditDecision:E});case c.INPUT:default:return r.jsx(b,{initialData:w,onAnalysisComplete:B,onCancel:a?R:null,isAuthenticated:h,requireAuth:I,savedDecisionId:t,onSaveDraft:C,onUpdateSession:f,onDecisionIdChange:i})}};return r.jsxs(r.Fragment,{children:[r.jsx(g,{featureId:"decisionboard",showOnMount:!0}),r.jsx("div",{style:{minHeight:"100%"},children:U()})]})};export{J as DecisionBoardApp,b as DecisionBoardInput,A as DecisionBoardResult};
