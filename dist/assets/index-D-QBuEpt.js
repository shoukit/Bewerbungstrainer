import{j as e,Y as q,F as O,av as ve,h as Le,z as se,ah as M,ac as at,aw as de,i as it,ag as lt,R as re,c as xe,S as ue,a2 as he,ax as pe,ay as be,a1 as ge,l as ne,at as ae,x as fe,U as je,am as ie,r as le,w as Pe,y as Se,C as ye,E as X,a as Ce,_ as Oe,b as _e,$ as Re,u as ot,az as Ie,L as Be,m as me,X as ct,aA as Te,a3 as dt,aB as mt,aC as xt,A as ze,aD as Me}from"./ui-vendor-4RzMPcHM.js";import{a}from"./react-vendor-uDOJF2jQ.js";import{w as U,k as ut,F as ht,C as pt}from"./FeatureInfoButton-DkKoIptM.js";import{S as bt}from"./ScenarioDashboard-vSA_sLNk.js";import{B as ee,C as te}from"./select-native-CVzvlCkd.js";import"./dialog-BxKlTEi_.js";import{F as gt}from"./fullscreen-loader-Dp-kqp8J.js";import{D as ft}from"./DynamicFormField-CHFrCTO-.js";import{a as jt,B as yt}from"./BriefingWorkbook-Dcvx4MdZ.js";import{u as Nt}from"./useMobile-YxjH166V.js";import"./ScenarioCard-CYQyYFKP.js";import"./utils-BEHD0UYf.js";import"./index-CklPxmEV.js";const kt={"file-text":O,briefcase:le,banknote:ie,users:je,user:fe,"message-circle":ae,target:ne,award:ge,book:be,clipboard:pe,star:he,lightbulb:se,shield:ue,compass:xe,rocket:re,heart:lt,folder:ve,"trending-up":it},L={key:"MEINE",label:"Meine Templates",shortLabel:"Meine",color:"#7C3AED",bgColor:"#EDE9FE",icon:ve},wt=({onSelectTemplate:r,onShowList:g,onCreateTemplate:f,onEditTemplate:o,onCopyTemplate:h,isAuthenticated:i,requireAuth:m,setPendingAction:x,demoCode:b})=>{const[N,p]=a.useState(null),[n,d]=a.useState(0),c=a.useCallback(async()=>{const u=new URLSearchParams;b&&u.append("demo_code",b);const w=await U.request(`/smartbriefing/templates?${u.toString()}`,{method:"GET"});if(w.success&&w.data?.templates)return w.data.templates;throw new Error("Unerwartete API-Antwort")},[b,n]),S=()=>{if(!i&&!b){m&&(x(()=>f),m());return}f?.()},j=(u,w)=>{u.stopPropagation(),o?.(w)},C=(u,w)=>{u.stopPropagation(),p(w)},l=(u,w)=>{if(u.stopPropagation(),!i&&!b){m&&(x(()=>()=>h?.({...w,title:`${w.title} (Kopie)`,id:null,is_custom:!0})),m());return}h?.({...w,title:`${w.title} (Kopie)`,id:null,is_custom:!0})},B=async()=>{if(N)try{const u=new URLSearchParams;b&&u.append("demo_code",b),(await U.request(`/smartbriefing/templates/${N.id}?${u.toString()}`,{method:"DELETE"})).success&&d(V=>V+1)}catch(u){console.error("[SmartBriefing] Error deleting template:",u)}finally{p(null)}},_=u=>kt[u.icon]||O,I=u=>{const w=u.variables_schema?.length||0;return[{text:`${w} Eingabefeld${w!==1?"er":""}`}]},R=(u,w)=>{const G=(Array.isArray(u.category)?u.category:[u.category]).includes("MEINE"),F=u.category&&!G?w(u.category):null;return e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[u.is_custom&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-2xl text-[11px] font-semibold",style:{backgroundColor:L.bgColor,color:L.color},children:[e.jsx(ve,{style:{width:"12px",height:"12px"}}),L.shortLabel]}),F&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-2xl text-[11px] font-semibold",style:{backgroundColor:F.bgColor,color:F.color},children:[F.IconComponent&&e.jsx(F.IconComponent,{style:{width:"12px",height:"12px"}}),F.shortLabel]})]})},K=u=>u.is_custom?"ring-2 ring-violet-200 bg-violet-50/30":"",v=u=>u.is_custom?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:w=>j(w,u),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-slate-100 hover:text-primary",title:"Template bearbeiten",children:e.jsx(at,{size:16})}),e.jsx("button",{onClick:w=>C(w,u),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-red-50 hover:text-red-500",title:"Template lÃ¶schen",children:e.jsx(q,{size:16})})]}):h?e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:w=>l(w,u),className:"p-1.5 rounded-md border-none bg-transparent text-slate-500 cursor-pointer flex items-center justify-center transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Als eigenes Template kopieren",children:e.jsx(de,{size:16})})}):null,k=(i||b)&&f?e.jsxs("button",{onClick:S,className:"flex items-center gap-2 py-2.5 px-4 rounded-xl border-2 border-dashed border-indigo-200 bg-white text-indigo-500 text-sm font-medium cursor-pointer transition-all whitespace-nowrap hover:border-indigo-400 hover:bg-indigo-50 hover:shadow-sm",children:[e.jsx(M,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"persÃ¶nliches Template"}),e.jsx("span",{className:"sm:hidden",children:"Template"})]}):null,E=()=>e.jsx("div",{className:"mt-12 py-5 px-6 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(se,{size:20,className:"text-indigo-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900 mb-1",children:"So funktioniert Smart Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-600 leading-relaxed",children:"WÃ¤hle ein Template aus, gib deine spezifischen Informationen ein (z.B. Unternehmen, Position), und erhalte ein maÃŸgeschneidertes Briefing mit Insider-Wissen, Fachbegriffen und cleveren RÃ¼ckfragen."})]})]})}),A=N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>p(null),children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-[400px] w-full shadow-2xl transform transition-all",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center",children:e.jsx(q,{size:24,className:"text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Template lÃ¶schen?"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden."})]})]}),e.jsx("div",{className:"bg-slate-50 rounded-xl p-3 mb-5",children:e.jsx("p",{className:"text-sm text-slate-700",children:e.jsx("strong",{children:N.title})})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(ee,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(ee,{variant:"danger",onClick:B,children:"LÃ¶schen"})]})]})});return e.jsxs(e.Fragment,{children:[e.jsx(ut,{featureId:"smartbriefing",showOnMount:!0}),e.jsx(bt,{title:"Smart Briefing",subtitle:"Dein KI-gestÃ¼tzter Vorbereitungs-Assistent",headerIcon:O,headerActions:e.jsx(ht,{featureId:"smartbriefing",size:"sm"}),fetchScenarios:c,moduleKey:"briefings",historyButtonLabel:"Meine Briefings",onNavigateToHistory:g,onSelectScenario:r,renderCardMeta:I,renderCategoryBadge:R,getIconForScenario:_,getCardCustomActions:v,getCardClassName:K,cardActionLabel:"Briefing erstellen",cardActionIcon:Le,categoryField:"category",additionalCategories:[{key:L.key,label:L.label,shortLabel:L.shortLabel,color:L.color,bgColor:L.bgColor,icon:L.icon,IconComponent:L.icon,filterFn:u=>u.is_custom===!0}],emptyStateIcon:O,emptyStateTitle:"Keine Templates gefunden",emptyStateMessage:"Es wurden noch keine Briefing-Templates erstellt.",searchPlaceholder:"Briefings durchsuchen...",filterActions:k,renderInfoBox:E,extraContent:A,isAuthenticated:i,requireAuth:m,setPendingAction:x,demoCode:b,loadingMessage:"Templates werden geladen..."},n)]})},vt=({variable:r,index:g,onChange:f,onDelete:o})=>e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("input",{type:"text",value:r.key||"",onChange:h=>f(g,"key",h.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"_")),placeholder:"variable_name",className:"flex-1 py-2 px-3 rounded-md border border-slate-200 text-sm font-mono bg-slate-50 mr-2 outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"}),e.jsx("button",{type:"button",onClick:()=>o(g),className:"p-2 border-none bg-transparent cursor-pointer text-red-500 flex items-center justify-center hover:bg-red-50 rounded-md transition-colors",children:e.jsx(q,{size:18})})]}),e.jsx("textarea",{value:r.value||"",onChange:h=>f(g,"value",h.target.value),placeholder:"Wert eingeben... (mehrzeilig mÃ¶glich)",rows:3,className:"w-full py-2.5 px-3 rounded-md border border-slate-200 text-sm resize-y min-h-[80px] box-border outline-none focus:border-primary focus:ring-2 focus:ring-primary/10"})]}),St=({template:r,onBack:g,onBriefingGenerated:f,isAuthenticated:o})=>{const[h,i]=a.useState({}),[m,x]=a.useState({}),[b,N]=a.useState(!1),[p,n]=a.useState(null),[d,c]=a.useState([]),[S,j]=a.useState(!1),C=jt(r?.icon);a.useEffect(()=>{if(r?.variables_schema){const v={};r.variables_schema.forEach(k=>{k.default&&(v[k.key]=k.default)}),i(v)}c([]),j(!1)},[r]);const l=()=>{c([...d,{key:"",value:""}])},B=(v,k,E)=>{const A=[...d];A[v][k]=E,c(A)},_=v=>{c(d.filter((k,E)=>E!==v))},I=(v,k)=>{i(E=>({...E,[v]:k})),m[v]&&x(E=>{const A={...E};return delete A[v],A})},R=()=>{const v={};return r?.variables_schema?.forEach(k=>{k.required&&!h[k.key]&&(v[k.key]="Dieses Feld ist erforderlich")}),v},K=async v=>{v.preventDefault();const k=R();if(Object.keys(k).length>0){x(k);return}N(!0),n(null);try{const E={};d.forEach(w=>{w.key&&w.value&&(E[w.key]=w.value)});const A={template_id:r.id,variables:h};Object.keys(E).length>0&&(A.custom_variables=E);const u=await U.request("/smartbriefing/generate",{method:"POST",body:JSON.stringify(A)});if(u.success&&u.data?.briefing)f(u.data.briefing);else throw new Error("Unerwartete API-Antwort")}catch(E){console.error("[SmartBriefing] Error generating briefing:",E),n(E.message||"Fehler beim Generieren des Briefings")}finally{N(!1)}};return r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 pt-8 max-w-[700px] mx-auto",children:[e.jsxs("button",{onClick:g,disabled:b,className:`flex items-center gap-2 py-2 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer mb-6 transition-opacity ${b?"opacity-50 cursor-not-allowed":"hover:text-slate-700"}`,children:[e.jsx(Pe,{size:18}),e.jsx("span",{className:"leading-relaxed",children:"ZurÃ¼ck zur Ãœbersicht"})]}),e.jsx(te,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(C,{size:28,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-[22px] font-bold text-slate-900 mb-1",children:r.title}),e.jsx("p",{className:"text-sm text-slate-500",children:r.description})]})]})}),e.jsxs(te,{className:"p-6",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900 mb-5 pb-4 border-b border-slate-100",children:"Deine Angaben"}),e.jsxs("form",{onSubmit:K,children:[r.variables_schema?.map(v=>e.jsx(ft,{field:v,value:h[v.key],onChange:I,error:m[v.key]},v.key)),r.allow_custom_variables&&e.jsxs("div",{className:"mt-6 mb-5 pt-5 border-t border-slate-100",children:[e.jsxs("button",{type:"button",onClick:()=>j(!S),className:`flex items-start gap-2 p-0 border-none bg-transparent text-slate-500 text-sm font-medium cursor-pointer text-left ${S?"mb-4":""}`,children:[e.jsxs("span",{className:"flex items-center gap-2 flex-shrink-0",children:[S?e.jsx(Se,{size:18}):e.jsx(ye,{size:18}),e.jsx(M,{size:16})]}),e.jsx("span",{className:"leading-relaxed",children:"ZusÃ¤tzliche Variablen hinzufÃ¼gen (optional)"})]}),S&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:"FÃ¼ge eigene Variablen hinzu, die in die Briefing-Generierung einflieÃŸen sollen."}),d.length>0&&e.jsx("div",{className:"mb-3",children:d.map((v,k)=>e.jsx(vt,{variable:v,index:k,onChange:B,onDelete:_},k))}),e.jsxs("button",{type:"button",onClick:l,className:"flex items-center gap-1.5 py-2 px-3 border border-dashed border-slate-300 rounded-lg bg-white text-slate-500 text-[13px] cursor-pointer w-full justify-center hover:border-primary hover:text-primary transition-colors",children:[e.jsx(M,{size:14}),"Variable hinzufÃ¼gen"]})]})]}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-5 flex items-start gap-3",children:[e.jsx(X,{size:20,className:"text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:p})]}),e.jsx(ee,{type:"submit",disabled:b,size:"lg",fullWidth:!0,icon:e.jsx(Ce,{size:20}),children:"Briefing generieren"})]})]})]}),e.jsx(gt,{isLoading:b,message:"Smart Briefing wird erstellt...",subMessage:"Die KI analysiert deine Angaben und erstellt ein maÃŸgeschneidertes Briefing."})]}):null},Ct={"file-text":O,briefcase:le,banknote:ie,users:je,user:fe,"message-circle":ae,target:ne,award:ge,book:be,clipboard:pe,star:he,lightbulb:se,shield:ue,compass:xe,rocket:re},Bt=({content:r})=>{if(!r)return null;const g=o=>{const h=o.split(`
`),i=[];let m=[],x=null;const b=()=>{m.length>0&&(i.push(e.jsx("ul",{className:"my-3 pl-6 list-none",children:m.map((N,p)=>e.jsxs("li",{className:"mb-2 text-[15px] leading-relaxed text-gray-700 relative pl-5",children:[e.jsx("span",{className:"absolute left-0 text-primary font-bold",children:x==="number"?`${p+1}.`:"â€¢"}),f(N)]},p))},`list-${i.length}`)),m=[],x=null)};return h.forEach((N,p)=>{const n=N.trim();if(!n){b();return}if(n.startsWith("### ")){b(),i.push(e.jsx("h3",{className:`text-lg font-bold text-slate-900 my-6 mb-3 pt-4 flex items-center gap-2 ${p>0?"border-t border-slate-100":""}`,children:f(n.substring(4))},`h3-${p}`));return}if(n.startsWith("## ")){b(),i.push(e.jsx("h2",{className:"text-xl font-bold text-slate-900 my-7 mb-3.5",children:f(n.substring(3))},`h2-${p}`));return}if(n.startsWith("# ")){b(),i.push(e.jsx("h1",{className:"text-2xl font-bold text-slate-900 my-8 mb-4",children:f(n.substring(2))},`h1-${p}`));return}if(n.startsWith("- ")||n.startsWith("* ")){x!=="bullet"&&(b(),x="bullet"),m.push(n.substring(2));return}const d=n.match(/^(\d+)\.\s/);if(d){x!=="number"&&(b(),x="number"),m.push(n.substring(d[0].length));return}b(),i.push(e.jsx("p",{className:"my-3 text-[15px] leading-relaxed text-gray-700",children:f(n)},`p-${p}`))}),b(),i},f=o=>{const h=[];let i=o,m=0;for(;i.length>0;){const x=i.match(/\*\*(.+?)\*\*/),b=i.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),N=i.match(/`([^`]+)`/),p=[{match:x,type:"bold"},{match:b,type:"italic"},{match:N,type:"code"}].filter(d=>d.match);if(p.length===0){h.push(i);break}const n=p.reduce((d,c)=>(d.match?.index??1/0)<(c.match?.index??1/0)?d:c);switch(n.match.index>0&&h.push(i.substring(0,n.match.index)),n.type){case"bold":h.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:n.match[1]},m++));break;case"italic":h.push(e.jsx("em",{className:"italic",children:n.match[1]||n.match[2]},m++));break;case"code":h.push(e.jsx("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-[13px] font-mono text-primary",children:n.match[1]},m++));break}i=i.substring(n.match.index+n.match[0].length)}return h};return e.jsx("div",{children:g(r)})},zt=({briefing:r,template:g,onBack:f,onCreateNew:o,onGenerateAnother:h})=>{const i=Nt(),[m,x]=a.useState(!1),b=a.useRef(null),N=Ct[g?.icon||r?.template_icon]||O,p=c=>c?new Date(c).toLocaleDateString("de-DE",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",n=async()=>{try{await navigator.clipboard.writeText(r.content_markdown),x(!0),setTimeout(()=>x(!1),2e3)}catch(c){console.error("[SmartBriefing] Failed to copy:",c)}},d=()=>{const c=`${g?.title||r?.template_title}
${"=".repeat(50)}

Erstellt am: ${p(r.created_at)}

${r.content_markdown}`,S=new Blob([c],{type:"text/plain;charset=utf-8"}),j=URL.createObjectURL(S),C=document.createElement("a");C.href=j,C.download=`briefing-${r.id}.txt`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(j)};return r?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:`bg-brand-gradient sticky top-0 z-40 ${i?"px-4 py-5":"px-8 py-6"}`,children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[f&&e.jsxs("button",{onClick:f,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-lg px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 transition-colors",children:[e.jsx(Pe,{size:16}),"ZurÃ¼ck zur Ãœbersicht"]}),e.jsxs("div",{className:`flex items-center gap-6 ${i?"flex-col items-start gap-4":""}`,children:[e.jsx("div",{className:`rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 ${i?"w-[70px] h-[70px]":"w-[90px] h-[90px]"}`,children:e.jsx(N,{size:i?32:40,color:pt.white})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsxs("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-primary flex items-center gap-1",children:[e.jsx(Ce,{size:12}),"Fertig!"]})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${i?"text-xl":"text-2xl"}`,children:g?.title||r?.template_title}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(Oe,{size:14}),p(r.created_at)]})})]}),!i&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:n,className:`flex items-center gap-2 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium border border-white/30 transition-colors ${m?"bg-green-500/30":"bg-white/20 hover:bg-white/30"}`,children:[m?e.jsx(_e,{size:16}):e.jsx(de,{size:16}),m?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-2 bg-white/20 border border-white/30 rounded-xl px-5 py-2.5 cursor-pointer text-white text-sm font-medium hover:bg-white/30 transition-colors",children:[e.jsx(Re,{size:16}),"Speichern"]})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${i?"p-4":"px-8 py-6"}`,children:[i&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:n,className:`flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border text-[13px] font-medium cursor-pointer transition-colors ${m?"bg-green-50 border-green-200 text-green-700":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[m?e.jsx(_e,{size:16}):e.jsx(de,{size:16}),m?"Kopiert!":"Kopieren"]}),e.jsxs("button",{onClick:d,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-[13px] font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(Re,{size:16}),"Speichern"]})]}),e.jsx("div",{ref:b,className:"bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200",children:e.jsx("div",{className:i?"p-5":"p-8",children:e.jsx(Bt,{content:r.content_markdown})})}),e.jsxs("div",{className:"flex gap-3 mt-6 flex-wrap",children:[e.jsxs("button",{onClick:h,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-2 border-primary bg-white text-primary text-[15px] font-semibold cursor-pointer transition-all hover:bg-primary/5",children:[e.jsx(ot,{size:18}),"Mit anderen Angaben neu generieren"]}),e.jsxs("button",{onClick:o,className:"flex-1 min-w-[200px] flex items-center justify-center gap-2 px-6 py-3.5 rounded-xl border-none bg-brand-gradient text-white text-[15px] font-semibold cursor-pointer transition-all shadow-primary/40 shadow-lg hover:shadow-xl",children:[e.jsx(M,{size:18}),"Neues Briefing erstellen"]})]})]})]}):null},Et={"file-text":O,briefcase:le,banknote:ie,users:je,user:fe,"message-circle":ae,target:ne,award:ge,book:be,clipboard:pe,star:he,lightbulb:se,shield:ue,compass:xe,rocket:re},At=r=>r?new Date(r).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",$t=({briefing:r,onOpen:g,onDelete:f,isDeleting:o})=>{const[h,i]=a.useState(!1),[m,x]=a.useState(!1),b=Et[r.template_icon]||O,N=p=>{p.stopPropagation(),m?(f(r.id),x(!1)):(x(!0),setTimeout(()=>x(!1),3e3))};return e.jsxs(te,{onClick:()=>g(r),onMouseEnter:()=>i(!0),onMouseLeave:()=>{i(!1),x(!1)},className:`p-5 cursor-pointer transition-all duration-300 relative ${h?"border-primary shadow-lg -translate-y-0.5":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-[10px] bg-primary/10 flex items-center justify-center",children:e.jsx(b,{size:22,className:"text-primary"})}),e.jsx("button",{onClick:N,disabled:o,className:`p-2 rounded-lg border-none cursor-pointer transition-all ${m?"bg-red-50 text-red-500":h?"bg-slate-100 text-slate-400":"bg-transparent text-slate-400"} ${h||m?"opacity-100":"opacity-0"} ${o?"cursor-not-allowed":""}`,children:o?e.jsx(Be,{size:18,className:"animate-spin"}):e.jsx(q,{size:18})})]}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 mb-1 leading-tight truncate",children:r.title||"Unbenanntes Briefing"}),e.jsx("p",{className:"text-[13px] text-slate-500 mb-3",children:r.template_title}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 text-xs",children:[e.jsx(Oe,{size:14}),At(r.created_at)]}),e.jsxs("div",{className:"flex items-center gap-1 text-primary text-[13px] font-medium",children:["Ã–ffnen",e.jsx(Le,{size:16})]})]}),m&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-50 border border-red-200 rounded-lg py-2 px-3 text-xs text-red-600 font-medium z-10",onClick:p=>p.stopPropagation(),children:"Nochmal klicken zum LÃ¶schen"})]})},Dt=({onOpenBriefing:r,onCreateNew:g,isAuthenticated:f})=>{const[o,h]=a.useState([]),[i,m]=a.useState(!0),[x,b]=a.useState(null),[N,p]=a.useState(null);a.useEffect(()=>{(async()=>{if(!f){m(!1);return}try{m(!0),b(null);const c=await U.request("/smartbriefing/briefings",{method:"GET"});if(c.success&&c.data?.briefings){const S=c.data.briefings.filter(j=>j.status==="completed");h(S)}else throw new Error("Unerwartete API-Antwort")}catch(c){console.error("[SmartBriefing] Error fetching briefings:",c),b(c.message||"Fehler beim Laden der Briefings")}finally{m(!1)}})()},[f]);const n=async d=>{try{if(p(d),(await U.request(`/smartbriefing/briefings/${d}`,{method:"DELETE"})).success)h(S=>S.filter(j=>j.id!==d));else throw new Error("Fehler beim LÃ¶schen")}catch(c){console.error("[SmartBriefing] Error deleting briefing:",c),b(c.message||"Fehler beim LÃ¶schen des Briefings")}finally{p(null)}};return f?e.jsxs("div",{className:"p-6 max-w-[1200px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Meine Briefings"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[o.length," gespeicherte Briefings"]})]}),e.jsx(ee,{onClick:g,icon:e.jsx(M,{size:18}),children:"Neues Briefing"})]}),i&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(Be,{size:40,className:"text-primary animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-500",children:"Briefings werden geladen..."})]}),x&&!i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 flex items-start gap-3",children:[e.jsx(X,{size:24,className:"text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base text-red-600 font-medium mb-1",children:"Fehler beim Laden"}),e.jsx("p",{className:"text-sm text-red-700",children:x})]})]}),!i&&!x&&e.jsx(e.Fragment,{children:o.length===0?e.jsxs(te,{className:"py-12 px-6 text-center",children:[e.jsx(Ie,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Noch keine Briefings"}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Erstelle dein erstes Briefing, um loszulegen."}),e.jsx(ee,{onClick:g,icon:e.jsx(M,{size:18}),children:"Briefing erstellen"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5",children:o.map(d=>e.jsx($t,{briefing:d,onOpen:r,onDelete:n,isDeleting:N===d.id},d.id))})})]}):e.jsx("div",{className:"p-6 max-w-[800px] mx-auto",children:e.jsxs(te,{className:"py-12 px-6 text-center",children:[e.jsx(Ie,{size:48,className:"text-slate-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg text-slate-500 mb-2",children:"Anmeldung erforderlich"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Melde dich an, um deine gespeicherten Briefings zu sehen."})]})})},Ke=[{key:"file-text",icon:O,label:"Dokument"},{key:"briefcase",icon:le,label:"Koffer"},{key:"banknote",icon:ie,label:"Geld"},{key:"users",icon:je,label:"Team"},{key:"user",icon:fe,label:"Person"},{key:"target",icon:ne,label:"Ziel"},{key:"lightbulb",icon:se,label:"Idee"},{key:"star",icon:he,label:"Stern"},{key:"shield",icon:ue,label:"Schutz"},{key:"compass",icon:xe,label:"Kompass"},{key:"rocket",icon:re,label:"Rakete"},{key:"message-circle",icon:ae,label:"Nachricht"},{key:"award",icon:ge,label:"Auszeichnung"},{key:"book",icon:be,label:"Buch"},{key:"clipboard",icon:pe,label:"Checkliste"}],Fe=[{value:"text",label:"Einzeiliges Textfeld"},{value:"textarea",label:"Mehrzeiliges Textfeld"},{value:"select",label:"Dropdown-Auswahl"}],Ve=[{key:"empty",label:"--- Vorlage wÃ¤hlen ---",icon:O,aiRole:"",sections:[],aiBehavior:"",variables:[]},{key:"sales",label:"ðŸŽ¯ Sales / KundengesprÃ¤ch",icon:ne,aiRole:"Du bist ein erfahrener Sales-Coach und Vertriebsexperte mit 15+ Jahren Erfahrung im B2B-Vertrieb.",sections:[{id:"hook",title:"The Hook ðŸª",instruction:"Erstelle einen packenden GesprÃ¤chseinstieg fÃ¼r ${customer_type} Kunden"},{id:"discovery",title:"Discovery Questions ðŸ”",instruction:"Formuliere 5-7 offene Fragen um Bedarf zu wecken und Pain Points zu identifizieren"},{id:"value",title:"Value Proposition ðŸ’Ž",instruction:"Beschreibe den Mehrwert basierend auf ${product_service}"},{id:"objections",title:"Einwandbehandlung ðŸ›¡ï¸",instruction:"Liste typische EinwÃ¤nde und passende Antworten"},{id:"closing",title:"Closing Path ðŸŽ¯",instruction:"Entwickle einen Weg zum Ziel: ${meeting_goal}"}],aiBehavior:"Schreibe praxisnah und actionable. Jeder Punkt soll direkt umsetzbar sein. Vermeide Theorie - fokussiere auf konkrete Formulierungen und Techniken.",variables:[{key:"customer_type",label:"Kundentyp",type:"text",placeholder:"z.B. Enterprise, KMU, Startup"},{key:"product_service",label:"Produkt/Service",type:"text",placeholder:"Was verkaufst du?"},{key:"meeting_goal",label:"Ziel des GesprÃ¤chs",type:"text",placeholder:"z.B. Demo-Termin, Angebot"}]},{key:"career",label:"ðŸ’¼ Karriere / VorstellungsgesprÃ¤ch",icon:le,aiRole:"Du bist ein erfahrener Karriere-Coach und HR-Experte mit umfassender Erfahrung in Bewerbungsprozessen.",sections:[{id:"company",title:"Unternehmens-Insights ðŸ¢",instruction:"Recherchiere wichtige Fakten Ã¼ber ${unternehmen} die im GesprÃ¤ch relevant sind"},{id:"position",title:"Positions-Analyse ðŸ“‹",instruction:"Analysiere die Anforderungen fÃ¼r ${position} und wie der Kandidat diese erfÃ¼llt"},{id:"questions",title:"Typische Fragen â“",instruction:"Liste die 10 wahrscheinlichsten Interviewfragen mit Antwortstrategien"},{id:"stories",title:"STAR-Stories â­",instruction:"Entwickle 3-5 Erfolgsgeschichten nach der STAR-Methode"},{id:"questions_to_ask",title:"Eigene Fragen ðŸ™‹",instruction:"Formuliere 5-7 kluge RÃ¼ckfragen an den Interviewer"}],aiBehavior:"Sei konkret und praxisorientiert. Gib FormulierungsvorschlÃ¤ge die direkt verwendet werden kÃ¶nnen. BerÃ¼cksichtige deutsche GeschÃ¤ftskultur.",variables:[{key:"unternehmen",label:"Unternehmen",type:"text",placeholder:"Name des Unternehmens"},{key:"position",label:"Position",type:"text",placeholder:"Stelle, auf die du dich bewirbst"}]},{key:"negotiation",label:"ðŸ’° Gehaltsverhandlung",icon:ie,aiRole:"Du bist ein Experte fÃ¼r Gehaltsverhandlungen und Karriereentwicklung.",sections:[{id:"market",title:"Marktanalyse ðŸ“Š",instruction:"Analysiere Gehaltsspannen fÃ¼r ${position} in ${branche} und ${region}"},{id:"arguments",title:"Argumente ðŸ’ª",instruction:"Entwickle 5-7 Ã¼berzeugende Argumente fÃ¼r eine GehaltserhÃ¶hung basierend auf ${erfolge}"},{id:"counter",title:"Konterstrategien ðŸ›¡ï¸",instruction:"Bereite Antworten auf typische Gegenargumente des Arbeitgebers vor"},{id:"tactics",title:"Verhandlungstaktiken ðŸŽ¯",instruction:"Beschreibe bewÃ¤hrte Taktiken fÃ¼r die Gehaltsverhandlung"},{id:"alternatives",title:"Alternativen ðŸ”„",instruction:"Liste nicht-monetÃ¤re Benefits die verhandelbar sind"}],aiBehavior:"Fokussiere auf konkrete Zahlen und Formulierungen. Sei selbstbewusst aber nicht arrogant im Ton.",variables:[{key:"position",label:"Position",type:"text",placeholder:"Deine aktuelle/angestrebte Position"},{key:"branche",label:"Branche",type:"text",placeholder:"z.B. IT, Finanzen, Marketing"},{key:"region",label:"Region",type:"text",placeholder:"z.B. MÃ¼nchen, Berlin, Remote"},{key:"erfolge",label:"Deine Erfolge",type:"textarea",placeholder:"Beschreibe deine wichtigsten Leistungen"}]},{key:"presentation",label:"ðŸŽ¤ PrÃ¤sentation / Pitch",icon:re,aiRole:"Du bist ein PrÃ¤sentations-Coach und Storytelling-Experte.",sections:[{id:"hook",title:"ErÃ¶ffnung ðŸŽ¬",instruction:"Erstelle einen aufmerksamkeitsstarken Einstieg fÃ¼r ${thema}"},{id:"problem",title:"Problem/Herausforderung âš¡",instruction:"Beschreibe das Problem das ${zielgruppe} hat"},{id:"solution",title:"LÃ¶sung/Angebot ðŸ’¡",instruction:"PrÃ¤sentiere die LÃ¶sung klar und Ã¼berzeugend"},{id:"proof",title:"Beweise/Beispiele ðŸ“ˆ",instruction:"Liste Erfolgsbeispiele, Zahlen und Social Proof"},{id:"cta",title:"Call-to-Action ðŸŽ¯",instruction:"Formuliere einen klaren nÃ¤chsten Schritt"}],aiBehavior:"Schreibe in aktivem, energetischem Stil. Jeder Abschnitt soll eine klare Botschaft haben. Nutze Storytelling-Elemente.",variables:[{key:"thema",label:"Thema der PrÃ¤sentation",type:"text",placeholder:"WorÃ¼ber prÃ¤sentierst du?"},{key:"zielgruppe",label:"Zielgruppe",type:"text",placeholder:"Wer ist dein Publikum?"}]},{key:"feedback",label:"ðŸ’¬ Feedback-GesprÃ¤ch",icon:ae,aiRole:"Du bist ein erfahrener Leadership-Coach und Experte fÃ¼r MitarbeiterfÃ¼hrung.",sections:[{id:"context",title:"GesprÃ¤chsrahmen ðŸ“‹",instruction:"Bereite den Rahmen fÃ¼r das Feedback-GesprÃ¤ch mit ${mitarbeiter_name} vor"},{id:"positive",title:"StÃ¤rken & Erfolge â­",instruction:"Liste konkrete positive Beobachtungen und Erfolge"},{id:"development",title:"Entwicklungsfelder ðŸŒ±",instruction:"Beschreibe Verbesserungspotenziale konstruktiv"},{id:"goals",title:"Zielvereinbarung ðŸŽ¯",instruction:"Formuliere SMART-Ziele fÃ¼r die nÃ¤chste Periode"},{id:"support",title:"UnterstÃ¼tzungsangebote ðŸ¤",instruction:"Liste mÃ¶gliche UnterstÃ¼tzungsmaÃŸnahmen"}],aiBehavior:"Schreibe wertschÃ¤tzend und konstruktiv. Fokussiere auf Verhalten, nicht auf PersÃ¶nlichkeit. Nutze die SBI-Methode (Situation-Behavior-Impact).",variables:[{key:"mitarbeiter_name",label:"Name des Mitarbeiters",type:"text",placeholder:'Vorname oder "der Mitarbeiter"'}]}],P=()=>`var_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,_t=()=>({id:P(),key:"",label:"",type:"text",required:!0,placeholder:"",options:[]}),Rt=()=>({id:P(),value:"",label:""}),It=()=>({id:P(),title:"",instruction:""}),Tt=({variable:r,index:g,total:f,onChange:o,onDelete:h,onMoveUp:i,onMoveDown:m})=>{const[x,b]=a.useState(!0),[N,p]=a.useState(r.label);a.useEffect(()=>{p(r.label)},[r.label]);const n=(l,B)=>{o({...r,[l]:B})},d=()=>{const l=[...r.options||[],Rt()];o({...r,options:l})},c=(l,B,_)=>{const I=r.options.map(R=>R.id===l?{...R,[B]:_}:R);o({...r,options:I})},S=l=>{const B=r.options.filter(_=>_.id!==l);o({...r,options:B})},j=l=>l.toLowerCase().replace(/[Ã¤Ã¶Ã¼ÃŸ]/g,B=>({Ã¤:"ae",Ã¶:"oe",Ã¼:"ue",ÃŸ:"ss"})[B]).replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),C=()=>{if(N!==r.label){const l={label:N};(!r.key||r.key===j(r.label))&&(l.key=j(N)),o({...r,...l})}};return e.jsxs("div",{className:"bg-slate-50 rounded-xl border border-slate-200 mb-3 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-3 bg-white cursor-pointer ${x?"border-b border-slate-200":""}`,onClick:()=>b(!x),children:[e.jsx(Me,{size:16,className:"text-slate-400 cursor-grab"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:r.label||`Variable ${g+1}`}),r.key&&e.jsxs("span",{className:"ml-2 text-slate-500 text-xs",children:["$","{","$",r.key,"}"]})]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-[11px] font-medium bg-primary/10 text-primary",children:Fe.find(l=>l.value===r.type)?.label||r.type}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),i()},disabled:g===0,className:`p-1 border-none bg-transparent ${g===0?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(Se,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),m()},disabled:g===f-1,className:`p-1 border-none bg-transparent ${g===f-1?"cursor-not-allowed opacity-30":"cursor-pointer"}`,children:e.jsx(ye,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),h()},className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(q,{size:16})})]}),e.jsx(ze,{children:x&&e.jsx(me.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:e.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldbezeichnung *"}),e.jsx("input",{type:"text",value:N,onChange:l=>p(l.target.value),onBlur:C,placeholder:"z.B. Unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Variablenname *"}),e.jsx("input",{type:"text",value:r.key,onChange:l=>n("key",l.target.value),placeholder:"z.B. unternehmen",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm font-mono"})]})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Feldtyp"}),e.jsx("select",{value:r.type,onChange:l=>n("type",l.target.value),className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm bg-white",children:Fe.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 py-2.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.required,onChange:l=>n("required",l.target.checked),className:"w-4 h-4 accent-primary"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Pflichtfeld"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-1",children:"Platzhalter-Text (optional)"}),e.jsx("input",{type:"text",value:r.placeholder,onChange:l=>n("placeholder",l.target.value),placeholder:"z.B. BMW AG, Siemens, etc.",className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm"})]}),r.type==="select"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 mb-2",children:"Auswahloptionen"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[(r.options||[]).map(l=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:l.value,onChange:B=>c(l.id,"value",B.target.value),placeholder:"Wert",className:"flex-1 px-2.5 py-2 rounded-md border border-slate-200 text-[13px] font-mono"}),e.jsx("input",{type:"text",value:l.label,onChange:B=>c(l.id,"label",B.target.value),placeholder:"Anzeigename",className:"flex-[2] px-2.5 py-2 rounded-md border border-slate-200 text-[13px]"}),e.jsx("button",{onClick:()=>S(l.id),className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500",children:e.jsx(q,{size:14})})]},l.id)),e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 px-3 py-2 border border-dashed border-slate-300 rounded-md bg-transparent text-slate-500 text-[13px] cursor-pointer mt-1 hover:bg-slate-50",children:[e.jsx(M,{size:14}),"Option hinzufÃ¼gen"]})]})]})]})})})]})},Ft=({section:r,index:g,total:f,variables:o,onChange:h,onDelete:i,onMoveUp:m,onMoveDown:x,onInsertVariable:b})=>{const N=a.useRef(null),p=(d,c)=>{h({...r,[d]:c})},n=d=>{const c=N.current;if(c){const S=c.selectionStart,j=c.selectionEnd,C=r.instruction,l=`\${${d}}`,B=C.substring(0,S)+l+C.substring(j);p("instruction",B),setTimeout(()=>{c.focus(),c.setSelectionRange(S+l.length,S+l.length)},0)}else p("instruction",r.instruction+`\${${d}}`)};return e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 mb-3 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-indigo-50 to-violet-50 border-b border-slate-200",children:[e.jsx(Me,{size:16,className:"text-slate-400 cursor-grab"}),e.jsx("span",{className:"w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 text-xs font-bold flex items-center justify-center",children:g+1}),e.jsx("input",{type:"text",value:r.title,onChange:d=>p("title",d.target.value),placeholder:"Abschnittstitel (z.B. 'Discovery Questions ðŸ”')",className:"flex-1 px-2 py-1 rounded border-0 bg-transparent text-sm font-semibold text-slate-800 placeholder:text-slate-400"}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:m,disabled:g===0,className:`p-1 border-none bg-transparent ${g===0?"opacity-30":"cursor-pointer"}`,children:e.jsx(Se,{size:16,className:"text-slate-500"})}),e.jsx("button",{onClick:x,disabled:g===f-1,className:`p-1 border-none bg-transparent ${g===f-1?"opacity-30":"cursor-pointer"}`,children:e.jsx(ye,{size:16,className:"text-slate-500"})})]}),e.jsx("button",{onClick:i,className:"p-1.5 border-none bg-transparent cursor-pointer text-red-500 hover:bg-red-50 rounded",children:e.jsx(q,{size:16})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600",children:"Anweisung fÃ¼r diesen Abschnitt"}),o.length>0&&e.jsx(we,{variables:o,onSelect:n})]}),e.jsx("textarea",{ref:N,value:r.instruction,onChange:d=>p("instruction",d.target.value),placeholder:"z.B. 'Erstelle 5-7 offene Fragen um Bedarf zu wecken basierend auf ${customer_type}'",rows:2,className:"w-full px-3 py-2.5 rounded-lg border border-slate-200 text-sm resize-y"})]})]})},we=({variables:r,onSelect:g})=>{const[f,o]=a.useState(!1),h=a.useRef(null);return a.useEffect(()=>{const i=m=>{h.current&&!h.current.contains(m.target)&&o(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),r.length===0?null:e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>o(!f),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-indigo-50 text-indigo-600 text-xs font-medium border-none cursor-pointer hover:bg-indigo-100 transition-colors",children:[e.jsx(M,{size:14}),"Variable einfÃ¼gen",e.jsx(ye,{size:14,className:`transition-transform ${f?"rotate-180":""}`})]}),e.jsx(ze,{children:f&&e.jsx(me.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-slate-200 z-50 min-w-[180px] py-1",children:r.map(i=>e.jsxs("button",{onClick:()=>{g(i.key),o(!1)},className:"w-full px-3 py-2.5 text-left text-sm hover:bg-indigo-50 border-none bg-transparent cursor-pointer flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-slate-800 font-medium",children:i.label}),e.jsxs("code",{className:"text-xs text-indigo-700 bg-indigo-100 px-2 py-1 rounded font-mono font-semibold whitespace-nowrap",children:["$","{","$",i.key,"}"]})]},i.id))})})]})},Vt=({selectedIcon:r,onSelect:g})=>e.jsx("div",{className:"flex flex-wrap gap-3",children:Ke.map(({key:f,icon:o,label:h})=>{const i=r===f;return e.jsx("button",{onClick:()=>g(f),title:h,className:`w-[60px] h-[60px] rounded-xl border-2 flex items-center justify-center cursor-pointer transition-all ${i?"border-primary bg-primary/10":"border-slate-200 bg-white hover:border-primary/40"}`,children:e.jsx(o,{size:28,className:i?"text-primary":"text-slate-500"})},f)})}),Lt=({isOpen:r,onClose:g,onSave:f,editTemplate:o=null,demoCode:h})=>{const[i,m]=a.useState(""),[x,b]=a.useState(""),[N,p]=a.useState("file-text"),[n,d]=a.useState([]),[c,S]=a.useState(""),[j,C]=a.useState([]),[l,B]=a.useState(""),[_,I]=a.useState("empty"),[R,K]=a.useState(!1),[v,k]=a.useState(null),[E,A]=a.useState("basics"),[u,w]=a.useState(null),[V,G]=a.useState(null),[F,Z]=a.useState(!1),oe=a.useRef(null),ce=a.useRef(null),Ne=t=>{if(!t)return{aiRole:"",sections:[],aiBehavior:""};let s="",y=[],z="";const T=t.match(/\n*WICHTIG:\s*([\s\S]*?)$/i);T&&(z=T[1].trim(),t=t.replace(T[0],"").trim());const J=/###\s*\d+\.\s*([^\n]+)\n([\s\S]*?)(?=###\s*\d+\.|$)/g;let Y;const H=[];for(;(Y=J.exec(t))!==null;)H.push({id:P(),title:Y[1].trim(),instruction:Y[2].trim()});if(H.length>0){y=H;const Q=t.indexOf("###"),ke=t.indexOf("Erstelle ein strukturiertes Briefing");ke!==-1&&ke<Q?s=t.substring(0,ke).trim():Q!==-1&&(s=t.substring(0,Q).trim())}else s=t;return{aiRole:s,sections:y,aiBehavior:z}};a.useEffect(()=>{if(o){if(m(o.title||""),b(o.description||""),p(o.icon||"file-text"),d((o.variables_schema||[]).map(t=>({...t,id:t.id||P(),options:(t.options||[]).map(s=>({...s,id:s.id||P()}))}))),o.ai_role){if(S(o.ai_role),o.ai_task)try{const t=JSON.parse(o.ai_task);Array.isArray(t)&&C(t.map(s=>({...s,id:s.id||P()})))}catch{C([{id:P(),title:"Hauptabschnitt",instruction:o.ai_task}])}B(o.ai_behavior||"")}else if(o.system_prompt){const t=Ne(o.system_prompt);S(t.aiRole),C(t.sections),B(t.aiBehavior)}Z(o.allow_user_variables||!1),I("empty")}else m(""),b(""),p("file-text"),d([]),S(""),C([]),B(""),Z(!1),I("empty");A("basics"),k(null),G(null)},[o,r]);const $=()=>c.trim()||j.length>0||l.trim()||n.length>0,W=t=>{const s=Ve.find(y=>y.key===t);if(!s||t==="empty"){I("empty");return}$()?w(s):Ee(s)},Ee=t=>{I(t.key),S(t.aiRole),C(t.sections.map(s=>({...s,id:P()}))),B(t.aiBehavior),p(Ke.find(s=>s.icon===t.icon)?.key||"file-text"),t.variables&&t.variables.length>0&&d(t.variables.map(s=>({...s,id:P(),required:!0,options:[]}))),w(null)},Ue=()=>{w(null)},Ge=()=>{d([...n,_t()])},We=(t,s)=>{const y=[...n];y[t]=s,d(y)},He=t=>{d(n.filter((s,y)=>y!==t))},qe=t=>{if(t===0)return;const s=[...n];[s[t-1],s[t]]=[s[t],s[t-1]],d(s)},Ze=t=>{if(t===n.length-1)return;const s=[...n];[s[t],s[t+1]]=[s[t+1],s[t]],d(s)},Je=()=>{C([...j,It()])},Ye=(t,s)=>{const y=[...j];y[t]=s,C(y)},Qe=t=>{C(j.filter((s,y)=>y!==t))},Xe=t=>{if(t===0)return;const s=[...j];[s[t-1],s[t]]=[s[t],s[t-1]],C(s)},et=t=>{if(t===j.length-1)return;const s=[...j];[s[t],s[t+1]]=[s[t+1],s[t]],C(s)},Ae=(t,s,y,z)=>{const T=t.current;if(T){const J=T.selectionStart,Y=T.selectionEnd,H=`\${${z}}`,Q=y.substring(0,J)+H+y.substring(Y);s(Q),setTimeout(()=>{T.focus(),T.setSelectionRange(J+H.length,J+H.length)},0)}else s(y+`\${${z}}`)},$e=()=>{let t=c+`

`;return j.length>0&&(t+=`Erstelle ein strukturiertes Briefing mit folgenden Abschnitten:

`,j.forEach((s,y)=>{t+=`### ${y+1}. ${s.title}
${s.instruction}

`})),l&&(t+=`
WICHTIG: ${l}`),t},tt=()=>{const t=$e(),s=/\$\{(\w+)\}/g,y=[];let z;for(;(z=s.exec(t))!==null;)y.includes(z[1])||y.push(z[1]);return y},De=()=>{const t=tt(),s=n.map(z=>z.key).filter(z=>z.trim()),y=t.filter(z=>!s.includes(z));return{success:y.length===0,undefinedVars:y,usedVariables:t,definedKeys:s}},st=()=>{const t=De();return G(t),t.success?k(null):(k(`Undefinierte Variablen im Prompt gefunden: ${t.undefinedVars.map(s=>"${"+s+"}").join(", ")}`),A("prompt")),t.success},rt=()=>{if(!i.trim())return k("Bitte gib einen Titel ein."),A("basics"),!1;if(!c.trim())return k("Bitte definiere eine KI-Rolle."),A("prompt"),!1;if(j.length===0)return k("Bitte fÃ¼ge mindestens einen Abschnitt hinzu."),A("prompt"),!1;for(const s of j)if(!s.title.trim())return k("Alle Abschnitte benÃ¶tigen einen Titel."),A("prompt"),!1;for(const s of n){if(!s.key.trim()||!s.label.trim())return k("Alle Variablen benÃ¶tigen einen Namen und eine Bezeichnung."),A("variables"),!1;if(s.type==="select"&&(!s.options||s.options.length===0))return k(`Variable "${s.label}" benÃ¶tigt mindestens eine Auswahloption.`),A("variables"),!1}const t=De();return G(t),t.success?!0:(k(`Undefinierte Variablen im Prompt: ${t.undefinedVars.map(s=>"${"+s+"}").join(", ")}. Bitte definiere diese Variablen unter "Eingabefelder".`),A("prompt"),!1)},nt=async()=>{if(k(null),!!rt()){K(!0);try{const t=n.map(z=>({key:z.key,label:z.label,type:z.type,required:z.required,placeholder:z.placeholder,...z.type==="select"?{options:z.options.map(T=>({value:T.value,label:T.label}))}:{}})),s={title:i.trim(),description:x.trim(),icon:N,ai_role:c,ai_task:JSON.stringify(j.map(z=>({title:z.title,instruction:z.instruction}))),ai_behavior:l,system_prompt:$e(),variables_schema:t,allow_user_variables:F,...h?{demo_code:h}:{}};let y;if(o?y=await U.request(`/smartbriefing/templates/${o.id}`,{method:"PUT",body:JSON.stringify(s)}):y=await U.request("/smartbriefing/templates",{method:"POST",body:JSON.stringify(s)}),y.success)f?.(y.data.template),g();else throw new Error(y.message||"Fehler beim Speichern")}catch(t){console.error("[CreateTemplateDialog] Save error:",t),k(t.message||"Fehler beim Speichern des Templates")}finally{K(!1)}}};return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(me.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-[750px] max-h-[90vh] flex flex-col shadow-2xl overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-slate-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 text-xl font-bold text-slate-900",children:o?"Template bearbeiten":"Neues Template erstellen"}),e.jsx("p",{className:"mt-1 mb-0 text-sm text-slate-500",children:"Erstelle ein persÃ¶nliches Briefing-Template"})]}),e.jsx("button",{onClick:g,className:"p-2 border-none bg-slate-100 rounded-lg cursor-pointer hover:bg-slate-200 transition-colors",children:e.jsx(ct,{size:20,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex border-b border-slate-200 px-6 gap-1",children:[{key:"basics",label:"1. Grundlagen"},{key:"variables",label:"2. Eingabefelder"},{key:"prompt",label:"3. KI-Anweisung"}].map(t=>{const s=E===t.key;return e.jsx("button",{onClick:()=>A(t.key),className:"px-5 py-3 text-sm font-semibold cursor-pointer transition-all rounded-t-lg",style:{backgroundColor:s?"#E0E7FF":"transparent",color:s?"#4338CA":"#64748B",borderBottom:s?"3px solid #4F46E5":"3px solid transparent",marginBottom:"-1px"},children:t.label},t.key)})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg px-4 py-3 mb-4 flex items-center gap-2",children:[e.jsx(X,{size:18,className:"text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:v})]}),E==="basics"&&e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-violet-50 rounded-xl p-4 border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ce,{size:18,className:"text-indigo-600"}),e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:o?"Vorlage anwenden":"Schnellstart mit Vorlage"})]}),e.jsx("select",{value:_,onChange:t=>W(t.target.value),className:"w-full px-3.5 py-3 rounded-xl border border-indigo-200 text-sm bg-white cursor-pointer",children:Ve.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:o?"WÃ¤hle eine Vorlage, um die KI-Anweisungen zu ersetzen. Titel und Beschreibung bleiben erhalten.":"Eine Vorlage fÃ¼llt Eingabefelder und KI-Anweisungen automatisch aus."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Titel *"}),e.jsx("input",{type:"text",value:i,onChange:t=>m(t.target.value),placeholder:"z.B. Sales Discovery Call Prep",className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-[15px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-1.5",children:"Beschreibung"}),e.jsx("textarea",{value:x,onChange:t=>b(t.target.value),placeholder:"Kurze Beschreibung, wofÃ¼r dieses Template verwendet wird...",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Symbol"}),e.jsx(Vt,{selectedIcon:N,onSelect:p})]})]}),E==="variables"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Te,{size:16,className:"text-slate-500"}),e.jsxs("span",{className:"text-[13px] text-slate-500",children:["Definiere die Eingabefelder, die der Nutzer beim Erstellen eines Briefings ausfÃ¼llen soll. Diese kÃ¶nnen dann im Prompt als $","{variablenname}"," verwendet werden."]})]})}),n.map((t,s)=>e.jsx(Tt,{variable:t,index:s,total:n.length,onChange:y=>We(s,y),onDelete:()=>He(s),onMoveUp:()=>qe(s),onMoveDown:()=>Ze(s)},t.id)),e.jsxs("button",{onClick:Ge,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3.5 rounded-xl border-2 border-dashed border-slate-300 bg-white text-slate-500 text-sm font-medium cursor-pointer transition-all hover:border-primary hover:text-primary",children:[e.jsx(M,{size:18}),"Eingabefeld hinzufÃ¼gen"]}),n.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Noch keine Eingabefelder definiert."}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-200",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:t=>Z(t.target.checked),className:"w-5 h-5 accent-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-800 text-sm",children:"Nutzer darf eigene Variablen hinzufÃ¼gen"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Wenn aktiviert, kann der Nutzer beim Erstellen eines Briefings eigene zusÃ¤tzliche Eingabefelder definieren."})]})]})})]}),E==="prompt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"KI-Rolle *"}),n.length>0&&e.jsx(we,{variables:n,onSelect:t=>Ae(oe,S,c,t)})]}),e.jsx("textarea",{ref:oe,value:c,onChange:t=>S(t.target.value),placeholder:"z.B. 'Du bist ein erfahrener Sales-Coach mit 15+ Jahren B2B-Vertriebserfahrung...'",rows:3,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Briefing-Abschnitte *"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[j.length," Abschnitt",j.length!==1?"e":""]})]}),j.map((t,s)=>e.jsx(Ft,{section:t,index:s,total:j.length,variables:n,onChange:y=>Ye(s,y),onDelete:()=>Qe(s),onMoveUp:()=>Xe(s),onMoveDown:()=>et(s)},t.id)),e.jsxs("button",{onClick:Je,className:"flex items-center justify-center gap-2 w-full px-3.5 py-3 rounded-xl border-2 border-dashed border-indigo-300 bg-indigo-50/50 text-indigo-600 text-sm font-medium cursor-pointer transition-all hover:bg-indigo-100",children:[e.jsx(M,{size:18}),"Abschnitt hinzufÃ¼gen"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-900",children:"Verhalten & Stil (optional)"}),n.length>0&&e.jsx(we,{variables:n,onSelect:t=>Ae(ce,B,l,t)})]}),e.jsx("textarea",{ref:ce,value:l,onChange:t=>B(t.target.value),placeholder:"z.B. 'Schreibe praxisnah und actionable. Vermeide Theorie - fokussiere auf konkrete Formulierungen.'",rows:2,className:"w-full px-3.5 py-3 rounded-xl border border-slate-200 text-sm resize-y"})]}),n.length>0&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Te,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500",children:"VerfÃ¼gbare Variablen (klicken zum Kopieren)"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(t=>e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(`\${${t.key}}`)},className:"inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-white rounded-lg border border-slate-200 text-xs cursor-pointer hover:border-indigo-300 hover:bg-indigo-50 transition-colors",children:[e.jsx("span",{className:"text-slate-600",children:t.label}),e.jsxs("code",{className:"font-mono text-indigo-600",children:["$","{","$",t.key,"}"]}),e.jsx(de,{size:12,className:"text-slate-400"})]},t.id))})]})]})]}),V&&e.jsx("div",{className:`px-6 py-3 border-t ${V.success?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:e.jsx("div",{className:"flex items-center gap-2",children:V.success?e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:18,className:"text-green-600"}),e.jsxs("span",{className:"text-green-700 text-sm font-medium",children:["Syntax OK - Alle ",V.usedVariables.length," Variablen sind definiert."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{size:18,className:"text-amber-600"}),e.jsxs("span",{className:"text-amber-700 text-sm",children:[e.jsx("strong",{children:"Undefinierte Variablen:"})," ",V.undefinedVars.map(t=>"${"+t+"}").join(", ")]})]})})}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 flex justify-between items-center gap-3",children:[e.jsx("button",{onClick:g,className:"px-6 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:"Abbrechen"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:st,className:"flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-200 bg-white text-slate-600 text-sm font-medium cursor-pointer hover:bg-slate-50 transition-colors",children:[e.jsx(mt,{size:16}),"Syntax prÃ¼fen"]}),e.jsx("button",{onClick:nt,disabled:R,className:`flex items-center gap-2 px-6 py-3 rounded-xl border-none bg-brand-gradient text-white text-sm font-semibold transition-all ${R?"cursor-not-allowed opacity-70":"cursor-pointer"}`,children:R?e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:18,className:"animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{size:18}),o?"Speichern":"Template erstellen"]})})]})]})]})}),e.jsx(ze,{children:u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[70] p-4",children:e.jsxs(me.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl w-full max-w-[420px] shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-amber-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{size:24,className:"text-amber-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Daten Ã¼berschreiben?"})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-slate-600 text-sm mb-4",children:["Du hast bereits Eingabefelder oder KI-Anweisungen definiert. Wenn du die Vorlage ",e.jsxs("strong",{children:['"',u.label,'"']})," anwendest, werden diese Daten Ã¼berschrieben."]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 font-medium mb-1",children:"Was wird Ã¼berschrieben:"}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[n.length>0&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),n.length," Eingabefeld",n.length!==1?"er":""]}),c&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),"KI-Rolle"]}),j.length>0&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),j.length," Briefing-Abschnitt",j.length!==1?"e":""]}),l&&e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),"Verhalten & Stil"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Ue,className:"flex-1 px-4 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 font-medium text-sm cursor-pointer hover:bg-slate-50 transition-colors",children:"Abbrechen"}),e.jsx("button",{onClick:()=>Ee(u),className:"flex-1 px-4 py-2.5 rounded-xl border-none bg-amber-500 text-white font-medium text-sm cursor-pointer hover:bg-amber-600 transition-colors",children:"Ãœberschreiben"})]})]})]})})})]}):null},D={DASHBOARD:"dashboard",FORM:"form",RESULT:"result",LIST:"list",WORKBOOK:"workbook"},Xt=({isAuthenticated:r,requireAuth:g,setPendingAction:f,onNavigateToSimulator:o,onNavigateToHistory:h,demoCode:i})=>{const[m,x]=a.useState(D.DASHBOARD),[b,N]=a.useState(null),[p,n]=a.useState(null),[d,c]=a.useState(null),[S,j]=a.useState(null),[C,l]=a.useState(!1),[B,_]=a.useState(null),[I,R]=a.useState(0);a.useEffect(()=>{S&&r&&(N(S),x(D.FORM),j(null))},[S,r]),a.useEffect(()=>{window.scrollTo(0,0)},[m]);const K=a.useCallback($=>{N($),x(D.FORM)},[]),v=a.useCallback(()=>{N(null),n(null),c(null),x(D.DASHBOARD)},[]),k=a.useCallback($=>{n($),c($),x(D.WORKBOOK)},[]),E=a.useCallback(()=>{n(null),c(null),N(null),x(D.DASHBOARD)},[]),A=a.useCallback(()=>{n(null),c(null),x(D.FORM)},[]);a.useCallback(()=>{x(D.LIST)},[]);const u=a.useCallback($=>{c($),x(D.WORKBOOK)},[]);a.useCallback(()=>{c(null),x(D.LIST)},[]);const w=a.useCallback($=>{o&&o($)},[o]),V=a.useCallback(async $=>{try{if((await U.request(`/smartbriefing/briefings/${$.id}`,{method:"DELETE"})).success)c(null),x(D.DASHBOARD);else throw new Error("Fehler beim LÃ¶schen")}catch(W){throw console.error("[SmartBriefing] Error deleting briefing:",W),W}},[]),G=a.useCallback(()=>{_(null),l(!0)},[]),F=a.useCallback($=>{_($),l(!0)},[]),Z=a.useCallback($=>{_($),l(!0)},[]),oe=a.useCallback(()=>{l(!1),_(null)},[]),ce=a.useCallback($=>{R(W=>W+1)},[]),Ne=()=>{switch(m){case D.FORM:return e.jsx(St,{template:b,onBack:v,onBriefingGenerated:k,isAuthenticated:r});case D.RESULT:return e.jsx(zt,{briefing:p,template:b,onBack:v,onCreateNew:E,onGenerateAnother:A});case D.LIST:return e.jsx(Dt,{onOpenBriefing:u,onCreateNew:E,isAuthenticated:r});case D.WORKBOOK:return e.jsx(yt,{briefing:d,onBack:v,onDelete:V,onStartSimulation:o?w:null});case D.DASHBOARD:default:return e.jsx(wt,{onSelectTemplate:K,onShowList:h,onCreateTemplate:G,onEditTemplate:F,onCopyTemplate:Z,isAuthenticated:r,requireAuth:g,setPendingAction:f,demoCode:i},I)}};return e.jsxs("div",{className:"min-h-full",children:[Ne(),e.jsx(Lt,{isOpen:C,onClose:oe,onSave:ce,editTemplate:B,demoCode:i})]})};export{Dt as BriefingList,zt as BriefingResult,yt as BriefingWorkbook,Xt as SmartBriefingApp,wt as SmartBriefingDashboard,St as SmartBriefingForm};
