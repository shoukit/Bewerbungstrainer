import{j as r,d as k}from"./ui-vendor-CgXEyNXi.js";import{a as o}from"./react-vendor-uDOJF2jQ.js";import{a as v,D as A}from"./DecisionBoardResult-BpKOPc3j.js";import{w as p,i as F,o as P,C as y}from"./FeatureInfoButton-BUfqVR8e.js";import{u as T,a as _,F as L}from"./useScrollToTop-B6j6jc4A.js";import"./Button-j0YrfSxa.js";import"./utils-BEHD0UYf.js";import"./input-lfaX5RPk.js";import"./textarea-CvyTjNsl.js";import"./index.js";import"./AudioRecorder-5hzQyYyg.js";import"./button-xzdvQGR3.js";import"./card-h-69AINb.js";import"./index-CklPxmEV.js";const c={INPUT:"input",RESULT:"result"},se=({isAuthenticated:m,requireAuth:h,setPendingAction:N,onNavigateToHistory:i})=>{const[I,d]=o.useState(c.INPUT),[w,D]=o.useState(null),[C,u]=o.useState(null),[t,a]=o.useState(null),[M,O]=o.useState(!1),l=o.useRef(!1),B=P(y.teal[500],y.teal[400]);T(m,h),_({dependencies:[I]});const b=o.useCallback(async e=>{if(l.current||!e.topic?.trim())return null;try{const s={topic:e.topic,context:e.context||null,pros:e.pros||[],cons:e.cons||[],pro_score:e.proScore||0,contra_score:e.contraScore||0,status:"draft"},n=await p.createDecision(s);if(n?.id)return l.current=!0,a(n.id),console.log("[DecisionBoard] Draft session saved with ID:",n.id),n.id}catch(s){console.error("[DecisionBoard] Failed to save draft session:",s)}return null},[]),f=o.useCallback(async(e,s)=>{if(e)try{const n={topic:s.topic,context:s.context||null,pros:s.pros||[],cons:s.cons||[],pro_score:s.proScore||0,contra_score:s.contraScore||0,analysis:s.analysis||null,status:s.status||"completed"};await p.updateDecision(e,n),console.log("[DecisionBoard] Session updated:",e)}catch(n){console.error("[DecisionBoard] Failed to update session:",n)}},[]),x=o.useCallback(async e=>{if(e)try{await p.deleteDecision(e),console.log("[DecisionBoard] Session deleted:",e)}catch(s){console.error("[DecisionBoard] Failed to delete session:",s)}},[]),E=o.useCallback(async(e,s)=>{D(e),u(s),d(c.RESULT);try{if(t)await f(t,{...e,analysis:s,status:"completed"});else{const n={topic:e.topic,context:e.context||null,pros:e.pros,cons:e.cons,pro_score:e.proScore,contra_score:e.contraScore,analysis:s,status:"completed"},S=await p.createDecision(n);S?.id&&(a(S.id),l.current=!0,console.log("[DecisionBoard] Decision saved with ID:",S.id))}}catch(n){console.error("[DecisionBoard] Failed to save decision:",n)}},[t,f]),R=o.useCallback(()=>{D(null),u(null),a(null),l.current=!1,d(c.INPUT)},[]),g=o.useCallback(()=>{u(null),d(c.INPUT)},[]),U=o.useCallback(async()=>{t&&await x(t),D(null),u(null),a(null),l.current=!1,i&&i()},[t,x,i]),j=()=>{switch(I){case c.RESULT:return r.jsx(A,{decisionData:w,analysisResult:C,onStartNew:R,onEditDecision:g});case c.INPUT:default:return r.jsx(v,{initialData:w,onAnalysisComplete:E,onCancel:i?U:null,isAuthenticated:m,requireAuth:h,savedDecisionId:t,onSaveDraft:b,onUpdateSession:f,onDecisionIdChange:a})}};return r.jsxs(r.Fragment,{children:[r.jsx(F,{featureId:"decisionboard",showOnMount:!0}),r.jsxs("div",{className:"min-h-full",children:[r.jsx(L,{featureId:"decisionboard",icon:k,title:"Entscheidungs-Board",subtitle:"Strukturierte Entscheidungsfindung",gradient:B,historyLabel:"Meine Entscheidungen",onNavigateToHistory:i}),j()]})]})};export{se as DecisionBoardApp,v as DecisionBoardInput,A as DecisionBoardResult};
