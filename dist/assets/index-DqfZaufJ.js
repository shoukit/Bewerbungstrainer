import{V as Oe,c as We,a as Ge,b as Ze}from"./VideoTrainingApp-WST7yJ29.js";import{j as e,v as re,V as Q,m as f,I as z,y as S,an as F,f as K,l as Y,a as ee,a1 as le,E as te,am as oe,M as ce,g as de,z as L,h as me,C as xe,t as ue}from"./ui-vendor-CgXEyNXi.js";import{a as i}from"./react-vendor-uDOJF2jQ.js";import{u as pe,g as he,a as X}from"./FeatureInfoButton-CKRfvL7l.js";import{F as ge}from"./fullscreen-loader-jviqvzjF.js";import{C as I,B as fe}from"./Button-j0YrfSxa.js";import"./select-native-LRVAJk5R.js";import"./dialog-dwOizz02.js";import"./ScenarioDashboard-Cpf91yxq.js";import"./ScenarioCard-Bto50kc_.js";import"./useBranding-B68WBX8m.js";import"./useMobile-YxjH166V.js";import"./button-B4ZYjenW.js";import"./input-lfaX5RPk.js";import"./utils-BEHD0UYf.js";import"./textarea-CvyTjNsl.js";import"./DeviceSetupPage-BnuTH9fi.js";import"./MicrophoneTestDialog-BXR4an4r.js";import"./DeviceSettingsDialog-DNBpO6vu.js";import"./progress-bar-BbBJ93aa.js";import"./Confetti-DTo36itb.js";import"./index-CklPxmEV.js";const J={target:Y,clock:de,mic:K,camera:F,video:Q,"message-square":ce,lightbulb:S,brain:oe,info:z,settings:te,check:le,sparkles:ee},be=[{icon:F,title:"Blick in die Kamera",description:"Schaue direkt in die Kamera, um Augenkontakt zu simulieren."},{icon:S,title:"Gute Beleuchtung",description:"Achte auf ausreichend Licht von vorne, um professionell zu wirken."},{icon:K,title:"Klare Aussprache",description:"Sprich deutlich und in angemessenem Tempo."},{icon:Y,title:"Strukturierte Antworten",description:"Nutze die STAR-Methode: Situation, Task, Action, Result."}],H=({type:t,devices:m,selectedDeviceId:p,onDeviceChange:x,isLoading:u,error:d,onRefresh:r})=>{const[v,j]=i.useState(!1),N=t==="video"?F:K,w=t==="video"?"Kamera":"Mikrofon",D=l=>{if(l.label){let o=l.label;return o=o.replace(/^Default - /,""),o=o.replace(/^Kommunikation - /,""),o=o.replace(/^Standard - /,""),o.length>35&&(o=o.substring(0,32)+"..."),o}return`${w} ${m.indexOf(l)+1}`},y=m.find(l=>l.deviceId===p),q=l=>{x?.(l),j(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>!u&&j(!v),disabled:u,className:`flex-1 min-w-[200px] flex items-center justify-between gap-3 p-3 rounded-xl border-2 transition-all
            ${d?"border-red-500 bg-red-50":"border-slate-200 bg-white"}
            ${u?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-[10px] flex items-center justify-center
              ${d?"bg-red-100":"bg-brand-gradient"}`,children:d?e.jsx(L,{className:"w-[22px] h-[22px] text-red-500"}):e.jsx(N,{className:"w-[22px] h-[22px] text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium mb-0.5",children:w}),e.jsx("div",{className:`text-sm font-semibold ${d?"text-red-600":"text-slate-900"}`,children:u?"Lade...":d||(y?D(y):"Bitte wählen")})]})]}),e.jsx(xe,{className:`w-5 h-5 text-slate-400 transition-transform duration-200 ${v?"rotate-180":""}`})]}),d&&r&&e.jsx("button",{type:"button",onClick:r,className:"flex items-center justify-center px-4 py-3 rounded-xl border-2 border-slate-200 bg-white cursor-pointer hover:bg-slate-50 transition-colors",children:e.jsx(ue,{className:"w-5 h-5 text-slate-600"})})]}),v&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>j(!1),className:"fixed inset-0 z-40"}),e.jsx("div",{className:"absolute top-[calc(100%+8px)] left-0 right-0 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden max-h-[280px] overflow-y-auto",children:m.map((l,o)=>{const g=p===l.deviceId;return e.jsxs("button",{type:"button",onClick:()=>q(l.deviceId),className:`w-full py-3.5 px-4 text-left flex items-center gap-3 border-none cursor-pointer transition-colors
                    ${g?"bg-primary/10":"bg-transparent hover:bg-slate-50"}`,children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center
                    ${g?"bg-primary":"bg-slate-100"}`,children:e.jsx(N,{className:`w-[18px] h-[18px] ${g?"text-white":"text-slate-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`text-sm font-medium truncate ${g?"text-primary":"text-slate-900"}`,children:D(l)}),l.deviceId==="default"&&e.jsx("div",{className:"text-xs text-slate-400",children:"Systemstandard"})]}),g&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},l.deviceId||o)})})]})]})},ve=({field:t,value:m,onChange:p,error:x})=>{const u=`w-full py-3 px-4 rounded-[10px] border-2 text-base transition-all outline-none bg-white
    ${x?"border-red-500":"border-slate-200"}
    focus:border-primary focus:ring-2 focus:ring-primary/20`,d=()=>{switch(t.type){case"select":return e.jsxs("select",{value:m||t.default||"",onChange:r=>p(t.key,r.target.value),className:`${u} cursor-pointer`,required:t.required,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte auswählen..."}),t.options?.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]});case"textarea":return e.jsx("textarea",{value:m||"",onChange:r=>p(t.key,r.target.value),placeholder:t.placeholder,className:`${u} min-h-[100px] resize-y`,required:t.required});case"number":return e.jsx("input",{type:"number",value:m||"",onChange:r=>p(t.key,r.target.value),placeholder:t.placeholder,className:u,required:t.required,min:t.min,max:t.max});default:return e.jsx("input",{type:"text",value:m||"",onChange:r=>p(t.key,r.target.value),placeholder:t.placeholder,className:u,required:t.required})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),d(),t.hint&&e.jsx("p",{className:"text-[13px] text-slate-400 mt-1",children:t.hint}),x&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(L,{size:14}),x]})]})},_e=({scenario:t,onBack:m,onStart:p})=>{const[x,u]=i.useState(()=>{const s=t?.input_configuration||[],a={};return s.forEach(n=>{n.default&&(a[n.key]=n.default)}),a}),[d,r]=i.useState({}),[v,j]=i.useState(!1),[N,w]=i.useState(null),[D,y]=i.useState([]),[q,l]=i.useState([]),[o,g]=i.useState(null),[A,_]=i.useState(null),[B,P]=i.useState(!0),[O,k]=i.useState(null),[W,C]=i.useState(null),M=i.useRef(0),T=i.useRef(!1),R=i.useRef(!0),V=i.useRef(0),G=i.useRef(null),Z=i.useRef(null),{demoCode:se}=pe();G.current=o,Z.current=A;const E=i.useCallback(async(s=!1)=>{if(T.current){console.log("[VideoTraining] Skipping loadDevices - already loading");return}if(s){if(R.current){console.log("[VideoTraining] Skipping devicechange - ignore flag set");return}const a=Date.now()-M.current;if(a<5e3){console.log("[VideoTraining] Skipping devicechange - too soon:",a,"ms");return}if(V.current+=1,V.current>3){console.log("[VideoTraining] Skipping devicechange - too many events:",V.current);return}}T.current=!0,M.current=Date.now(),P(!0),k(null),C(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(c=>c.stop());const n=await navigator.mediaDevices.enumerateDevices(),h=n.filter(c=>c.kind==="audioinput"),b=n.filter(c=>c.kind==="videoinput");if(h.length===0)k("Kein Mikrofon gefunden"),y([]);else if(y(h),!G.current){const c=h.find($=>$.deviceId==="default")||h[0];g(c.deviceId)}if(b.length===0)C("Keine Kamera gefunden"),l([]);else if(l(b),!Z.current){const c=b.find($=>$.deviceId==="default")||b[0];_(c.deviceId)}}catch(a){console.error("Error loading devices:",a),a.name==="NotAllowedError"||a.name==="PermissionDeniedError"?(k("Zugriff verweigert"),C("Zugriff verweigert")):a.name==="NotFoundError"?(k("Kein Mikrofon gefunden"),C("Keine Kamera gefunden")):(k("Fehler beim Laden"),C("Fehler beim Laden")),y([]),l([])}finally{P(!1),T.current=!1,M.current=Date.now(),s||setTimeout(()=>{R.current=!1,console.log("[VideoTraining] Now accepting devicechange events")},5e3)}},[]);i.useEffect(()=>{E(!1);let s=null;const a=()=>{R.current||T.current||(s&&clearTimeout(s),s=setTimeout(()=>{E(!0)},1e3))};return navigator.mediaDevices?.addEventListener("devicechange",a),()=>{s&&clearTimeout(s),navigator.mediaDevices?.removeEventListener("devicechange",a)}},[]);const ae=i.useCallback((s,a)=>{u(n=>({...n,[s]:a})),d[s]&&r(n=>{const h={...n};return delete h[s],h})},[d]),ie=i.useCallback(()=>{const s={};return(t?.input_configuration||[]).forEach(n=>{n.required&&!x[n.key]&&(s[n.key]=`${n.label} ist erforderlich`)}),r(s),Object.keys(s).length===0},[t,x]),ne=async()=>{if(ie()){j(!0),w(null);try{const s=he(),a=await fetch(`${s}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()},body:JSON.stringify({scenario_id:t.id,variables:x,demo_code:se||null})});if(!a.ok)throw new Error("Fehler beim Erstellen der Sitzung");const n=await a.json();if(!n.success||!n.data?.session)throw new Error("Ungültige Antwort beim Erstellen der Sitzung");const h=n.data.session,b=await fetch(`${s}/video-training/sessions/${h.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":X()}});if(!b.ok)throw new Error("Fehler beim Generieren der Fragen");const c=await b.json();if(!c.success||!c.data?.questions)throw new Error("Fehler beim Generieren der Fragen");p({session:c.data.session,questions:c.data.questions,variables:x,selectedMicrophoneId:o,selectedCameraId:A})}catch(s){console.error("[VIDEO TRAINING] Error starting session:",s),w(s.message)}finally{j(!1)}}},U=t?.input_configuration||[];return e.jsxs("div",{className:"p-6 md:p-8 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(re,{size:18}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-[14px] bg-brand-gradient flex items-center justify-center",children:e.jsx(Q,{size:28,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:t?.title}),e.jsx("p",{className:"text-sm text-slate-500",children:"Konfiguriere deine Wirkungs-Analyse"})]})]})]}),e.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"py-4 px-5 bg-primary/5 rounded-xl border border-primary/20 mb-8 flex items-start gap-3",children:[e.jsx(z,{size:20,className:"text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-sm",children:"So funktioniert es"}),e.jsxs("p",{className:"text-[13px] text-slate-500 leading-relaxed",children:["Die KI generiert ",t?.question_count||5," personalisierte Fragen basierend auf deinen Angaben. Beantworte jede Frage vor der Kamera und erhalte anschließend detailliertes Feedback."]})]})]}),t?.long_description&&e.jsx(I,{as:f.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-[10px] bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[15px] font-semibold text-slate-900 mb-2",children:"Deine Aufgabe"}),e.jsx("p",{className:"text-sm leading-relaxed text-slate-600 whitespace-pre-wrap",children:t.long_description?.replace(/\/n/g,`
`)})]})]})}),e.jsxs(I,{as:f.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-5",children:[e.jsx(S,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Tipps für dein Video-Training"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:(t?.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((s,a)=>typeof s=="string"?{icon:S,title:`Tipp ${a+1}`,description:s}:{icon:J[s.icon]||J[s.icon?.toLowerCase()]||S,title:s.title||`Tipp ${a+1}`,description:s.text||s.description||""}):be).map((s,a)=>{const n=s.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-9 h-9 rounded-[10px] bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(n,{className:"w-[18px] h-[18px] text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-[13px] text-slate-500 leading-relaxed",children:s.description})]})]},a)})})]}),e.jsxs(I,{as:f.div,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-6 md:p-7 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-6",children:[e.jsx(te,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Personalisiere dein Training"})]}),U.map(s=>e.jsx(ve,{field:s,value:x[s.key],onChange:ae,error:d[s.key]},s.key)),U.length===0&&e.jsx("p",{className:"text-slate-500 text-center py-5",children:"Keine zusätzliche Konfiguration erforderlich."})]}),e.jsxs(I,{as:f.div,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-6 md:p-7 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-6",children:[e.jsx(F,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Kamera & Mikrofon"})]}),e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx(H,{type:"video",devices:q,selectedDeviceId:A,onDeviceChange:_,isLoading:B,error:W,onRefresh:E}),e.jsx(H,{type:"audio",devices:D,selectedDeviceId:o,onDeviceChange:g,isLoading:B,error:O,onRefresh:E})]}),(O||W)&&e.jsxs("p",{className:"text-[13px] text-slate-400 mt-4 flex items-start gap-2",children:[e.jsx(z,{size:16,className:"flex-shrink-0 mt-0.5"}),"Bitte erlaube den Zugriff auf Kamera und Mikrofon in deinen Browser-Einstellungen, um die Geräte nutzen zu können."]})]}),N&&e.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 bg-red-50 rounded-xl border border-red-200 mb-6 flex items-center gap-3",children:[e.jsx(L,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm",children:N})]}),e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-slate-50 rounded-xl p-5 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[e.jsx(ee,{size:18,className:"text-primary"}),e.jsx("span",{className:"font-semibold text-slate-900 text-sm",children:"Training-Details"})]}),e.jsxs("div",{className:"flex flex-wrap gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Fragen"}),e.jsx("span",{className:"text-base font-semibold text-slate-900",children:t?.question_count||5})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:["~",Math.round((t?.time_limit_per_question||120)/60)," Min."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Gesamtdauer"}),e.jsxs("span",{className:"text-base font-semibold text-slate-900",children:["~",Math.round((t?.total_time_limit||900)/60)," Min."]})]})]})]}),e.jsx(fe,{as:f.button,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},onClick:ne,disabled:v,size:"lg",fullWidth:!0,iconPosition:"right",icon:e.jsx(me,{size:20}),children:"Video Training starten"}),e.jsx(ge,{isLoading:v,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{Oe as VideoTrainingApp,We as VideoTrainingComplete,Ge as VideoTrainingDashboard,Ze as VideoTrainingSession,_e as VideoTrainingWizard};
