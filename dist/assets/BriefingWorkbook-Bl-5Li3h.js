import{F as z,N as U,aD as L,r as re,aE as ie,aF as le,aG as oe,aH as ce,aI as de,s as xe,L as k,t as me,T as he,I as ue,X as ge,b as $,aJ as pe,ae as fe,O as y,aK as be,aL as je,aM as Ne,aN as we,g as ye,aO as ke,P as ve,aP as Ce,M as Se,aa as ze,ad as _e,Z as Pe,aQ as Ae,aR as Be,aS as Ee,i as Ie,aT as Me,E as Le,aA as De,z as Te,a1 as Fe,a4 as Ge,f as Re,V as Oe,a as D,Q as H,R as Ue,c as $e,S as He,y as V,a0 as Ve,aw as qe,ax as Ke,a8 as We,l as Ze,as as Je,w as Qe,U as q,aj as K,B as W,j as e,v as Ye,Y as Xe,x as Z,C as J,A as es,m as G,aB as ss,_ as ts}from"./ui-vendor-BE38435C.js";import{a as d}from"./react-vendor-uDOJF2jQ.js";import{u as as,w as B,k as ns}from"./FeatureInfoButton-DfHx39Vr.js";import{u as rs}from"./useMobile-YxjH166V.js";import{C as I,B as E}from"./Button-e95WK7fN.js";import"./select-native-D9I-UwiP.js";import"./dialog-D3nE5LV1.js";const is={"file-text":z,briefcase:W,banknote:K,users:q,user:Qe,"message-circle":Je,target:Ze,award:We,book:Ke,clipboard:qe,star:Ve,lightbulb:V,shield:He,compass:$e,rocket:Ue,calendar:H,sparkles:D,video:Oe,mic:Re,play:Ge,"check-circle":Fe,"alert-circle":Te,"help-circle":De,settings:Le,home:Me,"trending-up":Ie,"bar-chart":Ee,"pie-chart":Be,activity:Ae,zap:Pe,heart:_e,"thumbs-up":ze,"message-square":Se,mail:Ce,phone:ve,"map-pin":ke,clock:ye,bell:we,search:Ne,filter:je,edit:be,trash:y,plus:fe,minus:pe,check:$,x:ge,info:ue,warning:he,refresh:me,loader:k,globe:xe,link:de,bookmark:ce,tag:oe,code:le,database:ie,server:re,pen:L,bot:U},ls={"file-text":z,briefcase:W,banknote:K,users:q},os=(s,a=z)=>is[s]||a,ks=s=>ls[s]||z,cs={role_name:"Position",position:"Position",target_company:"Unternehmen",company:"Unternehmen",interview_type:"Gesprächsart",karrierelevel:"Karrierelevel",experience_years:"Berufserfahrung",industry:"Branche",current_salary:"Aktuelles Gehalt",target_salary:"Zielgehalt",negotiation_context:"Verhandlungskontext",customer_name:"Kunde",meeting_goal:"Gesprächsziel",product_service:"Produkt/Service",user_name:"Name",skills:"Fähigkeiten",strengths:"Stärken",challenges:"Herausforderungen"},ds=s=>cs[s]||s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),M=s=>{if(!s)return null;const a=[];let n=s,r=0;for(;n.length>0;){const h=n.match(/\*\*(.+?)\*\*/),t=n.match(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)|_([^_]+)_")),g=n.match(/`([^`]+)`/),x=[{match:h,type:"bold"},{match:t,type:"italic"},{match:g,type:"code"}].filter(m=>m.match);if(x.length===0){a.push(n);break}const o=x.reduce((m,u)=>(m.match?.index??1/0)<(u.match?.index??1/0)?m:u);switch(o.match.index>0&&a.push(n.substring(0,o.match.index)),o.type){case"bold":a.push(e.jsx("strong",{className:"font-semibold text-slate-900",children:o.match[1]},r++));break;case"italic":a.push(e.jsx("em",{className:"italic",children:o.match[1]||o.match[2]},r++));break;case"code":a.push(e.jsx("code",{className:"bg-indigo-50 px-1.5 py-0.5 rounded text-[13px] font-mono text-indigo-700",children:o.match[1]},r++));break}n=n.substring(o.match.index+o.match[0].length)}return a},Q=({content:s})=>{if(!s)return null;const a=n=>{const r=n.split(`
`),h=[];let t=[],g=null;const x=()=>{t.length>0&&(h.push(e.jsx("ul",{className:"my-2 pl-5 list-none",children:t.map((o,m)=>e.jsxs("li",{className:"mb-1.5 text-sm leading-relaxed text-slate-700 relative pl-4",children:[e.jsx("span",{className:"absolute left-0 text-indigo-600 font-bold",children:g==="number"?`${m+1}.`:"•"}),M(o)]},m))},`list-${h.length}`)),t=[],g=null)};return r.forEach((o,m)=>{const u=o.trim();if(!u){x();return}if(u.startsWith("- ")||u.startsWith("* ")){g!=="bullet"&&(x(),g="bullet"),t.push(u.substring(2));return}const f=u.match(/^(\d+)\.\s/);if(f){g!=="number"&&(x(),g="number"),t.push(u.substring(f[0].length));return}x(),h.push(e.jsx("p",{className:"my-2 text-sm leading-relaxed text-slate-700",children:M(u)},`p-${m}`))}),x(),h};return e.jsx("div",{children:a(s)})},xs=({item:s,onRestore:a})=>e.jsxs("div",{className:"px-3 py-2.5 bg-slate-50 rounded-xl mb-2 flex items-center justify-between opacity-60",children:[e.jsxs("span",{className:"text-sm text-slate-500 italic",children:[e.jsx("s",{children:s.label})," - gelöscht"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2.5 py-1.5 rounded-lg border-none bg-slate-200 text-slate-600 text-xs font-medium cursor-pointer hover:bg-indigo-100 hover:text-indigo-700 transition-all",children:[e.jsx(ts,{size:12}),"Wiederherstellen"]})]}),R=({item:s,sectionId:a,onUpdateItem:n})=>{const[r,h]=d.useState(s.user_note||""),[t,g]=d.useState(!1),[x,o]=d.useState(!1),[m,u]=d.useState(!1),[f,j]=d.useState(!!s.user_note);d.useEffect(()=>{u(r!==(s.user_note||""))},[r,s.user_note]);const N=async()=>{g(!0);try{await n(a,s.id,{user_note:r}),o(!0),u(!1),setTimeout(()=>o(!1),2e3)}catch(b){console.error("Error saving note:",b)}finally{g(!1)}},v=async()=>{try{await n(a,s.id,{deleted:!0})}catch(b){console.error("Error deleting item:",b)}},c=async()=>{try{await n(a,s.id,{deleted:!1})}catch(b){console.error("Error restoring item:",b)}};return s.deleted?e.jsx(xs,{item:s,onRestore:c}):e.jsxs(I,{className:"mb-2.5 overflow-hidden p-0 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-3.5 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("h4",{className:"text-sm font-semibold text-slate-900 m-0",children:s.label})]}),s.content&&e.jsx("p",{className:"text-[13px] text-slate-600 m-0 ml-3.5 leading-snug",children:M(s.content)})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.user_note&&!f&&e.jsx("span",{className:"text-[11px] font-medium text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full",children:"Notiz"}),e.jsx("button",{onClick:()=>j(!f),title:"Notiz hinzufügen",className:`p-1.5 rounded-lg border-none cursor-pointer flex items-center justify-center transition-all ${f?"bg-indigo-100 text-indigo-600":"bg-transparent text-slate-400 hover:text-indigo-600 hover:bg-indigo-50"}`,children:e.jsx(L,{size:16})}),e.jsx("button",{onClick:v,title:"Löschen",className:"p-1.5 rounded-lg border-none bg-transparent text-slate-400 cursor-pointer flex items-center justify-center hover:text-red-500 hover:bg-red-50 transition-all",children:e.jsx(y,{size:16})})]})]}),f&&e.jsxs("div",{className:"px-3.5 py-3 bg-slate-50 border-t border-slate-100",children:[e.jsx("textarea",{value:r,onChange:b=>h(b.target.value),placeholder:"Deine Notiz zu diesem Punkt...",className:"w-full min-h-[60px] p-2.5 rounded-xl border border-slate-200 text-[13px] text-slate-700 resize-y outline-none transition-colors focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100"}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx(E,{variant:"secondary",size:"sm",onClick:()=>{j(!1),h(s.user_note||"")},children:"Abbrechen"}),e.jsx(E,{variant:x?"secondary":"primary",size:"sm",onClick:N,disabled:t||!m,icon:t?e.jsx(k,{size:12,className:"animate-spin"}):x?e.jsx($,{size:12}):e.jsx(ss,{size:12}),className:x?"bg-green-100 text-green-700 border-green-200":"",children:x?"Gespeichert!":"Speichern"})]})]})]})},ms=({onClick:s,isGenerating:a})=>e.jsx("button",{onClick:s,disabled:a,className:`flex items-center justify-center gap-2 w-full py-3 px-4 mt-3 mb-2 rounded-xl
      border-2 border-dashed border-indigo-200 bg-indigo-50 text-indigo-600 text-[13px] font-medium
      cursor-pointer transition-all
      hover:bg-indigo-100 hover:border-indigo-300 hover:shadow-sm
      disabled:cursor-wait disabled:opacity-60`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:16,className:"animate-spin"}),"Generiere 5 weitere Punkte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{size:16}),"5 weitere Punkte generieren"]})}),hs=({section:s,onUpdateItem:a,onGenerateMore:n,isExpanded:r,onToggle:h})=>{const[t,g]=d.useState(!1),x=async()=>{g(!0);try{await n(s.id)}catch(c){console.error("Error generating more items:",c)}finally{g(!1)}},o=d.useCallback(()=>{if(!s.ai_content)return{type:"empty",items:[],content:""};try{const c=JSON.parse(s.ai_content);if(c&&Array.isArray(c.items))return{type:"items",items:c.items,content:""}}catch{}return{type:"markdown",items:[],content:s.ai_content}},[s.ai_content]),{type:m,items:u,content:f}=o(),j=u.filter(c=>!c.deleted),N=u.filter(c=>c.deleted),v=u.some(c=>c.user_note&&!c.deleted);return e.jsxs(I,{className:"mb-4 overflow-hidden p-0 hover:shadow-lg transition-shadow",children:[e.jsxs("button",{onClick:h,className:`w-full px-5 py-4 flex items-start justify-between gap-2 border-none bg-transparent cursor-pointer ${r?"border-b border-slate-100":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 m-0 text-left flex-1 min-w-0 break-words leading-snug",children:s.section_title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 flex-wrap justify-end",children:[m==="items"&&e.jsxs("span",{className:"text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded-full",children:[j.length," Punkte"]}),v&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full",children:[e.jsx(L,{size:12}),"Notizen"]}),r?e.jsx(Z,{size:20,className:"text-slate-400"}):e.jsx(J,{size:20,className:"text-slate-400"})]})]}),r&&e.jsx("div",{className:"px-5 py-4",children:m==="items"?e.jsxs(e.Fragment,{children:[j.map(c=>e.jsx(R,{item:c,sectionId:s.id,onUpdateItem:a},c.id)),n&&e.jsx(ms,{onClick:x,isGenerating:t}),N.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2 flex items-center gap-1.5",children:[e.jsx(y,{size:12}),N.length," gelöschte ",N.length===1?"Punkt":"Punkte"]}),N.map(c=>e.jsx(R,{item:c,sectionId:s.id,onUpdateItem:a},c.id))]})]}):m==="markdown"?e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(U,{size:16,className:"text-indigo-600"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"KI-Empfehlung"})]}),e.jsx(Q,{content:f})]}):e.jsx("p",{className:"text-slate-400 italic",children:"Kein Inhalt verfügbar"})})]})},O=({onClick:s,disabled:a,loading:n,icon:r,danger:h,title:t})=>e.jsx("button",{onClick:s,disabled:a,title:t,className:`flex items-center justify-center rounded-xl px-3 py-2.5 border cursor-pointer outline-none transition-all
      ${h?"bg-red-500/20 border-red-500/40 text-white hover:bg-red-500/30 hover:shadow-lg":"bg-white/20 border-white/30 text-white hover:bg-white/30 hover:shadow-lg"}
      disabled:opacity-60 disabled:cursor-not-allowed`,children:n?e.jsx(k,{size:16,className:"animate-spin"}):e.jsx(r,{size:16})}),us=({variables:s,isExpanded:a,onToggle:n})=>!s||Object.keys(s).length===0?null:e.jsxs(I,{className:"mb-5 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("button",{onClick:n,className:"flex items-center justify-between w-full p-0 border-none bg-transparent cursor-pointer",children:[e.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Deine Angaben (",Object.keys(s).length,")"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 hover:text-indigo-600 transition-colors",children:[e.jsx("span",{className:"text-xs",children:a?"Einklappen":"Ausklappen"}),a?e.jsx(Z,{size:16}):e.jsx(J,{size:16})]})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 flex flex-wrap gap-2",children:Object.entries(s).map(([r,h])=>e.jsxs("span",{className:"bg-indigo-50 px-3 py-1.5 rounded-full text-xs text-slate-700 border border-indigo-100",children:[e.jsxs("strong",{className:"text-indigo-700",children:[ds(r),":"]})," ",h]},r))})]}),gs=({isOpen:s,onClose:a,onConfirm:n,isDeleting:r})=>e.jsx(es,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/50 z-[1000]"}),e.jsx(G.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 max-w-[400px] w-[90%] z-[1001] shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{size:24,className:"text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Briefing löschen?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Diese Aktion kann nicht rückgängig gemacht werden. Dein Briefing und alle Notizen werden dauerhaft gelöscht."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{variant:"secondary",onClick:a,disabled:r,fullWidth:!0,children:"Abbrechen"}),e.jsx(E,{variant:"danger",onClick:n,disabled:r,icon:r?e.jsx(k,{size:16,className:"animate-spin"}):e.jsx(y,{size:16}),fullWidth:!0,children:r?"Löschen...":"Löschen"})]})]})})]})}),vs=({briefing:s,onBack:a,onDelete:n})=>{const{config:r}=as(),h=rs(),[t,g]=d.useState(s),[x,o]=d.useState(!s?.sections),[m,u]=d.useState(null),[f,j]=d.useState({}),[N,v]=d.useState(!1),[c,b]=d.useState(!1),[Y,T]=d.useState(!1),[_,F]=d.useState(!1),X=os(t?.template_icon)||z;d.useEffect(()=>{const i=async()=>{if(t?.sections){const l={};t.sections.forEach(p=>{l[p.id]=!0}),j(l),o(!1);return}try{o(!0);const l=await B.request(`/smartbriefing/briefings/${t.id}`,{method:"GET"});if(l.success&&l.data?.briefing){g(l.data.briefing);const p={};l.data.briefing.sections?.forEach(w=>{p[w.id]=!0}),j(p)}else throw new Error("Fehler beim Laden des Briefings")}catch(l){console.error("[SmartBriefing] Error fetching briefing:",l),u(l.message)}finally{o(!1)}};t?.id&&i()},[t?.id]);const ee=d.useCallback(i=>{j(l=>({...l,[i]:!l[i]}))},[]),se=d.useCallback(async(i,l,p)=>{const w=await B.request(`/smartbriefing/sections/${i}/items/${l}`,{method:"PATCH",body:JSON.stringify(p)});if(!w.success)throw new Error("Fehler beim Speichern");g(P=>({...P,sections:P.sections.map(C=>C.id===i?w.data.section:C)}))},[]),te=d.useCallback(async i=>{const l=await B.request(`/smartbriefing/sections/${i}/generate-more`,{method:"POST"});if(!l.success)throw new Error(l.message||"Fehler beim Generieren");return g(p=>({...p,sections:p.sections.map(w=>w.id===i?l.data.section:w)})),l.data.new_items_count},[]),ae=d.useCallback(async()=>{if(!(_||!t?.id)){F(!0);try{const i=await B.request(`/smartbriefing/briefings/${t.id}/pdf`,{method:"GET"});if(!i.success||!i.data?.pdf_base64)throw new Error(i.message||"PDF-Export fehlgeschlagen");const l=atob(i.data.pdf_base64),p=new Array(l.length);for(let A=0;A<l.length;A++)p[A]=l.charCodeAt(A);const w=new Uint8Array(p),P=new Blob([w],{type:"application/pdf"}),C=window.URL.createObjectURL(P),S=document.createElement("a");S.href=C,S.download=i.data.filename||"Smart-Briefing.pdf",document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(C)}catch(i){console.error("[SmartBriefing] PDF download error:",i)}finally{F(!1)}}},[t?.id,_]),ne=async()=>{if(!(!n||!t?.id)){T(!0);try{await n(t)}catch(i){console.error("Failed to delete briefing:",i)}finally{T(!1),b(!1)}}};return t?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"sticky top-0 z-40 px-4 py-5 md:px-8 md:py-6",style:{background:"var(--header-gradient, linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%))"},children:e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[a&&e.jsxs("button",{onClick:a,className:"flex items-center gap-1.5 bg-white/15 border-none rounded-xl px-3 py-2 cursor-pointer text-white text-[13px] mb-4 hover:bg-white/25 hover:shadow-lg transition-all",children:[e.jsx(Ye,{size:16}),"Zurück zur Übersicht"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[!h&&e.jsx("div",{className:"w-[90px] h-[90px] rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx(X,{size:40,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap mb-2",children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide px-2.5 py-1 rounded-full bg-white/20 text-white",children:"Smart Briefing"}),e.jsx("span",{className:"text-xs font-medium px-2.5 py-1 rounded-full bg-white/90 text-indigo-700",children:t.template_title})]}),e.jsx("h1",{className:`font-bold text-white m-0 mb-2 ${h?"text-xl":"text-2xl"}`,children:t.title||"Briefing"}),e.jsx("div",{className:"flex items-center gap-4 flex-wrap",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-[13px] text-white/80",children:[e.jsx(H,{size:14}),ns(t.created_at)]})})]}),e.jsxs("div",{className:"flex gap-2.5 flex-shrink-0",children:[e.jsx(O,{onClick:ae,disabled:_,loading:_,icon:Xe,title:"Als PDF herunterladen"}),n&&e.jsx(O,{onClick:()=>b(!0),icon:y,danger:!0,title:"Briefing löschen"})]})]})]})}),e.jsxs("div",{className:`max-w-[900px] mx-auto ${h?"p-4":"px-8 py-6"}`,children:[e.jsx(us,{variables:t.variables,isExpanded:N,onToggle:()=>v(!N)}),x&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(k,{size:40,className:"text-indigo-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-slate-600 font-medium",children:"Briefing wird geladen..."})]}),m&&!x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-red-600 m-0",children:m})}),!x&&!m&&t.sections&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(D,{size:18,className:"text-indigo-600"}),e.jsx("h2",{className:"text-base font-semibold text-slate-900 m-0",children:"Briefing-Inhalte"}),e.jsxs("span",{className:"text-[13px] font-medium text-slate-500 bg-slate-100 px-2.5 py-0.5 rounded-full",children:[t.sections.length," Abschnitte"]})]}),t.sections.map(i=>e.jsx(hs,{section:i,onUpdateItem:se,onGenerateMore:te,isExpanded:f[i.id],onToggle:()=>ee(i.id)},i.id))]}),!x&&!m&&(!t.sections||t.sections.length===0)&&t.content_markdown&&e.jsx(I,{className:"p-6",children:e.jsx(Q,{content:t.content_markdown})}),e.jsx("div",{className:"mt-6 px-5 py-4 bg-indigo-50 rounded-2xl border border-indigo-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{size:18,className:"text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"m-0 mb-1 text-slate-900 text-sm font-semibold",children:"Tipp: Personalisiere dein Briefing"}),e.jsx("p",{className:"m-0 text-slate-600 text-[13px] leading-relaxed",children:"Klicke auf das Stift-Icon bei jedem Punkt, um deine eigenen Notizen hinzuzufügen. Nicht relevante Punkte kannst du mit dem Papierkorb-Icon ausblenden."})]})]})})]}),e.jsx(gs,{isOpen:c,onClose:()=>b(!1),onConfirm:ne,isDeleting:Y})]}):null};export{vs as B,os as a,ks as g};
