import{V as Oe,c as We,a as Ge,b as Ze}from"./VideoTrainingApp-BRSSeawc.js";import{z as N,a as ne,a3 as ae,J as H,I as $,B as ie,M as le,V as oe,ap as I,e as A,g as ce,l as Q,j as e,w as de,E as L,a8 as me,C as ue,u as xe}from"./ui-vendor-CDZVYibh.js";import{a as n}from"./react-vendor-uDOJF2jQ.js";import{u as pe,g as he,a as U}from"./FeatureInfoButton-DB5lQe7S.js";import{F as ge}from"./fullscreen-loader-Bhu3nY-I.js";import{C as E,B as fe}from"./select-native-VdBGhKK_.js";import"./dialog-jLCTDy-1.js";import"./ScenarioDashboard-DkM_EXVq.js";import"./ScenarioCard-zGIcOdg7.js";import"./useMobile-YxjH166V.js";import"./button--2kfBOSF.js";import"./MicrophoneTestDialog-BhgD0e4g.js";import"./utils-BEHD0UYf.js";import"./input-B7rblInv.js";import"./textarea-CliYojgU.js";import"./DeviceSettingsDialog-B3HbcRPY.js";import"./DeviceSetupPage-4NSVYRUj.js";import"./progress-bar-y2Z0xprx.js";import"./Confetti-DaZvruMH.js";import"./audioMetricsAdapter-aAsYJoo0.js";import"./index-CklPxmEV.js";const be=t=>t?t.split(/(\*\*.*?\*\*)/g).map((c,m)=>c.startsWith("**")&&c.endsWith("**")?e.jsx("strong",{children:c.slice(2,-2)},m):c):null,J={target:Q,clock:ce,mic:A,camera:I,video:oe,"message-square":le,lightbulb:N,brain:ie,info:$,settings:H,check:ae,sparkles:ne},ve=[{icon:I,title:"Blick in die Kamera",description:"Schaue direkt in die Kamera, um Augenkontakt zu simulieren."},{icon:N,title:"Gute Beleuchtung",description:"Achte auf ausreichend Licht von vorne, um professionell zu wirken."},{icon:A,title:"Klare Aussprache",description:"Sprich deutlich und in angemessenem Tempo."},{icon:Q,title:"Strukturierte Antworten",description:"Nutze die STAR-Methode: Situation, Task, Action, Result."}],X=({type:t,devices:x,selectedDeviceId:c,onDeviceChange:m,isLoading:p,error:u,onRefresh:i})=>{const[g,v]=n.useState(!1),w=t==="video"?I:A,y=t==="video"?"Kamera":"Mikrofon",S=l=>{if(l.label){let o=l.label;return o=o.replace(/^Default - /,""),o=o.replace(/^Kommunikation - /,""),o=o.replace(/^Standard - /,""),o.length>35&&(o=o.substring(0,32)+"..."),o}return`${y} ${x.indexOf(l)+1}`},j=x.find(l=>l.deviceId===c),M=l=>{m?.(l),v(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>!p&&v(!g),disabled:p,className:`flex-1 min-w-[200px] flex items-center justify-between gap-3 p-3 rounded-xl border-2 transition-all
            ${u?"border-red-500 bg-red-50":"border-slate-200 bg-white"}
            ${p?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-[10px] flex items-center justify-center
              ${u?"bg-red-100":"bg-brand-gradient"}`,children:u?e.jsx(L,{className:"w-[22px] h-[22px] text-red-500"}):e.jsx(w,{className:"w-[22px] h-[22px] text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium mb-0.5",children:y}),e.jsx("div",{className:`text-sm font-semibold ${u?"text-red-600":"text-slate-900"}`,children:p?"Lade...":u||(j?S(j):"Bitte wählen")})]})]}),e.jsx(ue,{className:`w-5 h-5 text-slate-400 transition-transform duration-200 ${g?"rotate-180":""}`})]}),u&&i&&e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center px-4 py-3 rounded-xl border-2 border-slate-200 bg-white cursor-pointer hover:bg-slate-50 transition-colors",children:e.jsx(xe,{className:"w-5 h-5 text-slate-600"})})]}),g&&x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>v(!1),className:"fixed inset-0 z-40"}),e.jsx("div",{className:"absolute top-[calc(100%+8px)] left-0 right-0 bg-white rounded-xl shadow-xl border border-slate-200 z-50 overflow-hidden max-h-[280px] overflow-y-auto",children:x.map((l,o)=>{const f=c===l.deviceId;return e.jsxs("button",{type:"button",onClick:()=>M(l.deviceId),className:`w-full py-3.5 px-4 text-left flex items-center gap-3 border-none cursor-pointer transition-colors
                    ${f?"bg-primary/10":"bg-transparent hover:bg-slate-50"}`,children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center
                    ${f?"bg-primary":"bg-slate-100"}`,children:e.jsx(w,{className:`w-[18px] h-[18px] ${f?"text-white":"text-slate-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`text-sm font-medium truncate ${f?"text-primary":"text-slate-900"}`,children:S(l)}),l.deviceId==="default"&&e.jsx("div",{className:"text-xs text-slate-400",children:"Systemstandard"})]}),f&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},l.deviceId||o)})})]})]})},je=({field:t,value:x,onChange:c,error:m})=>{const p=`w-full py-3 px-4 rounded-[10px] border-2 text-base transition-all outline-none bg-white
    ${m?"border-red-500":"border-slate-200"}
    focus:border-primary focus:ring-2 focus:ring-primary/20`,u=()=>{switch(t.type){case"select":return e.jsxs("select",{value:x||t.default||"",onChange:i=>c(t.key,i.target.value),className:`${p} cursor-pointer`,required:t.required,children:[!t.default&&e.jsx("option",{value:"",children:"Bitte auswählen..."}),t.options?.slice().sort((i,g)=>i.label.localeCompare(g.label,"de")).map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]});case"textarea":return e.jsx("textarea",{value:x||"",onChange:i=>c(t.key,i.target.value),placeholder:t.placeholder,className:`${p} min-h-[100px] resize-y`,required:t.required});case"number":return e.jsx("input",{type:"number",value:x||"",onChange:i=>c(t.key,i.target.value),placeholder:t.placeholder,className:p,required:t.required,min:t.min,max:t.max});default:return e.jsx("input",{type:"text",value:x||"",onChange:i=>c(t.key,i.target.value),placeholder:t.placeholder,className:p,required:t.required})}};return e.jsxs("div",{className:"mb-5",children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),u(),t.hint&&e.jsx("p",{className:"text-[13px] text-slate-400 mt-1",children:t.hint}),m&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(L,{size:14}),m]})]})},_e=({scenario:t,onBack:x,onStart:c})=>{const[m,p]=n.useState(()=>{const s=t?.input_configuration||[],r={};return s.forEach(a=>{a.default&&(r[a.key]=a.default)}),r}),[u,i]=n.useState({}),[g,v]=n.useState(!1),[w,y]=n.useState(null),[S,j]=n.useState([]),[M,l]=n.useState([]),[o,f]=n.useState(null),[V,K]=n.useState(null),[_,B]=n.useState(!0),[P,k]=n.useState(null),[O,C]=n.useState(null),q=n.useRef(0),D=n.useRef(!1),z=n.useRef(!0),F=n.useRef(0),W=n.useRef(null),G=n.useRef(null),{demoCode:Y}=pe();W.current=o,G.current=V;const T=n.useCallback(async(s=!1)=>{if(D.current){console.log("[VideoTraining] Skipping loadDevices - already loading");return}if(s){if(z.current){console.log("[VideoTraining] Skipping devicechange - ignore flag set");return}const r=Date.now()-q.current;if(r<5e3){console.log("[VideoTraining] Skipping devicechange - too soon:",r,"ms");return}if(F.current+=1,F.current>3){console.log("[VideoTraining] Skipping devicechange - too many events:",F.current);return}}D.current=!0,q.current=Date.now(),B(!0),k(null),C(null);try{(await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(d=>d.stop());const a=await navigator.mediaDevices.enumerateDevices(),h=a.filter(d=>d.kind==="audioinput"),b=a.filter(d=>d.kind==="videoinput");if(h.length===0)k("Kein Mikrofon gefunden"),j([]);else if(j(h),!W.current){const d=h.find(R=>R.deviceId==="default")||h[0];f(d.deviceId)}if(b.length===0)C("Keine Kamera gefunden"),l([]);else if(l(b),!G.current){const d=b.find(R=>R.deviceId==="default")||b[0];K(d.deviceId)}}catch(r){console.error("Error loading devices:",r),r.name==="NotAllowedError"||r.name==="PermissionDeniedError"?(k("Zugriff verweigert"),C("Zugriff verweigert")):r.name==="NotFoundError"?(k("Kein Mikrofon gefunden"),C("Keine Kamera gefunden")):(k("Fehler beim Laden"),C("Fehler beim Laden")),j([]),l([])}finally{B(!1),D.current=!1,q.current=Date.now(),s||setTimeout(()=>{z.current=!1,console.log("[VideoTraining] Now accepting devicechange events")},5e3)}},[]);n.useEffect(()=>{T(!1);let s=null;const r=()=>{z.current||D.current||(s&&clearTimeout(s),s=setTimeout(()=>{T(!0)},1e3))};return navigator.mediaDevices?.addEventListener("devicechange",r),()=>{s&&clearTimeout(s),navigator.mediaDevices?.removeEventListener("devicechange",r)}},[]);const ee=n.useCallback((s,r)=>{p(a=>({...a,[s]:r})),u[s]&&i(a=>{const h={...a};return delete h[s],h})},[u]),te=n.useCallback(()=>{const s={};return(t?.input_configuration||[]).forEach(a=>{a.required&&!m[a.key]&&(s[a.key]=`${a.label} ist erforderlich`)}),i(s),Object.keys(s).length===0},[t,m]),se=async()=>{if(te()){v(!0),y(null);try{const s=he(),r=await fetch(`${s}/video-training/sessions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":U()},body:JSON.stringify({scenario_id:t.id,variables:m,demo_code:Y||null})});if(!r.ok)throw new Error("Fehler beim Erstellen der Sitzung");const a=await r.json();if(!a.success||!a.data?.session)throw new Error("Ungültige Antwort beim Erstellen der Sitzung");const h=a.data.session,b=await fetch(`${s}/video-training/sessions/${h.id}/questions`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":U()}});if(!b.ok)throw new Error("Fehler beim Generieren der Fragen");const d=await b.json();if(!d.success||!d.data?.questions)throw new Error("Fehler beim Generieren der Fragen");c({session:d.data.session,questions:d.data.questions,variables:m,selectedMicrophoneId:o,selectedCameraId:V})}catch(s){console.error("[VIDEO TRAINING] Error starting session:",s),y(s.message)}finally{v(!1)}}},Z=t?.input_configuration||[],re=t?.tips&&Array.isArray(t.tips)&&t.tips.length>0?t.tips.map((s,r)=>typeof s=="string"?{icon:N,title:`Tipp ${r+1}`,description:s}:{icon:J[s.icon]||J[s.icon?.toLowerCase()]||N,title:s.title||`Tipp ${r+1}`,description:s.text||s.description||""}):ve;return e.jsxs("div",{className:"p-6 md:p-8 max-w-[700px] mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:x,className:"flex items-center gap-2 bg-transparent border-none text-slate-500 cursor-pointer text-sm py-2 mb-4 hover:text-slate-700 transition-colors",children:[e.jsx(de,{size:18}),"Zurück"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-gradient flex items-center justify-center",children:e.jsx(N,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600 m-0 mb-1",children:"Vorbereitung"}),e.jsx("h1",{className:"text-[24px] font-bold text-slate-900 m-0",children:t?.title||"Training"})]})]})]}),t?.long_description&&e.jsx(E,{className:"p-5 md:p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 m-0 mb-2",children:"Deine Aufgabe"}),e.jsx("div",{className:"text-[15px] leading-relaxed text-slate-600 m-0 whitespace-pre-wrap",children:be(t.long_description?.replace(/\/n/g,`
`))})]})]})}),Z.length>0&&e.jsxs(E,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(H,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 m-0",children:"Dein Profil"})]}),Z.map(s=>e.jsx(je,{field:s,value:m[s.key],onChange:ee,error:u[s.key]},s.key))]}),e.jsxs(E,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(I,{size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 m-0",children:"Kamera & Mikrofon"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(X,{type:"video",devices:M,selectedDeviceId:V,onDeviceChange:K,isLoading:_,error:O,onRefresh:T}),e.jsx(X,{type:"audio",devices:S,selectedDeviceId:o,onDeviceChange:f,isLoading:_,error:P,onRefresh:T})]}),(P||O)&&e.jsxs("p",{className:"text-[13px] text-slate-400 mt-4 flex items-start gap-2",children:[e.jsx($,{size:16,className:"flex-shrink-0 mt-0.5"}),"Bitte erlaube den Zugriff auf Kamera und Mikrofon in deinen Browser-Einstellungen."]})]}),w&&e.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200 mb-6 flex items-center gap-3",children:[e.jsx(L,{size:20,className:"text-red-500"}),e.jsx("p",{className:"text-red-600 text-sm m-0",children:w})]}),e.jsx(fe,{onClick:se,disabled:g,size:"lg",fullWidth:!0,icon:e.jsx(me,{size:20}),className:"mb-6",children:"Video Training starten"}),e.jsxs(E,{className:"p-5 md:p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx(N,{size:20,className:"text-amber-500"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900 m-0",children:"Tipps für dein Video-Training"})]}),e.jsx("div",{className:"flex flex-col gap-3",children:re.map((s,r)=>{const a=s.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 md:p-4 rounded-xl bg-slate-50",children:[e.jsx("div",{className:"w-9 h-9 rounded-[10px] bg-brand-gradient flex items-center justify-center flex-shrink-0",children:e.jsx(a,{className:"w-[18px] h-[18px] text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-0.5",children:s.title}),e.jsx("p",{className:"text-[13px] text-slate-500 leading-relaxed m-0",children:s.description})]})]},r)})})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl py-4 px-5 flex flex-wrap gap-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Fragen"}),e.jsx("span",{className:"text-lg font-semibold text-slate-900",children:t?.question_count||5})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Zeit pro Frage"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:["~",Math.round((t?.time_limit_per_question||120)/60)," Min"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-400 block",children:"Gesamtdauer"}),e.jsxs("span",{className:"text-lg font-semibold text-slate-900",children:["~",Math.round((t?.total_time_limit||900)/60)," Min"]})]})]}),e.jsx(ge,{isLoading:g,message:"Fragen werden generiert...",subMessage:"Die KI erstellt personalisierte Fragen basierend auf deinen Angaben."})]})};export{Oe as VideoTrainingApp,We as VideoTrainingComplete,Ge as VideoTrainingDashboard,Ze as VideoTrainingSession,_e as VideoTrainingWizard};
