import{j as e,Q as X,p as O,l as J,m as _,au as Z,o as ee,Y as te,O as re,e as oe,r as Q,aq as G,aa as ne,ad as N}from"./ui-vendor-BAEfSb-X.js";import{a as r}from"./react-vendor-uDOJF2jQ.js";import{u as ie}from"./useBranding-CvtU4d75.js";import{a as se,M as ae,A as le}from"./MicrophoneTestDialog-B0wmV7tf.js";import{e as Y}from"./formatting-D8kxjF5h.js";const ce=({type:x,devices:i,selectedDeviceId:s,onDeviceChange:m,isLoading:c,error:d,onRefresh:S,branding:t})=>{const[f,v]=r.useState(!1),A=x==="video"?Z:O,D=x==="video"?"Kamera":"Mikrofon",j=n=>{if(n.label){let a=n.label;return a=a.replace(/^Default - /,""),a=a.replace(/^Kommunikation - /,""),a=a.replace(/^Standard - /,""),a.length>40&&(a=a.substring(0,37)+"..."),a}return`${D} ${i.indexOf(n)+1}`},T=i.find(n=>n.deviceId===s),R=n=>{m?.(n),v(!1)};return e.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:e.jsxs("button",{type:"button",onClick:()=>!c&&v(!f),disabled:c,style:{flex:"1 1 100%",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"14px 18px",borderRadius:"14px",border:`2px solid ${d?t.error:t.borderColor}`,backgroundColor:d?t.errorLight:t.cardBgColor,cursor:c?"not-allowed":"pointer",opacity:c?.6:1,transition:"all 0.2s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",background:d?t.errorLight:t.headerGradient},children:d?e.jsx(te,{style:{width:"24px",height:"24px",color:t.error}}):e.jsx(A,{style:{width:"24px",height:"24px",color:t.white}})}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"13px",color:t.textMuted,fontWeight:500,marginBottom:"2px"},children:D}),e.jsx("div",{style:{fontSize:"15px",fontWeight:600,color:d?t.errorDark:t.textMain},children:c?"Lade...":d||(T?j(T):"Bitte wählen")})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[d&&S&&e.jsx("button",{type:"button",onClick:n=>{n.stopPropagation(),S()},style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"8px",border:"none",backgroundColor:t.cardBgHover,cursor:"pointer"},children:e.jsx(re,{style:{width:"18px",height:"18px",color:t.textSecondary}})}),e.jsx(oe,{style:{width:"22px",height:"22px",color:t.textMuted,transform:f?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s"}})]})]})}),f&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>v(!1),style:{position:"fixed",inset:0,zIndex:40}}),e.jsx("div",{style:{position:"absolute",top:"calc(100% + 8px)",left:0,right:0,backgroundColor:t.cardBgColor,borderRadius:"14px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",border:`1px solid ${t.borderColor}`,zIndex:50,overflow:"hidden",maxHeight:"300px",overflowY:"auto"},children:i.map((n,a)=>e.jsxs("button",{type:"button",onClick:()=>R(n.deviceId),style:{width:"100%",padding:"14px 16px",textAlign:"left",display:"flex",alignItems:"center",gap:"12px",border:"none",backgroundColor:s===n.deviceId?t.primaryAccentLight:t.transparent,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:u=>{s!==n.deviceId&&(u.currentTarget.style.backgroundColor=t.cardBgHover)},onMouseLeave:u=>{u.currentTarget.style.backgroundColor=s===n.deviceId?t.primaryAccentLight:t.transparent},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:s===n.deviceId?t.primaryAccent:t.cardBgHover},children:e.jsx(A,{style:{width:"20px",height:"20px",color:s===n.deviceId?t.white:t.textMuted}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:500,color:s===n.deviceId?t.primaryAccent:t.textMain,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:j(n)}),n.deviceId==="default"&&e.jsx("div",{style:{fontSize:"12px",color:t.textMuted},children:"Systemstandard"})]}),s===n.deviceId&&e.jsx(Q,{style:{width:"20px",height:"20px",color:t.primaryAccent}})]},n.deviceId||a))})]})]})},me=({deviceId:x,branding:i})=>{const[s,m]=r.useState(!1),[c,d]=r.useState(!1),[S,t]=r.useState(0),[f,v]=r.useState(null),[A,D]=r.useState(0),j=r.useRef(null),T=r.useRef(null),R=r.useRef(null),n=r.useRef(null),a=r.useRef(null),u=r.useRef([]),k=r.useRef(null),I=r.useRef(null),U=async()=>{try{v(null),D(0),u.current=[];const h=await navigator.mediaDevices.getUserMedia({audio:x?{deviceId:{exact:x}}:!0});j.current=h;const y=new(window.AudioContext||window.webkitAudioContext);n.current=y;const P=y.createMediaStreamSource(h),C=y.createAnalyser();C.fftSize=256,P.connect(C),T.current=C;const z=new MediaRecorder(h,{mimeType:"audio/webm"});a.current=z,z.ondataavailable=b=>{b.data.size>0&&u.current.push(b.data)},z.onstop=()=>{const b=new Blob(u.current,{type:"audio/webm"});v(b)},z.start(),m(!0);const $=Date.now();I.current=setInterval(()=>{D(Math.floor((Date.now()-$)/1e3))},100);const o=new Uint8Array(C.frequencyBinCount),p=()=>{C.getByteFrequencyData(o);const b=o.reduce((H,M)=>H+M,0)/o.length;t(Math.min(100,b/128*100)),R.current=requestAnimationFrame(p)};p()}catch(h){console.error("Error starting recording:",h)}},W=()=>{I.current&&(clearInterval(I.current),I.current=null),R.current&&(cancelAnimationFrame(R.current),R.current=null),a.current&&a.current.state!=="inactive"&&a.current.stop(),j.current&&(j.current.getTracks().forEach(h=>h.stop()),j.current=null),n.current&&(n.current.close(),n.current=null),m(!1),t(0)},B=()=>{if(!f)return;const h=URL.createObjectURL(f),y=new Audio(h);k.current=y,y.onplay=()=>d(!0),y.onended=()=>{d(!1),URL.revokeObjectURL(h)},y.onerror=()=>{d(!1),URL.revokeObjectURL(h)},y.play()},L=()=>{k.current&&(k.current.pause(),k.current.currentTime=0,k.current=null),d(!1)},E=()=>{L(),v(null),D(0)};return r.useEffect(()=>()=>{W(),L()},[]),r.useEffect(()=>{s&&W(),E()},[x]),e.jsxs("div",{style:{padding:"16px",backgroundColor:i.cardBgHover,borderRadius:"12px",marginTop:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:s?W:U,disabled:c,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:"none",backgroundColor:s?i.error:i.primaryAccent,color:i.white,fontSize:"14px",fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.6:1,transition:"all 0.2s"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(G,{style:{width:"16px",height:"16px"}}),"Stoppen (",Y(A),")"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{style:{width:"16px",height:"16px"}}),"Aufnehmen"]})}),f&&!s&&e.jsx("button",{type:"button",onClick:c?L:B,style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",borderRadius:"10px",border:`2px solid ${i.primaryAccent}`,backgroundColor:c?i.primaryAccentLight:i.cardBgColor,color:i.primaryAccent,fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s"},children:c?e.jsxs(e.Fragment,{children:[e.jsx(G,{style:{width:"16px",height:"16px"}}),"Stoppen"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{style:{width:"16px",height:"16px"}}),"Abspielen"]})}),s&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:i.error,fontSize:"13px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:i.error,animation:"pulse 1s infinite"}}),"Aufnahme läuft..."]}),c&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:i.successDark,fontSize:"13px"},children:[e.jsx(N,{style:{width:"16px",height:"16px"}}),"Wiedergabe..."]}),f&&!s&&!c&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:i.textMuted,fontSize:"13px"},children:[e.jsx(Q,{style:{width:"16px",height:"16px",color:i.success}}),"Aufnahme bereit (",Y(A),")"]})]}),s&&e.jsx(le,{audioLevel:S/100,isActive:!0,variant:"bars",size:"sm"}),!s&&!f&&e.jsxs("p",{style:{margin:0,fontSize:"13px",color:i.textMuted,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(N,{style:{width:"14px",height:"14px"}}),"Nimm etwas auf und spiele es ab, um dein Mikrofon zu testen."]}),e.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
      `})]})},de=({deviceId:x,branding:i})=>{const s=r.useRef(null),m=r.useRef(null),[c,d]=r.useState(null);return r.useEffect(()=>(x&&(async()=>{try{m.current&&m.current.getTracks().forEach(f=>f.stop());const t=await navigator.mediaDevices.getUserMedia({video:x?{deviceId:{exact:x}}:!0});m.current=t,s.current&&(s.current.srcObject=t),d(null)}catch(t){console.error("Error starting camera preview:",t),d("Kamera-Vorschau nicht verfügbar")}})(),()=>{m.current&&m.current.getTracks().forEach(t=>t.stop())}),[x]),c?e.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:i.cardBgHover,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:i.textMuted,fontSize:"14px"},children:c}):e.jsx("div",{style:{aspectRatio:"16/9",backgroundColor:i.textMain,borderRadius:"12px",overflow:"hidden"},children:e.jsx("video",{ref:s,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"}})})},ye=({mode:x="audio",scenario:i,onBack:s,onStart:m,title:c,startButtonLabel:d="Training starten",icon:S,extraContent:t=null,disabled:f=!1})=>{const[v,A]=r.useState(window.innerWidth<768);r.useEffect(()=>{const l=()=>A(window.innerWidth<768);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]);const[D,j]=r.useState([]),[T,R]=r.useState([]),[n,a]=r.useState(null),[u,k]=r.useState(null),[I,U]=r.useState(!0),[W,B]=r.useState(null),[L,E]=r.useState(null),[h,y]=r.useState(!1),P=r.useRef(0),C=r.useRef(!1),z=r.useRef(null),$=r.useRef(null),o=ie(),p=x==="audio-video";z.current=n,$.current=u;const b=r.useCallback(async(l=!1)=>{if(!C.current&&!(l&&Date.now()-P.current<2e3)){C.current=!0,P.current=Date.now(),U(!0),B(null),p&&E(null);try{const w={audio:!0};p&&(w.video=!0),(await navigator.mediaDevices.getUserMedia(w)).getTracks().forEach(g=>g.stop());const V=await navigator.mediaDevices.enumerateDevices();console.log("[DeviceSetupPage] All detected devices:",V.map(g=>({kind:g.kind,label:g.label||"(no label)",deviceId:g.deviceId?.substring(0,8)+"..."})));const F=V.filter(g=>g.kind==="audioinput"),K=V.filter(g=>g.kind==="videoinput");if(console.log("[DeviceSetupPage] Audio inputs:",F.length,"Video inputs:",K.length),F.length===0)console.warn("[DeviceSetupPage] No audioinput devices found"),B("Kein Mikrofon gefunden"),j([]);else if(j(F),!z.current){const g=F.find(q=>q.deviceId==="default")||F[0];a(g.deviceId)}if(p){if(K.length===0)E("Keine Kamera gefunden"),R([]);else if(R(K),!$.current){const g=K.find(q=>q.deviceId==="default")||K[0];k(g.deviceId)}}}catch(w){console.error("Error loading devices:",w),w.name==="NotAllowedError"||w.name==="PermissionDeniedError"?(B("Zugriff verweigert"),p&&E("Zugriff verweigert")):w.name==="NotFoundError"?(B("Kein Mikrofon gefunden"),p&&E("Keine Kamera gefunden")):(B("Fehler beim Laden"),p&&E("Fehler beim Laden"))}finally{U(!1),C.current=!1,P.current=Date.now()}}},[p]);r.useEffect(()=>{b(!1);let l=null;const w=()=>{l&&clearTimeout(l),l=setTimeout(()=>{b(!0)},500)};return navigator.mediaDevices?.addEventListener("devicechange",w),()=>{l&&clearTimeout(l),navigator.mediaDevices?.removeEventListener("devicechange",w)}},[]);const H=()=>{m({selectedMicrophoneId:n,selectedCameraId:p?u:null})},M=n&&!W&&(!p||u&&!L)&&!f;return e.jsxs("div",{style:{padding:"24px",paddingBottom:v?"120px":"40px",maxWidth:"640px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("button",{onClick:s,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"8px 12px",marginBottom:"16px",border:"none",background:o.transparent,color:o.textSecondary,fontSize:"14px",cursor:"pointer",borderRadius:"8px",transition:"background 0.2s"},onMouseEnter:l=>l.target.style.background=o.cardBgHover,onMouseLeave:l=>l.target.style.background=o.transparent,children:[e.jsx(X,{style:{width:"18px",height:"18px"}}),"Zurück"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",background:o.headerGradient,display:"flex",alignItems:"center",justifyContent:"center"},children:S?e.jsx(S,{style:{width:"28px",height:"28px",color:o.headerText}}):e.jsx(O,{style:{width:"28px",height:"28px",color:o.headerText}})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:o.textMain,margin:0},children:c||i?.title||"Geräte einrichten"}),e.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,margin:"4px 0 0 0"},children:p?"Kamera und Mikrofon auswählen":"Mikrofon auswählen und testen"})]})]})]}),I&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 24px",backgroundColor:o.cardBgHover,borderRadius:"16px"},children:[e.jsx(J,{style:{width:"32px",height:"32px",color:o.primaryAccent,marginBottom:"16px"},className:"animate-spin"}),e.jsx("p",{style:{color:o.textSecondary,margin:0},children:"Geräte werden geladen..."})]}),!I&&e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[p&&e.jsxs("div",{style:{padding:"24px",backgroundColor:o.cardBgColor,borderRadius:"16px",border:`1px solid ${o.borderColor}`,marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx(Z,{style:{width:"22px",height:"22px",color:o.primaryAccent}}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:o.textMain,margin:0},children:"Kamera auswählen"})]}),e.jsx(ce,{type:"video",devices:T,selectedDeviceId:u,onDeviceChange:k,isLoading:I,error:L,onRefresh:b,branding:o}),u&&!L&&e.jsx(de,{deviceId:u,branding:o})]}),e.jsxs("div",{style:{padding:"24px",backgroundColor:o.cardBgColor,borderRadius:"16px",border:`1px solid ${o.borderColor}`,marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx(O,{style:{width:"22px",height:"22px",color:o.primaryAccent}}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:o.textMain,margin:0},children:"Mikrofon testen"})]}),e.jsx(se,{selectedDeviceId:n,onDeviceChange:a,onTestClick:()=>y(!0)})]}),t&&e.jsx("div",{style:{marginBottom:"24px"},children:t}),e.jsx("div",{style:v?{position:"fixed",bottom:0,left:0,right:0,padding:"16px",background:`linear-gradient(to top, ${o.pageBg} 80%, transparent)`,zIndex:100}:{},children:e.jsxs("button",{onClick:H,disabled:!M,style:{width:"100%",maxWidth:v?"100%":void 0,padding:"16px 24px",borderRadius:"14px",border:"none",background:M?o.buttonGradient:o.disabledBg,color:o.white,fontSize:"16px",fontWeight:600,cursor:M?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:M?`0 4px 12px ${o.primaryAccent}4d`:"none"},onMouseEnter:l=>{M&&(l.target.style.transform="translateY(-2px)",l.target.style.boxShadow=`0 6px 16px ${o.primaryAccent}66`)},onMouseLeave:l=>{l.target.style.transform="none",l.target.style.boxShadow=M?`0 4px 12px ${o.primaryAccent}4d`:"none"},children:[d,e.jsx(ee,{style:{width:"20px",height:"20px"}})]})})]}),e.jsx(ae,{isOpen:h,onClose:()=>y(!1),deviceId:n})]})};export{ye as D,me as M};
